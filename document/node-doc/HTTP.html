<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/HTTP.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="HTTP"><meta property="og:description" content="HTTP Node.js ä¸­çš„ HTTP æ¨¡å—å…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è¿™æ˜¯ç½‘ç»œåº”ç”¨å¼€å‘çš„åŸºç¡€ï¼Œå› ä¸º HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ Web ä¸Šæ•°æ®äº¤æ¢çš„ä¸»è¦æ–¹å¼ã€‚ HTTP æœåŠ¡å™¨ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨éå¸¸ç›´æ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒNode.js ä¼šå¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šç›‘å¬æœ¬åœ°..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"HTTP","description":"HTTP Node.js ä¸­çš„ HTTP æ¨¡å—å…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è¿™æ˜¯ç½‘ç»œåº”ç”¨å¼€å‘çš„åŸºç¡€ï¼Œå› ä¸º HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ Web ä¸Šæ•°æ®äº¤æ¢çš„ä¸»è¦æ–¹å¼ã€‚ HTTP æœåŠ¡å™¨ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨éå¸¸ç›´æ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒNode.js ä¼šå¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šç›‘å¬æœ¬åœ°..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>HTTP | hanekawa-shiki</title><meta name="description" content="HTTP Node.js ä¸­çš„ HTTP æ¨¡å—å…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è¿™æ˜¯ç½‘ç»œåº”ç”¨å¼€å‘çš„åŸºç¡€ï¼Œå› ä¸º HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ Web ä¸Šæ•°æ®äº¤æ¢çš„ä¸»è¦æ–¹å¼ã€‚ HTTP æœåŠ¡å™¨ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨éå¸¸ç›´æ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒNode.js ä¼šå¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šç›‘å¬æœ¬åœ°...">
    <link rel="stylesheet" href="/assets/css/styles.a84c0532.css">
    <link rel="preload" href="/assets/js/runtime~app.8acf974b.js" as="script"><link rel="preload" href="/assets/css/styles.a84c0532.css" as="style"><link rel="preload" href="/assets/js/4485.e6fe7c7b.js" as="script"><link rel="preload" href="/assets/js/app.fff57528.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-CommonJS%20modules.html" aria-label="Modules: CommonJS modules"><!---->Modules: CommonJS modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-ECMAScript%20modules.html" aria-label="Modules: ECMAScript modules"><!---->Modules: ECMAScript modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-node_module%20API.html" aria-label="Modules: node:module API"><!---->Modules: node:module API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><!---->Modules: Packages<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->HTTP</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 379 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT379M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 113646 å­—</span><meta property="wordCount" content="113646"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-æœåŠ¡å™¨">HTTP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-å®¢æˆ·ç«¯">HTTP å®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-http-agent">Class: http.Agent</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦-http-agent">ä¸ºä»€ä¹ˆéœ€è¦ http.Agentï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-agent-å¦‚ä½•å·¥ä½œ">http.Agent å¦‚ä½•å·¥ä½œï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹åŒ–ä¸€ä¸ª-agent">å®ä¾‹åŒ–ä¸€ä¸ª Agent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-agent-options">new Agent([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-åˆ›å»ºé»˜è®¤çš„-http-agent">å®ä¾‹ 1ï¼šåˆ›å»ºé»˜è®¤çš„ HTTP Agent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-åˆ›å»ºå¸¦æœ‰é…ç½®çš„-http-agent">å®ä¾‹ 2ï¼šåˆ›å»ºå¸¦æœ‰é…ç½®çš„ HTTP Agent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-3-å…³é—­-agent-çš„è¿æ¥æ± ">å®ä¾‹ 3ï¼šå…³é—­ Agent çš„è¿æ¥æ± </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-createconnection-options-callback">agent.createConnection(options[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-ä½¿ç”¨-agent-createconnection">ä¾‹å­ 1ï¼šä½¿ç”¨ agent.createConnection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-ä½¿ç”¨-unix-åŸŸå¥—æ¥å­—">ä¾‹å­ 2ï¼šä½¿ç”¨ UNIX åŸŸå¥—æ¥å­—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-keepsocketalive-socket">agent.keepSocketAlive(socket)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-keepsocketalive-socket-1">agent.keepSocketAlive(socket)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-reusesocket-socket-request">agent.reuseSocket(socket, request)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-reusesocket-socket-request-1">agent.reuseSocket(socket, request)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-destroy">agent.destroy()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº†è§£-http-agent">äº†è§£ http.Agent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-destroy-æ–¹æ³•">agent.destroy() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-freesockets">agent.freeSockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-æŸ¥çœ‹ç©ºé—²çš„-sockets">ç¤ºä¾‹ 1ï¼šæŸ¥çœ‹ç©ºé—²çš„ sockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-é‡ç”¨-sockets">ç¤ºä¾‹ 2ï¼šé‡ç”¨ sockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-getname-options">agent.getName([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-1">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-getname-options-1">agent.getName([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-maxfreesockets">agent.maxFreeSockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-agent-maxfreesockets">ä»€ä¹ˆæ˜¯ agent.maxFreeSocketsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-maxsockets">agent.maxSockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é»˜è®¤å€¼">é»˜è®¤å€¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦è®¾ç½®agent-maxsockets">ä¸ºä»€ä¹ˆè¦è®¾ç½®agent.maxSockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•è®¾ç½®">å¦‚ä½•è®¾ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-maxtotalsockets">agent.maxTotalSockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•è®¾ç½®-1">å¦‚ä½•è®¾ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-requests">agent.requests</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-requests-1">agent.requests</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#agent-sockets">agent.sockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-agent-sockets">è§£é‡Š agent.sockets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¾‹è¯´æ˜">ä¸¾ä¾‹è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨">å®é™…è¿ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-http-clientrequest">Class: http.ClientRequest</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-clientrequest">http.ClientRequest</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-abort">Event: &#39;abort&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-abort-äº‹ä»¶">ä»€ä¹ˆæ˜¯ abort äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-abort-äº‹ä»¶å¾ˆé‡è¦">ä¸ºä»€ä¹ˆ abort äº‹ä»¶å¾ˆé‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯event-close">ä»€ä¹ˆæ˜¯Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-3">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connect">Event: &#39;connect&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-connect-æ–¹æ³•">HTTP CONNECT æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„äº‹ä»¶">Node.js ä¸­çš„äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connect-1">Event: &#39;connect&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-continue">Event: &#39;continue&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-continue-1">Event: &#39;continue&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-finish">Event: &#39;finish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-information">Event: &#39;information&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-http">ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-2-å’Œ-1xx-çŠ¶æ€ç ">HTTP/2 å’Œ 1xx çŠ¶æ€ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-information-äº‹ä»¶">Node.js ä¸­çš„ information äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-response">Event: &#39;response&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-response-1">Event: &#39;response&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-1">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-socket">Event: &#39;socket&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-socket-1">Event: &#39;socket&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-timeout">Event: &#39;timeout&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€è§£é‡Š">åŸºç¡€è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-2">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-upgrade">Event: &#39;upgrade&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-abort">request.abort()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬è§£é‡Š">åŸºæœ¬è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ">å¦‚ä½•å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-aborted">request.aborted</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-aborted-ç®€ä»‹">request.aborted ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-connection">request.connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨-1">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-cork">request.cork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-request-cork">ä»€ä¹ˆæ˜¯ request.cork()ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ-1">å¦‚ä½•å·¥ä½œï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-3">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-end-data-encoding-callback">request.end([data[, encoding]][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-å‘é€-get-è¯·æ±‚">ç¤ºä¾‹ 1ï¼šå‘é€ GET è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-å‘é€å¸¦æœ‰æ•°æ®çš„-post-è¯·æ±‚">ç¤ºä¾‹ 2ï¼šå‘é€å¸¦æœ‰æ•°æ®çš„ POST è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-destroy-error">request.destroy([error])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-destroy-error-æ–¹æ³•">request.destroy([error]) æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-4">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-finished">request.finished</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯å’Œé‡è¦æ€§">ä½¿ç”¨åœºæ™¯å’Œé‡è¦æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-flushheaders">request.flushHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æå‰å‘é€è¯·æ±‚å¤´éƒ¨">1. æå‰å‘é€è¯·æ±‚å¤´éƒ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å®ç°é•¿è½®è¯¢">2. å®ç°é•¿è½®è¯¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-getheader-name">request.getHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ç®€ä»‹">Node.js ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-è¯·æ±‚å’Œå“åº”">HTTP è¯·æ±‚å’Œå“åº”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-getheader-name-1">request.getHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä½¿ç”¨ä¾‹å­">å®é™…ä½¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-3">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-getheadernames">request.getHeaderNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-http-è¯·æ±‚å’Œå¤´éƒ¨-headers">ç†è§£ HTTP è¯·æ±‚å’Œå¤´éƒ¨(Headers)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯request-getheadernames">ä»€ä¹ˆæ˜¯request.getHeaderNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-getheaders">request.getHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å·¥ä½œåŸç†">å·¥ä½œåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨-2">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-getrawheadernames">request.getRawHeaderNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-getrawheadernames-1">request.getRawHeaderNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-hasheader-name">request.hasHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ–¹æ³•è¯´æ˜">æ–¹æ³•è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-1">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-maxheaderscount">request.maxHeadersCount</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£request-maxheaderscount">ç†è§£request.maxHeadersCount</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é»˜è®¤å€¼-1">é»˜è®¤å€¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-path">request.path</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-request-path">ä»€ä¹ˆæ˜¯ request.pathï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-request-path-é‡è¦">ä¸ºä»€ä¹ˆ request.path é‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨å®ä¾‹">å®é™…è¿ç”¨å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-method">request.method</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨">ä¾‹å­ 1: åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-å¤„ç†ä¸åŒç±»å‹çš„-http-è¯·æ±‚">ä¾‹å­ 2: å¤„ç†ä¸åŒç±»å‹çš„ HTTP è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-host">request.host</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨">åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è®¿é—®-request-host">è®¿é—® request.host</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-7">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-protocol">request.protocol</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-8">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-removeheader-name">request.removeHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-reusedsocket">request.reusedSocket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯request-reusedsocket">ä»€ä¹ˆæ˜¯request.reusedSocket?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tcp-è¿æ¥å’Œé‡ç”¨">TCP è¿æ¥å’Œé‡ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-setheader-name-value">request.setHeader(name, value)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ ¼å¼">æ ¼å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-9">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-setnodelay-nodelay">request.setNoDelay([noDelay])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-2">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-setnodelay-nodelay-1">request.setNoDelay([noDelay])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-10">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-setsocketkeepalive-enable-initialdelay">request.setSocketKeepAlive([enable][, initialDelay])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-2">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-setsocketkeepalive">ä½¿ç”¨ setSocketKeepAlive</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-4">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-settimeout-timeout-callback">request.setTimeout(timeout[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-settimeout-timeout-callback-1">request.setTimeout(timeout[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®è·µä¾‹å­">å®è·µä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-5">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-socket">request.socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-socket-1">request.socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-6">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-uncork">request.uncork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-writableended">request.writableEnded</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-3">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-request-writableended">ä»€ä¹ˆæ˜¯ request.writableEndedï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-11">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-writablefinished">request.writableFinished</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-2">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-write-chunk-encoding-callback">request.write(chunk[, encoding][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#request-write-chunk-encoding-callback-1">request.write(chunk[, encoding][, callback])</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-http-server">Class: http.Server</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-http-server-1">Class: http.Server</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-checkcontinue">Event: &#39;checkContinue&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#èƒŒæ™¯">èƒŒæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-checkcontinue-1">Event: &#39;checkContinue&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-checkexpectation">Event: &#39;checkExpectation&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-çš„-expect-å¤´éƒ¨">HTTP çš„ Expect å¤´éƒ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-checkexpectation-äº‹ä»¶">Node.js ä¸­çš„ checkExpectation äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-9">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-7">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-clienterror">Event: &#39;clientError&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#clienterror-äº‹ä»¶">clientError äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close-1">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connect-2">Event: &#39;connect&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connection">Event: &#39;connection&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•ä»‹ç»">ç®€å•ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆå®ƒé‡è¦">ä¸ºä»€ä¹ˆå®ƒé‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¸¾ä¾‹">å®é™…è¿ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -2">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-droprequest">Event: &#39;dropRequest&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-event-droprequest">ä»€ä¹ˆæ˜¯ Event: &#39;dropRequest&#39;?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦-droprequest-äº‹ä»¶">ä¸ºä»€ä¹ˆéœ€è¦&#39;dropRequest&#39;äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-droprequest-äº‹ä»¶">å¦‚ä½•ä½¿ç”¨&#39;dropRequest&#39;äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-12">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-request">Event: &#39;request&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-3">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-æ¨¡å—">HTTP æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-request-1">Event: &#39;request&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-8">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-upgrade-1">Event: &#39;upgrade&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-close-callback">server.close([callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-close-callback-1">server.close([callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-closeallconnections">server.closeAllConnections()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-4">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-closeallconnections-ç®€ä»‹">server.closeAllConnections()ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-13">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-closeidleconnections">server.closeIdleConnections()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-5">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-1">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-headerstimeout">server.headersTimeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-listen">server.listen()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ç›‘å¬ç‰¹å®šç«¯å£">1. ç›‘å¬ç‰¹å®šç«¯å£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ç›‘å¬ç«¯å£å¹¶æŒ‡å®šä¸»æœºå">2. ç›‘å¬ç«¯å£å¹¶æŒ‡å®šä¸»æœºå</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-éšæœºåˆ†é…ç«¯å£">3. éšæœºåˆ†é…ç«¯å£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ä½¿ç”¨-promise-å’Œå¼‚æ­¥å‡½æ•°">4. ä½¿ç”¨ Promise å’Œå¼‚æ­¥å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-listening">server.listening</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-maxheaderscount">server.maxHeadersCount</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-10">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-requesttimeout">server.requestTimeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-settimeout-msecs-callback">server.setTimeout([msecs][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-4">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-11">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-maxrequestspersocket">server.maxRequestsPerSocket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½œç”¨">ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é»˜è®¤å€¼-2">é»˜è®¤å€¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-3">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-timeout">server.timeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-timeout-1">server.timeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-14">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-keepalivetimeout">server.keepAliveTimeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-4">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#serversymbol-asyncdispose-https-nodejs-org-docs-latest-api-http-html-serversymbolasyncdispose">[serverSymbol.asyncDispose](https://nodejs.org/docs/latest/api/http.html#serversymbolasyncdispose)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-http-serverresponse">Class: http.ServerResponse</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-5">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-12">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-9">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close-2">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-5">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close-3">[Event: &#39;close&#39;]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-6">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-10">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-finish-1">Event: &#39;finish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-finish-2">Event: &#39;finish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-11">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-addtrailers-headers">response.addTrailers(headers)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-http-trailer">ä»€ä¹ˆæ˜¯ HTTP Trailerï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-response-addtrailers-headers">å¦‚ä½•ä½¿ç”¨ response.addTrailers(headers)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -3">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è¯­">ç»“è¯­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-connection">response.connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-response-connection">ç†è§£ response.connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-12">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-cork">response.cork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-end-data-encoding-callback">response.end([data[, encoding]][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-13">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-finished">response.finished</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-æ£€æŸ¥å“åº”æ˜¯å¦å®Œæˆ">ä¾‹å­ 1ï¼šæ£€æŸ¥å“åº”æ˜¯å¦å®Œæˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-å¼‚æ­¥æ“ä½œæœŸé—´æ£€æŸ¥å“åº”çŠ¶æ€">ä¾‹å­ 2ï¼šå¼‚æ­¥æ“ä½œæœŸé—´æ£€æŸ¥å“åº”çŠ¶æ€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-flushheaders">response.flushHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯response-flushheaders">ä»€ä¹ˆæ˜¯response.flushHeaders()?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨response-flushheaders">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨response.flushHeaders()?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-getheader-name">response.getHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-response-getheader-name">ä»€ä¹ˆæ˜¯ response.getHeader(name)ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-response-getheader-name">å¦‚ä½•ä½¿ç”¨ response.getHeader(name)ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-getheadernames">response.getHeaderNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-http-å¤´éƒ¨">ç†è§£ HTTP å¤´éƒ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨response-getheadernames">ä½¿ç”¨response.getHeaderNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨åœºæ™¯">å®é™…è¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-getheaders">response.getHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-headers">ç†è§£ Headers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-response-getheaders">ä½¿ç”¨ response.getHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨å®ä¾‹-1">å®é™…è¿ç”¨å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-13">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-hasheader-name">response.hasHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-hasheader-name-1">response.hasHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-16">å®é™…è¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-headerssent">response.headersSent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-17">å®é™…è¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-removeheader-name">response.removeHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-response-removeheader-name">ç†è§£ response.removeHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-req">response.req</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-http-æœåŠ¡å™¨">ä¾‹å­ 1ï¼šHTTP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-è®°å½•è¯·æ±‚-å“åº”å‘¨æœŸ">ä¾‹å­ 2ï¼šè®°å½•è¯·æ±‚-å“åº”å‘¨æœŸ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-senddate">response.sendDate</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-date-å“åº”å¤´">ç†è§£ Date å“åº”å¤´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-response-senddate">ä½¿ç”¨ response.sendDate</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-setheader-name-value">response.setHeader(name, value)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-è®¾ç½®å†…å®¹ç±»å‹">ä¾‹å­ 1ï¼šè®¾ç½®å†…å®¹ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-è®¾ç½®-cookie">ä¾‹å­ 2ï¼šè®¾ç½® Cookie</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-3-æ§åˆ¶ç¼“å­˜">ä¾‹å­ 3ï¼šæ§åˆ¶ç¼“å­˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-settimeout-msecs-callback">response.setTimeout(msecs[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-settimeout-msecs-callback-è¯¦è§£">response.setTimeout(msecs[, callback]) è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-18">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-socket">response.socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-socket-1">response.socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-statuscode">response.statusCode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-response-statuscode">è§£é‡Š response.statusCode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-19">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-statusmessage">response.statusMessage</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-statusmessage-1">response.statusMessage</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-14">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-strictcontentlength">response.strictContentLength</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ç”¨é€”">å®é™…ç”¨é€”ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-uncork">response.uncork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-15">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-3">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writableended">response.writableEnded</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-ç®€å•çš„-http-æœåŠ¡å™¨">ç¤ºä¾‹ 1: ç®€å•çš„ HTTP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-æ£€æŸ¥å“åº”æ˜¯å¦å·²ç»“æŸ">ç¤ºä¾‹ 2: æ£€æŸ¥å“åº”æ˜¯å¦å·²ç»“æŸ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writablefinished">response.writableFinished</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-http-å“åº”-http-response">ä»€ä¹ˆæ˜¯ HTTP å“åº”ï¼ˆHTTP Responseï¼‰ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writablefinished-1">response.writableFinished</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-16">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-15">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-write-chunk-encoding-callback">response.write(chunk[, encoding][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-1">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writecontinue">response.writeContinue()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-1-1-100-continue-çŠ¶æ€ç ">HTTP/1.1 100 Continue çŠ¶æ€ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writecontinue-çš„ä½œç”¨">response.writeContinue() çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writeearlyhints-hints-callback">response.writeEarlyHints(hints[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-early-hints-103-çŠ¶æ€ç ">ç†è§£ Early Hints (103 çŠ¶æ€ç )</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writeearlyhints-hints-callback-1">response.writeEarlyHints(hints[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-16">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writehead-statuscode-statusmessage-headers">response.writeHead(statusCode[, statusMessage][, headers])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-1">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹-1">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-4">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-writeprocessing">response.writeProcessing()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-20">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-http-incomingmessage">Class: http.IncomingMessage</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-6">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®ç‰¹æ€§">å…³é”®ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-7">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-aborted">Event: &#39;aborted&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-aborted-1">Event: &#39;aborted&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close-4">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-åˆ›å»º-http-æœåŠ¡å™¨å¹¶ç›‘å¬-close-äº‹ä»¶">å®ä¾‹ï¼šåˆ›å»º HTTP æœåŠ¡å™¨å¹¶ç›‘å¬ &#39;close&#39; äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-ç¨‹åºé€€å‡ºå‰å…³é—­æœåŠ¡å™¨">å®ä¾‹ï¼šç¨‹åºé€€å‡ºå‰å…³é—­æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-aborted">message.aborted</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-17">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-complete">message.complete</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åœ¨åˆ›å»º-http-æœåŠ¡å™¨æ—¶æ£€æŸ¥è¯·æ±‚æ¶ˆæ¯æ˜¯å¦å®Œæ•´">1. åœ¨åˆ›å»º HTTP æœåŠ¡å™¨æ—¶æ£€æŸ¥è¯·æ±‚æ¶ˆæ¯æ˜¯å¦å®Œæ•´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åœ¨ä½¿ç”¨-http-å®¢æˆ·ç«¯æ—¶æ£€æŸ¥å“åº”æ¶ˆæ¯æ˜¯å¦å®Œæ•´">2. åœ¨ä½¿ç”¨ HTTP å®¢æˆ·ç«¯æ—¶æ£€æŸ¥å“åº”æ¶ˆæ¯æ˜¯å¦å®Œæ•´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-connection">message.connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£message-connection">ç†è§£message.connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-21">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-destroy-error">message.destroy([error])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°-5">å‚æ•°ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-8">å®é™…åº”ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-5">å°ç»“:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-headers">message.headers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-headersdistinct">message.headersDistinct</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-httpversion">message.httpVersion</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-6">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-httpversion-1">message.httpVersion</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-5">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-method">message.method</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-åˆ›å»º-http-æœåŠ¡å™¨å¹¶æ£€æŸ¥è¯·æ±‚æ–¹æ³•">ä¾‹å­ 1ï¼šåˆ›å»º HTTP æœåŠ¡å™¨å¹¶æ£€æŸ¥è¯·æ±‚æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-æ ¹æ®è¯·æ±‚æ–¹æ³•å“åº”ä¸åŒå†…å®¹">ä¾‹å­ 2ï¼šæ ¹æ®è¯·æ±‚æ–¹æ³•å“åº”ä¸åŒå†…å®¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-3-restful-api">ä¾‹å­ 3ï¼šRESTful API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-rawheaders">message.rawHeaders</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-rawheadersç®€ä»‹">message.rawHeadersç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-22">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-17">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-rawtrailers">message.rawTrailers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-settimeout-msecs-callback">message.setTimeout(msecs[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-2">å‚æ•°è§£é‡Šï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£å®ƒçš„è¿ä½œæœºåˆ¶">ç†è§£å®ƒçš„è¿ä½œæœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-23">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-socket">message.socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-æŸ¥çœ‹å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯">ä¾‹å­ 1ï¼šæŸ¥çœ‹å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-æ‰‹åŠ¨å¤„ç†-tcp-å¥—æ¥å­—">ä¾‹å­ 2ï¼šæ‰‹åŠ¨å¤„ç† TCP å¥—æ¥å­—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-statuscode">message.statusCode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¯¦ç»†è§£é‡Š">è¯¦ç»†è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-6">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-18">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-statusmessage">message.statusMessage</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å·¥ä½œåŸç†-1">å·¥ä½œåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-7">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-trailers">message.trailers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-trailersdistinct">message.trailersDistinct</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#message-url">message.url</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£message-url">ç†è§£message.url</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-24">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-http-outgoingmessage">Class: http.OutgoingMessage</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-http-outgoingmessage">ç†è§£ http.OutgoingMessage</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨æ¡ˆä¾‹">å®é™…åº”ç”¨æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-19">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-drain">Event: &#39;drain&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#èƒŒæ™¯-1">èƒŒæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-drain-æ˜¯ä»€ä¹ˆ">Event: &#39;drain&#39; æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-15">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-4">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-finish-3">Event: &#39;finish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-finish-4">Event: &#39;finish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®ç‚¹">å…³é”®ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-prefinish">Event: &#39;prefinish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†-1">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-prefinish-1">Event: &#39;prefinish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-addtrailers-headers">outgoingMessage.addTrailers(headers)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-7">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-8">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-appendheader-name-value">outgoingMessage.appendHeader(name, value)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-27">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-connection">outgoingMessage.connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-connection-1">outgoingMessage.connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-cork">outgoingMessage.cork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯-outgoingmessage">1. ä»€ä¹ˆæ˜¯ OutgoingMessageï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-cork-æ–¹æ³•çš„ä½œç”¨">2. cork() æ–¹æ³•çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-18">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-destroy-error">outgoingMessage.destroy([error])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-destroy-error-1">outgoingMessage.destroy([error])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-end-chunk-encoding-callback">outgoingMessage.end(chunk[, encoding][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-3">å‚æ•°è§£é‡Šï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨-3">å®é™…è¿ç”¨ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-20">æ€»ç»“ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-flushheaders">outgoingMessage.flushHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†-2">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-flushheaders-1">outgoingMessage.flushHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-20">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-getheader-name">outgoingMessage.getHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-getheadernames">outgoingMessage.getHeaderNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-21">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-getheaders">outgoingMessage.getHeaders()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-getheaders-æ–¹æ³•">outgoingMessage.getHeaders() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹-1">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-21">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-hasheader-name">outgoingMessage.hasHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-hasheader-name-1">outgoingMessage.hasHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-29">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-headerssent">outgoingMessage.headersSent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-outgoingmessage-headerssent">ä»€ä¹ˆæ˜¯ outgoingMessage.headersSentï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-30">å®é™…è¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-pipe">outgoingMessage.pipe()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-removeheader-name">outgoingMessage.removeHeader(name)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-setheader-name-value">outgoingMessage.setHeader(name, value)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-setheaders-headers">outgoingMessage.setHeaders(headers)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-settimeout-msesc-callback">outgoingMessage.setTimeout(msesc[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-2">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-16">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-5">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-socket">outgoingMessage.socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-uncork">outgoingMessage.uncork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-å’Œ-buffering">Streams å’Œ Buffering</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cork-and-uncork-mechanism">Cork and Uncork Mechanism</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-uncork-1">outgoingMessage.uncork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­">ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writablecorked">outgoingMessage.writableCorked</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writableended">outgoingMessage.writableEnded</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writableended-1">outgoingMessage.writableEnded</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writablefinished">outgoingMessage.writableFinished</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ˜“æ‡‚è§£é‡Š">æ˜“æ‡‚è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-31">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-22">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writablehighwatermark">outgoingMessage.writableHighWaterMark</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ç®€ä»‹-2">Node.js ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-æµ">Streamsï¼ˆæµï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#backpressure-èƒŒå‹">Backpressureï¼ˆèƒŒå‹ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writablehighwatermark-1">outgoingMessage.writableHighWaterMark</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writablelength">outgoingMessage.writableLength</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-outgoingmessage-writablelength">ç†è§£ outgoingMessage.writableLength</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-writableobjectmode">outgoingMessage.writableObjectMode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writableobjectmode-ç®€è¿°">writableObjectMode ç®€è¿°ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº”ç”¨åœºæ™¯ç¤ºä¾‹">åº”ç”¨åœºæ™¯ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outgoingmessage-write-chunk-encoding-callback">outgoingMessage.write(chunk[, encoding][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-outgoingmessage-write-chunk-encoding-callback">ç†è§£ outgoingMessage.write(chunk[, encoding][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-33">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-methods">http.METHODS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-status-codes">http.STATUS_CODES</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨">å®é™…åº”ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-createserver-options-requestlistener">http.createServer([options][, requestListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-get-options-callback">http.get(options[, callback])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€ç†è§£">åŸºç¡€ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è¯¦è§£">å‚æ•°è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä½¿ç”¨ä¾‹å­-1">å®é™…ä½¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-7">å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-get-url-options-callback">http.get(url[, options][, callback])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-get-url-options-callback-1">http.get(url[, options][, callback])</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-globalagent">http.globalAgent</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-23">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-maxheadersize">http.maxHeaderSize</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-http-maxheadersize">ç†è§£ http.maxHeaderSize</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-9">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è¯­-1">ç»“è¯­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-request-options-callback">http.request(options[, callback])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-4">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-17">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-request-url-options-callback">http.request(url[, options][, callback])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯http-request">ä»€ä¹ˆæ˜¯http.request?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°-6">å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ä¾‹å­-1">ä½¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-23">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-validateheadername-name-label">http.validateHeaderName(name[, label])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-validateheadervalue-name-value">http.validateHeaderValue(name, value)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-http-å¤´éƒ¨-headers">ä»€ä¹ˆæ˜¯ HTTP å¤´éƒ¨ï¼ˆHeadersï¼‰ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-http-validateheadervalue-name-value-çš„ç›®çš„">ä½¿ç”¨ http.validateHeaderValue(name, value) çš„ç›®çš„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-18">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#http-setmaxidlehttpparsers-max">http.setMaxIdleHTTPParsers(max)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°-7">å‚æ•°ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹-2">ä½¿ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="http" tabindex="-1"><a class="header-anchor" href="#http"><span><a href="https://nodejs.org/docs/latest/api/http.html#http" target="_blank" rel="noopener noreferrer">HTTP</a></span></a></h1><p>Node.js ä¸­çš„ HTTP æ¨¡å—å…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è¿™æ˜¯ç½‘ç»œåº”ç”¨å¼€å‘çš„åŸºç¡€ï¼Œå› ä¸º HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ Web ä¸Šæ•°æ®äº¤æ¢çš„ä¸»è¦æ–¹å¼ã€‚</p><h3 id="http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#http-æœåŠ¡å™¨"><span>HTTP æœåŠ¡å™¨</span></a></h3><p>åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨éå¸¸ç›´æ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨å¹¶å®šä¹‰è¯·æ±‚å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å°†ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒNode.js ä¼šå¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šç›‘å¬æœ¬åœ°æœºå™¨çš„ 3000 ç«¯å£ã€‚å½“ä½ æ‰“å¼€æµè§ˆå™¨å¹¶è®¿é—®<code>http://localhost:3000/</code>æ—¶ï¼Œä½ å°†çœ‹åˆ°ä¸€ä¸ªæ˜¾ç¤ºâ€œHello, World!â€çš„é¡µé¢ã€‚</p><h3 id="http-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#http-å®¢æˆ·ç«¯"><span>HTTP å®¢æˆ·ç«¯</span></a></h3><p>åŒæ ·åœ°ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ HTTP æ¨¡å—åˆ›å»ºä¸€ä¸ª HTTP å®¢æˆ·ç«¯æ¥å‘é€è¯·æ±‚åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// é…ç½®è¯·æ±‚é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å‡ºç°é”™è¯¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘<code>example.com</code>å‘å‡ºäº†ä¸€ä¸ª GET è¯·æ±‚ï¼Œå¹¶ä¸”æ‰“å°å‡ºäº†å“åº”çŠ¶æ€ç ä»¥åŠå“åº”ä½“å†…å®¹ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><strong>API æœåŠ¡å™¨</strong>: ä½ å¯ä»¥ä½¿ç”¨ HTTP æ¨¡å—åˆ›å»º RESTful APIï¼Œå®ƒå¯ä»¥å“åº”å„ç§ HTTP è¯·æ±‚ï¼Œå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ï¼Œå¹¶è¿”å› JSON æ ¼å¼çš„æ•°æ®ã€‚</li><li><strong>ç½‘ç«™æœåŠ¡</strong>: é™¤äº† API æœåŠ¡å™¨ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥æ‰˜ç®¡é™æ€æ–‡ä»¶ï¼ˆHTMLã€CSSã€JavaScript æ–‡ä»¶ç­‰ï¼‰ï¼Œä»è€Œæä¾›å®Œæ•´çš„ç½‘ç«™è®¿é—®ä½“éªŒã€‚</li><li><strong>ä»£ç†æœåŠ¡å™¨</strong>: é€šè¿‡æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ç„¶åè½¬å‘ç»™å…¶ä»–æœåŠ¡å™¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™å¯¹äºè´Ÿè½½å‡è¡¡æˆ–ç¼“å­˜ç­‰åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</li></ol><p>Node.js çš„ HTTP æ¨¡å—æ˜¯æ„å»ºç½‘ç»œæœåŠ¡çš„åŸºçŸ³ï¼Œå³ä¾¿åœ¨ç°ä»£æ¡†æ¶ï¼ˆå¦‚ Express.jsï¼‰æä¾›æ›´é«˜çº§æŠ½è±¡çš„æƒ…å†µä¸‹ï¼Œè¿™äº›æ¡†æ¶ä»æ—§åœ¨åº•å±‚ä½¿ç”¨ Node.js çš„ HTTP æ¨¡å—ã€‚</p><h2 id="class-http-agent" tabindex="-1"><a class="header-anchor" href="#class-http-agent"><span><a href="https://nodejs.org/docs/latest/api/http.html#class-httpagent" target="_blank" rel="noopener noreferrer">Class: http.Agent</a></span></a></h2><p>Node.js ä¸­çš„ <code>http.Agent</code> æ˜¯ä¸€ä¸ªè´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯è¿æ¥æŒä¹…æ€§å’Œé‡ç”¨çš„ç±»ã€‚å½“ä½ åœ¨ Node.js ä¸­å‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œé€šå¸¸æ˜¯é€šè¿‡è¿™ä¸ª http.Agent æ¥å¤„ç†è¿æ¥é€»è¾‘çš„ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-http-agent" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-http-agent"><span>ä¸ºä»€ä¹ˆéœ€è¦ http.Agentï¼Ÿ</span></a></h3><p>åœ¨ HTTP åè®®ä¸­ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œé€šå¸¸éƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ DNS æŸ¥æ‰¾ã€TCP æ¡æ‰‹ç­‰ï¼Œä¼šæ¶ˆè€—é¢å¤–çš„æ—¶é—´å’Œèµ„æºã€‚å¦‚æœå®¢æˆ·ç«¯éœ€è¦é¢‘ç¹åœ°å‘åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè¿™ç§æ¯æ¬¡éƒ½å»ºç«‹æ–°è¿æ¥çš„æ–¹å¼å°±æ•ˆç‡ä½ä¸‹äº†ã€‚</p><p><code>http.Agent</code> çš„å­˜åœ¨æ­£æ˜¯ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚å®ƒå¯ä»¥ç»´æŠ¤ä¸€ä¸ªæŒä¹…çš„è¿æ¥æ± ï¼Œå¹¶ä¸”åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¤ç”¨è¿™äº›è¿æ¥ã€‚è¿™æ ·ï¼Œåç»­çš„è¯·æ±‚å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç»å»ºç«‹å¥½çš„è¿æ¥ï¼Œä¸éœ€è¦å†é‡æ–°è¿›è¡Œè¿æ¥çš„æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ï¼Œä»è€Œæå‡æ•ˆç‡ã€‚</p><h3 id="http-agent-å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#http-agent-å¦‚ä½•å·¥ä½œ"><span>http.Agent å¦‚ä½•å·¥ä½œï¼Ÿ</span></a></h3><ol><li><p><strong>æŒä¹…è¿æ¥ï¼ˆKeep-Aliveï¼‰</strong>: é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js çš„ http.Agent ä¼šå¯ç”¨ HTTP Keep-Alive åŠŸèƒ½ï¼Œå®ƒå…è®¸åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå‘é€å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡äº¤äº’éƒ½æ‰“å¼€æ–°çš„è¿æ¥ã€‚</p></li><li><p><strong>è¿æ¥æ± ï¼ˆConnection Poolingï¼‰</strong>: http.Agent ä½¿ç”¨ä¸€ä¸ªè¿æ¥æ± æ¥ç®¡ç†è¿æ¥ã€‚è¿™ä¸ªæ± å­é‡Œé¢å­˜ç€ä¸€å®šæ•°é‡çš„æ´»è·ƒè¿æ¥ï¼Œå½“éœ€è¦å‘èµ·æ–°çš„è¯·æ±‚æ—¶ï¼ŒAgent ä¼šæ£€æŸ¥æ± å­é‡Œæ˜¯å¦æœ‰ç©ºé—²çš„è¿æ¥ï¼Œç„¶åå¤ç”¨å®ƒã€‚</p></li><li><p><strong>è¯·æ±‚æ’é˜Ÿ</strong>: å¦‚æœæ‰€æœ‰è¿æ¥éƒ½åœ¨ä½¿ç”¨ä¸­ï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„è¿æ¥ã€‚</p></li></ol><h3 id="å®ä¾‹åŒ–ä¸€ä¸ª-agent" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åŒ–ä¸€ä¸ª-agent"><span>å®ä¾‹åŒ–ä¸€ä¸ª Agent</span></a></h3><p>å½“ä½ ä½¿ç”¨ <code>http.request()</code> æˆ–è€… <code>http.get()</code> å‘é€è¯·æ±‚æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè‡ªå®šä¹‰çš„ Agentï¼Œé‚£ä¹ˆ Node.js å°†ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é»˜è®¤ Agentã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ Agent å®ä¾‹æ¥è‡ªå®šä¹‰è¿™äº›è¡Œä¸ºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Agent</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  maxSockets</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 10</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æœ€å¤§å¹¶å‘ socket æ•°é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨è‡ªå®šä¹‰ Agent å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><p><strong>æœåŠ¡å™¨çŠ¶æ€ç›‘æ§</strong>ï¼šå¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªæœåŠ¡ç›‘æ§ç³»ç»Ÿï¼Œéœ€è¦æ¯éš”å‡ ç§’é’Ÿæ£€æµ‹ä½ çš„æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰ Keep-Alive çš„ Agentï¼Œè¿™æ ·å°±å¯ä»¥é¿å…é¢‘ç¹çš„è¿æ¥å»ºç«‹å’Œæ–­å¼€ã€‚</p></li><li><p><strong>Web çˆ¬è™«</strong>: å¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ª web çˆ¬è™«å»çˆ¬å–ç‰¹å®šç½‘ç«™çš„æ•°æ®ï¼Œä½¿ç”¨ http.Agent å¯ä»¥åœ¨å¯¹åŒä¸€åŸŸåçš„è¯·æ±‚ä¸­å¤ç”¨è¿æ¥ï¼Œè¿™å°†æ˜¾è‘—æé«˜çˆ¬å–æ•ˆç‡ã€‚</p></li><li><p><strong>API æ¶ˆè´¹è€…</strong>: å½“ä½ çš„åº”ç”¨ç¨‹åºéœ€è¦é¢‘ç¹è°ƒç”¨å¤–éƒ¨ API è·å–æ•°æ®æ—¶ï¼Œä½¿ç”¨ http.Agent ä¹Ÿèƒ½å‡å°‘è¿æ¥çš„å¼€é”€ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç¤¾äº¤åª’ä½“åº”ç”¨ä¸­è·å–ç”¨æˆ·çš„æœ€æ–°æ¨æ–‡ã€‚</p></li></ol><p>æ€»ç»“æ¥è¯´ï¼Œ<code>http.Agent</code> åœ¨ Node.js ä¸­æ‰®æ¼”ç€ç½‘ç»œè¿æ¥ä¼˜åŒ–å™¨çš„è§’è‰²ã€‚é€šè¿‡ç®¡ç†è¿æ¥çš„æŒä¹…åŒ–å’Œé‡ç”¨ï¼Œå®ƒèƒ½å¤Ÿå¢å¼º HTTP è¯·æ±‚çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦é¢‘ç¹è¿›è¡Œç½‘ç»œè¯·æ±‚çš„åœºæ™¯ä¸‹ã€‚</p><h3 id="new-agent-options" tabindex="-1"><a class="header-anchor" href="#new-agent-options"><span><a href="https://nodejs.org/docs/latest/api/http.html#new-agentoptions" target="_blank" rel="noopener noreferrer">new Agent([options])</a></span></a></h3><p>åœ¨è§£é‡Š<code>new Agent([options])</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ HTTP å®¢æˆ·ç«¯å¦‚ä½•å·¥ä½œã€‚</p><p>å½“ä½ åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œä½ çš„æµè§ˆå™¨ä¼šåˆ›å»ºä¸€ä¸ªåˆ°æœåŠ¡å™¨çš„è¿æ¥ï¼Œè¯·æ±‚ç½‘é¡µå†…å®¹ï¼Œç„¶åæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ HTTP æ¨¡å—æ¥ä»¥ç¼–ç¨‹æ–¹å¼æ‰§è¡Œç›¸ä¼¼çš„æ“ä½œï¼Œæ¯”å¦‚è·å–ç½‘ç»œèµ„æºæˆ–è€…ä¸è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚</p><p><code>new Agent([options])</code>æ˜¯ Node.js <code>http</code> æ¨¡å—ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚ä¸€ä¸ª&quot;Agent&quot;è´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯çš„æŒä¹…æ€§å’Œå¤ç”¨ï¼Œå®ƒèƒ½å¤Ÿä¸ºå¤šä¸ªè¯·æ±‚ç»´æŠ¤ç€ä¸€ä¸ªæŒä¹…åŒ–çš„è¿æ¥æ± ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å‘èµ·å¤šä¸ª HTTP è¯·æ±‚ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡è¯·æ±‚éƒ½å»ºç«‹æ–°çš„è¿æ¥ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨<code>new Agent([options])</code>ï¼š</p><h3 id="å®ä¾‹-1-åˆ›å»ºé»˜è®¤çš„-http-agent" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-åˆ›å»ºé»˜è®¤çš„-http-agent"><span>å®ä¾‹ 1ï¼šåˆ›å»ºé»˜è®¤çš„ HTTP Agent</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„HTTP Agentï¼Œæ— ç‰¹æ®Šé…ç½®</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨è¿™ä¸ªagentå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åä½ å°±å¯ä»¥ï¼ˆä¸é”™è¿™æœ¬ä»½æ–‡æ¡£çš„ä½œè€…æ˜¯ï¼šCherryChat doc.cherrychat.orgï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¼ é€’ä»»ä½•ç‰¹å®šçš„é€‰é¡¹ç»™<code>new Agent()</code>ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚æˆ‘ä»¬éšåä½¿ç”¨è¿™ä¸ª agent æ¥å‘èµ·ä¸€ä¸ª GET è¯·æ±‚ã€‚</p><h3 id="å®ä¾‹-2-åˆ›å»ºå¸¦æœ‰é…ç½®çš„-http-agent" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-åˆ›å»ºå¸¦æœ‰é…ç½®çš„-http-agent"><span>å®ä¾‹ 2ï¼šåˆ›å»ºå¸¦æœ‰é…ç½®çš„ HTTP Agent</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå¸¦æœ‰é…ç½®çš„HTTP Agent</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¼€å¯é•¿è¿æ¥åŠŸèƒ½</span></span>
<span class="line"><span style="color:#88C0D0;">  keepAliveMsecs</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 10000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å½“keepAliveå¼€å¯æ—¶ï¼ŒæŒ‡å®šTCP Keep-Aliveæ•°æ®åŒ…çš„é—´éš”ï¼Œé»˜è®¤æ˜¯1000ms</span></span>
<span class="line"><span style="color:#88C0D0;">  maxSockets</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 50</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å…è®¸çš„æœ€å¤§socketæ•°é‡ï¼Œé»˜è®¤æ˜¯Infinity</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨è¿™ä¸ªagentå‘èµ·ä¸€ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç»™<code>new Agent()</code>ä¼ å…¥äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›å…·ä½“çš„é…ç½®é€‰é¡¹ã€‚è¿™æ ·çš„è¯ï¼Œè¿™ä¸ª agent å°±ä¼šæ ¹æ®æˆ‘ä»¬æä¾›çš„å‚æ•°æ¥ç®¡ç†è¿æ¥ã€‚</p><h3 id="å®ä¾‹-3-å…³é—­-agent-çš„è¿æ¥æ± " tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-3-å…³é—­-agent-çš„è¿æ¥æ± "><span>å®ä¾‹ 3ï¼šå…³é—­ Agent çš„è¿æ¥æ± </span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªAgentï¼Œå¹¶ä¸”å…³é—­è¿æ¥æ± åŠŸèƒ½</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨æ¯ä¸ªè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¹¶åœ¨å®Œæˆåå…³é—­å®ƒ</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†<code>keepAlive</code>é€‰é¡¹è®¾ç½®ä¸º<code>false</code>ï¼Œå‘Šè¯‰ agent ä¸è¦ä¿æŒè¿æ¥ã€‚æ‰€ä»¥ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å°†æ‰“å¼€ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œç„¶ååœ¨è¯·æ±‚ç»“æŸåå…³é—­å®ƒã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>new Agent([options])</code>å…è®¸ä½ å®šåˆ¶å¹¶ä¼˜åŒ– HTTP è¯·æ±‚çš„è¿æ¥è¡Œä¸ºã€‚é€šè¿‡åˆç†åœ°ä½¿ç”¨ Agentï¼Œå¯ä»¥ä½¿åº”ç”¨ç¨‹åºæ›´åŠ é«˜æ•ˆåœ°ä¸ HTTP æœåŠ¡å™¨é€šä¿¡ã€‚</p><h3 id="agent-createconnection-options-callback" tabindex="-1"><a class="header-anchor" href="#agent-createconnection-options-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentcreateconnectionoptions-callback" target="_blank" rel="noopener noreferrer">agent.createConnection(options[, callback])</a></span></a></h3><p><code>agent.createConnection(options[, callback])</code> æ˜¯ Node.js ä¸­ <code>http.Agent</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ HTTP æˆ– HTTPS è¿æ¥ã€‚åœ¨ Node.js çš„ http æ¨¡å—ä¸­ï¼Œ<code>http.Agent</code> è´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§å’Œé‡ç”¨ï¼Œä»¥åŠå¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿã€‚</p><p>ä¸‹é¢æˆ‘ä¼šå…ˆè§£é‡Šä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œç„¶åä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><strong>HTTP Agent</strong>: åœ¨ Node.js ä¸­ï¼ŒHTTP Agent è´Ÿè´£ä¸º HTTP å®¢æˆ·ç«¯è¯·æ±‚åˆ›å»ºå’Œç®¡ç†è¿æ¥æ± ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½ å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼ŒNode.js ä¼šä½¿ç”¨å…¨å±€çš„ HTTP Agent æ¥å¤„ç†è¿™äº›è¯·æ±‚ã€‚</li><li><strong>è¿æ¥æŒä¹…æ€§</strong>: æ„å‘³ç€åœ¨ä¸€ä¸ª HTTP è¯·æ±‚å®Œæˆåï¼Œè¿æ¥ä»ç„¶ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¯ä»¥è¢«åç»­çš„è¯·æ±‚å¤ç”¨ã€‚è¿™å‡å°‘äº†å»ºç«‹æ–°è¿æ¥æ‰€éœ€çš„æ—¶é—´å’Œèµ„æºï¼Œå› æ­¤å¯ä»¥æå‡æ€§èƒ½ã€‚</li><li><strong>è¿æ¥é‡ç”¨</strong>: å½“æœ‰å¤šä¸ªè¯·æ±‚è¦å‘é€åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œå¦‚æœè¿æ¥ä¿æŒæŒä¹…æ€§ï¼Œé‚£ä¹ˆ Agent ä¼šå°è¯•å¤ç”¨å·²ç»å»ºç«‹çš„è¿æ¥ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-ä½¿ç”¨-agent-createconnection" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ä½¿ç”¨-agent-createconnection"><span>ä¾‹å­ 1ï¼šä½¿ç”¨ <code>agent.createConnection</code></span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦å¯¹æŸä¸ªè¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œå¤šä¸ª HTTP è¯·æ±‚ã€‚ä½ æƒ³è¦è‡ªå®šä¹‰è¿æ¥çš„åˆ›å»ºæ–¹å¼ï¼Œæ¯”å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›é…ç½®ç‰¹å®šçš„ TCP å¥—æ¥å­—é€‰é¡¹ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ UNIX åŸŸå¥—æ¥å­—æ¥å»ºç«‹è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®ä¾‹åŒ–ä¸€ä¸ªè‡ªå®šä¹‰çš„ http.Agent å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> customAgent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // è¦†ç›– createConnection æ–¹æ³•æ¥è‡ªå®šä¹‰è¿æ¥çš„åˆ›å»º</span></span>
<span class="line"><span style="color:#88C0D0;">  createConnection</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ­£åœ¨åˆ›å»ºè¿æ¥...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // ä½¿ç”¨ net æ¨¡å—åˆ›å»ºä¸€ä¸ª TCP æˆ– IPC è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span></span>
<span class="line"><span style="color:#616E88;">        // è¿™é‡Œå¯ä»¥æŒ‡å®šè¦è¿æ¥çš„ç«¯å£å’Œä¸»æœº</span></span>
<span class="line"><span style="color:#88C0D0;">        port</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> options</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">        host</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> options</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">host</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#ECEFF4;">      ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å·²åˆ›å»º</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">        // è¿æ¥åˆ›å»ºæˆåŠŸåï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°å¹¶å°† socket ä¼ é€’ç»™å®ƒ</span></span>
<span class="line"><span style="color:#88C0D0;">        callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // ç›‘å¬é”™è¯¯äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å‘ç”Ÿé”™è¯¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">      callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨è‡ªå®šä¹‰ agent å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> customAgent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿™é‡ŒæŒ‡å®šæˆ‘ä»¬è‡ªå®šä¹‰çš„ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°å“åº”çŠ¶æ€ç :</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚ï¼Œå¦‚æœä¸ç»“æŸè¯·æ±‚ï¼Œè¯·æ±‚ä¸ä¼šçœŸæ­£å‘å‡º</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>http</code> å’Œ <code>net</code> æ¨¡å—ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>http.Agent</code> å®ä¾‹ï¼Œå¹¶è¦†ç›–äº†å®ƒçš„ <code>createConnection</code> æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>net.createConnection</code> æ¥å»ºç«‹çœŸæ­£çš„ç½‘ç»œè¿æ¥ï¼Œå¹¶åœ¨è¿æ¥æˆåŠŸæ—¶è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå¹¶æŒ‡å®šä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ <code>http.Agent</code>ã€‚å½“æœåŠ¡å™¨å“åº”æ—¶ï¼Œæˆ‘ä»¬æ‰“å°å“åº”çŠ¶æ€ç å¹¶ç›‘å¬æ•°æ®äº‹ä»¶æ¥å¤„ç†å“åº”æ­£æ–‡ã€‚</p><h3 id="ä¾‹å­-2-ä½¿ç”¨-unix-åŸŸå¥—æ¥å­—" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨-unix-åŸŸå¥—æ¥å­—"><span>ä¾‹å­ 2ï¼šä½¿ç”¨ UNIX åŸŸå¥—æ¥å­—</span></a></h3><p>å¦‚æœä½ æƒ³é€šè¿‡ UNIX åŸŸå¥—æ¥å­—ä¸æœ¬åœ°æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ...ï¼ˆå‰é¢ä»£ç è·Ÿä¹‹å‰ä¾‹å­ç›¸åŒï¼‰</span></span>
<span class="line"><span style="color:#616E88;">// å®ä¾‹åŒ–ä¸€ä¸ªè‡ªå®šä¹‰çš„ http.Agent å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> customAgent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // è¦†ç›– createConnection æ–¹æ³•æ¥è‡ªå®šä¹‰è¿æ¥çš„åˆ›å»º</span></span>
<span class="line"><span style="color:#88C0D0;">  createConnection</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ä½¿ç”¨ UNIX åŸŸå¥—æ¥å­—è·¯å¾„æ¥åˆ›å»ºè¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span></span>
<span class="line"><span style="color:#88C0D0;">        path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/tmp/unix.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#ECEFF4;">      ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">        callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // ...å¤„ç†é”™è¯¯äº‹ä»¶ç­‰</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// ...ï¼ˆåç»­ä»£ç è·Ÿä¹‹å‰ä¾‹å­ç›¸åŒï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹ <code>net.createConnection</code> ä¸­çš„ <code>path</code> é€‰é¡¹æ¥æŒ‡å®š UNIX åŸŸå¥—æ¥å­—çš„è·¯å¾„ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>agent.createConnection</code> æ–¹æ³•å…è®¸ä½ æ›´ç²¾ç»†åœ°æ§åˆ¶ HTTP è¿æ¥çš„åˆ›å»ºè¿‡ç¨‹ï¼Œåœ¨éœ€è¦ç‰¹æ®Šè¿æ¥è¡Œä¸ºæ—¶éå¸¸æœ‰ç”¨ã€‚é€šè¿‡æä¾›è‡ªå·±çš„ <code>createConnection</code> å‡½æ•°ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªèº«åº”ç”¨çš„éœ€æ±‚è‡ªå®šä¹‰è¿æ¥é€»è¾‘ã€‚</p><h3 id="agent-keepsocketalive-socket" tabindex="-1"><a class="header-anchor" href="#agent-keepsocketalive-socket"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentkeepsocketalivesocket" target="_blank" rel="noopener noreferrer">agent.keepSocketAlive(socket)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼¹æ€§å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒã€‚å®ƒä½¿å¾— JavaScript å¯ä»¥åœ¨æµè§ˆå™¨å¤–æ‰§è¡Œï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚Node.js æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œè€Œ <code>http</code> æ¨¡å—æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿå¤„ç† http è¯·æ±‚å’Œå“åº”ã€‚</p><p>åœ¨ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>Agent</code> å¯¹è±¡æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§å’Œé‡ç”¨ï¼Œå‡å°‘äº†å»ºç«‹å’Œæ‹†é™¤è¿æ¥çš„å¼€é”€ã€‚è¿™å¯¹äºæå‡æ€§èƒ½å°¤ä¸ºå…³é”®ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é¢‘ç¹è¿›è¡Œ HTTP è¯·æ±‚çš„åº”ç”¨ç¨‹åºä¸­ã€‚</p><h3 id="agent-keepsocketalive-socket-1" tabindex="-1"><a class="header-anchor" href="#agent-keepsocketalive-socket-1"><span>agent.keepSocketAlive(socket)</span></a></h3><p><code>agent.keepSocketAlive(socket)</code> æ–¹æ³•æ˜¯ <code>http.Agent</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚å®ƒçš„ä½œç”¨æ˜¯å†³å®šæ˜¯å¦ä¿æŒ socket è¿æ¥æ´»è·ƒã€‚å½“ä½ å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼ŒNode.js ä¼šåˆ›å»ºä¸€ä¸ª socketï¼ˆç½‘ç»œå¥—æ¥å­—ï¼‰æ¥ä¸æœåŠ¡å™¨é€šä¿¡ã€‚å®Œæˆè¯·æ±‚åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ª socket ä¼šè¢«å…³é—­ã€‚ä½†å¦‚æœä½ æƒ³è¦é‡ç”¨è¿™ä¸ª socket å‘é€å…¶ä»–è¯·æ±‚ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦ä¿æŒå®ƒçš„æ´»è·ƒçŠ¶æ€ã€‚è¿™æ­£æ˜¯ <code>agent.keepSocketAlive(socket)</code> æ–¹æ³•çš„ç”¨é€”ã€‚</p><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°</span></a></h4><ul><li><code>socket</code>: è¦æ£€æŸ¥å¹¶å¯èƒ½ä¿æŒæ´»è·ƒçš„ socket å¯¹è±¡ã€‚</li></ul><h4 id="è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼"><span>è¿”å›å€¼</span></a></h4><ul><li>è¿”å› <code>true</code> æˆ– <code>false</code>ï¼Œè¡¨ç¤ºæ˜¯å¦åº”è¯¥ä¿æŒ socket æ´»è·ƒã€‚</li></ul><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><h5 id="_1-åˆ›å»º-http-è¯·æ±‚-å¤ç”¨è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»º-http-è¯·æ±‚-å¤ç”¨è¿æ¥"><span>1. åˆ›å»º HTTP è¯·æ±‚ï¼Œå¤ç”¨è¿æ¥</span></a></h5><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦é¢‘ç¹åœ°å‘åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹è¿æ¥ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>http.Agent</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ agentï¼Œè®¾ç½® keepAlive ä¸º true</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// é€šè¿‡é…ç½® agent ä½¿ç”¨ keepAliveï¼Œæˆ‘ä»¬å‘Šè¯‰ Node.js æˆ‘ä»¬å¸Œæœ›ä¿æŒ socket è¿æ¥æ´»è·ƒ</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€ HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Response Body:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>http.Agent</code> å¹¶è®¾ç½® <code>keepAlive</code> é€‰é¡¹ä¸º <code>true</code>ã€‚è¿™æŒ‡ç¤º Node.js ä¿æŒåº•å±‚ TCP è¿æ¥æ´»è·ƒï¼Œä»¥ä¾¿åç»­çš„è¯·æ±‚å¯ä»¥å¤ç”¨å®ƒã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬è¿ç»­å‘å‡ºå¤šä¸ªè¯·æ±‚åˆ°åŒä¸€æœåŠ¡å™¨æ—¶ï¼Œå°±å¯ä»¥èŠ‚çº¦æ—¶é—´ï¼Œå› ä¸ºä¸éœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚é‡æ–°å»ºç«‹ TCP è¿æ¥ã€‚</p><p>æ³¨æ„ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¸éœ€è¦ç›´æ¥è°ƒç”¨ <code>agent.keepSocketAlive(socket)</code> æ–¹æ³•ï¼Œå› ä¸ºè®¾ç½® <code>keepAlive</code> é€‰é¡¹å·²ç»è¶³å¤Ÿè®© <code>Agent</code> æ™ºèƒ½åœ°ç®¡ç†è¿æ¥ã€‚ç„¶è€Œï¼Œç†è§£è¿™ä¸ªæ–¹æ³•åŠå…¶èƒŒåçš„æœºåˆ¶å¯¹äºæ·±å…¥ç†è§£ Node.js ä¸­ HTTP è¿æ¥çš„ç®¡ç†æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p><h3 id="agent-reusesocket-socket-request" tabindex="-1"><a class="header-anchor" href="#agent-reusesocket-socket-request"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentreusesocketsocket-request" target="_blank" rel="noopener noreferrer">agent.reuseSocket(socket, request)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥äº†è§£ <code>agent.reuseSocket(socket, request)</code> è¿™ä¸ªæ–¹æ³•åœ¨ Node.js ä¸­çš„ä½œç”¨ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒï¼Œé€šå¸¸ç”¨æ¥åˆ›å»ºé«˜æ€§èƒ½çš„æœåŠ¡å™¨ç«¯åº”ç”¨ã€‚è€Œ <code>http.Agent</code> ç±»æ˜¯ Node.js ä¸­å†…ç½®çš„ <code>http</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§å’Œé‡ç”¨ï¼Œä»¥æå‡ç½‘ç»œè¯·æ±‚çš„æ•ˆç‡ã€‚</p><h3 id="agent-reusesocket-socket-request-1" tabindex="-1"><a class="header-anchor" href="#agent-reusesocket-socket-request-1"><span>agent.reuseSocket(socket, request)</span></a></h3><p>åœ¨ç†è§£ <code>agent.reuseSocket(socket, request)</code> æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><p><strong>Socket</strong>: åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œsocket æ˜¯ä¸¤ä¸ªç¨‹åºé—´è¿›è¡Œæ•°æ®äº¤æ¢çš„ç«¯ç‚¹ã€‚åœ¨ HTTP é€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ¯ä¸ª TCP è¿æ¥éƒ½å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ª socketã€‚</p></li><li><p><strong>HTTP Agent</strong>: å½“ä½ å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼ŒNode.js ä¼šä½¿ç”¨ HTTP Agent æ¥å¤„ç†ä¸æœåŠ¡å™¨çš„è¿æ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ª agent ä¼šä¸ºç›¸åŒçš„æœåŠ¡å™¨é‡ç”¨ socketï¼Œä»¥é¿å…ä¸å¿…è¦çš„è¿æ¥å»ºç«‹å’Œæ‹†é™¤å¼€é”€ã€‚</p></li><li><p><strong>Connection Keep-Alive</strong>: åœ¨ HTTP/1.1 ä¸­ï¼Œé»˜è®¤å¯ç”¨äº† Keep-Aliveï¼Œè¿™æ„å‘³ç€ TCP è¿æ¥åœ¨å‘é€è¯·æ±‚åå¯ä»¥ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä¾›åç»­è¯·æ±‚é‡ç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹æ–°çš„è¿æ¥ã€‚</p></li></ol><p>ç°åœ¨ï¼Œå½“ä½ ä½¿ç”¨ HTTP Agent å‘èµ·è¯·æ±‚ï¼Œå¹¶ä¸”æœåŠ¡å™¨å“åº”å¤´åŒ…å« <code>Connection: keep-alive</code> æ—¶ï¼ŒTCP è¿æ¥å°†ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚ä½†æœ‰äº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚å½“å“åº”æ•°æ®ä¸‹è½½å®Œæˆåï¼Œä½ å¯èƒ½å¸Œæœ›ç«‹å³é‡ç”¨è¿™ä¸ª socket è¿›è¡Œå¦ä¸€ä¸ªè¯·æ±‚ï¼Œè€Œä¸æ˜¯ç­‰å¾…æœåŠ¡å™¨å…³é—­å®ƒã€‚è¿™å°±æ˜¯ <code>agent.reuseSocket(socket, request)</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>è¯¥æ–¹æ³•å…è®¸å¼€å‘è€…å‘Šè¯‰ HTTP Agentï¼Œä¸€æ—¦æ•°æ®ä¼ è¾“å®Œæˆï¼Œç«‹å³å°†è¿™ä¸ª socketï¼ˆå³ TCP è¿æ¥ï¼‰æ ‡è®°ä¸ºå¯é‡ç”¨ï¼Œä»è€Œç”¨äºæœªæ¥çš„å…¶ä»–è¯·æ±‚ã€‚è¿™æ ·åšå¯ä»¥èŠ‚çœæ—¶é—´ï¼Œå› ä¸ºå®ƒå‡å°‘äº†é‡æ–°å»ºç«‹ TCP è¿æ¥çš„æ¬¡æ•°ã€‚</p><h4 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h4><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ–¹æ³•çš„å®é™…ç”¨é€”ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keepAliveAgent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ç”¨æ¥å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> handleResponse</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ... å¤„ç† HTTP å“åº” ...</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬è¯»å–å®Œæ‰€æœ‰å“åº”æ•°æ®å¹¶å‡†å¤‡å‘é€å¦ä¸€ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  keepAliveAgent</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">reuseSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> newRequest</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæ–°çš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> newRequest</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> keepAliveAgent</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#D8DEE9;">  handleResponse</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">newRequest</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¿æŒæ´»è·ƒçš„ HTTP Agent (<code>keepAliveAgent</code>)ï¼Œå¹¶å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ã€‚åœ¨æˆ‘ä»¬çš„ <code>handleResponse</code> å‡½æ•°ä¸­ï¼Œåœ¨å¤„ç†å®Œå“åº”åï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>keepAliveAgent.reuseSocket()</code>ï¼Œå°†å“åº”çš„ socket æ ‡è®°ä¸ºå¯é‡ç”¨ã€‚ç„¶åæ­¤ socket å¯ä»¥ç”¨äº <code>newRequest</code> æˆ–å…¶ä»–è¯·æ±‚ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>agent.reuseSocket(socket, request)</code> æä¾›äº†ä¸€ä¸ªä¼˜åŒ–ç½‘ç»œè¿æ¥çš„æ–¹å¼ã€‚å½“åœ¨é«˜è´Ÿè½½ç¯å¢ƒä¸­ï¼Œæˆ–è€…éœ€è¦å¿«é€Ÿè¿ç»­å‘èµ·å¤šä¸ªè¯·æ±‚åˆ°åŒä¸€æœåŠ¡å™¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æ˜æ˜¾å‡å°‘å»¶è¿Ÿå’Œèµ„æºæ¶ˆè€—ã€‚</p><h3 id="agent-destroy" tabindex="-1"><a class="header-anchor" href="#agent-destroy"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentdestroy" target="_blank" rel="noopener noreferrer">agent.destroy()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>agent.destroy()</code> æ–¹æ³•æ˜¯å±äº http.Agent ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¦ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå¾—äº†è§£ä¸€ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚</li><li><strong>HTTP</strong>: è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰æ˜¯ç”¨äºä¼ è¾“ç½‘é¡µï¼ˆHTML æ–‡ä»¶ï¼Œå›¾ç‰‡ç­‰ï¼‰çš„åè®®ã€‚</li><li><strong>http.Agent</strong>: åœ¨ Node.js ä¸­ç”¨æ¥ç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§å’Œé‡ç”¨ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒå¸®åŠ©ç®¡ç†ä¸æœåŠ¡å™¨çš„è¿æ¥ã€‚</li></ol><h3 id="äº†è§£-http-agent" tabindex="-1"><a class="header-anchor" href="#äº†è§£-http-agent"><span>äº†è§£ http.Agent</span></a></h3><p>å½“ä½ å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼ˆæ¯”å¦‚è®¿é—®ä¸€ä¸ªç½‘é¡µï¼‰ï¼ŒèƒŒåçš„å®é™…æ“ä½œåŒ…æ‹¬å»ºç«‹ä¸æœåŠ¡å™¨çš„è¿æ¥ã€å‘é€è¯·æ±‚ã€æ¥æ”¶å“åº”æ•°æ®ã€æœ€åå…³é—­è¿æ¥ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¸å¿…æ¯æ¬¡è¯·æ±‚éƒ½ç»å†è¿™äº›æ­¥éª¤ï¼Œ<code>http.Agent</code> çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº† â€”â€” å®ƒå¯ä»¥ç»´æŒè¿æ¥æ´»è·ƒï¼Œä»¥ä¾¿é‡ç”¨ï¼Œä»è€Œå‡å°‘äº†å¼€é”€ã€‚</p><h3 id="agent-destroy-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#agent-destroy-æ–¹æ³•"><span>agent.destroy() æ–¹æ³•</span></a></h3><p><code>agent.destroy()</code> æ–¹æ³•çš„ä½œç”¨æ˜¯ç«‹å³é”€æ¯æ‰€æœ‰ä¸è¯¥ä»£ç†ç›¸å…³è”çš„ socketï¼ˆç½‘ç»œè¿æ¥ï¼‰ï¼Œå¹¶ä¸”ç¡®ä¿è¿™äº› socket ä¸ä¼šè¢«ç”¨äºæœªæ¥çš„è¯·æ±‚ã€‚è¿™ä¸ªæ–¹æ³•åœ¨ä½ æƒ³è¦ç¡®ä¿ç¨‹åºæ­£ç¡®é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œæˆ–è€…å½“ä½ çŸ¥é“ä¸å†éœ€è¦å‘èµ·é¢å¤–çš„è¯·æ±‚ä¸”å¸Œæœ›å…³é—­æ‰€æœ‰ç°å­˜è¿æ¥æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ åœ¨åˆ›å»ºä¸€ä¸ª Web åº”ç”¨ï¼Œè¯¥åº”ç”¨å®šæœŸä»å¤šä¸ª API è·å–ä¿¡æ¯ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨<code>http.Agent</code>æ¥ç®¡ç†è¿™äº›è¿æ¥ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æœåŠ¡å™¨æ­£åœ¨å…³é—­æˆ–ä½ æƒ³è¦æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚åœæ­¢è¿›ä¸€æ­¥çš„ API è°ƒç”¨ï¼Œä½ å°±éœ€è¦ç¡®ä¿æ‰€æœ‰æ´»åŠ¨çš„è¿æ¥éƒ½è¢«æ­£ç¡®å…³é—­ï¼Œä»¥é‡Šæ”¾èµ„æºå¹¶é¿å…æ½œåœ¨çš„å†…å­˜æ³„éœ²ã€‚è¿™æ—¶å€™ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>agent.destroy()</code>æ–¹æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ agent</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å“åº”å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾æ­¤æ—¶å†³å®šä¸å†éœ€è¦æ›´å¤šè¯·æ±‚ï¼Œå¯ä»¥é”€æ¯ agent</span></span>
<span class="line"><span style="color:#D8DEE9;">    agent</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>http</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>http.Agent</code> å®ä¾‹ã€‚ç„¶åå‘èµ·ä¸€ä¸ª GET è¯·æ±‚åˆ° <code>example.com</code>ï¼Œåœ¨è¯·æ±‚å®Œæˆå¹¶å¤„ç†å“åº”åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>agent.destroy()</code> æ–¹æ³•æ¥å…³é—­æ‰€æœ‰ç”± agent ç®¡ç†çš„è¿æ¥ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>agent.destroy()</code> æ˜¯ä¸€ä¸ªå¼ºåŠ›çš„æ–¹æ³•ï¼Œç”¨äºç¡®ä¿æ‰€æœ‰é€šè¿‡ç‰¹å®š <code>http.Agent</code> å®ä¾‹å‘èµ·çš„è¿æ¥éƒ½è¢«åŠæ—¶ã€æ­£ç¡®åœ°å…³é—­ã€‚åœ¨éœ€è¦æ§åˆ¶èµ„æºä½¿ç”¨æˆ–ä¼˜åŒ–åº”ç”¨æ€§èƒ½çš„åœºæ™¯ä¸‹ä½¿ç”¨æ­¤æ–¹æ³•éå¸¸åˆé€‚ã€‚</p><h3 id="agent-freesockets" tabindex="-1"><a class="header-anchor" href="#agent-freesockets"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentfreesockets" target="_blank" rel="noopener noreferrer">agent.freeSockets</a></span></a></h3><p><code>agent.freeSockets</code> æ˜¯ Node.js <code>http</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº <code>http.Agent</code> çš„å®ä¾‹ã€‚è¿™ä¸ªå±æ€§åŒ…å«äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºæ‰€æœ‰æœªè¢«å½“å‰ä½¿ç”¨ä¸”è¿˜ä¿æŒè¿æ¥çš„ socketsï¼ˆæ’åº§ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œ<code>freeSockets</code> å±æ€§å­˜å‚¨äº†é‚£äº›å·²ç»å®Œæˆäº† HTTP è¯·æ±‚ï¼Œä½†æ˜¯è¿æ¥æ²¡æœ‰å…³é—­ï¼Œä»¥ä¾¿å¯ä»¥è¢«åç»­çš„è¯·æ±‚é‡ç”¨çš„ socketsã€‚</p><p>åœ¨ HTTP åè®®ä¸­ï¼Œå»ºç«‹ä¸€ä¸ª TCP è¿æ¥éœ€è¦æ—¶é—´å’Œèµ„æºã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œç°ä»£çš„ HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ”¯æŒç§°ä½œâ€œkeep-aliveâ€çš„ç‰¹æ€§ï¼Œå³åœ¨å®Œæˆä¸€ä¸ªè¯·æ±‚ä¹‹åï¼ŒTCP è¿æ¥ä¸ä¼šç«‹å³å…³é—­ï¼Œè€Œæ˜¯å¯ä»¥è¢«ç”¨æ¥æ‰§è¡Œæ›´å¤šçš„è¯·æ±‚ã€‚</p><p>Node.js ä¸­çš„ <code>http.Agent</code> è´Ÿè´£ç®¡ç†è¿™ç§è¿æ¥çš„æŒä¹…åŒ–ï¼Œå®ƒé»˜è®¤æƒ…å†µä¸‹ä¼šå¯ç”¨ keep-alive ç‰¹æ€§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>freeSockets</code> ä¼šå­˜åœ¨ï¼Œå› ä¸ºå½“ä¸€ä¸ª socket å¤„äºç©ºé—²çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯ä¿æŒäº†è¿æ¥ä½†ç›®å‰æ²¡æœ‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚ï¼‰æ—¶ï¼Œå®ƒä¼šè¢«æ”¾å…¥ <code>freeSockets</code> å¯¹è±¡ä¸­ã€‚</p><p>è¿™é‡Œæœ‰å‡ ä¸ªå…³äº <code>freeSockets</code> å±æ€§å¦‚ä½•å·¥ä½œçš„å®é™…ä¾‹å­ï¼š</p><h3 id="ç¤ºä¾‹-1-æŸ¥çœ‹ç©ºé—²çš„-sockets" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æŸ¥çœ‹ç©ºé—²çš„-sockets"><span>ç¤ºä¾‹ 1ï¼šæŸ¥çœ‹ç©ºé—²çš„ sockets</span></a></h3><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ª HTTP ä»£ç†æœåŠ¡ï¼Œè¯¥æœåŠ¡ä¼šé¢‘ç¹åœ°å‘ç›¸åŒçš„å‡ ä¸ªæœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ£€æŸ¥å½“å‰æœ‰å“ªäº›ç©ºé—²çš„ socketsï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ agent</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·ä¸€ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰çš„ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // å½“è¯·æ±‚ç»“æŸæ—¶ï¼Œsocket å¯èƒ½ä¼šå˜æˆç©ºé—²çŠ¶æ€</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">agent</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">freeSockets</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºç©ºé—²çš„ sockets ä¿¡æ¯</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-2-é‡ç”¨-sockets" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-é‡ç”¨-sockets"><span>ç¤ºä¾‹ 2ï¼šé‡ç”¨ sockets</span></a></h3><p>å½“ä½ è¦å‘èµ·å¯¹åŒä¸€æœåŠ¡å™¨çš„å¤šä¸ªè¯·æ±‚æ—¶ï¼Œ<code>freeSockets</code> ä¸­çš„ sockets å¯ä»¥è¢«è‡ªåŠ¨é‡ç”¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ¯æ¬¡è¯·æ±‚çš„å»¶è¿Ÿï¼Œå› ä¸ºä¸éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> makeRequest</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#ECEFF4;">    (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·ä¸¤ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="color:#88C0D0;">makeRequest</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">makeRequest</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¬¬äºŒä¸ªè¯·æ±‚å¯èƒ½ä¼šé‡ç”¨ç¬¬ä¸€ä¸ªè¯·æ±‚åç©ºé—²çš„ socket</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è°ƒç”¨ <code>makeRequest()</code> å‡½æ•°ä¸¤æ¬¡æ—¶ï¼Œç¬¬äºŒä¸ªè¯·æ±‚å¯èƒ½ä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªè¯·æ±‚å®Œæˆåå¹¶å˜ä¸ºç©ºé—²çŠ¶æ€çš„ socketã€‚</p><p>æ€»ä¹‹ï¼Œ<code>agent.freeSockets</code> æä¾›äº†ä¸€ç§æ–¹å¼æ¥æŸ¥çœ‹å’Œç®¡ç†å¤„äºç©ºé—²çŠ¶æ€çš„ socket è¿æ¥ï¼Œè¿™å¯¹äºéœ€è¦ä¿æŒé«˜æ€§èƒ½å’Œæœ‰æ•ˆåˆ©ç”¨èµ„æºçš„åº”ç”¨ç¨‹åºæ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><h3 id="agent-getname-options" tabindex="-1"><a class="header-anchor" href="#agent-getname-options"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentgetnameoptions" target="_blank" rel="noopener noreferrer">agent.getName([options])</a></span></a></h3><p>Node.js ä¸­çš„ <code>agent.getName([options])</code> æ–¹æ³•å±äº HTTP æ¨¡å—ï¼Œå®ƒåœ¨å†…éƒ¨ç”¨äºç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§å’Œå¤ç”¨ã€‚ä¸ºäº†ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œè®©æˆ‘ä»¬å…ˆä»ä¸€äº›åŸºç¡€æ¦‚å¿µå¼€å§‹ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-1"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><h4 id="http-agent" tabindex="-1"><a class="header-anchor" href="#http-agent"><span>HTTP Agent</span></a></h4><p>åœ¨ Node.js ä¸­ï¼ŒHTTP Agent è´Ÿè´£ä¸º HTTP å®¢æˆ·ç«¯è¯·æ±‚ç®¡ç†è¿æ¥çš„æŒä¹…æ€§å’Œå¤ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ å‘èµ·å¤šä¸ªå¯¹åŒä¸€æœåŠ¡å™¨çš„ HTTP è¯·æ±‚æ—¶ï¼ŒAgent å¯ä»¥å¸®åŠ©å¤ç”¨å·²ç»å»ºç«‹çš„è¿æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹è¿æ¥ã€‚è¿™å¯ä»¥æé«˜æ€§èƒ½å¹¶å‡å°‘èµ„æºæ¶ˆè€—ã€‚</p><h4 id="è¿æ¥çš„å¤ç”¨" tabindex="-1"><a class="header-anchor" href="#è¿æ¥çš„å¤ç”¨"><span>è¿æ¥çš„å¤ç”¨</span></a></h4><p>è¿æ¥å¤ç”¨æŒ‡çš„æ˜¯ä½¿ç”¨åŒä¸€ä¸ª TCP/IP è¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚/å“åº”ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚/å“åº”å¯¹å¼€å¯ä¸€ä¸ªæ–°çš„è¿æ¥ã€‚è¿™åœ¨é¢‘ç¹äº¤äº’çš„åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ Web åº”ç”¨ç¨‹åºæˆ–è€… API æœåŠ¡ã€‚</p><h3 id="agent-getname-options-1" tabindex="-1"><a class="header-anchor" href="#agent-getname-options-1"><span>agent.getName([options])</span></a></h3><p>è¿™ä¸ªæ–¹æ³•æä¾›äº†ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼Œç”¨äºè¡¨ç¤ºç”±ç»™å®šé€‰é¡¹ï¼ˆå¦‚ä¸»æœºåã€ç«¯å£ã€æœ¬åœ°åœ°å€ç­‰ï¼‰åˆ›å»ºçš„è¿æ¥ã€‚<code>getName</code> æ–¹æ³•æ ¹æ®æä¾›çš„ <code>options</code> ç”Ÿæˆä¸€ä¸ªå”¯ä¸€å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²ç”¨äºåŒºåˆ†å’Œè¯†åˆ«ç‰¹å®šçš„è¿æ¥æˆ–è¿æ¥æ± ã€‚</p><h4 id="å‚æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-1"><span>å‚æ•°</span></a></h4><ul><li><code>options</code>ï¼ˆå¯é€‰ï¼‰: ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« HTTP è¯·æ±‚çš„é…ç½®é¡¹ï¼Œæ¯”å¦‚ <code>host</code>, <code>port</code>, <code>localAddress</code> ç­‰ã€‚</li></ul><h4 id="è¿”å›å€¼-1" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-1"><span>è¿”å›å€¼</span></a></h4><ul><li>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»£è¡¨äº†ç»™å®š <code>options</code> ä¸‹çš„è¿æ¥çš„åå­—ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦é¢‘ç¹å‘ä¸¤ä¸ªä¸åŒ API ç«¯ç‚¹å‘èµ·è¯·æ±‚çš„åº”ç”¨ç¨‹åºã€‚ä¸€ä¸ªæ˜¯å¤©æ°”æœåŠ¡ APIï¼Œå¦ä¸€ä¸ªæ˜¯æ–°é—»æœåŠ¡ APIã€‚</p><ol><li><p><strong>å¤©æ°”æœåŠ¡ API è¿æ¥</strong>:</p><ul><li>ä¸»æœºå: <code>api.weather.com</code></li><li>ç«¯å£: <code>80</code></li></ul></li><li><p><strong>æ–°é—»æœåŠ¡ API è¿æ¥</strong>:</p><ul><li>ä¸»æœºå: <code>api.news.com</code></li><li>ç«¯å£: <code>80</code></li></ul></li></ol><p>å¯¹äºè¿™ä¸¤ç§ä¸åŒçš„è¿æ¥ï¼Œ<code>agent.getName([options])</code> å°†ä¼šç”Ÿæˆä¸¤ä¸ªä¸åŒçš„å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼Œå› ä¸ºå®ƒä»¬çš„ <code>options</code> ï¼ˆè‡³å°‘æ˜¯ä¸»æœºåï¼‰ä¸åŒã€‚è¿™é‡Œä¸¾ä¸ªä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> weatherServiceOptions</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">api.weather.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> newsServiceOptions</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">api.news.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è·å–å¤©æ°”æœåŠ¡APIè¿æ¥çš„åç§°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> weatherServiceName</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getName</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">weatherServiceOptions</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">weatherServiceName</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºå¯èƒ½æ˜¯ &quot;api.weather.com:80:&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è·å–æ–°é—»æœåŠ¡APIè¿æ¥çš„åç§°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> newsServiceName</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getName</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">newsServiceOptions</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">newsServiceName</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºå¯èƒ½æ˜¯ &quot;api.news.com:80:&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js ä½¿ç”¨ <code>agent.getName([options])</code> æ¥åŒºåˆ†å’Œç®¡ç†ä¸åŒ API ç«¯ç‚¹çš„è¿æ¥å¤ç”¨ã€‚è¿™æ ·ï¼Œå³ä½¿ä½ çš„ç¨‹åºåŒæ—¶ä¸å¤šä¸ªè¿œç«¯æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä¹Ÿèƒ½æœ‰æ•ˆåˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜é€šä¿¡æ•ˆç‡ã€‚</p><h3 id="agent-maxfreesockets" tabindex="-1"><a class="header-anchor" href="#agent-maxfreesockets"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentmaxfreesockets" target="_blank" rel="noopener noreferrer">agent.maxFreeSockets</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªèƒ½è®©ä½ ç”¨ JavaScript ç¼–å†™æœåŠ¡ç«¯è½¯ä»¶çš„å¹³å°ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æä¾›äº†ä¸€ç§æ–¹å¼æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œè€Œ <code>http.Agent</code> ç±»æ˜¯ç”¨äºç®¡ç† HTTP å®¢æˆ·ç«¯è¿æ¥æŒä¹…æ€§å’Œå¤ç”¨çš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-agent-maxfreesockets" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-agent-maxfreesockets"><span>ä»€ä¹ˆæ˜¯ <code>agent.maxFreeSockets</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js çš„ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>Agent</code> å¯¹è±¡è´Ÿè´£ä¸º HTTP å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ªæŒä¹…è¿æ¥çš„æ± (pool)ã€‚è¿™æ„å‘³ç€å½“ä½ å‘èµ· HTTP è¯·æ±‚æ—¶ï¼ŒNode.js å¯ä»¥é‡ç”¨å·²ç»å»ºç«‹çš„è¿æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹æ–°çš„è¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹æé«˜äº†æ•ˆç‡ï¼Œå‡å°‘äº†å»¶è¿Ÿã€‚</p><p><code>agent.maxFreeSockets</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæ§åˆ¶åœ¨ç©ºé—²çŠ¶æ€ä¸‹ï¼Œå³å½“å‰æ²¡æœ‰æ´»è·ƒè¯·æ±‚æ—¶ï¼ŒAgent å¯ä»¥ä¿æŒæ‰“å¼€çš„æœ€å¤§å¥—æ¥å­—ï¼ˆsocketsï¼‰æ•°é‡ã€‚ä¸€æ—¦è¾¾åˆ°è¿™ä¸ªé™åˆ¶ï¼Œé¢å¤–çš„ç©ºé—²å¥—æ¥å­—å°†è¢«å…³é—­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼å¯èƒ½ä¼šæ ¹æ®ä¸åŒç‰ˆæœ¬çš„ Node.js æœ‰æ‰€å˜åŒ–ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦é¢‘ç¹è°ƒç”¨ç¬¬ä¸‰æ–¹ API çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚è·å–å¤©æ°”ä¿¡æ¯çš„åº”ç”¨ã€‚å¦‚æœä½ çš„åº”ç”¨æ¯æ¬¡è·å–æ•°æ®éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œé‚£ä¹ˆå°±ä¼šæ¶ˆè€—æ›´å¤šèµ„æºå¹¶ä¸”å¢åŠ å“åº”æ—¶é—´ã€‚</p><p>ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ agent</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> maxFreeSockets</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 10</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡†å¤‡è¯·æ±‚é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ²¡æœ‰æ›´å¤šçš„æ•°æ®ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½® <code>maxFreeSockets</code> ä¸º 10ï¼Œè¿™æ„å‘³ç€å½“æ²¡æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œagent å°†ä¿æŒæœ€å¤š 10 ä¸ªæ‰“å¼€çš„ç©ºé—²å¥—æ¥å­—ã€‚è¿™å¯¹äºä¼˜åŒ–æ€§èƒ½å°¤å…¶æœ‰ç”¨ï¼Œå°¤å…¶åœ¨ä½ é¢„è®¡ä¼šæœ‰è®¸å¤šç±»ä¼¼è¯·æ±‚ä¸”æƒ³è¦æœ‰æ•ˆé‡ç”¨è¿æ¥æ—¶ã€‚</p><p>é€šè¿‡è°ƒæ•´ <code>maxFreeSockets</code> çš„å€¼ï¼Œä½ å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„ç‰¹å®šéœ€æ±‚å’Œç›®æ ‡æœåŠ¡å™¨çš„èƒ½åŠ›æ¥å¾®è°ƒæ€§èƒ½å’Œèµ„æºä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨èƒ½å¤Ÿå¤„ç†æ›´å¤šçš„å¹¶è¡Œè¿æ¥ï¼Œä½ å¯ä»¥é€‚å½“å¢åŠ è¿™ä¸ªå€¼æ¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½®å¤ªé«˜çš„å€¼å¯èƒ½ä¼šå¯¼è‡´èµ„æºæµªè´¹ï¼Œå› ä¸ºå¤ªå¤šçš„ç©ºé—²è¿æ¥ä¹Ÿä¼šå ç”¨ç³»ç»Ÿèµ„æºã€‚</p><h3 id="agent-maxsockets" tabindex="-1"><a class="header-anchor" href="#agent-maxsockets"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentmaxsockets" target="_blank" rel="noopener noreferrer">agent.maxSockets</a></span></a></h3><p><code>agent.maxSockets</code> æ˜¯ Node.js ä¸­ http æ¨¡å—çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº <code>http.Agent</code> çš„å®ä¾‹ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http.Agent</code> è´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§ä»¥åŠé‡ç”¨ï¼Œè¿™æ˜¯ä¸ºäº†ä¼˜åŒ–ç½‘ç»œé€šè®¯ã€‚</p><p>é€šä¿—åœ°è¯´ï¼Œå½“ä½ çš„ Node.js åº”ç”¨ç¨‹åºéœ€è¦ä¸å¤–éƒ¨æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ API æœåŠ¡ï¼‰è¿›è¡Œ HTTP é€šè®¯æ—¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ªåˆ°é‚£ä¸ªæœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥ã€‚è¿™äº›è¿æ¥å¯ä»¥è¢«é‡æ–°ä½¿ç”¨ï¼Œå› è€Œå‡å°‘äº†æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚<code>agent.maxSockets</code> å°±æ˜¯ç”¨æ¥æ§åˆ¶ä¸€ä¸ª<code>http.Agent</code>å¯ä»¥åŒæ—¶æ‰“å¼€çš„æœ€å¤§ socketï¼ˆç½‘ç»œè¿æ¥ï¼‰æ•°é‡ã€‚</p><h3 id="é»˜è®¤å€¼" tabindex="-1"><a class="header-anchor" href="#é»˜è®¤å€¼"><span>é»˜è®¤å€¼</span></a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•° Node.js ç‰ˆæœ¬ä¸­<code>agent.maxSockets</code>çš„å€¼è¢«è®¾ç½®ä¸ºæ— é™(<code>Infinity</code>)ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ç¡¬æ€§çš„é™åˆ¶ï¼Œ<code>http.Agent</code>å¯ä»¥æ ¹æ®éœ€è¦æ‰“å¼€ä»»æ„æ•°é‡çš„ socketsã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦è®¾ç½®agent-maxsockets" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦è®¾ç½®agent-maxsockets"><span>ä¸ºä»€ä¹ˆè¦è®¾ç½®<code>agent.maxSockets</code></span></a></h3><p>æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦é™åˆ¶å¹¶å‘è¿æ¥æ•°ï¼ŒåŸå› å¯èƒ½åŒ…æ‹¬ï¼š</p><ol><li>é˜²æ­¢åº”ç”¨æ¶ˆè€—è¿‡å¤šç³»ç»Ÿèµ„æºã€‚</li><li>æŸäº›å¤–éƒ¨æœåŠ¡å™¨å¯èƒ½å¯¹å¹¶å‘è¿æ¥æ•°æœ‰é™åˆ¶ã€‚</li><li>æ§åˆ¶åº”ç”¨ç¨‹åºçš„æµé‡ã€‚</li></ol><h3 id="å¦‚ä½•è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è®¾ç½®"><span>å¦‚ä½•è®¾ç½®</span></a></h3><p>ä½ å¯ä»¥åœ¨åˆ›å»ºæ–°çš„<code>http.Agent</code>å®ä¾‹æ—¶è®¾ç½®<code>maxSockets</code>ï¼Œæˆ–è€…ä¿®æ”¹ç°æœ‰å®ä¾‹çš„è¯¥å±æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„agentå®ä¾‹ï¼Œå¹¶è®¾ç½®æœ€å¤§socketsä¸º10</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> maxSockets</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 10</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„agent</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰çš„agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æƒ³æ”¹å˜å…¨å±€çš„é»˜è®¤ agent çš„<code>maxSockets</code>å€¼ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¿®æ”¹å…¨å±€é»˜è®¤agentçš„maxSocketså€¼</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">globalAgent</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxSockets</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 20</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨æ‰€æœ‰é€šè¿‡å…¨å±€é»˜è®¤agentå‘èµ·çš„è¯·æ±‚éƒ½ä¼šéµå¾ªè¿™ä¸ªæ–°çš„é™åˆ¶</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ª Node.js è„šæœ¬ï¼Œå®ƒéœ€è¦ä»ä¸€ä¸ªå›¾ç‰‡åˆ†äº«æœåŠ¡ä¸‹è½½å¤§é‡å›¾ç‰‡ã€‚ä½ å¯èƒ½ä¸å¸Œæœ›åŒæ—¶å‘èµ·å¤ªå¤šè¿æ¥ï¼Œä»¥å…ç»™æœåŠ¡æä¾›è€…é€ æˆå‹åŠ›æˆ–è€…è¶…è¿‡å…¶è¿æ¥é™åˆ¶ã€‚è¿™æ—¶ä½ å¯ä»¥è®¾ç½®<code>maxSockets</code>æ¥é™åˆ¶åŒæ—¶ä¸‹è½½çš„å›¾ç‰‡æ•°é‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> downloadQueue</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">image1.jpg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">image2.jpg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#616E88;"> /* æ›´å¤šå›¾ç‰‡ */</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> maxSockets</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 5</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åŒæ—¶åªä¸‹è½½5å¼ å›¾ç‰‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">downloadQueue</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forEach</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">imageUrl</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">image-service.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">/images/</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">imageUrl</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> fileStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">./downloads/</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">imageUrl</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fileStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">imageUrl</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> downloaded</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error downloading </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">imageUrl</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®<code>agent.maxSockets</code>ä¸º 5ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨å°±ä¸ä¼šåŒæ—¶æ‰“å¼€è¶…è¿‡ 5 ä¸ªè¿æ¥å»ä¸‹è½½å›¾ç‰‡ã€‚è¿™æ ·å¯ä»¥æ›´åŠ å‹å¥½åœ°åˆ©ç”¨ç½‘ç»œèµ„æºï¼ŒåŒæ—¶ä¹Ÿéµå®ˆäº†å¤–éƒ¨æœåŠ¡çš„å¹¶å‘é™åˆ¶ã€‚</p><h3 id="agent-maxtotalsockets" tabindex="-1"><a class="header-anchor" href="#agent-maxtotalsockets"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentmaxtotalsockets" target="_blank" rel="noopener noreferrer">agent.maxTotalSockets</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¨¡å—å«åš <code>http</code>ï¼Œè¿™ä¸ªæ¨¡å—å…è®¸ Node.js èƒ½å¤Ÿæ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œå¦‚å‘é€è¯·æ±‚åˆ°å…¶ä»–ç½‘ç«™æˆ–åˆ›å»ºè‡ªå·±çš„æœåŠ¡å™¨æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><p>å½“ä½ ä½¿ç”¨ Node.js çš„ <code>http</code> æ¨¡å—å‘é€å¤šä¸ªå¹¶å‘è¯·æ±‚æ—¶ï¼Œä¾‹å¦‚å‘ä¸åŒçš„ API å‘é€æ•°æ®æˆ–ä»ä¸åŒçš„èµ„æºè·å–æ•°æ®ï¼ŒNode.js ä½¿ç”¨æ‰€è°“çš„â€œä»£ç†â€ï¼ˆAgentï¼‰æ¥ç®¡ç†è¿™äº›è¯·æ±‚ã€‚ä¸€ä¸ªä»£ç†å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ä¸­ä»‹ï¼Œå®ƒå¸®åŠ©ç®¡ç†å’Œä¼˜åŒ–ç½‘ç»œè¿æ¥ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬æåˆ°çš„ <code>agent.maxTotalSockets</code> å±æ€§ï¼Œå°±æ˜¯ä¸è¿™ä¸ªä»£ç†ç›¸å…³çš„é…ç½®é¡¹ä¹‹ä¸€ã€‚ç®€å•æ¥è¯´ï¼Œ<code>maxTotalSockets</code> é™åˆ¶äº†ä»£ç†å¯ä»¥åŒæ—¶æ‰“å¼€çš„å¥—æ¥å­—ï¼ˆsocketsï¼‰çš„æ€»æ•°ã€‚å¥—æ¥å­—æ˜¯æŒ‡ç½‘ç»œè¿æ¥ï¼Œæ¯è¿›è¡Œä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªå¥—æ¥å­—ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤©æ°”é¢„æŠ¥åº”ç”¨ã€‚ç”¨æˆ·è¾“å…¥ä»–ä»¬çš„ä½ç½®ï¼Œä½ çš„æœåŠ¡éœ€è¦ä»å‡ ä¸ªä¸åŒçš„æ•°æ®æºè·å–ä¿¡æ¯ï¼šæ¸©åº¦ã€æ¹¿åº¦ã€é£é€Ÿç­‰ã€‚å¦‚æœä½ å†³å®šåŒæ—¶ä» 5 ä¸ªä¸åŒçš„ API è·å–è¿™äº›æ•°æ®ï¼Œæ¯ä¸ª API è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼ˆå³å¥—æ¥å­—ï¼‰ã€‚</p><p>å¦‚æœä½ æ²¡æœ‰è®¾ç½® <code>maxTotalSockets</code>ï¼Œæˆ–è€…è®¾ç½®å¾—è¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>èµ„æºæµªè´¹</strong>ï¼šä¿æŒå¤§é‡é—²ç½®çš„è¿æ¥ä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºã€‚</li><li><strong>æ€§èƒ½å½±å“</strong>ï¼šæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå¯¹è¿‡å¤šçš„å¹¶å‘è¿æ¥æ–½åŠ é™åˆ¶ï¼Œå½±å“åº”ç”¨æ€§èƒ½ã€‚</li><li><strong>è¶…å‡ºæœåŠ¡å™¨é™åˆ¶</strong>ï¼šç›®æ ‡æœåŠ¡å™¨å¯èƒ½ä¼šå› ä¸ºæ¥æ”¶åˆ°å¤ªå¤šçš„å¹¶å‘è¯·æ±‚è€Œé˜»æ­¢ä½ çš„ IPã€‚</li></ul><p>é€šè¿‡åˆç†è®¾ç½® <code>agent.maxTotalSockets</code>ï¼Œä½ å¯ä»¥é¿å…è¿™äº›é—®é¢˜ï¼Œç¡®ä¿ä½ çš„åº”ç”¨åœ¨é«˜æ•ˆåœ°ä½¿ç”¨èµ„æºçš„åŒæ—¶ï¼Œè¿˜èƒ½ä¿æŒè‰¯å¥½çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ç¡®å®šä½ çš„åº”ç”¨æœ€å¤šåªéœ€è¦åŒæ—¶å¯¹å¤–å¼€æ”¾ 10 ä¸ª HTTP è¯·æ±‚ï¼Œä½ å°±å¯ä»¥æŠŠ <code>maxTotalSockets</code> è®¾ç½®ä¸º 10ã€‚</p><h3 id="å¦‚ä½•è®¾ç½®-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è®¾ç½®-1"><span>å¦‚ä½•è®¾ç½®</span></a></h3><p>åœ¨ Node.js ä¸­è®¾ç½® <code>agent.maxTotalSockets</code> å¾ˆç®€å•ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ç‰‡æ®µï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨å‘é€ HTTP è¯·æ±‚æ—¶è®¾ç½® <code>maxTotalSockets</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ä»£ç†</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> maxTotalSockets</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 10</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨è‡ªå®šä¹‰ä»£ç†å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/some/path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ä»£ç†</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†<code>http</code>æ¨¡å—ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä»£ç†ï¼Œå¹¶é€šè¿‡<code>maxTotalSockets</code>å±æ€§è®¾ç½®äº†æœ€å¤§å¥—æ¥å­—æ•°ä¸º 10ã€‚æ¥ç€æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªä»£ç†å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js åº”ç”¨å¯ä»¥æ›´æœ‰æ•ˆåœ°ç®¡ç†ç½‘ç»œè¿æ¥ï¼Œæ— è®ºæ˜¯è®¿é—®å¤–éƒ¨ API è¿˜æ˜¯å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p><h3 id="agent-requests" tabindex="-1"><a class="header-anchor" href="#agent-requests"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentrequests" target="_blank" rel="noopener noreferrer">agent.requests</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç”¨äºæ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºçš„å¹³å°ã€‚å®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥å¼€å‘æœåŠ¡å™¨ç«¯çš„è½¯ä»¶ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨åŒä¸€ç§è¯­è¨€ç¼–å†™å‰ç«¯å’Œåç«¯ä»£ç ï¼Œè¿™å¯¹å¾ˆå¤šå¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ã€‚åœ¨ Node.js ä¸­æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œ<code>http</code>æ¨¡å—å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿå¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚</p><p>åœ¨<code>http</code>æ¨¡å—ä¸­ï¼Œ<code>http.Agent</code>è´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§å’Œé‡ç”¨ï¼Œå®ƒä¸ºå¤šä¸ªå¹¶å‘è¯·æ±‚åˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ªè¿æ¥æ± ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<code>http.Agent</code>æ§åˆ¶ç€å¯¹äºç‰¹å®šä¸»æœºå’Œç«¯å£çš„è¿æ¥æ˜¯å¦‚ä½•è¢«å»ºç«‹ã€ç»´æŠ¤ä»¥åŠå¤ç”¨çš„ã€‚</p><h3 id="agent-requests-1" tabindex="-1"><a class="header-anchor" href="#agent-requests-1"><span>agent.requests</span></a></h3><p><code>agent.requests</code>æ˜¯<code>http.Agent</code>å®ä¾‹çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¿«ç…§ï¼Œæ˜¾ç¤ºå½“å‰æ‰€æœ‰æœªå®Œæˆï¼ˆæ­£åœ¨è¿›è¡Œä¸­ï¼‰çš„è¯·æ±‚ã€‚è¿™ä¸ªå±æ€§è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­é”®æ˜¯è¯·æ±‚çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯è¿æ¥åå­—ï¼‰ï¼Œå€¼æ˜¯å¯¹åº”è¯¥æ ‡è¯†ç¬¦å½“å‰æœªå®Œæˆè¯·æ±‚çš„æ•°é‡ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦é¢‘ç¹åœ°ä»å¤–éƒ¨ API è·å–æ•°æ®ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºåŒæ—¶å‘èµ·äº†æ•°ç™¾ä¸ªè¯·æ±‚å»è·å–ä¿¡æ¯ï¼Œäº†è§£å“ªäº›è¯·æ±‚ä»åœ¨è¿›è¡Œä¸­ã€å“ªäº›å·²ç»å®Œæˆå¯ä»¥å¸®åŠ©ä½ åœ¨è°ƒè¯•æ—¶å®šä½é—®é¢˜ï¼Œæˆ–è€…æ›´å¥½åœ°ç†è§£ä½ çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆã€‚</p><h5 id="ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç "><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„agentå®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡†å¤‡å‘é€è¯·æ±‚çš„é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰agent</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æŸ¥çœ‹å½“å‰æœªå®Œæˆçš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">agent</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">requests</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº†<code>http</code>æ¨¡å—ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ–°çš„<code>http.Agent</code>å®ä¾‹ï¼Œå¹¶é€šè¿‡æŒ‡å®š<code>keepAlive</code>é€‰é¡¹ä¸º<code>true</code>æ¥å¼€å¯è¿æ¥ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªåŒ…å«è¯·æ±‚é€‰é¡¹çš„å¯¹è±¡ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å®šäº†æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>agent</code>ã€‚ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>http.request</code>æ–¹æ³•å‘èµ·äº†ä¸€ä¸ª GET è¯·æ±‚åˆ°<code>example.com</code>ã€‚</p><p>åœ¨è¯·æ±‚ç»“æŸåï¼Œæˆ‘ä»¬é€šè¿‡æ‰“å°å‡º<code>agent.requests</code>æ¥æŸ¥çœ‹å½“å‰æ‰€æœ‰æœªå®Œæˆçš„è¯·æ±‚ã€‚è¿™å°†å¸®åŠ©æˆ‘ä»¬äº†è§£åœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼Œæœ‰å¤šå°‘è¯·æ±‚ä»ç„¶å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œä»è€Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹æ€§èƒ½é—®é¢˜è¿›è¡Œæ›´æ·±å…¥çš„åˆ†ææˆ–è°ƒè¯•ã€‚</p><p>è¯·æ³¨æ„ï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œ<code>example.com</code>å’Œè¯·æ±‚é€‰é¡¹åº”æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚è¿›è¡Œæ›¿æ¢ã€‚æ­¤å¤–ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ­£ç¡®å¤„ç†å“åº”å’Œé”™è¯¯æ˜¯éå¸¸é‡è¦çš„ï¼Œç¡®ä¿ä½ çš„ä»£ç èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å„ç§æƒ…å†µã€‚</p><h3 id="agent-sockets" tabindex="-1"><a class="header-anchor" href="#agent-sockets"><span><a href="https://nodejs.org/docs/latest/api/http.html#agentsockets" target="_blank" rel="noopener noreferrer">agent.sockets</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>agent.sockets</code>ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>http.Agent</code> æ˜¯ç®¡ç† HTTP å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ã€‚å®ƒè´Ÿè´£ç»´æŠ¤ä¸€ä¸ªæŒä¹…è¿æ¥æ± ï¼Œç”¨äºå¤ç”¨ TCP è¿æ¥ï¼Œä»è€Œæé«˜ç½‘ç»œé€šä¿¡çš„æ•ˆç‡ã€‚è¿™é‡Œçš„ &quot;sockets&quot; æŒ‡çš„å°±æ˜¯è¿™äº› TCP è¿æ¥ã€‚</p><h3 id="è§£é‡Š-agent-sockets" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-agent-sockets"><span>è§£é‡Š <code>agent.sockets</code></span></a></h3><p><code>agent.sockets</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†å½“å‰æ‰€æœ‰å­˜æ´»çš„å¥—æ¥å­—ï¼ˆsocketsï¼‰çš„ä¿¡æ¯ã€‚æ¢è¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†æ¯ä¸ªå·²ç»ä¸º HTTP å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹å¹¶ä¸”æ­£åœ¨ä½¿ç”¨ä¸­çš„ TCP è¿æ¥çš„è¯¦æƒ…ã€‚</p><p>æ¯ä¸ªé”®å€¼å¯¹ä»£è¡¨ä¸€ä¸ªè¿æ¥ã€‚é”®æ˜¯è¿æ¥çš„ç›®æ ‡ï¼ˆä¾‹å¦‚ <code>&quot;localhost:80&quot;</code>ï¼‰ï¼Œå€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå…·ä½“çš„ socketï¼ˆTCP è¿æ¥ï¼‰ã€‚</p><h3 id="ä¸¾ä¾‹è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¾‹è¯´æ˜"><span>ä¸¾ä¾‹è¯´æ˜</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦é¢‘ç¹åœ°å‘ä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ã€‚ä¸€ä¸ªè¿è¡Œåœ¨æœ¬æœºï¼ˆlocalhostï¼‰çš„ç«¯å£ 3000 ä¸Šï¼Œå¦ä¸€ä¸ªæ˜¯å¤–éƒ¨ APIï¼Œè¿è¡Œåœ¨ <code>example.com</code> çš„ 80 ç«¯å£ä¸Šã€‚</p><p>å½“ä½ çš„åº”ç”¨é€šè¿‡ <code>http.Agent</code> å‘è¿™ä¸¤ä¸ªæœåŠ¡å‘èµ·å¤šä¸ªå¹¶å‘è¯·æ±‚æ—¶ï¼Œ<code>agent.sockets</code> å¯ä»¥å¸®åŠ©ä½ ç†è§£åº•å±‚ TCP è¿æ¥çš„çŠ¶æ€ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> agent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚åˆ°æœ¬åœ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚ localhost:3000 å®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚åˆ°è¿œç¨‹æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> agent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ç›¸åŒçš„ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚ example.com å®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">agent</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">sockets</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æŸ¥çœ‹ agent.sockets çš„çŠ¶æ€</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>http.Agent</code> å®ä¾‹ï¼Œå¹¶ä¸”åœ¨ä¸¤ä¸ª <code>http.get</code> è°ƒç”¨ä¸­å¤ç”¨äº†å®ƒï¼Œåˆ†åˆ«å‘æœ¬åœ°æœåŠ¡å™¨å’Œ <code>example.com</code> å‘é€è¯·æ±‚ã€‚é€šè¿‡è®¾ç½® <code>keepAlive</code> ä¸º <code>true</code>ï¼Œæˆ‘ä»¬å‘Šè¯‰ <code>agent</code> ä¿æŒè¿æ¥å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œè€Œä¸æ˜¯åœ¨è¯·æ±‚å®Œæˆåç«‹å³å…³é—­ã€‚</p><p>è°ƒç”¨ <code>console.log(agent.sockets);</code> å°†æ‰“å°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºï¼Œå®ƒå±•ç¤ºäº†å½“å‰æ‰€æœ‰æ´»è·ƒçš„è¿æ¥ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> [</span></span>
<span class="line"><span style="color:#616E88;">    /* socket details */</span></span>
<span class="line"><span style="color:#ECEFF4;">  ],</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">example.com:80</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> [</span></span>
<span class="line"><span style="color:#616E88;">    /* socket details */</span></span>
<span class="line"><span style="color:#ECEFF4;">  ]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“å‰æœ‰é’ˆå¯¹ <code>localhost:3000</code> å’Œ <code>example.com:80</code> çš„æ´»è·ƒè¿æ¥ã€‚</p><h3 id="å®é™…è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨"><span>å®é™…è¿ç”¨</span></a></h3><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<code>agent.sockets</code> éå¸¸æœ‰ç”¨äºç›‘æ§å’Œè°ƒè¯•ç›®çš„ã€‚</p><ul><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šäº†è§£å¹¶æ§åˆ¶æŒä¹…è¿æ¥å¯ä»¥å¸®åŠ©å¼€å‘è€…ä¼˜åŒ–åº”ç”¨æ€§èƒ½ï¼Œå‡å°‘å»ºç«‹æ–°è¿æ¥å¸¦æ¥çš„å¼€é”€ã€‚</li><li><strong>èµ„æºç®¡ç†</strong>ï¼šç¡®ä¿ä½ çš„åº”ç”¨ä¸ä¼šå› ä¸ºè¿‡å¤šå¼€å¯çš„è¿æ¥è€Œæ¶ˆè€—å¤ªå¤šèµ„æºæˆ–è€…è¾¾åˆ°æ“ä½œç³»ç»Ÿé™åˆ¶ã€‚</li><li><strong>è°ƒè¯•</strong>ï¼šå½“å‡ºç°ç½‘ç»œé—®é¢˜æ—¶ï¼Œ<code>agent.sockets</code> å¯ä»¥å¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜æ˜¯å¦å‡ºç°åœ¨ TCP è¿æ¥å±‚é¢ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œç†è§£å’Œåˆ©ç”¨ <code>agent.sockets</code> æ˜¯æ„å»ºé«˜æ•ˆã€å¯é  Node.js ç½‘ç»œåº”ç”¨çš„ä¸€ä¸ªé‡è¦æ–¹é¢ã€‚</p><h2 id="class-http-clientrequest" tabindex="-1"><a class="header-anchor" href="#class-http-clientrequest"><span><a href="https://nodejs.org/docs/latest/api/http.html#class-httpclientrequest" target="_blank" rel="noopener noreferrer">Class: http.ClientRequest</a></span></a></h2><p>å½“ç„¶ï¼Œæ¥è®²è§£ä¸€ä¸‹ Node.js ä¸­çš„<code>http.ClientRequest</code>ç±»ã€‚è¿™ä¸ªç±»æ˜¯ Node.js HTTP API çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ã€‚åœ¨ä»‹ç»å®ƒä¹‹å‰ï¼Œæœ‰å¿…è¦äº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ol><li><strong>HTTP åè®®</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªè§„å®šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å¦‚ä½•é€šä¿¡çš„åè®®ã€‚</li><li><strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨</strong>ï¼šåœ¨ HTTP äº¤äº’ä¸­ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ï¼Œä½ çš„æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªç½‘é¡µï¼‰ï¼ŒæœåŠ¡å™¨å“åº”è¯·æ±‚ã€‚</li><li><strong>è¯·æ±‚å’Œå“åº”</strong>ï¼šä¸€ä¸ªå®Œæ•´çš„ HTTP äº¤äºšè¿‡ç¨‹åŒ…æ‹¬ä¸€ä¸ªè¯·æ±‚å’Œä¸€ä¸ªå“åº”ã€‚å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å›å¤å“åº”ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥<code>http.ClientRequest</code>ã€‚</p><h3 id="http-clientrequest" tabindex="-1"><a class="header-anchor" href="#http-clientrequest"><span>http.ClientRequest</span></a></h3><p><code>http.ClientRequest</code>æ˜¯ä¸€ä¸ªç”±<code>http.request()</code>æˆ–<code>http.get()</code>æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºæ­£åœ¨è¿›è¡Œçš„ HTTP è¯·æ±‚ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„äº‹ä»¶ã€æ–¹æ³•å’Œå±æ€§ï¼Œè®©ä½ å¯ä»¥ç²¾ç¡®åœ°æ§åˆ¶ HTTP è¯·æ±‚çš„æ¯ä¸ªæ–¹é¢ï¼Œå¹¶è·å–è¯·æ±‚çš„çŠ¶æ€å’Œå“åº”ã€‚</p><h4 id="åˆ›å»º-clientrequest" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-clientrequest"><span>åˆ›å»º ClientRequest</span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œä½ ä¸ç›´æ¥ä½¿ç”¨<code>new http.ClientRequest()</code>æ¥åˆ›å»ºè¿™ä¸ªå¯¹è±¡ã€‚ç›¸åï¼Œä½ ä¼šç”¨<code>http.request()</code>æˆ–<code>http.get()</code>æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šä¸ºä½ åˆ›å»º<code>ClientRequest</code>å®ä¾‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨http.request()åˆ›å»ºHTTP POSTè¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å†™å…¥æ•°æ®åˆ°è¯·æ±‚ä¸»ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">John Doe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> occupation</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">gardener</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¸»è¦äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸»è¦äº‹ä»¶"><span>ä¸»è¦äº‹ä»¶</span></a></h4><ul><li><code>response</code>: å½“æ”¶åˆ°æœåŠ¡å™¨å“åº”å¤´æ—¶è§¦å‘ã€‚</li><li><code>error</code>: è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚</li><li><code>abort</code>: è¯·æ±‚è¢«å®¢æˆ·ç«¯ä¸­æ­¢æ—¶è§¦å‘ã€‚</li><li><code>end</code>: è¯·æ±‚ç»“æŸæ—¶è§¦å‘ã€‚</li></ul><h4 id="ä¸»è¦æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸»è¦æ–¹æ³•"><span>ä¸»è¦æ–¹æ³•</span></a></h4><ul><li><code>write(data)</code>: å†™å…¥è¯·æ±‚ä¸»ä½“ã€‚</li><li><code>end()</code>: å®Œæˆå‘é€è¯·æ±‚ã€‚</li><li><code>abort()</code>: ä¸­æ­¢è¯·æ±‚ã€‚</li></ul><h4 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h4><h5 id="_1-å‘é€ç®€å•çš„-get-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_1-å‘é€ç®€å•çš„-get-è¯·æ±‚"><span>1. å‘é€ç®€å•çš„ GET è¯·æ±‚</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">é”™è¯¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-å‘é€å«æ•°æ®çš„-post-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-å‘é€å«æ•°æ®çš„-post-è¯·æ±‚"><span>2. å‘é€å«æ•°æ®çš„ POST è¯·æ±‚</span></a></h5><p>çœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨å†™å…¥è¯·æ±‚ä¸»ä½“å’Œç»“æŸè¯·æ±‚ä¹‹å‰ï¼Œæˆ‘ä»¬è®¾ç½®äº†è¯·æ±‚çš„ç±»å‹ä¸º<code>POST</code>ï¼Œå¹¶é€šè¿‡<code>write()</code>æ–¹æ³•å‘é€äº† JSON æ ¼å¼çš„æ•°æ®ã€‚</p><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h3><p><code>http.ClientRequest</code>ç±»æ˜¯ Node.js é‡Œå¤„ç† HTTP è¯·æ±‚çš„æ ¸å¿ƒï¼Œé€šè¿‡å®ƒï¼Œä½ å¯ä»¥æ„é€ å‡ ä¹ä»»ä½•ç±»å‹çš„ HTTP è¯·æ±‚ï¼Œæ§åˆ¶è¯·æ±‚å¤´ã€å‘é€æ•°æ®ç­‰ç­‰ã€‚ç†è§£å¹¶æŒæ¡å®ƒï¼Œå¯¹äºå¼€å‘ Web å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯ç¨‹åºéƒ½éå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="event-abort" tabindex="-1"><a class="header-anchor" href="#event-abort"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-abort" target="_blank" rel="noopener noreferrer">Event: &#39;abort&#39;</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>abort</code> äº‹ä»¶ï¼Œå°¤å…¶æ˜¯åœ¨ HTTP æ¨¡å—çš„ä¸Šä¸‹æ–‡ä¸­ã€‚æˆ‘å°†å°½é‡ç®€åŒ–è§£é‡Šï¼Œå¹¶æä¾›ä¸€äº›å®é™…çš„ä¾‹å­å¸®åŠ©ç†è§£ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-abort-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-abort-äº‹ä»¶"><span>ä»€ä¹ˆæ˜¯ <code>abort</code> äº‹ä»¶ï¼Ÿ</span></a></h3><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>abort</code> äº‹ä»¶æ˜¯ä¸è¯·æ±‚ï¼ˆRequestï¼‰å’Œå“åº”ï¼ˆResponseï¼‰ç›¸å…³çš„ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒè¢«è§¦å‘å½“ä¸€ä¸ªè¯·æ±‚è¢«å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨æˆ–å¦ä¸€ä¸ª Node.js åº”ç”¨ï¼‰ä¸­æ­¢æ—¶ã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„ HTTP è¯·æ±‚è¢«å–æ¶ˆäº†ï¼ŒNode.js å°†è§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-abort-äº‹ä»¶å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-abort-äº‹ä»¶å¾ˆé‡è¦"><span>ä¸ºä»€ä¹ˆ <code>abort</code> äº‹ä»¶å¾ˆé‡è¦ï¼Ÿ</span></a></h3><p>åœ¨æ„å»ºç½‘ç»œåº”ç”¨æ—¶ï¼Œå¤„ç†å¼‚å¸¸å’Œæ„å¤–æƒ…å†µéå¸¸é‡è¦ã€‚ç”¨æˆ·å¯èƒ½ä¼šåœ¨åŠ è½½è¿‡ç¨‹ä¸­åˆ·æ–°é¡µé¢ï¼Œæˆ–è€…å› ä¸ºç½‘ç»œè¿æ¥é—®é¢˜è€Œæ–­å¼€è¯·æ±‚ã€‚é€šè¿‡ç›‘å¬ <code>abort</code> äº‹ä»¶ï¼Œä½ çš„åº”ç”¨å¯ä»¥é€‚å½“åœ°å“åº”è¿™äº›ä¸­æ–­ï¼Œä¾‹å¦‚æ¸…ç†èµ„æºï¼Œè®°å½•æ—¥å¿—ï¼Œæˆ–è€…é‡æ–°å°è¯•è¯·æ±‚ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-http-æœåŠ¡å™¨ç›‘å¬-abort-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-http-æœåŠ¡å™¨ç›‘å¬-abort-äº‹ä»¶"><span>ä¾‹å­ 1ï¼šHTTP æœåŠ¡å™¨ç›‘å¬ <code>abort</code> äº‹ä»¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Node.js HTTP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å¯¹æŸäº›è¯·æ±‚æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼ˆæ¯”å¦‚ä»æ•°æ®åº“è·å–å¤§é‡æ•°æ®ï¼‰ã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨è¿‡ç¨‹ä¸­å–æ¶ˆäº†è¯·æ±‚ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”åœæ­¢æ‰§è¡Œä¸å†éœ€è¦çš„ä»»åŠ¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™æ˜¯ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> longRunningTask</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®Œæˆé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬ abort äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">abort</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚è¢«ä¸­æ­¢</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    clearTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">longRunningTask</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å–æ¶ˆé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨ä»»åŠ¡å®Œæˆä¹‹å‰ä¸­æ–­äº†è¯·æ±‚ï¼ˆä¾‹å¦‚å…³é—­æµè§ˆå™¨æ ‡ç­¾ï¼‰ï¼Œ<code>abort</code> äº‹ä»¶å°†è¢«è§¦å‘ï¼Œå…è®¸æœåŠ¡å™¨åœæ­¢æ‰§è¡Œä¸å¿…è¦çš„ä»»åŠ¡ã€‚</p><h4 id="ä¾‹å­-2-ä½¿ç”¨-http-å®¢æˆ·ç«¯å¤„ç†-abort-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨-http-å®¢æˆ·ç«¯å¤„ç†-abort-äº‹ä»¶"><span>ä¾‹å­ 2ï¼šä½¿ç”¨ HTTP å®¢æˆ·ç«¯å¤„ç† <code>abort</code> äº‹ä»¶</span></a></h4><p>å½“ä½ çš„ Node.js åº”ç”¨ä½œä¸ºå®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚ç»™å…¶ä»–æœåŠ¡å™¨æ—¶ï¼Œä¹Ÿå¯èƒ½éœ€è¦å¤„ç† <code>abort</code> äº‹ä»¶ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ äº†è§£ä½•æ—¶è¯·æ±‚æ²¡æœ‰æˆåŠŸå®Œæˆï¼Œä»è€Œé‡‡å–ç›¸åº”çš„æªæ–½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¦‚æœè¯·æ±‚è¢«ç»ˆæ­¢ï¼Œç›‘å¬å¹¶å“åº” abort äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">abort</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚è¢«ä¸­æ­¢</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿè¯·æ±‚ä¸­æ­¢</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä¸»åŠ¨ä¸­æ­¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ±‚åœ¨å‘é€åç«‹å³è¢«ä¸­æ­¢ï¼Œè§¦å‘äº† <code>abort</code> äº‹ä»¶ã€‚è¿™ç§æœºåˆ¶åœ¨å¤„ç†è¯¸å¦‚è¶…æ—¶ã€ç”¨æˆ·å–æ¶ˆæ“ä½œç­‰åœºæ™¯æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>abort</code> äº‹ä»¶åœ¨ Node.js ä¸­æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…æœ‰æ•ˆåœ°ç®¡ç†å’Œå“åº” HTTP è¯·æ±‚çš„ä¸­æ­¢è¡Œä¸ºã€‚è¿™å¯¹äºä¿éšœèµ„æºæœ‰æ•ˆåˆ©ç”¨å’Œå¢å¼ºç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚</p><h3 id="event-close" tabindex="-1"><a class="header-anchor" href="#event-close"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-close" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>Event: &#39;close&#39;</code>æ˜¯åœ¨ HTTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åœæ­¢æ—¶è§¦å‘çš„äº‹ä»¶ã€‚ç†è§£è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆå¾—æ˜ç™½ Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ã€‚è¿™æ„å‘³ç€ï¼ŒNode.js ä¸­å¾ˆå¤šå¯¹è±¡ï¼ˆæ¯”å¦‚ HTTP æœåŠ¡å™¨å’Œè¯·æ±‚ï¼‰éƒ½ä¼šåœ¨æŸäº›å…³é”®æ—¶åˆ»è§¦å‘äº‹ä»¶ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶å¹¶ä½œå‡ºç›¸åº”çš„å“åº”ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯event-close" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯event-close"><span>ä»€ä¹ˆæ˜¯<code>Event: &#39;close&#39;</code></span></a></h3><p>å½“ HTTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯å®Œæˆæ‰€æœ‰çš„è¯·æ±‚å’Œå“åº”åï¼Œå¹¶ä¸”å…³é—­è¿æ¥æ—¶ï¼Œä¼šè§¦å‘<code>close</code>äº‹ä»¶ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œè¿™ä¸ª<code>close</code>äº‹ä»¶å¹¶ä¸ä¿è¯æ‰€æœ‰çš„è¿æ¥éƒ½å·²ç»å®Œå…¨å…³é—­ï¼Œå°¤å…¶æ˜¯åœ¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ã€‚ä½†å®ƒæ ‡å¿—ç€æœåŠ¡å™¨ä¸å†æ¥å—æ–°çš„è¿æ¥ï¼Œå¹¶å¼€å§‹å…³é—­è¿‡ç¨‹ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-http-æœåŠ¡å™¨å…³é—­ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_1-http-æœåŠ¡å™¨å…³é—­ç¤ºä¾‹"><span>1. HTTP æœåŠ¡å™¨å…³é—­ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå½“æœåŠ¡å™¨å…³é—­æ—¶ï¼Œä½ æƒ³è®°å½•æ—¥å¿—è¯´æ˜æœåŠ¡å™¨å·²ç»åœæ­¢æœåŠ¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬closeäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹ŸæœåŠ¡å™¨å…³é—­</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä¸»åŠ¨å…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç­‰å¾…5ç§’é’Ÿåå…³é—­æœåŠ¡å™¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨å¯åŠ¨å 5 ç§’é’Ÿå°†è‡ªåŠ¨å…³é—­ï¼Œå¹¶è§¦å‘<code>close</code>äº‹ä»¶ï¼Œç„¶åè¾“å‡ºâ€œServer is closed.â€åˆ°æ§åˆ¶å°ã€‚</p><h4 id="_2-http-å®¢æˆ·ç«¯å…³é—­ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-http-å®¢æˆ·ç«¯å…³é—­ç¤ºä¾‹"><span>2. HTTP å®¢æˆ·ç«¯å…³é—­ç¤ºä¾‹</span></a></h4><p>ç°åœ¨è€ƒè™‘å¦ä¸€ç§æƒ…å†µï¼Œä½ æ­£åœ¨ä½¿ç”¨ HTTP æ¨¡å—çš„å®¢æˆ·ç«¯åŠŸèƒ½å‘é€è¯·æ±‚ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“ä½•æ—¶å®¢æˆ·ç«¯å®Œæˆæ‰€æœ‰æ“ä½œå¹¶å…³é—­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// é…ç½®è¯·æ±‚é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection is closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘èµ·äº†ä¸€ä¸ªå‘<code>www.example.com</code>çš„ GET è¯·æ±‚ã€‚å½“è¯·æ±‚ç»“æŸå¹¶å…³é—­æ—¶ï¼Œ<code>close</code>äº‹ä»¶è¢«è§¦å‘ï¼Œç„¶åè¾“å‡ºâ€œConnection is closed.â€åˆ°æ§åˆ¶å°ã€‚</p><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h3><p><code>Event: &#39;close&#39;</code>åœ¨ HTTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸­éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯éœ€è¦åœ¨å…³é—­è¿æ¥ä¹‹å‰è¿›è¡Œæ¸…ç†å·¥ä½œæ—¶ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æŒæ¡å’Œç®¡ç†èµ„æºé‡Šæ”¾ã€æ—¥å¿—è®°å½•ç­‰ä»»åŠ¡ã€‚</p><h3 id="event-connect" tabindex="-1"><a class="header-anchor" href="#event-connect"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-connect" target="_blank" rel="noopener noreferrer">Event: &#39;connect&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>Event: &#39;connect&#39;</code>æ˜¯ä¸ HTTP æœåŠ¡å™¨ç›¸å…³çš„ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒç‰¹åˆ«ç”¨äºå¤„ç† HTTP CONNECT è¯·æ±‚ã€‚åœ¨è®²è§£è¿™ä¸ªäº‹ä»¶ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ä»¶äº‹ï¼šä»€ä¹ˆæ˜¯ HTTP CONNECT æ–¹æ³•ï¼Œä»¥åŠ Node.js ä¸­çš„äº‹ä»¶æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h3 id="http-connect-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#http-connect-æ–¹æ³•"><span>HTTP CONNECT æ–¹æ³•</span></a></h3><p>HTTP CONNECT æ–¹æ³•ä¸»è¦ç”¨äºè¦æ±‚ä»£ç†æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯ä¸å¦ä¸€å°æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªéš§é“è¿æ¥ï¼Œé€šå¸¸ç”¨äº HTTPS è¯·æ±‚æˆ– WebSocket è¿æ¥ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„ç½‘ç»œè¯·æ±‚éœ€è¦é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®ç›®æ ‡æœåŠ¡å™¨æ—¶ï¼ŒCONNECT æ–¹æ³•å¯ä»¥å¸®ä½ ç›´æ¥è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ä¼ è¾“ã€‚</p><h3 id="node-js-ä¸­çš„äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„äº‹ä»¶"><span>Node.js ä¸­çš„äº‹ä»¶</span></a></h3><p>Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œè¿™æ„å‘³ç€ Node.js å¯ä»¥ç›‘å¬å’Œè§¦å‘äº‹ä»¶ã€‚åœ¨ Node.js ä¸­ï¼Œå½“æŸäº›ç‰¹å®šçš„äº‹æƒ…å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚æ–‡ä»¶è¯»å–å®Œæ¯•ï¼‰ï¼Œä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œç»‘å®šåœ¨è¿™ä¸ªäº‹ä»¶ä¸Šçš„å‡½æ•°ã€‚è¿™æ˜¯ Node.js å¼‚æ­¥éé˜»å¡æ¶æ„çš„æ ¸å¿ƒä¹‹ä¸€ã€‚</p><h3 id="event-connect-1" tabindex="-1"><a class="header-anchor" href="#event-connect-1"><span>Event: &#39;connect&#39;</span></a></h3><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œå½“æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ª CONNECT è¯·æ±‚æ—¶ï¼Œä¼šè§¦å‘<code>&#39;connect&#39;</code>äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶å…è®¸ä½ å¯¹è¯¥è¯·æ±‚è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä¾‹å¦‚å»ºç«‹ä¸€ä¸ªä»£ç†æœåŠ¡ã€‚äº‹ä»¶å¤„ç†å™¨ä¼šæ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š</p><ol><li><strong>request</strong>ï¼šä¸€ä¸ª<code>http.IncomingMessage</code>å¯¹è±¡ï¼Œæä¾›è¯·æ±‚ä¿¡æ¯ã€‚</li><li><strong>socket</strong>ï¼šä¸€ä¸ªç½‘ç»œå¥—æ¥å­—ï¼ˆSocketï¼‰ï¼Œç”¨äºä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚</li><li><strong>head</strong>ï¼šä¸€ä¸ª<code>Buffer</code>ï¼ŒåŒ…å«ç¬¬ä¸€ä¸ªæ•°æ®åŒ…çš„å¤´éƒ¨ä¿¡æ¯ï¼Œæ­¤æ•°æ®å¯èƒ½åœ¨ä»£ç†åˆ›å»ºåç«‹å³å‘é€ã€‚</li></ol><h4 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP ä»£ç†æœåŠ¡å™¨ï¼Œå½“æ”¶åˆ° CONNECT è¯·æ±‚æ—¶ï¼Œä½ å¸Œæœ›èƒ½å¤Ÿå¤„ç†è¿™ç§è¯·æ±‚ï¼Œå»ºç«‹ä¸€ä¸ªåˆ°ç›®çš„åœ°çš„éš§é“ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨<code>&#39;connect&#39;</code>äº‹ä»¶æ¥å®ç°è¿™ä¸ªåŠŸèƒ½çš„ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> URL</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">url</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ­£å¸¸çš„HTTPè¯·æ±‚å“åº”</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> head</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è§£æç›®æ ‡åœ°å€å’Œç«¯å£</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> hostname</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> port</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">http://</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å»ºç«‹åˆ°ç›®æ ‡æœåŠ¡å™¨çš„TCPè¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> targetSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;"> ||</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> hostname</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTTP/1.1 200 Connection Established</span><span style="color:#EBCB8B;">\r\n\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    targetSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">head</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // æ•°æ®æµä¹‹é—´äº’ç›¸ç®¡é“ä¼ è¾“</span></span>
<span class="line"><span style="color:#D8DEE9;">    targetSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">targetSocket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  targetSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç›®æ ‡æœåŠ¡å™¨è¿æ¥å¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä»£ç†æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ HTTP æœåŠ¡å™¨æ¥æ”¶åˆ° CONNECT è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå°è¯•è¿æ¥è¯·æ±‚ä¸­æŒ‡å®šçš„ hostname å’Œ portã€‚å¦‚æœè¿æ¥æˆåŠŸï¼ŒæœåŠ¡å™¨å°±ä¼šå°†å®¢æˆ·ç«¯çš„ socket å’Œç›®æ ‡æœåŠ¡å™¨çš„ socket è¿›è¡ŒåŒå‘è¿æ¥ï¼Œä½¿å¾—æ•°æ®èƒ½å¤Ÿåœ¨ä¸¤è€…ä¹‹é—´æµé€šï¼Œä»è€Œå®Œæˆä»£ç†çš„åŠŸèƒ½ã€‚</p><h3 id="event-continue" tabindex="-1"><a class="header-anchor" href="#event-continue"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-continue" target="_blank" rel="noopener noreferrer">Event: &#39;continue&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚å…¶ä¸­ï¼ŒNode.js ä¸­çš„<code>http</code>æ¨¡å—æ˜¯ç”¨äºåˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚å½“ä½ äº†è§£ Node.js çš„äº‹ä»¶ç³»ç»Ÿæ—¶ï¼Œä½ ä¼šå‘ç°è¿™æ˜¯ Node.js ä¸­éå¸¸å¼ºå¤§ä¸”çµæ´»çš„ç‰¹æ€§ä¹‹ä¸€ã€‚</p><h3 id="event-continue-1" tabindex="-1"><a class="header-anchor" href="#event-continue-1"><span>Event: &#39;continue&#39;</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>http</code>æ¨¡å—æä¾›äº†ä¸€ä¸ªäº‹ä»¶å«åš<code>&#39;continue&#39;</code>ã€‚è¿™ä¸ªäº‹ä»¶ä¸ HTTP åè®®çš„ 100-continue æœºåˆ¶ç´§å¯†ç›¸å…³ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯-http-100-continue" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-http-100-continue"><span>ä»€ä¹ˆæ˜¯ HTTP 100-continueï¼Ÿ</span></a></h4><p>HTTP/1.1 åè®®ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨å‘é€ POST æˆ– PUT è¯·æ±‚æ—¶ï¼Œå¯ä»¥å‘é€ä¸€ä¸ª Expect: 100-continue å¤´éƒ¨è¯·æ±‚æœåŠ¡å™¨ç¡®è®¤æ˜¯å¦æ„¿æ„æ¥å—è¯·æ±‚ä½“çš„æ•°æ®ã€‚å¦‚æœæœåŠ¡å™¨æ„¿æ„æ¥å—è¯·æ±‚ä½“ï¼Œåˆ™å›å¤ä¸€ä¸ªçŠ¶æ€ç ä¸º 100ï¼ˆContinueï¼‰çš„å“åº”ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å¯ä»¥å®‰å…¨åœ°ç»§ç»­å‘é€è¯·æ±‚ä½“ã€‚å¦‚æœæœåŠ¡å™¨ä¸æ„¿æ„æ¥å—è¯·æ±‚ä½“çš„æ•°æ®ï¼Œåˆ™å¯ä»¥ç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”ï¼ˆå¦‚ 417 Expectation Failedï¼‰ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±æ— éœ€å‘é€è¯·æ±‚ä½“äº†ï¼Œä»è€ŒèŠ‚çœå¸¦å®½å’Œæ—¶é—´ã€‚</p><h4 id="åœ¨-node-js-ä¸­ä½¿ç”¨-event-continue" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ä¸­ä½¿ç”¨-event-continue"><span>åœ¨ Node.js ä¸­ä½¿ç”¨ Event: &#39;continue&#39;</span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨å¹¶ä¸”å¤„ç† POST æˆ– PUT è¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®è¯·æ±‚çš„æŸäº›æ¡ä»¶ï¼ˆæ¯”å¦‚è¯·æ±‚å¤´éƒ¨ä¿¡æ¯æˆ–è€…è¯·æ±‚ä½“çš„å¤§å°ï¼‰æ¥å†³å®šæ˜¯å¦æ¥å—è¯·æ±‚ä½“ã€‚è¿™æ—¶ï¼Œ<code>&#39;continue&#39;</code>äº‹ä»¶å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å‘é€100 Continueå“åº”</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œåªå¤„ç†æœ€ç»ˆçš„è¯·æ±‚ã€‚</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> body</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &#39;&#39;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      body</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è½¬æ¢Bufferåˆ°å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">body</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºè¯·æ±‚ä½“å†…å®¹</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">ä¸Šä¼ å®Œæˆ</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 404</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">æœªæ‰¾åˆ°</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;continue&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">checkContinue</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬è¦æ ¹æ®è¯·æ±‚å¤´ä¿¡æ¯åšå‡ºå†³ç­–</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">content-length</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœå†…å®¹é•¿åº¦å°äº1000å­—èŠ‚ï¼Œå‘é€100ç»§ç»­å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeContinue</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // ç„¶åäº‹ä»¶å¤„ç†å™¨é€€å‡ºï¼Œè¯·æ±‚å°†ç»§ç»­è¢«å¤„ç†</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦åˆ™ï¼Œæ‹’ç»è¿‡å¤§çš„è¯·æ±‚ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">413</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">è¯·æ±‚ä½“è¿‡å¤§</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥æ¥æ”¶åˆ°<code>/upload</code>è·¯å¾„çš„ POST è¯·æ±‚ã€‚é€šè¿‡ç›‘å¬<code>checkContinue</code>äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°åŸºäºè¯·æ±‚å¤´ï¼ˆä¾‹å¦‚å†…å®¹é•¿åº¦ï¼‰çš„é€»è¾‘æ¥åˆ¤æ–­æ˜¯å¦æ¥å—è¯·æ±‚ä½“ã€‚å¦‚æœè¯·æ±‚ä½“ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼ˆä¾‹å¦‚å†…å®¹é•¿åº¦å°äº 1000 å­—èŠ‚ï¼‰ï¼Œæˆ‘ä»¬å°±è°ƒç”¨<code>res.writeContinue()</code>æ–¹æ³•æ¥å‘é€ 100-continue å“åº”ï¼Œå…è®¸å®¢æˆ·ç«¯ç»§ç»­å‘é€è¯·æ±‚ä½“æ•°æ®ã€‚å¦‚æœè¯·æ±‚ä½“ä¸ç¬¦åˆè¦æ±‚ï¼ˆä¾‹å¦‚å¤ªå¤§ï¼‰ï¼Œæˆ‘ä»¬åˆ™è¿”å›ä¸€ä¸ª 413 çŠ¶æ€ç ï¼Œè¡¨ç¤ºè¯·æ±‚ä½“è¿‡å¤§ã€‚</p><p>è¿™ä¸ªæœºåˆ¶å¯¹äºæ§åˆ¶èµ„æºæ¶ˆè€—ã€æé«˜æœåŠ¡å™¨æ•ˆç‡ç­‰æ–¹é¢éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡ä¸Šä¼ æ“ä½œæ—¶ã€‚</p><h3 id="event-finish" tabindex="-1"><a class="header-anchor" href="#event-finish"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-finish" target="_blank" rel="noopener noreferrer">Event: &#39;finish&#39;</a></span></a></h3><p>å½“ä½ å¼€å§‹å­¦ä¹ ç¼–ç¨‹ï¼Œç‰¹åˆ«æ˜¯ Node.jsï¼Œç†è§£ä¸åŒçš„æ¦‚å¿µå’Œäº‹ä»¶å¯èƒ½ä¼šç¨æ˜¾å¤æ‚ï¼Œä½†æˆ‘ä¼šå°½åŠ›ç”¨ç®€å•çš„è¯­è¨€æ¥è§£é‡Šç»™ä½ ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œâ€œEvent: &#39;finish&#39;â€æ˜¯ä¸€ä¸ªä¸ HTTP æ¨¡å—ç›¸å…³è”çš„äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶æ˜¯å±äº Streamï¼ˆæµï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ Writable Streamï¼ˆå¯å†™æµï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“ä½ å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œå¹¶ä¸”æ‰€æœ‰æ•°æ®éƒ½å·²æˆåŠŸå‘é€å®Œæˆæ—¶ï¼Œå°±ä¼šè§¦å‘&#39;finish&#39;äº‹ä»¶ã€‚è¿™å¯¹äºçŸ¥é“ä½•æ—¶ç»“æŸå“åº”æˆ–æ‰§è¡Œæ¸…ç†å·¥ä½œéå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼Œè¿™æ ·ä½ ä¼šæ›´å®¹æ˜“ç†è§£ã€‚</p><h4 id="ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”"><span>ç¤ºä¾‹ 1: HTTP æœåŠ¡å™¨å“åº”</span></a></h4><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶ï¼Œä½ æƒ³å‘ä»–ä»¬å‘é€ä¸€äº›ä¿¡æ¯ï¼Œå¹¶åœ¨å…¨éƒ¨ä¿¡æ¯å‘é€å®Œæˆåï¼Œåœ¨æ§åˆ¶å°ä¸Šæ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€ä¸€ä¸ªå“åº”åˆ°å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A new connection has been established.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬resçš„&#39;finish&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">All data sent to client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å½“æ‰€æœ‰æ•°æ®å‘é€å®Œæ¯•æ—¶ï¼Œæ‰“å°æ­¤æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬è°ƒç”¨<code>res.end()</code>å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯åï¼Œ<code>&#39;finish&#39;</code>äº‹ä»¶è¢«è§¦å‘ï¼Œè¡¨æ˜æ‰€æœ‰æ•°æ®éƒ½å·²ç»å‘é€å®Œæ¯•ã€‚</p><h4 id="ç¤ºä¾‹-2-æ–‡ä»¶å†™å…¥" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ–‡ä»¶å†™å…¥"><span>ç¤ºä¾‹ 2: æ–‡ä»¶å†™å…¥</span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨<code>&#39;finish&#39;</code>äº‹ä»¶æ¥çŸ¥é“æ•°æ®æ˜¯å¦å…¨éƒ¨å†™å…¥å®Œæˆã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> writeStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">output.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is some content being written into the file.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¡¨ç¤ºæ²¡æœ‰æ›´å¤šæ•°æ®è¦è¢«å†™å…¥Writable Stream</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;finish&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Finished writing to file.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ•°æ®å†™å…¥å®Œæˆ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">There was an error writing to the file: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘<code>output.txt</code>çš„å†™å…¥æµï¼Œå¹¶å‘å…¶ä¸­å†™å…¥äº†ä¸€äº›æ–‡æœ¬ã€‚è°ƒç”¨<code>.end()</code>æ–¹æ³•åï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šæ•°æ®è¦å†™å…¥ï¼Œéšå<code>&#39;finish&#39;</code>äº‹ä»¶è¢«è§¦å‘ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰æ•°æ®éƒ½å·²æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚</p><h3 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h3><p>ç®€è€Œè¨€ä¹‹ï¼Œâ€œEvent: &#39;finish&#39;â€æ˜¯ä¸€ä¸ªåœ¨ Node.js ä¸­è¡¨ç¤ºæŸç§ç±»å‹çš„ Writable Streamï¼ˆå¦‚ HTTP å“åº”æˆ–æ–‡ä»¶å†™å…¥æ“ä½œï¼‰å·²ç»æˆåŠŸå®Œæˆæ•°æ®å†™å…¥çš„äº‹ä»¶ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥ç¡®åˆ‡åœ°çŸ¥é“ä½•æ—¶å®Œæˆäº†æ•°æ®å‘é€æˆ–å†™å…¥æ“ä½œï¼Œå¹¶å¯æ®æ­¤è¿›è¡Œåç»­çš„é€»è¾‘å¤„ç†æˆ–èµ„æºæ¸…ç†ã€‚</p><h3 id="event-information" tabindex="-1"><a class="header-anchor" href="#event-information"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-information" target="_blank" rel="noopener noreferrer">Event: &#39;information&#39;</a></span></a></h3><p>Node.js çš„ <code>information</code> äº‹ä»¶æ˜¯åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ä½¿ç”¨çš„ä¸€ä¸ªç‰¹æ®Šäº‹ä»¶ã€‚è¦ç†è§£è¿™ä¸ªäº‹ä»¶ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-http" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-http"><span>ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ</span></a></h3><p>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§ç”¨äºä¼ è¾“ç½‘é¡µï¼ˆHTML æ–‡ä»¶ï¼Œå›¾ç‰‡ç­‰ï¼‰çš„åè®®ã€‚å®ƒå»ºç«‹åœ¨å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”æ¨¡å‹ä¸Šã€‚</p><h3 id="http-2-å’Œ-1xx-çŠ¶æ€ç " tabindex="-1"><a class="header-anchor" href="#http-2-å’Œ-1xx-çŠ¶æ€ç "><span>HTTP/2 å’Œ 1xx çŠ¶æ€ç </span></a></h3><p>ä» HTTP/1.1 å¼€å§‹ï¼Œå­˜åœ¨ä¸€ç±»ç‰¹æ®Šçš„çŠ¶æ€ç ï¼Œå³ 1xx çŠ¶æ€ç ï¼Œå®ƒä»¬è¢«ç§°ä¸ºä¿¡æ¯æ€§çŠ¶æ€ç ã€‚è¿™äº›çŠ¶æ€ç è¡¨ç¤ºä¸´æ—¶çš„å“åº”ï¼Œç›®çš„æ˜¯é€šçŸ¥å®¢æˆ·ç«¯è¯·æ±‚æ­£åœ¨è¢«å¤„ç†ï¼Œä½†è¿˜æ²¡æœ‰å®Œå…¨å®Œæˆã€‚</p><p>HTTP/2 è¿›ä¸€æ­¥æ‰©å±•äº†è¿™ä¸€æ¦‚å¿µï¼Œå¼•å…¥äº†æœåŠ¡å™¨æ¨é€åŠŸèƒ½ç­‰ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚</p><h3 id="node-js-ä¸­çš„-information-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-information-äº‹ä»¶"><span>Node.js ä¸­çš„ <code>information</code> äº‹ä»¶</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>http</code> æˆ– <code>https</code> æ¨¡å—åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æˆ–å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå‘é€ä¸€ä¸ªæˆ–å¤šä¸ª 1xx å“åº”ï¼ˆæ¯”å¦‚ 100ï¼ˆç»§ç»­ï¼‰ã€102ï¼ˆå¤„ç†ä¸­ï¼‰ç­‰ï¼‰ã€‚è¿™æ—¶ï¼Œ<code>information</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚</p><p>è¿™ä¸ªäº‹ä»¶å¯¹äºé‚£äº›æƒ³è¦æ ¹æ®æœåŠ¡å™¨çš„åˆæ­¥å“åº”æ¥è°ƒæ•´å…¶åç»­è¡Œä¸ºçš„åº”ç”¨ç¨‹åºæ¥è¯´éå¸¸æœ‰ç”¨ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³åœ¨æ”¶åˆ° 100ï¼ˆç»§ç»­ï¼‰å“åº”åå†å‘é€è¯·æ±‚ä½“ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><ol><li><p><strong>å¤„ç† 100 Continue å“åº”ï¼š</strong></p><p>å‡è®¾ä½ åœ¨ä¸Šä¼ ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ã€‚åœ¨å¼€å§‹ä¼ è¾“å¤§é‡æ•°æ®ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥å…ˆå‘é€ä¸€ä¸ªåŒ…å«<code>Expect: 100-continue</code>å¤´éƒ¨çš„è¯·æ±‚ã€‚å¦‚æœæœåŠ¡å™¨æ„¿æ„æ¥å—æ•°æ®ï¼Œå®ƒå°†å›å¤ 100 Continue çŠ¶æ€ç ï¼Œè¿™æ—¶å®¢æˆ·ç«¯æ‰å¼€å§‹ä¼ è¾“æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      Expect</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">100-continue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">information</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">info</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°ä¿¡æ¯æ€§å“åº”: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">info</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">info</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> ===</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // æœåŠ¡å™¨å·²å‡†å¤‡å¥½æ¥æ”¶æ•°æ®ï¼Œå¼€å§‹å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®é™…è¦å‘é€çš„æ•°æ®...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•å¤„ç† 100 Continue å“åº”ï¼Œä»¥åŠå¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå‘é€æ•°æ®ã€‚</p><p>é€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼ŒNode.js åº”ç”¨å¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°å¤„ç† HTTP é€šä¿¡ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠå¤§é‡æ•°æ®ä¼ è¾“æ—¶ã€‚ä½¿ç”¨ <code>information</code> äº‹ä»¶èƒ½å¤Ÿè®©å¼€å‘è€…åœ¨æ”¶åˆ°æœåŠ¡å™¨çš„åˆæ­¥åé¦ˆåï¼Œè¿›è¡Œæ›´ç²¾ç»†åŒ–çš„æ§åˆ¶ã€‚</p><h3 id="event-response" tabindex="-1"><a class="header-anchor" href="#event-response"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-response" target="_blank" rel="noopener noreferrer">Event: &#39;response&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>Event: &#39;response&#39;</code>äº‹ä»¶æ˜¯åœ¨ä½¿ç”¨ HTTP æ¨¡å—è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶é‡åˆ°çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šå°½é‡ç®€å•åœ°è§£é‡Šå®ƒï¼ŒåŒæ—¶ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Node.js çš„ HTTP æ¨¡å—å…è®¸ä½ åˆ›å»º HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚HTTP å®¢æˆ·ç«¯ç”¨äºå‘é€è¯·æ±‚åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶æ¥æ”¶å“åº”ã€‚è€Œå½“æˆ‘ä»¬è°ˆè®º<code>Event: &#39;response&#39;</code>æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯å®¢æˆ·ç«¯éƒ¨åˆ†ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ å‘ä¸€ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼ˆæ¯”å¦‚é€šè¿‡<code>http.get()</code>æˆ–<code>http.request()</code>æ–¹æ³•ï¼‰ï¼ŒNode.js ä¼šå¼‚æ­¥åœ°å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚è¿™æ„å‘³ç€ç¨‹åºä¼šç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œä¸ä¼šç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå½“æœåŠ¡å™¨çš„å“åº”åˆ°è¾¾æ—¶ï¼Œä½ çš„ç¨‹åºå¦‚ä½•çŸ¥é“å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡ç›‘å¬<code>response</code>äº‹ä»¶ã€‚</p><h3 id="event-response-1" tabindex="-1"><a class="header-anchor" href="#event-response-1"><span><code>Event: &#39;response&#39;</code></span></a></h3><p>å½“æœåŠ¡å™¨å›å¤å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œ<code>response</code>äº‹ä»¶è¢«è§¦å‘ï¼Œå®ƒè¿”å›ä¸€ä¸ª<code>http.IncomingMessage</code>å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä»£è¡¨æœåŠ¡å™¨çš„å“åº”ä¿¡æ¯ã€‚ä½ å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶æ¥è·å–å’Œå¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-åŸºæœ¬çš„-get-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åŸºæœ¬çš„-get-è¯·æ±‚"><span>ç¤ºä¾‹ 1ï¼šåŸºæœ¬çš„ GET è¯·æ±‚</span></a></h4><p>å‡è®¾æˆ‘ä»¬æƒ³ä»æŸä¸ª API è·å– JSON æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>http.get()</code>ç®€åŒ–è¯·æ±‚è¿‡ç¨‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æŒ‡å®šè¯·æ±‚çš„URL</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> url</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://api.example.com/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">resp</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ¥æ”¶æ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘é€äº†ä¸€ä¸ª GET è¯·æ±‚åˆ°ç›®æ ‡ URLã€‚ä¸€æ—¦æœåŠ¡å™¨å“åº”ï¼Œ<code>response</code>äº‹ä»¶è¢«è§¦å‘ï¼Œç„¶åæ‰§è¡Œä¼ é€’ç»™<code>http.get()</code>çš„å›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬é€šè¿‡ç›‘å¬<code>data</code>äº‹ä»¶æ¥é€å—æ¥æ”¶æ•°æ®ï¼Œæœ€ååœ¨<code>end</code>äº‹ä»¶å‘ç”Ÿåå¤„ç†æ•´åˆåçš„æ•°æ®ã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨http-request" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨http-request"><span>ç¤ºä¾‹ 2ï¼šä½¿ç”¨<code>http.request()</code></span></a></h4><p>æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦æ›´å¤šæ§åˆ¶ï¼Œæ¯”å¦‚è®¾ç½® HTTP å¤´æˆ–è€…å‘é€ POST è¯·æ±‚ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨<code>http.request()</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¯·æ±‚é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">api.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/submit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">resp</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Response from server: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">problem with request: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å†™å…¥æ•°æ®åˆ°è¯·æ±‚ä¸»ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> key</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ª POST è¯·æ±‚ï¼ŒåŒ…æ‹¬äº†è¯·æ±‚å¤´çš„å®šä¹‰ã€‚é€šè¿‡ç›‘å¬<code>response</code>äº‹ä»¶ï¼Œæˆ‘ä»¬å¤„ç†äº†æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</p><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1"><span>å°ç»“</span></a></h3><p><code>Event: &#39;response&#39;</code>åœ¨ Node.js çš„ HTTP å®¢æˆ·ç«¯ç¼–ç¨‹ä¸­éå¸¸é‡è¦ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿå¼‚æ­¥åœ°å¤„ç†æœåŠ¡å™¨çš„å“åº”ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°æ¥æ”¶å’Œå¤„ç†æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ï¼Œæ— è®ºæ˜¯å¤„ç† JSONã€ä¸‹è½½æ–‡ä»¶è¿˜æ˜¯å…¶ä»–ç±»å‹çš„æ•°æ®äº¤æ¢ã€‚ç†è§£å’Œè¿ç”¨å¥½è¿™ä¸€æœºåˆ¶ï¼Œå¯¹äºå¼€å‘ Web åº”ç”¨å’ŒæœåŠ¡æ¥è¯´è‡³å…³é‡è¦ã€‚</p><h3 id="event-socket" tabindex="-1"><a class="header-anchor" href="#event-socket"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-socket" target="_blank" rel="noopener noreferrer">Event: &#39;socket&#39;</a></span></a></h3><p>äº†è§£ Node.js ä¸­çš„ <code>&#39;socket&#39;</code> äº‹ä»¶ï¼Œé¦–å…ˆå¾—çŸ¥é“ Node.js æ˜¯ä»€ä¹ˆã€‚Node.js æ˜¯ä¸€ä¸ªèƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript çš„å¹³å°ï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚å®ƒéå¸¸é€‚åˆå¤„ç†é«˜å¹¶å‘ã€I/O å¯†é›†å‹çš„åº”ç”¨ï¼Œæ¯”å¦‚å®æ—¶é€šè®¯åº”ç”¨æˆ–ç½‘ç»œæœåŠ¡å™¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ&#39;socket&#39; é€šå¸¸æŒ‡çš„æ˜¯ç½‘ç»œå¥—æ¥å­—ï¼Œè¿™æ˜¯ä¸€ç§å…è®¸ç½‘ç»œä¸­ä¸åŒæœºå™¨ä¸Šçš„è¿›ç¨‹ï¼ˆç¨‹åºè¿è¡Œå®ä¾‹ï¼‰è¿›è¡ŒåŒå‘é€šä¿¡çš„æŠ€æœ¯ã€‚HTTP æœåŠ¡å°±æ˜¯å»ºç«‹åœ¨ TCP/IP å¥—æ¥å­—ä¹‹ä¸Šçš„ï¼Œè€Œ Node.js å…è®¸ä½ é€šè¿‡ç›‘å¬ä¸åŒçš„äº‹ä»¶æ¥å¤„ç†è¿™äº›åº•å±‚çš„ç½‘ç»œæ“ä½œã€‚</p><h3 id="event-socket-1" tabindex="-1"><a class="header-anchor" href="#event-socket-1"><span>Event: &#39;socket&#39;</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„ HTTP æ¨¡å—æ–‡æ¡£ä¸­ï¼Œ<code>&#39;socket&#39;</code> äº‹ä»¶æ˜¯å½“ä¸€ä¸ªæ–°çš„ TCP æµï¼ˆå³â€œsocketâ€ï¼‰è¢«åˆ›å»ºä¸”å‡†å¤‡ä¸å®¢æˆ·ç«¯é€šä¿¡æ—¶ç”±æœåŠ¡å™¨è§¦å‘çš„ã€‚æ¯æ¬¡å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚ç›‘å¬è¿™ä¸ªäº‹ä»¶è®©ä½ èƒ½ç›´æ¥è®¿é—®åº•å±‚çš„é€šä¿¡æ¸ é“ï¼ˆå³ socketï¼‰ï¼Œä»è€Œå¯ä»¥å¯¹å…¶è¿›è¡Œå„ç§ä½çº§æ“ä½œï¼Œæ¯”å¦‚ç›‘è§†æ•°æ®ä¼ è¾“ã€è®¾ç½®è¶…æ—¶æ—¶é—´æˆ–ç”šè‡³æ˜¯ç›´æ¥å†™å…¥æˆ–è¯»å–æ•°æ®ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-6"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><p><strong>1. ç›‘æ§æ•°æ®ä¼ è¾“</strong></p><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æœåŠ¡ï¼Œå¹¶å¸Œæœ›è·Ÿè¸ªæ¯ä¸ªç”¨æˆ·ä¸Šä¼ çš„æ•°æ®é‡ã€‚é€šè¿‡ç›‘å¬ <code>&#39;socket&#39;</code> äº‹ä»¶ï¼Œä½ å¯ä»¥è·å¾—ä¸æ¯ä¸ªä¸Šä¼ æ“ä½œç›¸å…³è”çš„ socketï¼Œç„¶åç›‘è§†é€šè¿‡è¯¥ socket ä¼ è¾“çš„æ•°æ®é‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†è¯·æ±‚...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;socket&#39; äº‹ä»¶æ¥è®¿é—®åº•å±‚ socket</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">socket</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> uploadedBytes</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    uploadedBytes</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">uploadedBytes</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> bytes of data.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Upload completed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. è®¾ç½® Socket è¶…æ—¶</strong></p><p>åœ¨å¦ä¸€ä¸ªåœºæ™¯ä¸­ï¼Œä½ å¯èƒ½æƒ³è¦ç¡®ä¿ä½ çš„æœåŠ¡å™¨ä¸ä¼šå› ä¸ºä¸€äº›é•¿æ—¶é—´æŒ‚èµ·çš„è¿æ¥è€Œèµ„æºå ç”¨è¿‡å¤šã€‚é€šè¿‡ç›‘å¬ <code>&#39;socket&#39;</code> äº‹ä»¶ï¼Œä½ å¯ä»¥è·å–åˆ°æ¯ä¸€ä¸ªæ–°çš„ socket è¿æ¥å¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">socket</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½® 30 ç§’æ— æ´»åŠ¨åˆ™è‡ªåŠ¨æ–­å¼€è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">30000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Socket has timed out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½åˆ©ç”¨äº† <code>&#39;socket&#39;</code> äº‹ä»¶æ¥è®¿é—®å’Œæ§åˆ¶åº•å±‚çš„ç½‘ç»œè¿æ¥ã€‚è¿™å±•ç¤ºäº† Node.js æä¾›çš„å¼ºå¤§åŠŸèƒ½ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿç²¾ç»†åœ°æ§åˆ¶ç½‘ç»œé€šä¿¡ï¼Œä¼˜åŒ–åº”ç”¨æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ã€‚</p><h3 id="event-timeout" tabindex="-1"><a class="header-anchor" href="#event-timeout"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-timeout" target="_blank" rel="noopener noreferrer">Event: &#39;timeout&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>Event: &#39;timeout&#39;</code>æ˜¯ä¸€ä¸ªä¸ HTTP æ¨¡å—ç›¸å…³çš„äº‹ä»¶ã€‚å½“æˆ‘ä»¬åœ¨ Node.js ä¸­ä½¿ç”¨ HTTP æ¨¡å—åˆ›å»ºæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ï¼Œ<code>&#39;timeout&#39;</code>äº‹ä»¶å¸®åŠ©æˆ‘ä»¬ç®¡ç†å’Œå“åº”ç½‘ç»œè¯·æ±‚ä¸­çš„è¶…æ—¶æƒ…å†µã€‚</p><h3 id="åŸºç¡€è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€è§£é‡Š"><span>åŸºç¡€è§£é‡Š</span></a></h3><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œè¶…æ—¶æŒ‡çš„æ˜¯å½“ä½ å°è¯•è¿æ¥åˆ°å¦ä¸€å°è®¡ç®—æœºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ HTTP è¯·æ±‚ç½‘é¡µï¼‰æ—¶ï¼Œç­‰å¾…å¯¹æ–¹å“åº”æ‰€è®¾å®šçš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘è¶…æ—¶ï¼Œæ­¤æ—¶å¯ä»¥æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚é‡è¯•è¯·æ±‚ã€æŠ¥å‘Šé”™è¯¯ç»™ç”¨æˆ·ç­‰ã€‚</p><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>&#39;timeout&#39;</code>äº‹ä»¶å°±æ˜¯ç”¨æ¥ç›‘å¬è¿™ç§è¶…æ—¶æƒ…å†µçš„ã€‚æ— è®ºæ˜¯æœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œåœ¨è¶…æ—¶åéƒ½å¯ä»¥é€šè¿‡ç»‘å®š<code>&#39;timeout&#39;</code>äº‹ä»¶çš„å¤„ç†å™¨ï¼ˆä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œæ¥å®šä¹‰åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„æ“ä½œã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h3><ol><li><p><strong>HTTP æœåŠ¡å™¨è¶…æ—¶å¤„ç†ï¼š</strong></p><p>å½“ä½ åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šå¸Œæœ›æ§åˆ¶å¤„ç†è¯·æ±‚çš„æ—¶é—´ä¸è¦å¤ªé•¿ï¼Œä»¥ç¡®ä¿æœåŠ¡å™¨èµ„æºèƒ½æœ‰æ•ˆåˆ©ç”¨ï¼Œé˜²æ­¢æŸäº›è¯·æ±‚å› ä¸ºå„ç§åŸå› è€—æ—¶è¿‡é•¿è€Œå½±å“å…¶ä»–è¯·æ±‚çš„å¤„ç†ã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä¸ºæœåŠ¡å™¨è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¹¶é€šè¿‡ç›‘å¬<code>&#39;timeout&#39;</code>äº‹ä»¶æ¥å¤„ç†è¶…æ—¶åçš„é€»è¾‘ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º5000æ¯«ç§’ï¼ˆ5ç§’ï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">timeout</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 5000</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è¶…æ—¶äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚è¶…æ—¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¤„ç†è¶…æ—¶é€»è¾‘</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å¯ä»¥å…³é—­socketï¼Œå‘é€è¶…æ—¶å“åº”ç­‰</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚è¶…æ—¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>HTTP å®¢æˆ·ç«¯è¯·æ±‚è¶…æ—¶ï¼š</strong></p><p>å½“ä½¿ç”¨ HTTP æ¨¡å—å»è¯·æ±‚å¤–éƒ¨èµ„æºæ—¶ï¼Œå¯èƒ½ç”±äºç½‘ç»œé—®é¢˜æˆ–ç›®æ ‡æœåŠ¡å™¨çš„å»¶è¿Ÿï¼Œå¯¼è‡´è¯·æ±‚é•¿æ—¶é—´æœªå¾—åˆ°å“åº”ã€‚è¿™æ—¶ï¼Œå¯ä»¥ä¸ºè¯·æ±‚è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¹¶åœ¨è¶…æ—¶åè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/some/path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸å“åº”å¤„ç†</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¯·æ±‚è¶…æ—¶æ—¶é—´è®¾ç½®</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚è¶…æ—¶ï¼Œå¤„ç†é€»è¾‘</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä¸­æ–­è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2"><span>å°ç»“</span></a></h3><p>é€šè¿‡ç›‘å¬å¹¶å¤„ç†<code>&#39;timeout&#39;</code>äº‹ä»¶ï¼Œä½ å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œç®¡ç† Node.js ä¸­ HTTP é€šä¿¡ä¸­çš„è¶…æ—¶æƒ…å†µï¼Œæ— è®ºæ˜¯ä½œä¸ºæœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯ã€‚è¿™å¯¹äºæ„å»ºå¯é ä¸”ç”¨æˆ·å‹å¥½çš„åº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</p><h3 id="event-upgrade" tabindex="-1"><a class="header-anchor" href="#event-upgrade"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-upgrade" target="_blank" rel="noopener noreferrer">Event: &#39;upgrade&#39;</a></span></a></h3><p>Node.js ä¸­çš„ <code>&#39;upgrade&#39;</code> äº‹ä»¶æ˜¯ä¸ HTTP æœåŠ¡å™¨æœ‰å…³çš„ä¸€ä¸ªç‰¹æ®Šäº‹ä»¶ï¼Œå®ƒé€šå¸¸ç”¨äºåœ¨å®¢æˆ·ç«¯è¦æ±‚å‡çº§è¿æ¥æ—¶è¢«è§¦å‘ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å¹¶ä¸”æƒ³è¦æ”¯æŒåƒ WebSocket è¿™æ ·çš„åè®®æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œå› ä¸º WebSocket éœ€è¦ä»æ ‡å‡†çš„ HTTP åè®®&quot;å‡çº§&quot;åˆ° WebSocket åè®®ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹â€œå‡çº§â€æ˜¯ä»€ä¹ˆæ„æ€ã€‚åœ¨ HTTP/1.1 åè®®ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘é€ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚å¤´<code>Upgrade</code>ç»™æœåŠ¡å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªå‘Šè¯‰æœåŠ¡å™¨ï¼šâ€œæˆ‘æƒ³è¦åˆ‡æ¢åˆ°ä¸€ä¸ªä¸åŒçš„åè®®â€çš„ä¿¡å·ã€‚å¦‚æœæœåŠ¡å™¨æ”¯æŒè¿™ç§å‡çº§ï¼Œå®ƒä¼šå“åº”ä¸€ä¸ªçŠ¶æ€ç  <code>101 Switching Protocols</code> çš„å“åº”ï¼Œç„¶åä¸¤è€…ä¹‹é—´çš„è¿æ¥å°±ä¼šä» HTTP åè®®åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåè®®ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª Node.js ä¸­ä½¿ç”¨ <code>http</code> æ¨¡å—å¤„ç† <code>&#39;upgrade&#39;</code> äº‹ä»¶çš„å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸çš„ HTTP è¯·æ±‚ä¼šåœ¨è¿™é‡Œå¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;upgrade&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">upgrade</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> head</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª &#39;upgrade&#39; è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«è§¦å‘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œä½ å¯ä»¥æ ¹æ®è¯·æ±‚æ¥å†³å®šæ˜¯å¦è¿›è¡Œåè®®å‡çº§</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">upgrade</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">websocket</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // åœ¨è¿™é‡Œå¤„ç† WebSocket æ¡æ‰‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾æˆ‘ä»¬å·²ç»å®Œæˆäº† WebSocket æ¡æ‰‹çš„æ­¥éª¤ï¼Œ</span></span>
<span class="line"><span style="color:#616E88;">    // ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹é€šè¿‡ socket å‘é€å’Œæ¥æ”¶æ•°æ®äº†</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">HTTP/1.1 101 Switching Protocols</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span></span>
<span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">Upgrade: websocket</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span></span>
<span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">Connection: Upgrade</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span></span>
<span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯äº†</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™ä¼šæŠŠæ¥æ”¶åˆ°çš„æ•°æ®åŸæ ·è¿”å›ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœä¸æ˜¯è¯·æ±‚çš„ WebSocket å‡çº§ï¼Œåˆ™å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTTP/1.1 400 Bad Request</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æŸä¸ªç«¯å£ä¸Šçš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŸºç¡€çš„ HTTP æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿç›‘å¬äº† <code>&#39;upgrade&#39;</code> äº‹ä»¶ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚ WebSocket å‡çº§æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†è¯·æ±‚å¤´æ¥ç¡®è®¤å®ƒç¡®å®æ˜¯ä¸€ä¸ª WebSocket å‡çº§è¯·æ±‚ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°±å‘é€ä¸€ä¸ª 101 å“åº”ç æ¥è¿›è¡Œæ¡æ‰‹ï¼Œå¹¶é€šè¿‡ <code>socket</code> å¯¹è±¡ä¸å®¢æˆ·ç«¯ä¿æŒé€šä¿¡ã€‚å¦‚æœè¯·æ±‚çš„å‡çº§ä¸æ˜¯æˆ‘ä»¬æ”¯æŒçš„ç±»å‹ï¼Œæ¯”å¦‚ä¸æ˜¯ WebSocketï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¿”å›ä¸€ä¸ªé”™è¯¯çš„å“åº”å¹¶å…³é—­è¿æ¥ã€‚</p><p>è¿™ä¸ª <code>&#39;upgrade&#39;</code> äº‹ä»¶æ˜¯å»ºç«‹æ›´å¤æ‚åè®®ï¼ˆä¾‹å¦‚ WebSocketï¼‰é€šä¿¡çš„å…³é”®æ‰€åœ¨ï¼Œè€Œä¸”æ˜¯å®ç°å…¨åŒå·¥é€šä¿¡çš„åŸºç¡€ï¼Œå³å…è®¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åŒæ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</p><h3 id="request-abort" tabindex="-1"><a class="header-anchor" href="#request-abort"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestabort" target="_blank" rel="noopener noreferrer">request.abort()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒå…è®¸ä½ ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ç”¨äºå¤„ç† HTTP è¯·æ±‚å’Œå“åº”çš„å·¥å…·ã€‚è€Œ <code>request.abort()</code> æ–¹æ³•æ˜¯ä¸ HTTP è¯·æ±‚ç›¸å…³è”çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚</p><h3 id="åŸºæœ¬è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è§£é‡Š"><span>åŸºæœ¬è§£é‡Š</span></a></h3><p><code>request.abort()</code> æ–¹æ³•æ˜¯ç”¨æ¥ç»ˆæ­¢æ­£åœ¨è¿›è¡Œçš„ HTTP è¯·æ±‚çš„ã€‚å½“ä½ å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚åï¼Œå‡ºäºå„ç§åŸå› ï¼ˆæ¯”å¦‚è¶…æ—¶ã€ç”¨æˆ·å–æ¶ˆæ“ä½œç­‰ï¼‰ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦åœ¨è¯·æ±‚å®Œæˆå‰ç»ˆæ­¢è¿™ä¸ªè¯·æ±‚ã€‚è¿™æ—¶ï¼Œå°±å¯ä»¥è°ƒç”¨ <code>request.abort()</code> æ–¹æ³•æ¥å®ç°ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ"><span>å¦‚ä½•å·¥ä½œ</span></a></h3><p>å½“ä½ è°ƒç”¨ <code>request.abort()</code> æ–¹æ³•æ—¶ï¼ŒNode.js ä¼šç«‹å³åœæ­¢å‘é€è¯·æ±‚ã€‚å¦‚æœè¯·æ±‚å·²ç»éƒ¨åˆ†æˆ–å…¨éƒ¨å‘é€åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å¯èƒ½ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªä¸å®Œæ•´çš„è¯·æ±‚ã€‚ä»å®¢æˆ·ç«¯çš„è§’åº¦çœ‹ï¼Œè¯·æ±‚è¢«è§†ä¸ºå¤±è´¥ï¼Œç›¸å…³çš„å›è°ƒå‡½æ•°æˆ–äº‹ä»¶å°†ä¼šè¢«è§¦å‘ï¼Œä¾‹å¦‚â€œerrorâ€äº‹ä»¶ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><strong>è¶…æ—¶æ§åˆ¶</strong>: å‡è®¾ä½ ä½¿ç”¨ Node.js å¼€å‘äº†ä¸€ä¸ªç½‘ç«™ï¼Œåœ¨ç”¨æˆ·è¿›è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œä½ éœ€è¦å‘å¦ä¸€ä¸ªæœåŠ¡å‘é€ HTTP è¯·æ±‚ã€‚å¦‚æœè¿™ä¸ªæœåŠ¡å“åº”å¾ˆæ…¢ï¼Œä½ å¯èƒ½ä¸æƒ³è®©ç”¨æˆ·ç­‰å¤ªä¹…ã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œä¸€æ—¦è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå°±è‡ªåŠ¨è°ƒç”¨ <code>request.abort()</code> æ¥ç»ˆæ­¢è¯·æ±‚ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPè¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º5ç§’</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç»ˆæ­¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ç”¨æˆ·å–æ¶ˆæ“ä½œ</strong>: å¦‚æœä½ çš„åº”ç”¨æœ‰ä¸€ä¸ªè¾ƒé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œç”¨æˆ·å¯èƒ½ä¼šé€‰æ‹©å–æ¶ˆè¿™ä¸ªæ“ä½œã€‚è¿™æ—¶ï¼Œä½ åŒæ ·å¯ä»¥ä½¿ç”¨ <code>request.abort()</code> æ¥åœæ­¢è¿™ä¸ªä»»åŠ¡ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fileStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/large/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/octet-stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ç”¨æˆ·ç‚¹å‡»äº†å–æ¶ˆæŒ‰é’®çš„äº‹ä»¶å¤„ç†å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onCancelUpload</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç”¨æˆ·å–æ¶ˆä¸Šä¼ ï¼Œç»ˆæ­¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>è°ƒç”¨ <code>request.abort()</code> åï¼Œå¦‚æœè¯·æ±‚å·²ç»å‘å‡ºå»äº†ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å¯èƒ½å·²ç»å¼€å§‹å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚ç»ˆæ­¢è¯·æ±‚å¹¶ä¸æ„å‘³ç€æœåŠ¡å™¨ä¸Šçš„æ“ä½œä¹Ÿä¼šåœæ­¢ï¼Œä»…ä»…æ˜¯å®¢æˆ·ç«¯åœæ­¢ç­‰å¾…å“åº”ã€‚</li><li><code>request.abort()</code> è§¦å‘çš„é”™è¯¯æ˜¯å®¢æˆ·ç«¯å¼•å‘çš„ï¼Œéœ€è¦åœ¨ä»£ç ä¸­é€šè¿‡ç›‘å¬é”™è¯¯äº‹ä»¶æ¥å¤„ç†ã€‚</li></ul><p>é€šè¿‡ä»¥ä¸Šç¤ºä¾‹ï¼Œä½ åº”è¯¥å¯¹ <code>request.abort()</code> æ–¹æ³•æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚è®°ä½ï¼Œåˆç†åˆ©ç”¨æ­¤æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶ HTTP è¯·æ±‚ï¼Œæå‡åº”ç”¨çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ã€‚</p><h3 id="request-aborted" tabindex="-1"><a class="header-anchor" href="#request-aborted"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestaborted" target="_blank" rel="noopener noreferrer">request.aborted</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œå¤„ç† HTTP è¯·æ±‚æ˜¯å¸¸è§çš„ä»»åŠ¡ä¹‹ä¸€ã€‚ç†è§£å¦‚ä½•æ£€æµ‹å’Œå“åº”å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸­æ–­ï¼ˆæˆ–ç»ˆæ­¢ï¼‰å¯¹äºæä¾›å¯é çš„æœåŠ¡éå¸¸é‡è¦ã€‚</p><h3 id="request-aborted-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#request-aborted-ç®€ä»‹"><span><code>request.aborted</code> ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“æˆ‘ä»¬è°ˆåˆ° HTTP æ¨¡å—æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‡çš„æ˜¯ç”¨äºåˆ›å»º web æœåŠ¡å™¨çš„ APIã€‚<code>request.aborted</code>å±æ€§ç”¨äºæ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦å·²ç»ä¸­æ–­äº†è¯·æ±‚ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå®ƒè¡¨æ˜è‡ªè¯·æ±‚å¼€å§‹ä»¥æ¥ï¼Œå®¢æˆ·ç«¯æ˜¯å¦å·²ç»å‘é€äº†ä¸­æ–­ä¿¡å·ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·å…³é—­äº†æµè§ˆå™¨çª—å£æˆ–ç‚¹å‡»äº†â€œåœæ­¢â€æŒ‰é’®ï¼‰ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„ HTTP æ¨¡å—åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚æŸä¸ªèµ„æºæ—¶ï¼ŒæœåŠ¡å™¨å¼€å§‹å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å†³å®šå–æ¶ˆè¿™ä¸ªè¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œè¯·æ±‚è¢«â€œç»ˆæ­¢â€äº†ï¼‰ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡æ£€æŸ¥<code>request.aborted</code>å±æ€§æ¥äº†è§£è¿™ä¸€ç‚¹ï¼Œå¹¶æ®æ­¤ä½œå‡ºç›¸åº”çš„ååº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥è¯·æ±‚æ˜¯å¦å·²ç»è¢«å®¢æˆ·ç«¯ä¸­æ–­</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">aborted</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request was aborted by the client</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æ­£å¸¸å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-è¶…æ—¶å“åº”" tabindex="-1"><a class="header-anchor" href="#_1-è¶…æ—¶å“åº”"><span>1. è¶…æ—¶å“åº”ï¼š</span></a></h4><p>è®©æˆ‘ä»¬è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä½ çš„æœåŠ¡å™¨æ­£åœ¨å¤„ç†ä¸€ä¸ªç‰¹åˆ«è€—æ—¶çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚ä»æ•°æ®åº“æ£€ç´¢å¤§é‡æ•°æ®ï¼‰ã€‚å€˜è‹¥å®¢æˆ·ç«¯åœ¨è¿™ä¸ªé•¿æ—¶é—´çš„ç­‰å¾…è¿‡ç¨‹ä¸­å˜å¾—ä¸è€çƒ¦å¹¶å–æ¶ˆäº†è¯·æ±‚ï¼Œé€šè¿‡æ£€æŸ¥<code>request.aborted</code>ï¼ŒæœåŠ¡å™¨å¯ä»¥ç«‹å³åœæ­¢è¿›ä¸€æ­¥çš„å¤„ç†ï¼Œä»è€ŒèŠ‚çœæœåŠ¡å™¨èµ„æºã€‚</p><h4 id="_2-æ•°æ®æµä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®æµä¼ è¾“"><span>2. æ•°æ®æµä¼ è¾“ï¼š</span></a></h4><p>æƒ³è±¡ä½ çš„æœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä¼ è¾“ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚å¦‚æœåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ç”¨æˆ·å–æ¶ˆäº†ä¸‹è½½ï¼Œ<code>request.aborted</code>ä¼šå˜ä¸º<code>true</code>ã€‚æœåŠ¡å™¨å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¿¡å·æ¥åœæ­¢å‘é€æ–‡ä»¶çš„å‰©ä½™éƒ¨åˆ†ã€‚</p><h4 id="_3-ç”¨æˆ·ä½“éªŒä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-ç”¨æˆ·ä½“éªŒä¼˜åŒ–"><span>3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼š</span></a></h4><p>åœ¨æ„å»ºå®æ—¶äº¤äº’å¼ Web åº”ç”¨æ—¶ï¼Œç”¨æˆ·å¯èƒ½å¿«é€Ÿåœ°å‘èµ·å¹¶å–æ¶ˆå¤šä¸ªè¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥æŸ¥è¯¢æ¡ä»¶æ—¶ï¼‰ã€‚é€šè¿‡è¯†åˆ«ä¸­æ–­çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯ä»¥é¿å…å¯¹è¿™äº›æ— ç”¨è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°åˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œæå‡æ•´ä½“çš„ç”¨æˆ·ä½“éªŒã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>request.aborted</code>æ˜¯ Node.js HTTP API ä¸­ä¸€ä¸ªç®€å•ä½†éå¸¸æœ‰ç”¨çš„å±æ€§ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…è¯†åˆ«å’Œå¤„ç†é‚£äº›è¢«å®¢æˆ·ç«¯ä¸­æ–­çš„è¯·æ±‚ï¼Œä¿è¯äº†æœåŠ¡å™¨èµ„æºçš„é«˜æ•ˆåˆ©ç”¨å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p><h3 id="request-connection" tabindex="-1"><a class="header-anchor" href="#request-connection"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestconnection" target="_blank" rel="noopener noreferrer">request.connection</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js ç‰¹åˆ«é€‚åˆå¤„ç†é«˜å¹¶å‘ã€I/O å¯†é›†å‹çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>request.connection</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå¼•ç”¨äº†åº•å±‚çš„ TCP è¿æ¥å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æä¾›äº†å…³äºç½‘ç»œè¿æ¥çš„ä¸€äº›è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚è¿æ¥çš„è¿œç¨‹åœ°å€ï¼ˆå®¢æˆ·ç«¯çš„ IP åœ°å€ï¼‰ã€ç«¯å£ç­‰ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Node.js çš„è¾ƒæ–°ç‰ˆæœ¬ä¸­ï¼Œ<code>request.connection</code> è¢«è§†ä¸ºé—ç•™ï¼ˆlegacyï¼‰ä¸”ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºç°åœ¨æœ‰äº†æ›´ç°ä»£ä¸”æ ‡å‡†åŒ–çš„æ–¹å¼æ¥è·å–åŒæ ·çš„ä¿¡æ¯ï¼Œå³é€šè¿‡ <code>request.socket</code>ã€‚</p><h3 id="å®é™…è¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨-1"><span>å®é™…è¿ç”¨</span></a></h3><p>è™½ç„¶ <code>request.connection</code> ç›®å‰ä¸æ¨èä½¿ç”¨ï¼Œä½†ç†è§£å…¶æ¦‚å¿µå¯¹äºæ–°æ‰‹æ¥è¯´ä»ç„¶æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ä¸‹é¢ï¼Œæˆ‘å°†æ¼”ç¤ºä¸€äº›ä½¿ç”¨ç°ä»£æ›¿ä»£æ–¹æ³• <code>request.socket</code> æ¥è¾¾åˆ°ç›¸ä¼¼ç›®çš„çš„ä¾‹å­ã€‚</p><h4 id="_1-è·å–å®¢æˆ·ç«¯çš„-ip-åœ°å€" tabindex="-1"><a class="header-anchor" href="#_1-è·å–å®¢æˆ·ç«¯çš„-ip-åœ°å€"><span>1. è·å–å®¢æˆ·ç«¯çš„ IP åœ°å€</span></a></h4><p>å½“ä½ å¼€å‘ä¸€ä¸ªéœ€è¦çŸ¥é“å®¢æˆ·ç«¯ IP åœ°å€çš„ Web åº”ç”¨æ—¶ï¼ˆä¾‹å¦‚ï¼Œè®°å½•è®¿é—®æ—¥å¿—ã€åœ°ç†ä½ç½®å®šä½ã€é™åˆ¶ç‰¹å®šåŒºåŸŸçš„è®¿é—®ç­‰ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ request.socket ä»£æ›¿å·²ç»è¿‡æ—¶çš„ request.connection</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> clientIP</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯çš„ IP åœ°å€æ˜¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientIP</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä½ çš„ IP åœ°å€æ˜¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientIP</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-è·å–è¯·æ±‚çš„ç«¯å£å·" tabindex="-1"><a class="header-anchor" href="#_2-è·å–è¯·æ±‚çš„ç«¯å£å·"><span>2. è·å–è¯·æ±‚çš„ç«¯å£å·</span></a></h4><p>äº†è§£ä»å“ªä¸ªç«¯å£æ”¶åˆ°çš„è¯·æ±‚å¯èƒ½å¯¹æŸäº›åº”ç”¨ç¨‹åºå¾ˆé‡è¦ï¼Œå°¤å…¶æ˜¯é‚£äº›è¿è¡Œåœ¨å¤šä¸ªç«¯å£å¹¶éœ€è¦åŒºåˆ†è¯·æ±‚æ¥æºçš„åº”ç”¨ç¨‹åºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> clientPort</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚æ¥è‡ªç«¯å£: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientPort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä½ çš„è¯·æ±‚æ¥è‡ªç«¯å£: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientPort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p>å°½ç®¡ <code>request.connection</code> å·²ä¸å†æ¨èä½¿ç”¨ï¼Œä½†äº†è§£å¦‚ä½•æ“ä½œå’Œåˆ©ç”¨åº•å±‚ TCP è¿æ¥å¯¹è±¡æ¥è·å–æœ‰å…³ç½‘ç»œè¿æ¥çš„ä¿¡æ¯ä»ç„¶æ˜¯å­¦ä¹ ç½‘ç»œç¼–ç¨‹çš„é‡è¦éƒ¨åˆ†ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®ä½¿ç”¨ <code>request.socket</code> æ¥è·å–ç±»ä¼¼çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒæ˜¯å®˜æ–¹æ¨èçš„ã€æ›´æ ‡å‡†åŒ–çš„æ–¹æ³•ã€‚</p><h3 id="request-cork" tabindex="-1"><a class="header-anchor" href="#request-cork"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestcork" target="_blank" rel="noopener noreferrer">request.cork()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹ Node.js ä¸­ <code>request.cork()</code> æ–¹æ³•çš„ä½¿ç”¨å’Œä½œç”¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-request-cork" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-request-cork"><span>ä»€ä¹ˆæ˜¯ <code>request.cork()</code>ï¼Ÿ</span></a></h3><p>Node.js ä¸­çš„ <code>request.cork()</code> æ–¹æ³•æ˜¯é’ˆå¯¹æµï¼ˆstreamï¼‰ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚åœ¨ Node.js çš„ <code>http</code> æ¨¡å—ä¸­ï¼Œå®ƒé€šå¸¸è¢«ç”¨äºæš‚æ—¶é˜»æ­¢ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯å¯å†™æµï¼‰å‘é€æ•°æ®åˆ°åº•å±‚ç³»ç»Ÿï¼Œç›´åˆ°è°ƒç”¨ <code>request.uncork()</code> æˆ–è€… <code>request.end()</code> æ–¹æ³•ã€‚è¿™æ ·åšå¯ä»¥æœ‰æ•ˆåœ°å°†å¤šä¸ªå°çš„å†™æ“ä½œæ‰¹é‡æˆä¸€ä¸ªå¤§çš„å†™æ“ä½œï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ-1"><span>å¦‚ä½•å·¥ä½œï¼Ÿ</span></a></h3><p>å½“ä½ è°ƒç”¨ <code>request.cork()</code> æ–¹æ³•æ—¶ï¼ŒNode.js ä¼šæš‚åœæ•°æ®çš„å‘é€å¹¶ä¸”å¼€å§‹ç¼“å­˜éšåçš„å†™æ“ä½œã€‚ç„¶åï¼Œå½“ä½ å®Œæˆäº†æ‰€æœ‰çš„å†™æ“ä½œä¹‹åï¼Œä½ å¯ä»¥è°ƒç”¨ <code>request.uncork()</code> æ–¹æ³•æ¥é‡Šæ”¾ç¼“å­˜ï¼Œå¹¶ä¸”å°†æ‰€æœ‰ç´¯ç§¯çš„æ•°æ®ä¸€æ¬¡æ€§åœ°å‘é€å‡ºå»ã€‚å¦å¤–ï¼Œå¦‚æœä½ è°ƒç”¨ <code>request.end()</code> æ–¹æ³•æ¥ç»“æŸè¯·æ±‚ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨ <code>uncork()</code>ï¼Œç¡®ä¿æ‰€æœ‰çš„æ•°æ®éƒ½è¢«å‘é€ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-3"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ï¼Œä½ éœ€è¦å‘é€å¤šä¸ªæ•°æ®ç‰‡æ®µåˆ°å¦ä¸€ç«¯ã€‚ä¸ä½¿ç”¨ <code>cork()</code> å’Œ <code>uncork()</code> å¯èƒ½å¯¼è‡´æ¯ä¸€æ¬¡ <code>write()</code> è°ƒç”¨éƒ½äº§ç”Ÿå•ç‹¬çš„ç½‘ç»œåŒ…ï¼Œè¿™å¯èƒ½æ˜¯éé«˜æ•ˆçš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ cork() æ–¹æ³•å¼€å§‹ç¼“å†²å†™æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è¿›è¡Œå¤šä¸ªå†™æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å»¶æ—¶æ“ä½œæ¨¡æ‹Ÿ</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æ›´å¤šå†™æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> This is an example.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // uncork() æ–¹æ³•è¢«è°ƒç”¨ï¼Œæ­¤æ—¶ä¹‹å‰çš„æ•°æ®ä¼šè¢«åˆå¹¶å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">uncork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç»“æŸè¯·æ±‚ï¼Œä¹Ÿä¼šå¯¼è‡´ç¼“å†²åŒºå†…çš„æ•°æ®è¢«å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> Goodbye!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡è°ƒç”¨ <code>res.cork()</code> æ¥æš‚åœæ•°æ®çš„å‘é€ã€‚åœ¨ä¸€ç³»åˆ—çš„ <code>res.write()</code> è°ƒç”¨ä¹‹åï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå»¶æ—¶ï¼Œåœ¨å»¶æ—¶ç»“æŸåè°ƒç”¨ <code>res.uncork()</code>ï¼Œè¿™æ ·å°±æŠŠæ‰€æœ‰å†™å…¥çš„æ•°æ®ä½œä¸ºä¸€ä¸ªæ›´å¤§çš„æ•°æ®å—å‘é€å‡ºå»ï¼Œè€Œä¸æ˜¯æ¯æ‰§è¡Œä¸€æ¬¡ <code>write()</code> å°±å‘é€ä¸€ä¸ªå°çš„æ•°æ®åŒ…ã€‚</p><p>è¿™ç§æ–¹æ³•åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…éœ€è¦é¢‘ç¹å†™æ“ä½œçš„åœºæ™¯ä¸‹å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘ç½‘ç»œæ‹¥å µä¸é™ä½ CPU çš„ä½¿ç”¨ï¼Œä»è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚</p><p>è®°å¾—ï¼Œæ­£ç¡®ä½¿ç”¨ <code>cork()</code> å’Œ <code>uncork()</code> æˆ–è€… <code>end()</code> æ˜¯å¾ˆé‡è¦çš„ï¼Œä»¥ä¿è¯æ•°æ®æœ€ç»ˆèƒ½å¤Ÿæ­£ç¡®çš„å‘é€å‡ºå»ï¼Œå¹¶ä¸”ä¸ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><h3 id="request-end-data-encoding-callback" tabindex="-1"><a class="header-anchor" href="#request-end-data-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestenddata-encoding-callback" target="_blank" rel="noopener noreferrer">request.end([data[, encoding]][, callback])</a></span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js æ¥å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œ<code>request.end()</code>æ–¹æ³•æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯æ ‡å¿—ç€è¯·æ±‚æ¶ˆæ¯çš„ç»“æŸã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®ƒé€šå¸¸è¢«ç”¨äºå®Œæˆè¯·æ±‚çš„å‘é€è¿‡ç¨‹ã€‚</p><p>è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹<code>request.end([data[, encoding]][, callback])</code>è¿™ä¸ªæ–¹æ³•çš„ä¸åŒéƒ¨åˆ†ï¼Œå¹¶çœ‹çœ‹æ€ä¹ˆä½¿ç”¨å®ƒï¼š</p><ol><li><p><strong>data (å¯é€‰å‚æ•°)</strong>: å½“ä½ æƒ³è¦åœ¨è¯·æ±‚çš„æœ€åå‘é€ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚ POST æˆ– PUT è¯·æ±‚çš„ä¸»ä½“ï¼Œä½ å¯ä»¥å°†è¿™äº›æ•°æ®ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™<code>end()</code>æ–¹æ³•ã€‚</p></li><li><p><strong>encoding (å¯é€‰å‚æ•°)</strong>: å¦‚æœä½ ä¼ é€’äº†æ•°æ®å¹¶ä¸”è¿™äº›æ•°æ®æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼Œä½ å¯ä»¥æŒ‡å®šå®ƒçš„ç¼–ç ï¼ˆä¾‹å¦‚ï¼š&#39;utf8&#39;ï¼‰ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šä½¿ç”¨&#39;utf8&#39;ç¼–ç ã€‚</p></li><li><p><strong>callback (å¯é€‰å‚æ•°)</strong>: ä¸€æ—¦è¯·æ±‚ç»“æŸï¼Œå¹¶ä¸”å“åº”çš„æ‰€æœ‰æ•°æ®éƒ½å·²ç»æ¥æ”¶å®Œæ¯•ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚</p></li></ol><p>ç°åœ¨ï¼Œæ¥çœ‹å‡ ä¸ªä¾‹å­è¯´æ˜è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><h3 id="ç¤ºä¾‹-1-å‘é€-get-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å‘é€-get-è¯·æ±‚"><span>ç¤ºä¾‹ 1ï¼šå‘é€ GET è¯·æ±‚</span></a></h3><p>å‡è®¾ä½ åªéœ€è¦å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ°æŸä¸ª APIï¼Œå› ä¸º GET è¯·æ±‚é€šå¸¸ä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥è°ƒç”¨<code>end()</code>è€Œä¸éœ€è¦ä¼ é€’ä»»ä½•å‚æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ±‚å‘é€åˆ°äº†&#39;<a href="http://example.com" target="_blank" rel="noopener noreferrer">http://example.com</a>&#39;ï¼Œæˆ‘ä»¬æ²¡æœ‰å‘<code>end()</code>ä¼ é€’ä»»ä½•æ•°æ®ï¼Œå› ä¸ºGETè¯·æ±‚ä¸éœ€è¦ã€‚</p><h3 id="ç¤ºä¾‹-2-å‘é€å¸¦æœ‰æ•°æ®çš„-post-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å‘é€å¸¦æœ‰æ•°æ®çš„-post-è¯·æ±‚"><span>ç¤ºä¾‹ 2ï¼šå‘é€å¸¦æœ‰æ•°æ®çš„ POST è¯·æ±‚</span></a></h3><p>å¦‚æœä½ è¦å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œä½ å¯èƒ½éœ€è¦å‘é€ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚æäº¤è¡¨å•æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> postData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">John Doe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  job</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Developer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¯·æ±‚é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/submit-form</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">byteLength</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">postData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚å¹¶ç»“æŸè¯·æ±‚æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">postData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†è¦å‘é€çš„æ•°æ®<code>postData</code>ã€‚ç„¶ååœ¨è¯·æ±‚é€‰é¡¹ä¸­è®¾ç½®äº†è¯·æ±‚ç±»å‹ä¸º POSTï¼Œå¹¶ä¸”è®¾ç½®äº†ç›¸åº”çš„è¯·æ±‚å¤´ã€‚é€šè¿‡è°ƒç”¨<code>req.write(postData)</code>å‘é€æ•°æ®ï¼Œç„¶åè°ƒç”¨<code>req.end()</code>æ¥ç»“æŸè¯·æ±‚ã€‚</p><p>å¦‚æœæƒ³åœ¨è¯·æ±‚ç»“æŸåç«‹å³æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¯ä»¥æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å·²ç»å‘é€ï¼Œç­‰å¾…æœåŠ¡å™¨å“åº”...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨è¯·æ±‚ç»“æŸåç«‹å³æ‰§è¡Œã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>request.end()</code>æ–¹æ³•åœ¨ Node.js çš„ HTTP å®¢æˆ·ç«¯è¯·æ±‚ä¸­èµ·ç€éå¸¸å…³é”®çš„ä½œç”¨ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥ç»“æŸè¯·æ±‚å¹¶å¯é€‰æ‹©æ€§åœ°å‘é€æ•°æ®ã€‚é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿç†è§£å®ƒçš„åŸºç¡€ç”¨æ³•å¹¶å¼€å§‹ä½¿ç”¨å®ƒå‘é€è‡ªå·±çš„ HTTP è¯·æ±‚äº†ã€‚</p><h3 id="request-destroy-error" tabindex="-1"><a class="header-anchor" href="#request-destroy-error"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestdestroyerror" target="_blank" rel="noopener noreferrer">request.destroy([error])</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­ <code>request.destroy([error])</code> æ–¹æ³•çš„æ¦‚å¿µå’Œç”¨æ³•ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£ <code>request.destroy([error])</code>ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®å®ƒæ˜¯å±äº Node.js çš„å“ªéƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ HTTP æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºå¤„ç† HTTP è¯·æ±‚ã€‚å½“ä½ åœ¨ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ª web æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ï¼ŒHTTP æ¨¡å—å°±ä¼šé¢‘ç¹åœ°è¢«ç”¨åˆ°ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ul><li><strong>Node.js</strong>: æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„è¿è¡Œç¯å¢ƒï¼Œå¹¿æ³›åº”ç”¨äºæ„å»ºåç«¯æœåŠ¡ï¼ˆå³ APIï¼‰ï¼Œä½¿å¾— JavaScript å¯ä»¥ä¸æ•°æ®åº“äº¤äº’ã€‚</li><li><strong>HTTP æ¨¡å—</strong>: æä¾›äº†ä¸€å¥—åˆ›å»ºæœåŠ¡å™¨å’Œå‘é€ç½‘ç»œè¯·æ±‚çš„å·¥å…·ã€‚</li></ul><h3 id="request-destroy-error-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#request-destroy-error-æ–¹æ³•"><span><code>request.destroy([error])</code> æ–¹æ³•</span></a></h3><p>æ­¤æ–¹æ³•ç”¨äºç«‹å³ç»ˆæ­¢ä¸€ä¸ª HTTP è¯·æ±‚ã€‚åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼ˆ<code>error</code>ï¼‰ï¼Œè¿™é€šå¸¸ç”¨äºè¡¨ç¤ºä¸ºä»€ä¹ˆè¯·æ±‚è¢«ç»ˆæ­¢ã€‚</p><h4 id="å‚æ•°-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-2"><span>å‚æ•°</span></a></h4><ul><li><code>error</code> (å¯é€‰): é”™è¯¯å¯¹è±¡ï¼ŒæŒ‡ç¤ºç»ˆæ­¢è¯·æ±‚çš„åŸå› ã€‚</li></ul><h4 id="è¿”å›å€¼-2" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-2"><span>è¿”å›å€¼</span></a></h4><ul><li>è°ƒç”¨æ­¤æ–¹æ³•ä¼šè¿”å›è¯·æ±‚ (<code>request</code>) å¯¹è±¡æœ¬èº«ï¼Œå…è®¸é“¾å¼è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-4"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>è¶…æ—¶ç»ˆæ­¢è¯·æ±‚</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»å¤–éƒ¨ API è·å–æ•°æ®ã€‚å¦‚æœè¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ä¸€å®šæ—¶é—´åè‡ªåŠ¨ç»ˆæ­¢è¯¥è¯·æ±‚ä»¥é¿å…æ— é™ç­‰å¾…ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸å¤„ç†å“åº”...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º3ç§’</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request timeout.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¤„ç†é”™è¯¯åç»ˆæ­¢è¯·æ±‚</strong></p><p>å½“åœ¨è¯·æ±‚çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†æŸäº›é—®é¢˜ï¼Œæ¯”å¦‚è¿æ¥é”™è¯¯ã€æ•°æ®æ ¼å¼é”™è¯¯ç­‰ï¼Œä½ å¯èƒ½éœ€è¦ç«‹å³åœæ­¢è¯·æ±‚ï¼Œå¹¶è®°å½•é”™è¯¯ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      const</span><span style="color:#D8DEE9;"> parsedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // å¤„ç†æ•°æ®...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è§£æå¤±è´¥ï¼Œç»ˆæ­¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ <code>request.destroy([error])</code> æ¥ç®¡ç† HTTP è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦æå‰ç»ˆæ­¢è¯·æ±‚çš„æƒ…å†µä¸‹ã€‚é€šè¿‡ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿˜å¯ä»¥åœ¨ç»“æŸè¯·æ±‚çš„åŒæ—¶æä¾›é”™è¯¯ä¸Šä¸‹æ–‡ï¼Œæœ‰åŠ©äºåœ¨å‘ç”Ÿé”™è¯¯æ—¶è¿›è¡Œè°ƒè¯•ã€‚</p><h4 id="request-destroyed" tabindex="-1"><a class="header-anchor" href="#request-destroyed"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestdestroyed" target="_blank" rel="noopener noreferrer">request.destroyed</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>request.destroyed</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºäº†è§£ HTTP è¯·æ±‚æ˜¯å¦å·²ç»è¢«é”€æ¯ã€‚è¿™ä¸ªå±æ€§å½’å±äº HTTP æ¨¡å—çš„<code>ClientRequest</code>ç±»ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“è¯·æ±‚ä½“å·²è¢«å®Œå…¨å‘é€ã€å“åº”ä½“å·²è¢«å®Œå…¨æ¥æ”¶æˆ–è€…è¿æ¥ï¼ˆSocketï¼‰å·²ç»å…³é—­æ—¶ï¼Œè¯¥è¯·æ±‚å°±è¢«è§†ä¸ºâ€œé”€æ¯â€ã€‚</p><p><code>request.destroyed</code> çš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹ï¼ˆbooleanï¼‰ï¼Œå®ƒä¼šå‘Šè¯‰ä½ è¯·æ±‚æ˜¯å¦å·²ç»ç»“æŸï¼Œå¹¶ä¸”èµ„æºå·²ç»è¢«æ¸…ç†ã€‚å¦‚æœè¯·æ±‚å·²ç»ç»“æŸï¼Œåˆ™å®ƒçš„å€¼ä¸º <code>true</code>ï¼Œå¦åˆ™ä¸º <code>false</code>ã€‚</p><p>è¿™é‡Œæœ‰ä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><strong>æ£€æµ‹è¯·æ±‚çŠ¶æ€</strong>ï¼š<br> å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥ä¸€ä¸ªè¯·æ±‚åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šæ˜¯å¦ä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚é€šè¿‡æ£€æŸ¥ <code>request.destroyed</code> å±æ€§ï¼Œå¯ä»¥é¿å…å‘ä¸€ä¸ªå·²ç»å…³é—­çš„è¿æ¥å‘é€æ•°æ®ï¼Œä»è€Œå¯¼è‡´é”™è¯¯ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">destroyed</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å·²è¢«é”€æ¯</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>æ¸…ç†èµ„æº</strong>ï¼š<br> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦åœ¨è¯·æ±‚ç»“æŸæ—¶é‡Šæ”¾æˆ–æ¸…ç†èµ„æºã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶æµæˆ–è€…æ•°æ®åº“è¿æ¥ï¼Œä½ ä¸å¸Œæœ›è¿™äº›èµ„æºåœ¨è¯·æ±‚å®Œæˆåç»§ç»­å ç”¨ã€‚å¯ä»¥ä½¿ç”¨ <code>request.destroyed</code> æ¥åˆ¤æ–­æ˜¯å¦æ‰§è¡Œæ¸…ç†æ“ä½œã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å½“è¯·æ±‚å…³é—­æ—¶ï¼Œé€šè¿‡æ£€æŸ¥request.destroyedå±æ€§æ¥å†³å®šæ˜¯å¦éœ€è¦æ¸…ç†</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">destroyed</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å·²è¢«é”€æ¯ï¼Œé‡Šæ”¾èµ„æº</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>ä¼˜åŒ–æ€§èƒ½</strong>ï¼š<br> å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼æ˜¯éå¸¸é‡è¦çš„ã€‚é€šè¿‡ç›‘æ§ <code>request.destroyed</code>ï¼Œä½ å¯ä»¥ç¡®ä¿ä¸å¯¹å·²é”€æ¯çš„è¯·æ±‚æ‰§è¡Œä»»ä½•è¿›ä¸€æ­¥çš„å¤„ç†ï¼Œè¿™æœ‰åŠ©äºä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œæé«˜åº”ç”¨æ€§èƒ½ã€‚</li></ol><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>request.destroyed</code>æ˜¯ Node.js ä¸­ç”¨æ¥ç¡®å®šä¸€ä¸ª HTTP è¯·æ±‚æ˜¯å¦ç»“æŸå¹¶ä¸”ç›¸å…³èµ„æºæ˜¯å¦å·²ç»è¢«æ¸…ç†çš„å±æ€§ã€‚å®ƒåœ¨ç®¡ç†èµ„æºã€é¿å…é”™è¯¯å’Œä¼˜åŒ–åº”ç”¨æ€§èƒ½æ–¹é¢éå¸¸æœ‰ç”¨ã€‚</p><h3 id="request-finished" tabindex="-1"><a class="header-anchor" href="#request-finished"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestfinished" target="_blank" rel="noopener noreferrer">request.finished</a></span></a></h3><p><code>request.finished</code> åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒç”¨æ¥åˆ¤æ–­ HTTP è¯·æ±‚æ˜¯å¦å·²ç»å®Œæˆã€‚å½“æˆ‘ä»¬è°ˆè®º HTTP è¯·æ±‚å®Œæˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯è¯·æ±‚çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸâ€”â€”ä»å‘é€è¯·æ±‚åˆ°æ¥æ”¶å“åº”â€”â€”å·²ç»ç»“æŸã€‚è¿™ä¸ªå±æ€§ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆ<code>true</code> æˆ– <code>false</code>ï¼‰ï¼Œå‘Šè¯‰ä½ è¯·æ±‚æ˜¯å¦å·²ç»ç»“æŸã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯å’Œé‡è¦æ€§" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯å’Œé‡è¦æ€§"><span>ä½¿ç”¨åœºæ™¯å’Œé‡è¦æ€§</span></a></h3><p>äº†è§£ä¸€ä¸ªè¯·æ±‚æ˜¯å¦å·²ç»å®Œæˆæ˜¯éå¸¸é‡è¦çš„ï¼Œå°¤å…¶æ˜¯åœ¨å¼€å‘æ¶‰åŠç½‘ç»œé€šä¿¡çš„åº”ç”¨ç¨‹åºæ—¶ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œä½ å¯èƒ½éœ€è¦åœ¨è¯·æ±‚å®Œæˆåæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œæˆ–è€…æ›´æ–°æœåŠ¡å™¨ç«¯çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬åœ¨æ„å»ºä¸€ä¸ªç®€å•çš„ Node.js æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¤„ç†åå“åº”ã€‚æˆ‘ä»¬æƒ³è¦åœ¨æ¯æ¬¡è¯·æ±‚ç»“æŸåè®°å½•ä¸€æ¡æ—¥å¿—ï¼Œè¡¨æ˜è¿™ä¸ªè¯·æ±‚å·²ç»è¢«å®Œå…¨å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾å¤„ç†ä¸€äº›äº‹æƒ…...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç°åœ¨æˆ‘ä»¬æ£€æŸ¥ request.finished å±æ€§æ¥å†³å®šæ˜¯å¦è®°å½•æ—¥å¿—</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">finished</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å·²å®Œæˆï¼Œå¯ä»¥è¿›è¡Œæ—¥å¿—è®°å½•ç­‰åç»­æ“ä½œã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ­¤æ—¶è¯·æ±‚æœªå®Œæˆï¼Œè¿˜æœ‰æ•°æ®åœ¨ä¼ è¾“ä¸­ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬<code>3000</code>ç«¯å£ã€‚æ¯å½“æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘å®¢æˆ·ç«¯å‘é€â€œHello World!â€ä½œä¸ºå“åº”ï¼Œå¹¶ä¸”æ£€æŸ¥<code>req.finished</code>å±æ€§ã€‚åŸºäº<code>req.finished</code>çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæ˜¯å¦æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—ã€‚</p><p>ç„¶è€Œï¼Œé€šå¸¸<code>req.finished</code>æ›´å¤šçš„æ˜¯ç”¨æ¥åˆ¤æ–­å“åº”æ˜¯å¦å·²ç»è¢«é€å‡ºã€‚æ³¨æ„ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç›´æ¥åœ¨å‘é€å“åº”ä¹‹åæ£€æŸ¥<code>req.finished</code>å¯èƒ½ä¸æ˜¯å¾ˆæœ‰æ„ä¹‰ï¼Œå› ä¸ºåœ¨å“åº”ç»“æŸ(<code>res.end()</code>)ä¹‹åï¼Œ<code>req.finished</code>å¾ˆå¯èƒ½æ€»æ˜¯ä¸º<code>true</code>ã€‚çœŸæ­£çš„ç”¨é€”å¯èƒ½ä½“ç°åœ¨ä¸€äº›å¼‚æ­¥é€»è¾‘çš„å¤„ç†ã€é”™è¯¯å¤„ç†æˆ–è€…èµ„æºæ¸…ç†ä¸Šï¼Œåœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œæ­£ç¡®åœ°ä½¿ç”¨<code>request.finished</code>å¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºã€‚</p><h3 id="request-flushheaders" tabindex="-1"><a class="header-anchor" href="#request-flushheaders"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestflushheaders" target="_blank" rel="noopener noreferrer">request.flushHeaders()</a></span></a></h3><p><code>request.flushHeaders()</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js ä¸­ç”¨äº HTTP è¯·æ±‚çš„æ–¹æ³•ï¼Œå®ƒå±äº http æ¨¡å—ã€‚è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ç«‹å³å°†å·²ç»è®¾ç½®ä½†è¿˜æœªå‘é€çš„ HTTP è¯·æ±‚å¤´éƒ¨å†™å…¥åˆ°ç½‘ç»œæµä¸­ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨ Node.js ä¸­ï¼Œå½“ä½ åˆ›å»ºäº†ä¸€ä¸ª HTTP è¯·æ±‚å¹¶å¼€å§‹å‘é€æ•°æ®æ—¶ï¼ŒNode.js ä¼šè‡ªåŠ¨å°†è¯·æ±‚å¤´éƒ¨å’Œæ•°æ®ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ã€‚ä½†æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šæƒ³æ‰‹åŠ¨æ§åˆ¶ä½•æ—¶å‘é€è¯·æ±‚å¤´éƒ¨ã€‚</p><p>è®©æˆ‘é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¯¦ç»†è§£é‡Šè¿™ä¸ªå‡½æ•°çš„åº”ç”¨ï¼š</p><h3 id="_1-æå‰å‘é€è¯·æ±‚å¤´éƒ¨" tabindex="-1"><a class="header-anchor" href="#_1-æå‰å‘é€è¯·æ±‚å¤´éƒ¨"><span>1. æå‰å‘é€è¯·æ±‚å¤´éƒ¨</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªéœ€è¦å‘æœåŠ¡å™¨å‘é€å¤§é‡æ•°æ®çš„ç¨‹åºï¼Œè€Œä½ ä¸æƒ³ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½å‡†å¤‡å¥½æ‰å¼€å§‹å‘é€ã€‚ä½ å¯ä»¥å…ˆè°ƒç”¨ <code>request.flushHeaders()</code> æ¥æå‰å‘é€è¯·æ±‚å¤´éƒ¨ï¼Œå‘Šè¯‰æœåŠ¡å™¨å®¢æˆ·ç«¯çš„æ„å›¾å’Œå³å°†å‘é€çš„æ•°æ®ç±»å‹ç­‰ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPè¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç«‹å³å‘é€è¯·æ±‚å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">flushHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// éšåå‘é€è¯·æ±‚ä½“æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> data</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some large data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœ€åç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>flushHeaders()</code> è¢«ç”¨æ¥ç«‹å³å‘é€ <code>&#39;Content-Type&#39;: &#39;application/json&#39;</code> è¯·æ±‚å¤´éƒ¨ï¼Œè€Œä¸æ˜¯ç­‰å¾…éšåçš„ <code>req.write()</code> æ•°æ®ä¸€èµ·å‘é€ã€‚</p><h3 id="_2-å®ç°é•¿è½®è¯¢" tabindex="-1"><a class="header-anchor" href="#_2-å®ç°é•¿è½®è¯¢"><span>2. å®ç°é•¿è½®è¯¢</span></a></h3><p>é•¿è½®è¯¢æ˜¯ Web å¼€å‘ä¸­ä¸€ç§æœåŠ¡å™¨æ¨é€æŠ€æœ¯ï¼Œå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰ç«‹å³å¯ç”¨çš„æ•°æ®ï¼ŒæœåŠ¡ç«¯å°±ä¿æŒè¿æ¥ç›´åˆ°æœ‰æ–°æ•°æ®å¯å‘é€ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå‘é€è¯·æ±‚å¤´éƒ¨å¯ä»¥è®©å®¢æˆ·ç«¯çŸ¥é“è¿æ¥å·²ç»å»ºç«‹ï¼Œè€ŒæœåŠ¡ç«¯æ­£åœ¨å¤„ç†è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> longPollingRequest</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/long-polling</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // å½“æ”¶åˆ°æ•°æ®åï¼Œå†æ¬¡å‘èµ·é•¿è½®è¯¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#88C0D0;">      longPollingRequest</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç«‹å³å‘é€è¯·æ±‚å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">flushHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">problem with request: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ³¨æ„è¿™é‡Œä¸éœ€è¦å†™å…¥æ•°æ®æˆ–ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯åŠ¨é•¿è½®è¯¢</span></span>
<span class="line"><span style="color:#88C0D0;">longPollingRequest</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>flushHeaders()</code> è¢«ç”¨äºç«‹å³å‘é€ GET è¯·æ±‚çš„è¯·æ±‚å¤´éƒ¨ï¼Œå‘Šè¯‰æœåŠ¡å™¨å¼€å§‹é•¿è½®è¯¢ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>request.flushHeaders()</code> æ–¹æ³•åœ¨ä½ éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ HTTP è¯·æ±‚çš„å‘é€è¿‡ç¨‹æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠåˆ°ä¼˜åŒ–æ€§èƒ½æˆ–è€…å®ç°ç‰¹å®šçš„ HTTP äº¤äº’æ¨¡å¼æ—¶ã€‚</p><h3 id="request-getheader-name" tabindex="-1"><a class="header-anchor" href="#request-getheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestgetheadername" target="_blank" rel="noopener noreferrer">request.getHeader(name)</a></span></a></h3><p>äº†è§£<code>request.getHeader(name)</code>ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ Node.js å’Œå®ƒå¤„ç† HTTP è¯·æ±‚çš„åŸºæœ¬æ¦‚å¿µã€‚</p><h3 id="node-js-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#node-js-ç®€ä»‹"><span>Node.js ç®€ä»‹</span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js ç‰¹åˆ«é€‚åˆå¼€å‘éœ€è¦é«˜æ€§èƒ½ã€å®æ—¶çš„ Web åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚åœ¨çº¿æ¸¸æˆã€èŠå¤©åº”ç”¨ç­‰ã€‚</p><h3 id="http-è¯·æ±‚å’Œå“åº”" tabindex="-1"><a class="header-anchor" href="#http-è¯·æ±‚å’Œå“åº”"><span>HTTP è¯·æ±‚å’Œå“åº”</span></a></h3><p>å½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªç½‘å€æ—¶ï¼Œä½ çš„æµè§ˆå™¨å°±ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚åŒ…å«äº†å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚ä½ è¦è®¿é—®çš„ç½‘é¡µåœ°å€ã€ä½ çš„æµè§ˆå™¨ç±»å‹ç­‰ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚çš„å†…å®¹ç”Ÿæˆç›¸åº”çš„å›å¤ï¼ˆå³ HTTP å“åº”ï¼‰ï¼Œç„¶åå‘é€å›æµè§ˆå™¨ã€‚</p><h3 id="request-getheader-name-1" tabindex="-1"><a class="header-anchor" href="#request-getheader-name-1"><span>request.getHeader(name)</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¤„ç† HTTP è¯·æ±‚æ—¶ä¼šç”¨åˆ°<code>request.getHeader(name)</code>ã€‚è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å– HTTP è¯·æ±‚å¤´éƒ¨(header)ä¸­æŸä¸ªå…·ä½“å­—æ®µçš„å€¼ã€‚è¯·æ±‚å¤´æ˜¯ HTTP è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«äº†è¯¸å¦‚è¯·æ±‚çš„èµ„æºã€å®¢æˆ·ç«¯çš„ç±»å‹ç­‰ä¿¡æ¯ã€‚</p><ul><li><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><code>name</code>: ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦æ£€ç´¢çš„å¤´éƒ¨å­—æ®µçš„åç§°ï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰ã€‚</li></ul></li><li><p><strong>è¿”å›å€¼</strong>ï¼šè¿™ä¸ªæ–¹æ³•è¿”å›æŒ‡å®šå¤´éƒ¨å­—æ®µçš„å€¼ï¼ˆå¦‚æœè¯¥å­—æ®µå­˜åœ¨ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å­—æ®µï¼Œåˆ™è¿”å›<code>undefined</code>ã€‚</p></li></ul><h3 id="å®é™…ä½¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä½¿ç”¨ä¾‹å­"><span>å®é™…ä½¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·çš„æµè§ˆå™¨ç±»å‹æ¥æä¾›ä¸åŒçš„å†…å®¹ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>request.getHeader(&#39;User-Agent&#39;)</code>æ¥è·å–ç”¨æˆ·æµè§ˆå™¨çš„ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è·å–è¯·æ±‚çš„User-Agentå¤´éƒ¨ï¼Œè¿™é‡Œä¿å­˜äº†æµè§ˆå™¨çš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> userAgent</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">User-Agent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">userAgent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°å‡ºç”¨æˆ·çš„æµè§ˆå™¨ä¿¡æ¯</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ ¹æ®User-Agentæ¥åšä¸€äº›æ“ä½œ...</span></span>
<span class="line"><span style="color:#616E88;">  // æ¯”å¦‚æ ¹æ®ä¸åŒçš„æµè§ˆå™¨è¿”å›ä¸åŒçš„å†…å®¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä¼šæ‰“å°æ¯ä¸ªè¯·æ±‚çš„<code>User-Agent</code>ä¿¡æ¯ï¼Œè¿™æ ·ä½ å°±å¯ä»¥çŸ¥é“æ˜¯å“ªç§æµè§ˆå™¨å‘èµ·çš„è¯·æ±‚ï¼Œå¹¶æ®æ­¤è¿›è¡Œå¤„ç†ã€‚</p><h3 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡<code>request.getHeader(name)</code>ï¼Œä½ å¯ä»¥è½»æ¾åœ°è®¿é—® HTTP è¯·æ±‚å¤´éƒ¨ä¸­çš„å„ç§ä¿¡æ¯ï¼Œè¿™åœ¨å¤„ç† Web è¯·æ±‚æ—¶éå¸¸æœ‰ç”¨ã€‚æ— è®ºæ˜¯åˆ¤æ–­ç”¨æˆ·çš„æµè§ˆå™¨ç±»å‹ï¼Œè¿˜æ˜¯å¤„ç†è®¤è¯ä¿¡æ¯ï¼ˆæ¯”å¦‚<code>Authorization</code>å¤´éƒ¨ï¼‰ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥å®ç°ã€‚</p><h3 id="request-getheadernames" tabindex="-1"><a class="header-anchor" href="#request-getheadernames"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestgetheadernames" target="_blank" rel="noopener noreferrer">request.getHeaderNames()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚è€Œåœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œå¤„ç† HTTP è¯·æ±‚å’Œå“åº”æ˜¯éå¸¸åŸºç¡€ä¸”é‡è¦çš„éƒ¨åˆ†ã€‚<code>request.getHeaderNames()</code>æ˜¯ Node.js ä¸­ http æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è·å–å½“å‰ HTTP è¯·æ±‚ä¸­æ‰€æœ‰å¤´éƒ¨(header)çš„åç§°ã€‚</p><h3 id="ç†è§£-http-è¯·æ±‚å’Œå¤´éƒ¨-headers" tabindex="-1"><a class="header-anchor" href="#ç†è§£-http-è¯·æ±‚å’Œå¤´éƒ¨-headers"><span>ç†è§£ HTTP è¯·æ±‚å’Œå¤´éƒ¨(Headers)</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªç½‘å€æˆ–ç‚¹å‡»ä¸€ä¸ªé“¾æ¥æ—¶ï¼Œä½ çš„æµè§ˆå™¨å®é™…ä¸Šå‘é€äº†ä¸€ä¸ª HTTP è¯·æ±‚ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªè¯·æ±‚åŒ…å«äº†å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚ä½ æƒ³è¦è·å–å“ªä¸ªé¡µé¢ã€ä½ çš„æµè§ˆå™¨æ˜¯ä»€ä¹ˆã€ä½ çš„åå¥½è¯­è¨€ç­‰ç­‰ã€‚è¿™äº›ä¿¡æ¯å¤§éƒ¨åˆ†éƒ½å­˜æ”¾åœ¨æ‰€è°“çš„â€œå¤´éƒ¨(headers)â€ä¸­ã€‚æ¯ä¸ªå¤´éƒ¨éƒ½æœ‰ä¸€ä¸ªåç§°å’Œå¯¹åº”çš„å€¼ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>User-Agent</code>: æè¿°äº†å‘å‡ºè¯·æ±‚çš„æµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚</li><li><code>Accept-Language</code>: å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ”¯æŒå“ªäº›è¯­è¨€ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯request-getheadernames" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯request-getheadernames"><span>ä»€ä¹ˆæ˜¯<code>request.getHeaderNames()</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ æ¥æ”¶åˆ°ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦æ£€æŸ¥è¿™ä¸ªè¯·æ±‚åŒ…å«å“ªäº›å¤´éƒ¨ã€‚è¿™èƒ½å¸®åŠ©ä½ æ ¹æ®è¯·æ±‚çš„ä¸åŒå¤´éƒ¨åšå‡ºç›¸åº”çš„å¤„ç†ã€‚<code>request.getHeaderNames()</code>å°±æ˜¯ç”¨æ¥åšè¿™ä»¶äº‹çš„ã€‚å®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†è¯·æ±‚ä¸­æ‰€æœ‰å¤´éƒ¨çš„åç§°ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œä½ éœ€è¦æ ¹æ®ç”¨æˆ·çš„åå¥½è¯­è¨€è¿”å›ä¸åŒè¯­è¨€çš„é¡µé¢ã€‚è¿™æ—¶å€™ï¼Œä½ å°±å¯ä»¥åˆ©ç”¨<code>request.getHeaderNames()</code>æ¥æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦åŒ…å«<code>Accept-Language</code>å¤´éƒ¨ï¼Œç„¶åæ®æ­¤ä½œå‡ºå“åº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨getHeaderNames()è·å–æ‰€æœ‰å¤´éƒ¨çš„åç§°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> headers</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaderNames</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥æ˜¯å¦å­˜åœ¨Accept-Languageå¤´éƒ¨</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">accept-language</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // è·å–Accept-Languageçš„å€¼</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> preferredLanguage</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">accept-language</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // æ ¹æ®preferredLanguageçš„å€¼å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚è¿”å›ç‰¹å®šè¯­è¨€çš„é¡µé¢</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Your preferred language is: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">preferredLanguage</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰Accept-Languageå¤´éƒ¨ï¼Œè¿”å›é»˜è®¤é¡µé¢</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨é¦–å…ˆé€šè¿‡<code>getHeaderNames()</code>æ–¹æ³•è·å–åˆ°æ‰€æœ‰çš„å¤´éƒ¨åç§°ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦åŒ…å«<code>accept-language</code>å¤´éƒ¨ã€‚å¦‚æœå­˜åœ¨è¿™ä¸ªå¤´éƒ¨ï¼ŒæœåŠ¡å™¨å°†ä¼šè¯»å–å…¶å€¼ï¼Œå¹¶æ®æ­¤è¿”å›ä¸€ä¸ªç‰¹å®šè¯­è¨€çš„æ¬¢è¿æ¶ˆæ¯ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå°±è¿”å›é»˜è®¤çš„æ¬¢è¿æ¶ˆæ¯ã€‚</p><p>è¿™åªæ˜¯<code>getHeaderNames()</code>æ–¹æ³•çš„ä¸€ä¸ªç®€å•åº”ç”¨ï¼Œä½†å®ƒå±•ç¤ºäº†å¦‚ä½•åŸºäºè¯·æ±‚çš„å¤´éƒ¨ä¿¡æ¯æ¥è°ƒæ•´ä½ çš„åº”ç”¨é€»è¾‘ï¼Œä»è€Œåˆ›å»ºæ›´åŠ åŠ¨æ€å’Œä¸ªæ€§åŒ–çš„ Web åº”ç”¨ã€‚</p><h3 id="request-getheaders" tabindex="-1"><a class="header-anchor" href="#request-getheaders"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestgetheaders" target="_blank" rel="noopener noreferrer">request.getHeaders()</a></span></a></h3><p>Node.js ä¸­çš„ <code>request.getHeaders()</code> æ–¹æ³•ç”¨äºè·å–å½“å‰ HTTP è¯·æ±‚ä¸­çš„æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯ã€‚åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œäº†è§£å’Œæ“ä½œè¯·æ±‚å¤´ï¼ˆHeadersï¼‰æ˜¯å¸¸è§çš„éœ€æ±‚ã€‚è¯·æ±‚å¤´åŒ…å«äº†å¯¹æœåŠ¡å™¨éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯çš„ç±»å‹ã€è¯·æ±‚çš„å†…å®¹ç±»å‹ã€æ¥å—è¯­è¨€ç­‰ã€‚</p><h3 id="å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œåŸç†"><span>å·¥ä½œåŸç†</span></a></h3><p>å½“ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨æˆ–è€…å…¶ä»–ä»»ä½•å‘èµ· HTTP è¯·æ±‚çš„ç¨‹åºï¼‰å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé™„å¸¦ä¸€ç³»åˆ—çš„è¯·æ±‚å¤´ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œå¯ä»¥é€šè¿‡ <code>request.getHeaders()</code> æ–¹æ³•æ¥è¯»å–è¿™äº›è¯·æ±‚å¤´ä¿¡æ¯ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰è¯·æ±‚å¤´çš„é”®å€¼å¯¹ã€‚</p><h3 id="å®é™…è¿ç”¨-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨-2"><span>å®é™…è¿ç”¨</span></a></h3><h4 id="_1-åˆ¤æ–­è¯·æ±‚æ¥æº" tabindex="-1"><a class="header-anchor" href="#_1-åˆ¤æ–­è¯·æ±‚æ¥æº"><span>1. åˆ¤æ–­è¯·æ±‚æ¥æº</span></a></h4><p>æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåªå…è®¸æ¥è‡ªç‰¹å®šåŸŸåçš„è¯·æ±‚çš„ Web æœåŠ¡ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>request.getHeaders()</code> æ¥è·å–è¯·æ±‚å¤´ä¸­çš„ <code>&#39;Referer&#39;</code> å­—æ®µï¼Œè¿™ä¸ªå­—æ®µé€šå¸¸ç”¨æ¥è¡¨ç¤ºè¯·æ±‚æ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> headers</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> referer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">referer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">||</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Referer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ³¨æ„å¤§å°å†™</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">referer</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> referer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">startsWith</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://trusteddomain.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome, trusted user!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">403</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Access Denied</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-å†…å®¹åå•†" tabindex="-1"><a class="header-anchor" href="#_2-å†…å®¹åå•†"><span>2. å†…å®¹åå•†</span></a></h4><p>åœ¨ä¸€ä¸ªå¤šè¯­è¨€æ”¯æŒçš„ç½‘ç«™ä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦æ ¹æ®å®¢æˆ·ç«¯æœŸæœ›çš„è¯­è¨€æ¥è¿”å›ç›¸åº”çš„ç½‘é¡µç‰ˆæœ¬ã€‚å®¢æˆ·ç«¯é€šè¿‡åœ¨è¯·æ±‚å¤´ä¸­è®¾ç½® <code>&#39;Accept-Language&#39;</code> å­—æ®µæ¥é€šçŸ¥æœåŠ¡å™¨å®ƒæ‰€ä¼˜å…ˆé€‰æ‹©çš„è¯­è¨€ã€‚æœåŠ¡å™¨å¯ä»¥è¯»å–è¿™ä¸ªå­—æ®µï¼Œå¹¶æä¾›ç›¸åº”è¯­è¨€çš„å†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> headers</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> acceptLanguage</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">accept-language</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">acceptLanguage</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> acceptLanguage</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">en-US</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">acceptLanguage</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> acceptLanguage</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fr-FR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Bonjour!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello or Bonjour!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-è®¤è¯ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_3-è®¤è¯ä¿¡æ¯"><span>3. è®¤è¯ä¿¡æ¯</span></a></h4><p>åœ¨ä¸€äº›éœ€è¦è®¤è¯çš„ API æ¥å£ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨è¯·æ±‚å¤´ä¸­é™„åŠ ä¸€ä¸ª <code>&#39;Authorization&#39;</code> å­—æ®µï¼ŒåŒ…å«äº†è®¤è¯æ‰€éœ€çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ Tokenï¼‰ã€‚æœåŠ¡å™¨å¯ä»¥é€šè¿‡æ­¤å­—æ®µéªŒè¯è¯·æ±‚çš„åˆæ³•æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> headers</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> authToken</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">authorization</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">authToken</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SomeSecretToken</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Authenticated content</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">401</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // Unauthorized</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Access denied</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä¾‹å­å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ <code>request.getHeaders()</code> æ–¹æ³•åœ¨ä¸åŒåœºæ™¯ä¸‹åˆ©ç”¨è¯·æ±‚å¤´ä¿¡æ¯ã€‚è¿™ä¸ªæ–¹æ³•ä¸ºæœåŠ¡å™¨æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å¤„ç†å’Œå“åº”ä¸åŒç±»å‹çš„ HTTP è¯·æ±‚ã€‚</p><h3 id="request-getrawheadernames" tabindex="-1"><a class="header-anchor" href="#request-getrawheadernames"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestgetrawheadernames" target="_blank" rel="noopener noreferrer">request.getRawHeaderNames()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šæ¨¡å—å’Œ API ç”¨äºå¤„ç†å„ç§ä»»åŠ¡ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç½‘ç»œé€šä¿¡ç­‰ã€‚å…¶ä¸­ <code>http</code> æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ï¼Œè€Œ <code>request.getRawHeaderNames()</code> æ˜¯ <code>http</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><h3 id="request-getrawheadernames-1" tabindex="-1"><a class="header-anchor" href="#request-getrawheadernames-1"><span>request.getRawHeaderNames()</span></a></h3><p>å½“ä½ ç”¨ Node.js åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨æˆ–å…¶å®ƒæœåŠ¡å™¨ï¼‰ä¼šå‘é€ HTTP è¯·æ±‚åˆ°ä½ çš„æœåŠ¡å™¨ã€‚è¿™äº›è¯·æ±‚åŒ…å«äº†å¾ˆå¤šä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†è¯·æ±‚å¤´ï¼ˆHeadersï¼‰ã€‚è¯·æ±‚å¤´åŒ…å«äº†å…³äºè¯·æ±‚çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯æƒ³è¦ä¼ è¾¾ç»™æœåŠ¡å™¨çš„ä¿¡æ¯ç±»å‹ã€å†…å®¹é•¿åº¦ã€è®¤è¯ä¿¡æ¯ç­‰ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒHTTP è¯·æ±‚å¤´çš„åå­—ä¼šè¢«è‡ªåŠ¨è½¬æ¢æˆå°å†™æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œå³ä½¿å®¢æˆ·ç«¯å‘é€äº† &quot;Content-Type&quot; æˆ– &quot;CONTENT-TYPE&quot; è¿™æ ·çš„è¯·æ±‚å¤´ï¼Œé€šè¿‡æ ‡å‡†çš„ Node.js API è·å–åˆ°çš„å°†ä¼šæ˜¯ &quot;content-type&quot;ã€‚</p><p>ç„¶è€Œï¼Œæœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦çŸ¥é“åŸå§‹çš„è¯·æ±‚å¤´åç§°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å‘é€çš„æœªç»ä¿®æ”¹çš„æ ¼å¼ã€‚<code>request.getRawHeaderNames()</code> æ–¹æ³•å°±æ˜¯ä¸ºäº†è¿™ä¸ªç›®çš„è€Œå­˜åœ¨çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶å¸Œæœ›å‡†ç¡®åœ°è®°å½•å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¤´åç§°çš„å¤§å°å†™æ ¼å¼ã€‚ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>request.getRawHeaderNames()</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è·å–åŸå§‹è¯·æ±‚å¤´åç§°çš„æ•°ç»„</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> rawHeaderNames</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRawHeaderNames</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ‰“å°åŸå§‹è¯·æ±‚å¤´åç§°</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">rawHeaderNames</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸çš„å“åº”å¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœç°åœ¨æœ‰å®¢æˆ·ç«¯å¯¹ä½ çš„æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶è¯·æ±‚å¤´åŒ…å«äº† &quot;Content-Type&quot; å’Œ &quot;X-Custom-Header&quot;ï¼Œä¸ç®¡å®¢æˆ·ç«¯ä½¿ç”¨ä»€ä¹ˆæ ·çš„å¤§å°å†™å½¢å¼å‘é€è¿™äº›å¤´éƒ¨ï¼Œä½ çš„æœåŠ¡å™¨éƒ½å°†æ‰“å°å‡ºåŸå§‹çš„æ ¼å¼ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½¿ç”¨ <code>request.getRawHeaderNames()</code> çš„åœºåˆä¸å¤šã€‚å¤§éƒ¨åˆ†æ—¶å€™ï¼Œä½ åªéœ€è¦çŸ¥é“è¯·æ±‚å¤´çš„é”®å€¼å¯¹ï¼Œè€Œä¸åœ¨ä¹å®ƒä»¬çš„å¤§å°å†™æ ¼å¼ã€‚ä½†æ˜¯ï¼Œåœ¨éœ€è¦éµå®ˆæŸäº›ç‰¹å®šåè®®çš„æ—¥å¿—è®°å½•æˆ–è€…è¿›è¡Œè°ƒè¯•æ—¶ï¼Œå¯èƒ½ä¼šéœ€è¦è¿™ä¸ªåŠŸèƒ½ã€‚</p><h3 id="request-hasheader-name" tabindex="-1"><a class="header-anchor" href="#request-hasheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#requesthasheadername" target="_blank" rel="noopener noreferrer">request.hasHeader(name)</a></span></a></h3><p>å½“ç„¶ï¼Œå¾ˆé«˜å…´å¸®åŠ©ä½ ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><p><code>request.hasHeader(name)</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥ä¼ å…¥çš„ HTTP è¯·æ±‚(request)å¯¹è±¡ä¸Šæ˜¯å¦å­˜åœ¨æŸä¸ªç‰¹å®šçš„å¤´éƒ¨(header)ã€‚åœ¨ HTTP é€šä¿¡ä¸­ï¼Œè¯·æ±‚å’Œå“åº”éƒ½å¯ä»¥åŒ…å«å¤´éƒ¨ä¿¡æ¯ï¼Œå®ƒä»¬æä¾›äº†å…³äº HTTP æ¶ˆæ¯æœ¬èº«çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ã€ç¼–ç ä¿¡æ¯ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å¹¶æƒ³è¦å¤„ç†è¿›æ¥çš„è¯·æ±‚æ—¶ï¼Œä½ ç»å¸¸éœ€è¦æŸ¥çœ‹è¯·æ±‚ä¸­çš„å¤´éƒ¨ä¿¡æ¯æ¥å†³å®šæ€æ ·å¤„ç†è¯¥è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“å®¢æˆ·ç«¯æœŸæœ›çš„å›å¤æ ¼å¼ï¼ˆJSON, HTML ç­‰ï¼‰ï¼Œæˆ–è€…éªŒè¯ä¸€äº›å®‰å…¨ç›¸å…³çš„å¤´éƒ¨ï¼Œæ¯”å¦‚è®¤è¯ä»¤ç‰Œã€‚</p><h3 id="æ–¹æ³•è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•è¯´æ˜"><span>æ–¹æ³•è¯´æ˜</span></a></h3><p><code>request.hasHeader(name)</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‚æ•° <code>name</code>ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºä½ æƒ³è¦æ£€æŸ¥çš„å¤´éƒ¨å­—æ®µçš„åç§°ã€‚å¦‚æœè¯·æ±‚ä¸­å«æœ‰è¿™ä¸ªå¤´éƒ¨ï¼Œåˆ™æ–¹æ³•è¿”å› <code>true</code>ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å› <code>false</code>ã€‚</p><h3 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Web APIï¼Œè¿™ä¸ª API èƒ½å¤Ÿå“åº” JSON æˆ–è€… XML æ ¼å¼çš„æ•°æ®ã€‚å®¢æˆ·ç«¯é€šè¿‡è®¾ç½® &quot;Accept&quot; å¤´éƒ¨æ¥å‘Šè¯‰æœåŠ¡å™¨å®ƒæœŸæœ›æ¥æ”¶ä»€ä¹ˆæ ¼å¼çš„æ•°æ®ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ <code>request.hasHeader(name)</code> æ¥æ£€æŸ¥è¿™ä¸ªå¤´éƒ¨çš„ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦åŒ…å« &#39;Accept&#39; å¤´éƒ¨</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">hasHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Accept</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // è·å– &#39;Accept&#39; å¤´éƒ¨çš„å€¼</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> acceptHeader</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">accept</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // åŸºäº &#39;Accept&#39; å¤´éƒ¨çš„å€¼å†³å®šå“åº”æ ¼å¼</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">acceptHeader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å®¢æˆ·ç«¯æƒ³è¦ JSON æ ¼å¼çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, JSON!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">acceptHeader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">application/xml</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å®¢æˆ·ç«¯æƒ³è¦ XML æ ¼å¼çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/xml</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`message&gt;Hello, XML!`&lt;`/message&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // å¦‚æœä¸æ”¯æŒå®¢æˆ·ç«¯è¯·æ±‚çš„æ ¼å¼ï¼Œå‘é€ 406 Not Acceptable</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 406</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæ²¡æœ‰ &#39;Accept&#39; å¤´éƒ¨ï¼Œé»˜è®¤å‘é€ JSON æ ¼å¼çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, JSON by default!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥æ¯ä¸ªè¿›æ¥çš„è¯·æ±‚æ˜¯å¦æœ‰ &quot;Accept&quot; å¤´éƒ¨ï¼Œå¹¶æ ¹æ®å…¶å€¼å‘é€é€‚å½“æ ¼å¼çš„å“åº”ã€‚è¿™é‡Œä½¿ç”¨äº† <code>req.hasHeader(&#39;Accept&#39;)</code> æ¥ç¡®å®šè¯·æ±‚æ˜¯å¦åŒ…å« &quot;Accept&quot; å¤´éƒ¨ã€‚æ³¨æ„ï¼Œå®é™…æ“ä½œä¸­æ˜¯ç›´æ¥è®¿é—® <code>req.headers[&#39;accept&#39;]</code> æ¥è·å–å¤´éƒ¨çš„å€¼ï¼Œå› ä¸ºå³ä½¿ <code>hasHeader</code> ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å®ƒå¯ä»¥ä½œä¸ºé¢å¤–çš„æ£€æŸ¥ï¼Œç¡®ä¿ä»£ç çš„å¥å£®æ€§ã€‚</p><h3 id="request-maxheaderscount" tabindex="-1"><a class="header-anchor" href="#request-maxheaderscount"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestmaxheaderscount" target="_blank" rel="noopener noreferrer">request.maxHeadersCount</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>request.maxHeadersCount</code>æ˜¯ä¸ HTTP æœåŠ¡å™¨ç›¸å…³çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥æ§åˆ¶æœåŠ¡å™¨å¯ä»¥æ¥å—çš„æœ€å¤§ header æ•°é‡ã€‚HTTP è¯·æ±‚ç”±èµ·å§‹è¡Œã€å¤´éƒ¨(header)å­—æ®µå’Œå¯é€‰çš„æ¶ˆæ¯ä½“ç»„æˆã€‚å¤´éƒ¨å­—æ®µåŒ…å«äº†å¯¹è¯·æ±‚æˆ–è€…å“åº”è¿›è¡Œæè¿°çš„å„ç§å‚æ•°å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p><h3 id="ç†è§£request-maxheaderscount" tabindex="-1"><a class="header-anchor" href="#ç†è§£request-maxheaderscount"><span>ç†è§£<code>request.maxHeadersCount</code></span></a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½æ²¡æœ‰è®¾ç½®é™åˆ¶æ¥æ”¶çš„æœ€å¤§ header æ•°ï¼Œæˆ–è€…è¿™ä¸ªé™åˆ¶è¢«è®¾ç½®å¾—éå¸¸é«˜ä»¥å…è®¸å¤§é‡çš„ headerã€‚ç„¶è€Œï¼Œä¸ºäº†é˜²èŒƒå¯èƒ½çš„æ¶æ„æ”»å‡»ï¼ˆå¦‚ï¼šHTTP å¤´æ³¨å…¥æ”»å‡»æˆ–è¯·æ±‚å¤´å¤ªå¤§å¯¼è‡´çš„æœåŠ¡æ‹’ç»æ”»å‡»ï¼‰ï¼Œé€šè¿‡<code>request.maxHeadersCount</code>è®¾ç½®ä¸€ä¸ªåˆç†çš„é™åˆ¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨ç‰¹åˆ«ä¾èµ–äº HTTP å¤´éƒ¨è¿›è¡Œç”¨æˆ·è®¤è¯ã€çŠ¶æ€ç®¡ç†ç­‰ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šå‘é€åŒ…å«å¤šä¸ªè‡ªå®šä¹‰å¤´éƒ¨çš„è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŸä¸ªæ¶æ„ç”¨æˆ·å°è¯•é€šè¿‡å‘é€åŒ…å«å¤§é‡å¤´éƒ¨çš„è¯·æ±‚æ¥å°è¯•æ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œè¿™æ—¶å€™å°±éœ€è¦æœ‰ä¸€ç§æœºåˆ¶æ¥é™åˆ¶è¿™ç§è¡Œä¸ºï¼Œ<code>request.maxHeadersCount</code>æ­£æ˜¯è¿™ç§æƒ…å†µä¸‹çš„æ•‘æ˜Ÿã€‚</p><h3 id="é»˜è®¤å€¼-1" tabindex="-1"><a class="header-anchor" href="#é»˜è®¤å€¼-1"><span>é»˜è®¤å€¼</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>request.maxHeadersCount</code>çš„é»˜è®¤å€¼å¯èƒ½å› ç‰ˆæœ¬ä¸åŒç¨æœ‰å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å¯èƒ½æ˜¯æ— é™åˆ¶çš„ï¼Œè€Œåœ¨å…¶ä»–ç‰ˆæœ¬ä¸­ï¼Œåˆ™å¯èƒ½æœ‰ä¸€ä¸ªå…·ä½“çš„æ•°å­—ï¼ˆå¦‚ 1000ï¼‰ä½œä¸ºé»˜è®¤é™åˆ¶ã€‚å¯¹äº Node.js v21.7.1ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£è·å–æœ€å‡†ç¡®çš„é»˜è®¤å€¼ä¿¡æ¯ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æ‚¨æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js web åº”ç”¨ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„ http æ¨¡å—åˆ›å»ºæœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†è¯·æ±‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®æœ€å¤§Headeræ•°é‡</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxHeadersCount</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 500</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä»…å“åº”åŒ…å«ç®€å•é—®å€™çš„æ–‡æœ¬æ¶ˆæ¯ã€‚é€šè¿‡è®¾ç½®<code>server.maxHeadersCount = 500;</code>ï¼Œæˆ‘ä»¬é™åˆ¶äº†æœåŠ¡å™¨æ¥å—çš„æœ€å¤§ header æ•°é‡ä¸º 500ã€‚è¿™æ„å‘³ç€ä»»ä½•åŒ…å«è¶…è¿‡ 500 ä¸ªå¤´éƒ¨å­—æ®µçš„è¯·æ±‚éƒ½å°†è¢«æœåŠ¡å™¨æ‹’ç»ï¼Œè¿™æœ‰åŠ©äºå¢å¼ºåº”ç”¨çš„å®‰å…¨æ€§ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>request.maxHeadersCount</code>æ˜¯ä¸€ä¸ªé‡è¦çš„é…ç½®é¡¹ï¼Œèƒ½å¸®åŠ©ä½ æé«˜åº”ç”¨çš„å®‰å…¨æ€§ï¼Œé¿å…æ½œåœ¨çš„æ¶æ„æ”»å‡»ï¼Œç‰¹åˆ«æ˜¯åœ¨å…¬å…±æˆ–é¢å‘å¤§é‡æœªçŸ¥ç”¨æˆ·çš„ Web åº”ç”¨åœºæ™¯ä¸­å°¤å…¶é‡è¦ã€‚</p><h3 id="request-path" tabindex="-1"><a class="header-anchor" href="#request-path"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestpath" target="_blank" rel="noopener noreferrer">request.path</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æä¾›äº†åˆ›å»ºæœåŠ¡å™¨å’Œå¤„ç†ç½‘ç»œè¯·æ±‚çš„èƒ½åŠ›ã€‚ç†è§£ <code>request.path</code> å¯¹äºåˆ›å»ºåŠ¨æ€å“åº”æœåŠ¡å™¨å°¤å…¶é‡è¦ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-request-path" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-request-path"><span>ä»€ä¹ˆæ˜¯ <code>request.path</code>ï¼Ÿ</span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º <code>http</code> æ¨¡å—ä¸­çš„ <code>request.path</code> å±æ€§æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯å¯¹æœåŠ¡å™¨å‘èµ·çš„ HTTP è¯·æ±‚ä¸­ URL çš„è·¯å¾„éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªå±æ€§å…è®¸ä½ è·å–ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ é‡Œè¾“å…¥æˆ–ç‚¹å‡»é“¾æ¥æ—¶è¯·æ±‚çš„å…·ä½“é¡µé¢æˆ–èµ„æºçš„è·¯å¾„ã€‚</p><p>æ¯æ¬¡ HTTP è¯·æ±‚éƒ½ç”±å‡ ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼ŒåŒ…æ‹¬æ–¹æ³•ï¼ˆå¦‚ GETã€POSTï¼‰ã€å¤´éƒ¨ï¼ˆHeadersï¼‰ã€ä»¥åŠè¯·æ±‚çš„ URLã€‚è¿™ä¸ª URL å¯ä»¥è¿›ä¸€æ­¥åˆ†è§£ä¸ºåè®®ã€ä¸»æœºåã€ç«¯å£å·ã€è·¯å¾„ä»¥åŠæŸ¥è¯¢å­—ç¬¦ä¸²ç­‰ã€‚å…¶ä¸­ï¼Œ<code>request.path</code> ä¸“æŒ‡ URL ä¸­çš„è·¯å¾„éƒ¨åˆ†ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-request-path-é‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-request-path-é‡è¦"><span>ä¸ºä»€ä¹ˆ <code>request.path</code> é‡è¦ï¼Ÿ</span></a></h3><p>åˆ©ç”¨ <code>request.path</code>ï¼ŒæœåŠ¡å™¨å¯ä»¥ç¡®å®šç”¨æˆ·æƒ³è¦è®¿é—®çš„èµ„æºæˆ–é¡µé¢ï¼Œä»è€Œåšå‡ºç›¸åº”çš„å¤„ç†æˆ–å“åº”ã€‚è¿™æ˜¯æ„å»ºåŠ¨æ€ç½‘ç«™å’Œåº”ç”¨çš„åŸºç¡€ä¹‹ä¸€ï¼Œæœ‰åŠ©äºå®ç°è·¯ç”±æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®ä¸åŒçš„è·¯å¾„è¿”å›ä¸åŒçš„å†…å®¹æˆ–é¡µé¢ã€‚</p><h3 id="å®é™…è¿ç”¨å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨å®ä¾‹"><span>å®é™…è¿ç”¨å®ä¾‹</span></a></h3><p>ä¸‹é¢é€šè¿‡å‡ ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ <code>request.path</code> åœ¨å®é™…åº”ç”¨ä¸­çš„ä½œç”¨ï¼š</p><h4 id="ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨-æ ¹æ®ä¸åŒçš„è·¯å¾„è¿”å›ä¸åŒçš„æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨-æ ¹æ®ä¸åŒçš„è·¯å¾„è¿”å›ä¸åŒçš„æ¶ˆæ¯"><span>ç¤ºä¾‹ 1: åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œæ ¹æ®ä¸åŒçš„è·¯å¾„è¿”å›ä¸åŒçš„æ¶ˆæ¯</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è·å–è¯·æ±‚çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ ¹æ®ä¸åŒçš„è·¯å¾„è¿”å›ä¸åŒçš„å“åº”</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">path</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/welcome</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to our website!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">path</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/about</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">About Us</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">404</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Page not found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£å· 3000</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç›‘å¬ 3000 ç«¯å£ã€‚å½“ä½ é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://localhost:3000/welcome</code> æ—¶ï¼Œå› ä¸ºè·¯å¾„åŒ¹é… <code>/welcome</code>ï¼ŒæœåŠ¡å™¨è¿”å›â€œWelcome to our website!â€ã€‚ç±»ä¼¼åœ°ï¼Œè®¿é—® <code>http://localhost:3000/about</code> æ—¶è¿”å›â€œAbout Usâ€ï¼Œè€Œè®¿é—®å…¶ä»–è·¯å¾„åˆ™æç¤ºé¡µé¢æ‰¾ä¸åˆ°ã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨-express-æ¡†æ¶ç®€åŒ–è·¯ç”±å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨-express-æ¡†æ¶ç®€åŒ–è·¯ç”±å¤„ç†"><span>ç¤ºä¾‹ 2: ä½¿ç”¨ Express æ¡†æ¶ç®€åŒ–è·¯ç”±å¤„ç†</span></a></h4><p>Express æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„ Web åº”ç”¨æ¡†æ¶ï¼Œå®ƒæä¾›äº†æ›´åŠ å¼ºå¤§å’Œçµæ´»çš„è·¯ç”±å¤„ç†èƒ½åŠ›ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> express</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> app</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> express</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/welcome</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to our Express server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/about</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">About Us - Express Version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">use</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">status</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">404</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Page not found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Express server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Express æ¡†æ¶æ¥æ›´ç®€æ´åœ°å®šä¹‰è·¯ç”±ã€‚é€šè¿‡ <code>app.get</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„è·¯å¾„è®¾ç½®å¤„ç†å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„è·¯ç”±ï¼Œ<code>app.use</code> æ–¹æ³•ä¼šæ•è·æ‰€æœ‰å‰©ä½™çš„è¯·æ±‚å¹¶è¿”å› 404 çŠ¶æ€ç ï¼Œè¡¨ç¤ºé¡µé¢æœªæ‰¾åˆ°ã€‚</p><p>é€šè¿‡ä»¥ä¸Šç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>request.path</code>ï¼ˆæˆ–åœ¨ Express ä¸­ç®€åŒ–çš„è·¯å¾„å®šä¹‰ï¼‰å¦‚ä½•å¸®åŠ©æˆ‘ä»¬æ ¹æ®ä¸åŒçš„è¯·æ±‚è·¯å¾„è¿”å›ä¸åŒçš„å†…å®¹ï¼Œè¿™æ˜¯æ„å»ºåŠ¨æ€ç½‘ç«™å’Œåº”ç”¨çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚</p><h3 id="request-method" tabindex="-1"><a class="header-anchor" href="#request-method"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestmethod" target="_blank" rel="noopener noreferrer">request.method</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨åŒä¸€ç§è¯­è¨€æ¥ç¼–å†™å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ç«¯ï¼‰å’ŒæœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æ˜¯ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œç”¨äºåˆ›å»º HTTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚å½“åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œä¼šç”¨åˆ° <code>http.createServer()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶æ¯æ¬¡æ”¶åˆ°è¯·æ±‚ã€‚æœåŠ¡å™¨å¯¹è±¡ä¼šå“åº” <code>&#39;request&#39;</code> äº‹ä»¶ï¼Œå¹¶ä¼ é€’ä¸¤ä¸ªå¯¹è±¡ï¼š<code>request</code> å’Œ <code>response</code>ã€‚<code>request</code> å¯¹è±¡åŒ…å«äº†è¯·æ±‚ï¼ˆå®¢æˆ·ç«¯å‘ç»™æœåŠ¡å™¨ç«¯çš„ä¿¡æ¯ï¼‰ï¼Œè€Œ <code>response</code> å¯¹è±¡ç”¨æ¥æ„å»ºå¹¶å‘é€å›æœåŠ¡å™¨çš„å“åº”ã€‚</p><p><code>request.method</code> å°±æ˜¯ <code>request</code> å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œè¡¨ç¤ºäº†å®¢æˆ·ç«¯è¯·æ±‚çš„ HTTP æ–¹æ³•ç±»å‹ã€‚ä¸»è¦çš„ HTTP æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><code>GET</code>: è¯·æ±‚è·å–æŒ‡å®šèµ„æºã€‚</li><li><code>POST</code>: å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚</li><li><code>PUT</code>: ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹ã€‚</li><li><code>DELETE</code>: è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢ã€‚</li><li><code>HEAD</code>: ç±»ä¼¼äº GET æ–¹æ³•ï¼Œä½†ä¸è¿”å›å“åº”ä½“ï¼Œé€šå¸¸ç”¨äºæµ‹è¯•è¶…é“¾æ¥çš„æœ‰æ•ˆæ€§ã€å¯è¾¾æ€§å’Œæœ€è¿‘æ˜¯å¦ä¿®æ”¹ã€‚</li><li><code>OPTIONS</code>: å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚</li></ul><p>ä¸‹é¢ä¸¾å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨"><span>ä¾‹å­ 1: åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ‰“å°è¯·æ±‚çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Requested method is: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ ¹æ®ä¸åŒçš„è¯·æ±‚æ–¹æ³•åšå‡ºä¸åŒçš„å“åº”</span></span>
<span class="line"><span style="color:#81A1C1;">  switch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    case</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received a GET request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      break;</span></span>
<span class="line"><span style="color:#81A1C1;">    case</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received a POST request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      break;</span></span>
<span class="line"><span style="color:#81A1C1;">    default</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received a </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> request</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„ç«¯å£ 3000ã€‚å¯¹äºæ¯ä¸ªæ¥æ”¶åˆ°çš„è¯·æ±‚ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰“å°å‡ºäº†è¯·æ±‚çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ <code>GET</code> æˆ– <code>POST</code>ï¼‰ï¼Œç„¶åæ ¹æ®è¯·æ±‚çš„æ–¹æ³•ç±»å‹è¿”å›äº†ä¸åŒçš„å“åº”ã€‚</p><h3 id="ä¾‹å­-2-å¤„ç†ä¸åŒç±»å‹çš„-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å¤„ç†ä¸åŒç±»å‹çš„-http-è¯·æ±‚"><span>ä¾‹å­ 2: å¤„ç†ä¸åŒç±»å‹çš„ HTTP è¯·æ±‚</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç† GET è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">You sent a GET request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç† POST è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> body</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      body</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å°† Buffer è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">You sent a POST request with data: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">body</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å…¶ä»–ç±»å‹çš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">405</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> is not allowed</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¤„ç†äº† <code>GET</code> å’Œ <code>POST</code> è¯·æ±‚ã€‚å¯¹äº <code>GET</code> è¯·æ±‚ï¼Œæˆ‘ä»¬ç›´æ¥å‘é€äº†ä¸€ä¸ªå“åº”ã€‚å¯¹äº <code>POST</code> è¯·æ±‚ï¼Œæˆ‘ä»¬æ”¶é›†äº†è¯·æ±‚ä½“ä¸­çš„æ•°æ®ï¼Œå¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å…¶ä»–ç±»å‹çš„è¯·æ±‚åˆ™è¿”å›äº†ä¸€ä¸ª <code>405 Method Not Allowed</code> çŠ¶æ€ç ã€‚</p><h3 id="request-host" tabindex="-1"><a class="header-anchor" href="#request-host"><span><a href="https://nodejs.org/docs/latest/api/http.html#requesthost" target="_blank" rel="noopener noreferrer">request.host</a></span></a></h3><p><code>request.host</code> æ˜¯ Node.js http æ¨¡å—ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå¯ä»¥ç”¨äºè·å–å½“å‰è¯·æ±‚çš„ä¸»æœºåï¼ˆhostï¼‰ã€‚åœ¨ HTTP è¯·æ±‚ä¸­ï¼Œä¸»æœºåé€šå¸¸æ¥è‡ªè¯·æ±‚å¤´ä¸­çš„ <code>Host</code> å­—æ®µã€‚è¿™ä¸ªå­—æ®µæŒ‡ç¤ºäº†å®¢æˆ·ç«¯æƒ³è¦è¿æ¥çš„æœåŠ¡å™¨çš„åŸŸåæˆ–è€… IP åœ°å€åŠç«¯å£å·ã€‚</p><p>å½“ä½ åœ¨ Node.js ä¸­ä½¿ç”¨ http æ¨¡å—åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯·æ±‚å¯¹è±¡ï¼ˆé€šå¸¸å‘½åä¸º <code>req</code> æˆ–è€… <code>request</code>ï¼‰æ¥è®¿é—® <code>request.host</code>ã€‚è¿™ä¸ªå±æ€§å°†è¿”å›è¯·æ±‚ä¸­çš„ <code>Host</code> å¤´éƒ¨çš„å†…å®¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ <code>request.host</code> çš„ä¸€äº›æ­¥éª¤å’Œä¾‹å­ï¼š</p><h3 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨"><span>åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ Node.js çš„ <code>http</code> æ¨¡å—ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æœ‰è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è®¿é—®-request-host" tabindex="-1"><a class="header-anchor" href="#è®¿é—®-request-host"><span>è®¿é—® <code>request.host</code></span></a></h3><p>åœ¨åˆ›å»ºçš„æœåŠ¡å™¨ä¸­ï¼Œä½ å¯ä»¥è®¿é—® <code>req.host</code> æ¥è·å–è¯·æ±‚çš„ Host å¤´éƒ¨çš„å€¼ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¿é—®è¯·æ±‚çš„ Host å¤´éƒ¨</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> host</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">host</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ‰“å°å‡ºè¯·æ±‚çš„ Host å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">host</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å®¢æˆ·ç«¯å‘é€å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è®¾ç½®çŠ¶æ€ç ä¸º 200ï¼ˆæˆåŠŸï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è®¾ç½®å“åº”å¤´éƒ¨çš„å†…å®¹ç±»å‹</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€å“åº”å†…å®¹å¹¶ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-7"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œäº†ä¸Šé¢çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨æµè§ˆå™¨è®¿é—® <code>http://localhost:3000</code>ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œ<code>req.host</code> å°†åŒ…å« <code>&quot;localhost:3000&quot;</code>ï¼Œå› ä¸ºè¿™æ˜¯ä½ åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥çš„ä¸»æœºåå’Œç«¯å£å·ã€‚</p><p>å®é™…ä¸Šï¼Œ<code>request.host</code> çš„ç”¨é€”å¯èƒ½å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š</p><ol><li><p><strong>è™šæ‹Ÿä¸»æœºï¼ˆVirtual Hostingï¼‰</strong>ï¼šæ ¹æ®ä¸åŒçš„ <code>Host</code> å¤´éƒ¨åˆ†é…è¯·æ±‚åˆ°ä¸åŒçš„ç½‘ç«™å†…å®¹ã€‚å¦‚æœä½ çš„æœåŠ¡å™¨æ‰˜ç®¡äº†å¤šä¸ªç½‘ç«™ï¼Œä½ å¯ä»¥æ£€æŸ¥ <code>req.host</code> æ¥ç¡®å®šå®¢æˆ·ç«¯æƒ³è¦è®¿é—®å“ªä¸ªç½‘ç«™ï¼Œå¹¶ç›¸åº”åœ°æä¾›ä¸åŒçš„å†…å®¹ã€‚</p></li><li><p><strong>å®‰å…¨æ£€æŸ¥</strong>ï¼šç¡®ä¿è¯·æ±‚æ­£åœ¨é€šè¿‡é¢„æœŸçš„ä¸»æœºåè®¿é—®ä½ çš„æœåŠ¡ï¼Œé˜²æ­¢ HTTP Host å¤´éƒ¨æ”»å‡»ã€‚</p></li><li><p><strong>é‡å®šå‘</strong>ï¼šåŸºäºè¯·æ±‚çš„ä¸»æœºåè¿›è¡Œé‡å®šå‘ï¼Œä¾‹å¦‚ä»æ—§çš„åŸŸåè½¬ç§»åˆ°æ–°çš„åŸŸåã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œ<code>request.host</code> å·²åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨ <code>req.headers.host</code> æ›¿ä»£ä»¥è·å–åŒæ ·çš„ä¿¡æ¯ï¼Œå› ä¸ºè¿™æ˜¯æ›´æ ‡å‡†çš„æ–¹å¼æ¥è·å–è¯·æ±‚å¤´éƒ¨ä¿¡æ¯ã€‚è€Œä¸”ï¼Œåœ¨å¤„ç†å®é™…éƒ¨ç½²çš„ web åº”ç”¨ç¨‹åºæ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åˆ°ä»£ç†å’Œè´Ÿè½½å¹³è¡¡å™¨å¯èƒ½å¯¹åŸå§‹çš„ Host å¤´éƒ¨è¿›è¡Œä¿®æ”¹çš„æƒ…å†µã€‚</p><h3 id="request-protocol" tabindex="-1"><a class="header-anchor" href="#request-protocol"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestprotocol" target="_blank" rel="noopener noreferrer">request.protocol</a></span></a></h3><p>è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Node.js æ˜¯ä»€ä¹ˆã€‚Node.js æ˜¯ä¸€ä¸ªå¼€æºå’Œè·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿå¤„ç† HTTP è¯·æ±‚ã€è®¿é—®æ•°æ®åº“ä»¥åŠæ›´å¤šåç«¯ä»»åŠ¡çš„ç¨‹åºã€‚</p><p>åœ¨æ¢ç´¢ <code>request.protocol</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç™½ HTTP è¯·æ±‚æ˜¯å¦‚ä½•åœ¨å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ä¿¡æ¯çš„ã€‚å½“ä½ åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ä¸€ä¸ªç½‘å€å¹¶æŒ‰ä¸‹å›è½¦æ—¶ï¼Œä½ çš„æµè§ˆå™¨å°±ä¼šå‘å¯¹åº”çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚ä¼šå‘Šè¯‰æœåŠ¡å™¨ä½ æƒ³è¦è·å–æˆ–å‘é€ç»™æœåŠ¡å™¨çš„ä¿¡æ¯ç±»å‹ã€‚</p><p>ç°åœ¨ï¼Œè°ˆè°ˆ <code>request.protocol</code> è¿™ä¸ªæ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ Node.js çš„ HTTP æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ª web æœåŠ¡å™¨æ—¶ï¼Œæ¯å½“æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå®ƒéƒ½ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«å„ç§å±æ€§çš„è¯·æ±‚ï¼ˆrequestï¼‰å¯¹è±¡ã€‚è¿™ä¸ªè¯·æ±‚å¯¹è±¡åŒ…å«äº†å…³äºè¯¥è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ URLã€è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰å’Œå¤´ä¿¡æ¯ç­‰ã€‚</p><p>å…¶ä¸­ <code>request.protocol</code> å±æ€§å°±æ˜¯ç”¨æ¥è·å–å½“å‰è¯·æ±‚æ‰€ä½¿ç”¨çš„åè®®ç±»å‹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¼šæ˜¯ <code>http:</code> æˆ– <code>https:</code>ã€‚è¿™å¯¹äºç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†ä¸åŒç±»å‹çš„è¯·æ±‚éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦åŒºåˆ†å®‰å…¨è¿æ¥ï¼ˆHTTPSï¼‰å’Œéå®‰å…¨è¿æ¥ï¼ˆHTTPï¼‰æ—¶ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-8"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œä½ æƒ³è¦ç¡®ä¿æŸäº›ä¿¡æ¯åªé€šè¿‡å®‰å…¨çš„ HTTPS åè®®ä¼ è¾“ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>request.protocol</code> æ¥æ£€æŸ¥è¯·æ±‚æ˜¯é€šè¿‡ HTTP è¿˜æ˜¯ HTTPS å‘é€çš„ï¼Œå¹¶æ®æ­¤åšå‡ºé€‚å½“çš„å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">protocol</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">https:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Secure request received.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // å¤„ç†å®‰å…¨è¯·æ±‚çš„é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Insecure request received.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // å¯ä»¥é€‰æ‹©é‡å®šå‘åˆ° HTTPS æˆ–å¤„ç†éå®‰å…¨è¯·æ±‚çš„é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨äº† HTTP æ¨¡å—æ¥åˆ›å»ºæœåŠ¡å™¨ï¼Œè€Œå®é™…ä¸Šï¼Œ<code>request.protocol</code> ç›´æ¥ç”¨è¿™ç§æ–¹å¼å¯èƒ½ä¸ä¼šå·¥ä½œï¼Œå› ä¸ºå®ƒé€šå¸¸æ˜¯åœ¨ä½¿ç”¨åƒ Express è¿™æ ·çš„æ¡†æ¶æ—¶æ‰å¯ç”¨çš„é«˜çº§åŠŸèƒ½ã€‚åœ¨åŸç”Ÿçš„ Node.js HTTP æ¨¡å—ä¸­ï¼Œä½ å¯èƒ½éœ€è¦è‡ªå·±è§£æè¯·æ±‚çš„ URL æ¥ç¡®å®šåè®®ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªä¾‹å­çš„ç›®çš„æ˜¯å¸®åŠ©ä½ ç†è§£ <code>request.protocol</code> çš„ç”¨é€”ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Express æˆ–å…¶ä»–æ¡†æ¶ï¼Œå®ƒä»¬å¯èƒ½ä¼šæä¾›æ›´ç®€ä¾¿çš„æ–¹å¼æ¥è®¿é—®ç±»ä¼¼çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨ Express ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>req.protocol</code> æ¥è·å–è¯·æ±‚çš„åè®®ç±»å‹ã€‚</p><p>å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Node.js ä¸­çš„ <code>request.protocol</code> å’Œå®ƒçš„æ½œåœ¨ç”¨é€”ï¼</p><h3 id="request-removeheader-name" tabindex="-1"><a class="header-anchor" href="#request-removeheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestremoveheadername" target="_blank" rel="noopener noreferrer">request.removeHeader(name)</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>request.removeHeader(name)</code>æ˜¯ä¸€ä¸ªç”¨äºç§»é™¤ä¹‹å‰åœ¨ HTTP è¯·æ±‚å¤´ä¸­è®¾ç½®çš„æŒ‡å®š header çš„å‡½æ•°ã€‚å½“ä½ åœ¨ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ª HTTP å®¢æˆ·ç«¯æ¥å‘é€è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ HTTP è¯·æ±‚å¤´ï¼ˆHTTP request headersï¼‰ã€‚åœ¨ HTTP é€šä¿¡ä¸­ï¼Œè¯·æ±‚å¤´éƒ¨åˆ†åŒ…å«äº†å…³äºè¯·æ±‚æ¶ˆæ¯çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚è¢«å‘å¾€å“ªé‡Œã€å¸Œæœ›æœåŠ¡å™¨å¦‚ä½•å¤„ç†è¯·æ±‚ç­‰ã€‚å¸¸è§çš„è¯·æ±‚å¤´åŒ…æ‹¬<code>Content-Type</code>ï¼ˆå‘Šè¯‰æœåŠ¡å™¨æ­£æ–‡æ•°æ®çš„ç±»å‹ï¼‰ã€<code>Accept</code>ï¼ˆå®¢æˆ·ç«¯èƒ½å¤Ÿæ¥æ”¶çš„å†…å®¹ç±»å‹ï¼‰å’Œ<code>Authorization</code>ï¼ˆè®¤è¯ä¿¡æ¯ï¼‰ç­‰ã€‚</p><p>é‚£ä¹ˆï¼Œåœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œä¸ºä½•æˆ‘ä»¬éœ€è¦ç§»é™¤ä¸€ä¸ªå·²ç»è®¾å®šçš„ header å‘¢ï¼Ÿä»¥ä¸‹æ˜¯å‡ ç§å¯èƒ½çš„æƒ…å†µï¼š</p><ol><li><p><strong>åŠ¨æ€è°ƒæ•´ headers</strong>ï¼šåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®ä¸åŒçš„æ¡ä»¶åŠ¨æ€æ”¹å˜è¯·æ±‚çš„ headersã€‚å¦‚æœä½ äº‹å…ˆè®¾ç½®äº†ä¸€ä¸ª headerï¼Œç„¶ååŸºäºåç»­é€»è¾‘åˆ¤æ–­éœ€è¦åˆ é™¤å®ƒï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨<code>removeHeader</code>æ–¹æ³•ã€‚</p></li><li><p><strong>å®‰å…¨è€ƒè™‘</strong>ï¼šåœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œå‡ºäºå®‰å…¨åŸå› ï¼Œå¯èƒ½éœ€è¦ç§»é™¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ headersï¼Œé˜²æ­¢è¿™äº›ä¿¡æ¯è¢«ä¼ é€åˆ°æœåŠ¡å™¨æˆ–è€…å…¬å¼€ã€‚</p></li><li><p><strong>é¿å…é”™è¯¯</strong>ï¼šå¦‚æœé”™è¯¯åœ°è®¾ç½®äº†ä¸€ä¸ª headerï¼Œæˆ–è€…è®¾ç½®äº†ä¸å¿…è¦çš„ headerï¼Œä½¿ç”¨<code>removeHeader</code>å¯ä»¥å°†å…¶ç§»é™¤ï¼Œä»¥ç¡®ä¿è¯·æ±‚åªåŒ…å«æ­£ç¡®å’Œå¿…è¦çš„ä¿¡æ¯ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js ç¨‹åºæ¥è®¿é—®ä¸€ä¸ª APIï¼Œå¹¶ä¸”ä½ éœ€è¦åœ¨å‘é€è¯·æ±‚ä¹‹å‰ä¿®æ”¹ headersã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPè¯·æ±‚é€‰é¡¹å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">/endpoint</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾ä½ äº‹å…ˆè®¾ç½®äº†ä¸€ä¸ªè‡ªå®šä¹‰å¤´&#39;X-Custom-Header&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">    &#39;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">my-custom-value</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &#39;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºè¯·æ±‚å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¤„ç†æœåŠ¡å™¨çš„å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åŸºäºæŸäº›é€»è¾‘å†³å®šæ˜¯å¦ç§»é™¤&#39;X-Custom-Header&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#616E88;">/* some condition */</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†<code>http</code>æ¨¡å—ï¼Œå¹¶è®¾ç½®äº†è¯·æ±‚çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„ç›®æ ‡åœ°å€ã€ç«¯å£ã€è·¯å¾„ã€æ–¹æ³•å’Œ headersã€‚åœ¨ headers ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ header <code>&#39;X-Custom-Header&#39;</code>ã€‚ä¹‹ååˆ›å»ºäº†ä¸€ä¸ªè¯·æ±‚å¯¹è±¡<code>req</code>ï¼Œä½†åœ¨å‘é€(<code>req.end()</code>)ä¹‹å‰ï¼Œæˆ‘ä»¬æ ¹æ®æŸäº›æ¡ä»¶åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»é™¤<code>&#39;X-Custom-Header&#39;</code>ã€‚å¦‚æœéœ€è¦ç§»é™¤ï¼Œæˆ‘ä»¬è°ƒç”¨äº†<code>req.removeHeader(&#39;X-Custom-Header&#39;)</code>ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨<code>removeHeader</code>æ¥åŠ¨æ€æ§åˆ¶ HTTP è¯·æ±‚å¤´ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨å¼€å‘å¤æ‚çš„ HTTP å®¢æˆ·ç«¯æˆ–ä¸å¤–éƒ¨æœåŠ¡äº¤äº’æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="request-reusedsocket" tabindex="-1"><a class="header-anchor" href="#request-reusedsocket"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestreusedsocket" target="_blank" rel="noopener noreferrer">request.reusedSocket</a></span></a></h3><p>äº†è§£<code>request.reusedSocket</code>ä¹‹å‰ï¼Œå…ˆè¦çŸ¥é“ Node.js ä¸­çš„ HTTP æ¨¡å—æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚HTTP æ¨¡å—å…è®¸ Node.js è½»æ¾åœ°å¤„ç†ç½‘ç»œè¯·æ±‚ä¸å“åº”ã€‚è€Œåœ¨å¤„ç†è¿™äº›ç½‘ç»œè¯·æ±‚æ—¶ï¼Œæ€§èƒ½å’Œæ•ˆç‡éå¸¸å…³é”®ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯request-reusedsocket" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯request-reusedsocket"><span>ä»€ä¹ˆæ˜¯<code>request.reusedSocket</code>?</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>request.reusedSocket</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥æŒ‡ç¤ºå¯¹ç‰¹å®šè¯·æ±‚è€Œè¨€ï¼Œå…¶åº•å±‚çš„ TCP è¿æ¥æ˜¯å¦è¢«é‡ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå‘Šè¯‰ä½ è¿™ä¸ª HTTP è¯·æ±‚æ˜¯å¦ä½¿ç”¨äº†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ã€ä¹‹å‰å»ºç«‹å¥½çš„ç½‘ç»œè¿æ¥ï¼Œè€Œä¸æ˜¯æ‰“å¼€ä¸€ä¸ªå…¨æ–°çš„è¿æ¥ã€‚</p><h3 id="tcp-è¿æ¥å’Œé‡ç”¨" tabindex="-1"><a class="header-anchor" href="#tcp-è¿æ¥å’Œé‡ç”¨"><span>TCP è¿æ¥å’Œé‡ç”¨</span></a></h3><p>ä¸ºäº†ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œéœ€è¦å…ˆæ˜ç™½ TCP è¿æ¥çš„åŸºç¡€ã€‚TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„åè®®ã€‚å½“å®¢æˆ·ç«¯æƒ³ä¸æœåŠ¡å™¨é€šä¿¡æ—¶ï¼Œå®ƒä»¬ä¹‹é—´ä¼šå…ˆå»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹åˆç§°ä¸ºä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p>æ¯æ¬¡ä½ çš„åº”ç”¨å‘èµ·ä¸€ä¸ªæ–°çš„ HTTP è¯·æ±‚ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨è¿æ¥é‡ç”¨ï¼Œå°±ä¼šè¿›è¡Œä¸€æ¬¡æ–°çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ï¼Œæ•°æ®äº¤æ¢å®Œæˆåå†é€šè¿‡å››æ¬¡æŒ¥æ‰‹å…³é—­è¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹è™½ç„¶å¯é ï¼Œä½†ç›¸å¯¹è€—æ—¶è€—èµ„æºã€‚</p><p>ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒHTTP/1.1 å¼•å…¥äº†æŒä¹…è¿æ¥ï¼ˆä¹Ÿç§°ä¸º HTTP Keep-Aliveï¼‰ï¼Œå…è®¸åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå‘é€å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹è¿æ¥ã€‚HTTP/2 æ›´è¿›ä¸€æ­¥ï¼Œæ”¯æŒåœ¨å•ä¸€è¿æ¥ä¸Šå¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚</p><p><code>request.reusedSocket</code>å±æ€§å°±æ˜¯åŸºäºè¿™æ ·çš„èƒŒæ™¯ã€‚å¦‚æœè¿™ä¸ªå±æ€§å€¼ä¸º<code>true</code>ï¼Œé‚£ä¹ˆè¡¨ç¤ºå½“å‰çš„ HTTP è¯·æ±‚ä½¿ç”¨äº†ä¸€ä¸ªå·²å­˜åœ¨çš„ TCP è¿æ¥ï¼›å¦‚æœä¸º<code>false</code>ï¼Œåˆ™è¡¨ç¤ºä¸ºæ­¤è¯·æ±‚æ–°å»ºäº†ä¸€ä¸ª TCP è¿æ¥ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦é¢‘ç¹åœ°ä»åŒä¸€ä¸ª API è·å–æ•°æ®ã€‚å¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ï¼Œå°†å¤§å¤§å¢åŠ å“åº”æ—¶é—´å’Œèµ„æºæ¶ˆè€—ã€‚</p><ol><li><p><strong>API å®¢æˆ·ç«¯</strong>ï¼šä½ ç¼–å†™äº†ä¸€ä¸ªæœåŠ¡ï¼Œéœ€è¦é¢‘ç¹è°ƒç”¨ç¬¬ä¸‰æ–¹ API è·å–å¤©æ°”ä¿¡æ¯ã€‚å¯ç”¨ HTTP Keep-Aliveï¼Œå¯ä»¥è®©ä½ çš„æœåŠ¡åœ¨åˆæ¬¡ä¸ API å»ºç«‹è¿æ¥åï¼Œç»§ç»­å¤ç”¨è¯¥è¿æ¥è¿›è¡Œåç»­è¯·æ±‚ï¼Œå‡å°‘äº†è¿æ¥å»ºç«‹æ‰€éœ€çš„æ—¶é—´ï¼Œæé«˜äº†æ•´ä½“çš„è¯·æ±‚æ•ˆç‡ã€‚</p></li><li><p><strong>Web çˆ¬è™«</strong>ï¼šå¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªçˆ¬è™«ç¨‹åºï¼Œç›®æ ‡æ˜¯æŠ“å–æŸç½‘ç«™çš„æ•°æ®ã€‚è¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰é¡µé¢éƒ½åœ¨åŒä¸€åŸŸåä¸‹ã€‚é€šè¿‡ä¿æŒè¿æ¥é‡ç”¨ï¼Œä½ çš„çˆ¬è™«å¯ä»¥æ›´å¿«åœ°æŠ“å–åˆ°æ•°æ®ï¼ŒåŒæ—¶å¯¹ç›®æ ‡æœåŠ¡å™¨çš„å‹åŠ›ä¹Ÿå°ä¸€äº›ã€‚</p></li><li><p><strong>å¾®æœåŠ¡é—´é€šä¿¡</strong>ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡æ˜¯å¸¸è§çš„æƒ…å†µã€‚å¦‚æœæ¯ä¸ªæœåŠ¡ä¹‹é—´çš„è¯·æ±‚éƒ½é‡ç”¨ TCP è¿æ¥ï¼Œé‚£ä¹ˆé€šä¿¡æ•ˆç‡å°†å¾—åˆ°æ˜¾è‘—æå‡ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ã€‚</p></li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>request.reusedSocket</code>å±æ€§å¸®åŠ©å¼€å‘è€…äº†è§£è¯·æ±‚æ˜¯å¦ä½¿ç”¨äº†æŒä¹…è¿æ¥ï¼Œè¿™å¯¹äºä¼˜åŒ–ç½‘ç»œè¯·æ±‚æ€§èƒ½ï¼Œå‡å°‘å»¶è¿Ÿå’Œèµ„æºæ¶ˆè€—éå¸¸æœ‰å¸®åŠ©ã€‚åœ¨è®¾è®¡é«˜æ•ˆå’Œå¯æ‰©å±•çš„ Node.js åº”ç”¨æ—¶ï¼Œåˆç†åˆ©ç”¨å·²æœ‰çš„ TCP è¿æ¥è‡³å…³é‡è¦ã€‚</p><h3 id="request-setheader-name-value" tabindex="-1"><a class="header-anchor" href="#request-setheader-name-value"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestsetheadername-value" target="_blank" rel="noopener noreferrer">request.setHeader(name, value)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦é€šè¿‡ HTTP åè®®ä¸å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰æˆ–å…¶ä»–æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤æ¢ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè®¾ç½® HTTP è¯·æ±‚çš„å¤´éƒ¨ä¿¡æ¯ï¼ˆheadersï¼‰æ˜¯éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åŒ…å«å…³äºè¯·æ±‚å’Œå“åº”çš„é‡è¦å…ƒæ•°æ®ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ã€èº«ä»½éªŒè¯ä¿¡æ¯ç­‰ã€‚</p><p><code>request.setHeader(name, value)</code>è¿™ä¸ªæ–¹æ³•å…è®¸ä½ åœ¨å‘é€ HTTP è¯·æ±‚æ—¶è®¾ç½®å•ä¸ªè¯·æ±‚å¤´çš„å€¼ã€‚è¿™é‡Œçš„<code>request</code>æ˜¯æŒ‡ä¸€ä¸ª HTTP è¯·æ±‚å¯¹è±¡ï¼Œè€Œ<code>name</code>å’Œ<code>value</code>åˆ†åˆ«ä»£è¡¨è¯·æ±‚å¤´åç§°å’Œå€¼ã€‚</p><h3 id="æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#æ ¼å¼"><span>æ ¼å¼</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-9"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-è®¾ç½®å†…å®¹ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_1-è®¾ç½®å†…å®¹ç±»å‹"><span>1. è®¾ç½®å†…å®¹ç±»å‹</span></a></h4><p>å½“ä½ æƒ³å‘é€ JSON æ•°æ®åˆ°æœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦å‘Šè¯‰æœåŠ¡å™¨ï¼Œå‘é€çš„æ­£æ–‡ï¼ˆbodyï¼‰æ˜¯ JSON æ ¼å¼çš„ã€‚è¿™æ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>setHeader</code>æ¥è®¾ç½®<code>Content-Type</code>ä¸º<code>application/json</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPè¯·æ±‚é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†å“åº”çš„ä»£ç ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¯·æ±‚å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€è¯·æ±‚ä½“ï¼ˆä¾‹å¦‚JSONå­—ç¬¦ä¸²ï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> password</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">123456</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-è®¾ç½®æˆæƒå¤´éƒ¨" tabindex="-1"><a class="header-anchor" href="#_2-è®¾ç½®æˆæƒå¤´éƒ¨"><span>2. è®¾ç½®æˆæƒå¤´éƒ¨</span></a></h4><p>å¦‚æœä½ æ­£åœ¨è®¿é—®ä¸€ä¸ªéœ€è¦è®¤è¯çš„ APIï¼Œé€šå¸¸éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ä¸€ä¸ªæˆæƒä»¤ç‰Œã€‚å‡è®¾ API æœŸå¾…ä¸€ä¸ª Bearer ä»¤ç‰Œï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®è¯·æ±‚å¤´ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">api.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/user/profile</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†å“åº”...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ä½ çš„ä»¤ç‰Œæ˜¯&quot;abc123&quot;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Authorization</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Bearer abc123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-è‡ªå®šä¹‰å¤´éƒ¨" tabindex="-1"><a class="header-anchor" href="#_3-è‡ªå®šä¹‰å¤´éƒ¨"><span>3. è‡ªå®šä¹‰å¤´éƒ¨</span></a></h4><p>æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å‘è¯·æ±‚ä¸­æ·»åŠ è‡ªå®šä¹‰å¤´éƒ¨ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½éœ€è¦æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºè¯·æ±‚ ID çš„å¤´éƒ¨ï¼Œåœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­è·Ÿè¸ªè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yourserver.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/log</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†å“åº”...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è‡ªå®šä¹‰å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Request-ID</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Log this request with ID 12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>request.setHeader(name, value)</code>æ–¹æ³•åœ¨æ„å»º HTTP è¯·æ±‚æ—¶å¦‚ä½•æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œå…è®¸ä½ ç²¾ç¡®åœ°æ§åˆ¶è¯·æ±‚çš„å„ç§ç»†èŠ‚ã€‚è¿™å¯¹äºå¼€å‘ç°ä»£ Web åº”ç”¨å’Œ API æ¥å£è‡³å…³é‡è¦ã€‚</p><h3 id="request-setnodelay-nodelay" tabindex="-1"><a class="header-anchor" href="#request-setnodelay-nodelay"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestsetnodelaynodelay" target="_blank" rel="noopener noreferrer">request.setNoDelay([noDelay])</a></span></a></h3><p>åœ¨è§£é‡Š <code>request.setNoDelay([noDelay])</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ Node.jsã€HTTP è¯·æ±‚å’Œ TCP åè®®çš„ä¸€äº›åŸºç¡€ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-2"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><p><strong>Node.js</strong>:</p><ul><li>Node.js æ˜¯ä¸€ä¸ªå¯ä»¥è®©ä½ ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„è¿è¡Œç¯å¢ƒã€‚å®ƒä»¥å…¶éé˜»å¡ I/O (è¾“å…¥/è¾“å‡º) å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§è€Œé—»åï¼Œä½¿å¾—å®ƒç‰¹åˆ«é€‚åˆæ„å»ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</li></ul></li><li><p><strong>HTTP è¯·æ±‚</strong>:</p><ul><li>HTTP è¯·æ±‚æ˜¯å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å‘é€ç»™æœåŠ¡å™¨çš„æ¶ˆæ¯ï¼Œè¯·æ±‚æŸç§æ“ä½œï¼Œå¦‚è·å–ç½‘é¡µã€ä¸Šä¼ æ•°æ®ç­‰ã€‚å“åº”æ˜¯æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯ã€‚</li></ul></li><li><p><strong>TCP åè®®</strong>:</p><ul><li>TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„åè®®ã€‚å®ƒç¡®ä¿ä»æºåˆ°ç›®æ ‡çš„æ•°æ®ä¼ è¾“æ˜¯æŒ‰é¡ºåºä¸”æ— è¯¯å·®çš„ã€‚TCP å®ç°è¿™ä¸€ç‚¹çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨â€œTCP Nagle ç®—æ³•â€æ¥ç¼“å†²æ•°æ®ï¼Œä»¥å‡å°‘ç½‘ç»œä¸Šçš„å°åŒ…æ•°ç›®ã€‚</li></ul></li></ol><h3 id="request-setnodelay-nodelay-1" tabindex="-1"><a class="header-anchor" href="#request-setnodelay-nodelay-1"><span><code>request.setNoDelay([noDelay])</code></span></a></h3><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>request.setNoDelay([noDelay])</code> æ–¹æ³•å…è®¸ä½ æ§åˆ¶ TCP å¥—æ¥å­—ä¸Šçš„ Nagle ç®—æ³•æ˜¯å¦å¯ç”¨ã€‚</p><ul><li><p><strong>Nagle ç®—æ³•</strong>: ä¸ºäº†æé«˜ç½‘ç»œæ•ˆç‡ï¼Œè¯¥ç®—æ³•ä¼šç¼“å†²å°çš„æ•°æ®åŒ…ï¼Œç›´åˆ°æœ‰è¶³å¤Ÿçš„æ•°æ®å‘é€ä¸€ä¸ªæ›´å¤§çš„åŒ…ã€‚è¿™æ„å‘³ç€æ•°æ®å‘é€å¯èƒ½ä¼šç»å†çŸ­æš‚çš„å»¶è¿Ÿã€‚</p></li><li><p><strong>å‚æ•° <code>noDelay</code></strong>:</p><ul><li>å¦‚æœä½ è®¾ç½® <code>noDelay</code> ä¸º <code>true</code>ï¼Œé‚£ä¹ˆå°±ä¼šç¦ç”¨ Nagle ç®—æ³•ï¼Œå³æ•°æ®å°†ä¼šç«‹å³å‘é€ï¼Œä¸ç­‰å¾…ç¼“å†²åŒºå¡«æ»¡ã€‚</li><li>å¦‚æœè®¾ç½®ä¸º <code>false</code> æˆ–ä¸è®¾ç½®ï¼Œåˆ™å¯ç”¨ Nagle ç®—æ³•ï¼Œæ•°æ®å¯èƒ½ä¼šè¢«å»¶è¿Ÿå‘é€ï¼Œä»¥å‡‘è¶³ä¸€ä¸ªè¾ƒå¤§çš„æ•°æ®åŒ…ã€‚</li></ul></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-10"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®æ—¶èŠå¤©åº”ç”¨ï¼š</p><ol><li><p><strong>å®æ—¶æ€§è¦æ±‚é«˜</strong>:</p><ul><li>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½ å¸Œæœ›ç”¨æˆ·è¾“å…¥çš„æ¯ä¸€æ¡æ¶ˆæ¯éƒ½èƒ½å°½å¿«é€è¾¾ï¼Œå³ä½¿æ˜¯å¾ˆçŸ­çš„æ¶ˆæ¯ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>request.setNoDelay(true);</code> æ¥ç¡®ä¿æ¯æ¡æ¶ˆæ¯éƒ½ç«‹å³å‘é€ï¼Œè€Œä¸ä¼šå› ä¸º Nagle ç®—æ³•çš„ç¼“å†²è€Œå»¶è¿Ÿã€‚</li></ul></li><li><p><strong>æ•°æ®ä¼ è¾“ä¼˜åŒ–</strong>:</p><ul><li>å¦‚æœä½ çš„åº”ç”¨åœºæ™¯ä¸éœ€è¦æä½çš„é€šä¿¡å»¶è¿Ÿï¼Œæ¯”å¦‚åå°æ•°æ®åŒæ­¥ä»»åŠ¡ï¼Œå…è®¸ç¨å¾®çš„å»¶è¿Ÿå¯ä»¥é€šè¿‡å‡å°‘ç½‘ç»œåŒ…çš„æ•°é‡æ¥æé«˜æ•´ä½“ä¼ è¾“æ•ˆç‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„è¡Œä¸ºï¼ˆå³ä¸è°ƒç”¨ <code>setNoDelay</code> æˆ–è€…è°ƒç”¨ <code>request.setNoDelay(false);</code>ï¼‰å°±å¾ˆåˆé€‚ã€‚</li></ul></li></ol><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p><code>request.setNoDelay([noDelay])</code> æ–¹æ³•æä¾›äº†å¯¹ HTTP è¯·æ±‚åº•å±‚ TCP è¿æ¥çš„ç»†ç²’åº¦æ§åˆ¶ã€‚é€šè¿‡å¯ç”¨æˆ–ç¦ç”¨ Nagle ç®—æ³•ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ ¹æ®å…·ä½“åº”ç”¨çš„éœ€æ±‚ï¼Œåœ¨å»¶è¿Ÿå’Œç½‘ç»œæ•ˆç‡ä¹‹é—´åšå‡ºæƒè¡¡ã€‚</p><h3 id="request-setsocketkeepalive-enable-initialdelay" tabindex="-1"><a class="header-anchor" href="#request-setsocketkeepalive-enable-initialdelay"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestsetsocketkeepaliveenable-initialdelay" target="_blank" rel="noopener noreferrer">request.setSocketKeepAlive([enable][, initialDelay])</a></span></a></h3><p>Node.js ä¸­çš„ <code>request.setSocketKeepAlive([enable][, initialDelay])</code> æ–¹æ³•æ˜¯ç”¨äºé…ç½® HTTP è¯·æ±‚åœ¨ TCP å±‚é¢ä¸Šçš„ keep-alive è¡Œä¸ºã€‚è¿™ä¸ªæ–¹æ³•é€šè¿‡æ§åˆ¶ TCP è¿æ¥çš„æ´»è·ƒçŠ¶æ€ï¼Œæœ‰åŠ©äºæé«˜ç½‘ç»œé€šè®¯æ•ˆç‡å’Œå‡å°‘å»¶è¿Ÿã€‚ç°åœ¨ï¼Œæˆ‘å°†å°½å¯èƒ½ç®€å•åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼Œå¹¶æä¾›ä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-2"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨æ·±å…¥äº†è§£ <code>setSocketKeepAlive</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç™½å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ul><li><p><strong>TCP è¿æ¥</strong>ï¼šä¼ è¾“æ§åˆ¶åè®®ï¼ˆTCPï¼‰æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„åè®®ã€‚å®ƒç¡®ä¿æ•°æ®åŒ…æŒ‰é¡ºåºä¸”ä¸é‡å¤åœ°ä¼ é€ç»™æ¥æ”¶æ–¹ã€‚å»ºç«‹ TCP è¿æ¥æ¶‰åŠåˆ°ä¸€ä¸ªè¢«ç§°ä¸ºä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚</p></li><li><p><strong>Keep-Alive æœºåˆ¶</strong>ï¼šTCP Keep-Alive æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥æ£€æµ‹ä¸¤ä¸ª TCP è¿æ¥ç«¯ç‚¹ä¹‹é—´çš„è¿æ¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘¨æœŸæ€§åœ°å‘é€æ¢æµ‹æ•°æ®åŒ…æ¥å®ç°ï¼Œå¦‚æœåœ¨ç‰¹å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œè¿æ¥å°†è¢«è®¤ä¸ºå·²æ–­å¼€ã€‚</p></li><li><p><strong>HTTP è¯·æ±‚</strong>ï¼šHTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ç”¨äºä»æœåŠ¡å™¨è·å–ä¿¡æ¯æˆ–å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„åè®®ã€‚HTTP å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼Œæ¯å½“ä½ è®¿é—®ç½‘é¡µæ—¶ï¼Œä½ çš„æµè§ˆå™¨éƒ½ä¼šé€šè¿‡ HTTP å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ã€‚</p></li></ul><h3 id="ä½¿ç”¨-setsocketkeepalive" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-setsocketkeepalive"><span>ä½¿ç”¨ <code>setSocketKeepAlive</code></span></a></h3><p><code>request.setSocketKeepAlive([enable][, initialDelay])</code> å…è®¸ä½ ä¸ºæŒ‡å®šçš„ HTTP è¯·æ±‚è®¾ç½® TCP keep-alive è¡Œä¸ºã€‚å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li><code>enable</code>ï¼šå¸ƒå°”å€¼ï¼Œç”¨äºå¯ç”¨æˆ–ç¦ç”¨ keep-alive åŠŸèƒ½ã€‚å¦‚æœçœç•¥æ­¤å‚æ•°ï¼Œé»˜è®¤å°†å¯ç”¨ keep-aliveã€‚</li><li><code>initialDelay</code>ï¼šæ•°å­—ï¼Œè¡¨ç¤ºåœ¨å¤šé•¿æ—¶é—´åå¼€å§‹å‘é€ç¬¬ä¸€ä¸ª keep-alive åŒ…ã€‚å•ä½ä¸ºæ¯«ç§’ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å¯ç”¨-keep-alive-ä¸è®¾ç½®åˆå§‹å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å¯ç”¨-keep-alive-ä¸è®¾ç½®åˆå§‹å»¶è¿Ÿ"><span>ç¤ºä¾‹ 1ï¼šå¯ç”¨ Keep-Aliveï¼Œä¸è®¾ç½®åˆå§‹å»¶è¿Ÿ</span></a></h4><p>å½“ä½ æƒ³è¦ä¸º HTTP è¯·æ±‚å¯ç”¨ keep-alive åŠŸèƒ½ï¼Œä½†ä¸æŒ‡å®šå¼€å§‹å‘é€ keep-alive åŒ…çš„åˆå§‹å»¶è¿Ÿæ—¶ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPè¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯ç”¨Keep-Aliveï¼Œä¸æŒ‡å®šåˆå§‹å»¶è¿Ÿ</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setSocketKeepAlive</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">true</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œkeep-alive è¢«å¯ç”¨äº†ï¼Œè¿™æ„å‘³ç€åœ¨è¯·æ±‚å®Œæˆåï¼ŒTCP è¿æ¥å°†å°½å¯èƒ½ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä»¥ä¾¿æœªæ¥çš„è¯·æ±‚å¯ä»¥é‡ç”¨è¯¥è¿æ¥ï¼Œå‡å°‘äº†å»ºç«‹æ–°è¿æ¥çš„æˆæœ¬ã€‚</p><h4 id="ç¤ºä¾‹-2-å¯ç”¨-keep-alive-å¹¶è®¾ç½®åˆå§‹å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¯ç”¨-keep-alive-å¹¶è®¾ç½®åˆå§‹å»¶è¿Ÿ"><span>ç¤ºä¾‹ 2ï¼šå¯ç”¨ Keep-Alive å¹¶è®¾ç½®åˆå§‹å»¶è¿Ÿ</span></a></h4><p>å¦‚æœä½ æƒ³è¦æ›´ç²¾ç»†åœ°æ§åˆ¶ keep-alive è¡Œä¸ºï¼Œæ¯”å¦‚åœ¨è¯·æ±‚å®Œæˆ 30 ç§’åæ‰å¼€å§‹å‘é€ keep-alive åŒ…ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPè¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯ç”¨Keep-Aliveï¼Œå¹¶è®¾ç½®30ç§’åå¼€å§‹å‘é€keep-aliveåŒ…</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setSocketKeepAlive</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">true</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 30000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç¤ºä¾‹éå¸¸é€‚åˆäºé‚£äº›å¸Œæœ›åœ¨ä¿æŒ TCP è¿æ¥å¼€æ”¾ä¸€æ®µæ—¶é—´åæ‰å¼€å§‹è¿›è¡Œæ´»åŠ¨æ£€æµ‹çš„åœºæ™¯ï¼Œæœ‰åŠ©äºä¼˜åŒ–èµ„æºä½¿ç”¨å’Œç½‘ç»œæµé‡ã€‚</p><h3 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡è°ƒèŠ‚ <code>setSocketKeepAlive</code> çš„å‚æ•°ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚å’Œç½‘ç»œçŠ¶å†µï¼Œçµæ´»åœ°ç®¡ç† HTTP è¯·æ±‚çš„ TCP è¿æ¥ã€‚è¿™æ—¢æé«˜äº†ç½‘ç»œé€šä¿¡çš„æ•ˆç‡ï¼Œåˆèƒ½æœ‰æ•ˆåœ°åˆ©ç”¨å¯ç”¨èµ„æºã€‚</p><h3 id="request-settimeout-timeout-callback" tabindex="-1"><a class="header-anchor" href="#request-settimeout-timeout-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestsettimeouttimeout-callback" target="_blank" rel="noopener noreferrer">request.setTimeout(timeout[, callback])</a></span></a></h3><p>åœ¨è§£é‡Š <code>request.setTimeout(timeout[, callback])</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ Node.js åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶çš„ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒä½¿å¾—å¯ä»¥åœ¨æœåŠ¡ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚Node.js çš„è®¾è®¡éå¸¸é€‚åˆæ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯é‚£äº›éœ€è¦é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿå’Œå¤§è§„æ¨¡å¹¶å‘çš„åº”ç”¨ã€‚</p><h3 id="request-settimeout-timeout-callback-1" tabindex="-1"><a class="header-anchor" href="#request-settimeout-timeout-callback-1"><span>request.setTimeout(timeout[, callback])</span></a></h3><p>è¿™ä¸ªæ–¹æ³•æ˜¯ä» Node.js çš„ <code>http</code> æ¨¡å—ä¸­æä¾›çš„ï¼Œç”¨äºè®¾ç½® HTTP è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚è®¾ç½®è¶…æ—¶æ—¶é—´æ˜¯ç½‘ç»œç¼–ç¨‹ä¸­å¸¸è§çš„éœ€æ±‚ï¼Œç›®çš„æ˜¯ç¡®ä¿å½“æŸä¸ªè¯·æ±‚å› ä¸ºå„ç§åŸå› ï¼ˆå¦‚ç½‘ç»œå»¶è¿Ÿã€ç›®æ ‡æœåŠ¡å™¨å¤„ç†ç¼“æ…¢ç­‰ï¼‰æœªèƒ½åœ¨é¢„æœŸæ—¶é—´å†…å®Œæˆæ—¶ï¼Œèƒ½å¤Ÿä¸»åŠ¨ç»ˆæ­¢è¿™ä¸ªè¯·æ±‚ï¼Œé¿å…æ— è°“çš„ç­‰å¾…ï¼Œä»è€Œæé«˜åº”ç”¨çš„å“åº”èƒ½åŠ›å’Œèµ„æºä½¿ç”¨æ•ˆç‡ã€‚</p><p><strong>å‚æ•°è§£æï¼š</strong></p><ul><li><code>timeout</code>: è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼ˆmsï¼‰ã€‚è¿™ä¸ªå€¼æŒ‡å®šäº†å¤šé•¿æ—¶é—´åï¼Œå¦‚æœè¯·æ±‚è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™ä¼šè¢«è‡ªåŠ¨ç»ˆæ­¢ã€‚</li><li><code>callback</code>: å¯é€‰å‚æ•°ã€‚å½“è¯·æ±‚è¶…æ—¶è§¦å‘æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°ã€‚</li></ul><h3 id="å®è·µä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®è·µä¾‹å­"><span>å®è·µä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ç®€å•çš„ç¤ºä¾‹æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><h4 id="ç¤ºä¾‹-1-è®¾ç½®-http-è¯·æ±‚çš„è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è®¾ç½®-http-è¯·æ±‚çš„è¶…æ—¶"><span>ç¤ºä¾‹ 1: è®¾ç½® HTTP è¯·æ±‚çš„è¶…æ—¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤–éƒ¨ API è·å–æ•°æ®ã€‚è¿™ä¸ª API å“åº”æ—¶é—´å¯èƒ½å› ä¸ºå„ç§åŸå› æœ‰æ‰€ä¸åŒã€‚ä¸ºäº†ä¸è®©ç”¨æˆ·ç­‰å¾…å¤ªä¹…ï¼Œä½ å†³å®šä¸ºè¿™æ¬¡è¯·æ±‚è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æ•°æ®åˆ†ç‰‡åˆ°è¾¾æ—¶ï¼Œé€æ­¥æ‹¼æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 2000 æ¯«ç§’</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request has timed out.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç»ˆæ­¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬é”™è¯¯äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Encountered an error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>http.get()</code> å‘èµ·äº†ä¸€ä¸ª GET è¯·æ±‚åˆ° <code>http://example.com</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>request.setTimeout(2000, callback)</code> æ¥è®¾ç½®ä¸€ä¸ª 2 ç§’çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ 2 ç§’å†…è¯·æ±‚æ²¡æœ‰å®Œæˆï¼Œå°±ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬æ‰“å°å‡ºæç¤ºä¿¡æ¯ï¼Œå¹¶ä¸”è°ƒç”¨ <code>request.abort()</code> æ¥ç»ˆæ­¢è¯·æ±‚ã€‚</p><h3 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä½¿ç”¨ <code>request.setTimeout()</code> æ–¹æ³•ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶ HTTP è¯·æ±‚çš„è¶…æ—¶è¡Œä¸ºã€‚è¿™å¯¹äºæ„å»ºé«˜æ•ˆä¸”å¯é çš„ç½‘ç»œåº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´å¯ä»¥å¸®åŠ©ä½ çš„åº”ç”¨æ›´å¥½åœ°åº”å¯¹ç½‘ç»œå»¶è¿Ÿã€æœåŠ¡å“åº”æ…¢ç­‰é—®é¢˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p><h3 id="request-socket" tabindex="-1"><a class="header-anchor" href="#request-socket"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestsocket" target="_blank" rel="noopener noreferrer">request.socket</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å®ƒè¢«è®¾è®¡æ¥åˆ›å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œå…¶ä¸­ <code>http</code> æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ã€‚</p><p>åœ¨ <code>http</code> æ¨¡å—ä¸­ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨å¹¶æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚(<code>request</code>)éƒ½ä¼šæºå¸¦ä¸€äº›ä¿¡æ¯å’Œå±æ€§ã€‚å…¶ä¸­ä¸€ä¸ªå±æ€§å°±æ˜¯ <code>request.socket</code>ã€‚</p><h3 id="request-socket-1" tabindex="-1"><a class="header-anchor" href="#request-socket-1"><span>request.socket</span></a></h3><p><code>request.socket</code> æ˜¯ä¸€ä¸ªå¼•ç”¨äº†åº•å±‚ç½‘ç»œè¿æ¥ï¼ˆsocketï¼‰çš„å¯¹è±¡ã€‚ç®€å•æ¥è¯´ï¼Œå½“å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰é€šè¿‡ç½‘ç»œå‘ä½ çš„æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šé€šè¿‡ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—ï¼ˆsocketï¼‰ä¼ è¾“ã€‚<code>request.socket</code> å®é™…ä¸Šå°±ç»™ä½ æä¾›äº†å¯¹è¿™ä¸ªå¥—æ¥å­—çš„ç›´æ¥è®¿é—®æƒé™ã€‚</p><p>é€šè¿‡è¿™ä¸ª <code>socket</code> å¯¹è±¡ï¼Œä½ å¯ä»¥è·å–å¾ˆå¤šå’Œå½“å‰ç½‘ç»œè¿æ¥ç›¸å…³çš„ä¿¡æ¯å’Œèƒ½åŠ›ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å®¢æˆ·ç«¯çš„ IP åœ°å€ (<code>socket.remoteAddress</code>)</li><li>å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£ (<code>socket.remotePort</code>)</li><li>å’Œæ›´å¤šçš„ä½çº§ç½‘ç»œç‰¹æ€§ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><strong>è·å–å®¢æˆ·ç«¯ IP</strong></li></ol><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦çŸ¥é“å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®ç”¨æˆ·çš„åœ°ç†ä½ç½®æ¥æä¾›ä¸åŒçš„æœåŠ¡ï¼Œæˆ–è€…åœ¨æ—¥å¿—ä¸­è®°å½•è®¿é—®æ¥æºç­‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> clientIP</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Client IP: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientIP</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>é™åˆ¶è¿æ¥æ•°</strong></li></ol><p>å‡è®¾ä½ æƒ³æ§åˆ¶åˆ°ä½ çš„æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°ï¼Œé˜²æ­¢è¿‡å¤šçš„è¿æ¥å¯¼è‡´æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€‚ä½ å¯ä»¥åˆ©ç”¨ <code>socket</code> å¯¹è±¡æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> connections</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  connections</span><span style="color:#81A1C1;">++;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Current connections: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">connections</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    connections</span><span style="color:#81A1C1;">--;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Connection closed. Current connections: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">connections</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬ <code>connection</code> äº‹ä»¶æ¥å¢åŠ è¿æ¥æ•°ï¼ŒåŒæ—¶ç›‘å¬æ¯ä¸ª <code>socket</code> çš„ <code>close</code> äº‹ä»¶æ¥å‡å°‘è¿æ¥æ•°ã€‚è¿™æ ·ï¼Œå°±èƒ½ç²—ç•¥åœ°æ§åˆ¶å’Œç›‘è§†å½“å‰çš„å¹¶å‘è¿æ¥æ•°ã€‚</p><h3 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h3><p><code>request.socket</code> åœ¨ Node.js ä¸­æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä½¿ä½ èƒ½å¤Ÿç›´æ¥ä¸å®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥è¿›è¡Œäº¤äº’å’Œç®¡ç†ã€‚æ— è®ºæ˜¯è·å–å®¢æˆ·ç«¯ä¿¡æ¯è¿˜æ˜¯æ§åˆ¶è¿æ¥ï¼Œéƒ½æ˜¯æ„å»ºé«˜æ•ˆç½‘ç»œæœåŠ¡çš„é‡è¦éƒ¨åˆ†ã€‚ç†è§£å’Œåˆç†ä½¿ç”¨ <code>request.socket</code> å°†å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†å’Œä¼˜åŒ–ä½ çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="request-uncork" tabindex="-1"><a class="header-anchor" href="#request-uncork"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestuncork" target="_blank" rel="noopener noreferrer">request.uncork()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥å¸®ä½ ç†è§£<code>request.uncork()</code>è¿™ä¸ªæ–¹æ³•åœ¨ Node.js ä¸­çš„ä½œç”¨å’Œä¸€äº›å®é™…çš„åº”ç”¨åœºæ™¯ã€‚</p><p>é¦–å…ˆï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£<code>uncork()</code>ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼šâ€œæµâ€ï¼ˆStreamsï¼‰å’Œâ€œèƒŒå‹â€ï¼ˆBackpressureï¼‰ã€‚</p><p><strong>1. æµï¼ˆStreamsï¼‰:</strong> åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®åƒæ°´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»æ–‡ä»¶è¯»å–æ•°æ®å¹¶å‘é€åˆ°å®¢æˆ·ç«¯æ—¶ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥é€šè¿‡æµæ¥å¤„ç†ã€‚</p><p><strong>2. èƒŒå‹ï¼ˆBackpressureï¼‰:</strong> å½“æ•°æ®æµçš„ç”Ÿäº§é€Ÿç‡é«˜äºæ¶ˆè´¹é€Ÿç‡æ—¶ï¼Œå°±ä¼šå‡ºç°èƒŒå‹é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨å°†æ•°æ®å¿«é€Ÿå†™å…¥ç¡¬ç›˜ï¼Œä½†ç¡¬ç›˜ä¿å­˜æ•°æ®çš„é€Ÿåº¦è·Ÿä¸ä¸Šï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é—®é¢˜ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯ Corking?</strong></p><p>åœ¨ Node.js ä¸­ï¼Œcorking æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå…è®¸ä½ æš‚æ—¶åœæ­¢æ•°æ®çš„å‘é€ï¼Œå°†å¤šä¸ªå°çš„æ•°æ®å—åˆå¹¶æˆä¸€ä¸ªè¾ƒå¤§çš„æ•°æ®å—ï¼Œç„¶åå†ä¸€æ¬¡æ€§å‘é€ã€‚è¿™æœ‰åŠ©äºæé«˜æ€§èƒ½ï¼Œå› ä¸ºè¿›è¡Œä¸€æ¬¡å¤§çš„å†™æ“ä½œæ¯”å¤šæ¬¡å°çš„å†™æ“ä½œæ›´é«˜æ•ˆã€‚</p><p><strong>request.uncork() æ–¹æ³•ï¼š</strong></p><p>å½“ä½ åœ¨ä¸€ä¸ª HTTP è¯·æ±‚å¯¹è±¡ä¸Šè°ƒç”¨<code>request.cork()</code>æ–¹æ³•åï¼Œæ‰€æœ‰å†™å…¥è¯·æ±‚å¯¹è±¡çš„æ•°æ®ä¼šè¢«æš‚æ—¶å­˜å‚¨èµ·æ¥ï¼Œè€Œä¸æ˜¯ç«‹å³å‘é€ã€‚å½“ä½ å‡†å¤‡å¥½å‘é€è¿™äº›ç§¯ç´¯çš„æ•°æ®æ—¶ï¼Œä½ å°±è°ƒç”¨<code>request.uncork()</code>æ–¹æ³•ã€‚åœ¨è°ƒç”¨<code>uncork()</code>ä¹‹åï¼Œä¹‹å‰è¢«â€œcorkedâ€çš„æ‰€æœ‰æ•°æ®ä¼šè¢«é€å‡ºã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä»æ•°æ®åº“è·å–å¾ˆå¤šå°ç‰‡æ®µçš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><p>ä¸ä½¿ç”¨<code>cork/uncork</code>ï¼š</p><p>æ¯ä»æ•°æ®åº“è·å–ä¸€ä¸ªæ•°æ®ç‰‡æ®µï¼Œä½ å°±ç«‹å³é€šè¿‡ HTTP å“åº”å‘é€å®ƒã€‚å¦‚æœè¿™äº›æ•°æ®ç‰‡æ®µéå¸¸å°ä¸”æ•°é‡å¾ˆå¤šï¼Œè¿™ç§é¢‘ç¹çš„å°æ•°æ®åŒ…å‘é€å¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œæ‹¥å µï¼Œå¢åŠ äº†é¢å¤–çš„å¼€é”€ã€‚</p><p>ä½¿ç”¨<code>cork/uncork</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ä½¿ç”¨ cork æ–¹æ³•æ¥å»¶è¿Ÿæ•°æ®çš„å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾ fetchData å‡½æ•°æ˜¯ç”¨æ¥ä»æ•°æ®åº“è·å–æ•°æ®ç‰‡æ®µçš„</span></span>
<span class="line"><span style="color:#88C0D0;">    fetchData</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">dataFragments</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fragment</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> dataFragments</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">        // å†™å…¥æ¯ä¸€ä¸ªæ•°æ®ç‰‡æ®µåˆ°å“åº”å¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fragment</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#616E88;">      // ä½¿ç”¨ uncork æ–¹æ³•æŠŠæ‰€æœ‰ç§¯ç´¯çš„æ•°æ®ç‰‡æ®µä¸€æ¬¡æ€§å‘é€å‡ºå»</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">uncork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨<code>res.cork()</code>æ¥å¼€å§‹ç§¯ç´¯æ•°æ®ã€‚åœ¨è·å–æ‰€æœ‰æ•°æ®ç‰‡æ®µåï¼Œåœ¨å¾ªç¯ä¸­æˆ‘ä»¬å†™å…¥è¿™äº›æ•°æ®ç‰‡æ®µï¼Œä½†å®ƒä»¬ä¸ä¼šç«‹å³å‘é€ã€‚æœ€åï¼Œè°ƒç”¨<code>res.uncork()</code>å°†æ‰€æœ‰ç§¯ç´¯çš„æ•°æ®ä¸€æ¬¡æ€§å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å°‘ç½‘ç»œå¼€é”€ï¼Œæå‡åº”ç”¨æ€§èƒ½ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>request.uncork()</code>æ–¹æ³•åœ¨å¤„ç†å¤§é‡æ•°æ®ã€éœ€è¦æ§åˆ¶å‘é€ç²’åº¦ä»¥ä¼˜åŒ–æ€§èƒ½çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚é€šè¿‡åˆç†ä½¿ç”¨ corking æŠ€æœ¯ï¼Œå¯ä»¥ä½¿ Node.js åº”ç”¨è¿è¡Œå¾—æ›´åŠ é«˜æ•ˆã€‚</p><h3 id="request-writableended" tabindex="-1"><a class="header-anchor" href="#request-writableended"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestwritableended" target="_blank" rel="noopener noreferrer">request.writableEnded</a></span></a></h3><p>åœ¨è§£é‡Š <code>request.writableEnded</code> å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®ƒæ‰€å¤„çš„ä¸Šä¸‹æ–‡â€”â€”Node.js ä¸­çš„ HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚Node.js å…è®¸ä½ é€šè¿‡ç¼–å†™ JavaScript ä»£ç æ¥åˆ›å»ºç½‘ç»œæœåŠ¡ã€API ç­‰ã€‚HTTP æ¨¡å—æ˜¯ Node.js ä¸­ç”¨äºå¤„ç†ç½‘ç»œè¯·æ±‚çš„å…³é”®æ¨¡å—ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-3"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><strong>HTTP è¯·æ±‚ä¸å“åº”</strong>: åœ¨ Web å¼€å‘ä¸­ï¼Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯ï¼‰å‘é€ HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¿™äº›è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</li><li><strong>æµ(Streams)</strong>: Node.js ä½¿ç”¨æµæ¥å¤„ç†æ•°æ®ï¼ˆå¦‚æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œé€šä¿¡ï¼‰çš„ä¼ è¾“ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½å…·å¤‡ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯-request-writableended" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-request-writableended"><span>ä»€ä¹ˆæ˜¯ request.writableEndedï¼Ÿ</span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º HTTP æ¨¡å—ä¸­çš„<code>request</code>å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‡çš„æ˜¯å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚æˆ–æœåŠ¡å™¨æ¥æ”¶çš„è¯·æ±‚çš„è¡¨ç¤ºã€‚è¿™ä¸ªå¯¹è±¡å…è®¸ä½ è®¿é—®è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ URLã€è¯·æ±‚å¤´(headers)å’Œè¯·æ±‚ä½“(body)ã€‚</p><p><code>request.writableEnded</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼å±æ€§ï¼Œå®ƒæŒ‡ç¤ºå¯¹äºè¯·æ±‚å¯¹è±¡è€Œè¨€ï¼Œæ˜¯å¦å·²ç»å®Œæˆäº†å†™æ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå‘Šè¯‰ä½ æ˜¯å¦å·²ç»ç»“æŸäº†å‘è¯·æ±‚ä½“ä¸­å†™å…¥æ•°æ®çš„è¿‡ç¨‹ã€‚è¿™ä¸ªå±æ€§åœ¨å¤„ç†å¯å†™æµæ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¸ä¼šå°è¯•å‘ä¸€ä¸ªå·²ç»å…³é—­çš„æµå†™å…¥æ•°æ®ï¼Œä»è€Œé¿å…é”™è¯¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-11"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ—¥å¿—è®°å½•</strong>ï¼šä½ å¯èƒ½æƒ³è¦è®°å½•æ‰€æœ‰å·²ç»å¤„ç†å®Œæ¯•çš„è¯·æ±‚ã€‚ä½¿ç”¨<code>request.writableEnded</code>ï¼Œä½ å¯ä»¥ç¡®å®šè¯·æ±‚ä½•æ—¶ç»“æŸï¼Œæ®æ­¤åšå‡ºç›¸åº”çš„æ—¥å¿—è®°å½•æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†è¯·æ±‚é€»è¾‘...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å½“å“åº”ç»“æŸæ—¶è¿›è¡Œæ—¥å¿—è®°å½•</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableEnded</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å·²è¢«å®Œå…¨å¤„ç†ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>é¿å…é‡å¤å“åº”</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸ç¡®å®šæ˜¯å¦å·²ç»å¯¹è¯·æ±‚ä½œå‡ºäº†å“åº”ã€‚æ£€æŸ¥<code>request.writableEnded</code>å¯ä»¥é˜²æ­¢ä½ å°è¯•å‘ä¸€ä¸ªå·²ç»ç»“æŸçš„è¯·æ±‚å‘é€æ›´å¤šçš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬ä¸€éƒ¨åˆ†æ•°æ®</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ£€æŸ¥æ˜¯å¦å¯ä»¥å®‰å…¨åœ°ç»§ç»­å†™æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableEnded</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬äºŒéƒ¨åˆ†æ•°æ®</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚ç»“æŸ</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œ<code>request.writableEnded</code> æ›´å¤šåœ°è¢«ç”¨äºç¡®ä¿ä»£ç çš„å¥å£®æ€§å’Œé¿å…åœ¨å·²ç»“æŸçš„è¯·æ±‚ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œä»¥å…å¼•å‘æ„å¤–é”™è¯¯ã€‚æŒæ¡å®ƒçš„ç”¨æ³•èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç† HTTP è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h3 id="request-writablefinished" tabindex="-1"><a class="header-anchor" href="#request-writablefinished"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestwritablefinished" target="_blank" rel="noopener noreferrer">request.writableFinished</a></span></a></h3><p><code>request.writableFinished</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº HTTP æ¨¡å—ä¸­ <code>http.ClientRequest</code> ç±»çš„å®ä¾‹ã€‚åœ¨è¯¦ç»†è§£é‡Šè¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ã€‚</p><p>åœ¨ Node.js ä¸­ï¼ŒHTTP è¯·æ±‚å’Œå“åº”éƒ½è¢«çœ‹ä½œæ˜¯æ•°æ®æµã€‚å½“ä½ å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼ŒNode.js ä¼šåˆ›å»ºä¸€ä¸ª <code>ClientRequest</code> å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä»£è¡¨ç€å³å°†å‘é€åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æ•°æ®æµã€‚åœ¨æ•°æ®æµä¸­ï¼Œä½ å¯ä»¥å†™å…¥è¦å‘é€çš„æ•°æ®ï¼Œä¾‹å¦‚ GET è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°æˆ–è€… POST è¯·æ±‚çš„æ¶ˆæ¯ä½“å†…å®¹ã€‚</p><p><code>request.writableFinished</code> è¿™ä¸ªå±æ€§å°±æ˜¯ç”¨æ¥æŸ¥çœ‹è¿™ä¸ªè¯·æ±‚æµæ˜¯å¦å·²ç»å®Œæˆå†™å…¥æ“ä½œã€‚å¦‚æœæ‰€æœ‰æ•°æ®éƒ½å·²æˆåŠŸå†™å…¥åº•å±‚ç³»ç»Ÿï¼Œå¹¶ä¸”åˆ·æ–°åˆ°äº†ç›®æ ‡ï¼Œåˆ™è¿™ä¸ªå±æ€§çš„å€¼ä¸º <code>true</code>ï¼›å¦‚æœæ•°æ®è¿˜æ²¡æœ‰å®Œå…¨å†™å…¥ï¼Œæˆ–è€…è¿™ä¸ªæµè¿˜æ²¡æœ‰ç»“æŸï¼Œé‚£ä¹ˆå®ƒçš„å€¼ä¸º <code>false</code>ã€‚</p><h3 id="å®é™…ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶æƒ³è¦å‘ä¸€ä¸ªå¤–éƒ¨çš„ API æœåŠ¡å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼ŒåŒ…å«ä½ è¦è¯·æ±‚çš„åœ°å€ã€ç«¯å£ä»¥åŠè·¯å¾„ç­‰ä¿¡æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å“åº”ä¸»ä½“: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å†™å…¥æ•°æ®åˆ°è¯·æ±‚ä¸»ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> key</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¨åï¼Œæˆ‘ä»¬æƒ³ç¡®è®¤æˆ‘ä»¬çš„æ•°æ®æ˜¯å¦å·²ç»å…¨éƒ¨å†™å…¥å¹¶ä¸”è¯·æ±‚å·²ç»“æŸ</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableFinished</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å·²ç»å®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å°šæœªå®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>http</code> æ¨¡å—ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªè¯·æ±‚çš„é…ç½®é€‰é¡¹ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>http.request</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ HTTP è¯·æ±‚ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬ <code>response</code> äº‹ä»¶æ¥è·å–æœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œå¹¶é€šè¿‡ <code>error</code> äº‹ä»¶æ¥å¤„ç†å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ã€‚</p><p>ä½¿ç”¨ <code>req.write</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å‘è¯·æ±‚ä¸­å†™å…¥äº†ä¸€ä¸ª JSON å­—ç¬¦ä¸²ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>req.end</code> æ–¹æ³•æ¥ç»“æŸè¿™æ¬¡è¯·æ±‚ã€‚</p><p>åœ¨è°ƒç”¨ <code>req.end</code> æ–¹æ³•ä¹‹åï¼Œç†è®ºä¸Šè¯·æ±‚æ•°æ®åº”è¯¥éƒ½å·²ç»å†™å…¥å®Œæ¯•ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ£€æŸ¥ <code>req.writableFinished</code> å±æ€§æ—¶ï¼Œå®ƒåº”è¯¥è¿”å› <code>true</code>ï¼Œè¡¨ç¤ºè¯·æ±‚çš„å†™å…¥æ“ä½œå·²ç»å®Œæˆã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>request.writableFinished</code> æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å±æ€§ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆå³æ•°æ®å†™å…¥ï¼‰æ˜¯å¦å·²ç»å®Œå…¨å®Œæˆï¼Œè¿™åœ¨éœ€è¦ç²¾ç¡®æ§åˆ¶æ•°æ®æµæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="request-write-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#request-write-chunk-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#requestwritechunk-encoding-callback" target="_blank" rel="noopener noreferrer">request.write(chunk[, encoding][, callback])</a></span></a></h3><p>åœ¨è§£é‡Š <code>request.write(chunk[, encoding][, callback])</code> è¿™ä¸ªå‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ã€‚Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„è„šæœ¬ï¼Œæ‰§è¡Œå„ç§åç«¯ä»»åŠ¡ï¼Œæ¯”å¦‚ä¸æ•°æ®åº“äº¤äº’ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œä»¥åŠç½‘ç»œé€šä¿¡ç­‰ã€‚</p><h3 id="request-write-chunk-encoding-callback-1" tabindex="-1"><a class="header-anchor" href="#request-write-chunk-encoding-callback-1"><span>request.write(chunk[, encoding][, callback])</span></a></h3><p>è¿™ä¸ªå‡½æ•°æ˜¯ Node.js ä¸­ç”¨äºå‘é€ HTTP è¯·æ±‚ä½“æ•°æ®çš„æ–¹æ³•ã€‚å®ƒå±äº HTTP æ¨¡å—çš„ <code>ClientRequest</code> ç±»ã€‚å½“ä½ æƒ³è¦é€šè¿‡ HTTP åè®®å‘é€æ•°æ®åˆ°æœåŠ¡å™¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ´¾ä¸Šç”¨åœºã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£å‚æ•°å’Œå®é™…åº”ç”¨ã€‚</p><h4 id="å‚æ•°-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-3"><span>å‚æ•°ï¼š</span></a></h4><ol><li><strong>chunk</strong>: è¿™æ˜¯ä½ æƒ³è¦å‘é€çš„æ•°æ®å—ã€‚<code>chunk</code> å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ˜¯ä¸€ä¸ª Bufferï¼ˆä¸€ä¸ªåŒ…å«äºŒè¿›åˆ¶æ•°æ®çš„å¯¹è±¡ï¼‰ã€‚</li><li><strong>encoding</strong> (å¯é€‰): å½“ä½ çš„ <code>chunk</code> æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¿™ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šè¯¥å­—ç¬¦ä¸²çš„ç¼–ç æ ¼å¼ï¼ˆæ¯”å¦‚ï¼Œ&#39;utf8&#39;, &#39;ascii&#39;ï¼‰ã€‚å¦‚æœä½ ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º &#39;utf8&#39;ã€‚</li><li><strong>callback</strong> (å¯é€‰): å½“è¿™ä¸ªæ•°æ®å—è¢«æˆåŠŸåœ°å†™å…¥åº•å±‚ç³»ç»Ÿæ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°†ä¼šè¢«è°ƒç”¨ã€‚</li></ol><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä½ éœ€è¦å‘æœåŠ¡å™¨å‘é€ä¸€äº›æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦å‘ä¸€ä¸ª API å‘é€ç”¨æˆ·å¡«å†™çš„è¡¨å•æ•°æ®ã€‚</p><h5 id="ç¤ºä¾‹ä»£ç -1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -1"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP è¯·æ±‚çš„é…ç½®é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/submit-form</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡†å¤‡å‘é€çš„æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> postData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">exampleUser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  email</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user@example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ request.write() å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">postData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®Œæˆè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é¦–å…ˆå¼•å…¥äº† <code>http</code> æ¨¡å—ï¼Œç„¶åè®¾ç½®äº†è¯·æ±‚çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬ç›®æ ‡åœ°å€ã€ç«¯å£ã€è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ä»¥åŠè¯·æ±‚å¤´ã€‚æ¥ç€ï¼Œå®ƒä½¿ç”¨ <code>http.request()</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚çš„ä¸»ä½“ä¸­ä½¿ç”¨ <code>request.write()</code> æ–¹æ³•å‘é€äº† JSON æ ¼å¼çš„æ•°æ®ã€‚æœ€åï¼Œè°ƒç”¨ <code>req.end()</code> æ–¹æ³•ç»“æŸäº†è¯·æ±‚ã€‚å¦‚æœæœåŠ¡å™¨å“åº”ï¼Œå“åº”ä½“æ•°æ®ä¼šè¢«æ‰“å°å‡ºæ¥ï¼›å¦‚æœè¯·æ±‚é‡åˆ°é”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ä¹Ÿä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>request.write()</code>ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ†å—å‘é€æ•°æ®ç»™æœåŠ¡å™¨ï¼Œè¿™å¯¹äºå‘é€å¤§é‡æ•°æ®æˆ–è€…åœ¨ä¸ç¡®å®šæ‰€æœ‰æ•°æ®å¤§å°æ—¶éå¸¸æœ‰ç”¨ã€‚è¿™æ ·åšå¯ä»¥æé«˜æ€§èƒ½ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œå› ä¸ºä½ ä¸éœ€è¦åœ¨å‘é€ä¹‹å‰å°†æ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h2 id="class-http-server" tabindex="-1"><a class="header-anchor" href="#class-http-server"><span><a href="https://nodejs.org/docs/latest/api/http.html#class-httpserver" target="_blank" rel="noopener noreferrer">Class: http.Server</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å…¶éé˜»å¡ I/Oï¼ˆè¾“å…¥/è¾“å‡ºï¼‰æ¨¡å‹ï¼Œä½¿å¾—å®ƒç‰¹åˆ«é€‚åˆå¼€å‘éœ€è¦é«˜å¹¶å‘å¤„ç†èƒ½åŠ›çš„åº”ç”¨ï¼Œå¦‚ç½‘ç«™åå°æœåŠ¡ã€API æ¥å£ç­‰ã€‚</p><h3 id="class-http-server-1" tabindex="-1"><a class="header-anchor" href="#class-http-server-1"><span>Class: http.Server</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>http.Server</code> æ˜¯ä¸€ä¸ªå†…ç½®çš„ HTTP æœåŠ¡å™¨ç±»ã€‚è¿™ä¸ªç±»å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªç®€å•æˆ–å¤æ‚çš„ HTTP æœåŠ¡å™¨ã€‚å®ƒæ˜¯é€šè¿‡ <code>require(&#39;http&#39;)</code> æ¨¡å—æ¥è®¿é—®çš„ã€‚<code>http.Server</code> ç±»ç»§æ‰¿è‡ª <code>EventEmitter</code>ï¼Œè¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿåƒå¤„ç†å…¶ä»–äº‹ä»¶ä¸€æ ·å¤„ç† HTTP è¯·æ±‚ã€‚</p><h4 id="åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„-http-æœåŠ¡å™¨å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„-http-æœåŠ¡å™¨å®ä¾‹"><span>åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„ HTTP æœåŠ¡å™¨å®ä¾‹</span></a></h4><ol><li><p><strong>é¦–å…ˆ</strong>, ä½ éœ€è¦å¼•å…¥ Node.js çš„ <code>http</code> æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>ç„¶å</strong>, ä½¿ç”¨ <code>http.createServer()</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨æ¯æ¬¡æœ‰è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶è¢«è°ƒç”¨ã€‚å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<code>req</code> (è¯·æ±‚å¯¹è±¡) å’Œ <code>res</code> (å“åº”å¯¹è±¡)ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æœ€å</strong>, éœ€è¦è°ƒç”¨ <code>.listen</code> æ–¹æ³•æ¥å¯åŠ¨æœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªç«¯å£å·å’Œä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿çŸ¥é“æœåŠ¡å™¨å¯åŠ¨æˆåŠŸã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-8"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><ul><li><p><strong>æ„å»ºä¸€ä¸ªç®€å•çš„ Web åº”ç”¨</strong>: ä½¿ç”¨ <code>http.Server</code> åˆ›å»ºä¸€ä¸ªæœåŠ¡å³å¯å“åº”ç”¨æˆ·è¯·æ±‚ã€‚æ¯”å¦‚ï¼Œè¿”å›ä¸€ä¸ª HTML é¡µé¢æˆ–è€…ä¸ºå‰ç«¯æä¾› API æ¥å£ã€‚</p></li><li><p><strong>API æ¥å£æœåŠ¡</strong>: å¼€å‘ RESTful APIï¼Œä¾›å‰ç«¯æˆ–è€…ç§»åŠ¨åº”ç”¨ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° <code>/api/users</code>ï¼ŒæœåŠ¡å™¨åˆ™å“åº”ç”¨æˆ·åˆ—è¡¨çš„ JSON æ•°æ®ã€‚</p></li><li><p><strong>ä»£ç†æœåŠ¡å™¨</strong>: å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸­é—´ä»¶æœåŠ¡å™¨ï¼Œè½¬å‘å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™åœ¨å¤„ç†è·¨åŸŸè¯·æ±‚æˆ–èšåˆå¤šä¸ªæœåŠ¡çš„æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚</p></li><li><p><strong>é™æ€æ–‡ä»¶æœåŠ¡å™¨</strong>: é€šè¿‡è§£æè¯·æ±‚çš„ URL è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°ï¼Œè¿”å›å¯¹åº”çš„é™æ€æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ã€CSS æ–‡ä»¶ã€JavaScript æ–‡ä»¶ç­‰ã€‚</p></li></ul><p>Node.js çš„ <code>http.Server</code> ç±»æ˜¯æ„å»ºç½‘ç»œæœåŠ¡å’Œåº”ç”¨çš„åŸºç¡€ï¼Œå®ƒæä¾›äº†å¤§é‡çš„çµæ´»æ€§æ¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ï¼Œä»ç®€å•çš„ä¸ªäººé¡¹ç›®åˆ°å¤æ‚çš„ä¼ä¸šçº§åº”ç”¨ã€‚é€šè¿‡ç»“åˆä½¿ç”¨ Node.js çš„å…¶ä»–æ¨¡å—å’Œç¬¬ä¸‰æ–¹åº“ï¼Œä½ å¯ä»¥è½»æ¾æ‰©å±•å’Œå¢å¼ºä½ çš„ HTTP æœåŠ¡å™¨ã€‚</p><h3 id="event-checkcontinue" tabindex="-1"><a class="header-anchor" href="#event-checkcontinue"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-checkcontinue" target="_blank" rel="noopener noreferrer">Event: &#39;checkContinue&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>Event: &#39;checkContinue&#39;</code>æ˜¯ä¸ HTTP æœåŠ¡å™¨ç›¸å…³çš„ä¸€ä¸ªäº‹ä»¶ï¼Œä¸»è¦ç”¨äºå¤„ç†<code>Expect: 100-continue</code>è¿™ç§ç‰¹æ®Šçš„ HTTP è¯·æ±‚å¤´ã€‚åœ¨è¯¦ç»†è§£é‡Šè¿™ä¸ªäº‹ä»¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="èƒŒæ™¯" tabindex="-1"><a class="header-anchor" href="#èƒŒæ™¯"><span>èƒŒæ™¯</span></a></h3><p>å½“å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ä¸€ä¸ªæµè§ˆå™¨æˆ–å…¶ä»–ç±»å‹çš„å®¢æˆ·ç«¯ç¨‹åºï¼‰å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ç»™æœåŠ¡å™¨æ—¶ï¼Œå®ƒä»¬å¯èƒ½ä¼šåŒ…å«ä¸€ä¸ª<code>Expect: 100-continue</code>è¯·æ±‚å¤´ã€‚è¿™ä¸ªè¯·æ±‚å¤´æ˜¯å®¢æˆ·ç«¯ç”¨æ¥å‘Šè¯‰æœåŠ¡å™¨ï¼šâ€œæˆ‘è¿™é‡Œæœ‰ä¸€äº›æ•°æ®æƒ³è¦å‘é€ç»™ä½ ï¼Œä½†åœ¨æˆ‘å‘é€ä¹‹å‰ï¼Œè¯·ç¡®è®¤æ¥æ”¶è¿™äº›æ•°æ®æ˜¯ OK çš„â€ã€‚è¿™æ ·åšçš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†æ•ˆç‡å’Œæ€§èƒ½ï¼Œå°¤å…¶æ˜¯å½“å‘é€çš„æ•°æ®ä½“å¾ˆå¤§æ—¶ã€‚å¦‚æœæœåŠ¡å™¨è®¤ä¸ºä¸åº”è¯¥æ¥å—è¿™äº›æ•°æ®ï¼ˆå¯èƒ½å› ä¸ºè®¤è¯å¤±è´¥ç­‰åŸå› ï¼‰ï¼Œå®ƒå¯ä»¥ç«‹å³å›å¤å®¢æˆ·ç«¯ï¼Œé¿å…å®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ®åæ‰å‘ç°è¯·æ±‚è¢«æ‹’ç»ã€‚</p><h3 id="event-checkcontinue-1" tabindex="-1"><a class="header-anchor" href="#event-checkcontinue-1"><span>Event: &#39;checkContinue&#39;</span></a></h3><p>åœ¨ Node.js çš„ HTTP æœåŠ¡å™¨å®ä¾‹ä¸­ï¼Œ<code>&#39;checkContinue&#39;</code>äº‹ä»¶å°±æ˜¯ç”¨æ¥å¤„ç†è¿™ç§æƒ…å†µçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªå¸¦æœ‰<code>Expect: 100-continue</code>è¯·æ±‚å¤´çš„è¯·æ±‚ï¼ŒNode.js çš„ HTTP æœåŠ¡å™¨ä¼šè‡ªåŠ¨å›å¤<code>HTTP/1.1 100 Continue</code>å“åº”ï¼Œç„¶åå®¢æˆ·ç«¯ä¼šç»§ç»­å‘é€è¯·æ±‚ä½“ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¸Œæœ›æ ¹æ®è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ¯”å¦‚è¯·æ±‚å¤´éƒ¨æˆ–è€…è¿æ¥çš„å…¶ä»–å±æ€§ï¼‰æ¥å†³å®šæ˜¯å¦åº”è¯¥ç»§ç»­æ¥æ”¶æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ‰‹åŠ¨å¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚ä¸Šä¼ å¤§å‹æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œä½ æƒ³è¦ç¡®ä¿åªæœ‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶ï¼Œä¸”æ¯ä¸ªæ–‡ä»¶å¿…é¡»å°äºä¸€ä¸ªç‰¹å®šçš„å¤§å°é™åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>&#39;checkContinue&#39;</code>äº‹ä»¶å°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">checkContinue</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥è¯·æ±‚å¤´æˆ–å…¶ä»–ä¿¡æ¯ä»¥ç¡®å®šæ˜¯å¦åº”è¯¥ç»§ç»­æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#616E88;">/* éªŒè¯å¤±è´¥çš„æ¡ä»¶ */</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">403</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æˆ–å…¶ä»–é€‚å½“çš„çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Authentication failed or data too large</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeContinue</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘Šè¯‰å®¢æˆ·ç«¯ç»§ç»­å‘é€è¯·æ±‚ä½“</span></span>
<span class="line"><span style="color:#616E88;">    // æ³¨æ„: ä¹‹åè¿˜éœ€è¦ç›‘å¬&#39;request&#39;äº‹ä»¶æ¥å¤„ç†è¯·æ±‚ä½“</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>å½“å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¸¦æœ‰<code>Expect: 100-continue</code>å¤´çš„è¯·æ±‚æ—¶ï¼Œ<code>&#39;checkContinue&#39;</code>äº‹ä»¶è¢«è§¦å‘ã€‚</li><li>å¦‚æœèº«ä»½éªŒè¯å¤±è´¥æˆ–æ•°æ®è¶…å‡ºäº†æˆ‘ä»¬çš„é™åˆ¶ï¼Œæˆ‘ä»¬å›å¤å®¢æˆ·ç«¯ç›¸åº”çš„é”™è¯¯å“åº”ï¼Œå¹¶ç»“æŸè¯·æ±‚ã€‚</li><li>å¦‚æœè¯·æ±‚çœ‹èµ·æ¥æœ‰æ•ˆï¼Œæˆ‘ä»¬è°ƒç”¨<code>res.writeContinue()</code>æ¥è®©å®¢æˆ·ç«¯ç»§ç»­å‘é€è¯·æ±‚ä½“ã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†æ­£å¸¸çš„<code>&#39;request&#39;</code>äº‹ä»¶æ¥æ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ä½“ã€‚</li></ol><p>é€šè¿‡è¿™ä¸ªæœºåˆ¶ï¼Œä½ å¯ä»¥åœ¨å®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ®ä¹‹å‰ï¼Œå…ˆå¯¹è¯·æ±‚è¿›è¡Œåˆæ­¥çš„å®¡æ ¸ï¼Œä»è€Œæé«˜åº”ç”¨çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚</p><h3 id="event-checkexpectation" tabindex="-1"><a class="header-anchor" href="#event-checkexpectation"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-checkexpectation" target="_blank" rel="noopener noreferrer">Event: &#39;checkExpectation&#39;</a></span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;checkExpectation&#39;</code> æ˜¯ä¸€ä¸ªä¸ HTTP æœåŠ¡å™¨ç›¸å…³çš„äº‹ä»¶ï¼Œå®ƒç‰¹åˆ«ç”¨äºå¤„ç† HTTP è¯·æ±‚ä¸­çš„ <code>Expect</code> å¤´éƒ¨ã€‚äº†è§£è¿™ä¸ªæ¦‚å¿µï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½å‡ ä¸ªåŸºç¡€ç‚¹ã€‚</p><h3 id="http-çš„-expect-å¤´éƒ¨" tabindex="-1"><a class="header-anchor" href="#http-çš„-expect-å¤´éƒ¨"><span>HTTP çš„ Expect å¤´éƒ¨</span></a></h3><p>åœ¨ HTTP åè®®ä¸­ï¼Œå®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨æˆ–å…¶ä»–åº”ç”¨ï¼‰å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤´éƒ¨ä¸­åŒ…å«ä¸€ä¸ª <code>Expect</code> å­—æ®µã€‚è¿™ä¸ªå­—æ®µé€šå¸¸ç”¨æ¥å‘Šè¯‰æœåŠ¡å™¨å®¢æˆ·ç«¯æœŸæœ›çš„ä¸€äº›è¡Œä¸ºã€‚æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ <code>Expect: 100-continue</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æƒ³è¦åœ¨å‘é€è¯·æ±‚æ­£æ–‡ä¹‹å‰ï¼Œç¡®ä¿æœåŠ¡å™¨æ„¿æ„æ¥å—è¯·æ±‚ï¼ˆåŸºäºè¯·æ±‚å¤´éƒ¨çš„é¢„æ£€æŸ¥ï¼‰ã€‚</p><h3 id="node-js-ä¸­çš„-checkexpectation-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-checkexpectation-äº‹ä»¶"><span>Node.js ä¸­çš„ <code>checkExpectation</code> äº‹ä»¶</span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js çš„ <code>http</code> æ¨¡å—åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œå¦‚æœæ”¶åˆ°ä¸€ä¸ªåŒ…å« <code>Expect</code> å¤´éƒ¨çš„è¯·æ±‚ï¼Œè€Œè¿™ä¸ªå¤´éƒ¨çš„å€¼ä¸æ˜¯æœåŠ¡å™¨çŸ¥é“å¦‚ä½•å¤„ç†çš„ï¼ˆä¾‹å¦‚ä¸æ˜¯ <code>100-continue</code>ï¼‰ï¼Œé‚£ä¹ˆ <code>checkExpectation</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚ä½œä¸ºæœåŠ¡å™¨å¼€å‘è€…ï¼Œä½ å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œæ ¹æ®è¯·æ±‚å¤´éƒ¨ä¸­çš„ <code>Expect</code> å€¼åšå‡ºé€‚å½“çš„å“åº”ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-9"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡ï¼Œå®¢æˆ·ç«¯åœ¨ä¸Šä¼ å¤§æ–‡ä»¶ä¹‹å‰å¯èƒ½ä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰ <code>Expect: 100-continue</code> çš„è¯·æ±‚ï¼Œæƒ³è¦ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦å‡†å¤‡å¥½æ¥å—æ–‡ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;checkExpectation&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">checkExpectation</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥è¯·æ±‚å¤´éƒ¨æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">expect</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">100-continue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæ˜¯é¢„æœŸçš„100-continueï¼Œåˆ™ç»§ç»­æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeContinue</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæ”¶åˆ°çš„Expectå€¼ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ï¼Œå¯ä»¥è¿”å›ç›¸åº”çš„é”™è¯¯ç </span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 417</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Expectation Failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡ç›‘å¬ <code>checkExpectation</code> äº‹ä»¶ï¼Œæ£€æŸ¥è¯·æ±‚çš„ <code>Expect</code> å¤´éƒ¨ã€‚å¦‚æœè¯·æ±‚å¤´éƒ¨ç¬¦åˆé¢„æœŸï¼ˆ<code>100-continue</code>ï¼‰ï¼ŒæœåŠ¡å™¨å›å¤ç»§ç»­æ‰§è¡Œï¼Œä»è€Œå®¢æˆ·ç«¯ä¼šå‘é€è¯·æ±‚ä½“ï¼›å¦‚æœä¸æ˜¯é¢„æœŸå†…çš„å€¼ï¼ŒæœåŠ¡å™¨åˆ™è¿”å›ä¸€ä¸ª 417 é”™è¯¯ï¼ˆExpectation Failedï¼‰ã€‚</p><h3 id="æ€»ç»“-7" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-7"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ç›‘å¬ <code>checkExpectation</code> äº‹ä»¶ï¼ŒNode.js å¼€å‘è€…å¯ä»¥æ›´ç²¾ç»†åœ°æ§åˆ¶å¯¹ HTTP è¯·æ±‚çš„å¤„ç†ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†è¾ƒä¸ºå¤æ‚æˆ–ä¸å¸¸è§çš„ <code>Expect</code> è¯·æ±‚å¤´éƒ¨æ—¶ã€‚è¿™ä¸ºå¼€å‘é«˜æ•ˆã€ç¨³å®šçš„ç½‘ç»œæœåŠ¡æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œæ§åˆ¶åŠ›ã€‚</p><h3 id="event-clienterror" tabindex="-1"><a class="header-anchor" href="#event-clienterror"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-clienterror" target="_blank" rel="noopener noreferrer">Event: &#39;clientError&#39;</a></span></a></h3><p>åœ¨è§£é‡Š Node.js ä¸­çš„ <code>clientError</code> äº‹ä»¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Node.js ä»¥åŠå®ƒå¤„ç† HTTP æœåŠ¡çš„åŸºæœ¬æ¦‚å¿µã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“è¿è¡Œ JavaScript ä»£ç çš„å¹³å°ã€‚ç”±äºå…¶éé˜»å¡ I/O å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§ï¼ŒNode.js éå¸¸é€‚åˆå¼€å‘éœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥çš„ç½‘ç»œåº”ç”¨ï¼Œå¦‚ç½‘ç«™åç«¯æœåŠ¡ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—å…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚å½“ä½¿ç”¨è¿™ä¸ªæ¨¡å—åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œä½ å¯ä»¥ç›‘å¬å’Œå¤„ç†å„ç§äº‹ä»¶ï¼Œæ¯”å¦‚æ¥æ”¶è¯·æ±‚ã€å‘é€å“åº”ç­‰ã€‚å…¶ä¸­ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶å°±æ˜¯ <code>clientError</code>ã€‚</p><h3 id="clienterror-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#clienterror-äº‹ä»¶"><span><code>clientError</code> äº‹ä»¶</span></a></h3><p>å½“ HTTP æœåŠ¡å™¨é‡åˆ°å®¢æˆ·ç«¯é”™è¯¯ï¼ˆæ¯”å¦‚ä¸åˆæ³•çš„è¯·æ±‚ï¼‰æ—¶ï¼Œä¼šè§¦å‘ <code>clientError</code> äº‹ä»¶ã€‚è¿™ç»™äº†å¼€å‘è€…ä¸€ä¸ªæœºä¼šå»è‡ªå®šä¹‰å¤„ç†è¿™äº›é”™è¯¯ï¼Œå¯èƒ½æ˜¯è®°å½•æ—¥å¿—ï¼Œæˆ–è€…å‘å®¢æˆ·ç«¯å‘é€ç‰¹å®šçš„é”™è¯¯å“åº”ã€‚</p><h4 id="å‚æ•°-4" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-4"><span>å‚æ•°</span></a></h4><p><code>clientError</code> äº‹ä»¶ä¼ é€’ä¸¤ä¸ªå‚æ•°ç»™å›è°ƒå‡½æ•°ï¼š</p><ol><li><strong>error</strong>ï¼šä¸€ä¸ª <code>Error</code> å¯¹è±¡ï¼ŒåŒ…å«äº†é”™è¯¯çš„è¯¦æƒ…ã€‚</li><li><strong>socket</strong>ï¼šè¡¨ç¤ºä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„ç½‘ç»œå¥—æ¥å­—ã€‚å¯ä»¥ç”¨æ¥å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</li></ol><h4 id="ä½¿ç”¨å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨å®ä¾‹"><span>ä½¿ç”¨å®ä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ æƒ³è¦è‡ªå®šä¹‰å¤„ç†å®¢æˆ·ç«¯é”™è¯¯ï¼Œæ¯”å¦‚å½“å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªæ ¼å¼ä¸æ­£ç¡®çš„è¯·æ±‚æ—¶ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">clientError</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A client error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª 400 é”™è¯¯å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTTP/1.1 400 Bad Request</span><span style="color:#EBCB8B;">\r\n\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:8000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒå¯¹æ‰€æœ‰è¯·æ±‚éƒ½è¿”å› &quot;Hello, World!&quot;ã€‚é€šè¿‡ç›‘å¬ <code>clientError</code> äº‹ä»¶ï¼Œå¦‚æœé‡åˆ°å®¢æˆ·ç«¯é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªæ— æ³•è§£æçš„è¯·æ±‚ï¼‰ï¼ŒæœåŠ¡å™¨å°†æ‰“å°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª 400 é”™è¯¯å“åº”ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„è¯·æ±‚æœ‰è¯¯ã€‚</p><p>è¿™ç§æ–¹å¼å¯ä»¥å¸®åŠ©æå‡ç”¨æˆ·ä½“éªŒå’ŒæœåŠ¡å™¨çš„å¥å£²æ€§ï¼Œå› ä¸ºä½ å¯ä»¥æ›´ä¼˜é›…åœ°å¤„ç†é”™è¯¯æƒ…å†µï¼Œè€Œä¸æ˜¯è®©å®¢æˆ·ç«¯é‡åˆ°ä¸å‹å¥½çš„æ–­å¼€è¿æ¥ç­‰é—®é¢˜ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>clientError</code> äº‹ä»¶åœ¨ Node.js çš„ HTTP æœåŠ¡å™¨ä¸­æä¾›äº†ä¸€ä¸ªå¤„ç†å’Œå“åº”å®¢æˆ·ç«¯é”™è¯¯çš„æœ‰åŠ›å·¥å…·ã€‚é€šè¿‡è‡ªå®šä¹‰é”™è¯¯å¤„ç†é€»è¾‘ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®åº”ç”¨çš„éœ€æ±‚çµæ´»åº”å¯¹ä¸åŒçš„é”™è¯¯æƒ…å†µã€‚</p><h3 id="event-close-1" tabindex="-1"><a class="header-anchor" href="#event-close-1"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-close_1" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h3><p>åœ¨ Node.js çš„ http æ¨¡å—ä¸­ï¼Œ<code>Event: &#39;close&#39;</code> æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒä¼šåœ¨æœåŠ¡å™¨å…³é—­çš„æ—¶å€™è¢«è§¦å‘ã€‚è¿™ä¸ªäº‹ä»¶æ˜¯ç”± <code>http.Server</code> ç±»æˆ–è€… <code>http.ServerResponse</code> ç±»å®ä¾‹åŒ–çš„å¯¹è±¡æ‰€å…·å¤‡çš„ã€‚å½“ä½ åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å¯èƒ½å› ä¸ºå„ç§åŸå› è€Œå…³é—­ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥æˆ–è€…æœåŠ¡å™¨ä¸»åŠ¨å…³é—­ç­‰ã€‚</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>Event: &#39;close&#39;</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†è¯·æ±‚å’Œå‘é€å“åº”çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;close&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server closed!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨æŸä¸ªæ—¶é—´ç‚¹å…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™å°†è§¦å‘ &#39;close&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åœ¨10ç§’åå…³é—­æœåŠ¡å™¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œé¦–å…ˆé€šè¿‡ <code>http.createServer()</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”å®šä¹‰äº†æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„é€»è¾‘ã€‚æˆ‘ä»¬è°ƒç”¨ <code>server.listen()</code> æ–¹æ³•ä½¿å¾—æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç‰¹å®šçš„ç«¯å£ï¼ˆä¾‹å¦‚ï¼š3000ï¼‰ï¼Œä»¥ä¾¿å¯ä»¥æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥å’Œè¯·æ±‚ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>server.on(&#39;close&#39;, callback)</code> æ–¹æ³•æ¥æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨å‡½æ•°ï¼ˆå³å›è°ƒå‡½æ•°ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨æœåŠ¡å™¨å…³é—­æ—¶æ‰§è¡Œã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“æœåŠ¡å™¨å…³é—­æ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡º &quot;Server closed!&quot;ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è®¾å®šäº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä½¿ç”¨ <code>setTimeout()</code> æ–¹æ³•ï¼Œåœ¨ 10 ç§’åè°ƒç”¨ <code>server.close()</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¼šå¯¼è‡´æœåŠ¡å™¨åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œå¹¶ä¸”ä¸€æ—¦æ‰€æœ‰ç°æœ‰çš„è¿æ¥éƒ½è¢«å¤„ç†å®Œæ¯•ï¼ŒæœåŠ¡å™¨å°±ä¼šå…³é—­ï¼Œæ­¤æ—¶ &#39;close&#39; äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œæˆ‘ä»¬ä¹‹å‰æ³¨å†Œçš„ç›‘å¬å™¨å‡½æ•°å°±ä¼šè¿è¡Œã€‚</p><p>é€šä¿—åœ°è¯´ï¼Œä½ å¯ä»¥æŠŠ <code>Event: &#39;close&#39;</code> çœ‹ä½œæ˜¯æœåŠ¡å™¨çš„â€œå…³é—¨æ‰“çƒŠâ€ä¿¡å·ã€‚å½“ä½ å¬åˆ°è¿™ä¸ªä¿¡å·æ—¶ï¼Œä½ çŸ¥é“æœåŠ¡å™¨å·²ç»ä¸å†æä¾›æœåŠ¡ï¼Œæ‰€æœ‰çš„äº‹åŠ¡éƒ½å·²ç»ç»“æŸæˆ–è€…æ­£åœ¨ç»“æŸã€‚ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªäº‹ä»¶æ¥è¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€å†™æ—¥å¿—ã€é€šçŸ¥ç®¡ç†å‘˜ç­‰æ“ä½œã€‚</p><h3 id="event-connect-2" tabindex="-1"><a class="header-anchor" href="#event-connect-2"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-connect_1" target="_blank" rel="noopener noreferrer">Event: &#39;connect&#39;</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“æˆ‘ä»¬è°ˆè®º HTTP æ¨¡å—çš„ &#39;connect&#39; äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‡çš„æ˜¯ä¸ HTTP ä»£ç†äº¤äº’çš„ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªäº‹ä»¶åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ <code>CONNECT</code> æ–¹æ³•å‘ä»£ç†æœåŠ¡å™¨å‘èµ·è¯·æ±‚å¹¶ä¸”æˆåŠŸå»ºç«‹è¿æ¥æ—¶è§¦å‘ã€‚</p><p>é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹ <code>CONNECT</code> æ–¹æ³•ï¼š<br> HTTP åè®®ä¸­çš„ <code>CONNECT</code> æ–¹æ³•ä¸»è¦ç”¨æ¥è¯·æ±‚ä»£ç†æœåŠ¡å™¨å¯¹æŒ‡å®šèµ„æºå»ºç«‹éš§é“è¿æ¥ã€‚è¿™åœ¨ HTTPS é€šè¿‡ä»£ç†è¿æ¥åˆ° Web æœåŠ¡å™¨æ—¶ç‰¹åˆ«å¸¸è§ã€‚ç”±äº HTTPS æ˜¯åŠ å¯†çš„ï¼Œä»£ç†æœåŠ¡å™¨ä¸èƒ½æŸ¥çœ‹æˆ–ä¿®æ”¹ä¼ è¾“çš„å†…å®¹ï¼Œå®ƒåªèƒ½å°†æ•°æ®è½¬å‘ç»™ç›®æ ‡æœåŠ¡å™¨ã€‚</p><p>ç°åœ¨ï¼Œå›åˆ° Node.js ä¸­çš„ &#39;connect&#39; äº‹ä»¶ï¼šè¿™ä¸ªäº‹ä»¶æ˜¯åœ¨ http æ¨¡å—çš„æœåŠ¡å™¨å¯¹è±¡ä¸Šè§¦å‘çš„ï¼Œå½“æœåŠ¡å™¨ä½œä¸ºä»£ç†ï¼Œå¹¶æ”¶åˆ° <code>CONNECT</code> è¯·æ±‚æ—¶ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚è¿™ç»™å¼€å‘è€…æä¾›äº†å¤„ç†ä»£ç†è¯·æ±‚çš„æœºä¼šã€‚</p><p>è®©æˆ‘ä»¬é€æ­¥åˆ†æä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP ä»£ç†æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> proxy</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;connect&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">proxy</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> cltSocket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> head</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // req å¯¹è±¡åŒ…å«è¯·æ±‚ä¿¡æ¯ï¼Œä¾‹å¦‚ &#39;url&#39; å±æ€§</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ° CONNECT è¯·æ±‚: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> srvUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">http://</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> srvSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">srvUrl</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> srvUrl</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">hostname</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å‘Šè¯‰å®¢æˆ·ç«¯è¿æ¥å·²å»ºç«‹</span></span>
<span class="line"><span style="color:#D8DEE9;">    cltSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">HTTP/1.1 200 Connection Established</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span></span>
<span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">Proxy-agent: Node.js-Proxy</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span></span>
<span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å°†æœåŠ¡ç«¯å“åº”ä¼ å›å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    srvSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">head</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    srvSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">cltSocket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    cltSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">srvSocket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æŸä¸ªç«¯å£ä¸Šçš„ä»£ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">proxy</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1337</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä»£ç†æœåŠ¡å™¨è¿è¡Œåœ¨ http://127.0.0.1:1337/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ <code>proxy</code>ï¼Œå®ƒå°†å……å½“ä»£ç†æœåŠ¡å™¨ã€‚</li><li>ä½¿ç”¨ <code>.on()</code> æ–¹æ³•ç›‘å¬ <code>proxy</code> ä¸Šçš„ &#39;connect&#39; äº‹ä»¶ã€‚</li><li>å½“ &#39;connect&#39; äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œå®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š <ul><li><code>req</code>: åŒ…å«è¯·æ±‚è¯¦æƒ…ï¼ˆå¦‚ URLï¼‰çš„å¯¹è±¡ã€‚</li><li><code>cltSocket</code>: ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—å¯¹è±¡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å’Œä»£ç†ä¹‹é—´çš„è¿æ¥ã€‚</li><li><code>head</code>: è¯·æ±‚ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå¯èƒ½æ˜¯ HTTP è¯·æ±‚çš„å¤´éƒ¨ä¿¡æ¯ã€‚</li></ul></li><li>åœ¨å›è°ƒå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬è§£æè¯·æ±‚çš„ç›®æ ‡åœ°å€å’Œç«¯å£ï¼Œå¹¶ä½¿ç”¨ <code>net.connect</code> åˆ›å»ºä¸€ä¸ªåˆ°ç›®æ ‡æœåŠ¡å™¨çš„ TCP è¿æ¥ã€‚</li><li>æˆåŠŸå»ºç«‹åˆ°ç›®æ ‡æœåŠ¡å™¨çš„è¿æ¥åï¼Œæˆ‘ä»¬å‘é€ä¸€ä¸ª HTTP 200 å“åº”ç»™å®¢æˆ·ç«¯ï¼Œå‘ŠçŸ¥è¿æ¥å·²ç»æˆåŠŸå»ºç«‹ã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬å»ºç«‹ä» <code>srvSocket</code> åˆ° <code>cltSocket</code> çš„ç®¡é“ï¼Œè¿™æ ·å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®å°±å¯ä»¥ç›¸äº’ä¼ é€’äº†ã€‚</li></ol><p>è¿™ä¸ª <code>connect</code> äº‹ä»¶å¸¸è§äºæ„å»º HTTP ä»£ç†åœºæ™¯ï¼Œå®ƒä½¿å¾— Node.js èƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„ç½‘ç»œåè®®å’Œæ•°æ®æµåŠ¨åœºæ™¯ã€‚å¸Œæœ›è¿™ä¸ªä¾‹å­å’Œè§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£ Node.js ä¸­ &#39;connect&#39; äº‹ä»¶çš„æ¦‚å¿µå’Œç”¨æ³•ã€‚</p><h3 id="event-connection" tabindex="-1"><a class="header-anchor" href="#event-connection"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-connection" target="_blank" rel="noopener noreferrer">Event: &#39;connection&#39;</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>Event: &#39;connection&#39;</code> äº‹ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ v21.7.1 ä¸­æ‰€ä½“ç°çš„ç”¨æ³•ï¼Œæˆ‘ä»¬ä¼šç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€æ¥ä»‹ç»ï¼Œå¹¶é€šè¿‡å®é™…ä¾‹å­å¸®ä½ ç†è§£ã€‚</p><h3 id="ç®€å•ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»"><span>ç®€å•ä»‹ç»</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>Event: &#39;connection&#39;</code> æ˜¯ä¸€ä¸ªä¸ç½‘ç»œç›¸å…³çš„äº‹ä»¶ï¼Œä¸»è¦å‡ºç°åœ¨ http æˆ– https æ¨¡å—ä¸­ã€‚å½“æ–°çš„ TCP è¿æ¥ï¼ˆä¼ è¾“æ§åˆ¶åè®®è¿æ¥ï¼‰å»ºç«‹æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚å®ƒå…è®¸ä½ åœ¨åº•å±‚ TCP è¿æ¥å»ºç«‹åã€ä½†åœ¨å®é™… HTTP è¯·æ±‚å¤„ç†ä¹‹å‰å¯¹è¯¥è¿æ¥è¿›è¡Œè®¿é—®å’Œæ“ä½œã€‚</p><h3 id="ä¸ºä»€ä¹ˆå®ƒé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆå®ƒé‡è¦"><span>ä¸ºä»€ä¹ˆå®ƒé‡è¦ï¼Ÿ</span></a></h3><p>ç†è§£å’Œä½¿ç”¨ <code>&#39;connection&#39;</code> äº‹ä»¶å¯ä»¥ä½¿ä½ æœ‰æœºä¼šåœ¨è¯·æ±‚çº§åˆ«ä¹‹ä¸‹å·¥ä½œï¼Œä¸ºä¾‹å¦‚å®‰å…¨æ€§éªŒè¯ã€è¿æ¥ç›‘è§†ã€æ—¥å¿—è®°å½•æˆ–ç”šè‡³æ˜¯ä½æ°´å¹³çš„ç½‘ç»œä¼˜åŒ–æä¾›å¯èƒ½ã€‚</p><h3 id="å®é™…è¿ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¸¾ä¾‹"><span>å®é™…è¿ç”¨ä¸¾ä¾‹</span></a></h3><ol><li><p><strong>ç›‘æ§è¿æ¥æ•°</strong>ï¼šå¦‚æœä½ æƒ³çŸ¥é“ä½ çš„æœåŠ¡å™¨åœ¨ä»»æ„æ—¶åˆ»æœ‰å¤šå°‘æ´»è·ƒçš„è¿æ¥ï¼Œå¯ä»¥é€šè¿‡ç›‘å¬ <code>&#39;connection&#39;</code> äº‹ä»¶å¹¶æ›´æ–°ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°ã€‚</p></li><li><p><strong>æ—¥å¿—è®°å½•</strong>ï¼šåœ¨æ¯ä¸ªæ–°çš„è¿æ¥è¢«åˆ›å»ºæ—¶è®°å½•ä¿¡æ¯ï¼Œæ¯”å¦‚è¿æ¥æ—¶é—´ã€æ¥æº IP åœ°å€ç­‰ï¼Œå¯¹äºè°ƒè¯•æˆ–ç›‘æ§æœåŠ¡å™¨è¡Œä¸ºéå¸¸æœ‰ç”¨ã€‚</p></li><li><p><strong>å®æ–½å®‰å…¨ç­–ç•¥</strong>ï¼šåŸºäºæ¥æº IP æˆ–è¿æ¥é¢‘ç‡ç­‰ä¿¡æ¯æ‹’ç»æŸäº›è¿æ¥ï¼Œä»è€Œé˜²æ­¢æ¶æ„ç”¨æˆ·æˆ–æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDDoSï¼‰ã€‚</p></li></ol><h3 id="ç¤ºä¾‹ä»£ç -2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -2"><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Node.js çš„ <code>http</code> æ¨¡å—åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå¹¶æƒ³è¦åœ¨æ¯æ¬¡å»ºç«‹æ–°è¿æ¥æ—¶æ‰“å°ä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;connection&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">New connection established.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å¯ä»¥åœ¨æ­¤å¤„æ·»åŠ æ›´å¤šé€»è¾‘ï¼Œæ¯”å¦‚è®°å½•è¿æ¥ä¿¡æ¯ç­‰</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®©æœåŠ¡å™¨ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š</p><ul><li>æˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>http</code> æ¨¡å—å¹¶ä½¿ç”¨å…¶ <code>createServer</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚</li><li>é€šè¿‡ <code>server.on(&#39;connection&#39;, callback)</code> ç›‘å¬ <code>&#39;connection&#39;</code> äº‹ä»¶ã€‚æ¯å½“æ–°çš„ TCP è¿æ¥å»ºç«‹æ—¶ï¼Œæˆ‘ä»¬çš„å›è°ƒå‡½æ•°å°±ä¼šæ‰§è¡Œï¼Œæ­¤å¤„æˆ‘ä»¬ä»…ä»…æ˜¯åœ¨æ§åˆ¶å°æ‰“å°å‡º &quot;New connection established.&quot;ã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬è®©æœåŠ¡å™¨ç›‘å¬ 3000 ç«¯å£ï¼Œå‡†å¤‡æ¥æ”¶è¿æ¥è¯·æ±‚ã€‚</li></ul><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Node.js ä¸­ <code>Event: &#39;connection&#39;</code> çš„åº”ç”¨ï¼</p><h3 id="event-droprequest" tabindex="-1"><a class="header-anchor" href="#event-droprequest"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-droprequest" target="_blank" rel="noopener noreferrer">Event: &#39;dropRequest&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿå¤„ç†ç½‘ç»œè¯·æ±‚ã€è®¿é—®æ•°æ®åº“ç­‰åç«¯æ“ä½œçš„ç¨‹åºã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-event-droprequest" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-event-droprequest"><span>ä»€ä¹ˆæ˜¯ Event: &#39;dropRequest&#39;?</span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>&#39;dropRequest&#39;</code>äº‹ä»¶æ˜¯ HTTP æ¨¡å—çš„ä¸€ä¸ªæ–°ç‰¹æ€§ã€‚HTTP æ¨¡å—ç”¨äºåˆ›å»º Web æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚å½“ä¸€ä¸ª HTTP æœåŠ¡å™¨å› ä¸ºæŸäº›åŸå› å†³å®šä¸å¤„ç†ï¼ˆå³â€œä¸¢å¼ƒâ€ï¼‰ä¸€ä¸ªæ”¶åˆ°çš„è¯·æ±‚æ—¶ï¼Œå°±ä¼šè§¦å‘<code>&#39;dropRequest&#39;</code>äº‹ä»¶ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-droprequest-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-droprequest-äº‹ä»¶"><span>ä¸ºä»€ä¹ˆéœ€è¦&#39;dropRequest&#39;äº‹ä»¶ï¼Ÿ</span></a></h3><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨å¯èƒ½å› ä¸ºå¤šç§åŸå› æ‹’ç»å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœ€å¸¸è§çš„å‡ ä¸ªåŸå› åŒ…æ‹¬ï¼š</p><ul><li><strong>æœåŠ¡å™¨è¿‡è½½</strong>ï¼šå¦‚æœæœåŠ¡å™¨åœ¨çŸ­æ—¶é—´å†…æ”¶åˆ°äº†è¿‡å¤šè¯·æ±‚ï¼Œä¸ºäº†ä¿æŠ¤æœåŠ¡å™¨ä¸è¢«å‹å®ï¼Œå¯èƒ½ä¼šé€‰æ‹©ä¸¢å¼ƒä¸€äº›è¯·æ±‚ã€‚</li><li><strong>ç»´æŠ¤çŠ¶æ€</strong>ï¼šæœåŠ¡å™¨å¯èƒ½å› ä¸ºæ­£åœ¨è¿›è¡Œç»´æŠ¤è€Œæš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ã€‚</li><li><strong>å®‰å…¨è€ƒè™‘</strong>ï¼šå¦‚æœæ£€æµ‹åˆ°æŸäº›è¯·æ±‚å¯èƒ½æ˜¯æ¶æ„çš„ï¼Œä¸ºäº†ä¿æŠ¤æœåŠ¡å™¨å’Œå…¶å®ƒç”¨æˆ·çš„å®‰å…¨ï¼ŒæœåŠ¡å™¨å¯ä»¥é€‰æ‹©ä¸å¤„ç†è¿™äº›è¯·æ±‚ã€‚</li></ul><h3 id="å¦‚ä½•ä½¿ç”¨-droprequest-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-droprequest-äº‹ä»¶"><span>å¦‚ä½•ä½¿ç”¨&#39;dropRequest&#39;äº‹ä»¶ï¼Ÿ</span></a></h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜å¦‚ä½•ç›‘å¬å¹¶å¤„ç†<code>&#39;dropRequest&#39;</code>äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;dropRequest&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dropRequest</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> head</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä¸€ä¸ªè¯·æ±‚è¢«ä¸¢å¼ƒ</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥æ‰§è¡Œä¸€äº›é¢å¤–çš„æ—¥å¿—è®°å½•æˆ–æ¸…ç†å·¥ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒå¯¹æ‰€æœ‰æ¥æ”¶åˆ°çš„è¯·æ±‚å›å¤&quot;Hello World&quot;ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>.on()</code>æ–¹æ³•ç›‘å¬äº†<code>&#39;dropRequest&#39;</code>äº‹ä»¶ã€‚è™½ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰ä¸»åŠ¨è§¦å‘<code>&#39;dropRequest&#39;</code>äº‹ä»¶ï¼ˆå› ä¸ºè¿™é€šå¸¸æ˜¯ç”± Node.js å†…éƒ¨åŸºäºç‰¹å®šé€»è¾‘è‡ªåŠ¨è§¦å‘çš„ï¼‰ï¼Œä½†å¦‚æœè¯¥äº‹ä»¶è¢«è§¦å‘ï¼Œæˆ‘ä»¬å°†åœ¨æ§åˆ¶å°æ‰“å°å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œæç¤ºæœ‰è¯·æ±‚è¢«ä¸¢å¼ƒã€‚è¿™å¯¹äºè°ƒè¯•å’Œç›‘æ§æœåŠ¡å™¨è¡Œä¸ºéå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-12"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œä½ è¿è¥ç€ä¸€ä¸ªåœ¨çº¿å•†åŸï¼Œåœ¨å¤§ä¿ƒé”€æ—¥é‚£å¤©ï¼Œæµé‡æ¿€å¢ã€‚æœåŠ¡å™¨çªç„¶é—´æ”¶åˆ°äº†æˆç™¾ä¸Šåƒå€å¹³æ—¶çš„è¯·æ±‚é‡ï¼Œä¸ºäº†é˜²æ­¢æœåŠ¡å™¨å´©æºƒï¼Œä¿è¯æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿçš„ç¨³å®šï¼Œä½ å¯èƒ½ä¼šé‡‡å–ç­–ç•¥ï¼Œæ¯”å¦‚è®¾ç½®è¯·æ±‚ä¼˜å…ˆçº§ã€é™æµç­‰ï¼Œè¶…å‡ºå¤„ç†èƒ½åŠ›çš„è¯·æ±‚åˆ™å¯èƒ½è¢«ä¸¢å¼ƒã€‚è¿™æ—¶ï¼Œ<code>&#39;dropRequest&#39;</code>äº‹ä»¶å°±å¯ä»¥å¸®åŠ©ä½ ç›‘æ§åˆ°å“ªäº›è¯·æ±‚è¢«ä¸¢å¼ƒäº†ï¼Œä»¥ä¾¿ä½ åˆ†æé—®é¢˜ã€è°ƒæ•´ç­–ç•¥ï¼Œç”šè‡³å¯¹ç”¨æˆ·åšå‡ºä¸€äº›å“åº”æªæ–½ï¼Œæ¯”å¦‚é‡å®šå‘åˆ°é”™è¯¯é¡µé¢æˆ–æç¤ºç”¨æˆ·ç¨åå†è¯•ã€‚</p><h3 id="event-request" tabindex="-1"><a class="header-anchor" href="#event-request"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-request" target="_blank" rel="noopener noreferrer">Event: &#39;request&#39;</a></span></a></h3><p>Node.js ä¸­çš„ &#39;request&#39; äº‹ä»¶æ˜¯åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå°¤å…¶æ˜¯å½“ä½ ä½¿ç”¨ Node.js çš„ <code>http</code> æ¨¡å—åˆ›å»ºæœåŠ¡å™¨æ—¶ã€‚ä¸ºäº†è®©è¿™ä¸ªæ¦‚å¿µæ›´åŠ æ˜“äºç†è§£ï¼Œæˆ‘å°†ä¼šåˆ†æ­¥éª¤åœ°å‘ä½ ä»‹ç»ï¼Œå¹¶ä¸”ä¸¾ä¸€äº›å®é™…çš„ä¾‹å­ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-3"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ˜ç¡®ä»€ä¹ˆæ˜¯ Node.jsã€‚Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿå¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰åç«¯åŠŸèƒ½çš„ä»£ç ã€‚</p><h3 id="http-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#http-æ¨¡å—"><span>HTTP æ¨¡å—</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æä¾›äº†ä¸€äº›æ„å»º HTTP æœåŠ¡çš„å·¥å…·ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¨¡å—æ¥åˆ›å»ºæœåŠ¡å™¨ï¼Œç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯ï¼ˆå¦‚ç½‘é¡µæµè§ˆå™¨ï¼‰çš„è¯·æ±‚ï¼Œå¹¶å›åº”è¿™äº›è¯·æ±‚ã€‚</p><h3 id="event-request-1" tabindex="-1"><a class="header-anchor" href="#event-request-1"><span>Event: &#39;request&#39;</span></a></h3><p>å½“ä½ ä½¿ç”¨ <code>http</code> æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨åï¼Œæ¯æ¬¡æœ‰å®¢æˆ·ç«¯å‘è¯¥æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå°±ä¼šè§¦å‘ &#39;request&#39; äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶æ˜¯ç”±ä¸¤ä¸ªä¸»è¦å¯¹è±¡ç»„æˆçš„ï¼š<code>req</code> (request) å’Œ <code>res</code> (response)ã€‚</p><ul><li><code>req</code>ï¼ˆè¯·æ±‚å¯¹è±¡ï¼‰åŒ…å«äº†è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚çš„ URLã€å¤´éƒ¨(headers)ã€æ–¹æ³•(method)ç­‰ã€‚</li><li><code>res</code>ï¼ˆå“åº”å¯¹è±¡ï¼‰ç”¨äºæ„å»ºå¹¶å‘é€å›å®¢æˆ·ç«¯çš„å“åº”ï¼ŒåŒ…æ‹¬è®¾ç½®å“åº”å¤´ã€çŠ¶æ€ç ã€å‘é€å“åº”æ­£æ–‡ç­‰ã€‚</li></ul><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶ï¼Œè¿”å› &quot;Hello, World!&quot;ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å®ç°çš„æ­¥éª¤å’Œä»£ç ï¼š</p><ol><li><p><strong>åˆå§‹åŒ–é¡¹ç›®</strong>: é¦–å…ˆï¼Œç¡®ä¿ä½ çš„è®¡ç®—æœºä¸Šå®‰è£…äº† Node.jsã€‚ç„¶åï¼Œæ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ä½œä¸ºé¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨ <code>npm init</code> åˆå§‹åŒ–ä½ çš„ Node.js é¡¹ç›®ã€‚</p></li><li><p><strong>åˆ›å»ºæœåŠ¡å™¨</strong>: åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>server.js</code> çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹ä»£ç ã€‚</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œè®¾ç½®å“åº”å¤´éƒ¨å†…å®¹ç±»å‹ä¸º text/plain</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”æ•°æ® &quot;Hello, World!&quot; å¹¶ç»“æŸå“åº”è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p><strong>è¿è¡ŒæœåŠ¡å™¨</strong>: åœ¨å‘½ä»¤è¡Œä¸­ï¼Œè¿›å…¥åˆ°åŒ…å« <code>server.js</code> æ–‡ä»¶çš„ç›®å½•ï¼Œæ‰§è¡Œ <code>node server.js</code>ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡å™¨å¼€å§‹è¿è¡Œï¼Œå¹¶ç›‘å¬ 3000 ç«¯å£ã€‚</p></li><li><p><strong>æµ‹è¯•</strong>: æ‰“å¼€ä½ çš„ç½‘é¡µæµè§ˆå™¨ï¼Œè®¿é—® <code>http://127.0.0.1:3000/</code>ï¼Œä½ å°†çœ‹åˆ°é¡µé¢ä¸Šæ˜¾ç¤º &quot;Hello, World!&quot;ã€‚</p></li></ol><h3 id="æ€»ç»“-8" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-8"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤å’Œç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Node.js ä¸­å¤„ç† &#39;request&#39; äº‹ä»¶æ˜¯å¦‚ä½•åˆ›å»ºåŸºæœ¬çš„ç½‘ç»œåº”ç”¨çš„å…³é”®æ­¥éª¤ä¹‹ä¸€ã€‚ä½¿ç”¨ <code>http</code> æ¨¡å—åˆ›å»ºæœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡ç›‘å¬ &#39;request&#39; äº‹ä»¶æ¥å¤„ç†è¿›æ¥çš„ç½‘ç»œè¯·æ±‚ï¼Œæ ¹æ®éœ€è¦æ„å»ºå’Œå‘é€å“åº”ã€‚è¿™åªæ˜¯ Node.js åŠŸèƒ½çš„å†°å±±ä¸€è§’ï¼Œä½†æŒæ¡è¿™ä¸ªåŸºç¡€çŸ¥è¯†å¯¹äºå¼€å‘æ›´å¤æ‚çš„ç½‘ç»œåº”ç”¨è‡³å…³é‡è¦ã€‚</p><h3 id="event-upgrade-1" tabindex="-1"><a class="header-anchor" href="#event-upgrade-1"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-upgrade_1" target="_blank" rel="noopener noreferrer">Event: &#39;upgrade&#39;</a></span></a></h3><p>Node.js ä¸­çš„ &#39;upgrade&#39; äº‹ä»¶ä¸»è¦ç”¨äºåœ¨ HTTP æœåŠ¡å™¨ä¸Šå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä»æ™®é€šçš„ HTTP åè®®å‡çº§åˆ°å…¶ä»–åè®®çš„æƒ…å†µã€‚è¿™ç§åè®®å‡çº§ç»å¸¸å‘ç”Ÿåœ¨éœ€è¦å»ºç«‹ä¸€ä¸ªæŒä¹…è¿æ¥ï¼Œå¦‚ä½¿ç”¨ WebSocket åè®®è¿›è¡Œå®æ—¶åŒå‘é€šè®¯çš„æƒ…å†µä¸­ã€‚</p><p>å½“å®¢æˆ·ç«¯æƒ³è¦ä½¿ç”¨æ–°çš„åè®®ä¸æœåŠ¡å™¨é€šè®¯æ—¶ï¼Œå®ƒä¼šåœ¨å…¶è¯·æ±‚å¤´éƒ¨å‘é€ä¸€ä¸ª <code>Upgrade</code> è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚å‘Šè¯‰æœåŠ¡å™¨ï¼šâ€œæˆ‘å¸Œæœ›ä» HTTP åè®®åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåè®®â€ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™æ ·çš„è¯·æ±‚åï¼Œå¦‚æœæ”¯æŒå‡çº§åˆ°è¯¥åè®®ï¼Œå°±ä¼šè§¦å‘ &#39;upgrade&#39; äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­å®Œæˆåè®®å‡çº§çš„è¿‡ç¨‹ã€‚</p><p>ä¸ºäº†ç»™ä½ ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªä½¿ç”¨ WebSocket çš„èŠå¤©åº”ç”¨ã€‚WebSocket æ˜¯ä¸€ç§å…è®¸å¼€æ”¾æŒä¹…åŒ–è¿æ¥çš„åè®®ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿå®æ—¶åœ°å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ã€‚ä¸‹é¢æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­ç›‘å¬ &#39;upgrade&#39; äº‹ä»¶å¹¶ä¸”ä¸º WebSocket è¯·æ±‚å¤„ç†åè®®å‡çº§çš„ä¸€ä¸ªç®€å•ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†æ­£å¸¸çš„ HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;upgrade&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">upgrade</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> head</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¸Œæœ›å‡çº§åè®®çš„è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶è¢«è§¦å‘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥è¯·æ±‚çš„å‡çº§ç±»å‹æ˜¯å¦æ˜¯ WebSocket</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">upgrade</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">websocket</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // TODO: è¿™é‡Œä½¿ç”¨ WebSocket åº“å¤„ç† WebSocket æ¡æ‰‹ã€è®¤è¯ç­‰é€»è¾‘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾æˆ‘ä»¬éªŒè¯é€šè¿‡å¹¶å‡†å¤‡å»ºç«‹ WebSocket è¿æ¥ï¼Œ</span></span>
<span class="line"><span style="color:#616E88;">    // æˆ‘ä»¬å¯èƒ½éœ€è¦å†™å…¥å“åº”å¤´éƒ¨ï¼Œç„¶åå°†socketä¼ é€’ç»™ WebSocket åº“</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // ç¤ºä¾‹ä¸­æœªåŒ…æ‹¬ WebSocket çš„è¯¦ç»†å¤„ç†ä»£ç </span></span>
<span class="line"><span style="color:#616E88;">    // å®é™…æƒ…å†µä¸­ä½ éœ€è¦ä½¿ç”¨ä¾‹å¦‚ &#39;ws&#39; è¿™æ ·çš„åº“æ¥å¤„ç† WebSocket ç›¸å…³æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">WebSocket upgrade requested</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœä¸æ˜¯ WebSocketï¼Œç»“æŸ socket è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTTP/1.1 400 Bad Request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// HTTP æœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æœåŠ¡å™¨æ£€æµ‹åˆ° <code>Upgrade</code> è¯·æ±‚å¤´ä¸º &quot;websocket&quot; æ—¶ï¼Œå®ƒå°±ä¼šè¿›è¡Œä¸€ç³»åˆ—çš„æ¡æ‰‹æ“ä½œæ¥å»ºç«‹ä¸€ä¸ª WebSocket è¿æ¥ã€‚æ³¨æ„ï¼Œåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œå¤„ç† WebSocket æ¡æ‰‹å’Œè¿æ¥çš„éƒ¨åˆ†é€šå¸¸ä¼šä½¿ç”¨ä¸“é—¨çš„åº“ï¼Œæ¯”å¦‚ <code>ws</code> æˆ–è€… <code>socket.io</code>ï¼Œå› ä¸ºè¿™äº›åº“æä¾›äº†æ›´å®Œæ•´ã€æ›´å®‰å…¨çš„å®ç°ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>&#39;upgrade&#39;</code> äº‹ä»¶åœ¨ Node.js ä¸­æ˜¯å¤„ç†åè®®å‡çº§è¯·æ±‚çš„é‡è¦æœºåˆ¶ï¼Œå°¤å…¶æ˜¯å¯¹äºé‚£äº›éœ€è¦ä½å»¶è¿Ÿé€šè®¯çš„åº”ç”¨éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨çº¿æ¸¸æˆã€å®æ—¶èŠå¤©åº”ç”¨æˆ–è€…ä»»ä½•éœ€è¦å®æ—¶æ•°æ®æ¨é€çš„æƒ…å†µã€‚</p><h3 id="server-close-callback" tabindex="-1"><a class="header-anchor" href="#server-close-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#serverclosecallback" target="_blank" rel="noopener noreferrer">server.close([callback])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚è®©æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ <code>server.close([callback])</code> è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒåœ¨ Node.js çš„ http æ¨¡å—ä¸­éå¸¸é‡è¦ã€‚</p><h3 id="server-close-callback-1" tabindex="-1"><a class="header-anchor" href="#server-close-callback-1"><span>server.close([callback])</span></a></h3><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯åœæ­¢æœåŠ¡å™¨æ¥å—æ–°çš„è¿æ¥ï¼Œå¹¶ä¿æŒå·²ç»å­˜åœ¨çš„è¿æ¥ç›´åˆ°å®ƒä»¬ç»“æŸä¸ºæ­¢ï¼Œç„¶åå…³é—­æœåŠ¡å™¨ã€‚è¿™é€šå¸¸ç”¨äºä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨ã€‚</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>[callback]</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œä¸€ä¸ªå‡½æ•°ï¼Œå½“æœåŠ¡å™¨å…³é—­æ—¶è¢«è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªç½‘ç«™æˆ– API æœåŠ¡ï¼Œç°åœ¨éœ€è¦è¿›è¡Œç»´æŠ¤æˆ–è€…å‡çº§æœåŠ¡ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰æ–°çš„è¿æ¥è¯·æ±‚è¿›æ¥ï¼Œä½†åŒæ—¶å¸Œæœ›å½“å‰å·²ç»å»ºç«‹çš„è¿æ¥èƒ½å¤Ÿæ­£å¸¸å®Œæˆã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>server.close([callback])</code> æ–¹æ³•ã€‚</p><h4 id="ç¤ºä¾‹-1-åˆ›å»ºå¹¶å…³é—­-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºå¹¶å…³é—­-http-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1ï¼šåˆ›å»ºå¹¶å…³é—­ HTTP æœåŠ¡å™¨</span></a></h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å†³å®šå…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 10ç§’åå…³é—­æœåŠ¡å™¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥ <code>http</code> æ¨¡å—ï¼Œç„¶åä½¿ç”¨è¯¥æ¨¡å—åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å¯¹æ‰€æœ‰è¯·æ±‚å“åº” &quot;Hello World\n&quot;ã€‚é€šè¿‡ <code>server.listen</code> æ–¹æ³•ï¼ŒæœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œ10 ç§’åè§¦å‘ <code>server.close</code> æ–¹æ³•ï¼Œå…³é—­æœåŠ¡å™¨ï¼Œå¹¶åœ¨å…³é—­åæ‰“å° &quot;Server closed&quot;ã€‚</p><h4 id="ç¤ºä¾‹-2-ä¼˜é›…çš„å…³é—­æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä¼˜é›…çš„å…³é—­æœåŠ¡å™¨"><span>ç¤ºä¾‹ 2ï¼šä¼˜é›…çš„å…³é—­æœåŠ¡å™¨</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªæ›´å®é™…çš„åœºæ™¯ï¼ŒæœåŠ¡å™¨æ­£åœ¨å¤„ç†è‹¥å¹²é•¿è¿æ¥ï¼ˆä¾‹å¦‚ WebSocketï¼‰ï¼Œçªç„¶æ”¶åˆ°å…³é—­å‘½ä»¤ã€‚ä½ ä¸å¸Œæœ›ç«‹å³ä¸­æ–­è¿™äº›è¿æ¥ï¼Œè€Œæ˜¯æƒ³ç­‰å¾…å®ƒä»¬å®Œæˆå½“å‰å·¥ä½œã€‚è¿™æ—¶ï¼Œå¯ä»¥ç»“åˆ <code>server.close()</code> å’Œæ£€æŸ¥æ´»åŠ¨è¿æ¥çš„é€»è¾‘æ¥å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#616E88;">/* å¤„ç†å‡½æ•° */</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> activeConnections</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Set</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  activeConnections</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    activeConnections</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">delete</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> gracefulShutdown</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // ç¡®ä¿æ‰€æœ‰èµ„æºï¼ˆå¦‚æ•°æ®åº“è¿æ¥ï¼‰éƒ½å·²æ­£ç¡®é‡Šæ”¾</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exit</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æé†’æ‰€æœ‰è¿æ¥å°½å¿«å®Œæˆå½“å‰ä»»åŠ¡</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> activeConnections</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¯ä»¥ç»™æ¯ä¸ªsocketå‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ¯”å¦‚â€œæœåŠ¡å™¨å³å°†å…³é—­ï¼Œè¯·å°½å¿«å®Œæˆæ“ä½œâ€</span></span>
<span class="line"><span style="color:#616E88;">    // æˆ–è€…å¼ºåˆ¶å®ƒä»¬æ–­å¼€ï¼šsocket.end()</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“ä½ éœ€è¦å…³é—­æœåŠ¡å™¨æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="color:#616E88;">// gracefulShutdown();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•è¿½è¸ªæ´»è·ƒçš„è¿æ¥ï¼Œå¹¶åœ¨æœåŠ¡å™¨å…³é—­å‰ä¼˜é›…åœ°å¤„ç†å®ƒä»¬ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºéƒ½è¢«æ­£ç¡®é‡Šæ”¾ï¼ŒåŒæ—¶æä¾›äº†ä¸€ç§æœºåˆ¶æ¥å°½å¯èƒ½å‡å°‘å…³é—­å¯¹ç”¨æˆ·çš„å½±å“ã€‚</p><p>é€šè¿‡è¿™ä¸¤ä¸ªç¤ºä¾‹ï¼Œä½ åº”è¯¥å¯ä»¥ç†è§£ <code>server.close([callback])</code> åœ¨ Node.js http æ¨¡å—ä¸­çš„ä½œç”¨ï¼Œå®ƒå…è®¸å¼€å‘è€…ä¼˜é›…åœ°ç®¡ç†æœåŠ¡å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h3 id="server-closeallconnections" tabindex="-1"><a class="header-anchor" href="#server-closeallconnections"><span><a href="https://nodejs.org/docs/latest/api/http.html#servercloseallconnections" target="_blank" rel="noopener noreferrer">server.closeAllConnections()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å…¶ä¸­ï¼Œ<code>http</code>æ¨¡å—æä¾›äº†æ„å»ºç½‘ç»œæœåŠ¡çš„åŠŸèƒ½ã€‚ç†è§£<code>server.closeAllConnections()</code>æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç™½å‡ ä¸ªæ¦‚å¿µã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-4" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-4"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><strong>æœåŠ¡å™¨ï¼ˆServerï¼‰</strong>ï¼šåœ¨ç½‘ç»œä¸­ä¸ºå…¶ä»–è®¡ç®—æœºï¼ˆå®¢æˆ·ç«¯ï¼‰æä¾›æ•°æ®æˆ–æœåŠ¡çš„è®¡ç®—æœºæˆ–è½¯ä»¶ã€‚</li><li><strong>è¿æ¥ï¼ˆConnectionï¼‰</strong>ï¼šç½‘ç»œä¸­ä¸¤ä¸ªç‚¹ï¼ˆä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰ä¹‹é—´çš„é€šä¿¡é“¾è·¯ã€‚</li><li><strong>Node.js <code>http</code>æ¨¡å—</strong>ï¼šå…è®¸ Node.js è½»æ¾åˆ›å»º Web æœåŠ¡å™¨ï¼Œæ¥æ”¶è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</li></ul><h3 id="server-closeallconnections-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#server-closeallconnections-ç®€ä»‹"><span><code>server.closeAllConnections()</code>ç®€ä»‹</span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>server.closeAllConnections()</code>æ˜¯<code>http</code>æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç«‹å³å…³é—­æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰æ´»è·ƒè¿æ¥ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œæ‰€æœ‰å½“å‰æ‰“å¼€çš„è¿æ¥éƒ½ä¼šè¢«å¼ºåˆ¶å…³é—­ï¼Œè€Œä¸æ˜¯ç­‰å¾…è¿™äº›è¿æ¥è‡ªç„¶ç»“æŸã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-13"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="åœºæ™¯ä¸€-ç»´æŠ¤æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯ä¸€-ç»´æŠ¤æ›´æ–°"><span>åœºæ™¯ä¸€ï¼šç»´æŠ¤æ›´æ–°</span></a></h4><p>å‡è®¾ä½ è¿è¡Œäº†ä¸€ä¸ªç½‘ç«™ï¼Œè¿™ä¸ªç½‘ç«™çš„æœåŠ¡å™¨ç”± Node.js æä¾›æ”¯æŒã€‚ç°åœ¨ï¼Œä½ éœ€è¦å¯¹æœåŠ¡å™¨è¿›è¡Œå‡çº§æˆ–ç»´æŠ¤ã€‚åœ¨ç»´æŠ¤æœŸé—´ï¼Œä½ å¯èƒ½å¸Œæœ›æ‹’ç»æ–°çš„è¿æ¥ï¼Œå¹¶ä¸”å®‰å…¨åœ°å…³é—­æ‰€æœ‰ç°æœ‰è¿æ¥ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>server.closeAllConnections()</code>æ¥ç¡®ä¿æ‰€æœ‰ç”¨æˆ·çš„è¿æ¥éƒ½è¢«ä¼˜é›…åœ°å…³é—­ï¼Œç„¶åè¿›è¡Œç»´æŠ¤å·¥ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œä½ å†³å®šå…³é—­æ‰€æœ‰è¿æ¥</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">closeAllConnections</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">All connections are closed. Ready for maintenance.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 10ç§’åå…³é—­æ‰€æœ‰è¿æ¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åœºæ™¯äºŒ-åº”æ€¥å“åº”" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯äºŒ-åº”æ€¥å“åº”"><span>åœºæ™¯äºŒï¼šåº”æ€¥å“åº”</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„ç½‘ç«™é­å—äº† DDoS æ”»å‡»ï¼ˆåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼‰ï¼Œå¤§é‡æ¶æ„è¯·æ±‚è¯•å›¾ä½¿ä½ çš„æœåŠ¡å™¨è¶…è½½ã€‚ä¸ºäº†ä¿æŠ¤æœåŠ¡å™¨èµ„æºå¹¶ä¸”å°½å¿«å›å¤æ­£å¸¸æœåŠ¡ï¼Œä½ å¯èƒ½å†³å®šæš‚æ—¶å…³é—­æ‰€æœ‰æ´»è·ƒçš„è¿æ¥ï¼Œç„¶åé€æ­¥æ¢å¤æœåŠ¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾ä½ æœ‰é¢„è­¦ç³»ç»Ÿæ£€æµ‹åˆ°DDoSæ”»å‡»</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#88C0D0;">detectDDoS</span><span style="color:#D8DEE9FF;">()) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">closeAllConnections</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Under attack. All connections are closed to protect the server.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ³¨æ„äº‹é¡¹-1" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-1"><span>æ³¨æ„äº‹é¡¹</span></a></h4><p>è™½ç„¶<code>server.closeAllConnections()</code>èƒ½å¤Ÿç«‹å³æ–­å¼€æ‰€æœ‰è¿æ¥ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­åº”è°¨æ…ä½¿ç”¨ã€‚å› ä¸ºå®ƒä¼šä¸­æ–­æ­£åœ¨å¤„ç†çš„è¯·æ±‚ï¼Œå¯èƒ½å¯¼è‡´ç”¨æˆ·ä½“éªŒä¸ä½³ã€‚é€šå¸¸ï¼Œæ›´æ¸©å’Œçš„æªæ–½å¦‚é™æµï¼ˆRate Limitingï¼‰æˆ–è€…ä½¿ç”¨æ›´åŠ å¤æ‚çš„å®‰å…¨é˜²æŠ¤æ‰‹æ®µå¯èƒ½æ›´ä¸ºåˆé€‚ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>server.closeAllConnections()</code>æ˜¯ä¸€ä¸ªå¼ºå¤§ä½†åº”è°¨æ…ä½¿ç”¨çš„å·¥å…·ï¼Œå®ƒå¯ä»¥ç”¨äºæœåŠ¡å™¨ç»´æŠ¤æˆ–åº”æ€¥å“åº”åœºæ™¯ï¼Œå¸®åŠ©ç®¡ç†å’Œæ§åˆ¶æœåŠ¡å™¨ä¸Šçš„è¿æ¥ã€‚</p><h3 id="server-closeidleconnections" tabindex="-1"><a class="header-anchor" href="#server-closeidleconnections"><span><a href="https://nodejs.org/docs/latest/api/http.html#servercloseidleconnections" target="_blank" rel="noopener noreferrer">server.closeIdleConnections()</a></span></a></h3><p>Node.js ä¸­çš„ <code>server.closeIdleConnections()</code> æ–¹æ³•æ˜¯ç”¨åœ¨åˆ›å»ºçš„ HTTP æœåŠ¡å™¨ä¸Šï¼Œå®ƒçš„ä½œç”¨æ˜¯ç«‹å³å…³é—­æ‰€æœ‰å¤„äºç©ºé—²ï¼ˆidleï¼‰çŠ¶æ€çš„è¿æ¥ã€‚åœ¨ HTTP æœåŠ¡å™¨ä¸­ï¼Œç©ºé—²è¿æ¥æŒ‡çš„æ˜¯é‚£äº›ç›®å‰æ²¡æœ‰æ´»åŠ¨è¯·æ±‚æ­£åœ¨å¤„ç†çš„è¿æ¥ã€‚</p><p>å½“ä½ è°ƒç”¨ <code>server.closeIdleConnections()</code> æ–¹æ³•æ—¶ï¼ŒNode.js ä¼šéå†å½“å‰æœåŠ¡å™¨ä¸Šæ‰€æœ‰çš„è¿æ¥ï¼Œå¹¶æ‰¾å‡ºé‚£äº›ç©ºé—²çš„è¿æ¥ï¼Œç„¶åå…³é—­è¿™äº›è¿æ¥ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€æé«˜å®‰å…¨æ€§ï¼ˆé€šè¿‡å‡å°‘æ½œåœ¨çš„åƒµå°¸è¿æ¥ï¼‰ä»¥åŠä¿è¯æœåŠ¡å™¨ä¸ä¼šå› ä¸ºç»´æŒæ— ç”¨çš„è¿æ¥è€Œæµªè´¹èµ„æºã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>server.closeIdleConnections()</code> æ–¹æ³•é€šå¸¸ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ï¼š</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-5"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>èµ„æºä¼˜åŒ–</strong>ï¼š<br> å¦‚æœä½ çš„æœåŠ¡å™¨åœ¨æŸæ®µæ—¶é—´ä¹‹åä¼šå˜å¾—éå¸¸å¿™ç¢Œï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨å¿™ç¢Œä¹‹å‰é‡Šæ”¾æ‰ä¸€äº›èµ„æºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å‘¨æœŸæ€§åœ°è°ƒç”¨ <code>server.closeIdleConnections()</code> æ¥å…³é—­é‚£äº›ä¸å†éœ€è¦çš„è¿æ¥ï¼Œä»¥ç¡®ä¿æœ‰è¶³å¤Ÿçš„èµ„æºæ¥å¤„ç†æ–°çš„è¯·æ±‚ã€‚</p></li><li><p><strong>ç»´æŠ¤å’Œå‡çº§</strong>ï¼š<br> å½“æœåŠ¡å™¨éœ€è¦è¿›è¡Œç»´æŠ¤æˆ–å‡çº§æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦å…ˆå…³é—­æ‰€æœ‰ç°æœ‰çš„ç©ºé—²è¿æ¥ï¼Œä»¥ç¡®ä¿æ‰€æœ‰çš„è¯·æ±‚éƒ½å·²ç»å¤„ç†å®Œæˆã€‚ç„¶åä½ å¯ä»¥å®‰å…¨åœ°åœæ­¢æœåŠ¡å™¨ï¼Œè¿›è¡Œå¿…è¦çš„æ›´æ–°ï¼Œè€Œä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚</p></li><li><p><strong>å®‰å…¨æªæ–½</strong>ï¼š<br> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé•¿æ—¶é—´ç©ºé—²çš„è¿æ¥å¯èƒ½ä¼šè¢«è§†ä¸ºä¸€ä¸ªæ½œåœ¨çš„å®‰å…¨é£é™©ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ æ‹…å¿ƒæœ‰äººå¯èƒ½åˆ©ç”¨è¿™äº›è¿æ¥æ¥è¿›è¡Œæ¶æ„è¡Œä¸ºã€‚é€šè¿‡å®šæœŸå…³é—­è¿™äº›ç©ºé—²è¿æ¥ï¼Œä½ å¯ä»¥å¸®åŠ©é™ä½è¿™ä¸ªé£é™©ã€‚</p></li><li><p><strong>å“åº”é‡çº§æ‰©å±•</strong>ï¼š<br> å‡è®¾ä½ çš„æœåŠ¡å™¨åŸºäºè´Ÿè½½æƒ…å†µä¼šè‡ªåŠ¨æ‰©å±•ï¼ˆscale up/downï¼‰ã€‚åœ¨è´Ÿè½½å‡å°‘æ—¶ï¼Œä½ å¯èƒ½ä¸å†éœ€è¦ä¹‹å‰ä¸ºäº†åº”å¯¹é«˜è´Ÿè½½è€Œå¼€å¯çš„å¤§é‡è¿æ¥ã€‚ä½¿ç”¨ <code>server.closeIdleConnections()</code> å¯ä»¥å¸®åŠ©å¿«é€Ÿé™ä½èµ„æºä½¿ç”¨ï¼Œä½¿å¾—å¯ä»¥æ›´æœ‰æ•ˆåœ°ç¼©å°æœåŠ¡å™¨è§„æ¨¡ã€‚</p></li></ol><h3 id="å¦‚ä½•ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-1"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨ <code>server.closeIdleConnections()</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æ­¤å‡½æ•°ä¼šåœ¨ä½ æƒ³è¦å…³é—­ç©ºé—²è¿æ¥çš„æ—¶å€™è¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> handleCleanup</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">closeIdleConnections</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Idle connections have been closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½ å¯èƒ½ä¼šæ ¹æ®å…·ä½“éœ€æ±‚è°ƒç”¨ handleCleanup å‡½æ•°ï¼Œä¾‹å¦‚å¯ä»¥è®¾ç½®å®šæ—¶å™¨æˆ–è€…å“åº”æŸä¸ªä¿¡å·</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">handleCleanup</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 60000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 60ç§’åå…³é—­æ‰€æœ‰ç©ºé—²è¿æ¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤Ÿå“åº”è¯·æ±‚å¹¶è¿”å›â€œHello, World!â€ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>handleCleanup</code> çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨äº† <code>server.closeIdleConnections()</code> æ¥å…³é—­æ‰€æœ‰ç©ºé—²çš„è¿æ¥ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>setTimeout</code> åœ¨ 60 ç§’åè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ¸…ç†å‡½æ•°ï¼Œä»è€Œå…³é—­ç©ºé—²è¿æ¥ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šæ ¹æ®ä¸åŒçš„è§¦å‘æ¡ä»¶æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><h3 id="server-headerstimeout" tabindex="-1"><a class="header-anchor" href="#server-headerstimeout"><span><a href="https://nodejs.org/docs/latest/api/http.html#serverheaderstimeout" target="_blank" rel="noopener noreferrer">server.headersTimeout</a></span></a></h3><p><code>server.headersTimeout</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒç”¨äºæŒ‡å®šæœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€å®Œæ•´ HTTP è¯·æ±‚å¤´çš„æœ€é•¿æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´æ˜¯ä»¥æ¯«ç§’ä¸ºå•ä½çš„ã€‚</p><p>å½“ä½ åˆ›å»ºä¸€ä¸ª http æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ã€‚æ¯ä¸ª HTTP è¯·æ±‚ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ä¸‰éƒ¨åˆ†ç»„æˆã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šæœ‰æ¶æ„çš„å®¢æˆ·ç«¯æˆ–è€…å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´è¯·æ±‚å¤´æ²¡æœ‰åŠæ—¶å®Œå…¨ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨èµ„æºçš„æµªè´¹ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸€ç›´åœ¨ç­‰å¾…å‰©ä½™çš„è¯·æ±‚æ•°æ®ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒNode.js å…è®¸ä½ é€šè¿‡è®¾ç½® <code>server.headersTimeout</code> æ¥å®šä¹‰æœåŠ¡å™¨åº”è¯¥ç­‰å¾…å¤šä¹…ã€‚å¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…è¯·æ±‚å¤´æ²¡æœ‰è¢«å®Œå…¨æ¥æ”¶ï¼ŒæœåŠ¡å™¨å°†ä¸­æ­¢è¿æ¥ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>server.headersTimeout</code> çš„å€¼å¯èƒ½å¤§çº¦æ˜¯ä¸¤åˆ†é’Ÿï¼ˆä½†å…·ä½“é»˜è®¤å€¼å¯èƒ½ä¼šéšç€ä¸åŒç‰ˆæœ¬çš„ Node.js è€Œå˜åŒ–ï¼‰ã€‚å¦‚æœä½ æƒ³è¦ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå¯ä»¥åœ¨åˆ›å»º http æœåŠ¡å™¨åè®¾ç½®è¿™ä¸ªå±æ€§ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>server.headersTimeout</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¤„ç†è¯·æ±‚å¹¶å‘é€å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½® headersTimeout ä¸º 30000 æ¯«ç§’ (30 ç§’)</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersTimeout</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 30000</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£ä¸Šçš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„ HTTP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨åªæ˜¯ç®€å•åœ°å¯¹æ‰€æœ‰è¯·æ±‚è¿”å› &quot;Hello World&quot; æ–‡æœ¬ã€‚ç„¶åï¼Œæˆ‘ä»¬å°† <code>headersTimeout</code> è®¾ç½®ä¸º 30000 æ¯«ç§’ï¼ˆ30 ç§’ï¼‰ã€‚è¿™æ„å‘³ç€å¦‚æœæœåŠ¡å™¨æ²¡æœ‰åœ¨ 30 ç§’å†…æ¥æ”¶åˆ°å®Œæ•´çš„è¯·æ±‚å¤´ï¼Œé‚£ä¹ˆå®ƒå°†è‡ªåŠ¨å…³é—­è¿æ¥ã€‚</p><p>è¿™ä¸ªè®¾ç½®æœ‰åŠ©äºé˜²æ­¢æ½œåœ¨çš„æ…¢é€Ÿæ”»å‡»ï¼ˆSlowloris æ”»å‡»ï¼‰ï¼Œè¿™ç§æ”»å‡»é€šè¿‡ç¼“æ…¢å‘é€ HTTP è¯·æ±‚å¤´ï¼Œè¯•å›¾è€—å°½æœåŠ¡å™¨èµ„æºä»è€Œä½¿æ­£å¸¸ç”¨æˆ·æ— æ³•è®¿é—®æœåŠ¡ã€‚é€šè¿‡è®¾ç½®åˆç†çš„ <code>headersTimeout</code> å€¼ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿåœ¨è§„å®šæ—¶é—´å†…é‡Šæ”¾è¿æ¥ï¼Œç»§è€Œå¯æœåŠ¡äºå…¶ä»–æ­£å¸¸çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><h3 id="server-listen" tabindex="-1"><a class="header-anchor" href="#server-listen"><span><a href="https://nodejs.org/docs/latest/api/http.html#serverlisten" target="_blank" rel="noopener noreferrer">server.listen()</a></span></a></h3><p>Node.js çš„ <code>server.listen()</code> æ–¹æ³•ç”¨äºå¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶è®©å®ƒç›‘å¬ç‰¹å®šçš„ç«¯å£å’Œä¸»æœºã€‚å½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šå¤šç§å‚æ•°æ¥å†³å®šæœåŠ¡å™¨å¦‚ä½•ç›‘å¬è¯·æ±‚ï¼Œä¾‹å¦‚ç«¯å£å·ã€ä¸»æœºåå’Œå›è°ƒå‡½æ•°ã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>server.listen()</code> å‡ ç§å¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼š</p><h3 id="_1-ç›‘å¬ç‰¹å®šç«¯å£" tabindex="-1"><a class="header-anchor" href="#_1-ç›‘å¬ç‰¹å®šç«¯å£"><span>1. ç›‘å¬ç‰¹å®šç«¯å£</span></a></h3><p>å½“ä½ æƒ³è®©ä½ çš„æœåŠ¡å™¨åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šçš„ç‰¹å®šç«¯å£ç›‘å¬å…¥ç«™è¿æ¥æ—¶ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šå¯¹æ‰€æœ‰è¯·æ±‚è¿”å› &quot;Hello World&quot; å­—ç¬¦ä¸²ã€‚<code>server.listen(3000)</code> è¡¨ç¤ºæœåŠ¡å™¨å°†ç›‘å¬æœ¬åœ°è®¡ç®—æœºä¸Šçš„ 3000 ç«¯å£ã€‚å½“æœåŠ¡å™¨æˆåŠŸå¼€å§‹ç›‘å¬ç«¯å£æ—¶ï¼Œå›è°ƒå‡½æ•°å°†è¢«æ‰§è¡Œï¼Œæ‰“å°ä¸€æ¡ä¿¡æ¯åˆ°æ§åˆ¶å°ã€‚</p><h3 id="_2-ç›‘å¬ç«¯å£å¹¶æŒ‡å®šä¸»æœºå" tabindex="-1"><a class="header-anchor" href="#_2-ç›‘å¬ç«¯å£å¹¶æŒ‡å®šä¸»æœºå"><span>2. ç›‘å¬ç«¯å£å¹¶æŒ‡å®šä¸»æœºå</span></a></h3><p>å¦‚æœä½ è¿˜æƒ³æŒ‡å®šä¸»æœºåï¼ˆæ¯”å¦‚åªå…è®¸æ¥è‡ªæŸä¸ªç‰¹å®š IP åœ°å€çš„æµé‡ï¼‰ï¼Œä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªä¸»æœºå‚æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼ŒæœåŠ¡å™¨åªä¼šå“åº”å‘é€åˆ° <code>127.0.0.1</code> ï¼ˆå³ localhostï¼‰çš„è¯·æ±‚ã€‚</p><h3 id="_3-éšæœºåˆ†é…ç«¯å£" tabindex="-1"><a class="header-anchor" href="#_3-éšæœºåˆ†é…ç«¯å£"><span>3. éšæœºåˆ†é…ç«¯å£</span></a></h3><p>æœ‰æ—¶å€™ä½ å¯èƒ½æƒ³è¦æœåŠ¡å™¨ç›‘å¬ä»»æ„å¯ç”¨çš„ç«¯å£ï¼Œè€Œä¸æ˜¯å›ºå®šç«¯å£ã€‚è¿™å¯ä»¥é€šè¿‡ä¼ é€’ <code>0</code> ä½œä¸ºç«¯å£å·å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> address</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Server running at http://</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Node.js ä¼šä¸ºä½ é€‰æ‹©ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„ç«¯å£ã€‚é€šè¿‡ <code>server.address()</code> å¯ä»¥è·å–å®é™…è¢«ç›‘å¬çš„åœ°å€å’Œç«¯å£ä¿¡æ¯ã€‚</p><h3 id="_4-ä½¿ç”¨-promise-å’Œå¼‚æ­¥å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_4-ä½¿ç”¨-promise-å’Œå¼‚æ­¥å‡½æ•°"><span>4. ä½¿ç”¨ Promise å’Œå¼‚æ­¥å‡½æ•°</span></a></h3><p>åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>util.promisify</code> å°† <code>listen</code> å‡½æ•°è½¬åŒ–ä¸ºè¿”å› Promise çš„å‡½æ•°ï¼Œç„¶åç”¨ async/await è¿›è¡Œæ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> util</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">util</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">...</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">listen</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> util</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">promisify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">listen</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> startServer</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">startServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>startServer</code> æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå®ƒç­‰å¾…æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£ 3000ã€‚ä¸€æ—¦ç«¯å£ç›‘å¬å¼€å§‹ï¼Œå®ƒå°†è¾“å‡ºæ—¥å¿—ã€‚</p><p>è¿™äº›æ˜¯ <code>server.listen()</code> æ–¹æ³•çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ï¼Œå®ƒè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒè®©ä½ çš„ Node.js åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ¥å¬ç½‘ç»œè¯·æ±‚ã€‚åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç¡®ä¿æ­£ç¡®è®¾ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåå¯¹äºç¡®ä¿åº”ç”¨ç¨‹åºçš„æ­£ç¡®å·¥ä½œå’Œå®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</p><h3 id="server-listening" tabindex="-1"><a class="header-anchor" href="#server-listening"><span><a href="https://nodejs.org/docs/latest/api/http.html#serverlistening" target="_blank" rel="noopener noreferrer">server.listening</a></span></a></h3><p>Node.js ä¸­çš„ <code>server.listening</code> å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå®ƒç”¨æ¥è¡¨ç¤ºä¸€ä¸ª Node.js æœåŠ¡å™¨å®ä¾‹æ˜¯å¦æ­£åœ¨ç›‘å¬è¿æ¥ã€‚åœ¨ Node.js çš„ <code>http</code> æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”é€šè¿‡è°ƒç”¨å®ƒçš„ <code>listen</code> æ–¹æ³•æ¥å¼€å§‹æ¥æ”¶ç½‘ç»œè¯·æ±‚ã€‚</p><p>å½“ä½ è°ƒç”¨äº† <code>server.listen()</code> æ–¹æ³•ä»¥åï¼ŒNode.js ä¼šå¯åŠ¨ HTTP æœåŠ¡å™¨å¹¶å¼€å§‹ç›‘å¬æŒ‡å®šçš„ç«¯å£ï¼ˆæ¯”å¦‚ 80ã€8080 ç­‰ï¼‰ä¸Šçš„ç½‘ç»œè¯·æ±‚ã€‚ä¸€æ—¦æœåŠ¡å™¨å‡†å¤‡å¥½å¹¶å¼€å§‹ç›‘å¬è¯·æ±‚ï¼Œ<code>server.listening</code> å±æ€§å°±ä¼šå˜æˆ <code>true</code>ã€‚å¦‚æœæœåŠ¡å™¨æ²¡æœ‰å¯åŠ¨æˆ–è€…å·²ç»è¢«å…³é—­ï¼Œåˆ™è¯¥å±æ€§ä¼šæ˜¯ <code>false</code>ã€‚</p><p>ä¸‹é¢æ˜¯ <code>server.listening</code> å±æ€§çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">listening</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ­¤æ—¶å°†ä¼šæ‰“å° falseï¼Œå› ä¸ºæœåŠ¡å™¨è¿˜æ²¡å¼€å§‹ç›‘å¬</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£ 3000 ä¸Šçš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨ listen å›è°ƒå‡½æ•°ä¸­ï¼Œæ­¤æ—¶å°†ä¼šæ‰“å° trueï¼Œå› ä¸ºæœåŠ¡å™¨å·²ç»å¼€å§‹ç›‘å¬</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">listening</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨æŸä¸ªæ—¶åˆ»æˆ‘ä»¬æƒ³è¦åœæ­¢æœåŠ¡å™¨æ¥æ”¶æ–°çš„è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is now closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åœ¨æœåŠ¡å™¨å…³é—­åï¼Œæ­¤æ—¶å°†ä¼šæ‰“å° false</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">listening</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† Node.js çš„ <code>http</code> æ¨¡å—ï¼Œå¹¶ä½¿ç”¨ <code>http.createServer()</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ HTTP æœåŠ¡å™¨ã€‚æˆ‘ä»¬ä¼ é€’ç»™ <code>createServer</code> çš„å›è°ƒå‡½æ•°å®šä¹‰äº†æœåŠ¡å™¨å¦‚ä½•å¤„ç†è¿›å…¥çš„è¯·æ±‚ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå¯¹æ‰€æœ‰è¯·æ±‚ï¼ŒæœåŠ¡å™¨éƒ½ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç ä¸º 200 çš„å“åº”ï¼Œå¹¶å‘é€æ–‡æœ¬ â€œHello Worldâ€ã€‚</p><p>æˆ‘ä»¬è°ƒç”¨äº† <code>server.listen(3000)</code> æ¥å‘Šè¯‰æœåŠ¡å™¨åœ¨æœ¬åœ°æœºå™¨çš„ 3000 ç«¯å£ä¸Šç›‘å¬è¯·æ±‚ã€‚ç„¶åï¼Œåœ¨ <code>listen</code> æ–¹æ³•çš„å›è°ƒä¸­ï¼Œæˆ‘ä»¬æ‰“å°å‡º <code>server.listening</code> çš„å€¼ï¼Œè¿™æ—¶å€™å®ƒåº”è¯¥æ˜¯ <code>true</code>ï¼Œå› ä¸ºæœåŠ¡å™¨å·²ç»å¼€å§‹ç›‘å¬è¯·æ±‚ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>server.close()</code> æ–¹æ³•æ¥åœæ­¢æœåŠ¡å™¨æ¥æ”¶æ–°çš„è¿æ¥ï¼Œå¹¶åœ¨å…³é—­ä¹‹åå†æ¬¡æ£€æŸ¥ <code>server.listening</code> çš„å€¼ï¼Œè¿™æ—¶å®ƒå°†ä¼šæ˜¯ <code>false</code>ã€‚</p><h3 id="server-maxheaderscount" tabindex="-1"><a class="header-anchor" href="#server-maxheaderscount"><span><a href="https://nodejs.org/docs/latest/api/http.html#servermaxheaderscount" target="_blank" rel="noopener noreferrer">server.maxHeadersCount</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Web å¼€å‘ä¸­ï¼ŒNode.js ç»å¸¸è¢«ç”¨æ¥æ„å»ºåå°æœåŠ¡ï¼ˆAPIsï¼‰ï¼Œè¿™æ ·å‰ç«¯åº”ç”¨å°±å¯ä»¥é€šè¿‡è¿™äº› APIs è·å–æˆ–å‘é€æ•°æ®ã€‚äº†è§£ Node.js å¯¹äº Web å¼€å‘æ¥è¯´éå¸¸é‡è¦ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.maxHeadersCount</code>æ˜¯ HTTP æœåŠ¡å™¨çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå®ƒå®šä¹‰äº†æœåŠ¡å™¨èƒ½å¤Ÿæ¥å—çš„æœ€å¤§ HTTP å¤´æ•°é‡ã€‚å¦‚æœè¯·æ±‚åŒ…å«çš„å¤´éƒ¨æ•°é‡è¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼ŒNode.js å°†ä¼šæ‹’ç»è¯¥è¯·æ±‚ï¼Œå¹¶è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”ã€‚è¿™æ˜¯ä¸€ä¸ªå®‰å…¨ç‰¹æ€§ï¼Œæ—¨åœ¨é˜²æ­¢æ¶æ„ç”¨æˆ·é€šè¿‡å‘é€å¤§é‡çš„æ— æ•ˆè¯·æ±‚å¤´æ¥è¯•å›¾è€—å°½æœåŠ¡å™¨èµ„æºï¼ˆä¸€ç§ç§°ä¸º HTTP å¤´æ”»å‡»çš„æŠ€æœ¯ï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>server.maxHeadersCount</code>çš„å€¼è¢«è®¾ç½®ä¸º<code>2000</code>ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªè¯·æ±‚ä¸­æœ€å¤šå¯ä»¥åŒ…å« 2000 ä¸ªå¤´éƒ¨ä¿¡æ¯ã€‚è¿™ä¸ªå€¼é€šå¸¸è¶³å¤Ÿæ—¥å¸¸ä½¿ç”¨ï¼Œä½†æ ¹æ®ä½ çš„åº”ç”¨éœ€æ±‚ï¼Œä½ å¯èƒ½éœ€è¦è°ƒæ•´è¿™ä¸ªæ•°å­—ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-10"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><strong>åŸºæœ¬çš„ Web æœåŠ¡å™¨</strong>ï¼š</li></ol><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ï¼Œä½ æƒ³ç¡®ä¿å®ƒä¸å®¹æ˜“å—åˆ° HTTP å¤´æ”»å‡»ã€‚ä½ å¯ä»¥è®¾ç½®<code>maxHeadersCount</code>æ¥å‡å°‘èƒ½è¢«æ¥å—çš„å¤´éƒ¨æ•°é‡ï¼Œä½œä¸ºä¸€ç§é¢å¤–çš„å®‰å…¨æªæ–½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®æœ€å¤§å¤´éƒ¨æ•°é‡ä¸º500</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxHeadersCount</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 500</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>API æœåŠ¡å™¨</strong>ï¼š</li></ol><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª APIï¼Œè¿™ä¸ª API æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡å¤æ‚è¯·æ±‚ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šå®šåˆ¶åŒ–çš„ HTTP å¤´éƒ¨ç”¨äºè®¤è¯ã€ç¼“å­˜æ§åˆ¶ç­‰ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¦‚æœé»˜è®¤çš„<code>maxHeadersCount</code>å€¼è¿‡ä½ï¼Œå¯èƒ½ä¼šæ— æ„ä¸­é˜»æ­¢åˆæ³•çš„è¯·æ±‚ã€‚å› æ­¤ï¼Œé€‚å½“å¢åŠ è¿™ä¸ªå€¼å¯èƒ½æ˜¯å¿…è¦çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> express</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> app</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> express</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">app</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">API Home</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬é¢„æœŸä¼šæ”¶åˆ°åŒ…å«å¤šä¸ªè‡ªå®šä¹‰å¤´éƒ¨çš„å¤æ‚è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxHeadersCount</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 2500</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æé«˜æœ€å¤§å¤´éƒ¨æ•°é‡é™åˆ¶</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">API server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“æ¥è¯´ï¼Œ<code>server.maxHeadersCount</code>æ˜¯ Node.js ä¸­ç”¨äºå¢å¼ºæœåŠ¡å™¨å®‰å…¨å’Œç¨³å®šæ€§çš„é…ç½®é€‰é¡¹ä¹‹ä¸€ã€‚æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚ï¼Œé€‚å½“åœ°è°ƒæ•´è¿™ä¸ªå€¼å¯ä»¥å¸®åŠ©ä½ æ„å»ºæ›´å¥å£®ã€æ›´å®‰å…¨çš„ Web åº”ç”¨ã€‚</p><h3 id="server-requesttimeout" tabindex="-1"><a class="header-anchor" href="#server-requesttimeout"><span><a href="https://nodejs.org/docs/latest/api/http.html#serverrequesttimeout" target="_blank" rel="noopener noreferrer">server.requestTimeout</a></span></a></h3><p>Node.js ä¸­çš„ <code>server.requestTimeout</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº Node.js çš„ <code>http</code> æ¨¡å—ä¸­çš„ <code>Server</code> ç±»ã€‚è¿™ä¸ªå±æ€§å…è®¸ä½ è®¾ç½®æœåŠ¡å™¨åœ¨å…³é—­ä¸€ä¸ªé—²ç½®è¯·æ±‚ä¹‹å‰ç­‰å¾…çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ä¸€æ—¦è®¾ç½®äº†è¿™ä¸ªæ—¶é—´ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æœ‰åœ¨æŒ‡å®šçš„æ—¶é—´å†…æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼ˆå…³é—­ï¼‰è¿™ä¸ªè¯·æ±‚ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<code>server.requestTimeout</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬é˜²æ­¢æŸäº›ç±»å‹çš„æ”»å‡»ï¼Œæ¯”å¦‚æ…¢é€Ÿè¯»å–æ”»å‡»ï¼ˆSlowlorisï¼‰ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¼˜åŒ–æœåŠ¡å™¨èµ„æºçš„ä½¿ç”¨ï¼Œé˜²æ­¢å ç”¨è¿‡é•¿æ—¶é—´çš„è¿æ¥ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•åœ¨ Node.js http æœåŠ¡å™¨ä¸­è®¾ç½® <code>requestTimeout</code> å±æ€§çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ”¶åˆ°è¯·æ±‚åå‘é€å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½® requestTimeout ä¸º 5000 æ¯«ç§’ï¼ˆ5 ç§’ï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">requestTimeout</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 5000</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯åŠ¨æœåŠ¡å™¨ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒè¿”å› &quot;Hello World&quot;ã€‚æˆ‘ä»¬è¿˜è®¾ç½®äº† <code>requestTimeout</code> ä¸º 5000 æ¯«ç§’ï¼Œè¿™æ„å‘³ç€å¦‚æœæœåŠ¡å™¨åœ¨ 5 ç§’å†…æ²¡æœ‰ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°å®Œæ•´çš„è¯·æ±‚æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°†è¢«è‡ªåŠ¨å…³é—­ã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¼€å§‹å‘æˆ‘ä»¬çš„æœåŠ¡å™¨å‘èµ·è¯·æ±‚ä½†æ˜¯å‘é€æ•°æ®å¾ˆæ…¢æˆ–è€…åœæ­¢å‘é€äº†ï¼Œå¦‚æœè¶…è¿‡äº† 5 ç§’ï¼Œå³ä¾¿è¯·æ±‚æ²¡æœ‰å®Œæˆï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šå…³é—­è¿™ä¸ªè¿æ¥ã€‚è¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨è€Œè¨€æ˜¯ä¸€ç§ä¿æŠ¤æœºåˆ¶ï¼Œå®ƒé¿å…äº†æœåŠ¡å™¨æ— é™æœŸåœ°ç­‰å¾…æŸäº›è¯·æ±‚ï¼Œä»è€Œå¯ä»¥é‡Šæ”¾èµ„æºå»å¤„ç†å…¶ä»–è¯·æ±‚ã€‚</p><h3 id="server-settimeout-msecs-callback" tabindex="-1"><a class="header-anchor" href="#server-settimeout-msecs-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#serversettimeoutmsecs-callback" target="_blank" rel="noopener noreferrer">server.setTimeout([msecs][, callback])</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ° Node.js ä¸­çš„<code>server.setTimeout([msecs][, callback])</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºå¦‚ä½•æ§åˆ¶æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ—¶é—´ã€‚è¿™ä¸ªæ¦‚å¿µè™½ç„¶å¬èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œä½†æˆ‘ä¼šé€šè¿‡ä¸€äº›ç®€å•çš„ä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-4" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-4"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ã€‚åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡å™¨å“åº”ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè¿‡ç¨‹å°½å¯èƒ½å¿«ï¼Œä½†æœ‰æ—¶å› ä¸ºå„ç§åŸå› ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ã€‚å¦‚æœè¶…è¿‡äº†ä¸€å®šçš„æ—¶é—´ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¸å†éœ€è¦è¿™ä¸ªè¯·æ±‚çš„ç»“æœäº†ã€‚è¿™å°±æ˜¯<code>setTimeout</code>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>å…·ä½“åˆ° Node.js çš„<code>server.setTimeout()</code>æ–¹æ³•ï¼Œå®ƒå…è®¸ä½ è®¾ç½®æœåŠ¡å™¨åœ¨è‡ªåŠ¨ç»“æŸå“åº”å‰ç­‰å¾…çš„æœ€é•¿æ—¶é—´ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªæ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œä¸€æ—¦è¾¾åˆ°è¿™ä¸ªæ—¶é—´é™åˆ¶ï¼Œå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢è¯·æ±‚ã€‚</p><h3 id="å‚æ•°è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>msecs</code>: è¿™æ˜¯è¶…æ—¶æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æŒ‡å®šæœåŠ¡å™¨ç­‰å¾…å¤šä¹…ã€‚å¦‚æœè¿™ä¸ªå‚æ•°æ²¡æœ‰è¢«è®¾ç½®ï¼Œé‚£ä¹ˆé»˜è®¤çš„è¶…æ—¶æ—¶é—´å°†ä¼šè¢«ä½¿ç”¨ã€‚</li><li><code>callback</code>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå½“è¯·æ±‚è¶…æ—¶æ—¶ä¼šè¢«æ‰§è¡Œã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œå®šä¹‰å½“è¯·æ±‚è¶…æ—¶æ—¶æƒ³è¦æ‰§è¡Œçš„æ“ä½œã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-11"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªæä¾›å¤©æ°”é¢„æŠ¥ä¿¡æ¯çš„ Web æœåŠ¡ã€‚ç”¨æˆ·é€šè¿‡ç½‘é¡µæäº¤ä»–ä»¬çš„ä½ç½®ï¼Œç„¶åæœåŠ¡å™¨è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„è®¡ç®—ï¼Œæœ€åè¿”å›æœªæ¥å‡ å¤©çš„å¤©æ°”é¢„æŠ¥ã€‚</p><p><strong>ä¾‹å­ 1: è®¾ç½®è¶…æ—¶</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¤æ‚çš„é€»è¾‘å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#616E88;">  // æ¯”å¦‚ä»æ•°æ®åº“è·å–æ•°æ®ï¼Œæˆ–è€…è¿›è¡Œä¸€äº›è€—æ—¶è®¡ç®—</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º2åˆ†é’Ÿ</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">120000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request has timed out.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®æœåŠ¡å™¨å¯¹æ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ä¸è¶…è¿‡ 2 åˆ†é’Ÿã€‚å¦‚æœå¤„ç†æŸä¸ªè¯·æ±‚è¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼ŒæœåŠ¡å™¨å°†ä¼šè‡ªåŠ¨ç»ˆæ­¢è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”<code>console.log</code>å°†è¾“å‡º&quot;Request has timed out.&quot;ã€‚</p><p><strong>ä¾‹å­ 2: ä¸è®¾ç½®å›è°ƒ</strong></p><p>ä½ ä¹Ÿå¯ä»¥ä¸è®¾ç½®å›è°ƒå‡½æ•°ã€‚å¦‚æœä½ åªå…³å¿ƒé™åˆ¶æ—¶é—´ï¼Œè€Œä¸éœ€è¦åœ¨è¶…æ—¶å‘ç”Ÿæ—¶æ‰§è¡Œç‰¹å®šçš„ä»£ç ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º2åˆ†é’Ÿï¼Œæ²¡æœ‰æä¾›è¶…æ—¶å›è°ƒ</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">120000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè¯·æ±‚è¶…æ—¶ï¼ŒæœåŠ¡å™¨ä»ç„¶ä¼šè‡ªåŠ¨ç»ˆæ­¢è¯·æ±‚ï¼Œä½†ä¸ä¼šæœ‰ä»»ä½•é¢å¤–çš„æ“ä½œæ‰§è¡Œã€‚</p><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä½¿ç”¨<code>server.setTimeout()</code>æ–¹æ³•ï¼Œä½ å¯ä»¥æ›´å¥½åœ°æ§åˆ¶ Node.js æœåŠ¡å™¨ä¸Šçš„è¯·æ±‚å¤„ç†æµç¨‹ï¼Œç¡®ä¿æœåŠ¡å™¨ä¸ä¼šå› ä¸ºæŸäº›éå¸¸è€—æ—¶çš„è¯·æ±‚è€Œå˜å¾—ä¸å“åº”ã€‚è¿™å¯¹äºæé«˜ç”¨æˆ·ä½“éªŒå’ŒæœåŠ¡çš„å¯é æ€§è‡³å…³é‡è¦ã€‚</p><h3 id="server-maxrequestspersocket" tabindex="-1"><a class="header-anchor" href="#server-maxrequestspersocket"><span><a href="https://nodejs.org/docs/latest/api/http.html#servermaxrequestspersocket" target="_blank" rel="noopener noreferrer">server.maxRequestsPerSocket</a></span></a></h3><p><code>server.maxRequestsPerSocket</code> æ˜¯åœ¨ Node.js v21.7.1 åŠå…¶åç»­ç‰ˆæœ¬ä¸­å¼•å…¥çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒç”¨äºé…ç½® HTTP æœåŠ¡å™¨å¯¹è±¡ (<code>http.Server</code>) ä¸Šæ¯ä¸ª socketï¼ˆç½‘ç»œè¿æ¥ï¼‰å¯ä»¥å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ã€‚è¿™æ˜¯é’ˆå¯¹ HTTP/1.1 è¿æ¥çš„è®¾ç½®ï¼Œå› ä¸º HTTP/2 å’Œæ›´é«˜ç‰ˆæœ¬å·²ç»æœ‰äº†å†…ç½®çš„æœºåˆ¶æ¥å¤„ç†ç±»ä¼¼çš„é™åˆ¶ã€‚</p><p>åœ¨ç†è§£ <code>server.maxRequestsPerSocket</code> ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼š</p><ul><li><strong>HTTP</strong>: è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰æ˜¯ç”¨äºä¼ è¾“è¶…æ–‡æœ¬ï¼ˆä¾‹å¦‚ç½‘é¡µï¼‰ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰çš„åè®®ã€‚</li><li><strong>Socket</strong>: åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œsocket æ˜¯ç«¯ç‚¹ä¹‹é—´åŒå‘é€šä¿¡é“¾è·¯çš„ä¸€ä¸ªæŠ½è±¡ã€‚åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹è¿æ¥æ—¶ï¼Œå®ƒä»¬ä¹‹é—´çš„æ•°æ®é€šè¿‡è¿™ä¸ªâ€œsocketâ€æ¥ä¼ é€’ã€‚</li><li><strong>HTTP/1.1 æŒä¹…è¿æ¥</strong>: åœ¨ HTTP/1.1 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥æ˜¯æŒä¹…çš„ï¼Œå³ä¸ä¼šåœ¨ä¼ è¾“å•ä¸ªè¯·æ±‚/å“åº”åç«‹å³å…³é—­ã€‚è¿™æ ·å¯ä»¥å‡å°‘å»ºç«‹å’Œå…³é—­è¿æ¥çš„å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚</li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº <code>server.maxRequestsPerSocket</code> çš„ä½œç”¨ï¼š</p><h3 id="ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#ä½œç”¨"><span>ä½œç”¨</span></a></h3><p><code>server.maxRequestsPerSocket</code> å…è®¸ä½ è®¾ç½®ä¸€ä¸ªæ•´æ•°å€¼ï¼Œè¡¨ç¤ºæ¯ä¸ª socket è¿æ¥ä¸Šå…è®¸å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ã€‚å½“è¾¾åˆ°è¿™ä¸ªé™åˆ¶åï¼Œå½“å‰çš„ socket è¿æ¥å°†ä¼šè¢«å…³é—­ï¼Œå¦‚æœè¿˜æœ‰è¯·æ±‚éœ€è¦å¤„ç†ï¼Œåˆ™å¿…é¡»å»ºç«‹æ–°çš„è¿æ¥ã€‚</p><h3 id="é»˜è®¤å€¼-2" tabindex="-1"><a class="header-anchor" href="#é»˜è®¤å€¼-2"><span>é»˜è®¤å€¼</span></a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§çš„å€¼æ˜¯ <code>0</code>ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼Œsocket å¯ä»¥å¤„ç†æ— é™æ•°é‡çš„è¯·æ±‚ï¼ˆæˆ–è€…ç›´åˆ°è¿æ¥è‡ªç„¶ç»“æŸï¼‰ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>è®¾å®š <code>server.maxRequestsPerSocket</code> çš„å€¼ä¸»è¦ç”¨äºæ§åˆ¶èµ„æºä½¿ç”¨å’Œç®¡ç†æœåŠ¡å™¨è´Ÿè½½ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡é™åˆ¶æ¯ä¸ªè¿æ¥çš„è¯·æ±‚æ•°ï¼Œå¯ä»¥é¿å…æŸäº›å®¢æˆ·ç«¯è¿‡åº¦å ç”¨æœåŠ¡å™¨è¿æ¥èµ„æºï¼Œä¿è¯æœåŠ¡å™¨å¯¹æ‰€æœ‰å®¢æˆ·ç«¯çš„å“åº”æ›´åŠ å…¬å¹³å’Œé«˜æ•ˆã€‚</p><h3 id="å®é™…ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-3"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js HTTP æœåŠ¡å™¨ï¼Œä½ å¸Œæœ›é™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥æœ€å¤šåªèƒ½å‘é€ 100 ä¸ªè¯·æ±‚ï¼Œä¹‹åè¿™ä¸ªè¿æ¥å°†è¢«å…³é—­ï¼Œå¦‚æœå®¢æˆ·ç«¯è¿˜æƒ³ç»§ç»­é€šä¿¡ï¼Œå°±éœ€è¦æ–°å»ºä¸€ä¸ªè¿æ¥ã€‚ä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®æ¯ä¸ª socket æœ€å¤šå¯å¤„ç† 100 ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxRequestsPerSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 100</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»»ä½•é€šè¿‡è¿™ä¸ªæœåŠ¡å™¨çš„ socket è¿æ¥å‘é€çš„è¯·æ±‚ï¼Œä¸€æ—¦è¾¾åˆ°äº† 100 ä¸ªè¯·æ±‚çš„é™åˆ¶ï¼Œè¯¥è¿æ¥ä¼šè¢«å…³é—­ã€‚è¿™ç§æœºåˆ¶æœ‰åŠ©äºç®¡ç†æœåŠ¡å™¨çš„èµ„æºå’Œæ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨é¢å¯¹å¤§é‡å¹¶å‘è¿æ¥æ—¶ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œé€šè¿‡ <code>server.maxRequestsPerSocket</code> çš„åˆç†é…ç½®ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ä½ çš„ Node.js åº”ç”¨çš„æ€§èƒ½å’Œèµ„æºä½¿ç”¨æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡ HTTP/1.1 è¯·æ±‚æ—¶ã€‚</p><h3 id="server-timeout" tabindex="-1"><a class="header-anchor" href="#server-timeout"><span><a href="https://nodejs.org/docs/latest/api/http.html#servertimeout" target="_blank" rel="noopener noreferrer">server.timeout</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨é€»è¾‘ï¼Œå°±å¦‚åŒä½¿ç”¨ JavaScript æ¥æ§åˆ¶ç½‘é¡µè¡Œä¸ºä¸€æ ·ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æä¾›äº†åˆ›å»ºç½‘ç»œæœåŠ¡çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ HTTP Web æœåŠ¡å™¨ã€‚è¿™æ˜¯ Node.js æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒå…è®¸ä½ ä»¥ JavaScript ä¸ºæ ¸å¿ƒï¼Œæ„å»ºå…¨æ ˆåº”ç”¨ç¨‹åºã€‚</p><h3 id="server-timeout-1" tabindex="-1"><a class="header-anchor" href="#server-timeout-1"><span>server.timeout</span></a></h3><p>åœ¨ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>server.timeout</code> å±æ€§ç”¨äºè®¾ç½®æœåŠ¡å™¨ä¸Šè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯ <code>120000</code> æ¯«ç§’ï¼ˆ2 åˆ†é’Ÿï¼‰ã€‚å½“è¯·æ±‚è¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡æœ‰è¢«ç›¸åº”ï¼Œåˆ™ä¼šè‡ªåŠ¨ä¸­æ–­è¯·æ±‚ã€‚</p><p>è¿™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©é˜²æ­¢æŸäº›è¯·æ±‚æ— é™æœŸåœ°æŒ‚èµ·ï¼Œä»è€Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ã€‚é€šè¿‡è®¾ç½®ä¸€ä¸ªåˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œä½ å¯ä»¥ç¡®ä¿æœåŠ¡å™¨èƒ½å¤Ÿåœ¨é‡åˆ°é•¿æ—¶é—´è¿è¡Œæˆ–å¡ä½çš„è¯·æ±‚æ—¶é‡Šæ”¾èµ„æºï¼Œç»§è€Œå¤„ç†å…¶ä»–è¯·æ±‚ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-14"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>åˆ›å»ºåŸºæœ¬çš„ HTTP æœåŠ¡å™¨ï¼Œå¹¶è®¾ç½®è¶…æ—¶</strong></p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤Ÿå“åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œä½†ä½ æƒ³è¦ç¡®ä¿å¦‚æœè¯·æ±‚å¤„ç†æ—¶é—´è¿‡é•¿ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿè‡ªåŠ¨ä¸­æ–­é‚£ä¸ªè¯·æ±‚ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ <code>server.timeout</code> æ¥å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¯·æ±‚å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º1åˆ†é’Ÿ</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">timeout</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 60000</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 3000 ç«¯å£ã€‚é€šè¿‡è®¾ç½® <code>server.timeout = 60000;</code>ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 1 åˆ†é’Ÿã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä»»ä½•è¯·æ±‚ 1 åˆ†é’Ÿå†…æ²¡æœ‰å®Œæˆï¼ŒæœåŠ¡å™¨å°†è‡ªåŠ¨å…³é—­è¯¥è¿æ¥ã€‚</p></li><li><p><strong>å¤„ç†è¶…æ—¶çš„è¯·æ±‚</strong></p><p>é™¤äº†è®¾ç½®è¶…æ—¶æ—¶é—´å¤–ï¼Œä½ å¯èƒ½è¿˜æƒ³çŸ¥é“å¦‚ä½•å¤„ç†é‚£äº›è¶…æ—¶çš„è¯·æ±‚ã€‚è™½ç„¶ <code>server.timeout</code> è‡ªèº«åªè´Ÿè´£è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä½†ä½ å¯ä»¥ç»“åˆä½¿ç”¨äº‹ä»¶ç›‘å¬æ¥å¤„ç†è¶…æ—¶æƒ…å†µï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“è¯·æ±‚è¶…æ—¶æ—¶ï¼Œè¿™é‡Œçš„ä»£ç å°†è¢«æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request has timed out.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘å®¢æˆ·ç«¯å‘é€è¶…æ—¶ä¿¡æ¯</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•ç›‘å¬è¶…æ—¶äº‹ä»¶ï¼Œå¹¶ç»™å‡ºåé¦ˆã€‚å½“è¯·æ±‚è¶…æ—¶æ—¶ï¼Œ<code>&#39;timeout&#39;</code>äº‹ä»¶è¢«è§¦å‘ï¼Œç„¶åæ‰§è¡Œå›è°ƒå‡½æ•°æ¥å¤„ç†è¿™ä¸ªæƒ…å†µã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€â€œRequest timeoutâ€æ¶ˆæ¯æ¥å“åº”è¶…æ—¶ã€‚</p></li></ol><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>server.timeout</code> åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­æ§åˆ¶å’Œç®¡ç†è¯·æ±‚è¶…æ—¶æ–¹é¢èµ·ç€å…³é”®ä½œç”¨ã€‚æ­£ç¡®è®¾ç½®å’Œå¤„ç†è¯·æ±‚è¶…æ—¶ï¼Œä¸ä»…å¯ä»¥æé«˜æœåŠ¡å™¨æ€§èƒ½ï¼Œè¿˜å¯ä»¥æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚</p><h3 id="server-keepalivetimeout" tabindex="-1"><a class="header-anchor" href="#server-keepalivetimeout"><span><a href="https://nodejs.org/docs/latest/api/http.html#serverkeepalivetimeout" target="_blank" rel="noopener noreferrer">server.keepAliveTimeout</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.keepAliveTimeout</code>æ˜¯ä¸€ä¸ªè®¾ç½®å±äº HTTP æœåŠ¡å™¨çš„å±æ€§ï¼Œè¯¥å±æ€§æ§åˆ¶äº†å½“è¿æ¥å¤„äºé—²ç½®çŠ¶æ€æ—¶ï¼ˆå³æ²¡æœ‰æ•°æ®è¢«ä¼ è¾“ï¼‰ï¼Œå¤šä¹…ä¹‹åæœåŠ¡å™¨ä¼šå…³é—­è¿™ä¸ª TCP è¿æ¥ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP/1.1 åè®®ä¸­çš„è¿æ¥æ˜¯æŒä¹…è¿æ¥ï¼ˆpersistent connectionsï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šä¿¡å®Œä¸€ä¸ªè¯·æ±‚åï¼Œè¿æ¥ä¸ä¼šç«‹å³å…³é—­ï¼Œè€Œæ˜¯å¯ä»¥è¢«ç”¨æ¥ä¼ è¾“åç»­çš„è¯·æ±‚ã€‚è¿™æ ·åšå¯ä»¥å‡å°‘å»ºç«‹å’Œå…³é—­è¿æ¥çš„å¼€é”€ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p><p><code>keepAliveTimeout</code>çš„ä½œç”¨æ˜¯è®¾ç½®ä¸€ä¸ªæ—¶é—´é˜ˆå€¼ï¼Œå¦‚æœä¸€ä¸ªè¿æ¥åœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ´»åŠ¨ï¼ˆä¾‹å¦‚ï¼Œæ²¡æœ‰æ–°çš„æ•°æ®è¢«ä¼ è¾“ï¼‰ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†è‡ªåŠ¨å…³é—­è¿™ä¸ªè¿æ¥ã€‚å‡è®¾ä½ å°†<code>keepAliveTimeout</code>è®¾ç½®ä¸º 10000 æ¯«ç§’ï¼ˆå³ 10 ç§’ï¼‰ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´çª—å£å†…æœåŠ¡å™¨æ²¡æœ‰æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æˆ–æ•°æ®ï¼Œåˆ™ä¼šå…³é—­è¿æ¥ã€‚</p><h3 id="å®é™…ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-4"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js çš„ Web æœåŠ¡å™¨ï¼Œå¹¶ä¸”æƒ³è¦æ›´ç»†è‡´åœ°æ§åˆ¶æœåŠ¡å™¨çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡å¹¶å‘è¿æ¥æ—¶ï¼Œè°ƒæ•´<code>keepAliveTimeout</code>å¯èƒ½ä¼šå¯¹æ€§èƒ½æœ‰æ‰€å¸®åŠ©ã€‚</p><p><strong>ä¾‹å­ 1ï¼šè®¾ç½® <code>keepAliveTimeout</code></strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®é—²ç½®è¿æ¥è¶…æ—¶æ—¶é—´ä¸º10ç§’</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">keepAliveTimeout</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 10000</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒå¯¹æ‰€æœ‰è¯·æ±‚éƒ½è¿”å›&quot;Hello World&quot;ã€‚ç„¶åæˆ‘ä»¬è®¾ç½®äº†<code>keepAliveTimeout</code>ä¸º 10 ç§’ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥å 10 ç§’å†…æ²¡æœ‰åç»­çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†å…³é—­è¿™ä¸ªè¿æ¥ã€‚</p><p><strong>ä¾‹å­ 2ï¼šæµ‹è¯•æœåŠ¡å™¨çš„ <code>keepAliveTimeout</code></strong></p><p>ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹<code>curl</code>å‘½ä»¤æµ‹è¯•æœåŠ¡å™¨çš„<code>keepAliveTimeout</code>åŠŸèƒ½ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">curl</span><span style="color:#A3BE8C;"> -v</span><span style="color:#A3BE8C;"> --keepalive-time</span><span style="color:#B48EAD;"> 11</span><span style="color:#A3BE8C;"> http://localhost:3000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šè¿°å‘½ä»¤ä¸­<code>--keepalive-time</code>å‚æ•°æŒ‡å®šäº†<code>curl</code>ä¿æŒè¿æ¥æ´»è·ƒçš„æ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®æˆ 11 ç§’ï¼Œæ¯”æœåŠ¡å™¨çš„<code>keepAliveTimeout</code>ç•¥é•¿ã€‚ç”±äºæœåŠ¡å™¨è®¾ç½®äº† 10 ç§’çš„è¶…æ—¶æ—¶é—´ï¼Œæ‰€ä»¥å³ä¾¿<code>curl</code>è¯·æ±‚ä¿æŒè¿æ¥ï¼ŒæœåŠ¡å™¨è¿˜æ˜¯ä¼šåœ¨ 10 ç§’åå…³é—­è¿æ¥ã€‚</p><p>é€šè¿‡è°ƒæ•´<code>keepAliveTimeout</code>ï¼Œä½ å¯ä»¥ç®¡ç†æœåŠ¡å™¨èµ„æºçš„ä½¿ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨é«˜æµé‡çš„åœºæ™¯ä¸‹ï¼Œåˆç†çš„è®¾ç½®å¯ä»¥å¸®åŠ©é¿å…æœåŠ¡å™¨èµ„æºçš„æµªè´¹ï¼Œå› ä¸ºæŒä¹…è¿æ¥è™½ç„¶èƒ½æé«˜æ•ˆç‡ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå ç”¨æœåŠ¡å™¨çš„æ–‡ä»¶æè¿°ç¬¦ç­‰èµ„æºã€‚è®©æœåŠ¡å™¨ç»´æŠ¤å¤§é‡ç©ºé—²çš„è¿æ¥å¯èƒ½ä¼šå¯¼è‡´èµ„æºè€—å°½ï¼Œå½±å“æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p><h3 id="serversymbol-asyncdispose-https-nodejs-org-docs-latest-api-http-html-serversymbolasyncdispose" tabindex="-1"><a class="header-anchor" href="#serversymbol-asyncdispose-https-nodejs-org-docs-latest-api-http-html-serversymbolasyncdispose"><span>[server<a href="">Symbol.asyncDispose</a>](<a href="https://nodejs.org/docs/latest/api/http.html#serversymbolasyncdispose" target="_blank" rel="noopener noreferrer">https://nodejs.org/docs/latest/api/http.html#serversymbolasyncdispose</a>)</span></a></h3><p>Node.js ä¸­çš„ <code>server[Symbol.asyncDispose]()</code> æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°ä¸”æ¯”è¾ƒé«˜çº§çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ ä»¥ä¸€ç§æ›´ä¸ºä¼˜é›…çš„æ–¹å¼æ¥å…³é—­ HTTP æœåŠ¡å™¨ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ Node.js çš„ç‰ˆæœ¬ 18.0.0 å¼•å…¥çš„ã€‚åœ¨è§£é‡Šè¿™ä¸ªç‰¹æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªç›¸å…³çš„æ¦‚å¿µï¼š</p><ol><li><p><strong>AsyncIterable protocol</strong>: è¿™æ˜¯ä¸€ä¸ª JavaScript åè®®ï¼Œå®ƒå…è®¸ä¸€ä¸ªå¯¹è±¡è¢«å¼‚æ­¥è¿­ä»£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿­ä»£è¿‡ç¨‹ä¸­å¯ä»¥è¿›è¡Œå¼‚æ­¥æ“ä½œã€‚</p></li><li><p><strong>Symbol.asyncDispose</strong>: è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½® Symbol å€¼ï¼Œå®ƒè¢« Node.js ç”¨äºå®ç°å¼‚æ­¥æ¸…ç†ï¼ˆasync disposalï¼‰çš„åè®®ã€‚å½“ä½ æ‹¥æœ‰ä¸€ä¸ªèµ„æºï¼ˆæ¯”å¦‚æœåŠ¡å™¨ã€æ–‡ä»¶æµç­‰ï¼‰ï¼Œå¹¶å¸Œæœ›åœ¨è¿™ä¸ªèµ„æºä¸å†éœ€è¦æ—¶èƒ½å¤Ÿä¼˜é›…åœ°è¿›è¡Œæ¸…ç†æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªåè®®ã€‚</p></li><li><p><strong>Graceful shutdown</strong>: æŒ‡çš„æ˜¯å½“ä½ æƒ³è¦å…³é—­ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œä½ é¦–å…ˆåœæ­¢æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œç„¶åå®Œæˆæ‰€æœ‰å·²ç»å¼€å§‹çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ€åå…³é—­æœåŠ¡ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œè¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±å’Œå…¶ä»–é”™è¯¯ã€‚</p></li></ol><p>ç°åœ¨ï¼Œå›åˆ° <code>server[Symbol.asyncDispose]()</code>ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¢«æ·»åŠ åˆ° HTTP æœåŠ¡å™¨å¯¹è±¡ä¸Šï¼Œç”¨äºå®šä¹‰å½“æœåŠ¡å™¨å³å°†å…³é—­æ—¶åº”è¯¥æ€æ ·å¼‚æ­¥æ¸…ç†èµ„æºã€‚å½“ä½ è°ƒç”¨ <code>server.close()</code> æ–¹æ³•æ¥å°è¯•å…³é—­ä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šæœ‰ <code>Symbol.asyncDispose</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨æœåŠ¡å™¨å…³é—­ä¹‹å‰è¢«è°ƒç”¨ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šå±•ç¤ºä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚</p><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ æƒ³è¦åœ¨æœåŠ¡å™¨å…³é—­å‰æ¸…ç†ä¸€äº›èµ„æºï¼Œä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥æˆ–è€…åœæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€äº›éœ€è¦æ¸…ç†çš„èµ„æº</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> resourceCleanup</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¸…ç†èµ„æº...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨è¿™é‡Œæ‰§è¡Œä»»ä½•éœ€è¦çš„èµ„æºæ¸…ç†å·¥ä½œï¼Œ</span></span>
<span class="line"><span style="color:#616E88;">  // æ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ï¼š</span></span>
<span class="line"><span style="color:#616E88;">  // await databaseConnection.close();</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ Symbol.asyncDispose å®ç°ä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">Symbol</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">asyncDispose</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨å…³é—­...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#88C0D0;"> resourceCleanup</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å·²ç»ä¼˜é›…åœ°æ¸…ç†å®Œæ¯•ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯åŠ¨æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨åœ¨ç«¯å£ 3000 ä¸Šè¿è¡Œ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¸€æ®µæ—¶é—´åæˆ‘ä»¬å†³å®šå…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ‰§è¡Œå…³é—­æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å·²ç»å…³é—­ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾10ç§’åæˆ‘ä»¬æƒ³è¦å…³é—­æœåŠ¡å™¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒä»…ä»…è¿”å› &quot;Hello, world!&quot;ã€‚ç„¶åæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>resourceCleanup</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¨¡æ‹Ÿäº†å¯èƒ½éœ€è¦è¿›è¡Œçš„ä¸€äº›æ¸…ç†ä»»åŠ¡ã€‚ç´§æ¥ç€ï¼Œæˆ‘ä»¬ç»™æœåŠ¡å™¨å¯¹è±¡è®¾ç½®äº†ä¸€ä¸ª <code>server[Symbol.asyncDispose]</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æœåŠ¡å™¨å…³é—­å‰è‡ªåŠ¨è°ƒç”¨ <code>resourceCleanup</code> å‡½æ•°æ¥æ¸…ç†èµ„æºã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>server.close()</code> æ¥å®‰æ’æœåŠ¡å™¨å…³é—­ï¼Œè¿™ä¼šè§¦å‘æˆ‘ä»¬å®šä¹‰çš„å¼‚æ­¥æ¸…ç†é€»è¾‘ã€‚</p><h2 id="class-http-serverresponse" tabindex="-1"><a class="header-anchor" href="#class-http-serverresponse"><span><a href="https://nodejs.org/docs/latest/api/http.html#class-httpserverresponse" target="_blank" rel="noopener noreferrer">Class: http.ServerResponse</a></span></a></h2><p>ç†è§£<code>http.ServerResponse</code>è¿™ä¸ªç±»æ˜¯å­¦ä¹  Node.js ä¸­ç½‘ç»œç¼–ç¨‹éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“ä½ ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ª web æœåŠ¡å™¨æ—¶ï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ä¸€ä¸ªæµè§ˆå™¨æˆ–å…¶ä»–ä»»ä½•èƒ½å‘èµ· HTTP è¯·æ±‚çš„è½¯ä»¶ï¼‰å‘ä½ çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨éœ€è¦ç»™è¿™ä¸ªè¯·æ±‚å‘é€å›ä¸€ä¸ªå“åº”ã€‚è¿™ä¸ªâ€œå“åº”â€å°±æ˜¯é€šè¿‡<code>http.ServerResponse</code>çš„å®ä¾‹æ¥æ„å»ºå’Œç®¡ç†çš„ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-5" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-5"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><p><strong>ä»€ä¹ˆæ˜¯ http.ServerResponseï¼Ÿ</strong><br><code>http.ServerResponse</code>æ˜¯ä¸€ä¸ªæ ¸å¿ƒ Node.js æ¨¡å—æä¾›çš„ç±»ï¼Œå®ƒå°è£…äº†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å“åº”ã€‚æ¯æ¬¡å½“æœ‰ HTTP è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼ŒNode.js ä¼šåˆ›å»ºä¸€ä¸ª<code>ServerResponse</code>å¯¹è±¡ï¼Œç„¶åå¼€å‘è€…é€šè¿‡è¿™ä¸ªå¯¹è±¡æ“ä½œæ¥å®šä¹‰è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ã€çŠ¶æ€ç ã€å¤´ä¿¡æ¯ç­‰ã€‚</p></li><li><p><strong>æ€æ ·ä½¿ç”¨ http.ServerResponseï¼Ÿ</strong><br> é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º<code>ServerResponse</code>å®ä¾‹ã€‚å½“ä½ åœ¨ Node.js ä¸­ä½¿ç”¨<code>http</code>æ¨¡å—åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œæ¯å½“æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è§¦å‘ï¼Œå¹¶ä¸” Node.js ä¼šä¸ºä½ ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š<code>request</code>ï¼ˆä»£è¡¨å…¥ç«™æ¶ˆæ¯/è¯·æ±‚ï¼‰ä¸<code>response</code>ï¼ˆå³<code>ServerResponse</code>å®ä¾‹ï¼Œç”¨äºæ„å»ºå¹¶å‘é€å“åº”åˆ°å®¢æˆ·ç«¯ï¼‰ã€‚</p></li></ol><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-12"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ç¤ºä¾‹-1-è¿”å›ç®€å•çš„æ–‡æœ¬å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¿”å›ç®€å•çš„æ–‡æœ¬å“åº”"><span>ç¤ºä¾‹ 1: è¿”å›ç®€å•çš„æ–‡æœ¬å“åº”</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®HTTPå“åº”å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®æœåŠ¡å™¨æ—¶ï¼ˆæ¯”å¦‚ç”¨æµè§ˆå™¨æ‰“å¼€<code>http://localhost:3000/</code>ï¼‰ï¼Œä»–ä»¬ä¼šçœ‹åˆ°é¡µé¢ä¸Šæ˜¾ç¤º&quot;Hello World!&quot;ã€‚</p><h4 id="ç¤ºä¾‹-2-è¿”å›-json-å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è¿”å›-json-å“åº”"><span>ç¤ºä¾‹ 2: è¿”å› JSON å“åº”</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®çŠ¶æ€ç å’Œå“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä½œä¸ºå“åº”ä½“</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    id</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">John Doe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    email</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">john@doe.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€JSONæ ¼å¼çš„å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•è¿”å›ä¸€ä¸ª JSON æ ¼å¼çš„å“åº”ï¼Œè¿™åœ¨åˆ›å»º API æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="æ€»ç»“-9" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-9"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡<code>http.ServerResponse</code>ç±»ï¼Œä½ å¯ä»¥æ§åˆ¶æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„æ‰€æœ‰ç»†èŠ‚ï¼ŒåŒ…æ‹¬çŠ¶æ€ç ã€å“åº”å¤´å’Œå“åº”ä½“ã€‚åˆ©ç”¨è¿™äº›åŠŸèƒ½ï¼Œä½ å¯ä»¥æ„å»ºå‡ºèƒ½å¤Ÿå¤„ç†å„ç§ HTTP è¯·æ±‚çš„å¼ºå¤§ Web åº”ç”¨å’Œ APIã€‚</p><h3 id="event-close-2" tabindex="-1"><a class="header-anchor" href="#event-close-2"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-close_2" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h3><p>å½“ä½ å¼€å§‹ä½¿ç”¨ Node.js æ¥å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œä¼šé‡åˆ°å¾ˆå¤šäº‹ä»¶é©±åŠ¨çš„æ¦‚å¿µã€‚Node.js ä¸­çš„â€œEvent: &#39;close&#39;â€å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç† HTTP æœåŠ¡å™¨æ—¶ã€‚è¿™é‡Œï¼Œæˆ‘å°†å°è¯•ç®€å•è€Œè¯¦ç»†åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼Œå¹¶ç»™å‡ºä¸€äº›å®é™…çš„ä¾‹å­ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-5" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-5"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½ä¼šè§¦å‘äº‹ä»¶ï¼›ä¾‹å¦‚ï¼Œå½“ HTTP æœåŠ¡å™¨å®Œæˆè¯·æ±‚å¤„ç†åï¼Œå®ƒå¯èƒ½ä¼šè§¦å‘ä¸€ä¸ª&#39;close&#39;äº‹ä»¶ã€‚&#39;close&#39;äº‹ä»¶è¡¨ç¤ºä¸€ä¸ªèµ„æºï¼ˆæ¯”å¦‚ HTTP æœåŠ¡å™¨ã€æ–‡ä»¶æµç­‰ï¼‰å·²ç»å…³é—­ï¼Œå¹¶ä¸”ä¸å†å¯ç”¨ã€‚</p><h3 id="event-close-3" tabindex="-1"><a class="header-anchor" href="#event-close-3"><span>[Event: &#39;close&#39;]</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼ŒHTTP æ¨¡å—å…·æœ‰ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶ç§°ä¸º&#39;close&#39;ã€‚å½“ HTTP æœåŠ¡å™¨å…³é—­æ—¶ï¼Œæ— è®ºæ˜¯ç”±äºæ­£å¸¸å…³é—­è¿˜æ˜¯å› é”™è¯¯è€Œå…³é—­ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªäº‹ä»¶çš„è§¦å‘æ„å‘³ç€æœåŠ¡å™¨ä¸å†æ¥å—æ–°çš„è¿æ¥ï¼Œå·²ç»å­˜åœ¨çš„è¿æ¥ä¹Ÿè¢«é”€æ¯ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-6"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»ºå¹¶å…³é—­-http-æœåŠ¡å™¨-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºå¹¶å…³é—­-http-æœåŠ¡å™¨-1"><span>ç¤ºä¾‹ 1ï¼šåˆ›å»ºå¹¶å…³é—­ HTTP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œä½†å‡ºäºæŸç§åŸå› ï¼Œä½ å¸Œæœ›åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å…³é—­å®ƒã€‚ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸ªç›®æ ‡çš„ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£3000</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹ŸæŸç§æ¡ä»¶ï¼Œå»¶è¿Ÿ5ç§’åå…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server closed due to maintenance.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æœåŠ¡å™¨å…³é—­æ—¶ï¼Œä¼šè§¦å‘&#39;close&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">The server has been closed and is no longer accepting connections.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†<code>http</code>æ¨¡å—å¹¶åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚æœåŠ¡å™¨ç®€å•åœ°å¯¹æ¯ä¸ªè¯·æ±‚è¿”å›â€œHello, World!â€ã€‚é€šè¿‡è°ƒç”¨<code>server.listen()</code>ï¼ŒæœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£ã€‚ç„¶ååˆ©ç”¨<code>setTimeout</code>å‡½æ•°æ¨¡æ‹Ÿäº†ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨ 5 ç§’åè‡ªåŠ¨å…³é—­æœåŠ¡å™¨ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡<code>server.on(&#39;close&#39;, callback)</code>ç›‘å¬äº†&#39;close&#39;äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨æœåŠ¡å™¨å…³é—­æ—¶æ‰§è¡Œç‰¹å®šæ“ä½œï¼ˆæ¯”å¦‚è®°å½•æ—¥å¿—æˆ–æ¸…ç†èµ„æºï¼‰ã€‚</p><h4 id="ç¤ºä¾‹-2-ç†è§£äº‹ä»¶è§¦å‘é¡ºåº" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç†è§£äº‹ä»¶è§¦å‘é¡ºåº"><span>ç¤ºä¾‹ 2ï¼šç†è§£äº‹ä»¶è§¦å‘é¡ºåº</span></a></h4><p>ç†è§£&#39;close&#39;äº‹ä»¶ä¸å…¶ä»–äº‹ä»¶ï¼ˆæ¯”å¦‚&#39;request&#39;ï¼‰ä¹‹é—´çš„è§¦å‘é¡ºåºä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚&#39;close&#39;äº‹ä»¶åªæœ‰åœ¨æ‰€æœ‰è¯·æ±‚éƒ½å¤„ç†å®Œæˆï¼Œä¸”æœåŠ¡å™¨å…³é—­åæ‰ä¼šè¢«è§¦å‘ã€‚è¿™æ„å‘³ç€ä»»ä½•å¤„äºå¤„ç†ä¸­çš„è¯·æ±‚éƒ½ä¼šå…ˆå®Œæˆï¼Œç„¶åæ‰å…³é—­æœåŠ¡å™¨ã€‚</p><p>è¿™ç§æœºåˆ¶ç¡®ä¿äº†æœåŠ¡å™¨çš„ä¼˜é›…å…³é—­ï¼Œä¸ä¼šåœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ—¶çªç„¶åœæ­¢æœåŠ¡ï¼Œä»è€Œé¿å…æ•°æ®ä¸¢å¤±æˆ–æŸåã€‚</p><h3 id="æ€»ç»“-10" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-10"><span>æ€»ç»“</span></a></h3><p>&#39;close&#39;äº‹ä»¶åœ¨ Node.js ä¸­éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°èµ„æºç®¡ç†å’Œä¼˜é›…å…³é—­ç¨‹åºæ—¶ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œå¼€å‘è€…å¯ä»¥åœ¨æœåŠ¡å™¨æˆ–å…¶ä»–èµ„æºè¢«å…³é—­æ—¶æ‰§è¡Œå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚å¸Œæœ›ä»¥ä¸Šçš„è§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Node.js ä¸­çš„&#39;close&#39;äº‹ä»¶å’Œå®ƒçš„åº”ç”¨ã€‚</p><h3 id="event-finish-1" tabindex="-1"><a class="header-anchor" href="#event-finish-1"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-finish_1" target="_blank" rel="noopener noreferrer">Event: &#39;finish&#39;</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>&#39;finish&#39;</code> äº‹ä»¶æ˜¯ä¸æµï¼ˆStreamsï¼‰å’Œ HTTP è¯·æ±‚ç›¸å…³çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å°†å…ˆä»åŸºç¡€å¼€å§‹ä»‹ç»ï¼Œç„¶åé€šè¿‡ä¾‹å­æ¥å±•ç¤ºå¦‚ä½•åœ¨å®é™…ä¸­åº”ç”¨è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><h4 id="node-js-ç®€ä»‹-1" tabindex="-1"><a class="header-anchor" href="#node-js-ç®€ä»‹-1"><span>Node.js ç®€ä»‹</span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚å®ƒéå¸¸é€‚åˆæ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯é‚£äº›éœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥è€Œä¸å ç”¨å¤ªå¤šèµ„æºçš„åº”ç”¨ã€‚Node.js çš„è®¾è®¡å“²å­¦æ˜¯&quot;å°æ ¸å¿ƒï¼Œé«˜æ€§èƒ½ï¼Œæ˜“äºæ‰©å±•&quot;ã€‚</p><h4 id="æµ-streams" tabindex="-1"><a class="header-anchor" href="#æµ-streams"><span>æµï¼ˆStreamsï¼‰</span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰ä¸€å¤§æ¡¶æ°´ï¼Œä½ éœ€è¦ä»ä¸€ä¸ªåœ°æ–¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€æ¬¡æ€§æ‰›è¿‡å»ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç”¨ç®¡å­æ…¢æ…¢å¼•æµã€‚åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œåè€…å°±ç±»ä¼¼äºæµçš„å·¥ä½œæ–¹å¼ã€‚æµå…è®¸ä½ åˆ†å—è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œæé«˜æ•ˆç‡å’Œæ€§èƒ½ã€‚</p><h4 id="http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#http-è¯·æ±‚"><span>HTTP è¯·æ±‚</span></a></h4><p>HTTP è¯·æ±‚æ˜¯å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚æµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚å½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªç½‘å€æ—¶ï¼Œæµè§ˆå™¨ä¼šå‘è¯¥ç½‘å€çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿”å›è¯¥ç½‘é¡µçš„å†…å®¹ã€‚</p><h3 id="event-finish-2" tabindex="-1"><a class="header-anchor" href="#event-finish-2"><span>Event: &#39;finish&#39;</span></a></h3><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>&#39;finish&#39;</code> äº‹ä»¶æ˜¯æŒ‡å½“å“åº”ï¼ˆResponseï¼‰å¯¹è±¡å®Œæˆå‘é€æ•°æ®å¹¶ä¸”åˆ·æ–°åˆ°åº•å±‚ç³»ç»Ÿä¹‹åè§¦å‘çš„äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶è¡¨æ˜æ‰€æœ‰çš„å“åº”å¤´å’Œå“åº”ä½“éƒ½å·²ç»å®Œå…¨å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-15"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><h5 id="ä¾‹å­-1-ç®€å•çš„-web-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç®€å•çš„-web-æœåŠ¡å™¨"><span>ä¾‹å­ 1ï¼šç®€å•çš„ Web æœåŠ¡å™¨</span></a></h5><p>å‡è®¾ä½ æƒ³æ„å»ºä¸€ä¸ªç®€å•çš„ web æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶ï¼Œè¿”å›â€œHello Worldâ€ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A new connection is established</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨<code>&#39;finish&#39;</code>äº‹ä»¶ï¼Œä½†æ¯æ¬¡è°ƒç”¨<code>res.end()</code>åï¼Œä¸€æ—¦å“åº”å®Œæˆï¼Œå†…éƒ¨ä¼šè§¦å‘<code>&#39;finish&#39;</code>äº‹ä»¶ã€‚</p><h5 id="ä¾‹å­-2-ç›‘å¬-finish-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç›‘å¬-finish-äº‹ä»¶"><span>ä¾‹å­ 2ï¼šç›‘å¬&#39;finish&#39;äº‹ä»¶</span></a></h5><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ˜¾å¼ç›‘å¬<code>&#39;finish&#39;</code>äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">All data has been sent to the client</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚æ¯å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å‘å®¢æˆ·ç«¯å‘é€â€œHello Worldâ€ï¼Œç„¶åå…³é—­å“åº”ã€‚é€šè¿‡<code>res.on(&#39;finish&#39;)</code>ï¼Œæˆ‘ä»¬æ˜¾å¼ç›‘å¬äº†<code>&#39;finish&#39;</code>äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨å“åº”æ•°æ®å®Œå…¨å‘é€åˆ°å®¢æˆ·ç«¯åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚åœ¨æ§åˆ¶å°ä¸­æ‰“å°æ¶ˆæ¯ã€‚</p><h3 id="æ€»ç»“-11" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-11"><span>æ€»ç»“</span></a></h3><p><code>&#39;finish&#39;</code>äº‹ä»¶åœ¨ Node.js ä¸­è¡¨ç¤ºä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç† HTTP è¯·æ±‚å’Œå“åº”æ—¶ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥ç²¾ç¡®åœ°çŸ¥é“ä½•æ—¶ä¸€ä¸ªè¯·æ±‚è¢«å®Œå…¨å¤„ç†å®Œæ¯•ï¼Œè¿™å¯¹äºèµ„æºç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–ä»¥åŠæä¾›æ›´åŠ å¤æ‚çš„åŠŸèƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚å¸Œæœ›ä»¥ä¸Šçš„è§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£<code>&#39;finish&#39;</code>äº‹ä»¶å¦‚ä½•åœ¨ Node.js ä¸­å·¥ä½œã€‚</p><h3 id="response-addtrailers-headers" tabindex="-1"><a class="header-anchor" href="#response-addtrailers-headers"><span><a href="https://nodejs.org/docs/latest/api/http.html#responseaddtrailersheaders" target="_blank" rel="noopener noreferrer">response.addTrailers(headers)</a></span></a></h3><p>ç†è§£ <code>response.addTrailers(headers)</code> çš„æ¦‚å¿µï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯ HTTP Trailer å’Œå®ƒçš„ç”¨é€”ã€‚åœ¨ Node.js ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯é€šè¿‡ http æ¨¡å—æä¾›çš„ï¼Œå®ƒå…è®¸ä½ åœ¨å‘é€ HTTP å“åº”çš„å°¾éƒ¨æ·»åŠ é¢å¤–çš„å¤´ä¿¡æ¯ï¼ˆHeadersï¼‰ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-http-trailer" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-http-trailer"><span>ä»€ä¹ˆæ˜¯ HTTP Trailerï¼Ÿ</span></a></h3><p>HTTP Trailer ç±»ä¼¼äº HTTP Headerï¼Œä½†å®ƒä»¬å‡ºç°åœ¨ä¸€ä¸ª HTTP æ¶ˆæ¯çš„æœ«å°¾ã€‚æ ¹æ® HTTP/1.1 è§„èŒƒï¼ŒTrailer å¯ä»¥åŒ…å«ä¸€äº›åœ¨æ¶ˆæ¯ä¸»ä½“å¼€å§‹å‘é€æ—¶è¿˜æœªçŸ¥çš„å…ƒæ•°æ®ã€‚è¿™åœ¨ä¼ è¾“ç¼–ç ä¸ºâ€œchunkedâ€çš„å“åº”æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-1"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å‘é€ä¸€ä¸ªå¤§æ–‡ä»¶æˆ–è€…æ•°æ®æµç»™å®¢æˆ·ç«¯ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ æƒ³åœ¨æ‰€æœ‰æ•°æ®ä¼ è¾“å®Œæ¯•åï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å…³äºè¿™æ¬¡ä¼ è¾“çš„ä¸€äº›æ‘˜è¦ä¿¡æ¯æˆ–éªŒè¯ä¿¡æ¯ï¼Œæ¯”å¦‚æ•°æ®çš„å“ˆå¸Œå€¼ã€‚ç”±äºæ•°æ®åœ¨å¼€å§‹ä¼ è¾“æ—¶å¹¶æœªå…¨éƒ¨å‡†å¤‡å¥½ï¼Œå› æ­¤æ— æ³•åœ¨å“åº”å¤´ä¸­ç›´æ¥æä¾›è¿™ç±»ä¿¡æ¯ã€‚è¿™æ—¶å€™ï¼ŒTrailer å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-response-addtrailers-headers" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-response-addtrailers-headers"><span>å¦‚ä½•ä½¿ç”¨ <code>response.addTrailers(headers)</code></span></a></h3><p>åœ¨ Node.js çš„ http æ¨¡å—ä¸­ï¼Œ<code>addTrailers</code> æ–¹æ³•ç”¨äºåœ¨å“åº”ç»“æŸä¹‹å‰æ·»åŠ  Trailer å¤´éƒ¨ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨å®ƒçš„æ­¥éª¤ï¼š</p><ol><li><strong>åˆ›å»ºæœåŠ¡å™¨</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ä½¿ç”¨ <code>http.createServer()</code> åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚</li><li><strong>å‘é€åˆ†å—çš„å“åº”</strong>ï¼šç¡®ä¿å“åº”å¤´ä¸­åŒ…å« <code>Transfer-Encoding: chunked</code>ã€‚è¿™æ ‡æ˜å“åº”å°†ä»¥ä¸€ç³»åˆ—å—çš„å½¢å¼å‘é€ã€‚</li><li><strong>ä½¿ç”¨ <code>response.addTrailers(headers)</code></strong>ï¼šåœ¨æ‰€æœ‰çš„æ•°æ®å—éƒ½å‘é€å®Œæˆåï¼Œä½ å¯ä»¥è°ƒç”¨ <code>addTrailers</code> æ–¹æ³•æ¥æ·»åŠ  Trailer ä¿¡æ¯ã€‚</li></ol><h3 id="ç¤ºä¾‹ä»£ç -3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -3"><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ Trailerï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ ‡æ˜å“åº”å°†ä»¥åˆ†å—çš„æ–¹å¼å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Transfer-Encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">chunked</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“çš„ç¬¬ä¸€éƒ¨åˆ†</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚ä»æ•°æ®åº“è·å–æ•°æ®</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å‘é€å“åº”ä½“çš„ç¬¬äºŒéƒ¨åˆ†</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ‰€æœ‰æ•°æ®éƒ½å·²ç»å‘é€ï¼Œç°åœ¨æ·»åŠ  Trailer å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">7895bf4b8828b55ceaf47747b4bca667</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ¨¡ä»¿äº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä»æ•°æ®åº“è·å–æ•°æ®ç„¶åå‘é€ç»™å®¢æˆ·ç«¯ã€‚åœ¨æ‰€æœ‰æ•°æ®å—å‘é€å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>res.addTrailers</code> æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ª <code>Content-MD5</code> Trailerï¼Œå®ƒæä¾›äº†æ•´ä¸ªå“åº”æ•°æ®çš„ MD5 å“ˆå¸Œå€¼ã€‚è¿™æ ·å®¢æˆ·ç«¯å°±èƒ½å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒäº†ã€‚</p><h3 id="ç»“è¯­" tabindex="-1"><a class="header-anchor" href="#ç»“è¯­"><span>ç»“è¯­</span></a></h3><p><code>response.addTrailers(headers)</code> åœ¨ Node.js ä¸­æä¾›äº†ä¸€ç§çµæ´»çš„æœºåˆ¶æ¥åœ¨å“åº”çš„æœ€åæ·»åŠ é¢å¤–çš„å…ƒæ•°æ®ã€‚è¿™å¯¹äºé‚£äº›éœ€è¦åœ¨å‘é€å¤§é‡æ•°æ®æˆ–åœ¨å“åº”ç»“æŸå‰æ‰çŸ¥é“æŸäº›ä¿¡æ¯çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚</p><h3 id="response-connection" tabindex="-1"><a class="header-anchor" href="#response-connection"><span><a href="https://nodejs.org/docs/latest/api/http.html#responseconnection" target="_blank" rel="noopener noreferrer">response.connection</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåœ¨æœåŠ¡ç«¯è¿è¡Œ JavaScript çš„ç¯å¢ƒï¼Œéå¸¸é€‚åˆæ„å»ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ã€‚Node.js ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ I/O æ¨¡å‹ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚</p><h3 id="ç†è§£-response-connection" tabindex="-1"><a class="header-anchor" href="#ç†è§£-response-connection"><span>ç†è§£ <code>response.connection</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“æˆ‘ä»¬è°ˆè®º HTTP æœåŠ¡å™¨æ—¶ï¼Œ<code>response</code> å¯¹è±¡æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚æ¯å½“æœ‰å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨æˆ–å…¶ä»–ç±»å‹çš„å®¢æˆ·ç«¯ï¼‰å‘èµ·è¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå¯¹æ¯ä¸ªè¯·æ±‚ç”Ÿæˆä¸€ä¸ª <code>response</code>ï¼ˆå“åº”ï¼‰å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†å¾ˆå¤šæ–¹æ³•å’Œå±æ€§ï¼Œç”¨äºæ„å»ºå’Œå‘é€å›å®¢æˆ·ç«¯çš„å“åº”æ•°æ®ã€‚</p><p><code>response.connection</code> å±æ€§æ˜¯ <code>response</code> å¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­æåŠçš„ <code>response.connection</code> å±æ€§ï¼Œå®é™…ä¸Šå¼•ç”¨çš„æ˜¯åº•å±‚ç½‘ç»œè¿æ¥ã€‚</p><p>ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œä½¿ç”¨ <code>response.connection</code> å·²ç»ä¸å†æ¨èäº†ã€‚ç°åœ¨æ›´æ¨èä½¿ç”¨ <code>response.socket</code> å±æ€§æ¥è®¿é—®åŒæ ·çš„åº•å±‚è¿æ¥ä¿¡æ¯ã€‚åŸå› åœ¨äº <code>connection</code> å±æ€§åªæ˜¯ <code>socket</code> å±æ€§çš„åˆ«åï¼Œä¸ºäº†ä»£ç çš„å¯è¯»æ€§å’Œä¸€è‡´æ€§ï¼Œå®˜æ–¹å»ºè®®ç›´æ¥ä½¿ç”¨ <code>socket</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å°½ç®¡ <code>response.connection</code> ä¸å†æ¨èä½¿ç”¨ï¼Œä½†ç†è§£å®ƒåœ¨å®é™…ä¸­çš„ä½œç”¨è¿˜æ˜¯æœ‰ä»·å€¼çš„ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­è¯´æ˜åœ¨æ—©æœŸç‰ˆæœ¬ä¸­å¯èƒ½å¦‚ä½•ä½¿ç”¨ <code>response.connection</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¿é—®åº•å±‚ TCP è¿æ¥ä¿¡æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> remoteAddress</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> remotePort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">connection</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Client connected from: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”å†…å®¹å¹¶ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé€šè¿‡ <code>res.connection</code>ï¼ˆè™½ç„¶ä¸æ¨èï¼Œä»…ç¤ºæ„ï¼‰è·å–åˆ°äº†å®¢æˆ·ç«¯çš„è¿œç¨‹åœ°å€å’Œç«¯å£å·ã€‚è¿™å¯ä»¥ç”¨äºæ—¥å¿—è®°å½•ã€å®šåˆ¶åŒ–å“åº”ç­‰åœºæ™¯ã€‚</p><h3 id="æ€»ç»“-12" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-12"><span>æ€»ç»“</span></a></h3><p>å°½ç®¡ <code>response.connection</code> æä¾›äº†è®¿é—®åº•å±‚ç½‘ç»œè¿æ¥çš„èƒ½åŠ›ï¼Œä½†ä¸ºäº†éµå¾ªæœ€ä½³å®è·µå’Œç¡®ä¿ä»£ç çš„æœªæ¥å…¼å®¹æ€§ï¼Œæ¨èä½¿ç”¨ <code>response.socket</code> è·å¾—ç›¸åŒçš„åŠŸèƒ½ã€‚è¿™åæ˜ äº†åœ¨å¼€å‘å®è·µä¸­ï¼ŒæŠ€æœ¯å’Œæ ‡å‡†æ˜¯ä¸æ–­è¿›åŒ–çš„ï¼Œæˆ‘ä»¬éœ€è¦éšä¹‹æ›´æ–°æˆ‘ä»¬çš„çŸ¥è¯†å’Œä»£ç å®è·µã€‚</p><h3 id="response-cork" tabindex="-1"><a class="header-anchor" href="#response-cork"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsecork" target="_blank" rel="noopener noreferrer">response.cork()</a></span></a></h3><p><code>response.cork()</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå±äº <code>http.ServerResponse</code> ç±»ã€‚è¿™ä¸ªç±»æ˜¯ç”¨æ¥å¤„ç† HTTP æœåŠ¡å™¨å“åº”çš„ï¼Œæ¯”å¦‚ä½ åœ¨ Node.js é‡Œæ­å»ºä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šå‘é€å“åº”ç»™å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨æˆ–å…¶å®ƒå®¢æˆ·ç«¯ï¼‰ã€‚</p><p>äº†è§£ <code>response.cork()</code> è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œå…ˆè¦ç†è§£ Node.js çš„æµï¼ˆstreamï¼‰å’Œç¼“å†²ï¼ˆbufferingï¼‰ã€‚åœ¨ Node.js ä¸­ï¼Œæ•°æ®é€šå¸¸ä»¥æµçš„å½¢å¼è¢«å¤„ç†å’Œä¼ è¾“ã€‚æµå¯ä»¥è®©ä½ å¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œæ•°æ®ä¼ è¾“ç­‰ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸´æ—¶åœæ­¢æ•°æ®çš„å‘é€ï¼Œå°†ä¸€äº›å°å—çš„æ•°æ®ç»„åˆæˆæ›´å¤§çš„å—ï¼Œç„¶åå†ä¸€æ¬¡æ€§å‘é€å‡ºå»ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯ä¼˜åŒ–äº† I/O æ€§èƒ½ã€‚</p><p>è¿™å°±æ˜¯ <code>response.cork()</code> æ–¹æ³•çš„ä½œç”¨ã€‚å½“ä½ è°ƒç”¨ <code>response.cork()</code> æ—¶ï¼ŒNode.js ä¼šæš‚æ—¶é˜»æ­¢æ•°æ®è¢«å‘é€ï¼Œå³ä½¿ä½ æ‰§è¡Œäº†å†™æ“ä½œã€‚ç›´åˆ°ä½ è°ƒç”¨ <code>response.uncork()</code> æ–¹æ³•ï¼Œæˆ–è€…å½“ &#39;drain&#39; äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè¢« &quot;corked&quot; çš„æ•°æ®æ‰ä¼šä¸€èµ·è¢«å‘é€ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js çš„ HTTP æœåŠ¡å™¨ï¼Œä½ æƒ³å‘å®¢æˆ·ç«¯å‘é€å¤šä¸ªå°ä¿¡æ¯ç‰‡æ®µï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œä½ å¸Œæœ›å°†è¿™äº›å°ç‰‡æ®µç»„åˆåå†å‘é€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨å‘é€å¤§é‡æ•°æ®ä¹‹å‰ï¼Œæš‚æ—¶é˜»å¡æ•°æ®çš„å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬æœ‰å¤šä¸ªæ•°æ®å—è¦å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ›´å¤šçš„æ•°æ®å†™å…¥...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®šæ—¶å™¨æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œå¯èƒ½åœ¨çœŸå®åœºæ™¯ä¸­æ˜¯æ•°æ®åº“æŸ¥è¯¢æˆ–å¤–éƒ¨æœåŠ¡è¯·æ±‚</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">from Node.js!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œuncork æ–¹æ³•è¢«è°ƒç”¨ï¼Œæ‰€æœ‰ä¹‹å‰ corked çš„æ•°æ®ç°åœ¨è¢«å‘é€å‡ºå»ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">uncork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¦‚æœæœ‰æ›´å¤šçš„å¼‚æ­¥æ“ä½œï¼Œä½ å¯ä»¥åœ¨æ¯æ¬¡å¼‚æ­¥æ“ä½œç»“æŸæ—¶å†æ¬¡è°ƒç”¨ res.cork() å’Œ res.uncork()ã€‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä½¿ç”¨ <code>res.cork()</code> é˜»å¡æ•°æ®ï¼Œç„¶åå†™å…¥å¤šä¸ªæ•°æ®å—ï¼Œä¹‹åé€šè¿‡ä¸€ä¸ªå®šæ—¶å™¨æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œå¼‚æ­¥æ“ä½œå®Œæˆåå†ä½¿ç”¨ <code>res.uncork()</code> å‘é€æ‰€æœ‰ç§¯ç´¯çš„æ•°æ®å—ã€‚</p><p>ä½¿ç”¨ <code>res.cork()</code> å’Œ <code>res.uncork()</code> å¯ä»¥å¸®åŠ©æå‡ç½‘ç»œååé‡ï¼Œå°¤å…¶æ˜¯åœ¨å‘é€å¤§é‡å°æ•°æ®åŒ…çš„æƒ…å†µä¸‹éå¸¸æœ‰æ•ˆã€‚è¿™æ˜¯å› ä¸ºå®ƒå‡å°‘äº†å•ç‹¬å‘é€æ¯ä¸ªå°æ•°æ®åŒ…æ‰€éœ€çš„ç½‘ç»œå¾€è¿”æ¬¡æ•°å’Œæ“ä½œç³»ç»Ÿåº•å±‚çš„ TCP/IP æ•°æ®åŒ…çš„æ•°é‡ã€‚</p><h3 id="response-end-data-encoding-callback" tabindex="-1"><a class="header-anchor" href="#response-end-data-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#responseenddata-encoding-callback" target="_blank" rel="noopener noreferrer">response.end([data[, encoding]][, callback])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œéå¸¸é€‚åˆåˆ›å»ºç½‘ç«™åç«¯æœåŠ¡æˆ–è€… APIã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http</code>æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ï¼Œè€Œ<code>response.end()</code>æ–¹æ³•æ˜¯è¿™ä¸ªæ¨¡å—ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚</p><h3 id="è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š"><span>è§£é‡Š</span></a></h3><p><code>response.end([data[, encoding]][, callback])</code> æ˜¯ <code>http</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºç»“æŸå“åº”è¿‡ç¨‹ã€‚å½“ä½ ä½¿ç”¨ Node.js å»ºç«‹ä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œæ¯æ¬¡æ¥æ”¶åˆ°è¯·æ±‚ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªå“åº”ï¼ˆresponseï¼‰å¯¹è±¡ä¼ å…¥å›è°ƒå‡½æ•°ã€‚ä½¿ç”¨æ­¤æ–¹æ³•å¯ä»¥å‘Šè¯‰æœåŠ¡å™¨ï¼Œä½ å·²ç»å®Œæˆäº†å¯¹è¯¥è¯·æ±‚çš„å¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥å°†å¤„ç†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯äº†ã€‚</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>data</code> ï¼ˆå¯é€‰ï¼‰ï¼šå¯ä»¥æŒ‡å®šå‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä¸å‘é€ä»»ä½•æ•°æ®ã€‚</li><li><code>encoding</code> ï¼ˆå¯é€‰ï¼‰ï¼šå½“ä½ å‘é€æ•°æ®ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šå­—ç¬¦ç¼–ç ï¼ˆå¦‚ &#39;utf8&#39;ï¼‰ã€‚</li><li><code>callback</code> ï¼ˆå¯é€‰ï¼‰ï¼šå½“å“åº”æµç»“æŸæ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-13"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-ç®€å•æ–‡æœ¬å“åº”" tabindex="-1"><a class="header-anchor" href="#_1-ç®€å•æ–‡æœ¬å“åº”"><span>1. ç®€å•æ–‡æœ¬å“åº”</span></a></h4><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶ï¼Œè¿”å›&quot;Hello, world!&quot;æ¶ˆæ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç»“æŸå“åº”ï¼Œå‘é€&quot;Hello, world!&quot;ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-åœ¨ç»“æŸå‰å†™å…¥å“åº”ä½“" tabindex="-1"><a class="header-anchor" href="#_2-åœ¨ç»“æŸå‰å†™å…¥å“åº”ä½“"><span>2. åœ¨ç»“æŸå‰å†™å…¥å“åº”ä½“</span></a></h4><p>å¦‚æœä½ æƒ³åœ¨å‘é€å“åº”ä¹‹å‰ï¼Œå…ˆå‘å“åº”ä½“ä¸­å†™å…¥ä¸€äº›æ•°æ®ï¼Œç„¶åå†ç»“æŸå“åº”ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å“åº”ä½“å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // ç»“æŸå“åº”ï¼Œå¹¶æ·»åŠ æœ€åä¸€éƒ¨åˆ†æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-ä½¿ç”¨å›è°ƒ" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨å›è°ƒ"><span>3. ä½¿ç”¨å›è°ƒ</span></a></h4><p>ä½ ä¹Ÿå¯ä»¥åœ¨<code>res.end()</code>ä¸­æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨å“åº”çœŸæ­£ç»“æŸåæ‰§è¡Œä¸€äº›æ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Goodbye, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å½“å“åº”ç»“æŸæ—¶æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”å·²ç»å‘ç»™å®¢æˆ·ç«¯ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œå¸Œæœ›ä½ èƒ½ç†è§£<code>response.end()</code>åœ¨ Node.js ä¸­çš„ä½œç”¨å’Œå¦‚ä½•ä½¿ç”¨å®ƒã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±æ˜¯ç”¨æ¥ç»“æŸå“åº”å¹¶å¯é€‰åœ°å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</p><h3 id="response-finished" tabindex="-1"><a class="header-anchor" href="#response-finished"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsefinished" target="_blank" rel="noopener noreferrer">response.finished</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>response.finished</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº HTTP å“åº”å¯¹è±¡ (<code>http.ServerResponse</code>)ã€‚è¿™ä¸ªå±æ€§ç”¨æ¥æŒ‡ç¤ºå“åº”æ˜¯å¦å·²ç»å®Œæˆã€‚å½“ä½ åœ¨æœåŠ¡å™¨ç«¯å‘é€å“åº”ç»™å®¢æˆ·ç«¯æ—¶ï¼Œå“åº”ä½“ï¼ˆbodyï¼‰å¯èƒ½ä¼šåˆ†å¤šæ¬¡å‘é€ï¼Œä¸€æ—¦å…¨éƒ¨å‘é€å®Œæ¯•ï¼Œå¹¶ä¸”åº•å±‚çš„è¿æ¥å·²ç»å…³é—­ï¼Œé‚£ä¹ˆ <code>response.finished</code> å°±ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>response.finished</code> å‘Šè¯‰ä½ çš„æ˜¯ï¼šæœåŠ¡å™¨æ˜¯å¦å·²ç»å®Œæˆäº†å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†ï¼Œå¹¶ä¸”æŠŠæœ€åçš„æ•°æ®éƒ½å‘é€å‡ºå»äº†ã€‚</p><p>ä¸‹é¢é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è§£é‡Š <code>response.finished</code> çš„ä½œç”¨ï¼š</p><h3 id="ä¾‹å­-1-æ£€æŸ¥å“åº”æ˜¯å¦å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ£€æŸ¥å“åº”æ˜¯å¦å®Œæˆ"><span>ä¾‹å­ 1ï¼šæ£€æŸ¥å“åº”æ˜¯å¦å®Œæˆ</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥å“åº”æ˜¯å¦å®Œæˆ</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">finished</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å° true æˆ– false</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª &quot;Hello World&quot; çš„æ¶ˆæ¯ã€‚è°ƒç”¨ <code>res.end()</code> åï¼ŒNode.js å°†æ¶ˆæ¯å‘é€å‡ºå»ï¼Œå¹¶ä¸”ç«‹å³å°† <code>res.finished</code> è®¾ç½®ä¸º <code>true</code>ã€‚</p><h3 id="ä¾‹å­-2-å¼‚æ­¥æ“ä½œæœŸé—´æ£€æŸ¥å“åº”çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å¼‚æ­¥æ“ä½œæœŸé—´æ£€æŸ¥å“åº”çŠ¶æ€"><span>ä¾‹å­ 2ï¼šå¼‚æ­¥æ“ä½œæœŸé—´æ£€æŸ¥å“åº”çŠ¶æ€</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¼‚æ­¥å†™å…¥å“åº”ä½“</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 2000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œä¼šç«‹å³æ‰“å° falseï¼Œå› ä¸ºå“åº”å°šæœªå®Œæˆ</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">finished</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å»¶è¿Ÿæ£€æŸ¥å“åº”æ˜¯å¦å®Œæˆ</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">finished</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 2ç§’åä¼šæ‰“å° true</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 2100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>setTimeout</code> æ¥æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”å»¶è¿Ÿå‘é€å“åº”ä½“çš„æŸäº›éƒ¨åˆ†ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆå§‹çš„åŒæ­¥ä»£ç ä¸­ï¼Œ<code>res.finished</code> çš„å€¼ä¸º <code>false</code>ï¼Œå› ä¸ºå“åº”è¿˜æ²¡å®Œæˆã€‚ä½†æ˜¯ï¼Œåœ¨æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå°±æ˜¯ä¸¤ç§’åï¼Œ<code>res.finished</code> çš„å€¼å˜ä¸º <code>true</code>ã€‚</p><p>è¿™äº›ä¾‹å­è¯´æ˜ <code>response.finished</code> å±æ€§æ˜¯å¦‚ä½•åæ˜ å“åº”çŠ¶æ€çš„ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›ä¸€æ­¥æ“ä½œå“åº”å¯¹è±¡æˆ–è€…æ˜¯è¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œã€‚</p><h3 id="response-flushheaders" tabindex="-1"><a class="header-anchor" href="#response-flushheaders"><span><a href="https://nodejs.org/docs/latest/api/http.html#responseflushheaders" target="_blank" rel="noopener noreferrer">response.flushHeaders()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œäº†è§£å¦‚ä½•å¤„ç† HTTP å“åº”æ˜¯éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚è¿™å°±å¼•å‡ºäº†<code>response.flushHeaders()</code>æ–¹æ³•çš„ç”¨é€”ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯response-flushheaders" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯response-flushheaders"><span>ä»€ä¹ˆæ˜¯<code>response.flushHeaders()</code>?</span></a></h3><p><code>response.flushHeaders()</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨å‘é€ HTTP å“åº”å¤´ä¹‹å‰å°†å®ƒä»¬åˆ·æ–°åˆ°å®¢æˆ·ç«¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç«‹å³å°†å·²ç»è®¾ç½®å¥½çš„ HTTP å¤´ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªå“åº”ä½“ï¼ˆresponse bodyï¼‰éƒ½å‡†å¤‡å¥½åå†å‘é€ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨response-flushheaders" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨response-flushheaders"><span>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>response.flushHeaders()</code>?</span></a></h3><ol><li><p><strong>æå‰åé¦ˆ</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¸Œæœ›å®¢æˆ·ç«¯å°½å¿«çŸ¥é“è¯·æ±‚å·²è¢«æ¥æ”¶å¹¶å¼€å§‹å¤„ç†ï¼Œå³ä½¿æœ€ç»ˆæ•°æ®è¿˜æœªå‡†å¤‡å¥½å‘é€ã€‚è¿™å¯¹äºæå‡ç”¨æˆ·ä½“éªŒå¾ˆæœ‰å¸®åŠ©ã€‚</p></li><li><p><strong>é¿å…è¶…æ—¶</strong>ï¼šåœ¨å¤„ç†éœ€è¦é•¿æ—¶é—´çš„è¯·æ±‚æ—¶ï¼ˆä¾‹å¦‚å¤§é‡æ•°æ®å¤„ç†æˆ–å¤æ‚æŸ¥è¯¢ï¼‰ï¼ŒæœåŠ¡å™¨å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´æ‰èƒ½ç”Ÿæˆå®Œæ•´çš„å“åº”ä½“ã€‚é€šè¿‡æå‰å‘é€å“åº”å¤´ï¼Œå¯ä»¥é˜²æ­¢å®¢æˆ·ç«¯å› ä¸ºç­‰å¾…æ—¶é—´è¿‡é•¿è€Œè¶…æ—¶æ–­å¼€è¿æ¥ã€‚</p></li><li><p><strong>æµå¼å“åº”</strong>ï¼šå¦‚æœä½ æ‰“ç®—ä½¿ç”¨æµå¼ä¼ è¾“æ•°æ®ï¼ˆæ¯”å¦‚åˆ†å—ä¼ è¾“å¤§æ–‡ä»¶ï¼‰ï¼Œå…ˆå‘é€å“åº”å¤´å¯ä»¥å£°æ˜å³å°†å‘é€çš„å†…å®¹ç±»å‹å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚</p></li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-æå‰å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚å·²æ¥æ”¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æå‰å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚å·²æ¥æ”¶"><span>ç¤ºä¾‹ 1: æå‰å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚å·²æ¥æ”¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„ APIï¼Œç”±äºæ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼ŒæœåŠ¡å™¨å¤„ç†éœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚ä½ å¯ä»¥åœ¨å¼€å§‹å¤„ç†ä¸Šä¼ çš„å†…å®¹ä¹‹å‰ç«‹å³å‘é€å“åº”å¤´ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚å·²æˆåŠŸæ¥æ”¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // è¿™é‡Œå¤„ç†æ–‡ä»¶ä¸Šä¼ é€»è¾‘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // å…ˆå‘é€å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">202</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 202 Accepted çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚å·²è¢«æ¥å—è¿›è¡Œå¤„ç†ï¼Œä½†å¤„ç†å°šæœªå®Œæˆ</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">flushHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å°†å“åº”å¤´å‘é€ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // å‡è®¾è¿™é‡Œæ˜¯å¤„ç†æ–‡ä»¶çš„è€—æ—¶æ“ä½œ</span></span>
<span class="line"><span style="color:#88C0D0;">      setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">        // æ–‡ä»¶å¤„ç†å®Œæˆåå‘é€å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File uploaded successfully</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-é¿å…è¶…æ—¶-é€‚ç”¨äºéœ€è¦é•¿æ—¶é—´å¤„ç†çš„è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-é¿å…è¶…æ—¶-é€‚ç”¨äºéœ€è¦é•¿æ—¶é—´å¤„ç†çš„è¯·æ±‚"><span>ç¤ºä¾‹ 2: é¿å…è¶…æ—¶ï¼Œé€‚ç”¨äºéœ€è¦é•¿æ—¶é—´å¤„ç†çš„è¯·æ±‚</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªç”ŸæˆæŠ¥å‘Šçš„åœºæ™¯ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´æ¥ä»æ•°æ®åº“è·å–æ•°æ®ã€å¤„ç†æ•°æ®å¹¶ç”ŸæˆæŠ¥å‘Šï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/generate-report</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">flushHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç«‹å³å‘é€å“åº”å¤´ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯ä¿æŒè¿æ¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // æ¨¡æ‹Ÿè€—æ—¶çš„æŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹</span></span>
<span class="line"><span style="color:#88C0D0;">      setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Report generated successfully</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span><span style="color:#B48EAD;"> 60000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾æŠ¥å‘Šç”Ÿæˆéœ€è¦60ç§’</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>res.flushHeaders()</code>çš„ä½œç”¨æ˜¯ç¡®ä¿å®¢æˆ·ç«¯åœ¨æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„åŒæ—¶ï¼Œèƒ½å¤ŸåŠæ—¶æ”¶åˆ°ä¸€äº›åŸºæœ¬çš„åé¦ˆä¿¡æ¯ï¼Œä»è€Œæ”¹å–„ç”¨æˆ·ä½“éªŒæˆ–é¿å…å› é•¿æ—¶é—´ç­‰å¾…è€Œå¯¼è‡´çš„è¶…æ—¶é—®é¢˜ã€‚</p><h3 id="response-getheader-name" tabindex="-1"><a class="header-anchor" href="#response-getheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsegetheadername" target="_blank" rel="noopener noreferrer">response.getHeader(name)</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘å°†å°½é‡è¯¦ç»†å¹¶é€šä¿—åœ°è§£é‡Š Node.js ä¸­ <code>response.getHeader(name)</code> çš„æ¦‚å¿µå’Œç”¨æ³•ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-response-getheader-name" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-response-getheader-name"><span>ä»€ä¹ˆæ˜¯ <code>response.getHeader(name)</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>response.getHeader(name)</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–å½“å‰å“åº”å¯¹è±¡ï¼ˆresponseï¼‰ä¸­æŒ‡å®šåç§°ï¼ˆnameï¼‰çš„å¤´éƒ¨ï¼ˆheaderï¼‰çš„å€¼ã€‚å®ƒæ˜¯å¤„ç† HTTP å“åº”æ—¶å¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦è¯»å–å·²è®¾ç½®çš„å“åº”å¤´ä¿¡æ¯æ—¶ã€‚</p><p>å“åº”å¤´æ˜¯ HTTP å“åº”çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†å…³äºå“åº”çš„å…ƒæ•°æ®ï¼Œå¦‚å†…å®¹ç±»å‹ã€ç¼–ç ã€ç¼“å­˜æ§åˆ¶ç­‰ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-response-getheader-name" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-response-getheader-name"><span>å¦‚ä½•ä½¿ç”¨ <code>response.getHeader(name)</code>ï¼Ÿ</span></a></h3><p>è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªå“åº”å¯¹è±¡ã€‚è¿™é€šå¸¸åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶é€šè¿‡å›è°ƒå‡½æ•°è·å¾—ï¼š</p><ol><li>å¯¼å…¥ <code>http</code> æ¨¡å—ã€‚</li><li>ä½¿ç”¨ <code>http.createServer()</code> åˆ›å»ºæœåŠ¡å™¨ã€‚</li><li>åœ¨åˆ›å»ºæœåŠ¡å™¨æ—¶æä¾›çš„å›è°ƒå‡½æ•°é‡Œï¼Œä½ ä¼šæ¥æ”¶åˆ°è¯·æ±‚ï¼ˆrequestï¼‰å’Œå“åº”ï¼ˆresponseï¼‰å¯¹è±¡ã€‚</li><li>é€šè¿‡ <code>response.setHeader(name, value)</code> å…ˆè®¾ç½®ä¸€ä¸ªå“åº”å¤´ã€‚</li><li>ç„¶åå¯ä»¥ä½¿ç”¨ <code>response.getHeader(name)</code> æ¥è¯»å–è¯¥å“åº”å¤´çš„å€¼ã€‚</li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨ <code>response.getHeader(name)</code>ã€‚</p><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä¼šè¿”å›å¸¦æœ‰ç‰¹å®šå†…å®¹ç±»å‹çš„å“åº”ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³åœ¨æ—¥å¿—ä¸­è®°å½•è¿™ä¸ªå†…å®¹ç±»å‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å¯¼å…¥ http æ¨¡å—</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”å¤´ &#39;Content-Type&#39; ä¸º &#39;text/plain&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è·å–å¹¶æ‰“å° &#39;Content-Type&#39; å“åº”å¤´çš„å€¼</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> contentType</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content Type is:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> contentType</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“ &#39;Hello, world!&#39; å¹¶ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè®¾ç½®äº†å“åº”å¤´ <code>&#39;Content-Type&#39;</code> ä¸º <code>&#39;text/plain&#39;</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>response.getHeader(&#39;Content-Type&#39;)</code> æ¥è·å–è¿™ä¸ªå¤´éƒ¨çš„å€¼ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚æœ€åï¼Œæˆ‘ä»¬å‘é€äº†å“åº” <code>&#39;Hello, world!&#39;</code> ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿è¡Œè¿™ä¸ªæœåŠ¡å™¨å¹¶è®¿é—® <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000</a> æ—¶ï¼Œåœ¨æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸Šï¼Œä½ ä¼šçœ‹åˆ°æ‰“å°å‡ºäº† <code>&#39;Content Type is: text/plain&#39;</code>ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬æˆåŠŸåœ°è·å–äº† <code>&#39;Content-Type&#39;</code> å“åº”å¤´çš„å€¼ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºè°ƒè¯•å’ŒéªŒè¯è®¾ç½®çš„å“åº”å¤´æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è€…åœ¨å†³å®šä¸‹ä¸€æ­¥æ“ä½œä¹‹å‰éœ€è¦æ£€æŸ¥å“åº”å¤´çš„æƒ…å†µã€‚</p><h3 id="response-getheadernames" tabindex="-1"><a class="header-anchor" href="#response-getheadernames"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsegetheadernames" target="_blank" rel="noopener noreferrer">response.getHeaderNames()</a></span></a></h3><p>Node.js ä¸­çš„<code>response.getHeaderNames()</code>æ–¹æ³•æ˜¯ç”¨äºä» HTTP å“åº”ä¸­è·å–æ‰€æœ‰å·²è®¾ç½®çš„å¤´éƒ¨(header)å­—æ®µçš„åç§°ã€‚åœ¨ä½¿ç”¨ Node.js è¿›è¡Œç½‘ç»œå¼€å‘æ—¶ï¼Œä½ ä¼šä¸ HTTP è¯·æ±‚å’Œå“åº”æ‰“äº¤é“ã€‚æ¯ä¸ª HTTP å“åº”éƒ½å¯èƒ½åŒ…å«å¤šä¸ªå¤´éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å®¹ç±»å‹ã€çŠ¶æ€ç ã€ç¼“å­˜æ§åˆ¶ç­‰ï¼Œè¿™äº›ä¿¡æ¯å¯¹äºæ§åˆ¶å¦‚ä½•å¤„ç†å’Œè§£é‡Šè¯¥å“åº”è‡³å…³é‡è¦ã€‚</p><h3 id="ç†è§£-http-å¤´éƒ¨" tabindex="-1"><a class="header-anchor" href="#ç†è§£-http-å¤´éƒ¨"><span>ç†è§£ HTTP å¤´éƒ¨</span></a></h3><p>HTTP å¤´éƒ¨å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡ HTTP è¯·æ±‚å’Œå“åº”ä¼ é€’é¢å¤–çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œ<code>Content-Type</code>å¤´éƒ¨å‘Šè¯‰å®¢æˆ·ç«¯å“åº”ä½“çš„åª’ä½“ç±»å‹ï¼ˆå¦‚<code>text/html</code>è¡¨ç¤º HTML æ–‡æ¡£ï¼‰ï¼Œè€Œ<code>Content-Length</code>å¤´éƒ¨æŒ‡ç¤ºå“åº”æ­£æ–‡çš„å¤§å°ã€‚</p><h3 id="ä½¿ç”¨response-getheadernames" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨response-getheadernames"><span>ä½¿ç”¨<code>response.getHeaderNames()</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨å¹¶ä¸”éœ€è¦å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP å“åº”æ—¶ï¼Œä½ å¯èƒ½æƒ³æ£€æŸ¥æˆ–è€…æ“ä½œè¿™äº›å“åº”å¤´ã€‚<code>response.getHeaderNames()</code>æ–¹æ³•å°±æ˜¯ä¸ºäº†è¿™ä¸€ç›®çš„è€Œå­˜åœ¨çš„ã€‚å®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å·²ç»è®¾ç½®çš„å“åº”å¤´éƒ¨çš„åç§°ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰ã€‚</p><p>è¿™é‡Œæœ‰å‡ ä¸ªæ­¥éª¤å’Œä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨<code>response.getHeaderNames()</code>ï¼š</p><ol><li><strong>åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</strong> - é¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨ Node.js çš„<code>http</code>æ¨¡å—åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®ä¸€äº›å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Powered-By</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, Node.js!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>è·å–å’Œè¾“å‡ºæ‰€æœ‰å“åº”å¤´åç§°</strong> - æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨å‘é€å“åº”ä¹‹å‰ä½¿ç”¨<code>response.getHeaderNames()</code>è·å–æ‰€æœ‰å·²è®¾ç½®çš„å“åº”å¤´éƒ¨åç§°ï¼Œå¹¶å°†å®ƒä»¬è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®ä¸€äº›å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Powered-By</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è·å–å¹¶è¾“å‡ºæ‰€æœ‰å·²è®¾ç½®çš„å“åº”å¤´éƒ¨åç§°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> headerNames</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaderNames</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">headerNames</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼š[&#39;content-type&#39;, &#39;x-powered-by&#39;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, Node.js!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œå®ƒè®¾ç½®äº†ä¸¤ä¸ªå“åº”å¤´ï¼š<code>Content-Type</code>å’Œ<code>X-Powered-By</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>response.getHeaderNames()</code>è·å–äº†è¿™äº›å¤´éƒ¨çš„åç§°ï¼Œå¹¶å°†å®ƒä»¬è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°æ‰€æœ‰å·²è®¾ç½®çš„å“åº”å¤´éƒ¨åç§°ï¼Œè¿™å¯¹äºè°ƒè¯•å’Œç¡®ä¿æ­£ç¡®è®¾ç½®å¤´éƒ¨éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨åœºæ™¯"><span>å®é™…è¿ç”¨åœºæ™¯</span></a></h3><ul><li><strong>è°ƒè¯•å’Œæ—¥å¿—è®°å½•</strong>ï¼šå¼€å‘è€…å¯èƒ½æƒ³çŸ¥é“åœ¨å“åº”ä¸­è®¾ç½®äº†å“ªäº›å¤´éƒ¨ï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œè®°å½•æ—¥å¿—ã€‚</li><li><strong>å®‰å…¨å®¡è®¡</strong>ï¼šç¡®ä¿æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å®‰å…¨ç›¸å…³çš„å¤´éƒ¨ï¼‰è¢«æ­£ç¡®åœ°è®¾ç½®å’Œå‘é€ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å†—ä½™å¤´éƒ¨ï¼Œæˆ–æ˜¯ä¸ºäº†éµå®ˆæœ€ä½³å®è·µè€Œè®¾ç½®çš„ç‰¹å®šå¤´éƒ¨ï¼ˆæ¯”å¦‚ç¼“å­˜æ§åˆ¶ï¼‰ã€‚</li></ul><p>é€šè¿‡<code>response.getHeaderNames()</code>æ–¹æ³•ï¼ŒNode.js å¼€å‘è€…å¯ä»¥æ›´è½»æ¾åœ°ç®¡ç†å’Œæ“ä½œ HTTP å“åº”å¤´éƒ¨ï¼Œä½¿å¾—å¼€å‘è¿‡ç¨‹æ›´åŠ é«˜æ•ˆå’Œå¯æ§ã€‚</p><h3 id="response-getheaders" tabindex="-1"><a class="header-anchor" href="#response-getheaders"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsegetheaders" target="_blank" rel="noopener noreferrer">response.getHeaders()</a></span></a></h3><p>Node.js ä¸­çš„ <code>response.getHeaders()</code> æ–¹æ³•æ˜¯åœ¨å¤„ç† HTTP äº¤äº‘é€šä¿¡æ—¶éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªåŠŸèƒ½ã€‚åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰å‘è¿™ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚åï¼ŒæœåŠ¡å™¨éœ€è¦ç»™å®¢æˆ·ç«¯å›é€ä¸€ä¸ªå“åº”ï¼ˆresponseï¼‰ã€‚å“åº”ä¸ä»…åŒ…æ‹¬ä¸»ä½“æ•°æ®ï¼ˆbodyï¼‰ï¼Œä¹ŸåŒ…å«äº†ä¸€ç³»åˆ—çš„å¤´éƒ¨ä¿¡æ¯ï¼ˆheadersï¼‰ï¼Œè¿™äº›å¤´éƒ¨ä¿¡æ¯å¯¹äºå®¢æˆ·ç«¯ç†è§£å’Œå¤„ç†å“åº”è‡³å…³é‡è¦ã€‚</p><h3 id="ç†è§£-headers" tabindex="-1"><a class="header-anchor" href="#ç†è§£-headers"><span>ç†è§£ Headers</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä¸‹ä»€ä¹ˆæ˜¯ Headersã€‚HTTP å“åº”å¤´éƒ¨ï¼ˆHeadersï¼‰åŒ…å«äº†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„å“åº”çš„æè¿°å’Œæ§åˆ¶ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰ã€è®¾ç½® cookieï¼ˆSet-Cookieï¼‰ã€ç¼“å­˜æ§åˆ¶ï¼ˆCache-Controlï¼‰ç­‰ã€‚è¿™äº›ä¿¡æ¯å¸®åŠ©å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼Œæµè§ˆå™¨ï¼‰å¦‚ä½•å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</p><h3 id="ä½¿ç”¨-response-getheaders" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-response-getheaders"><span>ä½¿ç”¨ <code>response.getHeaders()</code></span></a></h3><p><code>response.getHeaders()</code> è¿™ä¸ªæ–¹æ³•å…è®¸ä½ åœ¨ Node.js ä»£ç ä¸­è·å–å½“å‰å“åº”å¯¹è±¡ä¸Šå·²ç»è®¾ç½®çš„æ‰€æœ‰å¤´éƒ¨ä¿¡æ¯ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰çš„å“åº”å¤´éƒ¨é”®å€¼å¯¹ã€‚</p><h3 id="å®é™…è¿ç”¨å®ä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨å®ä¾‹-1"><span>å®é™…è¿ç”¨å®ä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œéœ€è¦æ£€æŸ¥æˆ–è®°å½•ä»æœåŠ¡å™¨å‘é€å›å®¢æˆ·ç«¯çš„æŸäº›å¤´éƒ¨ä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®ä¸€äº›å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Powered-By</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“â€œHello Worldâ€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è·å–å¹¶æ‰“å°å“åº”å¤´</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> headers</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¾“å‡ºå¯èƒ½æ˜¯ï¼š{ &#39;content-type&#39;: &#39;text/html&#39;, &#39;x-powered-by&#39;: &#39;Node.js&#39; }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šå¯¹ä»»ä½•è¿›å…¥çš„è¯·æ±‚è¿”å› â€œHello Worldâ€ çš„å“åº”ï¼Œå¹¶è®¾ç½®äº†ä¸¤ä¸ªå“åº”å¤´ï¼šContent-Type å’Œ X-Powered-Byã€‚é€šè¿‡ <code>res.getHeaders()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·å–å¹¶æ‰“å°å‡ºè¿™äº›è®¾ç½®çš„å¤´éƒ¨ä¿¡æ¯ã€‚</p><h3 id="æ€»ç»“-13" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-13"><span>æ€»ç»“</span></a></h3><p><code>response.getHeaders()</code> æ–¹æ³•æä¾›äº†ä¸€ç§ç®€ä¾¿çš„æ–¹å¼æ¥æ£€æŸ¥å’Œç®¡ç†ä½ çš„ HTTP å“åº”å¤´éƒ¨ä¿¡æ¯ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œäº†è§£å®¢æˆ·ç«¯å°†æ¥æ”¶ä½•ç§å¤´éƒ¨ä¿¡æ¯éå¸¸å…³é”®ã€‚æ— è®ºæ˜¯è°ƒè¯•ã€æ—¥å¿—è®°å½•ï¼Œè¿˜æ˜¯ç¡®ä¿æ­£ç¡®çš„å¤´éƒ¨ä¿¡æ¯è¢«å‘é€ä»¥æ»¡è¶³å®‰å…¨æˆ–æ€§èƒ½éœ€æ±‚ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•éƒ½æ˜¯éå¸¸æœ‰ç›Šå¤„çš„ã€‚</p><h3 id="response-hasheader-name" tabindex="-1"><a class="header-anchor" href="#response-hasheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsehasheadername" target="_blank" rel="noopener noreferrer">response.hasHeader(name)</a></span></a></h3><p>å½“æˆ‘ä»¬è®¨è®º<code>response.hasHeader(name)</code>è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯åœ¨è°ˆè®º Node.js ä¸­çš„ HTTP æœåŠ¡å™¨åŠŸèƒ½ã€‚Node.js æ˜¯ä¸€ä¸ª JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒèƒ½è®©ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚å…¶ä¸­ HTTP æ¨¡å—æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œå…è®¸ Node.js èƒ½å¤Ÿä½œä¸ºä¸€ä¸ª web æœåŠ¡å™¨æ¥å— HTTP è¯·æ±‚å¹¶ä¸”å‘é€ HTTP å“åº”ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥ç†è§£<code>response.hasHeader(name)</code>è¿™ä¸ªæ–¹æ³•ï¼š</p><h3 id="response-hasheader-name-1" tabindex="-1"><a class="header-anchor" href="#response-hasheader-name-1"><span><code>response.hasHeader(name)</code></span></a></h3><ul><li>**ç›®çš„ï¼š**è¿™ä¸ªæ–¹æ³•ç”¨äºæ£€æŸ¥ HTTP å“åº”å¤´ä¸­æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„å¤´éƒ¨ï¼ˆheaderï¼‰ã€‚</li><li><strong>å‚æ•°ï¼š</strong><ul><li><code>name</code>ï¼šè¿™æ˜¯ä½ æƒ³è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨çš„å“åº”å¤´åç§°ï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œå³<code>Content-Type</code>å’Œ<code>content-type</code>è¢«è§†ä¸ºç›¸åŒã€‚</li></ul></li><li>**è¿”å›å€¼ï¼š**å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼Œå¦‚æœæŒ‡å®šçš„å“åº”å¤´å­˜åœ¨ï¼Œåˆ™è¿”å›<code>true</code>ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›<code>false</code>ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-16"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œå¹¶ä¸”éœ€è¦æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚ä¿®æ”¹æˆ–è®¾ç½® HTTP å“åº”å¤´ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å…ˆéœ€è¦åˆ¤æ–­ä¸€ä¸ªç‰¹å®šçš„å“åº”å¤´æ˜¯å¦å·²ç»è¢«è®¾ç½®ï¼Œä»¥é¿å…é‡å¤è®¾ç½®æˆ–è€…å†²çªã€‚è¿™æ—¶å€™ï¼Œ<code>response.hasHeader(name)</code>å°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚</p><h4 id="ç¤ºä¾‹-1-æ£€æŸ¥å†…å®¹ç±»å‹-content-type" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ£€æŸ¥å†…å®¹ç±»å‹-content-type"><span>ç¤ºä¾‹ 1ï¼šæ£€æŸ¥å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰</span></a></h4><p>å‡è®¾ä½ å¸Œæœ›ç¡®ä¿åªåœ¨å“åº”å¤´ä¸­è¿˜æ²¡æœ‰è®¾ç½®<code>Content-Type</code>æ—¶æ‰å»è®¾ç½®å®ƒï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">hasHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, World!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨é¦–å…ˆä¼šæ£€æŸ¥å“åº”ä¸­æ˜¯å¦å·²ç»åŒ…å«äº†<code>Content-Type</code>å¤´éƒ¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šé€šè¿‡<code>setHeader</code>æ–¹æ³•è®¾ç½®ä¸º<code>text/html</code>ã€‚ç„¶åï¼ŒæœåŠ¡å™¨å‘é€ä¸€ä¸ªç®€å•çš„ HTML å“åº”ç»™å®¢æˆ·ç«¯ã€‚</p><h4 id="ç¤ºä¾‹-2-æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®äº†ç¼“å­˜æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®äº†ç¼“å­˜æ§åˆ¶"><span>ç¤ºä¾‹ 2ï¼šæ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®äº†ç¼“å­˜æ§åˆ¶</span></a></h4><p>è€ƒè™‘åˆ°æ€§èƒ½ä¼˜åŒ–ï¼Œä½ å¯èƒ½å¸Œæœ›ä¸ºé™æ€èµ„æºè®¾ç½®ç¼“å­˜ç­–ç•¥ã€‚ä½†åœ¨è®¾ç½®ä¹‹å‰ï¼Œæ£€æŸ¥<code>Cache-Control</code>å¤´æ˜¯å¦å·²è®¾ç½®ä¹Ÿæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">hasHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cache-Control</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cache-Control</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">public, max-age=3600</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾æ¥ä¸‹æ¥æ˜¯å‘é€æ–‡ä»¶æˆ–å…¶ä»–å“åº”çš„ä»£ç </span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåªæœ‰åœ¨<code>Cache-Control</code>å¤´æœªè¢«è®¾ç½®çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ·»åŠ ä¸€ä¸ªæŒ‡å®šèµ„æºå¯ä»¥è¢«å…¬å…±ç¼“å­˜ï¼Œå¹¶ä¸”æœ€å¤§å¹´é¾„ä¸º 3600 ç§’çš„ç¼“å­˜æ§åˆ¶å¤´ã€‚</p><p>é€šè¿‡è¿™ä¸¤ä¸ªç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>response.hasHeader(name)</code>æ–¹æ³•å¦‚ä½•å¸®åŠ©æˆ‘ä»¬æ›´ç»†è‡´åœ°æ§åˆ¶ HTTP å“åº”çš„å¤´éƒ¨è®¾ç½®ï¼Œä»è€Œä½¿æˆ‘ä»¬çš„ Web åº”ç”¨æ›´åŠ å¥å£¯å’Œå¯é ã€‚å¸Œæœ›è¿™äº›è§£é‡Šå’Œç¤ºä¾‹å¯¹ä½ ç†è§£ Node.js çš„ HTTP åŠŸèƒ½æœ‰æ‰€å¸®åŠ©ï¼</p><h3 id="response-headerssent" tabindex="-1"><a class="header-anchor" href="#response-headerssent"><span><a href="https://nodejs.org/docs/latest/api/http.html#responseheaderssent" target="_blank" rel="noopener noreferrer">response.headersSent</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è€Œé€šä¿—åœ°è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ <code>response.headersSent</code> å±æ€§ã€‚</p><p>åœ¨ Web å¼€å‘ä¸­ï¼ŒæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰ä¹‹é—´çš„é€šä¿¡å¾ˆé‡è¦ã€‚æ¯å½“ä½ è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œä½ çš„æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰éƒ½ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨åˆ™ä¼šè¿”å›ä¸€ä¸ªå“åº”ã€‚è¿™ä¸ªå“åº”åŒ…æ‹¬äº†ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š<strong>å¤´éƒ¨</strong>ï¼ˆHeadersï¼‰å’Œ<strong>æ­£æ–‡</strong>ï¼ˆBodyï¼‰ã€‚å¤´éƒ¨åŒ…å«äº†å…³äºå“åº”çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚å“åº”å†…å®¹çš„ç±»å‹ã€è®¾ç½®çš„ cookiesã€çŠ¶æ€ç ç­‰ã€‚æ­£æ–‡åˆ™åŒ…å«äº†å®é™…çš„å“åº”å†…å®¹ï¼Œæ¯”å¦‚ HTML é¡µé¢ã€å›¾ç‰‡ã€æ•°æ®ç­‰ã€‚</p><p>Node.js ä½¿ç”¨ <code>http</code> æ¨¡å—æ¥å¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œ<code>response</code> å¯¹è±¡ä»£è¡¨äº†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„å“åº”ã€‚<code>response.headersSent</code> æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå®ƒç”¨æ¥æ£€æŸ¥å“åº”å¤´éƒ¨æ˜¯å¦å·²ç»è¢«å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><p>ä¸€æ—¦è°ƒç”¨äº†å¦‚ <code>response.writeHead()</code> æˆ– <code>response.write()</code> ä¹‹ç±»çš„æ–¹æ³•ï¼Œå¤´éƒ¨å°±è¢«è®¤ä¸ºæ˜¯å·²å‘é€çš„ï¼Œè¿™æ—¶ <code>response.headersSent</code> çš„å€¼å°±ä¼šæ˜¯ <code>true</code>ã€‚å¦‚æœå“åº”å¤´éƒ¨è¿˜æ²¡æœ‰è¢«å‘é€ï¼Œå…¶å€¼å°±ä¼šæ˜¯ <code>false</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-17"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h3><h4 id="æ£€æŸ¥å¤´éƒ¨æ˜¯å¦å·²å‘é€" tabindex="-1"><a class="header-anchor" href="#æ£€æŸ¥å¤´éƒ¨æ˜¯å¦å·²å‘é€"><span>æ£€æŸ¥å¤´éƒ¨æ˜¯å¦å·²å‘é€</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå¹¶ä¸”ä½ æƒ³ç¡®ä¿ä¸åœ¨å¤´éƒ¨å·²ç»å‘é€åå†å°è¯•ä¿®æ”¹å®ƒï¼ˆå› ä¸ºè¿™ä¼šå¯¼è‡´é”™è¯¯ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>response.headersSent</code> æ¥æ£€æŸ¥å¤´éƒ¨æ˜¯å¦å·²å‘é€ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersSent</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // æ£€æŸ¥æ˜¯å¦å¤´éƒ¨å·²ç»å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Headers already sent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é˜²æ­¢é‡å¤å‘é€å¤´éƒ¨" tabindex="-1"><a class="header-anchor" href="#é˜²æ­¢é‡å¤å‘é€å¤´éƒ¨"><span>é˜²æ­¢é‡å¤å‘é€å¤´éƒ¨</span></a></h4><p>æœ‰æ—¶å€™ï¼Œåœ¨ä¸€æ®µé€»è¾‘ä¸­å¯èƒ½ä¼šä¸å°å¿ƒå¤šæ¬¡å°è¯•å‘é€å“åº”å¤´éƒ¨ï¼Œè¿™ç§æƒ…å†µä¸‹ <code>response.headersSent</code> å¯ä»¥ç”¨æ¥é˜»æ­¢è¿™ç§é”™è¯¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersSent</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å¦‚æœå¤´éƒ¨æœªå‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`p&gt;Hello World!`&lt;`/p&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨å‘é€å¤´éƒ¨å‰å…ˆæ£€æŸ¥ <code>headersSent</code> çš„å€¼ï¼Œå¦‚æœå¤´éƒ¨è¿˜æ²¡å‘é€ï¼ˆ<code>false</code>ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰è°ƒç”¨ <code>writeHead</code> æ–¹æ³•å‘é€å¤´éƒ¨ã€‚è¿™é¿å…äº†åœ¨å“åº”è¿‡ç¨‹ä¸­é‡å¤å‘é€å¤´éƒ¨çš„å¯èƒ½æ€§ï¼Œä»è€Œé˜²æ­¢äº†æ½œåœ¨çš„é”™è¯¯ã€‚</p><p>ç†è§£ <code>response.headersSent</code> å¦‚ä½•å·¥ä½œï¼Œå¹¶åˆç†åˆ©ç”¨è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶ HTTP å“åº”çš„æµç¨‹ï¼Œä¿è¯å“åº”é€»è¾‘çš„æ­£ç¡®æ€§å’Œé«˜æ•ˆæ€§ã€‚</p><h3 id="response-removeheader-name" tabindex="-1"><a class="header-anchor" href="#response-removeheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#responseremoveheadername" target="_blank" rel="noopener noreferrer">response.removeHeader(name)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œè€Œå…¶ä¸­çš„ <code>response.removeHeader(name)</code> æ–¹æ³•æ˜¯ç”¨äºæ“ä½œ HTTP å“åº”å¤´çš„ä¸€ä¸ªåŠŸèƒ½ã€‚å½“ä½ ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨æ—¶ï¼Œä½ ä¼šå‘é€ç»™å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚æµè§ˆå™¨ï¼‰ä¸€äº›å“åº”ï¼Œè¿™äº›å“åº”ä¸­åŒ…æ‹¬äº†ç§°ä¸ºâ€œå“åº”å¤´â€çš„ä¿¡æ¯ã€‚å“åº”å¤´å¯ä»¥å‘Šè¯‰æµè§ˆå™¨å¦‚ä½•å¤„ç†æ¥æ”¶åˆ°çš„å†…å®¹æˆ–è€…æä¾›ä¸€äº›å…¶ä»–çš„å…ƒä¿¡æ¯ã€‚</p><h3 id="ç†è§£-response-removeheader-name" tabindex="-1"><a class="header-anchor" href="#ç†è§£-response-removeheader-name"><span>ç†è§£ <code>response.removeHeader(name)</code></span></a></h3><p><code>response.removeHeader(name)</code> æ˜¯ HTTP æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸ä½ ä»å³å°†å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ä¸­åˆ é™¤ä¹‹å‰è®¾ç½®çš„æŸä¸ªç‰¹å®šçš„å“åº”å¤´ã€‚è¿™é‡Œçš„ <code>name</code> å°±æ˜¯ä½ æƒ³è¦åˆ é™¤çš„å“åº”å¤´çš„åç§°ã€‚</p><p>å®é™…è¿ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šç¢°åˆ°ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä½ å…ˆå‰è®¾ç½®äº†ä¸€ä¸ªå“åº”å¤´ï¼Œä½†éšååŸºäºæŸä¸ªé€»è¾‘åˆ¤æ–­ï¼Œä½ ä¸å†å¸Œæœ›è¿™ä¸ªå¤´è¢«å‘é€ã€‚</li><li>ä½ éœ€è¦è¦†ç›–ç”±æ¡†æ¶è‡ªåŠ¨æ·»åŠ çš„æŸä¸ªé»˜è®¤å“åº”å¤´ï¼Œé¦–å…ˆé€šè¿‡åˆ é™¤å®ƒï¼Œç„¶åæ·»åŠ ä¸€ä¸ªæ–°çš„ã€‚</li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>æˆ‘å°†é€šè¿‡ä¸¤ä¸ªç®€å•çš„ç¤ºä¾‹æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>response.removeHeader(name)</code>ã€‚</p><h4 id="ç¤ºä¾‹-1-åˆ é™¤ç®€å•çš„è‡ªå®šä¹‰å“åº”å¤´" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ é™¤ç®€å•çš„è‡ªå®šä¹‰å“åº”å¤´"><span>ç¤ºä¾‹ 1ï¼šåˆ é™¤ç®€å•çš„è‡ªå®šä¹‰å“åº”å¤´</span></a></h4><p>å‡è®¾ä½ åœ¨åˆ›å»ºä¸€ä¸ª Web æœåŠ¡ï¼Œè¯¥æœåŠ¡åœ¨æŸäº›æƒ…å†µä¸‹ä¸éœ€è¦å‘é€å…ˆå‰è®¾ç½®çš„è‡ªå®šä¹‰å“åº”å¤´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŸºäºæŸä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬å†³å®šä¸å‘é€è¿™ä¸ªå“åº”å¤´</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">true</span><span style="color:#616E88;"> /* å‡è®¾è¿™é‡Œæ˜¯ä½ çš„é€»è¾‘åˆ¤å®š */</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-åˆ é™¤å·²æœ‰çš„æ•æ„Ÿä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-åˆ é™¤å·²æœ‰çš„æ•æ„Ÿä¿¡æ¯"><span>ç¤ºä¾‹ 2ï¼šåˆ é™¤å·²æœ‰çš„æ•æ„Ÿä¿¡æ¯</span></a></h4><p>å‡è®¾ä½ åˆ›å»ºä¸€ä¸ª Web æœåŠ¡ï¼Œè€Œ Node.js æˆ–è€…ä½ ä½¿ç”¨çš„æ¡†æ¶è‡ªåŠ¨æ·»åŠ äº†ä¸€äº›å¯èƒ½æ³„éœ²æœåŠ¡å™¨ä¿¡æ¯ï¼ˆä¾‹å¦‚æœåŠ¡å™¨ç±»å‹ï¼‰çš„å“åº”å¤´ï¼Œä½ å‡ºäºå®‰å…¨è€ƒè™‘æƒ³è¦åˆ é™¤å®ƒä»¬ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æ¡†æ¶è‡ªåŠ¨æ·»åŠ äº† &quot;X-Powered-By: Node.js&quot; å¤´</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬å†³å®šåˆ é™¤è¿™ä¸ªå“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Powered-By</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Security first!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ­£ç¡®ç®¡ç†å“åº”å¤´å¯¹äºç¡®ä¿åº”ç”¨çš„æ€§èƒ½å’Œå®‰å…¨éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚é€šè¿‡ä½¿ç”¨ <code>response.removeHeader(name)</code>ï¼Œä½ å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶å“ªäº›ä¿¡æ¯åº”è¯¥è¢«å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><h3 id="response-req" tabindex="-1"><a class="header-anchor" href="#response-req"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsereq" target="_blank" rel="noopener noreferrer">response.req</a></span></a></h3><p><code>response.req</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒå‡ºç°åœ¨ Node.js çš„ HTTP æ¨¡å—é‡Œé¢ã€‚å½“ä½ ä½¿ç”¨ HTTP æ¨¡å—åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…å‘èµ·ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä½ ä¼šæ¥è§¦åˆ°è¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­å¤„ç† HTTP è¯·æ±‚å’Œå“åº”æ—¶ï¼Œä¸€ä¸ªè¯·æ±‚ï¼ˆreqï¼‰ä¼šäº§ç”Ÿä¸€ä¸ªå“åº”ï¼ˆresï¼‰ã€‚æ¯å½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šæ„é€ ä¸€ä¸ªè¯·æ±‚å¯¹è±¡å’Œä¸€ä¸ªç›¸åº”å¯¹è±¡ã€‚è¿™ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«åŒ…å«äº†è¯·æ±‚çš„è¯¦æƒ…å’Œå°†è¦è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”çš„è¯¦æƒ…ã€‚</p><p>è¿™é‡Œçš„<code>response.req</code>æŒ‡çš„æ˜¯åœ¨å“åº”å¯¹è±¡ï¼ˆresponse objectï¼‰ä¸­ï¼Œä½ å¯ä»¥è®¿é—®åˆ°æœ€åˆå‘èµ·è¿™ä¸ªå“åº”çš„è¯·æ±‚å¯¹è±¡ï¼ˆrequest objectï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œé€šè¿‡<code>response.req</code>ï¼Œä½ å¯ä»¥å›æº¯åˆ°è¿™ä¸ªå“åº”æ˜¯ç”±å“ªä¸ªè¯·æ±‚è§¦å‘çš„ã€‚</p><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-http-æœåŠ¡å™¨"><span>ä¾‹å­ 1ï¼šHTTP æœåŠ¡å™¨</span></a></h3><p>å‡è®¾ä½ åœ¨ Node.js ä¸­åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œå¹¶ä¸”æƒ³åœ¨å‘é€å“åº”ä¹‹å‰æ‰“å°å‡ºè¯·æ±‚çš„ä¸€äº›ä¿¡æ¯ã€‚ä»£ç å¯èƒ½åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received request for:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ response.req æ¥è·å–å’Œæ“ä½œè¯·æ±‚å¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This request was sent by:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">user-agent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>req.url</code>æ¥æŸ¥çœ‹è¯·æ±‚çš„ URLï¼Œå¹¶é€šè¿‡<code>response.req.headers[&#39;user-agent&#39;]</code>æ¥æŸ¥çœ‹å‘é€è¯·æ±‚çš„ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚æµè§ˆå™¨ç±»å‹ï¼‰ã€‚</p><h3 id="ä¾‹å­-2-è®°å½•è¯·æ±‚-å“åº”å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è®°å½•è¯·æ±‚-å“åº”å‘¨æœŸ"><span>ä¾‹å­ 2ï¼šè®°å½•è¯·æ±‚-å“åº”å‘¨æœŸ</span></a></h3><p>å¦‚æœä½ æœ‰ä¸€ä¸ªç¨å¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½æƒ³è¦åœ¨æ¯æ¬¡è¯·æ±‚å®Œæˆæ—¶è®°å½•ä¸‹æ•´ä¸ªè¯·æ±‚-å“åº”å‘¨æœŸçš„ä¿¡æ¯ã€‚ä½ å¯ä»¥åœ¨å‘é€å“åº”åï¼Œé€šè¿‡<code>response.req</code>æ¥åšè®°å½•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">Request to </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> finished with status code </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ... å¤„ç†è¯·æ±‚å¹¶è°ƒç”¨ res.end() ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>res.on(&#39;finish&#39;, ...)</code>ç›‘å¬å™¨åœ¨å“åº”ç»“æŸæ—¶è¢«è°ƒç”¨ï¼Œæ­¤æ—¶ä½ å¯ä»¥é€šè¿‡<code>res.req</code>è·å–åŸå§‹çš„è¯·æ±‚æ•°æ®ï¼Œä¾‹å¦‚è¯·æ±‚çš„ URL å’ŒçŠ¶æ€ç ç­‰ï¼Œç„¶åå°†å…¶è®°å½•ä¸‹æ¥ã€‚</p><p>æ³¨æ„ï¼Œ<code>response.req</code> çš„å…·ä½“å†…å®¹å–å†³äºä½ çš„åº”ç”¨ç¨‹åºæ˜¯ä½œä¸º HTTP æœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯ã€‚åœ¨å®¢æˆ·ç«¯åœºæ™¯ä¸‹ï¼Œ<code>response.req</code>å¯èƒ½ä¼šåŒ…å«å‘èµ· HTTP å®¢æˆ·ç«¯è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ã€‚</p><p>å¸Œæœ›ä»¥ä¸Šè§£é‡Šå’Œä¾‹å­èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£<code>response.req</code>åœ¨ Node.js ä¸­çš„åº”ç”¨å’Œé‡è¦æ€§ã€‚</p><h3 id="response-senddate" tabindex="-1"><a class="header-anchor" href="#response-senddate"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsesenddate" target="_blank" rel="noopener noreferrer">response.sendDate</a></span></a></h3><p>Node.js ä¸­çš„ <code>response.sendDate</code> æ˜¯ä¸€ä¸ªä¸ HTTP å“åº”ç›¸å…³çš„å±æ€§ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦è‡ªåŠ¨åœ¨å“åº”å¤´ï¼ˆheadersï¼‰ä¸­å‘é€ <code>Date</code> å­—æ®µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼æ˜¯è®¾ç½®ä¸º <code>true</code> çš„ï¼Œæ„å‘³ç€æ¯å½“ä½ å‘é€ä¸€ä¸ª HTTP å“åº”æ—¶ï¼ŒNode.js ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªå½“å‰æ—¥æœŸå’Œæ—¶é—´çš„ <code>Date</code> å¤´åˆ°è¯¥å“åº”ä¸­ã€‚</p><h3 id="ç†è§£-date-å“åº”å¤´" tabindex="-1"><a class="header-anchor" href="#ç†è§£-date-å“åº”å¤´"><span>ç†è§£ <code>Date</code> å“åº”å¤´</span></a></h3><p>åœ¨ HTTP åè®®ä¸­ï¼Œ<code>Date</code> å“åº”å¤´å­—æ®µè¡¨ç¤ºæ¶ˆæ¯è¢«å‘é€çš„æ—¶é—´ï¼Œé€šå¸¸æ˜¯æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ã€å¤„ç†å¹¶å‡†å¤‡è¿”å›å“åº”çš„æ—¶é—´ç‚¹ã€‚è¿™ä¸ªæ—¶é—´ä¿¡æ¯éµå¾ª RFC 7231 è§„å®šçš„æ ¼å¼ï¼Œä¾‹å¦‚ <code>Wed, 21 Oct 2015 07:28:00 GMT</code>ã€‚</p><p>è¿™ä¸ªæ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯å¯¹äºå®¢æˆ·ç«¯ï¼ˆå¦‚ web æµè§ˆå™¨æˆ–å…¶ä»–ç±»å‹çš„ HTTP å®¢æˆ·ç«¯ï¼‰æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åŸºäºè¿™äº›ä¿¡æ¯å¯¹èµ„æºè¿›è¡Œç¼“å­˜ç­‰æ“ä½œã€‚</p><h3 id="ä½¿ç”¨-response-senddate" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-response-senddate"><span>ä½¿ç”¨ <code>response.sendDate</code></span></a></h3><p>å½“ä½ åœ¨ Node.js åº”ç”¨ä¸­å¤„ç† HTTP å“åº”æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ <code>http</code> æ¨¡å—ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>response</code> å¯¹è±¡æ˜¯ <code>http.ServerResponse</code> çš„å®ä¾‹ã€‚<code>sendDate</code> å±æ€§å°±å±äºè¿™ä¸ªå¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // é»˜è®¤æƒ…å†µä¸‹ï¼ŒsendDate æ˜¯ trueï¼Œæ‰€ä»¥ä¸éœ€è¦æ˜¾å¼è®¾ç½®</span></span>
<span class="line"><span style="color:#616E88;">  // å¦‚æœå‡ºäºæŸç§åŸå› ä½ æƒ³å…³é—­å®ƒï¼Œå¯ä»¥è¿™æ ·åšï¼š</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">sendDate</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="å¼€å¯-senddate" tabindex="-1"><a class="header-anchor" href="#å¼€å¯-senddate"><span>å¼€å¯ <code>sendDate</code></span></a></h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å¤„ç† <code>sendDate</code> å±æ€§ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯å¼€å¯çš„ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªç®€å•çš„ Web æœåŠ¡ï¼Œè¿”å›ä¸€äº›æ•°æ®ç»™å®¢æˆ·ç«¯æ—¶ï¼Œè‡ªåŠ¨æ·»åŠ çš„ <code>Date</code> å“åº”å¤´å¯ä»¥å¸®åŠ©å®¢æˆ·ç«¯ç†è§£å“åº”è¢«ç”Ÿæˆçš„æ—¶é—´ã€‚</p><h4 id="å…³é—­-senddate" tabindex="-1"><a class="header-anchor" href="#å…³é—­-senddate"><span>å…³é—­ <code>sendDate</code></span></a></h4><p>å¯èƒ½å­˜åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œä½ ä¸å¸Œæœ›æš´éœ²æœåŠ¡å™¨æ—¶é—´ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€‰æ‹©å…³é—­ <code>sendDate</code>ï¼š</p><ul><li>å‡ºäºå®‰å…¨è€ƒè™‘ï¼šåœ¨æŸäº›æå…¶ç‰¹å®šçš„å®‰å…¨è¦æ±‚ä¸‹ï¼Œéšè—æœåŠ¡å™¨æ—¶é—´ä¿¡æ¯å¯ä»¥ç¨å¾®å¢åŠ æ”»å‡»è€…çš„éš¾åº¦ã€‚</li><li>æ€§èƒ½ä¼˜åŒ–ï¼šåœ¨æç«¯çš„æ€§èƒ½ä¼˜åŒ–åœºæ™¯ä¸‹ï¼Œå³ä½¿æ˜¯çœå»è®¾ç½®è¿™ä¸ªå¤´éƒ¨æ‰€éœ€çš„å¾®å°å¤„ç†æ—¶é—´ä¹Ÿå¯èƒ½æ˜¯æœ‰ç›Šçš„ã€‚</li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>response.sendDate</code> æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•ä½†å…·æœ‰ç‰¹å®šç”¨é€”çš„åŠŸèƒ½ã€‚å®ƒå…è®¸ä½ æ§åˆ¶æ˜¯å¦åœ¨ HTTP å“åº”å¤´ä¸­è‡ªåŠ¨åŒ…å«å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼Œè¿™åœ¨å¤§å¤šæ•°åº”ç”¨ä¸­éƒ½æ˜¯æ¨èå¼€å¯çš„ï¼Œé™¤éä½ æœ‰ç‰¹åˆ«çš„ç†ç”±éœ€è¦å…³é—­å®ƒã€‚</p><h3 id="response-setheader-name-value" tabindex="-1"><a class="header-anchor" href="#response-setheader-name-value"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsesetheadername-value" target="_blank" rel="noopener noreferrer">response.setHeader(name, value)</a></span></a></h3><p><code>response.setHeader(name, value)</code> æ˜¯ Node.js ä¸­ HTTP æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨åˆ›å»º HTTP å“åº”æ—¶è®¾ç½®å“åº”å¤´éƒ¨ä¿¡æ¯ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸å…³é”®ï¼Œå› ä¸ºå®ƒå…è®¸æœåŠ¡å™¨æŒ‡å®šè¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰çš„ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œå¦‚å†…å®¹ç±»å‹ã€è®¾ç½® Cookieã€æ§åˆ¶ç¼“å­˜ç­‰ã€‚</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>name</code>: è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºä½ æƒ³è¦è®¾ç½®çš„å¤´éƒ¨å­—æ®µåç§°ï¼Œæ¯”å¦‚ <code>&#39;Content-Type&#39;</code>, <code>&#39;Set-Cookie&#39;</code>, <code>&#39;Cache-Control&#39;</code> ç­‰ã€‚</li><li><code>value</code>: è¿™æ˜¯ä½ æƒ³è¦ç»™ä¸Šè¿°å­—æ®µè®¾ç½®çš„å€¼ï¼Œå®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²æ•°ç»„ã€‚</li></ul><p>ä¸‹é¢ä¸¾å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-è®¾ç½®å†…å®¹ç±»å‹" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è®¾ç½®å†…å®¹ç±»å‹"><span>ä¾‹å­ 1ï¼šè®¾ç½®å†…å®¹ç±»å‹</span></a></h3><p>å½“ä½ å‘é€ HTML é¡µé¢æˆ– JSON æ•°æ®æ—¶ï¼Œéœ€è¦å‘Šè¯‰æµè§ˆå™¨ä½ å‘é€çš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹çš„ã€‚è¿™æ ·æµè§ˆå™¨æ‰èƒ½æ­£ç¡®åœ°æ˜¾ç¤ºæˆ–å¤„ç†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è®¾ç½®å†…å®¹ç±»å‹ä¸º HTML</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, World!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œå®ƒå‘é€ HTML æ•°æ®ï¼Œå¹¶é€šè¿‡ <code>response.setHeader</code> æ–¹æ³•è®¾ç½®äº†å†…å®¹ç±»å‹ä¸º text/htmlã€‚</p><h3 id="ä¾‹å­-2-è®¾ç½®-cookie" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è®¾ç½®-cookie"><span>ä¾‹å­ 2ï¼šè®¾ç½® Cookie</span></a></h3><p>Cookies é€šå¸¸ç”¨äºè·Ÿè¸ªç”¨æˆ·ä¼šè¯æˆ–å­˜å‚¨ç”¨æˆ·çš„åå¥½è®¾ç½®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è®¾ç½®ä¸€ä¸ªåä¸º &#39;session_id&#39; çš„ Cookieï¼Œå€¼ä¸º &#39;123456&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Set-Cookie</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">session_id=123456</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cookie set</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªåä¸º <code>session_id</code> çš„ Cookieï¼Œå¹¶èµ‹äºˆå®ƒä¸€ä¸ªå€¼ <code>&#39;123456&#39;</code>ã€‚å®¢æˆ·ç«¯åœ¨åç»­çš„è¯·æ±‚ä¸­ä¼šå¸¦ä¸Šè¿™ä¸ª Cookieï¼ŒæœåŠ¡å™¨å°±å¯ä»¥æ®æ­¤è¯†åˆ«ç”¨æˆ·ã€‚</p><h3 id="ä¾‹å­-3-æ§åˆ¶ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-æ§åˆ¶ç¼“å­˜"><span>ä¾‹å­ 3ï¼šæ§åˆ¶ç¼“å­˜</span></a></h3><p>ç¼“å­˜å¯ä»¥è®©ç½‘é¡µèµ„æºè¢«é‡ç”¨ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«é¡µé¢çš„åŠ è½½é€Ÿåº¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è®¾ç½® Cache-Control å¤´éƒ¨æ¥å®šä¹‰èµ„æºçš„ç¼“å­˜ç­–ç•¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cache-Control</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">public, max-age=3600</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç¼“å­˜æ—¶é—´ä¸º1å°æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Caching policy set</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½® <code>Cache-Control</code> å¤´éƒ¨ä½¿å¾—å“åº”çš„èµ„æºå¯ä»¥åœ¨å…¬å…±ç¼“å­˜ä¸­å­˜å‚¨ï¼Œå¹¶ä¸”æŒ‡å®šäº†ä¸€ä¸ªæœ€å¤§å¹´é¾„ï¼ˆ<code>max-age</code>ï¼‰ï¼Œå‘Šè¯‰æµè§ˆå™¨æˆ–å…¶ä»–ç¼“å­˜æœºåˆ¶è¯¥èµ„æºå¯ä»¥åœ¨æœ¬åœ°ç¼“å­˜å¹¶é‡ç”¨å¤šé•¿æ—¶é—´ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œä½¿ç”¨ <code>response.setHeader</code> æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å’Œæ§åˆ¶ HTTP å“åº”çš„è¡Œä¸ºã€‚åœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œåˆç†åœ°è®¾ç½®å“åº”å¤´éƒ¨å¯¹äºæ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨æ€§æå‡ç­‰æ–¹é¢éƒ½è‡³å…³é‡è¦ã€‚</p><h3 id="response-settimeout-msecs-callback" tabindex="-1"><a class="header-anchor" href="#response-settimeout-msecs-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsesettimeoutmsecs-callback" target="_blank" rel="noopener noreferrer">response.setTimeout(msecs[, callback])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—å«åš <code>http</code>ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿå¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚ä»Šå¤©æˆ‘ä»¬è¦æ¢è®¨çš„æ˜¯ <code>response.setTimeout(msecs[, callback])</code> æ–¹æ³•ï¼Œè¿™æ˜¯ <code>http</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ã€‚</p><h3 id="response-settimeout-msecs-callback-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#response-settimeout-msecs-callback-è¯¦è§£"><span><code>response.setTimeout(msecs[, callback])</code> è¯¦è§£</span></a></h3><ul><li><p><strong>ç›®çš„ï¼š</strong> è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ä¸º HTTP å“åº”è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚å½“ä½ å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚åï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰å®Œæˆå“åº”ï¼ˆå³æ²¡æœ‰ç»“æŸå“åº”ï¼‰ï¼ŒNode.js å°†è‡ªåŠ¨ç»ˆæ­¢è¿™ä¸ªå“åº”ã€‚è¿™å¯¹äºé˜²æ­¢èµ„æºé•¿æ—¶é—´è¢«å ç”¨æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p></li><li><p><strong>å‚æ•°ï¼š</strong></p><ul><li><code>msecs</code>ï¼šè¿™æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</li><li><code>callback</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå½“å“åº”è¶…æ—¶æ—¶ä¼šè¢«è°ƒç”¨ã€‚</li></ul></li><li><p><strong>å·¥ä½œåŸç†ï¼š</strong> å½“ä½ è°ƒç”¨ <code>response.setTimeout(msecs, callback)</code> æ—¶ï¼š</p><ol><li>è®¾ç½®äº†ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œå¦‚æœåœ¨ <code>msecs</code> æŒ‡å®šçš„æ—¶é—´å†…å“åº”æ²¡æœ‰è¢«å®Œå…¨å‘é€ç»™å®¢æˆ·ç«¯ï¼ˆå³è°ƒç”¨ <code>response.end()</code> ç»“æŸå“åº”ï¼‰ï¼Œåˆ™è§¦å‘è¶…æ—¶ã€‚</li><li>å¦‚æœè®¾ç½®äº† <code>callback</code> å‡½æ•°ï¼Œå½“è¶…æ—¶å‘ç”Ÿæ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°†è¢«æ‰§è¡Œã€‚</li><li>æ³¨æ„ï¼Œä»…ä»…æ˜¯è¶…æ—¶ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨ç»“æŸå“åº”ã€‚å¦‚æœéœ€è¦åœ¨è¶…æ—¶æ—¶ç»“æŸå“åº”ï¼Œä½ åº”è¯¥åœ¨å›è°ƒå‡½æ•°ä¸­æ˜ç¡®è°ƒç”¨ <code>response.end()</code> æˆ–å…¶ä»–ç›¸å…³æ–¹æ³•ã€‚</li></ol></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-18"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œç”¨æˆ·é€šè¿‡è¡¨å•æäº¤æ•°æ®ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå¤„ç†å¯èƒ½åŒ…æ‹¬å¤æ‚çš„æ•°æ®åº“æ“ä½œæˆ–ç¬¬ä¸‰æ–¹ API è°ƒç”¨ï¼Œæœ‰æ—¶å¯èƒ½ä¼šèŠ±è´¹è¾ƒé•¿æ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åªå¯¹ç‰¹å®šè·¯ç”±è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/process-form</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // è®¾ç½®å“åº”è¶…æ—¶ä¸º 5 ç§’</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”è¶…æ—¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // å“åº”è¿˜æœªç»“æŸï¼Œå¯ä»¥é€‰æ‹©ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¤„ç†è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ¨¡æ‹Ÿé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ</span></span>
<span class="line"><span style="color:#88C0D0;">    setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // å‡è®¾è¿™é‡Œæ˜¯æ•°æ®å¤„ç†çš„ä»£ç </span></span>
<span class="line"><span style="color:#616E88;">      // å¦‚æœåœ¨5ç§’å†…å®Œæˆï¼Œåˆ™æ­£å¸¸å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¡¨å•å¤„ç†å®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span><span style="color:#B48EAD;"> 3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾å¤„ç†éœ€è¦3ç§’é’Ÿ</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ°ä¸»é¡µï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ <code>/process-form</code> çš„å¤„ç†æ—¶é—´å°‘äº 5 ç§’ï¼Œåˆ™ç”¨æˆ·å°†çœ‹åˆ° &quot;è¡¨å•å¤„ç†å®Œæˆ&quot; çš„æ¶ˆæ¯ã€‚å¦‚æœå¤„ç†è¶…è¿‡ 5 ç§’ï¼ˆæˆ‘ä»¬è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼‰ï¼Œåˆ™ç”¨æˆ·ä¼šæ”¶åˆ° &quot;å¤„ç†è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•ã€‚&quot; çš„æç¤ºï¼Œå¹¶ä¸”åœ¨æ§åˆ¶å°ä¸­è¾“å‡º &quot;å“åº”è¶…æ—¶&quot;ã€‚è¿™æ ·æ—¢ä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿä¿æŠ¤äº†æœåŠ¡å™¨èµ„æºä¸è¢«æ— é™å ç”¨ã€‚</p><h3 id="response-socket" tabindex="-1"><a class="header-anchor" href="#response-socket"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsesocket" target="_blank" rel="noopener noreferrer">response.socket</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æµè§ˆå™¨ä¸­ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ä»£ç ï¼Œä»è€Œå®ç°å‰åç«¯ç”¨åŒä¸€ç§è¯­è¨€å¼€å‘ï¼Œç®€åŒ–äº† Web åº”ç”¨çš„å¼€å‘æµç¨‹ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>http</code>æ¨¡å—æ˜¯ç”¨äºåˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ— APIï¼Œä½¿å¾—å¤„ç† HTTP è¯·æ±‚å˜å¾—ç®€å•ã€‚ç†è§£<code>http</code>æ¨¡å—çš„å·¥ä½œåŸç†å¯¹äºå¼€å‘ Web åº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</p><h3 id="response-socket-1" tabindex="-1"><a class="header-anchor" href="#response-socket-1"><span><code>response.socket</code></span></a></h3><p>åœ¨<code>http</code>æ¨¡å—ä¸­ï¼Œå½“ä½ æ¥æ”¶åˆ°ä¸€ä¸ª HTTP è¯·æ±‚å¹¶ä¸”è¦å‘é€å›ä¸€ä¸ªå“åº”æ—¶ï¼Œä¼šç”¨åˆ°<code>response</code>å¯¹è±¡ã€‚<code>response.socket</code>æ˜¯<code>response</code>å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†å¯¹åº•å±‚ç½‘ç»œé€šä¿¡çš„ socketï¼ˆå¥—æ¥å­—ï¼‰çš„ç›´æ¥è®¿é—®ã€‚</p><p>ä¸€ä¸ªâ€œsocketâ€æ˜¯ç½‘ç»œä¸Šçš„ä¸¤ä¸ªç¨‹åºé€šè¿‡ç½‘ç»œäº¤æ¢æ•°æ®çš„ç«¯ç‚¹ã€‚æ¯ä¸ª socket éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„ IP åœ°å€å’Œç«¯å£ï¼Œç”¨äºåŒºåˆ†åœ¨ Internet ä¸Šæˆ–è€…æœ¬åœ°ç½‘ç»œä¸­çš„ä¸åŒç¨‹åºã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-14"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><ol><li><p><strong>è·å–å®¢æˆ·ç«¯ä¿¡æ¯</strong>ï¼šåˆ©ç”¨<code>response.socket</code>ï¼Œå¯ä»¥è·å–åˆ°å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ IP åœ°å€å’Œç«¯å£å·ã€‚è¿™å¯¹äºè®°å½•æ—¥å¿—ã€åˆ†ææµé‡æ¥æºç­‰åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> clientSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯åœ°å€: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">ï¼Œç«¯å£: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼Œä¸–ç•Œï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç›´æ¥æ“ä½œ socket è¿›è¡Œä½çº§é€šä¿¡</strong>ï¼šè™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦ç›´æ¥æ“ä½œ socketï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šåœºåˆï¼Œæ¯”å¦‚éœ€è¦å®ç°ä¸€äº›è‡ªå®šä¹‰çš„åº•å±‚åè®®æˆ–è€…æ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œ<code>response.socket</code>æä¾›äº†è¿™ç§å¯èƒ½ã€‚</p><p>æ³¨æ„ï¼Œç›´æ¥æ“ä½œ socket éœ€è¦å¯¹ TCP/IP åè®®æœ‰æ·±å…¥ç†è§£ï¼Œå¹¶ä¸”è¿™æ ·åšå®¹æ˜“å¼•å…¥é”™è¯¯å’Œå®‰å…¨é—®é¢˜ã€‚æ‰€ä»¥ï¼Œé™¤éçœŸçš„æœ‰å¿…è¦ï¼Œå¦åˆ™æ¨èä½¿ç”¨ Node.js çš„é«˜çº§ API æ¥å¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚</p></li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>response.socket</code>æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¥å£ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåœ¨å¿…è¦æ—¶å¯¹ HTTP é€šä¿¡è¿›è¡Œæ›´åŠ ç»†ç²’åº¦çš„æ§åˆ¶ã€‚ç„¶è€Œï¼Œæ­£ç¡®åœ°ä½¿ç”¨è¿™ä¸ªç‰¹æ€§éœ€è¦å¯¹ç½‘ç»œç¼–ç¨‹æœ‰ä¸€å®šçš„äº†è§£ã€‚å¯¹äºå¤§å¤šæ•°å¸¸è§çš„ Web å¼€å‘ä»»åŠ¡ï¼Œä½ å¯èƒ½ä¸éœ€è¦ç›´æ¥ä¸<code>response.socket</code>æ‰“äº¤é“ã€‚</p><h3 id="response-statuscode" tabindex="-1"><a class="header-anchor" href="#response-statuscode"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsestatuscode" target="_blank" rel="noopener noreferrer">response.statusCode</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼±å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™ä½¿å¾— JavaScript ä¸ä»…å¯ä»¥ç”¨äºæ„å»ºå‰ç«¯ç”¨æˆ·ç•Œé¢ï¼Œè¿˜èƒ½ç”¨äºåç«¯æœåŠ¡å™¨çš„å¼€å‘ã€‚Node.js æä¾›äº†å¾ˆå¤šå†…ç½®æ¨¡å—å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ã€‚</p><p>å…¶ä¸­çš„ <code>http</code> æ¨¡å—æ˜¯ Node.js ä¸­éå¸¸æ ¸å¿ƒçš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿä½œä¸ºæœåŠ¡å™¨æ¥æ”¶ HTTP è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚<code>response.statusCode</code> æ˜¯è¿™ä¸ªæ¨¡å—ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒè¢«ç”¨æ¥è¡¨ç¤ºå“åº”çš„ HTTP çŠ¶æ€ç ã€‚</p><h3 id="è§£é‡Š-response-statuscode" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-response-statuscode"><span>è§£é‡Š <code>response.statusCode</code></span></a></h3><p>å½“ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨é™¤äº†è¦å›ä¼ è¯·æ±‚çš„å†…å®¹å¤–ï¼Œè¿˜ä¼šé€šè¿‡çŠ¶æ€ç å‘ŠçŸ¥å®¢æˆ·ç«¯æœ¬æ¬¡è¯·æ±‚çš„ç»“æœã€‚è¿™äº›çŠ¶æ€ç é€šè¿‡ <code>response.statusCode</code> å±æ€§è®¾å®šã€‚</p><p>çŠ¶æ€ç æ˜¯ä¸€ä¸ªä¸‰ä½æ•°çš„æ•°å­—ï¼Œæ ¹æ®å…¶èŒƒå›´åˆ†ä¸ºå‡ ç±»ï¼š</p><ul><li><strong>1xxï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰</strong>ï¼šè¡¨ç¤ºæ¥æ”¶åˆ°è¯·æ±‚ï¼Œç»§ç»­å¤„ç†ã€‚</li><li><strong>2xxï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</strong>ï¼šè¡¨ç¤ºè¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ï¼Œå¹¶æ¥å—ã€‚ä¾‹å¦‚ï¼Œ200 OK æ˜¯æœ€å¸¸è§çš„æˆåŠŸçŠ¶æ€ç ã€‚</li><li><strong>3xxï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</strong>ï¼šè¡¨ç¤ºéœ€è¦å®¢æˆ·ç«¯é‡‡å–è¿›ä¸€æ­¥çš„æ“ä½œæ‰èƒ½å®Œæˆè¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œ301 Moved Permanently è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚</li><li><strong>4xxï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</strong>ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çœ‹èµ·æ¥å¯èƒ½å‘å‡ºäº†é”™è¯¯çš„è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œ404 Not Found è¡¨ç¤ºè¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨ä¸Šæœªæ‰¾åˆ°ã€‚</li><li><strong>5xxï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</strong>ï¼šè¡¨ç¤ºæœåŠ¡å™¨åœ¨å°è¯•å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†å†…éƒ¨é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œ500 Internal Server Error è¡¨ç¤ºæœåŠ¡å™¨é‡åˆ°äº†ä¸€ä¸ªæœªé¢„æœŸçš„çŠ¶å†µï¼Œé˜»æ­¢äº†å®ƒå®Œæˆè¯·æ±‚ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-19"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ªç½‘ç«™åç«¯ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®ä¸åŒçš„æƒ…å†µè¿”å›ä¸åŒçš„çŠ¶æ€ç ç»™å®¢æˆ·ç«¯ã€‚</p><h4 id="ä¾‹å­-1-è¿”å›ä¸€ä¸ªæˆåŠŸçš„å“åº”" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¿”å›ä¸€ä¸ªæˆåŠŸçš„å“åº”"><span>ä¾‹å­ 1ï¼šè¿”å›ä¸€ä¸ªæˆåŠŸçš„å“åº”</span></a></h4><p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ å¯ä»¥è¿”å›ä¸€ä¸ª <code>200 OK</code> çŠ¶æ€ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æœ‰äººè®¿é—®ä½ çš„æœåŠ¡å™¨æ—¶ï¼Œä»–ä»¬ä¼šæ”¶åˆ°ä¸€ä¸ªçŠ¶æ€ç  200 å’Œæ–‡æœ¬ â€œHello, World!â€ã€‚</p><h4 id="ä¾‹å­-2-èµ„æºæœªæ‰¾åˆ°" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-èµ„æºæœªæ‰¾åˆ°"><span>ä¾‹å­ 2ï¼šèµ„æºæœªæ‰¾åˆ°</span></a></h4><p>å¦‚æœè¯·æ±‚çš„é¡µé¢ä¸å­˜åœ¨ï¼Œä½ å¯ä»¥è¿”å›ä¸€ä¸ª <code>404 Not Found</code> çŠ¶æ€ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/page-that-does-not-exist</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 404</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">404 Not Found</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to my website!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæœ‰äººå°è¯•è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢ï¼ˆ/page-that-does-not-existï¼‰ï¼Œä»–ä»¬ä¼šæ”¶åˆ°ä¸€ä¸ªçŠ¶æ€ç  404 å’Œæ–‡æœ¬ â€œ404 Not Foundâ€ã€‚</p><p>é€šè¿‡æ­£ç¡®ä½¿ç”¨ <code>response.statusCode</code>ï¼Œä½ å¯ä»¥è®©ä½ çš„ web åº”ç”¨æ›´åŠ å‹å¥½å’Œç¬¦åˆ HTTP æ ‡å‡†ã€‚</p><h3 id="response-statusmessage" tabindex="-1"><a class="header-anchor" href="#response-statusmessage"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsestatusmessage" target="_blank" rel="noopener noreferrer">response.statusMessage</a></span></a></h3><p>äº†è§£<code>response.statusMessage</code>ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ HTTP åè®®çš„åŸºç¡€çŸ¥è¯†ã€‚å½“ä½ é€šè¿‡æµè§ˆå™¨æˆ–è€…å…¶ä»–å·¥å…·å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ˆæ¯”å¦‚è®¿é—®ä¸€ä¸ªç½‘é¡µï¼‰ï¼ŒæœåŠ¡å™¨ä¼šå›åº”ä¸€ä¸ª HTTP å“åº”ã€‚è¿™ä¸ªå“åº”åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šçŠ¶æ€ç ï¼ˆStatus Codeï¼‰ã€çŠ¶æ€æ¶ˆæ¯ï¼ˆStatus Messageï¼‰å’Œå“åº”ä½“ï¼ˆResponse Bodyï¼‰ã€‚</p><ul><li><strong>çŠ¶æ€ç </strong> æ˜¯ä¸€ä¸ªä¸‰ä½æ•°å­—ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¯·æ±‚æ˜¯æˆåŠŸäº†ã€å‡ºç°äº†é”™è¯¯ï¼Œè¿˜æ˜¯éœ€è¦è¿›ä¸€æ­¥æ“ä½œã€‚</li><li><strong>çŠ¶æ€æ¶ˆæ¯</strong> æä¾›å¯¹çŠ¶æ€ç çš„ç®€çŸ­æè¿°ï¼Œä¾‹å¦‚&quot;OK&quot;æˆ–&quot;Not Found&quot;ã€‚</li><li><strong>å“åº”ä½“</strong> åˆ™æ˜¯å®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹ï¼Œæ¯”å¦‚ HTML é¡µé¢ã€å›¾ç‰‡ç­‰ã€‚</li></ul><h3 id="response-statusmessage-1" tabindex="-1"><a class="header-anchor" href="#response-statusmessage-1"><span>response.statusMessage</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>response.statusMessage</code>å±æ€§ç”¨äºè·å–æˆ–è®¾ç½® HTTP å“åº”çš„çŠ¶æ€æ¶ˆæ¯ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸<code>http.ServerResponse</code>å¯¹è±¡ç›¸å…³è”çš„ï¼Œè¿™ä¸ªå¯¹è±¡é€šå¸¸è¡¨ç¤ºæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å“åº”ã€‚</p><p>æ¥çœ‹å‡ ä¸ªä¾‹å­è¯´æ˜<code>response.statusMessage</code>çš„ä½¿ç”¨åœºæ™¯ï¼š</p><h4 id="è®¾ç½®è‡ªå®šä¹‰çŠ¶æ€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®è‡ªå®šä¹‰çŠ¶æ€æ¶ˆæ¯"><span>è®¾ç½®è‡ªå®šä¹‰çŠ¶æ€æ¶ˆæ¯</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web æœåŠ¡ï¼Œå½“ç”¨æˆ·è¯•å›¾è®¿é—®ä¸å­˜åœ¨çš„å†…å®¹æ—¶ï¼Œä½ ä¸ä»…æƒ³è¿”å› 404 çŠ¶æ€ç ï¼Œè¿˜æƒ³æä¾›ä¸€ä¸ªæ›´å‹å¥½çš„çŠ¶æ€æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // The document is from Ying Chao Tea.Do not use for commercial purposes.</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/not-found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 404</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content Not Found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è‡ªå®šä¹‰çŠ¶æ€æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">OK</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to the homepage!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¦‚æœç”¨æˆ·è®¿é—®<code>/not-found</code>è·¯å¾„ï¼Œä»–ä»¬å°†æ”¶åˆ°ä¸€ä¸ªçŠ¶æ€ç ä¸º 404 å’ŒçŠ¶æ€æ¶ˆæ¯ä¸º&quot;Content Not Found&quot;çš„å“åº”ã€‚è€Œè®¿é—®å…¶ä»–è·¯å¾„ï¼Œåˆ™ä¼šè¿”å›çŠ¶æ€ç  200 å’ŒçŠ¶æ€æ¶ˆæ¯&quot;OK&quot;ï¼Œä»¥åŠæ–‡å­—&quot;Welcome to the homepage!&quot;ã€‚</p><h4 id="è·å–çŠ¶æ€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#è·å–çŠ¶æ€æ¶ˆæ¯"><span>è·å–çŠ¶æ€æ¶ˆæ¯</span></a></h4><p>è€ƒè™‘å¦ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½œä¸ºå¼€å‘è€…å¯èƒ½éœ€è¦æ ¹æ®å“åº”çš„çŠ¶æ€æ¶ˆæ¯æ¥åšè¿›ä¸€æ­¥å¤„ç†ã€‚æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªä¸­é—´ä»¶æˆ–å‡½æ•°è´Ÿè´£æ—¥å¿—è®°å½•ï¼Œéœ€è¦æ‰“å°å‡ºå“åº”çš„çŠ¶æ€ç å’ŒçŠ¶æ€æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> logResponse</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">Response sent with status code: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> and status message: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusMessage</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨æŸå¤„è°ƒç”¨äº†logResponseå‡½æ•°ï¼Œå¹¶ä¼ å…¥äº†ä¸€ä¸ªresponseå¯¹è±¡ã€‚</span></span>
<span class="line"><span style="color:#616E88;">// è¿™é‡Œå°±ä¸å†èµ˜è¿°åˆ›å»ºæœåŠ¡å™¨å’Œå“åº”çš„å®Œæ•´ä»£ç ï¼Œé‡ç‚¹åœ¨äºå±•ç¤ºlogResponseçš„ç”¨æ³•ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-14" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-14"><span>æ€»ç»“</span></a></h3><p><code>response.statusMessage</code>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­æ‰®æ¼”ç€ä¸€ä¸ªé‡è¦çš„è§’è‰²ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨åˆ›å»º HTTP å“åº”æ—¶æä¾›æ›´ä¸°å¯Œçš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—åœ¨å¤„ç† HTTP å“åº”æ—¶å¯ä»¥ä¾æ®çŠ¶æ€æ¶ˆæ¯è¿›è¡Œç‰¹å®šçš„é€»è¾‘å¤„ç†ã€‚æ— è®ºæ˜¯å¯¹äºæ„å»ºç”¨æˆ·å‹å¥½çš„ Web æœåŠ¡ï¼Œè¿˜æ˜¯è¿›è¡Œæœ‰æ•ˆçš„æ—¥å¿—è®°å½•ï¼Œäº†è§£å¹¶æ­£ç¡®ä½¿ç”¨<code>response.statusMessage</code>éƒ½æ˜¯éå¸¸æœ‰ç›Šçš„ã€‚</p><h3 id="response-strictcontentlength" tabindex="-1"><a class="header-anchor" href="#response-strictcontentlength"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsestrictcontentlength" target="_blank" rel="noopener noreferrer">response.strictContentLength</a></span></a></h3><p><code>response.strictContentLength</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ˜¯ä¸“é—¨ç”¨äº http å“åº”(<code>http.ServerResponse</code>)å¯¹è±¡çš„ã€‚åœ¨äº†è§£è¿™ä¸ªå±æ€§ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“ HTTP å“åº”ä¸­æœ‰ä¸€ä¸ªåä¸º <code>Content-Length</code> çš„å¤´ä¿¡æ¯ï¼Œå®ƒè¡¨ç¤ºå‘é€ç»™å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨æˆ–å…¶ä»– HTTP å®¢æˆ·ç«¯ï¼‰çš„å“åº”ä¸»ä½“çš„ç¡®åˆ‡å­—èŠ‚æ•°ã€‚</p><p>æœ‰æ—¶å€™ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šé”™è¯¯åœ°è®¾ç½® <code>Content-Length</code> å¤´éƒ¨ï¼Œæˆ–è€…åœ¨å‘é€å“åº”ä¸»ä½“æ—¶å‘é€äº†æ›´å¤šæˆ–æ›´å°‘çš„æ•°æ®ã€‚å¦‚æœ <code>strictContentLength</code> è®¾ç½®ä¸º <code>true</code>ï¼ŒNode.js å°†ä¼šéªŒè¯å‘é€çš„æ•°æ®é•¿åº¦æ˜¯å¦ä¸ <code>Content-Length</code> å¤´éƒ¨å£°æ˜çš„é•¿åº¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œå°†ä¼šå‘å‡ºä¸€ä¸ªé”™è¯¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>strictContentLength</code> æ˜¯ <code>false</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ Node.js ä¸ä¼šè¿›è¡Œè¿™ä¸ªä¸¥æ ¼çš„æ£€æŸ¥ã€‚</p><h3 id="å®é™…ç”¨é€”" tabindex="-1"><a class="header-anchor" href="#å®é™…ç”¨é€”"><span>å®é™…ç”¨é€”ï¼š</span></a></h3><ol><li><p><strong>ä¿è¯æ•°æ®å®Œæ•´æ€§</strong>ï¼š<br> å½“ä½ ä½œä¸ºå¼€å‘è€…è¦ç¡®ä¿å‘é€åˆ°å®¢æˆ·ç«¯çš„æ•°æ®å®Œæ•´æ— è¯¯æ—¶ï¼Œå¯ä»¥å°† <code>strictContentLength</code> è®¾ä¸º <code>true</code>ã€‚å¦‚æœç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚ç¨‹åºé€»è¾‘é”™è¯¯ï¼‰å‘é€çš„æ•°æ®é‡ä¸ <code>Content-Length</code> å¤´éƒ¨ä¸ç¬¦ï¼ŒNode.js ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæé†’å¼€å‘è€…æˆ–è€…ç»ˆæ­¢å“åº”ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å‘é€æŸåæˆ–è€…ä¸å®Œæ•´çš„æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</p></li><li><p><strong>è°ƒè¯•å’Œæµ‹è¯•</strong>ï¼š<br> åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½æƒ³è¦ç¡®è®¤ä½ çš„åº”ç”¨æ­£ç¡®åœ°å¤„ç†äº†å†…å®¹é•¿åº¦ã€‚é€šè¿‡å¯ç”¨ <code>strictContentLength</code>ï¼Œä½ å¯ä»¥åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æ•è·ä»»ä½•ä¸å†…å®¹é•¿åº¦ç›¸å…³çš„é”™è¯¯ï¼Œè¿™æœ‰åŠ©äºç¡®ä¿å‡†å¤‡éƒ¨ç½²çš„ä»£ç æ˜¯å¥å£®çš„ã€‚</p></li><li><p><strong>éµå®ˆåè®®</strong>ï¼š<br> åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯èƒ½éœ€è¦ä¸¥æ ¼éµå¾ª HTTP åè®®è§„èŒƒï¼Œæ­¤æ—¶ä½¿ç”¨ <code>strictContentLength</code> å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿åº”ç”¨ä¸¥æ ¼æŒ‰ç…§åè®®æ¥è¿ä½œï¼Œå°¤å…¶æ˜¯å½“ä½ çš„åº”ç”¨éœ€è¦é€šè¿‡æŸäº›å®‰å…¨å®¡è®¡æˆ–åˆè§„æ£€æŸ¥æ—¶ã€‚</p></li></ol><h3 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹"><span>ä»£ç ç¤ºä¾‹ï¼š</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">20</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾æˆ‘ä»¬å‘Šè¯‰å®¢æˆ·ç«¯å°†è¦å‘é€20å­—èŠ‚çš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¼€å¯ä¸¥æ ¼æ ¡éªŒï¼Œå°†ä¼šç›‘æµ‹å®é™…å‘é€çš„æ•°æ®é•¿åº¦æ˜¯å¦ä¸º20å­—èŠ‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">strictContentLength</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> true;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€äº†15å­—èŠ‚çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™é‡Œå®é™…åªæœ‰13å­—èŠ‚ï¼Œä½† Content-Length è¢«è®¾ç½®æˆäº† 20</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å› ä¸ºå®é™…å‘é€çš„å­—èŠ‚ä¸ Content-Length ä¸ç¬¦ï¼ŒNode.js å°†ä¼šæŠ›å‡ºé”™è¯¯</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå½“å“åº”ç»“æŸæ—¶ï¼Œå¦‚æœå·²ç»å‘é€çš„æ•°æ®é•¿åº¦ä¸ç­‰äº <code>Content-Length</code> å¤´éƒ¨æŒ‡å®šçš„é•¿åº¦ï¼ŒNode.js å°†ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼ˆå› ä¸ºæˆ‘ä»¬è®¾ç½®äº† <code>strictContentLength = true</code>ï¼‰ã€‚è¿™ä¸ªé”™è¯¯é€šå¸¸ä¼šå¯¼è‡´å“åº”è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå‘é€ä»»ä½•åç»­çš„å“åº”æ•°æ®ã€‚è¿™æ ·çš„é”™è¯¯å¤„ç†æœºåˆ¶èƒ½è®©å¼€å‘è€…æ„è¯†åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶åŠæ—¶ä¿®å¤å®ƒä»¬ã€‚</p><h3 id="response-uncork" tabindex="-1"><a class="header-anchor" href="#response-uncork"><span><a href="https://nodejs.org/docs/latest/api/http.html#responseuncork" target="_blank" rel="noopener noreferrer">response.uncork()</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>response.uncork()</code> æ–¹æ³•æ—¶ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—ç†è§£ Node.js åœ¨å¤„ç† I/Oï¼ˆè¾“å…¥/è¾“å‡ºï¼‰æ“ä½œæ—¶é‡‡ç”¨çš„ä¸€ç§å«åš &quot;stream&quot;ï¼ˆæµï¼‰çš„æ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œæµè¢«ç”¨æ¥æœ‰æ•ˆåœ°å¤„ç†æ•°æ®ï¼Œæ— è®ºè¿™äº›æ•°æ®æ˜¯ä»æ–‡ä»¶è¯»å‡ºæ¥çš„ï¼Œè¿˜æ˜¯å†™å…¥æ–‡ä»¶ï¼Œæˆ–æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“çš„ã€‚</p><p>åœ¨è¿›è¡Œç½‘ç»œé€šä¿¡æˆ–æ–‡ä»¶å†™å…¥æ—¶ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªé‡è¦è€ƒè™‘å› ç´ ã€‚ä¸ºäº†å‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callsï¼‰çš„æ¬¡æ•°å’Œæé«˜æ•ˆç‡ï¼ŒNode.js ä½¿ç”¨äº†ä¸€ç§ç§°ä¸º &quot;buffering&quot;ï¼ˆç¼“å†²ï¼‰çš„æŠ€æœ¯ã€‚ç¼“å†²å…è®¸å°å—æ•°æ®å…ˆç§¯ç´¯èµ·æ¥ï¼Œç„¶åä¸€æ¬¡æ€§å‘é€æˆ–å†™å…¥ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘å‘æ“ä½œç³»ç»Ÿè¯·æ±‚èµ„æºçš„æ¬¡æ•°ã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ¯”å¦‚ç¡®ä¿ä¸€ç³»åˆ—æ•°æ®å—ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«ç«‹å³å¤„ç†ã€‚è¿™å°±æ˜¯ <code>response.cork()</code> å’Œ <code>response.uncork()</code> å‡ºåœºçš„åœ°æ–¹ã€‚é¦–å…ˆç®€å•äº†è§£ä¸€ä¸‹ <code>response.cork()</code>ï¼šå®ƒå®é™…ä¸Šæ˜¯åœ¨å‘Šè¯‰ Node.js &quot;æš‚æ—¶æŒ‚èµ·ï¼ˆcorkï¼‰&quot; æ•°æ®çš„å‘é€ï¼Œå³ä½¿ç¨‹åºå¯èƒ½æ­£åœ¨å°è¯•å†™å…¥æ•°æ®ã€‚æ•°æ®ä¼šè¢«ç§¯ç´¯èµ·æ¥ï¼Œç›´åˆ°æˆ‘ä»¬æ˜ç¡®è¡¨ç¤ºå‡†å¤‡å‘é€ã€‚</p><p>ç°åœ¨èŠèŠ <code>response.uncork()</code>ã€‚è¿™ä¸ªæ–¹æ³•æ­£å¥½ç›¸åï¼Œå®ƒè¢«ç”¨æ¥â€œè§£é™¤æŒ‚èµ·ï¼ˆuncorkï¼‰â€ä¹‹å‰è¢«æŒ‚èµ·çš„æ•°æ®æµã€‚å½“ä½ è°ƒç”¨ <code>response.cork()</code> åï¼Œå¯ä»¥åšä¸€äº›æ•°æ®å¤„ç†æˆ–æ·»åŠ æ›´å¤šçš„æ•°æ®åˆ°ç¼“å†²åŒºï¼Œç„¶åé€šè¿‡ <code>response.uncork()</code> æ¥å‘Šè¯‰ Node.jsï¼šâ€œå¥½äº†ï¼Œç°åœ¨å¯ä»¥æŠŠä¹‹å‰ç§¯ç´¯çš„æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§å‘é€å‡ºå»äº†â€ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-15"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªåº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä»æ•°æ®åº“è·å–ä¸€äº›æ•°æ®ï¼Œç„¶åå°†è¿™äº›æ•°æ®è½¬æ¢æˆç‰¹å®šæ ¼å¼å‘é€ç»™å®¢æˆ·ç«¯ã€‚ä½ çš„ä»£ç å¯èƒ½é•¿è¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾responseæ˜¯ä½ é€šè¿‡HTTPæœåŠ¡å™¨å¾—åˆ°çš„å“åº”å¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä»æ•°æ®åº“ä¸­è·å–æ•°æ®</span></span>
<span class="line"><span style="color:#88C0D0;">getDataFromDatabase</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œåªæ˜¯ç®€å•åœ°è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> processedData</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> processData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å†™å…¥å¤„ç†åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">processedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç°åœ¨æˆ‘ä»¬å®Œæˆäº†æ•°æ®å¤„ç†å’Œæ·»åŠ ï¼Œå¯ä»¥è§£é™¤æŒ‚èµ·ï¼Œè®© Node.js å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">uncork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>response.cork()</code> å’Œ <code>response.uncork()</code> çš„ä½¿ç”¨ç¡®ä¿äº†å³ä½¿æ˜¯åœ¨å¼‚æ­¥æ“ä½œå®Œæˆä¹‹å‰å°±å¼€å§‹è¿›è¡Œæ•°æ®çš„å†™å…¥ï¼Œæœ€ç»ˆæ•°æ®ä¹Ÿæ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“å‘é€çš„ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><h3 id="å°ç»“-3" tabindex="-1"><a class="header-anchor" href="#å°ç»“-3"><span>å°ç»“</span></a></h3><p>æ€»çš„æ¥è¯´ï¼Œ<code>response.uncork()</code> æ–¹æ³•åœ¨ Node.js ä¸­æ˜¯ä¸ <code>response.cork()</code> é…åˆä½¿ç”¨çš„ï¼Œç”¨äºä¼˜åŒ–æ•°æ®çš„å‘é€è¿‡ç¨‹ã€‚é€šè¿‡æš‚æ—¶æŒ‚èµ·æ•°æ®å‘é€ï¼Œç­‰å¾…ç›´åˆ°æ‰€æœ‰å¿…è¦çš„æ•°æ®éƒ½å‡†å¤‡å¥½åå†ä¸€æ¬¡æ€§å‘é€ï¼Œå¯ä»¥å¸®åŠ©æå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p><h3 id="response-writableended" tabindex="-1"><a class="header-anchor" href="#response-writableended"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsewritableended" target="_blank" rel="noopener noreferrer">response.writableEnded</a></span></a></h3><p><code>response.writableEnded</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—çš„ä¸€ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨æ¥æŒ‡ç¤ºå¯¹ä¸€ä¸ª HTTP å“åº”(response)å¯¹è±¡çš„å†™å…¥æ“ä½œæ˜¯å¦å·²ç»å®Œæˆã€‚åœ¨ Node.js v21.7.1 å’Œå…¶ä»–è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå±æ€§å‘Šè¯‰ä½ æ˜¯å¦æ‰€æœ‰è¦å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®å·²ç»è¢«å®Œå…¨å†™å…¥å¹¶ä¸”ç»“æŸäº†ã€‚</p><p>ä¸ºäº†æ›´å…·ä½“åœ°ç†è§£ <code>response.writableEnded</code>ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“ Node.js ä¸­çš„ HTTP å“åº”å¯¹è±¡æ˜¯ä»€ä¹ˆã€‚å½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚åˆ°è¿™ä¸ªæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±ä¼šç”Ÿæˆä¸€ä¸ªå“åº”å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡ï¼Œä½ å¯ä»¥å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®å’Œä¿¡æ¯ã€‚è¿™ä¸ªå“åº”å¯¹è±¡æä¾›äº†å¤šç§æ–¹æ³•æ¥è®¾ç½®è¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹ï¼Œæ¯”å¦‚è®¾ç½®çŠ¶æ€ç ï¼ˆå¦‚ 200 è¡¨ç¤ºæˆåŠŸï¼‰ï¼Œå‘é€å“åº”å¤´å’Œå“åº”ä½“ç­‰ã€‚</p><p>å½“ä½ å®Œæˆå¯¹å“åº”å¯¹è±¡çš„å†™å…¥åé€šå¸¸ä¼šè°ƒç”¨ <code>.end()</code> æ–¹æ³•æ¥ç»“æŸå“åº”ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å°†æ”¶åˆ°å®Œæ•´çš„å›å¤ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥çœ‹çœ‹ <code>response.writableEnded</code> æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š</p><h3 id="ç¤ºä¾‹-1-ç®€å•çš„-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç®€å•çš„-http-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1: ç®€å•çš„ HTTP æœåŠ¡å™¨</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å†™å…¥å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableEnded</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º falseï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableEnded</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º trueï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ç»“æŸäº†å“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå½“å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› &quot;Hello, World!&quot; å­—ç¬¦ä¸²ã€‚åœ¨è°ƒç”¨ <code>res.end()</code> æ–¹æ³•ä¹‹å‰ï¼Œ<code>res.writableEnded</code> çš„å€¼æ˜¯ <code>false</code>ï¼Œè¿™è¯´æ˜å“åº”è¿˜æ²¡æœ‰ç»“æŸã€‚è°ƒç”¨ <code>res.end()</code> åï¼Œ<code>res.writableEnded</code> å˜æˆ <code>true</code>ï¼Œè¡¨æ˜å“åº”å·²ç»ç»“æŸï¼Œæ•°æ®å·²å…¨éƒ¨å‘é€å®Œæ¯•ã€‚</p><h3 id="ç¤ºä¾‹-2-æ£€æŸ¥å“åº”æ˜¯å¦å·²ç»“æŸ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ£€æŸ¥å“åº”æ˜¯å¦å·²ç»“æŸ"><span>ç¤ºä¾‹ 2: æ£€æŸ¥å“åº”æ˜¯å¦å·²ç»“æŸ</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">First part of the response.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">End of the response.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableEnded</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The response has been sent to the client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The response has not been fully sent yet.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå‘é€äº†å“åº”çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œç„¶åç«‹åˆ»ç»“æŸå“åº”ï¼Œå¹¶å‘é€æœ€åçš„æ•°æ®ã€‚å› ä¸ºæˆ‘ä»¬è°ƒç”¨äº† <code>res.end()</code> æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨æ£€æŸ¥ <code>res.writableEnded</code> å±æ€§æ—¶ï¼Œå®ƒåº”è¯¥è¿”å› <code>true</code>ï¼Œæ„å‘³ç€å“åº”å·²ç»å®Œå…¨å‘é€ç»™äº†å®¢æˆ·ç«¯ã€‚</p><p>è¿™ä¸ªå±æ€§ç‰¹åˆ«æœ‰ç”¨åœ¨é‚£äº›æƒ³è¦ç¡®ä¿ä¸é‡å¤å‘é€å“åº”æˆ–è€…åœ¨æŸäº›å¼‚æ­¥æ“ä½œå®Œæˆåæ‰ç»“æŸå“åº”çš„åœºæ™¯ã€‚é€šè¿‡æ£€æŸ¥ <code>response.writableEnded</code>ï¼Œä½ å¯ä»¥ç¼–å†™ä»£ç ä»¥é˜²æ­¢åœ¨å“åº”å·²ç»ç»“æŸåå†æ¬¡å°è¯•å†™å…¥æˆ–ç»“æŸï¼Œä»è€Œé¿å…é”™è¯¯ã€‚</p><h3 id="response-writablefinished" tabindex="-1"><a class="header-anchor" href="#response-writablefinished"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsewritablefinished" target="_blank" rel="noopener noreferrer">response.writableFinished</a></span></a></h3><p>åœ¨è§£é‡Š Node.js v21.7.1 ä¸­çš„ <code>response.writableFinished</code> å±æ€§å‰ï¼Œè®©æˆ‘ä»¬å…ˆç†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒå¹¿æ³›ç”¨äºå¼€å‘åç«¯æœåŠ¡ï¼Œå¦‚ APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰å’Œç½‘ç«™çš„æœåŠ¡å™¨ç«¯é€»è¾‘ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-http-å“åº”-http-response" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-http-å“åº”-http-response"><span>ä»€ä¹ˆæ˜¯ HTTP å“åº”ï¼ˆHTTP Responseï¼‰ï¼Ÿ</span></a></h3><p>å½“ä½ æµè§ˆç½‘é¡µæˆ–ä¸ç½‘ç»œæœåŠ¡äº¤äº’æ—¶ï¼Œé€šå¸¸ä¼šå‘å‡ºä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¿™ä¸ªè¯·æ±‚åè¿”å›ä¸€ä¸ªå“åº”ã€‚è¿™ä¸ªå“åº”å¯ä»¥æ˜¯ç½‘é¡µã€å›¾ç‰‡ã€æ•°æ®ç­‰ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ http æ¨¡å—æ¥åˆ›å»ºæœåŠ¡å™¨ï¼Œæ¥æ”¶è¯·æ±‚å¹¶å‘é€å“åº”ã€‚</p><h3 id="response-writablefinished-1" tabindex="-1"><a class="header-anchor" href="#response-writablefinished-1"><span>response.writableFinished</span></a></h3><p>åœ¨ Node.js çš„ http æ¨¡å—ä¸­ï¼Œ<code>response</code> å¯¹è±¡ä»£è¡¨äº†å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å“åº”ã€‚<code>response.writableFinished</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼å±æ€§ï¼Œå®ƒè¡¨ç¤ºæ˜¯å¦æ‰€æœ‰è¦å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®å·²ç»è¢« Node.js å‘é€å®Œæ¯•ã€‚å¦‚æœè¯¥å±æ€§ä¸º <code>true</code>ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»ä¼ è¾“å®Œæˆï¼›å¦‚æœä¸º <code>false</code>ï¼Œåˆ™è¿˜æœ‰æ•°æ®æœªè¢«å®Œå…¨å‘é€ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-16"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼šä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘ç«™ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªè¡¨å•ï¼Œç”¨æˆ·å¡«å†™åæäº¤ã€‚æœåŠ¡å™¨éœ€è¦å¤„ç†è¿™ä¸ªè¡¨å•ï¼Œå¯èƒ½è¿˜éœ€ä¸æ•°æ®åº“äº¤äº’ï¼Œå¹¶å‘ç”¨æˆ·æä¾›ä¸€ä¸ªç¡®è®¤ä¿¡æ¯è¡¨ç¤ºè¡¨å•å·²æˆåŠŸæäº¤ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/submit-form</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¤„ç†é€»è¾‘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‘é€å“åº”ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Form submitted successfully.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // ç°åœ¨å¯ä»¥æ£€æŸ¥ writableFinished å±æ€§</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableFinished</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">All data has been sent to the client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">There is still data being sent to the client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç›‘å¬ POST è¯·æ±‚åˆ° <code>/submit-form</code> è·¯å¾„ã€‚å½“è¿™ä¸ªè¯·æ±‚å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼ˆå‡è®¾å¤„ç†é€»è¾‘å·²å®Œæˆï¼‰ï¼Œç„¶åé€šè¿‡è°ƒç”¨ <code>res.end(&#39;Form submitted successfully.&#39;)</code> å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¡¨ç¤ºè¡¨å•æäº¤æˆåŠŸã€‚ç´§æ¥ç€ï¼Œé€šè¿‡æ£€æŸ¥ <code>res.writableFinished</code> å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤æ•°æ®æ˜¯å¦å…¨éƒ¨å‘é€å®Œæ¯•ã€‚</p><h3 id="æ€»ç»“-15" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-15"><span>æ€»ç»“</span></a></h3><p><code>response.writableFinished</code> åœ¨ Node.js çš„ http æ¨¡å—ä¸­æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦ç¡®ä¿æ‰€æœ‰çš„å“åº”æ•°æ®éƒ½å·²æ­£ç¡®å‘é€ç»™å®¢æˆ·ç«¯æ—¶ã€‚é€šè¿‡æ£€æŸ¥è¿™ä¸ªå±æ€§ï¼Œå¼€å‘è€…å¯ä»¥å®æ–½é€‚å½“çš„åç»­æ­¥éª¤ï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—ã€æ¸…ç†èµ„æºç­‰æ“ä½œï¼Œä»è€Œå¢å¼ºåº”ç”¨çš„å¯é æ€§å’Œæ•ˆç‡ã€‚</p><h3 id="response-write-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#response-write-chunk-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsewritechunk-encoding-callback" target="_blank" rel="noopener noreferrer">response.write(chunk[, encoding][, callback])</a></span></a></h3><p>åœ¨è§£é‡Š <code>response.write(chunk[, encoding][, callback])</code> è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å®ƒæ‰€å¤„çš„ç¯å¢ƒâ€”â€”Node.jsã€‚Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®© JavaScript å¯ä»¥è„±ç¦»æµè§ˆå™¨è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šã€‚Node.js éå¸¸é€‚åˆå¼€å‘éœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥è€Œæ— éœ€å¤šçº¿ç¨‹ç¼–ç¨‹çš„ç½‘ç»œåº”ç”¨ï¼Œå¦‚ Web æœåŠ¡å™¨ã€‚</p><p>ç°åœ¨æ¥çœ‹ä½ æåˆ°çš„è¿™ä¸ªæ–¹æ³•ï¼Œ<code>response.write(chunk[, encoding][, callback])</code>æ˜¯ Node.js ä¸­ HTTP æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚HTTP æ¨¡å—å…è®¸ Node.js å¯ä»¥ä½œä¸ºæœåŠ¡å™¨æ¥æ”¶ HTTP è¯·æ±‚å¹¶ä¸”å‘é€ HTTP å“åº”ã€‚</p><h3 id="è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-1"><span>è§£é‡Š</span></a></h3><ul><li><p><strong><code>chunk</code></strong>ï¼šå¿…é¡»å‚æ•°ï¼Œè¡¨ç¤ºä½ æƒ³è¦å‘é€ç»™å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯ï¼‰çš„æ•°æ®å—ã€‚è¿™ä¸ªæ•°æ®å—å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª Bufferï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚å¦‚æœä½ å‘é€çš„æ˜¯ HTML é¡µé¢çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆ<code>chunk</code>å¯èƒ½å°±æ˜¯åŒ…å« HTML æ ‡ç­¾çš„å­—ç¬¦ä¸²ã€‚</p></li><li><p><strong><code>encoding</code></strong>ï¼šå¯é€‰å‚æ•°ï¼Œå½“<code>chunk</code>æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šå®ƒçš„ç¼–ç ï¼ˆæ¯”å¦‚<code>&#39;utf8&#39;</code>ï¼‰ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤å°±æ˜¯<code>&#39;utf8&#39;</code>ã€‚</p></li><li><p><strong><code>callback</code></strong>ï¼šå¯é€‰å‚æ•°ï¼Œå½“è¿™ä¸ªæ•°æ®å—è¢«å®Œå…¨å¤„ç†åï¼Œä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚å¯ä»¥ç”¨æ¥å¤„ç†é”™è¯¯æˆ–ç¡®è®¤å†™å…¥å®Œæˆã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ Web æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤Ÿå‘è®¿é—®è€…æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½® HTTP å¤´éƒ¨ï¼ŒçŠ¶æ€ç æ˜¯ 200ï¼Œå†…å®¹ç±»å‹æ˜¯ text/plain</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”å¤´â€œHello, World!â€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">First chunk is sent.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€ç¬¬äºŒéƒ¨åˆ†å“åº”ä½“ï¼Œâ€œWorld!â€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Second chunk is sent.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç»“æŸå“åº”è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:8000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š</p><ol><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå½“æœ‰ HTTP è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</li><li>ä½¿ç”¨<code>res.writeHead()</code>è®¾ç½®å“åº”çš„å¤´éƒ¨ä¿¡æ¯ã€‚</li><li>é€šè¿‡ä¸¤æ¬¡è°ƒç”¨<code>res.write()</code>æ–¹æ³•å‘é€å“åº”ä¸»ä½“çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼šâ€œHello, â€å’Œâ€œWorld!â€ã€‚</li><li>æ¯æ¬¡<code>res.write()</code>åï¼Œæˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»…ä¸ºç¤ºä¾‹å±•ç¤ºå…¶ç”¨æ³•ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰“å°æ¶ˆæ¯ã€‚</li><li>æœ€åï¼Œä½¿ç”¨<code>res.end()</code>ç»“æŸå“åº”ã€‚å¦‚æœæ²¡æœ‰æ›´å¤šçš„æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¿…é¡»è°ƒç”¨æ­¤æ–¹æ³•å‘Šè¯‰æœåŠ¡å™¨é‚£è¾¹å“åº”å·²ç»ç»“æŸã€‚</li></ol><p>è¿™æ ·ï¼Œå½“æœ‰äººé€šè¿‡æµè§ˆå™¨è®¿é—®<code>http://127.0.0.1:8000/</code>æ—¶ï¼Œä»–ä»¬å°†ä¼šçœ‹åˆ°â€œHello, World!â€è¿™æ¡æ¶ˆæ¯ï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸­çœ‹åˆ°æœ‰å…³æ•°æ®å—å‘é€çš„æ—¥å¿—ã€‚</p><h3 id="response-writecontinue" tabindex="-1"><a class="header-anchor" href="#response-writecontinue"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsewritecontinue" target="_blank" rel="noopener noreferrer">response.writeContinue()</a></span></a></h3><p>é¦–å…ˆï¼Œä¸ºäº†ç†è§£<code>response.writeContinue()</code>æ–¹æ³•åœ¨ Node.js v21.7.1 ä¸­çš„åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><h3 id="http-1-1-100-continue-çŠ¶æ€ç " tabindex="-1"><a class="header-anchor" href="#http-1-1-100-continue-çŠ¶æ€ç "><span>HTTP/1.1 100 Continue çŠ¶æ€ç </span></a></h3><p>åœ¨æ·±å…¥<code>response.writeContinue()</code>ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆè°ˆè°ˆ HTTP åè®®ä¸­çš„ä¸€ä¸ªç‰¹æ®ŠçŠ¶æ€ç ï¼š<code>100 Continue</code>ã€‚å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼ˆæ¯”å¦‚å¤§æ–‡ä»¶ä¸Šä¼ ï¼‰ä¹‹å‰ï¼Œå®ƒå¯èƒ½æƒ³çŸ¥é“æœåŠ¡å™¨æ˜¯å¦æ„¿æ„æ¥å—æ•°æ®ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨å‘é€å®é™…æ•°æ®ä¹‹å‰å‘é€ä¸€ä¸ªåŒ…å«<code>Expect: 100-continue</code>å¤´éƒ¨çš„è¯·æ±‚ã€‚å¦‚æœæœåŠ¡å™¨æ„¿æ„å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå®ƒä¼šå›å¤ä¸€ä¸ª<code>100 Continue</code>çŠ¶æ€ç ï¼Œä½œä¸ºä¸€ä¸ªä¿¡å·å‘Šè¯‰å®¢æˆ·ç«¯â€œè¯·ç»§ç»­å‘é€æ•°æ®â€ã€‚å¦‚æœæœåŠ¡å™¨å†³å®šä¸å¤„ç†è¯·æ±‚ï¼Œå®ƒå¯ä»¥ç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œé¿å…å®¢æˆ·ç«¯æ— è°“åœ°å‘é€å¤§é‡æ•°æ®ã€‚</p><h3 id="response-writecontinue-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#response-writecontinue-çš„ä½œç”¨"><span>response.writeContinue() çš„ä½œç”¨</span></a></h3><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>response.writeContinue()</code>æ–¹æ³•æ­£æ˜¯ç”¨äºå®ç°ä¸Šè¿°é€»è¾‘çš„ã€‚è°ƒç”¨æ­¤æ–¹æ³•ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª<code>100 Continue</code>çŠ¶æ€ç ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨å…è®¸ç”¨æˆ·ä¸Šä¼ å¤§å‹è§†é¢‘æ–‡ä»¶ã€‚åœ¨ç”¨æˆ·å¼€å§‹ä¸Šä¼ ä¹‹å‰ï¼Œä½ çš„æœåŠ¡å™¨å¯èƒ½éœ€è¦æ£€æŸ¥æŸäº›æ¡ä»¶ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„è®¤è¯çŠ¶æ€ã€æ–‡ä»¶å¤§å°é™åˆ¶ç­‰ï¼‰ï¼Œä»¥å†³å®šæ˜¯å¦æ¥å—æ–‡ä»¶ä¸Šä¼ ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥æ˜¯å¦æœ‰â€œExpect: 100-continueâ€å¤´éƒ¨</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">expect</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">100-continue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // è¿™é‡Œè¿›è¡Œä¸€äº›é¢„æ£€æŸ¥ï¼Œæ¯”å¦‚èº«ä»½éªŒè¯æˆ–å…¶ä»–é€»è¾‘</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> isAuthorized</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> true;</span><span style="color:#616E88;"> // å‡è®¾è¿™æ˜¯é€šè¿‡æŸç§æ–¹å¼è®¡ç®—å¾—å‡ºçš„</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> fileSizeLimit</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 5000000</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾é™åˆ¶æ–‡ä»¶å¤§å°ä¸º5MB</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> fileSize</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> parseInt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">content-length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä»è¯·æ±‚å¤´ä¸­è·å–æ–‡ä»¶å¤§å°</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">isAuthorized</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å¦‚æœç”¨æˆ·æœªæˆæƒï¼Œç›´æ¥è¿”å›401 Unauthorized</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">401</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Unauthorized</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">fileSize</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#D8DEE9;"> fileSizeLimit</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œè¿”å›413 Payload Too Large</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">413</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Payload Too Large</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // ç”¨æˆ·å·²æˆæƒä¸”æ–‡ä»¶å¤§å°åˆé€‚ï¼Œå‘é€100 ContinueçŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeContinue</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // æ¥ä¸‹æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å…¶ä»–è¯·æ±‚é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œå½“æ¥æ”¶åˆ°å¸¦æœ‰<code>Expect: 100-continue</code>å¤´éƒ¨çš„è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å…ˆæ‰§è¡Œä¸€äº›é¢„æ£€æŸ¥å·¥ä½œã€‚å¦‚æœç”¨æˆ·æœªæˆæƒæˆ–æ–‡ä»¶å¤ªå¤§ï¼Œåˆ™æœåŠ¡å™¨å°†ç«‹å³è¿”å›ç›¸åº”çš„é”™è¯¯å“åº”ï¼Œè€Œä¸æ˜¯å‘é€<code>100 Continue</code>å“åº”ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯åœ¨å‘é€å¤§æ–‡ä»¶ä¹‹å‰å°±èƒ½å¾—çŸ¥æ˜¯å¦ç»§ç»­æ“ä½œï¼Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼ŒæœåŠ¡å™¨é€šè¿‡è°ƒç”¨<code>response.writeContinue()</code>æ–¹æ³•å‘Šè¯‰å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘é€æ•°æ®ã€‚</p><h3 id="response-writeearlyhints-hints-callback" tabindex="-1"><a class="header-anchor" href="#response-writeearlyhints-hints-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsewriteearlyhintshints-callback" target="_blank" rel="noopener noreferrer">response.writeEarlyHints(hints[, callback])</a></span></a></h3><p>Node.js çš„<code>response.writeEarlyHints(hints[, callback])</code>æ–¹æ³•æ˜¯åœ¨ HTTP åè®®ä¸­ç”¨äºå‘é€æ—©æœŸæç¤ºï¼ˆEarly Hintsï¼‰ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦åŸºäº HTTP/2 å’Œåç»­ç‰ˆæœ¬ï¼Œå®ƒå…è®¸æœåŠ¡å™¨åœ¨æœ€ç»ˆå“åº”ä¹‹å‰é¢„å…ˆå‘é€ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚è¿™å¯ä»¥å¸®åŠ©æé«˜é¡µé¢çš„åŠ è½½é€Ÿåº¦ï¼Œå› ä¸ºæµè§ˆå™¨å¯ä»¥æ›´æ—©åœ°å¼€å§‹æŸäº›æ“ä½œï¼Œæ¯”å¦‚é¢„åŠ è½½èµ„æºã€‚</p><h3 id="ç†è§£-early-hints-103-çŠ¶æ€ç " tabindex="-1"><a class="header-anchor" href="#ç†è§£-early-hints-103-çŠ¶æ€ç "><span>ç†è§£ Early Hints (103 çŠ¶æ€ç )</span></a></h3><p>åœ¨æ·±å…¥äº†è§£<code>writeEarlyHints</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ Early Hints çš„æ¦‚å¿µã€‚HTTP çŠ¶æ€ç  103 (Early Hints) æ˜¯ä¸€ä¸ªä¸­é—´å“åº”ï¼Œæ„å‘³ç€æœåŠ¡å™¨è¿˜æ²¡æœ‰å®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œä½†å·²ç»æœ‰ä¸€äº›å¤´éƒ¨ä¿¡æ¯å¯ä»¥å‘é€ç»™å®¢æˆ·ç«¯äº†ã€‚è¿™äº›å¤´éƒ¨ä¿¡æ¯é€šå¸¸åŒ…æ‹¬é¢„è¿æ¥æˆ–é¢„åŠ è½½æŒ‡ä»¤ï¼Œå‘Šè¯‰æµè§ˆå™¨å¯ä»¥å¼€å§‹é¢„åŠ è½½æŒ‡å®šçš„èµ„æºï¼Œå¦‚ CSSã€JavaScript æ–‡ä»¶æˆ–è€…å›¾ç‰‡ç­‰ã€‚</p><h3 id="response-writeearlyhints-hints-callback-1" tabindex="-1"><a class="header-anchor" href="#response-writeearlyhints-hints-callback-1"><span><code>response.writeEarlyHints(hints[, callback])</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>response.writeEarlyHints(hints[, callback])</code>æ–¹æ³•æ­£æ˜¯ç”¨æ¥å‘é€è¿™ç§ç±»å‹çš„ä¿¡æ¯ã€‚å…¶ä¸­ï¼š</p><ul><li><code>hints</code> å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…å¤´éƒ¨å­—æ®µæ•°ç»„ï¼Œè¡¨ç¤ºè¦å‘é€çš„æ—©æœŸæç¤ºå¤´éƒ¨ã€‚</li><li><code>callback</code> æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œåœ¨æ‰€æœ‰çš„æç¤ºéƒ½è¢«å‘é€åæ‰§è¡Œã€‚</li></ul><h4 id="ä½¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¾‹å­"><span>ä½¿ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œé¡µé¢ä¸Šæœ‰å‡ ä¸ªé‡è¦çš„èµ„æºéœ€è¦å°½å¿«åŠ è½½ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§çš„ CSS æ–‡ä»¶å’Œä¸€ä¸ªå…³é”®çš„ JavaScript è„šæœ¬ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>writeEarlyHints</code>æ–¹æ³•æ¥é¢„å…ˆå‘ŠçŸ¥å®¢æˆ·ç«¯è¿™äº›èµ„æºï¼Œä»è€Œæå‰å¼€å§‹åŠ è½½å®ƒä»¬ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€ Early Hints</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeEarlyHints</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    Link</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">`&lt;`/style.css&gt;; rel=preload; as=style, `&lt;`/script.js&gt;; rel=preload; as=script</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹ŸæœåŠ¡å™¨å¤„ç†æ—¶é—´</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æœ€ç»ˆå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">`&lt;`html&gt;`&lt;`head&gt;`&lt;`/head&gt;`&lt;`body&gt;`&lt;`h1&gt;Hello World`&lt;`/h1&gt;`&lt;`/body&gt;`&lt;`/html&gt;</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨å…ˆé€šè¿‡<code>res.writeEarlyHints</code>å‘é€äº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ª<code>Link</code>å¤´éƒ¨çš„æ—©æœŸæç¤ºï¼Œè¿™äº›<code>Link</code>å¤´éƒ¨æŒ‡ç¤ºå®¢æˆ·ç«¯é¢„åŠ è½½<code>style.css</code>å’Œ<code>script.js</code>ã€‚ç„¶åï¼ŒæœåŠ¡å™¨æ¨¡æ‹Ÿä¸€äº›å¤„ç†æ—¶é—´åï¼Œå‘é€æœ€ç»ˆçš„å“åº”ã€‚</p><h3 id="æ€»ç»“-16" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-16"><span>æ€»ç»“</span></a></h3><p>ä½¿ç”¨<code>writeEarlyHints</code>æ–¹æ³•å¯ä»¥è®©ä½ çš„åº”ç”¨æ›´åŠ é«˜æ•ˆï¼Œé€šè¿‡é¢„å…ˆå‘é€å…³é”®èµ„æºçš„åŠ è½½æŒ‡ä»¤ï¼Œæ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚ä¸è¿‡ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåŠŸèƒ½ä¾èµ–äºå®¢æˆ·ç«¯å¯¹ HTTP/2 æˆ–æ›´é«˜ç‰ˆæœ¬çš„æ”¯æŒï¼Œä»¥åŠå¯¹ 103 Early Hints çŠ¶æ€ç çš„å¤„ç†èƒ½åŠ›ã€‚</p><h3 id="response-writehead-statuscode-statusmessage-headers" tabindex="-1"><a class="header-anchor" href="#response-writehead-statuscode-statusmessage-headers"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsewriteheadstatuscode-statusmessage-headers" target="_blank" rel="noopener noreferrer">response.writeHead(statusCode[, statusMessage][, headers])</a></span></a></h3><p>å½“æˆ‘ä»¬åœ¨ä½¿ç”¨ Node.js å¼€å‘ web åº”ç”¨æ—¶ï¼Œç»å¸¸éœ€è¦ä¸å®¢æˆ·ç«¯è¿›è¡Œ HTTP é€šä¿¡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦ç»™å®¢æˆ·ç«¯å‘é€ä¸€äº›å“åº”æ•°æ®ã€‚<code>response.writeHead()</code>æ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿè®¾ç½®å“åº”å¤´éƒ¨ä¿¡æ¯çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ Node.js HTTP æ¨¡å—ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><h3 id="å‚æ•°è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-1"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><p><code>statusCode</code>: è¿™æ˜¯ä¸€ä¸ªæ•°å­—å€¼ï¼Œè¡¨ç¤º HTTP å“åº”çš„çŠ¶æ€ç ã€‚ä¾‹å¦‚ï¼Œ200 ä»£è¡¨æˆåŠŸï¼Œ404 ä»£è¡¨æœªæ‰¾åˆ°ï¼Œ500 ä»£è¡¨æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ç­‰ã€‚</p></li><li><p><code>statusMessage</code> (å¯é€‰): è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œç”¨æ¥æè¿°çŠ¶æ€ç çš„å«ä¹‰ã€‚æ¯”å¦‚ï¼Œå¯¹äº 200ï¼ŒçŠ¶æ€æ¶ˆæ¯å¯ä»¥æ˜¯&quot;OK&quot;ã€‚</p></li><li><p><code>headers</code> (å¯é€‰): è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†è¦å‘é€çš„ HTTP å“åº”å¤´ã€‚ä½ å¯ä»¥è®¾ç½®è¯¸å¦‚&quot;Content-Type&quot;ã€&quot;Content-Length&quot;æˆ–å…¶ä»–ä»»ä½•æœ‰æ•ˆçš„ HTTP å¤´éƒ¨å­—æ®µã€‚</p></li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹-1"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å‘é€ç®€å•çš„å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å‘é€ç®€å•çš„å“åº”"><span>ç¤ºä¾‹ 1: å‘é€ç®€å•çš„å“åº”</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª web æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹ URL æ—¶ï¼Œä½ æƒ³å‘é€ä¸€ä¸ªç®€å•çš„æ¬¢è¿ä¿¡æ¯ã€‚ä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨<code>response.writeHead()</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to our website!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹ URL æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>res.writeHead(200, { &#39;Content-Type&#39;: &#39;text/plain&#39; })</code>è®¾ç½®äº†çŠ¶æ€ç ä¸º 200 å’Œå†…å®¹ç±»å‹ä¸ºçº¯æ–‡æœ¬ã€‚ç„¶åï¼Œé€šè¿‡<code>res.end(&#39;Welcome to our website!&#39;)</code>å‘é€å“åº”ä½“ã€‚</p><h4 id="ç¤ºä¾‹-2-è®¾ç½®é‡å®šå‘" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è®¾ç½®é‡å®šå‘"><span>ç¤ºä¾‹ 2: è®¾ç½®é‡å®šå‘</span></a></h4><p>æœ‰æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å°†è¯·æ±‚é‡å®šå‘åˆ°å¦ä¸€ä¸ª URLã€‚ä½ å¯ä»¥ä½¿ç”¨çŠ¶æ€ç  302ï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/old-page</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">302</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> Location</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://www.yoursite.com/new-page</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœç”¨æˆ·å°è¯•è®¿é—®<code>/old-page</code>ï¼Œä»–ä»¬ä¼šè¢«é‡å®šå‘åˆ°æ–°çš„ URL(<code>http://www.yoursite.com/new-page</code>)ã€‚è¿™æ˜¯é€šè¿‡è®¾ç½®çŠ¶æ€ç ä¸º 302 å’Œ<code>Location</code>å¤´æ¥å®Œæˆçš„ã€‚</p><h3 id="å°ç»“-4" tabindex="-1"><a class="header-anchor" href="#å°ç»“-4"><span>å°ç»“</span></a></h3><p><code>response.writeHead()</code>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–¹æ³•ï¼Œå…è®¸ä½ å¿«é€Ÿè®¾ç½® HTTP å“åº”çš„çŠ¶æ€ç ã€çŠ¶æ€æ¶ˆæ¯å’Œå¤´éƒ¨å­—æ®µã€‚æ— è®ºæ˜¯å‘é€æ™®é€šå“åº”ã€è®¾ç½®å†…å®¹ç±»å‹è¿˜æ˜¯æ‰§è¡Œé‡å®šå‘ç­‰æ“ä½œï¼Œå®ƒéƒ½æ˜¯å¤„ç† HTTP å“åº”æ—¶éå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ åº”è¯¥èƒ½æ›´å¥½åœ°ç†è§£å¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥æ§åˆ¶ä½ çš„ HTTP å“åº”äº†ã€‚</p><h3 id="response-writeprocessing" tabindex="-1"><a class="header-anchor" href="#response-writeprocessing"><span><a href="https://nodejs.org/docs/latest/api/http.html#responsewriteprocessing" target="_blank" rel="noopener noreferrer">response.writeProcessing()</a></span></a></h3><p>ç†è§£<code>response.writeProcessing()</code>çš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç™½ HTTP åè®®ä¸­å¼•å…¥çš„ä¸€ä¸ªæ¦‚å¿µâ€”â€”â€œ103 Early Hintsâ€çŠ¶æ€ç ã€‚</p><p>åœ¨ HTTP/2 å’Œæ›´æ–°çš„ç‰ˆæœ¬ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨æœ€ç»ˆå“åº”ä¹‹å‰å‘é€ä¸€ä¸ªæˆ–å¤šä¸ªâ€œ103 Early Hintsâ€å“åº”ã€‚è¿™ç§æ—©æœŸæç¤ºç›®çš„æ˜¯ä¸ºäº†è®©å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚æµè§ˆå™¨ï¼‰æå‰çŸ¥é“ä¸€äº›å³å°†éœ€è¦çš„èµ„æºï¼Œä»¥ä¾¿èƒ½å¤Ÿæ›´æ—©åœ°å¼€å§‹æŸäº›æ“ä½œï¼Œæ¯”å¦‚é¢„åŠ è½½èµ„æºã€‚è¿™æ ·åšå¯ä»¥æ˜¾è‘—æé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦ï¼Œå› ä¸ºæµè§ˆå™¨ä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨å‘é€ HTML æ–‡æ¡£åæ‰å¼€å§‹ä¸‹è½½ CSSã€JavaScript æ–‡ä»¶æˆ–å›¾ç‰‡ã€‚</p><p>ç°åœ¨ï¼Œæ¥å…·ä½“çœ‹çœ‹<code>response.writeProcessing()</code>ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ Node.js åœ¨å…¶<code>http</code>æ¨¡å—ä¸­æä¾›çš„ï¼Œç”¨äºå‘é€â€œ103 Early Hintsâ€å“åº”ç»™å®¢æˆ·ç«¯ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„ Node.js æœåŠ¡å™¨å†³å®šå‘é€ä¸€äº›æ—©æœŸçš„å¤´ä¿¡æ¯æç¤ºç»™å®¢æˆ·ç«¯æ—¶ï¼Œä½ å°±ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="ä½¿ç”¨æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ–¹æ³•"><span>ä½¿ç”¨æ–¹æ³•</span></a></h3><p>åœ¨ Node.js çš„æœåŠ¡å™¨ä»£ç ä¸­ï¼Œå½“ä½ æƒ³è¦å‘é€â€œ103 Early Hintsâ€å“åº”æ—¶ï¼Œå¯ä»¥è°ƒç”¨<code>response.writeProcessing()</code>ã€‚é€šå¸¸ï¼Œå®ƒä¼šåœ¨å‘é€æœ€ç»ˆå“åº”ä¹‹å‰è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥é€šçŸ¥å®¢æˆ·ç«¯é¢„åŠ è½½æŸäº›èµ„æºã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-20" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-20"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-é¢„åŠ è½½èµ„æº" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-é¢„åŠ è½½èµ„æº"><span>ä¾‹å­ 1ï¼šé¢„åŠ è½½èµ„æº</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µéœ€è¦åŠ è½½å¤šä¸ª CSS å’Œ JavaScript æ–‡ä»¶ã€‚ä¸ºäº†æé«˜é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œä½ å¸Œæœ›æµè§ˆå™¨å°½æ—©çŸ¥é“è¿™äº›èµ„æºï¼Œä»¥ä¾¿å¹¶è¡Œä¸‹è½½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€103 Early Hintså“åº”</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writeProcessing</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeProcessing</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">Link</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">`&lt;`/style.css&gt;; rel=preload; as=style, `&lt;`/script.js&gt;; rel=preload; as=script</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡†å¤‡å‘é€ä¸»ä½“å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &#39;</span><span style="color:#A3BE8C;">`&lt;`html&gt;`&lt;`head&gt;`&lt;`link rel=&quot;stylesheet&quot; href=&quot;/style.css&quot;/&gt;`&lt;`script src=&quot;/script.js&quot;&gt;`&lt;`/script&gt;`&lt;`/head&gt;`&lt;`body&gt;Hello World`&lt;`/body&gt;`&lt;`/html&gt;</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨é¦–å…ˆæ£€æŸ¥<code>res.writeProcessing</code>æ˜¯å¦å­˜åœ¨ï¼ˆç¡®ä¿å‘åå…¼å®¹ï¼‰ã€‚å¦‚æœå­˜åœ¨ï¼Œå®ƒä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶é€šè¿‡<code>setHeader</code>è®¾ç½®<code>Link</code>å¤´éƒ¨ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯é¢„åŠ è½½<code>style.css</code>å’Œ<code>script.js</code>ã€‚ä¹‹åï¼Œå®ƒç»§ç»­å‘é€æœ€ç»ˆçš„ HTML å“åº”ã€‚</p><h4 id="ä¾‹å­-2-ä¼˜åŒ–-api-å“åº”" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä¼˜åŒ–-api-å“åº”"><span>ä¾‹å­ 2ï¼šä¼˜åŒ– API å“åº”</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª APIï¼Œè¿™ä¸ª API å°†è¿”å›ä¸€ç»„æ•°æ®ï¼Œè€Œè·å–è¿™äº›æ•°æ®éœ€è¦ä¸€äº›æ—¶é—´ã€‚åœ¨æ­¤æœŸé—´ï¼Œä½ å¯èƒ½æƒ³å‘Šè¯‰å®¢æˆ·ç«¯å»é¢„åŠ è½½ä¸€äº›å¯èƒ½ä¼šç”¨åˆ°çš„å…¶ä»–èµ„æºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¼‚æ­¥æ“ä½œè·å–æ•°æ®</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨è·å–æ•°æ®çš„åŒæ—¶ï¼Œå‘é€103 Early Hintså“åº”</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writeProcessing</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeProcessing</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Link</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">`&lt;`https://example.com/other-api&gt;; rel=preload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è·å–æ•°æ®åå‘é€ä¸»ä½“å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Here is your data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨<code>setTimeout</code>æ¨¡æ‹Ÿæ•°æ®è·å–è¿‡ç¨‹ã€‚åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå®ƒå‘é€â€œ103 Early Hintsâ€å“åº”ï¼Œå»ºè®®å®¢æˆ·ç«¯é¢„åŠ è½½å¦ä¸€ä¸ª APIã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·çš„åº”ç”¨ç­‰å¾…å½“å‰ API å“åº”æ—¶ï¼Œå®ƒå¯ä»¥åŒæ—¶å¼€å§‹ä¸å¦ä¸€ä¸ª API äº¤äº’ï¼Œä»è€ŒèŠ‚çœæ—¶é—´ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>response.writeProcessing()</code>å…è®¸ Node.js æœåŠ¡å™¨ä¼˜åŒ–å®¢æˆ·ç«¯çš„åŠ è½½æ€§èƒ½ï¼Œé€šè¿‡æå‰å‘é€èµ„æºé“¾æ¥ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿæ›´å¿«åœ°å¼€å§‹é‡è¦èµ„æºçš„ä¸‹è½½è¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•å°¤å…¶é€‚ç”¨äºéœ€è¦é¢„åŠ è½½èµ„æºæˆ–è€…åœ¨ç­‰å¾…æœåŠ¡å™¨å¤„ç†è¿‡ç¨‹ä¸­ä¼˜åŒ–ç”¨æˆ·ä½“éªŒçš„åœºæ™¯ã€‚</p><h2 id="class-http-incomingmessage" tabindex="-1"><a class="header-anchor" href="#class-http-incomingmessage"><span><a href="https://nodejs.org/docs/latest/api/http.html#class-httpincomingmessage" target="_blank" rel="noopener noreferrer">Class: http.IncomingMessage</a></span></a></h2><p>å½“ä½ åœ¨å­¦ä¹  Node.jsï¼Œå°¤å…¶æ˜¯ Web å¼€å‘æ–¹é¢æ—¶ï¼Œä¼šé‡åˆ°<code>http.IncomingMessage</code>è¿™ä¸ªæ¦‚å¿µã€‚è¿™æ˜¯ Node.js ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç±»ï¼Œä¸»è¦ä¸ HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯·æ±‚ç›¸å…³ã€‚ä¸ºäº†ä½¿ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘å°†ä»¥é€šä¿—æ˜“æ‡‚çš„æ–¹å¼ï¼Œç»“åˆå®é™…ä¾‹å­æ¥è§£é‡Šå®ƒã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-6" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-6"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œ<code>http.IncomingMessage</code>æ˜¯ Node.js http æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»£è¡¨ä¸€ä¸ª<strong>è¿›æ¥çš„æ¶ˆæ¯</strong>ï¼Œåœ¨æœåŠ¡å™¨ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™é€šå¸¸æ„å‘³ç€ä¸€ä¸ª HTTP è¯·æ±‚ã€‚ç®€å•æ¥è¯´ï¼Œå½“æœ‰äººï¼ˆæˆ–å…¶ä»–ç³»ç»Ÿï¼‰å‘ä½ çš„ Node.js æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼ˆæ¯”å¦‚é€šè¿‡æµè§ˆå™¨è®¿é—®ä½ çš„ç½‘ç«™ï¼‰ï¼ŒNode.js ä¼šåˆ›å»ºä¸€ä¸ª<code>http.IncomingMessage</code>çš„å®ä¾‹æ¥è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚ã€‚</p><h3 id="å…³é”®ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#å…³é”®ç‰¹æ€§"><span>å…³é”®ç‰¹æ€§</span></a></h3><ul><li><p><strong>æ•°æ®æµ</strong>ï¼š<code>http.IncomingMessage</code>æ˜¯ä¸€ä¸ªå¯è¯»æµã€‚è¿™æ„å‘³ç€è¯·æ±‚çš„æ•°æ®ï¼ˆä¾‹å¦‚ POST è¯·æ±‚ä¸­çš„è¡¨å•æ•°æ®ï¼‰æ˜¯é€æ­¥æ¥æ”¶çš„ï¼Œä½ å¯ä»¥ç›‘å¬ä¸åŒçš„äº‹ä»¶æ¥å¤„ç†è¿™äº›æ•°æ®ï¼Œæ¯”å¦‚<code>data</code>äº‹ä»¶ç”¨äºæ¥æ”¶æ•°æ®ç‰‡æ®µï¼Œ<code>end</code>äº‹ä»¶è¡¨ç¤ºæ‰€æœ‰æ•°æ®å·²æ¥æ”¶å®Œæ¯•ã€‚</p></li><li><p><strong>è¯·æ±‚ç»†èŠ‚</strong>ï¼šå®ƒåŒ…å«äº†è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚å¤´ï¼ˆheadersï¼‰ã€è¯·æ±‚æ–¹æ³•ï¼ˆGET, POST ç­‰ï¼‰ã€URL ç­‰ã€‚</p></li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-7"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºç®€å•çš„-web-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºç®€å•çš„-web-æœåŠ¡å™¨"><span>1. åˆ›å»ºç®€å•çš„ Web æœåŠ¡å™¨</span></a></h4><p>è€ƒè™‘æœ€ç®€å•çš„ä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤Ÿè¯»å–å¹¶å“åº”æ¯ä¸ª HTTP è¯·æ±‚çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è¿™é‡Œçš„reqå°±æ˜¯ä¸€ä¸ªhttp.IncomingMessageå®ä¾‹</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚æ–¹æ³•: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°è¯·æ±‚æ–¹æ³•</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚URL: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°è¯·æ±‚çš„URL</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚å¤´:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°è¯·æ±‚å¤´</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‘é€ä¸€ä¸ªç®€å•çš„å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>http</code>æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨ã€‚å¯¹äºæ¯ä¸ªä¼ å…¥çš„è¯·æ±‚ï¼ˆå³<code>req</code>å¯¹è±¡ï¼Œä¸€ä¸ª<code>http.IncomingMessage</code>å®ä¾‹ï¼‰ï¼Œæˆ‘ä»¬æ‰“å°å‡ºè¯·æ±‚çš„æ–¹æ³•ã€URL å’Œå¤´éƒ¨ï¼Œç„¶åå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç®€å•çš„&quot;Hello, World!&quot;å“åº”ã€‚</p><h4 id="_2-å¤„ç†-post-è¯·æ±‚æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2-å¤„ç†-post-è¯·æ±‚æ•°æ®"><span>2. å¤„ç† POST è¯·æ±‚æ•°æ®</span></a></h4><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªæ¥æ”¶è¡¨å•æäº¤æ•°æ®çš„æœåŠ¡å™¨ã€‚ç”±äº<code>http.IncomingMessage</code>æ˜¯ä¸€ä¸ªå¯è¯»æµï¼Œä½ å¯ä»¥é€šè¿‡ç›‘å¬<code>data</code>å’Œ<code>end</code>äº‹ä»¶æ¥æ”¶é›†å’Œå¤„ç†è¿™äº›æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> StringDecoder</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">string_decoder</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">StringDecoder</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">      let</span><span style="color:#D8DEE9;"> body</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      const</span><span style="color:#D8DEE9;"> decoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> StringDecoder</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf-8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // æ•°æ®æ­£åœ¨æ¥æ”¶</span></span>
<span class="line"><span style="color:#D8DEE9;">      req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        body</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> decoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">      req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        body</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> decoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ¥æ”¶åˆ°çš„æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">body</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ•°æ®æ¥æ”¶æˆåŠŸ</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // å¯¹äºéPOSTè¯·æ±‚ç®€å•è¿”å›ä¸€ä¸ªæç¤º</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·å‘é€POSTè¯·æ±‚</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¯·æ±‚ç±»å‹æ˜¯ POSTï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨æ¥ç›‘å¬<code>data</code>äº‹ä»¶ï¼Œæ¯æ¬¡äº‹ä»¶è§¦å‘æ—¶ï¼Œæˆ‘ä»¬æ”¶åˆ°è¯·æ±‚ä½“çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¹¶å°†å…¶ç´¯åŠ ã€‚å½“æ¥æ”¶æ‰€æœ‰æ•°æ®åï¼Œ<code>end</code>äº‹ä»¶è§¦å‘ï¼Œæˆ‘ä»¬åˆ™å®Œæˆæ•°æ®çš„æ¥æ”¶ä¸å¤„ç†ã€‚</p><p>é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>http.IncomingMessage</code>åœ¨æ„å»º HTTP æœåŠ¡å™¨æ—¶æ‰®æ¼”çš„è§’è‰²ã€‚å®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¤„ç†å…¥ç«™ HTTP è¯·æ±‚çš„å¼ºå¤§æ¥å£ï¼Œä½¿å¾—è¯»å–è¯·æ±‚æ•°æ®ã€è§£æè¯·æ±‚å¤´å’Œå…¶ä»–ä»»åŠ¡å˜å¾—ç®€å•ä¸”ç›´è§‚ã€‚</p><h3 id="event-aborted" tabindex="-1"><a class="header-anchor" href="#event-aborted"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-aborted" target="_blank" rel="noopener noreferrer">Event: &#39;aborted&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js ä¸­æœ‰å¾ˆå¤šå†…å»ºçš„æ¨¡å—ï¼Œ<code>http</code> æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿå¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚</p><p>åœ¨ <code>http</code> æ¨¡å—ä¸­ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å¹¶ç›‘å¬ HTTP è¯·æ±‚æ—¶ï¼Œä¼šé‡åˆ°å„ç§äº‹ä»¶ã€‚å…¶ä¸­ï¼Œâ€œabortedâ€äº‹ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å°±æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹å®ƒã€‚</p><h3 id="event-aborted-1" tabindex="-1"><a class="header-anchor" href="#event-aborted-1"><span>Event: &#39;aborted&#39;</span></a></h3><p>â€œabortedâ€äº‹ä»¶åœ¨ HTTP è¯·æ±‚è¢«è¯·æ±‚æ–¹ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨æˆ–è€…å®¢æˆ·ç«¯ï¼‰ä¸­æ­¢ä¹‹åè§¦å‘ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨è¯·æ±‚å®Œæˆä¹‹å‰æ–­å¼€è¿æ¥ï¼Œé‚£ä¹ˆå°†ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚</p><p>è¿™ä¸ªäº‹ä»¶çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>è®°å½•åˆ†æï¼šè·Ÿè¸ªè¯·æ±‚è¢«ä¸­æ­¢çš„æƒ…å†µï¼Œå¸®åŠ©å¼€å‘äººå‘˜è¯Šæ–­é—®é¢˜ã€‚</li><li>æ¸…ç†èµ„æºï¼šå¦‚æœä½ åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­åˆ†é…äº†ä¸€äº›ä¸´æ—¶èµ„æºï¼ˆæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ ï¼‰ï¼Œå¯ä»¥åœ¨è¿™ä¸ªäº‹ä»¶ä¸­è¿›è¡Œæ¸…ç†ã€‚</li><li>ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼šäº†è§£ç”¨æˆ·å–æ¶ˆè¯·æ±‚çš„è¡Œä¸ºï¼Œå¯èƒ½å¸®åŠ©æ”¹å–„ç”¨æˆ·ä½“éªŒæˆ–è€…æ€§èƒ½ä¼˜åŒ–ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-13"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼ ã€‚å¦‚æœç”¨æˆ·åœ¨ä¸Šä¼ è¿‡ç¨‹ä¸­å–æ¶ˆäº†æ“ä½œï¼Œä½ å¯èƒ½æƒ³çŸ¥é“è¿™ä¸€è¡Œä¸ºï¼Œå¹¶åŠæ—¶é‡Šæ”¾æ‰å·²ç»åˆ†é…çš„èµ„æºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›é€»è¾‘æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aborted</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç”¨æˆ·å–æ¶ˆäº†è¯·æ±‚ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // åœ¨è¿™é‡Œæ‰§è¡Œæ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚åˆ é™¤éƒ¨åˆ†ä¸Šä¼ çš„æ–‡ä»¶</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–‡ä»¶ä¸Šä¼ æˆåŠŸ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 3000 ç«¯å£ã€‚å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬ <code>aborted</code> äº‹ä»¶æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨è¿‡ç¨‹ä¸­å–æ¶ˆäº†è¯·æ±‚ã€‚å¦‚æœäº‹ä»¶è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚åˆ é™¤å·²ç»ä¸Šä¼ çš„æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œé˜²æ­¢æœåŠ¡å™¨ä¸Šç•™ä¸‹æ— ç”¨çš„æ•°æ®ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½¿ç”¨ <code>aborted</code> äº‹ä»¶å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†èµ„æºå’Œæå‡åº”ç”¨çš„å¥å£®æ€§ã€‚</p><h3 id="event-close-4" tabindex="-1"><a class="header-anchor" href="#event-close-4"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-close_3" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h3><p>Node.js ä¸­çš„ &#39;close&#39; äº‹ä»¶é€šå¸¸ä¸å„ç§ç±»å‹çš„æµï¼ˆStreamsï¼‰æˆ–æœåŠ¡å™¨å¯¹è±¡ï¼ˆå¦‚ HTTP æœåŠ¡å™¨ï¼‰ç›¸å…³è”ã€‚å½“ &#39;close&#39; äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ„å‘³ç€æŸä¸ªèµ„æºï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘ç»œè¿æ¥ã€æ–‡ä»¶æµç­‰å·²ç»ä¸å†å¼€æ”¾æˆ–å¯ç”¨äº†ï¼Œå·²ç»å®Œå…¨å…³é—­ï¼Œå¹¶ä¸”æ²¡æœ‰æ•°æ®å†è¢«å‘é€æˆ–æ¥æ”¶ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>http.Server</code> ç±»ä¸­çš„ &#39;close&#39; äº‹ä»¶ç‰¹æŒ‡å½“ HTTP æœåŠ¡å™¨å®Œå…¨å…³é—­æ—¶è§¦å‘çš„äº‹ä»¶ã€‚è¿™é‡Œçš„â€œå®Œå…¨å…³é—­â€æ„å‘³ç€æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥å‡å·²ç»“æŸï¼Œä¸”æœåŠ¡å™¨ä¸å†æ¥å—æ–°çš„è¿æ¥ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨å®é™…ç¼–ç¨‹ä¸­è¿™ä¸ª &#39;close&#39; äº‹ä»¶å¯èƒ½å¦‚ä½•åº”ç”¨ï¼š</p><h3 id="å®ä¾‹-åˆ›å»º-http-æœåŠ¡å™¨å¹¶ç›‘å¬-close-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-åˆ›å»º-http-æœåŠ¡å™¨å¹¶ç›‘å¬-close-äº‹ä»¶"><span>å®ä¾‹ï¼šåˆ›å»º HTTP æœåŠ¡å™¨å¹¶ç›‘å¬ &#39;close&#39; äº‹ä»¶</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®ä¸€ä¸ªæ¡ä»¶ä½¿å¾—æœåŠ¡å™¨åœ¨10ç§’åå…³é—­</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server has been closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;close&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The server is no longer accepting connections!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>http</code> æ¨¡å—ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒå¯¹æ‰€æœ‰è¯·æ±‚è¿”å› &quot;Hello World&quot; æ–‡æœ¬ã€‚æœåŠ¡å™¨è¢«è®¾ç½®ä¸ºç›‘å¬ 3000 ç«¯å£ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>setTimeout</code> å‡½æ•°åœ¨ 10 ç§’åè°ƒç”¨ <code>server.close()</code> æ–¹æ³•æ¥å…³é—­æœåŠ¡å™¨ï¼Œè¿™æ˜¯æ¨¡æ‹ŸæŸç§æ¡ä»¶æ»¡è¶³åæœåŠ¡å™¨éœ€è¦å…³é—­çš„æƒ…å†µã€‚</p><p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡ <code>server.on(&#39;close&#39;, callback)</code> ç›‘å¬ &#39;close&#39; äº‹ä»¶ï¼Œå¹¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å½“æœåŠ¡å™¨å…³é—­æ—¶ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œæ‰“å°å‡º &quot;The server is no longer accepting connections!&quot;ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥åœ¨æœåŠ¡å™¨å…³é—­æ—¶æ‰§è¡Œæ¸…ç†æ“ä½œæˆ–æ—¥å¿—è®°å½•ã€‚</p><h3 id="å®ä¾‹-ç¨‹åºé€€å‡ºå‰å…³é—­æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-ç¨‹åºé€€å‡ºå‰å…³é—­æœåŠ¡å™¨"><span>å®ä¾‹ï¼šç¨‹åºé€€å‡ºå‰å…³é—­æœåŠ¡å™¨</span></a></h3><p>åœ¨ç°å®çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›ç¡®ä¿å½“ä½ çš„ Node.js ç¨‹åºè¢«ç»ˆæ­¢æ—¶ï¼ˆæ¯”å¦‚é€šè¿‡ Ctrl + Cï¼‰ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿä¼˜é›…åœ°å…³é—­ã€‚ä½ å¯ä»¥ä¾¦å¬è¿›ç¨‹çš„ &#39;SIGINT&#39; ä¿¡å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SIGINT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received SIGINT. Shutting down the server...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server shut down after receiving SIGINT.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬äº† Node.js è¿›ç¨‹ä¸Šçš„ &#39;SIGINT&#39; äº‹ä»¶ï¼Œè¿™é€šå¸¸æ˜¯ç”±ç”¨æˆ·æ‰‹åŠ¨ç»ˆæ­¢ç¨‹åºæ—¶äº§ç”Ÿçš„ï¼ˆä¾‹å¦‚ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æŒ‰ä¸‹ Ctrl + Cï¼‰ã€‚ä¸€æ—¦æ•è·åˆ° &#39;SIGINT&#39; ä¿¡å·ï¼Œæˆ‘ä»¬å°±å°è¯•å…³é—­æœåŠ¡å™¨ï¼Œå¹¶åœ¨æœåŠ¡å™¨æˆåŠŸå…³é—­åæ‰“å°å‡ºæç¤ºä¿¡æ¯ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æœåŠ¡å™¨åœ¨åœæ­¢ä¹‹å‰æœ‰æœºä¼šå…³é—­æ‰€æœ‰æ´»åŠ¨è¿æ¥ï¼Œä»è€Œé¿å…ä»»ä½•æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚çªç„¶ä¸­æ–­ã€‚</p><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° &#39;close&#39; äº‹ä»¶æ˜¯å¦‚ä½•ç”¨äºç®¡ç† Node.js ä¸­çš„æœåŠ¡å™¨å…³é—­è¿‡ç¨‹çš„ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ç›‘å¬è¯¥äº‹ä»¶æ¥æ‰§è¡Œæ¸…ç†å·¥ä½œå’Œå…¶ä»–å¿…è¦çš„ç»ˆç»“æ­¥éª¤ã€‚</p><h3 id="message-aborted" tabindex="-1"><a class="header-anchor" href="#message-aborted"><span><a href="https://nodejs.org/docs/latest/api/http.html#messageaborted" target="_blank" rel="noopener noreferrer">message.aborted</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>message.aborted</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºäº†è§£ HTTP è¯·æ±‚æˆ–å“åº”æ˜¯å¦å·²ç»è¢«ä¸­æ­¢ã€‚ç®€å•æ¥è¯´ï¼Œå½“æˆ‘ä»¬è°ˆè®º HTTP é€šä¿¡ï¼Œå®ƒæ¶‰åŠåˆ°å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨æˆ–è€…å…¶ä»–åº”ç”¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚è¿™ä¸ªä¿¡æ¯äº¤æ¢è¿‡ç¨‹ä¸­ï¼Œè¦ä¹ˆå®¢æˆ·ç«¯å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨å¹¶ç­‰å¾…å“åº”ï¼Œè¦ä¹ˆæœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ˆå“åº”ï¼‰ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºå„ç§åŸå› ï¼ˆå¦‚ç½‘ç»œé—®é¢˜ã€å®¢æˆ·ç«¯å–æ¶ˆè¯·æ±‚ç­‰ï¼‰å¯¼è‡´è¿™ä¸ªæ­£åœ¨è¿›è¡Œçš„é€šä¿¡è¢«ä¸­æ–­æˆ–å–æ¶ˆã€‚è¿™æ—¶å€™ï¼Œ<code>message.aborted</code> è¿™ä¸ªå±æ€§å°±æ˜¾å¾—éå¸¸æœ‰ç”¨äº†ã€‚</p><p><code>message.aborted</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆ<code>true</code> æˆ– <code>false</code>ï¼‰ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ç›¸å…³çš„ HTTP æ¶ˆæ¯ï¼ˆæ— è®ºæ˜¯è¯·æ±‚è¿˜æ˜¯å“åº”ï¼‰æ˜¯å¦è¢«ä¸­æ­¢äº†ã€‚å¦‚æœè¢«ä¸­æ­¢ï¼Œå®ƒä¼šè¢«è®¾ç½®ä¸º <code>true</code>ï¼›å¦åˆ™ï¼Œå®ƒä¿æŒä¸º <code>false</code>ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-17"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-æ£€æŸ¥è¯·æ±‚æ˜¯å¦è¢«å®¢æˆ·ç«¯ä¸­æ­¢" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ£€æŸ¥è¯·æ±‚æ˜¯å¦è¢«å®¢æˆ·ç«¯ä¸­æ­¢"><span>ä¾‹å­ 1ï¼šæ£€æŸ¥è¯·æ±‚æ˜¯å¦è¢«å®¢æˆ·ç«¯ä¸­æ­¢</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨éœ€è¦å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§æ–‡ä»¶ä¸Šä¼ ã€‚å½“å®¢æˆ·ç«¯å¼€å§‹ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå®ƒä»¬å¯èƒ½ç”±äºç½‘ç»œä¸ç¨³å®šæˆ–ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆä¸Šä¼ è€Œä¸­æ–­ä¸Šä¼ è¿‡ç¨‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº†è§£ä¸Šä¼ æ˜¯å¦è¢«ä¸­æ­¢å¯ä»¥å¸®åŠ©æœåŠ¡å™¨ä½œå‡ºç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºæˆ–è®°å½•æ—¥å¿—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è¯·æ±‚æ­£å¸¸ç»“æŸ</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">aborted</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–‡ä»¶ä¸Šä¼ æˆåŠŸ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è¯·æ±‚è¢«ä¸­æ­¢</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">aborted</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸Šä¼ è¢«å–æ¶ˆæˆ–ç½‘ç»œä¸­æ–­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-é˜²æ­¢å¯¹å·²ä¸­æ­¢çš„è¯·æ±‚å‘é€å“åº”" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-é˜²æ­¢å¯¹å·²ä¸­æ­¢çš„è¯·æ±‚å‘é€å“åº”"><span>ä¾‹å­ 2ï¼šé˜²æ­¢å¯¹å·²ä¸­æ­¢çš„è¯·æ±‚å‘é€å“åº”</span></a></h4><p>å¦‚æœå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªè¯·æ±‚åä¸­é€”å–æ¶ˆäº†ï¼ŒæœåŠ¡å™¨ä»ç„¶å°è¯•å‘é€å“åº”å¯èƒ½ä¼šå¼•èµ·é”™è¯¯ï¼Œå› ä¸ºè¿æ¥å¯èƒ½å·²ç»å…³é—­äº†ã€‚é€šè¿‡æ£€æŸ¥ <code>message.aborted</code> å±æ€§ï¼ŒæœåŠ¡å™¨å¯ä»¥é¿å…è¿™ç§å°è¯•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹ŸæœåŠ¡å™¨å¤„ç†å»¶æ—¶</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">aborted</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿™æ˜¯å“åº”å†…å®¹</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // è¯·æ±‚å·²è¢«ä¸­æ­¢ï¼Œé¿å…å‘é€å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å°è¯•å“åº”ä¸€ä¸ªå·²ä¸­æ­¢çš„è¯·æ±‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å»¶è¿Ÿ1ç§’æ¨¡æ‹Ÿå¤„ç†æ—¶é—´</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>message.aborted</code> åœ¨å®è·µä¸­æ˜¯å¦‚ä½•å¸®åŠ©ç®¡ç†å’Œæ§åˆ¶ HTTP é€šä¿¡æµç¨‹çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚æˆ–éœ€è¦é«˜åº¦å¯é æ€§çš„åº”ç”¨åœºæ™¯ä¸­ã€‚</p><h3 id="message-complete" tabindex="-1"><a class="header-anchor" href="#message-complete"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagecomplete" target="_blank" rel="noopener noreferrer">message.complete</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>http.IncomingMessage</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªæ­£åœ¨å¤„ç†çš„ HTTP è¯·æ±‚ï¼ˆå¦‚æœæ˜¯æœåŠ¡å™¨ç«¯ï¼‰æˆ–è€… HTTP å“åº”ï¼ˆå¦‚æœæ˜¯å®¢æˆ·ç«¯ï¼‰ã€‚<code>message.complete</code>å±æ€§æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå®ƒä¼šå‘Šè¯‰ä½ è¿™ä¸ªæ¶ˆæ¯ä½“æ˜¯å¦å·²ç»è¢«å®Œå…¨æ¥æ”¶ã€‚</p><p>å½“ä½ å¤„ç† HTTP è¯·æ±‚æˆ–å“åº”æ—¶ï¼Œæ•°æ®å¯èƒ½æ˜¯åˆ†å—ä¼ è¾“çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªå†…å®¹ä¸ä¼šä¸€æ¬¡æ€§å…¨éƒ¨å‘é€è¿‡æ¥ï¼Œè€Œæ˜¯åˆ†å‡ éƒ¨åˆ†é€æ¸å‘é€ã€‚åœ¨ Node.js ä¸­ï¼Œä½ é€šå¸¸ä¼šç›‘å¬<code>data</code>äº‹ä»¶æ¥æ¥æ”¶è¿™äº›æ•°æ®å—ï¼Œå¹¶åœ¨æœ€åç›‘å¬<code>end</code>äº‹ä»¶æ¥è¡¨ç¤ºæ¶ˆæ¯ç»“æŸã€‚</p><p>å¦‚æœ<code>message.complete</code>å€¼ä¸º<code>true</code>ï¼Œè¿™è¡¨ç¤ºæ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»è¢«æˆåŠŸæ¥æ”¶äº†ï¼Œè€Œä¸”æ²¡æœ‰æ›´å¤šçš„æ•°æ®ä¼šå†å‘é€è¿‡æ¥ã€‚å¦‚æœå€¼ä¸º<code>false</code>ï¼Œåˆ™è¡¨ç¤ºè¿˜æœ‰æ•°æ®åœ¨è·¯ä¸Šï¼Œæˆ–è€…è¿æ¥è¢«ä¸­æ–­äº†ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­æ¥è§£é‡Šï¼š</p><h3 id="_1-åœ¨åˆ›å»º-http-æœåŠ¡å™¨æ—¶æ£€æŸ¥è¯·æ±‚æ¶ˆæ¯æ˜¯å¦å®Œæ•´" tabindex="-1"><a class="header-anchor" href="#_1-åœ¨åˆ›å»º-http-æœåŠ¡å™¨æ—¶æ£€æŸ¥è¯·æ±‚æ¶ˆæ¯æ˜¯å¦å®Œæ•´"><span>1. åœ¨åˆ›å»º HTTP æœåŠ¡å™¨æ—¶æ£€æŸ¥è¯·æ±‚æ¶ˆæ¯æ˜¯å¦å®Œæ•´</span></a></h3><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒæ¥æ”¶ä¸Šä¼ çš„æ–‡ä»¶ã€‚ä½ éœ€è¦ç¡®ä¿åœ¨å¼€å§‹å¤„ç†æ–‡ä»¶ä¹‹å‰ï¼Œæ•´ä¸ªæ–‡ä»¶éƒ½å·²ç»è¢«ä¸Šä¼ å®Œæ¯•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">complete</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚å·²å®Œæ•´æ¥æ”¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // è¿›è¡Œæ–‡ä»¶å¤„ç†...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚æœªå®Œæ•´æ¥æ”¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 400</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: è¯·æ±‚æœªå®Œæ•´æ¥æ”¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬<code>end</code>äº‹ä»¶æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦å·²ç»ç»“æŸã€‚ç„¶åæ£€æŸ¥<code>req.complete</code>å±æ€§ï¼Œå¦‚æœä¸º<code>true</code>è¡¨ç¤ºè¯·æ±‚æ¶ˆæ¯å®Œæ•´ï¼Œå¯ä»¥å®‰å…¨åœ°è¿›è¡Œæ–‡ä»¶å¤„ç†ï¼›å¦‚æœä¸º<code>false</code>ï¼Œåˆ™å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯æ¶ˆæ¯ã€‚</p><h3 id="_2-åœ¨ä½¿ç”¨-http-å®¢æˆ·ç«¯æ—¶æ£€æŸ¥å“åº”æ¶ˆæ¯æ˜¯å¦å®Œæ•´" tabindex="-1"><a class="header-anchor" href="#_2-åœ¨ä½¿ç”¨-http-å®¢æˆ·ç«¯æ—¶æ£€æŸ¥å“åº”æ¶ˆæ¯æ˜¯å¦å®Œæ•´"><span>2. åœ¨ä½¿ç”¨ HTTP å®¢æˆ·ç«¯æ—¶æ£€æŸ¥å“åº”æ¶ˆæ¯æ˜¯å¦å®Œæ•´</span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js ä½œä¸ºå®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“ä½ æ¥æ”¶çš„å“åº”æ˜¯å¦å®Œæ•´ã€‚ä¾‹å¦‚ï¼Œä½ ä»æŸä¸ª API è¯·æ±‚æ•°æ®ï¼Œéœ€è¦ç¡®ä¿æ¥æ”¶åˆ°å®Œæ•´çš„æ•°æ®æ‰èƒ½è¿›è¡Œè§£æå’Œå¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/api/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æ¥æ”¶çš„æ•°æ®å—...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">complete</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”å·²å®Œæ•´æ¥æ”¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // å®Œæˆæ•°æ®å¤„ç†...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”æœªå®Œæ•´æ¥æ”¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨<code>end</code>äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥<code>res.complete</code>å±æ€§ã€‚å¦‚æœä¸º<code>true</code>ï¼Œæ„å‘³ç€å“åº”æ¶ˆæ¯å·²ç»å®Œæ•´æ¥æ”¶ï¼Œæ­¤æ—¶å¯ä»¥æ”¾å¿ƒåœ°å¯¹æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚å¦‚æœä¸º<code>false</code>ï¼Œåˆ™è¯´æ˜å“åº”æ•°æ®ä¸å®Œæ•´ï¼Œå¯èƒ½éœ€è¦é‡æ–°è¯·æ±‚æˆ–è€…å¤„ç†é”™è¯¯ã€‚</p><h3 id="message-connection" tabindex="-1"><a class="header-anchor" href="#message-connection"><span><a href="https://nodejs.org/docs/latest/api/http.html#messageconnection" target="_blank" rel="noopener noreferrer">message.connection</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šæ¨¡å—è®©å¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰æˆä¸ºå¯èƒ½ã€‚å…¶ä¸­ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—æ˜¯ HTTP æ¨¡å—ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿä½œä¸ºæœåŠ¡å™¨æ¥æ”¶ HTTP è¯·æ±‚ä»¥åŠä½œä¸ºå®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚ã€‚</p><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>message.connection</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†å¯¹å½“å‰æ¶ˆæ¯æµä¸­çš„ç½‘ç»œè¿æ¥ï¼ˆsocketï¼‰çš„å¼•ç”¨ã€‚è¿™ä¸ªå±æ€§ä¸»è¦å‡ºç°åœ¨ä¸¤ç§å¯¹è±¡ä¸­ï¼šHTTP è¯·æ±‚ï¼ˆrequestï¼‰å’Œ HTTP å“åº”ï¼ˆresponseï¼‰ã€‚ä¸è¿‡ï¼Œå®˜æ–¹æ–‡æ¡£å»ºè®®ä½¿ç”¨ <code>message.socket</code> ä»£æ›¿ <code>message.connection</code>ï¼Œå› ä¸ºåè€…å·²ç»è¢«åºŸå¼ƒã€‚</p><h3 id="ç†è§£message-connection" tabindex="-1"><a class="header-anchor" href="#ç†è§£message-connection"><span>ç†è§£<code>message.connection</code></span></a></h3><p>ç®€å•æ¥è¯´ï¼Œæ— è®ºå½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œè¿˜æ˜¯ä½¿ç”¨ HTTP å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œæ¯æ¬¡äº¤äº‘éƒ½æ¶‰åŠåˆ°ä¸¤ä¸ªåŸºæœ¬å…ƒç´ ï¼šè¯·æ±‚ï¼ˆrequestï¼‰å’Œå“åº”ï¼ˆresponseï¼‰ã€‚æ¯ä¸ªè¯·æ±‚å’Œå“åº”æ¶ˆæ¯éƒ½å¯ä»¥é€šè¿‡å®ƒä»¬çš„ <code>connection</code> å±æ€§è®¿é—®åº•å±‚çš„ç½‘ç»œè¿æ¥ã€‚</p><p>è¿™ä¸ªç½‘ç»œè¿æ¥å®è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒå‘é€šä¿¡é€šé“ï¼Œå®ƒå…è®¸æ•°æ®åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æµåŠ¨ã€‚è¿™ä¸ªè¿æ¥å¯ä»¥æ˜¯ TCP è¿æ¥ï¼Œä¹Ÿå¯èƒ½æ˜¯æ›´é«˜çº§åˆ«çš„ TLS/SSL åŠ å¯†è¿æ¥ï¼ˆå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ HTTPSï¼‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-21" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-21"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>è·å–å®¢æˆ·ç«¯ IP åœ°å€</strong></p><p>å½“ä½ åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚è™½ç„¶ç›´æ¥ä½¿ç”¨<code>message.connection</code>æ¥åšè¿™ä»¶äº‹å·²ç»ä¸è¢«æ¨èï¼ˆåº”è¯¥ç”¨<code>message.socket</code>ï¼‰ï¼Œä½†åŸç†æ˜¯ç›¸ä¼¼çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> ip</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Your IP address is </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">ip</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>é™åˆ¶åŒæ—¶æ‰“å¼€çš„ Socket è¿æ¥æ•°</strong></p><p>å¦‚æœä½ æƒ³æ§åˆ¶åŒæ—¶ä¸ä½ çš„ HTTP æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯æ•°é‡ï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®åº•å±‚çš„ socket æ¥å®æ–½è¿™ä¸€ç­–ç•¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getConnections</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">&gt;</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾æœ€å¤§è¿æ¥æ•°ä¸º100</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Too many connections.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¯·æ³¨æ„ï¼Œè¿™äº›ç¤ºä¾‹æ²¡æœ‰ç›´æ¥ä½¿ç”¨<code>message.connection</code>ï¼Œè€Œæ˜¯é‡‡ç”¨äº†æ›´æ¨èçš„<code>message.socket</code>ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå…³æ³¨<code>socket</code>å±æ€§èƒ½æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œæ§åˆ¶åŠ›ã€‚ä¸è¿‡ï¼Œäº†è§£<code>message.connection</code>çš„å­˜åœ¨å’Œæ¦‚å¿µå¯¹äºç†è§£ HTTP é€šä¿¡çš„ä½å±‚æ¬¡ç»†èŠ‚ä»ç„¶æ˜¯æœ‰ç›Šçš„ã€‚</p><h3 id="message-destroy-error" tabindex="-1"><a class="header-anchor" href="#message-destroy-error"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagedestroyerror" target="_blank" rel="noopener noreferrer">message.destroy([error])</a></span></a></h3><p>Node.js ä¸­çš„ <code>message.destroy([error])</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒç”¨äºåœ¨å¤„ç† HTTP æ¶ˆæ¯æ—¶ï¼ˆæ¯”å¦‚è¯·æ±‚ï¼ˆrequestï¼‰å’Œå“åº”ï¼ˆresponseï¼‰ï¼‰å¼ºåˆ¶ç»ˆæ­¢æ¶ˆæ¯æµã€‚è¿™ä¸ªæ–¹æ³•é€šå¸¸ç”¨äºå‡ºç°é”™è¯¯æˆ–è€…ä¸å†éœ€è¦ç»§ç»­å¤„ç†æ¶ˆæ¯æ—¶ã€‚</p><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>http.IncomingMessage</code> ç±»å‹çš„å¯¹è±¡è¡¨ç¤ºæ­£åœ¨æ¥æ”¶çš„æ•°æ®æµï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œè¿˜æ˜¯æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ã€‚<code>message.destroy()</code> æ–¹æ³•å±äºæ­¤ç±»å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è°ƒç”¨ä»¥é”€æ¯æµã€‚</p><h3 id="å‚æ•°-5" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-5"><span>å‚æ•°ï¼š</span></a></h3><ul><li><code>error</code> ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœæä¾›äº† <code>error</code> å‚æ•°ï¼Œé‚£ä¹ˆæµä¼šè¢«é”€æ¯ï¼Œå¹¶ä¸”ä¼šè§¦å‘ &#39;error&#39; äº‹ä»¶ï¼Œå°†æä¾›çš„é”™è¯¯å¯¹è±¡ä¼ é€’ç»™ç›‘å¬å™¨ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-8"><span>å®é™…åº”ç”¨ä¾‹å­ï¼š</span></a></h3><h4 id="ç¤ºä¾‹-1-ç»ˆæ­¢è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç»ˆæ­¢è¯·æ±‚"><span>ç¤ºä¾‹ 1: ç»ˆæ­¢è¯·æ±‚</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œå®ƒæ¥æ”¶æ–‡ä»¶ä¸Šä¼ ã€‚å¦‚æœæ–‡ä»¶å¤ªå¤§ï¼Œä½ å¯èƒ½æƒ³è¦æå‰ç»ˆæ­¢è¿™ä¸ªè¯·æ±‚ï¼Œé˜²æ­¢æµªè´¹æœåŠ¡å™¨èµ„æºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length </span><span style="color:#81A1C1;">&gt;</span><span style="color:#B48EAD;"> 1e6</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">        // å½“æ¥æ”¶çš„æ•°æ®å—å¤§å°è¶…è¿‡ 1MB</span></span>
<span class="line"><span style="color:#616E88;">        // é”€æ¯æ¶ˆæ¯æµå¹¶è¿”å›é”™è¯¯</span></span>
<span class="line"><span style="color:#D8DEE9;">        req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File too large</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File received</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">413</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File too large</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">OK</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœä¸Šä¼ çš„æ–‡ä»¶æ•°æ®è¶…è¿‡äº†æˆ‘ä»¬è®¾å®šçš„é™åˆ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>req.destroy()</code> æ–¹æ³•æ¥ç»ˆæ­¢è¯·æ±‚æµå¹¶ä¼ é€’ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ <code>&#39;File too large&#39;</code>ã€‚ä¸€æ—¦è°ƒç”¨ <code>destroy</code> æ–¹æ³•ï¼Œæµå°±è¢«ç»ˆæ­¢äº†ï¼Œä¸ä¼šå†æœ‰æ•°æ®è¯»å–ã€‚</p><h4 id="ç¤ºä¾‹-2-ç»ˆæ­¢å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç»ˆæ­¢å“åº”"><span>ç¤ºä¾‹ 2: ç»ˆæ­¢å“åº”</span></a></h4><p>è€ƒè™‘å¦å¤–ä¸€ä¸ªåœºæ™¯ï¼Œä½ çš„æœåŠ¡å™¨æ­£åœ¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨å‘é€è¿‡ç¨‹ä¸­å‘ç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œä½ å¸Œæœ›ç«‹å³åœæ­¢å‘é€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/big/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¼€å§‹å‘é€æ–‡ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å‘ç”Ÿé”™è¯¯ï¼Œé”€æ¯å“åº”æµ</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœåœ¨è¯»å–æˆ–è€…å‘é€æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œé€šè¿‡ <code>res.destroy(err)</code> æˆ‘ä»¬ä¸»åŠ¨ä¸­æ–­äº†å“åº”æµï¼Œå¹¶ä¸”å‘å®¢æˆ·ç«¯é€šçŸ¥äº†å‘ç”Ÿçš„é”™è¯¯ã€‚</p><h3 id="å°ç»“-5" tabindex="-1"><a class="header-anchor" href="#å°ç»“-5"><span>å°ç»“:</span></a></h3><p><code>message.destroy([error])</code> æä¾›äº†ä¸€ç§æ‰‹æ®µæ¥ç«‹å³ç»ˆæ­¢æ­£åœ¨å¤„ç†çš„ HTTP è¯·æ±‚æˆ–å“åº”ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†èµ„æºå¹¶å¤„ç†å¼‚å¸¸æƒ…å†µã€‚</p><h3 id="message-headers" tabindex="-1"><a class="header-anchor" href="#message-headers"><span><a href="https://nodejs.org/docs/latest/api/http.html#messageheaders" target="_blank" rel="noopener noreferrer">message.headers</a></span></a></h3><p>äº†è§£ <code>message.headers</code> é¦–å…ˆéœ€è¦æˆ‘ä»¬çŸ¥é“å®ƒæ˜¯åœ¨ Node.js ä¸­çš„ HTTP æ¨¡å—é‡Œä½¿ç”¨çš„ä¸€ä¸ªå±æ€§ã€‚è¿™ä¸ªå±æ€§å±äº HTTP æ¶ˆæ¯å¯¹è±¡ï¼Œå¯ä»¥æ˜¯è¯·æ±‚ï¼ˆrequestï¼‰æˆ–å“åº”ï¼ˆresponseï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<code>message.headers</code> åŒ…å«äº†ä¸€ä¸ª HTTP æ¶ˆæ¯çš„æ‰€æœ‰å¤´éƒ¨ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆã€‚</p><p>åœ¨ HTTP é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯å¤´éƒ¨ï¼ˆHeadersï¼‰æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚å®ƒä»¬ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’çš„æ•°æ®æä¾›äº†ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰ã€å†…å®¹é•¿åº¦ï¼ˆContent-Lengthï¼‰ã€ç”¨æˆ·ä»£ç†ï¼ˆUser-Agentï¼‰ã€è®¤è¯ä¿¡æ¯ç­‰ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-è¯»å–è¯·æ±‚å¤´" tabindex="-1"><a class="header-anchor" href="#_1-è¯»å–è¯·æ±‚å¤´"><span>1. è¯»å–è¯·æ±‚å¤´</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®è¯·æ±‚çš„ User-Agent æ¥åˆ¤æ–­è¯·æ±‚æ¥è‡ªå“ªç§è®¾å¤‡ï¼Œä»¥æä¾›ä¸åŒçš„å“åº”ç­–ç•¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> userAgent</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">user-agent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">User-Agent: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">userAgent</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">mobile</span><span style="color:#ECEFF4;">/</span><span style="color:#81A1C1;">i</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">test</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">userAgent</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Serving mobile version of the site</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Serving desktop version of the site</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>req.headers[&#39;user-agent&#39;]</code> ç”¨äºè·å–è¯·æ±‚çš„ User-Agent å¤´éƒ¨çš„å€¼ï¼Œå¹¶åŸºäºè¯¥å€¼å†³å®šæœåŠ¡çš„ç‰ˆæœ¬ï¼ˆç§»åŠ¨ç‰ˆæˆ–æ¡Œé¢ç‰ˆï¼‰ã€‚</p><h4 id="_2-è®¾ç½®å“åº”å¤´" tabindex="-1"><a class="header-anchor" href="#_2-è®¾ç½®å“åº”å¤´"><span>2. è®¾ç½®å“åº”å¤´</span></a></h4><p>å½“ä½ è¦å‘å®¢æˆ·ç«¯å‘é€å“åº”æ—¶ï¼Œæœ‰æ—¶éœ€è¦è®¾ç½®ä¸€äº›å“åº”å¤´æ¥æ§åˆ¶è¡Œä¸ºï¼Œæ¯”å¦‚è®¾ç½®å†…å®¹ç±»å‹æˆ–å¤„ç†è·¨åŸŸè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Access-Control-Allow-Origin</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">*</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ <code>res.setHeader()</code> æ–¹æ³•è®¾ç½®äº†ä¸¤ä¸ªå“åº”å¤´ï¼š<code>Content-Type</code> å’Œ <code>Access-Control-Allow-Origin</code>ã€‚<code>Content-Type</code> å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘ä»¬å‘é€çš„æ•°æ®æ ¼å¼æ˜¯ JSONï¼›<code>Access-Control-Allow-Origin: *</code> å…è®¸ä»»ä½•æºçš„è¯·æ±‚è®¿é—®èµ„æºï¼Œè¿™æ˜¯å¤„ç†è·¨åŸŸè¯·æ±‚çš„ä¸€ä¸ªå¸¸è§æ–¹å¼ã€‚</p><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p>ç†è§£å¹¶æœ‰æ•ˆåˆ©ç”¨ HTTP å¤´éƒ¨æ˜¯æ„å»ºç½‘ç»œåº”ç”¨çš„å…³é”®ç¯èŠ‚ã€‚é€šè¿‡ <code>message.headers</code>ï¼ŒNode.js æä¾›äº†ä¸€ä¸ªç®€æ´çš„æ¥å£æ¥è®¿é—®å’Œæ“ä½œè¿™äº›å¤´éƒ¨ä¿¡æ¯ã€‚æ— è®ºæ˜¯åˆ†æè¯·æ±‚è¿˜æ˜¯ä¼˜åŒ–å“åº”ï¼Œå®ƒéƒ½æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚</p><h3 id="message-headersdistinct" tabindex="-1"><a class="header-anchor" href="#message-headersdistinct"><span><a href="https://nodejs.org/docs/latest/api/http.html#messageheadersdistinct" target="_blank" rel="noopener noreferrer">message.headersDistinct</a></span></a></h3><p><code>message.headersDistinct</code> æ˜¯ Node.js v21.7.1 HTTP æ¨¡å—ä¸­ä¸€ä¸ªæ–°æ·»åŠ çš„å±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥è®©ä½ æ›´æ–¹ä¾¿åœ°è·å–åˆ° HTTP æ¶ˆæ¯ï¼ˆè¯·æ±‚æˆ–å“åº”ï¼‰çš„å¤´éƒ¨å­—æ®µä¿¡æ¯ã€‚åœ¨ HTTP é€šä¿¡ä¸­ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå¤´éƒ¨ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å…ƒæ•°æ®ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ã€ä»¥åŠå…¶ä»–çš„ä¸€äº›ä¿¡æ¯ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œè¦è·å–è¯·æ±‚æˆ–å“åº”çš„å¤´éƒ¨æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ <code>message.headers</code> å±æ€§ï¼Œä½†æ˜¯è¿™ä¸ªå±æ€§å¹¶ä¸åŒºåˆ†å¤´éƒ¨å­—æ®µåçš„å¤§å°å†™ï¼Œå¹¶ä¸”å½“æœ‰å¤šä¸ªç›¸åŒåç§°çš„å¤´éƒ¨å­—æ®µæ—¶ï¼Œå®ƒä»¬ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚è¿™æœ‰æ—¶ä¼šå¯¼è‡´ä¸€äº›æ··æ·†ï¼Œå› ä¸ºæ ¹æ® HTTP/1.1 çš„è§„èŒƒï¼Œå¤§éƒ¨åˆ†å¤´éƒ¨å­—æ®µåéƒ½æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œè€Œæœ‰ä¸€äº›ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œå­—æ®µå€¼åˆå¹¶å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ª HTTP è¯·æ±‚åŒ…å«äº†ä¸¤ä¸ª <code>Set-Cookie</code> å¤´éƒ¨å­—æ®µï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Set-Cookie: yum=yumValue</span></span>
<span class="line"><span>Set-Cookie: tasty=tastyValue</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>message.headers[&#39;set-cookie&#39;]</code> å¾—åˆ°çš„å°†æ˜¯ä¸€ä¸ªåˆå¹¶åçš„å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äº <code>&quot;yum=yumValue, tasty=tastyValue&quot;</code>ï¼Œè€Œæœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å®ƒä»¬æ˜¯åˆ†å¼€çš„ï¼Œä¾¿äºå•ç‹¬å¤„ç†æ¯ä¸€ä¸ª <code>Set-Cookie</code>ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNode.js åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­å¼•å…¥äº† <code>message.headersDistinct</code> å±æ€§ã€‚è¿™ä¸ªå±æ€§è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­çš„æ¯ä¸ªé”®éƒ½æ˜¯ä¸€ä¸ªå°å†™çš„å¤´éƒ¨å­—æ®µåï¼Œè€Œå¯¹åº”çš„å€¼åˆ™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰åŒåçš„å¤´éƒ¨å­—æ®µå€¼ï¼Œæ²¡æœ‰è¿›è¡Œåˆå¹¶ã€‚</p><p>ç°åœ¨æ¥çœ‹å…·ä½“çš„è¿ç”¨å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚åŒ…å«å¤šä¸ªç›¸åŒåç§°çš„å¤´éƒ¨å­—æ®µ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨message.headers</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">set-cookie</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: &quot;yum=yumValue, tasty=tastyValue&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨message.headersDistinct</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersDistinct</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersDistinct</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">set-cookie</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> cookie</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersDistinct</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">set-cookie</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">cookie</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆ†åˆ«è¾“å‡º: &quot;yum=yumValue&quot; å’Œ &quot;tasty=tastyValue&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 3000 ç«¯å£ã€‚å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆå°è¯•æ‰“å°å‡ºé€šè¿‡ <code>req.headers</code> è·å–çš„ <code>&#39;set-cookie&#39;</code> å¤´éƒ¨å­—æ®µå€¼ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªåˆå¹¶åçš„å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œå®ƒæ£€æŸ¥æ˜¯å¦å­˜åœ¨ <code>req.headersDistinct</code> å±æ€§ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™éå† <code>req.headersDistinct[&#39;set-cookie&#39;]</code> æ•°ç»„ï¼Œå¹¶æ‰“å°å‡ºæ¯ä¸€ä¸ªç‹¬ç«‹çš„ <code>Set-Cookie</code> å­—æ®µã€‚</p><p>è¿™æ ·ï¼Œä½ å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ†åˆ«å¤„ç†æ¯ä¸€ä¸ª <code>Set-Cookie</code>ï¼Œæ— éœ€æ‹…å¿ƒä¸åŒ <code>Set-Cookie</code> ä¹‹é—´çš„æ··æ·†ã€‚è¿™æ˜¯ <code>message.headersDistinct</code> æä¾›çš„ä¸€ä¸ªä¸»è¦å¥½å¤„ã€‚</p><h3 id="message-httpversion" tabindex="-1"><a class="header-anchor" href="#message-httpversion"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagehttpversion" target="_blank" rel="noopener noreferrer">message.httpVersion</a></span></a></h3><p>ç†è§£ <code>message.httpVersion</code> åœ¨ Node.js ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ç‰ˆæœ¬ 21.7.1 çš„ä¸Šä¸‹æ–‡é‡Œï¼Œé¦–å…ˆéœ€è¦äº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js ä¸­å¤„ç†ç½‘ç»œé€šä¿¡æ—¶ï¼ŒHTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ‰®æ¼”ç€æ ¸å¿ƒè§’è‰²ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-6" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-6"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><h4 id="http-1" tabindex="-1"><a class="header-anchor" href="#http-1"><span>HTTP</span></a></h4><p>HTTP åè®®æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„åè®®ä¹‹ä¸€ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è§„åˆ™ã€‚å½“ä½ åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ä¸€ä¸ª URL å¹¶æ•²å‡»å›è½¦æ—¶ï¼Œä½ çš„æµè§ˆå™¨å°±ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥åˆ°è¯·æ±‚åï¼Œè¿”å›å“åº”çš„èµ„æºï¼Œæ¯”å¦‚ HTML é¡µé¢ã€å›¾ç‰‡ç­‰ã€‚</p><h4 id="node-js-ä¸­çš„-http-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-http-æ¨¡å—"><span>Node.js ä¸­çš„ <code>http</code> æ¨¡å—</span></a></h4><p>Node.js æä¾›äº†ä¸€ä¸ªå†…ç½®çš„æ¨¡å—ï¼Œåä¸º <code>http</code>ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿä½œä¸ºæœåŠ¡å™¨æ¥æ”¶ HTTP è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚è¿™ä¸ªæ¨¡å—ä¹Ÿæ”¯æŒä½œä¸ºå®¢æˆ·ç«¯å‘èµ· HTTP è¯·æ±‚ã€‚ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼Œä½ å¯ä»¥åˆ›å»ºå®Œæ•´çš„ HTTP æœåŠ¡ã€‚</p><h3 id="message-httpversion-1" tabindex="-1"><a class="header-anchor" href="#message-httpversion-1"><span><code>message.httpVersion</code></span></a></h3><p>åœ¨ Node.js çš„ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>message.httpVersion</code> æ˜¯æŒ‡ä»£ HTTP æ¶ˆæ¯çš„ç‰ˆæœ¬ä¿¡æ¯çš„å±æ€§ã€‚è¿™é‡Œçš„â€œæ¶ˆæ¯â€å¯ä»¥æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚æˆ–è€…æ˜¯ä¸€ä¸ª HTTP å“åº”ã€‚HTTP æ¶ˆæ¯åŒ…å«äº†èµ·å§‹è¡Œã€å¤´éƒ¨å­—æ®µå’Œå¯é€‰çš„æ¶ˆæ¯ä½“ã€‚</p><ul><li><strong>èµ·å§‹è¡Œ</strong>ï¼šå¯¹äºè¯·æ±‚ï¼Œèµ·å§‹è¡ŒåŒ…å«æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ã€è¯·æ±‚çš„èµ„æºè·¯å¾„å’Œ HTTP ç‰ˆæœ¬ï¼›å¯¹äºå“åº”ï¼Œå®ƒåŒ…å« HTTP ç‰ˆæœ¬ã€çŠ¶æ€ç ï¼ˆå¦‚ 200ã€404ï¼‰å’ŒçŠ¶æ€æ¶ˆæ¯ï¼ˆå¦‚ OKã€Not Foundï¼‰ã€‚</li><li><strong>å¤´éƒ¨å­—æ®µ</strong>ï¼šåŒ…å«å…³äºè¯·æ±‚æˆ–å“åº”çš„é™„åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ç­‰ã€‚</li><li><strong>æ¶ˆæ¯ä½“</strong>ï¼šå¯é€‰ï¼ŒåŒ…å«å‘é€çš„æ•°æ®ï¼Œå¦‚ POST è¡¨å•æ•°æ®ã€‚</li></ul><p><code>message.httpVersion</code> å±æ€§å°±æ˜¯ç”¨æ¥è·å–è¿™ä¸ª HTTP æ¶ˆæ¯ä¸­çš„ç‰ˆæœ¬å·ï¼Œå…¶å€¼å¯èƒ½æ˜¯ &quot;1.0&quot;, &quot;1.1&quot;, æˆ– &quot;2.0&quot; ç­‰ã€‚äº†è§£æ¶ˆæ¯çš„ HTTP ç‰ˆæœ¬å¯¹äºå¤„ç†ä¸åŒç‰ˆæœ¬çš„ HTTP åè®®å¾ˆé‡è¦ï¼Œå› ä¸ºä¸åŒç‰ˆæœ¬çš„åè®®åœ¨åŠŸèƒ½å’Œæ€§èƒ½ä¸Šæœ‰æ‰€å·®å¼‚ã€‚</p><h3 id="å®é™…ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-5"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ å¼€å‘äº†ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å¤„ç†ç”¨æˆ·çš„ HTTP è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚çš„ HTTP ç‰ˆæœ¬æ¥é‡‡å–ä¸åŒçš„å¤„ç†é€»è¾‘ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¿é—® message.httpVersion å±æ€§è·å–è¯·æ±‚çš„ HTTP ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> httpVersion</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">httpVersion</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ ¹æ® HTTP ç‰ˆæœ¬æ‰“å°ä¸åŒçš„æ¬¢è¿ä¿¡æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">httpVersion</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to our website using HTTP/1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">httpVersion</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to our modern website using HTTP/2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">Your HTTP version is </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">httpVersion</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, but we recommend 1.1 or 2.0 for the best experience.</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç®€å•çš„æœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åŸºäºå®¢æˆ·ç«¯è¯·æ±‚çš„ HTTP ç‰ˆæœ¬æ¥æä¾›ä¸åŒçš„å“åº”æ¶ˆæ¯ã€‚é€šè¿‡æ£€æŸ¥ <code>req.httpVersion</code>ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„ HTTP ç‰ˆæœ¬å®æ–½ç‰¹å®šçš„é€»è¾‘æˆ–ä¼˜åŒ–ã€‚</p><p>å¸Œæœ›è¿™æœ‰åŠ©äºä½ ç†è§£ Node.js ä¸­ <code>message.httpVersion</code> çš„æ¦‚å¿µåŠå…¶åº”ç”¨ï¼</p><h3 id="message-method" tabindex="-1"><a class="header-anchor" href="#message-method"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagemethod" target="_blank" rel="noopener noreferrer">message.method</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…ç½®çš„ <code>http</code> æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å¯ä»¥å¸®åŠ©ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p><p>åœ¨ Node.js çš„ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>message.method</code> å±æ€§æ˜¯ç”¨æ¥è·å–æˆ–è¡¨ç¤º HTTP è¯·æ±‚çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯åŠ¨ä½œç±»å‹ï¼‰ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ <code>&#39;GET&#39;</code>, <code>&#39;POST&#39;</code>, <code>&#39;PUT&#39;</code>, <code>&#39;DELETE&#39;</code> ç­‰ç­‰ã€‚è¿™äº›è¯·æ±‚æ–¹æ³•é€šå¸¸å®šä¹‰äº†å®¢æˆ·ç«¯æƒ³å¯¹æœåŠ¡å™¨ä¸Šçš„èµ„æºæ‰§è¡Œä»€ä¹ˆæ ·çš„æ“ä½œã€‚</p><p>ä¸‹é¢æˆ‘ç»™ä½ ä¸¾å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-åˆ›å»º-http-æœåŠ¡å™¨å¹¶æ£€æŸ¥è¯·æ±‚æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»º-http-æœåŠ¡å™¨å¹¶æ£€æŸ¥è¯·æ±‚æ–¹æ³•"><span>ä¾‹å­ 1ï¼šåˆ›å»º HTTP æœåŠ¡å™¨å¹¶æ£€æŸ¥è¯·æ±‚æ–¹æ³•</span></a></h3><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå¹¶è¾“å‡ºæ¯æ¬¡è¯·æ±‚çš„æ–¹æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // req.method åŒ…å«äº†HTTPè¯·æ±‚çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚æ–¹æ³•ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œè¿™æ®µä»£ç åï¼Œæ¯å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒä¼šæ‰“å°å‡ºè¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET æˆ– POSTã€‚</p><h3 id="ä¾‹å­-2-æ ¹æ®è¯·æ±‚æ–¹æ³•å“åº”ä¸åŒå†…å®¹" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ ¹æ®è¯·æ±‚æ–¹æ³•å“åº”ä¸åŒå†…å®¹"><span>ä¾‹å­ 2ï¼šæ ¹æ®è¯·æ±‚æ–¹æ³•å“åº”ä¸åŒå†…å®¹</span></a></h3><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ ¹æ®ä¸åŒçš„è¯·æ±‚æ–¹æ³•å‘é€ä¸åŒçš„å“åº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å‘é€äº†ä¸€ä¸ª GET è¯·æ±‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å‘é€äº†ä¸€ä¸ª POST è¯·æ±‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°äº†ä¸€ä¸ª </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> è¯·æ±‚</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ ä½¿ç”¨æµè§ˆå™¨å»è®¿é—®è¿™ä¸ªæœåŠ¡å™¨ï¼Œé»˜è®¤ä¸º GET è¯·æ±‚ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºâ€œä½ å‘é€äº†ä¸€ä¸ª GET è¯·æ±‚â€ã€‚å¦‚æœä½ ç”¨å·¥å…·å¦‚ Postman å»å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œåˆ™ä¼šæ˜¾ç¤ºâ€œä½ å‘é€äº†ä¸€ä¸ª POST è¯·æ±‚â€ã€‚</p><h3 id="ä¾‹å­-3-restful-api" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-restful-api"><span>ä¾‹å­ 3ï¼šRESTful API</span></a></h3><p>åœ¨æ„å»º RESTful API æ—¶ï¼Œä¸åŒçš„è¯·æ±‚æ–¹æ³•è¡¨ç¤ºå¯¹æœåŠ¡å™¨ä¸Šèµ„æºçš„ä¸åŒæ“ä½œï¼š</p><ul><li>GET: è·å–èµ„æº</li><li>POST: åˆ›å»ºèµ„æº</li><li>PUT: æ›´æ–°èµ„æº</li><li>DELETE: åˆ é™¤èµ„æº</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  switch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    case</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#616E88;">      // å¤„ç†è·å–èµ„æºçš„é€»è¾‘</span></span>
<span class="line"><span style="color:#81A1C1;">      break;</span></span>
<span class="line"><span style="color:#81A1C1;">    case</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#616E88;">      // å¤„ç†åˆ›å»ºèµ„æºçš„é€»è¾‘</span></span>
<span class="line"><span style="color:#81A1C1;">      break;</span></span>
<span class="line"><span style="color:#81A1C1;">    case</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PUT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#616E88;">      // å¤„ç†æ›´æ–°èµ„æºçš„é€»è¾‘</span></span>
<span class="line"><span style="color:#81A1C1;">      break;</span></span>
<span class="line"><span style="color:#81A1C1;">    case</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">DELETE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#616E88;">      // å¤„ç†åˆ é™¤èµ„æºçš„é€»è¾‘</span></span>
<span class="line"><span style="color:#81A1C1;">      break;</span></span>
<span class="line"><span style="color:#81A1C1;">    default</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#616E88;">      // å¤„ç†å…¶ä»–æƒ…å†µ</span></span>
<span class="line"><span style="color:#81A1C1;">      break;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Handled </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> request</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šæ˜¯é’ˆå¯¹ Node.js v21.7.1 ä¸­çš„ <code>message.method</code> å±æ€§çš„è§£é‡Šå’Œä¾‹å­ï¼Œè¯¥å±æ€§æ˜¯åœ¨åˆ›å»º HTTP æœåŠ¡æ—¶ç”¨æ¥åŒºåˆ«å’Œå¤„ç†ä¸åŒ HTTP æ–¹æ³•çš„é‡è¦å±æ€§ã€‚</p><h3 id="message-rawheaders" tabindex="-1"><a class="header-anchor" href="#message-rawheaders"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagerawheaders" target="_blank" rel="noopener noreferrer">message.rawHeaders</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒä½¿å¾— JavaScript å¯ä»¥ç”¨äºåç«¯å¼€å‘ï¼Œå¤„ç†æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“æ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚Node.js ä¸­æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ­å»ºç½‘ç»œæœåŠ¡å’Œåº”ç”¨ã€‚<code>http</code>æ˜¯è¿™æ ·ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿä½œä¸ºæœåŠ¡å™¨æ¥æ”¶ HTTP è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå½“ä½ ä½¿ç”¨<code>http</code>æ¨¡å—å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå…¶ä¸­çš„ä¸€ä¸ªå±æ€§æ˜¯<code>message.rawHeaders</code>ã€‚æ¯ä¸ª HTTP æ¶ˆæ¯(è¯·æ±‚æˆ–å“åº”)éƒ½æœ‰å¤´éƒ¨(headers)ï¼ŒåŒ…å«äº†ä¸€äº›å…³äºæ¶ˆæ¯æœ¬èº«ä¿¡æ¯çš„å…ƒæ•°æ®ï¼ˆæ¯”å¦‚å†…å®¹ç±»å‹ã€ç¼–ç æ–¹å¼ç­‰ï¼‰ã€‚é€šå¸¸ï¼Œè¿™äº›å¤´éƒ¨ä»¥é”®å€¼å¯¹çš„å½¢å¼å‡ºç°ã€‚</p><h3 id="message-rawheadersç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#message-rawheadersç®€ä»‹"><span><code>message.rawHeaders</code>ç®€ä»‹</span></a></h3><p><code>message.rawHeaders</code>æ˜¯æŒ‡æœªç»å¤„ç†çš„å¤´éƒ¨ä¿¡æ¯æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„é‡Œé¢åŒ…æ‹¬äº†è¯·æ±‚æˆ–å“åº”å¤´éƒ¨çš„åŸå§‹é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹æ˜¯æŒ‰ç…§å®ƒä»¬åœ¨åŸå§‹ HTTP æ¶ˆæ¯ä¸­å‡ºç°çš„é¡ºåºäº¤é”™æ’åˆ—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¼šå…ˆçœ‹åˆ°ç¬¬ä¸€ä¸ªå¤´éƒ¨çš„åç§°ï¼Œç´§æ¥ç€æ˜¯å®ƒçš„å€¼ï¼Œç„¶åæ˜¯ä¸‹ä¸€ä¸ªå¤´éƒ¨çš„åç§°å’Œå€¼ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-22" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-22"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-æŸ¥çœ‹æ‰€æœ‰çš„è¯·æ±‚å¤´éƒ¨ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_1-æŸ¥çœ‹æ‰€æœ‰çš„è¯·æ±‚å¤´éƒ¨ä¿¡æ¯"><span>1. æŸ¥çœ‹æ‰€æœ‰çš„è¯·æ±‚å¤´éƒ¨ä¿¡æ¯</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œä½ å¯èƒ½æƒ³æŸ¥çœ‹æ‰€æœ‰å‘å¾€è¯¥æœåŠ¡å™¨çš„è¯·æ±‚å¤´éƒ¨ä¿¡æ¯ã€‚è¿™å¯¹äºè°ƒè¯•æˆ–æ ¹æ®å¤´éƒ¨ä¿¡æ¯åšå‡ºç‰¹å®šé€»è¾‘å¤„ç†éå¸¸æœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">rawHeaders</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°å‡ºæ‰€æœ‰è¯·æ±‚å¤´éƒ¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“ä»»ä½•è¯·æ±‚å‘å¾€æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>req.rawHeaders</code>æ‰“å°å‡ºäº†è¯·æ±‚çš„æ‰€æœ‰å¤´éƒ¨ä¿¡æ¯ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£è¯·æ±‚çš„å„ç±»å…ƒæ•°æ®ã€‚</p><h4 id="_2-æ„é€ åŸºäºå¤´éƒ¨ä¿¡æ¯çš„é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#_2-æ„é€ åŸºäºå¤´éƒ¨ä¿¡æ¯çš„é€»è¾‘"><span>2. æ„é€ åŸºäºå¤´éƒ¨ä¿¡æ¯çš„é€»è¾‘</span></a></h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³æ ¹æ®è¯·æ±‚çš„å¤´éƒ¨ä¿¡æ¯æ¥æ›´æ”¹ä½ çš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸åŒçš„<code>User-Agent</code>æ¥è¿”å›ä¸åŒæ ¼å¼çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> userAgentIndex</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">rawHeaders</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">indexOf</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">User-Agent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">+</span><span style="color:#B48EAD;"> 1</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> userAgent</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">rawHeaders</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">userAgentIndex</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">userAgent</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Mozilla</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Returning data for a desktop browser.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Returning data for a mobile browser or other client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°<code>User-Agent</code>å¤´éƒ¨çš„ä½ç½®ï¼Œç„¶åè·å–å…¶å€¼ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æ ¹æ®<code>User-Agent</code>çš„å€¼ï¼ˆå³ç”¨æˆ·çš„æµè§ˆå™¨ç±»å‹ï¼‰æ¥å†³å®šè¿”å›ç»™ç”¨æˆ·ä»€ä¹ˆæ ·çš„æ•°æ®ã€‚</p><h3 id="æ€»ç»“-17" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-17"><span>æ€»ç»“</span></a></h3><p><code>message.rawHeaders</code>æä¾›äº†ä¸€ç§ç›´æ¥è®¿é—® HTTP è¯·æ±‚æˆ–å“åº”å¤´éƒ¨åŸå§‹ä¿¡æ¯çš„æ–¹å¼ã€‚é€šè¿‡è¿™ä¸ªå±æ€§ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°éå†å’Œå¤„ç†è¿™äº›ä¿¡æ¯ï¼Œå®ç°æ›´åŠ çµæ´»å’Œå¼ºå¤§çš„åŠŸèƒ½ã€‚ä¸è¿‡ï¼Œåœ¨å¤„ç†è¿™äº›åŸå§‹å¤´éƒ¨ä¿¡æ¯æ—¶ï¼Œè®°å¾—è€ƒè™‘åˆ°å¤§å°å†™ä¸æ•æ„Ÿå’Œé‡å¤å¤´éƒ¨çš„å¯èƒ½æ€§ã€‚</p><h3 id="message-rawtrailers" tabindex="-1"><a class="header-anchor" href="#message-rawtrailers"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagerawtrailers" target="_blank" rel="noopener noreferrer">message.rawTrailers</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>http</code>æ¨¡å—æ˜¯ç”¨äºåˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ ¸å¿ƒæ¨¡å—ã€‚å½“å¤„ç† HTTP è¯·æ±‚å’Œå“åº”æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ° HTTP å¤´ä¿¡æ¯ï¼ˆheadersï¼‰å’Œå°¾éƒ¨ä¿¡æ¯ï¼ˆtrailersï¼‰ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒHTTP å¤´ä¿¡æ¯æ˜¯åœ¨è¯·æ±‚æˆ–å“åº”çš„å¼€å§‹éƒ¨åˆ†å‘é€çš„ï¼Œå¹¶ä¸”åŒ…å«å…³äºæ•°æ®çš„å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ç­‰ã€‚è€Œ HTTP å°¾éƒ¨ä¿¡æ¯åˆ™æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¤´ä¿¡æ¯ï¼Œå®ƒä»¬å‡ºç°åœ¨ HTTP æ¶ˆæ¯ä½“çš„æœ«å°¾ï¼ŒåŒæ ·å¯ä»¥åŒ…å«å…ƒä¿¡æ¯ï¼Œä½†æ˜¯å¹¶ä¸æ€»æ˜¯è¢«ä½¿ç”¨ã€‚</p><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>message.rawTrailers</code>å±æ€§å°±æ˜¯ç”¨æ¥è®¿é—®è¿™äº›åŸå§‹çš„å°¾éƒ¨ä¿¡æ¯çš„ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>message</code>å¯ä»¥æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚ï¼ˆ<code>http.IncomingMessage</code>å¯¹è±¡ï¼‰æˆ–è€…ä¸€ä¸ª HTTP å“åº”ï¼ˆ<code>http.ServerResponse</code>å¯¹è±¡ï¼‰ï¼Œè€Œ<code>rawTrailers</code>å±æ€§ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„åŒ…å«äº†è¯·æ±‚æˆ–å“åº”ä¸­çš„æœªè§£æçš„å°¾éƒ¨ä¿¡æ¯å­—ç¬¦ä¸²ã€‚</p><p>æ¯å¯¹å°¾éƒ¨ä¿¡æ¯éƒ½æ˜¯ä¸€ä¸ªç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å°¾éƒ¨ä¿¡æ¯çš„åç§°ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å°¾éƒ¨ä¿¡æ¯çš„å€¼ï¼Œå®ƒä»¬ä¹‹é—´ç”¨å†’å·ï¼ˆ:ï¼‰éš”å¼€ã€‚å®ƒä»¬å’Œæ™®é€šçš„å¤´ä¿¡æ¯éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯ä½ç½®ä¸åŒã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨<code>rawTrailers</code>çš„ä¾‹å­ï¼š</p><p>å‡è®¾æœ‰ä¸€ä¸ª HTTP å®¢æˆ·ç«¯å‘æˆ‘ä»¬çš„ Node.js æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªåŒ…å«å°¾éƒ¨ä¿¡æ¯çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚å¯èƒ½é•¿è¿™æ ·ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>POST /example HTTP/1.1</span></span>
<span class="line"><span>Host: www.example.com</span></span>
<span class="line"><span>Content-Type: text/plain</span></span>
<span class="line"><span>Trailer: Expires</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Hello, world!</span></span>
<span class="line"><span>Expires: Wed, 21 Oct 2021 07:28:00 GMT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªè¯·æ±‚ä¸­ï¼Œå°¾éƒ¨ä¿¡æ¯æ˜¯â€œExpiresâ€ï¼Œå®ƒå‡ºç°åœ¨æ¶ˆæ¯ä½“ä¹‹åã€‚</p><p>åœ¨ Node.js æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥è¯»å–è¿™ä¸ªå°¾éƒ¨ä¿¡æ¯ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬ &#39;data&#39; äº‹ä»¶æ¥æ¥æ”¶æ•°æ®å—</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†è¯·æ±‚ä¸»ä½“æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬ &#39;end&#39; äº‹ä»¶ï¼Œè¡¨ç¤ºè¯·æ±‚ä½“å·²ç»å®Œå…¨æ¥æ”¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // åœ¨è¯·æ±‚ç»“æŸåï¼ŒrawTrailers æ•°ç»„åŒ…å«äº†å°¾éƒ¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">rawTrailers</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º [&#39;Expires: Wed, 21 Oct 2021 07:28:00 GMT&#39;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å‘é€å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“è¯·æ±‚å®Œå…¨æ¥æ”¶ç»“æŸæ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬<code>end</code>äº‹ä»¶æ¥è·å–å°¾éƒ¨ä¿¡æ¯ã€‚åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„å°¾éƒ¨ä¿¡æ¯éƒ½å·²ç»å­˜å‚¨åœ¨<code>req.rawTrailers</code>æ•°ç»„ä¸­ï¼Œå¹¶ä¸”å¯ä»¥è¢«è¾“å‡ºæˆ–è€…æ ¹æ®éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</p><h3 id="message-settimeout-msecs-callback" tabindex="-1"><a class="header-anchor" href="#message-settimeout-msecs-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagesettimeoutmsecs-callback" target="_blank" rel="noopener noreferrer">message.setTimeout(msecs[, callback])</a></span></a></h3><p>Node.js ä¸­çš„ <code>message.setTimeout(msecs[, callback])</code> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ã€‚å®ƒå…è®¸ä½ ä¸ºè¯·æ±‚æˆ–å“åº”è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚å¦‚æœæŒ‡å®šçš„æ—¶é—´è¿‡å»åï¼Œè¯·æ±‚/å“åº”è¿˜æ²¡æœ‰å®Œå…¨ç»“æŸï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå¦‚æœä½ æä¾›äº†çš„è¯ï¼‰ï¼ŒåŒæ—¶ä¹Ÿä¼šè§¦å‘ <code>&#39;timeout&#39;</code> äº‹ä»¶ã€‚</p><h3 id="å‚æ•°è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-2"><span>å‚æ•°è§£é‡Šï¼š</span></a></h3><ul><li><code>msecs</code>: æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li><li><code>callback</code>: å¯é€‰å‚æ•°ã€‚ä¸€æ—¦è§¦å‘äº†è¶…æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚</li></ul><h3 id="ç†è§£å®ƒçš„è¿ä½œæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ç†è§£å®ƒçš„è¿ä½œæœºåˆ¶"><span>ç†è§£å®ƒçš„è¿ä½œæœºåˆ¶</span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js åˆ›å»º HTTP å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨æ—¶ï¼Œæ¯ä¸ªä¼ å…¥çš„è¯·æ±‚æˆ–ä¼ å‡ºçš„å“åº”éƒ½å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ª<code>message</code>å¯¹è±¡ã€‚è¿™æ„å‘³ç€æ— è®ºæ˜¯æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿˜æ˜¯å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”ï¼Œéƒ½å¯ä»¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶é™åˆ¶ã€‚è¿™å¯¹äºç»´æŒè‰¯å¥½çš„èµ„æºç®¡ç†å’Œç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢ç³»ç»Ÿä¸ºäº†ç­‰å¾…æŸä¸ªæ°¸è¿œä¸ä¼šç»“æŸçš„è¯·æ±‚/å“åº”è€Œæ— é™æœŸåœ°å ç”¨èµ„æºã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-23" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-23"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-http-æœåŠ¡å™¨ç«¯è®¾ç½®è¯·æ±‚è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#_1-http-æœåŠ¡å™¨ç«¯è®¾ç½®è¯·æ±‚è¶…æ—¶"><span>1. HTTP æœåŠ¡å™¨ç«¯è®¾ç½®è¯·æ±‚è¶…æ—¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›å¤„ç†è¯·æ±‚èŠ±è´¹å¤ªé•¿æ—¶é—´ï¼Œå› ä¸ºè¿™å°†å ç”¨æœåŠ¡å™¨èµ„æºï¼Œå¹¶å¯èƒ½å¯¼è‡´å…¶ä»–ç”¨æˆ·ä½“éªŒå»¶è¿Ÿã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä¸ºè¯·æ±‚è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 5 ç§’</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request has timed out.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 408</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è®¾ç½® HTTP çŠ¶æ€ç ä¸º 408 Request Timeout</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request timed out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-http-å®¢æˆ·ç«¯è¯·æ±‚è®¾ç½®è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#_2-http-å®¢æˆ·ç«¯è¯·æ±‚è®¾ç½®è¶…æ—¶"><span>2. HTTP å®¢æˆ·ç«¯è¯·æ±‚è®¾ç½®è¶…æ—¶</span></a></h4><p>å½“ä½ çš„åº”ç”¨ç¨‹åºéœ€è¦ä»å¦ä¸€ä¸ªæœåŠ¡è·å–æ•°æ®æ—¶ï¼Œä½ å¯èƒ½ä¸æƒ³è®©è¿™ä¸ªè¯·æ±‚æ— é™æœŸåœ°ç­‰å¾…å“åº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP è¯·æ±‚çš„é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">STATUS: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">BODY: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">No more data in response.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request timed out.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç»ˆæ­¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º 3 ç§’</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">problem with request: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡åœ¨ HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸­è®¾ç½®è¶…æ—¶ï¼Œä½ å¯ä»¥æ›´å¥½åœ°æ§åˆ¶èµ„æºçš„ä½¿ç”¨ï¼Œé¿å…å› ä¸ºä¸€äº›æ— å“åº”çš„è¯·æ±‚æˆ–æ…¢å“åº”å¯¼è‡´æ•´ä¸ªåº”ç”¨æ€§èƒ½ä¸‹é™ã€‚</p><h3 id="message-socket" tabindex="-1"><a class="header-anchor" href="#message-socket"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagesocket" target="_blank" rel="noopener noreferrer">message.socket</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript å¼€å‘æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http</code>æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚</p><p>å½“ä½ åœ¨ Node.js ä¸­ä½¿ç”¨<code>http</code>æ¨¡å—å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå°±ä¼šæœ‰ä¸€ä¸ª<code>http.IncomingMessage</code>å¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªå³å°†è¿›å…¥çš„æ¶ˆæ¯ï¼Œæ— è®ºæ˜¯è¯·æ±‚ (<code>http.ClientRequest</code>) è¿˜æ˜¯å“åº” (<code>http.ServerResponse</code>)ã€‚</p><p><code>message.socket</code>å±æ€§æ˜¯<code>http.IncomingMessage</code>å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†å¯¹åº•å±‚ç½‘ç»œè¿æ¥çš„ç›´æ¥è®¿é—®ã€‚è¿™ä¸ªç½‘ç»œè¿æ¥æ˜¯ä¸€ä¸ª<code>net.Socket</code>å¯¹è±¡ï¼Œå®ƒå°è£…äº†ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—ï¼Œå¹¶æä¾›äº†å¾ˆå¤šåº•å±‚çš„ç½‘ç»œè¯»å†™æ“ä½œã€‚</p><p>ç°åœ¨ï¼Œæˆ‘å°†é€šè¿‡ä¸€äº›ç®€å•çš„ä¾‹å­å¸®åŠ©ä½ ç†è§£<code>message.socket</code>çš„ä½œç”¨ï¼š</p><h3 id="ä¾‹å­-1-æŸ¥çœ‹å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æŸ¥çœ‹å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯"><span>ä¾‹å­ 1ï¼šæŸ¥çœ‹å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯</span></a></h3><p>å½“ä½ åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ IP åœ°å€å’Œç«¯å£å·ã€‚è¿™æ—¶å€™ä½ å¯ä»¥åˆ©ç”¨<code>message.socket</code>æ¥è·å–è¿™äº›ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> clientAddress</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> clientPort</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°æ¥è‡ª </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">clientPort</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> çš„è¯·æ±‚</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½, ä¸–ç•Œï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>req.socket</code>ï¼ˆå³<code>message.socket</code>ï¼‰è·å–äº†å®¢æˆ·ç«¯çš„ IP åœ°å€å’Œç«¯å£å·ï¼Œå¹¶å°†å…¶æ‰“å°è¾“å‡ºã€‚</p><h3 id="ä¾‹å­-2-æ‰‹åŠ¨å¤„ç†-tcp-å¥—æ¥å­—" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ‰‹åŠ¨å¤„ç†-tcp-å¥—æ¥å­—"><span>ä¾‹å­ 2ï¼šæ‰‹åŠ¨å¤„ç† TCP å¥—æ¥å­—</span></a></h3><p>è™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦ç›´æ¥æ“ä½œ TCP å¥—æ¥å­—ï¼Œä½†å¦‚æœä½ è¦å®ç°ä¸€äº›æ›´åº•å±‚çš„ç½‘ç»œæ“ä½œï¼Œæ¯”å¦‚æ‰‹åŠ¨å¤„ç† TCP æµæˆ–è€…å®ç°æŸç§è‡ªå®šä¹‰çš„åè®®ï¼Œ<code>message.socket</code>å°±å˜å¾—éå¸¸é‡è¦äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/special-endpoint</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ ç›´æ¥ä¸å¥—æ¥å­—é€šä¿¡äº†ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸çš„HTTPå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ­£å¸¸çš„HTTPè¯·æ±‚å“åº”</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœè¯·æ±‚ç‰¹å®šçš„è·¯å¾„<code>/special-endpoint</code>ï¼Œæˆ‘ä»¬å°†ç›´æ¥é€šè¿‡<code>req.socket</code>å†™å…¥ä¿¡æ¯ç»™å®¢æˆ·ç«¯è€Œä¸ä½¿ç”¨ HTTP åè®®çš„æ ¼å¼ï¼Œç„¶åç«‹å³é”€æ¯è¿™ä¸ªå¥—æ¥å­—ã€‚è¿™åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºï¼Œå®é™…åº”ç”¨ä¸­ä½ å¯èƒ½ä¸ä¼šè¿™æ ·åšï¼Œä½†è¿™æ˜¾ç¤ºäº†ä½ å¯ä»¥å¦‚ä½•åˆ©ç”¨<code>message.socket</code>è¿›è¡Œä½çº§åˆ«çš„æ“ä½œã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>message.socket</code>æä¾›äº†å¯¹æ­£åœ¨å¤„ç†çš„ HTTP æ¶ˆæ¯èƒŒåçš„ç½‘ç»œå¥—æ¥å­—çš„è®¿é—®ã€‚è¿™å¯ä»¥è®©ä½ æ‰§è¡Œä¸€äº›é«˜çº§çš„ã€å®šåˆ¶åŒ–çš„æ“ä½œï¼Œè™½ç„¶åœ¨å¤§å¤šæ•°çš„ HTTP åº”ç”¨ä¸­ä½ å¯èƒ½ä¸éœ€è¦ç›´æ¥ä½¿ç”¨å®ƒã€‚å¸Œæœ›ä¸Šé¢çš„ä¾‹å­æœ‰åŠ©äºä½ ç†è§£<code>message.socket</code>çš„æ¦‚å¿µå’Œç”¨é€”ã€‚</p><h3 id="message-statuscode" tabindex="-1"><a class="header-anchor" href="#message-statuscode"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagestatuscode" target="_blank" rel="noopener noreferrer">message.statusCode</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¯ä»¥ä½¿ç”¨ JavaScript è¯­è¨€æ¥å¼€å‘æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œç‰¹åˆ«æ˜¯å¤„ç† HTTP ç½‘ç»œé€šè®¯æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä¸æ‰€è°“çš„â€œå“åº”æ¶ˆæ¯ï¼ˆresponse messageï¼‰â€æ‰“äº¤é“ã€‚</p><p><code>message.statusCode</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº HTTP æ¨¡å—ï¼Œå¹¶ä¸”é€šå¸¸ä¸ HTTP å“åº”æ¶ˆæ¯ï¼ˆå³æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å›å¤ï¼‰ç›¸å…³ã€‚åœ¨ HTTP åè®®ä¸­ï¼Œæ¯ä¸€æ¬¡è¯·æ±‚éƒ½æœ‰ä¸€ä¸ªçŠ¶æ€ç ï¼ˆStatus Codeï¼‰ï¼Œè¿™ä¸ªçŠ¶æ€ç è¡¨æ˜äº†è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œä»¥åŠå¦‚æœä¸æˆåŠŸæ˜¯å‡ºäºä»€ä¹ˆåŸå› ã€‚</p><h3 id="è¯¦ç»†è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è¯¦ç»†è§£é‡Š"><span>è¯¦ç»†è§£é‡Š</span></a></h3><p>å½“ä½ åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼Œæ¥æ”¶åˆ° HTTP å“åº”æ—¶ï¼Œè¯¥å“åº”å¯¹è±¡ä¼šé™„å¸¦ä¸€ä¸ªåä¸º <code>statusCode</code> çš„å±æ€§ã€‚è¿™ä¸ªå±æ€§å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºå“åº”çš„çŠ¶æ€ä»£ç ã€‚</p><p>å¸¸è§çš„ HTTP çŠ¶æ€ç åŒ…æ‹¬ï¼š</p><ul><li><code>200</code>: OK - è¯·æ±‚å·²æˆåŠŸå¤„ç†ã€‚</li><li><code>404</code>: Not Found - æœåŠ¡å™¨æ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚</li><li><code>500</code>: Internal Server Error - æœåŠ¡å™¨é‡åˆ°äº†æ„å¤–æƒ…å†µï¼Œä¸èƒ½å®Œæˆå®¢æˆ·çš„è¯·æ±‚ã€‚</li></ul><h3 id="å®é™…ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-6"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js ç¨‹åºï¼Œéœ€è¦ä»å¦ä¸€ä¸ªç½‘ç«™è·å–æ•°æ®ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ Node.js çš„<code>http</code>æ¨¡å—æ¥å‘é€ä¸€ä¸ª GET è¯·æ±‚ã€‚å½“ä½ æ¥æ”¶åˆ°å“åº”æ—¶ï¼Œä½ ä¼šæ£€æŸ¥ <code>statusCode</code> æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·ä¸€ä¸ªGETè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ ¹æ®çŠ¶æ€ç è¿›è¡Œä¸åŒçš„å¤„ç†</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> ===</span><span style="color:#B48EAD;"> 200</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚æˆåŠŸï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // ...å¤„ç†æˆåŠŸçš„é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> ===</span><span style="color:#B48EAD;"> 404</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœªæ‰¾åˆ°èµ„æºï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // ...å¤„ç†èµ„æºæœªæ‰¾åˆ°çš„é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // ...å¤„ç†å…¶ä»–é”™è¯¯çš„é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">é‡åˆ°é”™è¯¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>http.get</code>æ–¹æ³•å‘<code>http://example.com</code>å‘é€ GET è¯·æ±‚ã€‚è¯·æ±‚è¿”å›åï¼Œæˆ‘ä»¬é€šè¿‡ <code>res.statusCode</code> è·å–çŠ¶æ€ç ï¼Œå¹¶æ‰“å°å®ƒã€‚ç„¶åæ ¹æ®çŠ¶æ€ç çš„ä¸åŒå€¼æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œæ¯”å¦‚å¦‚æœçŠ¶æ€ç æ˜¯ 200ï¼Œåˆ™è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼›å¦‚æœçŠ¶æ€ç æ˜¯ 404ï¼Œåˆ™è¡¨ç¤ºæœªæ‰¾åˆ°è¯·æ±‚çš„èµ„æºï¼Œç­‰ç­‰ã€‚</p><h3 id="æ€»ç»“-18" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-18"><span>æ€»ç»“</span></a></h3><p><code>message.statusCode</code> æ˜¯ Node.js HTTP API ä¸­ç”¨äºè¡¨ç¤º HTTP å“åº”çŠ¶æ€ç çš„å±æ€§ã€‚é€šè¿‡æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ç ï¼Œä½ çš„ç¨‹åºå¯ä»¥åˆ¤æ–­ HTTP è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œå¹¶æ ¹æ®ä¸åŒçš„çŠ¶æ€ç å€¼æ¥æ‰§è¡Œç›¸åº”çš„é€»è¾‘å¤„ç†ã€‚</p><h3 id="message-statusmessage" tabindex="-1"><a class="header-anchor" href="#message-statusmessage"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagestatusmessage" target="_blank" rel="noopener noreferrer">message.statusMessage</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js çš„ä¼—å¤šæ¨¡å—ä¸­ï¼Œ<code>http</code> æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯çš„ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>message.statusMessage</code> æ˜¯ä¸€ä¸ªä¸ HTTP å“åº”ç›¸å…³çš„å±æ€§ã€‚è¿™ä¸ªå±æ€§è¡¨ç¤ºçš„æ˜¯ HTTP å“åº”çŠ¶æ€ç çš„æ–‡æœ¬æè¿°ã€‚HTTP çŠ¶æ€ç æ˜¯ä¸€ä¸ªä¸‰ä½æ•°ï¼Œç”¨äºè¡¨ç¤ºæœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”æƒ…å†µã€‚è€Œ <code>statusMessage</code> åˆ™æ˜¯è¿™ä¸ªçŠ¶æ€ç çš„æ–‡å­—è¯´æ˜ï¼Œæ¯”å¦‚ &quot;200&quot; å¯¹åº”çš„çŠ¶æ€æ¶ˆæ¯æ˜¯ &quot;OK&quot;ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</p><h3 id="å·¥ä½œåŸç†-1" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œåŸç†-1"><span>å·¥ä½œåŸç†</span></a></h3><p>å½“ä½ çš„ Node.js åº”ç”¨ç¨‹åºä½¿ç”¨ <code>http</code> æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸”å½“æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰çš„è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå¯¹è¯¥è¯·æ±‚åšå‡ºå“åº”ã€‚åœ¨è¿™ä¸ªå“åº”ä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„çŠ¶æ€ç å’ŒçŠ¶æ€æ¶ˆæ¯æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚çš„ç»“æœã€‚</p><h3 id="å®é™…ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-7"><span>å®é™…ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨"><span>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></a></h4><p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒæ€»æ˜¯è¿”å›çŠ¶æ€ç  200 å’ŒçŠ¶æ€æ¶ˆæ¯ &quot;OK&quot;ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®çŠ¶æ€ç å’ŒçŠ¶æ€æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">OK</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ä½ é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://localhost:3000/</code> æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›æ–‡æœ¬ &quot;Hello, World!&quot; å¹¶ä¸” HTTP å“åº”çš„çŠ¶æ€ç ä¸º 200ï¼ŒçŠ¶æ€æ¶ˆæ¯ä¸º &quot;OK&quot;ã€‚</p><h4 id="_2-æ ¹æ®ä¸åŒçš„è¯·æ±‚è·¯å¾„è¿”å›ä¸åŒçš„çŠ¶æ€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_2-æ ¹æ®ä¸åŒçš„è¯·æ±‚è·¯å¾„è¿”å›ä¸åŒçš„çŠ¶æ€æ¶ˆæ¯"><span>2. æ ¹æ®ä¸åŒçš„è¯·æ±‚è·¯å¾„è¿”å›ä¸åŒçš„çŠ¶æ€æ¶ˆæ¯</span></a></h4><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®è¯·æ±‚çš„è·¯å¾„è¿”å›ä¸åŒçš„çŠ¶æ€æ¶ˆæ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/success</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">OK</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Success path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 404</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Not Found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœä½ è®¿é—® <code>http://localhost:3000/success</code>ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›çŠ¶æ€ç  200 å’ŒçŠ¶æ€æ¶ˆæ¯ &quot;OK&quot;ï¼›è€Œå¦‚æœä½ è®¿é—® <code>http://localhost:3000/error</code>ï¼ŒæœåŠ¡å™¨åˆ™ä¼šè¿”å›çŠ¶æ€ç  404 å’ŒçŠ¶æ€æ¶ˆæ¯ &quot;Not Found&quot;ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒæœåŠ¡å™¨å¯ä»¥æ›´åŠ çµæ´»åœ°å¤„ç†ä¸åŒç±»å‹çš„è¯·æ±‚ï¼Œå¹¶ä¸”é€šè¿‡çŠ¶æ€ç å’ŒçŠ¶æ€æ¶ˆæ¯è®©å®¢æˆ·ç«¯æ˜ç™½è¯·æ±‚çš„å¤„ç†ç»“æœã€‚</p><h3 id="message-trailers" tabindex="-1"><a class="header-anchor" href="#message-trailers"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagetrailers" target="_blank" rel="noopener noreferrer">message.trailers</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>message.trailers</code>æ˜¯æŒ‡ HTTP æ¶ˆæ¯ï¼ˆè¯·æ±‚æˆ–å“åº”ï¼‰çš„å°¾éƒ¨å­—æ®µï¼Œåˆç§°ä¸ºå°¾éƒ¨å¤´éƒ¨(Trailing Headers)ã€‚HTTP åè®®å…è®¸åœ¨æ¶ˆæ¯ä¸»ä½“ä¹‹åå‘é€é¢å¤–çš„å¤´ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ç§°ä¸º Trailer Headersã€‚ä¸è¿‡ï¼Œå®ƒä»¬å¹¶ä¸å¸¸ç”¨ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰çš„ HTTP å®¢æˆ·ç«¯å’Œä»£ç†éƒ½æ”¯æŒè¿™ä¸€ç‰¹æ€§ã€‚</p><p>è¦ä½¿ç”¨å°¾éƒ¨å¤´éƒ¨ï¼Œé¦–å…ˆï¼Œå¿…é¡»åœ¨æ¶ˆæ¯çš„åˆå§‹å¤´éƒ¨ä¸­å£°æ˜<code>TE: trailers</code>ï¼ˆé’ˆå¯¹è¯·æ±‚ï¼‰æˆ–è€…<code>Transfer-Encoding: chunked</code>ä»¥åŠ<code>Trailer: Header-Name</code>ï¼ˆé’ˆå¯¹å“åº”ï¼‰ã€‚å£°æ˜äº†<code>Trailer</code>åï¼Œå¯ä»¥åˆ—å‡ºå°†ä¼šåœ¨æ¶ˆæ¯å°¾éƒ¨å‘é€çš„å¤´éƒ¨å­—æ®µåç§°ã€‚</p><p>åœ¨ Node.js çš„ http æ¨¡å—ä¸­ï¼Œ<code>message.trailers</code>å¯¹è±¡åŒ…å«è§£æåçš„å°¾éƒ¨å¤´éƒ¨å­—æ®µã€‚è¿™ä¸ªå¯¹è±¡åœ¨æ¶ˆæ¯çš„&#39;end&#39;äº‹ä»¶è§¦å‘æ—¶è¢«å¡«å……ï¼Œåªæœ‰åœ¨æ­¤ä¹‹åæ‰èƒ½è®¿é—®å®ƒä»¬ã€‚</p><p>å®é™…ä¸Šåœ¨ Node.js ä¸­ä½¿ç”¨å°¾éƒ¨å¤´éƒ¨çš„æƒ…å½¢æ¯”è¾ƒå°‘è§ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¼šç”¨åˆ°ï¼Œä¾‹å¦‚ï¼š</p><ol><li><p>å‘é€æ‘˜è¦æˆ–ç­¾åï¼šæœåŠ¡å™¨å¯èƒ½ä¼šåœ¨å‘é€å¤§å‹å“åº”ä½“çš„æ—¶å€™ï¼Œåœ¨ç»“æŸæ—¶å‘é€ä¸€ä¸ªæ‘˜è¦æˆ–ç­¾åä½œä¸ºå°¾éƒ¨å¤´éƒ¨ï¼Œæ¥éªŒè¯å“åº”ä½“æ²¡æœ‰åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚</p></li><li><p>åŠ¨æ€ç”Ÿæˆå†…å®¹ï¼šå½“æœåŠ¡å™¨åŠ¨æ€ç”Ÿæˆå†…å®¹ï¼Œå¹¶ä¸”ç›´åˆ°å…¨éƒ¨å†…å®¹ç”Ÿæˆå®Œæ¯•åæ‰èƒ½çŸ¥é“ä¸€äº›å¤´éƒ¨å­—æ®µçš„å€¼æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å°¾éƒ¨å¤´éƒ¨ã€‚</p></li></ol><p>ä¸‹é¢ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜å¦‚ä½•åœ¨ Node.js ä¸­å‘é€å°¾éƒ¨å¤´éƒ¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”ä¸ºåˆ†å—ä¼ è¾“ç¼–ç </span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Transfer-Encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">chunked</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    Trailer</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“çš„ç¬¬ä¸€éƒ¨åˆ†</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å»¶è¿Ÿå‘é€å“åº”ä½“çš„ç¬¬äºŒéƒ¨åˆ†</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // è®¾ç½®å°¾éƒ¨å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">&quot;someChecksumValue&quot;</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚è¿™ä¸ªæœåŠ¡å™¨å£°æ˜äº†å°†è¦åœ¨å°¾éƒ¨å‘é€çš„<code>Content-MD5</code>å°¾éƒ¨å¤´éƒ¨ï¼Œå¹¶é€šè¿‡<code>res.addTrailers()</code>æ–¹æ³•æ·»åŠ äº†è¿™ä¸ªå¤´éƒ¨çš„å€¼ã€‚æ³¨æ„ï¼Œå°¾éƒ¨å¤´éƒ¨æ˜¯åœ¨è°ƒç”¨<code>res.end()</code>æ–¹æ³•ä¹‹å‰æ·»åŠ çš„ã€‚</p><p>å®¢æˆ·ç«¯ä»è¿™ä¸ªæœåŠ¡å™¨æ¥æ”¶å“åº”æ—¶ï¼Œåœ¨æ¥æ”¶åˆ°æ‰€æœ‰æ•°æ®å—ä¹‹åï¼Œå¯ä»¥åœ¨<code>message.trailers</code>å±æ€§ä¸­è·å–å°¾éƒ¨å¤´éƒ¨çš„å†…å®¹ã€‚ä½†è¯·è®°ä½ï¼Œç”±äºå°¾éƒ¨å¤´éƒ¨çš„æ”¯æŒåº¦å¹¶ä¸å¹¿æ³›ï¼Œæ‰€ä»¥åœ¨è®¾è®¡ API æ—¶åº”è°¨æ…ä½¿ç”¨å®ƒä»¬ã€‚</p><h3 id="message-trailersdistinct" tabindex="-1"><a class="header-anchor" href="#message-trailersdistinct"><span><a href="https://nodejs.org/docs/latest/api/http.html#messagetrailersdistinct" target="_blank" rel="noopener noreferrer">message.trailersDistinct</a></span></a></h3><p>Node.js çš„ <code>message.trailersDistinct</code> æ˜¯ä¸€ä¸ªæ–°å¢åŠ çš„å±æ€§ï¼Œå®ƒå¯ä»¥åœ¨å¤„ç† HTTP æ¶ˆæ¯æ—¶å¸®åŠ©æˆ‘ä»¬åŒºåˆ†åŸå§‹çš„ header å’Œ trailer ä¸­ç›¸åŒåç§°å­—æ®µçš„å€¼ã€‚</p><p>å…ˆæ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ HTTP æ¶ˆæ¯ä¸­çš„ trailersã€‚HTTP åè®®æ”¯æŒåœ¨å“åº”æ¶ˆæ¯ï¼ˆResponseï¼‰çš„æœ«å°¾å‘é€é¢å¤–çš„å¤´ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ç§°ä¸ºâ€œtrailersâ€ã€‚Trailers é€šå¸¸ç”¨äºåœ¨æ¶ˆæ¯ä¸»ä½“å·²ç»å¼€å§‹ä¼ è¾“åï¼Œå‘é€ä¸€äº›æ— æ³•æå‰çŸ¥é“å€¼çš„å¤´ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦åœ¨å‘é€å®Œä¸€ä¸ªå¤§æ–‡ä»¶ä¹‹åï¼Œå‘Šè¯‰æ¥æ”¶æ–¹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ‘˜è¦æˆ–è€…æ ¡éªŒå’Œï¼Œè€Œè¿™ä¸ªä¿¡æ¯åªèƒ½åœ¨æ–‡ä»¶ä¼ è¾“ç»“æŸåæ‰èƒ½è®¡ç®—å‡ºæ¥ã€‚</p><p>ä¸¾ä¸€ä¸ªå®é™…ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨å‘å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªå¤§å‹çš„æ•°æ®æµï¼Œä¾‹å¦‚ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ã€‚åœ¨æ•°æ®æµçš„æœ«å°¾ï¼Œä½ æƒ³æ·»åŠ ä¸€ä¸ªæ ¡éªŒå’Œï¼ˆchecksumï¼‰ä½œä¸º trailer æ¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚å®¢æˆ·ç«¯åœ¨æ¥æ”¶å¹¶å¤„ç†æ•´ä¸ªæ•°æ®æµåï¼Œä¼šæŸ¥çœ‹è¿™ä¸ª trailer æ¥éªŒè¯æ•°æ®æ˜¯å¦åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æŸåã€‚</p><p>åœ¨ Node.js http æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·è®¾ç½®å’Œè¯»å– trailersï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç«¯ä»£ç ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€ headers</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€ä¸»ä½“æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½® trailers çš„ header</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">someChecksumValue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç»“æŸ response å¯¹è±¡ï¼Œå³å®Œæˆå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºå®¢æˆ·ç«¯æ¥è®²ï¼Œåœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ç›‘å¬ <code>&#39;end&#39;</code> äº‹ä»¶æ¥è¯»å– trailersã€‚ä½†æ˜¯åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œæ–°å¢åŠ äº† <code>message.trailersDistinct</code> å±æ€§ï¼Œè¯¥å±æ€§å…è®¸å®¢æˆ·ç«¯åŒºåˆ†åŸå§‹çš„ headers å’Œ trailers ä¸­ç›¸åŒåå­—çš„å­—æ®µã€‚</p><p>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬é‡Œï¼Œå¦‚æœ headers å’Œ trailers æœ‰é‡åå­—æ®µï¼Œå½“è°ƒç”¨ <code>response.trailers</code> æ—¶ä½ å¾—åˆ°çš„æ˜¯ trailers å­—æ®µè¦†ç›–æ‰ headers å­—æ®µçš„ç»“æœã€‚</p><p>ç°åœ¨ï¼Œé€šè¿‡ä½¿ç”¨ <code>message.trailersDistinct</code>ï¼Œä½ å¯ä»¥è·å¾—ä¸€ä¸ªä¸ä¼šä¸ headers æ··æ·†çš„ã€æ˜ç¡®åŒ…å«æ‰€æœ‰ç‹¬ç‰¹çš„ trailer å­—æ®µçš„å¯¹è±¡ã€‚</p><p>è¿™é‡Œæ˜¯å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨å®ƒçš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿™é‡Œæˆ‘ä»¬è¯·æ±‚ä¸Šé¢åˆ›å»ºçš„æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†ä¸»ä½“æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">No more data in response.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // åœ¨å“åº”ç»“æŸåè·å– trailers</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Trailers:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">trailers</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœä½¿ç”¨äº† message.trailersDistinct</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">trailersDistinct</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Distinct Trailers:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">trailersDistinct</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œä½ å¯ä»¥åœ¨ Node.js v21.7.1 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­å®‰å…¨åœ°å¤„ç†å’ŒåŒºåˆ† headers å’Œ trailersï¼Œå³ä½¿å®ƒä»¬æœ‰ç›¸åŒçš„å­—æ®µåä¹Ÿä¸ä¼šå‘ç”Ÿå†²çªï¼Œä»è€Œä½¿å¾— HTTP é€šä¿¡æ›´åŠ å¯é ã€‚</p><h3 id="message-url" tabindex="-1"><a class="header-anchor" href="#message-url"><span><a href="https://nodejs.org/docs/latest/api/http.html#messageurl" target="_blank" rel="noopener noreferrer">message.url</a></span></a></h3><p>å½“æˆ‘ä»¬åœ¨è°ˆè®º Node.js ä¸­çš„<code>message.url</code>å±æ€§æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºçš„æ˜¯ HTTP æ¶ˆæ¯ä¸­çš„ä¸€ä¸ªç‰¹å®šéƒ¨åˆ†ã€‚åœ¨ Node.js çš„ HTTP æ¨¡å—æ–‡æ¡£ä¸­ï¼Œ<code>message</code>å¯¹è±¡ä»£è¡¨ç€ä¸€ä¸ª HTTP è¯·æ±‚ï¼ˆreqï¼‰æˆ–å“åº”ï¼ˆresï¼‰ã€‚è€Œå¯¹äºè¯·æ±‚å¯¹è±¡ï¼ˆå³<code>req</code>ï¼‰ï¼Œ<code>message.url</code>å±æ€§åŒ…å«äº†å¯¹æœåŠ¡å™¨çš„è¯·æ±‚ä¸­çš„ URL å­—ç¬¦ä¸²ã€‚</p><h3 id="ç†è§£message-url" tabindex="-1"><a class="header-anchor" href="#ç†è§£message-url"><span>ç†è§£<code>message.url</code></span></a></h3><p>ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå¸¦æœ‰ä¸€ä¸ª URLï¼Œå®ƒæŒ‡ç¤ºäº†å®¢æˆ·ç«¯æƒ³è¦ä¸ä¹‹äº¤äº‘æ¶Œçš„èµ„æºçš„ä½ç½®ã€‚<code>message.url</code>å°±æ˜¯ç”¨æ¥è·å–è¿™ä¸ª URL çš„è·¯å¾„éƒ¨åˆ†ã€‚</p><p><strong>é‡è¦ç‚¹</strong>ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¾—åˆ°çš„ URL ä¸åŒ…æ‹¬åè®®ï¼ˆå¦‚<code>http://</code>ï¼‰ã€åŸŸåï¼ˆå¦‚<code>example.com</code>ï¼‰å’Œç«¯å£å·ï¼ˆå¦‚<code>:80</code>ï¼‰ã€‚å®ƒä¸»è¦æ˜¯è·¯å¾„ï¼ˆpathï¼‰å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰çš„ç»„åˆã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-24" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-24"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œç”¨äºå¤„ç†ç”¨æˆ·å¯¹ç½‘ç«™æŸäº›èµ„æºçš„è¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥<code>message.url</code>æ¥å†³å®šå¦‚ä½•å“åº”ä¸åŒçš„ URL è¯·æ±‚ã€‚</p><h4 id="ä¾‹å­-1-åŸºç¡€-web-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åŸºç¡€-web-æœåŠ¡å™¨"><span>ä¾‹å­ 1: åŸºç¡€ Web æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è·å–è¯·æ±‚çš„URL</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> url</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ ¹æ®URLè¿”å›ä¸åŒçš„å†…å®¹</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to our homepage</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/about</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Here is our about page</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">404</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Page not found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡æ£€æŸ¥<code>req.url</code>æ¥å†³å®šå‘é€å›å®¢æˆ·ç«¯çš„å“åº”å†…å®¹ã€‚å¦‚æœç”¨æˆ·è®¿é—®æ ¹ç›®å½•ï¼ˆ&#39;/&#39;ï¼‰ï¼Œåˆ™è¿”å›æ¬¢è¿ä¿¡æ¯ï¼›å¦‚æœè®¿é—®&#39;/about&#39;é¡µé¢ï¼Œåˆ™è¿”å›å…³äºé¡µé¢çš„ä¿¡æ¯ï¼›å¦‚æœè®¿é—®çš„æ˜¯å…¶ä»– URLï¼Œåˆ™è¿”å› 404 é”™è¯¯è¡¨ç¤ºé¡µé¢æœªæ‰¾åˆ°ã€‚</p><h4 id="ä¾‹å­-2-ä½¿ç”¨-url-æ¨¡å—è§£ææŸ¥è¯¢å­—ç¬¦ä¸²" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨-url-æ¨¡å—è§£ææŸ¥è¯¢å­—ç¬¦ä¸²"><span>ä¾‹å­ 2: ä½¿ç”¨ URL æ¨¡å—è§£ææŸ¥è¯¢å­—ç¬¦ä¸²</span></a></h4><p>ä» Node.js v11.1.0 å¼€å§‹ï¼Œ<code>url.parse()</code>æ–¹æ³•å·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œæ¨èä½¿ç”¨æ–°çš„<code>URL</code>æ„é€ å‡½æ•°æ¥å¤„ç† URLã€‚ä½†æ˜¯ï¼Œäº†è§£è¿™ä¸€ç‚¹å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨<code>message.url</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> URL</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">url</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ„é€ å®Œæ•´URLï¼ˆå› ä¸ºreq.urlä¸åŒ…å«åè®®å’ŒåŸŸåï¼‰</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> myURL</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">http://</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">host</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è§£ææŸ¥è¯¢å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> searchParams</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> myURL</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">searchParams</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨æŸ¥è¯¢å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">searchParams</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">has</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greeting</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> greeting</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> searchParams</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greeting</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">You sent a greeting: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">greeting</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨<code>URL</code>å¯¹è±¡è§£æè¯·æ±‚çš„å®Œæ•´ URLï¼ŒåŒ…æ‹¬æŸ¥è¯¢å‚æ•°ã€‚å¦‚æœæ£€æµ‹åˆ°æŸ¥è¯¢å‚æ•°ä¸­æœ‰<code>greeting</code>ï¼ŒæœåŠ¡å™¨å°†ä»¥ç›¸åº”çš„é—®å€™è¯­å“åº”è¯·æ±‚ã€‚</p><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>message.url</code>åœ¨ Node.js æœåŠ¡å™¨å¼€å‘ä¸­çš„åŸºæœ¬åº”ç”¨ï¼Œå®ƒä½¿å¾—è·¯ç”±å¤„ç†å’Œè¯·æ±‚å¤„ç†å˜å¾—å¯è¡Œä¸”çµæ´»ã€‚</p><h2 id="class-http-outgoingmessage" tabindex="-1"><a class="header-anchor" href="#class-http-outgoingmessage"><span><a href="https://nodejs.org/docs/latest/api/http.html#class-httpoutgoingmessage" target="_blank" rel="noopener noreferrer">Class: http.OutgoingMessage</a></span></a></h2><p>Node.js ä¸­çš„ <code>http.OutgoingMessage</code> ç±»æ˜¯ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚è¿™ä¸ªç±»å¹¶ä¸ç›´æ¥ç”±å¼€å‘è€…å®ä¾‹åŒ–ï¼ˆåˆ›å»ºå®ä¾‹ï¼‰ï¼Œè€Œæ˜¯åœ¨ Node.js çš„ HTTP æœåŠ¡å†…éƒ¨ä½¿ç”¨ï¼Œä»¥ç”Ÿæˆå’Œæ“ä½œ HTTP å“åº”æˆ–è¯·æ±‚ã€‚</p><h3 id="ç†è§£-http-outgoingmessage" tabindex="-1"><a class="header-anchor" href="#ç†è§£-http-outgoingmessage"><span>ç†è§£ http.OutgoingMessage</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œå½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å‘è¯¥æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒNode.js å°±ä¼šä½¿ç”¨ <code>http.OutgoingMessage</code> çš„å®ä¾‹æ¥ä»£è¡¨å°†è¦å‘é€å›å®¢æˆ·ç«¯çš„å“åº”æ¶ˆæ¯ã€‚ç›¸ä¼¼åœ°ï¼Œåœ¨ Node.js ä¸­å‘èµ· HTTP å®¢æˆ·ç«¯è¯·æ±‚æ—¶, <code>http.OutgoingMessage</code> å®ä¾‹ç”¨äºè¡¨ç¤ºå³å°†å‘é€ç»™æœåŠ¡å™¨çš„è¯·æ±‚æ¶ˆæ¯ã€‚</p><h4 id="å…³é”®å±æ€§å’Œæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å…³é”®å±æ€§å’Œæ–¹æ³•"><span>å…³é”®å±æ€§å’Œæ–¹æ³•</span></a></h4><ul><li><strong>.setHeader(name, value)</strong>: è®¾ç½® HTTP æ¶ˆæ¯å¤´éƒ¨å­—æ®µã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦è®¾ç½®å†…å®¹ç±»å‹æˆ–å“åº”çŠ¶æ€ç ã€‚</li><li><strong>.write(chunk[, encoding][, callback])</strong>: å‘æ¶ˆæ¯ä½“ä¸­å†™å…¥æ•°æ®ã€‚å¦‚æœä½ æƒ³å‘é€ä¸€äº›æ•°æ®ç»™å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ HTML é¡µé¢æˆ– JSON æ•°æ®ï¼‰ï¼Œå°±éœ€è¦ç”¨åˆ°å®ƒã€‚</li><li><strong>.end([data][, encoding][, callback])</strong>: ç»“æŸå“åº”ï¼Œå‘Šè¯‰æœåŠ¡å™¨è¿™ä¸ªæ¶ˆæ¯å·²ç»å®Œæˆï¼Œå¹¶ä¸”å¯ä»¥å‘é€ç»™å®¢æˆ·ç«¯äº†ã€‚</li></ul><h3 id="å®é™…åº”ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨æ¡ˆä¾‹"><span>å®é™…åº”ç”¨æ¡ˆä¾‹</span></a></h3><p>è€ƒè™‘ä¸‹é¢å‡ ä¸ªå®é™…çš„ä½¿ç”¨åœºæ™¯ï¼š</p><h4 id="_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨-1" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨-1"><span>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ ‡è®°å“åº”çŠ¶æ€ä¸º200 OK</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€å“åº”ä½“</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>res</code> å¯¹è±¡å°±æ˜¯ä¸€ä¸ª <code>http.OutgoingMessage</code> çš„å®ä¾‹ã€‚æˆ‘ä»¬é€šè¿‡ <code>setHeader</code> æ¥è®¾å®šå“åº”çš„å†…å®¹ç±»å‹ï¼Œé€šè¿‡ <code>end</code> æ–¹æ³•å‘é€å“åº”ä½“ç»™å®¢æˆ·ç«¯ã€‚</p><h4 id="_2-å‘èµ·ä¸€ä¸ª-http-å®¢æˆ·ç«¯è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-å‘èµ·ä¸€ä¸ª-http-å®¢æˆ·ç«¯è¯·æ±‚"><span>2. å‘èµ·ä¸€ä¸ª HTTP å®¢æˆ·ç«¯è¯·æ±‚</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPè¯·æ±‚çš„é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">STATUS: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">HEADERS: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">BODY: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">problem with request: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®Œæˆè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç é‡Œï¼Œ<code>req</code> å¯¹è±¡æ˜¯ä¸€ä¸ª <code>http.OutgoingMessage</code> å®ä¾‹ã€‚æˆ‘ä»¬é€šè¿‡è¿™ä¸ªå¯¹è±¡å‘èµ·ä¸€ä¸ªå¯¹ <code>www.example.com</code> çš„ GET è¯·æ±‚ã€‚å°½ç®¡è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰æ˜æ˜¾åœ°è°ƒç”¨ <code>setHeader</code> æˆ– <code>write</code> æ–¹æ³•ï¼ˆå› ä¸º GET è¯·æ±‚é€šå¸¸ä¸éœ€è¦å‘é€æ¶ˆæ¯ä½“ï¼‰ï¼Œä½†è¿™å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>http.OutgoingMessage</code> å‘èµ·è¯·æ±‚çš„è¿‡ç¨‹ã€‚</p><h3 id="æ€»ç»“-19" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-19"><span>æ€»ç»“</span></a></h3><p><code>http.OutgoingMessage</code> æ˜¯ Node.js ä¸­å¤„ç† HTTP é€šä¿¡çš„åŸºçŸ³ä¹‹ä¸€ã€‚ç†è§£å…¶ä½œç”¨å’Œå¦‚ä½•ä½¿ç”¨å®ƒå¯¹äºæ„å»ºä»»ä½•æ¶‰åŠ HTTP é€šä¿¡çš„ Node.js åº”ç”¨éƒ½éå¸¸é‡è¦ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯å¤„ç†å“åº”è¿˜æ˜¯å‘èµ·æ–°çš„è¯·æ±‚ï¼Œ<code>http.OutgoingMessage</code> éƒ½æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ§åˆ¶ HTTP æ¶ˆæ¯çš„å„ä¸ªæ–¹é¢ã€‚</p><h3 id="event-drain" tabindex="-1"><a class="header-anchor" href="#event-drain"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-drain" target="_blank" rel="noopener noreferrer">Event: &#39;drain&#39;</a></span></a></h3><p>äº†è§£ Node.js ä¸­çš„ <code>&#39;drain&#39;</code> äº‹ä»¶ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½ Node.js åœ¨å¤„ç† I/O æ“ä½œï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰æ—¶æ˜¯éé˜»å¡çš„ï¼Œå¹¶ä¸”å¤§é‡ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æ¨¡å¼ã€‚è¿™æ„å‘³ç€ Node.js å¯ä»¥åœ¨ä¸ç­‰å¾…ä¸€ä¸ªæ“ä½œå®Œæˆçš„æƒ…å†µä¸‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œæå‡äº†åº”ç”¨çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><h3 id="èƒŒæ™¯-1" tabindex="-1"><a class="header-anchor" href="#èƒŒæ™¯-1"><span>èƒŒæ™¯</span></a></h3><p>å½“æˆ‘ä»¬å‘ä¸€ä¸ªæµï¼ˆstreamï¼‰å†™æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®è¢«æ¥æ”¶è€…ï¼ˆæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿæˆ–ç½‘ç»œå¥—æ¥å­—ï¼‰è¿…é€Ÿå¤„ç†ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½å¥½ã€‚ä½†å¦‚æœæ•°æ®å†™å…¥çš„é€Ÿåº¦è¶…è¿‡äº†æ¥æ”¶æ–¹å¤„ç†çš„é€Ÿåº¦ï¼Œè¿™äº›æ•°æ®å°±ä¼šåœ¨å†…å­˜ä¸­æ’é˜Ÿï¼Œå½¢æˆä¸€ä¸ªç¼“å†²åŒºã€‚ä¸ºäº†é¿å…æ— é™åˆ¶åœ°å¢åŠ å†…å­˜ä½¿ç”¨ï¼Œæµä¼šæœ‰ä¸€ä¸ªå«åšâ€œèƒŒå‹ï¼ˆbackpressureï¼‰â€çš„æœºåˆ¶æ¥æ§åˆ¶æ•°æ®çš„æµåŠ¨é€Ÿç‡ã€‚</p><h3 id="event-drain-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#event-drain-æ˜¯ä»€ä¹ˆ"><span><code>Event: &#39;drain&#39;</code> æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­çš„å¾ˆå¤šå¯¹è±¡éƒ½æ˜¯æµçš„å®ç°ï¼ŒåŒ…æ‹¬ HTTP å“åº”ï¼ˆ<code>http.ServerResponse</code>ï¼‰å¯¹è±¡ã€‚å½“æˆ‘ä»¬ä¸æ–­å‘è¿™ç±»å¯¹è±¡å†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå†…éƒ¨ç¼“å†²åŒºæ»¡äº†ï¼Œ<code>.write()</code> æ–¹æ³•ä¼šè¿”å› <code>false</code>ï¼Œå‘Šè¯‰æˆ‘ä»¬åœæ­¢å†™å…¥æ•°æ®ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç­‰å¾… <code>&#39;drain&#39;</code> äº‹ä»¶å‘ç”Ÿåå†ç»§ç»­å†™å…¥æ›´å¤šæ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œ<code>&#39;drain&#39;</code> äº‹ä»¶è¡¨ç¤ºç°åœ¨å¯ä»¥å®‰å…¨åœ°ç»§ç»­å‘æµä¸­å†™å…¥æ•°æ®ï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿‡åº¦æ¶ˆè€—å†…å­˜ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-15"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å†™å…¥å¤§æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å†™å…¥å¤§æ–‡ä»¶"><span>ç¤ºä¾‹ 1ï¼šå†™å…¥å¤§æ–‡ä»¶</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œéœ€è¦å°†å¤§é‡æ•°æ®å†™å…¥æ–‡ä»¶ã€‚å¦‚æœç›´æ¥è¿ç»­å†™å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æš´å¢ã€‚è¿™æ—¶å€™å°±å¯ä»¥åˆ©ç”¨ <code>&#39;drain&#39;</code> äº‹ä»¶æ¥ä¼˜åŒ–ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fileStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">bigfile.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> writeDataIteratively</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">drain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">nextTick</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ dataChunks æ˜¯ä¸€ä¸ªåŒ…å«å¤§é‡æ•°æ®å—çš„æ•°ç»„</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> currentIndex</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> writeNextChunk</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">currentIndex</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> dataChunks</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å†™å…¥å®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dataChunks</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">currentIndex</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">  writeDataIteratively</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> writeNextChunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">writeNextChunk</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡å°è¯•å†™å…¥æ•°æ®å‰éƒ½æ£€æŸ¥ <code>.write()</code> çš„è¿”å›å€¼ã€‚å¦‚æœè¿”å›äº† <code>false</code>ï¼Œæˆ‘ä»¬å°±ç­‰å¾… <code>&#39;drain&#39;</code> äº‹ä»¶ä¹‹åå†ç»§ç»­å†™å…¥ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼Œé˜²æ­¢å› ä¸ºå¤§é‡æ•°æ®å†™å…¥è€Œé€ æˆçš„å†…å­˜æº¢å‡ºé—®é¢˜ã€‚</p><h4 id="ç¤ºä¾‹-2-ç½‘ç»œé€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç½‘ç»œé€šä¿¡"><span>ç¤ºä¾‹ 2ï¼šç½‘ç»œé€šä¿¡</span></a></h4><p>å½“ä½ åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡ï¼Œå®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ®åˆ°æœåŠ¡å™¨æ—¶ï¼Œä¹Ÿå¯èƒ½ä¼šé‡åˆ°ç›¸ä¼¼çš„æƒ…å½¢ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is pausing receiving data because of backpressure</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">drain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is now ready to continue receiving data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 8000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç®€å•åœ°å°†æ¥æ”¶åˆ°çš„æ•°æ®å›é€ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå†™å›å®¢æˆ·ç«¯çš„é€Ÿåº¦è·Ÿä¸ä¸Šæ¥æ”¶çš„é€Ÿåº¦ï¼ŒæœåŠ¡å™¨ä¼šæš‚æ—¶åœæ­¢æ¥æ”¶æ•°æ®ï¼Œç›´åˆ° <code>&#39;drain&#39;</code> äº‹ä»¶è§¦å‘ï¼Œè¡¨æ˜ç°åœ¨å¯ä»¥å®‰å…¨åœ°ç»§ç»­å‘é€æ•°æ®ã€‚</p><h3 id="ç»“è®º-4" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-4"><span>ç»“è®º</span></a></h3><p>é€šè¿‡æ­£ç¡®å¤„ç† <code>&#39;drain&#39;</code> äº‹ä»¶ï¼Œä½ å¯ä»¥æ„å»ºæ›´ä¸ºå¥å£®ä¸”é«˜æ•ˆçš„ Node.js åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¤„ç†å¤§é‡æ•°æ®çš„åœºæ™¯ä¸‹ã€‚å®ƒæ˜¯ Node.js æµèƒŒå‹ç®¡ç†æœºåˆ¶çš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†ï¼Œç¡®ä¿äº†åº”ç”¨åœ¨é¢å¯¹å¤§æ•°æ®è´Ÿè½½æ—¶ä¸ä¼šè¿‡åº¦æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚</p><h3 id="event-finish-3" tabindex="-1"><a class="header-anchor" href="#event-finish-3"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-finish_2" target="_blank" rel="noopener noreferrer">Event: &#39;finish&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªèƒ½è®©ä½ ä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„è¿è¡Œç¯å¢ƒã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…å»ºçš„æ¨¡å—å’Œäº‹ä»¶ï¼Œå¸®åŠ©ä½ æ„å»ºé«˜æ•ˆä¸”åŠŸèƒ½å¼ºå¤§çš„åº”ç”¨ç¨‹åºã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸“æ³¨äºç†è§£ <code>http</code> æ¨¡å—ä¸­çš„ <code>&#39;finish&#39;</code> äº‹ä»¶ã€‚</p><h3 id="event-finish-4" tabindex="-1"><a class="header-anchor" href="#event-finish-4"><span>Event: &#39;finish&#39;</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <strong>äº‹ä»¶é©±åŠ¨æ¨¡å‹</strong>ã€‚Node.js å¤§é‡ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†è¯¸å¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰å¼‚æ­¥æ“ä½œã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œå½“æŸäº›ç‰¹å®šåŠ¨ä½œå®Œæˆæ—¶ï¼Œä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ï¼Œç„¶åè°ƒç”¨ä¸ä¹‹å…³è”çš„å›è°ƒå‡½æ•°ã€‚</p><p>åœ¨ <code>http</code> æ¨¡å—ï¼ˆè¢«ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼‰ä¸­çš„ <code>&#39;finish&#39;</code> äº‹ä»¶æ˜¯ä¸€ä¸ªç‰¹åˆ«çš„äº‹ä»¶ï¼Œå®ƒå…³è”ç€ <strong>å¯å†™æµ</strong> çš„ç»“æŸã€‚å½“ä½ åœ¨ Node.js ä¸­å†™å…¥æ•°æ®åˆ°å“åº”ï¼ˆresponseï¼‰å¯¹è±¡æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨å‘ä¸€ä¸ªå¯å†™æµä¸­å†™å…¥æ•°æ®ã€‚ä¸€æ—¦æ‰€æœ‰æ•°æ®è¢«å†™å…¥åˆ°æµä¸­ï¼Œå¹¶ä¸”è¯¥æµè¢«ç»“æŸï¼Œé‚£ä¹ˆ <code>&#39;finish&#39;</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-25" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-25"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘é¡µæœåŠ¡å™¨ï¼Œæ¯å½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä½ æƒ³å‘é€ä¸€äº›æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œç„¶åè®°å½•æ—¥å¿—è¡¨ç¤ºå‘é€æ“ä½œå·²å®Œæˆã€‚ä¸‹é¢æ˜¯å¦‚ä½•åˆ©ç”¨ <code>&#39;finish&#39;</code> äº‹ä»¶æ¥å®ç°è¿™ä¸ªéœ€æ±‚çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç»“æŸå“åº”ï¼Œå¦‚æœä¸è°ƒç”¨res.end(), å®¢æˆ·ç«¯å°†æ°¸è¿œå¤„äºç­‰å¾…çŠ¶æ€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is the end of the message.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬ &#39;finish&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">All data has been sent to the client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç›‘å¬ 3000 ç«¯å£ã€‚æ¯å½“æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€â€œHello, world!â€è·Ÿç€æ˜¯â€œThis is the end of the message.â€åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨å‘é€å®Œæˆåï¼Œé€šè¿‡ <code>&#39;finish&#39;</code> äº‹ä»¶æ‰“å°å‡ºæç¤ºä¿¡æ¯ã€‚</p><h3 id="å…³é”®ç‚¹" tabindex="-1"><a class="header-anchor" href="#å…³é”®ç‚¹"><span>å…³é”®ç‚¹</span></a></h3><ul><li><strong>äº‹ä»¶é©±åŠ¨æ¨¡å‹</strong>ï¼šNode.js ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚</li><li><strong><code>&#39;finish&#39;</code> äº‹ä»¶</strong>ï¼šç‰¹æŒ‡åœ¨ HTTP æ¨¡å—ä¸­ï¼Œå½“ response å¯¹è±¡çš„å¯å†™æµç»“æŸæ—¶è§¦å‘ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šå¯ä»¥ç”¨æ¥æ‰§è¡Œæ¸…ç†ä»»åŠ¡ã€è®°å½•æ—¥å¿—ã€å‘é€é€šçŸ¥ç­‰ï¼Œåœ¨ç¡®è®¤å®¢æˆ·ç«¯å·²æ¥æ”¶å…¨éƒ¨æ•°æ®åæ‰§è¡Œçš„æ“ä½œã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js åˆ©ç”¨äº‹ä»¶å’Œå›è°ƒå‡½æ•°ï¼Œä½¿å¾—å¼€å‘å¼‚æ­¥ç¼–ç¨‹å˜å¾—ç›´è§‚å’Œé«˜æ•ˆã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ <code>&#39;finish&#39;</code> äº‹ä»¶åœ¨ Node.js ä¸­çš„åº”ç”¨ã€‚</p><h3 id="event-prefinish" tabindex="-1"><a class="header-anchor" href="#event-prefinish"><span><a href="https://nodejs.org/docs/latest/api/http.html#event-prefinish" target="_blank" rel="noopener noreferrer">Event: &#39;prefinish&#39;</a></span></a></h3><p>Node.js ä¸­çš„ &quot;prefinish&quot; äº‹ä»¶æ˜¯ä¸€ä¸ªæµï¼ˆStreamsï¼‰å’Œ HTTP æ¨¡å—ç›¸å…³çš„é«˜çº§æ¦‚å¿µï¼Œæ‰€ä»¥åœ¨è§£é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªåŸºç¡€çš„ç‚¹ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†-1"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><ul><li><strong>Node.js</strong>ï¼šä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå¹¿æ³›ç”¨äºåˆ›å»ºç½‘ç«™åç«¯æœåŠ¡ã€‚</li><li><strong>æµ(Streams)</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨æ¥å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®å°±åƒæ˜¯æ°´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚è¿™æ˜¯ä¸€ç§å¾ˆé«˜æ•ˆçš„å¤„ç†å¤§é‡æ•°æ®çš„æ–¹æ³•ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œé€šä¿¡ã€‚</li><li><strong>HTTP æ¨¡å—</strong>ï¼šè¿™æ˜¯ Node.js å†…ç½®çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºåˆ›å»º Web æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚å½“ä½ ä½¿ç”¨ Node.js å¼€å‘ç½‘ç«™æˆ–ç½‘ç»œåº”ç”¨æ—¶ï¼Œè¿™ä¸ªæ¨¡å—éå¸¸é‡è¦ã€‚</li></ul><h3 id="event-prefinish-1" tabindex="-1"><a class="header-anchor" href="#event-prefinish-1"><span>Event: &#39;prefinish&#39;</span></a></h3><p><code>&#39;prefinish&#39;</code> äº‹ä»¶åœ¨ Node.js çš„æµï¼ˆStreamsï¼‰å’ŒæŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„ HTTP æ¨¡å—ä¸­å‡ºç°ã€‚å®ƒä¸»è¦ä¸æµçš„ç»“æŸè¿‡ç¨‹æœ‰å…³ã€‚</p><h4 id="ç®€å•ç†è§£" tabindex="-1"><a class="header-anchor" href="#ç®€å•ç†è§£"><span>ç®€å•ç†è§£</span></a></h4><p>å½“ä¸€ä¸ªæµå³å°†å®Œæˆå…¶å†™å…¥æ“ä½œï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ­£å¼ç»“æŸï¼ˆå³è¿˜æ²¡æœ‰è§¦å‘ <code>&#39;finish&#39;</code> äº‹ä»¶ï¼‰æ—¶ï¼Œä¼šè§¦å‘ <code>&#39;prefinish&#39;</code> äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶ç»™ä½ ä¸€ä¸ªæœºä¼šï¼Œåœ¨æµæ­£å¼ç»“æŸä¹‹å‰ï¼Œè¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œæˆ–è€…æœ€åçš„æ•°æ®å¤„ç†ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-26" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-26"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><ol><li><strong>æ–‡ä»¶å†™å…¥ç›‘æ§</strong>ï¼šæƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨ç”¨ Node.js å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦å‘ä¸€ä¸ªæ–‡ä»¶å†™å…¥å¤§é‡æ•°æ®ã€‚é€šè¿‡ç›‘å¬ <code>&#39;prefinish&#39;</code> äº‹ä»¶ï¼Œä½ å¯ä»¥åœ¨æ–‡ä»¶å†™å…¥å³å°†å®Œæˆæ—¶ï¼Œæ‰§è¡Œä¸€äº›é¢å¤–çš„é€»è¾‘ï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œè¡¨ç¤ºæ–‡ä»¶å³å°†å†™å…¥å®Œæ¯•ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> writableStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">writableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">prefinish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–‡ä»¶å†™å…¥å³å°†å®Œæˆã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ç½‘ç»œè¯·æ±‚å¤„ç†</strong>ï¼šå½“ä½ åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œå¹¶ä¸”åœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œå¯èƒ½éœ€è¦åœ¨å“åº”å®Œå…¨å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰ï¼Œåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è®°å½•ä¸€äº›ä¿¡æ¯æˆ–è€…å…³é—­æ•°æ®åº“è¿æ¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">prefinish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”å³å°†å‘é€è‡³å®¢æˆ·ç«¯ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // åœ¨è¿™é‡Œæ‰§è¡Œä»»ä½•å‡†å¤‡æ€§çš„æ¸…ç†å·¥ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å°ç»“-6" tabindex="-1"><a class="header-anchor" href="#å°ç»“-6"><span>å°ç»“</span></a></h4><p><code>&#39;prefinish&#39;</code> äº‹ä»¶ä¸ºå¼€å‘è€…åœ¨æµæˆ– HTTP å“åº”ç»“æŸå‰æä¾›äº†ä¸€ä¸ªå®æ–½è‡ªå®šä¹‰é€»è¾‘çš„æœºä¼šï¼Œä»è€Œèƒ½å¤Ÿæ›´åŠ çµæ´»åœ°ç®¡ç†èµ„æºå’Œæ•°æ®ã€‚é€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼ŒNode.js å¼ºåŒ–äº†å¯¹äºå¼‚æ­¥æ“ä½œçš„æ§åˆ¶ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´ç²¾ç»†åœ°å¤„ç†å¤æ‚çš„æ•°æ®æµåœºæ™¯ã€‚</p><h3 id="outgoingmessage-addtrailers-headers" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-addtrailers-headers"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageaddtrailersheaders" target="_blank" rel="noopener noreferrer">outgoingMessage.addTrailers(headers)</a></span></a></h3><p>ç†è§£ Node.js ä¸­çš„ <code>outgoingMessage.addTrailers(headers)</code> åŠŸèƒ½ï¼Œé¦–å…ˆéœ€è¦äº†è§£ HTTP åè®®ä¸­çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚åœ¨ HTTP/1.1 ç‰ˆæœ¬ä¸­ï¼Œä¸€ä¸ªæ¶ˆæ¯ç”±å¤´éƒ¨ï¼ˆheadersï¼‰ã€å¯é€‰çš„æ¶ˆæ¯ä½“ï¼ˆbodyï¼‰å’Œå°¾éƒ¨ï¼ˆtrailersï¼‰ç»„æˆã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å…³æ³¨çš„ä¿¡æ¯éƒ½æ˜¯åœ¨å¤´éƒ¨å’Œæ¶ˆæ¯ä½“ä¸­ã€‚ç„¶è€Œï¼Œå°¾éƒ¨ï¼ˆtrailersï¼‰ä¹Ÿå¯ä»¥æä¾›ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯åœ¨ä¼ è¾“ç¼–ç ï¼ˆtransfer encodingï¼‰ä¸ºåˆ†å—ï¼ˆchunkedï¼‰æ—¶ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-7" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-7"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><p><strong>Headers:</strong> è¿™äº›æ˜¯åœ¨ HTTP æ¶ˆæ¯å¼€å§‹æ—¶å‘é€çš„é”®å€¼å¯¹ï¼ŒåŒ…å«äº†å…³äºè¯·æ±‚æˆ–å“åº”çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ã€é•¿åº¦ç­‰ã€‚</p></li><li><p><strong>Body:</strong> æ˜¯éšç€è¯·æ±‚æˆ–å“åº”å‘é€çš„å®é™…æ•°æ®ã€‚</p></li><li><p><strong>Trailers:</strong> è¿™äº›æ˜¯åœ¨æ¶ˆæ¯ä½“ä¹‹åå‘é€çš„ã€ç±»ä¼¼äºå¤´éƒ¨çš„é¢å¤–é”®å€¼å¯¹ã€‚ä¸è¿‡ï¼Œå¹¶éæ‰€æœ‰çš„ HTTP å®¢æˆ·ç«¯éƒ½èƒ½æ­£ç¡®å¤„ç†å°¾éƒ¨ã€‚</p></li></ul><h3 id="ä½¿ç”¨åœºæ™¯-2" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-2"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p><code>outgoingMessage.addTrailers(headers)</code> æ–¹æ³•å…è®¸ä½ åœ¨ Node.js çš„ HTTP å“åº”æˆ–è¯·æ±‚ä¸­æ·»åŠ å°¾éƒ¨ã€‚è¿™ä¸ªæ–¹æ³•ç‰¹åˆ«é€‚åˆåœ¨å“åº”çš„ä¸»ä½“æ•°æ®å·²ç»è¢«å‘é€ï¼Œä½†åœ¨æ¶ˆæ¯çš„æœ€ç»ˆç»“æŸä¹‹å‰ï¼Œéœ€è¦æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®æ—¶ä½¿ç”¨ã€‚</p><h3 id="å®é™…ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-8"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨å‘å®¢æˆ·ç«¯å‘é€å¤§é‡çš„æ•°æ®ï¼Œä¾‹å¦‚æ–‡ä»¶å†…å®¹æˆ–æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼Œå¹¶ä¸”ä½ æƒ³åœ¨æ‰€æœ‰æ•°æ®ä¼ è¾“å®Œæ¯•åï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯ä¸€äº›æ‘˜è¦ä¿¡æ¯æˆ–çŠ¶æ€ï¼Œè¿™æ—¶ <code>addTrailers</code> å°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚</p><h4 id="ä¾‹å­-1-å‘é€æ–‡ä»¶å†…å®¹åŠå…¶æ‘˜è¦" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å‘é€æ–‡ä»¶å†…å®¹åŠå…¶æ‘˜è¦"><span>ä¾‹å­ 1ï¼šå‘é€æ–‡ä»¶å†…å®¹åŠå…¶æ‘˜è¦</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> fileName</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/path/to/large/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»ºä¸€ä¸ªç”¨äºè®¡ç®—æ–‡ä»¶å†…å®¹æ‘˜è¦çš„ hash å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Transfer-Encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">chunked</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> fileStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fileName</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ›´æ–° hash å¯¹è±¡ä¸æ–‡ä»¶å†…å®¹çš„æ‘˜è¦</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> digest</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> digest</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ–‡ä»¶å…¨éƒ¨å‘é€å®Œæ¯•åï¼Œé€šè¿‡å°¾éƒ¨å‘é€æ‘˜è¦</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä¼šå‘é€ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ç»™å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨æ‰€æœ‰æ•°æ®ä¼ è¾“å®Œæ¯•åï¼Œé€šè¿‡å°¾éƒ¨å‘ŠçŸ¥å®¢æˆ·ç«¯æ–‡ä»¶å†…å®¹çš„ SHA-256 æ‘˜è¦ã€‚è¿™åœ¨å®¢æˆ·ç«¯éœ€è¦éªŒè¯æ•°æ®å®Œæ•´æ€§çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚</p><h4 id="ä¾‹å­-2-åŠ¨æ€ç”Ÿæˆå†…å®¹åŠå…¶é•¿åº¦" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-åŠ¨æ€ç”Ÿæˆå†…å®¹åŠå…¶é•¿åº¦"><span>ä¾‹å­ 2ï¼šåŠ¨æ€ç”Ÿæˆå†…å®¹åŠå…¶é•¿åº¦</span></a></h4><p>å¦‚æœä½ çš„åº”ç”¨æ˜¯åŠ¨æ€ç”Ÿæˆå†…å®¹ï¼Œå¹¶ä¸”ç›´åˆ°å…¨éƒ¨å†…å®¹ç”Ÿæˆå®Œæ¯•æ‰èƒ½çŸ¥é“å…¶é•¿åº¦ï¼Œå¯ä»¥ä½¿ç”¨å°¾éƒ¨æ¥å‘ŠçŸ¥å†…å®¹çš„å®é™…é•¿åº¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> content</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾ generateContent æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåŠ¨æ€ç”Ÿæˆå†…å®¹</span></span>
<span class="line"><span style="color:#D8DEE9;">  content</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> generateContent</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Transfer-Encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">chunked</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">content</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> content</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åœ¨æ‰€æœ‰å†…å®¹å‘é€å®Œæ¯•åï¼Œé€šè¿‡å°¾éƒ¨å‘ŠçŸ¥å†…å®¹é•¿åº¦</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> generateContent</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åŠ¨æ€ç”Ÿæˆå†…å®¹çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">`&lt;`html&gt;...`&lt;`/html&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js åº”ç”¨ä¸­ä½¿ç”¨ <code>outgoingMessage.addTrailers(headers)</code> æ¥å¢å¼º HTTP å“åº”çš„åŠŸèƒ½ï¼Œæä¾›é¢å¤–çš„ã€åœ¨æ¶ˆæ¯å¼€å§‹æ—¶æ— æ³•ç¡®å®šçš„ä¿¡æ¯ã€‚</p><h3 id="outgoingmessage-appendheader-name-value" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-appendheader-name-value"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageappendheadername-value" target="_blank" rel="noopener noreferrer">outgoingMessage.appendHeader(name, value)</a></span></a></h3><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js åˆ›å»º Web æœåŠ¡å™¨æˆ–åº”ç”¨æ—¶ï¼Œç»å¸¸éœ€è¦ä¸å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰äº¤æµä¿¡æ¯ã€‚è¿™ç§ä¿¡æ¯äº¤æ¢é€šå¸¸é€šè¿‡ HTTP è¯·æ±‚å’Œå“åº”è¿›è¡Œã€‚æ¯ä¸ª HTTP è¯·æ±‚å’Œå“åº”éƒ½åŒ…å«äº†ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œç§°ä¸ºâ€œå¤´éƒ¨ï¼ˆHeadersï¼‰â€ï¼Œå®ƒä»¬æä¾›äº†å…³äºä¼ è¾“æ•°æ®çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¤´éƒ¨å¯ä»¥å‘Šè¯‰æµè§ˆå™¨å¦‚ä½•è§£é‡Šæ”¶åˆ°çš„æ•°æ®ï¼Œæˆ–è€…å‘Šè¯‰æœåŠ¡å™¨å®¢æˆ·ç«¯çš„åå¥½è®¾ç½®ç­‰ã€‚</p><p><code>outgoingMessage.appendHeader(name, value)</code>æ˜¯ Node.js ä¸­ç”¨æ¥æ·»åŠ  HTTP å¤´éƒ¨åˆ°ä¸€ä¸ªå³å°†å‘é€çš„æ¶ˆæ¯ä¸­çš„æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œâ€œå³å°†å‘é€çš„æ¶ˆæ¯â€å¯èƒ½æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚æˆ–è€…å“åº”ã€‚è¿™ä¸ªæ–¹æ³•è®©ä½ èƒ½å¤Ÿè¿½åŠ å¤´éƒ¨ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æ›¿æ¢æ‰å·²ç»å­˜åœ¨çš„åŒåå¤´éƒ¨ã€‚è¿™ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæŸäº›æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªå¤´éƒ¨åç§°å¯èƒ½éœ€è¦æºå¸¦å¤šä¸ªå€¼ã€‚</p><h3 id="åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><ul><li><strong>name</strong>ï¼šå¤´éƒ¨åç§°ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li><li><strong>value</strong>ï¼šå¤´éƒ¨çš„å€¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Header-Name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HeaderValue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¾‹å­-27" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-27"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-è®¾ç½®-cookies" tabindex="-1"><a class="header-anchor" href="#_1-è®¾ç½®-cookies"><span>1. è®¾ç½® Cookies</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè®¾ç½®å¤šä¸ª cookie ä»¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯å’Œåå¥½è®¾ç½®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Set-Cookie</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user_id=12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Set-Cookie</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">preferences=dark_mode</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cookies are set.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>appendHeader</code>ä¸¤æ¬¡æ¥æ·»åŠ ä¸¤ä¸ªä¸åŒçš„<code>Set-Cookie</code>å¤´éƒ¨ã€‚è¿™ä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªå“åº”ä¸­å‘å®¢æˆ·ç«¯å‘é€å¤šä¸ª cookieã€‚</p><h4 id="_2-æ§åˆ¶ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-æ§åˆ¶ç¼“å­˜"><span>2. æ§åˆ¶ç¼“å­˜</span></a></h4><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå†…å®¹æ›´æ–°é¢‘ç¹çš„åŠ¨æ€ç½‘ç«™ï¼Œå¹¶æƒ³è¦ç²¾ç»†æ§åˆ¶æµè§ˆå™¨å’Œä»£ç†æœåŠ¡å™¨å¦‚ä½•ç¼“å­˜é¡µé¢ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cache-Control</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">no-cache</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cache-Control</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">no-store</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Caching rules are applied.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡<code>appendHeader</code>æ·»åŠ <code>Cache-Control</code>å¤´éƒ¨ï¼Œå¹¶æŒ‡å®š<code>no-cache</code>å’Œ<code>no-store</code>ï¼Œå¯ä»¥æŒ‡ç¤ºå®¢æˆ·ç«¯å’Œä»£ç†ä¸åº”ç¼“å­˜è¿™æ¬¡å“åº”çš„å†…å®¹ã€‚</p><h4 id="_3-å®ç°å†…å®¹åå•†" tabindex="-1"><a class="header-anchor" href="#_3-å®ç°å†…å®¹åå•†"><span>3. å®ç°å†…å®¹åå•†</span></a></h4><p>åœ¨æ„å»ºæ”¯æŒå¤šç§è¯­è¨€çš„ Web åº”ç”¨æ—¶ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å®¢æˆ·ç«¯çš„è¯­è¨€åå¥½è¿”å›ä¸åŒè¯­è¨€ç‰ˆæœ¬çš„å†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æ¨¡æ‹Ÿä»è¯·æ±‚ä¸­è¯»å–â€œAccept-Languageâ€å¤´éƒ¨æ¥å†³å®šå†…å®¹è¯­è¨€</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> language</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">accept-language</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">language</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">en</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Language</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">en</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">language</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fr</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Language</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">fr</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Bonjour!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Language</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">en</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨æ ¹æ®è¯·æ±‚ä¸­çš„<code>Accept-Language</code>å¤´éƒ¨æ¥å†³å®šä½¿ç”¨ä½•ç§è¯­è¨€å“åº”å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨<code>appendHeader</code>æ–¹æ³•æ·»åŠ ç›¸åº”çš„<code>Content-Language</code>å¤´éƒ¨ã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>appendHeader</code>åœ¨å®é™…å¼€å‘ä¸­çš„å¤šç§ç”¨é€”ï¼Œæ— è®ºæ˜¯ç®¡ç† cookieã€æ§åˆ¶ç¼“å­˜è¿˜æ˜¯å®ç°å†…å®¹åå•†ï¼Œå®ƒéƒ½æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·ã€‚</p><h3 id="outgoingmessage-connection" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-connection"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageconnection" target="_blank" rel="noopener noreferrer">outgoingMessage.connection</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—å«åš <code>http</code>ï¼Œè¿™ä¸ªæ¨¡å—å…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è¿™å°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ç”¨ Node.js æ¥æ”¶å’Œå‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚æ„å»ºç½‘ç«™åç«¯æˆ–è€…ä¸å…¶ä»–æœåŠ¡çš„ API è¿›è¡Œäº¤äº’ã€‚</p><p>åœ¨ <code>http</code> æ¨¡å—ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š<code>IncomingMessage</code> å’Œ <code>OutgoingMessage</code>ã€‚<code>IncomingMessage</code> å¯¹è±¡è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå½“åˆ«äººé€šè¿‡æµè§ˆå™¨è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼‰ï¼Œè€Œ <code>OutgoingMessage</code> å¯¹è±¡åˆ™ç”¨äºå‘é€æ•°æ®ï¼ˆå“åº”è®¿é—®è€…çš„è¯·æ±‚ï¼‰ã€‚</p><h3 id="outgoingmessage-connection-1" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-connection-1"><span>outgoingMessage.connection</span></a></h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº <code>outgoingMessage.connection</code>ã€‚è¿™æ˜¯ <code>OutgoingMessage</code> å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œæä¾›äº†å¯¹åº•å±‚ç½‘ç»œè¿æ¥çš„å¼•ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§è·å–å¹¶æ“ä½œä¸å½“å‰å“åº”ç›¸å…³çš„ç½‘ç»œè¿æ¥çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>ä½†åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨ <code>outgoingMessage.connection</code> å¯èƒ½ä¸æ˜¯æœ€ä½³å®è·µã€‚è‡ª Node.js v13.0.0 èµ·ï¼Œè¿™ä¸ª API å·²è¢«åºŸå¼ƒï¼Œå®˜æ–¹æ–‡æ¡£å»ºè®®ç›´æ¥ä½¿ç”¨ <code>outgoingMessage.socket</code> ä½œä¸ºæ›¿ä»£ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-28" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-28"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><ol><li><p><strong>ç ”ç©¶ç½‘ç»œè¿æ¥çš„çŠ¶æ€</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“ä¸€ä¸ªç‰¹å®šå“åº”çš„åº•å±‚ TCP è¿æ¥æ˜¯å¦ä»ç„¶å¼€æ”¾ï¼Œæˆ–è€…è·å–ä¸€äº›å…³äºè¿æ¥çš„ç»Ÿè®¡ä¿¡æ¯ã€‚é€šè¿‡ <code>outgoingMessage.connection</code>ï¼ˆæˆ–æ›´æ¨èçš„ <code>outgoingMessage.socket</code>ï¼‰ï¼Œä½ å¯ä»¥è·å¾—è¿™æ ·çš„ä¿¡æ¯ã€‚</p></li><li><p><strong>é«˜çº§ç½‘ç»œæ“ä½œ</strong>ï¼šå¦‚æœä½ éœ€è¦è¿›è¡Œä¸€äº›æ›´é«˜çº§çš„ç½‘ç»œæ“ä½œï¼Œæ¯”å¦‚è®¾ç½®è¶…æ—¶ï¼Œæˆ–è€…æ‰‹åŠ¨å…³é—­è¿æ¥ç­‰ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿä¼šéå¸¸æœ‰ç”¨ã€‚è™½ç„¶å¤§éƒ¨åˆ†æ—¶å€™ Node.js çš„é»˜è®¤è¡Œä¸ºå·²ç»è¶³å¤Ÿå¥½ï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ§åˆ¶è¿™äº›ç»†èŠ‚å¯èƒ½æ˜¯å¿…è¦çš„ã€‚</p></li></ol><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå¦‚æœä½ æƒ³æ£€æŸ¥å½“å‰çš„å“åº”æ˜¯å¦ä½¿ç”¨äº†æŒä¹…è¿æ¥ï¼ˆKeep-Aliveï¼‰ï¼Œä½ å¯ä»¥è¿™ä¹ˆåšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> connection</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">connection</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æˆ– res.socket</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">connection</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">keepAlive</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºè¿æ¥çš„ keepAlive çŠ¶æ€</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿ç›´æ¥æ“ä½œåº•å±‚è¿æ¥å¯èƒ½çœ‹èµ·æ¥åŠŸèƒ½å¼ºå¤§ï¼Œä½†å¤§å¤šæ•°æ—¥å¸¸å¼€å‘ä»»åŠ¡ä¸­å¹¶ä¸éœ€è¦è¿™ä¹ˆåšã€‚Node.js å’Œå…¶ <code>http</code> æ¨¡å—å·²ç»å°è£…äº†ç»å¤§å¤šæ•°ä½ éœ€è¦çš„åŠŸèƒ½ï¼Œè®©ä½ èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>outgoingMessage.connection</code> æä¾›äº†ä¸€ä¸ªé€šé“å»äº†è§£å’Œæ§åˆ¶ HTTP å“åº”çš„åº•å±‚ç½‘ç»œè¿æ¥ã€‚ä½†è€ƒè™‘åˆ°æœ€æ–°çš„å®è·µå’Œ API æ›´æ–°ï¼Œå»ºè®®ä½¿ç”¨ <code>outgoingMessage.socket</code> è·å–ç›¸åŒçš„åŠŸèƒ½ï¼Œå¹¶å§‹ç»ˆç•™æ„ Node.js å®˜æ–¹æ–‡æ¡£ä¸­çš„æœ€æ–°å˜åŒ–å’Œæ¨èåšæ³•ã€‚</p><h3 id="outgoingmessage-cork" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-cork"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagecork" target="_blank" rel="noopener noreferrer">outgoingMessage.cork()</a></span></a></h3><p>Node.js ä¸­çš„<code>outgoingMessage.cork()</code>æ˜¯ä¸€ä¸ªä¸æµ(streams)å’Œç½‘ç»œæ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„æ–¹æ³•ã€‚ä¸ºäº†æ·±å…¥ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦åˆ†å‡ ä¸ªéƒ¨åˆ†æ¥è®¨è®ºï¼šé¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„ <code>OutgoingMessage</code>ï¼Œå…¶æ¬¡æ˜¯ <code>cork()</code> æ–¹æ³•çš„ä½œç”¨ï¼Œæœ€åé€šè¿‡ä¸€äº›å®é™…ä¾‹å­æ¥è¯´æ˜å®ƒçš„åº”ç”¨ã€‚</p><h3 id="_1-ä»€ä¹ˆæ˜¯-outgoingmessage" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯-outgoingmessage"><span>1. ä»€ä¹ˆæ˜¯ OutgoingMessageï¼Ÿ</span></a></h3><p>åœ¨ Node.js çš„ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>OutgoingMessage</code> æ˜¯ä¸€ä¸ªè¡¨ç¤ºå³å°†å‘é€çš„æ¶ˆæ¯çš„å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æˆ–è€…ä¸€ä¸ªæœåŠ¡å™¨å“åº”ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä½ éœ€è¦ç»™è¿™ä¸ªè¯·æ±‚å‘é€ä¸€ä¸ªå“åº”ã€‚è¿™ä¸ªå“åº”å°±æ˜¯é€šè¿‡ <code>OutgoingMessage</code> å¯¹è±¡æ¥è¿›è¡Œæ§åˆ¶å’Œå‘é€çš„ã€‚</p><h3 id="_2-cork-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_2-cork-æ–¹æ³•çš„ä½œç”¨"><span>2. cork() æ–¹æ³•çš„ä½œç”¨</span></a></h3><p><code>cork()</code> æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯æš‚æ—¶é˜»æ­¢æ¶ˆæ¯è¢«å‘é€ï¼Œç›´åˆ°ä½¿ç”¨ <code>uncork()</code> æ–¹æ³•æˆ–è€…å¡«æ»¡å†…éƒ¨ç¼“å†²åŒºã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æœ‰æ•ˆåœ°æ‰¹é‡å¤„ç†æ•°æ®ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚</p><p>åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¯å½“ä½ å‘ <code>OutgoingMessage</code> å†™å…¥æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ <code>response.write(chunk)</code>ï¼‰ï¼ŒNode.js å°†å°è¯•ç«‹å³å°†è¿™äº›æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯ã€‚å¦‚æœé¢‘ç¹åœ°å†™å…¥å°å—æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ¯ä¸ªè°ƒç”¨éƒ½æ¶‰åŠåˆ°ç½‘ç»œæ“ä½œï¼Œè¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚</p><p>ä½¿ç”¨ <code>cork()</code> æ–¹æ³•åï¼ŒNode.js ä¼šæš‚æ—¶æŠŠå†™å…¥çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°è°ƒç”¨ <code>uncork()</code> æ–¹æ³•ï¼Œç„¶å Node.js ä¼šå°½é‡åˆå¹¶å¤šæ¬¡å†™å…¥çš„æ•°æ®ï¼Œå¹¶åœ¨ä¸€ä¸ªæ“ä½œä¸­å‘é€å®ƒä»¬ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ˜¾è‘—å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„æ•ˆç‡ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-18"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å‘å®¢æˆ·ç«¯å‘é€å¤šæ®µæ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // é˜»æ­¢æ¶ˆæ¯è¢«ç«‹å³å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹Ÿæ•°æ®å†™å…¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ•°æ®å†™å…¥å®Œæˆï¼Œå…è®¸æ¶ˆæ¯è¢«å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">uncork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è¿˜å¯ä»¥å†æ¬¡è°ƒç”¨ res.cork() å’Œ res.uncork() æ¥æ§åˆ¶å…¶ä»–æ•°æ®çš„å‘é€</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨ <code>cork()</code> æ–¹æ³•æš‚åœæ•°æ®çš„å‘é€ï¼Œå¹¶å¼€å§‹å†™å…¥ä¸€äº›æ•°æ®ã€‚ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>setTimeout</code> æ¥æ¨¡æ‹Ÿæ•°æ®å¤„ç†å»¶è¿Ÿï¼Œå¹¶åœ¨å¤„ç†å®Œæˆåè°ƒç”¨ <code>uncork()</code>ï¼Œæ­¤æ—¶ä¹‹å‰æš‚å­˜çš„æ•°æ®ä¼šè¢«å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</p><p>è¿™åªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼Œä½†å®ƒå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>cork()</code> å’Œ <code>uncork()</code> æ¥æ”¹è¿› Node.js åº”ç”¨ä¸­çš„æ•°æ®å‘é€æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠåˆ°å¤§é‡æ•°æ®å¤„ç†å’Œå‘é€æ—¶ã€‚é€šè¿‡åˆç†åˆ©ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ä½ çš„åº”ç”¨è¿è¡Œå¾—æ›´åŠ é«˜æ•ˆã€‚</p><h3 id="outgoingmessage-destroy-error" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-destroy-error"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagedestroyerror" target="_blank" rel="noopener noreferrer">outgoingMessage.destroy([error])</a></span></a></h3><p>å½“æˆ‘ä»¬åœ¨ä½¿ç”¨ Node.js è¿›è¡Œç½‘ç»œç¼–ç¨‹æ—¶ï¼Œç»å¸¸ä¼šæ¶‰åŠåˆ°åˆ›å»ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ“ä½œã€‚åœ¨è¿™äº›æ“ä½œä¸­ï¼Œ<code>http.OutgoingMessage</code> æ˜¯ä¸€ä¸ªé‡è¦çš„æ ¸å¿ƒå¯¹è±¡ï¼Œå®ƒæ˜¯ Node.js ä¸­æ‰€æœ‰å‘å‡ºçš„å“åº”ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰å’Œè¯·æ±‚ï¼ˆå®¢æˆ·ç«¯ï¼‰çš„åŸºç¡€ã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ å·²ç»æœ‰ä¸€äº› Node.js çš„åŸºç¡€çŸ¥è¯†ï¼Œæ¯”å¦‚çŸ¥é“å¦‚ä½•å»ºç«‹ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨æˆ–è€…å®¢æˆ·ç«¯ï¼Œæˆ‘å°†è§£é‡Š <code>outgoingMessage.destroy([error])</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="outgoingmessage-destroy-error-1" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-destroy-error-1"><span>outgoingMessage.destroy([error])</span></a></h3><p>è¿™ä¸ªæ–¹æ³•ç”¨æ¥ç«‹å³ç»ˆæ­¢ä¸€ä¸ªæ¶ˆæ¯æµï¼Œå¯ä»¥æ˜¯è¯·æ±‚æˆ–å“åº”ã€‚å¦‚æœåœ¨è°ƒç”¨ <code>destroy</code> æ–¹æ³•çš„è¿‡ç¨‹ä¸­æœ‰ä»»ä½•é”™è¯¯ï¼Œä½ å¯ä»¥é€‰æ‹©æ€§åœ°ä¼ é€’ä¸€ä¸ª <code>Error</code> å¯¹è±¡ä½œä¸ºå‚æ•°æ¥æŒ‡ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯ã€‚</p><p>å®ƒé€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li>å½“ä¸€ä¸ªè¯·æ±‚æˆ–å“åº”é­å—åˆ°ä¸€äº›ä¸å¯æ¢å¤çš„é”™è¯¯æ—¶ï¼Œæ¯”å¦‚ç½‘ç»œé—®é¢˜æˆ–è€…æ•°æ®ä¼ è¾“é”™è¯¯ã€‚</li><li>å½“ä½ æƒ³è¦æå‰ç»“æŸä¸€ä¸ªå“åº”ï¼Œå¯èƒ½å› ä¸ºä½ å·²ç»å¾—åˆ°äº†éœ€è¦çš„ä¿¡æ¯ï¼Œæˆ–è€…ä½ åˆ¤æ–­å‡ºå‰©ä¸‹çš„æ•°æ®å¯¹ä½ ä¸å†é‡è¦ã€‚</li></ol><p>ä½¿ç”¨ <code>destroy</code> æ–¹æ³•å°†ä¼šå¯¼è‡´åº•å±‚çš„ socket è¢«å…³é—­ï¼Œè¿›è€Œè§¦å‘ <code>&#39;close&#39;</code> äº‹ä»¶ï¼Œè¡¨æ˜è¯¥æ¶ˆæ¯æµå·²ç»å½»åº•ç»“æŸï¼Œä¸èƒ½å†è¢«å†™å…¥æˆ–è¯»å–ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-19"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><p><strong>å®ä¾‹ 1:</strong> æœåŠ¡å™¨ç«¯ï¼Œåœ¨æŸäº›æ¡ä»¶ä¸‹æå‰ç»ˆæ­¢å“åº”ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾åœ¨è¿™ä¸ªURLä¸‹ï¼Œä½ å¸Œæœ›æ— è®ºå¦‚ä½•éƒ½ä¸å¤„ç†è¯·æ±‚ç›´æ¥ç»“æŸå®ƒ</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œå¦‚æœè¯·æ±‚çš„ URL æ˜¯ <code>/end</code>ï¼Œæˆ‘ä»¬å¹¶ä¸å‘é€ä»»ä½•å“åº”ï¼Œè€Œæ˜¯ç›´æ¥é”€æ¯è¿™ä¸ªå“åº”å¯¹è±¡ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å°†ä¼šæ”¶åˆ°ä¸€ä¸ªè¿æ¥ä¸­æ–­çš„é”™è¯¯ã€‚</p><p><strong>å®ä¾‹ 2:</strong> å®¢æˆ·ç«¯ï¼Œåœ¨è·å–ä¸€äº›æ•°æ®åå–æ¶ˆä¸‹è½½å‰©ä½™å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com/largefile</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾æˆ‘ä»¬åªéœ€è¦å‰100ä¸ªå­—ç¬¦</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length </span><span style="color:#81A1C1;">&gt;</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">slice</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // é”€æ¯å“åº”ï¼Œåœæ­¢æ¥æ”¶æ›´å¤šçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Response was destroyed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„å®¢æˆ·ç«¯å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªå‡æƒ³çš„å¤§æ–‡ä»¶ä¸­è·å–æ•°æ®ã€‚ä¸€æ—¦æˆ‘ä»¬è·å¾—äº†è¶³å¤Ÿçš„æ•°æ®ï¼ˆä¾‹å¦‚å‰ 100 ä¸ªå­—ç¬¦ï¼‰ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦ç»§ç»­ä¸‹è½½æ–‡ä»¶ï¼Œå› æ­¤ä¸»åŠ¨è°ƒç”¨ <code>res.destroy()</code> æ¥ç»ˆæ­¢å“åº”å¯¹è±¡ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>outgoingMessage.destroy([error])</code> æ˜¯ä¸€ä¸ªç”¨äºç«‹å³ç»ˆæ­¢æ¶ˆæ¯æµçš„æ–¹æ³•ï¼Œéå¸¸æœ‰ç”¨å½“ä½ æƒ³è¦æ§åˆ¶ç½‘ç»œèµ„æºæˆ–åŠæ—¶å“åº”é”™è¯¯å’Œå¼‚å¸¸æƒ…å†µã€‚é€šè¿‡è°ƒç”¨å®ƒï¼Œä»»ä½•æ’é˜Ÿç­‰å¾…è¢«å‘é€çš„æ•°æ®å°†ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”ä¸å†æœ‰æ•°æ®èƒ½å¤Ÿè¢«å‘é€æˆ–æ¥æ”¶ã€‚</p><h3 id="outgoingmessage-end-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-end-chunk-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageendchunk-encoding-callback" target="_blank" rel="noopener noreferrer">outgoingMessage.end(chunk[, encoding][, callback])</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>outgoingMessage.end(chunk[, encoding][, callback])</code> æ–¹æ³•æ˜¯ç”¨äºç»“æŸå‘é€ä¸€ä¸ª HTTP è¯·æ±‚æˆ–å“åº”çš„è¿‡ç¨‹ã€‚è¿™ä¸ªæ–¹æ³•å±äº <code>http</code> æ¨¡å—ä¸­çš„ <code>OutgoingMessage</code> ç±»çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥ç±»ç”¨äºåˆ›å»ºå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æˆ–è€…æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„å“åº”ã€‚ç†è§£è¿™ä¸ªæ–¹æ³•å¯¹äºè¿›è¡Œç½‘ç»œç¼–ç¨‹å’Œæ„å»º web åº”ç”¨éå¸¸é‡è¦ã€‚</p><h3 id="å‚æ•°è§£é‡Š-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-3"><span>å‚æ•°è§£é‡Šï¼š</span></a></h3><ul><li><strong>chunk</strong> (å¯é€‰å‚æ•°): è¿™æ˜¯ä½ æƒ³è¦å‘é€çš„æ•°æ®æœ€åä¸€éƒ¨åˆ†ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ª bufferã€‚å¦‚æœä½ ä¹‹å‰å·²ç»ä½¿ç”¨ <code>write()</code> æ–¹æ³•å‘é€äº†æ•°æ®ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ <code>chunk</code> å°†ä½œä¸ºæœ€åçš„æ•°æ®éƒ¨åˆ†å‘é€ã€‚</li><li><strong>encoding</strong> (å¯é€‰å‚æ•°): å½“ <code>chunk</code> æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šå®ƒçš„ç¼–ç ï¼ˆæ¯”å¦‚ &#39;utf8&#39;ï¼‰ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨ &#39;utf8&#39; ç¼–ç ã€‚</li><li><strong>callback</strong> (å¯é€‰å‚æ•°): è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“æ¶ˆæ¯è¢«å®Œå…¨å‘é€å¹¶ä¸”è¾“å‡ºç¼“å†²åŒºè¢«æ¸…ç©ºåï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨-3"><span>å®é™…è¿ç”¨ï¼š</span></a></h3><p>æ¥çœ‹ä¸€äº›å®é™…çš„ä¾‹å­ï¼Œä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ–¹æ³•çš„ç”¨é€”ã€‚</p><h4 id="ä¾‹å­-1-å‘é€ä¸€ä¸ªç®€å•çš„-http-å“åº”" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å‘é€ä¸€ä¸ªç®€å•çš„-http-å“åº”"><span>ä¾‹å­ 1ï¼šå‘é€ä¸€ä¸ªç®€å•çš„ HTTP å“åº”</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ web æœåŠ¡å™¨ï¼Œéœ€è¦å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå“åº”ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“ï¼Œå¹¶ç»“æŸå“åº”è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>res.end(&#39;Hello World\n&#39;)</code> å‘é€äº†å“åº”ä½“ç»™å®¢æˆ·ç«¯ï¼Œå…¶ä¸­åŒ…å«æ–‡å­— â€œHello Worldâ€ï¼Œç„¶åç»“æŸäº†å“åº”è¿‡ç¨‹ã€‚è¿™æ˜¯æœ€åŸºæœ¬çš„ç”¨æ³•ã€‚</p><h4 id="ä¾‹å­-2-ä½¿ç”¨å›è°ƒç¡®è®¤æ¶ˆæ¯å‘é€å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨å›è°ƒç¡®è®¤æ¶ˆæ¯å‘é€å®Œæˆ"><span>ä¾‹å­ 2ï¼šä½¿ç”¨å›è°ƒç¡®è®¤æ¶ˆæ¯å‘é€å®Œæˆ</span></a></h4><p>å¦‚æœä½ æƒ³çŸ¥é“å½“æ¶ˆæ¯è¢«å®Œå…¨å‘é€å‡ºå»ï¼ˆå³æ•°æ®è¢«æ“ä½œç³»ç»Ÿæ¥ç®¡ï¼‰çš„ç¡®åˆ‡æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨ <code>callback</code> å‚æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿™æ˜¯æˆ‘çš„æ•°æ®</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ç¡®è®¤æ¶ˆæ¯å‘é€å®Œæˆ</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”å·²ç»å®Œå…¨å‘é€ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ <code>end()</code> æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å½“æ•°æ®å‘é€å®Œæˆæ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚</p><h3 id="æ€»ç»“-20" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-20"><span>æ€»ç»“ï¼š</span></a></h3><p>ç†è§£ <code>outgoingMessage.end()</code> æ–¹æ³•å¯¹äºæ„å»ºåŸºäº Node.js çš„ web åº”ç”¨å’ŒæœåŠ¡æ˜¯ååˆ†é‡è¦çš„ã€‚å®ƒä¸ä»…æ ‡å¿—ç€æ¶ˆæ¯ä¼ è¾“çš„ç»“æŸï¼Œè¿˜æä¾›äº†ä¸€ç§æœºåˆ¶æ¥ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€ï¼Œå…è®¸å¼€å‘è€…è¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—ã€å‘é€é¢å¤–çš„æ•°æ®ç­‰ã€‚</p><h3 id="outgoingmessage-flushheaders" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-flushheaders"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageflushheaders" target="_blank" rel="noopener noreferrer">outgoingMessage.flushHeaders()</a></span></a></h3><p>åœ¨è§£é‡Š <code>outgoingMessage.flushHeaders()</code> æ–¹æ³•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£è¿™ä¸€æ–¹æ³•çš„ç”¨é€”å’Œä½œç”¨ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†-2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†-2"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><ol><li><p><strong>Node.js</strong>: Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æ„å»ºæœåŠ¡å™¨å’Œåç«¯æœåŠ¡ï¼Œå¦‚ APIsã€æ–‡ä»¶å¤„ç†ç³»ç»Ÿç­‰ã€‚</p></li><li><p><strong>HTTP æ¶ˆæ¯</strong>: åœ¨æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´é€šä¿¡æ—¶ï¼Œæ•°æ®é€šè¿‡ HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ¶ˆæ¯ä¼ è¾“ã€‚è¿™äº›æ¶ˆæ¯åˆ†ä¸ºä¸¤ç±»ï¼šè¯·æ±‚ï¼ˆç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ï¼‰å’Œå“åº”ï¼ˆç”±æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ï¼‰ã€‚</p></li><li><p><strong>OutgoingMessage</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>OutgoingMessage</code> å¯¹è±¡æ˜¯ä¸€ä¸ªæŠ½è±¡çš„åŸºç±»ï¼Œå®ƒè¢«ç”¨äºå‡ ç§ç±»å‹çš„è¾“å‡ºæ¶ˆæ¯ï¼Œæœ€å¸¸è§çš„æ˜¯ HTTP å“åº” (<code>http.ServerResponse</code>) å’Œ HTTP å®¢æˆ·ç«¯è¯·æ±‚ (<code>http.ClientRequest</code>)ã€‚ç®€è¨€ä¹‹ï¼Œè¿™æ˜¯æœåŠ¡å™¨å“åº”æˆ–å‘å‡ºçš„è¯·æ±‚çš„è¡¨ç¤ºã€‚</p></li></ol><h3 id="outgoingmessage-flushheaders-1" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-flushheaders-1"><span>outgoingMessage.flushHeaders()</span></a></h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥ <code>outgoingMessage.flushHeaders()</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥ç«‹å³å°†æ’é˜Ÿçš„å¤´ä¿¡æ¯ï¼ˆheadersï¼‰å‘é€åˆ°å®¢æˆ·ç«¯çš„ã€‚åœ¨ä¸€ä¸ª HTTP äº¤äº’ä¸­ï¼Œé¦–å…ˆå‘é€çš„æ˜¯å¤´ä¿¡æ¯ï¼Œå®ƒåŒ…æ‹¬äº†çŠ¶æ€ç ã€å†…å®¹ç±»å‹ç­‰å…ƒæ•°æ®ï¼Œéšåæ‰æ˜¯å®é™…çš„å“åº”ä½“ï¼ˆæ¯”å¦‚ HTML é¡µé¢ã€JSON æ•°æ®ç­‰ï¼‰ã€‚ä½¿ç”¨ <code>flushHeaders()</code> å¯ä»¥ç¡®ä¿å¤´ä¿¡æ¯å³åˆ»è¢«å‘é€è€Œä¸å¿…ç­‰å¾…å…¨éƒ¨å“åº”ä¸»ä½“å†…å®¹å®Œæˆã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ï¼Ÿ</strong></p><ul><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦æ‰§è¡Œé•¿æ—¶é—´è¿ç®—æˆ–è€…ä»æ•°æ®åº“æ£€ç´¢å¤§é‡æ•°æ®æ—¶ï¼Œç«‹å³å‘é€å¤´ä¿¡æ¯å¯ä»¥å‘Šè¯‰å®¢æˆ·ç«¯è¯·æ±‚å·²ç»è¢«æ¥æ”¶å¹¶ä¸”æ­£åœ¨å¤„ç†ä¸­ï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>æ§åˆ¶è¿æ¥</strong>: æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³ä¿æŒè¯·æ±‚å¼€å¯çŠ¶æ€ä»¥å‘é€è¿›ä¸€æ­¥çš„æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œåœ¨å®æ—¶åº”ç”¨ä¸­ï¼‰ï¼Œé€šè¿‡å…ˆå‘é€å¤´éƒ¨å¯ä»¥ç¡®ä¿è¿æ¥æŒ‰é¢„æœŸä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-20" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-20"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦ä»æ•°æ®åº“åŠ è½½å¤§é‡æ•°æ®ç„¶åè¿”å›ç»™ç”¨æˆ·ã€‚è¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>flushHeaders()</code> æ¥ä¼˜åŒ–ä½“éªŒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ç«‹å³å‘é€å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">flushHeaders</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€å¤´éƒ¨ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¿æ¥å·²ç»å»ºç«‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œæˆ–å…¶ä»–é•¿æ—¶é—´è¿ç®—</span></span>
<span class="line"><span style="color:#88C0D0;">    setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span><span style="color:#B48EAD;"> 10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾è¿™é‡Œçš„æ“ä½œéœ€è¦10ç§’é’Ÿ</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒæœåŠ¡å™¨ç«‹å³å‘é€ HTTP çŠ¶æ€ç å’Œå†…å®¹ç±»å‹å¤´ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå¼€å§‹å¤„ç†æ•°æ®ï¼ˆè¿™é‡Œé€šè¿‡ <code>setTimeout</code> æ¨¡æ‹Ÿï¼‰ã€‚åœ¨æ•°æ®å¤„ç†å®Œæˆä¹‹å‰ï¼Œå®¢æˆ·ç«¯å·²ç»çŸ¥é“è¯·æ±‚æˆåŠŸï¼Œå¹¶å¤„äºç­‰å¾…çŠ¶æ€ç›´åˆ°æœ€ç»ˆçš„å“åº”ä½“ä¼ è¾“å®Œæˆã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>outgoingMessage.flushHeaders()</code> æ–¹æ³•åœ¨ Node.js ä¸­ç”¨äºæ”¹å–„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œé€šè¿‡æå‰å‘é€ HTTP å¤´ä¿¡æ¯æ¥å®ç°ã€‚å®ƒå¯¹äºæ„å»ºé«˜æ•ˆã€å“åº”å¼çš„ç½‘ç»œåº”ç”¨å°¤ä¸ºé‡è¦ã€‚</p><h3 id="outgoingmessage-getheader-name" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-getheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagegetheadername" target="_blank" rel="noopener noreferrer">outgoingMessage.getHeader(name)</a></span></a></h3><p>å½“ä½ å¼€å§‹ä½¿ç”¨ Node.js æ¥å¼€å‘ Web åº”ç”¨æ—¶ï¼Œä½ ä¼šç»å¸¸ä¸ç½‘ç«™çš„è¯·æ±‚å’Œå“åº”æ‰“äº¤é“ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œäº†è§£å¦‚ä½•æ“ä½œ HTTP æ¶ˆæ¯çš„å¤´éƒ¨ï¼ˆHeadersï¼‰æ˜¯éå¸¸é‡è¦çš„ã€‚å…·ä½“åˆ°<code>outgoingMessage.getHeader(name)</code>è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒæ˜¯ç”¨äºè·å–å½“å‰æ­£åœ¨å‘é€çš„ HTTP æ¶ˆæ¯ï¼ˆæ¯”æ–¹è¯´ï¼Œä¸€ä¸ª HTTP å“åº”ï¼‰ä¸­çš„ç‰¹å®šå¤´éƒ¨çš„å€¼ã€‚</p><p>ä¸ºäº†è®©è¿™ä¸ªæ¦‚å¿µæ›´åŠ æ¸…æ™°ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ul><li><strong>HTTP æ¶ˆæ¯</strong>ï¼šåœ¨å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„ä¿¡æ¯ã€‚åˆ†ä¸ºè¯·æ±‚ï¼ˆRequestï¼‰å’Œå“åº”ï¼ˆResponseï¼‰ã€‚</li><li><strong>Headers</strong>ï¼šHTTP æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«äº†å¯¹æ¶ˆæ¯æè¿°çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ç­‰ã€‚</li><li><strong>outgoingMessage</strong>ï¼šåœ¨ Node.js çš„<code>http</code>æ¨¡å—ä¸­ï¼Œä»£è¡¨å³å°†è¢«å‘é€è‡³å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œå¯ä»¥æ˜¯è¯·æ±‚æˆ–å“åº”ï¼Œä½†åœ¨å®è·µä¸­ï¼Œå®ƒä¸»è¦ç”¨äºå“åº”ã€‚</li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨<code>outgoingMessage.getHeader(name)</code>ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œä½ æƒ³æ£€æŸ¥åœ¨å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ä¸­ï¼Œ<code>Content-Type</code>è¿™ä¸ªå¤´éƒ¨ï¼ˆHeaderï¼‰è®¾ç½®æˆäº†ä»€ä¹ˆã€‚<code>Content-Type</code>å‘Šè¯‰æµè§ˆå™¨ä½ å‘é€çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼çš„ï¼Œæ¯”å¦‚<code>text/html</code>è¡¨ç¤º HTML æ–‡æ¡£ï¼Œè€Œ<code>application/json</code>åˆ™è¡¨ç¤º JSON æ ¼å¼çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // é¦–å…ˆï¼Œæˆ‘ä»¬è®¾ç½®å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æ­¤åˆ»æˆ‘ä»¬æƒ³æ£€æŸ¥&#39;Content-Type&#39;å¤´çš„å€¼</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> contentType</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">contentType</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™ä¼šè¾“å‡º: &#39;application/json&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç„¶åæˆ‘ä»¬å‘é€å“åº”ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥å¤„ç†åˆ°è¾¾çš„è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ª JSON æ ¼å¼çš„å“åº”ã€‚</li><li>åœ¨å‘é€å“åº”ä¹‹å‰ï¼Œæˆ‘ä»¬è®¾ç½®äº†<code>Content-Type</code>å¤´ä¸º<code>application/json</code>ã€‚</li><li>ä¸ºäº†éªŒè¯æˆ–è€…å‡ºäºå…¶ä»–ä»»ä½•åŸå› ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>res.getHeader(&#39;Content-Type&#39;)</code>è·å–<code>Content-Type</code>å¤´çš„å€¼ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚</li></ol><p>è¿™ç§èƒ½åŠ›å…è®¸ä½ åœ¨å°†å“åº”å‘é€å›å®¢æˆ·ç«¯ä¹‹å‰ï¼ŒæŸ¥çœ‹æˆ–ä¿®æ”¹ HTTP å¤´éƒ¨ï¼Œè¿™å¯¹äºè°ƒè¯•ã€æ»¡è¶³ç‰¹å®šçš„å®¢æˆ·ç«¯éœ€æ±‚æˆ–ä¿è¯ä½ çš„ Web æœåŠ¡è¡Œä¸ºç¬¦åˆé¢„æœŸéƒ½æ˜¯æå…¶æœ‰ç”¨çš„ã€‚</p><h3 id="outgoingmessage-getheadernames" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-getheadernames"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagegetheadernames" target="_blank" rel="noopener noreferrer">outgoingMessage.getHeaderNames()</a></span></a></h3><p>å½“ä½ ç”¨ Node.js æ¥å¼€å‘ Web åº”ç”¨æ—¶ï¼Œä¼šé¢‘ç¹ä¸ HTTP è¯·æ±‚å’Œå“åº”æ‰“äº¤é“ã€‚è¿™äº›è¯·æ±‚å’Œå“åº”éƒ½ä¼šæºå¸¦ä¸€ç³»åˆ—çš„å¤´ä¿¡æ¯ï¼ˆHeadersï¼‰ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰ã€ç¼“å­˜ç­–ç•¥ï¼ˆCache-Controlï¼‰ç­‰ç­‰ã€‚ç†è§£å¦‚ä½•æ“ä½œè¿™äº›å¤´ä¿¡æ¯æ˜¯æ„å»ºæœ‰æ•ˆ Web æœåŠ¡çš„å…³é”®éƒ¨åˆ†ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>outgoingMessage.getHeaderNames()</code>æ˜¯ä¸€ä¸ªå®ç”¨çš„æ–¹æ³•ï¼Œå®ƒå…è®¸ä½ è·å–å½“å‰ OutgoingMessage å¯¹è±¡ï¼ˆå³å‘é€å‡ºå»çš„æ¶ˆæ¯ï¼Œå¯ä»¥æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚æˆ–æœåŠ¡å™¨çš„å“åº”ï¼‰ä¸Šè®¾ç½®çš„æ‰€æœ‰å¤´ä¿¡æ¯çš„åç§°åˆ—è¡¨ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²ä»£è¡¨ä¸€ä¸ªå¤´ä¿¡æ¯çš„åç§°ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-21" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-21"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-æ—¥å¿—è®°å½•" tabindex="-1"><a class="header-anchor" href="#_1-æ—¥å¿—è®°å½•"><span>1. æ—¥å¿—è®°å½•</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js çš„ Web æœåŠ¡ï¼Œå¹¶ä¸”æƒ³è¦åœ¨æ¯æ¬¡å‘é€å“åº”æ—¶è®°å½•æ‰€æœ‰å·²è®¾ç½®çš„å¤´ä¿¡æ¯åç§°ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®ä¸€äº›å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Powered-By</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è·å–å¹¶è®°å½•æ‰€æœ‰è®¾ç½®çš„å“åº”å¤´ä¿¡æ¯åç§°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> headerNames</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaderNames</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Sent headers:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headerNames</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: Sent headers: [ &#39;content-type&#39;, &#39;x-powered-by&#39; ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-æ¡ä»¶å¼è®¾ç½®å¤´ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_2-æ¡ä»¶å¼è®¾ç½®å¤´ä¿¡æ¯"><span>2. æ¡ä»¶å¼è®¾ç½®å¤´ä¿¡æ¯</span></a></h4><p>å‡å®šæœ‰ä¸€ä¸ªåœºæ™¯ï¼Œä½ åªåœ¨æŸäº›æ¡ä»¶æ»¡è¶³æ—¶æ·»åŠ ç‰¹å®šçš„å¤´ä¿¡æ¯ï¼Œä½†åœ¨å‘é€å“åº”å‰éœ€è¦ç¡®è®¤è¿™ä¸ªå¤´æ˜¯å¦å·²ç»è¢«æ·»åŠ ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> shouldAddCustomHeader</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Math</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">random</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 0.5</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 50%å‡ ç‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">shouldAddCustomHeader</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">SomeValue</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥X-Custom-Headeræ˜¯å¦å·²è®¾ç½®</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaderNames</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">x-custom-header</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">X-Custom-Header was not set.</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">X-Custom-Header is set.</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Check the server logs!</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>getHeaderNames()</code>æ¥æ£€æŸ¥å’Œè®°å½• OutgoingMessageï¼ˆHTTP å“åº”æˆ–è¯·æ±‚ï¼‰å¯¹è±¡ä¸Šè®¾ç½®çš„å¤´ä¿¡æ¯åç§°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œè°ƒè¯•ä½ çš„ Web æœåŠ¡ã€‚</p><h3 id="outgoingmessage-getheaders" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-getheaders"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagegetheaders" target="_blank" rel="noopener noreferrer">outgoingMessage.getHeaders()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªä½¿å¾—å¼€å‘è€…å¯ä»¥ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„å¹³å°ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—å¸®åŠ©ä½ æ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œæ¯”å¦‚åˆ›å»º HTTP æœåŠ¡å™¨ã€è¯»å†™æ–‡ä»¶ç­‰ã€‚<code>http</code> æ¨¡å—æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿå¤„ç†ç½‘ç»œè¯·æ±‚å’Œå“åº”ã€‚</p><p>å½“æˆ‘ä»¬è°ˆåˆ° <code>outgoingMessage.getHeaders()</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®º HTTP é€šä¿¡è¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ HTTP é€šä¿¡ä¸­ï¼Œæ•°æ®äº¤æ¢æ˜¯é€šè¿‡è¯·æ±‚ï¼ˆRequestï¼‰å’Œå“åº”ï¼ˆResponseï¼‰è¿›è¡Œçš„ï¼Œè€Œè¿™äº›è¯·æ±‚å’Œå“åº”éƒ½åŒ…å«äº†æ ‡é¢˜ï¼ˆHeadersï¼‰å’Œæ­£æ–‡ï¼ˆBodyï¼‰ã€‚æ ‡é¢˜æä¾›äº†å…³äºæ­£æ–‡å†…å®¹æˆ–è¯·æ±‚/å“åº”æœ¬èº«çš„å…ƒä¿¡æ¯ã€‚</p><h3 id="outgoingmessage-getheaders-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-getheaders-æ–¹æ³•"><span>outgoingMessage.getHeaders() æ–¹æ³•</span></a></h3><p><code>outgoingMessage.getHeaders()</code> æ˜¯ <code>http</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–ä¸€ä¸ªæ­£åœ¨å‘é€çš„æ¶ˆæ¯ï¼ˆæ— è®ºæ˜¯å®¢æˆ·ç«¯è¯·æ±‚è¿˜æ˜¯æœåŠ¡å™¨å“åº”ï¼‰çš„å½“å‰çš„å¤´ä¿¡æ¯ï¼ˆHeadersï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†æ‰€æœ‰è®¾å®šçš„å¤´ä¿¡æ¯çš„å‰¯æœ¬ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹-1"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h3><h4 id="_1-æ—¥å¿—è®°å½•-1" tabindex="-1"><a class="header-anchor" href="#_1-æ—¥å¿—è®°å½•-1"><span>1. æ—¥å¿—è®°å½•</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Web åº”ç”¨ï¼Œå¹¶æƒ³è¦è®°å½•æ‰€æœ‰å‘å‡ºçš„å“åº”çš„å¤´ä¿¡æ¯ä»¥ä¾¿äºè°ƒè¯•æˆ–ç›‘æ§ç›®çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>outgoingMessage.getHeaders()</code> è·å–è¿™äº›ä¿¡æ¯å¹¶å°†å…¶è®°å½•ä¸‹æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®ä¸€äº›å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Powered-By</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è®°å½•å“åº”å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaders</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, World!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚æ¯å½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒä¼šè®¾ç½®å“åº”å¤´ä¿¡æ¯ç„¶åè®°å½•è¿™äº›ä¿¡æ¯ï¼Œæœ€åå“åº”ä¸€æ¡ç®€å•çš„ HTML æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚</p><h4 id="_2-åŠ¨æ€å¤´ä¿¡æ¯è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_2-åŠ¨æ€å¤´ä¿¡æ¯è®¾ç½®"><span>2. åŠ¨æ€å¤´ä¿¡æ¯è®¾ç½®</span></a></h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®è¯·æ±‚çš„ä¸åŒåŠ¨æ€åœ°è®¾ç½®å“åº”å¤´ã€‚ä½¿ç”¨ <code>getHeaders()</code> å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­æ˜¯å¦å·²ç»è®¾ç½®äº†æŸä¸ªå¤´ä¿¡æ¯ï¼Œä»è€Œé¿å…é‡å¤è®¾ç½®æˆ–è¿›è¡Œæ¡ä»¶ä¿®æ”¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getHeaders</span><span style="color:#D8DEE9FF;">()[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åšå…¶ä»–çš„å“åº”å¤„ç†...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, this response header was set based on condition!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>if</code> æ¡ä»¶æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®äº† <code>&#39;content-type&#39;</code> å¤´ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è®¾ç½®ä¸º <code>&#39;text/plain&#39;</code>ã€‚è¿™æ ·å¯ä»¥ä¿è¯æˆ‘ä»¬ä¸ä¼šè¦†ç›–ä¹‹å‰å¯èƒ½å·²ç»è®¾ç½®çš„ <code>&#39;content-type&#39;</code> å€¼ã€‚</p><h3 id="æ€»ç»“-21" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-21"><span>æ€»ç»“</span></a></h3><p><code>outgoingMessage.getHeaders()</code> æ–¹æ³•åœ¨å¤„ç† HTTP é€šä¿¡æ—¶éå¸¸æœ‰ç”¨ã€‚å®ƒå…è®¸å¼€å‘è€…è·å–å³å°†å‘å‡ºçš„æ¶ˆæ¯çš„å¤´ä¿¡æ¯ï¼Œè¿™å¯¹äºè°ƒè¯•ã€æ—¥å¿—è®°å½•ã€æ¡ä»¶æ€§åœ°è®¾ç½®å¤´ä¿¡æ¯ç­‰æ–¹é¢éƒ½æ˜¯ååˆ†æœ‰ç”¨çš„å·¥å…·ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ åº”è¯¥å¯¹å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚</p><h3 id="outgoingmessage-hasheader-name" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-hasheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagehasheadername" target="_blank" rel="noopener noreferrer">outgoingMessage.hasHeader(name)</a></span></a></h3><p>å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œç†è§£ Node.js çš„ <code>outgoingMessage.hasHeader(name)</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªåŸºæœ¬çš„æ¦‚å¿µå¼€å§‹ï¼šHTTP æ¶ˆæ¯ã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œå½“ä½ çš„æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘æœåŠ¡å™¨è¯·æ±‚ç½‘é¡µæˆ–æ•°æ®æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å‘é€å’Œæ¥æ”¶ HTTP æ¶ˆæ¯ã€‚HTTP æ¶ˆæ¯ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼šè¯·æ±‚ï¼ˆRequestï¼‰å’Œå“åº”ï¼ˆResponseï¼‰ã€‚è¿™ä¸¤ç§æ¶ˆæ¯éƒ½å¯èƒ½åŒ…å«å¤´éƒ¨ï¼ˆHeadersï¼‰ï¼Œå¤´éƒ¨ç”¨äºä¼ é€’é¢å¤–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ç­‰ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº Node.js ä¸­çš„ <code>outgoingMessage.hasHeader(name)</code> æ–¹æ³•ï¼š</p><h3 id="outgoingmessage-hasheader-name-1" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-hasheader-name-1"><span><code>outgoingMessage.hasHeader(name)</code></span></a></h3><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºæ£€æŸ¥ä¸€ä¸ªå³å°†å‘é€çš„ HTTP æ¶ˆæ¯ï¼ˆæ— è®ºæ˜¯è¯·æ±‚è¿˜æ˜¯å“åº”ï¼‰æ˜¯å¦å·²ç»è®¾ç½®äº†ç‰¹å®šçš„å¤´éƒ¨ï¼ˆHeaderï¼‰ã€‚å®ƒçš„ä½œç”¨ä¸»è¦åœ¨äºå¸®åŠ©å¼€å‘è€…ç¡®è®¤æŸä¸ªå¤´éƒ¨æ˜¯å¦å­˜åœ¨ï¼Œä»è€Œé¿å…é‡å¤è®¾ç½®æˆ–åœ¨ä¸æ­£ç¡®çš„æ—¶é—´ç‚¹ä¿®æ”¹å¤´éƒ¨ã€‚æ­¤æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼š</p><ul><li><code>name</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºä½ æƒ³è¦æ£€æŸ¥çš„å¤´éƒ¨åç§°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåç§°æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œæ„æ€æ˜¯ &quot;Content-Type&quot; å’Œ &quot;content-type&quot; è¢«è§†ä¸ºç›¸åŒçš„å¤´éƒ¨ã€‚</li></ul><p>å¦‚æœæŒ‡å®šçš„å¤´éƒ¨å­˜åœ¨ï¼Œ<code>hasHeader(name)</code> è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-29" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-29"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å‘ç”¨æˆ·å‘é€ä¸€ä¸ª JSON æ ¼å¼çš„æ•°æ®å“åº”ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œç¡®ä¿ä½ çš„å“åº”ä¸­åŒ…å«æ­£ç¡®çš„ <code>Content-Type</code> å¤´éƒ¨æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå®ƒå‘Šè¯‰å®¢æˆ·ç«¯å¦‚ä½•è§£ææ”¶åˆ°çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // éœ€æ±‚ï¼šå‘é€ä¸€ä¸ª JSON å“åº”</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥ &#39;Content-Type&#39; å¤´éƒ¨æ˜¯å¦å·²è®¾ç½®</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">hasHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™æ·»åŠ  &#39;Content-Type&#39; å¤´éƒ¨ï¼Œå¹¶è®¾ç½®å…¶å€¼ä¸º &#39;application/json&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“ä¸º JSON å­—ç¬¦ä¸²çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ <code>res.hasHeader(&#39;Content-Type&#39;)</code> æ£€æŸ¥å“åº”å¯¹è±¡ (<code>res</code>) æ˜¯å¦å·²ç»æœ‰ <code>&#39;Content-Type&#39;</code> å¤´éƒ¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>res.setHeader(&#39;Content-Type&#39;, &#39;application/json&#39;);</code> æ¥è®¾ç½®å®ƒã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ <code>res.end(...)</code> å‘é€ä¸€ä¸ª JSON æ ¼å¼çš„å“åº”ä½“ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿™ä¸ªç®€å•çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>outgoingMessage.hasHeader(name)</code> æ¥ç¡®ä¿æˆ‘ä»¬çš„ HTTP å“åº”ä¸­åŒ…å«äº†æ­£ç¡®çš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚è¿™ç§æŠ€æœ¯åœ¨æ„å»º RESTful API æˆ–ä»»ä½•éœ€è¦ç²¾å‡†æ§åˆ¶ HTTP å“åº”çš„ Web åº”ç”¨ä¸­ååˆ†å¸¸è§å’Œæœ‰ç”¨ã€‚</p><h3 id="outgoingmessage-headerssent" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-headerssent"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageheaderssent" target="_blank" rel="noopener noreferrer">outgoingMessage.headersSent</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>outgoingMessage.headersSent</code> å±æ€§ï¼Œä»¥åŠå®ƒåœ¨å®é™…åº”ç”¨ä¸­çš„å‡ ä¸ªä¾‹å­ã€‚</p><p>é¦–å…ˆï¼Œ<code>OutgoingMessage</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„å¯¹è±¡ï¼Œå®ƒæ˜¯å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å“åº”ï¼ˆresponseï¼‰æˆ–æœåŠ¡å™¨ç«¯è¯·æ±‚ï¼ˆrequestï¼‰çš„å°è£…ã€‚å½“æˆ‘ä»¬è°ˆè®º HTTP é€šè®¯æ—¶ï¼Œæ¯æ¬¡äº¤æµéƒ½æ¶‰åŠåˆ°ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š<strong>å¤´éƒ¨ï¼ˆHeadersï¼‰<strong>å’Œ</strong>æ­£æ–‡ï¼ˆBodyï¼‰</strong>ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-outgoingmessage-headerssent" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-outgoingmessage-headerssent"><span>ä»€ä¹ˆæ˜¯ <code>outgoingMessage.headersSent</code>ï¼Ÿ</span></a></h3><p><code>outgoingMessage.headersSent</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼å±æ€§ï¼Œç”¨äºæ ‡è¯†åœ¨ä¸€ä¸ª <code>OutgoingMessage</code> å¯¹è±¡ä¸­ï¼ˆæ— è®ºæ˜¯ HTTP å“åº”è¿˜æ˜¯è¯·æ±‚ï¼‰ï¼ŒHTTP å¤´éƒ¨æ˜¯å¦å·²ç»è¢«å‘é€ç»™æ¥æ”¶è€…ã€‚å¦‚æœå¤´éƒ¨å·²ç»å‘é€ï¼Œè¯¥å±æ€§çš„å€¼ä¸º <code>true</code>ï¼›å¦‚æœå¤´éƒ¨è¿˜æ²¡æœ‰å‘é€ï¼Œå…¶å€¼ä¸º <code>false</code>ã€‚</p><p>è¿™ä¸ªå±æ€§å¾ˆé‡è¦ï¼Œå› ä¸ºä¸€æ—¦å¤´éƒ¨è¢«å‘é€å‡ºå»ï¼Œä½ å°±ä¸èƒ½å†å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹äº†ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨å†³å®šå‘é€å“ªäº›å¤´éƒ¨ä¿¡æ¯ä¹‹å‰ï¼Œä½ éœ€è¦è°¨æ…è€ƒè™‘ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-30" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-30"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h3><h4 id="_1-ç¡®è®¤å¤´éƒ¨æ˜¯å¦å·²å‘é€" tabindex="-1"><a class="header-anchor" href="#_1-ç¡®è®¤å¤´éƒ¨æ˜¯å¦å·²å‘é€"><span>1. ç¡®è®¤å¤´éƒ¨æ˜¯å¦å·²å‘é€</span></a></h4><p>åœ¨å¤„ç† HTTP å“åº”æ—¶ï¼Œå¯èƒ½ä¼šç¢°åˆ°éœ€è¦æ ¹æ®æ¡ä»¶åŠ¨æ€è®¾ç½®å“åº”å¤´çš„åœºæ™¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ <code>headersSent</code> å±æ€§å¯ä»¥é¿å…åœ¨å¤´éƒ¨å·²å‘é€åå°è¯•ä¿®æ”¹å®ƒä»¬ï¼Œä»è€Œå¯¼è‡´é”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersSent</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å› ä¸ºå¤´éƒ¨è¿˜æ²¡å‘é€ï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°è®¾ç½®é¢å¤–çš„å¤´éƒ¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SomeValue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-é¿å…é‡å¤å‘é€å¤´éƒ¨" tabindex="-1"><a class="header-anchor" href="#_2-é¿å…é‡å¤å‘é€å¤´éƒ¨"><span>2. é¿å…é‡å¤å‘é€å¤´éƒ¨</span></a></h4><p>åœ¨æŸäº›å¼‚æ­¥æ“ä½œå®Œæˆåå‘é€ HTTP å“åº”ï¼Œä½†ä½ å¯èƒ½ä¸ç¡®å®šå›è°ƒå‡½æ•°æ˜¯å¦ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œæˆ–è€…æ˜¯å¦åœ¨å¼‚æ­¥æ“ä½œå®Œæˆä¹‹å‰å·²ç»å‘é€äº†å“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ£€æµ‹ <code>headersSent</code> å¯ä»¥é˜²æ­¢å°è¯•å¤šæ¬¡å‘é€å¤´éƒ¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    doSomeAsyncOperation</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headersSent</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">          res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">500</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è®¾ç½®çŠ¶æ€ç ä¸º 500</span></span>
<span class="line"><span style="color:#D8DEE9;">          res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Internal Server Error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">          res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">          res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>res.headersSent</code> æ£€æŸ¥ç¡®ä¿å³ä½¿ <code>doSomeAsyncOperation</code> çš„å›è°ƒè¢«å¤šæ¬¡æ‰§è¡Œï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šå°è¯•å»å‘é€å¤´éƒ¨ä¿¡æ¯è¶…è¿‡ä¸€æ¬¡ï¼Œè¿™æœ‰åŠ©äºé¿å…å‡ºç° Node.js æŠ›å‡ºé”™è¯¯çš„æƒ…å†µã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>outgoingMessage.headersSent</code> æ˜¯ä¸€ä¸ªæå…¶æœ‰ç”¨çš„å±æ€§ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å†™å‡ºæ›´å¥å£®ã€é”™è¯¯å°‘çš„ä»£ç ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚çš„ HTTP äº¤äº’æ—¶ã€‚é€šè¿‡ä½¿ç”¨å®ƒï¼Œå¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„ç¨‹åºè¡Œä¸ºæ­£ç¡®ï¼Œå¹¶ä¸”æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p><h3 id="outgoingmessage-pipe" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-pipe"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagepipe" target="_blank" rel="noopener noreferrer">outgoingMessage.pipe()</a></span></a></h3><p><code>outgoingMessage.pipe()</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¤„ç†æµæ•°æ®ã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥å°†å®ƒæƒ³è±¡æˆä¸€æ¡æ°´ç®¡ï¼Œæ•°æ®å°±åƒæ°´ä¸€æ ·ä»ä¸€ç«¯æµåˆ°å¦ä¸€ç«¯ã€‚Node.js çš„æµåˆ†ä¸ºå››ç§ç±»å‹ï¼šå¯è¯»æµã€å¯å†™æµã€åŒå·¥æµå’Œè½¬æ¢æµã€‚</p><p>åœ¨æˆ‘ä»¬è®¨è®ºçš„è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>outgoingMessage</code> æ˜¯ä¸€ä¸ª HTTP æ¨¡å—çš„å¯¹è±¡ï¼Œä»£è¡¨äº†ä¸€ä¸ªå³å°†å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ï¼ˆResponseï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªå¯å†™æµï¼Œå…è®¸ä½ å‘å…¶ä¸­å†™å…¥è¦å‘é€çš„æ•°æ®ã€‚</p><p><code>pipe()</code> æ–¹æ³•åˆ™æ˜¯ä¸€ä¸ªç”¨æ¥ç›´æ¥æŠŠä¸€ä¸ªæµä¸­çš„æ•°æ®ä¼ è¾“åˆ°å¦ä¸€ä¸ªæµä¸­çš„æ–¹æ³•ã€‚å½“ä½ ä½¿ç”¨ <code>outgoingMessage.pipe()</code> æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨è®¾ç½®ä¸€ä¸ªé€šé“ï¼Œä½¿å¾—æ•°æ®å¯ä»¥ä»ä¸€ä¸ªæµè‡ªåŠ¨åœ°ä¼ è¾“åˆ° <code>outgoingMessage</code> æµä¸­ï¼Œå¹¶æœ€ç»ˆå‘é€åˆ°å®¢æˆ·ç«¯ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œä½ æƒ³å°†è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ä½œä¸º HTTP å“åº”å‘é€ç»™å®¢æˆ·ç«¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬è¦å‘é€ä¸€ä¸ªå«åš &#39;example.txt&#39; çš„æ–‡ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”å¤´éƒ¨ï¼Œå‘Šè¯‰æµè§ˆå™¨å†…å®¹ç±»å‹æ˜¯æ–‡æœ¬</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ pipe() å°†æ–‡ä»¶è¯»å–æµè¿æ¥åˆ°å“åº”æµ</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™æ · &#39;example.txt&#39; æ–‡ä»¶çš„å†…å®¹å°±ä¼šè¢«å‘é€ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº† <code>http</code> å’Œ <code>fs</code> æ¨¡å—ï¼Œåˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ <code>fs.createReadStream()</code> åˆ›å»ºä¸€ä¸ªæŒ‡å‘ &#39;example.txt&#39; æ–‡ä»¶çš„å¯è¯»æµã€‚ç„¶åï¼Œæˆ‘ä»¬è®¾ç½®äº†å“åº”çš„ HTTP çŠ¶æ€ç å’Œå¤´éƒ¨ï¼Œå¹¶ä½¿ç”¨ <code>readStream.pipe(res)</code> å°†æ–‡ä»¶çš„å†…å®¹ç›´æ¥â€œç®¡é“â€åˆ° HTTP å“åº”ä¸­ã€‚è¿™æ ·ï¼Œ&#39;example.txt&#39; çš„å†…å®¹å°±ä¼šæµå‘ <code>res</code>ï¼Œä¹Ÿå°±æ˜¯ <code>outgoingMessage</code> å¯¹è±¡ï¼Œå¹¶ç”±æ­¤å‘é€ç»™è¯·æ±‚æ–¹ã€‚</p><p>ä½¿ç”¨ <code>pipe()</code> çš„å¥½å¤„æ˜¯å®ƒå¯ä»¥è‡ªåŠ¨ç®¡ç†æ•°æ®æµçš„é€Ÿåº¦ï¼Œé˜²æ­¢å†…å­˜å ç”¨è¿‡å¤šã€‚å¦‚æœè¯»å–é€Ÿåº¦å¿«äºå†™å…¥é€Ÿåº¦ï¼Œå®ƒä¼šæš‚åœè¯»å–ï¼Œç›´åˆ°å†™å…¥è¿½ä¸Šæ¥ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºèƒŒå‹ï¼ˆbackpressureï¼‰ç®¡ç†ï¼Œåœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶å°¤ä¸ºé‡è¦ã€‚</p><h3 id="outgoingmessage-removeheader-name" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-removeheader-name"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageremoveheadername" target="_blank" rel="noopener noreferrer">outgoingMessage.removeHeader(name)</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>outgoingMessage.removeHeader(name)</code>æ˜¯ä¸€ä¸ªç”¨äºç§»é™¤ HTTP æ¶ˆæ¯å¤´çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å±äº HTTP æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒé€šå¸¸ç”¨äºå¯¹å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å‘é€çš„ HTTP æ¶ˆæ¯è¿›è¡Œæ“ä½œã€‚</p><p>é¦–å…ˆï¼Œ<code>outgoingMessage</code>æ˜¯ Node.js HTTP æ¨¡å—ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä»£è¡¨æ­£åœ¨å‘é€çš„ HTTP å“åº”æˆ–è¯·æ±‚ã€‚åœ¨ HTTP å“åº”ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡é€šå¸¸è¢«ç§°ä¸º<code>response</code>ï¼ˆç®€å†™ä¸º<code>res</code>ï¼‰ï¼Œè€Œåœ¨ HTTP è¯·æ±‚ä¸­ï¼Œå®ƒå¯ä»¥è¢«ç§°ä¸º<code>request</code>ï¼ˆç®€å†™ä¸º<code>req</code>ï¼‰ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ¥è§£é‡Š<code>removeHeader(name)</code>æ–¹æ³•ï¼š</p><ul><li><code>name</code>ï¼šè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦ç§»é™¤çš„ HTTP å¤´éƒ¨å­—æ®µçš„åç§°ã€‚</li><li><code>removeHeader</code>ï¼šè¿™ä¸ªæ–¹æ³•ä¼šä»å³å°†å‘é€çš„æ¶ˆæ¯ä¸­ç§»é™¤æŒ‡å®šçš„å¤´éƒ¨å­—æ®µã€‚</li></ul><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js ç¼–å†™æœåŠ¡å™¨ä»£ç æ—¶ï¼Œæœ‰æ—¶ä½ å¯èƒ½å·²ç»è®¾ç½®äº†æŸä¸ª HTTP å¤´éƒ¨å­—æ®µï¼Œä½†åæ¥å†³å®šä¸å‘é€è¿™ä¸ªå­—æ®µç»™å®¢æˆ·ç«¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>removeHeader</code>æ¥ç§»é™¤æ­¤å­—æ®µã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js çš„ HTTP æœåŠ¡å™¨ï¼Œä½ æƒ³æ ¹æ®æŸäº›æ¡ä»¶ç§»é™¤ä¹‹å‰è®¾ç½®çš„<code>&#39;Content-Type&#39;</code>å“åº”å¤´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬å¼€å§‹è®¾ç½®äº†&#39;Content-Type&#39;å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æŸäº›é€»è¾‘åˆ¤æ–­ï¼Œå†³å®šæ˜¯å¦éœ€è¦ç§»é™¤è¿™ä¸ªå¤´éƒ¨</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#616E88;">/* æŸä¸ªç‰¹å®šæ¡ä»¶æ»¡è¶³ */</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // ç§»é™¤&#39;Content-Type&#39;å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, World!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼š</p><ol><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚</li><li>å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬é»˜è®¤ä¸ºå“åº”è®¾ç½®äº†<code>&#39;Content-Type&#39;</code>å¤´éƒ¨ä¸º<code>&#39;text/html&#39;</code>ã€‚</li><li>æ ¹æ®æŸäº›æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>res.removeHeader(&#39;Content-Type&#39;)</code>ç§»é™¤äº†<code>&#39;Content-Type&#39;</code>å¤´éƒ¨ã€‚</li><li>æœ€åå‘å®¢æˆ·ç«¯å‘é€å“åº”ï¼Œå¦‚æœ<code>&#39;Content-Type&#39;</code>å¤´éƒ¨è¢«ç§»é™¤ï¼Œå®¢æˆ·ç«¯å°†ä¸ä¼šçŸ¥é“å“åº”ä½“çš„å†…å®¹ç±»å‹ã€‚</li></ol><p>è¿™æ ·ï¼Œä½¿ç”¨<code>removeHeader</code>æ–¹æ³•å¯ä»¥çµæ´»åœ°æ§åˆ¶ HTTP å“åº”çš„å¤´éƒ¨ä¿¡æ¯ã€‚è®°ä½ï¼Œåœ¨è°ƒç”¨<code>res.end()</code>å‘é€å“åº”ä½“ä¹‹å‰ï¼Œå¯ä»¥éšæ—¶æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤ HTTP å¤´éƒ¨å­—æ®µã€‚</p><h3 id="outgoingmessage-setheader-name-value" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-setheader-name-value"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagesetheadername-value" target="_blank" rel="noopener noreferrer">outgoingMessage.setHeader(name, value)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­ <code>outgoingMessage.setHeader(name, value)</code> è¿™ä¸ªæ–¹æ³•çš„ç”¨é€”å’Œè¿ç”¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>http.OutgoingMessage</code> æ˜¯ä¸€ä¸ªå†…å»ºçš„ç±»ï¼Œå®ƒç”¨äºè¡¨ç¤ºä¸€ä¸ªå³å°†å‘é€åˆ°å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰çš„æ¶ˆæ¯ã€‚è¿™ä¸ªæ¶ˆæ¯å¯ä»¥æ˜¯ä¸€ä¸ª HTTP å“åº”ï¼Œä¹Ÿå°±æ˜¯ä½ åœ¨æœåŠ¡å™¨ä¸Šå¤„ç†å®Œä¸€ä¸ªè¯·æ±‚åè¦å‘å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ã€‚<code>OutgoingMessage</code> çš„å®ä¾‹åŒ…å«äº†ä¸€ç³»åˆ—çš„å±æ€§å’Œæ–¹æ³•ï¼Œç”¨æ¥è®¾ç½®è¿™ä¸ªå“åº”çš„å„ç§å‚æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ HTTP å¤´å­—æ®µã€‚</p><p>HTTP å¤´éƒ¨ï¼ˆHeadersï¼‰æ˜¯åœ¨å‘é€ HTTP è¯·æ±‚æˆ–å“åº”æ—¶é™„å¸¦çš„é¢å¤–ä¿¡æ¯ï¼Œå®ƒä»¬å®šä¹‰äº†ä¼ è¾“ä¸­çš„å„ç§æ¡ä»¶å’Œå±æ€§ï¼Œå¦‚å†…å®¹ç±»å‹ã€ç¼“å­˜æ§åˆ¶ã€è®¤è¯ä¿¡æ¯ç­‰ã€‚</p><p><code>outgoingMessage.setHeader(name, value)</code> è¿™ä¸ªæ–¹æ³•å…è®¸ä½ åœ¨ <code>OutgoingMessage</code> å¯¹è±¡ä¸Šè®¾ç½®ä¸€ä¸ª HTTP å¤´éƒ¨å­—æ®µã€‚è¿™é‡Œçš„ <code>name</code> å°±æ˜¯å¤´éƒ¨å­—æ®µçš„åç§°ï¼Œæ¯”å¦‚ &quot;Content-Type&quot;ã€&quot;Content-Length&quot; æˆ–è€… &quot;Set-Cookie&quot; ç­‰ï¼›<code>value</code> åˆ™æ˜¯å¯¹åº”çš„å€¼ï¼Œå®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²æ•°ç»„ï¼ˆå¦‚æœä¸€ä¸ªå¤´éƒ¨å­—æ®µæœ‰å¤šä¸ªå€¼çš„è¯ï¼‰ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p><strong>è®¾ç½®å†…å®¹ç±»å‹</strong>ï¼šå‡è®¾ä½ æƒ³è¿”å›ä¸€äº› HTML å†…å®¹ã€‚ä½ éœ€è¦å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªå“åº”åŒ…å«çš„æ˜¯ HTMLï¼Œæ‰€ä»¥ä½ ä¼šè®¾ç½® &quot;Content-Type&quot; å¤´éƒ¨å­—æ®µä¸º &quot;text/html&quot;ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, World!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªå“åº” (<code>res</code>)ï¼Œå¹¶é€šè¿‡ <code>res.setHeader</code> æ–¹æ³•è®¾ç½® &quot;Content-Type&quot; å¤´éƒ¨å­—æ®µä¸º &quot;text/html&quot;ï¼Œç„¶åå‘é€ä¸€ä¸ªç®€å•çš„ HTML æ–‡æœ¬ä½œä¸ºå“åº”ä½“ã€‚</p></li><li><p><strong>è®¾ç½® cookie</strong>ï¼šå¦‚æœä½ æƒ³åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè®¾ç½®ä¸€ä¸ª cookieï¼Œä¾‹å¦‚ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>setHeader</code> æ–¹æ³•æ¥è®¾ç½® &quot;Set-Cookie&quot; å¤´éƒ¨å­—æ®µã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Set-Cookie</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">type=ninja</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">language=javascript</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cookie set</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸¤ä¸ª cookiesï¼š&quot;type&quot; è®¾ä¸º &quot;ninja&quot;ï¼Œ&quot;language&quot; è®¾ä¸º &quot;javascript&quot;ã€‚</p></li><li><p><strong>æ§åˆ¶ç¼“å­˜</strong>ï¼šä½ å¯èƒ½ä¸å¸Œæœ›å®¢æˆ·ç«¯ç¼“å­˜æŸäº›å“åº”ã€‚é€šè¿‡è®¾ç½® &quot;Cache-Control&quot; å¤´éƒ¨å­—æ®µï¼Œä½ å¯ä»¥æŒ‡ç¤ºæµè§ˆå™¨ä¸è¦ç¼“å­˜è¿™ä¸ªå“åº”ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cache-Control</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">no-cache, no-store, must-revalidate</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This response will not be cached</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ <code>setHeader</code> è®¾ç½® &quot;Cache-Control&quot; å¤´éƒ¨å­—æ®µï¼Œè®©æµè§ˆå™¨çŸ¥é“ä¸åº”è¯¥ç¼“å­˜è¿™ä¸ªå“åº”ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œ<code>outgoingMessage.setHeader(name, value)</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªç”¨äºé…ç½® HTTP å“åº”å¤´éƒ¨çš„æ–¹æ³•ï¼Œå®ƒéå¸¸é‡è¦ï¼Œå› ä¸ºæ­£ç¡®åœ°è®¾ç½®è¿™äº›å¤´éƒ¨å­—æ®µå¯ä»¥æ§åˆ¶ä½ çš„åº”ç”¨ç¨‹åºå¦‚ä½•ä¸å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰äº¤äº’ã€‚</p><h3 id="outgoingmessage-setheaders-headers" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-setheaders-headers"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagesetheadersheaders" target="_blank" rel="noopener noreferrer">outgoingMessage.setHeaders(headers)</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„ <code>outgoingMessage.setHeaders(headers)</code> å‡½æ•°æ˜¯ <code>http</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè®¾ç½®å³å°†å‘é€çš„ HTTP æ¶ˆæ¯ï¼ˆå¦‚è¯·æ±‚æˆ–å“åº”ï¼‰çš„å¤´éƒ¨ä¿¡æ¯ã€‚</p><p>åœ¨ HTTP é€šä¿¡ä¸­ï¼Œå¤´éƒ¨ï¼ˆHeadersï¼‰æºå¸¦äº†å…³äºå³å°†å‘é€çš„æ¶ˆæ¯çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚å†…å®¹ç±»å‹ã€é•¿åº¦ã€ç¼–ç æ–¹å¼ç­‰ã€‚é€šè¿‡ <code>setHeaders</code> æ–¹æ³•å¯ä»¥ä¸€æ¬¡æ€§åœ°è®¾ç½®å¤šä¸ªè¿™æ ·çš„å¤´éƒ¨ä¿¡æ¯ã€‚</p><p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong><br> è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¯¹è±¡ä¸­çš„é”®ï¼ˆkeysï¼‰ä»£è¡¨å¤´éƒ¨çš„åç§°ï¼Œè€Œå¯¹åº”çš„å€¼ï¼ˆvaluesï¼‰ä»£è¡¨å¤´éƒ¨çš„å€¼ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå®é™…ä¾‹å­ï¼š</p><p><strong>ä¾‹å­ 1ï¼šè®¾ç½® HTTP å“åº”å¤´éƒ¨</strong></p><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ª Node.js ç½‘ç»œåº”ç”¨ï¼Œéœ€è¦å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª JSON æ ¼å¼çš„å“åº”ã€‚ä½ éœ€è¦è®¾ç½® <code>Content-Type</code> å¤´éƒ¨å‘Šè¯‰å®¢æˆ·ç«¯ä½ å‘é€çš„æ˜¯ JSON æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”å¤´éƒ¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeaders</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">X-Powered-By</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>res.setHeaders</code> æ–¹æ³•è®¾ç½®äº†ä¸¤ä¸ªå¤´éƒ¨ä¿¡æ¯ï¼Œä¸€ä¸ªæŒ‡å®šäº†å†…å®¹ç±»å‹ä¸º JSON (<code>Content-Type: application/json</code>)ï¼Œå¦ä¸€ä¸ªæ˜¯è‡ªå®šä¹‰å¤´éƒ¨ (<code>X-Powered-By: Node.js</code>)ï¼Œæ ‡æ˜äº†æœåŠ¡ç”± Node.js æä¾›ã€‚</p><p><strong>ä¾‹å­ 2ï¼šè®¾ç½® HTTP è¯·æ±‚å¤´éƒ¨</strong></p><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js æ¥ä½œä¸ºå®¢æˆ·ç«¯å‘èµ· HTTP è¯·æ±‚ï¼Œå¯èƒ½ä¹Ÿéœ€è¦è®¾ç½®è¯·æ±‚å¤´éƒ¨æ¥å‘ŠçŸ¥æœåŠ¡å™¨ä¸€äº›ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">STATUS: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">HEADERS: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">BODY: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">No more data in response.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œè®¾ç½®è¯·æ±‚å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeaders</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  Accept</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å†™å…¥æ•°æ®åˆ°è¯·æ±‚ä¸»ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> data</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åœ¨å‘èµ· POST è¯·æ±‚å‰è®¾ç½®äº†ä¸¤ä¸ªè¯·æ±‚å¤´éƒ¨ã€‚<code>Content-Type</code> å¤´éƒ¨å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬æ­£åœ¨å‘é€ JSON æ ¼å¼çš„æ•°æ®ï¼Œè€Œ <code>Accept</code> å¤´éƒ¨å‘ŠçŸ¥æœåŠ¡å™¨æˆ‘ä»¬å¸Œæœ›æ”¶åˆ°çš„å“åº”æ ¼å¼ä¹Ÿæ˜¯ JSONã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™äº›ä»£ç ç¤ºä¾‹ä¸­çš„æ–¹æ³• <code>setHeaders</code> å¹¶ä¸æ˜¯ Node.js å®˜æ–¹æ–‡æ¡£ä¸­çš„æ–¹æ³•ã€‚å®˜æ–¹æ–‡æ¡£æ¨èä½¿ç”¨ <code>response.setHeader(name, value)</code> æ¥å•ç‹¬è®¾ç½®æ¯ä¸ªå¤´éƒ¨ï¼Œæˆ–è€…åœ¨åˆ›å»ºæœåŠ¡å™¨å“åº”æ—¶ç›´æ¥ä¼ é€’å¤´éƒ¨å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ç¢°åˆ°äº†æŸäº›ç¬¬ä¸‰æ–¹åº“æˆ–è€…æ¡†æ¶æä¾›äº† <code>setHeaders</code> æ–¹æ³•ï¼Œå…¶åº•å±‚åŸç†åº”è¯¥æ˜¯ç±»ä¼¼çš„ã€‚</p><h3 id="outgoingmessage-settimeout-msesc-callback" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-settimeout-msesc-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagesettimeoutmsesc-callback" target="_blank" rel="noopener noreferrer">outgoingMessage.setTimeout(msesc[, callback])</a></span></a></h3><p>Node.js ä¸­çš„ <code>outgoingMessage.setTimeout()</code> æ˜¯ä¸€ä¸ªç”¨äºè®¾ç½®è¶…æ—¶æ—¶é—´çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ http æ¨¡å—ä¸­ <code>OutgoingMessage</code> å¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦åº”ç”¨äº HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„å¼€å‘ä¸­ï¼Œç”¨æ¥æ§åˆ¶è¯·æ±‚æˆ–å“åº”åœ¨ç‰¹å®šæ—¶é—´å†…å®Œæˆäº¤äº’çš„èƒ½åŠ›ã€‚</p><h3 id="è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-2"><span>è§£é‡Š</span></a></h3><p>åœ¨è¯¦ç»†è§£é‡Šä¹‹å‰ï¼Œå…ˆç®€è¦äº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ul><li><strong>Node.js:</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>HTTP Module:</strong> Node.js æä¾›çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</li><li><strong>OutgoingMessage:</strong> åœ¨ HTTP æ¨¡å—ä¸­ï¼Œä»»ä½•å‘é€åˆ°å®¢æˆ·ç«¯çš„å“åº”ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰æˆ–å‘é€åˆ°æœåŠ¡å™¨çš„è¯·æ±‚ï¼ˆå®¢æˆ·ç«¯ï¼‰éƒ½è¢«å°è£…ä¸º <code>OutgoingMessage</code> çš„å®ä¾‹ã€‚</li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>outgoingMessage.setTimeout()</code> æ–¹æ³•ï¼š</p><h4 id="å‡½æ•°ç­¾å" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°ç­¾å"><span>å‡½æ•°ç­¾å</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">outgoingMessage</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">msec</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#D8DEE9FF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>msec</code>: è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼ˆmsï¼‰ã€‚è¿™æ˜¯ä½ æœŸæœ›æ“ä½œï¼ˆå¦‚å‘é€è¯·æ±‚æˆ–å“åº”ï¼‰åœ¨æ­¤æ—¶é—´å†…å®Œæˆçš„è®¾å®šå€¼ã€‚</li><li><code>callback</code>: è¶…æ—¶è§¦å‘æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚è¿™æ˜¯å¯é€‰å‚æ•°ã€‚</li></ul><h4 id="åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½"><span>åŠŸèƒ½</span></a></h4><p>è¿™ä¸ªæ–¹æ³•å…è®¸ä½ ä¸º HTTP è¯·æ±‚æˆ–å“åº”è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…æœªå®Œæˆå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œåˆ™ä¼šè‡ªåŠ¨è§¦å‘ &#39;timeout&#39; äº‹ä»¶ï¼Œå¹¶å¯ä»¥é€‰æ‹©æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-16"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”è¶…æ—¶"><span>ç¤ºä¾‹ 1: HTTP æœåŠ¡å™¨å“åº”è¶…æ—¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ æƒ³ç»™æœåŠ¡å™¨å“åº”è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œä»¥ç¡®ä¿å¦‚æœæœåŠ¡å™¨å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå®¢æˆ·ç«¯ä¸ä¼šæ— é™æœŸåœ°ç­‰å¾…ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”è¶…æ—¶ä¸º 5000 æ¯«ç§’ï¼ˆ5 ç§’ï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Response has timed out.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›è€—æ—¶çš„æ“ä½œ...</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 6000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å»¶è¿Ÿ6ç§’å‘é€å“åº”ï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å“åº”è¶…è¿‡ 5 ç§’ï¼Œé‚£ä¹ˆå°†æ‰“å°å‡º â€œResponse has timed out.â€ çš„æ¶ˆæ¯ã€‚ç”±äºæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ª 6 ç§’çš„å»¶è¿Ÿå“åº”ï¼Œæ‰€ä»¥å°†ä¼šè§¦å‘è¶…æ—¶é€»è¾‘ã€‚</p><h4 id="ç¤ºä¾‹-2-http-å®¢æˆ·ç«¯è¯·æ±‚è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-http-å®¢æˆ·ç«¯è¯·æ±‚è¶…æ—¶"><span>ç¤ºä¾‹ 2: HTTP å®¢æˆ·ç«¯è¯·æ±‚è¶…æ—¶</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ç¼–å†™å‘å¤–éƒ¨æœåŠ¡å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯ä»£ç ï¼Œå¯èƒ½ä¹Ÿå¸Œæœ›è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥é¿å…å› ä¸ºå¤–éƒ¨æœåŠ¡çš„å“åº”å»¶è¿Ÿè€Œå¯¼è‡´å®¢æˆ·ç«¯ç¨‹åºæŒ‚èµ·ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP GET è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">HTTP Status Code: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æ­£å¸¸å¤„ç†å“åº”...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º 2000 æ¯«ç§’ï¼ˆ2 ç§’ï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request has timed out.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¯·æ±‚ 2 ç§’å†…æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå°†ä¼šæ‰“å° â€œRequest has timed out.â€ çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å–æ¶ˆè¿™ä¸ªè¯·æ±‚ï¼Œé˜²æ­¢è¿›ä¸€æ­¥çš„èµ„æºæµªè´¹ã€‚</p><h3 id="ç»“è®º-5" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-5"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ <code>outgoingMessage.setTimeout()</code> æ–¹æ³•ï¼ŒNode.js å…è®¸å¼€å‘è€…ä¸º HTTP è¯·æ±‚å’Œå“åº”è®¾ç½®è¶…æ—¶æœºåˆ¶ï¼Œå¢å¼ºäº†ä»£ç çš„å¥å£®æ€§å¹¶æé«˜äº†ç”¨æˆ·ä½“éªŒã€‚è¿™åœ¨å¤„ç†å¤§é‡è¯·æ±‚æˆ–ä¾èµ–å¤–éƒ¨æœåŠ¡çš„æƒ…å†µä¸‹å°¤å…¶é‡è¦ã€‚</p><h3 id="outgoingmessage-socket" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-socket"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagesocket" target="_blank" rel="noopener noreferrer">outgoingMessage.socket</a></span></a></h3><p><code>outgoingMessage.socket</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒå…³è”åˆ°å¤„ç† HTTP è¯·æ±‚æˆ–å“åº”çš„åº•å±‚ç½‘ç»œå¥—æ¥å­—ï¼ˆsocketï¼‰ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>OutgoingMessage</code> æ˜¯ä¸€ä¸ªè¡¨ç¤ºå‘å‡ºå»çš„æ¶ˆæ¯çš„å¯¹è±¡ï¼Œè¿™å¯ä»¥æ˜¯å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„ HTTP è¯·æ±‚æˆ–è€…æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„ HTTP å“åº”ã€‚</p><p>å½“ä½ å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æˆ–è€…ç”Ÿæˆä¸€ä¸ªå“åº”æ—¶ï¼ŒNode.js ä¼šä½¿ç”¨ä¸€ä¸ª socket æ¥å®é™…å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚è¿™ä¸ª socket æ˜¯ä¸€ä¸ªç½‘ç»œçš„è¿æ¥ç‚¹ï¼Œå…è®¸ä½ çš„è®¡ç®—æœºå’Œå…¶ä»–è®¾å¤‡é€šè¿‡ç½‘ç»œé€šä¿¡ã€‚</p><p><code>outgoingMessage.socket</code> å±æ€§å°±æ˜¯å¯¹è¿™ä¸ªç”¨äºå‘é€ HTTP æ¶ˆæ¯çš„åº•å±‚ç½‘ç»œå¥—æ¥å­—çš„å¼•ç”¨ã€‚é€šå¸¸ï¼Œä½ å¯èƒ½ä¸éœ€è¦ç›´æ¥ä¸è¿™ä¸ª socket äº¤äº’ï¼Œå› ä¸º Node.js ä¼šå¸®ä½ å¤„ç†ç»†èŠ‚ã€‚ä½†æ˜¯ï¼Œäº†è§£å®ƒå­˜åœ¨å¹¶èƒ½å¤Ÿæä¾›ç»™ä½ æ›´æ·±å±‚æ¬¡çš„æ§åˆ¶å’Œä¿¡æ¯æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><p>å®é™…è¿ç”¨ä¾‹å­ï¼š</p><ol><li><strong>è·å–è¿œç¨‹åœ°å€ä¿¡æ¯</strong>ï¼šä½ å¯ä»¥ä½¿ç”¨ <code>outgoingMessage.socket</code> è·å–ä¸ HTTP äº¤æµç›¸å…³çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œå¦‚æœä½ æƒ³è¦è®°å½•æ¯ä¸ªè¯·æ±‚æ¥è‡ªå“ªä¸ª IP åœ°å€ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> remoteAddress</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> remotePort</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received request from </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”...</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>æ£€æŸ¥ socket æ˜¯å¦å·²ç»è¢«å‡çº§</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒHTTP è¿æ¥å¯èƒ½ä¼šè¢«å‡çº§åˆ°å…¶ä»–åè®®ï¼Œå¦‚ WebSocketã€‚ä½ å¯èƒ½æƒ³çŸ¥é“å½“å‰çš„ socket æ˜¯å¦è¿˜åœ¨å¤„ç† HTTP æˆ–è€…å·²ç»å‡çº§ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">upgraded</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœ socket å·²ç»è¢«å‡çº§äº†ï¼ˆä¾‹å¦‚ï¼Œåˆ° WebSocketï¼‰ï¼Œé‚£ä¹ˆè¿›è¡Œç›¸åº”å¤„ç†</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æ­£å¸¸å¤„ç† HTTP è¯·æ±‚å’Œå“åº”</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>æ‰‹åŠ¨å…³é—­è¿æ¥</strong>ï¼šè™½ç„¶ Node.js é€šå¸¸ä¼šä¸ºä½ ç®¡ç† socket çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†ä¹Ÿè®¸ä½ æƒ³åœ¨æŸä¸ªæ¡ä»¶ä¸‹å¼ºåˆ¶å…³é—­è¿æ¥ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#88C0D0;">shouldCloseConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„ <code>.destroy()</code> æ–¹æ³•å°†ä¼šç«‹å³ç»ˆæ­¢ socket è¿æ¥ï¼Œå¹¶ä¸”æ‰€æœ‰æœªå‘é€å®Œæ¯•çš„æ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚è¿™ç§æ–¹å¼åº”è¯¥è°¨æ…ä½¿ç”¨ï¼Œåªæœ‰åœ¨ä½ ç¡®å®éœ€è¦ç«‹å³å…³é—­è¿æ¥ä¸”ä¸å…³å¿ƒæœªå®Œæˆçš„æ•°æ®æ—¶æ‰é€‚åˆã€‚</p><h3 id="outgoingmessage-uncork" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-uncork"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessageuncork" target="_blank" rel="noopener noreferrer">outgoingMessage.uncork()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“æˆ‘ä»¬è°ˆè®º<code>outgoingMessage.uncork()</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ Node.js çš„æµï¼ˆStreamsï¼‰å’Œç¼“å†²ï¼ˆBufferingï¼‰æœºåˆ¶ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºç½‘ç»œæ“ä½œä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç† HTTPã€TCP æˆ–æµæ•°æ®æ—¶éå¸¸æœ‰ç”¨çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ã€‚</p><h3 id="streams-å’Œ-buffering" tabindex="-1"><a class="header-anchor" href="#streams-å’Œ-buffering"><span>Streams å’Œ Buffering</span></a></h3><p>Node.js ä½¿ç”¨äº†ä¸€ä¸ªæ¨¡å‹ï¼Œå«åšâ€œæµâ€ï¼ˆStreamsï¼‰ï¼Œæ¥å¤„ç†æ•°æ®å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šè®¯ç­‰ã€‚æµå¯ä»¥ç†è§£ä¸ºä¸€ç³»åˆ—çš„æ•°æ®ç‰‡æ®µï¼Œå®ƒä»¬å¯ä»¥è¿ç»­ä¸æ–­åœ°ä¼ è¾“ã€‚åœ¨å‘é€å¤§é‡æ•°æ®æ—¶ï¼Œç›´æ¥ä¸€æ¬¡æ€§å‘é€å…¨éƒ¨æ•°æ®å¯èƒ½ä¼šå¯¼è‡´èµ„æºæµªè´¹æˆ–æ•ˆç‡ä½ä¸‹ã€‚å› æ­¤ï¼Œæµå…è®¸æˆ‘ä»¬å°†æ•°æ®åˆ†æˆå°å—è¿›è¡Œä¼ è¾“ã€‚</p><p>åœ¨æµçš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œâ€œç¼“å†²â€ï¼ˆBufferingï¼‰å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚å®ƒæŒ‡çš„æ˜¯æš‚æ—¶å­˜å‚¨æ•°æ®çš„åŒºåŸŸï¼Œåœ¨æ•°æ®æœ€ç»ˆè¢«å‘é€ä¹‹å‰ï¼Œè¿™äº›æ•°æ®ä¼šç§¯ç´¯åœ¨ç¼“å†²åŒºä¸­ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æ‰¹é‡å‘é€æ•°æ®ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚</p><h3 id="cork-and-uncork-mechanism" tabindex="-1"><a class="header-anchor" href="#cork-and-uncork-mechanism"><span>Cork and Uncork Mechanism</span></a></h3><p>Node.js ä¸­çš„æµå®ç°äº†ä¸€ä¸ªç‰¹æ®Šçš„æœºåˆ¶ï¼Œç§°ä¸ºâ€œcork/uncorkâ€ã€‚å½“ä½ å°†ä¸€ä¸ªæµæ‰§è¡Œ<code>cork</code>æ“ä½œæ—¶ï¼ŒNode.js ä¼šå¼€å§‹ç¼“å†²åé¢å†™å…¥çš„æ‰€æœ‰æ•°æ®ã€‚åªæœ‰å½“ä½ è°ƒç”¨<code>uncork</code>æ–¹æ³•ï¼Œæˆ–è€…è‡ªåŠ¨è§¦å‘<code>flush</code>æ“ä½œæ—¶ï¼ˆæ¯”å¦‚æµå³å°†å…³é—­æ—¶ï¼‰ï¼Œè¿™äº›ç¼“å†²çš„æ•°æ®æ‰ä¼šå®é™…å‘é€ã€‚</p><h3 id="outgoingmessage-uncork-1" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-uncork-1"><span>outgoingMessage.uncork()</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>outgoingMessage</code>å¯¹è±¡ä»£è¡¨ç€ä¸€ä¸ªå³å°†å‘é€ç»™å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ª HTTP å“åº”æˆ–ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„å“åº”ã€‚</p><p>å½“ä½ ä½¿ç”¨<code>outgoingMessage.cork()</code>æ–¹æ³•æ—¶ï¼ŒNode.js ä¼šé˜»æ­¢æ¶ˆæ¯è¢«ç«‹åˆ»å‘é€å‡ºå»ï¼Œå¹¶ä¸”å¼€å§‹ç¼“å†²ä½ å†™å…¥åˆ°<code>outgoingMessage</code>çš„ä»»ä½•æ•°æ®ã€‚è¿™ä¸ªæ“ä½œç»å¸¸åœ¨ä½ æƒ³è¦ä¸€æ¬¡æ€§å‘é€å¤šä¸ªå°æ•°æ®ç‰‡æ®µæ—¶ä½¿ç”¨ã€‚</p><p>ç„¶åï¼Œå½“ä½ å®Œæˆäº†æ•°æ®å†™å…¥ï¼Œå¹¶ä¸”æƒ³è¦å‘é€æ‰€æœ‰ç¼“å†²çš„æ•°æ®æ—¶ï¼Œä½ å°±ä¼šè°ƒç”¨<code>outgoingMessage.uncork()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå°†æ‰€æœ‰ç¼“å†²çš„æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶æ¢å¤æ­£å¸¸çš„æ•°æ®æµåŠ¨ã€‚</p><h3 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­"><span>ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ æƒ³è¦å‘é€ä¸¤ä¸ªæ•°æ®å—ç»™å®¢æˆ·ç«¯â€”â€”é¦–å…ˆæ˜¯ HTML å¤´éƒ¨ï¼Œç„¶åæ˜¯ HTML ä¸»ä½“ã€‚ä½ å¸Œæœ›é€šè¿‡ç¼“å†²è¿™ä¸¤ä¸ªéƒ¨åˆ†æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™ä¹ˆåšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // Cork the response to start buffering</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // Write the first part of the message (e.g., HTML header)</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">`&lt;`!DOCTYPE html&gt;`&lt;`html&gt;`&lt;`head&gt;`&lt;`title&gt;My Page`&lt;`/title&gt;`&lt;`/head&gt;</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // Perform some operations, such as retrieving data for body...</span></span>
<span class="line"><span style="color:#88C0D0;">  processDataForBody</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">bodyData</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // Write the second part of the message (e.g., HTML body)</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">``</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">body&gt;</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">bodyData</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">/body&gt;</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">/html&gt;</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // Uncork the response to flush the buffered data</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">uncork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ä½¿ç”¨<code>.cork()</code>å’Œ<code>.uncork()</code>ï¼Œä½ ä¿è¯äº† HTML å¤´éƒ¨å’Œä¸»ä½“éƒ½è¢«ç¼“å†²å¹¶ä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€æ¬¡æ€§å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿå¹¶å¯èƒ½æé«˜äº†æ€§èƒ½ã€‚</p><p>æ€»ç»“ï¼š<code>outgoingMessage.uncork()</code>æ–¹æ³•ç”¨äºé‡Šæ”¾å…ˆå‰ä½¿ç”¨<code>.cork()</code>æ–¹æ³•ç¼“å†²çš„æ•°æ®ï¼Œä½¿å¾—æ‰€æœ‰ç¼“å†²çš„æ•°æ®è¢«å‘é€è‡³å®¢æˆ·ç«¯ã€‚è¿™ç§æœºåˆ¶åœ¨éœ€è¦æ§åˆ¶æ•°æ®å‘é€æ‰¹æ¬¡å’Œæ—¶é—´ç‚¹çš„åœºæ™¯ä¸‹ååˆ†æœ‰ç”¨ã€‚</p><h3 id="outgoingmessage-writablecorked" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writablecorked"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagewritablecorked" target="_blank" rel="noopener noreferrer">outgoingMessage.writableCorked</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä»¥ç®€å•çš„æ–¹å¼ç†è§£ <code>outgoingMessage.writableCorked</code> å±æ€§åœ¨ Node.js ä¸­çš„ä½œç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>: è¿™æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>HTTP æ¨¡å—</strong>: åœ¨ Node.js ä¸­ï¼ŒHTTP æ¨¡å—ä½¿ä½ èƒ½å¤Ÿåˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è¿™å¯¹äºå¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</li><li><strong>æµ(Streams)</strong>: è¿™æ˜¯ Node.js ä¸­å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®é‡å¤§æˆ–è€…æ•°æ®ä»¥ç‰‡æ®µå½¢å¼åˆ°è¾¾æ—¶ã€‚å®ƒä»¬å¯ä»¥ç”¨æ¥è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚</li><li><strong>Corking</strong>: åœ¨ Node.js çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œcorking ä¸€æ¡æµæ„å‘³ç€æš‚æ—¶åœæ­¢å°†æ•°æ®å‘é€åˆ°ç›®çš„åœ°ï¼Œå¹¶å°†åç»­æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ç›´åˆ°æµè¢« &quot;uncorked&quot;ï¼ˆè§£é™¤å°é—­ï¼‰ï¼Œæ‰€æœ‰ç§¯ç´¯çš„æ•°æ®æ‰ä¼šè¢«å‘é€ã€‚è¿™æœ‰åŠ©äºæé«˜æ•ˆç‡ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†è®¸å¤šå°çš„æ•°æ®ç‰‡æ®µæ—¶ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº <code>outgoingMessage.writableCorked</code> å±æ€§ã€‚</p><p><strong><code>outgoingMessage.writableCorked</code></strong></p><p>åœ¨ HTTP æ¨¡å—ä¸­ï¼Œ<code>OutgoingMessage</code> æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ­£åœ¨å‘é€çš„æ¶ˆæ¯çš„å¯¹è±¡ï¼Œå¦‚ä¸€ä¸ª HTTP è¯·æ±‚æˆ–å“åº”ã€‚<code>outgoingMessage.writableCorked</code> å±æ€§å°±æ˜¯ç”¨æ¥å‘Šè¯‰ä½ è¯¥æ¶ˆæ¯çš„æµå½“å‰æ˜¯å¦å¤„äº corked çŠ¶æ€ï¼Œä»¥åŠæœ‰å¤šå°‘æ¬¡ corking æ“ä½œè¿˜æ²¡æœ‰è¢«è§£é™¤ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>writableCorked</code> å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæµè¢« corked çš„æ·±åº¦ã€‚å¦‚æœè¯¥å€¼ä¸º 0ï¼Œåˆ™è¡¨ç¤ºæµå½“å‰ä¸æ˜¯ corked çŠ¶æ€ï¼›å¦‚æœå¤§äº 0ï¼Œåˆ™è¡¨ç¤ºæµå½“å‰æ˜¯ corked çŠ¶æ€ï¼Œå¹¶ä¸”è¯¥å€¼å‘Šè¯‰ä½ éœ€è¦è¿›è¡Œå¤šå°‘æ¬¡ uncork æ“ä½œæ‰èƒ½è§£é™¤æ‰€æœ‰ corkingã€‚</p><p><strong>å®é™…è¿ç”¨ç¤ºä¾‹</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å‘å®¢æˆ·ç«¯å‘é€å¤§é‡çš„å°æ•°æ®åŒ…ã€‚</p><p>ä¸ä½¿ç”¨ corking:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå°±å‘é€å¾ˆå¤šå°çš„æ•°æ®ç‰‡æ®µã€‚</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 1000</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ•°æ®ç‰‡æ®µ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">i</span><span style="color:#81A1C1;">}</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯ä¸ªå°æ•°æ®ç‰‡æ®µéƒ½å¯èƒ½è§¦å‘å•ç‹¬çš„ TCP æ•°æ®åŒ…ï¼Œè¿™åœ¨ç½‘ç»œæ•ˆç‡ä¸Šæ˜¯ä½æ•ˆçš„ã€‚</p><p>ä½¿ç”¨ corking:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // Cork the stream.</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cork</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç„¶åå‘é€å¾ˆå¤šå°çš„æ•°æ®ç‰‡æ®µã€‚</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 1000</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ•°æ®ç‰‡æ®µ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">i</span><span style="color:#81A1C1;">}</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æœ€åï¼Œè§£é™¤ cork çŠ¶æ€ï¼Œæ‰€æœ‰æ•°æ®ä¼šä½œä¸ºä¸€ä¸ªæ›´å¤§çš„å•å…ƒå‘é€ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">nextTick</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">uncork</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä½¿ç”¨äº† corking çš„ç‰ˆæœ¬ä¸­ï¼Œæ‰€æœ‰çš„å°æ•°æ®ç‰‡æ®µéƒ½ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œç›´åˆ°è°ƒç”¨ <code>res.uncork()</code>ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡å‡å°‘ TCP æ•°æ®åŒ…çš„æ•°é‡æ¥å¢åŠ ç½‘ç»œæ•ˆç‡ã€‚</p><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œ<code>outgoingMessage.writableCorked</code> å°†åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­åœ¨è°ƒç”¨ <code>res.cork()</code> åè¿”å› 1ï¼Œåœ¨è°ƒç”¨ <code>res.uncork()</code> åè¿”å› 0ï¼Œè¡¨æ˜æµçš„ cork çŠ¶æ€ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>outgoingMessage.writableCorked</code> å±æ€§ä»¥åŠç›¸å…³çš„ <code>cork()</code> å’Œ <code>uncork()</code> æ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…ä»¥æ›´é«˜æ•ˆçš„æ–¹å¼æ§åˆ¶æ•°æ®çš„å‘é€ï¼Œç‰¹åˆ«æ˜¯å½“å¤„ç†å¤§é‡å°æ•°æ®ç‰‡æ®µæ—¶ã€‚</p><h3 id="outgoingmessage-writableended" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writableended"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagewritableended" target="_blank" rel="noopener noreferrer">outgoingMessage.writableEnded</a></span></a></h3><p>äº†è§£ <code>outgoingMessage.writableEnded</code> å±æ€§ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç¡®å‡ ä¸ªæ¦‚å¿µï¼šNode.jsã€HTTP æ¨¡å—ã€ä»¥åŠæµ(Streams)ã€‚</p><ol><li><strong>Node.js</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚</li><li><strong>HTTP æ¨¡å—</strong>ï¼šNode.js ä¸­çš„ HTTP æ¨¡å—å…è®¸ Node.js èƒ½å¤Ÿä½œä¸ºæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å’Œåˆ›å»ºå“åº”ã€‚</li><li><strong>æµ(Streams)</strong>ï¼šæµæ˜¯ Node.js ä¸­å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼ˆå¦‚è¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼‰ã€‚å®ƒä»¬å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>outgoingMessage.writableEnded</code>ï¼š</p><h3 id="outgoingmessage-writableended-1" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writableended-1"><span><code>outgoingMessage.writableEnded</code></span></a></h3><ul><li>å½“æˆ‘ä»¬è°ˆè®º <code>outgoingMessage</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‡çš„æ˜¯é€šè¿‡ HTTP æ¨¡å—å‘é€çš„è¯·æ±‚æˆ–å“åº”å¯¹è±¡ã€‚</li><li><code>writableEnded</code> æ˜¯ <code>outgoingMessage</code> å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå±æ€§ã€‚å®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼Œç”¨æ¥æ ‡è¯†æµæ˜¯å¦å·²ç»ç»“æŸäº†å†™æ“ä½œã€‚å½“æµçš„ç»“æŸæ–¹æ³•ï¼ˆå¦‚ <code>.end()</code>ï¼‰è¢«è°ƒç”¨åï¼Œæ­¤å±æ€§å°†å˜ä¸º <code>true</code>ã€‚</li></ul><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-22" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-22"><span>å®é™…è¿ç”¨çš„ä¾‹å­:</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåŠŸèƒ½ï¼Œå‘ç”¨æˆ·æä¾›ä¸€äº›æ•°æ®æ–‡ä»¶ä¸‹è½½ã€‚</p><ol><li><strong>æ–‡ä»¶ä¸‹è½½ API</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶ä½äº &quot;./data/myfile.zip&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./data/myfile.zip</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬æµçš„ &#39;open&#39; äº‹ä»¶ï¼Œå¼€å§‹å‘å“åº”ä¸­å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">open</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬æµçš„ &#39;end&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Stream finished.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ writableEnded æ£€æŸ¥æµæ˜¯å¦å®Œæˆå†™å…¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableEnded</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Response has been sent completely.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸‹è½½æœåŠ¡ã€‚å½“è¯·æ±‚ &quot;/data/myfile.zip&quot; æ–‡ä»¶æ—¶ï¼ŒæœåŠ¡å™¨ä¼šé€šè¿‡ HTTP å“åº”å‘é€è¯¥æ–‡ä»¶ã€‚ä½¿ç”¨ <code>res.writableEnded</code> å¯ä»¥æ£€æŸ¥å“åº”æ˜¯å¦å®Œå…¨å‘é€ç»™äº†å®¢æˆ·ç«¯ã€‚</p><ul><li>åœ¨æµç»“æŸ (<code>stream.on(&#39;end&#39;)</code>) åï¼Œæˆ‘ä»¬æ‰“å°å‡º <code>&quot;Stream finished.&quot;</code> æ¥å‘ŠçŸ¥æ–‡ä»¶è¯»å–å®Œæ¯•ã€‚</li><li>å½“å“åº”ç»“æŸ (<code>res.on(&#39;finish&#39;)</code>) æ—¶ï¼Œé€šè¿‡æ£€æŸ¥ <code>res.writableEnded</code>ï¼Œæˆ‘ä»¬ç¡®è®¤å“åº”æ˜¯å¦æˆåŠŸå‘é€ã€‚å¦‚æœä¸º <code>true</code>ï¼Œè¡¨ç¤ºæ‰€æœ‰æ•°æ®å·²æˆåŠŸå‘å‡ºã€‚</li></ul><p>è¿™æ ·çš„æœºåˆ¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ç¡®è®¤æ•°æ®æ˜¯å¦å®Œæ•´å‘é€è‡³å®¢æˆ·ç«¯çš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸‹è½½ã€å¤§æ•°æ®ä¼ è¾“ç­‰ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ ç†è§£ <code>outgoingMessage.writableEnded</code> çš„æ¦‚å¿µï¼</p><h3 id="outgoingmessage-writablefinished" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writablefinished"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagewritablefinished" target="_blank" rel="noopener noreferrer">outgoingMessage.writableFinished</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>outgoingMessage.writableFinished</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥æŒ‡ç¤ºæ˜¯å¦å·²ç»æˆåŠŸå®Œæˆå¯¹ä¸€ä¸ª outgoing messageï¼ˆå³å‘å‡ºçš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ HTTP å“åº”æˆ–è¯·æ±‚ï¼‰çš„å†™å…¥æ“ä½œã€‚å½“ä½ å‘å®¢æˆ·ç«¯å‘é€æ•°æ®æˆ–å“åº”æ—¶ï¼Œäº†è§£æ•°æ®æ˜¯å¦å®Œå…¨å‘é€å®Œæ¯•æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ­£æ˜¯ <code>writableFinished</code> å±æ€§çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p><h3 id="æ˜“æ‡‚è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#æ˜“æ‡‚è§£é‡Š"><span>æ˜“æ‡‚è§£é‡Š</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨é€šè¿‡é‚®ä»¶å‘é€ä¸€å°ä¿¡ã€‚ä¿¡ä»¶çš„æ’°å†™å’Œå¯„é€è¿‡ç¨‹å¯ä»¥ç±»æ¯”äºåœ¨ Node.js ä¸­å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼š</p><ol><li><strong>å¼€å§‹å†™ä¿¡</strong> - å¼€å§‹å¾€ HTTP å“åº”ä½“ä¸­å†™å…¥æ•°æ®ã€‚</li><li><strong>å°ä¿¡</strong> - æ•°æ®å†™å…¥å®Œæˆï¼Œç»“æŸå“åº”ã€‚</li><li><strong>ç¡®è®¤ä¿¡å·²æŠ•é€’</strong> - ç¡®è®¤ä¿¡ä»¶ï¼ˆæ•°æ®ï¼‰æ˜¯å¦å·²ç»æˆåŠŸå¯„å‡ºå’ŒæŠ•é€’ã€‚</li></ol><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼Œâ€œç¡®è®¤ä¿¡å·²æŠ•é€’â€å¯¹åº”äºæ£€æŸ¥ <code>outgoingMessage.writableFinished</code> çš„å€¼ã€‚å¦‚æœå®ƒä¸º <code>true</code>ï¼Œå°±æ„å‘³ç€æ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»æˆåŠŸå†™å…¥åº•å±‚ç³»ç»Ÿï¼Œå¹¶ä¸”ä¸å†æ¥å—æ–°çš„æ•°æ®å†™å…¥â€”â€”å°±åƒä½ å·²ç»æŠŠä¿¡å¯„å‡ºï¼Œæ— æ³•å†å¾€ä¿¡å°é‡ŒåŠ ä¸œè¥¿ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-31" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-31"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å‘ç”¨æˆ·å‘é€å¤§é‡çš„æ•°æ®ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶ä¸‹è½½æˆ–è€…å¤§å‹çš„ JSON æ•°æ®é›†ã€‚ç¡®è®¤æ‰€æœ‰æ•°æ®æ˜¯å¦å·²ç»å‘é€ç»™ç”¨æˆ·æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>outgoingMessage.writableFinished</code> æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><h4 id="ç¤ºä¾‹-å‘é€å¤§å‹-json-æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-å‘é€å¤§å‹-json-æ•°æ®"><span>ç¤ºä¾‹ï¼šå‘é€å¤§å‹ JSON æ•°æ®</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹Ÿå¤§å‹æ•°æ®å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> largeData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#81A1C1;"> ...</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">largeData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å½“è°ƒç”¨ res.end() å¹¶ä¼ å…¥å›è°ƒåï¼Œæ•°æ®å†™å…¥è¿‡ç¨‹æ‰çœŸæ­£å®Œæˆ</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">å‘é€å®Œæˆï¼</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨æœåŠ¡å™¨å…³é—­äº‹ä»¶ä¸­æ£€æŸ¥ writableFinished å±æ€§</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableFinished</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">æ‰€æœ‰å“åº”å‡æˆåŠŸå‘é€ã€‚</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">å­˜åœ¨æœªå®Œæˆçš„å“åº”ã€‚</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šå‘æ¯ä¸ªè¯·æ±‚å‘é€ä¸€ä¸ªå¤§å‹çš„ JSON æ•°æ®ã€‚é€šè¿‡åœ¨ <code>res.end()</code> è°ƒç”¨çš„å›è°ƒä¸­æ‰“å°ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤æ•°æ®å‘é€æ˜¯å¦å®Œæˆã€‚æ­¤å¤–ï¼Œåœ¨æœåŠ¡å™¨å…³é—­å‰ï¼Œæˆ‘ä»¬è¿˜æ£€æŸ¥äº† <code>writableFinished</code> å±æ€§ï¼Œä»¥ç¡®è®¤æ‰€æœ‰çš„å“åº”æ˜¯å¦éƒ½å·²ç»è¢«æˆåŠŸå¤„ç†å’Œå‘é€ã€‚</p><h3 id="æ€»ç»“-22" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-22"><span>æ€»ç»“</span></a></h3><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>outgoingMessage.writableFinished</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªç”¨äºç¡®è®¤æ•°æ®æ˜¯å¦å·²ç»å®Œå…¨å†™å…¥å¹¶å®Œæˆå‘é€çš„å±æ€§ã€‚å®ƒå¯¹äºç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€æ’é”™å’Œä¼˜åŒ–æ€§èƒ½ç­‰æ–¹é¢éå¸¸æœ‰ç”¨ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ åº”è¯¥å¯ä»¥æ›´å¥½åœ°ç†è§£å®ƒçš„ä½œç”¨å’Œåº”ç”¨åœºæ™¯ã€‚</p><h3 id="outgoingmessage-writablehighwatermark" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writablehighwatermark"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagewritablehighwatermark" target="_blank" rel="noopener noreferrer">outgoingMessage.writableHighWaterMark</a></span></a></h3><p>ç†è§£ <code>outgoingMessage.writableHighWaterMark</code> è¿™ä¸ªæ¦‚å¿µï¼Œé¦–å…ˆå¾—çŸ¥é“å‡ ä¸ªå…³é”®ç‚¹ï¼šNode.jsã€Streamsï¼ˆæµï¼‰ã€ä»¥åŠ backpressureï¼ˆèƒŒå‹ï¼‰ã€‚</p><h3 id="node-js-ç®€ä»‹-2" tabindex="-1"><a class="header-anchor" href="#node-js-ç®€ä»‹-2"><span>Node.js ç®€ä»‹</span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptï¼Œæ˜¯æ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºï¼ˆå°¤å…¶æ˜¯åç«¯æœåŠ¡ï¼‰çš„çƒ­é—¨é€‰æ‹©ä¹‹ä¸€ã€‚</p><h3 id="streams-æµ" tabindex="-1"><a class="header-anchor" href="#streams-æµ"><span>Streamsï¼ˆæµï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æƒ³è±¡ä¸€ä¸‹æµæ°´ï¼ˆæ•°æ®ï¼‰ä»ä¸€å¤„ï¼ˆæ¯”å¦‚æ–‡ä»¶æˆ–ç½‘ç»œè¯·æ±‚ï¼‰æµå‘å¦ä¸€å¤„ï¼ˆæ¯”å¦‚å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œç»ˆç«¯ï¼Œæˆ–è€…å“åº”ä½“ï¼‰ã€‚è¿™ç§æ¨¡å‹å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯å¯ä»¥é€å—åœ°å¤„ç†ã€‚</p><h3 id="backpressure-èƒŒå‹" tabindex="-1"><a class="header-anchor" href="#backpressure-èƒŒå‹"><span>Backpressureï¼ˆèƒŒå‹ï¼‰</span></a></h3><p>å½“æ•°æ®çš„ç”Ÿäº§é€Ÿåº¦è¶…è¿‡æ¶ˆè´¹é€Ÿåº¦æ—¶ï¼Œå°±ä¼šå‘ç”ŸèƒŒå‹ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æœä½ æ­£åœ¨ä»ä¸€ä¸ªéå¸¸å¿«çš„ API æ¥æ”¶æ•°æ®ï¼Œä½†æ˜¯æŠŠæ•°æ®å†™å…¥ä¸€ä¸ªç›¸å¯¹è¾ƒæ…¢çš„æ•°æ®åº“ï¼Œé‚£ä¹ˆå¤„ç†é€Ÿåº¦çš„ä¸åŒ¹é…å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ•°æ®ä¸¢å¤±ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œæµæä¾›äº†æœºåˆ¶æ¥è‡ªåŠ¨ç®¡ç†æ•°æ®æµé€Ÿå’Œå¤„ç†èƒŒå‹ã€‚</p><h3 id="outgoingmessage-writablehighwatermark-1" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writablehighwatermark-1"><span><code>outgoingMessage.writableHighWaterMark</code></span></a></h3><p>è¿™é‡Œæˆ‘ä»¬ç‰¹åˆ«å…³æ³¨ Node.js çš„ http æ¨¡å—ä¸­çš„ <code>OutgoingMessage</code> å¯¹è±¡ï¼Œå®ƒæ˜¯ HTTP è¯·æ±‚æˆ–å“åº”çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ Node.js å¤„ç†å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚</p><ul><li><strong><code>writableHighWaterMark</code></strong> å±æ€§å°±æ˜¯æŒ‡åœ¨å¼€å§‹ç¼“å†²å†™å…¥ä¹‹å‰ï¼Œæµå¯ä»¥æ¥å—çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå®šä¹‰äº†â€œæ°´ä½çº¿â€ï¼Œå½“å†™å…¥çš„æ•°æ®é‡è¾¾åˆ°è¿™ä¸ªé™åˆ¶æ—¶ï¼Œæµä¼šåœæ­¢æ¥å—æ›´å¤šçš„æ•°æ®ï¼Œç›´åˆ°å·²ç»å†™å…¥çš„æ•°æ®è¢«æ¶ˆè´¹ï¼ˆæ¯”å¦‚è¢«å‘é€åˆ°å®¢æˆ·ç«¯ï¼‰ã€‚è¿™æ˜¯ä¸€ç§å¤„ç†èƒŒå‹çš„æœºåˆ¶ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ä¾‹å­-32" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-32"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦ä»æ•°æ®åº“ä¸­è¯»å–å¤§é‡æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®ä½œä¸º HTTP å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><ol><li><p><strong>æ— æ§åˆ¶ç¤ºä¾‹</strong>: å¦‚æœä½ ä¸åŠ æ§åˆ¶åœ°å°†æ‰€æœ‰æ•°æ®ç«‹å³å†™å…¥å“åº”å¯¹è±¡ï¼Œå¯èƒ½ä¼šå› ä¸ºå®¢æˆ·ç«¯æ¥æ”¶æ•°æ®çš„é€Ÿåº¦è·Ÿä¸ä¸Šè€Œå¯¼è‡´ç¨‹åºå‡ºç°å†…å­˜é—®é¢˜ã€‚</p></li><li><p><strong>ä½¿ç”¨<code>writableHighWaterMark</code> æ§åˆ¶</strong>: ä½ è®¾ç½® <code>writableHighWaterMark</code> ä¸ºä¸€ä¸ªåˆç†çš„å€¼ï¼ˆæ¯”å¦‚ 16KBï¼‰ï¼Œéšåé€šè¿‡æµå†™å…¥æ•°æ®åˆ°å“åº”å¯¹è±¡ã€‚è¿™æ ·ï¼Œåªè¦å†™å…¥çš„æ•°æ®é‡è¾¾åˆ° 16KBï¼ŒNode.js å°±ä¼šæš‚åœæ›´å¤šçš„æ•°æ®å†™å…¥ï¼Œç­‰å¾…å®¢æˆ·ç«¯â€œèµ¶ä¸Šâ€å†ç»§ç»­ã€‚</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾ fetchDataAsync æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œä»æ•°æ®åº“è·å–æ•°æ®</span></span>
<span class="line"><span style="color:#88C0D0;">  fetchDataAsync</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // è®¾ç½® writableHighWaterMark</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableHighWaterMark</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 16384</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // çº¦16KB</span></span>
<span class="line"><span style="color:#616E88;">      // å†™å…¥æ•°æ®åˆ°å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ çš„ç¨‹åºå¯ä»¥é«˜æ•ˆå¹¶ä¸”ç¨³å®šåœ°å¤„ç†å¤§é‡æ•°æ®ï¼ŒåŒæ—¶é¿å…ç”±äºèƒŒå‹é€ æˆçš„é—®é¢˜ã€‚</p><h3 id="outgoingmessage-writablelength" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writablelength"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagewritablelength" target="_blank" rel="noopener noreferrer">outgoingMessage.writableLength</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>outgoingMessage.writableLength</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒè¡¨ç¤ºåœ¨<code>OutgoingMessage</code>çš„å†…éƒ¨ç¼“å†²åŒºä¸­ç­‰å¾…è¢«å‘é€çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªå±æ€§éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ äº†è§£å½“å‰æœ‰å¤šå°‘æ•°æ®æ­£åœ¨æ’é˜Ÿç­‰å¾…è¾“å‡ºåˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ã€‚åœ¨è¿™é‡Œï¼Œâ€œOutgoingMessageâ€æ˜¯ä¸€ä¸ªåŸºç±»ï¼Œç”¨äº HTTP æ¨¡å—ä¸­çš„å®¢æˆ·ç«¯è¯·æ±‚(<code>http.ClientRequest</code>)å’ŒæœåŠ¡å™¨å“åº”(<code>http.ServerResponse</code>)ã€‚</p><h3 id="ç†è§£-outgoingmessage-writablelength" tabindex="-1"><a class="header-anchor" href="#ç†è§£-outgoingmessage-writablelength"><span>ç†è§£ <code>outgoingMessage.writableLength</code></span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ é€šè¿‡ HTTP å‘é€æ•°æ®æ—¶ï¼ˆæ¯”å¦‚ï¼Œä½œä¸ºæœåŠ¡å™¨å“åº”æˆ–å®¢æˆ·ç«¯è¯·æ±‚ï¼‰ï¼Œé‚£äº›æ•°æ®å¹¶ä¸æ€»æ˜¯ç«‹å³å‘å‡ºã€‚å®ƒä»¬ä¼šå…ˆè¢«æš‚å­˜åˆ°ä¸€ä¸ªå†…éƒ¨çš„ç¼“å†²åŒºä¸­ï¼Œç­‰å¾…é€‚å½“çš„æ—¶æœºæ‰çœŸæ­£å‘é€ç»™å¯¹æ–¹ã€‚è¿™ç§æƒ…å†µå°¤å…¶åœ¨å‘é€å¤§é‡æ•°æ®æˆ–ç½‘ç»œè¾ƒæ…¢æ—¶å¸¸è§ã€‚<code>outgoingMessage.writableLength</code>å°±æ˜¯ç”¨æ¥å‘Šè¯‰ä½ ï¼Œè¿™ä¸ªå†…éƒ¨ç¼“å†²åŒºç›®å‰ç§¯ç´¯äº†å¤šå°‘æ•°æ®ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-3" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-3"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šå¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦ä¼˜åŒ–ç½‘ç»œæ€§èƒ½çš„åº”ç”¨ï¼Œç›‘æ§<code>writableLength</code>å¯ä»¥å¸®åŠ©ä½ ç†è§£æ˜¯å¦æœ‰è¿‡å¤šçš„æ•°æ®åœ¨ç­‰å¾…å‘é€ã€‚å¦‚æœè¿™ä¸ªå€¼æŒç»­å¾ˆé«˜ï¼Œæ„å‘³ç€æ•°æ®å‘é€å¯èƒ½æ˜¯ä¸€ä¸ªç“¶é¢ˆã€‚</p></li><li><p><strong>æµé‡æ§åˆ¶</strong>ï¼šåœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ æˆ–è§†é¢‘æµä¼ è¾“ï¼Œä½¿ç”¨<code>writableLength</code>å¯ä»¥å¸®åŠ©å®ç°åå‹åŠ›æœºåˆ¶ã€‚å¦‚æœç¼“å†²åŒºçš„æ•°æ®é‡è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼ï¼Œä½ å¯ä»¥ä¸´æ—¶åœæ­¢è¯»å–æ›´å¤šçš„æ•°æ®ï¼Œç›´åˆ°ç¼“å†²åŒºçš„æ•°æ®é‡é™ä½ã€‚</p></li><li><p><strong>è°ƒè¯•</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°äº†æ•°æ®ä¼ è¾“ç›¸å…³çš„é—®é¢˜ï¼Œæ£€æŸ¥<code>writableLength</code>å¯ä»¥æä¾›çº¿ç´¢ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ•°æ®ä¼¼ä¹æ²¡æœ‰è¢«å‘é€å‡ºå»ï¼Œä¸€ä¸ªå¼‚å¸¸é«˜çš„<code>writableLength</code>å¯èƒ½æ„å‘³ç€æœ‰ä¸€ä¸ªæµç¨‹ä¸Šçš„é”™è¯¯å¯¼è‡´æ•°æ®è¢«å¡åœ¨äº†ç¼“å†²åŒºä¸­ã€‚</p></li></ol><h3 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹</span></a></h3><p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šä¸€ä¸ª Node.js HTTP æœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å‘é€ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®å“åº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> largeData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 10</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">a</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¤§çº¦10MBçš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Before sending: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableLength</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">largeData</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">After sending: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writableLength</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:8000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰“å°å‡ºåœ¨å‘é€å¤§é‡æ•°æ®ä¹‹å‰çš„<code>writableLength</code>ï¼Œç„¶åå†æ¬¡æ‰“å°å®ƒåœ¨æ•°æ®å‘é€åçš„å€¼ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯è§†åŒ–æ•°æ®æ˜¯æ€æ ·ä»å†…éƒ¨ç¼“å†²åŒºç§»åŠ¨çš„ã€‚</p><p>è¯·æ³¨æ„ï¼Œå…·ä½“çš„<code>writableLength</code>å€¼ä¾èµ–äºå¤šç§å› ç´ ï¼ŒåŒ…æ‹¬ç½‘ç»œé€Ÿåº¦ã€æ¥æ”¶æ–¹çš„å¤„ç†é€Ÿåº¦ç­‰ï¼Œå› æ­¤ä½ è§‚å¯Ÿåˆ°çš„è¡Œä¸ºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p><p>é€šè¿‡ä»¥ä¸Šè§£é‡Šå’Œç¤ºä¾‹ï¼Œå¸Œæœ›ä½ å¯¹<code>outgoingMessage.writableLength</code>æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ï¼Œä»¥åŠå®ƒåœ¨ Node.js ç½‘ç»œç¼–ç¨‹ä¸­çš„åº”ç”¨ä»·å€¼ã€‚</p><h3 id="outgoingmessage-writableobjectmode" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-writableobjectmode"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagewritableobjectmode" target="_blank" rel="noopener noreferrer">outgoingMessage.writableObjectMode</a></span></a></h3><p>è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°äº†è§£ <code>outgoingMessage.writableObjectMode</code> è¿™ä¸ªå±æ€§ï¼Œå¹¶ä¸”é€šè¿‡å‡ ä¸ªä¾‹å­æ¥åŠ æ·±ç†è§£ã€‚</p><p>é¦–å…ˆï¼Œè¦æ˜ç™½ <code>outgoingMessage.writableObjectMode</code> æ˜¯å±äº Node.js ä¸­çš„ HTTP æ¨¡å—ã€‚è¿™ä¸ªå±æ€§ä¸»è¦æ¶‰åŠåˆ°çš„æ˜¯æµ(Streams)çš„æ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§è·å–å…¨éƒ¨æ•°æ®æ—¶ï¼Œæµå¯ä»¥å¸®åŠ©ä½ åˆ†ç‰‡å¤„ç†æ•°æ®ã€‚Node.js æœ‰å››ç§åŸºæœ¬ç±»å‹çš„æµï¼šå¯è¯»ï¼ˆReadableï¼‰ã€å¯å†™ï¼ˆWritableï¼‰ã€åŒå·¥ï¼ˆDuplexï¼‰å’Œè½¬æ¢ï¼ˆTransformï¼‰æµã€‚</p><h3 id="writableobjectmode-ç®€è¿°" tabindex="-1"><a class="header-anchor" href="#writableobjectmode-ç®€è¿°"><span><code>writableObjectMode</code> ç®€è¿°ï¼š</span></a></h3><p><code>writableObjectMode</code> æ˜¯ä¸€ä¸ªç‰¹å®šäºå¯å†™æµï¼ˆWritable Streamï¼‰çš„å±æ€§ã€‚å½“è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œè¿™ä¸ªæµå¯ä»¥æ¥æ”¶ä»»ä½• JavaScript å¯¹è±¡ä½œä¸ºæ•°æ®å—ï¼Œè€Œä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²æˆ– Bufferã€‚è¿™å¯¹äºåœ¨åº”ç”¨ç¨‹åºä¸­å¤„ç†éæ–‡æœ¬å¯¹è±¡å°¤å…¶æœ‰ç”¨ã€‚</p><h3 id="åº”ç”¨åœºæ™¯ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯ç¤ºä¾‹"><span>åº”ç”¨åœºæ™¯ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-æ—¥å¿—è®°å½•ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ—¥å¿—è®°å½•ç³»ç»Ÿ"><span>ç¤ºä¾‹ 1ï¼šæ—¥å¿—è®°å½•ç³»ç»Ÿ</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªæ—¥å¿—è®°å½•ç³»ç»Ÿï¼Œéœ€è¦å¤„ç†å„ç§ç±»å‹çš„æ—¥å¿—æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯å¯èƒ½æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ã€é”™è¯¯å¯¹è±¡æˆ–åŒ…å«å¤šä¸ªå±æ€§çš„å¤æ‚å¯¹è±¡ã€‚å¦‚æœä½ çš„æ—¥å¿—å¤„ç†æµç¨‹æ¥å—å¯¹è±¡æ¨¡å¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥å°†è¿™äº›ä¸åŒå½¢å¼çš„æ—¥å¿—æ¶ˆæ¯å‘é€åˆ°æµä¸­ï¼Œè€Œä¸éœ€è¦å°†å®ƒä»¬è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Writable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œå¼€å¯å¯¹è±¡æ¨¡å¼</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myLoggerStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Writable</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  objectMode</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  write</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encoding</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Logging:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨æ—¥å¿—æµ</span></span>
<span class="line"><span style="color:#D8DEE9;">myLoggerStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> level</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">info</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This is an info message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myLoggerStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> level</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This is an error message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸæµ</span></span>
<span class="line"><span style="color:#D8DEE9;">myLoggerStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Finished logging</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å¤„ç†ç”¨æˆ·è¾“å…¥" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¤„ç†ç”¨æˆ·è¾“å…¥"><span>ç¤ºä¾‹ 2ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥ä¸Šä¼ ä¸åŒç±»å‹çš„æ•°æ®ï¼Œå¦‚æ–‡æœ¬ã€å›¾ç‰‡ã€JSON å¯¹è±¡ç­‰ã€‚ä½¿ç”¨å¯¹è±¡æ¨¡å¼çš„å¯å†™æµå¯ä»¥ç®€åŒ–å¤„ç†è¿™äº›ä¸åŒç±»å‹æ•°æ®çš„é€»è¾‘ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Writable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> body</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    req</span></span>
<span class="line"><span style="color:#ECEFF4;">      .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        body</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">      .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        body</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">concat</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">body</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">        // å‡è®¾æˆ‘ä»¬è§£æåˆ°çš„bodyæ˜¯ä¸ªJSONå¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">        const</span><span style="color:#D8DEE9;"> parsedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">body</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">        // å†™å…¥æ•°æ®åˆ°æŸä¸ªæ”¯æŒå¯¹è±¡æ¨¡å¼çš„æµ</span></span>
<span class="line"><span style="color:#81A1C1;">        const</span><span style="color:#D8DEE9;"> objectStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Writable</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">          objectMode</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">          write</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encoding</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">            // åœ¨è¿™é‡Œå¤„ç†å¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9;">            console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">            callback</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">          },</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">        objectStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">parsedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Data received and processed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­åˆ©ç”¨ <code>objectMode</code> å¤„ç†ä¸ä»…é™äºå­—ç¬¦ä¸²æˆ– Buffer çš„æ•°æ®ï¼Œä»è€Œæé«˜äº†æ•°æ®å¤„ç†çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚</p><h3 id="outgoingmessage-write-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#outgoingmessage-write-chunk-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#outgoingmessagewritechunk-encoding-callback" target="_blank" rel="noopener noreferrer">outgoingMessage.write(chunk[, encoding][, callback])</a></span></a></h3><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js è¿›è¡Œ Web å¼€å‘æ—¶ï¼Œå¤„ç† HTTP è¯·æ±‚å’Œå“åº”æ˜¯ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡ã€‚Node.js æä¾›äº†ä¸€ä¸ª<code>http</code>æ¨¡å—ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œä»¥ä¾¿å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>OutgoingMessage</code>å¯¹è±¡æ‰®æ¼”ç€å¾ˆé‡è¦çš„è§’è‰²ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æƒ³å‘å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶ã€‚</p><h3 id="ç†è§£-outgoingmessage-write-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#ç†è§£-outgoingmessage-write-chunk-encoding-callback"><span>ç†è§£ <code>outgoingMessage.write(chunk[, encoding][, callback])</code></span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å„ä¸ªéƒ¨åˆ†æ¥ç†è§£å®ƒçš„ä½œç”¨ï¼š</p><ul><li><p><strong>OutgoingMessage</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>OutgoingMessage</code>æ˜¯ä¸€ä¸ªå†…éƒ¨å¯¹è±¡ï¼Œè¡¨ç¤ºæ­£åœ¨å‘é€åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚ï¼ˆä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ï¼‰æˆ–ä¸€ä¸ª HTTP å“åº”ï¼ˆä»æœåŠ¡å™¨å‘é€åˆ°å®¢æˆ·ç«¯ï¼‰ã€‚å½“æˆ‘ä»¬è°ˆè®º<code>outgoingMessage.write</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‡çš„æ˜¯åœ¨æ„å»º HTTP å“åº”æ—¶ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p></li><li><p><strong>.write(chunk[, encoding][, callback])</strong>: è¿™æ˜¯<code>OutgoingMessage</code>å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ°æ¶ˆæ¯ä½“ä¸­ã€‚è¿™å¯¹äºå‘é€å¤§é‡æ•°æ®ï¼Œæˆ–è€…åœ¨æ•°æ®å®Œå…¨å‡†å¤‡å¥½ä¹‹å‰å°±å¼€å§‹å‘é€æ•°æ®å¾ˆæœ‰ç”¨ã€‚</p><ul><li><p><strong>chunk</strong>: è¿™æ˜¯ä½ æƒ³è¦å‘é€çš„æ•°æ®ç‰‡æ®µã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ª Bufferï¼ˆNode.js ä¸­ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„å¯¹è±¡ï¼‰ã€‚</p></li><li><p><strong>encoding</strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®š<code>chunk</code>çš„ç¼–ç ï¼ˆå¦‚æœ<code>chunk</code>æ˜¯å­—ç¬¦ä¸²çš„è¯ï¼‰ã€‚å¸¸è§çš„ç¼–ç æœ‰<code>&#39;utf8&#39;</code>, <code>&#39;ascii&#39;</code>, ç­‰ç­‰ã€‚å¦‚æœ<code>chunk</code>æ˜¯ä¸€ä¸ª Bufferï¼Œåˆ™æ­¤å‚æ•°ä¼šè¢«å¿½ç•¥ã€‚</p></li><li><p><strong>callback</strong>: è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œä¸€ä¸ªåœ¨å†™æ“ä½œå®Œæˆåä¼šè¢«è°ƒç”¨çš„å‡½æ•°ã€‚è¿™å¯¹äºçŸ¥é“ä½•æ—¶å¯ä»¥ç»§ç»­å‘é€æ›´å¤šæ•°æ®æˆ–è€…ç»“æŸå“åº”éå¸¸æœ‰ç”¨ã€‚</p></li></ul></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-33" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-33"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘é¡µæœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶ï¼Œä½ æƒ³å‘é€ä¸€ä¸ªç®€å•çš„ HTML é¡µé¢ã€‚è¿™é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨<code>outgoingMessage.write</code>æ–¹æ³•æ¥å®ç°çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”å¤´</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¼€å§‹å†™å…¥å“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`html&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`body&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello, World!`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`/body&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`/html&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬åœ¨3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>.write()</code>æ–¹æ³•å‘é€äº†ä¸€ä¸ªç®€å•çš„ HTML é¡µé¢ã€‚é€šè¿‡å¤šæ¬¡è°ƒç”¨<code>.write()</code>ï¼Œæˆ‘ä»¬é€æ­¥æ„å»ºäº†æ•´ä¸ªé¡µé¢ã€‚è¿™ä¸ªæ–¹æ³•ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬åœ¨æ•°æ®å‡†å¤‡å¥½å‘é€æ—¶å°±ç«‹å³å‘é€ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªå“åº”å†…å®¹éƒ½å‡†å¤‡å¥½ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>outgoingMessage.write()</code>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–¹æ³•ï¼Œä½¿å¾—åœ¨ Node.js ä¸­å¤„ç† HTTP å“åº”å˜å¾—çµæ´»å’Œé«˜æ•ˆã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥åœ¨æ•°æ®å‡†å¤‡å¥½æ—¶å°±ç«‹å³å¼€å§‹ä¼ è¾“ï¼Œä¼˜åŒ–äº†æ•°æ®å‘é€çš„æ•´ä¸ªæµç¨‹ã€‚</p><h2 id="http-methods" tabindex="-1"><a class="header-anchor" href="#http-methods"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpmethods" target="_blank" rel="noopener noreferrer">http.METHODS</a></span></a></h2><p>Node.js ä¸­çš„ <code>http.METHODS</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¿™äº›å­—ç¬¦ä¸²ä»£è¡¨äº†æ‰€æœ‰ç”± Node.js æ”¯æŒçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼ˆæˆ–è€…ç§°ä¸º&quot;åŠ¨ä½œ&quot;ï¼‰ã€‚HTTP è¯·æ±‚æ–¹æ³•æŒ‡æ˜äº†å®¢æˆ·ç«¯å¸Œæœ›å¯¹æœåŠ¡å™¨ä¸Šçš„èµ„æºæ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨é€”å’Œå«ä¹‰ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>http.METHODS</code> å±æ€§ä¼šåˆ—å‡ºæ‰€æœ‰ç¬¦åˆ IANA æ³¨å†Œçš„ HTTP æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•é€šå¸¸ä¹Ÿä¸æ‰€è°“çš„ RFC æ–‡æ¡£æ ‡å‡†ä¸€è‡´ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›æœ€å¸¸è§çš„ HTTP æ–¹æ³•ï¼š</p><ul><li><code>GET</code>: è¯·æ±‚è·å–èµ„æºï¼Œåªåº”å½“ç”¨äºè·å–æ•°æ®ã€‚</li><li><code>POST</code>: ç”¨äºæäº¤æ•°æ®ç»™æœåŠ¡å™¨ï¼Œä¾‹å¦‚æäº¤è¡¨å•ã€‚</li><li><code>PUT</code>: ç”¨äºä¸Šä¼ æ›´æ–°çš„å†…å®¹åˆ°æŒ‡å®šçš„èµ„æºã€‚</li><li><code>DELETE</code>: è¯·æ±‚åˆ é™¤æŒ‡å®šçš„èµ„æºã€‚</li><li><code>HEAD</code>: ç±»ä¼¼äº GETï¼Œä½†å®ƒä¸è¿”å›æ¶ˆæ¯ä½“ï¼Œåªè¿”å›å¤´ä¿¡æ¯ã€‚</li><li><code>OPTIONS</code>: ç”¨äºæè¿°ç›®æ ‡èµ„æºçš„é€šä¿¡é€‰é¡¹ã€‚</li></ul><p>ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>http.METHODS</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ‰“å°æ‰€æœ‰æ”¯æŒçš„ HTTP æ–¹æ³•</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">METHODS</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¤ºä¾‹è¾“å‡ºå¯èƒ½ç±»ä¼¼ï¼š</span></span>
<span class="line"><span style="color:#616E88;">// [</span></span>
<span class="line"><span style="color:#616E88;">//   &#39;ACL&#39;, &#39;BIND&#39;, &#39;CHECKOUT&#39;, &#39;CONNECT&#39;, &#39;COPY&#39;, &#39;DELETE&#39;,</span></span>
<span class="line"><span style="color:#616E88;">//   &#39;GET&#39;, &#39;HEAD&#39;, &#39;LINK&#39;, &#39;LOCK&#39;, &#39;M-SEARCH&#39;, &#39;MERGE&#39;,</span></span>
<span class="line"><span style="color:#616E88;">//   &#39;MKACTIVITY&#39;, &#39;MKCALENDAR&#39;, &#39;MKCOL&#39;, &#39;MOVE&#39;, &#39;NOTIFY&#39;,</span></span>
<span class="line"><span style="color:#616E88;">//   &#39;OPTIONS&#39;, &#39;PATCH&#39;, &#39;POST&#39;, &#39;PRI&#39;, &#39;PROPFIND&#39;, &#39;PROPPATCH&#39;,</span></span>
<span class="line"><span style="color:#616E88;">//   &#39;PURGE&#39;, &#39;PUT&#39;, &#39;REBIND&#39;, &#39;REPORT&#39;, &#39;SEARCH&#39;, &#39;SOURCE&#39;,</span></span>
<span class="line"><span style="color:#616E88;">//   &#39;SUBSCRIBE&#39;, &#39;TRACE&#39;, &#39;UNBIND&#39;, &#39;UNLINK&#39;, &#39;UNLOCK&#39;,</span></span>
<span class="line"><span style="color:#616E88;">//   &#39;UNSUBSCRIBE&#39;</span></span>
<span class="line"><span style="color:#616E88;">// ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</p><p>æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„åšå®¢ç³»ç»Ÿï¼Œä½ å¯èƒ½éœ€è¦å¤„ç†ä»¥ä¸‹ç±»å‹çš„ HTTP è¯·æ±‚ï¼š</p><ol><li>è·å–æ–‡ç« åˆ—è¡¨ï¼šä½ ä¼šä½¿ç”¨ <code>GET</code> æ–¹æ³•æ¥è·å–æ•°æ®ã€‚</li><li>å‘å¸ƒæ–°æ–‡ç« ï¼šä½ ä¼šä½¿ç”¨ <code>POST</code> æ–¹æ³•æ¥å‘é€æ–‡ç« æ•°æ®ã€‚</li><li>æ›´æ–°å·²å­˜åœ¨çš„æ–‡ç« ï¼šä½ ä¼šä½¿ç”¨ <code>PUT</code> æ–¹æ³•æ¥æäº¤æ–°çš„æ–‡ç« å†…å®¹ã€‚</li><li>åˆ é™¤æ–‡ç« ï¼šä½ ä¼šä½¿ç”¨ <code>DELETE</code> æ–¹æ³•æ¥ç§»é™¤ä¸€ä¸ªæ–‡ç« ã€‚</li></ol><p>åœ¨ Node.js ç¨‹åºä¸­ï¼Œä½ å¯ä»¥ç»“åˆä½¿ç”¨ <code>http.createServer()</code> å‡½æ•°å’Œ <code>http.METHODS</code> æ¥åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶æ ¹æ®ä¸åŒçš„è¯·æ±‚æ–¹æ³•æ¥åšå‡ºå“åº”ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> method</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç† GET è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received a GET request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç† POST è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received a POST request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PUT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç† PUT è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received a PUT request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">DELETE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç† DELETE è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received a DELETE request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received a </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> request</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®è¯·æ±‚çš„æ–¹æ³•ç±»å‹æ¥è¿”å›ä¸åŒçš„å“åº”ã€‚å°½ç®¡è¿™é‡Œåªå±•ç¤ºäº†å››ç§ HTTP æ–¹æ³•ï¼Œä½†æ˜¯çŸ¥é“ <code>http.METHODS</code> å¯ä»¥æä¾›æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œå¯¹äºåˆ›å»ºç¬¦åˆæ ‡å‡†çš„ã€èƒ½å¤Ÿæ­£ç¡®å“åº”å„ç§ HTTP è¯·æ±‚çš„ Web æœåŠ¡å™¨éå¸¸æœ‰å¸®åŠ©ã€‚</p><h2 id="http-status-codes" tabindex="-1"><a class="header-anchor" href="#http-status-codes"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpstatus_codes" target="_blank" rel="noopener noreferrer">http.STATUS_CODES</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚å®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ï¼Œè€Œä¸ä»…ä»…æ˜¯å‰ç«¯ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨åŒä¸€ç§è¯­è¨€æ¥å¼€å‘æ•´ä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºï¼Œä»ç”¨æˆ·ç•Œé¢åˆ°æœåŠ¡å™¨é€»è¾‘ã€‚</p><p><code>http.STATUS_CODES</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ç‰¹æ€§ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€ä¾¿çš„æ–¹å¼æ¥è®¿é—®æ‰€æœ‰çš„ HTTP çŠ¶æ€ç åŠå…¶å¯¹åº”çš„æè¿°æ–‡æœ¬ã€‚HTTP çŠ¶æ€ç æ˜¯æœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶è¿”å›çš„ä¸€ä¸ª 3 ä½æ•°å­—ä»£ç ï¼Œå®ƒä»¬å¸®åŠ©ä½ äº†è§£è¯·æ±‚æ˜¯æˆåŠŸäº†ã€å‡ºé”™äº†ï¼Œè¿˜æ˜¯éœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œã€‚</p><h3 id="ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª web æœåŠ¡ï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢æ—¶ï¼Œä½ æƒ³è¦è¿”å›â€œ404 Not Foundâ€é”™è¯¯ã€‚ä½¿ç”¨ Node.js, ä½ å¯ä»¥é€šè¿‡<code>http.STATUS_CODES</code>è½»æ¾è·å–è¿™ä¸ªçŠ¶æ€ç çš„æè¿°æ–‡æœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬æ²¡æ‰¾åˆ°è¯·æ±‚çš„èµ„æºï¼Œæˆ‘ä»¬è®¾ç½®çŠ¶æ€ç ä¸º404</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 404</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æˆ‘ä»¬ä»http.STATUS_CODESè·å–çŠ¶æ€ç 404çš„æ–‡æœ¬æè¿°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> statusMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">STATUS_CODES</span><span style="color:#D8DEE9FF;">[</span><span style="color:#B48EAD;">404</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”å¤´å’Œå“åº”ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> - </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">statusMessage</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœç”¨æˆ·è¯·æ±‚äº†æœåŠ¡å™¨ä¸Šä¸å­˜åœ¨çš„èµ„æºï¼Œä»–ä»¬å°†ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å«â€œError: 404 - Not Foundâ€çš„å“åº”ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åˆ©ç”¨<code>http.STATUS_CODES[404]</code>å¾—åˆ°äº†&quot;404&quot;çŠ¶æ€ç å¯¹åº”çš„æ–‡æœ¬æè¿°ï¼Œå¹¶å°†å…¶å‘é€ç»™äº†å®¢æˆ·ç«¯ã€‚</p><h3 id="å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨"><span>å®é™…åº”ç”¨</span></a></h3><ol><li><p><strong>API å¼€å‘</strong>: å½“ä½ æ„å»ºä¸€ä¸ª API æ—¶ï¼Œåˆç†ä½¿ç”¨ HTTP çŠ¶æ€ç å¯¹äºé€šçŸ¥å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸä¸å¦è‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·æˆåŠŸåˆ›å»ºä¸€ä¸ªèµ„æºæ—¶è¿”å›&quot;201 Created&quot;ï¼Œæˆ–è€…å½“ç”¨æˆ·çš„è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯æ—¶è¿”å›&quot;400 Bad Request&quot;ã€‚</p></li><li><p><strong>ç½‘é¡µå¼€å‘</strong>: åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ç½‘ç«™ä¸­ï¼Œæ­£ç¡®ä½¿ç”¨ HTTP çŠ¶æ€ç å¯ä»¥å¸®åŠ©æœç´¢å¼•æ“äº†è§£ç½‘ç«™çš„ç»“æ„ï¼Œæ¯”å¦‚ä½¿ç”¨&quot;301 Moved Permanently&quot;é‡å®šå‘æ—§é“¾æ¥åˆ°æ–°é“¾æ¥ï¼Œæˆ–è€…ä½¿ç”¨&quot;404 Not Found&quot;æ ‡è®°å¤±æ•ˆçš„é“¾æ¥ã€‚</p></li><li><p><strong>å¤„ç†é”™è¯¯å’Œè°ƒè¯•</strong>: åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨ HTTP çŠ¶æ€ç å¯ä»¥æ›´å®¹æ˜“åœ°è¯†åˆ«å’Œè°ƒè¯•é—®é¢˜ã€‚æ¯”å¦‚å½“ä½ çœ‹åˆ°ä¸€ä¸ª&quot;500 Internal Server Error&quot;ï¼Œä½ å°±çŸ¥é“é—®é¢˜å¾ˆå¯èƒ½å‡ºåœ¨æœåŠ¡å™¨çš„å†…éƒ¨é€»è¾‘ä¸Šã€‚</p></li></ol><p><code>http.STATUS_CODES</code>æä¾›çš„çŠ¶æ€ç å’Œæ–‡æœ¬æè¿°æ˜ å°„æ˜¯ä¸€ä¸ªç®€å•ä½†éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒè®©å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿå¼•ç”¨æ ‡å‡†çš„ HTTP å“åº”ï¼Œç¡®ä¿ä¸å®¢æˆ·ç«¯çš„é€šä¿¡æ˜ç¡®ä¸”æœ‰æ•ˆã€‚</p><h2 id="http-createserver-options-requestlistener" tabindex="-1"><a class="header-anchor" href="#http-createserver-options-requestlistener"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpcreateserveroptions-requestlistener" target="_blank" rel="noopener noreferrer">http.createServer([options][, requestListener])</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚<code>http.createServer()</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚</p><p>è¿™é‡Œæ˜¯ <code>http.createServer()</code> æ–¹æ³•çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¼•å…¥ http æ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // req æ˜¯ä¸€ä¸ª http.IncomingMessage å®ä¾‹ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#616E88;">  // res æ˜¯ä¸€ä¸ª http.ServerResponse å®ä¾‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨çš„å“åº”</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®å“åº”å¤´éƒ¨çŠ¶æ€ç å’Œå†…å®¹ç±»å‹</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€å“åº”æ•°æ® &quot;Hello World&quot; å¹¶ç»“æŸå“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®©æœåŠ¡å™¨ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>http</code> æ¨¡å—ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>http.createServer()</code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ã€‚è¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°åˆæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š<code>req</code>ï¼ˆè¯·æ±‚å¯¹è±¡ï¼‰å’Œ <code>res</code>ï¼ˆå“åº”å¯¹è±¡ï¼‰ã€‚</p><p>æ¯å½“æœ‰å®¢æˆ·ç«¯ï¼ˆå¦‚ç½‘é¡µæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚åˆ°è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°±ä¼šè¢«è§¦å‘ã€‚åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ“ä½œ <code>req</code> å’Œ <code>res</code> å¯¹è±¡æ¥å¤„ç†è¯·æ±‚å’Œå‘é€å“åº”ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>res.writeHead()</code> æ–¹æ³•è®¾ç½®äº†å“åº”çš„ HTTP çŠ¶æ€ç ä¸º 200ï¼ˆè¡¨ç¤ºæˆåŠŸï¼‰ï¼Œå¹¶ä¸”è®¾ç½®äº†å“åº”å†…å®¹çš„ç±»å‹ä¸ºçº¯æ–‡æœ¬ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ <code>res.end()</code> æ–¹æ³•å‘é€äº†ä¸€ä¸ªå­—ç¬¦ä¸² &quot;Hello World\n&quot; ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ç»“æŸäº†è¿™æ¬¡å“åº”ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>server.listen()</code> æ–¹æ³•è®©æœåŠ¡å™¨å¼€å§‹ç›‘å¬æŒ‡å®šçš„ç«¯å£å·ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ 3000ï¼‰ã€‚å½“æœåŠ¡å™¨å¼€å§‹è¿è¡Œåï¼Œä½ å¯ä»¥æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>http://localhost:3000</code>ï¼Œæµè§ˆå™¨å°±ä¼šæ˜¾ç¤º &quot;Hello World&quot;ã€‚</p><p>å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šæ ¹æ®ä¸åŒçš„ URL è·¯å¾„æˆ–è¯·æ±‚ç±»å‹ï¼ˆGETã€POST ç­‰ï¼‰æ¥å¤„ç†ä¸åŒçš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™é€šå¸¸æ¶‰åŠæ›´å¤æ‚çš„è·¯ç”±è®¾è®¡ï¼Œè€Œè¿™é€šå¸¸ä¼šä½¿ç”¨åƒ Express è¿™æ ·çš„æ¡†æ¶æ¥ç®€åŒ–å®ç°ã€‚ä½†åœ¨åº•å±‚ï¼Œæ— è®ºå“ªä¸ªæ¡†æ¶ï¼Œéƒ½æ˜¯å»ºç«‹åœ¨åŸç”Ÿçš„ Node.js http æ¨¡å—ä¹‹ä¸Šçš„ï¼Œ<code>http.createServer()</code> å°±æ˜¯è¿™ä¸€åˆ‡çš„èµ·ç‚¹ã€‚</p><h2 id="http-get-options-callback" tabindex="-1"><a class="header-anchor" href="#http-get-options-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpgetoptions-callback" target="_blank" rel="noopener noreferrer">http.get(options[, callback])</a></span></a></h2><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>http.get(options[, callback])</code> æ–¹æ³•ï¼Œå®ƒæ˜¯ Node.js æ ‡å‡†åº“ä¸­ <code>http</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•ç”¨äºå‘é€ä¸€ä¸ª HTTP GET è¯·æ±‚åˆ°ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶æ¥æ”¶å“åº”ã€‚</p><p>é¦–å…ˆï¼Œç†è§£ <code>http.get()</code> æ–¹æ³•çš„åŸºæœ¬æ¦‚å¿µå¾ˆé‡è¦ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›å®é™…ä¾‹å­æ¥æ­ç¤ºå…¶å¼ºå¤§ä¹‹å¤„ã€‚</p><h3 id="åŸºç¡€ç†è§£" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ç†è§£"><span>åŸºç¡€ç†è§£</span></a></h3><ul><li><strong>Node.js</strong>: ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œä½¿å¾—ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚</li><li><strong>http æ¨¡å—</strong>: Node.js çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œå®ƒå…è®¸ Node.js èƒ½å¤Ÿä¼ è¾“æ•°æ®<br> ï¼ˆHTTP åè®®ï¼‰ã€‚å®ƒæä¾›åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯·æ±‚çš„åŠŸèƒ½ã€‚</li><li><strong><code>http.get()</code> æ–¹æ³•</strong>: ä¸“é—¨ç”¨äºå‘é€ HTTP GET è¯·æ±‚ã€‚GET è¯·æ±‚ä¸€èˆ¬ç”¨äºè¯·æ±‚æ•°æ®ä»æŒ‡å®šçš„èµ„æºã€‚</li></ul><h3 id="å‚æ•°è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯¦è§£"><span>å‚æ•°è¯¦è§£</span></a></h3><ul><li><code>options</code>: å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¢«è§†ä¸º URLã€‚é€šå¸¸ï¼Œå®ƒåŒ…æ‹¬ç›®æ ‡çš„ hostnameã€pathã€port ç­‰ä¿¡æ¯ã€‚</li><li><code>callback</code>: å½“è¯·æ±‚å®Œæˆæ—¶è°ƒç”¨çš„å‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š<code>response</code> (å³å“åº”å¯¹è±¡)ã€‚</li></ul><h3 id="å®é™…ä½¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä½¿ç”¨ä¾‹å­-1"><span>å®é™…ä½¿ç”¨ä¾‹å­</span></a></h3><p><strong>ä¾‹å­ 1: è·å–ç½‘é¡µå†…å®¹</strong></p><p>å‡è®¾ä½ æƒ³è·å– Google ä¸»é¡µçš„ HTML å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¼•å…¥ HTTP æ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰è·å– Google ä¸»é¡µçš„é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.google.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // HTTP é»˜è®¤ç«¯å£æ˜¯ 80</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€ GET è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">resp</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ¥æ”¶æ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºè·å–åˆ°çš„ç½‘é¡µHTMLå†…å®¹</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 2: ç®€åŒ–ç‰ˆè·å– JSON æ•°æ®</strong></p><p>Node.js å…è®¸æˆ‘ä»¬ä»¥æ›´ç®€æ´çš„æ–¹å¼æ¥å‘é€ GET è¯·æ±‚ï¼Œç‰¹åˆ«é€‚åˆ API è°ƒç”¨åœºæ™¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ³¨æ„è¿™é‡Œä½¿ç”¨ https æ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›´æ¥ä½¿ç”¨ URL å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://api.example.com/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">resp</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾å“åº”æ˜¯ JSON æ ¼å¼ï¼Œè¿›è¡Œè§£æå¹¶è¾“å‡º</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°ç»“-7" tabindex="-1"><a class="header-anchor" href="#å°ç»“-7"><span>å°ç»“</span></a></h3><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿç†è§£ <code>http.get()</code> æ–¹æ³•å¦‚ä½•åœ¨ Node.js ç¯å¢ƒä¸‹å‘é€ HTTP GET è¯·æ±‚ï¼Œå¹¶å¤„ç†è¿”å›çš„æ•°æ®ã€‚æ— è®ºæ˜¯è·å–ç½‘é¡µå†…å®¹è¿˜æ˜¯è°ƒç”¨ REST APIï¼Œ<code>http.get()</code> éƒ½æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚è®°å¾—æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©æ­£ç¡®çš„æ¨¡å—ï¼ˆ<code>http</code> æˆ– <code>https</code>ï¼‰ï¼Œå¹¶ä¸”ç¡®ä¿ä½ å¯¹é”™è¯¯æƒ…å†µè¿›è¡Œäº†å¤„ç†ã€‚</p><h2 id="http-get-url-options-callback" tabindex="-1"><a class="header-anchor" href="#http-get-url-options-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpgeturl-options-callback" target="_blank" rel="noopener noreferrer">http.get(url[, options][, callback])</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚è€Œ <code>http.get</code> æ–¹æ³•æ˜¯ Node.js ä¸­ç”¨äºå‘èµ· HTTP GET è¯·æ±‚çš„ä¸€ç§æ–¹å¼ï¼Œå±äº Node.js çš„ HTTP æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©ä½ è¯·æ±‚ç½‘ç»œèµ„æºæˆ–ä¸å…¶ä»–æœåŠ¡å™¨äº¤äº’ã€‚</p><h3 id="http-get-url-options-callback-1" tabindex="-1"><a class="header-anchor" href="#http-get-url-options-callback-1"><span>http.get(url[, options][, callback])</span></a></h3><ul><li><strong>url</strong>ï¼šä½ æƒ³è¦è¯·æ±‚çš„ URL åœ°å€ã€‚</li><li><strong>options</strong>ï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºå®šåˆ¶ HTTP è¯·æ±‚çš„å„ç§è®¾ç½®ã€‚</li><li><strong>callback</strong>ï¼šå½“è¯·æ±‚å®Œæˆæ—¶ä¼šè¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚</li></ul><p>å½“ä½ ä½¿ç”¨ <code>http.get</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†è¯·æ±‚çš„æ–¹æ³•è®¾ç½®ä¸º GETï¼Œå¹¶åœ¨æ¥æ”¶åˆ°å®Œæ•´çš„å“åº”å¤´åç«‹å³è°ƒç”¨å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³ä¸€ä¸ª <code>IncomingMessage</code> å®ä¾‹ï¼Œç”¨äºè®¿é—®å“åº”çŠ¶æ€ã€å¤´ä¿¡æ¯ä»¥åŠæ•°æ®ä½“ã€‚</p><h4 id="ä¾‹å­-1-è¯·æ±‚ä¸€ä¸ªç½‘é¡µå†…å®¹" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯·æ±‚ä¸€ä¸ªç½‘é¡µå†…å®¹"><span>ä¾‹å­ 1: è¯·æ±‚ä¸€ä¸ªç½‘é¡µå†…å®¹</span></a></h4><p>å‡è®¾æˆ‘ä»¬æƒ³è¯·æ±‚ &quot;<a href="http://example.com" target="_blank" rel="noopener noreferrer">http://example.com</a>&quot; ç½‘ç«™çš„é¦–é¡µå†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ¥æ”¶æ•°æ®ç‰‡æ®µå¹¶æ‹¼æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>http</code> æ¨¡å—ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨ <code>http.get</code> æ–¹æ³•è¯·æ±‚ &quot;<a href="http://example.com" target="_blank" rel="noopener noreferrer">http://example.com</a>&quot; çš„å†…å®¹ã€‚å½“æ¥æ”¶åˆ°å“åº”æ•°æ®æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬ <code>data</code> äº‹ä»¶æ¥è·å–æ•°æ®ç‰‡æ®µï¼Œå¹¶å°†å®ƒä»¬æ‹¼æ¥æˆå®Œæ•´çš„å“åº”ä½“ã€‚å½“æ‰€æœ‰æ•°æ®è¢«æ¥æ”¶å®Œæ¯•åï¼Œ<code>end</code> äº‹ä»¶è¢«è§¦å‘ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰“å°å‡ºæ•´ä¸ªç½‘é¡µçš„ HTMLã€‚</p><h4 id="ä¾‹å­-2-è·å–-json-æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è·å–-json-æ•°æ®"><span>ä¾‹å­ 2: è·å– JSON æ•°æ®</span></a></h4><p>è®¸å¤šç°ä»£çš„ API è¿”å› JSON æ ¼å¼çš„æ•°æ®ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ <code>http.get</code> æ–¹æ³•æ¥è·å–å¹¶è§£æ JSON æ•°æ®çš„ä¾‹å­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> url</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://example.com/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾è¿™ä¸ª URL è¿”å› JSON æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> statusCode</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> !==</span><span style="color:#B48EAD;"> 200</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Request Failed.</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">Status Code: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      return;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> rawData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      rawData</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        const</span><span style="color:#D8DEE9;"> parsedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">rawData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">parsedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Got error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾ä» &quot;<a href="http://example.com/data" target="_blank" rel="noopener noreferrer">http://example.com/data</a>&quot; è·å– JSON æ•°æ®ã€‚æˆ‘ä»¬æ£€æŸ¥çŠ¶æ€ç ä»¥ç¡®ä¿è¯·æ±‚æˆåŠŸï¼Œç„¶åæŒ‰ç…§å­—ç¬¦ç¼–ç  utf8 è·å–æ•°æ®ï¼ˆè¿™å¯¹äº JSON æ•°æ®æ˜¯å¿…è¦çš„ï¼‰ã€‚æ¥æ”¶åˆ°å…¨éƒ¨æ•°æ®åï¼Œæˆ‘ä»¬å°è¯•å°†å…¶è§£æä¸º JavaScript å¯¹è±¡ï¼Œå¦‚æœæˆåŠŸï¼Œå°±èƒ½å¤„ç†è¿™äº›æ•°æ®äº†ã€‚</p><p>è¿™ä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Node.js çš„ <code>http.get</code> æ–¹æ³•è¿›è¡ŒåŸºæœ¬çš„ HTTP GET è¯·æ±‚ã€‚è¿™åœ¨åˆ›å»ºç½‘ç«™åç«¯ã€API å®¢æˆ·ç«¯æˆ–ç®€å•çš„æ•°æ®æŠ“å–è„šæœ¬æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h2 id="http-globalagent" tabindex="-1"><a class="header-anchor" href="#http-globalagent"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpglobalagent" target="_blank" rel="noopener noreferrer">http.globalAgent</a></span></a></h2><p><code>http.globalAgent</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒæ˜¯ <code>http.Agent</code> çš„ä¸€ä¸ªå®ä¾‹ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http.Agent</code> è´Ÿè´£ç®¡ç† HTTP å®¢æˆ·ç«¯çš„è¿æ¥æŒä¹…æ€§å’Œé‡ç”¨ã€‚æ¢è¨€ä¹‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°ç®¡ç†å¤šä¸ªå‘åŒä¸€æœåŠ¡å™¨è¿›è¡Œçš„è¿æ¥ã€‚</p><p>å½“ä½ ä½¿ç”¨ Node.js çš„ <code>http</code> æ¨¡å—å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡è¿™ä¸ªå…¨å±€çš„ <code>http.globalAgent</code> æ¥å¤„ç†ã€‚è¿™ä¸ª agent ä¼šä¸ºç›¸åŒçš„æœåŠ¡å™¨å’Œç«¯å£ç»´æŠ¤ä¸€ä¸ªè¿æ¥æ± ã€‚è¿™æ„å‘³ç€å¦‚æœä½ è¿ç»­åšäº†å¤šä¸ªè¯·æ±‚åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œ<code>http.globalAgent</code> å¯ä»¥é‡ç”¨å·²ç»å»ºç«‹çš„è¿æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹è¿æ¥ã€‚è¿™æ ·åšå¯ä»¥æé«˜æ•ˆç‡å¹¶å‡å°‘å»¶è¿Ÿã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-23" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-23"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p><strong>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ <code>http.globalAgent</code>:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘å‡ºä¸€ä¸ª GET è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®š agentï¼Œæ‰€ä»¥ <code>http.get</code> æ–¹æ³•ä½¿ç”¨äº†é»˜è®¤çš„ <code>http.globalAgent</code>ã€‚</p><p><strong>è‡ªå®šä¹‰ agent çš„ä½¿ç”¨:</strong></p><p>å¦‚æœä½ æƒ³è‡ªå®šä¹‰è¿æ¥è¡Œä¸ºï¼Œæ¯”å¦‚æ›´æ”¹æœ€å¤§å¥—æ¥å­—æ•°é‡æˆ–è€…è¯·æ±‚è¶…æ—¶æ—¶é—´ç­‰ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„ <code>http.Agent</code> å®ä¾‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºè‡ªå®šä¹‰çš„ agent</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> customAgent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Agent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  keepAlive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  maxSockets</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 50</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘å‡ºä¸€ä¸ª GET è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„ agent</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    agent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> customAgent</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨è‡ªå®šä¹‰çš„ agent</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†å“åº”...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>http.Agent</code> å®ä¾‹ï¼Œå¹¶è®¾ç½®äº† <code>keepAlive</code> ä¸º <code>true</code>ï¼ˆä¿æŒè¿æ¥æ´»è·ƒï¼‰ï¼Œå’Œ <code>maxSockets</code> ä¸º <code>50</code>ï¼ˆæœ€å¤§å¥—æ¥å­—æ•°é‡ï¼‰ã€‚ç„¶åæˆ‘ä»¬åœ¨å‘èµ· <code>http.request</code> çš„æ—¶å€™æŒ‡å®šäº† <code>agent</code> é€‰é¡¹æ¥ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„ agentã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>http.globalAgent</code> åœ¨ Node.js ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œå®ƒè´Ÿè´£è¿æ¥çš„é‡ç”¨å’Œç®¡ç†ï¼Œæ˜¯ HTTP è¯·æ±‚ä¼˜åŒ–çš„å…³é”®å·¥å…·ã€‚é€šè¿‡è‡ªå®šä¹‰ <code>http.Agent</code> å®ä¾‹ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å…¶è¡Œä¸ºï¼Œä¼˜åŒ–åº”ç”¨ç¨‹åºçš„ç½‘ç»œæ€§èƒ½ã€‚</p><h2 id="http-maxheadersize" tabindex="-1"><a class="header-anchor" href="#http-maxheadersize"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpmaxheadersize" target="_blank" rel="noopener noreferrer">http.maxHeaderSize</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js ç”±äºå…¶éé˜»å¡ I/O å’Œäº‹ä»¶é©±åŠ¨ç‰¹æ€§ï¼Œéå¸¸é€‚åˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºæ„å»ºå„ç§ç½‘ç»œåº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ã€‚å½“æˆ‘ä»¬è°ˆè®ºåˆ° <code>http.maxHeaderSize</code> å±æ€§ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯åœ¨è®¨è®º Node.js ä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œè¯¥é€‰é¡¹å…è®¸ä½ è®¾ç½® HTTP å¤´éƒ¨çš„æœ€å¤§å¤§å°ã€‚</p><h3 id="ç†è§£-http-maxheadersize" tabindex="-1"><a class="header-anchor" href="#ç†è§£-http-maxheadersize"><span>ç†è§£ <code>http.maxHeaderSize</code></span></a></h3><p>HTTP å¤´éƒ¨ï¼ˆHeadersï¼‰æ˜¯ HTTP è¯·æ±‚å’Œå“åº”ä¸­çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œå®ƒä»¬åŒ…å«äº†è¯¸å¦‚èº«ä»½éªŒè¯ä¿¡æ¯ã€Cookiesã€å†…å®¹ç±»å‹ç­‰å…³é”®ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js é™åˆ¶äº† HTTP å¤´éƒ¨çš„æœ€å¤§å°ºå¯¸ï¼Œä»¥å¸®åŠ©é˜²æ­¢æ¶æ„çš„å¤§é‡æ•°æ®æ”»å‡»ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ DoS æ”»å‡»ï¼ˆæ‹’ç»æœåŠ¡æ”»å‡»ï¼‰ã€‚</p><p><code>http.maxHeaderSize</code> çš„å€¼è¡¨ç¤º HTTP å¤´éƒ¨çš„æœ€å¤§é•¿åº¦ï¼ˆå•ä½æ˜¯å­—èŠ‚ï¼‰ã€‚ä» Node.js v14.0.0 å¼€å§‹ï¼Œé»˜è®¤å€¼æ˜¯ 16KBï¼ˆå³ 16384 å­—èŠ‚ï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ¥æ”¶æ›´å¤§çš„å¤´éƒ¨ä¿¡æ¯ï¼Œæˆ–è€…å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½ å¯èƒ½å¸Œæœ›å‡å°‘å¤´éƒ¨çš„æœ€å¤§å…è®¸å¤§å°ã€‚é€šè¿‡è°ƒæ•´ <code>http.maxHeaderSize</code> çš„å€¼ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´è¿™ä¸ªé™åˆ¶ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-9"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="å¢åŠ -http-å¤´éƒ¨å¤§å°é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#å¢åŠ -http-å¤´éƒ¨å¤§å°é™åˆ¶"><span>å¢åŠ  HTTP å¤´éƒ¨å¤§å°é™åˆ¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ç”¨æˆ·è¿›è¡Œå¤§é‡èº«ä»½éªŒè¯ä¿¡æ¯äº¤æ¢çš„ Web åº”ç”¨ç¨‹åºã€‚ç”±äºèº«ä»½éªŒè¯ä¿¡æ¯ï¼ˆå¦‚ä»¤ç‰Œï¼‰å¯èƒ½ä¼šå¾ˆå¤§ï¼Œå› æ­¤é»˜è®¤çš„ HTTP å¤´éƒ¨å¤§å°é™åˆ¶å¯èƒ½ä¸å¤Ÿç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å¢åŠ å¤´éƒ¨å¤§å°é™åˆ¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨æ—¶å¢åŠ  maxHeaderSize é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> maxHeaderSize</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 81920</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶å°† <code>maxHeaderSize</code> è®¾ç½®ä¸º 80KBï¼ˆå³ 81920 å­—èŠ‚ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥æ¥å—æ›´å¤§çš„å¤´éƒ¨ä¿¡æ¯äº†ã€‚</p><h4 id="å‡å°-http-å¤´éƒ¨å¤§å°é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#å‡å°-http-å¤´éƒ¨å¤§å°é™åˆ¶"><span>å‡å° HTTP å¤´éƒ¨å¤§å°é™åˆ¶</span></a></h4><p>å¦‚æœä½ æƒ³æé«˜ä½ çš„åº”ç”¨å®‰å…¨æ€§ï¼Œå‡å°‘è¢«æ¶æ„å¤§å¤´éƒ¨æ”»å‡»çš„é£é™©ï¼Œä½ å¯ä»¥é€‰æ‹©å‡å°å¤´éƒ¨å¤§å°é™åˆ¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨æ—¶å‡å°‘ maxHeaderSize é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> maxHeaderSize</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 4096</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å°† HTTP å¤´éƒ¨çš„æœ€å¤§å¤§å°é™åˆ¶å‡å°åˆ°äº† 4KBï¼ˆ4096 å­—èŠ‚ï¼‰ï¼Œè¿™æœ‰åŠ©äºä¿æŠ¤æœåŠ¡å™¨ä¸è¢«å¤§é‡çš„ã€æ¶æ„æ„é€ çš„è¯·æ±‚å¤´æ‰€æ·¹æ²¡ã€‚</p><h3 id="ç»“è¯­-1" tabindex="-1"><a class="header-anchor" href="#ç»“è¯­-1"><span>ç»“è¯­</span></a></h3><p>é€šè¿‡åˆç†åœ°è°ƒæ•´ <code>http.maxHeaderSize</code> çš„å€¼ï¼Œä½ å¯ä»¥æ ¹æ®åº”ç”¨çš„éœ€æ±‚å’Œå®‰å…¨è€ƒè™‘æ¥ä¼˜åŒ–ä½ çš„ Node.js åº”ç”¨ã€‚æ— è®ºæ˜¯æå‡ç”¨æˆ·ä½“éªŒè¿˜æ˜¯å¢å¼ºåº”ç”¨çš„å®‰å…¨æ€§ï¼Œäº†è§£å’Œåˆ©ç”¨å¥½è¿™ä¸ªé…ç½®é€‰é¡¹éƒ½æ˜¯éå¸¸æœ‰ç›Šçš„ã€‚</p><h2 id="http-request-options-callback" tabindex="-1"><a class="header-anchor" href="#http-request-options-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#httprequestoptions-callback" target="_blank" rel="noopener noreferrer">http.request(options[, callback])</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªå¯ä»¥è®©ä½ ä½¿ç”¨ JavaScript è¯­è¨€æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ç¨‹åºçš„å¹³å°ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¨¡å—å«åš <code>http</code>ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºæœåŠ¡å™¨ï¼ˆServerï¼‰å’Œå‘èµ·ç½‘ç»œè¯·æ±‚ï¼ˆClientï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦èšç„¦äºå¦‚ä½•ä½¿ç”¨ <code>http</code> æ¨¡å—å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯ <code>http.request</code> æ–¹æ³•çš„ä½¿ç”¨ã€‚</p><p><code>http.request(options[, callback])</code> æ˜¯ Node.js ä¸­ç”¨æ¥å‘èµ· HTTP è¯·æ±‚çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸çµæ´»ï¼Œå…è®¸ä½ å®šåˆ¶å‡ ä¹æ‰€æœ‰è¯·æ±‚çš„å‚æ•°ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç›®æ ‡åœ°å€ã€ç«¯å£ã€è·¯å¾„ã€è¯·æ±‚å¤´ç­‰ã€‚å½“è¯·æ±‚å®Œæˆæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†å“åº”ã€‚</p><h3 id="å‚æ•°è§£é‡Š-4" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-4"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>options</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šè¯·æ±‚çš„ç›®æ ‡å’Œå…¶ä»–è®¾ç½®ã€‚å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¢«è§†ä¸ºè¯·æ±‚çš„ URLã€‚å¦‚æœæ˜¯å¯¹è±¡ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ªè®¾ç½®é¡¹ï¼Œæ¯”å¦‚: <ul><li><code>hostname</code> æˆ– <code>host</code>ï¼šè¯·æ±‚çš„ç›®æ ‡åœ°å€ã€‚</li><li><code>port</code>ï¼šç›®æ ‡ç«¯å£ã€‚</li><li><code>path</code>ï¼šè¯·æ±‚çš„è·¯å¾„ã€‚</li><li><code>method</code>ï¼šHTTP è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚ GETã€POST ç­‰ï¼‰ã€‚</li><li><code>headers</code>ï¼šè‡ªå®šä¹‰è¯·æ±‚å¤´éƒ¨ã€‚</li></ul></li><li><code>callback</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¯·æ±‚æ”¶åˆ°å“åº”æ—¶è¢«è°ƒç”¨ã€‚è¯¥å›è°ƒå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³å“åº”å¯¹è±¡(<code>response</code>)ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-17"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å‘èµ·ä¸€ä¸ª-get-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å‘èµ·ä¸€ä¸ª-get-è¯·æ±‚"><span>ç¤ºä¾‹ 1: å‘èµ·ä¸€ä¸ª GET è¯·æ±‚</span></a></h4><p>å‡è®¾æˆ‘ä»¬æƒ³ä» <code>https://jsonplaceholder.typicode.com/posts/1</code> è·å–ä¸€ç¯‡åšå®¢æ–‡ç« ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªGETè¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">jsonplaceholder.typicode.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // HTTP é»˜è®¤ç«¯å£æ˜¯ 80, HTTPS æ˜¯ 443</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/posts/1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰å›è°ƒå‡½æ•°å¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> callback</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ¥æ”¶æ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¦‚æœé‡åˆ°ç½‘ç»œé”™è¯¯</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">é—®é¢˜ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚ï¼Œå®é™…å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å‘èµ·ä¸€ä¸ª-post-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å‘èµ·ä¸€ä¸ª-post-è¯·æ±‚"><span>ç¤ºä¾‹ 2: å‘èµ·ä¸€ä¸ª POST è¯·æ±‚</span></a></h4><p>å‡è®¾æˆ‘ä»¬éœ€è¦å‘ <code>http://example.com/api/users</code> æäº¤æ–°ç”¨æˆ·ä¿¡æ¯ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”¨æˆ·æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> userData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">John Doe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  job</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content Writer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªPOSTè¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/api/users</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">byteLength</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">userData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å›è°ƒå¤„ç†å“åº”</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> callback</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    result</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">é—®é¢˜ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å†™å…¥æ•°æ®åˆ°è¯·æ±‚ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">userData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>http.request</code> æ–¹æ³•å‘èµ· GET å’Œ POST è¯·æ±‚ã€‚é€šè¿‡å®šåˆ¶ <code>options</code> å¯¹è±¡ï¼Œä½ å¯ä»¥åˆ›å»ºå‡ºç¬¦åˆä½ éœ€æ±‚çš„ HTTP è¯·æ±‚ï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­å¤„ç†æœåŠ¡å™¨çš„å“åº”ã€‚</p><h2 id="http-request-url-options-callback" tabindex="-1"><a class="header-anchor" href="#http-request-url-options-callback"><span><a href="https://nodejs.org/docs/latest/api/http.html#httprequesturl-options-callback" target="_blank" rel="noopener noreferrer">http.request(url[, options][, callback])</a></span></a></h2><p>å½“ä½ ä½¿ç”¨ Node.js æ¥å¼€å‘ Web åº”ç”¨æ—¶ï¼Œç»å¸¸éœ€è¦è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚è·å–å¦ä¸€ä¸ªç½‘ç«™çš„æ•°æ®æˆ–è°ƒç”¨è¿œç¨‹ APIã€‚è¿™æ—¶å€™ï¼Œ<code>http.request</code>æ–¹æ³•å°±éå¸¸æœ‰ç”¨äº†ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯http-request" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯http-request"><span>ä»€ä¹ˆæ˜¯<code>http.request</code>?</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>http.request</code>æ˜¯ä¸€ä¸ªç”¨æ¥å‘èµ· HTTP è¯·æ±‚çš„å‡½æ•°ã€‚å®ƒå…è®¸ä½ å‘æŒ‡å®šçš„ URL å‘é€è¯·æ±‚å¹¶å¤„ç†å“åº”ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸çµæ´»ï¼Œæ”¯æŒ GETã€POST ç­‰å¤šç§ HTTP æ–¹æ³•ï¼Œå¹¶å…è®¸ä½ è®¾ç½®è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰ã€‚</p><h3 id="å‚æ•°-6" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-6"><span>å‚æ•°</span></a></h3><ul><li><code>url</code>ï¼šä½ æƒ³è¦è¯·æ±‚çš„ URLã€‚</li><li><code>options</code>ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†è¯¸å¦‚è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ã€å¤´éƒ¨(headers)ã€è¶…æ—¶æ—¶é—´ç­‰é…ç½®é¡¹ã€‚</li><li><code>callback</code>ï¼šå½“æ”¶åˆ°å“åº”æ—¶çš„å›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå³ä¸€ä¸ªå“åº”å¯¹è±¡ã€‚</li></ul><h3 id="ä½¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¾‹å­-1"><span>ä½¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹-1-get-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹-1-get-è¯·æ±‚"><span>ä¾‹ 1ï¼šGET è¯·æ±‚</span></a></h4><p>å‡è®¾ä½ æƒ³è¦è·å– jsonplaceholder æä¾›çš„ä¸€ä¸ªå…è´¹ API æ¥å£çš„æµ‹è¯•æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰è¯·æ±‚çš„é€‰é¡¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">jsonplaceholder.typicode.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/posts/1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è¯·æ±‚ç»“æŸ</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”ä¸­å·²æ— æ•°æ®ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬é”™è¯¯äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»“æŸè¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é€šè¿‡<code>http.request</code>å‘èµ·äº†ä¸€ä¸ª GET è¯·æ±‚æ¥è·å– jsonplaceholder ä¸Šçš„ä¸€ç¯‡æ–‡ç« çš„æ•°æ®ã€‚</p><h4 id="ä¾‹-2-post-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹-2-post-è¯·æ±‚"><span>ä¾‹ 2ï¼šPOST è¯·æ±‚</span></a></h4><p>å¦‚æœä½ æƒ³é€šè¿‡ POST æ–¹æ³•å‘é€ä¸€äº›æ•°æ®ç»™æœåŠ¡å™¨ï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> postData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  title</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">foo</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  body</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">bar</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  userId</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">jsonplaceholder.typicode.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/posts</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">POST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Content-Length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">byteLength</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">postData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">çŠ¶æ€ç : </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“åº”ä¸­å·²æ— æ•°æ®ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å°†æ•°æ®å†™å…¥è¯·æ±‚ä½“</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">postData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>http.request</code>æ–¹æ³•å‘é€ä¸€ä¸ªåŒ…å« JSON æ•°æ®çš„ POST è¯·æ±‚ã€‚</p><h3 id="æ€»ç»“-23" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-23"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>http.request</code>æ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å®ƒæ˜¯ Node.js æä¾›çš„åº•å±‚ HTTP æ“ä½œæ¥å£ï¼Œéå¸¸å¼ºå¤§ä½†ä¹Ÿç•¥æ˜¾å¤æ‚ã€‚ä¸ºäº†ç®€åŒ– HTTP è¯·æ±‚ï¼Œå¾ˆå¤šäººä¹Ÿä¼šé€‰æ‹©ä½¿ç”¨åƒ<code>axios</code>è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“ã€‚ç„¶è€Œï¼ŒæŒæ¡<code>http.request</code>çš„ä½¿ç”¨è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› ä¸ºå®ƒè®©ä½ å¯¹ Node.js çš„ HTTP æ“ä½œæœ‰æ›´æ·±å…¥çš„ç†è§£ã€‚</p><h2 id="http-validateheadername-name-label" tabindex="-1"><a class="header-anchor" href="#http-validateheadername-name-label"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpvalidateheadernamename-label" target="_blank" rel="noopener noreferrer">http.validateHeaderName(name[, label])</a></span></a></h2><p><code>http.validateHeaderName(name[, label])</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ ¡éªŒç»™å®šçš„ HTTP å¤´éƒ¨åç§°ï¼ˆheader nameï¼‰æ˜¯å¦æœ‰æ•ˆã€‚è¿™ä¸ªåŠŸèƒ½åœ¨ä½ éœ€è¦ç¡®ä¿ HTTP å¤´éƒ¨çš„å‘½åç¬¦åˆè§„èŒƒæ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>é¦–å…ˆæ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ HTTP å¤´éƒ¨ï¼š<br> HTTP åè®®ä¸­çš„å¤´éƒ¨ï¼ˆHeadersï¼‰æ˜¯è¯·æ±‚ï¼ˆrequestï¼‰å’Œå“åº”ï¼ˆresponseï¼‰çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å®ƒä»¬åŒ…å«äº†å…³äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„å…ƒä¿¡æ¯ï¼Œå¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ã€ç¼“å­˜æ§åˆ¶ç­‰ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šåŒ…å«ä¸€ä¸ª <code>Content-Type</code> å¤´éƒ¨æ¥å‘Šè¯‰æœåŠ¡å™¨æ­£æ–‡çš„æ•°æ®ç±»å‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Content-Type: application/json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸ºä»€ä¹ˆéœ€è¦æ ¡éªŒå¤´éƒ¨åç§°ï¼Ÿ<br> å› ä¸º HTTP å¤´éƒ¨åç§°å¿…é¡»éµå¾ªç‰¹å®šçš„è§„åˆ™å’Œæ ‡å‡†ã€‚å¦‚æœä¸å°å¿ƒä½¿ç”¨äº†æ— æ•ˆæˆ–ä¸åˆæ³•çš„å¤´éƒ¨åç§°ï¼Œå¯èƒ½ä¼šå¯¼è‡´ HTTP æ¶ˆæ¯æ ¼å¼é”™è¯¯ï¼Œè¿›è€Œå¼•èµ·é€šä¿¡é—®é¢˜ã€‚</p><p>Node.js ä¸­ <code>http.validateHeaderName()</code> æ–¹æ³•å°±æ˜¯ç”¨æ¥æ£€æŸ¥è¿™ä¸ªå¤´éƒ¨åç§°æ˜¯å¦åˆæ³•çš„å·¥å…·ã€‚å¦‚æœå¤´éƒ¨åç§°åˆæ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä»€ä¹ˆéƒ½ä¸åšï¼›å¦‚æœä¸åˆæ³•ï¼Œå®ƒä¼šæŠ›å‡ºä¸€ä¸ª <code>TypeError</code>ã€‚</p><p>å‚æ•°è¯¦è§£ï¼š</p><ul><li><code>name</code>ï¼šè¿™æ˜¯ä½ æƒ³è¦éªŒè¯çš„ HTTP å¤´éƒ¨åç§°çš„å­—ç¬¦ä¸²ã€‚</li><li><code>label</code> (å¯é€‰)ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»£è¡¨ç€é”™è¯¯æ¶ˆæ¯ä¸­çš„å‰ç¼€ï¼Œå½“éªŒè¯å¤±è´¥æ—¶ï¼Œå®ƒä¼šå¸®åŠ©ä½ æ›´å¿«åœ°å®šä½é—®é¢˜æ‰€åœ¨ã€‚</li></ul><p>è¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³è¦æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰ HTTP å¤´éƒ¨åˆ°æˆ‘ä»¬çš„å“åº”ä¸­ã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦éªŒè¯è¿™ä¸ªå¤´éƒ¨åç§°æ˜¯å¦æœ‰æ•ˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­£ç¡®çš„å¤´éƒ¨åç§°</span></span>
<span class="line"><span style="color:#D8DEE9;">  http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">validateHeaderName</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨è¿™ä¸ªå¤´éƒ¨è¿›è¡Œåç»­æ“ä½œï¼Œæ¯”å¦‚è®¾ç½®å¤´éƒ¨å€¼ç­‰</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Header name is valid</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // å¦‚æœå¤´éƒ¨åç§°ä¸åˆæ³•ï¼Œåˆ™ä¼šæ•è·åˆ°é”™è¯¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Invalid header name: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // é”™è¯¯çš„å¤´éƒ¨åç§°ï¼ŒåŒ…å«æ— æ•ˆå­—ç¬¦</span></span>
<span class="line"><span style="color:#D8DEE9;">  http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">validateHeaderName</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Custom-Header?</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™å°†ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºå¤´éƒ¨åç§°åŒ…å«äº†ä¸å…è®¸çš„å­—ç¬¦ &#39;?&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Invalid header name: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç¬¬ä¸€ä¸ª <code>try</code> å—ä¸­ï¼Œæˆ‘ä»¬éªŒè¯äº†ä¸€ä¸ªåˆæ³•çš„å¤´éƒ¨åç§° &#39;X-Custom-Header&#39;ï¼Œæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œå¯ä»¥å®‰å…¨åœ°ä½¿ç”¨è¿™ä¸ªå¤´éƒ¨åç§°ã€‚</p><p>åœ¨ç¬¬äºŒä¸ª <code>try</code> å—ä¸­ï¼Œæˆ‘ä»¬å°è¯•éªŒè¯ä¸€ä¸ªåŒ…å«éæ³•å­—ç¬¦ &#39;?&#39; çš„å¤´éƒ¨åç§° &#39;X-Custom-Header?&#39;ã€‚è¿™æ˜¯ä¸ç¬¦åˆ HTTP æ ‡å‡†çš„ï¼Œæ‰€ä»¥ <code>http.validateHeaderName()</code> æ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ª <code>TypeError</code>ï¼Œæˆ‘ä»¬åœ¨ <code>catch</code> è¯­å¥ä¸­æ•è·åˆ°è¿™ä¸ªé”™è¯¯å¹¶æ‰“å°å‡ºæ¥ã€‚</p><p>è®°ä½ï¼Œè™½ç„¶è¿™ä¸ªæ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬éªŒè¯å¤´éƒ¨åç§°çš„æœ‰æ•ˆæ€§ï¼Œä½†å®ƒä¸ä¼šæ£€æŸ¥å¤´éƒ¨çš„å€¼æ˜¯å¦æœ‰æ•ˆã€‚å¯¹äºå¤´éƒ¨çš„å€¼ï¼Œä½ å¯èƒ½éœ€è¦å…¶ä»–æ–¹æ³•æ¥éªŒè¯ã€‚</p><h2 id="http-validateheadervalue-name-value" tabindex="-1"><a class="header-anchor" href="#http-validateheadervalue-name-value"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpvalidateheadervaluename-value" target="_blank" rel="noopener noreferrer">http.validateHeaderValue(name, value)</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªå¼€æºä¸è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå¯ä»¥è®©ä½ ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚<code>http.validateHeaderValue(name, value)</code> æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥éªŒè¯ HTTP å¤´éƒ¨å€¼çš„åˆæ³•æ€§ã€‚åœ¨æˆ‘ä»¬æ·±å…¥äº†è§£è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ã€‚</p><p>HTTPï¼ˆHyperText Transfer Protocolï¼‰å³è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯ç”¨äºä»ç½‘ç«™æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚HTTP æŠ¥æ–‡åŒ…å«å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šè¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ã€‚æ¯ç§ç±»å‹çš„æŠ¥æ–‡éƒ½åŒ…å«èµ·å§‹è¡Œã€å¤´éƒ¨å­—æ®µï¼ˆheadersï¼‰ä»¥åŠæ¶ˆæ¯ä¸»ä½“ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-http-å¤´éƒ¨-headers" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-http-å¤´éƒ¨-headers"><span>ä»€ä¹ˆæ˜¯ HTTP å¤´éƒ¨ï¼ˆHeadersï¼‰ï¼Ÿ</span></a></h3><p>HTTP å¤´éƒ¨å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ä¼ é€’é™„åŠ ä¿¡æ¯ã€‚å¤´éƒ¨å¯ä»¥åŒ…å«è®¤è¯ä¿¡æ¯ã€æŒ‡å®šç‰¹å®šç±»å‹çš„å“åº”ã€æ§åˆ¶ç¼“å­˜ç­‰ä¿¡æ¯ã€‚</p><h3 id="ä½¿ç”¨-http-validateheadervalue-name-value-çš„ç›®çš„" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-http-validateheadervalue-name-value-çš„ç›®çš„"><span>ä½¿ç”¨ <code>http.validateHeaderValue(name, value)</code> çš„ç›®çš„</span></a></h3><p>å½“ä½ åˆ›å»º HTTP è¯·æ±‚æˆ–å“åº”æ—¶ï¼Œä½ å¯èƒ½éœ€è¦æ·»åŠ è‡ªå®šä¹‰å¤´éƒ¨æ¥ä¼ é€’æŸäº›ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—ç¬¦éƒ½èƒ½è¢«ç”¨åœ¨ HTTP å¤´éƒ¨çš„å€¼ä¸­ã€‚æœ‰äº›å­—ç¬¦æ˜¯éæ³•çš„ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ç ´å HTTP åè®®çš„ç»“æ„ï¼Œæ¯”å¦‚æ¢è¡Œç¬¦å¯ä»¥è¢«ç”¨æ¥æ³¨å…¥æœªç»æˆæƒçš„å¤´éƒ¨æˆ–è€…åˆ†å‰²å“åº”ï¼Œè¿™å¯ä»¥è¢«æ¶æ„åˆ©ç”¨ã€‚</p><p><code>http.validateHeaderValue(name, value)</code> æ–¹æ³•å°±æ˜¯ç”¨æ¥éªŒè¯ç»™å®šçš„å¤´éƒ¨åç§°(<code>name</code>)å’Œå€¼(<code>value</code>)æ˜¯å¦ç¬¦åˆ HTTP æ ‡å‡†ã€‚å¦‚æœå¤´éƒ¨å€¼ä¸åˆæ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-18"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦å‘ç”¨æˆ·æä¾›ä¸€ä¸ªä¸‹è½½æ–‡ä»¶çš„åŠŸèƒ½ï¼Œå¹¶é€šè¿‡ HTTP å¤´éƒ¨è‡ªå®šä¹‰æ–‡ä»¶åã€‚</p><ol><li><strong>è®¾ç½®<code>Content-Disposition</code>å¤´éƒ¨æ¥å®šä¹‰ä¸‹è½½çš„æ–‡ä»¶å</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å‡å®šç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> fileName</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">report.pdf</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // éªŒè¯å¤´éƒ¨å€¼çš„åˆæ³•æ€§</span></span>
<span class="line"><span style="color:#D8DEE9;">      http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">validateHeaderValue</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">Content-Disposition</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">        `</span><span style="color:#A3BE8C;">attachment; filename=&quot;</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">fileName</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">&quot;</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // å¦‚æœä¸Šé¢çš„éªŒè¯é€šè¿‡ï¼Œåˆ™è®¾ç½®å¤´éƒ¨</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">Content-Disposition</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">        `</span><span style="color:#A3BE8C;">attachment; filename=&quot;</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">fileName</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">&quot;</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // å“åº”ä½“ä¸­å°†åŒ…å«æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File content would go here</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // å¦‚æœéªŒè¯å¤±è´¥ï¼Œåˆ™è¿”å›é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Invalid header value:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">400</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Invalid header value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>http.validateHeaderValue</code> æ¥ç¡®ä¿ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åä¸ä¼šå¯¼è‡´ç”Ÿæˆéæ³•çš„ HTTP å¤´éƒ¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å®‰å…¨æªæ–½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥æ—¶ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©é˜²æ­¢ä¸€äº›åŸºäºå¤´éƒ¨æ³¨å…¥çš„æ”»å‡»ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>http.validateHeaderValue(name, value)</code> æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥å¢å¼ºä½ çš„ Node.js åº”ç”¨çš„å®‰å…¨æ€§ï¼Œé€šè¿‡ç¡®ä¿æ·»åŠ åˆ° HTTP å“åº”ä¸­çš„å¤´éƒ¨å€¼æ˜¯åˆæ³•çš„ï¼Œä»è€Œé¿å…æ½œåœ¨çš„ HTTP åè®®å±‚é¢çš„é—®é¢˜ã€‚</p><h2 id="http-setmaxidlehttpparsers-max" tabindex="-1"><a class="header-anchor" href="#http-setmaxidlehttpparsers-max"><span><a href="https://nodejs.org/docs/latest/api/http.html#httpsetmaxidlehttpparsersmax" target="_blank" rel="noopener noreferrer">http.setMaxIdleHTTPParsers(max)</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“å»ºç«‹çš„å¹³å°ï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ç”¨ JavaScript ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­æœ‰å¾ˆå¤šå†…ç½®çš„æ¨¡å—ï¼Œå…¶ä¸­ <code>http</code> æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ã€‚</p><p>åœ¨ <code>http</code> æ¨¡å—ä¸­ï¼Œ<code>http.setMaxIdleHTTPParsers(max)</code> æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒå°‘ä½¿ç”¨ä¸”ä¸“é—¨åŒ–çš„å‡½æ•°ï¼Œå®ƒç”¨äºæ§åˆ¶æœ€å¤§ç©ºé—² HTTP è§£æå™¨çš„æ•°é‡ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯ä¸ºäº†æé«˜æ€§èƒ½å’Œç®¡ç†èµ„æºè€Œè®¾è®¡çš„ã€‚</p><p>æ¯å½“ HTTP è¯·æ±‚åˆ°è¾¾ Node.js æœåŠ¡å™¨æ—¶ï¼Œéœ€è¦ä¸€ä¸ªè§£æå™¨æ¥å¤„ç†è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€å’Œæ­£æ–‡ç­‰éƒ¨åˆ†ã€‚è§£æå®Œæ¯•åï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæœåŠ¡å™¨é¢„æœŸè¿˜ä¼šæ”¶åˆ°æ›´å¤šçš„è¯·æ±‚ï¼Œè¿™ä¸ªè§£æå™¨å°±ä¼šè¢«ä¿æŒä¸ºç©ºé—²çŠ¶æ€ä»¥ä¾¿é‡ç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥é”€æ¯ã€‚é‡ç”¨è§£æå™¨å¯ä»¥å‡å°‘åˆ›å»ºæ–°è§£æå™¨æ‰€éœ€çš„å¼€é”€ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚</p><p>ä½†æ˜¯ï¼Œä¿æŒè¿‡å¤šçš„ç©ºé—²è§£æå™¨å¯èƒ½ä¼šæµªè´¹å†…å­˜èµ„æºï¼Œç‰¹åˆ«æ˜¯åœ¨å¹¶å‘è¿æ¥è¾ƒä½çš„æ—¶å€™ã€‚å› æ­¤ï¼Œ<code>http.setMaxIdleHTTPParsers(max)</code> å‡½æ•°å…è®¸ä½ è®¾å®šä¸€ä¸ªä¸Šé™ï¼Œæ¥é™åˆ¶å¯ä»¥ä¿æŒä¸ºç©ºé—²çŠ¶æ€çš„è§£æå™¨æ•°é‡ã€‚ä¸€æ—¦è¾¾åˆ°è¿™ä¸ªä¸Šé™ï¼Œé¢å¤–çš„è§£æå™¨å°†è¢«é”€æ¯ï¼Œè€Œä¸æ˜¯è½¬å…¥ç©ºé—²çŠ¶æ€ã€‚</p><h3 id="å‚æ•°-7" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-7"><span>å‚æ•°ï¼š</span></a></h3><ul><li><code>max</code>: è¿™æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œç”¨äºè®¾ç½®æœ€å¤§ç©ºé—² HTTP è§£æå™¨çš„æ•°é‡ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™æ„å‘³ç€æ‰€æœ‰å®Œæˆå·¥ä½œçš„è§£æå™¨éƒ½å°†ç«‹å³è¢«é”€æ¯ã€‚</li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹-2"><span>ä½¿ç”¨ç¤ºä¾‹ï¼š</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¸Œæœ›é™åˆ¶æœ€å¤§ç©ºé—² HTTP è§£æå™¨æ•°é‡ä¸º 10ï¼Œä»¥ä¾¿èŠ‚çœèµ„æºã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®æœ€å¤§ç©ºé—²è§£æå™¨æ•°é‡ä¸º10</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxIdleHTTPParsers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨ <code>http.setMaxIdleHTTPParsers(10)</code> é™åˆ¶äº†æœ€å¤§ç©ºé—²è§£æå™¨æ•°é‡ã€‚è¿™æ„å‘³ç€åœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œæœ€å¤šåªä¼šæœ‰ 10 ä¸ªè§£æå™¨ä¿æŒä¸ºç©ºé—²çŠ¶æ€å‡†å¤‡å¤„ç†æ–°çš„è¯·æ±‚ã€‚è¶…å‡ºè¿™ä¸ªæ•°é‡çš„è§£æå™¨å°†è¢«é”€æ¯ï¼Œé‡Šæ”¾èµ„æºã€‚</p><p>è¯·æ³¨æ„ï¼Œ<code>setMaxIdleHTTPParsers</code> æ˜¯ä¸€ä¸ªæ¯”è¾ƒåº•å±‚çš„ä¼˜åŒ–æ‰‹æ®µï¼Œå¤§å¤šæ•°æ™®é€šç”¨æˆ·å¯èƒ½æ°¸è¿œä¸éœ€è¦æ‰‹åŠ¨é…ç½®è¿™ä¸ªå€¼ã€‚é€šå¸¸åªæœ‰åœ¨è°ƒè¯•æ€§èƒ½é—®é¢˜æˆ–è¿›è¡Œé«˜åº¦ä¼˜åŒ–æ—¶æ‰ä¼šç”¨åˆ°ã€‚å¦‚æœä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œä½ å¯èƒ½ä¸éœ€è¦ç«‹å³æ·±å…¥ç†è§£è¿™ä¸ªåŠŸèƒ½ï¼Œä½†çŸ¥é“å®ƒçš„å­˜åœ¨å’Œç›®çš„æ˜¯æœ‰ç›Šçš„ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Global objects</div></a><a class="route-link auto-link next" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">HTTPS<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.8acf974b.js" defer></script><script src="/assets/js/4485.e6fe7c7b.js" defer></script><script src="/assets/js/app.fff57528.js" defer></script>
  </body>
</html>
