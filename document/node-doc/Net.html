<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Net.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Net"><meta property="og:description" content="Net Node.js åœ¨å…¶ v21.7.1 ç‰ˆæœ¬ä¸­çš„Netæ¨¡å—æ˜¯ç”¨äºå¤„ç†ç½‘ç»œæ“ä½œçš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€ä¸ªå¼‚æ­¥ç½‘ç»œ APIï¼Œç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC çš„æœåŠ¡å™¨(net.createServer())å’Œå®¢æˆ·ç«¯(net.createConnection())ã€‚ è¦ç†è§£Netæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¯”ä½œæ˜¯å»ºç«‹å’Œç®¡ç†ç½‘ç»œè¿æ¥çš„å·¥å…·ç®±ã€‚å®ƒå…è®¸ N..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Net","description":"Net Node.js åœ¨å…¶ v21.7.1 ç‰ˆæœ¬ä¸­çš„Netæ¨¡å—æ˜¯ç”¨äºå¤„ç†ç½‘ç»œæ“ä½œçš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€ä¸ªå¼‚æ­¥ç½‘ç»œ APIï¼Œç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC çš„æœåŠ¡å™¨(net.createServer())å’Œå®¢æˆ·ç«¯(net.createConnection())ã€‚ è¦ç†è§£Netæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¯”ä½œæ˜¯å»ºç«‹å’Œç®¡ç†ç½‘ç»œè¿æ¥çš„å·¥å…·ç®±ã€‚å®ƒå…è®¸ N..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Net | hanekawa-shiki</title><meta name="description" content="Net Node.js åœ¨å…¶ v21.7.1 ç‰ˆæœ¬ä¸­çš„Netæ¨¡å—æ˜¯ç”¨äºå¤„ç†ç½‘ç»œæ“ä½œçš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€ä¸ªå¼‚æ­¥ç½‘ç»œ APIï¼Œç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC çš„æœåŠ¡å™¨(net.createServer())å’Œå®¢æˆ·ç«¯(net.createConnection())ã€‚ è¦ç†è§£Netæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¯”ä½œæ˜¯å»ºç«‹å’Œç®¡ç†ç½‘ç»œè¿æ¥çš„å·¥å…·ç®±ã€‚å®ƒå…è®¸ N...">
    <link rel="stylesheet" href="/assets/css/styles.a84c0532.css">
    <link rel="preload" href="/assets/js/runtime~app.8acf974b.js" as="script"><link rel="preload" href="/assets/css/styles.a84c0532.css" as="style"><link rel="preload" href="/assets/js/4485.e6fe7c7b.js" as="script"><link rel="preload" href="/assets/js/app.fff57528.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-CommonJS%20modules.html" aria-label="Modules: CommonJS modules"><!---->Modules: CommonJS modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-ECMAScript%20modules.html" aria-label="Modules: ECMAScript modules"><!---->Modules: ECMAScript modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-node_module%20API.html" aria-label="Modules: node:module API"><!---->Modules: node:module API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><!---->Modules: Packages<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Net</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 203 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT203M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 60814 å­—</span><meta property="wordCount" content="60814"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨">1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åˆ›å»ºä¸€ä¸ª-tcp-å®¢æˆ·ç«¯">2. åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨åœºæ™¯">å®é™…è¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ipc-support">IPC support</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-ipc">å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ IPC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#identifying-paths-for-ipc-connections">Identifying paths for IPC connections</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“">å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-net-blocklist">Class: net.BlockList</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨net-blocklist">å¦‚ä½•ä½¿ç”¨net.BlockList</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-1">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#blocklist-addaddress-address-type">blockList.addAddress(address[, type])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³äº-blocklist-addaddress-address-type">å…³äº blockList.addAddress(address[, type])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#blocklist-addrange-start-end-type">blockList.addRange(start, end[, type])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£blocklist">ç†è§£blockList:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ–¹æ³•è§£é‡Š-blocklist-addrange-start-end-type">æ–¹æ³•è§£é‡Šï¼šblockList.addRange(start, end[, type])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#blocklist-addsubnet-net-prefix-type">blockList.addSubnet(net, prefix[, type])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#blocklist-check-address-type">blockList.check(address[, type])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŠŸèƒ½è§£é‡Š">åŠŸèƒ½è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-3">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#blocklist-rules">blockList.rules</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-blocklist-rules">ä»€ä¹ˆæ˜¯ blockList.rules?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¸¾ä¾‹">å®é™…è¿ç”¨ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-net-socketaddress">Class: net.SocketAddress</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€è§£é‡Š">åŸºç¡€è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-socketaddress-ç±»">net.SocketAddress ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-4">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-net-socketaddress-options">new net.SocketAddress([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-new-net-socketaddress-options">ä»€ä¹ˆæ˜¯ new net.SocketAddress([options])ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-2">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socketaddress-address">socketaddress.address</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨">å®é™…åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socketaddress-family">socketaddress.family</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯å¥—æ¥å­—-socket">ä»€ä¹ˆæ˜¯å¥—æ¥å­—(Socket)?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ°å€å®¶æ—-address-family">åœ°å€å®¶æ—(Address Family)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socketaddress-family-åœ¨-node-js-ä¸­çš„è§’è‰²">socketaddress.family åœ¨ Node.js ä¸­çš„è§’è‰²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-5">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socketaddress-flowlabel">socketaddress.flowlabel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socketaddress-flowlabel-1">socketaddress.flowlabel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socketaddress-port">socketaddress.port</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-6">å®é™…è¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-net-server">Class: net.Server</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-server-ç®€ä»‹">net.Server ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»º-net-server-å®ä¾‹">åˆ›å»º net.Server å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç›‘å¬ç«¯å£å’Œå¯åŠ¨æœåŠ¡å™¨">ç›‘å¬ç«¯å£å’Œå¯åŠ¨æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-net-server-options-connectionlistener">new net.Server([options][, connectionListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-ç½‘ç»œæœåŠ¡å™¨">å®ä¾‹ 1: ç½‘ç»œæœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-æ–‡ä»¶æµ">å®ä¾‹ 2: æ–‡ä»¶æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connection">Event: &#39;connection&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ">å¦‚ä½•å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-7">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-error">Event: &#39;error&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€ä»‹ç»">åŸºç¡€ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-listening">Event: &#39;listening&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•ç†è§£">ç®€å•ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-1">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-drop">Event: &#39;drop&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶é©±åŠ¨æ¨¡å‹">äº‹ä»¶é©±åŠ¨æ¨¡å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-ä½¿ç”¨äº‹ä»¶">ç¤ºä¾‹ï¼šä½¿ç”¨äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-3">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-address">server.address()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•è§£é‡Š">ç®€å•è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-3">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-close-callback">server.close([callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä½¿ç”¨ä¾‹å­">å®é™…ä½¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-4">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#serversymbol-asyncdispose-https-nodejs-org-docs-latest-api-net-html-serversymbolasyncdispose">[serverSymbol.asyncDispose](https://nodejs.org/docs/latest/api/net.html#serversymbolasyncdispose)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-symbol-asyncdispose">ä»€ä¹ˆæ˜¯ Symbol.asyncDispose</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-server-symbol-asyncdispose-é‡è¦">ä¸ºä»€ä¹ˆ server[Symbol.asyncDispose]() é‡è¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-getconnections-callback">server.getConnections(callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•è§£é‡Š-1">ç®€å•è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è¯¦è§£">å‚æ•°è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-listen">server.listen()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åŸºæœ¬ç”¨æ³•">1. åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä¾‹å­">2. ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-5">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£æ">å‚æ•°è§£æï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹è§£é‡Š">å®ä¾‹è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-6">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-1">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-7">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-2">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-listening">server.listening</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -1">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨-1">å®é™…åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-maxconnections">server.maxConnections</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¾‹è¯´æ˜">ä¸¾ä¾‹è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-ref">server.ref()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-äº‹ä»¶å¾ªç¯">Node.js äº‹ä»¶å¾ªç¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-server-å¯¹è±¡">Node.js ä¸­çš„ Server å¯¹è±¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-ref-æ–¹æ³•çš„ä½œç”¨">server.ref() æ–¹æ³•çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-8">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-unref">server.unref()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-net-socket">Class: net.Socket</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºä¸€ä¸ª-net-socket-å®ä¾‹">åˆ›å»ºä¸€ä¸ª net.Socket å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-4">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-net-socket-options">new net.Socket([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-net-socket-options-çš„é€‰é¡¹">new net.Socket([options])çš„é€‰é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close-1">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-event-close">ä»€ä¹ˆæ˜¯ Event: &#39;close&#39;ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ç›‘å¬-event-close">å¦‚ä½•ç›‘å¬ Event: &#39;close&#39;ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-1">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connect">Event: &#39;connect&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-connect-äº‹ä»¶">ç†è§£ connect äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-8">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connectionattempt">Event: &#39;connectionAttempt&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-connectionattempt-äº‹ä»¶">ä»€ä¹ˆæ˜¯ &#39;connectionAttempt&#39; äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-connectionattempt-äº‹ä»¶">å¦‚ä½•ä½¿ç”¨ &#39;connectionAttempt&#39; äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-2">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connectionattemptfailed">Event: &#39;connectionAttemptFailed&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-1">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨å®ä¾‹">å®é™…è¿ç”¨å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connectionattempttimeout">Event: &#39;connectionAttemptTimeout&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#netæ¨¡å—ç®€ä»‹">netæ¨¡å—ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#connectionattempttimeout-äº‹ä»¶åº”ç”¨åœºæ™¯">connectionAttemptTimeout äº‹ä»¶åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -2">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-data">Event: &#39;data&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-data-è¯¦è§£">Event: &#39;data&#39; è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­">ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-drain">Event: &#39;drain&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-å’Œç¼“å†²-buffer">æµï¼ˆStreamï¼‰å’Œç¼“å†²ï¼ˆBufferï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#drain-äº‹ä»¶">drain äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-end">Event: &#39;end&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-end-1">Event: &#39;end&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-5">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-error-1">Event: &#39;error&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯event-error">ä»€ä¹ˆæ˜¯Event: &#39;error&#39;?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-error-äº‹ä»¶å¾ˆé‡è¦">ä¸ºä»€ä¹ˆ&#39;error&#39;äº‹ä»¶å¾ˆé‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-9">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-lookup">Event: &#39;lookup&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯å’Œä¾‹å­">ä½¿ç”¨åœºæ™¯å’Œä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¿™ä¸ªäº‹ä»¶é‡è¦">ä¸ºä»€ä¹ˆè¿™ä¸ªäº‹ä»¶é‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-ready">Event: &#39;ready&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç½‘ç»œè¿æ¥">ä¾‹å­ 1: åˆ›å»ºä¸€ä¸ªç½‘ç»œè¿æ¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-æœåŠ¡ç«¯æ¥æ”¶è¿æ¥">ä¾‹å­ 2: æœåŠ¡ç«¯æ¥æ”¶è¿æ¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-timeout">Event: &#39;timeout&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-net-æ¨¡å—">Node.js ä¸­çš„ net æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-socket">ä»€ä¹ˆæ˜¯ Socketï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶-timeout">äº‹ä»¶ï¼š&#39;timeout&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-address">socket.address()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-10">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-autoselectfamilyattemptedaddresses">socket.autoSelectFamilyAttemptedAddresses</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†-1">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-autoselectfamilyattemptedaddresses-1">socket.autoSelectFamilyAttemptedAddresses</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®è·µä¸­çš„åº”ç”¨">å®è·µä¸­çš„åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-9">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-buffersize">socket.bufferSize</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-buffersize-1">socket.bufferSize</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-bytesread">socket.bytesRead</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5">å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-byteswritten">socket.bytesWritten</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-è¿½è¸ªæ•°æ®ä¼ è¾“é‡">ä¾‹å­ 1ï¼šè¿½è¸ªæ•°æ®ä¼ è¾“é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-ç›‘æ§æ–‡ä»¶ä¼ è¾“è¿›åº¦">ä¾‹å­ 2ï¼šç›‘æ§æ–‡ä»¶ä¼ è¾“è¿›åº¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-connect">socket.connect()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-connect-æ–¹æ³•æ¦‚è¿°">socket.connect() æ–¹æ³•æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è¯¦è§£-1">å‚æ•°è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¯¦ç»†è§£é‡Š">è¯¦ç»†è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨-1">ç¤ºä¾‹ 1ï¼šè¿æ¥åˆ° TCP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-è¿æ¥åˆ°-ipc-æœåŠ¡å™¨">ç¤ºä¾‹ 2ï¼šè¿æ¥åˆ° IPC æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-2">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-1">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-connecting">socket.connecting</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-destroy-error">socket.destroy([error])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹">åº”ç”¨åœºæ™¯ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-1">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-destroyed">socket.destroyed</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-destroyed-1">socket.destroyed</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-destroysoon">socket.destroySoon()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-end-data-encoding-callback">socket.end([data[, encoding]][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-3">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-11">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-localaddress">socket.localAddress</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-localport">socket.localPort</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¾‹è¯´æ˜-1">ä¸¾ä¾‹è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-localfamily">socket.localFamily</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-pause">socket.pause()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-socket-1">ä»€ä¹ˆæ˜¯ Socket?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-pause-æ–¹æ³•æ¦‚è¿°">socket.pause() æ–¹æ³•æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-socket-pause">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ socket.pause()?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-2">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-6">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-pending">socket.pending</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¿™ä¸ªå±æ€§é‡è¦">ä¸ºä»€ä¹ˆè¿™ä¸ªå±æ€§é‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-12">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-ref">socket.ref()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-ref-å‡½æ•°çš„ä½œç”¨">socket.ref() å‡½æ•°çš„ä½œç”¨ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6">å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-remoteaddress">socket.remoteAddress</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-ip-åœ°å€">ä»€ä¹ˆæ˜¯ IP åœ°å€ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-remoteaddressçš„ä½œç”¨">socket.remoteAddressçš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-1">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-remotefamily">socket.remoteFamily</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ª-tcp-æœåŠ¡å™¨-æ‰“å°è¿æ¥çš„å®¢æˆ·ç«¯-ip-ç‰ˆæœ¬">ç¤ºä¾‹ 1: åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œæ‰“å°è¿æ¥çš„å®¢æˆ·ç«¯ IP ç‰ˆæœ¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-æ ¹æ®å®¢æˆ·ç«¯-ip-ç‰ˆæœ¬é‡‡å–ä¸åŒçš„å“åº”">ç¤ºä¾‹ 2: æ ¹æ®å®¢æˆ·ç«¯ IP ç‰ˆæœ¬é‡‡å–ä¸åŒçš„å“åº”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-remoteport">socket.remotePort</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•è§£é‡Š-2">ç®€å•è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-resetanddestroy">socket.resetAndDestroy()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-resume">socket.resume()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-13">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-setencoding-encoding">socket.setEncoding([encoding])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°">å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-4">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-setkeepalive-enable-initialdelay">socket.setKeepAlive([enable][, initialDelay])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-14">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-setnodelay-nodelay">socket.setNoDelay([noDelay])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-settimeout-timeout-callback">socket.setTimeout(timeout[, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨-1">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-2">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-timeout">socket.timeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å¥—æ¥å­—-socket-ç®€ä»‹">1. å¥—æ¥å­—(Socket)ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä»€ä¹ˆæ˜¯socket-timeout">2. ä»€ä¹ˆæ˜¯socket.timeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å¦‚ä½•ä½¿ç”¨socket-timeout">3. å¦‚ä½•ä½¿ç”¨socket.timeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-10">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-unref">socket.unref()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶å¾ªç¯-event-loop-åŸºç¡€">äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-unref-æ–¹æ³•çš„ä½œç”¨">socket.unref()æ–¹æ³•çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-15">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-5">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-write-data-encoding-callback">socket.write(data[, encoding][, callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#socket-readystate">socket.readyState</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯">å®ä¾‹ 1ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-ç›‘æµ‹-socket-çŠ¶æ€å˜åŒ–">å®ä¾‹ 2ï¼šç›‘æµ‹ socket çŠ¶æ€å˜åŒ–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-connect">net.connect()</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-16">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-3">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-connect-options-connectlistener">net.connect(options[, connectListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-4">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-8">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-11">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-connect-path-connectlistener">net.connect(path[, connectListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è¯´æ˜">å‚æ•°è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-17">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-7">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-connect-port-host-connectlistener">net.connect(port[, host][, connectListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-5">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-3">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-createconnection">net.createConnection()</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-createconnection-options-connectlistener">net.createConnection(options[, connectListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-6">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•-1">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-4">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-createconnection-path-connectlistener">net.createConnection(path[, connectListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‡½æ•°è§£é‡Š">å‡½æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•-2">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨æ¡ˆä¾‹">å®é™…åº”ç”¨æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-createconnection-port-host-connectlistener">net.createConnection(port[, host][, connectListener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-7">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-18">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-12">å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-createserver-options-connectionlistener">net.createServer([options][, connectionListener])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬è§£é‡Š">åŸºæœ¬è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1">ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-getdefaultautoselectfamily">net.getDefaultAutoSelectFamily()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-setdefaultautoselectfamily-value">net.setDefaultAutoSelectFamily(value)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-ip-åœ°å€æ—">ä»€ä¹ˆæ˜¯ IP åœ°å€æ—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-setdefaultautoselectfamily-value-1">net.setDefaultAutoSelectFamily(value)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-getdefaultautoselectfamilyattempttimeout">net.getDefaultAutoSelectFamilyAttemptTimeout()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-setdefaultautoselectfamilyattempttimeout-value">net.setDefaultAutoSelectFamilyAttemptTimeout(value)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-setdefaultautoselectfamilyattempttimeout-value-1">net.setDefaultAutoSelectFamilyAttemptTimeout(value)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-isip-input">net.isIP(input)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-isipv4-input">net.isIPv4(input)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#net-isipv6-input">net.isIPv6(input)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-ipv6-åœ°å€">ä»€ä¹ˆæ˜¯ IPv6 åœ°å€ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#net-isipv6-input-1">net.isIPv6(input)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-4">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="net" tabindex="-1"><a class="header-anchor" href="#net"><span><a href="https://nodejs.org/docs/latest/api/net.html#net" target="_blank" rel="noopener noreferrer">Net</a></span></a></h1><p>Node.js åœ¨å…¶ v21.7.1 ç‰ˆæœ¬ä¸­çš„<code>Net</code>æ¨¡å—æ˜¯ç”¨äºå¤„ç†ç½‘ç»œæ“ä½œçš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€ä¸ªå¼‚æ­¥ç½‘ç»œ APIï¼Œç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC çš„æœåŠ¡å™¨(<code>net.createServer()</code>)å’Œå®¢æˆ·ç«¯(<code>net.createConnection()</code>)ã€‚</p><p>è¦ç†è§£<code>Net</code>æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¯”ä½œæ˜¯å»ºç«‹å’Œç®¡ç†ç½‘ç»œè¿æ¥çš„å·¥å…·ç®±ã€‚å®ƒå…è®¸ Node.js åº”ç”¨ç¨‹åºè½»æ¾åœ°å»ºç«‹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ç½‘ç»œé€šä¿¡ã€‚ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜å®ƒçš„ä½¿ç”¨ï¼š</p><h3 id="_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨"><span>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨</span></a></h3><p>å½“ä½ æƒ³è¦å»ºç«‹ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç›‘å¬ç‰¹å®šç«¯å£ä¸Šçš„ç½‘ç»œè¯·æ±‚æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>Net</code>æ¨¡å—æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„å›å£°(Echo)æœåŠ¡å™¨ï¼Œå®ƒä¼šå°†ä»»ä½•æ¥æ”¶åˆ°çš„æ•°æ®å‘é€å›å®¢æˆ·ç«¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œå°†æ•°æ®å‘é€å›å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„8124ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8124</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨åœ¨8124ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-åˆ›å»ºä¸€ä¸ª-tcp-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_2-åˆ›å»ºä¸€ä¸ª-tcp-å®¢æˆ·ç«¯"><span>2. åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯</span></a></h3><p>ä¸ºäº†ä¸ä¸Šè¿°æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‘é€æ¶ˆæ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8124</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²è¿æ¥åˆ°æœåŠ¡å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼ŒæœåŠ¡å™¨!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å®Œæˆæ¥æ”¶åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“è¿æ¥å…³é—­</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²ä»æœåŠ¡å™¨æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨åœºæ™¯"><span>å®é™…è¿ç”¨åœºæ™¯</span></a></h3><ul><li><strong>æ„å»ºå³æ—¶é€šä¿¡åº”ç”¨</strong>ï¼šé€šè¿‡<code>Net</code>æ¨¡å—ï¼Œä½ å¯ä»¥æ„å»ºèŠå¤©åº”ç”¨ç¨‹åºï¼Œå…è®¸å¤šä¸ªå®¢æˆ·ç«¯ç›¸äº’é€šä¿¡ã€‚</li><li><strong>ç‰©è”ç½‘(IoT)è®¾å¤‡é€šä¿¡</strong>ï¼šç‰©è”ç½‘è®¾å¤‡ç»å¸¸éœ€è¦ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ä»¥å‘é€ä¼ æ„Ÿå™¨æ•°æ®æˆ–æ¥æ”¶æŒ‡ä»¤ï¼Œ<code>Net</code>æ¨¡å—å¯ä»¥å¸®åŠ©å®ç°è¿™ç§ç±»å‹çš„ç½‘ç»œé€šä¿¡ã€‚</li><li><strong>æ¸¸æˆæœåŠ¡å™¨</strong>ï¼šå¯¹äºå¤šäººåœ¨çº¿æ¸¸æˆï¼Œå¯ä»¥åˆ©ç”¨<code>Net</code>æ¨¡å—åˆ›å»ºæ¸¸æˆæœåŠ¡å™¨ï¼Œç®¡ç†ç©å®¶ä¹‹é—´çš„è¿æ¥ã€çŠ¶æ€åŒæ­¥ç­‰ã€‚</li></ul><p>æ€»ä¹‹ï¼Œ<code>Net</code>æ¨¡å—æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„æ–¹æ³•æ¥å¤„ç†ç½‘ç»œé€šä¿¡ï¼Œæ˜¯ Node.js ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚æ— è®ºæ˜¯æ„å»ºç®€å•çš„ç½‘ç»œæœåŠ¡è¿˜æ˜¯å¤æ‚çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œ<code>Net</code>æ¨¡å—éƒ½èƒ½å¤Ÿæä¾›å¿…è¦çš„åŠŸèƒ½æ”¯æŒã€‚</p><h2 id="ipc-support" tabindex="-1"><a class="header-anchor" href="#ipc-support"><span><a href="https://nodejs.org/docs/latest/api/net.html#ipc-support" target="_blank" rel="noopener noreferrer">IPC support</a></span></a></h2><p>IPC æ˜¯ Inter-Process Communicationï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰çš„ç¼©å†™ã€‚åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒIPC è®©ä¸åŒçš„è¿›ç¨‹ï¼ˆå³è¿è¡Œä¸­çš„ç¨‹åºæˆ–åº”ç”¨çš„å®ä¾‹ï¼‰èƒ½å¤Ÿäº’ç›¸å‘é€æ•°æ®å’ŒæŒ‡ä»¤ã€‚è¿™å¯¹äºæ„å»ºå¤æ‚ã€é«˜æ•ˆçš„è½¯ä»¶ç³»ç»Ÿéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸ç¨‹åºåˆ†æ‹†æˆæ›´å°ã€æ›´æ˜“äºç®¡ç†å’Œç»´æŠ¤çš„éƒ¨åˆ†ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ï¼Œå®ƒä½¿å¾—å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js çš„è®¾è®¡å“²å­¦ä¹‹ä¸€æ˜¯åˆ©ç”¨å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„æ¶æ„æ¥å¤„ç†å¤šä¸ªè¿æ¥ï¼Œä»è€Œæé«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚è¿™ç§æ¶æ„åœ¨éœ€è¦å¤§é‡ IO æ“ä½œï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰çš„åº”ç”¨åœºæ™¯ä¸‹è¡¨ç°å°¤ä¸ºçªå‡ºã€‚</p><p>åœ¨ Node.js ä¸­ï¼ŒIPC ä¸»è¦é€šè¿‡<code>net</code>æ¨¡å—æ”¯æŒï¼Œè¯¥æ¨¡å—æä¾›äº†ä¸€å¥—å¼‚æ­¥ç½‘ç»œ APIï¼Œç”¨äºåˆ›å»ºåŸºäºæµå’Œæ•°æ®æŠ¥çš„ TCP æˆ– IPC çš„æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h3><p><strong>1. å¼€å‘å¾®æœåŠ¡æ¶æ„çš„åº”ç”¨</strong></p><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ•´ä¸ªåº”ç”¨è¢«æ‹†åˆ†æˆè®¸å¤šå°å‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ï¼Œå¹¶é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚ä½¿ç”¨ Node.js çš„ IPC åŠŸèƒ½ï¼Œä½ å¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªå¾®æœåŠ¡ï¼Œå®ƒä»¬é€šè¿‡ IPC é€šé“ï¼ˆå¦‚ UNIX åŸŸå¥—æ¥å­—æˆ–å‘½åç®¡é“ï¼‰è¿›è¡Œé«˜æ•ˆçš„é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè´Ÿè´£ç”¨æˆ·è®¤è¯çš„æœåŠ¡å¯èƒ½ä¼šé€šè¿‡ IPC é€šçŸ¥å¦ä¸€ä¸ªå¤„ç†ç”¨æˆ·æ•°æ®çš„æœåŠ¡ï¼Œä»¥æ›´æ–°ç”¨æˆ·çŠ¶æ€ã€‚</p><p><strong>2. åˆ›å»ºå·¥å…·å’Œå¸®æ‰‹è¿›ç¨‹</strong></p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸» Node.js åº”ç”¨å¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº›å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚è§†é¢‘ç¼–ç ã€å›¾åƒå¤„ç†ç­‰ã€‚ä¸ºäº†é¿å…é˜»å¡ä¸»äº‹ä»¶å¾ªç¯ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æ¥å¤„ç†è¿™äº›ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ IPC ä¸ä¸»åº”ç”¨é€šä¿¡ã€‚å½“ä»»åŠ¡å®Œæˆæ—¶ï¼Œå·¥ä½œè¿›ç¨‹å°±é€šè¿‡ IPC å‘ä¸»åº”ç”¨å‘é€ç»“æœã€‚</p><p><strong>3. å®ç°å®ˆæŠ¤è¿›ç¨‹æˆ–åå°æœåŠ¡</strong></p><p>IPC ä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºå®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰æˆ–åå°æœåŠ¡ï¼Œè¿™äº›è¿›ç¨‹é•¿æ—¶é—´è¿è¡Œå¹¶æ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€ç›‘æ§ç³»ç»ŸçŠ¶æ€ç­‰ã€‚é€šè¿‡ IPCï¼Œè¿™äº›å®ˆæŠ¤è¿›ç¨‹å¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–åº”ç”¨æˆ–æœåŠ¡çš„æŒ‡ä»¤ï¼Œå¦‚é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€åœæ­¢æˆ–å¼€å§‹æ‰§è¡ŒæŸäº›ä»»åŠ¡ç­‰ã€‚</p><h3 id="å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-ipc" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-ipc"><span>å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ IPC</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¦‚æœä½ æƒ³è¦åœ¨çˆ¶å­è¿›ç¨‹é—´è¿›è¡Œé€šä¿¡ï¼Œä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>child_process.fork()</code>æ–¹æ³•å¯åŠ¨å­è¿›ç¨‹ã€‚è¿™ä¸ªæ–¹æ³•é™¤äº†åˆ›å»ºæ–°çš„è¿›ç¨‹å¤–ï¼Œè¿˜ä¼šå»ºç«‹ä¸€ä¸ªé€šä¿¡é¢‘é“ï¼Œè®©çˆ¶å­è¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å­è¿›ç¨‹ä»£ç åœ¨ &#39;child.js&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€æ¶ˆæ¯åˆ°å­è¿›ç¨‹</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æ¥è‡ªå­è¿›ç¨‹çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æ¥è‡ªå­è¿›ç¨‹çš„æ¶ˆæ¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>child.js</code>ä¸­ï¼Œå­è¿›ç¨‹å¯ä»¥ç›‘å¬<code>message</code>äº‹ä»¶ï¼Œä»¥æ¥æ”¶æ¥è‡ªçˆ¶è¿›ç¨‹çš„æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨<code>process.send()</code>å‘é€æ¶ˆæ¯å›çˆ¶è¿›ç¨‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æ¥è‡ªçˆ¶è¿›ç¨‹çš„æ¶ˆæ¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å›å¤æ¶ˆæ¯ç»™çˆ¶è¿›ç¨‹</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> received</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯ Node.js ä¸­ IPC çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚å€ŸåŠ© IPCï¼ŒNode.js åº”ç”¨å¯ä»¥æ›´çµæ´»åœ°ç»„ç»‡å…¶ç»„ä»¶ï¼Œå®ç°æ›´å¤æ‚çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¿æŒé«˜æ€§èƒ½ã€‚</p><h3 id="identifying-paths-for-ipc-connections" tabindex="-1"><a class="header-anchor" href="#identifying-paths-for-ipc-connections"><span><a href="https://nodejs.org/docs/latest/api/net.html#identifying-paths-for-ipc-connections" target="_blank" rel="noopener noreferrer">Identifying paths for IPC connections</a></span></a></h3><p>Node.js ä¸­çš„ IPCï¼ˆInter-Process Communicationï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼‰æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸è¿è¡Œåœ¨åŒä¸€å°è®¡ç®—æœºä¸Šçš„ä¸åŒè¿›ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚è¿™å¯¹äºæ„å»ºé«˜æ•ˆä¸”å¯æ‰©å±•çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦å¤šä¸ªè¿›ç¨‹åä½œå¤„ç†ä»»åŠ¡æ—¶ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>net</code>æ¨¡å—æä¾›äº†åˆ›å»º IPC è¿æ¥çš„åŠŸèƒ½ã€‚é€šè¿‡ IPCï¼ŒNode.js å¯ä»¥ä½¿ç”¨ Unix å¥—æ¥å­—ï¼ˆåœ¨ç±» Unix æ“ä½œç³»ç»Ÿä¸Šï¼‰æˆ–å‘½åç®¡é“ï¼ˆåœ¨ Windows ä¸Šï¼‰è¿›è¡Œé€šä¿¡ã€‚è¿™äº›è¿æ¥çš„â€œè·¯å¾„â€å°±æ˜¯æ ‡è¯†è¿™äº› Unix å¥—æ¥å­—æˆ–å‘½åç®¡é“çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-ipc-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-ipc-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯"><span>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ IPC æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</span></a></h4><p><strong>æœåŠ¡å™¨ç«¯ä»£ç ï¼ˆserver.jsï¼‰</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ•°æ®æ¥è‡ªå®¢æˆ·ç«¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼Œå®¢æˆ·ç«¯ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿™é‡Œ`./mysocket.sock`æ˜¯Unixå¥—æ¥å­—çš„è·¯å¾„ï¼ŒWindowsä¸Šå¯èƒ½æ˜¯`\\.\pipe\mypipe`</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./mysocket.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å·²å¯åŠ¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¢æˆ·ç«¯ä»£ç ï¼ˆclient.jsï¼‰</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./mysocket.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼ŒæœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸æœåŠ¡å™¨çš„è¿æ¥æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šè¿‡åœ¨ç›¸åŒçš„æœºå™¨ä¸Šçš„<code>./mysocket.sock</code> Unix å¥—æ¥å­—æ–‡ä»¶è¿›è¡Œé€šä¿¡ã€‚å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯åå›å¤å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å…³é—­è¿æ¥ã€‚</p><h4 id="_2-ä½¿ç”¨-ipc-é€šä¿¡æ§åˆ¶å­è¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨-ipc-é€šä¿¡æ§åˆ¶å­è¿›ç¨‹"><span>2. ä½¿ç”¨ IPC é€šä¿¡æ§åˆ¶å­è¿›ç¨‹</span></a></h4><p>å‡è®¾æœ‰æ—¶å€™æˆ‘ä»¬æƒ³ä»ä¸»è¿›ç¨‹å‘å­è¿›ç¨‹å‘é€æ•°æ®ï¼Œå¹¶è®©å­è¿›ç¨‹æ ¹æ®æ¥æ”¶çš„æ•°æ®æ‰§è¡Œç‰¹å®šæ“ä½œã€‚</p><p><strong>ä¸»è¿›ç¨‹ä»£ç ï¼ˆmain.jsï¼‰</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  stdio</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">inherit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">inherit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">inherit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ipc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¼€å¯IPCé€šé“</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> cmd</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sayHello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¥è‡ªå­è¿›ç¨‹çš„æ¶ˆæ¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å­è¿›ç¨‹ä»£ç ï¼ˆchild.jsï¼‰</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cmd</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cmd</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sayHello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼Œæ¥è‡ªçˆ¶è¿›ç¨‹çš„æ¶ˆæ¯!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> cmd</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">received</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸»è¿›ç¨‹åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶é€šè¿‡ IPC å‘é€ä¸€ä¸ªåŒ…å«æŒ‡ä»¤çš„å¯¹è±¡ã€‚å­è¿›ç¨‹æ”¶åˆ°æ¶ˆæ¯åæ‰§è¡Œç›¸åº”æ“ä½œï¼Œå¹¶å°†ç¡®è®¤æ¶ˆæ¯å›ä¼ ç»™ä¸»è¿›ç¨‹ã€‚</p><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h3><p>é€šè¿‡ä»¥ä¸Šä¾‹å­ï¼Œå¯ä»¥çœ‹å‡º Node.js ä¸­çš„<code>net</code>æ¨¡å—ä½¿å¾—è¿›ç¨‹é—´çš„é€šä¿¡å˜å¾—ç›¸å¯¹ç®€å•ã€‚æ— è®ºæ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šçš„ä¸åŒ Node.js è¿›ç¨‹ä¹‹é—´ï¼Œè¿˜æ˜¯ Node.js è¿›ç¨‹ä¸å…¶ä»–ç±»å‹è¿›ç¨‹ä¹‹é—´ï¼Œéƒ½å¯ä»¥åˆ©ç”¨è¿™ç§æ–¹å¼æœ‰æ•ˆåœ°è¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™å¯¹äºå¼€å‘éœ€è¦å¤šè¿›ç¨‹åä½œçš„å¤æ‚åº”ç”¨ç¨‹åºéå¸¸æœ‰å¸®åŠ©ã€‚</p><h2 id="class-net-blocklist" tabindex="-1"><a class="header-anchor" href="#class-net-blocklist"><span><a href="https://nodejs.org/docs/latest/api/net.html#class-netblocklist" target="_blank" rel="noopener noreferrer">Class: net.BlockList</a></span></a></h2><p>é¦–å…ˆï¼ŒNode.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ å°† JavaScript ç”¨äºæœåŠ¡å™¨ç«¯ç¼–ç¨‹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿå¤„ç†ç½‘é¡µè¯·æ±‚ã€æ•°æ®åº“æ“ä½œç­‰åç«¯ä»»åŠ¡çš„ä»£ç ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>net.BlockList</code>æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°åŠ å…¥çš„ç±»ï¼Œç”¨äºç®¡ç†å’Œæ“ä½œ IP åœ°å€æˆ– IP èŒƒå›´ï¼ˆå³ä¸€ç»„ IP åœ°å€ï¼‰çš„é˜»æ­¢åˆ—è¡¨ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå…è®¸å¼€å‘è€…å®šä¹‰ä¸€ç³»åˆ—ä¸è¢«å…è®¸è¿æ¥åˆ°ä½ çš„åº”ç”¨æˆ–æœåŠ¡çš„ IP åœ°å€ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨net-blocklist" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨net-blocklist"><span>å¦‚ä½•ä½¿ç”¨<code>net.BlockList</code></span></a></h3><p>æƒ³è¦ä½¿ç”¨<code>net.BlockList</code>ï¼Œä½ é¦–å…ˆéœ€è¦åœ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºä¸­å¼•å…¥<code>net</code>æ¨¡å—ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ª<code>BlockList</code>å®ä¾‹å¹¶ä½¿ç”¨å…¶åŸºæœ¬åŠŸèƒ½çš„æ­¥éª¤ï¼š</p><ol><li><p><strong>å¼•å…¥ net æ¨¡å—ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>åˆ›å»º BlockList å®ä¾‹ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ·»åŠ  IP åœ°å€åˆ°é˜»æ­¢åå•ï¼š</strong></p><ul><li>ä½ å¯ä»¥æ·»åŠ å•ä¸ª IP åœ°å€ï¼š<div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addAddress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>æˆ–è€…æ·»åŠ ä¸€ä¸ª IP æ®µï¼ˆCIDR è¡¨ç¤ºæ³•ï¼‰ï¼š<div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addRange</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.1.255</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>ç”šè‡³æ·»åŠ ä¸€ä¸ªå­ç½‘ï¼š<div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addSubnet</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.0/24</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>æ£€æŸ¥ IP åœ°å€æ˜¯å¦è¢«é˜»æ­¢ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> isBlocked</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">isBlocked</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼štrue æˆ– false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-é˜²æ­¢æ¶æ„è®¿é—®" tabindex="-1"><a class="header-anchor" href="#_1-é˜²æ­¢æ¶æ„è®¿é—®"><span>1. é˜²æ­¢æ¶æ„è®¿é—®</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Web æœåŠ¡å™¨ï¼ŒæŸä¸ªç‰¹å®šçš„ IP åœ°å€é¢‘ç¹åœ°è¿›è¡Œæ¶æ„å°è¯•ï¼Œæ¯”å¦‚å°è¯•ç ´è§£ç”¨æˆ·å¯†ç ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>BlockList</code>æ¥é˜»æ­¢æ¥è‡ªè¯¥ IP çš„æ‰€æœ‰è¯·æ±‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addAddress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¶æ„IPåœ°å€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> clientIP</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">clientIP</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">403</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€403 Forbidden å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Access denied</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ç»´æŠ¤é»‘åå•" tabindex="-1"><a class="header-anchor" href="#_2-ç»´æŠ¤é»‘åå•"><span>2. ç»´æŠ¤é»‘åå•</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ç®¡ç†ä¸€ä¸ªåªå…è®¸ç‰¹å®šç”¨æˆ·ç¾¤ä½“è®¿é—®çš„åœ¨çº¿æœåŠ¡ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ªåŒ…å«å·²çŸ¥æ”»å‡»è€… IP åœ°å€çš„é»‘åå•ã€‚é€šè¿‡å°†è¿™äº› IP åœ°å€æ·»åŠ åˆ°<code>BlockList</code>ï¼Œä½ å¯ä»¥è½»æ¾åœ°é˜²æ­¢å®ƒä»¬è®¿é—®ä½ çš„æœåŠ¡ã€‚</p><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1"><span>å°ç»“</span></a></h3><p><code>net.BlockList</code>æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼æ¥å¢åŠ  Node.js åº”ç”¨çš„å®‰å…¨æ€§ï¼Œé€šè¿‡é˜»æ­¢ä¸å—æ¬¢è¿çš„ IP åœ°å€æˆ–èŒƒå›´æ¥é˜²æ­¢æ½œåœ¨çš„æ¶æ„è®¿é—®ã€‚è¿™å¯¹äºä¿æŠ¤ Web æœåŠ¡å™¨ã€API ç«¯ç‚¹æˆ–ä»»ä½•ç½‘ç»œæœåŠ¡éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><h3 id="blocklist-addaddress-address-type" tabindex="-1"><a class="header-anchor" href="#blocklist-addaddress-address-type"><span><a href="https://nodejs.org/docs/latest/api/net.html#blocklistaddaddressaddress-type" target="_blank" rel="noopener noreferrer">blockList.addAddress(address[, type])</a></span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ Node.js æ˜¯ä»€ä¹ˆã€‚Node.js æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç ã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿå¤„ç†ç½‘ç»œè¯·æ±‚ã€è®¿é—®æ•°æ®åº“ç­‰åç«¯åŠŸèƒ½çš„ä»£ç ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æµè§ˆå™¨ä¸­è¿è¡Œæ¥æ§åˆ¶ç½‘é¡µè¡Œä¸ºã€‚</p><p>ç°åœ¨ï¼Œæ·±å…¥åˆ°ä½ çš„é—®é¢˜ï¼š<code>blockList.addAddress(address[, type])</code> è¿™ä¸ªæ–¹æ³•æ˜¯ Node.js v21.7.1 ä¸­ <code>net</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚<code>net</code> æ¨¡å—æä¾›äº†ç”¨äºåº•å±‚ç½‘ç»œé€šä¿¡çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èƒ½åŠ›ã€‚è€Œ <code>blockList</code> æ˜¯ <code>net</code> æ¨¡å—æ–°å¼•å…¥çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒä¸»è¦ç”¨äºç®¡ç†ä¸€ä¸ªâ€œé»‘åå•â€åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨ç”¨æ¥å­˜å‚¨é‚£äº›è¢«ç¦æ­¢è¿æ¥åˆ°ä½ çš„åº”ç”¨çš„ IP åœ°å€æˆ–æ˜¯åœ°å€èŒƒå›´ã€‚</p><h3 id="å…³äº-blocklist-addaddress-address-type" tabindex="-1"><a class="header-anchor" href="#å…³äº-blocklist-addaddress-address-type"><span>å…³äº <code>blockList.addAddress(address[, type])</code></span></a></h3><ul><li><p><strong>ä½œç”¨</strong>ï¼šè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å‘ <code>blockList</code> ä¸­æ·»åŠ ä¸€ä¸ªåœ°å€ã€‚ä¸€æ—¦åœ°å€è¢«æ·»åŠ åˆ°é»‘åå•ä¸­ï¼Œä»»ä½•æ¥è‡ªè¿™ä¸ªåœ°å€çš„è¿æ¥éƒ½ä¼šè¢«è‡ªåŠ¨æ‹’ç»ã€‚è¿™å¯¹äºå¢å¼ºåº”ç”¨çš„å®‰å…¨æ€§éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜»æ­¢å·²çŸ¥çš„æ¶æ„ç”¨æˆ·æˆ–ç³»ç»Ÿçš„è®¿é—®å°è¯•ã€‚</p></li><li><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><code>address</code>ï¼šè¿™æ˜¯è¦æ·»åŠ åˆ°é»‘åå•ä¸­çš„ IP åœ°å€æˆ–æ˜¯ CIDR åŒºé—´ã€‚</li><li><code>type</code>ï¼ˆå¯é€‰ï¼‰ï¼šè¿™è¡¨ç¤ºåœ°å€çš„ç±»å‹ã€‚å¯èƒ½çš„å€¼æœ‰ <code>&#39;ipv4&#39;</code>ã€<code>&#39;ipv6&#39;</code> æˆ– <code>&#39;cidr&#39;</code>ã€‚å¦‚æœä¸æä¾›ï¼ŒNode.js ä¼šå°è¯•è‡ªåŠ¨æ£€æµ‹åœ°å€ç±»å‹ã€‚</li></ul></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨æœ‰ä¸€ä¸ªç®€å•çš„ API æœåŠ¡å™¨ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡äº’è”ç½‘è·å–ä¿¡æ¯ã€‚ç„¶è€Œï¼Œä½ æ³¨æ„åˆ°æœ‰ä¸€äº›ç‰¹å®šçš„ IP åœ°å€é¢‘ç¹åœ°å‘é€å¤§é‡è¯·æ±‚ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬åœ¨å°è¯•æ”»å‡»ä½ çš„æœåŠ¡ã€‚ä¸ºäº†ä¿æŠ¤ä½ çš„åº”ç”¨ï¼Œä½ å†³å®šå°†è¿™äº› IP åœ°å€åŠ å…¥åˆ°é»‘åå•ä¸­ã€‚</p><p>è¿™é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨ <code>blockList.addAddress</code> æ¥å®ç°è¿™ä¸€ç›®æ ‡çš„ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ blockList å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯æˆ‘ä»¬è¯†åˆ«å‡ºçš„æ¶æ„ IP åœ°å€</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> maliciousIP</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.1.10</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å°†æ¶æ„ IP åœ°å€æ·»åŠ åˆ°é»‘åå•ä¸­</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addAddress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">maliciousIP</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ipv4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ TCP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥è¿æ¥çš„ IP åœ°å€æ˜¯å¦åœ¨é»‘åå•ä¸­</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Connection from </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> is blocked.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç»“æŸè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Connection from </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> is allowed.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å…¶ä»–å¤„ç†...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£12345ä¸Šçš„è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>net</code> æ¨¡å—å¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>blockList</code> å®ä¾‹ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªè¢«è§†ä¸ºæ¶æ„çš„ IP åœ°å€æ·»åŠ åˆ°äº†é»‘åå•ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œå¹¶åœ¨æ¯æ¬¡æ”¶åˆ°æ–°è¿æ¥æ—¶æ£€æŸ¥å‘èµ·è¿æ¥çš„ IP åœ°å€æ˜¯å¦åœ¨é»‘åå•ä¸­ã€‚å¦‚æœåœ¨é»‘åå•ä¸­ï¼Œåˆ™ç«‹å³ç»“æŸè¿æ¥ï¼›å¦‚æœä¸åœ¨ï¼Œåˆ™å…è®¸è¿æ¥è¿›è¡Œæ›´å¤šå¤„ç†ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°é™åˆ¶æ¶æ„ç”¨æˆ·å¯¹ä½ çš„ Node.js åº”ç”¨çš„è®¿é—®ï¼Œä»è€Œæé«˜åº”ç”¨çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</p><h3 id="blocklist-addrange-start-end-type" tabindex="-1"><a class="header-anchor" href="#blocklist-addrange-start-end-type"><span><a href="https://nodejs.org/docs/latest/api/net.html#blocklistaddrangestart-end-type" target="_blank" rel="noopener noreferrer">blockList.addRange(start, end[, type])</a></span></a></h3><p>è®©æˆ‘æ¥å¸®ä½ ç†è§£ Node.js ä¸­<code>blockList.addRange(start, end[, type])</code>è¿™ä¸ªæ–¹æ³•çš„æ¦‚å¿µå’Œå®ƒçš„å®é™…åº”ç”¨ã€‚</p><h3 id="ç†è§£blocklist" tabindex="-1"><a class="header-anchor" href="#ç†è§£blocklist"><span>ç†è§£<code>blockList</code>:</span></a></h3><p>åœ¨ Node.js çš„ç½‘ç»œï¼ˆnetï¼‰æ¨¡å—ä¸­ï¼Œ<code>blockList</code>æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† IP åœ°å€é»‘åå•çš„å·¥å…·ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥å¸®åŠ©ä½ æ§åˆ¶å“ªäº› IP åœ°å€è¢«å…è®¸æˆ–æ‹’ç»ä¸ä½ çš„æœåŠ¡å™¨äº¤äº’ã€‚è¿™å¯¹äºå¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚é˜²æ­¢ DDoS æ”»å‡»æˆ–é¿å…æ¶æ„ç”¨æˆ·è®¿é—®ã€‚</p><h3 id="æ–¹æ³•è§£é‡Š-blocklist-addrange-start-end-type" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•è§£é‡Š-blocklist-addrange-start-end-type"><span>æ–¹æ³•è§£é‡Šï¼š<code>blockList.addRange(start, end[, type])</code></span></a></h3><ul><li><code>start</code>: è¿™æ˜¯èŒƒå›´çš„å¼€å§‹ IP åœ°å€ã€‚</li><li><code>end</code>: è¿™æ˜¯èŒƒå›´ç»“æŸçš„ IP åœ°å€ã€‚</li><li><code>type</code> (å¯é€‰): æŒ‡å®š IP åœ°å€çš„ç±»å‹ã€‚å®ƒå¯ä»¥æ˜¯ <code>&#39;ipv4&#39;</code> æˆ–è€… <code>&#39;ipv6&#39;</code>ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šæ ¹æ®<code>start</code>å‚æ•°è‡ªåŠ¨æ£€æµ‹ç±»å‹ã€‚</li></ul><p>å½“ä½ è°ƒç”¨<code>addRange</code>æ–¹æ³•æ—¶ï¼Œä½ å‘Šè¯‰<code>blockList</code>ä»<code>start</code>åˆ°<code>end</code>ä¹‹é—´çš„æ‰€æœ‰ IP åœ°å€éƒ½åº”è¯¥è¢«æ·»åŠ åˆ°é»‘åå•ä¸­ã€‚è¿™æ ·åšå¯ä»¥æ‰¹é‡é˜»æ­¢ä¸€ç³»åˆ—çš„ IP åœ°å€ï¼Œè€Œä¸æ˜¯é€ä¸ªæ·»åŠ ï¼ŒèŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><strong>é˜»æ­¢ç‰¹å®šåŒºåŸŸçš„è®¿é—®</strong>:<br> å‡è®¾ä½ è¿è¡Œçš„åœ¨çº¿æœåŠ¡ä»…é¢å‘ç‰¹å®šå›½å®¶ï¼Œè€Œä½ æƒ³è¦é˜»æ­¢æŸäº›å›½å®¶çš„å¤§èŒƒå›´ IP æ®µä»¥å‡å°‘åƒåœ¾é‚®ä»¶æˆ–æ»¥ç”¨ã€‚å¦‚æœä½ çŸ¥é“è¿™äº›å›½å®¶çš„ IP èŒƒå›´ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>addRange</code>æ¥é˜»æ­¢å®ƒä»¬ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æƒ³è¦é˜»æ­¢æŸä¸ªå‡æƒ³å›½å®¶çš„IPèŒƒå›´ 192.168.1.1 åˆ° 192.168.1.255</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addRange</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.1.255</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ipv4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ£€æŸ¥æŸä¸ªIPæ˜¯å¦è¢«é˜»æ­¢</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.50</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: true, å› ä¸ºè¿™ä¸ªIPåœ¨è¢«é˜»æ­¢çš„èŒƒå›´å†…</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.2.50</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: false, å› ä¸ºè¿™ä¸ªIPä¸åœ¨è¢«é˜»æ­¢çš„èŒƒå›´å†…</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>å¢å¼ºæœåŠ¡å™¨å®‰å…¨æ€§</strong>:<br> å¦‚æœä½ å‘ç°ä½ çš„æœåŠ¡å™¨æ­£åœ¨é­å—æ¥è‡ªç‰¹å®š IP èŒƒå›´å†…çš„ DDoS æ”»å‡»ï¼Œä½ å¯ä»¥å¿«é€Ÿåœ°å°†è¿™ä¸ªèŒƒå›´æ·»åŠ åˆ°é»‘åå•ä¸­ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ æ”»å‡»è€…çš„IPèŒƒå›´åˆ°é»‘åå•</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addRange</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">10.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">10.0.0.255</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨æœåŠ¡å™¨ä¸­ä½¿ç”¨blockListæ¥æ£€æŸ¥å¹¶æ‹’ç»æ¥è‡ªè¿™äº›IPçš„è¿æ¥å°è¯•</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ‹’ç»è¿æ¥: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¥å—è¿æ¥: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æœ‰æ•ˆè¿æ¥...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£3000ä¸Š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹å‡º<code>blockList.addRange(start, end[, type])</code>åœ¨å¤„ç†ç½‘ç»œå®‰å…¨å’Œè®¿é—®æ§åˆ¶æ–¹é¢æ˜¯å¦‚ä½•æä¾›ä¸€ä¸ªå¼ºæœ‰åŠ›çš„å·¥å…·çš„ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†è°å¯ä»¥æˆ–ä¸èƒ½è®¿é—®ä½ çš„æœåŠ¡å™¨èµ„æºã€‚</p><h3 id="blocklist-addsubnet-net-prefix-type" tabindex="-1"><a class="header-anchor" href="#blocklist-addsubnet-net-prefix-type"><span><a href="https://nodejs.org/docs/latest/api/net.html#blocklistaddsubnetnet-prefix-type" target="_blank" rel="noopener noreferrer">blockList.addSubnet(net, prefix[, type])</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>blockList.addSubnet(net, prefix[, type])</code> å‡½æ•°ï¼Œå¹¶é€šè¿‡ä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­æ¥åŠ æ·±ç†è§£ã€‚</p><p>é¦–å…ˆï¼Œ<code>blockList</code> æ˜¯ Node.js çš„ä¸€ä¸ªç½‘ç»œï¼ˆnetï¼‰æ¨¡å—åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªé˜»æ­¢ï¼ˆå±è”½ï¼‰ç‰¹å®š IP åœ°å€æˆ–å­ç½‘çš„åˆ—è¡¨ã€‚è¿™åœ¨éœ€è¦æ§åˆ¶è°å¯ä»¥æˆ–ä¸èƒ½è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p><strong>å‡½æ•°è§£é‡Šï¼š</strong></p><ul><li><code>addSubnet(net, prefix[, type])</code> æ–¹æ³•å…è®¸ä½ å‘é˜»æ­¢åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå­ç½‘ã€‚ <ul><li><code>net</code> æ˜¯ä¸€ä¸ªè¡¨ç¤ºå­ç½‘èµ·å§‹åœ°å€çš„å­—ç¬¦ä¸²æˆ–è€…æ˜¯ä¸€ä¸ªåŒ…å«åœ°å€çš„ <code>Buffer</code>ã€<code>Uint8Array</code> ç±»å‹ã€‚</li><li><code>prefix</code> æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒæŒ‡å®šäº†å­ç½‘æ©ç çš„é•¿åº¦ã€‚</li><li><code>type</code> æ˜¯å¯é€‰å‚æ•°ï¼Œå®ƒå¯ä»¥æ˜¯ <code>&#39;ipv4&#39;</code> æˆ–è€… <code>&#39;ipv6&#39;</code>ï¼Œè¡¨ç¤ºåœ°å€çš„ç±»å‹ã€‚å¦‚æœä¸æä¾›ï¼ŒNode.js ä¼šæ ¹æ® <code>net</code> çš„æ ¼å¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹ã€‚</li></ul></li></ul><p><strong>å®é™…è¿ç”¨ä¾‹å­ï¼š</strong></p><ol><li><p><strong>é˜²æ­¢æ¶æ„è®¿é—®ï¼š</strong> å‡è®¾ä½ è¿è¡Œä¸€ä¸ªç½‘ç«™ï¼Œå‘ç°æŸä¸ªç‰¹å®šçš„ IP å­ç½‘é¢‘ç¹å°è¯•æ”»å‡»æˆ–çˆ¬å–ç½‘ç«™å†…å®¹ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>blockList.addSubnet</code> æ¥é˜»æ­¢æ¥è‡ªè¯¥å­ç½‘çš„æ‰€æœ‰è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ blockList å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ å­ç½‘åˆ°é˜»æ­¢åˆ—è¡¨ä¸­ï¼Œæ¯”å¦‚é˜»æ­¢ 192.168.0.0/24 å­ç½‘</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addSubnet</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 24</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Blocked address</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æœªè¢«é˜»æ­¢çš„è¿æ¥...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç»´æŠ¤ç™½åå•ï¼š</strong> å¦‚æœä½ æœ‰ä¸€ä¸ªåªå¯¹æŸäº›ç»„ç»‡æˆ–åœ°åŒºå¼€æ”¾çš„æœåŠ¡ï¼Œä½ å¯ä»¥é€šè¿‡é˜»æ­¢å…¶ä»–æ‰€æœ‰å­ç½‘ï¼Œç„¶åæ‰‹åŠ¨ç®¡ç†ä¾‹å¤–æƒ…å†µï¼Œæ¥å®ç°ç±»ä¼¼ç™½åå•çš„æ•ˆæœã€‚</p></li><li><p><strong>é™åˆ¶èµ„æºæ»¥ç”¨ï¼š</strong> å¯¹äºæä¾›æœ‰é™èµ„æºçš„å…¬å…± API æˆ–æœåŠ¡ï¼Œä½ å¯èƒ½å¸Œæœ›é˜»æ­¢å·²çŸ¥æ»¥ç”¨è¿™äº›èµ„æºçš„å­ç½‘ï¼Œç¡®ä¿æœåŠ¡çš„ç¨³å®šå’Œå…¬å¹³æ€§ã€‚</p></li></ol><p>é€šè¿‡ä»¥ä¸Šä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>blockList.addSubnet</code> æ–¹æ³•ä¸º Node.js åº”ç”¨æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼æ¥å¢å¼ºå®‰å…¨æ€§å’Œæ§åˆ¶è®¿é—®æƒé™ã€‚å®ƒç‰¹åˆ«é€‚åˆå¤„ç†éœ€è¦å¤§é‡ç®¡ç† IP è®¿é—®è§„åˆ™çš„åœºæ™¯ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿæ›´å¥½åœ°ä¿æŠ¤ä»–ä»¬çš„åº”ç”¨å…å—ä¸å¿…è¦çš„è®¿é—®æˆ–æ”»å‡»ã€‚</p><h3 id="blocklist-check-address-type" tabindex="-1"><a class="header-anchor" href="#blocklist-check-address-type"><span><a href="https://nodejs.org/docs/latest/api/net.html#blocklistcheckaddress-type" target="_blank" rel="noopener noreferrer">blockList.check(address[, type])</a></span></a></h3><p>å½“ç„¶ï¼Œæˆ‘å¾ˆä¹æ„è§£é‡Šè¿™ä¸ªé—®é¢˜ç»™ä½ ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ Node.jsã€‚Node.js æ˜¯ä¸€ä¸ªå¼€æºå’Œè·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒéå¸¸é€‚åˆå¼€å‘éœ€è¦é«˜å¹¶å‘ã€æ•°æ®å¯†é›†çš„å®æ—¶åº”ç”¨ç¨‹åºã€‚</p><p>æ¥ç€ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä½ æåˆ°çš„ <code>blockList.check(address[, type])</code> å‡½æ•°ã€‚è¿™ä¸ªåŠŸèƒ½å±äº Node.js çš„ <code>net</code> æ¨¡å—ï¼Œå…¶ä¸­ <code>net</code> æ¨¡å—ä¸»è¦ç”¨äºåº•å±‚çš„ç½‘ç»œé€šä¿¡ã€‚</p><h3 id="åŠŸèƒ½è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½è§£é‡Š"><span>åŠŸèƒ½è§£é‡Š</span></a></h3><ul><li><p><strong>ç›®çš„ï¼š</strong> <code>blockList.check(address[, type])</code> æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯æ£€æŸ¥æŸä¸ª IP åœ°å€æˆ–è€… IP åœ°å€èŒƒå›´æ˜¯å¦è¢«åˆ—å…¥äº†é˜»æ­¢åˆ—è¡¨ï¼ˆblock listï¼‰ã€‚</p></li><li><p><strong>å‚æ•°ï¼š</strong></p><ul><li><code>address</code>ï¼šè¿™æ˜¯ä½ æƒ³è¦æ£€æŸ¥æ˜¯å¦è¢«é˜»æ­¢çš„ IP åœ°å€æˆ–è€…æ˜¯ä¸€ä¸ª CIDR èŒƒå›´ã€‚</li><li><code>type</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºåœ°å€çš„ç±»å‹ï¼Œæ¯”å¦‚ <code>&#39;ipv4&#39;</code> æˆ–è€… <code>&#39;ipv6&#39;</code>ã€‚</li></ul></li><li><p><strong>è¿”å›å€¼ï¼š</strong> å¦‚æœæŒ‡å®šçš„åœ°å€æˆ–åœ°å€èŒƒå›´åœ¨é˜»æ­¢åˆ—è¡¨ä¸­ï¼Œå®ƒä¼šè¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„é˜»æ­¢åˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„é˜»æ­¢åˆ—è¡¨"><span>åˆ›å»ºä¸€ä¸ªç®€å•çš„é˜»æ­¢åˆ—è¡¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª web åº”ç”¨ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½ æƒ³é˜²æ­¢æŸäº›ç‰¹å®šçš„ IP åœ°å€è®¿é—®ä½ çš„åº”ç”¨ã€‚è¿™æ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>blockList</code> æ¥å¸®åŠ©ä½ å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><ol><li><p><strong>åˆå§‹åŒ–é˜»æ­¢åˆ—è¡¨ï¼š</strong></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ <code>net</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>BlockList</code> å®ä¾‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> BlockList</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ·»åŠ  IP åœ°å€åˆ°é˜»æ­¢åˆ—è¡¨ï¼š</strong></p><p>å‡è®¾æˆ‘ä»¬æƒ³é˜»æ­¢ IP åœ°å€ä¸º &quot;192.168.1.1&quot; çš„ç”¨æˆ·ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addAddress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ£€æŸ¥åœ°å€æ˜¯å¦è¢«é˜»æ­¢ï¼š</strong></p><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ£€æŸ¥ IP åœ°å€ &quot;192.168.1.1&quot; æ˜¯å¦è¢«é˜»æ­¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>check</code> æ–¹æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> isBlocked</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">check</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">isBlocked</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼štrue</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç®¡ç†å’Œæ£€æŸ¥å“ªäº› IP åœ°å€è¢«é˜»æ­¢è®¿é—®ä½ çš„åº”ç”¨ã€‚è¿™ç§æ–¹æ³•å¯¹äºå¢å¼ºåº”ç”¨çš„å®‰å…¨æ€§æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ä¸å—æ¬¢è¿çš„æµé‡æˆ–è€…é˜²æ­¢ DDoS æ”»å‡»æ—¶ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ <code>blockList.check(address[, type])</code> æ–¹æ³•åœ¨ Node.js ä¸­çš„ç”¨é€”å’Œå®ç°æ–¹å¼ã€‚</p><h3 id="blocklist-rules" tabindex="-1"><a class="header-anchor" href="#blocklist-rules"><span><a href="https://nodejs.org/docs/latest/api/net.html#blocklistrules" target="_blank" rel="noopener noreferrer">blockList.rules</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js ä¸­æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œè¿™äº›æ¨¡å—æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œè®©å¼€å‘å˜å¾—æ›´åŠ é«˜æ•ˆå’Œæ–¹ä¾¿ã€‚å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒæ–°çš„æ¦‚å¿µæ˜¯ <code>blockList.rules</code>ï¼Œå®ƒå±äº <code>net</code> æ¨¡å—ï¼Œä¸»è¦ç”¨äºç®¡ç†ç½‘ç»œè¿æ¥çš„é˜»æ­¢åå•ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-blocklist-rules" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-blocklist-rules"><span>ä»€ä¹ˆæ˜¯ blockList.rules?</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>blockList.rules</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å®šä¹‰äº†å“ªäº› IP åœ°å€ï¼ˆæˆ– IP åœ°å€èŒƒå›´ï¼‰è¢«é˜»æ­¢ä¸ä½ çš„ Node.js åº”ç”¨å»ºç«‹ç½‘ç»œè¿æ¥ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç®¡ç†å’Œç»´æŠ¤ä½ çš„åº”ç”¨çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦äº†è§£å¦‚ä½•è®¾ç½®æˆ–æ·»åŠ é˜»æ­¢è§„åˆ™ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p><ol><li><strong>å¼•å…¥ net æ¨¡å—</strong>ï¼šè¿™æ˜¯ Node.js çš„å†…ç½®æ¨¡å—ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚</li><li><strong>åˆ›å»ºä¸€ä¸ª BlockList å®ä¾‹</strong>ï¼šBlockList æ˜¯ net æ¨¡å—ä¸­çš„ä¸€ä¸ªç±»ï¼Œä¸“é—¨ç”¨äºç®¡ç†é˜»æ­¢è§„åˆ™ã€‚</li><li><strong>æ·»åŠ é˜»æ­¢è§„åˆ™</strong>ï¼šå¯ä»¥æ˜¯ç‰¹å®šçš„ IP åœ°å€æˆ–è€…ä¸€ä¸ª IP åœ°å€èŒƒå›´ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¼•å…¥ net æ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> blockList</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BlockList</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆ›å»ºä¸€ä¸ª BlockList å®ä¾‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ é˜»æ­¢è§„åˆ™</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addAddress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">123.45.67.89</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é˜»æ­¢ä¸€ä¸ªå…·ä½“çš„ IP åœ°å€</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addRange</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">123.45.67.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">123.45.67.255</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é˜»æ­¢ä¸€ä¸ª IP åœ°å€èŒƒå›´</span></span>
<span class="line"><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addSubnet</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 24</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é˜»æ­¢ä¸€ä¸ªå­ç½‘å†…çš„æ‰€æœ‰ IP åœ°å€</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">blockList</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">rules</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„é˜»æ­¢è§„åˆ™</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¸¾ä¾‹"><span>å®é™…è¿ç”¨ä¸¾ä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªåœ¨çº¿æœåŠ¡ï¼Œä½ å‘ç°æ¥è‡ªæŸä¸ªç‰¹å®š IP åœ°å€æˆ–æŸä¸ª IP åœ°å€èŒƒå›´çš„æµé‡å¼‚å¸¸é¢‘ç¹ï¼Œæ€€ç–‘è¿™å¯èƒ½æ˜¯æ¶æ„æ”»å‡»ï¼ˆä¾‹å¦‚ DDOS æ”»å‡»ï¼‰ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>blockList.rules</code> åŠŸèƒ½æ¥å¿«é€Ÿé˜»æ­¢è¿™äº›å¯ç–‘çš„ IP åœ°å€ä¸ä½ çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œä»è€Œä¿æŠ¤ä½ çš„åº”ç”¨ä¸å—å½±å“ã€‚</p><p>å†æ¯”å¦‚ï¼Œå¦‚æœä½ çš„æœåŠ¡ä»…é¢å‘ç‰¹å®šå›½å®¶æˆ–åœ°åŒºçš„ç”¨æˆ·ï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ é˜»æ­¢è§„åˆ™æ¥é˜»æ­¢å…¶ä»–åœ°åŒºçš„ IP åœ°å€è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ— å…³æµé‡ï¼Œæå‡æœåŠ¡è´¨é‡å’Œå®‰å…¨æ€§ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>blockList.rules</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªéå¸¸å®ç”¨çš„å®‰å…¨ç‰¹æ€§ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…æœ‰æ•ˆç®¡ç†ç½‘ç»œè¿æ¥ï¼Œæå‡åº”ç”¨çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</p><h2 id="class-net-socketaddress" tabindex="-1"><a class="header-anchor" href="#class-net-socketaddress"><span><a href="https://nodejs.org/docs/latest/api/net.html#class-netsocketaddress" target="_blank" rel="noopener noreferrer">Class: net.SocketAddress</a></span></a></h2><p>Node.js çš„ <code>net.SocketAddress</code> ç±»æ˜¯åœ¨ Node.js ç‰ˆæœ¬ 18 å¼•å…¥çš„ï¼Œå®ƒæä¾›äº†ä¸€ç§è¡¨ç¤ºç½‘ç»œå¥—æ¥å­—åœ°å€ï¼ˆsocket addressï¼‰çš„æ–¹å¼ã€‚è¿™ä¸ªç±»çš„å¯¹è±¡åŒ…å«äº†ä¸ç½‘ç»œå¥—æ¥å­—ç›¸å…³çš„åœ°å€ä¿¡æ¯ï¼Œæ¯”å¦‚ IP åœ°å€å’Œç«¯å£å·ã€‚å®ƒé€šå¸¸ç”¨äºç½‘ç»œç¼–ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†åº•å±‚ç½‘ç»œé€šä¿¡æ—¶ã€‚</p><h3 id="åŸºç¡€è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€è§£é‡Š"><span>åŸºç¡€è§£é‡Š</span></a></h3><p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œä¸€ä¸ªâ€œå¥—æ¥å­—â€ï¼ˆsocketï¼‰æ˜¯é€šä¿¡é“¾è·¯çš„ä¸€ä¸ªç«¯ç‚¹ã€‚æ¯å½“ä½ æƒ³è¦åœ¨ç½‘ç»œä¸Šå‘é€æˆ–æ¥æ”¶æ•°æ®æ—¶ï¼Œä½ éƒ½ä¼šä½¿ç”¨åˆ°å¥—æ¥å­—ã€‚è€Œä¸€ä¸ªå¥—æ¥å­—åœ°å€åˆ™å®šä¹‰äº†ä¸€ä¸ªå¥—æ¥å­—åœ¨ç½‘ç»œä¸Šçš„ä½ç½®ï¼Œå®ƒç”±ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼šIP åœ°å€å’Œç«¯å£å·ã€‚IP åœ°å€æŒ‡å®šäº†è®¾å¤‡åœ¨ç½‘ç»œä¸Šçš„ä½ç½®ï¼Œè€Œç«¯å£å·åˆ™ç¡®å®šäº†è¯¥è®¾å¤‡ä¸Šç‰¹å®šçš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ã€‚</p><h3 id="net-socketaddress-ç±»" tabindex="-1"><a class="header-anchor" href="#net-socketaddress-ç±»"><span><code>net.SocketAddress</code> ç±»</span></a></h3><p><code>net.SocketAddress</code> ç±»å°è£…äº†è¿™äº›ä¿¡æ¯ï¼Œè®©å¼€å‘è€…å¯ä»¥åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­è½»æ¾åœ°è®¿é—®å’Œä½¿ç”¨ç½‘ç»œå¥—æ¥å­—åœ°å€ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªç±»çš„ä¸€äº›å…³é”®å±æ€§ï¼š</p><ul><li><code>address</code>: å­—ç¬¦ä¸²ç±»å‹ï¼Œä»£è¡¨ IP åœ°å€ã€‚</li><li><code>family</code>: å­—ç¬¦ä¸²ç±»å‹ï¼Œä»£è¡¨åœ°å€æ—ï¼Œæ¯”å¦‚ <code>&#39;IPv4&#39;</code> æˆ– <code>&#39;IPv6&#39;</code>ã€‚</li><li><code>port</code>: æ•°å­—ç±»å‹ï¼Œä»£è¡¨ç«¯å£å·ã€‚</li><li><code>flowlabel</code>: å¯¹äº IPv6 åœ°å€ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæµæ ‡ç­¾ï¼›å¯¹äº IPv4 åœ°å€ï¼Œæ­¤å±æ€§ä¸å­˜åœ¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</strong></p><p>åœ¨ Node.js ä¸­ï¼Œä½ å¯èƒ½æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®äº¤æ¢ã€‚æœåŠ¡å™¨ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶å¯¹å…¶åšå‡ºå“åº”ã€‚</p><p><strong>æœåŠ¡å™¨ç«¯ä»£ç ç¤ºä¾‹</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥æ¥è‡ª: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²è¿æ¥åˆ°æœåŠ¡å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> socketAddress</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socketAddress</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, ç«¯å£: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socketAddress</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>client.address()</code> æ–¹æ³•è·å–ä¸€ä¸ª <code>net.SocketAddress</code> å¯¹è±¡ï¼Œç„¶åæ‰“å°å‡ºå®¢æˆ·ç«¯çš„åœ°å€ä¿¡æ¯ã€‚</p></li><li><p><strong>è¯†åˆ«è¿œç¨‹å®¢æˆ·ç«¯ä¿¡æ¯</strong></p><p>åœ¨æ„å»ºç½‘ç»œæœåŠ¡æ—¶ï¼Œäº†è§£è¿æ¥åˆ°ä½ æœåŠ¡ä¸Šçš„å®¢æˆ·ç«¯çš„å…·ä½“ä¿¡æ¯æœ‰æ—¶æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚åˆ©ç”¨ <code>net.SocketAddress</code> ç±»ï¼Œä½ å¯ä»¥å®¹æ˜“åœ°è·å–å¹¶åˆ©ç”¨è¿™äº›ä¿¡æ¯ã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡ <code>socket.remoteAddress</code> å’Œ <code>socket.remotePort</code> è·å–å®¢æˆ·ç«¯çš„ IP åœ°å€å’Œç«¯å£å·ï¼Œå¹¶æ®æ­¤æ‰§è¡Œè¿›ä¸€æ­¥çš„æ“ä½œï¼Œå¦‚æ—¥å¿—è®°å½•ã€å®‰å…¨éªŒè¯ç­‰ã€‚</p></li></ol><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p><code>net.SocketAddress</code> ç±»ä¸º Node.js ä¸­çš„ç½‘ç»œç¼–ç¨‹æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„æ–¹å¼æ¥å¤„ç†ç½‘ç»œå¥—æ¥å­—åœ°å€ã€‚æ— è®ºä½ æ˜¯åœ¨åˆ›å»ºå¤æ‚çš„ç½‘ç»œæœåŠ¡è¿˜æ˜¯ç®€å•çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡åº”ç”¨ï¼Œç†è§£å¹¶èƒ½å¤Ÿæ“ä½œå¥—æ¥å­—åœ°å€éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="new-net-socketaddress-options" tabindex="-1"><a class="header-anchor" href="#new-net-socketaddress-options"><span><a href="https://nodejs.org/docs/latest/api/net.html#new-netsocketaddressoptions" target="_blank" rel="noopener noreferrer">new net.SocketAddress([options])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js çš„ä¼—å¤šç‰¹æ€§ä¸­ï¼Œç½‘ç»œåŠŸèƒ½æ˜¯å…¶æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ã€‚<code>net</code> æ¨¡å—å°±æ˜¯ä¸“é—¨ç”¨äºå¤„ç†ç½‘ç»œç›¸å…³æ“ä½œçš„æ¨¡å—ï¼Œæ¯”å¦‚åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ç½‘ç»œè¿æ¥ã€‚åœ¨ Node.js çš„ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œ<code>net</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°ï¼š<code>new net.SocketAddress([options])</code>ï¼Œè¿™ä¸ªåŠŸèƒ½ä½¿å¾—å¤„ç†ç½‘ç»œåœ°å€å˜å¾—æ›´åŠ çµæ´»å’Œæ–¹ä¾¿ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-new-net-socketaddress-options" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-new-net-socketaddress-options"><span>ä»€ä¹ˆæ˜¯ <code>new net.SocketAddress([options])</code>ï¼Ÿ</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>SocketAddress</code> æ˜¯ä¸€ä¸ªè¡¨ç¤ºç½‘ç»œåœ°å€çš„ç±»ï¼ŒåŒ…æ‹¬ IP åœ°å€å’Œç«¯å£å·ã€‚é€šè¿‡ä½¿ç”¨ <code>new net.SocketAddress([options])</code> æ„é€ å‡½æ•°ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>SocketAddress</code> å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å°è£…äº†ç½‘ç»œåœ°å€çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="å‚æ•°è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š"><span>å‚æ•°è§£é‡Š</span></a></h3><p>å½“ä½ åˆ›å»ºä¸€ä¸ª <code>SocketAddress</code> å®ä¾‹æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>options</code> å¯¹è±¡ä¼ å…¥ä¸€äº›é…ç½®é¡¹ï¼š</p><ul><li><code>port</code>: (å¿…éœ€) ç«¯å£å·ã€‚</li><li><code>address</code>: (å¯é€‰) IP åœ°å€ï¼Œé»˜è®¤ä¸º <code>localhost</code>ã€‚</li><li><code>family</code>: (å¯é€‰) åœ°å€æ—ï¼Œ<code>IPv4</code> æˆ– <code>IPv6</code>ï¼Œé»˜è®¤æ ¹æ® <code>address</code> è‡ªåŠ¨ç¡®å®šã€‚</li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬åœ°æœåŠ¡å™¨çš„-socketaddress" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬åœ°æœåŠ¡å™¨çš„-socketaddress"><span>ç¤ºä¾‹ 1: åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬åœ°æœåŠ¡å™¨çš„ SocketAddress</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¸æœ¬åœ°æœåŠ¡å™¨é€šä¿¡çš„åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>new net.SocketAddress([options])</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬åœ°æœåŠ¡å™¨ï¼ˆå‡è®¾è¿è¡Œåœ¨ç«¯å£ 3000 ä¸Šï¼‰çš„ SocketAddress å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socketAddress</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SocketAddress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  address</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socketAddress</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>SocketAddress</code> å®ä¾‹ï¼Œå®ƒä»£è¡¨äº†æœ¬åœ°æœºå™¨ä¸Šç«¯å£ä¸º 3000 çš„æœåŠ¡å™¨åœ°å€ã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨-socketaddress-è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨-socketaddress-è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨"><span>ç¤ºä¾‹ 2: ä½¿ç”¨ SocketAddress è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨</span></a></h4><p><code>SocketAddress</code> å®ä¾‹ä¹Ÿå¯ä»¥ç”¨äºå»ºç«‹åˆ°è¿œç¨‹æœåŠ¡å™¨çš„è¿æ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦è¿æ¥åˆ°è¿œç¨‹çš„æ•°æ®åº“æœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿œç¨‹æ•°æ®åº“æœåŠ¡å™¨çš„ IP åœ°å€æ˜¯ &quot;192.168.1.10&quot;ï¼Œç«¯å£å·æ˜¯ 5432</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> remoteDbAddress</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SocketAddress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 5432</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  address</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.1.10</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ SocketAddress åˆ›å»ºä¸€ä¸ª socket è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> path</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> remoteDbAddress</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">},</span></span>
<span class="line"><span style="color:#ECEFF4;">  ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to the remote database server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Failed to connect:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªä»£è¡¨è¿œç¨‹æ•°æ®åº“æœåŠ¡å™¨åœ°å€çš„ <code>SocketAddress</code> å®ä¾‹ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªåœ°å€å®ä¾‹å»å»ºç«‹ä¸€ä¸ªåˆ°è¯¥æœåŠ¡å™¨çš„è¿æ¥ã€‚</p><h3 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2"><span>å°ç»“</span></a></h3><p><code>new net.SocketAddress([options])</code> æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ–¹å¼æ¥è¡¨ç¤ºå’Œå¤„ç†ç½‘ç»œåœ°å€ã€‚æ— è®ºæ˜¯è¿æ¥åˆ°æœ¬åœ°æœåŠ¡è¿˜æ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œéƒ½å¯ä»¥é€šè¿‡æ˜ç¡®åœ°åˆ›å»º <code>SocketAddress</code> å®ä¾‹æ¥ç®€åŒ–åœ°å€çš„ç®¡ç†å’Œä½¿ç”¨ã€‚æ­¤å¤–ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥ä½¿ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç†è§£ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ—¶ã€‚</p><h3 id="socketaddress-address" tabindex="-1"><a class="header-anchor" href="#socketaddress-address"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketaddressaddress" target="_blank" rel="noopener noreferrer">socketaddress.address</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œæ¯”å¦‚ <code>net</code> æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—ä¸»è¦ç”¨äºç½‘ç»œæ“ä½œï¼Œæ¯”å¦‚å»ºç«‹æœåŠ¡å™¨ã€å®¢æˆ·ç«¯é€šä¿¡ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>socketAddress.address</code> æ˜¯ <code>net</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºäº†å¥—æ¥å­—ï¼ˆsocketï¼‰è¿æ¥çš„è¿œç¨‹åœ°å€ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ åœ¨ Node.js ä¸­å»ºç«‹ä¸€ä¸ªç½‘ç»œè¿æ¥ï¼ˆæ¯”å¦‚ TCP è¿æ¥ï¼‰æ—¶ï¼Œè¿™ä¸ªè¿æ¥åŒæ–¹ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰éƒ½ä¼šæœ‰ä¸€ä¸ªå¥—æ¥å­—æ¥ä»£è¡¨è¿™ä¸ªè¿æ¥ã€‚æ¯ä¸ªå¥—æ¥å­—éƒ½ç»‘å®šåˆ°ä¸€ä¸ª IP åœ°å€å’Œç«¯å£å·ï¼Œ<code>socketAddress.address</code> å°±æ˜¯ç”¨æ¥è·å–è¿™ä¸ªå¥—æ¥å­—ç»‘å®šçš„ IP åœ°å€ã€‚</p><h3 id="å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨"><span>å®é™…åº”ç”¨</span></a></h3><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£å®ƒçš„ç”¨é€”ï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><h4 id="ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯"><span>ä¾‹å­ 1: åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</span></a></h4><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œç›‘å¬æœ¬åœ°çš„ 12345 ç«¯å£ï¼Œå¹¶ä¸”å½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œæ‰“å°å‡ºå®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚</p><p><strong>æœåŠ¡å™¨ç«¯ä»£ç ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º TCP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œæ‰“å°å‡ºå®¢æˆ·ç«¯çš„ IP åœ°å€</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯åœ°å€ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯ï¼Œè¿æ¥å³å°†å…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 12345...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¢æˆ·ç«¯ä»£ç ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿æ¥åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¥æ”¶åˆ°æ•°æ®æ—¶å¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿æ¥å…³é—­æ—¶å¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸æœåŠ¡å™¨çš„è¿æ¥æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥åï¼Œé€šè¿‡ <code>socket.remoteAddress</code>ï¼ˆå°±æ˜¯å‰æ–‡æåˆ°çš„ socketAddress.address çš„å®é™…ä½¿ç”¨åœºæ™¯ä¹‹ä¸€ï¼‰è·å–å®¢æˆ·ç«¯çš„ IP åœ°å€ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</p><h4 id="ä¾‹å­-2-è·å–æœåŠ¡å™¨è‡ªèº«çš„åœ°å€ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è·å–æœåŠ¡å™¨è‡ªèº«çš„åœ°å€ä¿¡æ¯"><span>ä¾‹å­ 2: è·å–æœåŠ¡å™¨è‡ªèº«çš„åœ°å€ä¿¡æ¯</span></a></h4><p>é™¤äº†è·å–è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯çš„åœ°å€å¤–ï¼Œ<code>socketAddress.address</code> è¿˜å¯ä»¥ç”¨äºè·å–æœåŠ¡å™¨è‡ªèº«ç›‘å¬çš„åœ°å€ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">listening</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> address</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨ç›‘å¬äº </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>server.address()</code> è¿”å›ä¸€ä¸ªåŒ…å«æœåŠ¡å™¨è‡ªèº«ç›‘å¬çš„åœ°å€å’Œç«¯å£çš„å¯¹è±¡ã€‚è¿™å¯¹äºç¡®è®¤æœåŠ¡å™¨ç¡®å®åœ¨é¢„æœŸçš„åœ°å€å’Œç«¯å£ä¸Šç›‘å¬æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä»¥ä¸Šä¾‹å­ï¼Œæˆ‘ä»¬çœ‹åˆ° <code>socketAddress.address</code> åœ¨ Node.js ç½‘ç»œç¼–ç¨‹ä¸­çš„ç”¨é€”éå¸¸å¹¿æ³›ã€‚å®ƒæ—¢å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·å–è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯çš„ IP åœ°å€ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ç¡®è®¤æœåŠ¡å™¨è‡ªå·±çš„åœ°å€ä¿¡æ¯ï¼Œè¿™åœ¨è¿›è¡Œç½‘ç»œæœåŠ¡å¼€å‘æ—¶éå¸¸é‡è¦ã€‚</p><h3 id="socketaddress-family" tabindex="-1"><a class="header-anchor" href="#socketaddress-family"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketaddressfamily" target="_blank" rel="noopener noreferrer">socketaddress.family</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socketaddress.family</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†å…³äºç½‘ç»œå¥—æ¥å­—åœ°å€çš„å®¶æ—ä¿¡æ¯ã€‚ç†è§£è¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬ç‚¹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å¥—æ¥å­—-socket" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å¥—æ¥å­—-socket"><span>ä»€ä¹ˆæ˜¯å¥—æ¥å­—(Socket)?</span></a></h3><p>å¥—æ¥å­—æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ˜¯ç½‘ç»œä¸–ç•Œçš„ç”µè¯æ’åº§ã€‚é€šè¿‡å¥—æ¥å­—ï¼Œè®¡ç®—æœºä¹‹é—´èƒ½å¤Ÿè¿›è¡Œæ•°æ®äº¤æ¢ã€‚æ— è®ºæ˜¯ç½‘é¡µæµè§ˆã€ç”µå­é‚®ä»¶ä¼ è¾“ï¼Œè¿˜æ˜¯å³æ—¶æ¶ˆæ¯å‘é€ï¼ŒèƒŒåéƒ½æœ‰å¥—æ¥å­—åœ¨å·¥ä½œã€‚</p><h3 id="åœ°å€å®¶æ—-address-family" tabindex="-1"><a class="header-anchor" href="#åœ°å€å®¶æ—-address-family"><span>åœ°å€å®¶æ—(Address Family)</span></a></h3><p>åœ°å€å®¶æ—ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åœ°å€çš„ç±»å‹ï¼Œå®ƒå®šä¹‰äº†åœ°å€çš„ç»“æ„å’Œç”¨é€”ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œæœ€å¸¸è§çš„ä¸¤ç§åœ°å€å®¶æ—æ˜¯ï¼š</p><ul><li><strong>IPv4</strong>ï¼šä½¿ç”¨ 32 ä½åœ°å€ã€‚ä¾‹å¦‚ï¼Œ192.168.1.1ã€‚</li><li><strong>IPv6</strong>ï¼šä½¿ç”¨ 128 ä½åœ°å€ï¼Œèƒ½æä¾›æ›´å¤šçš„åœ°å€ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œ2001:0db8:85a3:0000:0000:8a2e:0370:7334ã€‚</li></ul><h3 id="socketaddress-family-åœ¨-node-js-ä¸­çš„è§’è‰²" tabindex="-1"><a class="header-anchor" href="#socketaddress-family-åœ¨-node-js-ä¸­çš„è§’è‰²"><span><code>socketaddress.family</code> åœ¨ Node.js ä¸­çš„è§’è‰²</span></a></h3><p>åœ¨ Node.js çš„<code>net</code>æ¨¡å—ä¸­ï¼Œå½“ä½ åˆ›å»ºæˆ–è€…å¤„ç†ç½‘ç»œå¥—æ¥å­—æ—¶ï¼Œ<code>socketaddress.family</code>å±æ€§ä¼šå‘Šè¯‰ä½ è¿™ä¸ªå¥—æ¥å­—åœ°å€å±äºå“ªä¸ªåœ°å€å®¶æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰ã€‚å…¶å®ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå‘Šè¯‰ç¨‹åºåº”è¯¥å¦‚ä½•è§£é‡Šè¿™ä¸ªå¥—æ¥å­—åœ°å€ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦ä¸å…¶ä»–æœåŠ¡å™¨é€šä¿¡ã€‚ä½ å¯èƒ½éœ€è¦æ ¹æ®ç›®æ ‡æœåŠ¡å™¨æ”¯æŒçš„åè®®ï¼ˆIPv4 æˆ– IPv6ï¼‰æ¥è°ƒæ•´ä½ çš„è¿æ¥è®¾ç½®ã€‚è¿™æ—¶å€™ï¼Œ<code>socketaddress.family</code>å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p><strong>ä¾‹å­ 1ï¼šå»ºç«‹ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</strong></p><ol><li><strong>æœåŠ¡å™¨ä»£ç </strong>ï¼ˆä¿å­˜ä¸º server.jsï¼‰:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥æ¥è‡ª: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, åœ°å€å®¶æ—: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteFamily</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½å®¢æˆ·ç«¯</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨äºï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>å®¢æˆ·ç«¯ä»£ç </strong>ï¼ˆä¿å­˜ä¸º client.jsï¼‰:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä»æœåŠ¡å™¨æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ‰“å°å‡ºå®¢æˆ·ç«¯åœ°å€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ°å€å®¶æ—ï¼ˆ<code>socket.remoteFamily</code>ï¼‰ã€‚ç„¶åï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶å…³é—­è¿æ¥ã€‚</p><p>è¦è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œä½ éœ€è¦åˆ†åˆ«åœ¨ä¸¤ä¸ªå‘½ä»¤è¡Œçª—å£ä¸­å¯åŠ¨æœåŠ¡å™¨(<code>node server.js</code>)å’Œå®¢æˆ·ç«¯(<code>node client.js</code>)ã€‚æ³¨æ„ï¼Œå› ä¸º<code>server.address().port</code>ä¾èµ–äºå½“å‰æœåŠ¡å™¨å®ä¾‹ï¼Œå®¢æˆ·ç«¯ä»£ç é‡Œæ­¤å¤„éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚</p><p>é€šè¿‡è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>socketaddress.family</code>åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„ä½œç”¨ï¼ŒåŠå…¶å¦‚ä½•å¸®åŠ©æˆ‘ä»¬è¯†åˆ«å’Œå¤„ç†ä¸åŒç±»å‹çš„åœ°å€å®¶æ—ã€‚</p><h3 id="socketaddress-flowlabel" tabindex="-1"><a class="header-anchor" href="#socketaddress-flowlabel"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketaddressflowlabel" target="_blank" rel="noopener noreferrer">socketaddress.flowlabel</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚<code>socketaddress.flowlabel</code>æ˜¯ Node.js v21.7.1 çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå±äºç½‘ç»œï¼ˆnetï¼‰æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†ç†è§£è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><h4 id="ip-åœ°å€" tabindex="-1"><a class="header-anchor" href="#ip-åœ°å€"><span>IP åœ°å€</span></a></h4><p>IP åœ°å€æ˜¯äº’è”ç½‘ä¸Šæ¯ä¸ªè®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ã€‚ç›®å‰ä¸»è¦æœ‰ä¸¤ç§ç‰ˆæœ¬ï¼šIPv4 å’Œ IPv6ã€‚</p><h4 id="socket" tabindex="-1"><a class="header-anchor" href="#socket"><span>Socket</span></a></h4><p>Socket æ˜¯ç½‘ç»œé€šä¿¡çš„åŸºçŸ³ï¼Œå¯ä»¥æƒ³è±¡æˆç”µè¯é€šä¿¡ä¸­çš„ç”µè¯æœºã€‚ç¨‹åºé€šè¿‡ Socket å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚</p><h4 id="flow-label" tabindex="-1"><a class="header-anchor" href="#flow-label"><span>Flow Label</span></a></h4><p>Flow Label æ˜¯ IPv6 åœ°å€çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ ‡è¯†æ¥è‡ªåŒä¸€ &quot;æµ&quot; çš„æ•°æ®åŒ…ï¼Œä»¥ä¾¿å¯¹å…¶è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚ä¸€ä¸ª &quot;æµ&quot; å¯ä»¥æ˜¯ä¸€æ¬¡ç½‘ç»œè¯·æ±‚æˆ–è€…ä»»ä½•ä¸€ç»„éœ€è¦ç‰¹åˆ«å¤„ç†çš„æ•°æ®åŒ…ã€‚Flow Label ä½¿å¾—è·¯ç”±å™¨èƒ½å¤Ÿæ›´å®¹æ˜“åœ°è¯†åˆ«å’Œä¼˜å…ˆå¤„ç†æŸäº›æ•°æ®åŒ…ã€‚</p><h3 id="socketaddress-flowlabel-1" tabindex="-1"><a class="header-anchor" href="#socketaddress-flowlabel-1"><span><code>socketaddress.flowlabel</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socketaddress.flowlabel</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å– TCP æˆ– UDP socket çš„ IPv6 flow label å€¼ã€‚è¿™ä¸ªå±æ€§ä»…å½“ä½¿ç”¨ IPv6 åœ°å€æ—¶æœ‰æ•ˆï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„ã€‚</p><h4 id="ä¸ºä»€ä¹ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆé‡è¦"><span>ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</span></a></h4><p>åˆ©ç”¨ Flow Labelï¼Œå¼€å‘è€…å¯ä»¥å®ç°æ›´å¤æ‚çš„ç½‘ç»œåŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>è´¨é‡æœåŠ¡ï¼ˆQoSï¼‰</strong>ï¼šé€šè¿‡æ ‡è¯†ç‰¹å®šæµçš„æ•°æ®åŒ…ï¼Œç½‘ç»œè®¾å¤‡å¯ä»¥ç»™äºˆè¿™äº›æ•°æ®åŒ…é«˜ä¼˜å…ˆçº§å¤„ç†ï¼Œç¡®ä¿è§†é¢‘é€šè¯æˆ–åœ¨çº¿æ¸¸æˆç­‰åº”ç”¨çš„æµç•…è¿è¡Œã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šè¯†åˆ«ç‰¹å®šæµçš„æ•°æ®åŒ…å¯ä»¥å¸®åŠ©æ›´åˆç†åœ°åˆ†é…ç½‘ç»œèµ„æºï¼Œæé«˜æœåŠ¡çš„å¯ç”¨æ€§å’Œå“åº”é€Ÿåº¦ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåœ¨çº¿è§†é¢‘ä¼šè®®ç³»ç»Ÿï¼Œéœ€è¦ç¡®ä¿è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®æµæ‹¥æœ‰è¾ƒé«˜çš„ç½‘ç»œä¼ è¾“è´¨é‡ã€‚</p><ol><li><p><strong>å»ºç«‹è¿æ¥</strong>ï¼š</p><ul><li>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹ IPv6 çš„ TCP/UDP è¿æ¥ã€‚</li></ul></li><li><p><strong>è®¾ç½®å¹¶è·å– Flow Label</strong>ï¼š</p><ul><li>å½“è¿æ¥å»ºç«‹åï¼Œæ“ä½œç³»ç»Ÿæˆ–è€…åº”ç”¨å¯èƒ½ä¼šä¸ºè¿™ä¸ªè¿æ¥è®¾ç½®ä¸€ä¸ª Flow Labelã€‚è™½ç„¶åœ¨ Node.js ä¸­ä¸èƒ½ç›´æ¥è®¾ç½® Flow Labelï¼Œä½†å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æˆ–åè®®ä¸ç½‘ç»œè®¾å¤‡æ²Ÿé€šï¼Œè¦æ±‚å¯¹è¿™ä¸ªæµè¿›è¡Œç‰¹åˆ«å¤„ç†ã€‚</li><li>åœ¨ Node.js åº”ç”¨ä¸­ï¼Œé€šè¿‡ <code>socketaddress.flowlabel</code> æ¥è¯»å–è¿™ä¸ªå€¼ï¼Œä»¥ç¡®è®¤æˆ–è®°å½•è¿™ä¸ªæµè¢«æ­£ç¡®æ ‡è®°ã€‚</li></ul></li><li><p><strong>æ•°æ®ä¼ è¾“</strong>ï¼š</p><ul><li>è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®é€šè¿‡è¿™ä¸ªå·²æ ‡è®°çš„è¿æ¥ä¼ è¾“ã€‚ç½‘ç»œè®¾å¤‡çœ‹åˆ°è¿™ä¸ª Flow Label åï¼ŒæŒ‰ç…§é¢„è®¾çš„è§„åˆ™ï¼ˆå¦‚æä¾›é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰å¤„ç†è¿™äº›æ•°æ®åŒ…ã€‚</li></ul></li><li><p><strong>ç›‘æ§å’Œè°ƒæ•´</strong>ï¼š</p><ul><li>æ ¹æ® <code>socketaddress.flowlabel</code> çš„å€¼ï¼Œå¼€å‘è€…å¯ä»¥å†™å…¥æ—¥å¿—æˆ–è¿›è¡Œè°ƒè¯•ï¼Œä»¥ç¡®ä¿ç½‘ç»œé€šä¿¡çš„è´¨é‡ã€‚å¦‚æœå¿…è¦ï¼Œè¿˜å¯ä»¥ä¸ç½‘ç»œå›¢é˜Ÿåˆä½œï¼Œè°ƒæ•´ç½‘ç»œè®¾å¤‡çš„é…ç½®ï¼Œä»¥ä¼˜åŒ–æ•°æ®æµçš„å¤„ç†ã€‚</li></ul></li></ol><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h3><p><code>socketaddress.flowlabel</code> æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œä½¿å¾— Node.js åº”ç”¨èƒ½å¤Ÿè¯»å–ç½‘ç»œè¿æ¥çš„ IPv6 flow labelï¼Œä»è€Œå¯ä»¥åœ¨æ›´é«˜å±‚æ¬¡ä¸Šç†è§£å’Œä¼˜åŒ–ç½‘ç»œé€šä¿¡ã€‚å°½ç®¡ç›´æ¥åº”ç”¨çš„åœºæ™¯å¯èƒ½ä¸å¤šï¼Œä½†åœ¨æ„å»ºéœ€è¦é«˜è´¨é‡ç½‘ç»œæœåŠ¡çš„åº”ç”¨æ—¶ï¼Œè¿™ä¸ªç‰¹æ€§æ— ç–‘æ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚</p><h3 id="socketaddress-port" tabindex="-1"><a class="header-anchor" href="#socketaddress-port"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketaddressport" target="_blank" rel="noopener noreferrer">socketaddress.port</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript çš„å¹³å°ã€‚<code>net</code> æ¨¡å—æ˜¯ Node.js æä¾›çš„ç”¨äºåº•å±‚ç½‘ç»œé€šä¿¡çš„æ¨¡å—ï¼Œå®ƒåŒ…å«äº†åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆé€šè¿‡ TCP æˆ– IPCï¼‰çš„èƒ½åŠ›ã€‚</p><p>åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­ï¼Œ<code>socketaddress.port</code> æ˜¯æŒ‡åœ¨ç”¨ <code>net</code> æ¨¡å—è¿›è¡Œç½‘ç»œç¼–ç¨‹æ—¶ï¼Œä¸ä¸€ä¸ª socket ç›¸å…³è”çš„ç«¯å£å·ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª &quot;socket&quot; å¯ä»¥è¢«çœ‹ä½œæ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªç«¯ç‚¹ï¼Œé€šè¿‡è¿™ä¸ªç«¯ç‚¹å¯ä»¥å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚è€Œç«¯å£å·åˆ™æ˜¯è¯¥ç«¯ç‚¹çš„å…·ä½“æ•°å­—æ ‡è¯†ï¼Œç”¨æ¥åŒºåˆ†ä¸€å°è®¡ç®—æœºä¸Šçš„ä¸åŒæœåŠ¡æˆ–åº”ç”¨ç¨‹åºã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-6"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºéœ€è¦æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚æœåŠ¡å™¨ä¼šåœ¨ç‰¹å®šçš„ç«¯å£ä¸Šç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Node.js çš„ <code>net</code> æ¨¡å—æ¥åˆ›å»ºè¿™æ ·çš„æœåŠ¡å™¨å°±å¾ˆæœ‰æ„ä¹‰ã€‚</p><h4 id="æœåŠ¡å™¨ç«¯ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å™¨ç«¯ç¤ºä¾‹ä»£ç "><span>æœåŠ¡å™¨ç«¯ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“æ”¶åˆ°æ•°æ®æ—¶ï¼Œæ‰“å°å‡ºæ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶æç¤º</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘é€ä¸€æ¡æ¶ˆæ¯ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ°æˆ‘çš„æœåŠ¡å™¨!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬12345ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨åœ¨12345ç«¯å£ä¸Šç›‘å¬</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç "><span>å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿æ¥åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼ŒæœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ–­å¼€è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä»æœåŠ¡å™¨æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ <code>net.createServer()</code> æ–¹æ³•åˆ›å»ºï¼Œå¹¶åœ¨ç«¯å£ <code>12345</code> ä¸Šç›‘å¬è¿æ¥ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ <code>net.connect()</code> æ–¹æ³•è¿æ¥åˆ°æœåŠ¡å™¨å¹¶ä½¿ç”¨ç›¸åŒçš„ç«¯å£æ—¶ï¼Œä¸¤è€…ä¹‹é—´å°±å»ºç«‹äº†é€šä¿¡ã€‚éšåå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥äº’ç›¸å‘é€æ¶ˆæ¯ã€‚</p><p>åœ¨æœåŠ¡å™¨ç«¯çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>socket.address().port</code> è·å–å½“å‰ socket æ­£åœ¨ä½¿ç”¨çš„ç«¯å£å·ã€‚è¿™åœ¨å¤šç«¯å£ç›‘å¬æˆ–æ—¥å¿—è®°å½•ç­‰åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨åœ¨</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#ECEFF4;">().</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">ç«¯å£ä¸Šç›‘å¬</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†è¾“å‡ºç±»ä¼¼äº &quot;æœåŠ¡å™¨åœ¨ 12345 ç«¯å£ä¸Šç›‘å¬&quot; çš„ä¿¡æ¯ï¼Œè¡¨ç¤ºå½“å‰æœåŠ¡å™¨ç›‘å¬çš„ç¡®åˆ‡ç«¯å£å·ã€‚</p><h2 id="class-net-server" tabindex="-1"><a class="header-anchor" href="#class-net-server"><span><a href="https://nodejs.org/docs/latest/api/net.html#class-netserver" target="_blank" rel="noopener noreferrer">Class: net.Server</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚<code>net.Server</code> ç±»æ˜¯ Node.js çš„ä¸€éƒ¨åˆ†ï¼Œä½äº <code>net</code> æ¨¡å—ä¹‹ä¸­ï¼Œè¿™ä¸ªæ¨¡å—æä¾›äº†å¼‚æ­¥ç½‘ç»œ APIï¼Œç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC çš„æœåŠ¡å™¨ (<code>net.Server</code>) å’Œå®¢æˆ·ç«¯ (<code>net.Socket</code>)ã€‚</p><h3 id="net-server-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#net-server-ç®€ä»‹"><span>net.Server ç®€ä»‹</span></a></h3><p><code>net.Server</code> æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºç½‘ç»œæœåŠ¡å™¨çš„ç±»ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªå®ä¾‹åŒ–çš„ <code>net.Server</code> å¯¹è±¡æ—¶ï¼Œä½ å°±åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥ç›‘å¬ç«¯å£ã€è·¯å¾„æˆ–å¥æŸ„çš„æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ç½‘ç»œè¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¯ä»¥è¯»å–è¯·æ±‚æ•°æ®å¹¶å“åº”ã€‚</p><h3 id="åˆ›å»º-net-server-å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-net-server-å®ä¾‹"><span>åˆ›å»º net.Server å®ä¾‹</span></a></h3><p>è¦ä½¿ç”¨ <code>net.Server</code>ï¼Œä½ é¦–å…ˆéœ€è¦å¼•å…¥ <code>net</code> æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>net.createServer()</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨æ¯æ¬¡æœ‰æ–°çš„è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä»å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ°æˆ‘çš„æœåŠ¡å™¨!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç›‘å¬ç«¯å£å’Œå¯åŠ¨æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬ç«¯å£å’Œå¯åŠ¨æœåŠ¡å™¨"><span>ç›‘å¬ç«¯å£å’Œå¯åŠ¨æœåŠ¡å™¨</span></a></h3><p>åˆ›å»ºæœåŠ¡å™¨å®ä¾‹åï¼Œä½ éœ€è¦å‘Šè¯‰æœåŠ¡å™¨ç›‘å¬å“ªä¸ªç«¯å£æˆ–è·¯å¾„ã€‚è¿™å¯ä»¥é€šè¿‡è°ƒç”¨ <code>server.listen()</code> æ–¹æ³•æ¥å®Œæˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æ­¤æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:8080</code>ï¼‰ï¼ŒæœåŠ¡å™¨å°±ä¼šæ¥æ”¶åˆ°è¿™ä¸ªè¿æ¥ï¼Œæ‰§è¡Œä¸Šé¢æä¾›çš„å›è°ƒå‡½æ•°ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>æ­å»ºä¸€ä¸ªç®€å•çš„å›å£°æœåŠ¡</strong>ï¼šæœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„ä»»ä½•æ•°æ®ï¼Œç„¶åå°†ç›¸åŒçš„æ•°æ®å‘é€å›å®¢æˆ·ç«¯ã€‚</p></li><li><p><strong>æ„å»ºä¸€ä¸ªèŠå¤©æœåŠ¡å™¨</strong>ï¼šå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶ä¸”æœåŠ¡å™¨å°†ä»»ä½•å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯è½¬å‘ç»™æ‰€æœ‰å…¶ä»–è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œå®ç°ç¾¤èŠåŠŸèƒ½ã€‚</p></li><li><p><strong>æ–‡ä»¶ä¼ è¾“æœåŠ¡</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œä¸Šä¼ æˆ–ä¸‹è½½æ–‡ä»¶ã€‚æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å¤„ç†æ–‡ä»¶å­˜å‚¨æˆ–æ£€ç´¢ã€‚</p></li></ol><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>é”™è¯¯å¤„ç†ï¼šç¡®ä¿å¯¹æœåŠ¡å™¨å’Œæ¯ä¸ªè¿æ¥è¿›è¡Œé€‚å½“çš„é”™è¯¯ç›‘å¬ï¼Œä»¥é¿å…ç¨‹åºå´©æºƒã€‚</li><li>å®‰å…¨è€ƒè™‘ï¼šå½“å¤„ç†æ¥è‡ªæœªçŸ¥æ¥æºçš„è¿æ¥å’Œæ•°æ®æ—¶ï¼Œå§‹ç»ˆæ ¼å¤–å°å¿ƒï¼Œå°½å¯èƒ½ä½¿ç”¨åŠ å¯†è¿æ¥ï¼ˆå¦‚ TLS/SSLï¼‰ã€‚</li></ul><p><code>net.Server</code> æ˜¯ Node.js ä¸­éå¸¸å¼ºå¤§çš„ä¸€ä¸ªç±»ï¼Œå®ƒä¸ºå¼€å‘å„ç§ç±»å‹çš„ç½‘ç»œæœåŠ¡å’Œåè®®æä¾›äº†åŸºç¡€ã€‚ç†è§£å…¶å·¥ä½œåŸç†å’Œå¦‚ä½•ä½¿ç”¨æ˜¯æˆä¸º Node.js ç½‘ç»œç¼–ç¨‹é«˜æ‰‹çš„å…³é”®ç¬¬ä¸€æ­¥ã€‚</p><h3 id="new-net-server-options-connectionlistener" tabindex="-1"><a class="header-anchor" href="#new-net-server-options-connectionlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#new-netserveroptions-connectionlistener" target="_blank" rel="noopener noreferrer">new net.Server([options][, connectionListener])</a></span></a></h3><p>Node.js ä¸­çš„ <code>net.Server</code> æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒç”¨äºåˆ›å»ºä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ã€‚è¿™ä¸ªæœåŠ¡å™¨å¯ä»¥æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®é€šä¿¡ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>new net.Server([options][, connectionListener])</code> å°±æ˜¯åˆ›å»ºè¿™æ ·ä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹çš„æ„é€ å‡½æ•°ã€‚</p><p>è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹æ„é€ å‡½æ•°å‚æ•°ï¼š</p><ul><li><p><code>options</code>ï¼ˆå¯é€‰ï¼‰: ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡æ¥é…ç½®æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®¾ç½® <code>allowHalfOpen</code> å±æ€§ï¼Œå½“å®ƒä¸º true æ—¶ï¼ŒæœåŠ¡å™¨å…è®¸åŠå¼€çš„ TCP è¿æ¥ï¼Œå³ä¸éœ€è¦è¿æ¥çš„ä¸¤ç«¯åŒæ—¶æ‰“å¼€å’Œå…³é—­ã€‚</p></li><li><p><code>connectionListener</code>ï¼ˆå¯é€‰ï¼‰: ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡æœ‰æ–°çš„è¿æ¥å»ºç«‹æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œ<code>socket</code>ï¼Œä»£è¡¨æ–°è¿æ¥çš„ socket å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ª socket ä¸å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</p></li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä¸¾å‡ ä¸ªç®€å•çš„ä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£ <code>net.Server</code> çš„å®é™…åº”ç”¨ï¼š</p><p><strong>ä¾‹å­ 1</strong>: åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP echo æœåŠ¡å™¨ï¼Œå®ƒå°†æ”¶åˆ°çš„ä»»ä½•æ•°æ®åŸæ ·å‘é€å›å®¢æˆ·ç«¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“æ”¶åˆ°æ•°æ®æ—¶ï¼Œå°†å…¶å›å‘ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶ï¼Œæ‰“å°æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 8080 ç«¯å£ä¸Šçš„è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 2</strong>: åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥æ¥å—å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¹¶å‘æ¯ä¸ªæ–°è¿æ¥å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨å¹¶æŒ‡å®šæ¬¢è¿ä¿¡æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> allowHalfOpen</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–°å®¢æˆ·ç«¯è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ°æˆ‘çš„æœåŠ¡å™¨ï¼</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€æ¬¢è¿æ¶ˆæ¯åç«‹å³å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£ 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œ<code>createServer</code> æ–¹æ³•éƒ½è¢«ç”¨äºåˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ã€‚åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç®€å•åœ°å›æ˜¾ï¼ˆechoï¼‰æ”¶åˆ°çš„ä»»ä½•æ•°æ®ã€‚åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨å‘é€æ¬¢è¿æ¶ˆæ¯å¹¶å…³é—­è¿æ¥ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>net.Server</code> æ˜¯ Node.js ä¸­å¤„ç†åº•å±‚ç½‘ç»œé€šä¿¡çš„åŸºç¡€ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿå»ºç«‹ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼Œå¹¶å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚å’Œæ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚é€šè¿‡ä¼ å…¥ä¸åŒçš„é€‰é¡¹å’Œç›‘å¬å™¨ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦å®šåˆ¶æœåŠ¡å™¨çš„è¡Œä¸ºã€‚</p><h3 id="event-close" tabindex="-1"><a class="header-anchor" href="#event-close"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-close" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;close&#39;</code> äº‹ä»¶æ˜¯åœ¨ç‰¹å®šå¯¹è±¡ï¼Œæ¯”å¦‚ç½‘ç»œè¿æ¥ï¼ˆnet æ¨¡å—ä¸­çš„ Socket å¯¹è±¡ï¼‰æˆ–æ–‡ä»¶æµï¼ˆfs æ¨¡å—ä¸­çš„ Stream å¯¹è±¡ï¼‰ç­‰ï¼Œç»“æŸæˆ–å…³é—­æ—¶è§¦å‘çš„ã€‚è¿™ä¸ªäº‹ä»¶çš„è§¦å‘æ„å‘³ç€å¯¹è±¡ä¸å†å¯ç”¨ï¼Œå·²ç»å½»åº•å…³é—­ï¼Œä¸ä¼šå†æœ‰æ•°æ®å‘é€æˆ–æ¥æ”¶ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶çš„è¡Œä¸ºå’Œå®šä¹‰å¯èƒ½ä¸ä¹‹å‰çš„ç‰ˆæœ¬æœ‰æ‰€ä¸åŒï¼Œä½†åŸºæœ¬æ¦‚å¿µæ˜¯ä¸€è‡´çš„ã€‚ä¸‹é¢æˆ‘ä¼šç”¨å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ <code>Event: &#39;close&#39;</code> çš„è¿ç”¨ã€‚</p><h3 id="å®ä¾‹-1-ç½‘ç»œæœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-ç½‘ç»œæœåŠ¡å™¨"><span>å®ä¾‹ 1: ç½‘ç»œæœåŠ¡å™¨</span></a></h3><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å®Œæˆæ‰€æœ‰è¯·æ±‚å¤„ç†ååº”è¯¥å…³é—­ã€‚å½“æœåŠ¡å™¨å…³é—­æ—¶ï¼Œä¼šè§¦å‘ <code>&#39;close&#39;</code> äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is now closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨æŸä¸ªæ¡ä»¶ä¸‹ä½ æƒ³å…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ä½ è°ƒç”¨ <code>server.close()</code> æ–¹æ³•æ—¶ï¼ŒæœåŠ¡å™¨å°†åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œå½“å‰å¤„ç†çš„è¯·æ±‚å®Œæˆåï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶å°†è¢«è§¦å‘ï¼Œç„¶åæ‰“å°å‡º <code>&#39;Server is now closed.&#39;</code>ã€‚</p><h3 id="å®ä¾‹-2-æ–‡ä»¶æµ" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-æ–‡ä»¶æµ"><span>å®ä¾‹ 2: æ–‡ä»¶æµ</span></a></h3><p>åœ¨å¤„ç†æ–‡ä»¶æ—¶ï¼Œæ¯”å¦‚è¯»å–æˆ–å†™å…¥æ–‡ä»¶å®Œæˆåï¼Œå¯ä»¥ç›‘å¬ <code>&#39;close&#39;</code> äº‹ä»¶æ¥ç¡®è®¤æ–‡ä»¶æµå·²ç»è¢«å…³é—­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File stream closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">length</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> bytes of data.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">There will be no more data.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fs.createReadStream</code> ç”¨äºåˆ›å»ºä¸€ä¸ªè¯»å–æµæ¥è¯»å– &#39;example.txt&#39; æ–‡ä»¶çš„å†…å®¹ã€‚å½“æ–‡ä»¶å†…å®¹è¢«å®Œå…¨è¯»å–åï¼Œ<code>&#39;end&#39;</code> äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œè€Œå½“æµè¢«å…³é—­æ—¶ï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶åˆ™ä¼šè¢«è§¦å‘ï¼Œè¡¨ç¤ºæ–‡ä»¶å·²ç»è¢«å®Œå…¨å¤„ç†å®Œæ¯•ã€‚</p><p>è¿™ä¸¤ä¸ªä¾‹å­å±•ç¤ºäº† <code>&#39;close&#39;</code> äº‹ä»¶åœ¨ä¸åŒæƒ…å¢ƒä¸‹çš„åº”ç”¨ã€‚åœ¨ç½‘ç»œç¼–ç¨‹å’Œæ–‡ä»¶å¤„ç†ä¸­ï¼Œæ­£ç¡®åœ°ç›‘å¬å’Œå¤„ç† <code>&#39;close&#39;</code> äº‹ä»¶æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ ç¡®ä¿èµ„æºè¢«é€‚å½“åœ°æ¸…ç†å’Œé‡Šæ”¾ã€‚</p><h3 id="event-connection" tabindex="-1"><a class="header-anchor" href="#event-connection"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-connection" target="_blank" rel="noopener noreferrer">Event: &#39;connection&#39;</a></span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;connection&#39;</code> æ˜¯ <code>net</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªäº‹ä»¶ï¼Œä¸»è¦ç”¨äº TCP æœåŠ¡å™¨ã€‚å½“ä¸€ä¸ªæ–°çš„è¿æ¥è¢«å»ºç«‹æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«è§¦å‘ã€‚è¿™ä¸ªæœºåˆ¶ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¯¹æ¯ä¸ªæ–°çš„è¿æ¥è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚è¯»å–å’Œå†™å…¥æ•°æ®ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ"><span>å¦‚ä½•å·¥ä½œ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨éå¸¸ç®€å•ã€‚å½“ä½ åˆ›å»ºäº†æœåŠ¡å™¨åï¼Œä½ å¯ä»¥ç›‘å¬ <code>connection</code> äº‹ä»¶æ¥å¤„ç†æ–°çš„ç½‘ç»œè¿æ¥ã€‚è¿™ä¸ªäº‹ä»¶æ¯å½“æœ‰æ–°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶éƒ½ä¼šè§¦å‘ï¼Œäº‹ä»¶çš„å›è°ƒå‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª <code>net.Socket</code> å®ä¾‹ï¼Œä»£è¡¨ç€è¿™ä¸ªæ–°çš„è¿æ¥ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-7"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨-1" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨-1"><span>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨</span></a></h4><p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„ 3000 ç«¯å£ã€‚å½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨ä¼šé€šè¿‡ <code>connection</code> äº‹ä»¶æ”¶åˆ°é€šçŸ¥ï¼Œå¹¶å‘é€ä¸€æ¡æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥æˆåŠŸã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ° Node.js æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®æ—¶ï¼Œæ‰“å°å‡ºæ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶çš„å¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#_2-å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡"><span>2. å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡</span></a></h4><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ <code>socket.write</code> å‘è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒ TCP è¿æ¥çš„å·¥å…·æˆ–åº“æ¥è¿æ¥åˆ°æ­¤æœåŠ¡å™¨ã€‚å½“è¿æ¥å»ºç«‹åï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€æ¬¢è¿æ¶ˆæ¯ï¼Œå¹¶èƒ½æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€‚</p><h4 id="_3-ç›‘å¬å’Œå¤„ç†è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_3-ç›‘å¬å’Œå¤„ç†è¿æ¥"><span>3. ç›‘å¬å’Œå¤„ç†è¿æ¥</span></a></h4><p>é€šè¿‡ç›‘å¬ <code>connection</code> äº‹ä»¶ï¼Œä½ å¯ä»¥å¯¹æ¯ä¸ªæ–°çš„è¿æ¥æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œæ¯”å¦‚èº«ä»½éªŒè¯ã€æ•°æ®å¤„ç†æˆ–è€…æ—¥å¿—è®°å½•ã€‚è¿™ç»™äº†å¼€å‘è€…å¾ˆå¤§çš„çµæ´»æ€§ï¼Œèƒ½å¤Ÿæ ¹æ®åº”ç”¨çš„éœ€è¦æ¥å®šåˆ¶å¤„ç†é€»è¾‘ã€‚</p><h3 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;connection&#39;</code> æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¥å£æ¥å¤„ç† TCP ç½‘ç»œè¿æ¥ã€‚é€šè¿‡è¿™ä¸ªäº‹ä»¶ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°æ„å»ºç½‘ç»œåº”ç”¨ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨ã€å®¢æˆ·ç«¯-æœåŠ¡å™¨åº”ç”¨ç¨‹åºç­‰ã€‚ä¸Šé¢çš„ä¾‹å­åªæ˜¯å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªäº‹ä»¶æ¥åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ TCP æœåŠ¡å™¨ï¼Œä½†å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•å’Œæ·±åŒ–è¿™ä¸ªåŸºç¡€ã€‚</p><h3 id="event-error" tabindex="-1"><a class="header-anchor" href="#event-error"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-error" target="_blank" rel="noopener noreferrer">Event: &#39;error&#39;</a></span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;error&#39;</code> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç½‘ç»œæ“ä½œå’Œæµï¼ˆstreamsï¼‰æ—¶ã€‚è¿™ä¸ªäº‹ä»¶ç”¨äºæ•è·å’Œå¤„ç†é”™è¯¯ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒå¹¶æä¾›æ›´ä¼˜é›…çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚æˆ‘å°†é€šè¿‡ä»‹ç»ã€è§£é‡Šä»¥åŠæä¾›å®é™…ç¤ºä¾‹çš„æ–¹å¼ï¼Œå¸®åŠ©ä½ ç†è§£è¿™ä¸€æ¦‚å¿µã€‚</p><h3 id="åŸºç¡€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ä»‹ç»"><span>åŸºç¡€ä»‹ç»</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½æ˜¯ &quot;EventEmitter&quot; çš„å®ä¾‹ï¼Œå¯ä»¥å¹¿æ’­ï¼ˆemitï¼‰äº‹ä»¶ï¼ŒåŒ…æ‹¬æ ‡å‡†åº“ä¸­çš„å¾ˆå¤šæ¨¡å—ï¼Œæ¯”å¦‚ <code>http</code>, <code>net</code>, <code>fs</code> ç­‰ã€‚å½“è¿™äº›å¯¹è±¡é‡åˆ°é—®é¢˜æ—¶ï¼Œä»–ä»¬ä¼šå‘å‡ºï¼ˆemitï¼‰ä¸€ä¸ª &#39;error&#39; äº‹ä»¶ã€‚</p><p>å¦‚æœè¿™ä¸ª &#39;error&#39; äº‹ä»¶æ²¡æœ‰è¢«ç›‘å¬ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼‰ï¼Œé‚£ä¹ˆ Node.js å°†ä¼šæ‰“å°å †æ ˆè·Ÿè¸ªä¿¡æ¯åˆ° stderrï¼Œå¹¶ä¸”ç«‹å³ç»ˆæ­¢è¿›ç¨‹ã€‚è¿™æ ·çš„è®¾è®¡å¼ºè¿«å¼€å‘è€…å»å¤„ç†å¯èƒ½çš„é”™è¯¯ï¼Œä½¿å¾—ä»£ç æ›´åŠ å¥å£®ã€‚</p><h3 id="å®é™…è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨"><span>å®é™…è¿ç”¨</span></a></h3><h4 id="ç¤ºä¾‹-1-ä½¿ç”¨-net-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ä½¿ç”¨-net-æ¨¡å—"><span>ç¤ºä¾‹ 1ï¼šä½¿ç”¨ net æ¨¡å—</span></a></h4><p><code>net</code> æ¨¡å—å…è®¸ä½ åˆ›å»ºåŸºäº TCP/IPC çš„æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ã€‚å½“ç½‘ç»œæ“ä½œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æ—¶ï¼ˆä¾‹å¦‚è¿æ¥å¤±è´¥ï¼‰ï¼Œ&#39;error&#39; äº‹ä»¶ä¼šè¢«è§¦å‘ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­¤å¤„å¤„ç†æ¯ä¸ªè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server error:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨é‡åˆ°é”™è¯¯ï¼ˆæ¯”å¦‚ç«¯å£å·²ç»è¢«å ç”¨ï¼‰ï¼Œ&#39;error&#39; äº‹ä»¶å°†ä¼šè¢«è§¦å‘ï¼Œå¹¶ä¸”é€šè¿‡ <code>console.error</code> æ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯è®©æ•´ä¸ªè¿›ç¨‹å´©æºƒã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨-fs-æ¨¡å—è¯»å–æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨-fs-æ¨¡å—è¯»å–æ–‡ä»¶"><span>ç¤ºä¾‹ 2ï¼šä½¿ç”¨ fs æ¨¡å—è¯»å–æ–‡ä»¶</span></a></h4><p><code>fs</code> æ¨¡å—ç”¨äºæ–‡ä»¶æ“ä½œã€‚å½“è¯»å–æ–‡ä»¶å‡ºç°é—®é¢˜æ—¶ï¼ˆä¾‹å¦‚æ–‡ä»¶ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ç›‘å¬ &#39;error&#39; äº‹ä»¶æ¥å¤„ç†é”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> rs</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">rs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cannot read file:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œ&#39;error&#39; äº‹ä»¶éšå³è¢«è§¦å‘ï¼Œå¹¶ä¸”é€šè¿‡ <code>console.error</code> æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œé¿å…äº†ç¨‹åºçš„å´©æºƒã€‚</p><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæ­£ç¡®åœ°å¤„ç† &#39;error&#39; äº‹ä»¶æ˜¯éå¸¸é‡è¦çš„ã€‚å®ƒä¸ä»…ä»…æ˜¯å…³äºé¿å…ç¨‹åºå´©æºƒé‚£ä¹ˆç®€å•ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå…è®¸ä½ å¯¹é”™è¯¯è¿›è¡Œæ°å½“çš„å¤„ç†ï¼Œæ¯”å¦‚é‡è¯•æ“ä½œã€èµ„æºæ¸…ç†ã€å‘ç”¨æˆ·æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æ¶ˆæ¯ç­‰ã€‚é€šè¿‡ç›‘å¬å’Œå¤„ç† &#39;error&#39; äº‹ä»¶ï¼Œä½ çš„åº”ç”¨å˜å¾—æ›´åŠ å¥å£®å’Œå¯é ã€‚</p><h3 id="event-listening" tabindex="-1"><a class="header-anchor" href="#event-listening"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-listening" target="_blank" rel="noopener noreferrer">Event: &#39;listening&#39;</a></span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;listening&#39;</code> äº‹ä»¶æ˜¯åœ¨ç½‘ç»œç¼–ç¨‹ä¸­éå¸¸å®ç”¨çš„ä¸€ä¸ªç‰¹æ€§ã€‚å½“ä½ ä½¿ç”¨ Node.js å»ºç«‹æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å¼€å§‹ç›‘å¬ç½‘ç»œç«¯å£ä¸Šçš„è¿æ¥è¯·æ±‚çš„é‚£ä¸€åˆ»ï¼Œ<code>&#39;listening&#39;</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚è¿™å¯¹äºç¡®è®¤æœåŠ¡å™¨å·²ç»å‡†å¤‡å¥½æ¥å—è¿æ¥éå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="ç®€å•ç†è§£" tabindex="-1"><a class="header-anchor" href="#ç®€å•ç†è§£"><span>ç®€å•ç†è§£</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ä½ å¼€äº†ä¸€å®¶åº—ï¼ŒæŠŠå¼€é—¨è¥ä¸šçš„ç¬é—´å‘Šè¯‰ç­‰åœ¨é—¨å¤–çš„é¡¾å®¢ï¼Œè¿™æ ·ä»–ä»¬å°±çŸ¥é“å¯ä»¥è¿›æ¥äº†ã€‚åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼Œ<code>&#39;listening&#39;</code> äº‹ä»¶å°±ç›¸å½“äºä½ å‘Šè¯‰é¡¾å®¢â€œé—¨å·²ç»å¼€äº†ï¼Œæ¬¢è¿è¿›å…¥â€ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-1"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>http</code> æˆ– <code>net</code> æ¨¡å—æ¥åšè¿™ä»¶äº‹ã€‚åˆ›å»ºæœåŠ¡å™¨åï¼Œä½ ä¼šç”¨åˆ° <code>.listen()</code> æ–¹æ³•æ¥æŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ã€‚<code>.listen()</code> æ–¹æ³•è°ƒç”¨ä¹‹åï¼ŒæœåŠ¡å™¨å°±å¼€å§‹ç›‘å¬è¿™ä¸ªç«¯å£ã€‚å½“å®ƒçœŸæ­£å¼€å§‹ç›‘å¬æ—¶ï¼Œå°±ä¼šè§¦å‘ <code>&#39;listening&#39;</code> äº‹ä»¶ã€‚</p><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Node.js <code>http</code> æ¨¡å—åˆ›å»º HTTP æœåŠ¡å™¨çš„ç®€å•ç¤ºä¾‹ã€‚è¿™ä¸ªæœåŠ¡å™¨ä¼šåœ¨ 3000 ç«¯å£ç›‘å¬è¯·æ±‚ï¼Œå½“ <code>&#39;listening&#39;</code> äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨æ§åˆ¶å°ä¸­æ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£æ—¶ï¼Œä¼šè§¦å‘ &#39;listening&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">listening</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The server is ready to accept connections!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>http</code> æ¨¡å—ï¼Œç„¶åä½¿ç”¨ <code>http.createServer()</code> åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨ã€‚æœåŠ¡å™¨ä¼šå“åº”æ‰€æœ‰å‘é€åˆ°è¯¥æœåŠ¡å™¨çš„ HTTP è¯·æ±‚ã€‚æ¥ç€ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>server.listen(3000, &#39;127.0.0.1&#39;)</code> è®©æœåŠ¡å™¨å¼€å§‹ç›‘å¬æœ¬åœ°ä¸»æœºï¼ˆ127.0.0.1ï¼‰ä¸Šçš„ 3000 ç«¯å£ã€‚<code>server.on(&#39;listening&#39;, callback)</code> æ˜¯æˆ‘ä»¬ç›‘å¬ <code>&#39;listening&#39;</code> äº‹ä»¶çš„æ–¹å¼ï¼Œä¸€æ—¦æœåŠ¡å™¨å¼€å§‹ç›‘å¬ï¼Œæˆ‘ä»¬å°±åœ¨æ§åˆ¶å°è¾“å‡ºä¸€æ¡æ¶ˆæ¯ã€‚</p><h3 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯"><span>åº”ç”¨åœºæ™¯</span></a></h3><ul><li><strong>å¯åŠ¨ç¡®è®¤</strong>ï¼šåœ¨å¼€å‘ä¸­ï¼Œä½¿ç”¨ <code>&#39;listening&#39;</code> äº‹ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æˆåŠŸå¯åŠ¨ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­ç»™å‡ºåé¦ˆã€‚</li><li><strong>åŠ¨æ€ç«¯å£åˆ†é…</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šè®© Node.js è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ç”¨ç«¯å£è€Œéå›ºå®šç«¯å£ã€‚åœ¨ <code>&#39;listening&#39;</code> äº‹ä»¶çš„å›è°ƒä¸­ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å™¨çš„ <code>address()</code> æ–¹æ³•è·å–å®é™…ç›‘å¬çš„ç«¯å£ä¿¡æ¯ã€‚</li></ul><p>è¿™å°±æ˜¯ <code>&#39;listening&#39;</code> äº‹ä»¶åœ¨ Node.js ä¸­çš„ä½œç”¨å’Œä¸€äº›åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼ã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£å¹¶å¼€å§‹ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼</p><h3 id="event-drop" tabindex="-1"><a class="header-anchor" href="#event-drop"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-drop" target="_blank" rel="noopener noreferrer">Event: &#39;drop&#39;</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>Event: &#39;drop&#39;</code>æ˜¯ä¸€ä¸ªåœ¨ç‰¹å®šåœºæ™¯ä¸‹è§¦å‘çš„äº‹ä»¶ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Node.js çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼ŒåŒ…æ‹¬æœ€æ–°ç‰ˆæœ¬ï¼ˆæˆªè‡³æˆ‘æœ€åæ›´æ–°çš„æ—¶é—´ï¼‰ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æåŠåä¸º<code>&#39;drop&#39;</code>çš„äº‹ä»¶ã€‚é€šå¸¸ï¼ŒNode.js ä¸­çš„äº‹ä»¶ä¸ç½‘ç»œï¼ˆnetï¼‰ã€æ–‡ä»¶ç³»ç»Ÿï¼ˆfsï¼‰ã€æµï¼ˆstreamï¼‰ç­‰æ ¸å¿ƒæ¨¡å—æœ‰å…³ï¼Œç”¨äºå¤„ç†å¦‚è¿æ¥ã€æ•°æ®ä¼ è¾“ã€æ–‡ä»¶è¯»å†™ç­‰å¼‚æ­¥æ“ä½œã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘å¯ä»¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­äº‹ä»¶çš„ä¸€èˆ¬ç”¨æ³•ï¼Œå¹¶ç»™å‡ºä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­ã€‚</p><h3 id="äº‹ä»¶é©±åŠ¨æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶é©±åŠ¨æ¨¡å‹"><span>äº‹ä»¶é©±åŠ¨æ¨¡å‹</span></a></h3><p>Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹çš„ï¼Œè¿™æ„å‘³ç€ Node.js å¯ä»¥ç›‘å¬å’Œè§¦å‘äº‹ä»¶ã€‚è¿™å¯¹äºå¤„ç† IO å¯†é›†å‹æ“ä½œï¼ˆæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰ï¼‰éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸éé˜»å¡ï¼ˆå¼‚æ­¥ï¼‰æ“ä½œï¼Œæé«˜äº†æ€§èƒ½å’Œæ•ˆç‡ã€‚</p><h3 id="ç¤ºä¾‹-ä½¿ç”¨äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-ä½¿ç”¨äº‹ä»¶"><span>ç¤ºä¾‹ï¼šä½¿ç”¨äº‹ä»¶</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ï¼Œæˆ‘ä»¬æƒ³åœ¨æ–°å®¢æˆ·ç«¯è¿æ¥æ—¶è¿›è¡Œä¸€äº›æ“ä½œã€‚åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>net</code>æ¨¡å—ï¼Œå®ƒå…è®¸æˆ‘ä»¬é€šè¿‡äº‹ä»¶æ¥ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æ•°æ®ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨åœ¨8080ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>net.createServer()</code>åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ã€‚æ¯å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œ<code>createServer</code>çš„å›è°ƒå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ª<code>socket</code>å¯¹è±¡ï¼Œç”¨äºä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚æˆ‘ä»¬ç›‘å¬äº†<code>socket</code>ä¸Šçš„<code>data</code>äº‹ä»¶æ¥æ¥æ”¶æ•°æ®ï¼Œå¹¶åœ¨<code>end</code>äº‹ä»¶å‘ç”Ÿæ—¶çŸ¥é“å®¢æˆ·ç«¯æ–­å¼€äº†è¿æ¥ã€‚</p><h3 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h3><p>å°½ç®¡<code>Event: &#39;drop&#39;</code>åœ¨ Node.js å®˜æ–¹æ–‡æ¡£ä¸­å¯èƒ½ä¸å­˜åœ¨æˆ–æ˜¯è¯¯è§£ï¼Œäº†è§£ Node.js çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹åŠå…¶åœ¨ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰é¢†åŸŸçš„åº”ç”¨æ˜¯å¾ˆé‡è¦çš„ã€‚è¿™ç§æ¨¡å‹ä½¿å¾— Node.js åœ¨å¤„ç†å¹¶å‘è¿æ¥å’Œ IO æ“ä½œæ–¹é¢éå¸¸é«˜æ•ˆï¼Œæ˜¯å…¶å¹¿æ³›ç”¨äºæ„å»ºåç«¯æœåŠ¡å’Œ API çš„ä¸€ä¸ªåŸå› ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹å¯¹ä½ ç†è§£ Node.js çš„äº‹ä»¶å’Œå¼‚æ­¥ç¼–ç¨‹æœ‰æ‰€å¸®åŠ©ï¼</p><h3 id="server-address" tabindex="-1"><a class="header-anchor" href="#server-address"><span><a href="https://nodejs.org/docs/latest/api/net.html#serveraddress" target="_blank" rel="noopener noreferrer">server.address()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.address()</code>æ–¹æ³•æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå°¤å…¶æ˜¯åœ¨ä½ å¼€å‘ç½‘ç»œåº”ç”¨æ—¶ã€‚å½“ä½ ä½¿ç”¨ Node.js çš„<code>net</code>æ¨¡å—æˆ–è€…æ›´å¸¸è§çš„<code>http</code>æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œ<code>server.address()</code>æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ è·å–æœåŠ¡å™¨æ­£åœ¨ç›‘å¬çš„ IP åœ°å€å’Œç«¯å£å·ã€‚è¿™ä¸ªä¿¡æ¯å¯¹äºäº†è§£å’Œæ§åˆ¶æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥éå¸¸é‡è¦ã€‚</p><h3 id="ç®€å•è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#ç®€å•è§£é‡Š"><span>ç®€å•è§£é‡Š</span></a></h3><p><code>server.address()</code>è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†<code>address</code>ã€<code>port</code>å’Œ<code>family</code>ä¸‰ä¸ªå­—æ®µï¼š</p><ul><li><code>address</code>ï¼šæœåŠ¡å™¨çš„ IP åœ°å€ã€‚</li><li><code>port</code>ï¼šæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·ã€‚</li><li><code>family</code>ï¼šIP åœ°å€çš„ç‰ˆæœ¬ï¼Œé€šå¸¸æ˜¯ IPv4 æˆ– IPv6ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å®ƒçš„å®é™…åº”ç”¨ã€‚</p><h4 id="ä¾‹å­-1-åˆ›å»ºä¸€ä¸ª-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ª-http-æœåŠ¡å™¨"><span>ä¾‹å­ 1ï¼šåˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> address</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 127.0.0.1:3000ã€‚ä½¿ç”¨<code>server.address()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·å–åˆ°æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ä¿¡æ¯ï¼Œå¹¶æ‰“å°å‡ºæ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æœåŠ¡å™¨åœ¨å“ªé‡Œè¿è¡Œã€‚</p><h4 id="ä¾‹å­-2-è·å–æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è·å–æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯"><span>ä¾‹å­ 2ï¼šè·å–æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯</span></a></h4><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£å·æ¥è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚åŠ¨æ€åœ°æ˜¾ç¤ºæœåŠ¡å™¨åœ°å€æˆ–è€…åŸºäºåœ°å€è¿›è¡Œä¸€äº›é€»è¾‘å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾serveræ˜¯ä¸€ä¸ªå·²ç»åˆ›å»ºå¹¶ç›‘å¬æŸä¸ªç«¯å£çš„æœåŠ¡å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> address</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  `</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">family</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> http://</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨<code>server.address()</code>æ¥è·å–æœåŠ¡å™¨çš„è¯¦ç»†ç›‘å¬ä¿¡æ¯ã€‚<code>address.family</code>å°†å‘Šè¯‰æˆ‘ä»¬æœåŠ¡å™¨ä½¿ç”¨çš„ IP ç‰ˆæœ¬ï¼Œè¿™å¯¹äºå…¼å®¹æ€§å’Œç½‘ç»œé…ç½®å¯èƒ½å¾ˆé‡è¦ã€‚</p><h3 id="å°ç»“-3" tabindex="-1"><a class="header-anchor" href="#å°ç»“-3"><span>å°ç»“</span></a></h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>server.address()</code>æ–¹æ³•åœ¨å¼€å‘è¿‡ç¨‹ä¸­çš„å®ç”¨æ€§ã€‚æ— è®ºæ˜¯åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶ç¡®è®¤ç›‘å¬çš„åœ°å€å’Œç«¯å£ï¼Œè¿˜æ˜¯åœ¨æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦è·å–è¿™äº›ä¿¡æ¯è¿›è¡Œå…¶ä»–æ“ä½œï¼Œ<code>server.address()</code>éƒ½æ˜¯ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„å·¥å…·ã€‚</p><h3 id="server-close-callback" tabindex="-1"><a class="header-anchor" href="#server-close-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverclosecallback" target="_blank" rel="noopener noreferrer">server.close([callback])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè®©ä½ ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚åœ¨ Node.js ä¸­ï¼Œ<code>server.close([callback])</code> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯å½“ä½ åœ¨å¤„ç†ç½‘ç»œæœåŠ¡æˆ–æœåŠ¡å™¨æ—¶ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹ <code>server.close([callback])</code> æ–¹æ³•åšäº†ä»€ä¹ˆï¼š</p><ul><li><p><strong>ä½œç”¨</strong>ï¼šè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯åœæ­¢æœåŠ¡å™¨æ¥å—æ–°çš„è¿æ¥ï¼Œå¹¶ä¿æŒç°æœ‰çš„è¿æ¥ç›´åˆ°å®ƒä»¬ç»“æŸï¼Œç„¶åå…³é—­æœåŠ¡å™¨ã€‚è¿™é€šå¸¸ç”¨äºä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨ï¼Œæ¯”å¦‚åœ¨éœ€è¦å¯¹æœåŠ¡å™¨è¿›è¡Œå‡çº§æˆ–ç»´æŠ¤æ—¶ã€‚</p></li><li><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><strong>callback</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚å½“æœåŠ¡å™¨å…³é—­å®Œæˆåï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚å¦‚æœåœ¨å…³é—­è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªé”™è¯¯å¯¹è±¡ä½œä¸ºå…¶å‚æ•°ã€‚</li></ul></li></ul><h3 id="å®é™…ä½¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä½¿ç”¨ä¾‹å­"><span>å®é™…ä½¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨å¹¶å…³é—­å®ƒ" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨å¹¶å…³é—­å®ƒ"><span>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¹¶å…³é—­å®ƒ</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬åœ¨5ç§’åå†³å®šå…³é—­æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å·²å…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒåœ¨æ¥æ”¶åˆ°è¯·æ±‚åå“åº” &quot;Hello World&quot;ã€‚æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£ 3000ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ª 5 ç§’çš„å®šæ—¶å™¨ï¼Œåœ¨è¿™ 5 ç§’åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>server.close()</code> æ–¹æ³•æ¥å…³é—­æœåŠ¡å™¨ï¼Œä¸€æ—¦æœåŠ¡å™¨å…³é—­ï¼Œå°±ä¼šæ‰“å°å‡º &quot;æœåŠ¡å™¨å·²å…³é—­&quot;ã€‚</p><h4 id="_2-å¤„ç†å…³é—­è¿‡ç¨‹ä¸­çš„é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#_2-å¤„ç†å…³é—­è¿‡ç¨‹ä¸­çš„é”™è¯¯"><span>2. å¤„ç†å…³é—­è¿‡ç¨‹ä¸­çš„é”™è¯¯</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å…³é—­æœåŠ¡å™¨æ—¶å‘ç”Ÿé”™è¯¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æˆåŠŸå…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç é‡Œï¼Œæˆ‘ä»¬ç»™ <code>server.close()</code> æ–¹æ³•æä¾›äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯å‘ç”Ÿï¼šå¦‚æœæœ‰ï¼Œå®ƒå°±ä¼šè®°å½•é”™è¯¯ï¼›å¦‚æœæ²¡æœ‰ï¼Œå®ƒå°±ä¼šæ‰“å°å‡ºâ€œæœåŠ¡å™¨æˆåŠŸå…³é—­â€ã€‚</p><h3 id="å°ç»“-4" tabindex="-1"><a class="header-anchor" href="#å°ç»“-4"><span>å°ç»“</span></a></h3><p>é€šè¿‡ä½¿ç”¨ <code>server.close([callback])</code> æ–¹æ³•ï¼Œä½ å¯ä»¥ä¼˜é›…åœ°å…³é—­ä½ çš„ Node.js æœåŠ¡å™¨ï¼Œç¡®ä¿æ‰€æœ‰å·²ç»å»ºç«‹çš„è¿æ¥éƒ½èƒ½æ­£å¸¸ç»“æŸï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¤„ç†å¯èƒ½å‡ºç°çš„ä»»ä½•é”™è¯¯ã€‚è¿™å¯¹äºç»´æŠ¤å·¥ä½œã€èµ„æºå›æ”¶æˆ–åœ¨æ­£ç¡®çš„æ—¶é—´ç‚¹å®‰å…¨åœ°åœæ­¢æœåŠ¡è‡³å…³é‡è¦ã€‚</p><h3 id="serversymbol-asyncdispose-https-nodejs-org-docs-latest-api-net-html-serversymbolasyncdispose" tabindex="-1"><a class="header-anchor" href="#serversymbol-asyncdispose-https-nodejs-org-docs-latest-api-net-html-serversymbolasyncdispose"><span>[server<a href="">Symbol.asyncDispose</a>](<a href="https://nodejs.org/docs/latest/api/net.html#serversymbolasyncdispose" target="_blank" rel="noopener noreferrer">https://nodejs.org/docs/latest/api/net.html#serversymbolasyncdispose</a>)</span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œè€Œ <code>server[Symbol.asyncDispose]()</code> æ˜¯ Node.js ç‰ˆæœ¬ 21.7.1 ä¸­å¼•å…¥çš„ä¸€ç§æ–°ç‰¹æ€§ï¼Œç”¨äºå¤„ç†æœåŠ¡å™¨èµ„æºçš„å¼‚æ­¥æ¸…ç†ã€‚è¦ç†è§£è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä»å‡ ä¸ªæ–¹é¢æ¥çœ‹ï¼šä»€ä¹ˆæ˜¯ <code>Symbol.asyncDispose</code>ï¼Œå®ƒä¸ºä»€ä¹ˆé‡è¦ï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…ä¸­ä½¿ç”¨å®ƒã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-symbol-asyncdispose" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-symbol-asyncdispose"><span>ä»€ä¹ˆæ˜¯ <code>Symbol.asyncDispose</code></span></a></h3><p>åœ¨ JavaScript ä¸­ï¼Œ<code>Symbol</code> æ˜¯ä¸€ç§åŸå§‹æ•°æ®ç±»å‹ï¼Œç”¨äºåˆ›å»ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚<code>Symbol.asyncDispose</code> æ˜¯ Node.js ç‰¹æœ‰çš„ Symbolï¼Œç”¨ä½œå¯¹è±¡çš„å±æ€§é”®ï¼ŒæŒ‡å‘ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚è¿™ä¸ªå¼‚æ­¥å‡½æ•°çš„èŒè´£æ˜¯åœ¨å¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œæ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-server-symbol-asyncdispose-é‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-server-symbol-asyncdispose-é‡è¦"><span>ä¸ºä»€ä¹ˆ <code>server[Symbol.asyncDispose]()</code> é‡è¦</span></a></h3><p>æœåŠ¡å™¨åº”ç”¨ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šåˆ›å»ºå’Œä½¿ç”¨å„ç§èµ„æºï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥æˆ–è€…ç½‘ç»œè¿æ¥ç­‰ã€‚å½“è¿™äº›èµ„æºä¸å†éœ€è¦æ—¶ï¼Œæ­£ç¡®åœ°å…³é—­å’Œæ¸…ç†è¿™äº›èµ„æºæ˜¯å¾ˆé‡è¦çš„ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€æ–‡ä»¶å¥æŸ„æ³„éœ²æˆ–å…¶ä»–èµ„æºè€—å°½é—®é¢˜ï¼Œå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><p>ä¼ ç»Ÿçš„èµ„æºæ¸…ç†æ–¹æ³•åŒ…æ‹¬æ‰‹åŠ¨å…³é—­è¿æ¥ã€ä½¿ç”¨å›è°ƒå‡½æ•°ç­‰ï¼Œä½†è¿™äº›æ–¹æ³•å¯èƒ½ä½¿ä»£ç å¤æ‚åŒ–ï¼Œéš¾ä»¥ç®¡ç†ã€‚è€Œ <code>server[Symbol.asyncDispose]()</code> æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–ã€ç®€æ´çš„å¼‚æ­¥èµ„æºæ¸…ç†æ–¹æ³•ï¼Œä½¿å¾—èµ„æºæ¸…ç†é€»è¾‘æ›´æ˜“äºç»„ç»‡å’Œç†è§£ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå®ƒå¼€å¯äº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ç”¨äºæ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç®€å•çš„æœåŠ¡å™¨åº”ç”¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨æœåŠ¡å™¨ä¸å†éœ€è¦æ—¶ï¼ˆæ¯”å¦‚ï¼Œåº”ç”¨ç¨‹åºæ­£åœ¨å…³é—­ï¼‰æ‰§è¡Œä¸€äº›å¼‚æ­¥æ¸…ç†æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>server[Symbol.asyncDispose]()</code> åŠŸèƒ½ã€‚é¦–å…ˆï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ªå¼‚æ­¥æ¸…ç†å‡½æ•°å¹¶å°†å…¶èµ‹å€¼ç»™ <code>server[Symbol.asyncDispose]</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">Symbol</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">asyncDispose</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Custom async cleanup operations can be performed here.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥æ”¾ç½®æ¸…ç†é€»è¾‘ï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€‚</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåœ¨åº”ç”¨ç¨‹åºå…³é—­å‰ï¼Œç¡®ä¿è°ƒç”¨æ­¤å¼‚æ­¥æ¸…ç†å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> shutdown</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#D8DEE9;"> server</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">Symbol</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">asyncDispose</span><span style="color:#D8DEE9FF;">]()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is gracefully shut down.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯è§¦å‘åº”ç”¨ç¨‹åºå…³é—­çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#88C0D0;">shutdown</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ä¸å†éœ€è¦æ—¶ï¼Œä¼˜é›…åœ°æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œï¼Œä»è€Œæ›´å¥½åœ°ç®¡ç†æœåŠ¡å™¨èµ„æºï¼Œé¿å…æ½œåœ¨çš„èµ„æºæ³„éœ²é—®é¢˜ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>server[Symbol.asyncDispose]()</code> æ˜¯ Node.js å¼•å…¥çš„ä¸€ç§æ–°æœºåˆ¶ï¼Œç”¨äºä¼˜åŒ–å’Œç®€åŒ–å¼‚æ­¥èµ„æºæ¸…ç†æ“ä½œçš„ç®¡ç†ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œåº”ç”¨çš„ç¨³å®šæ€§ã€‚</p><h3 id="server-getconnections-callback" tabindex="-1"><a class="header-anchor" href="#server-getconnections-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#servergetconnectionscallback" target="_blank" rel="noopener noreferrer">server.getConnections(callback)</a></span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js æ­å»ºæœåŠ¡å™¨æ—¶ï¼Œå¸¸å¸¸éœ€è¦ç®¡ç†å’Œç›‘æ§è¿™ä¸ªæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥ã€‚<code>server.getConnections(callback)</code>å°±æ˜¯ç”¨äºå¸®åŠ©ä½ å®ç°è¿™ä¸ªç›®æ ‡çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><h3 id="ç®€å•è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#ç®€å•è§£é‡Š-1"><span>ç®€å•è§£é‡Š</span></a></h3><p><code>server.getConnections(callback)</code> æ˜¯ Node.js ä¸­ <code>net</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘ä¸ªå®¢æˆ·ç«¯æ­£åœ¨ä¸ä½ çš„æœåŠ¡å™¨ä¿æŒè¿æ¥ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œäº†è§£å¹¶ç®¡ç†è¿™äº›è¿æ¥å¯¹äºèµ„æºç®¡ç†ã€æ€§èƒ½è°ƒä¼˜å’Œå®‰å…¨å¤„ç†éƒ½éå¸¸é‡è¦ã€‚</p><h3 id="å‚æ•°è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯¦è§£"><span>å‚æ•°è¯¦è§£</span></a></h3><ul><li><strong>callback</strong>: å½“<code>getConnections</code>å®Œæˆå…¶ä»»åŠ¡åï¼Œå®ƒä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼ˆå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè¿™é‡Œæ˜¯<code>null</code>ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯è¡¨ç¤ºå½“å‰è¿æ¥æ•°çš„æ•°å­—ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“æœ‰å¤šå°‘ç”¨æˆ·å½“å‰åœ¨çº¿ï¼Œä»¥è°ƒæ•´èµ„æºåˆ†é…æˆ–ä»…ä»…æ˜¯å‡ºäºç›‘æ§ç›®çš„ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç "><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from the server!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ getConnections æ¥æ£€æµ‹å½“å‰çš„è¿æ¥æ•°é‡</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getConnections</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> count</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error getting connections:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Number of concurrent connections to the server: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> count</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬æœ¬åœ°çš„ 3000 ç«¯å£ã€‚æ¯å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯å¹¶å…³é—­è¿æ¥ã€‚é€šè¿‡è°ƒç”¨<code>server.getConnections()</code>ï¼Œæˆ‘ä»¬å¯ä»¥è·å–å¹¶æ‰“å°å½“å‰åˆ°æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°ã€‚</p><p>å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šå®šæœŸè°ƒç”¨<code>server.getConnections()</code>æ¥ç›‘æ§è¿æ¥æ•°çš„å˜åŒ–ï¼Œæˆ–è€…åœ¨ç‰¹å®šäº‹ä»¶è§¦å‘æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µã€‚</p><p>è®°ä½ï¼Œå¤„ç†ç½‘ç»œè¿æ¥æ—¶ï¼Œè‰¯å¥½çš„èµ„æºç®¡ç†å’Œé”™è¯¯å¤„ç†æ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºç¨³å®šã€å¯é ã€å®‰å…¨åœ°è¿è¡Œã€‚</p><h3 id="server-listen" tabindex="-1"><a class="header-anchor" href="#server-listen"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverlisten" target="_blank" rel="noopener noreferrer">server.listen()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.listen()</code> æ–¹æ³•æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒç”¨äºå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œè®©å®ƒå¼€å§‹ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚è¿™ä¸ªæ–¹æ³•å±äº <code>net</code> æ¨¡å—ï¼Œä¹Ÿè¢«å¹¿æ³›ç”¨äºåˆ›å»º HTTPã€HTTPSã€TCPã€UDP æœåŠ¡å™¨ã€‚æˆ‘ä¼šé€šè¿‡å‡ ä¸ªæ­¥éª¤å’Œä¾‹å­æ¥è¯¦ç»†è§£é‡Šè¿™ä¸ªæ–¹æ³•çš„ç”¨æ³•ã€‚</p><h3 id="_1-åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#_1-åŸºæœ¬ç”¨æ³•"><span>1. åŸºæœ¬ç”¨æ³•</span></a></h3><p><code>server.listen()</code> æ–¹æ³•å¯ä»¥æ¥æ”¶å‡ ç§ä¸åŒç±»å‹çš„å‚æ•°æ¥æŒ‡å®šæœåŠ¡å™¨å¦‚ä½•ç›‘å¬ï¼š</p><ul><li>ç«¯å£å·ï¼šæœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼ŒæœåŠ¡å™¨ä¼šåœ¨æŒ‡å®šçš„ç«¯å£ä¸Šç›‘å¬ã€‚</li><li>è·¯å¾„ï¼šç”¨äºåˆ›å»º Unix å¥—æ¥å­—ï¼ˆsocketï¼‰ï¼Œé€šè¿‡æ–‡ä»¶è·¯å¾„è¿›è¡Œé€šä¿¡ã€‚</li><li>é€‰é¡¹å¯¹è±¡ï¼šå¯ä»¥æŒ‡å®šç«¯å£ã€ä¸»æœºåã€å›è°ƒå‡½æ•°ç­‰ã€‚</li><li>å›è°ƒå‡½æ•°ï¼šæœåŠ¡å™¨æˆåŠŸç›‘å¬åä¼šè°ƒç”¨çš„å‡½æ•°ã€‚</li></ul><h3 id="_2-ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#_2-ä¾‹å­"><span>2. ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ç›‘å¬ç«¯å£" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç›‘å¬ç«¯å£"><span>ä¾‹å­ 1ï¼šç›‘å¬ç«¯å£</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬æœ¬åœ°çš„ 3000 ç«¯å£ã€‚å½“ä½ é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://localhost:3000/</code> æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå“åº” &quot;Hello World\n&quot;ã€‚</p><h4 id="ä¾‹å­-2-æŒ‡å®šä¸»æœºå" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æŒ‡å®šä¸»æœºå"><span>ä¾‹å­ 2ï¼šæŒ‡å®šä¸»æœºå</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>server.listen()</code> æ–¹æ³•é™¤äº†æŒ‡å®šç«¯å£å¤–ï¼Œè¿˜æŒ‡å®šäº†ä¸»æœºåã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨åªä¼šæ¥å—å‘é€åˆ° <code>127.0.0.1</code> åœ°å€çš„è¯·æ±‚ã€‚</p><h4 id="ä¾‹å­-3-ä½¿ç”¨é€‰é¡¹å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-ä½¿ç”¨é€‰é¡¹å¯¹è±¡"><span>ä¾‹å­ 3ï¼šä½¿ç”¨é€‰é¡¹å¯¹è±¡</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    backlog</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 511</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æœ€å¤§ç­‰å¾…è¿æ¥æ•°ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯ 511</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>server.listen()</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œå¯ä»¥æ›´çµæ´»åœ°é…ç½®å¦‚ä½•ç›‘å¬ã€‚<code>backlog</code> å‚æ•°æŒ‡å®šäº†æ“ä½œç³»ç»Ÿåº”è¯¥ä¿æŒé˜Ÿåˆ—ä¸­çš„æœ€å¤§ç­‰å¾…è¿æ¥æ•°ã€‚</p><h4 id="ä¾‹å­-4-unix-å¥—æ¥å­—" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-4-unix-å¥—æ¥å­—"><span>ä¾‹å­ 4ï¼šUnix å¥—æ¥å­—</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/unix.socket</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on Unix socket at /path/to/unix.socket</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡ Unix å¥—æ¥å­—ç›‘å¬ï¼Œè€Œä¸æ˜¯é€šè¿‡ç½‘ç»œç«¯å£ã€‚è¿™åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚æé«˜å®‰å…¨æ€§æˆ–è€…æ€§èƒ½ã€‚</p><h3 id="å°ç»“-5" tabindex="-1"><a class="header-anchor" href="#å°ç»“-5"><span>å°ç»“</span></a></h3><p>é€šè¿‡ <code>server.listen()</code> æ–¹æ³•ï¼Œä½ å¯ä»¥è®© Node.js æœåŠ¡å™¨å¼€å§‹ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚ä½ å¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œé€šè¿‡ä¸åŒçš„å‚æ•°æ§åˆ¶ç›‘å¬çš„ç«¯å£ã€ä¸»æœºåï¼Œç”šè‡³æ˜¯ä½¿ç”¨ Unix å¥—æ¥å­—ã€‚è¿™æ˜¯æ„å»ºç½‘ç»œæœåŠ¡çš„åŸºç¡€ä¹‹ä¸€ã€‚</p><h4 id="server-listen-handle-backlog-callback" tabindex="-1"><a class="header-anchor" href="#server-listen-handle-backlog-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverlistenhandle-backlog-callback" target="_blank" rel="noopener noreferrer">server.listen(handle[, backlog][, callback])</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>server.listen(handle[, backlog][, callback])</code>æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ­£åœ¨è®¨è®ºå¦‚ä½•å¯åŠ¨ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œä½¿å®ƒèƒ½å¤Ÿå¼€å§‹æ¥å—ç½‘ç»œè¯·æ±‚ï¼ˆä¾‹å¦‚ HTTP è¯·æ±‚ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•å±äº Node.js çš„<code>net</code>æ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸»è¦ç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC çš„æœåŠ¡å™¨ï¼ˆTCP æ˜¯ä¸€ç§é€šç”¨çš„ç½‘ç»œåè®®ï¼Œè€Œ IPC æ˜¯è¿›ç¨‹é—´é€šä¿¡ï¼‰ã€‚</p><h3 id="å‚æ•°è§£æ" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£æ"><span>å‚æ•°è§£æï¼š</span></a></h3><ul><li><code>handle</code>: è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…æœåŠ¡å™¨åº”ç›‘å¬çš„ç«¯å£ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°†æŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„å…·ä½“è·¯å¾„ï¼ˆå¯¹äº IPC æœåŠ¡å™¨ï¼‰æˆ–åœ°å€å’Œç«¯å£ï¼ˆå¯¹äº TCP æœåŠ¡å™¨ï¼‰ã€‚</li><li><code>backlog</code>: è¿™ä¸ªå¯é€‰å‚æ•°æŒ‡å®šäº†ç­‰å¾…è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚å®é™…ä¸Šï¼Œå®ƒå†³å®šäº†åœ¨æ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ä¹‹å‰ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿæ’é˜Ÿç­‰å¾…çš„æœªè¢«æ¥å—è¿æ¥çš„æœ€å¤§æ•°é‡ã€‚</li><li><code>callback</code>: å½“æœåŠ¡å™¨ç»‘å®šåè°ƒç”¨çš„å¯é€‰å‡½æ•°ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æœåŠ¡å™¨å¼€å§‹ç›‘å¬åæƒ³è¦ç«‹å³æ‰§è¡Œçš„ä»£ç ã€‚</li></ul><h3 id="å®ä¾‹è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹è§£é‡Š"><span>å®ä¾‹è§£é‡Š</span></a></h3><h4 id="ä¾‹-1-å¯åŠ¨ä¸€ä¸ª-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹-1-å¯åŠ¨ä¸€ä¸ª-http-æœåŠ¡å™¨"><span>ä¾‹ 1: å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æƒ³é€šè¿‡ Node.js å¯åŠ¨ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­è®¿é—®å®ƒã€‚ä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ Node.js çš„<code>http</code>æ¨¡å—ï¼Œå¹¶ä½¿ç”¨<code>createServer</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨<code>server.listen()</code>æ–¹æ³•æ¥è®©æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç‰¹å®šçš„ç«¯å£å’Œå›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿çŸ¥é“æœåŠ¡å™¨ä½•æ—¶å‡†å¤‡å¥½äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨<code>.listen</code>æ–¹æ³•ç›‘å¬ 3000 ç«¯å£ã€‚ä¸€æ—¦æœåŠ¡å™¨å¼€å§‹è¿è¡Œï¼Œå®ƒå°±ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œæ‰“å°å‡ºä¸€æ¡æ¶ˆæ¯å‘Šè¯‰æˆ‘ä»¬æœåŠ¡å™¨å·²ç»å¯åŠ¨å¹¶ä¸”åœ¨ç›‘å¬ã€‚</p><h4 id="ä¾‹-2-ä½¿ç”¨-ipc-é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ä¾‹-2-ä½¿ç”¨-ipc-é€šä¿¡"><span>ä¾‹ 2: ä½¿ç”¨ IPC é€šä¿¡</span></a></h4><p>å¯¹äºä½¿ç”¨ IPC æ–¹å¼ï¼Œä½ å¯èƒ½ä¼šåœ¨è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡æ—¶ä½¿ç”¨åˆ°ã€‚ä¾‹å¦‚ï¼Œä½ æœ‰ä¸¤ä¸ª Node.js è¿›ç¨‹éœ€è¦äº’ç›¸é€šä¿¡ï¼Œä½ å¯ä»¥é€šè¿‡ IPC æ–¹å¼åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/tmp/nodejs.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åœ¨UNIXç³»ç»Ÿä¸­çš„è·¯å¾„</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºIPCæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬IPCè·¯å¾„</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Server listening on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">path</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä¸æ˜¯ç›‘å¬ç½‘ç»œç«¯å£ï¼Œè€Œæ˜¯ç›‘å¬ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚è¿™æ ·ï¼Œå…¶ä»– Node.js è¿›ç¨‹å°±å¯ä»¥é€šè¿‡è¿™ä¸ªè·¯å¾„ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤æ¢äº†ã€‚</p><h3 id="å°ç»“-6" tabindex="-1"><a class="header-anchor" href="#å°ç»“-6"><span>å°ç»“</span></a></h3><p><code>server.listen</code>æ–¹æ³•æ˜¯ Node.js ä¸­éå¸¸æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œæ— è®ºæ˜¯å¼€å‘ç½‘ç»œåº”ç”¨è¿˜æ˜¯è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œéƒ½ä¼šé¢‘ç¹ä½¿ç”¨åˆ°ã€‚ç†è§£å…¶å‚æ•°å’Œå·¥ä½œåŸç†å¯¹äºæœ‰æ•ˆåœ°ä½¿ç”¨ Node.js æ¥è¯´è‡³å…³é‡è¦ã€‚é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ä¸åŒçš„å‚æ•°æ¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ï¼Œä»è€Œæ„å»ºèƒ½å¤Ÿç›‘å¬ç‰¹å®šç«¯å£æˆ–è·¯å¾„çš„æœåŠ¡å™¨ã€‚</p><h4 id="server-listen-options-callback" tabindex="-1"><a class="header-anchor" href="#server-listen-options-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverlistenoptions-callback" target="_blank" rel="noopener noreferrer">server.listen(options[, callback])</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.listen(options[, callback])</code> æ˜¯ä¸€ä¸ªç”¨äºå¯åŠ¨ç½‘ç»œæœåŠ¡å™¨çš„æ–¹æ³•ï¼Œç‰¹åˆ«ç”¨äº <code>net</code> æ¨¡å—ï¼Œå®ƒå…è®¸ä½ çš„ Node.js åº”ç”¨ç¨‹åºç›‘å¬ç½‘ç»œä¸Šçš„è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒè®©ä½ çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ¥æ”¶å¹¶å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚ HTTP è¯·æ±‚ï¼Œè¿™æ˜¯æ„å»ºç½‘ç»œåº”ç”¨æˆ–æœåŠ¡çš„åŸºç¡€ã€‚</p><h3 id="å‚æ•°è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-1"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>options</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºé…ç½®æœåŠ¡å™¨ç›‘å¬çš„è¯¦ç»†å‚æ•°ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥æŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ã€ä¸»æœºåç­‰ã€‚</li><li><code>callback</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“æœåŠ¡å™¨å¼€å§‹ç›‘å¬æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼Œäº†è§£å¦‚ä½•åœ¨å®é™…ä¸­ä½¿ç”¨ <code>server.listen(options[, callback])</code>ã€‚</p><h4 id="ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„-http-æœåŠ¡å™¨"><span>ä¾‹å­ 1ï¼šåˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ HTTP æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ server.listen å¯åŠ¨æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŸºç¡€çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 3000 ç«¯å£ã€‚å½“æœ‰ HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®ƒä¼šå“åº” &quot;Hello World&quot;ã€‚<code>server.listen</code> çš„ <code>options</code> å‚æ•°ä¸­æŒ‡å®šäº†ç«¯å£å·ï¼Œ<code>callback</code> å‡½æ•°åœ¨æœåŠ¡å™¨æˆåŠŸç›‘å¬åæ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚</p><h4 id="ä¾‹å­-2-æŒ‡å®šä¸»æœºåå’Œç«¯å£" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æŒ‡å®šä¸»æœºåå’Œç«¯å£"><span>ä¾‹å­ 2ï¼šæŒ‡å®šä¸»æœºåå’Œç«¯å£</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯åŠ¨æœåŠ¡å™¨ï¼ŒæŒ‡å®šä¸»æœºåå’Œç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…æŒ‡å®šäº†ç›‘å¬çš„ç«¯å£å·ï¼Œè¿˜æŒ‡å®šäº†ä¸»æœºå <code>localhost</code>ã€‚è¿™æ ·æœåŠ¡å™¨åªæ¥å—å‘å¾€ <code>localhost</code> çš„è¯·æ±‚ï¼Œå¢åŠ äº†ä¸€å±‚ç®€å•çš„è®¿é—®æ§åˆ¶ã€‚</p><h3 id="å°ç»“-7" tabindex="-1"><a class="header-anchor" href="#å°ç»“-7"><span>å°ç»“</span></a></h3><p>é€šè¿‡ <code>server.listen(options[, callback])</code> æ–¹æ³•ï¼Œä½ å¯ä»¥è®©ä½ çš„ Node.js åº”ç”¨ç¨‹åºç›‘å¬ç½‘ç»œè¯·æ±‚ã€‚è¿™æ˜¯å¼€å‘ç½‘ç»œåº”ç”¨å’ŒæœåŠ¡çš„åŸºç¡€ã€‚é€šè¿‡è°ƒæ•´ <code>options</code> å‚æ•°ï¼Œä½ å¯ä»¥çµæ´»åœ°æ§åˆ¶æœåŠ¡å™¨çš„ç›‘å¬è¡Œä¸ºï¼Œæ¯”å¦‚ç›‘å¬ç‰¹å®šçš„ç«¯å£å’Œä¸»æœºåã€‚å¸Œæœ›è¿™äº›ä¾‹å­èƒ½å¸®åŠ©ä½ ç†è§£å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><h4 id="server-listen-path-backlog-callback" tabindex="-1"><a class="header-anchor" href="#server-listen-path-backlog-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverlistenpath-backlog-callback" target="_blank" rel="noopener noreferrer">server.listen(path[, backlog][, callback])</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚<code>server.listen(path[, backlog][, callback])</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¯åŠ¨ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ã€‚è¿™ä¸ªæ–¹æ³•å±äº<code>net</code>æ¨¡å—ï¼Œä¸»è¦ç”¨äº TCP æˆ– IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰æœåŠ¡å™¨ã€‚</p><p>åœ¨è§£é‡Š<code>server.listen(path[, backlog][, callback])</code>ä¹‹å‰ï¼Œéœ€è¦äº†è§£å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><strong>TCP (Transmission Control Protocol)</strong>: ä¸€ç§æ ¸å¿ƒçš„ç½‘ç»œåè®®ï¼Œå®ƒæ”¯æŒç½‘ç»œä¸Šçš„è®¡ç®—æœºä¹‹é—´è¿›è¡Œå¯é çš„é€šä¿¡ã€‚</li><li><strong>IPC (Inter-Process Communication)</strong>: è¿›ç¨‹é—´é€šä¿¡ï¼Œå…è®¸è¿è¡Œåœ¨åŒä¸€å°è®¡ç®—æœºä¸Šçš„ä¸åŒè¿›ç¨‹ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚</li><li><strong>å›è°ƒå‡½æ•° (Callback)</strong>: ä¸€ç§åœ¨æŸä¸ªä»»åŠ¡å®Œæˆæ—¶å°†è‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯¦ç»†è§£æ<code>server.listen(path[, backlog][, callback])</code>:</p><ul><li><code>path</code>: å½“ä½ æƒ³é€šè¿‡ IPC è¿›è¡Œé€šä¿¡æ—¶ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ IPC æœåŠ¡å™¨ç›‘å¬çš„è·¯å¾„ã€‚å¯¹äº TCP æœåŠ¡å™¨ï¼Œè¿™ä¸ªå‚æ•°ä¼šè¢«å¿½ç•¥ã€‚</li><li><code>backlog</code>: å¯é€‰å‚æ•°ï¼Œå†³å®šäº†ç­‰å¾…é˜Ÿåˆ—ä¸­å¯èƒ½çš„æœ€å¤§è¿æ¥æ•°ã€‚æ“ä½œç³»ç»Ÿå®é™…å¯èƒ½ä¼šé™åˆ¶è¿™ä¸ªæ•°å€¼ã€‚</li><li><code>callback</code>: å¯é€‰å‚æ•°ï¼Œå½“æœåŠ¡å™¨å¼€å§‹ç›‘å¬æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»º-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»º-tcp-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1: åˆ›å»º TCP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œç›‘å¬ 3000 ç«¯å£ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥å·²å…³é—­ã€‚</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨-ipc-è¿›è¡Œé€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨-ipc-è¿›è¡Œé€šä¿¡"><span>ç¤ºä¾‹ 2: ä½¿ç”¨ IPC è¿›è¡Œé€šä¿¡</span></a></h4><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€æ¬¾æ¡Œé¢åº”ç”¨ï¼Œå¹¶å¸Œæœ›å¤šä¸ªè¿›ç¨‹èƒ½å¤Ÿé€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨ IPCã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/tmp/echo.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åœ¨Unixç³»ç»Ÿä¸‹çš„è·¯å¾„</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å›é€æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨IPCè·¯å¾„ç›‘å¬</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨é€šè¿‡IPCè·¯å¾„ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">path</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> ç›‘å¬</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸¤ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>server.listen()</code>å¯åŠ¨ TCP å’Œ IPC æœåŠ¡å™¨ã€‚æ— è®ºæ˜¯é€šè¿‡ç½‘ç»œæ¥å£è¿˜æ˜¯æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼ŒNode.js éƒ½æä¾›äº†çµæ´»çš„æ–¹å¼æ¥å»ºç«‹è¿æ¥ï¼Œå¤„ç†æ•°æ®ã€‚</p><h4 id="server-listen-port-host-backlog-callback" tabindex="-1"><a class="header-anchor" href="#server-listen-port-host-backlog-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverlistenport-host-backlog-callback" target="_blank" rel="noopener noreferrer">server.listen([port[, host[, backlog]]][, callback])</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.listen()</code>æ–¹æ³•æ˜¯ç”¨æ¥å¯åŠ¨ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨çš„é‡è¦æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è®©ä½ çš„æœåŠ¡å™¨èƒ½å¤Ÿæ¥å—ç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚ HTTP è¯·æ±‚ã€‚åœ¨ v21.7.1 ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç”¨æ³•å’Œä»¥å¾€ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰ä¸€äº›æ€§èƒ½æ”¹è¿›æˆ–è€…å®‰å…¨æ€§æ›´æ–°ã€‚</p><h3 id="å‚æ•°è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-2"><span>å‚æ•°è§£é‡Š</span></a></h3><p><code>server.listen()</code>æ–¹æ³•å¯ä»¥æ¥å—å‡ ä¸ªå‚æ•°ï¼Œç”¨äºå®šåˆ¶æœåŠ¡å™¨çš„è¡Œä¸ºï¼š</p><ul><li><strong>port</strong> (å¯é€‰): è¿™æ˜¯ä½ å¸Œæœ›æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·ã€‚ç½‘ç«™é€šå¸¸ä½¿ç”¨ 80 ç«¯å£ï¼Œè€Œå¼€å‘æ—¶ç»å¸¸ä½¿ç”¨ 3000ã€8080 ä¹‹ç±»çš„ç«¯å£ã€‚</li><li><strong>host</strong> (å¯é€‰): è¿™æ˜¯æœåŠ¡å™¨ç›‘å¬çš„ä¸»æœºåæˆ–è€… IP åœ°å€ã€‚å¦‚æœä¸æŒ‡å®šï¼ŒæœåŠ¡å™¨å°†æ¥å—æ‰€æœ‰ IP åœ°å€çš„è¿æ¥è¯·æ±‚ï¼Œä½¿ç”¨<code>0.0.0.0</code>è¡¨ç¤ºã€‚</li><li><strong>backlog</strong> (å¯é€‰): è¿™å†³å®šäº†ç­‰å¾…é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯é‚£äº›æ­£åœ¨å»ºç«‹è¿æ¥ä½†è¿˜æ²¡æœ‰è¢«æ¥å—çš„è¯·æ±‚ã€‚å¦‚æœæœåŠ¡å™¨ç¹å¿™åˆ°æ— æ³•åŠæ—¶å¤„ç†æ‰€æœ‰è¿›æ¥çš„è¿æ¥ï¼Œè¿™ä¸ªå‚æ•°å°±å¾ˆæœ‰ç”¨äº†ã€‚</li><li><strong>callback</strong> (å¯é€‰): å½“æœåŠ¡å™¨å¯åŠ¨å¹¶å‡†å¤‡å¥½æ¥å—è¿æ¥æ—¶ï¼Œå°†è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-å¯åŠ¨ä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-å¯åŠ¨ä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨"><span>1. å¯åŠ¨ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬æœ¬æœºçš„ 3000 ç«¯å£ã€‚å½“è®¿é—®è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œå®ƒä¼šè¿”å›â€œHello Worldâ€ã€‚</p><h4 id="_2-ç›‘å¬ç‰¹å®š-ip" tabindex="-1"><a class="header-anchor" href="#_2-ç›‘å¬ç‰¹å®š-ip"><span>2. ç›‘å¬ç‰¹å®š IP</span></a></h4><p>å¦‚æœä½ çš„æœåŠ¡å™¨æœ‰å¤šä¸ª IP åœ°å€ï¼Œä½ å¯èƒ½åªæƒ³è®©å®ƒç›‘å¬å…¶ä¸­ä¸€ä¸ªï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.1.100</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://192.168.1.100:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼ŒæœåŠ¡å™¨åªä¼šæ¥å—å‘å¾€<code>192.168.1.100</code>è¿™ä¸ª IP åœ°å€çš„è¯·æ±‚ã€‚</p><h4 id="_3-ä½¿ç”¨é»˜è®¤ç«¯å£å’Œä»»æ„-ip" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨é»˜è®¤ç«¯å£å’Œä»»æ„-ip"><span>3. ä½¿ç”¨é»˜è®¤ç«¯å£å’Œä»»æ„ IP</span></a></h4><p>å¦‚æœä½ ä¸æŒ‡å®šç«¯å£å’Œ IPï¼ŒNode.js ä¼šé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ç«¯å£ï¼Œå¹¶ç›‘å¬æ‰€æœ‰ IP åœ°å€ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#ECEFF4;">().</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#ECEFF4;">().</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™åœ¨æŸäº›è‡ªåŠ¨åŒ–éƒ¨ç½²åœºæ™¯ä¸‹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä½ ä¸éœ€è¦é¢„å…ˆçŸ¥é“ç«¯å£å’Œ IP åœ°å€ã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>server.listen()</code>æ–¹æ³•åœ¨ Node.js åº”ç”¨ä¸­çš„çµæ´»æ€§å’Œé‡è¦æ€§ã€‚è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾åœ°æ ¹æ®éœ€è¦é…ç½®æœåŠ¡å™¨ã€‚</p><h3 id="server-listening" tabindex="-1"><a class="header-anchor" href="#server-listening"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverlistening" target="_blank" rel="noopener noreferrer">server.listening</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ JavaScript æ„å»ºç½‘ç«™åå°ã€API ç­‰ç­‰ã€‚å…¶ä¸­ï¼Œ<code>net</code> æ¨¡å—æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªç”¨äºç½‘ç»œæ“ä½œçš„æ ¸å¿ƒæ¨¡å—ï¼Œæ¯”å¦‚åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.listening</code> å±æ€§æ˜¯ <code>net</code> æ¨¡å—ä¸­ä¸€ä¸ªéå¸¸ç›´æ¥çš„å±æ€§ï¼Œç”¨äºæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨ç›‘å¬ï¼ˆå³æ¥å—ï¼‰æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p><h3 id="è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š"><span>è§£é‡Š</span></a></h3><p>å½“ä½ åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦è®©å®ƒ&quot;ç›‘å¬&quot;æŸä¸ªç«¯å£å·ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¥æ”¶å¹¶å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º&quot;ç›‘å¬&quot;ï¼ˆlisteningï¼‰ã€‚ä¸€æ—¦æœåŠ¡å™¨å¼€å§‹ç›‘å¬æŸä¸ªç«¯å£ï¼Œå®ƒå°±å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå‡†å¤‡æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p><p><code>server.listening</code> å°±æ˜¯ç”¨æ¥åˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦å·²ç»å¼€å§‹ç›‘å¬ç«¯å£çš„å±æ€§ã€‚å¦‚æœæœåŠ¡å™¨æ­£åœ¨ç›‘å¬ï¼Œåˆ™ <code>server.listening</code> çš„å€¼ä¸º <code>true</code>ï¼›å¦åˆ™ï¼Œå…¶å€¼ä¸º <code>false</code>ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -1"><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„ 3000 ç«¯å£ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from the server!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ server.listening å±æ€§æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨ç›‘å¬</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Is the server listening? </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">listening</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>net</code> æ¨¡å—ï¼Œå¹¶ä½¿ç”¨ <code>net.createServer()</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>server.listen()</code> æ–¹æ³•ä½¿æœåŠ¡å™¨ç›‘å¬ 3000 ç«¯å£ã€‚åœ¨æœåŠ¡å™¨å¼€å§‹ç›‘å¬ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡æ‰“å° <code>server.listening</code> çš„å€¼æ¥æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨ç›‘å¬ã€‚</p><h3 id="å®é™…åº”ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨-1"><span>å®é™…åº”ç”¨</span></a></h3><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®æœåŠ¡å™¨æ˜¯å¦å·²ç»å¼€å§‹ç›‘å¬æ¥å†³å®šæ‰§è¡ŒæŸäº›æ“ä½œã€‚ä¾‹å¦‚ï¼Œåªæœ‰åœ¨ç¡®å®šæœåŠ¡å™¨æˆåŠŸç›‘å¬ç«¯å£ä¹‹åï¼Œä½ æ‰å¯åŠ¨æŸäº›åç»­çš„åˆå§‹åŒ–æµç¨‹æˆ–è€…å‘é€é€šçŸ¥å‘Šè¯‰ç®¡ç†å‘˜æœåŠ¡å™¨å·²ç»æ­£å¸¸å¯åŠ¨ã€‚åˆ©ç”¨ <code>server.listening</code> å±æ€§å¯ä»¥è½»æ¾å®ç°è¿™ç±»é€»è¾‘ã€‚</p><p>å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ <code>server.listening</code> åœ¨ Node.js ä¸­çš„åº”ç”¨å’Œé‡è¦æ€§ï¼</p><h3 id="server-maxconnections" tabindex="-1"><a class="header-anchor" href="#server-maxconnections"><span><a href="https://nodejs.org/docs/latest/api/net.html#servermaxconnections" target="_blank" rel="noopener noreferrer">server.maxConnections</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.maxConnections</code>å±æ€§ç”¨äºè®¾ç½®åœ¨æŸä¸€æ—¶åˆ»æœåŠ¡å™¨ä¸Šèƒ½å¤Ÿå»ºç«‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚è¿™é‡Œçš„â€œå¹¶å‘è¿æ¥â€æŒ‡åŒæ—¶ä¸æœåŠ¡å™¨ä¿æŒæ´»åŠ¨çŠ¶æ€çš„å®¢æˆ·ç«¯è¿æ¥æ•°é‡ã€‚é€šè¿‡è®¾å®šè¿™ä¸ªé™åˆ¶ï¼Œä½ å¯ä»¥æ§åˆ¶æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œé¿å…è¿‡å¤šçš„è¿æ¥å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ã€‚</p><p>Node.js ä¸­çš„<code>net</code>æ¨¡å—æä¾›äº†ç”¨äºåˆ›å»ºåŸºäº TCP/IPC çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„åŠŸèƒ½ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªæ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨åï¼Œ<code>server.maxConnections</code>å±æ€§å°±æ˜¯ç”¨æ¥æ§åˆ¶è¿™ä¸ªæœåŠ¡å™¨å®ä¾‹æ‰€èƒ½æ¥å—çš„æœ€å¤§è¿æ¥æ•°ã€‚å¦‚æœæ–°çš„è¿æ¥è¯·æ±‚è¾¾åˆ°è¿™ä¸ªé™åˆ¶ï¼ŒNode.js å°†ä¸ä¼šå¤„ç†è¶…å‡ºçš„è¿æ¥è¯·æ±‚ï¼Œç›´åˆ°ç°æœ‰çš„è¿æ¥æ•°é™ä½ã€‚</p><h3 id="ä¸¾ä¾‹è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¾‹è¯´æ˜"><span>ä¸¾ä¾‹è¯´æ˜</span></a></h3><h4 id="ç¤ºä¾‹-1-è®¾ç½®æœ€å¤§è¿æ¥æ•°ä¸º-10" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è®¾ç½®æœ€å¤§è¿æ¥æ•°ä¸º-10"><span>ç¤ºä¾‹ 1ï¼šè®¾ç½®æœ€å¤§è¿æ¥æ•°ä¸º 10</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œè¦æ±‚åŒæ—¶åªèƒ½å¤„ç† 10 ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªTCPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®æœ€å¤§è¿æ¥æ•°ä¸º10</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxConnections</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 10</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬12345ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬12345ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ç¬¬ 11 ä¸ªå®¢æˆ·ç«¯å°è¯•è¿æ¥æ—¶ï¼Œç”±äº<code>maxConnections</code>è¢«è®¾ç½®ä¸º 10ï¼Œè¿™ä¸ªæ–°çš„è¿æ¥è¯·æ±‚å°†ä¸ä¼šè¢«æ¥å—ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ªç°æœ‰è¿æ¥è¢«å…³é—­ã€‚</p><h4 id="ç¤ºä¾‹-2-åŠ¨æ€æ£€æŸ¥å’Œä¿®æ”¹æœ€å¤§è¿æ¥æ•°" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-åŠ¨æ€æ£€æŸ¥å’Œä¿®æ”¹æœ€å¤§è¿æ¥æ•°"><span>ç¤ºä¾‹ 2ï¼šåŠ¨æ€æ£€æŸ¥å’Œä¿®æ”¹æœ€å¤§è¿æ¥æ•°</span></a></h4><p>ä½ ä¹Ÿå¯ä»¥åŠ¨æ€åœ°æ£€æŸ¥å½“å‰çš„<code>maxConnections</code>å€¼ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å½“å‰æœ€å¤§è¿æ¥æ•°: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxConnections</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åŸºäºæŸç§æ¡ä»¶ï¼Œä½ æƒ³å¢åŠ æœ€å¤§è¿æ¥æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxConnections</span><span style="color:#81A1C1;"> +=</span><span style="color:#B48EAD;"> 10</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ–°çš„æœ€å¤§è¿æ¥æ•°: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">maxConnections</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h4><ol><li><p><strong>æ§åˆ¶ API æœåŠ¡å™¨çš„è´Ÿè½½</strong>ï¼šå¦‚æœä½ å¼€å‘çš„æ˜¯ä¸€ä¸ªé¢å‘å…¬ä¼—çš„ API æœåŠ¡ï¼Œå¯èƒ½ä¼šå¸Œæœ›é™åˆ¶åŒä¸€æ—¶é—´å†…èƒ½å¤„ç†çš„è¯·æ±‚é‡ï¼Œä»¥é˜²æ­¢æœåŠ¡å™¨å› ä¸ºçªç„¶çš„æµé‡é«˜å³°è€Œå˜å¾—ä¸ç¨³å®šã€‚</p></li><li><p><strong>æ¸¸æˆæœåŠ¡å™¨</strong>ï¼šå¯¹äºæŸäº›ç±»å‹çš„æ¸¸æˆæœåŠ¡å™¨ï¼Œå¯èƒ½éœ€è¦é™åˆ¶æˆ¿é—´æˆ–æ¸¸æˆå®ä¾‹ä¸­çš„ç©å®¶æ•°é‡ï¼Œç¡®ä¿æ¸¸æˆè´¨é‡å’ŒæœåŠ¡å™¨æ€§èƒ½ã€‚</p></li><li><p><strong>ç‰©è”ç½‘ï¼ˆIoTï¼‰åº”ç”¨</strong>ï¼šåœ¨ç‰©è”ç½‘åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦é™åˆ¶åŒæ—¶è¿æ¥åˆ°æœåŠ¡å™¨çš„è®¾å¤‡æ•°é‡ï¼Œä»¥ç®¡ç†ç½‘ç»œæµé‡å’Œç¡®ä¿æ•°æ®çš„æœ‰æ•ˆå¤„ç†ã€‚</p></li></ol><p>é€šè¿‡åˆç†è®¾ç½®<code>server.maxConnections</code>ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°æ§åˆ¶æœåŠ¡å™¨èµ„æºï¼Œæå‡åº”ç”¨çš„å¯é æ€§å’Œæ€§èƒ½ã€‚</p><h3 id="server-ref" tabindex="-1"><a class="header-anchor" href="#server-ref"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverref" target="_blank" rel="noopener noreferrer">server.ref()</a></span></a></h3><p>Node.js ä¸­çš„ <code>server.ref()</code> æ–¹æ³•æ˜¯ä¸ç½‘ç»œæœåŠ¡å™¨ç›¸å…³çš„ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œå®ƒç”¨äºæ§åˆ¶ Node.js äº‹ä»¶å¾ªç¯çš„è¡Œä¸ºã€‚åœ¨äº†è§£è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ Node.js çš„äº‹ä»¶å¾ªç¯æœºåˆ¶å’Œ Node.js ä¸­æœåŠ¡å™¨å¯¹è±¡çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p><h3 id="node-js-äº‹ä»¶å¾ªç¯" tabindex="-1"><a class="header-anchor" href="#node-js-äº‹ä»¶å¾ªç¯"><span>Node.js äº‹ä»¶å¾ªç¯</span></a></h3><p>Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„éé˜»å¡ I/O æ¨¡å‹ã€‚è¿™æ„å‘³ç€ Node.js æœåŠ¡å™¨åœ¨å¤„ç† I/O æ“ä½œï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰æ—¶ï¼Œä¸ä¼šåœæ­¢ç­‰å¾…æ“ä½œå®Œæˆï¼Œè€Œæ˜¯å°†è¿™äº›æ“ä½œå§”æ‰˜ç»™ç³»ç»Ÿå†…æ ¸å»åšï¼Œä¸€æ—¦æ“ä½œå®Œæˆï¼Œç³»ç»Ÿå†…æ ¸ä¼šé€šçŸ¥ Node.jsï¼Œç„¶å Node.js é€šè¿‡äº‹ä»¶å¾ªç¯å¤„ç†è¿™äº›æ“ä½œçš„ç»“æœã€‚</p><h3 id="node-js-ä¸­çš„-server-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-server-å¯¹è±¡"><span>Node.js ä¸­çš„ Server å¯¹è±¡</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨æŸäº›æ¨¡å—ï¼ˆå¦‚ <code>http</code> æˆ– <code>net</code>ï¼‰åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª Server å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†ä½ çš„æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p><h3 id="server-ref-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#server-ref-æ–¹æ³•çš„ä½œç”¨"><span>server.ref() æ–¹æ³•çš„ä½œç”¨</span></a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ Node.js æœåŠ¡å™¨ä¸Šæœ‰æ´»è·ƒçš„è¿æ¥æ—¶ï¼ŒNode.js çš„äº‹ä»¶å¾ªç¯ä¼šä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œè¿™ç¡®ä¿äº†æœåŠ¡å™¨èƒ½å¤ŸæŒç»­å¤„ç†æ–°çš„è¯·æ±‚æˆ–ç°æœ‰è¿æ¥ä¸Šçš„æ•°æ®ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä½ å¸Œæœ› Node.js æœåŠ¡å™¨åœ¨æ²¡æœ‰å…¶ä»–å·¥ä½œè¦åšæ—¶ï¼ˆå³æ²¡æœ‰å®šæ—¶å™¨ã€æ²¡æœ‰å·¥ä½œä»»åŠ¡ç­‰ï¼‰è‡ªåŠ¨é€€å‡ºï¼Œè€Œä¸æ˜¯å› ä¸ºæœåŠ¡å™¨ä¸Šçš„æ´»è·ƒè¿æ¥è€Œä¿æŒè¿è¡Œï¼Œè¿™æ—¶ <code>server.unref()</code> æ–¹æ³•å°±éå¸¸æœ‰ç”¨ã€‚</p><p>ç›¸å¯¹çš„ï¼Œ<code>server.ref()</code> æ–¹æ³•å¯ä»¥æ’¤é”€ <code>server.unref()</code> çš„æ•ˆæœã€‚å¦‚æœä½ ä¹‹å‰è°ƒç”¨äº† <code>server.unref()</code>ï¼Œä½¿å¾—æœåŠ¡å™¨å¯¹è±¡ä¸å†é˜»æ­¢ Node.js é€€å‡ºäº‹ä»¶å¾ªç¯ï¼Œé‚£ä¹ˆ <code>server.ref()</code> ä¼šé‡æ–°å¼•ç”¨æœåŠ¡å™¨å¯¹è±¡ï¼Œç¡®ä¿å³ä½¿æ²¡æœ‰å…¶ä»–æ´»åŠ¨ï¼Œåªè¦æœåŠ¡å™¨ä¸Šæœ‰æ´»è·ƒè¿æ¥ï¼ŒNode.js äº‹ä»¶å¾ªç¯ä¹Ÿä¸ä¼šé€€å‡ºã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-8"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨å¯åŠ¨äº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ç”¨äºå¤„ç†è¯·æ±‚ï¼Œä½†åŒæ—¶å®ƒè¿˜ä¼šå®šæœŸæ‰§è¡Œä¸€äº›åå°ä»»åŠ¡ï¼Œä¾‹å¦‚æ¸…ç†æ—¥å¿—ã€å‘é€æŠ¥å‘Šé‚®ä»¶ç­‰ã€‚</p><p>å¦‚æœæŸä¸€åˆ»ï¼Œä½ çš„åº”ç”¨å®Œæˆäº†æ‰€æœ‰åå°ä»»åŠ¡ï¼Œè€Œä¸”æš‚æ—¶æ²¡æœ‰æ–°çš„å®¢æˆ·ç«¯è¯·æ±‚éœ€è¦å¤„ç†ï¼Œä½ å¯èƒ½å¸Œæœ›åº”ç”¨ç¨‹åºèƒ½å¤Ÿè‡ªåŠ¨é€€å‡ºã€‚ä½†æ˜¯ï¼Œç”±äº HTTP æœåŠ¡å™¨çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºä¸ä¼šè‡ªåŠ¨é€€å‡ºã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨åç«‹å³è°ƒç”¨ <code>server.unref()</code>ï¼Œè¿™æ ·å³ä½¿æœåŠ¡å™¨å¤„äºç©ºé—²çŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥é€€å‡ºã€‚å¦‚æœåæ¥ä½ åˆå¸Œæœ›ç¡®ä¿åº”ç”¨æŒç»­è¿è¡Œï¼Œå“åº”å¯èƒ½åˆ°æ¥çš„æ–°è¯·æ±‚ï¼Œä½ å¯ä»¥è°ƒç”¨ <code>server.ref()</code> æ¥ä¿è¯åº”ç”¨ä¸ä¼šå› ä¸ºæš‚æ—¶çš„ç©ºé—²è€Œé€€å‡ºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1337</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:1337/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unref</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è®©åº”ç”¨åœ¨ç©ºé—²æ—¶å¯ä»¥é€€å‡º</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨å…¶ä»–åœ°æ–¹æˆ–å…¶ä»–æ—¶åˆ»ï¼Œä½ å†³å®šåº”ç”¨éœ€è¦æŒç»­è¿è¡Œ</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ref</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å–æ¶ˆunrefçš„æ•ˆæœï¼Œä¿è¯åº”ç”¨ä¸ä¼šå› ä¸ºæš‚æ—¶çš„ç©ºé—²è€Œé€€å‡º</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹æ³•åœ¨æŸäº›ç‰¹å®šçš„åº”ç”¨åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯é‚£äº›éœ€è¦åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ä¼˜é›…é€€å‡ºçš„é•¿æœŸè¿è¡ŒæœåŠ¡æˆ–è„šæœ¬ã€‚</p><h3 id="server-unref" tabindex="-1"><a class="header-anchor" href="#server-unref"><span><a href="https://nodejs.org/docs/latest/api/net.html#serverunref" target="_blank" rel="noopener noreferrer">server.unref()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.unref()</code>æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„æ–¹æ³•ï¼Œå°¤å…¶åœ¨å¤„ç†ç½‘ç»œæœåŠ¡å™¨ï¼ˆå¦‚ HTTP æœåŠ¡å™¨ï¼‰æ—¶ã€‚è¦ç†è§£<code>server.unref()</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ Node.js çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ã€‚Node.js æ˜¯åŸºäºäº‹ä»¶å¾ªç¯çš„ï¼Œè¿™æ„å‘³ç€ Node.js ä¼šæŒç»­è¿è¡Œï¼Œç­‰å¾…å¹¶å¤„ç†äº‹ä»¶ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„äº‹ä»¶éœ€è¦å¤„ç†ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼ŒNode.js ä¼šä¿æŒç¨‹åºè¿è¡Œï¼Œç­‰å¾…æ–°çš„ç½‘ç»œè¿æ¥ã€‚è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨å¯¹è±¡ä¼šåœ¨å†…éƒ¨è¢«å¼•ç”¨ï¼Œä½œä¸ºäº‹ä»¶å¾ªç¯ä¸­å¾…å¤„ç†çš„ä¸€ä¸ªé¡¹ç›®ã€‚ä½†æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ› Node.js åœ¨æ²¡æœ‰å…¶ä»–å·¥ä½œè¦åšæ—¶è‡ªåŠ¨é€€å‡ºï¼Œå³ä½¿æœåŠ¡å™¨ä»åœ¨ç›‘å¬ç½‘ç»œè¿æ¥ã€‚è¿™æ­£æ˜¯<code>server.unref()</code>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>ä½¿ç”¨<code>server.unref()</code>æ–¹æ³•åï¼Œå¦‚æœè¿™ä¸ªæœåŠ¡å™¨æ˜¯äº‹ä»¶å¾ªç¯ä¸­å”¯ä¸€å‰©ä¸‹çš„å·¥ä½œï¼ŒNode.js è¿›ç¨‹å°†é€€å‡ºã€‚è¿™ä¸ä¼šç«‹å³å…³é—­æœåŠ¡å™¨ï¼Œè€Œæ˜¯å…è®¸æœåŠ¡å™¨åœ¨æ²¡æœ‰æ–°çš„è¿æ¥æ—¶è®© Node.js è‡ªç„¶é€€å‡ºã€‚ç›¸å¯¹çš„ï¼Œå¦‚æœæœåŠ¡å™¨å†æ¬¡å˜å¾—â€œå¿…è¦â€â€”â€”ä¾‹å¦‚ï¼Œæœ‰æ–°çš„è¿æ¥è¿›æ¥â€”â€”å®ƒå¯ä»¥é€šè¿‡<code>server.ref()</code>æ–¹æ³•è¢«é‡æ–°å¼•ç”¨ï¼Œé˜²æ­¢ Node.js é€€å‡ºã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><p><strong>å®šæ—¶ä»»åŠ¡æœåŠ¡å™¨</strong>ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯å®šæ—¶è¿è¡ŒæŸäº›ä»»åŠ¡ï¼ˆä½¿ç”¨<code>setTimeout</code>æˆ–<code>setInterval</code>ï¼‰ï¼Œä»»åŠ¡å®Œæˆåï¼Œä½ å¸Œæœ›æœåŠ¡å™¨èƒ½å¤Ÿè‡ªåŠ¨é€€å‡ºã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨åè°ƒç”¨<code>server.unref()</code>ï¼Œè¿™æ ·ä¸€æ—¦å®šæ—¶ä»»åŠ¡å®Œæˆï¼Œè€Œæ²¡æœ‰å…¶ä»–æ´»åŠ¨ï¼ˆå¦‚æ–°çš„ç½‘ç»œè¯·æ±‚ï¼‰ï¼ŒNode.js è¿›ç¨‹å°±ä¼šé€€å‡ºã€‚</p></li><li><p><strong>å¾®æœåŠ¡å¥åº·æ£€æŸ¥</strong>ï¼šå¦‚æœä½ åœ¨ä¸€ä¸ªå¤§å‹çš„å¾®æœåŠ¡æ¶æ„ä¸­è¿è¡Œå¤šä¸ªå°å‹æœåŠ¡ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªå¥åº·æ£€æŸ¥æœåŠ¡æ¥å®šæœŸæ£€æŸ¥æ¯ä¸ªæœåŠ¡çš„çŠ¶æ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæœåŠ¡å¯ä»¥ä½¿ç”¨<code>server.unref()</code>ï¼Œè¿™æ ·å¦‚æœå®ƒä»¬ä¸å¤„ç†ä»»ä½•è¯·æ±‚ï¼Œå°±å¯ä»¥åœ¨å¥åº·æ£€æŸ¥ä¹‹é—´è®© Node.js è¿›ç¨‹é€€å‡ºï¼Œä»è€Œå‡å°‘èµ„æºå ç”¨ã€‚</p></li><li><p><strong>å¼€å‘ä¸­çš„ä¸´æ—¶æœåŠ¡å™¨</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä¸´æ—¶å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨æ¥æµ‹è¯•æŸäº›åŠŸèƒ½ã€‚ä½¿ç”¨<code>server.unref()</code>å¯ä»¥è®©è¿™ä¸ªæœåŠ¡å™¨åœ¨ä½ å®Œæˆæµ‹è¯•åï¼Œä¸é˜»å¡ç»ˆç«¯æˆ–ç¼–è¾‘å™¨ä¸­çš„å…¶ä»–è¿›ç¨‹è‡ªåŠ¨é€€å‡ºã€‚</p></li></ol><p>è¿™äº›ä¾‹å­å±•ç¤ºäº†<code>server.unref()</code>åœ¨ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨ï¼Œå¸®åŠ©ä½ æ›´çµæ´»åœ°æ§åˆ¶ Node.js æœåŠ¡å™¨çš„è¡Œä¸ºå’Œèµ„æºç®¡ç†ã€‚</p><h2 id="class-net-socket" tabindex="-1"><a class="header-anchor" href="#class-net-socket"><span><a href="https://nodejs.org/docs/latest/api/net.html#class-netsocket" target="_blank" rel="noopener noreferrer">Class: net.Socket</a></span></a></h2><p><code>net.Socket</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç±»ï¼Œå®ƒç”¨äºå®ç°ä½çº§ç½‘ç»œé€šä¿¡ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œè¿™ä¸ªç±»æä¾›äº†ä¸€ä¸ªå¯¹è±¡çš„æ¥å£ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† TCP æˆ– IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰è¿æ¥ã€‚é€šè¿‡ä½¿ç”¨ <code>net.Socket</code>ï¼Œä½ å¯ä»¥æ„å»ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ul><li><strong>TCP (Transmission Control Protocol)</strong>: ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„åè®®ï¼Œå¸¸ç”¨äºäº’è”ç½‘é€šä¿¡ã€‚</li><li><strong>IPC (Inter-Process Communication)</strong>: è¿›ç¨‹é—´é€šä¿¡ï¼Œå…è®¸åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šçš„ä¸åŒè¿›ç¨‹ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li></ul><h3 id="åˆ›å»ºä¸€ä¸ª-net-socket-å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-net-socket-å®ä¾‹"><span>åˆ›å»ºä¸€ä¸ª <code>net.Socket</code> å®ä¾‹</span></a></h3><p>å¯ä»¥é€šè¿‡ç›´æ¥å®ä¾‹åŒ– <code>net.Socket</code> æˆ–è€…ä½¿ç”¨ <code>net.createConnection</code> æ–¹æ³•æ¥åˆ›å»ºã€‚ä¸€ä¸ª <code>net.Socket</code> å®ä¾‹æ—¢å¯ä»¥ä½œä¸ºå®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼‰ä¹Ÿå¯ä»¥ä½œä¸ºæœåŠ¡å™¨ç«¯æ¥å—çš„è¿æ¥ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p><strong>1. åˆ›å»º TCP å®¢æˆ·ç«¯</strong></p><p>å‡è®¾æˆ‘ä»¬æƒ³è¿æ¥åˆ°ä¸€ä¸ªè¿è¡Œåœ¨ç«¯å£ 12345 ä¸Šçš„ TCP æœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server! Love, Client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // kill client after server&#39;s response</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. åˆ›å»º TCP æœåŠ¡å™¨</strong></p><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ç¤ºä¾‹ï¼Œå®ƒç›‘å¬ç«¯å£ 12345 ä¸Šçš„è¿æ¥ï¼Œå¹¶å“åº”ä»»ä½•æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Echo server</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. ä½¿ç”¨ IPC è¿›è¡Œé€šä¿¡</strong></p><p>å¦‚æœä½ åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ IPC è€Œä¸æ˜¯ TCPã€‚è¿™é€šå¸¸é€šè¿‡å‘½åç®¡é“æˆ– Unix å¥—æ¥å­—å®ç°ã€‚åˆ›å»º IPC æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ä»£ç ä¸ TCP éå¸¸ç›¸ä¼¼ï¼Œä½†åœ¨è°ƒç”¨ <code>listen</code> æˆ– <code>connect</code> æ–¹æ³•æ—¶ï¼Œä½ ä¼šä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è€Œä¸æ˜¯ç«¯å£å·ã€‚</p><h3 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä½¿ç”¨ <code>net.Socket</code>ï¼Œä½ å¯ä»¥æ„å»ºå¤æ‚çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå®ç°æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„ä½çº§é€šä¿¡ã€‚è¿™äº›ç¤ºä¾‹ä»…ä»…æ˜¯å¼€å§‹ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å¤„ç†æ›´å¤æ‚çš„é€»è¾‘ï¼Œæ¯”å¦‚é”™è¯¯å¤„ç†ã€è¿æ¥é‡è¯•æœºåˆ¶ç­‰ã€‚å­¦ä¹ å’Œä½¿ç”¨ <code>net.Socket</code>ï¼Œä½ å¯ä»¥æ›´æ·±å…¥åœ°ç†è§£ç½‘ç»œé€šä¿¡çš„åŸç†ï¼Œä¸ºå¼€å‘æ›´é«˜çº§çš„ç½‘ç»œåº”ç”¨æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚</p><h3 id="new-net-socket-options" tabindex="-1"><a class="header-anchor" href="#new-net-socket-options"><span><a href="https://nodejs.org/docs/latest/api/net.html#new-netsocketoptions" target="_blank" rel="noopener noreferrer">new net.Socket([options])</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>net.Socket</code>æ˜¯ä¸€ä¸ªåŸºç¡€çš„ç½‘ç»œé€šä¿¡æ„å»ºå—ã€‚å®ƒç”¨äºåˆ›å»ºä¸€ä¸ªç½‘ç»œå¥—æ¥å­—ï¼Œå³ä¸€ä¸ªå¯ä»¥ç”¨æ¥è¯»å–å’Œå†™å…¥æ•°æ®çš„å¯¹è±¡ï¼Œç”¨äºåœ¨ç½‘ç»œä¸Šè¿›è¡Œé€šä¿¡ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>new net.Socket([options])</code>å…è®¸ä½ æ ¹æ®æä¾›çš„é€‰é¡¹æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Socket</code>å®ä¾‹ã€‚è¿™äº›é€‰é¡¹å¯ä»¥å¸®åŠ©ä½ é…ç½®å¥—æ¥å­—çš„ä¸åŒæ–¹é¢ï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸å¥—æ¥å­—ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œä»¥åŠæ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸Šä¼ è¾“ç­‰ã€‚</p><h3 id="new-net-socket-options-çš„é€‰é¡¹" tabindex="-1"><a class="header-anchor" href="#new-net-socket-options-çš„é€‰é¡¹"><span><code>new net.Socket([options])</code>çš„é€‰é¡¹</span></a></h3><p>å½“ä½ ä½¿ç”¨<code>new net.Socket([options])</code>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Socket</code>å®ä¾‹æ—¶ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªé€‰é¡¹å¯¹è±¡æ¥å®šåˆ¶å¥—æ¥å­—çš„è¡Œä¸ºã€‚è¿™ä¸ªé€‰é¡¹å¯¹è±¡æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä½ ä¸æä¾›ï¼Œé‚£ä¹ˆå°†ä¼šä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚é€‰é¡¹å¯¹è±¡å¯ä»¥åŒ…å«å¤šç§å±æ€§ï¼Œå¦‚<code>fd</code>ï¼ˆç”¨äºæŒ‡å®šä¸€ä¸ªé¢„å…ˆå­˜åœ¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€<code>allowHalfOpen</code>ï¼ˆå…è®¸åŠå¼€è¿æ¥ï¼Œå³åœ¨ä¸€ç«¯å…³é—­åä»ç„¶å¯ä»¥å‘é€æ•°æ®ï¼‰ã€<code>readable</code>å’Œ<code>writable</code>ï¼ˆåˆ†åˆ«æ§åˆ¶å¥—æ¥å­—çš„è¯»</p><h3 id="event-close-1" tabindex="-1"><a class="header-anchor" href="#event-close-1"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-close_1" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>Event: &#39;close&#39;</code> äº‹ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-event-close" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-event-close"><span>ä»€ä¹ˆæ˜¯ <code>Event: &#39;close&#39;</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½æ˜¯åŸºäºäº‹ä»¶çš„ã€‚è¿™æ„å‘³ç€è¿™äº›å¯¹è±¡èƒ½å¤Ÿå‘å‡ºï¼ˆè§¦å‘ï¼‰äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›‘å¬è¿™äº›äº‹ä»¶æ¥æ‰§è¡Œä»£ç ã€‚<code>Event: &#39;close&#39;</code> å°±æ˜¯è¿™æ ·ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒé€šå¸¸ä¸ Node.js ä¸­çš„ streams æˆ– sockets ç›¸å…³è”ã€‚</p><p>å½“ä¸€ä¸ª stream æˆ– socket å…³é—­æ—¶ï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶è¢«è§¦å‘ã€‚è¿™ä¸ªäº‹ä»¶å‘Šè¯‰ä½ ï¼Œç°åœ¨æ‰€æœ‰çš„æ“ä½œï¼ˆå¦‚ä¼ è¾“æ•°æ®ï¼‰éƒ½å·²ç»å®Œæˆï¼Œèµ„æºè¢«æ¸…ç†ï¼Œä¸ä¼šå†æœ‰æ›´å¤šçš„äº‹ä»¶å‘ç”Ÿäº†ã€‚</p><h3 id="å¦‚ä½•ç›‘å¬-event-close" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç›‘å¬-event-close"><span>å¦‚ä½•ç›‘å¬ <code>Event: &#39;close&#39;</code>ï¼Ÿ</span></a></h3><p>è¦ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ éœ€è¦å…ˆæœ‰ä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼ˆæ¯”å¦‚ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œæˆ–æ˜¯ä¸€ä¸ªæ–‡ä»¶æµï¼‰ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>.on()</code> æ–¹æ³•ä¾¦å¬ <code>&#39;close&#39;</code> äº‹ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè¯»å–æµ</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;close&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File stream closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè¯»å–æµï¼Œç”¨äºä»åä¸º <code>example.txt</code> çš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä¸€æ—¦è¯»å–æ“ä½œå®Œæˆï¼Œå¹¶ä¸”æµå…³é—­ï¼Œå°±ä¼šè§¦å‘ <code>&#39;close&#39;</code> äº‹ä»¶ï¼Œéšåæ‰“å°ä¿¡æ¯åˆ°æ§åˆ¶å°ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-1"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><h4 id="åœºæ™¯-1-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯-1-http-æœåŠ¡å™¨"><span>åœºæ™¯ 1ï¼šHTTP æœåŠ¡å™¨</span></a></h4><p>å½“ä½ åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯è¯·æ±‚ç»“æŸæ—¶ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“è¿æ¥ä½•æ—¶å…³é—­ã€‚è¿™å¯¹äºé‡Šæ”¾èµ„æºæˆ–è€…è¿›è¡Œæ¸…ç†å·¥ä½œéå¸¸æœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A new connection has been established.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æ–°çš„å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šè®¾ç½®ä¸€ä¸ªç›‘å¬å™¨æ¥ç›‘å¬ <code>close</code> äº‹ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—çŸ¥å®¢æˆ·ç«¯ä½•æ—¶æ–­å¼€è¿æ¥ã€‚</p><h4 id="åœºæ™¯-2-æ•°æ®åº“è¿æ¥" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯-2-æ•°æ®åº“è¿æ¥"><span>åœºæ™¯ 2ï¼šæ•°æ®åº“è¿æ¥</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js æ¥ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚å½“ä½ å®Œæˆæ‰€æœ‰æ•°æ®åº“æ“ä½œå¹¶å…³é—­è¿æ¥æ—¶ï¼Œç›‘å¬ <code>close</code> äº‹ä»¶å¯ä»¥å¸®åŠ©ç¡®è®¤è¿æ¥ç¡®å®å·²ç»å…³é—­ï¼Œè¿™å¯¹äºç»´æŠ¤è¿æ¥æ± ç‰¹åˆ«é‡è¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾ db æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥å®ä¾‹</span></span>
<span class="line"><span style="color:#D8DEE9;">db</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Database connection closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨é€‚å½“çš„æ—¶å€™å…³é—­æ•°æ®åº“è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">db</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°ç¤ºä¾‹åŠè§£é‡Šï¼Œå¸Œæœ›ä½ å¯¹ Node.js ä¸­çš„ <code>Event: &#39;close&#39;</code> æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚å®ƒæ˜¯å¤„ç†å¼‚æ­¥æ“ä½œå’Œèµ„æºç®¡ç†æ—¶éå¸¸æœ‰ç”¨çš„äº‹ä»¶ä¹‹ä¸€ã€‚</p><h3 id="event-connect" tabindex="-1"><a class="header-anchor" href="#event-connect"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-connect" target="_blank" rel="noopener noreferrer">Event: &#39;connect&#39;</a></span></a></h3><p>Node.js çš„ <code>connect</code> äº‹ä»¶æ˜¯åœ¨ä½¿ç”¨ Node.js çš„ <code>net</code> æ¨¡å—å»ºç«‹ TCP å®¢æˆ·ç«¯æ—¶éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µã€‚è¿™ä¸ªäº‹ä»¶ä¸»è¦ç”¨äºæŒ‡ç¤ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å·²ç»æˆåŠŸå»ºç«‹ã€‚åœ¨å®è·µä¸­ï¼Œ<code>connect</code> äº‹ä»¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ç¡®ä¿ç½‘ç»œè¿æ¥å·²ç»å‡†å¤‡å¥½ä¹‹åï¼Œå¼€å§‹è¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚</p><h3 id="ç†è§£-connect-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç†è§£-connect-äº‹ä»¶"><span>ç†è§£ <code>connect</code> äº‹ä»¶</span></a></h3><p>å½“ä½ åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ <code>net.createConnection</code> æ–¹æ³•ï¼‰æ—¶ï¼ŒNode.js ä¼šå°è¯•ä¸æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£å»ºç«‹è¿æ¥ã€‚ä¸€æ—¦è¿æ¥æˆåŠŸå»ºç«‹ï¼Œå°±ä¼šè§¦å‘ <code>connect</code> äº‹ä»¶ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥å®‰å…¨åœ°å‡è®¾ç½‘ç»œè¿æ¥æ˜¯å¼€æ”¾çš„ï¼Œå¹¶å¼€å§‹é€šè¿‡è¿™ä¸ªè¿æ¥å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ª-tcp-å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ª-tcp-å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1ï¼šåˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿è¡Œåœ¨ æœ¬åœ°ä¸»æœºï¼ˆlocalhostï¼‰çš„ TCP æœåŠ¡å™¨ï¼Œç›‘å¬ 12345 ç«¯å£ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯å¹¶ç›‘å¬ <code>connect</code> äº‹ä»¶çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // &#39;connect&#39; äº‹ä»¶çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;connect&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥æˆåŠŸï¼Œç°åœ¨å¯ä»¥å®‰å…¨åœ°å‘é€æ•°æ®äº†ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å¤„ç†è¿æ¥åçš„æ•°æ®å‘é€å’Œæ¥æ”¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¤„ç†è¿æ¥åçš„æ•°æ®å‘é€å’Œæ¥æ”¶"><span>ç¤ºä¾‹ 2ï¼šå¤„ç†è¿æ¥åçš„æ•°æ®å‘é€å’Œæ¥æ”¶</span></a></h4><p>åœ¨è¿æ¥å»ºç«‹ä¹‹åï¼Œä½ å¯èƒ½æƒ³è¦ç«‹å³å‘æœåŠ¡å™¨å‘é€ä¸€äº›æ•°æ®ï¼Œç„¶åå¤„ç†æœåŠ¡å™¨çš„å“åº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥æˆåŠŸï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€æ•°æ®åˆ°æœåŠ¡å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¯´ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“æœåŠ¡å™¨å…³é—­è¿æ¥æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å…³é—­äº†è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°ç»“-8" tabindex="-1"><a class="header-anchor" href="#å°ç»“-8"><span>å°ç»“</span></a></h3><p>é€šè¿‡ç›‘å¬ <code>connect</code> äº‹ä»¶ï¼ŒNode.js åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ç¡®ä¿ç½‘ç»œè¿æ¥å·²ç»å»ºç«‹å¹¶å‡†å¤‡å°±ç»ªä¹‹åï¼Œè¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚è¿™æ˜¯ç½‘ç»œç¼–ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦æ­¥éª¤ï¼Œç¡®ä¿äº†ç¨‹åºçš„å¥å£®æ€§å’Œæ•ˆç‡ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºå“åº”è¿…é€Ÿã€å¯é çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><h3 id="event-connectionattempt" tabindex="-1"><a class="header-anchor" href="#event-connectionattempt"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-connectionattempt" target="_blank" rel="noopener noreferrer">Event: &#39;connectionAttempt&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œå…¶ä¸­<code>net</code>æ¨¡å—å°±æ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ“ä½œï¼Œå¦‚åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡ç­‰ã€‚</p><p>åœ¨<code>net</code>æ¨¡å—ä¸­ï¼Œæœ‰ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶å«åš<code>&#39;connectionAttempt&#39;</code>ã€‚è¿™ä¸ªäº‹ä»¶åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Node.jsï¼ˆå¦‚ä½ æåˆ°çš„ v21.7.1ï¼‰ä¸­è¢«å¼•å…¥ï¼Œç”¨äºç›‘å¬ TCP æœåŠ¡å™¨ä¸Šçš„è¿æ¥å°è¯•ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-connectionattempt-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-connectionattempt-äº‹ä»¶"><span>ä»€ä¹ˆæ˜¯ <code>&#39;connectionAttempt&#39;</code> äº‹ä»¶ï¼Ÿ</span></a></h3><p>å½“æŸä¸ªå®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°ç”± Node.js <code>net</code>æ¨¡å—åˆ›å»ºçš„ TCP æœåŠ¡å™¨æ—¶ï¼Œå°±ä¼šè§¦å‘<code>&#39;connectionAttempt&#39;</code>äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªæœºä¼šï¼Œè®©ä»–ä»¬åœ¨è¿æ¥è¢«æ¥å—ä¹‹å‰çŸ¥é“æœ‰ä¸€ä¸ªè¿æ¥å°è¯•æ­£åœ¨è¿›è¡Œã€‚è¿™å¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€å®‰å…¨å®¡æ ¸ã€é™æµç­‰ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-connectionattempt-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-connectionattempt-äº‹ä»¶"><span>å¦‚ä½•ä½¿ç”¨ <code>&#39;connectionAttempt&#39;</code> äº‹ä»¶ï¼Ÿ</span></a></h3><p>è¦ä½¿ç”¨æ­¤äº‹ä»¶ï¼Œä½ é¦–å…ˆéœ€è¦ä½¿ç”¨<code>net</code>æ¨¡å—åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ç›‘å¬<code>&#39;connectionAttempt&#39;</code>äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;connectionAttempt&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connectionAttempt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> info</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœ‰ä¸€ä¸ªè¿æ¥å°è¯•ä» </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">info</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">info</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—æˆ–è€…å†³å®šæ˜¯å¦æ‹’ç»è¿™ä¸ªè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬æŒ‡å®šç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨å¹¶å¼€å§‹ç›‘å¬æœ¬åœ°çš„ 3000 ç«¯å£ã€‚å½“æœ‰ä»»ä½•è¿æ¥å°è¯•æ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ§åˆ¶å°è¾“å‡ºè¿œç¨‹å®¢æˆ·ç«¯çš„åœ°å€å’Œç«¯å£ä¿¡æ¯ã€‚è¿™åªæ˜¯ä¸€ä¸ªåŸºç¡€çš„ç¤ºèŒƒï¼Œå®é™…åº”ç”¨ä¸­ä½ å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œæ›´å¤æ‚çš„é€»è¾‘å¤„ç†ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-2"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ul><li><strong>å®‰å…¨å®¡è®¡</strong>ï¼šé€šè¿‡ç›‘å¬<code>&#39;connectionAttempt&#39;</code>äº‹ä»¶ï¼Œå¯ä»¥è®°å½•æ‰€æœ‰å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œå¸®åŠ©è¯†åˆ«æ½œåœ¨çš„æœªæˆæƒè®¿é—®å°è¯•ã€‚</li><li><strong>é™æµ</strong>ï¼šå¦‚æœä½ çš„æœåŠ¡å™¨é¢ä¸´è¿‡é«˜çš„è¿æ¥å°è¯•é¢‘ç‡ï¼Œå¯èƒ½éœ€è¦å®æ–½é™æµæªæ–½ã€‚é€šè¿‡æ£€æµ‹è¿æ¥å°è¯•çš„é¢‘ç‡ï¼Œå¯ä»¥å†³å®šæ˜¯å¦ç«‹å³æ‹’ç»æŸäº›è¿æ¥ï¼Œä»¥ä¿æŠ¤æœåŠ¡ç¨³å®šè¿è¡Œã€‚</li><li><strong>é»‘åå•/ç™½åå•</strong>ï¼šåŸºäºæ¥æº IP çš„é»‘åå•æˆ–ç™½åå•ï¼Œå¯ä»¥åœ¨è¿æ¥å°è¯•æ—¶å†³å®šæ˜¯å¦æ¥å—è¯¥è¿æ¥ã€‚è¿™å¯¹äºé˜²æ­¢æ¶æ„è®¿é—®æˆ–åªå…è®¸ç‰¹å®šç”¨æˆ·è®¿é—®æœåŠ¡éå¸¸æœ‰ç”¨ã€‚</li></ul><p>é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œ<code>&#39;connectionAttempt&#39;</code>äº‹ä»¶ä½¿å¾— Node.js å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´åŠ çµæ´»åœ°ç®¡ç†å’Œæ§åˆ¶å¯¹ TCP æœåŠ¡å™¨çš„è®¿é—®ï¼Œå¢å¼ºäº†åº”ç”¨çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</p><h3 id="event-connectionattemptfailed" tabindex="-1"><a class="header-anchor" href="#event-connectionattemptfailed"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-connectionattemptfailed" target="_blank" rel="noopener noreferrer">Event: &#39;connectionAttemptFailed&#39;</a></span></a></h3><p>ç†è§£ Node.js ä¸­çš„<code>&#39;connectionAttemptFailed&#39;</code>äº‹ä»¶ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“å®ƒå±äº<code>net</code>æ¨¡å—ã€‚<code>net</code>æ¨¡å—æ˜¯ Node.js ç”¨äºç½‘ç»œæ“ä½œçš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œæ¯”å¦‚åˆ›å»ºæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ç­‰ã€‚è¿™ä¸ªæ¨¡å—å…è®¸ä½ å®ç°åº•å±‚ç½‘ç»œé€šä¿¡ã€‚</p><h3 id="è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-1"><span>è§£é‡Š</span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>&#39;connectionAttemptFailed&#39;</code>äº‹ä»¶æ˜¯<code>net</code>æ¨¡å—æ–°åŠ å…¥çš„ä¸€ä¸ªç‰¹æ€§ã€‚å½“ä½ ä½¿ç”¨<code>net</code>æ¨¡å—å°è¯•å»ºç«‹è¿æ¥ï¼Œä½†è¿æ¥å°è¯•å¤±è´¥æ—¶ï¼Œå°†ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚è¿™å¯¹äºå¤„ç†å’Œå“åº”ç½‘ç»œè¿æ¥é—®é¢˜éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©å¼€å‘è€…çŸ¥é“æŸæ¬¡è¿æ¥å°è¯•æ²¡æœ‰æˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥è·å–åˆ°å¤±è´¥çš„è¯¦æƒ…ã€‚</p><h3 id="å®é™…è¿ç”¨å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨å®ä¾‹"><span>å®é™…è¿ç”¨å®ä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºéœ€è¦è¿æ¥åˆ°ä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨è·å–æ•°æ®ã€‚ä½¿ç”¨ Node.js çš„<code>net</code>æ¨¡å—ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¥å°è¯•ä¸æœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªsocketï¼ˆæ’åº§ï¼‰å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8124</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // &#39;connect&#39; ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼ŒæœåŠ¡å™¨ï¼</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²ä»æœåŠ¡å™¨æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;connectionAttemptFailed&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connectionAttemptFailed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å°è¯•å¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯ï¼Œå®ƒå°è¯•é€šè¿‡ TCP è¿æ¥åˆ°æŒ‡å®šç«¯å£ï¼ˆä¾‹å¦‚ 8124ï¼‰ä¸Šçš„æœåŠ¡å™¨ã€‚å¦‚æœè¿æ¥æˆåŠŸï¼Œå®ƒä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿç›‘å¬äº†<code>&#39;connectionAttemptFailed&#39;</code>äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨è¿æ¥å°è¯•å¤±è´¥æ—¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœå‡ºç°äº†è¿æ¥å¤±è´¥çš„æƒ…å†µï¼Œæ¯”å¦‚ç›®æ ‡æœåŠ¡å™¨ä¸å¯è¾¾ï¼Œç«¯å£é”™è¯¯ï¼Œæˆ–è€…ä»»ä½•å¯¼è‡´ TCP è¿æ¥å»ºç«‹å¤±è´¥çš„åŸå› ï¼Œ<code>&#39;connectionAttemptFailed&#39;</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œå¹¶æ‰“å°å‡ºå¤±è´¥çš„åŸå› ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå®ƒä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´å¥½åœ°ç®¡ç†å’Œè°ƒè¯•ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæä¾›äº†æ›´å¤šçš„æ§åˆ¶å’Œåé¦ˆæœºåˆ¶æ¥å¤„ç†ç½‘ç»œè¿æ¥çš„å„ç§æƒ…å†µã€‚</p><h3 id="event-connectionattempttimeout" tabindex="-1"><a class="header-anchor" href="#event-connectionattempttimeout"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-connectionattempttimeout" target="_blank" rel="noopener noreferrer">Event: &#39;connectionAttemptTimeout&#39;</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>&#39;connectionAttemptTimeout&#39;</code>äº‹ä»¶æ˜¯ä¸ç½‘ç»œæ“ä½œç›¸å…³çš„ä¸€ä¸ªç‰¹å®šäº‹ä»¶ï¼Œå®ƒå±äº<code>net</code>æ¨¡å—ã€‚è¿™ä¸ªäº‹ä»¶æ˜¯åœ¨å°è¯•å»ºç«‹ç½‘ç»œè¿æ¥æ—¶ï¼Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šçš„æ—¶é—´é™åˆ¶è¿˜æ²¡æœ‰æˆåŠŸå»ºç«‹è¿æ¥ï¼Œå°±ä¼šè¢«è§¦å‘ã€‚</p><p>ä¸ºäº†ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹<code>net</code>æ¨¡å—çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å’Œåœºæ™¯ã€‚</p><h3 id="netæ¨¡å—ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#netæ¨¡å—ç®€ä»‹"><span><code>net</code>æ¨¡å—ç®€ä»‹</span></a></h3><p><code>net</code>æ¨¡å—æä¾›äº†å¼‚æ­¥ç½‘ç»œåŒ…è£…å™¨ï¼Œç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC æœåŠ¡å™¨(<code>net.createServer()</code>)å’Œå®¢æˆ·ç«¯(<code>net.createConnection()</code>)ã€‚è¿™ä¸ªæ¨¡å—è¢«å¹¿æ³›ç”¨äºéœ€è¦ç½‘ç»œé€šä¿¡çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨ã€å®¢æˆ·ç«¯è¯·æ±‚ã€å®æ—¶æ•°æ®ä¼ è¾“åº”ç”¨ç­‰ã€‚</p><h3 id="connectionattempttimeout-äº‹ä»¶åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#connectionattempttimeout-äº‹ä»¶åº”ç”¨åœºæ™¯"><span><code>connectionAttemptTimeout</code> äº‹ä»¶åº”ç”¨åœºæ™¯</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨å…è®¸ç”¨æˆ·é€šè¿‡ä½ çš„æœåŠ¡å™¨ä¸å…¶ä»–ç”¨æˆ·è¿›è¡Œå®æ—¶é€šä¿¡ã€‚ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œä½ çš„æœåŠ¡å™¨éœ€è¦ä¸æ–­æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚ä½¿ç”¨ Node.js çš„<code>net</code>æ¨¡å—ï¼Œä½ å¯ä»¥è½»æ¾åœ°åˆ›å»ºè¿™æ ·çš„æœåŠ¡å™¨ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œç½‘ç»œè¿æ¥å¯èƒ½ç”±äºå„ç§åŸå› ï¼ˆå¦‚ç½‘ç»œæ‹¥å µã€ç›®æ ‡æœåŠ¡å™¨å“åº”ç¼“æ…¢ã€å®¢æˆ·ç«¯ç½‘ç»œè®¾ç½®é—®é¢˜ç­‰ï¼‰å¯¼è‡´è¿æ¥å»¶è¿Ÿæˆ–å¤±è´¥ã€‚å¦‚æœä¸€ä¸ªè¿æ¥å°è¯•é•¿æ—¶é—´æœªèƒ½æˆåŠŸï¼Œå®ƒä¸ä»…ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œè¿˜å¯èƒ½å ç”¨æœåŠ¡å™¨èµ„æºï¼Œå½±å“æœåŠ¡å™¨çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><p>ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼ŒNode.js å…è®¸ä½ è®¾ç½®ä¸€ä¸ªè¿æ¥å°è¯•çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œè¿æ¥æ²¡æœ‰æˆåŠŸå»ºç«‹ï¼Œ<code>&#39;connectionAttemptTimeout&#39;</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ç¼–å†™ä»£ç æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œæ¯”å¦‚å…³é—­è¿™æ¬¡è¿æ¥å°è¯•ï¼Œå¹¶å‘ç”¨æˆ·åé¦ˆâ€œè¿æ¥è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•â€ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -2"><span>ç¤ºä¾‹ä»£ç </span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connectionAttemptTimeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å°è¯•è¶…æ—¶ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œæ¯”å¦‚ç»“æŸ socket è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 3000...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç›‘å¬ç«¯å£ 3000 ä¸Šçš„è¿æ¥è¯·æ±‚ã€‚å¦‚æœæœ‰è¿æ¥å°è¯•è¶…è¿‡äº†è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼Œå°±ä¼šè§¦å‘ <code>&#39;connectionAttemptTimeout&#39;</code> äº‹ä»¶ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚æ‰“å°ä¸€æ¡æ—¥å¿—ä¿¡æ¯ï¼Œå¹¶ç»“æŸè¿™æ¬¡è¿æ¥å°è¯•ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¦æ­£ç¡®å¤„ç†å’Œè§¦å‘æ­¤äº‹ä»¶ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å®é™…åº”ç”¨åœºæ™¯è°ƒæ•´ä»£ç ï¼Œå¹¶ç¡®ä¿è®¾ç½®äº†è¿æ¥å°è¯•çš„è¶…æ—¶æ—¶é—´ã€‚</p><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p>ç†è§£å¹¶ä½¿ç”¨<code>&#39;connectionAttemptTimeout&#39;</code>äº‹ä»¶å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶å’Œç®¡ç†ç½‘ç»œè¿æ¥å°è¯•ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä¿æŒåº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œå“åº”é€Ÿåº¦ã€‚é€šè¿‡åˆç†è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå¹¶é’ˆå¯¹è¶…æ—¶äº‹ä»¶è¿›è¡Œæ°å½“å¤„ç†ï¼Œä½ çš„åº”ç”¨å°†èƒ½æ›´é²æ£’åœ°å¤„ç†ç½‘ç»œæ³¢åŠ¨å’Œå¼‚å¸¸æƒ…å†µã€‚</p><h3 id="event-data" tabindex="-1"><a class="header-anchor" href="#event-data"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-data" target="_blank" rel="noopener noreferrer">Event: &#39;data&#39;</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>&#39;data&#39;</code>äº‹ä»¶æ˜¯ä¸€ä¸ªéå¸¸æ ¸é‡è¦çš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç½‘ç»œæ“ä½œå’Œæ•°æ®æµï¼ˆstreamsï¼‰æ—¶ã€‚è¿™ä¸ªäº‹ä»¶è®©æˆ‘ä»¬èƒ½å¤Ÿä»¥éé˜»å¡ï¼ˆå¼‚æ­¥ï¼‰çš„æ–¹å¼å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ï¼Œè¿™å¯¹äºæ„å»ºé«˜æ•ˆçš„ç½‘ç»œåº”ç”¨å’ŒæœåŠ¡éå¸¸å…³é”®ã€‚æˆ‘ä¼šå°½é‡é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼Œå¹¶ç»™å‡ºå‡ ä¸ªå®é™…çš„ä¾‹å­ã€‚</p><h3 id="event-data-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#event-data-è¯¦è§£"><span><code>Event: &#39;data&#39;</code> è¯¦è§£</span></a></h3><p>åœ¨ Node.js çš„<code>net</code>æ¨¡å—ä¸­ï¼Œ<code>&#39;data&#39;</code>äº‹ä»¶ç”¨äºè¡¨ç¤ºæµï¼ˆstreamï¼‰æ¥æ”¶åˆ°äº†æ–°çš„æ•°æ®å—ã€‚è¿™ä¸ªäº‹ä»¶ä¸»è¦ç”¨åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œä¾‹å¦‚å»ºç«‹ä¸€ä¸ª TCP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ã€‚å½“æ•°æ®é€šè¿‡ç½‘ç»œå‘é€åˆ° Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œæ•°æ®æµä¼šè§¦å‘<code>&#39;data&#39;</code>äº‹ä»¶ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®ä½œä¸ºäº‹ä»¶çš„å‚æ•°ä¼ é€’ç»™ç›‘å¬å‡½æ•°ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-1"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>åˆ›å»º TCP æœåŠ¡å™¨</strong>ï¼šå½“ä½ åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨å¹¶ä¸”å®¢æˆ·ç«¯è¿æ¥ä¸Šå¹¶å‘é€æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ç›‘å¬<code>&#39;data&#39;</code>äº‹ä»¶æ¥æ¥æ”¶è¿™äº›æ•°æ®ã€‚</p></li><li><p><strong>è¯»å–æ•°æ®æµ</strong>ï¼šåœ¨å¤„ç†æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰åœºæ™¯æ—¶ï¼Œå¯ä»¥ç›‘å¬æ•°æ®æµçš„<code>&#39;data&#39;</code>äº‹ä»¶æ¥é€å—å¤„ç†æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æé«˜åº”ç”¨æ€§èƒ½ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚</p></li></ol><h3 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­"><span>ä¾‹å­</span></a></h3><h4 id="åˆ›å»ºç®€å•çš„-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç®€å•çš„-tcp-æœåŠ¡å™¨"><span>åˆ›å»ºç®€å•çš„ TCP æœåŠ¡å™¨</span></a></h4><p>è®©æˆ‘ä»¬ä»¥åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ä¸ºä¾‹ï¼Œæ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨<code>&#39;data&#39;</code>äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªTCPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬&#39;data&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ¥æ”¶åˆ°æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬åœ¨æœ¬åœ°çš„7000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">7000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨åœ¨7000ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬æœ¬åœ°çš„ 7000 ç«¯å£ã€‚æ¯å½“æœ‰å®¢æˆ·ç«¯è¿æ¥å¹¶å‘é€æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šæ¥æ”¶åˆ°è¿™äº›æ•°æ®ï¼Œå¹¶é€šè¿‡ç›‘å¬<code>&#39;data&#39;</code>äº‹ä»¶æ¥æ‰“å°è¿™äº›æ•°æ®ã€‚</p><h4 id="è¯»å–æ–‡ä»¶æ•°æ®æµ" tabindex="-1"><a class="header-anchor" href="#è¯»å–æ–‡ä»¶æ•°æ®æµ"><span>è¯»å–æ–‡ä»¶æ•°æ®æµ</span></a></h4><p><code>&#39;data&#39;</code>äº‹ä»¶ä¹Ÿå¯ä»¥ç”¨äºè¯»å–æ–‡ä»¶æ•°æ®æµã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•è¯»å–æ–‡ä»¶å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readableStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;data&#39;äº‹ä»¶æ¥è¯»å–æ•°æ®å—</span></span>
<span class="line"><span style="color:#D8DEE9;">readableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ¥æ”¶åˆ° </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">length</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> å­—èŠ‚çš„æ•°æ®</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ²¡æœ‰æ›´å¤šçš„æ•°æ®</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>fs.createReadStream</code>åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘<code>example.txt</code>æ–‡ä»¶çš„å¯è¯»æµã€‚ç„¶åï¼Œæˆ‘ä»¬ç›‘å¬è¿™ä¸ªæµçš„<code>&#39;data&#39;</code>äº‹ä»¶æ¥é€å—æ¥æ”¶æ–‡ä»¶æ•°æ®ã€‚å½“æ–‡ä»¶ä¸­æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»æ—¶ï¼Œä¼šè§¦å‘<code>&#39;end&#39;</code>äº‹ä»¶ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>&#39;data&#39;</code>äº‹ä»¶åœ¨ Node.js ä¸­æ˜¯å¤„ç†å¼‚æ­¥æ•°æ®æµçš„æ ¸å¿ƒæœºåˆ¶ï¼Œæ— è®ºæ˜¯åœ¨ç½‘ç»œé€šä¿¡è¿˜æ˜¯æ–‡ä»¶è¯»å†™ä¸­éƒ½éå¸¸æœ‰ç”¨ã€‚é€šè¿‡ç›‘å¬<code>&#39;data&#39;</code>äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é«˜æ•ˆã€çµæ´»åœ°å¤„ç†æ•°æ®ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¿«é€Ÿçš„å“åº”å’Œæ›´å¥½çš„ä½“éªŒã€‚</p><h3 id="event-drain" tabindex="-1"><a class="header-anchor" href="#event-drain"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-drain" target="_blank" rel="noopener noreferrer">Event: &#39;drain&#39;</a></span></a></h3><p>Node.js çš„ <code>&#39;drain&#39;</code> äº‹ä»¶æ˜¯åœ¨å¤„ç†æµå’Œç½‘ç»œé€šä¿¡æ—¶ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä¸å¦‚ä½•é«˜æ•ˆåœ°å¤„ç†æ•°æ®æµç›´æ¥ç›¸å…³ã€‚ä¸ºäº†ç†è§£ <code>&#39;drain&#39;</code> äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº› Node.js ä¸­æµï¼ˆStreamï¼‰å’Œç¼“å†²ï¼ˆBufferï¼‰çš„åŸºç¡€çŸ¥è¯†ã€‚</p><h3 id="æµ-stream-å’Œç¼“å†²-buffer" tabindex="-1"><a class="header-anchor" href="#æµ-stream-å’Œç¼“å†²-buffer"><span>æµï¼ˆStreamï¼‰å’Œç¼“å†²ï¼ˆBufferï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„ä¸€ç§æŠ½è±¡æœºåˆ¶ï¼Œå¦‚è¯»å–æ•°æ®æˆ–å†™å…¥æ•°æ®ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„æˆ–ä¸¤è€…éƒ½æ˜¯ï¼ˆå³åŒå‘æµï¼‰ã€‚å½“æˆ‘ä»¬å¤„ç†æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰æ“ä½œæ—¶ï¼Œæµéƒ½æ‰®æ¼”äº†é‡è¦è§’è‰²ã€‚</p><p>ç¼“å†²åŒºï¼ˆBufferï¼‰æ˜¯ä¸€å°å—å†…å­˜ï¼Œç”¨äºæš‚æ—¶å­˜å‚¨åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚åœ¨å†™å…¥æ•°æ®åˆ°ç›®æ ‡ï¼ˆæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå¥—æ¥å­—ç­‰ï¼‰æ—¶ï¼Œå¦‚æœç›®æ ‡æ— æ³•ç«‹å³å¤„ç†æ›´å¤šæ•°æ®ï¼Œè¿™äº›æ•°æ®å°±ä¼šè¢«æš‚æ—¶å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ã€‚</p><h3 id="drain-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#drain-äº‹ä»¶"><span><code>drain</code> äº‹ä»¶</span></a></h3><p><code>&#39;drain&#39;</code> äº‹ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶ï¼Œå®ƒå±äºå¯å†™æµï¼ˆWritable Streamï¼‰çš„ä¸€éƒ¨åˆ†ã€‚å½“ä½ å‘ä¸€ä¸ªæµå†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå†…éƒ¨çš„ç¼“å†²åŒºè¢«å¡«æ»¡äº†ï¼Œé‚£ä¹ˆå†™å…¥æ“ä½œï¼ˆ<code>write</code> æ–¹æ³•ï¼‰ä¼šè¿”å› <code>false</code>ï¼Œè¡¨ç¤ºæš‚æ—¶ä¸åº”è¯¥ç»§ç»­å¾€æµä¸­å†™å…¥æ›´å¤šæ•°æ®ã€‚è¿™æ˜¯å› ä¸ºç»§ç»­å†™å…¥å¯èƒ½ä¼šå¯¼è‡´å†…å­˜è¿‡åº¦ä½¿ç”¨æˆ–åº”ç”¨ç¨‹åºæ€§èƒ½ä¸‹é™ã€‚</p><p>å½“ç¼“å†²åŒºä¸­çš„æ•°æ®è¢«æ¶ˆè´¹ï¼ˆä¹Ÿå°±æ˜¯æ•°æ®å·²ç»è¢«å‘é€åˆ°ç›®æ ‡ï¼‰åï¼Œå¦‚æœæµä¹‹å‰å› ä¸ºç¼“å†²åŒºæ»¡è€Œæ— æ³•å†™å…¥æ›´å¤šæ•°æ®ï¼Œé‚£ä¹ˆ <code>&#39;drain&#39;</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚è¿™ä¸ªäº‹ä»¶çš„è§¦å‘å‘Šè¯‰æˆ‘ä»¬ï¼šç°åœ¨å¯ä»¥å®‰å…¨åœ°ç»§ç»­å‘æµä¸­å†™å…¥æ›´å¤šæ•°æ®äº†ï¼Œä¸ä¼šå¯¼è‡´è¿‡åº¦ç¼“å†²ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ä¾‹å­-1-å†™å…¥å¤§æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å†™å…¥å¤§æ–‡ä»¶"><span>ä¾‹å­ 1ï¼šå†™å…¥å¤§æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æƒ³å°†å¤§é‡æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œä½†åˆä¸æƒ³ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½ å¯ä»¥ç›‘å¬ <code>&#39;drain&#39;</code> äº‹ä»¶æ¥åˆ†æ‰¹å†™å…¥æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> writable</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¤§æ–‡ä»¶.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ dataChunks æ˜¯ä¸€ä¸ªåŒ…å«å¤§é‡æ•°æ®å—çš„æ•°ç»„</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> dataChunks</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // å¦‚æœå†™å…¥æµè¿”å› falseï¼Œè¡¨ç¤ºå†…éƒ¨ç¼“å†²åŒºå·²æ»¡</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">writable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // ç­‰å¾… drain äº‹ä»¶å†ç»§ç»­å†™å…¥</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> writable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">drain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resolve</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-ç½‘ç»œé€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç½‘ç»œé€šä¿¡"><span>ä¾‹å­ 2ï¼šç½‘ç»œé€šä¿¡</span></a></h4><p>åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ®ï¼Œå¯èƒ½ä¹Ÿä¼šé‡åˆ°ç¼“å†²åŒºæ»¡çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ <code>&#39;drain&#39;</code> äº‹ä»¶æ¥æ§åˆ¶æ•°æ®æµæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">drain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç°åœ¨å¯ä»¥ç»§ç»­å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯äº†</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // åœ¨è¿™é‡Œç»§ç»­å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•°è´Ÿè´£è·å–æ•°æ®å¹¶å‘é€ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#88C0D0;">  sendData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> sendData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  while</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#88C0D0;">needMoreData</span><span style="color:#D8DEE9FF;">()) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœ socket.write è¿”å› falseï¼Œåœæ­¢å‘é€æ•°æ®ï¼Œç­‰å¾… drain äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">getMoreData</span><span style="color:#D8DEE9FF;">())) </span><span style="color:#81A1C1;">break;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ç›‘å¬ <code>&#39;drain&#39;</code> äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å ç”¨è¿‡å¤šå†…å­˜å’Œä¿æŒåº”ç”¨æ€§èƒ½çš„åŒæ—¶ï¼Œé«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ã€‚</p><h3 id="event-end" tabindex="-1"><a class="header-anchor" href="#event-end"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-end" target="_blank" rel="noopener noreferrer">Event: &#39;end&#39;</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ç®€å•æ·±å…¥åœ°ç†è§£ Node.js ä¸­çš„ <code>Event: &#39;end&#39;</code> äº‹ä»¶ã€‚ä¸ºäº†ä½¿è¿™ä¸ªæ¦‚å¿µæ˜“äºç†è§£ï¼Œæˆ‘ä¼šå…ˆä»‹ç»ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œç„¶åé€šè¿‡å®ä¾‹æ¥å…·ä½“è¯´æ˜ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js å¤§é‡ä½¿ç”¨äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼Œè¿™æ„å‘³ç€ç¨‹åºæµæ˜¯é€šè¿‡äº‹ä»¶è§¦å‘çš„ã€‚å…¶ä¸­ï¼Œâ€œäº‹ä»¶â€å¯ä»¥æ˜¯ä»»ä½•äº‹æƒ…ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å–å®Œæˆã€æ–°çš„ç½‘ç»œè¿æ¥å»ºç«‹æˆ–è€…è¿æ¥ç»“æŸç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>net</code> æ¨¡å—æä¾›äº†ç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰æœåŠ¡å™¨ï¼ˆnet.Serverï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆnet.Socketï¼‰çš„åŠŸèƒ½ã€‚</p><h3 id="event-end-1" tabindex="-1"><a class="header-anchor" href="#event-end-1"><span>Event: &#39;end&#39;</span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ° <code>Event: &#39;end&#39;</code>ï¼Œç‰¹æŒ‡åœ¨ä¸€ä¸ªæµï¼ˆæ¯”å¦‚ TCP æµï¼‰ä¸Šè§¦å‘çš„äº‹ä»¶ï¼Œè¡¨ç¤ºæµçš„å¦ä¸€ç«¯å‘é€äº†ä¸€ä¸ª FIN åŒ…ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ›´å¤šçš„æ•°æ®è¦å‘é€äº†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªäº‹ä»¶å‘Šè¯‰ä½ ï¼šâ€œæ•°æ®ä¼ è¾“å®Œæˆäº†ï¼Œè¿æ¥å³å°†å…³é—­ã€‚â€</p><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-tcp-èŠå¤©æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-tcp-èŠå¤©æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1ï¼šTCP èŠå¤©æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP èŠå¤©æœåŠ¡å™¨ï¼Œå…è®¸å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å¹¶äº’ç›¸å‘é€æ¶ˆæ¯ã€‚å½“ä¸€ä¸ªå®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œä½ å¯èƒ½æƒ³é€šçŸ¥å…¶å®ƒå®¢æˆ·ç«¯è¯¥ç”¨æˆ·å·²ç¦»å¼€èŠå¤©å®¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç›‘å¬ <code>end</code> äº‹ä»¶æ¥æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º TCP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æ–°ç”¨æˆ·è¿æ¥æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A user connected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬æ•°æ®æ¥æ”¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Data from user: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬ end äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A user disconnected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å¯ä»¥åœ¨è¿™é‡Œé€šçŸ¥å…¶ä»–ç”¨æˆ·</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-æ–‡ä»¶ä¼ è¾“æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ–‡ä»¶ä¼ è¾“æœåŠ¡"><span>ç¤ºä¾‹ 2ï¼šæ–‡ä»¶ä¼ è¾“æœåŠ¡</span></a></h4><p>è€ƒè™‘ä½ æ­£åœ¨åˆ¶ä½œä¸€ä¸ªæ–‡ä»¶ä¼ è¾“æœåŠ¡ï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ã€‚ç”¨æˆ·å¼€å§‹ä¸Šä¼ æ–‡ä»¶æ—¶å»ºç«‹è¿æ¥ï¼Œæ–‡ä»¶ä¼ è¾“å®Œæ¯•åè¿æ¥å…³é—­ã€‚ä½¿ç”¨ <code>end</code> äº‹ä»¶ï¼Œä½ å¯ä»¥çŸ¥é“ä½•æ—¶ä¸€ä¸ªæ–‡ä»¶å·²ç»å®Œå…¨æ¥æ”¶ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ï¼Œæ¯”å¦‚ä¿å­˜åˆ°ç£ç›˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> fileStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">uploaded_file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fileStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File has been uploaded</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // æ–‡ä»¶ç°åœ¨å·²ç»ä¿å­˜äº†ï¼Œå¯ä»¥è¿›è¡Œå…¶ä»–å¤„ç†</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File transfer service is running on port 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h3><p>åœ¨ Node.js çš„ <code>net</code> æ¨¡å—ä¸­ï¼Œ<code>Event: &#39;end&#39;</code> æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒæ ‡å¿—ç€æ•°æ®æµä¼ è¾“çš„ç»“æŸã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“ä½•æ—¶åœæ­¢è¯»å†™æ“ä½œï¼Œä½•æ—¶é‡Šæ”¾èµ„æºï¼Œæˆ–è€…æ‰§è¡Œå…¶ä»–å¿…è¦çš„æ¸…ç†å·¥ä½œã€‚é€šè¿‡ä¸Šé¢çš„ä¸¤ä¸ªç¤ºä¾‹ï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨è¿™ä¸€äº‹ä»¶ã€‚</p><h3 id="event-error-1" tabindex="-1"><a class="header-anchor" href="#event-error-1"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-error_1" target="_blank" rel="noopener noreferrer">Event: &#39;error&#39;</a></span></a></h3><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js å¼€å‘åº”ç”¨æ—¶ï¼Œå¤„ç†é”™è¯¯æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„æ­¥éª¤ã€‚Node.js æä¾›äº†ä¸åŒçš„æœºåˆ¶æ¥æ•è·å’Œå¤„ç†é”™è¯¯ï¼Œåœ¨è¿™å…¶ä¸­ï¼Œâ€œäº‹ä»¶ï¼š&#39;error&#39;â€æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µã€‚è®©æˆ‘ä»¬ä»¥ç®€å•ã€æ˜“æ‡‚çš„æ–¹å¼æ¥æ¢è®¨ Node.js ä¸­çš„<code>Event: &#39;error&#39;</code>ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯event-error" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯event-error"><span>ä»€ä¹ˆæ˜¯<code>Event: &#39;error&#39;</code>?</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½ä¼šè§¦å‘äº‹ä»¶ï¼Œå®ƒä»¬å¤§å¤šæ•°ç»§æ‰¿è‡ª<code>EventEmitter</code>ç±»ã€‚è¿™å°±æ„å‘³ç€è¿™äº›å¯¹è±¡èƒ½å¤Ÿå‘å¸ƒï¼ˆemitï¼‰äº‹ä»¶ï¼Œå…¶ä»–å¯¹è±¡æˆ–å‡½æ•°å¯ä»¥ç›‘å¬ï¼ˆlisten toï¼‰è¿™äº›äº‹ä»¶å¹¶ä½œå‡ºååº”ã€‚<code>&#39;error&#39;</code>äº‹ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶ï¼Œå®ƒåœ¨å¯¹è±¡é‡åˆ°é”™è¯¯æ—¶è¢«è§¦å‘ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-error-äº‹ä»¶å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-error-äº‹ä»¶å¾ˆé‡è¦"><span>ä¸ºä»€ä¹ˆ<code>&#39;error&#39;</code>äº‹ä»¶å¾ˆé‡è¦ï¼Ÿ</span></a></h3><p>é”™è¯¯å¤„ç†å¯¹äºä»»ä½•åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œå¯é æ€§éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚é€šè¿‡æ­£ç¡®åœ°ç›‘å¬å’Œå“åº”<code>&#39;error&#39;</code>äº‹ä»¶ï¼Œå¯ä»¥é˜²æ­¢ç¨‹åºå´©æºƒï¼Œå¹¶ç»™äºˆå¼€å‘è€…ä¸€ä¸ªæœºä¼šæ¥è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œæˆ–è€…æ ¹æ®é”™è¯¯ç±»å‹å°è¯•æ¢å¤åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-9"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Node.js çš„<code>net</code>æ¨¡å—åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œè¿™ä¸ªæ¨¡å—å…è®¸ä½ å®ç°ç½‘ç»œé€šä¿¡ã€‚åœ¨åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ï¼Œå¦‚ç«¯å£å·å·²è¢«å ç”¨ç­‰ï¼Œè¿™æ—¶<code>&#39;error&#39;</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªTCPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬erroräº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®©æœåŠ¡å™¨ç›‘å¬12345ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬12345ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬ä½¿ç”¨<code>net.createServer()</code>åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ã€‚</li><li>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>.on()</code>æ–¹æ³•ç›‘å¬<code>&#39;error&#39;</code>äº‹ä»¶ã€‚è¿™æ„å‘³ç€å¦‚æœæœåŠ¡å™¨å¯¹è±¡é‡åˆ°ä»»ä½•é”™è¯¯ï¼ˆæ¯”å¦‚è¯•å›¾ç›‘å¬ä¸€ä¸ªå·²ç»è¢«å¦ä¸€ä¸ªåº”ç”¨å ç”¨çš„ç«¯å£ï¼‰ï¼Œè¿™ä¸ªé”™è¯¯å¤„ç†å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚</li><li>åœ¨é”™è¯¯å¤„ç†å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬æ‰“å°å‡ºäº†é”™è¯¯ä¿¡æ¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“é”™è¯¯çš„å…·ä½“åŸå› ï¼Œå¹¶é‡‡å–ç›¸åº”çš„å¤„ç†æªæ–½ï¼Œè€Œä¸æ˜¯è®©æ•´ä¸ªåº”ç”¨ç¨‹åºå´©æºƒã€‚</li></ol><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤„ç†<code>&#39;error&#39;</code>äº‹ä»¶çš„é‡è¦æ€§ä»¥åŠå…¶åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼ã€‚åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆç†åœ°å¤„ç†è¿™äº›é”™è¯¯äº‹ä»¶å¯ä»¥ä½¿å¾—ä½ çš„åº”ç”¨æ›´åŠ å¥å£®å’Œå¯é ã€‚</p><h3 id="event-lookup" tabindex="-1"><a class="header-anchor" href="#event-lookup"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-lookup" target="_blank" rel="noopener noreferrer">Event: &#39;lookup&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>Event: &#39;lookup&#39;</code>äº‹ä»¶æ˜¯åœ¨åˆ›å»ºç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒDNSï¼ˆåŸŸåç³»ç»Ÿï¼‰è§£æå®Œæˆæ—¶è§¦å‘çš„äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶å¯¹äºç›‘æ§å’Œè°ƒè¯•ç½‘ç»œè¯·æ±‚ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›å…³äºè¿æ¥å»ºç«‹ä¹‹å‰çš„ DNS è§£æä¿¡æ¯ã€‚åœ¨ Node.js çš„<code>net</code>æ¨¡å—ä¸­ï¼Œè¿™ä¸ªäº‹ä»¶å¸¸è§äºåˆ›å»º TCP è¿æ¥æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨<code>net.connect()</code>æˆ–å…¶ä»–ç›¸å…³æ–¹æ³•æ—¶ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯å’Œä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯å’Œä¾‹å­"><span>ä½¿ç”¨åœºæ™¯å’Œä¾‹å­</span></a></h3><p>å‡è®¾ä½ éœ€è¦åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯ï¼Œè¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ æƒ³çŸ¥é“åœ¨å°è¯•è¿æ¥ä¹‹å‰ï¼ŒDNS è§£æçš„ç»“æœæ˜¯ä»€ä¹ˆã€‚è¿™åœ¨è°ƒè¯•è¿æ¥é—®é¢˜æˆ–è€…ä»…ä»…æ˜¯ä¸ºäº†è®°å½•ç›®æ ‡ IP åœ°å€æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨<code>Event: &#39;lookup&#39;</code>çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> host</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> host</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">lookup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> address</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> family</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> host</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">DNS Lookup ç»“æœ:</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è§£æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">åœ°å€: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">åœ°å€æ—: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">family</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä¸»æœºå: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">host</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å·²å»ºç«‹</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨è¿™é‡Œå¯ä»¥å‘é€æ•°æ®æˆ–è€…åšå…¶ä»–æ“ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¿æ¥å‡ºé”™: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li>ä½¿ç”¨<code>net.connect()</code>å°è¯•è¿æ¥åˆ°<code>example.com</code>çš„ 80 ç«¯å£ã€‚</li><li>å½“ DNS è§£æå®Œæˆæ—¶ï¼Œ<code>&#39;lookup&#39;</code>äº‹ä»¶è¢«è§¦å‘ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶åˆ° DNS è§£æçš„ç»“æœï¼ŒåŒ…æ‹¬è§£æå‡ºçš„ IP åœ°å€ã€åœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰ï¼Œä»¥åŠè¯·æ±‚è§£æçš„ä¸»æœºåã€‚</li><li>ç„¶åï¼Œå¦‚æœè¿æ¥æˆåŠŸå»ºç«‹ï¼Œä¼šè§¦å‘<code>&#39;connect&#39;</code>äº‹ä»¶ï¼Œè¡¨æ˜ TCP è¿æ¥å·²ç»æˆåŠŸå»ºç«‹ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªäº‹ä»¶é‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¿™ä¸ªäº‹ä»¶é‡è¦"><span>ä¸ºä»€ä¹ˆè¿™ä¸ªäº‹ä»¶é‡è¦ï¼Ÿ</span></a></h3><ul><li><strong>è°ƒè¯•</strong>: å®ƒå…è®¸å¼€å‘è€…åœ¨å‘èµ·ç½‘ç»œè¿æ¥ä¹‹å‰äº†è§£ DNS è§£æçš„ç»“æœï¼Œè¿™å¯¹äºè°ƒè¯•ç½‘ç»œè¿æ¥é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚</li><li><strong>æ€§èƒ½ç›‘æ§</strong>: é€šè¿‡ç›‘æµ‹ DNS è§£ææ—¶é—´ï¼Œå¯ä»¥å¸®åŠ©è¯†åˆ«å’Œä¼˜åŒ–å¯èƒ½çš„æ€§èƒ½ç“¶é¢ˆã€‚</li><li><strong>å®‰å…¨</strong>: åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œäº†è§£åˆ°åº•æ˜¯å“ªä¸ª IP åœ°å€è¢«è§£æå‡ºæ¥ç”¨äºè¿æ¥ï¼Œå¯ä»¥å¸®åŠ©è¯†åˆ«å’Œé˜²æ­¢æ½œåœ¨çš„ DNS æ¬ºéª—æ”»å‡»ã€‚</li></ul><p>è®°ä½ï¼Œè™½ç„¶<code>&#39;lookup&#39;</code>äº‹ä»¶æä¾›äº†æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†å®ƒä¸æ˜¯æ¯æ¬¡å»ºç«‹ç½‘ç»œè¿æ¥æ—¶éƒ½å¿…é¡»å¤„ç†çš„ã€‚æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚ï¼Œä½ å¯ä»¥é€‰æ‹©ç›‘å¬è¿™ä¸ªäº‹ä»¶æˆ–è€…å¿½ç•¥å®ƒã€‚</p><h3 id="event-ready" tabindex="-1"><a class="header-anchor" href="#event-ready"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-ready" target="_blank" rel="noopener noreferrer">Event: &#39;ready&#39;</a></span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;ready&#39;</code> æ˜¯åœ¨ <code>net</code> æ¨¡å—ä¸­å‡ºç°çš„ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒä¸»è¦ç”¨äºæŒ‡ç¤ºæŸä¸ªæ“ä½œï¼ˆæ¯”å¦‚ç½‘ç»œè¿æ¥ï¼‰å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹è¿›è¡Œæ•°æ®çš„å‘é€æˆ–å¤„ç†ç­‰æ“ä½œã€‚è¿™ä¸ªäº‹ä»¶ç‰¹åˆ«é€‚ç”¨äºå¤„ç†ç½‘ç»œç¼–ç¨‹ä¸­çš„å¼‚æ­¥æ“ä½œï¼Œå¸®åŠ©å¼€å‘è€…åœ¨æ­£ç¡®çš„æ—¶æœºè¿›è¡Œæ•°æ®å¤„ç†ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥ç†è§£ <code>Event: &#39;ready&#39;</code> çš„è¿ç”¨ï¼š</p><h3 id="ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç½‘ç»œè¿æ¥" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç½‘ç»œè¿æ¥"><span>ä¾‹å­ 1: åˆ›å»ºä¸€ä¸ªç½‘ç»œè¿æ¥</span></a></h3><p>å‡è®¾ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºè¦è¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨å¹¶ä¸”å‘é€ä¸€äº›æ•°æ®ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>net</code> æ¨¡å—æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä½¿ç”¨ <code>Event: &#39;ready&#39;</code> äº‹ä»¶ï¼Œä½ å¯ä»¥åœ¨è¿æ¥çœŸæ­£å‡†å¤‡å¥½ä¹‹åå†å‘é€æ•°æ®ï¼Œç¡®ä¿æ•°æ®çš„å‘é€ä¸ä¼šå› ä¸ºè¿æ¥è¿˜æ²¡å»ºç«‹å°±ç»ªè€Œå¤±è´¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“è¿æ¥å‡†å¤‡å°±ç»ªæ—¶ï¼Œè§¦å‘ &#39;ready&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ready</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å·²å°±ç»ªï¼Œç°åœ¨å¯ä»¥å®‰å…¨åœ°å‘é€æ•°æ®ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¾‹å­-2-æœåŠ¡ç«¯æ¥æ”¶è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æœåŠ¡ç«¯æ¥æ”¶è¿æ¥"><span>ä¾‹å­ 2: æœåŠ¡ç«¯æ¥æ”¶è¿æ¥</span></a></h3><p>åŒæ ·åœ°ï¼Œå¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œä½ ä¹Ÿå¯ä»¥åˆ©ç”¨ <code>Event: &#39;ready&#39;</code> æ¥å¤„ç†å®¢æˆ·ç«¯è¿æ¥å·²ç»å‡†å¤‡å¥½æ¥å—æ•°æ®çš„æƒ…å†µã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ready</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æ¥æ”¶æˆ–å‘é€æ•°æ®ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æ•°æ®ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£8080ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>Event: &#39;ready&#39;</code> åœ¨ç½‘ç»œç¼–ç¨‹ä¸­çš„é‡è¦ä½œç”¨ã€‚å®ƒå¸®åŠ©å¼€å‘è€…æŒæ¡æ•°æ®ä¼ è¾“çš„æ­£ç¡®æ—¶æœºï¼Œé¿å…åœ¨è¿æ¥è¿˜æœªå®Œå…¨å»ºç«‹æ—¶å°±è¿›è¡Œæ•°æ®çš„å‘é€æˆ–å¤„ç†ï¼Œä»è€Œæé«˜ç¨‹åºçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p><h3 id="event-timeout" tabindex="-1"><a class="header-anchor" href="#event-timeout"><span><a href="https://nodejs.org/docs/latest/api/net.html#event-timeout" target="_blank" rel="noopener noreferrer">Event: &#39;timeout&#39;</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå…è®¸ä½ åœ¨ç‰¹å®šçš„æ—¶åˆ»åšå‡ºå“åº”ã€‚<code>&#39;timeout&#39;</code> äº‹ä»¶æ˜¯ä¸ç½‘ç»œï¼ˆnetï¼‰æ¨¡å—ä¸­çš„ socket ç›¸å…³çš„ä¸€ä¸ªäº‹ä»¶ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†è§£å¹¶ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="node-js-ä¸­çš„-net-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-net-æ¨¡å—"><span>Node.js ä¸­çš„ net æ¨¡å—</span></a></h3><p>Node.js çš„<code>net</code>æ¨¡å—æä¾›äº†ç”¨äºåº•å±‚ç½‘ç»œé€šä¿¡çš„åŠŸèƒ½ã€‚å®ƒå¯ä»¥ç”¨æ¥åˆ›å»ºæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ï¼Œè¿™äº›æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿé€šè¿‡ TCP åè®®æˆ– IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰è¿›è¡Œé€šä¿¡ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-socket" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-socket"><span>ä»€ä¹ˆæ˜¯ Socketï¼Ÿ</span></a></h3><p>ç®€å•æ¥è¯´ï¼ŒSocket æ˜¯ç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ã€‚å½“ä½ æƒ³é€šè¿‡äº’è”ç½‘å°†ä¸¤ä¸ªç¨‹åºè¿æ¥èµ·æ¥æ—¶ï¼Œå®ƒä»¬ä¹‹é—´ä¼šåˆ›å»ºä¸€ä¸ª Socket è¿æ¥ã€‚åœ¨ Node.js ä¸­ï¼Œä¸€æ—¦æœ‰æ–°çš„ TCP è¿æ¥ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª Socket å¯¹è±¡æ¥ä»£è¡¨è¿™ä¸ªè¿æ¥ã€‚</p><h3 id="äº‹ä»¶-timeout" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶-timeout"><span>äº‹ä»¶ï¼š&#39;timeout&#39;</span></a></h3><p>å½“ä½ è®¾ç½®äº† socket çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸”åœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰æ•°æ®äº¤æ¢æ—¶ï¼Œ<code>&#39;timeout&#39;</code>äº‹ä»¶è¢«è§¦å‘ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè§¦å‘<code>&#39;timeout&#39;</code>äº‹ä»¶å¹¶ä¸ä¼šè‡ªåŠ¨å…³é—­ socketï¼Œé™¤éä½ æ‰‹åŠ¨å…³é—­å®ƒã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥æ›´å¥½åœ°ç†è§£ï¼š</p><h4 id="å®é™…ä¾‹å­-1-åˆ›å»º-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1-åˆ›å»º-tcp-æœåŠ¡å™¨"><span>å®é™…ä¾‹å­ 1ï¼šåˆ›å»º TCP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨éœ€è¦å¤„ç†é•¿æ—¶é—´æœªå“åº”çš„è¿æ¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºTCPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®30ç§’è¶…æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">30000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“socketè¶…æ—¶æ—¶ï¼Œæ‰§è¡Œçš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Socket has timed out!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received data: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å…¶ä»–é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 8080 ç«¯å£ã€‚å¯¹äºæ¯ä¸ªæ–°çš„è¿æ¥ï¼Œæˆ‘ä»¬è®¾ç½®äº† 30 ç§’çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ 30 ç§’å†…ï¼Œæ²¡æœ‰ä»»ä½•æ•°æ®ä»è¯¥ socket ä¼ è¾“ï¼Œé‚£ä¹ˆå°†è§¦å‘<code>&#39;timeout&#39;</code>äº‹ä»¶ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰“å°æ¶ˆæ¯ï¼Œå¹¶å…³é—­è¿æ¥ã€‚</p><h4 id="å®é™…ä¾‹å­-2-ä½œä¸ºå®¢æˆ·ç«¯è®¾ç½®è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2-ä½œä¸ºå®¢æˆ·ç«¯è®¾ç½®è¶…æ—¶"><span>å®é™…ä¾‹å­ 2ï¼šä½œä¸ºå®¢æˆ·ç«¯è®¾ç½®è¶…æ—¶</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œéœ€è¦è¿æ¥åˆ°æŸä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸”æƒ³è¦å¤„ç†å¯èƒ½å‘ç”Ÿçš„è¶…æ—¶æƒ…å†µï¼ŒåŒæ ·çš„æ¦‚å¿µä¹Ÿé€‚ç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªsocketè¿æ¥åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 10ç§’</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¶…æ—¶äº‹ä»¶å¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection has timed out!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç»“æŸè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received data: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†æ•°æ®...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¿æ¥åˆ°äº†æœ¬æœºçš„ 8080 ç«¯å£ï¼Œå¹¶è®¾ç½®äº† 10 ç§’çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ 10 ç§’å†…ï¼Œæ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°è¶…æ—¶æ¶ˆæ¯ï¼Œå¹¶ä¸»åŠ¨ç»“æŸè¿™ä¸ªè¿æ¥ã€‚</p><p>æ€»ç»“ï¼šåœ¨ Node.js ä¸­ï¼Œé€šè¿‡<code>net</code>æ¨¡å—çš„<code>&#39;timeout&#39;</code>äº‹ä»¶ï¼Œå¯ä»¥å¸®åŠ©ä½ ç®¡ç†é‚£äº›å› ä¸ºæŸç§åŸå› è€Œæ— æ³•åŠæ—¶äº¤æ¢æ•°æ®çš„è¿æ¥ã€‚è¿™åœ¨ç»´æŠ¤è‰¯å¥½çš„èµ„æºç®¡ç†å’Œé¿å…æ½œåœ¨çš„åƒµå°¸è¿æ¥æ–¹é¢éå¸¸æœ‰ç”¨ã€‚</p><h3 id="socket-address" tabindex="-1"><a class="header-anchor" href="#socket-address"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketaddress" target="_blank" rel="noopener noreferrer">socket.address()</a></span></a></h3><p><code>socket.address()</code> æ˜¯ Node.js ä¸­ <code>net</code> æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè¿”å›å…³äº socket çš„åœ°å€ä¿¡æ¯ã€‚è¿™ä¸ªæ–¹æ³•ç‰¹åˆ«æœ‰ç”¨äºè·å–æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯çš„ç»‘å®šåœ°å€ä¿¡æ¯ï¼Œä¾‹å¦‚ IP åœ°å€å’Œç«¯å£å·ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>net</code> æ¨¡å—æä¾›äº†ä¸€ç»„å¼‚æ­¥ç½‘ç»œ API ç”¨äºåˆ›å»ºåŸºäºæµçš„ TCP æˆ– IPC çš„æœåŠ¡å™¨ (<code>net.createServer()</code>) å’Œå®¢æˆ·ç«¯ (<code>net.createConnection()</code>)ã€‚<code>socket.address()</code> æ–¹æ³•æ˜¯åœ¨è¿™äº› TCP æˆ– IPC æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¿æ¥ï¼ˆå³ <code>socket</code>ï¼‰ä¸Šè°ƒç”¨çš„ï¼Œä»¥è·å–è¿æ¥çš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-10"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>è·å–æœåŠ¡å™¨åœ°å€ä¿¡æ¯</strong>:<br> å‡è®¾ä½ å·²ç»ä½¿ç”¨ <code>net.createServer()</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£åï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨åœ¨æœåŠ¡å™¨çš„ &#39;listening&#39; äº‹ä»¶çš„å›è°ƒå‡½æ•°å†…çš„ <code>server.address()</code> æ–¹æ³•æ¥è·å–æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> address</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨ç›‘å¬åœ¨ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è·å–å®¢æˆ·ç«¯ Socket åœ°å€ä¿¡æ¯</strong>:<br> å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯çš„ socket å¯¹è±¡ä¸Šä½¿ç”¨ <code>socket.address()</code> æ–¹æ³•è·å–è¯¥è¿æ¥çš„æœ¬åœ°ç«¯å£å’Œåœ°å€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> address</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œ<code>address</code> å¯¹è±¡é€šå¸¸ä¼šåŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><code>address</code>: ç»‘å®šçš„ IP åœ°å€ã€‚</li><li><code>family</code>: IP åœ°å€çš„ç‰ˆæœ¬ï¼Œé€šå¸¸æ˜¯ <code>&#39;IPv4&#39;</code> æˆ–è€… <code>&#39;IPv6&#39;</code>ã€‚</li><li><code>port</code>: ç»‘å®šçš„ç«¯å£å·ã€‚</li></ul><p>è¿™äº›ä¿¡æ¯ç‰¹åˆ«æœ‰ç”¨äºè°ƒè¯•ç›®çš„æˆ–è€…åœ¨éœ€è¦æ ¹æ®è¿æ¥åŠ¨æ€è·å–ç»‘å®šåœ°å€ä¿¡æ¯çš„åœºæ™¯ä¸­ã€‚</p><h3 id="socket-autoselectfamilyattemptedaddresses" tabindex="-1"><a class="header-anchor" href="#socket-autoselectfamilyattemptedaddresses"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketautoselectfamilyattemptedaddresses" target="_blank" rel="noopener noreferrer">socket.autoSelectFamilyAttemptedAddresses</a></span></a></h3><p>åœ¨è§£é‡Š <code>socket.autoSelectFamilyAttemptedAddresses</code> ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µå’Œå®ƒçš„å®é™…åº”ç”¨ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†-1"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><ol><li><p><strong>Node.js</strong>ï¼šä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js éå¸¸é€‚åˆå¼€å‘éœ€è¦é«˜æ€§èƒ½ã€è¾“å…¥/è¾“å‡ºå¯†é›†å‹çš„ç½‘ç»œåº”ç”¨ã€‚</p></li><li><p><strong>Socket</strong>: åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œ<code>Socket</code> æ˜¯é€šä¿¡é“¾è·¯çš„ç«¯ç‚¹ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸¤å°æœºå™¨ä¹‹é—´é€šä¿¡çš„æ¡¥æ¢ã€‚å¼€å‘è€…é€šè¿‡ç¼–ç¨‹ä½¿ç”¨ Socket æ¥è¿›è¡Œç½‘ç»œé€šä¿¡ï¼ŒåŒ…æ‹¬æ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚</p></li><li><p><strong>IP åœ°å€æ—(IP Address Family)</strong>: ä¸»è¦æœ‰ IPv4 å’Œ IPv6 ä¸¤ç§ç±»å‹ã€‚IPv4 åœ°å€ç”± 32 ä½ç»„æˆï¼Œå½¢å¼ä¸ºå››æ®µæ•°å­—ï¼ˆä¾‹å¦‚ï¼š192.168.0.1ï¼‰ï¼Œè€Œ IPv6 åœ°å€ç”± 128 ä½ç»„æˆï¼Œå½¢å¼ä¸ºå…«ç»„å››ä¸ªåå…­è¿›åˆ¶æ•°ï¼ˆä¾‹å¦‚ï¼š2404:6800:4005:805::200eï¼‰ã€‚</p></li></ol><h3 id="socket-autoselectfamilyattemptedaddresses-1" tabindex="-1"><a class="header-anchor" href="#socket-autoselectfamilyattemptedaddresses-1"><span>socket.autoSelectFamilyAttemptedAddresses</span></a></h3><p>å½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª Socket è¿æ¥æ—¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½ä¸ç¡®å®šç›®æ ‡æœåŠ¡å™¨æ”¯æŒå“ªç§ IP åœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰ã€‚Node.js v21.7.1 å¼•å…¥çš„<code>socket.autoSelectFamilyAttemptedAddresses</code>å±æ€§å°±æ˜¯ç”¨æ¥å¸®åŠ©å¤„ç†è¿™ç§æƒ…å†µçš„ã€‚</p><p>è¿™ä¸ªå±æ€§æä¾›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†åœ¨å°è¯•è‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰æ—¶ï¼Œå·²ç»å°è¯•è¿‡è¿æ¥çš„ IP åœ°å€åˆ—è¡¨ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºåœ¨è¿æ¥åˆ°æŸä¸ªæœåŠ¡æ—¶è‡ªåŠ¨å°è¯•äº† IPv4 å’Œ IPv6 åœ°å€ï¼Œé‚£ä¹ˆé€šè¿‡æŸ¥çœ‹<code>socket.autoSelectFamilyAttemptedAddresses</code>å±æ€§ï¼Œä½ å¯ä»¥äº†è§£åˆ°åº•å°è¯•äº†å“ªäº›å…·ä½“çš„ IP åœ°å€ã€‚</p><h3 id="å®è·µä¸­çš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®è·µä¸­çš„åº”ç”¨"><span>å®è·µä¸­çš„åº”ç”¨</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¸å¤–éƒ¨æœåŠ¡é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼Œä½†ä½ ä¸ç¡®å®šè¯¥æœåŠ¡æ”¯æŒ IPv4 è¿˜æ˜¯ IPv6 åœ°å€ã€‚ä½ å¯ä»¥ä½¿ç”¨ Node.js ä¸­çš„ socket åŠŸèƒ½æ¥å°è¯•è¿æ¥ï¼Œå¹¶åˆ©ç”¨<code>socket.autoSelectFamilyAttemptedAddresses</code>æ¥è·å–å°è¯•è¿‡çš„ IP åœ°å€ä¿¡æ¯ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -3"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªsocketè¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›®æ ‡ä¸»æœºå</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›®æ ‡ç«¯å£å·</span></span>
<span class="line"><span style="color:#88C0D0;">    family</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è®¾ç½®familyä¸º0ï¼Œè®©Node.jsè‡ªåŠ¨é€‰æ‹©IPåœ°å€æ—</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿æ¥æˆåŠŸåï¼Œè·å–å°è¯•è¿‡çš„IPåœ°å€</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">autoSelectFamilyAttemptedAddresses</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°è¯•è¿æ¥åˆ°<code>example.com</code>çš„ 80 ç«¯å£ã€‚é€šè¿‡å°†<code>family</code>å±æ€§è®¾ç½®ä¸º 0ï¼Œæˆ‘ä»¬å‘Šè¯‰ Node.js è‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>socket.autoSelectFamilyAttemptedAddresses</code>æŸ¥çœ‹å“ªäº› IP åœ°å€è¢«å°è¯•è¿‡ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£è¿æ¥è¿‡ç¨‹å’Œå¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚</p><h3 id="å°ç»“-9" tabindex="-1"><a class="header-anchor" href="#å°ç»“-9"><span>å°ç»“</span></a></h3><p><code>socket.autoSelectFamilyAttemptedAddresses</code> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å±æ€§ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£åœ¨è‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—æ—¶å°è¯•è¿‡çš„ IP åœ°å€ã€‚è¿™å¯¹äºè°ƒè¯•ç½‘ç»œé—®é¢˜ã€ä¼˜åŒ–ç½‘ç»œè¿æ¥é€»è¾‘ç­‰éƒ½éå¸¸æœ‰ç”¨ã€‚</p><h3 id="socket-buffersize" tabindex="-1"><a class="header-anchor" href="#socket-buffersize"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketbuffersize" target="_blank" rel="noopener noreferrer">socket.bufferSize</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œå®ç°äº† JavaScript çš„åç«¯ç¼–ç¨‹èƒ½åŠ›ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰è®¸å¤šå†…ç½®æ¨¡å—æä¾›ä¸°å¯Œçš„ API æ¥æ”¯æŒæœåŠ¡å™¨ç«¯çš„å„ç§åŠŸèƒ½ï¼Œå…¶ä¸­ <code>net</code> æ¨¡å—å°±æ˜¯ç”¨äºç½‘ç»œæ“ä½œï¼Œæ¯”å¦‚åˆ›å»º TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç­‰ã€‚</p><p>å½“æˆ‘ä»¬è°ˆè®ºåˆ° <code>socket.bufferSize</code> è¿™ä¸ªå±æ€§æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºç½‘ç»œç¼–ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼šç¼“å†²åŒºï¼ˆBufferï¼‰ã€‚ç¼“å†²åŒºï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å†…å­˜ä¸­æš‚æ—¶å­˜å‚¨æ•°æ®çš„åœ°æ–¹ã€‚åœ¨è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶ï¼Œæ•°æ®ä¼šè¢«ä¸´æ—¶å­˜å‚¨åœ¨ç¼“å†²åŒºå†…ï¼Œç„¶åå†å‘é€ç»™å¯¹æ–¹ã€‚åŒæ ·çš„ï¼Œæ¥æ”¶æ–¹ä¹Ÿä¼šå…ˆå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚</p><h3 id="socket-buffersize-1" tabindex="-1"><a class="header-anchor" href="#socket-buffersize-1"><span>socket.bufferSize</span></a></h3><p><code>socket.bufferSize</code> å±æ€§è¡¨ç¤ºä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—ä»£è¡¨äº† TCP socket ç¼“å†²åŒºçš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚è¿™ä¸ªå±æ€§æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li><strong>è·å–å½“å‰ç¼“å†²åŒºå¤§å°</strong>ï¼šå½“ä½ è¯»å–è¿™ä¸ªå±æ€§å€¼çš„æ—¶å€™ï¼Œå®ƒä¼šå‘Šè¯‰ä½ å½“å‰ socket çš„ç¼“å†²åŒºè¿˜æœ‰å¤šå°‘å­—èŠ‚çš„æ•°æ®æœªè¢«å†™å…¥åˆ°åº•å±‚çš„ç³»ç»Ÿç¼“å†²åŒºä¸­ã€‚</li><li><strong>è®¾ç½®ç¼“å†²åŒºå¤§å°</strong>ï¼šé€šè¿‡ä¿®æ”¹è¿™ä¸ªå±æ€§çš„å€¼ï¼Œä½ å¯ä»¥è°ƒæ•´ TCP socket çš„ç¼“å†²åŒºçš„å¤§å°ï¼Œè¿™å½±å“ç€æ•°æ®ä¼ è¾“çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªèŠå¤©åº”ç”¨æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨æˆ–è€…æ‰‹æœº appï¼‰ä¼šé€šè¿‡ç½‘ç»œå‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¿™äº›æ¶ˆæ¯åï¼Œå¯èƒ½ä¼šå°†å…¶è½¬å‘ç»™å…¶ä»–å®¢æˆ·ç«¯ã€‚</p><p><strong>ç¤ºä¾‹ä¸€ï¼šç›‘æ§ç¼“å†²åŒºçŠ¶æ€</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">åˆå§‹ç¼“å†²åŒºå¤§å°: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">bufferSize</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ¥æ”¶åˆ°æ•°æ®, å½“å‰ç¼“å†²åŒºå¤§å°: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">bufferSize</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç›‘å¬12345ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœ‰æ–°çš„è¿æ¥è¿›æ¥æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šæ‰“å°å‡ºå½“å‰çš„ç¼“å†²åŒºå¤§å°ã€‚å¹¶ä¸”ï¼Œæ¯æ¬¡æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¹Ÿä¼šæ‰“å°å‡ºå½“å‰ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥ä¾¿äºå¼€å‘è€…ç›‘æ§æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ç¼“å†²åŒºçš„å˜åŒ–æƒ…å†µã€‚</p><p><strong>ç¤ºä¾‹äºŒï¼šè°ƒæ•´ç¼“å†²åŒºå¤§å°</strong></p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä½ é¢„è®¡å°†ä¼šæœ‰å¤§é‡æ•°æ®ä¼ è¾“ï¼Œä½ å¯èƒ½æƒ³è¦å¢åŠ ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥æé«˜æ•°æ®å¤„ç†çš„æ•ˆç‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">bufferSize</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 65536</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å°†ç¼“å†²åŒºå¤§å°è®¾ç½®ä¸º64KB</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ <code>example.com</code> çš„å®¢æˆ·ç«¯ socketï¼Œå¹¶ä¸”åœ¨è¿æ¥å»ºç«‹åï¼Œå°†ç¼“å†²åŒºå¤§å°è®¾ä¸ºäº† 64KBã€‚è¿™å¯ä»¥å¸®åŠ©åº”å¯¹é‚£äº›éœ€è¦å¤§é‡æ•°æ®äº¤æ¢çš„åœºæ™¯ï¼Œå‡å°‘å› ç¼“å†²åŒºè¿‡å°è€Œé¢‘ç¹è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ï¼Œä»è€Œæå‡æ•´ä½“æ€§èƒ½ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œäº†è§£å’Œåˆç†ä½¿ç”¨ <code>socket.bufferSize</code> å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æŒæ¡å’Œä¼˜åŒ– Node.js ç¨‹åºä¸­çš„ç½‘ç»œé€šä¿¡æ€§èƒ½ã€‚</p><h3 id="socket-bytesread" tabindex="-1"><a class="header-anchor" href="#socket-bytesread"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketbytesread" target="_blank" rel="noopener noreferrer">socket.bytesRead</a></span></a></h3><p>Node.js ä¸­çš„ <code>socket.bytesRead</code> å±æ€§ç”¨æ¥è¡¨ç¤ºä» socket æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªå±æ€§åœ¨å¤„ç†ç½‘ç»œé€šä¿¡æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦çŸ¥é“é€šè¿‡ä¸€ä¸ª TCP æˆ–è€… IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰è¿æ¥å·²ç»æˆåŠŸæ¥æ”¶äº†å¤šå°‘æ•°æ®çš„æƒ…å†µä¸‹ã€‚</p><p>ä¸ºäº†æ›´é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>socket</code> æƒ³è±¡æˆç”µè¯é€šè¯ä¸­çš„ä¸€ç«¯ï¼Œè€Œ <code>bytesRead</code> å°±åƒæ˜¯ä½ å¬åˆ°çš„è¯è¯­æ•°é‡ã€‚æ¯å½“ä½ æ¥å¬ç”µè¯ï¼Œå¯¹æ–¹è¯´çš„æ¯ä¸€ä¸ªå­—ã€æ¯ä¸€ä¸ªå¥å­ï¼Œéƒ½å¯ä»¥ç”¨æ•°æ®çš„å­—èŠ‚æ•°æ¥è¡¡é‡ã€‚åœ¨ Node.js çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œ<code>socket.bytesRead</code> å°±æ˜¯å¸®åŠ©æˆ‘ä»¬äº†è§£åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªç”µè¯ï¼ˆæˆ–è€…è¯´ç½‘ç»œè¿æ¥ï¼‰æ¥æ”¶åˆ°äº†å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h3><ol><li><p><strong>æ–‡ä»¶ä¼ è¾“</strong>ï¼šæƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªåŸºäº Node.js çš„åº”ç”¨æ¥ä¼ è¾“æ–‡ä»¶ã€‚<code>socket.bytesRead</code> å¯ä»¥ç”¨æ¥æ˜¾ç¤ºå·²ç»æ¥æ”¶åˆ°çš„æ–‡ä»¶éƒ¨åˆ†çš„å¤§å°ï¼Œè¿™å¯¹äºç›‘æ§æ–‡ä»¶ä¼ è¾“çš„è¿›åº¦éå¸¸æœ‰ç”¨ã€‚</p></li><li><p><strong>æ¶ˆæ¯åº”ç”¨</strong>ï¼šåœ¨ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ä¸­ï¼Œ<code>socket.bytesRead</code> å¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£æ¯æ¡æ¶ˆæ¯è¢«æ¥æ”¶æ—¶å ç”¨äº†å¤šå°‘å­—èŠ‚ï¼Œä»è€Œæœ‰åŠ©äºè°ƒè¯•æˆ–æ˜¯ä¼˜åŒ–ç½‘ç»œä½¿ç”¨æ•ˆç‡ã€‚</p></li><li><p><strong>æµåª’ä½“åº”ç”¨</strong>ï¼šå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæµåª’ä½“æ’­æ”¾å™¨ï¼Œäº†è§£å·²ç»ç¼“å†²ï¼ˆæ¥æ”¶ï¼‰äº†å¤šå°‘æ•°æ®æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ ·å¯ä»¥æ§åˆ¶æ’­æ”¾æµç¨‹ï¼Œç¡®ä¿ç”¨æˆ·æœ‰æµç•…çš„è§‚çœ‹ä½“éªŒã€‚<code>socket.bytesRead</code> åœ¨è¿™é‡Œå¯ä»¥å¸®åŠ©è¿½è¸ªæ¥æ”¶åˆ°çš„åª’ä½“æ•°æ®é‡ã€‚</p></li></ol><p>åœ¨ä½¿ç”¨æ—¶ï¼Œ<code>socket.bytesRead</code> æ˜¯è‡ªåŠ¨æ›´æ–°çš„ï¼Œæ¯å½“é€šè¿‡è¿™ä¸ª socket æ¥æ”¶åˆ°æ–°çš„æ•°æ®ï¼Œè¿™ä¸ªå±æ€§çš„å€¼å°±ä¼šå¢åŠ ã€‚è¿™è®©å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°ç›‘æ§æ•°æ®æµé‡ï¼Œæ— è®ºæ˜¯åœ¨å¼€å‘ç½‘ç»œåº”ç”¨ã€æ•°æ®ä¼ è¾“å·¥å…·è¿˜æ˜¯ä»»ä½•éœ€è¦ç½‘ç»œé€šä¿¡çš„é¡¹ç›®æ—¶ã€‚</p><h3 id="socket-byteswritten" tabindex="-1"><a class="header-anchor" href="#socket-byteswritten"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketbyteswritten" target="_blank" rel="noopener noreferrer">socket.bytesWritten</a></span></a></h3><p>Node.js ä¸­çš„<code>socket.bytesWritten</code>å±æ€§æ˜¯ç”¨äºè·å–é€šè¿‡ TCP æˆ– IPC å¥—æ¥å­—å‘é€çš„å­—èŠ‚æ€»æ•°ã€‚è¿™ä¸ªå±æ€§å¯¹äºäº†è§£å’Œç›‘æ§æ•°æ®ä¼ è¾“æ€§èƒ½éå¸¸æœ‰ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œæ¯å½“ä½ ä½¿ç”¨ Socketï¼ˆå¥—æ¥å­—ï¼‰å‘é€æ•°æ®æ—¶ï¼Œæ— è®ºæ˜¯æ–‡ä»¶ã€æ–‡æœ¬æ¶ˆæ¯è¿˜æ˜¯å…¶ä»–å½¢å¼çš„æ•°æ®ï¼Œ<code>bytesWritten</code>éƒ½ä¼šå‘Šè¯‰ä½ å·²ç»å‘é€äº†å¤šå°‘å­—èŠ‚ã€‚</p><p>ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-è¿½è¸ªæ•°æ®ä¼ è¾“é‡" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¿½è¸ªæ•°æ®ä¼ è¾“é‡"><span>ä¾‹å­ 1ï¼šè¿½è¸ªæ•°æ®ä¼ è¾“é‡</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œä½¿ç”¨ Node.js ä½œä¸ºåç«¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼šé¢‘ç¹åœ°äº¤æ¢æ¶ˆæ¯ã€‚ä½ å¯èƒ½æƒ³çŸ¥é“åœ¨ä¸€ä¸ªç»™å®šçš„è¿æ¥ä¸­ï¼Œå·²ç»æˆåŠŸå‘é€äº†å¤šå°‘æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received message: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å“åº”å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, client!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // å½“æ•°æ®å‘é€å®Œæˆåï¼Œæ‰“å°å·²å‘é€çš„å­—èŠ‚æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Bytes written: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">bytesWritten</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ¯å½“æœåŠ¡å™¨æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯åï¼Œå®ƒå°±ä¼šå›å¤&quot;Hello, client!&quot;ã€‚é€šè¿‡<code>socket.bytesWritten</code>ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åˆ°ç›®å‰ä¸ºæ­¢å·²ç»å‘è¯¥å®¢æˆ·ç«¯å‘é€äº†å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚</p><h3 id="ä¾‹å­-2-ç›‘æ§æ–‡ä»¶ä¼ è¾“è¿›åº¦" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç›‘æ§æ–‡ä»¶ä¼ è¾“è¿›åº¦"><span>ä¾‹å­ 2ï¼šç›‘æ§æ–‡ä»¶ä¼ è¾“è¿›åº¦</span></a></h3><p>å‡å®šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå…è®¸ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç±»åº”ç”¨ä¸­ï¼Œäº†è§£æ–‡ä»¶ä¸Šä¼ è¿›åº¦éå¸¸é‡è¦ã€‚è™½ç„¶<code>socket.bytesWritten</code>ä¸èƒ½ç›´æ¥ç”¨äº HTTP è¯·æ±‚ï¼Œä½†å¦‚æœä½ åœ¨åº•å±‚ä½¿ç”¨ TCP æˆ– IPC å¥—æ¥å­—æ¥å¤„ç†æ–‡ä»¶ä¼ è¾“ï¼Œè¿™ä¸ªå±æ€§å°±å˜å¾—éå¸¸æœ‰ç”¨äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> filePath</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./largeFile.zip</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªTCPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">open</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">File has been sent. Total bytes written: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">bytesWritten</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œå½“æœ‰è¿æ¥å»ºç«‹æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªå¤§æ–‡ä»¶ï¼ˆä¾‹å¦‚<code>largeFile.zip</code>ï¼‰ã€‚é€šè¿‡ç›‘å¬<code>end</code>äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–‡ä»¶å®Œå…¨å‘é€åè¾“å‡ºå·²ç»å†™å…¥çš„å­—èŠ‚æ•°ï¼Œä»è€Œç›‘æ§æ–‡ä»¶ä¼ è¾“çš„è¿›åº¦ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>socket.bytesWritten</code>æ˜¯ä¸€ä¸ªååˆ†å®ç”¨çš„å±æ€§ï¼Œå®ƒå¸®åŠ©ä½ äº†è§£é€šè¿‡ç½‘ç»œå‘é€äº†å¤šå°‘æ•°æ®ã€‚è¿™åœ¨è¿›è¡Œç½‘ç»œç¼–ç¨‹æ—¶éå¸¸é‡è¦ï¼Œæ— è®ºæ˜¯ç®€å•çš„æ•°æ®ä¼ è¾“è¿˜æ˜¯å¤æ‚çš„æ–‡ä»¶åˆ†äº«åº”ç”¨ï¼Œäº†è§£å’Œç›‘æ§æ•°æ®ä¼ è¾“é‡éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚</p><h3 id="socket-connect" tabindex="-1"><a class="header-anchor" href="#socket-connect"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketconnect" target="_blank" rel="noopener noreferrer">socket.connect()</a></span></a></h3><p>Node.js ä¸­çš„ <code>socket.connect()</code> æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šç«¯å£å’Œä¸»æœºçš„å¥—æ¥å­—è¿æ¥ã€‚å½“ä½ åœ¨ Node.js ä¸­ä½¿ç”¨ç½‘ç»œç¼–ç¨‹ï¼Œå°¤å…¶æ˜¯åœ¨å¼€å‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºæ—¶ï¼Œ<code>socket.connect()</code> æ˜¯å»ºç«‹ç½‘ç»œé€šä¿¡è¿æ¥çš„åŸºç¡€ã€‚ä¸‹é¢æˆ‘ä¼šè¯¦ç»†è§£é‡Šè¿™ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶ç»™å‡ºä¸€äº›å®é™…çš„è¿ç”¨ç¤ºä¾‹ã€‚</p><h3 id="socket-connect-æ–¹æ³•æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#socket-connect-æ–¹æ³•æ¦‚è¿°"><span><code>socket.connect()</code> æ–¹æ³•æ¦‚è¿°</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.connect()</code> æ–¹æ³•å±äº <code>net</code> æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æä¾›äº†å¼‚æ­¥ç½‘ç»œåŒ…è£…å™¨ï¼Œç”¨äº TCP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„åˆ›å»ºã€‚</p><p><code>socket.connect()</code> æ–¹æ³•çš„åŸºæœ¬ç”¨é€”æ˜¯å¯åŠ¨ä¸€ä¸ªè¿æ¥åˆ°æŒ‡å®šæœåŠ¡å™¨çš„è¯·æ±‚ã€‚å®ƒå¯ä»¥é€šè¿‡ä¸åŒçš„å‚æ•°è¿›è¡Œé…ç½®ï¼Œå¦‚ç›®æ ‡ä¸»æœºçš„ç«¯å£å·ã€ä¸»æœºåç­‰ã€‚å½“è¿æ¥æˆåŠŸå»ºç«‹åï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚</p><h3 id="å‚æ•°è¯¦è§£-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯¦è§£-1"><span>å‚æ•°è¯¦è§£</span></a></h3><p><code>socket.connect()</code> æ–¹æ³•å¯ä»¥æ¥å—å¤šç§å½¢å¼çš„å‚æ•°ï¼Œä½†æœ€å¸¸è§çš„æ˜¯ï¼š</p><ul><li><code>options</code>ï¼ˆå¯¹è±¡ï¼‰: åŒ…å«è¿æ¥é…ç½®çš„å¯¹è±¡ï¼Œå¦‚ <code>port</code>ï¼ˆç«¯å£å·ï¼‰ã€<code>host</code>ï¼ˆä¸»æœºåï¼‰ç­‰ã€‚</li><li><code>connectListener</code>ï¼ˆå‡½æ•°ï¼‰: ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œå°†è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1: è¿æ¥åˆ° TCP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾æœ‰ä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°ï¼Œç«¯å£ä¸º 8080 çš„ TCP æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>socket.connect()</code> æ¥è¿æ¥å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª socket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿æ¥åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æœåŠ¡å™¨æ•°æ®ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é”€æ¯ socket</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬å…³é—­äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£"><span>ç¤ºä¾‹ 2: æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£</span></a></h4><p>å¦‚æœä½ æƒ³è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æŸä¸ªç‰¹å®šç«¯å£ï¼Œåªéœ€æ›´æ”¹ <code>host</code> å’Œ <code>port</code> çš„å€¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1234</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>socket.connect()</code> å¦‚ä½•ç”¨äºåœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å»ºç«‹ TCP è¿æ¥ã€‚æ— è®ºæ˜¯è¿æ¥åˆ°æœ¬åœ°è¿˜æ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œåªéœ€æä¾›æ­£ç¡®çš„ç«¯å£å’Œä¸»æœºä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ä¸å…¶ä»–ç³»ç»Ÿè¿›è¡Œé€šä¿¡ã€‚</p><h4 id="socket-connect-options-connectlistener" tabindex="-1"><a class="header-anchor" href="#socket-connect-options-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketconnectoptions-connectlistener" target="_blank" rel="noopener noreferrer">socket.connect(options[, connectListener])</a></span></a></h4><p>Node.js çš„ <code>socket.connect(options[, connectListener])</code> æ–¹æ³•æ˜¯ <code>net</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒç”¨äºåˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šæœåŠ¡å™¨çš„ TCP è¿æ¥ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨å’ŒåŠŸèƒ½ä¿æŒä¸€è‡´æ€§ï¼Œè®©æˆ‘ä»¬é€šè¿‡å…·ä½“çš„æ–¹é¢æ¥åˆ†è§£è¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨å’Œåº”ç”¨åœºæ™¯ã€‚</p><h3 id="è¯¦ç»†è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è¯¦ç»†è§£é‡Š"><span>è¯¦ç»†è§£é‡Š</span></a></h3><ul><li><p><strong><code>options</code></strong>: è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºæŒ‡å®šè¿æ¥çš„è¯¦ç»†å‚æ•°ã€‚è¿™äº›å‚æ•°é€šå¸¸åŒ…æ‹¬ï¼š</p><ul><li><code>port</code>: è¦è¿æ¥çš„ç«¯å£å·ã€‚</li><li><code>host</code>: è¦è¿æ¥çš„ä¸»æœºåæˆ–è€… IP åœ°å€ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>localhost</code>ã€‚</li><li>å…¶ä»–å¯é€‰å‚æ•°ï¼Œæ¯”å¦‚ç”¨äº TLS è¿æ¥çš„é€‰é¡¹ç­‰ã€‚</li></ul></li><li><p><strong><code>connectListener</code></strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå½“è¿æ¥å»ºç«‹æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°æ˜¯äº‹ä»¶ç›‘å¬å™¨çš„ç®€ä¾¿æ–¹å¼ï¼Œç›¸å½“äºç›‘å¬äº† <code>connect</code> äº‹ä»¶ã€‚</p></li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-åˆ›å»º-tcp-å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»º-tcp-å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨"><span>1. åˆ›å»º TCP å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿è¡Œåœ¨ 12345 ç«¯å£çš„ TCP æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æƒ³ä»å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª socket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ socket.connect æ–¹æ³•è¿æ¥åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è¿æ¥å…³é—­</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å·²å…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é¦–å…ˆå¯¼å…¥äº† <code>net</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ socket å®¢æˆ·ç«¯ã€‚ç„¶åä½¿ç”¨ <code>socket.connect</code> æ–¹æ³•è¿æ¥åˆ°è¿è¡Œåœ¨æœ¬åœ°çš„ 12345 ç«¯å£çš„æœåŠ¡å™¨ã€‚å½“è¿æ¥å»ºç«‹æ—¶ï¼Œä¼šè¾“å‡ºä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ï¼Œå¹¶è®¾ç½®äº†ä¸¤ä¸ªäº‹ä»¶ç›‘å¬å™¨æ¥å¤„ç†ä»æœåŠ¡å™¨æ¥æ”¶çš„æ•°æ®å’Œè¿æ¥å…³é—­äº‹ä»¶ã€‚</p><h4 id="_2-ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶"><span>2. ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span></a></h4><p>å¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨çš„æ–¹å¼è€Œä¸æ˜¯å›è°ƒå‡½æ•°ï¼Œä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ <code>connect</code> ä¹‹åï¼Œä½¿ç”¨ <code>.on(&#39;connect&#39;, listener)</code> æ¥æ·»åŠ è¿æ¥å»ºç«‹çš„äº‹ä»¶ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç çš„æ•ˆæœå’Œä¹‹å‰çš„ä¾‹å­ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨äº†äº‹ä»¶ç›‘å¬çš„æ–¹å¼æ¥å¤„ç†è¿æ¥å»ºç«‹çš„äº‹ä»¶ã€‚</p><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p><code>socket.connect</code> æ–¹æ³•åœ¨ Node.js ä¸­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦åˆ›å»º TCP å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨çš„æƒ…å†µä¸‹ã€‚é€šè¿‡ç®€å•çš„ APIï¼Œå®ƒæä¾›äº†å¼ºå¤§çš„åŠŸèƒ½æ¥å»ºç«‹å’Œç®¡ç†ç½‘ç»œè¿æ¥ï¼Œæ— è®ºæ˜¯åœ¨å¼€å‘ç½‘ç»œåº”ç”¨ã€å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å‹åº”ç”¨ï¼Œè¿˜æ˜¯åœ¨éœ€è¦åº•å±‚ç½‘ç»œé€šä¿¡çš„åœºæ™¯ä¸­ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥å¼€å§‹æ¢ç´¢æ›´å¤æ‚çš„ç½‘ç»œåº”ç”¨å¼€å‘ã€‚</p><h4 id="socket-connect-path-connectlistener" tabindex="-1"><a class="header-anchor" href="#socket-connect-path-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketconnectpath-connectlistener" target="_blank" rel="noopener noreferrer">socket.connect(path[, connectListener])</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.connect(path[, connectListener])</code>æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šè·¯å¾„çš„ socket è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨åœ¨å®¢æˆ·ç«¯ï¼Œå¸®åŠ©ä½ è¿æ¥åˆ°æœåŠ¡å™¨ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥è¯¦ç»†è§£æè¿™ä¸ªæ–¹æ³•ã€‚</p><ol><li><p><strong>socket.connect(path[, connectListener])</strong>: è¿™æ˜¯æ–¹æ³•çš„åŸºæœ¬å½¢å¼ã€‚<code>socket</code>æ˜¯ä¸€ä¸ª socket å¯¹è±¡ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¯ä»¥æ¥æ”¶å’Œå‘é€æ•°æ®çš„é€šé“ã€‚<code>connect</code>æ˜¯è¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥å»ºç«‹è¿æ¥ã€‚</p></li><li><p><strong>path</strong>: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†ä½ è¦è¿æ¥çš„ç›®æ ‡åœ°å€ã€‚åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç«¯å£å·ï¼ˆå¯¹äº TCP è¿æ¥ï¼‰æˆ–è€…ä¸€ä¸ªè·¯å¾„ï¼ˆå¯¹äº IPC è¿æ¥ï¼‰ã€‚</p></li><li><p><strong>connectListener</strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚å¦‚æœæä¾›ï¼Œè¿™ä¸ªå‡½æ•°å°†ä¼šåœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨ã€‚å®ƒæ˜¯ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œç›¸å½“äºç›‘å¬äº†&#39;connect&#39;äº‹ä»¶ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›å®é™…çš„åº”ç”¨ä¾‹å­ï¼š</p><h3 id="ç¤ºä¾‹-1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨-1"><span>ç¤ºä¾‹ 1ï¼šè¿æ¥åˆ° TCP æœåŠ¡å™¨</span></a></h3><p>å‡è®¾æœ‰ä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°ï¼Œç«¯å£ä¸º 8080 çš„ TCP æœåŠ¡å™¨ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨<code>socket.connect</code>æ–¹æ³•å»è¿æ¥å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to the server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server! Love, Client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ socket å®¢æˆ·ç«¯ï¼Œå°è¯•è¿æ¥åˆ°æœ¬åœ°çš„ 8080 ç«¯å£ã€‚ä¸€æ—¦è¿æ¥æˆåŠŸï¼Œå®ƒä¼šå‘é€ä¸€æ¡æ¶ˆæ¯åˆ°æœåŠ¡å™¨ã€‚</p><h3 id="ç¤ºä¾‹-2-è¿æ¥åˆ°-ipc-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è¿æ¥åˆ°-ipc-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 2ï¼šè¿æ¥åˆ° IPC æœåŠ¡å™¨</span></a></h3><p>å¦‚æœä½ çš„æœåŠ¡å™¨æ˜¯ä¸€ä¸ª IPC æœåŠ¡å™¨ï¼Œä½¿ç”¨çš„æ˜¯è·¯å¾„è€Œä¸æ˜¯ç«¯å£å·ï¼Œè¿æ¥æ–¹å¼ä¼šç•¥æœ‰ä¸åŒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socketPath</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/tmp/echo.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socketPath</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to the server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server! Love, Client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>socketPath</code>æ˜¯ IPC æœåŠ¡å™¨ç›‘å¬çš„è·¯å¾„ã€‚å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªè·¯å¾„è¿æ¥åˆ°æœåŠ¡å™¨ã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>socket.connect</code>æ–¹æ³•å¦‚ä½•åœ¨ä¸åŒåœºæ™¯ä¸‹ç”¨äºå»ºç«‹ä¸æœåŠ¡å™¨çš„è¿æ¥ã€‚æ— è®ºæ˜¯ TCP è¿˜æ˜¯ IPC è¿æ¥ï¼Œè¿™ä¸ªæ–¹æ³•éƒ½æä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥å¯åŠ¨å’Œç®¡ç†ç½‘ç»œè¿æ¥ã€‚</p><h4 id="socket-connect-port-host-connectlistener" tabindex="-1"><a class="header-anchor" href="#socket-connect-port-host-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketconnectport-host-connectlistener" target="_blank" rel="noopener noreferrer">socket.connect(port[, host][, connectListener])</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚è€Œåœ¨ Node.js ä¸­ï¼Œ<code>socket.connect()</code> æ–¹æ³•æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£çš„ TCP è¿æ¥ã€‚</p><h3 id="è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-2"><span>è§£é‡Š</span></a></h3><p><code>socket.connect(port[, host][, connectListener])</code> æ–¹æ³•ç”¨äºå¯åŠ¨ä¸€ä¸ª socketï¼ˆå¥—æ¥å­—ï¼‰è¿æ¥ã€‚ç®€å•æ¥è¯´ï¼Œå°±åƒä½ ç”¨ç”µè¯æ‹¨æ‰“ä¸€ä¸ªå·ç å»ºç«‹é€šè¯è¿æ¥ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•è®©ä½ çš„ç¨‹åºèƒ½å¤Ÿâ€œæ‹¨æ‰“â€åˆ°å¦ä¸€å°è®¡ç®—æœºä¸Šçš„ç‰¹å®šç«¯å£ï¼Œä»è€Œå»ºç«‹ä¸€ä¸ªç½‘ç»œè¿æ¥ã€‚</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>port</code>ï¼šå¿…éœ€å‚æ•°ï¼Œä»£è¡¨ä½ æƒ³è¦è¿æ¥åˆ°çš„è¿œç¨‹è®¡ç®—æœºçš„ç«¯å£å·ã€‚</li><li><code>host</code>ï¼šå¯é€‰å‚æ•°ï¼Œä»£è¡¨è¿œç¨‹è®¡ç®—æœºçš„åœ°å€ï¼Œæ¯”å¦‚ä¸€ä¸ª IP åœ°å€æˆ–è€…åŸŸåã€‚å¦‚æœä¸æä¾›ï¼Œé»˜è®¤ä¸º &#39;localhost&#39;ã€‚</li><li><code>connectListener</code>ï¼šå¯é€‰å‚æ•°ï¼Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“è¿æ¥æˆåŠŸå»ºç«‹æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­</span></a></h3><h4 id="_1-è¿æ¥åˆ°æœ¬åœ°çš„æ•°æ®åº“æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-è¿æ¥åˆ°æœ¬åœ°çš„æ•°æ®åº“æœåŠ¡å™¨"><span>1. è¿æ¥åˆ°æœ¬åœ°çš„æ•°æ®åº“æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°ï¼ˆlocalhostï¼‰ï¼Œç›‘å¬ç«¯å£ 27017 çš„ MongoDB æ•°æ®åº“æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥è¿æ¥åˆ°å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª socket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ connect æ–¹æ³•è¿æ¥åˆ° MongoDB æœåŠ¡</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">27017</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to MongoDB server on port 27017</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æ•°æ®äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received data: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é”€æ¯ socketï¼Œç»“æŸè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬å…³é—­äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>net</code> æ¨¡å—ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ socket å®¢æˆ·ç«¯ã€‚é€šè¿‡ <code>connect</code> æ–¹æ³•ï¼Œæˆ‘ä»¬è¿æ¥åˆ°äº†æœ¬åœ°çš„ MongoDB æœåŠ¡å™¨ã€‚ä¸€æ—¦è¿æ¥æˆåŠŸï¼Œæ§åˆ¶å°å°†æ‰“å°å‡º &quot;Connected to MongoDB server on port 27017&quot;ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ³¨å†Œäº†å¤„ç†æ•°æ®æ¥æ”¶å’Œè¿æ¥å…³é—­çš„äº‹ä»¶ç›‘å¬å™¨ã€‚</p><h4 id="_2-è¿æ¥åˆ°è¿œç¨‹-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_2-è¿æ¥åˆ°è¿œç¨‹-http-æœåŠ¡å™¨"><span>2. è¿æ¥åˆ°è¿œç¨‹ HTTP æœåŠ¡å™¨</span></a></h4><p>å¦‚æœä½ æƒ³è¦é€šè¿‡åŸå§‹çš„ TCP è¿æ¥æ¥å’Œä¸€ä¸ªè¿œç¨‹çš„ HTTP æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">80</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to example.com on port 80</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP GET è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">GET / HTTP/1.1</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#A3BE8C;">Host: example.com</span><span style="color:#EBCB8B;">\r\n\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é”€æ¯ socketï¼Œç»“æŸè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•è¿æ¥åˆ° <code>example.com</code> çš„ 80 ç«¯å£ï¼ˆHTTP é»˜è®¤ç«¯å£ï¼‰ï¼Œç„¶åå‘é€ä¸€ä¸ªç®€å•çš„ HTTP GET è¯·æ±‚è‡³æœåŠ¡å™¨ã€‚æ¥ç€ï¼ŒæœåŠ¡å™¨çš„å“åº”ä¼šè¢«æ‰“å°åˆ°æ§åˆ¶å°ã€‚æœ€åï¼Œæ¥æ”¶å®Œæ•°æ®åï¼Œå®¢æˆ·ç«¯ä¼šé”€æ¯ socketï¼Œç»“æŸè¿æ¥ã€‚</p><p>é€šè¿‡è¿™äº›å®ä¾‹ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ° <code>socket.connect()</code> åœ¨ Node.js åº”ç”¨ä¸­åˆ›å»ºç½‘ç»œè¿æ¥çš„åŸºæœ¬ç”¨é€”ã€‚æ— è®ºæ˜¯è¿æ¥åˆ°æœ¬åœ°æœåŠ¡è¿˜æ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œéƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ã€‚</p><h3 id="socket-connecting" tabindex="-1"><a class="header-anchor" href="#socket-connecting"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketconnecting" target="_blank" rel="noopener noreferrer">socket.connecting</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.connecting</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæ ‡è¯† socketï¼ˆå¥—æ¥å­—ï¼‰æ˜¯å¦æ­£åœ¨å°è¯•å»ºç«‹è¿æ¥ã€‚å½“ä½ ä½¿ç”¨ Node.js çš„<code>net</code>æ¨¡å—åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œè¿™ä¸ªå±æ€§ä¼šå˜å¾—éå¸¸æœ‰ç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>socket.connecting</code> ä¼šåœ¨å°è¯•è¿æ¥è¿‡ç¨‹ä¸­è¿”å›<code>true</code>ï¼Œä¸€æ—¦è¿æ¥å»ºç«‹æˆ–è€…è¿æ¥å°è¯•å¤±è´¥ï¼Œå®ƒä¼šè¿”å›<code>false</code>ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥çœ‹çœ‹<code>socket.connecting</code>æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h4 id="ç¤ºä¾‹-1-åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—å¹¶è¿æ¥åˆ°æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—å¹¶è¿æ¥åˆ°æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1ï¼šåˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—å¹¶è¿æ¥åˆ°æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºéœ€è¦è¿æ¥åˆ°æŸä¸ªæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯å£ã€‚ä½ å¯ä»¥ä½¿ç”¨ Node.js çš„<code>net</code>æ¨¡å—æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªsocket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¼€å§‹è¿æ¥åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨socket.connectingæ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">connecting</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™é‡Œåº”è¯¥ä¼šæ‰“å° trueï¼Œå› ä¸ºè¿æ¥æ­£åœ¨å°è¯•ä¸­</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">connecting</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿æ¥å»ºç«‹åï¼Œè¿™é‡Œä¼šæ‰“å° false</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª socket å®¢æˆ·ç«¯ï¼Œå¹¶å°è¯•è¿æ¥åˆ°æœ¬åœ°ä¸»æœºï¼ˆ<code>127.0.0.1</code>ï¼‰ä¸Šçš„<code>12345</code>ç«¯å£ã€‚åœ¨<code>client.connect</code>è°ƒç”¨ä¹‹åï¼Œæˆ‘ä»¬æ£€æŸ¥<code>client.connecting</code>çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°å®ƒè¿”å›<code>true</code>ï¼Œå› ä¸ºæ­¤æ—¶è¿æ¥å°è¯•æ­£åœ¨è¿›è¡Œä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬ç›‘å¬<code>connect</code>äº‹ä»¶ï¼Œä¸€æ—¦è¿æ¥æˆåŠŸå»ºç«‹ï¼Œ<code>client.connecting</code>å°†è¿”å›<code>false</code>ã€‚</p><h4 id="ç¤ºä¾‹-2-é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-é”™è¯¯å¤„ç†"><span>ç¤ºä¾‹ 2ï¼šé”™è¯¯å¤„ç†</span></a></h4><p>äº†è§£<code>socket.connecting</code>å±æ€§ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨è¿›è¡Œé”™è¯¯å¤„ç†æ—¶æ›´ç²¾ç¡®åœ°ç†è§£ç¨‹åºçš„çŠ¶æ€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">connecting</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å°è¯•å¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬äº† socket çš„<code>error</code>äº‹ä»¶ã€‚é€šè¿‡æ£€æŸ¥<code>client.connecting</code>çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åŒºåˆ†é”™è¯¯æ˜¯åœ¨è¿æ¥å°è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿï¼ˆä¾‹å¦‚ï¼ŒæœåŠ¡å™¨ä¸å¯è¾¾ï¼‰ï¼Œè¿˜æ˜¯åœ¨è¿æ¥å·²ç»å»ºç«‹ä¹‹åå‘ç”Ÿçš„ï¼ˆä¾‹å¦‚ï¼Œè¿æ¥æ„å¤–æ–­å¼€ï¼‰ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>socket.connecting</code>å±æ€§ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§æ–¹æ³•æ¥åˆ¤æ–­ socket è¿æ¥çš„å½“å‰çŠ¶æ€ï¼Œè¿™åœ¨è¿›è¡Œè¿æ¥ç®¡ç†å’Œé”™è¯¯å¤„ç†æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="socket-destroy-error" tabindex="-1"><a class="header-anchor" href="#socket-destroy-error"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketdestroyerror" target="_blank" rel="noopener noreferrer">socket.destroy([error])</a></span></a></h3><p>Node.js çš„ <code>socket.destroy([error])</code> æ–¹æ³•æ˜¯ä¸€ä¸ªç”¨äºå…³é—­ç½‘ç»œé€šä¿¡ä¸­çš„å¥—æ¥å­—ï¼ˆsocketï¼‰çš„å‡½æ•°ã€‚åœ¨ Node.js ä¸­ï¼Œç½‘ç»œé€šä¿¡æ˜¯éå¸¸æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒå…è®¸ä½ çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šè¿‡äº’è”ç½‘ä¸å…¶ä»–è®¡ç®—æœºæˆ–æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤æ¢ã€‚å¥—æ¥å­—å®é™…ä¸Šå°±æ˜¯ä¸¤ä¸ªç½‘ç»œåº”ç”¨ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢çš„ç«¯ç‚¹ã€‚</p><p>å½“æˆ‘ä»¬è°ˆåˆ° <code>socket.destroy([error])</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯æŒ‡åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä¸»åŠ¨å…³é—­è¿™ä¸ªè¿æ¥ï¼Œè€Œä¸æ˜¯ç­‰å®ƒè‡ªç„¶ç»“æŸã€‚è¿™é‡Œæœ‰å‡ ä¸ªåœºæ™¯è¯´æ˜ä¸ºä»€ä¹ˆå’Œæ€æ ·ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼š</p><h3 id="åº”ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹"><span>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h3><ol><li><strong>è¶…æ—¶æ–­å¼€</strong>: å‡è®¾ä½ çš„æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å»ºç«‹äº†è¿æ¥ï¼Œä½†å› ä¸ºæŸäº›åŸå› ï¼Œå®¢æˆ·ç«¯é•¿æ—¶é—´æ²¡æœ‰å“åº”ã€‚ä¸ºäº†èµ„æºçš„æœ‰æ•ˆåˆ©ç”¨å’Œå®‰å…¨è€ƒè™‘ï¼Œä½ å¯èƒ½ä¼šè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œåœ¨è¿™æ®µæ—¶é—´åå¦‚æœè¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„å›å¤ï¼Œå°±ä½¿ç”¨ <code>socket.destroy()</code> æ¥ä¸»åŠ¨å…³é—­è¿æ¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received data: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¦‚æœ60ç§’å†…æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œåˆ™å…³é—­socket</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">60000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Socket timed out due to inactivity, destroying...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8124</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 8124</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>é”™è¯¯å¤„ç†</strong>: å½“åœ¨ä¸å®¢æˆ·ç«¯é€šä¿¡è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯æ—¶ï¼ˆæ¯”å¦‚æ•°æ®æ ¼å¼é”™è¯¯æˆ–è€…ä¼ è¾“ä¸­æ–­ï¼‰ï¼Œä¸ºäº†é˜²æ­¢é”™è¯¯å¯¼è‡´çš„æ½œåœ¨é—®é¢˜ï¼Œå¯ä»¥é€‰æ‹©é”€æ¯è¿™ä¸ªå¥—æ¥å­—è¿æ¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Encountered an error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é”€æ¯socketå¹¶å¯é€‰åœ°ä¼ é€’é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>ä¼˜é›…åœ°é€€å‡º</strong>: å½“æœåŠ¡å™¨éœ€è¦åœæ­¢æ¥å—æ–°çš„è¿æ¥è¯·æ±‚ï¼ŒåŒæ—¶ä¹Ÿæƒ³è¦ä¼˜é›…åœ°å…³é—­ç°æœ‰çš„è¿æ¥æ—¶ï¼Œå¯ä»¥å¯¹æ¯ä¸ªæ´»è·ƒçš„è¿æ¥è°ƒç”¨ <code>socket.destroy()</code> æ–¹æ³•æ¥ç¡®ä¿æ‰€æœ‰èµ„æºè¢«æ­£ç¡®é‡Šæ”¾ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾socketsæ˜¯å­˜å‚¨æ‰€æœ‰æ´»è·ƒè¿æ¥çš„æ•°ç»„</span></span>
<span class="line"><span style="color:#D8DEE9;">sockets</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forEach</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ³¨æ„äº‹é¡¹-1" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-1"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>è°ƒç”¨ <code>socket.destroy()</code> åï¼Œè¯¥è¿æ¥å°†ä¸èƒ½å†ç”¨äºå‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚</li><li>æ‚¨å¯ä»¥é€‰æ‹©æ€§åœ°ä¼ é€’ä¸€ä¸ª <code>Error</code> å¯¹è±¡ç»™ <code>destroy()</code> æ–¹æ³•ï¼Œè¿™æ ·åšå¯ä»¥å¸®åŠ©è°ƒè¯•ï¼Œå› ä¸ºå®ƒå°†ä½œä¸º &#39;error&#39; äº‹ä»¶çš„å‚æ•°è¢«ä¼ é€’å‡ºå»ï¼ˆå¦‚æœç›‘å¬äº†æ­¤äº‹ä»¶çš„è¯ï¼‰ã€‚</li><li>è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¸ä¼šç«‹å³å¯¼è‡´ &#39;close&#39; äº‹ä»¶çš„è§¦å‘ï¼›Node.js ä¼šå…ˆå°è¯•å‘é€é˜Ÿåˆ—ä¸­å‰©ä½™çš„æ•°æ®ï¼Œç„¶åæ‰å…³é—­è¿æ¥ã€‚</li></ul><p>æ€»ä¹‹ï¼Œ<code>socket.destroy([error])</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºæ§åˆ¶å’Œç®¡ç†ç½‘ç»œè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸã€‚é€‚æ—¶åœ°ä½¿ç”¨å®ƒï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºæ›´ç¨³å®šã€æ›´é«˜æ•ˆçš„ç½‘ç»œåº”ç”¨ã€‚</p><h3 id="socket-destroyed" tabindex="-1"><a class="header-anchor" href="#socket-destroyed"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketdestroyed" target="_blank" rel="noopener noreferrer">socket.destroyed</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js æä¾›äº†ä¸€å¥—ä¸°å¯Œçš„æ ‡å‡†åº“ï¼Œå…¶ä¸­åŒ…å«äº†ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰æ¨¡å—ï¼Œä»¥æ”¯æŒå„ç§æœåŠ¡å™¨ç«¯åŠŸèƒ½ã€‚åœ¨è¿™äº›æ ‡å‡†åº“ä¸­ï¼Œ<code>net</code> æ¨¡å—æä¾›äº†åˆ›å»ºåŸºäºæµå’Œå¥—æ¥å­—çš„ç½‘ç»œåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ TCP æˆ– IPC æœåŠ¡å™¨/å®¢æˆ·ç«¯ã€‚</p><h3 id="socket-destroyed-1" tabindex="-1"><a class="header-anchor" href="#socket-destroyed-1"><span>socket.destroyed</span></a></h3><p>åœ¨ Node.js çš„ <code>net</code> æ¨¡å—ä¸­ï¼Œ<code>socket.destroyed</code> å±æ€§æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ­¤ socketï¼ˆå¥—æ¥å­—ï¼‰æ˜¯å¦å·²ç»è¢«é”€æ¯ã€‚å¦‚æœ socket å·²ç»ç»“æŸé€šä¿¡å¹¶è¢«é”€æ¯ï¼Œåˆ™è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</p><h4 id="å®é™…åº”ç”¨åœºæ™¯-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-3"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h4><ol><li><p><strong>å®æ—¶èŠå¤©åº”ç”¨</strong>ï¼š<br> åœ¨å¼€å‘ä¸€ä¸ªå®æ—¶èŠå¤©åº”ç”¨æ—¶ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´éœ€è¦ä¿æŒæŒç»­çš„è¿æ¥ã€‚å½“æŸä¸ªç”¨æˆ·é€€å‡ºèŠå¤©å®¤æˆ–å…³é—­ç½‘é¡µæ—¶ï¼Œå¯¹åº”çš„ socket è¿æ¥éœ€è¦è¢«æ¸…ç†å’Œé”€æ¯ï¼Œä»¥é‡Šæ”¾æœåŠ¡å™¨èµ„æºã€‚è¿™æ—¶å€™ï¼Œé€šè¿‡æ£€æŸ¥ <code>socket.destroyed</code> çš„çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯ä»¥ç¡®å®šå“ªäº›è¿æ¥å·²ç»ä¸å†æ´»è·ƒï¼Œè¿›è€Œè¿›è¡Œå¦¥å–„å¤„ç†ã€‚</p></li><li><p><strong>å¤šäººåœ¨çº¿æ¸¸æˆæœåŠ¡å™¨</strong>ï¼š<br> å¯¹äºå¤šäººåœ¨çº¿æ¸¸æˆï¼Œç©å®¶ä¹‹é—´çš„å®æ—¶äº’åŠ¨ä¾èµ–äºç¨³å®šçš„ç½‘ç»œè¿æ¥ã€‚å¦‚æœç©å®¶çš„ç½‘ç»œè¿æ¥çªç„¶æ–­å¼€ï¼ˆå¯èƒ½æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜æˆ–ç©å®¶ä¸»åŠ¨ç¦»å¼€ï¼‰ï¼ŒæœåŠ¡å™¨éœ€è¦è¿…é€ŸçŸ¥é“è¿™ä¸€å˜åŒ–æ¥è°ƒæ•´æ¸¸æˆçŠ¶æ€ï¼Œå¦‚å°†è¯¥ç©å®¶æ ‡è®°ä¸ºæ‰çº¿çŠ¶æ€æˆ–ä»æ¸¸æˆä¸­ç§»é™¤ã€‚é€šè¿‡ç›‘è§†æ¯ä¸ªç©å®¶è¿æ¥çš„ <code>socket.destroyed</code> çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯ä»¥åŠæ—¶åšå‡ºååº”ã€‚</p></li><li><p><strong>API æœåŠ¡</strong>ï¼š<br> å½“æ„å»ºä¸€ä¸ª API æœåŠ¡æ—¶ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå¤„ç†æˆåƒä¸Šä¸‡çš„è¯·æ±‚ã€‚ä¸ºäº†ç®¡ç†èµ„æºå¹¶é˜²æ­¢å†…å­˜æ³„æ¼ï¼ŒæœåŠ¡å™¨éœ€è¦è·Ÿè¸ªå“ªäº›è¯·æ±‚å·²ç»å¤„ç†å®Œæˆï¼Œå¹¶å…³é—­é‚£äº›ä¸å†éœ€è¦çš„è¿æ¥ã€‚åˆ©ç”¨ <code>socket.destroyed</code>ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿè¯†åˆ«å“ªäº›è¿æ¥å·²ç»ç»“æŸï¼Œä»è€Œå¯ä»¥å…³é—­è¿™äº› socket è¿æ¥ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚</p></li></ol><h4 id="ç¤ºä¾‹ä»£ç -4" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -4"><span>ç¤ºä¾‹ä»£ç </span></a></h4><p>è¿™é‡Œæœ‰ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>socket.destroyed</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾åœ¨ä¸€äº›äº¤äº’åï¼Œä½ æƒ³æ£€æŸ¥ socket æ˜¯å¦å·²é”€æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">destroyed</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Socket å·²ç»è¢«é”€æ¯</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æ­£å¸¸å¤„ç†å…¶ä»–é€»è¾‘</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ°å®æ—¶èŠå¤©åº”ç”¨!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨åœ¨8080ç«¯å£ç›‘å¬</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 8080 ç«¯å£ä¸Šçš„è¿æ¥ã€‚å¯¹äºæ¯ä¸ªæ–°çš„è¿æ¥ï¼ŒæœåŠ¡å™¨éƒ½ä¼šæ£€æŸ¥è¿æ¥çš„ <code>socket.destroyed</code> çŠ¶æ€ã€‚å¦‚æœ socket æ²¡æœ‰è¢«é”€æ¯ï¼ŒæœåŠ¡å™¨å°±å‘å®¢æˆ·ç«¯å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚åŒæ ·åœ°ï¼Œå½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ”¶åˆ° <code>end</code> äº‹ä»¶çš„é€šçŸ¥ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>socket.destroyed</code> æ˜¯ Node.js ç½‘ç»œç¼–ç¨‹ä¸­é‡è¦çš„å±æ€§ä¹‹ä¸€ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…ç®¡ç† socket è¿æ¥ï¼Œç¡®ä¿åº”ç”¨çš„å¥å£®æ€§å’Œèµ„æºæœ‰æ•ˆä½¿ç”¨ã€‚</p><h3 id="socket-destroysoon" tabindex="-1"><a class="header-anchor" href="#socket-destroysoon"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketdestroysoon" target="_blank" rel="noopener noreferrer">socket.destroySoon()</a></span></a></h3><p>Node.js çš„ <code>socket.destroySoon()</code> æ–¹æ³•æ˜¯ <code>net.Socket</code> ç±»çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä½ åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨ Node.js çš„æœ€æ–°æ–‡æ¡£ä¸­ï¼Œ<code>destroySoon()</code> æ–¹æ³•å®é™…ä¸Šå·²ç»ä¸å†æåŠäº†ã€‚è¿™æ„å‘³ç€åœ¨ä½ æåˆ°çš„ Node.js ç‰ˆæœ¬ï¼ˆv21.7.1ï¼‰æˆ–å…¶ä»–è¿‘æœŸç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å¯èƒ½å·²ç»è¢«åºŸå¼ƒæˆ–é‡å‘½åã€‚</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>destroySoon()</code> æ–¹æ³•é€šå¸¸ç”¨äºåœ¨å†™å…¥ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°æ®å‘é€å®Œæ¯•ä¹‹åå…³é—­å¥—æ¥å­—ã€‚å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œå³ä¾¿ä½ è°ƒç”¨äº† <code>destroySoon()</code>ï¼ŒNode.js ä¹Ÿä¼šç­‰åˆ°æ‰€æœ‰çš„æ•°æ®éƒ½æˆåŠŸå‘é€åˆ°å¯¹æ–¹åï¼Œæ‰çœŸæ­£å…³é—­è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•çš„å­˜åœ¨æ˜¯ä¸ºäº†ç¡®ä¿æ•°æ®çš„å®Œæ•´å‘é€ï¼Œé¿å…æ•°æ®çš„ä¸¢å¤±ã€‚</p><p>ç„¶è€Œï¼Œå¯¹äºç°ä»£çš„ Node.js åº”ç”¨ï¼Œä½ é€šå¸¸ä¼šä½¿ç”¨ <code>socket.end()</code> æ–¹æ³•æ¥ä»£æ›¿ <code>destroySoon()</code>ã€‚<code>socket.end()</code> ä¹Ÿä¼šç­‰å¾…æ‰€æœ‰æ•°æ®å‘é€å®Œæˆåæ‰å…³é—­è¿æ¥ï¼Œä½†å®ƒæä¾›äº†ä¸€ä¸ªæ›´ç›´æ¥å’Œæ¸…æ™°çš„æ–¹å¼æ¥ç»“æŸé€šä¿¡ã€‚ä½ å¯ä»¥å‘ <code>socket.end()</code> æ–¹æ³•ä¼ é€’ä¸€äº›å¯é€‰çš„æ•°æ®å‚æ•°ï¼ˆå¦‚æœä½ è¿˜æœ‰æœ€åçš„æ•°æ®è¦å‘é€çš„è¯ï¼‰ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œä»¥åœ¨è¿æ¥çœŸæ­£ç»“æŸæ—¶å¾—åˆ°é€šçŸ¥ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><ol><li><strong>ç»“æŸ TCP æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„è¿æ¥</strong>ï¼š</li></ol><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª TCP æœåŠ¡å™¨å’Œä¸€ä¸ªå®¢æˆ·ç«¯ã€‚å½“æœåŠ¡å™¨å®Œæˆæ•°æ®å‘é€ä»»åŠ¡åï¼Œå®ƒå¯ä»¥ä½¿ç”¨ <code>socket.end()</code> æ¥å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç«¯ä»£ç </span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, client!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Goodbye, client!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‘é€å®Œæ¯•åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8124</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is listening on port 8124</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ä¼˜é›…å…³é—­ TCP è¿æ¥</strong>ï¼š</li></ol><p>åœ¨ä¸€ä¸ªæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½éœ€è¦åœ¨å‘é€å®Œä¸€ç³»åˆ—æ•°æ®åå…³é—­è¿æ¥ã€‚ä½ å¯ä»¥åœ¨æœ€åä¸€æ¬¡è°ƒç”¨ <code>write</code> æ–¹æ³•ä¹‹åè°ƒç”¨ <code>end</code> æ–¹æ³•ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½è¢«å‘é€å‡ºå»åå†å…³é—­è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Sending some data...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Sending more data...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Last bit of data, closing now.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä½¿ç”¨ <code>end()</code> æ–¹æ³•æ›¿ä»£ <code>destroySoon()</code> çš„è¿‡ç¨‹ä¸­ï¼Œä½ åº”è¯¥æ„è¯†åˆ°ï¼Œ<code>end()</code> æ–¹æ³•çš„ä½¿ç”¨æ–¹å¼æ›´åŠ ç›´è§‚å’Œæ˜“äºç†è§£ï¼Œè¿™æœ‰åŠ©äºæé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚</p><h3 id="socket-end-data-encoding-callback" tabindex="-1"><a class="header-anchor" href="#socket-end-data-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketenddata-encoding-callback" target="_blank" rel="noopener noreferrer">socket.end([data[, encoding]][, callback])</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.end([data[, encoding]][, callback])</code>æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„æ–¹æ³•ï¼Œå®ƒç”¨äºç»“æŸä¸€ä¸ª socket è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©ä½ ä¼˜é›…åœ°å…³é—­è¿æ¥ï¼Œè¿˜å¯ä»¥åœ¨å…³é—­å‰å‘é€ä¸€äº›å‰©ä½™çš„æ•°æ®ã€‚æˆ‘ä»¬æ¥è¯¦ç»†åˆ†è§£è¿™ä¸ªæ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…ä¸­åº”ç”¨å®ƒã€‚</p><h3 id="å‚æ•°è§£é‡Š-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-3"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>data</code>ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°å…è®¸ä½ å‘é€ä¸€æ¡æ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œç„¶åå†ç»“æŸè¿æ¥ã€‚è¿™å¯¹äºéœ€è¦å‘é€â€œå†è§â€æ¶ˆæ¯æˆ–è€…å®ŒæˆæŸäº›åè®®æ­¥éª¤éå¸¸æœ‰ç”¨ã€‚</li><li><code>encoding</code>ï¼ˆå¯é€‰ï¼‰: å¦‚æœä½ å‘é€çš„<code>data</code>æ˜¯å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°æŒ‡å®šç¼–ç æ–¹å¼ï¼ˆæ¯”å¦‚<code>&#39;utf8&#39;</code>ï¼‰ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨<code>&#39;utf8&#39;</code>ç¼–ç ã€‚</li><li><code>callback</code>ï¼ˆå¯é€‰ï¼‰: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“ socket ç»“æŸåä¼šè¢«è°ƒç”¨ã€‚ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªå›è°ƒæ¥å¤„ç†æ¸…ç†å·¥ä½œæˆ–è€…ç¡®è®¤è¿æ¥å·²ç»å…³é—­ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-11"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ç®€å•å…³é—­è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç®€å•å…³é—­è¿æ¥"><span>ä¾‹å­ 1ï¼šç®€å•å…³é—­è¿æ¥</span></a></h4><p>å¦‚æœä½ åªæ˜¯æƒ³å…³é—­è¿æ¥ï¼Œä¸éœ€è¦å‘é€ä»»ä½•æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨<code>socket.end()</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€æ•°æ®åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼ŒæœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¸å‘é€ä»»ä½•æ•°æ®ï¼Œç›´æ¥ç»“æŸè¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-å‘é€æ•°æ®ç„¶åå…³é—­è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å‘é€æ•°æ®ç„¶åå…³é—­è¿æ¥"><span>ä¾‹å­ 2ï¼šå‘é€æ•°æ®ç„¶åå…³é—­è¿æ¥</span></a></h4><p>å¦‚æœä½ æƒ³åœ¨å…³é—­è¿æ¥ä¹‹å‰å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€æ•°æ®åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼ŒæœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€&quot;å†è§&quot;æ¶ˆæ¯ç„¶åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å†è§ï¼ŒæœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-3-ä½¿ç”¨å›è°ƒç¡®è®¤å…³é—­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-ä½¿ç”¨å›è°ƒç¡®è®¤å…³é—­"><span>ä¾‹å­ 3ï¼šä½¿ç”¨å›è°ƒç¡®è®¤å…³é—­</span></a></h4><p>ä½ ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ç»™<code>end</code>æ–¹æ³•ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨è¿æ¥å®Œå…¨å…³é—­åæ‰§è¡Œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“è¿æ¥å…³é—­æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> onEnd</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å·²å…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€æ•°æ®å¹¶åœ¨ç»“æŸåè°ƒç”¨å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å†è§ï¼ŒæœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onEnd</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨<code>socket.end</code>æ–¹æ³•æ¥ä¼˜é›…åœ°ç®¡ç†ä½ çš„ socket è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•çš„çµæ´»æ€§è®©ä½ èƒ½å¤Ÿåœ¨ç»´æŠ¤è‰¯å¥½çš„ç½‘ç»œé€šä¿¡åè®®çš„åŒæ—¶ï¼Œä¹Ÿèƒ½ä¼˜é›…åœ°ç»“æŸè¿æ¥ã€‚</p><h3 id="socket-localaddress" tabindex="-1"><a class="header-anchor" href="#socket-localaddress"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketlocaladdress" target="_blank" rel="noopener noreferrer">socket.localAddress</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.localAddress</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å–å¥—æ¥å­—ï¼ˆsocketï¼‰çš„æœ¬åœ°ç»‘å®šåœ°å€ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„è®¡ç®—æœºé€šè¿‡ç½‘ç»œå¥—æ¥å­—ä¸å¦ä¸€å°è®¡ç®—æœºå»ºç«‹è¿æ¥æ—¶ï¼Œ<code>socket.localAddress</code>å°±æ˜¯ä½ è®¡ç®—æœºä¸Šç”¨äºè¿™ä¸ªè¿æ¥çš„ IP åœ°å€ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¸ªå±æ€§é‡è¦å‘¢ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„è®¡ç®—æœºå¯èƒ½æœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼Œæ¯”å¦‚ Wi-Fiã€ä»¥å¤ªç½‘ã€è™šæ‹Ÿç½‘ç»œæ¥å£ç­‰ï¼Œæ¯ä¸ªæ¥å£éƒ½æœ‰è‡ªå·±çš„ IP åœ°å€ã€‚å½“ä½ çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–ç›‘å¬ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå®ƒå¯èƒ½é€šè¿‡å…¶ä¸­ä¸€ä¸ªæ¥å£è¿›è¡Œé€šä¿¡ã€‚<code>socket.localAddress</code>å°±èƒ½å‘Šè¯‰ä½ ï¼Œè¿™ä¸ªå¥—æ¥å­—è¿æ¥æ˜¯é€šè¿‡å“ªä¸ª IP åœ°å€è¿›è¡Œçš„ã€‚</p><p>æ¥çœ‹å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p><strong>æœåŠ¡å™¨ç›‘å¬è¿æ¥</strong>ï¼šå‡è®¾ä½ åœ¨ Node.js ä¸­åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬æœ¬åœ°çš„ 3000 ç«¯å£ã€‚å½“æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>socket.localAddress</code>æ¥æŸ¥çœ‹æœåŠ¡å™¨ç”¨å“ªä¸ªæœ¬åœ° IP åœ°å€æ¥æ”¶äº†è¿™ä¸ªè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> localAddress</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">localAddress</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received request on local address: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">localAddress</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨</strong>ï¼šå½“ä½ çš„ Node.js åº”ç”¨ä½œä¸ºå®¢æˆ·ç«¯ï¼Œè¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡<code>socket.localAddress</code>æŸ¥çœ‹ä½ çš„åº”ç”¨ä½¿ç”¨å“ªä¸ªæœ¬åœ° IP åœ°å€å»ºç«‹äº†è¿™ä¸ªè¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">Client connected through local address: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">localAddress</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Client disconnected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œ<code>socket.localAddress</code>å¸®åŠ©æˆ‘ä»¬è¯†åˆ«å‡ºäº†å“ªä¸ªæœ¬åœ° IP åœ°å€è¢«ç”¨äºç½‘ç»œé€šä¿¡ã€‚è¿™åœ¨è°ƒè¯•ç½‘ç»œåº”ç”¨æˆ–å®ç°åŸºäºç½‘ç»œæ¥å£çš„ç‰¹å®šé€»è¾‘æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="socket-localport" tabindex="-1"><a class="header-anchor" href="#socket-localport"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketlocalport" target="_blank" rel="noopener noreferrer">socket.localPort</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒéå¸¸é€‚åˆå¼€å‘éœ€è¦é«˜å¹¶å‘ã€IO å¯†é›†å‹çš„ç½‘ç»œåº”ç”¨ï¼Œæ¯”å¦‚ç½‘ç«™åç«¯æœåŠ¡ã€API æœåŠ¡æˆ–è€…å®æ—¶é€šè®¯åº”ç”¨ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>net</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ç”¨äºç½‘ç»œç¼–ç¨‹çš„ APIï¼ŒåŒ…æ‹¬åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹ç±»çš„åŠŸèƒ½ã€‚</p><p><code>socket.localPort</code> æ˜¯ <code>net</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ª socketï¼ˆå¥—æ¥å­—ï¼‰è¿æ¥çš„æœ¬åœ°ç«¯å£å·ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„ç”µè„‘ï¼ˆä½œä¸ºå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ï¼‰ä¸å¦ä¸€å°ç”µè„‘å»ºç«‹ç½‘ç»œè¿æ¥æ—¶ï¼Œä¼šä½¿ç”¨åˆ°ç«¯å£å·æ¥æ ‡è¯†å’Œç®¡ç†è¿™ä¸ªè¿æ¥ã€‚æ¯ä¸ªç½‘ç»œè¿æ¥éƒ½ç”±ä¸¤ä¸ªç«¯å£å·æ ‡è¯†ï¼šä¸€ä¸ªæ˜¯ä½ ç”µè„‘ä¸Šçš„ç«¯å£å·ï¼ˆæœ¬åœ°ç«¯å£ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯è¿œç¨‹ç”µè„‘ä¸Šçš„ç«¯å£å·ã€‚</p><h3 id="ä¸¾ä¾‹è¯´æ˜-1" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¾‹è¯´æ˜-1"><span>ä¸¾ä¾‹è¯´æ˜</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„ç”µè„‘ï¼ˆAï¼‰è¦ä¸å¦ä¸€å°ç”µè„‘ï¼ˆBï¼‰é€šè¿‡ç½‘ç»œé€šä¿¡ã€‚ç”µè„‘ A ä¸Šçš„åº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªç«¯å£ï¼ˆæ¯”å¦‚ï¼š5000ï¼‰å‘å‡ºè¯·æ±‚ï¼Œæƒ³è¦è¿æ¥åˆ°ç”µè„‘ B ä¸Šè¿è¡Œçš„æœåŠ¡ï¼Œè¯¥æœåŠ¡ç›‘å¬åœ¨å¦ä¸€ä¸ªç«¯å£ï¼ˆæ¯”å¦‚ï¼š80ï¼‰ä¸Šã€‚</p><ul><li><strong>ç”µè„‘ A çš„ç«¯å£ 5000</strong>å°±æ˜¯<code>socket.localPort</code>ï¼Œå³æœ¬åœ°ç«¯å£ã€‚</li><li><strong>ç”µè„‘ B çš„ç«¯å£ 80</strong>åˆ™æ˜¯<code>socket.remotePort</code>ï¼Œå³è¿œç¨‹ç«¯å£ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>å»ºç«‹ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</strong>ï¼šå½“ä½ ç”¨ Node.js åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç›‘å¬æŸä¸ªç«¯å£ï¼ˆä¾‹å¦‚ 3000ï¼‰ã€‚å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰é€šè¿‡è¿™ä¸ªç«¯å£ä¸æœåŠ¡å™¨é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ åœ¨æœåŠ¡å™¨çš„å›è°ƒå‡½æ•°ä¸­è®¿é—®<code>socket.localPort</code>ï¼Œå®ƒä¼šè¿”å›ä½ çš„æœåŠ¡å™¨æ­£åœ¨ç›‘å¬çš„ç«¯å£å·ï¼Œå³ 3000ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥ä½¿ç”¨ req.socket.localPort è·å–æœ¬åœ°ç«¯å£å·</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">localPort</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¼€å‘èŠå¤©åº”ç”¨</strong>ï¼šåœ¨å¼€å‘ä¸€ä¸ªå®æ—¶èŠå¤©åº”ç”¨æ—¶ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ WebSocketã€‚æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ° WebSocket æœåŠ¡å™¨æ—¶ï¼Œéƒ½ä¼šå ç”¨ä¸€ä¸ªæœ¬åœ°ç«¯å£ã€‚é€šè¿‡<code>socket.localPort</code>ï¼Œä½ å¯ä»¥çŸ¥é“è¿™ä¸ªè¿æ¥ä½¿ç”¨çš„æ˜¯å“ªä¸ªæœ¬åœ°ç«¯å£ã€‚</p></li><li><p><strong>è°ƒè¯•ç½‘ç»œåº”ç”¨</strong>ï¼šåœ¨è°ƒè¯•é˜¶æ®µï¼Œäº†è§£ç½‘ç»œè¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬æœ¬åœ°ç«¯å£å·ï¼‰å¯¹äºè¯†åˆ«å’Œè§£å†³é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚é€šè¿‡æ‰“å°<code>socket.localPort</code>ï¼Œä½ å¯ä»¥çŸ¥é“ä½ çš„åº”ç”¨ç¨‹åºæ˜¯é€šè¿‡å“ªä¸ªç«¯å£ä¸å¤–ç•Œé€šä¿¡çš„ï¼Œè¿™å¯¹äºè§£å†³ç«¯å£å†²çªæˆ–ç†è§£ç½‘ç»œæµé‡åˆ†å¸ƒéå¸¸æœ‰ç”¨ã€‚</p></li></ol><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹å‡º<code>socket.localPort</code>åœ¨å¼€å‘å’Œè°ƒè¯•ç½‘ç»œåº”ç”¨æ—¶çš„é‡è¦æ€§ã€‚å®ƒå¸®åŠ©ä½ ç†è§£å’Œæ§åˆ¶ä½ çš„åº”ç”¨æ˜¯å¦‚ä½•ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡çš„ã€‚</p><h3 id="socket-localfamily" tabindex="-1"><a class="header-anchor" href="#socket-localfamily"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketlocalfamily" target="_blank" rel="noopener noreferrer">socket.localFamily</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptï¼Œæ‰§è¡Œå„ç§åç«¯ä»»åŠ¡ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—å¸®ä½ å¤„ç†ä¸åŒçš„ä»»åŠ¡ï¼Œå…¶ä¸­ <code>net</code> æ¨¡å—å°±æ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ“ä½œçš„ï¼Œæ¯”å¦‚å»ºç«‹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>å½“æˆ‘ä»¬è°ˆè®º <code>socket.localFamily</code> è¿™ä¸ªå±æ€§æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸ç½‘ç»œè¿æ¥ç›¸å…³çš„ä¸€ä¸ªç»†èŠ‚ã€‚å…ˆæ¥è§£é‡Šä¸€ä¸‹å‡ ä¸ªå…³é”®è¯ï¼š</p><ul><li><strong>Socket</strong>ï¼šåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œsocket æ˜¯ç”¨æ¥æè¿° IP åœ°å€å’Œç«¯å£ï¼Œä½œä¸ºé€šä¿¡çš„ç«¯ç‚¹ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆç”µè¯æ’åº§ï¼Œç”µè„‘æˆ–è€…å…¶ä»–è®¾å¤‡é€šè¿‡è¿™ä¸ªâ€œæ’åº§â€ä¸å¤–ç•Œé€šä¿¡ã€‚</li><li><strong>localFamily</strong>ï¼šè¿™ä¸ªå±æ€§è¡¨ç¤ºæœ¬åœ°è®¡ç®—æœºä¸ socket è¿æ¥æ‰€ä½¿ç”¨çš„ IP åœ°å€ç±»å‹ã€‚å®ƒä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼šIPv4 å’Œ IPv6ï¼Œåˆ†åˆ«å¯¹åº”çš„å€¼æ˜¯ <code>&#39;IPv4&#39;</code> æˆ– <code>&#39;IPv6&#39;</code>ã€‚</li></ul><p>ç°åœ¨è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­æ¥å…·ä½“è¯´æ˜è¿™äº›æ¦‚å¿µï¼š</p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘ç»œåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦æ¥æ”¶ç”¨æˆ·çš„è¿æ¥è¯·æ±‚ã€‚ä¸ºäº†å¤„ç†è¿™äº›è¯·æ±‚ï¼Œä½ å†³å®šä½¿ç”¨ Node.js çš„ <code>net</code> æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“å®¢æˆ·ç«¯è¿æ¥ä¸ŠæœåŠ¡å™¨åï¼Œæ‰“å°å‡ºè¿æ¥ä½¿ç”¨çš„æœ¬åœ°IPç±»å‹</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¿æ¥ä½¿ç”¨çš„æœ¬åœ°IPç±»å‹: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">localFamily</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶çš„å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å‘å®¢æˆ·ç«¯å›å‘æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ•°æ®å·²æ¥æ”¶</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶çš„å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨åœ¨3000ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡æ‰“å° <code>socket.localFamily</code> æ¥çœ‹è¿™ä¸ªè¿æ¥æ˜¯ä½¿ç”¨ IPv4 è¿˜æ˜¯ IPv6 åœ°å€ã€‚è¿™å¯¹äºç†è§£ä½ çš„åº”ç”¨å¦‚ä½•åœ¨ç½‘ç»œä¸Šè¿›è¡Œé€šä¿¡éå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯å½“ä½ çš„æœåŠ¡å™¨éœ€è¦æ”¯æŒå¤šç§ç±»å‹çš„ç½‘ç»œåè®®æ—¶ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨éƒ¨ç½²åœ¨ä¸€ä¸ªåªæ”¯æŒ IPv6 çš„ç¯å¢ƒä¸­ï¼Œä½†ä½ çš„åº”ç”¨å°è¯•è¿æ¥ä½¿ç”¨ IPv4ï¼Œè¿™æ—¶å°±ä¼šå› ä¸ºä¸åŒ¹é…è€Œäº§ç”Ÿé—®é¢˜ã€‚å› æ­¤ï¼Œäº†è§£ <code>socket.localFamily</code> å±æ€§å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°è°ƒè¯•å’Œä¼˜åŒ–ä½ çš„ç½‘ç»œåº”ç”¨ã€‚</p><h3 id="socket-pause" tabindex="-1"><a class="header-anchor" href="#socket-pause"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketpause" target="_blank" rel="noopener noreferrer">socket.pause()</a></span></a></h3><p>å½“æˆ‘ä»¬åœ¨è®¨è®º Node.js ä¸­çš„<code>socket.pause()</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç™½ä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å…¶ä¸­ï¼Œâ€œsocketsâ€æ˜¯é€šä¿¡çš„åŸºç¡€ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-socket-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-socket-1"><span>ä»€ä¹ˆæ˜¯ Socket?</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œsocket æ˜¯ç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ã€‚å½“ä½ æµè§ˆç½‘é¡µã€å‘é€ç”µå­é‚®ä»¶æˆ–è€…ä½¿ç”¨å³æ—¶æ¶ˆæ¯åº”ç”¨æ—¶ï¼Œä½ çš„è®¾å¤‡ï¼ˆå®¢æˆ·ç«¯ï¼‰å’Œæä¾›è¿™äº›æœåŠ¡çš„æœåŠ¡å™¨é€šè¿‡â€œsocketsâ€è¿›è¡Œé€šä¿¡ã€‚</p><h3 id="socket-pause-æ–¹æ³•æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#socket-pause-æ–¹æ³•æ¦‚è¿°"><span>socket.pause() æ–¹æ³•æ¦‚è¿°</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.pause()</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œå®ƒå±äº net æ¨¡å—ä¸‹çš„ Socket å¯¹è±¡ã€‚é¡¾åæ€ä¹‰ï¼Œè¯¥æ–¹æ³•ç”¨äºæš‚åœå¤„ç†æ¥æ”¶åˆ°çš„æ–°æ•°æ®ã€‚è¿™æ„å‘³ç€ï¼Œä¸€æ—¦è°ƒç”¨äº†<code>socket.pause()</code>ï¼Œä»»ä½•æ–°çš„æ•°æ®äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯<code>&#39;data&#39;</code>äº‹ä»¶ï¼‰éƒ½ä¸ä¼šè§¦å‘ï¼Œç›´åˆ°ä½ å†³å®šç»§ç»­å¤„ç†è¿™äº›æ•°æ®ï¼ˆé€šè¿‡è°ƒç”¨<code>socket.resume()</code>ï¼‰ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-socket-pause" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-socket-pause"><span>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ socket.pause()?</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ã€‚ä½ çš„æœåŠ¡å™¨éœ€è¦å¤„ç†æ•°ä»¥åƒè®¡çš„æ¶ˆæ¯ã€‚å¦‚æœæ¯ä¸ªæ¶ˆæ¯éƒ½åœ¨åŒæ—¶å‘é€ç»™æœåŠ¡å™¨ï¼Œè€ŒæœåŠ¡å™¨åˆç«‹å³å¯¹æ¯ä¸ªæ¶ˆæ¯åšå‡ºå“åº”ï¼Œå¾ˆå¿«å°±ä¼šå˜å¾—ä¸å ªé‡è´Ÿã€‚è¿™æ—¶ï¼Œ<code>socket.pause()</code>å¯ä»¥æ´¾ä¸Šç”¨åœºã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›æš‚æ—¶åœæ­¢æ¥æ”¶æ–°æ¶ˆæ¯ï¼Œç›´åˆ°ä½ å®Œæˆå¯¹å½“å‰æ¶ˆæ¯é˜Ÿåˆ—çš„å¤„ç†ã€‚</p><h3 id="å®é™…ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2"><span>å®é™…ä¾‹å­</span></a></h3><ol><li><p><strong>æµé‡æ§åˆ¶</strong>ï¼šä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æœåŠ¡ã€‚ç”¨æˆ·å¯ä»¥ä¸Šä¼ å¤§æ–‡ä»¶ã€‚å¦‚æœç”¨æˆ·çš„ä¸Šä¼ é€Ÿåº¦å¿«äºæœåŠ¡å™¨å¤„ç†è¿™äº›æ•°æ®çš„é€Ÿåº¦ï¼Œä½¿ç”¨<code>socket.pause()</code>å¯ä»¥é¿å…å†…å­˜æº¢å‡ºï¼Œé€šè¿‡æš‚åœæ¥æ”¶æ–‡ä»¶æ•°æ®ï¼Œç›´åˆ°å·²æ¥æ”¶çš„æ•°æ®è¢«å®Œå…¨å¤„ç†ã€‚</p></li><li><p><strong>èŠå¤©åº”ç”¨çš„æ¶ˆæ¯èŠ‚æµ</strong>ï¼šåœ¨é«˜å³°æ—¶é—´ï¼Œä½ çš„èŠå¤©åº”ç”¨å¯èƒ½ä¼šé‡åˆ°å¤§é‡çš„æ¶ˆæ¯ä¼ å…¥ã€‚ä¸ºäº†ä¿è¯æœåŠ¡å™¨çš„ç¨³å®šæ€§å’Œå“åº”é€Ÿåº¦ï¼Œä½ å¯ä»¥é€‚æ—¶è°ƒç”¨<code>socket.pause()</code>æ¥æš‚åœæ¥æ”¶æ–°æ¶ˆæ¯ï¼Œå¾…æœåŠ¡å™¨å‡è½»è´Ÿæ‹…åå†æ¢å¤ã€‚</p></li><li><p><strong>å®æ—¶æ•°æ®å¤„ç†</strong>ï¼šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªè‚¡ç¥¨å¸‚åœºå®æ—¶æ•°æ®åˆ†æå·¥å…·ã€‚è¯¥å·¥å…·éœ€è¦ä»å¤šä¸ªæºæ¥æ”¶æ•°æ®ã€‚ä¸ºäº†ç¡®ä¿æ¯ä¸ªæ•°æ®æºéƒ½èƒ½å¹³ç­‰åœ°å¤„ç†ï¼Œä½ å¯èƒ½ä¼šåœ¨å¤„ç†ä¸€ä¸ªæ•°æ®æºçš„é«˜é€Ÿæ•°æ®æµæ—¶ï¼Œæš‚åœå…¶ä»–æ•°æ®æºçš„æ•°æ®æµï¼Œè¿™ä¹Ÿæ˜¯<code>socket.pause()</code>èƒ½å‘æŒ¥ä½œç”¨çš„åœºæ™¯ã€‚</p></li></ol><h3 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h3><p><code>socket.pause()</code>æ˜¯ Node.js ä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦æ§åˆ¶æ•°æ®æµçš„é€Ÿåº¦æˆ–æ•°é‡æ—¶ã€‚é€šè¿‡æš‚åœå’Œæ¢å¤æ•°æ®æµï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°ç®¡ç†èµ„æºï¼Œä¼˜åŒ–åº”ç”¨çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><h3 id="socket-pending" tabindex="-1"><a class="header-anchor" href="#socket-pending"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketpending" target="_blank" rel="noopener noreferrer">socket.pending</a></span></a></h3><p><code>socket.pending</code> æ˜¯åœ¨ Node.js çš„ <code>net</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå¥—æ¥å­—ï¼ˆsocketï¼‰æ˜¯å¦æœ‰æœªå†™å…¥æˆ–è€…å°šæœªè¢«æ“ä½œç³»ç»Ÿæ¥å—çš„æ•°æ®ã€‚å½“ä½ ä½¿ç”¨ Node.js åˆ›å»ºç½‘ç»œåº”ç”¨æ—¶ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ° TCP æˆ– IPC å¥—æ¥å­—æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>socket.pending</code> å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆ<code>true</code> æˆ– <code>false</code>ï¼‰ï¼Œå®ƒæŒ‡ç¤ºäº†åœ¨ socket ä¸Šæ˜¯å¦æœ‰å¾…å¤„ç†çš„æ•°æ®ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªå±æ€§é‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¿™ä¸ªå±æ€§é‡è¦"><span>ä¸ºä»€ä¹ˆè¿™ä¸ªå±æ€§é‡è¦ï¼Ÿ</span></a></h3><p>åœ¨è¿›è¡Œç½‘ç»œç¼–ç¨‹æ—¶ï¼Œä½ å¯èƒ½éœ€è¦çŸ¥é“ä¸€ä¸ª socket æ˜¯å¦å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå¯ä»¥ç«‹å³å†™å…¥æˆ–è¯»å–æ•°æ®ã€‚å¦‚æœ <code>socket.pending</code> è¿”å› <code>true</code>ï¼Œè¿™æ„å‘³ç€ socket ç›®å‰è¿˜ä¸èƒ½ç”¨æ¥è¿›è¡Œè¿›ä¸€æ­¥çš„æ•°æ®ä¼ è¾“ï¼Œå› ä¸ºå®ƒè¿˜åœ¨å¤„ç†ä¸€äº›æŒ‚èµ·çš„æ“ä½œã€‚è®¸å¤šæƒ…å†µä¸‹ï¼Œä½ å¸Œæœ›ç­‰åˆ°è¿™ä¸ªæ“ä½œå®Œæˆåå†è¿›ä¸€æ­¥æ“ä½œ socketã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-12"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥å¹¶å‘ä»–ä»¬å‘é€æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œåœ¨å‘é€ä¹‹å‰ï¼Œä½ å¸Œæœ›ç¡®ä¿æ‰€æœ‰å‰é¢çš„æ“ä½œéƒ½å·²ç»å®Œæˆï¼Œæ²¡æœ‰ä»»ä½•æŒ‚èµ·çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // &#39;connection&#39; ç›‘å¬å™¨ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥æ˜¯å¦æœ‰æŒ‚èµ·çš„æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">pending</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæ²¡æœ‰æŒ‚èµ·çš„æ•°æ®ï¼Œå‘é€æ¬¢è¿æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ°æˆ‘çš„æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæœ‰æŒ‚èµ·çš„æ•°æ®ï¼Œç¨åå†å°è¯•å‘é€</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æš‚æ—¶ä¸èƒ½å‘é€æ•°æ®ï¼Œæœ‰æ•°æ®å¾…å¤„ç†ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ 8124 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8124</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ï¼š8124</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æ–°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ <code>socket.pending</code> çš„å€¼ã€‚å¦‚æœæ²¡æœ‰æŒ‚èµ·çš„æ•°æ®ï¼Œæˆ‘ä»¬å‘å®¢æˆ·ç«¯å†™å…¥ä¸€ä¸ªæ¬¢è¿æ¶ˆæ¯ã€‚å¦‚æœæœ‰æŒ‚èµ·çš„æ•°æ®ï¼Œæˆ‘ä»¬æ‰“å°ä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ï¼Œè¡¨æ˜ç°åœ¨ä¸æ˜¯å‘é€æ•°æ®çš„æ­£ç¡®æ—¶æœºã€‚</p><p>è¿™åªæ˜¯ <code>socket.pending</code> å±æ€§çš„ä¸€ç§ç”¨æ³•ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µæ¥å†³å®šå¦‚ä½•åˆ©ç”¨è¿™ä¸ªå±æ€§æ¥ä¼˜åŒ–ä½ çš„ç½‘ç»œé€šä¿¡é€»è¾‘ã€‚</p><h3 id="socket-ref" tabindex="-1"><a class="header-anchor" href="#socket-ref"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketref" target="_blank" rel="noopener noreferrer">socket.ref()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.ref()</code>æ˜¯ä¸€ä¸ªä¸ç½‘ç»œç›¸å…³çš„å‡½æ•°ï¼Œä¸»è¦ç”¨äºå¤„ç† TCP è¿æ¥æˆ–å…¶ä»–ç±»å‹çš„ç½‘ç»œæµã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¼„æ¸…æ¥šå‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£<code>socket.ref()</code>çš„ä½œç”¨ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µï¼š</span></a></h3><ol><li><p><strong>Socketï¼ˆå¥—æ¥å­—ï¼‰</strong>ï¼šåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå¥—æ¥å­—æ˜¯ä¸€ä¸ªç«¯ç‚¹ï¼Œç”¨äºåœ¨ç½‘ç»œä¸Šå‘é€å’Œæ¥æ”¶æ•°æ®ã€‚åœ¨ Node.js ä¸­ï¼Œä¸€ä¸ª Socket å®ä¾‹é€šå¸¸ä»£è¡¨ä¸€ä¸ªå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç«¯çš„ç½‘ç»œè¿æ¥ã€‚</p></li><li><p><strong>Event Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰</strong>ï¼šNode.js ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„éé˜»å¡ I/O æ¨¡å‹ã€‚è¿™æ„å‘³ç€ Node.js çš„æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶åœ¨å®Œæˆæ—¶é€šè¿‡äº‹ä»¶æ¥é€šçŸ¥ã€‚äº‹ä»¶å¾ªç¯æ˜¯è´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶çš„æœºåˆ¶ã€‚</p></li></ol><h3 id="socket-ref-å‡½æ•°çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#socket-ref-å‡½æ•°çš„ä½œç”¨"><span><code>socket.ref()</code> å‡½æ•°çš„ä½œç”¨ï¼š</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ä¸€ä¸ª Socket è¿æ¥å»ºç«‹æ—¶ï¼Œå®ƒé»˜è®¤æ˜¯â€œæ´»è·ƒâ€çš„ï¼Œæ„å‘³ç€å®ƒä¼šä¿æŒäº‹ä»¶å¾ªç¯è¿è¡Œï¼Œå³ä½¿æ²¡æœ‰å…¶ä»– JavaScript æ­£åœ¨æ‰§è¡Œã€‚è¿™ç¡®ä¿äº†ç¨‹åºä¸ä¼šé€€å‡ºï¼Œå› ä¸ºå®ƒè¿˜æœ‰æœªå¤„ç†çš„è¿æ¥ã€‚</p><p>ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›ä¸€ä¸ª Socket ä¿æŒäº‹ä»¶å¾ªç¯æ´»è·ƒã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒåº”è¯¥åœ¨æ²¡æœ‰ç”¨æˆ·è¿æ¥æ—¶è‡ªåŠ¨å…³é—­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>socket.unref()</code>ä½¿å¾—æ­¤ Socket ä¸å†ä¿æŒäº‹ä»¶å¾ªç¯ã€‚</p><p>ç›¸åï¼Œå¦‚æœä¸€ä¸ª Socket ä¹‹å‰è¢«æ ‡è®°ä¸º<code>unref()</code>ï¼ˆå³å®ƒä¸ä¼šé˜»æ­¢äº‹ä»¶å¾ªç¯é€€å‡ºï¼‰ï¼Œç„¶åä½ å†³å®šè¿™ä¸ª Socket åº”è¯¥å†æ¬¡é˜»æ­¢äº‹ä»¶å¾ªç¯é€€å‡ºï¼Œä½ å¯ä»¥ä½¿ç”¨<code>socket.ref()</code>ã€‚è°ƒç”¨<code>socket.ref()</code>å°†é‡æ–°å¼•ç”¨ Socketï¼Œä½¿äº‹ä»¶å¾ªç¯ç»§ç»­è¿è¡Œï¼Œå³ä½¿æ²¡æœ‰å…¶ä»– JavaScript ä»£ç åœ¨æ‰§è¡Œã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h3><ol><li><p><strong>æœåŠ¡å™¨å®šæ—¶å™¨</strong>ï¼šå‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œå®ƒåœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½•è¿æ¥æ—¶åº”è¯¥å…³é—­ã€‚ä½ å¯ä»¥é€šè¿‡<code>unref</code>ä¸€ä¸ªå®šæ—¶å™¨æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™æ ·å¦‚æœæ²¡æœ‰æ´»è·ƒçš„ Socket è¿æ¥ï¼ŒæœåŠ¡å™¨ä¼šåœ¨æŒ‡å®šæ—¶é—´åå…³é—­ã€‚å¦‚æœæ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥ï¼Œä½ å¯ä»¥è°ƒç”¨<code>ref</code>æ¥ç¡®ä¿æœåŠ¡å™¨ä¸ä¼šå› ä¸ºå®šæ—¶å™¨è€Œå…³é—­ã€‚</p></li><li><p><strong>é•¿è¿æ¥æœåŠ¡</strong>ï¼šå‡å¦‚ä½ çš„ Node.js åº”ç”¨æ˜¯ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ï¼Œä½ å¯èƒ½å¸Œæœ›å½“ç”¨æˆ·è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨åº”ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚ä½†åœ¨å¤œæ·±äººé™çš„æ—¶å€™ï¼Œä½ å¯èƒ½å¸Œæœ›å¦‚æœæ²¡æœ‰æ´»åŠ¨ç”¨æˆ·ï¼Œåˆ™å…è®¸ç¨‹åºé€€å‡ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æœ€åä¸€ä¸ªç”¨æˆ·æ–­å¼€è¿æ¥æ—¶ï¼Œä½ å¯ä»¥è°ƒç”¨<code>socket.unref()</code>ã€‚å¦‚æœæœ‰æ–°çš„ç”¨æˆ·è¿æ¥ï¼Œä½¿ç”¨<code>socket.ref()</code>ç¡®ä¿æœåŠ¡å™¨ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚</p></li></ol><p>è®°ä½ï¼Œ<code>socket.ref()</code>å’Œ<code>socket.unref()</code>ä¸»è¦ç”¨äºæ§åˆ¶ Node.js çš„äº‹ä»¶å¾ªç¯æ˜¯å¦å› ä¸ºè¿™ä¸ªç‰¹å®šçš„ Socket è¿æ¥è€Œä¿æŒæ´»åŠ¨ã€‚æ­£ç¡®ä½¿ç”¨è¿™äº›å‡½æ•°å¯ä»¥è®©ä½ å¯¹ Node.js åº”ç”¨çš„è¡Œä¸ºæœ‰æ›´ç²¾ç¡®çš„æ§åˆ¶ã€‚</p><h3 id="socket-remoteaddress" tabindex="-1"><a class="header-anchor" href="#socket-remoteaddress"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketremoteaddress" target="_blank" rel="noopener noreferrer">socket.remoteAddress</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.remoteAddress</code>æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å±æ€§ï¼Œå®ƒå±äº<code>net</code>æ¨¡å—ä¸‹çš„<code>Socket</code>ç±»ã€‚è¿™ä¸ªå±æ€§å¯ä»¥è®©ä½ çŸ¥é“ä¸ä½ çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„ç”µè„‘æˆ–è€…æ‰‹æœºä¸Šçš„ä¸€ä¸ªç¨‹åºï¼‰é€šè¿‡ç½‘ç»œè¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨æ—¶ï¼Œ<code>socket.remoteAddress</code>å°±èƒ½å‘Šè¯‰ä½ é‚£ä¸ªå®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-ip-åœ°å€" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-ip-åœ°å€"><span>ä»€ä¹ˆæ˜¯ IP åœ°å€ï¼Ÿ</span></a></h3><p>IP åœ°å€æ˜¯åˆ†é…ç»™ç½‘ç»œä¸­æ¯ä¸ªè®¾å¤‡çš„å”¯ä¸€åœ°å€ï¼Œå®ƒå¸®åŠ©è®¾å¤‡ç›¸äº’è¯†åˆ«å’Œé€šä¿¡ã€‚å°±åƒä½ å®¶çš„åœ°å€ä¸€æ ·ï¼Œè®©äººä»¬çŸ¥é“å¦‚ä½•æ‰¾åˆ°ä½ ã€‚</p><h3 id="socket-remoteaddressçš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#socket-remoteaddressçš„ä½œç”¨"><span><code>socket.remoteAddress</code>çš„ä½œç”¨</span></a></h3><p>åœ¨ Node.js çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œç†è§£å®¢æˆ·ç«¯çš„æ¥æºæ˜¯éå¸¸é‡è¦çš„ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦ï¼š</p><ul><li><strong>è¿‡æ»¤æµé‡</strong>ï¼šåŸºäº IP åœ°å€ï¼Œä½ å¯ä»¥å†³å®šå“ªäº›å®¢æˆ·ç«¯å¯ä»¥è®¿é—®ä½ çš„æœåŠ¡ï¼Œå“ªäº›ä¸å¯ä»¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å‘ç°æŸä¸ª IP åœ°å€çš„æµé‡å¼‚å¸¸ï¼Œå¯èƒ½æ˜¯æ¶æ„æ”»å‡»ï¼Œä½ å¯ä»¥é€‰æ‹©å±è”½è¿™ä¸ª IPã€‚</li><li><strong>åœ°ç†å®šä½</strong>ï¼šé€šè¿‡ IP åœ°å€ï¼Œä½ å¯ä»¥ä¼°è®¡å®¢æˆ·ç«¯çš„åœ°ç†ä½ç½®ï¼Œä¸ºç”¨æˆ·æä¾›æœ¬åœ°åŒ–çš„å†…å®¹æˆ–æœåŠ¡ã€‚æ¯”å¦‚ï¼Œæ ¹æ®ç”¨æˆ·çš„å›½å®¶æˆ–åŸå¸‚å±•ç¤ºç›¸åº”è¯­è¨€çš„é¡µé¢æˆ–ç‰¹å®šçš„ä¿¡æ¯ã€‚</li><li><strong>æ—¥å¿—è®°å½•</strong>ï¼šè®°å½•ç”¨æˆ·çš„ IP åœ°å€ï¼Œå¯¹äºåˆ†æç”¨æˆ·è¡Œä¸ºã€ç›‘æ§ç³»ç»Ÿå®‰å…¨ç­‰æ–¹é¢éå¸¸æœ‰å¸®åŠ©ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œä½ æƒ³è¦è®°å½•æ‰€æœ‰è¿æ¥åˆ°ä½ æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ IP åœ°å€ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œæ‰“å°å…¶IPåœ°å€</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥æ¥è‡ª: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®æ—¶ï¼Œå›åº”ä¸€æ¡æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬åœ¨æœ¬åœ°çš„8124ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8124</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨äº 8124 ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œå½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šæ‰“å°å‡ºå®¢æˆ·ç«¯çš„ IP åœ°å€ï¼Œå¹¶åœ¨æ”¶åˆ°æ•°æ®æ—¶å›åº”ã€‚è¿™åªæ˜¯<code>socket.remoteAddress</code>çš„ä¸€ä¸ªåŸºç¡€ç”¨æ³•ï¼Œå®é™…ä¸Šå®ƒçš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ã€‚</p><h3 id="socket-remotefamily" tabindex="-1"><a class="header-anchor" href="#socket-remotefamily"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketremotefamily" target="_blank" rel="noopener noreferrer">socket.remoteFamily</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.remoteFamily</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥è¡¨ç¤ºä¸è¯¥ socket è¿æ¥çš„è¿œç¨‹å®¢æˆ·ç«¯çš„ IP åœ°å€æ—ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå±æ€§çš„å€¼ä¼šæ˜¯<code>&#39;IPv4&#39;</code>æˆ–è€…<code>&#39;IPv6&#39;</code>ï¼Œå–å†³äºè¿œç¨‹å®¢æˆ·ç«¯ä½¿ç”¨çš„ IP ç‰ˆæœ¬ã€‚è¿™ä¸ªå±æ€§åœ¨ä½ éœ€è¦æ ¹æ®å®¢æˆ·ç«¯çš„ IP ç‰ˆæœ¬æ¥åšç‰¹å®šå¤„ç†æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥è¿›ä¸€æ­¥ç†è§£<code>socket.remoteFamily</code>çš„ä½œç”¨ã€‚</p><h3 id="ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ª-tcp-æœåŠ¡å™¨-æ‰“å°è¿æ¥çš„å®¢æˆ·ç«¯-ip-ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ª-tcp-æœåŠ¡å™¨-æ‰“å°è¿æ¥çš„å®¢æˆ·ç«¯-ip-ç‰ˆæœ¬"><span>ç¤ºä¾‹ 1: åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œæ‰“å°è¿æ¥çš„å®¢æˆ·ç«¯ IP ç‰ˆæœ¬</span></a></h3><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ã€‚æ¯å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬ä¼šæ‰“å°å‡ºè¯¥å®¢æˆ·ç«¯ä½¿ç”¨çš„ IP åœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥ä½¿ç”¨çš„IPåœ°å€æ—: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteFamily</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼Œå®¢æˆ·ç«¯ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨åœ¨3000ç«¯å£ç›‘å¬ä¸­...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œ<code>socket.remoteFamily</code>å°±ä¼šè¢«ç”¨æ¥è·å–å¹¶æ‰“å°å‡ºè¯¥å®¢æˆ·ç«¯çš„ IP åœ°å€æ—ã€‚</p><h3 id="ç¤ºä¾‹-2-æ ¹æ®å®¢æˆ·ç«¯-ip-ç‰ˆæœ¬é‡‡å–ä¸åŒçš„å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ ¹æ®å®¢æˆ·ç«¯-ip-ç‰ˆæœ¬é‡‡å–ä¸åŒçš„å“åº”"><span>ç¤ºä¾‹ 2: æ ¹æ®å®¢æˆ·ç«¯ IP ç‰ˆæœ¬é‡‡å–ä¸åŒçš„å“åº”</span></a></h3><p>åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å®¢æˆ·ç«¯çš„ IP ç‰ˆæœ¬æ¥é‡‡å–ä¸åŒçš„å¤„ç†ç­–ç•¥ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³å¯¹ IPv4 å’Œ IPv6 å®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒçš„æ¬¢è¿æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> welcomeMsg</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">æ¬¢è¿æ¥åˆ°æœåŠ¡å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteFamily</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">IPv4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    welcomeMsg</span><span style="color:#81A1C1;"> +=</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;"> - ä½ æ­£åœ¨ä½¿ç”¨IPv4åœ°å€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteFamily</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">IPv6</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    welcomeMsg</span><span style="color:#81A1C1;"> +=</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;"> - ä½ æ­£åœ¨ä½¿ç”¨IPv6åœ°å€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">welcomeMsg</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨åœ¨3000ç«¯å£ç›‘å¬ä¸­...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡æ£€æŸ¥<code>socket.remoteFamily</code>çš„å€¼ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿæ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€æ—å‘é€å®šåˆ¶åŒ–çš„æ¬¢è¿æ¶ˆæ¯ã€‚</p><p>è¿™äº›ä¾‹å­å±•ç¤ºäº†<code>socket.remoteFamily</code>å±æ€§åœ¨å®é™…åº”ç”¨ä¸­å¦‚ä½•å¸®åŠ©æˆ‘ä»¬æ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€æ—åšå‡ºç›¸åº”çš„å¤„ç†ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ›´çµæ´»åœ°è®¾è®¡ä½ çš„ç½‘ç»œåº”ç”¨ï¼Œä»¥é€‚åº”ä¸åŒçš„ç½‘ç»œç¯å¢ƒå’Œå®¢æˆ·ç«¯éœ€æ±‚ã€‚</p><h3 id="socket-remoteport" tabindex="-1"><a class="header-anchor" href="#socket-remoteport"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketremoteport" target="_blank" rel="noopener noreferrer">socket.remotePort</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.remotePort</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å–è¿œç¨‹å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£å·ã€‚è¿™ä¸ªå±æ€§éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç½‘ç»œé€šä¿¡æ—¶ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ äº†è§£å’ŒåŒºåˆ†è¿æ¥åˆ°ä½ æœåŠ¡å™¨çš„ä¸åŒå®¢æˆ·ç«¯ã€‚</p><h3 id="ç®€å•è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#ç®€å•è§£é‡Š-2"><span>ç®€å•è§£é‡Š</span></a></h3><p>å½“ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„æµè§ˆå™¨æˆ–è€…å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼‰è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨æ—¶ï¼Œå®ƒä¼šä»å®¢æˆ·ç«¯çš„æ“ä½œç³»ç»Ÿä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç«¯å£è¿›è¡Œè¿æ¥ã€‚<code>socket.remotePort</code>å°±æ˜¯ç”¨æ¥è·å–è¿™ä¸ªéšæœºé€‰å–çš„ç«¯å£å·çš„ã€‚çŸ¥é“äº†è¿™ä¸ªç«¯å£å·ï¼Œä½ å°±å¯ä»¥ç”¨å®ƒæ¥è·Ÿè¸ªæˆ–ç®¡ç†è¿™ä¸ªç‰¹å®šçš„è¿æ¥ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-æ—¥å¿—è®°å½•å’Œç›‘æ§" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ—¥å¿—è®°å½•å’Œç›‘æ§"><span>ç¤ºä¾‹ 1ï¼šæ—¥å¿—è®°å½•å’Œç›‘æ§</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œéœ€è¦è®°å½•æ¯ä¸ªè¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥ä¾¿äºåç»­çš„åˆ†ææˆ–è°ƒè¯•ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>socket.remotePort</code>æ¥è·å–è¿æ¥çš„å®¢æˆ·ç«¯ç«¯å£å·ï¼Œå¹¶å°†å…¶è®°å½•ä¸‹æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥æ¥è‡ªï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å…¶ä»–å¤„ç†...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨8080ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-åŸºäºç«¯å£çš„è¿æ¥è¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-åŸºäºç«¯å£çš„è¿æ¥è¿‡æ»¤"><span>ç¤ºä¾‹ 2ï¼šåŸºäºç«¯å£çš„è¿æ¥è¿‡æ»¤</span></a></h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦æ ¹æ®ç«¯å£å·æ¥æ¥å—æˆ–æ‹’ç»è¿æ¥ã€‚è™½ç„¶è¿™ä¸æ˜¯æœ€å¸¸è§çš„ç”¨ä¾‹ï¼Œä½†å®ƒå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>socket.remotePort</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remotePort</span><span style="color:#81A1C1;"> ===</span><span style="color:#B48EAD;"> 12345</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¥å—ç‰¹å®šç«¯å£çš„è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†è¿™ä¸ªè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ‹’ç»æˆ–å¿½ç•¥å…¶ä»–ç«¯å£çš„è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">//æ–‡æ›¸ã¯æ¡œèŒ¶ã‹ã‚‰æ¥ã¦ã„ã¾ã™ã€‚å•†ç”¨ç›®çš„ã§ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨8080ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>socket.remotePort</code>å¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­å‘æŒ¥ä½œç”¨ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œæ§åˆ¶é€šè¿‡ç½‘ç»œè¿æ¥åˆ°ä½ æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ã€‚</p><h3 id="socket-resetanddestroy" tabindex="-1"><a class="header-anchor" href="#socket-resetanddestroy"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketresetanddestroy" target="_blank" rel="noopener noreferrer">socket.resetAndDestroy()</a></span></a></h3><p><code>socket.resetAndDestroy()</code> æ–¹æ³•åœ¨ Node.js v21.7.1 ä¸­æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°ä¸”å…·ä½“çš„åŠŸèƒ½ï¼Œç”¨äºå¤„ç†ç½‘ç»œå¥—æ¥å­—ã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å…è®¸ä½ ç«‹å³å…³é—­ä¸€ä¸ªå¥—æ¥å­—ï¼ˆSocketï¼‰ï¼Œå¹¶ç¡®ä¿ä»»ä½•æœªå‘é€å®Œæ¯•çš„æ•°æ®éƒ½ä¼šè¢«é‡ç½®ï¼Œè€Œä¸æ˜¯æ­£å¸¸åœ°å‘é€å‡ºå»ã€‚è¿™é€šå¸¸ç”¨äºé‚£äº›éœ€è¦å¿«é€Ÿæ–­å¼€è¿æ¥ä¸”ä¸å…³å¿ƒæœªå®Œå…¨å‘é€æ•°æ®çš„åœºæ™¯ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>å¿«é€Ÿæ–­å¼€ä¸ç¨³å®šè¿æ¥</strong>ï¼šå‡è®¾ä½ å¼€å‘äº†ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªå®¢æˆ·ç«¯å¼€å§‹è¡¨ç°å‡ºä¸ç¨³å®šçš„ç½‘ç»œè¡Œä¸ºï¼Œå¦‚é¢‘ç¹åœ°è¿æ¥å’Œæ–­å¼€ã€‚ä½¿ç”¨ <code>socket.resetAndDestroy()</code> å¯ä»¥ç«‹å³æ¸…ç†è¿™ç§ä¸ç¨³å®šçš„è¿æ¥ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ‰€æœ‰æ¶ˆæ¯å°è¯•å‘é€å®Œæˆï¼Œè¿™æ ·å¯ä»¥ä¿æŒæœåŠ¡å™¨èµ„æºçš„æœ‰æ•ˆåˆ©ç”¨å’Œåº”ç”¨çš„æµç•…è¿è¡Œã€‚</p></li><li><p><strong>é¿å…éƒ¨åˆ†å‘é€æ•°æ®å¯¼è‡´çš„é—®é¢˜</strong>ï¼šåœ¨ä¸€äº›å¯¹æ•°æ®å®Œæ•´æ€§æœ‰ä¸¥æ ¼è¦æ±‚çš„åº”ç”¨ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®åŒ…åªå‘é€äº†ä¸€éƒ¨åˆ†å°±å› ä¸ºç½‘ç»œé—®é¢˜æ–­å¼€äº†ï¼Œé‚£ä¹ˆæ¥æ”¶ç«¯å¯èƒ½ä¼šé‡åˆ°å¤„ç†ä¸å®Œæ•´æ•°æ®çš„é—®é¢˜ã€‚é€šè¿‡ä½¿ç”¨ <code>socket.resetAndDestroy()</code>ï¼Œå¼€å‘è€…å¯ä»¥åœ¨æ£€æµ‹åˆ°è¿™ç§æƒ…å†µæ—¶å¿«é€Ÿæ–­å¼€è¿æ¥ï¼Œç¡®ä¿ä¸ä¼šå‘é€ä¸å®Œæ•´çš„æ•°æ®åŒ…ï¼Œä»è€Œé¿å…å¯èƒ½çš„æ•°æ®å¤„ç†é”™è¯¯ã€‚</p></li><li><p><strong>èµ„æºé™åˆ¶ç¯å¢ƒä¸‹çš„è¿æ¥ç®¡ç†</strong>ï¼šåœ¨èµ„æºæœ‰é™çš„ç¯å¢ƒä¸­ï¼ˆå¦‚ IoT è®¾å¤‡ï¼‰ï¼Œé•¿æ—¶é—´çš„è¿æ¥æˆ–åŠå¼€è¿æ¥å¯èƒ½æ¶ˆè€—å®è´µçš„ç³»ç»Ÿèµ„æºã€‚é€šè¿‡ä½¿ç”¨ <code>socket.resetAndDestroy()</code>ï¼Œå¼€å‘è€…å¯ä»¥æ›´ç§¯æåœ°ç®¡ç†è¿™äº›èµ„æºï¼Œé€šè¿‡å¿«é€Ÿé‡ç½®å’Œé”€æ¯ä¸å†éœ€è¦çš„è¿æ¥æ¥é‡Šæ”¾èµ„æºã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œ<code>socket.resetAndDestroy()</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå…è®¸å¼€å‘è€…æ›´æœ‰æ§åˆ¶åœ°ç®¡ç†ç½‘ç»œè¿æ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¿«é€Ÿé‡Šæ”¾èµ„æºæˆ–é¿å…å‘é€éƒ¨åˆ†æ•°æ®åŒ…çš„åœºæ™¯ä¸­ã€‚ç„¶è€Œï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¹Ÿéœ€è¦è°¨æ…ï¼Œå› ä¸ºå®ƒæ”¾å¼ƒäº†æ‰€æœ‰æœªå‘é€çš„æ•°æ®ï¼Œå¯èƒ½ä¸é€‚ç”¨äºæ‰€æœ‰åº”ç”¨åœºæ™¯ã€‚</p><h3 id="socket-resume" tabindex="-1"><a class="header-anchor" href="#socket-resume"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketresume" target="_blank" rel="noopener noreferrer">socket.resume()</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>socket.resume()</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºç½‘ç»œç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦æ–¹é¢ã€‚é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼šåœ¨ Node.js ä¸­ï¼Œ&quot;sockets&quot;å¸¸ç”¨äºç½‘ç»œé€šä¿¡ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª socket å°±åƒæ˜¯ä¸¤å°è®¡ç®—æœºï¼ˆæˆ–è€…æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼‰ä¹‹é—´çš„é€šä¿¡ç®¡é“ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªç®¡é“äº’ç›¸å‘é€æ•°æ®ã€‚</p><p>ç°åœ¨ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨ä¸‹è½½ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¸¸æˆæˆ–è€…ç”µå½±ã€‚çªç„¶ï¼Œä½ æ„è¯†åˆ°éœ€è¦æš‚åœä¸‹è½½ï¼Œå› ä¸ºä½ éœ€è¦ä½¿ç”¨ç½‘ç»œå»åšå…¶ä»–æ›´ç´§æ€¥çš„äº‹æƒ…ï¼Œæ¯”å¦‚å‚åŠ ä¸€ä¸ªåœ¨çº¿ä¼šè®®ã€‚åœ¨ Node.js ä¸­ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ sockets è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä½ å¯ä»¥è°ƒç”¨<code>socket.pause()</code>æ–¹æ³•æ¥â€œæš‚åœâ€æ•°æ®æµï¼Œç¡®ä¿åœ¨ä½ å‡†å¤‡å¥½ä¹‹å‰ä¸å†æ¥æ”¶æ›´å¤šæ•°æ®ã€‚</p><p>é‚£ä¹ˆï¼Œ<code>socket.resume()</code>æ–¹æ³•åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œ<code>socket.resume()</code>æ˜¯<code>socket.pause()</code>çš„åå‘æ“ä½œã€‚å½“ä½ å‡†å¤‡å¥½ç»§ç»­æ¥æ”¶æ•°æ®æ—¶ï¼Œä½ å¯ä»¥è°ƒç”¨<code>socket.resume()</code>æ¥é‡æ–°å¼€å¯æ•°æ®æµï¼Œç»§ç»­ä¹‹å‰çš„ä¸‹è½½æˆ–æ•°æ®æ¥æ”¶è¿‡ç¨‹ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-13"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ–‡ä»¶ä¼ è¾“åº”ç”¨</strong>ï¼š</p><ul><li>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå…è®¸ç”¨æˆ·ä¸Šä¼ å’Œä¸‹è½½å¤§æ–‡ä»¶çš„åº”ç”¨ã€‚ç”¨æˆ·å¯èƒ½éœ€è¦åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­æš‚åœï¼Œä»¥ä¾¿èŠ‚çœå¸¦å®½ç”¨äºå…¶ä»–ä»»åŠ¡ï¼Œå¦‚è§†é¢‘ä¼šè®®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨ç”¨æˆ·è¯·æ±‚æš‚åœæ—¶ä½¿ç”¨<code>socket.pause()</code>ï¼Œå¹¶åœ¨ä»–ä»¬å‡†å¤‡å¥½ç»§ç»­æ—¶è°ƒç”¨<code>socket.resume()</code>ã€‚</li></ul></li><li><p><strong>å®æ—¶èŠå¤©åº”ç”¨</strong>ï¼š</p><ul><li>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨ä¸€ä¸ªå®æ—¶èŠå¤©åº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šæš‚æ—¶åœæ­¢å‘ç‰¹å®šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼Œå½“ç”¨æˆ·æ ‡è®°çŠ¶æ€ä¸ºâ€œå¿™ç¢Œâ€æˆ–å…³é—­äº†èŠå¤©çª—å£æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯ä»¥å¯¹è¯¥ç”¨æˆ·çš„è¿æ¥è°ƒç”¨<code>socket.pause()</code>ï¼Œå¹¶åœ¨ç”¨æˆ·å‡†å¤‡å¥½æ¥æ”¶æ–°æ¶ˆæ¯ï¼ˆå³æ”¹å˜çŠ¶æ€æˆ–é‡æ–°æ‰“å¼€èŠå¤©çª—å£æ—¶ï¼‰è°ƒç”¨<code>socket.resume()</code>ã€‚</li></ul></li><li><p><strong>åœ¨çº¿æ¸¸æˆ</strong>ï¼š</p><ul><li>åœ¨ä¸€ä¸ªå¤šç©å®¶åœ¨çº¿æ¸¸æˆä¸­ï¼Œå¦‚æœä¸€ä¸ªç©å®¶çš„ç½‘ç»œè¿æ¥å˜å¾—ä¸ç¨³å®šï¼Œæ¸¸æˆæœåŠ¡å™¨å¯èƒ½ä¼šæš‚æ—¶åœæ­¢å‘è¿™ä¸ªç©å®¶å‘é€æ›´æ–°ï¼Œä»¥é¿å…ç»™ä»–ä»¬é€ æˆæ›´å¤šçš„ç½‘ç»œå»¶è¿Ÿã€‚ç„¶åï¼Œä¸€æ—¦ç©å®¶çš„ç½‘ç»œçŠ¶å†µæ”¹å–„ï¼ŒæœåŠ¡å™¨å¯ä»¥æ¢å¤å‘é€æ›´æ–°ï¼Œä½¿ç”¨<code>socket.resume()</code>æ¥é‡æ–°åŒæ­¥ç©å®¶çš„æ¸¸æˆçŠ¶æ€ã€‚</li></ul></li></ol><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>socket.resume()</code>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­çš„ä½œç”¨è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ§åˆ¶æ•°æ®æµåŠ¨çš„å¤æ‚åº”ç”¨ç¨‹åºä¸­ã€‚</p><h3 id="socket-setencoding-encoding" tabindex="-1"><a class="header-anchor" href="#socket-setencoding-encoding"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketsetencodingencoding" target="_blank" rel="noopener noreferrer">socket.setEncoding([encoding])</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­ <code>socket.setEncoding([encoding])</code> è¿™ä¸€åŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œç†è§£è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦çŸ¥é“å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>: ä¸€ä¸ªå¯ä»¥è®©ä½ ä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚å…¶è®¾è®¡ç†å¿µæ˜¯æä¾›ä¸€ç§ç®€å•çš„æ–¹å¼æ¥æ„å»ºå¯æ‰©å±•çš„ç½‘ç»œç¨‹åºã€‚</li><li><strong>Socket</strong>: åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒSocket æ˜¯ä¸€ä¸ªç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚åœ¨ Node.js ä¸­ï¼Œå½“ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ï¼Œä¼šç”¨åˆ° Socket ç¼–ç¨‹ã€‚</li><li><strong>Encoding</strong>: ç¼–ç æ˜¯æŒ‡å°†äººç±»å¯è¯»çš„å­—ç¬¦ï¼ˆå¦‚ ASCII å­—ç¬¦ï¼‰è½¬æ¢æˆæœºå™¨å¯ä»¥è¯†åˆ«å’Œå¤„ç†çš„æ ¼å¼ï¼Œåœ¨è®¡ç®—æœºä¸­é€šå¸¸æ˜¯å­—èŠ‚ã€‚</li></ol><p>ç°åœ¨ï¼Œ<code>socket.setEncoding([encoding])</code> æ–¹æ³•æ˜¯å±äº Node.js çš„ <code>net</code> æ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†å¼‚æ­¥ç½‘ç»œåŒ…è£…å™¨ã€‚å…·ä½“åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸ºæ¥æ”¶åˆ°çš„æ•°æ®è®¾ç½®ç¼–ç ã€‚æ‰€è°“è®¾ç½®ç¼–ç ï¼Œå°±æ˜¯æŒ‡å®šå½“æ•°æ®é€šè¿‡ Socket æµä¼ è¾“æ—¶ï¼Œåº”è¯¥å¦‚ä½•å°†æ¥æ”¶åˆ°çš„å­—èŠ‚è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p><h3 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°</span></a></h3><ul><li><code>encoding</code> (å¯é€‰): è¿™ä¸ªå‚æ•°æŒ‡å®šäº†å­—ç¬¦ç¼–ç çš„ç±»å‹ã€‚å¸¸è§çš„ç±»å‹æœ‰ &#39;utf8&#39;, &#39;ascii&#39;, &#39;base64&#39; ç­‰ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç¼–ç ï¼Œåˆ™æ•°æ®å°†ä»¥ Buffer å¯¹è±¡çš„å½¢å¼ä¼ é€’ï¼ŒBuffer æ˜¯ Node.js ä¸­ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h3><p><strong>åœºæ™¯ä¸€ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„ Echo æœåŠ¡å™¨</strong></p><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œå½“å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ç»™å®ƒæ—¶ï¼Œå®ƒä¼šå°†ç›¸åŒçš„æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® socket ç¼–ç ä¸º &#39;utf8&#39;ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å¤„ç†æ•°æ®ï¼Œè€Œä¸æ˜¯ä½œä¸º Buffer å¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®æ¥æ”¶æ•°æ®çš„ç¼–ç </span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received data: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å›å‘æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server listening on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åœºæ™¯äºŒï¼šå¤„ç† Base64 ç¼–ç æ•°æ®</strong></p><p>å‡è®¾ä½ çš„æœåŠ¡å™¨éœ€è¦å¤„ç†ä»å®¢æˆ·ç«¯å‘é€æ¥çš„ç»è¿‡ Base64 ç¼–ç çš„æ•°æ®ã€‚è®¾ç½® socket ç¼–ç ä¸º &#39;base64&#39;ï¼Œé‚£ä¹ˆæ¥æ”¶åˆ°çš„æ•°æ®å°†è‡ªåŠ¨ä»¥ Base64 æ ¼å¼çš„å­—ç¬¦ä¸²å‘ˆç°ï¼Œä½ å¯ä»¥ç›´æ¥å¯¹è¿™äº›å­—ç¬¦ä¸²è¿›è¡Œè§£ç æˆ–å…¶ä»–æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾ socket å·²ç»æ ¹æ®ä¸Šé¢çš„æ–¹å¼åˆ›å»º</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ­¤æ—¶ï¼Œdata å°†æ˜¯ä¸€ä¸ª Base64 ç¼–ç çš„å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received base64 data: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿›è¡Œè§£ç æˆ–å…¶ä»–å¤„ç†...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»“è®º-4" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-4"><span>ç»“è®º</span></a></h3><p>ä½¿ç”¨ <code>socket.setEncoding([encoding])</code> æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ æ›´æ–¹ä¾¿åœ°æŒ‰ç…§é¢„æœŸçš„å­—ç¬¦ç¼–ç å¤„ç†æ¥æ”¶åˆ°çš„ç½‘ç»œæ•°æ®ã€‚è¿™å¯¹äºå¼€å‘éœ€è¦å¤„ç†å„ç§å­—ç¬¦æ•°æ®çš„ç½‘ç»œåº”ç”¨å°¤å…¶æœ‰å¸®åŠ©ã€‚</p><h3 id="socket-setkeepalive-enable-initialdelay" tabindex="-1"><a class="header-anchor" href="#socket-setkeepalive-enable-initialdelay"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketsetkeepaliveenable-initialdelay" target="_blank" rel="noopener noreferrer">socket.setKeepAlive([enable][, initialDelay])</a></span></a></h3><p>äº†è§£ <code>socket.setKeepAlive([enable][, initialDelay])</code> å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•ç†è§£ä¸€ä¸‹å®ƒæ‰€æ¶‰åŠçš„å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><p><strong>Socket é€šä¿¡</strong>ï¼šåœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼ŒSocket ç”¨äºæè¿° IP åœ°å€å’Œç«¯å£ï¼Œæ˜¯ä¸€ä¸ªç½‘ç»œé€šä¿¡è¿‡ç¨‹çš„ç«¯ç‚¹ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä½ ç”µè„‘ä¸Šçš„ä¸€ä¸ªæ’å­”ï¼Œé€šè¿‡è¿™ä¸ªâ€œæ’å­”â€ï¼Œæ•°æ®å¯ä»¥å‘é€åˆ°ç½‘ç»œä¸Šçš„å¦ä¸€å°è®¡ç®—æœºã€‚</p></li><li><p><strong>TCP åè®®</strong>ï¼šä½äºä¼ è¾“å±‚ï¼Œæä¾›çš„æ˜¯ä¸€ç§é¢å‘è¿æ¥ã€å¯é çš„å­—èŠ‚æµæœåŠ¡ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ä¸¤å°è®¡ç®—æœºé€šä¿¡æ—¶ï¼ŒTCP ä¿è¯æ•°æ®èƒ½æŒ‰é¡ºåºã€å®Œæ•´åœ°åˆ°è¾¾ã€‚</p></li><li><p><strong>KeepAlive æœºåˆ¶</strong>ï¼šè¿™æ˜¯ TCP åè®®çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºæ£€æµ‹åŒæ–¹çš„è¿æ¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚å¯ç”¨ KeepAlive åï¼Œå¦‚æœåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œè®¡ç®—æœºä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªæ¢æµ‹åŒ…ç»™å¯¹æ–¹ï¼Œä»¥ç¡®è®¤åŒæ–¹çš„è¿æ¥æ˜¯å¦ä»ç„¶å­˜åœ¨ã€‚</p></li></ol><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ <code>socket.setKeepAlive([enable][, initialDelay])</code> è¿™ä¸ªå‡½æ•°ï¼š</p><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šè¿™ä¸ªå‡½æ•°ç”¨äºè®¾ç½® TCP KeepAlive æœºåˆ¶ã€‚å½“ä½ åœ¨ä½¿ç”¨ Node.js è¿›è¡Œç½‘ç»œç¼–ç¨‹ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªå‡½æ•°æ¥ç¡®ä¿ä½ çš„è¿æ¥æ˜¯æ´»è·ƒçš„ï¼Œå³ä½¿åŒæ–¹æš‚æ—¶æ²¡æœ‰æ•°æ®äº¤æ¢ã€‚</p></li><li><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><code>enable</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºå¼€å¯æˆ–å…³é—­ KeepAliveã€‚å¦‚æœè®¾ä¸º trueï¼Œåˆ™å¼€å¯ KeepAliveï¼›å¦‚æœè®¾ä¸º false æˆ–ä¸æä¾›ï¼Œè¡¨ç¤ºå…³é—­ã€‚</li><li><code>initialDelay</code>ï¼šä¸€ä¸ªæ•°å­—ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œè¡¨ç¤ºåœ¨å¤šä¹…æ— æ•°æ®äº¤äº’åæ‰å¼€å§‹å‘é€ç¬¬ä¸€ä¸ª KeepAlive æ¢æµ‹åŒ…ã€‚åªæœ‰å½“<code>enable</code>ä¸º true æ—¶ï¼Œè¿™ä¸ªå‚æ•°æ‰æœ‰æ•ˆã€‚</li></ul></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-14"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨æœåŠ¡å™¨ï¼Œä½ çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„æ‰‹æœºæˆ–ç½‘é¡µï¼‰ä¹‹é—´é•¿æ—¶é—´ä¿æŒè¿æ¥ã€‚ä½†æ˜¯ï¼Œå¯èƒ½æœ‰å¾ˆé•¿æ—¶é—´ç”¨æˆ·éƒ½æ²¡æœ‰å‘é€æ¶ˆæ¯ï¼Œè¿™æ—¶å€™ä½ éœ€è¦ç¡®ä¿è¿æ¥è¿˜æ˜¯æ´»ç€çš„ï¼Œä»¥ä¾¿å½“æœ‰æ¶ˆæ¯æ—¶å¯ä»¥ç«‹å³ä¼ é€’ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¼€å¯KeepAliveï¼Œ5åˆ†é’Ÿåå¼€å§‹å‘é€é¦–ä¸ªKeepAliveæ¢æµ‹åŒ…</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setKeepAlive</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">true</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 5</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 60</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨åœ¨8080ç«¯å£ç›‘å¬</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿ç”¨æˆ·å¾ˆé•¿æ—¶é—´æ²¡æœ‰å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆè¿™é‡Œæ˜¯ 5 åˆ†é’Ÿï¼‰å‘é€ä¸€ä¸ª KeepAlive æ¢æµ‹åŒ…æ¥æ£€æŸ¥è¿æ¥æ˜¯å¦ä»ç„¶å­˜æ´»ã€‚è¿™æ ·åšæœ‰åŠ©äºåŠæ—¶å‘ç°æ­»é“¾æ¥å¹¶è¿›è¡Œæ¸…ç†ï¼Œé¿å…èµ„æºæµªè´¹ï¼ŒåŒæ—¶ç¡®ä¿å½“æœ‰çœŸæ­£çš„æ•°æ®è¦ä¼ è¾“æ—¶è¿æ¥æ˜¯å¯ç”¨çš„ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>socket.setKeepAlive()</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é•¿æ—¶é—´ä¿æŒç½‘ç»œè¿æ¥çš„åº”ç”¨ä¸­ã€‚é€šè¿‡åˆç†è®¾ç½® KeepAliveï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„åº”ç”¨æ›´åŠ ç¨³å®šå’Œå¯é ã€‚</p><h3 id="socket-setnodelay-nodelay" tabindex="-1"><a class="header-anchor" href="#socket-setnodelay-nodelay"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketsetnodelaynodelay" target="_blank" rel="noopener noreferrer">socket.setNoDelay([noDelay])</a></span></a></h3><p><code>socket.setNoDelay([noDelay])</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªç½‘ç»œï¼ˆnetï¼‰æ¨¡å—çš„æ–¹æ³•ï¼Œç”¨æ¥æ§åˆ¶ TCP ç½‘ç»œè¿æ¥ä¸­çš„ Nagle ç®—æ³•æ˜¯å¦å¯ç”¨ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ä¸€ä¸ª<code>net.Socket</code>å®ä¾‹ä¸Šè°ƒç”¨çš„ã€‚</p><p>é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹ Nagle ç®—æ³•ï¼š</p><p>Nagle ç®—æ³•æ˜¯ä¸ºäº†ä¼˜åŒ–ç½‘ç»œæµé‡è€Œè®¾è®¡çš„ï¼Œå®ƒé€šè¿‡å‡å°‘è¦å‘é€çš„å°åŒ…æ•°é‡æ¥æé«˜ç½‘ç»œæ•ˆç‡ã€‚ç®—æ³•ä¼šå°†å¤šä¸ªå°çš„æ•°æ®åŒ…åˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…å†å‘é€ï¼Œè¿™æ ·åšè™½ç„¶å¯ä»¥å‡å°‘ç½‘ç»œæ‹¥å µå’Œè´Ÿè½½ï¼Œä½†æ˜¯ä¹Ÿä¼šå¢åŠ æ•°æ®ä¼ è¾“çš„å»¶è¿Ÿï¼Œå› ä¸ºç®—æ³•ä¼šç­‰å¾…ä¸€å®šæ—¶é—´æ¥æ”¶é›†æ›´å¤šçš„æ•°æ®æ‰å‘é€ã€‚</p><p>åœ¨ä¸€äº›éœ€è¦ä½å»¶è¿Ÿçš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ¯”å¦‚æ¸¸æˆæˆ–è€…å®æ—¶é€šè®¯è½¯ä»¶ï¼ŒNagle ç®—æ³•çš„è¿™ç§è¡Œä¸ºå¯èƒ½å¯¼è‡´é—®é¢˜ï¼Œå› ä¸ºå³ä½¿æ˜¯å¾®å°çš„å»¶è¿Ÿä¹Ÿä¼šå¯¹ç”¨æˆ·ä½“éªŒäº§ç”Ÿè´Ÿé¢å½±å“ã€‚è¿™æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨<code>socket.setNoDelay()</code>æ–¹æ³•æ¥ç¦ç”¨ Nagle ç®—æ³•ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹<code>socket.setNoDelay([noDelay])</code>æ–¹æ³•çš„ä½¿ç”¨ï¼š</p><ul><li><code>noDelay</code> (å¯é€‰)ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœæ˜¯<code>true</code>ï¼Œåˆ™å…³é—­ Nagle ç®—æ³•ï¼›å¦‚æœæ˜¯<code>false</code>ï¼Œåˆ™å¼€å¯ Nagle ç®—æ³•ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™é»˜è®¤ä¸º<code>true</code>ã€‚</li></ul><p>å½“ä½ åˆ›å»ºä¸€ä¸ª Socket å¯¹è±¡ä¹‹åï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥è®¾ç½®æ˜¯å¦è¦ä½¿ç”¨ Nagle ç®—æ³•ï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿æ¥åˆ°æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">port</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> host</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to server</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç¦ç”¨Nagleç®—æ³•ï¼Œç¡®ä¿æ•°æ®ç«‹å³å‘é€è€Œä¸ä¼šè¢«å»¶è¿Ÿ</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setNoDelay</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">true</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€æ•°æ®ç»™æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬è¿æ¥åˆ°æœåŠ¡å™¨å¹¶æˆåŠŸå»ºç«‹è¿æ¥åï¼Œæˆ‘ä»¬è°ƒç”¨<code>client.setNoDelay(true)</code>æ¥å…³é—­ Nagle ç®—æ³•ï¼Œè¿™æ ·å†™å…¥ socket çš„æ¯ä¸ªæ•°æ®åŒ…éƒ½ä¼šç«‹å³å‘é€è€Œä¸ä¼šç­‰å¾…å…¶ä»–å°åŒ…åˆå¹¶ã€‚</p><p>è¿™é‡Œæœ‰å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><strong>å®æ—¶æ¸¸æˆ</strong>ï¼šç½‘ç»œæ¸¸æˆï¼Œå°¤å…¶æ˜¯é‚£äº›éœ€è¦å¿«é€Ÿå“åº”çš„å°„å‡»æˆ–ç«é€Ÿç±»æ¸¸æˆï¼Œå¾€å¾€éœ€è¦å°½é‡å‡å°‘ä»»ä½•å¯èƒ½çš„å»¶è¿Ÿï¼Œä»¥ä¾¿ç©å®¶èƒ½å¾—åˆ°å®æ—¶çš„äº’åŠ¨ä½“éªŒã€‚</li><li><strong>äº¤æ˜“å¹³å°</strong>ï¼šè‚¡ç¥¨æˆ–å¤–æ±‡äº¤æ˜“å¹³å°ï¼Œå…¶ä¸­äº¤æ˜“å†³ç­–éœ€è¦åœ¨æ¯«ç§’çº§ä½œå‡ºï¼Œè¿™æ—¶å€™å…³é—­ Nagle ç®—æ³•å¯ä»¥å‡å°‘äº¤æ˜“æ‰§è¡Œçš„æ—¶é—´å»¶è¿Ÿã€‚</li><li><strong>å®æ—¶é€šä¿¡åº”ç”¨</strong>ï¼šèŠå¤©åº”ç”¨æˆ– VoIP æœåŠ¡ï¼Œåœ¨è¿™äº›åº”ç”¨ä¸­ç”¨æˆ·æœŸæœ›ä»–ä»¬çš„è¯­éŸ³ã€è§†é¢‘æˆ–æ¶ˆæ¯èƒ½å¤Ÿä¸å—ä»»ä½•ä¸å¿…è¦çš„å»¶è¿Ÿå½±å“åœ°ç«‹åˆ»ä¼ é€’ç»™å¯¹æ–¹ã€‚</li></ol><p>æ€»ç»“æ¥è¯´ï¼Œ<code>socket.setNoDelay()</code>æ–¹æ³•æ˜¯ç”¨æ¥åœ¨ TCP è¿æ¥ä¸Šå¯ç”¨æˆ–ç¦ç”¨ Nagle ç®—æ³•ï¼Œä»¥æ­¤æ¥å¹³è¡¡ç½‘ç»œæ•ˆç‡å’Œæ•°æ®ä¼ è¾“å»¶è¿Ÿä¹‹é—´çš„å…³ç³»ï¼Œæ ¹æ®ä½ çš„åº”ç”¨éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚</p><h3 id="socket-settimeout-timeout-callback" tabindex="-1"><a class="header-anchor" href="#socket-settimeout-timeout-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketsettimeouttimeout-callback" target="_blank" rel="noopener noreferrer">socket.setTimeout(timeout[, callback])</a></span></a></h3><p>Node.js çš„ <code>socket.setTimeout(timeout[, callback])</code> æ–¹æ³•æ˜¯åœ¨ <code>net</code> æ¨¡å—ä¸­ä½¿ç”¨çš„ï¼Œç”¨äºè®¾ç½® socket è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚è¿™æ„å‘³ç€å¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰æ•°æ®ä¼ è¾“ï¼Œå°±ä¼šè‡ªåŠ¨æ–­å¼€è¿æ¥ã€‚è¿™ä¸ªæœºåˆ¶å¯¹äºç®¡ç†ç½‘ç»œèµ„æºéå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ç»´æŠ¤å¤§é‡æ´»åŠ¨è¿æ¥æ—¶ï¼Œå¯ä»¥å¸®åŠ©é˜²æ­¢èµ„æºæµªè´¹ã€‚è®©æˆ‘ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šè¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸¾ä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­ã€‚</p><h3 id="åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><ul><li><strong>timeout</strong>: è¶…æ—¶æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</li><li><strong>callback</strong>: è¶…æ—¶å‘ç”Ÿæ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œä½ ä¸å¸Œæœ›ä¿æŒç©ºé—²çš„è¿æ¥å¤ªä¹…ï¼Œä»¥èŠ‚çœæœåŠ¡å™¨èµ„æºã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>socket.setTimeout</code> æ¥è®¾ç½®ä¸€ä¸ªåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 60000 æ¯«ç§’ï¼ˆå³ 1 åˆ†é’Ÿï¼‰</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">60000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å½“è¶…æ—¶äº‹ä»¶å‘ç”Ÿæ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥è¶…æ—¶ï¼Œå³å°†æ–­å¼€...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // è¿™é‡Œå¯ä»¥å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8124</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç›‘å¬ç«¯å£8124</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨-1"><span>å®é™…è¿ç”¨</span></a></h3><ul><li><strong>èŠå¤©æœåŠ¡å™¨</strong>ï¼šå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œä¸ºäº†é˜²æ­¢èµ„æºæµªè´¹ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªè¿æ¥è®¾ç½®è¶…æ—¶ã€‚</li><li><strong>æ¸¸æˆæœåŠ¡å™¨</strong>ï¼šåœ¨æ¸¸æˆä¸­ï¼Œå¦‚æœç©å®¶é•¿æ—¶é—´æ²¡æœ‰æ“ä½œï¼Œå¯ä»¥åˆ©ç”¨è¶…æ—¶æœºåˆ¶è‡ªåŠ¨å°†å…¶è¸¢å‡ºæ¸¸æˆæˆ¿é—´ã€‚</li><li><strong>API æœåŠ¡</strong>ï¼šåœ¨æä¾› API æœåŠ¡æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªè¯·æ±‚è®¾ç½®è¶…æ—¶ï¼Œä»¥é˜²æ­¢æŸäº›è¯·æ±‚å ç”¨è¿‡å¤šæ—¶é—´ã€‚</li></ul><h3 id="æ³¨æ„äº‹é¡¹-2" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-2"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>è¶…æ—¶å¹¶ä¸æ„å‘³ç€è¿æ¥ä¸€å®šä¼šå…³é—­ï¼Œé™¤éä½ åœ¨è¶…æ—¶å¤„ç†å‡½æ•°ä¸­æ˜ç¡®è°ƒç”¨äº† <code>socket.end()</code> æˆ–ç±»ä¼¼çš„æ–¹æ³•æ¥å…³é—­è¿æ¥ã€‚</li><li>è®¾ç½®è¶…æ—¶ä¸ä¼šå½±å“ socket çš„æ­£å¸¸é€šä¿¡ï¼Œåªæœ‰åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ•°æ®äº¤æ¢æ—¶ï¼Œæ‰ä¼šè§¦å‘è¶…æ—¶äº‹ä»¶ã€‚</li></ul><p>é€šè¿‡ä½¿ç”¨ <code>socket.setTimeout</code> æ–¹æ³•ï¼Œä½ å¯ä»¥æ›´å¥½åœ°æ§åˆ¶ç½‘ç»œèµ„æºçš„ä½¿ç”¨ï¼Œé¿å…èµ„æºçš„æ— è°“æµªè´¹ï¼Œå¹¶ä¿æŒåº”ç”¨çš„é«˜æ•ˆè¿è¡Œã€‚</p><h3 id="socket-timeout" tabindex="-1"><a class="header-anchor" href="#socket-timeout"><span><a href="https://nodejs.org/docs/latest/api/net.html#sockettimeout" target="_blank" rel="noopener noreferrer">socket.timeout</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.timeout</code>æ˜¯ä¸€ä¸ªä¸ç½‘ç»œé€šä¿¡ç›¸å…³çš„æ¦‚å¿µï¼Œç‰¹åˆ«å‡ºç°åœ¨ TCP è¿æ¥æˆ–å…¶ä»–ç±»å‹çš„ç½‘ç»œå¥—æ¥å­—(socket)ä¸­ã€‚ç†è§£è¿™ä¸ªæ¦‚å¿µæœ‰åŠ©äºä½ ç®¡ç†ç½‘ç»œè¯·æ±‚å’Œå“åº”çš„æ—¶é—´æ•ˆç‡ï¼Œå°¤å…¶æ˜¯å½“ä½ å¤„ç†å¯èƒ½ä¼šå»¶è¿Ÿæˆ–æŒ‚èµ·çš„ç½‘ç»œæ“ä½œæ—¶ã€‚ä¸ºäº†ä½¿è¿™ä¸ªè§£é‡Šæ›´æ˜“äºç†è§£ï¼Œæˆ‘å°†åˆ†æ­¥éª¤ä»‹ç»ï¼Œå¹¶æä¾›å®é™…åº”ç”¨çš„ä¾‹å­ã€‚</p><h3 id="_1-å¥—æ¥å­—-socket-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1-å¥—æ¥å­—-socket-ç®€ä»‹"><span>1. å¥—æ¥å­—(Socket)ç®€ä»‹</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä»€ä¹ˆæ˜¯å¥—æ¥å­—(Socket)ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œ&quot;Socket&quot;æ˜¯ç½‘ç»œä¸Šä¸¤ä¸ªç¨‹åºé€šè¿‡ç½‘ç»œè¿›è¡Œæ•°æ®äº¤æ¢çš„ç«¯ç‚¹ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆç”µè¯çš„ä¸€ä¸ªç«¯å£ï¼Œä¸€æ–¹ç›‘å¬å¹¶ç­‰å¾…å¦ä¸€æ–¹çš„å‘¼å«æ¥å»ºç«‹è¿æ¥ã€‚</p><h3 id="_2-ä»€ä¹ˆæ˜¯socket-timeout" tabindex="-1"><a class="header-anchor" href="#_2-ä»€ä¹ˆæ˜¯socket-timeout"><span>2. ä»€ä¹ˆæ˜¯<code>socket.timeout</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæ¯ä¸ª Socket å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>timeout</code>å±æ€§ã€‚è¿™ä¸ª<code>timeout</code>å±æ€§å®šä¹‰äº†åœ¨ socket åœ¨è‡ªåŠ¨å…³é—­ä¹‹å‰å¯ä»¥ä¿æŒç©ºé—²çš„æ—¶é—´é•¿åº¦ã€‚å¦‚æœè®¾ç½®äº†<code>timeout</code>ï¼Œå½“ socket åœ¨æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰æ•°æ®äº¤æ¢ï¼ˆå³ï¼Œæ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®ä¹Ÿæ²¡æœ‰å‘é€æ•°æ®ï¼‰ï¼Œé‚£ä¹ˆ socket å°†è§¦å‘ä¸€ä¸ª<code>&#39;timeout&#39;</code>äº‹ä»¶ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œsocket ä¸ä¼šè‡ªåŠ¨å…³é—­ï¼›ä½ éœ€è¦åœ¨<code>&#39;timeout&#39;</code>äº‹ä»¶çš„å¤„ç†å‡½æ•°ä¸­æ‰‹åŠ¨å…³é—­å®ƒï¼Œé™¤éä½ æœ‰ç‰¹æ®Šçš„éœ€æ±‚è®©å®ƒä¿æŒæ‰“å¼€çŠ¶æ€ã€‚</p><h3 id="_3-å¦‚ä½•ä½¿ç”¨socket-timeout" tabindex="-1"><a class="header-anchor" href="#_3-å¦‚ä½•ä½¿ç”¨socket-timeout"><span>3. å¦‚ä½•ä½¿ç”¨<code>socket.timeout</code></span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä¸ä¸€ä¸ªå¤–éƒ¨æœåŠ¡å™¨è¿›è¡Œ TCP è¿æ¥ï¼Œä»¥è·å–å¤©æ°”ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨å› ä¸ºæŸäº›åŸå› å“åº”å»¶è¿Ÿï¼Œä½ ä¸å¸Œæœ›ä½ çš„åº”ç”¨æ— é™æœŸåœ°ç­‰å¾…ã€‚è¿™æ—¶å€™ï¼Œè®¾ç½®<code>socket.timeout</code>å°±éå¸¸æœ‰ç”¨äº†ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -5" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -5"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> HOST</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¤–éƒ¨æœåŠ¡å™¨çš„åœ°å€</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> PORT</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 12345</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿æ¥ç«¯å£</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ä¸º5ç§’</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬timeoutäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Socket timeout. No response received within 5 seconds.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é”€æ¯socketï¼Œç»“æŸè¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">PORT</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> HOST</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘æœåŠ¡å™¨å‘é€è¯·æ±‚...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received data: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP å®¢æˆ·ç«¯ï¼Œè¯¥å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°<code>example.com</code>çš„ç¬¬<code>12345</code>ç«¯å£ã€‚é€šè¿‡è°ƒç”¨<code>setTimeout(5000)</code>ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ª 5 ç§’çš„è¶…æ—¶æ—¶é—´ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœ 5 ç§’å†…æ²¡æœ‰ä»»ä½•æ•°æ®ä»æœåŠ¡å™¨æ¥æ”¶åˆ°ï¼Œ<code>&#39;timeout&#39;</code>äº‹ä»¶å°†è¢«è§¦å‘ï¼Œç„¶åæ‰§è¡Œç›¸å…³çš„å¤„ç†å‡½æ•°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯æ‰“å°ä¸€æ¡æ¶ˆæ¯å¹¶å…³é—­è¿æ¥ã€‚</p><h3 id="å°ç»“-10" tabindex="-1"><a class="header-anchor" href="#å°ç»“-10"><span>å°ç»“</span></a></h3><p>é€šè¿‡è®¾ç½®<code>socket.timeout</code>ï¼Œä½ èƒ½æœ‰æ•ˆåœ°ç®¡ç†ä½ çš„åº”ç”¨å¯¹ç½‘ç»œæ“ä½œçš„ç­‰å¾…æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´æŒ‚èµ·ï¼Œå°¤å…¶æ˜¯åœ¨ä¸ä¸ç¨³å®šçš„å¤–éƒ¨æœåŠ¡æˆ–èµ„æºè¿›è¡Œäº¤äº’æ—¶ã€‚è¿™æ ·åšå¯ä»¥æé«˜åº”ç”¨çš„å“åº”æ€§å’Œå¯é æ€§ã€‚</p><h3 id="socket-unref" tabindex="-1"><a class="header-anchor" href="#socket-unref"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketunref" target="_blank" rel="noopener noreferrer">socket.unref()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.unref()</code>æ–¹æ³•æ˜¯ç”¨æ¥æ“ä½œç½‘ç»œè¿æ¥ï¼ˆsocketï¼‰çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¢è®¨ Node.js çš„äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰å’Œå®ƒæ˜¯å¦‚ä½•ä¸<code>unref</code>æ–¹æ³•ç›¸å…³è”çš„ã€‚</p><h3 id="äº‹ä»¶å¾ªç¯-event-loop-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶å¾ªç¯-event-loop-åŸºç¡€"><span>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰åŸºç¡€</span></a></h3><p>Node.js ä½¿ç”¨ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼Œå…¶ä¸­äº‹ä»¶å¾ªç¯å…è®¸ Node.js æ‰§è¡Œéé˜»å¡ I/O æ“ä½œâ€”â€”å°½ç®¡ JavaScript æ˜¯å•çº¿ç¨‹çš„â€”â€”é€šè¿‡å°†æ“ä½œè½¬ç§»åˆ°ç³»ç»Ÿå†…æ ¸ï¼ˆå¦‚æœå¯èƒ½ï¼‰ã€‚ä¸€æ—¦æ“ä½œå®Œæˆï¼Œäº‹ä»¶å¾ªç¯å°†ç¡®ä¿å›è°ƒå‡½æ•°è¢«æ‰§è¡Œã€‚</p><h3 id="socket-unref-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#socket-unref-æ–¹æ³•çš„ä½œç”¨"><span><code>socket.unref()</code>æ–¹æ³•çš„ä½œç”¨</span></a></h3><p>å½“ä¸€ä¸ª Node.js åº”ç”¨è¿è¡Œæ—¶ï¼Œå®ƒä¼šä¿æŒæ´»è·ƒç›´åˆ°æ²¡æœ‰ä»»ä½•æ›´å¤šçš„å·¥ä½œè¦åšï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„å®šæ—¶å™¨ã€socket è¿æ¥ç­‰éƒ½å·²ç»å®Œæˆæˆ–å…³é—­ã€‚è¿™é‡Œï¼Œ<code>socket.unref()</code>æ–¹æ³•å‘æŒ¥äº†ä½œç”¨ã€‚å®ƒå‘Šè¯‰ Node.js çš„äº‹ä»¶å¾ªç¯ï¼Œå¦‚æœè¿™ä¸ª socket æ˜¯å”¯ä¸€å‰©ä¸‹çš„å·¥ä½œï¼Œé‚£ä¹ˆå®ƒå¯ä»¥é€€å‡ºä¸ç”¨ç­‰å¾…è¿™ä¸ª socketã€‚ç®€å•åœ°è¯´ï¼Œå®ƒå…è®¸ Node.js åœ¨è¿™ä¸ª socket ä¸Šæ²¡æœ‰æŒ‚èµ·çš„ä»»åŠ¡æ—¶ä¼˜é›…åœ°å…³é—­ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-15"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>é•¿è¿æ¥å¿ƒè·³æ£€æµ‹</strong>ï¼š<br> å‡è®¾ä½ çš„åº”ç”¨ä¸ä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨ä¿æŒé•¿è¿æ¥ï¼Œå¹¶å®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯æ¥ä¿æŒè¿æ¥æ´»è·ƒã€‚å¦‚æœè¿™ä¸ªè¿æ¥æ˜¯ä½ çš„åº”ç”¨ä¸­å”¯ä¸€çš„æ´»åŠ¨ï¼Œä½¿ç”¨<code>socket.unref()</code>å¯ä»¥å…è®¸ä½ çš„åº”ç”¨åœ¨ä¸éœ€è¦é•¿è¿æ¥æ—¶è‡ªåŠ¨é€€å‡ºï¼Œé¿å…äº†æ‰‹åŠ¨å…³é—­ç¨‹åºã€‚</p></li><li><p><strong>å®šæ—¶ä»»åŠ¡ä¸­çš„æ•°æ®åº“è¿æ¥</strong>ï¼š<br> å‡å¦‚ä½ æœ‰ä¸€ä¸ª Node.js è„šæœ¬ï¼Œå®ƒå®šæœŸè¿è¡Œä¸€äº›æ•°æ®åº“æŸ¥è¯¢ä»»åŠ¡ã€‚æ¯æ¬¡ä»»åŠ¡è¿è¡Œç»“æŸåï¼Œæ•°æ®åº“è¿æ¥å¯èƒ½ä»ç„¶ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœè¿™ä¸ªæ•°æ®åº“è¿æ¥æ˜¯æœ€åä¸€ä¸ªæ´»åŠ¨ä»»åŠ¡ï¼Œé€šè¿‡åœ¨è¿æ¥å¯¹è±¡ä¸Šè°ƒç”¨<code>unref()</code>ï¼Œå¯ä»¥ä½¿å¾— Node.js è¿›ç¨‹åœ¨ä»»åŠ¡å®Œæˆåè‡ªåŠ¨é€€å‡ºï¼Œè€Œä¸æ˜¯æ— é™æœŸåœ°ç­‰å¾…ã€‚</p></li><li><p><strong>å¾®æœåŠ¡å¥åº·æ£€æŸ¥</strong>ï¼š<br> åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ¯ä¸ªæœåŠ¡å¯èƒ½éœ€è¦å®šæœŸå‘æ³¨å†Œä¸­å¿ƒæŠ¥å‘Šè‡ªå·±çš„å¥åº·çŠ¶æ€ã€‚é€šè¿‡åœ¨è¿™äº›æŠ¥å‘ŠçŠ¶æ€çš„ç½‘ç»œè¿æ¥ä¸Šä½¿ç”¨<code>unref()</code>ï¼ŒæœåŠ¡å¯ä»¥åœ¨å®ŒæˆçŠ¶æ€æŠ¥å‘Šåï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–æ´»åŠ¨ä»»åŠ¡ï¼Œç«‹å³ä¼˜é›…åœ°å…³é—­ã€‚</p></li></ol><h3 id="ç»“è®º-5" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-5"><span>ç»“è®º</span></a></h3><p><code>socket.unref()</code>æ–¹æ³•æ˜¯å¤„ç†ç½‘ç»œè¿æ¥æ—¶ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œè®©å¼€å‘è€…å¯ä»¥æ§åˆ¶ Node.js åº”ç”¨åœ¨ç‰¹å®šæ¡ä»¶ä¸‹çš„é€€å‡ºè¡Œä¸ºã€‚è¿™ä¸ä»…æœ‰åŠ©äºä¼˜åŒ–èµ„æºä½¿ç”¨ï¼Œè¿˜èƒ½æé«˜åº”ç”¨çš„å¯ç»´æŠ¤æ€§å’Œç¨³å®šæ€§ã€‚</p><h3 id="socket-write-data-encoding-callback" tabindex="-1"><a class="header-anchor" href="#socket-write-data-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketwritedata-encoding-callback" target="_blank" rel="noopener noreferrer">socket.write(data[, encoding][, callback])</a></span></a></h3><p>å½“ç„¶ï¼Œæˆ‘å¾ˆä¹æ„ä¸ºæ‚¨è§£é‡Š Node.js ä¸­çš„ <code>socket.write(data[, encoding][, callback])</code> æ–¹æ³•ã€‚</p><p>åœ¨ Node.js çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œ<code>socket</code> æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªç½‘ç»œè¿æ¥çš„ç«¯ç‚¹ã€‚å½“æ‚¨ä½¿ç”¨ Node.js åˆ›å»ºæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ï¼Œ<code>socket</code> ç”¨æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚<code>socket.write</code> æ–¹æ³•åˆ™æ˜¯ç”¨æ¥å‘è¿™ä¸ªè¿æ¥çš„å¦ä¸€ç«¯å‘é€æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚</p><p>è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹ <code>socket.write(data[, encoding][, callback])</code> æ–¹æ³•çš„å„ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><p><strong>data</strong>: è¿™æ˜¯æ‚¨æƒ³è¦å‘é€çš„æ•°æ®ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ˜¯ä¸€ä¸ª Buffer å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦å‘é€æ–‡æœ¬ï¼Œå¯ä»¥ç›´æ¥å°†æ–‡æœ¬ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ã€‚</p></li><li><p><strong>encoding</strong> (å¯é€‰): è¿™ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®š <code>data</code> çš„ç¼–ç æ–¹å¼ã€‚è¿™åœ¨æ‚¨å‘é€å­—ç¬¦ä¸²æ—¶éå¸¸æœ‰ç”¨ã€‚å¦‚æœ <code>data</code> æ˜¯ä¸€ä¸ª Bufferï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°é€šå¸¸ä¸éœ€è¦ã€‚å¸¸è§çš„ç¼–ç æœ‰ &#39;utf8&#39;, &#39;ascii&#39; ç­‰ã€‚</p></li><li><p><strong>callback</strong> (å¯é€‰): è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“æ•°æ®è¢«å®Œå…¨å¤„ç†å®Œæ¯•æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å®ƒé€šå¸¸ç”¨æ¥å¤„ç†å‘é€åçš„ç¡®è®¤æˆ–é”™è¯¯ã€‚</p></li></ol><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾æ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„èŠå¤©æœåŠ¡å™¨ï¼Œæ‚¨å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨ <code>socket.write</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–°çš„å®¢æˆ·ç«¯è¿æ¥äº†</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å‘å®¢æˆ·ç«¯å›åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æ‚¨çš„ä¿¡æ¯: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨8080ç«¯å£</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå®ƒå°±ä¼šé€šè¿‡ <code>socket.write</code> æ–¹æ³•å›åº”ä¸€æ¡æ¶ˆæ¯ã€‚è¿™ä¸ªæ¶ˆæ¯åŒ…å«äº†æ¥æ”¶åˆ°çš„åŸå§‹æ•°æ®ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥æ„å»ºå‡ºå¤æ‚çš„ç½‘ç»œåº”ç”¨ï¼Œå®ç°æ•°æ®çš„åŒå‘äº¤æµã€‚è®°ä½ï¼Œè™½ç„¶è¿™é‡Œçš„ä¾‹å­å¾ˆç®€å•ï¼Œä½†åœ¨çœŸå®çš„åº”ç”¨ä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦å¤„ç†æ›´å¤æ‚çš„æ•°æ®æ ¼å¼å’Œç½‘ç»œé”™è¯¯ç­‰é—®é¢˜ã€‚</p><h3 id="socket-readystate" tabindex="-1"><a class="header-anchor" href="#socket-readystate"><span><a href="https://nodejs.org/docs/latest/api/net.html#socketreadystate" target="_blank" rel="noopener noreferrer">socket.readyState</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.readyState</code>å±æ€§ç”¨äºå±•ç¤ºä¸€ä¸ª socketï¼ˆå¥—æ¥å­—ï¼‰å½“å‰çš„çŠ¶æ€ã€‚Socket æ˜¯ç½‘ç»œç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºç½‘ç»œä¸­ä¸¤ä¸ªç¨‹åºé€šè¿‡ç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ã€‚åœ¨ Node.js çš„<code>net</code>æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ sockets æ¥å¤„ç† TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æˆ– IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰è¿æ¥ã€‚</p><p><code>socket.readyState</code>è¿™ä¸ªå±æ€§ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜è¯¥ socket çš„å½“å‰çŠ¶æ€ã€‚è¿™äº›çŠ¶æ€åŒ…æ‹¬ï¼š</p><ol><li><strong><code>open</code></strong>: è¿™æ„å‘³ç€ socket å·²ç»æˆåŠŸå»ºç«‹è¿æ¥ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚</li><li><strong><code>opening</code></strong>: è¿™è¡¨ç¤º socket æ­£åœ¨å°è¯•å»ºç«‹è¿æ¥ã€‚</li><li><strong><code>closed</code></strong>: è¡¨ç¤ºè¿æ¥å·²ç»å…³é—­ï¼Œä¸å†å¯ç”¨äºé€šä¿¡ã€‚</li><li><strong><code>readOnly</code></strong>: è¿™ç§çŠ¶æ€ä¸‹ï¼Œsocket åªèƒ½æ¥æ”¶æ•°æ®ï¼Œä¸èƒ½å‘é€æ•°æ®ã€‚</li><li><strong><code>writeOnly</code></strong>: ä¸<code>readOnly</code>ç›¸åï¼Œè¿™ç§çŠ¶æ€ä¸‹ï¼Œsocket åªèƒ½å‘é€æ•°æ®ï¼Œä¸èƒ½æ¥æ”¶æ•°æ®ã€‚</li></ol><p>è®©æˆ‘ä»¬ä¸¾ä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­ä»¥ä¾¿æ›´å¥½åœ°ç†è§£å®ƒä»¬çš„åº”ç”¨åœºæ™¯ï¼š</p><h3 id="å®ä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯"><span>å®ä¾‹ 1ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</span></a></h3><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶æ ¹æ®<code>socket.readyState</code>æ¥åšå‡ºç›¸åº”çš„å“åº”ã€‚</p><p><strong>æœåŠ¡å™¨ç«¯ä»£ç  (server.js):</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥socketçŠ¶æ€</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å½“å‰SocketçŠ¶æ€: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">readyState</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¯åŠ¨ï¼Œåœ¨ç«¯å£8080ç›‘å¬</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¢æˆ·ç«¯ä»£ç  (client.js):</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å½“å‰SocketçŠ¶æ€: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">readyState</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server! Love, Client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä»æœåŠ¡å™¨æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å½“å‰SocketçŠ¶æ€: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">readyState</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥äº†åœ¨è¿æ¥è¿‡ç¨‹ä¸­å’Œç»“æŸæ—¶çš„<code>socket.readyState</code>çŠ¶æ€ã€‚</p><h3 id="å®ä¾‹-2-ç›‘æµ‹-socket-çŠ¶æ€å˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-ç›‘æµ‹-socket-çŠ¶æ€å˜åŒ–"><span>å®ä¾‹ 2ï¼šç›‘æµ‹ socket çŠ¶æ€å˜åŒ–</span></a></h3><p>ä½ ä¹Ÿè®¸æƒ³è¦åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­å¯¹<code>socket.readyState</code>çŠ¶æ€å˜åŒ–ä½œå‡ºå“åº”ï¼Œä¾‹å¦‚è®°å½•æ—¥å¿—ã€æ¸…ç†èµ„æºæˆ–è§¦å‘å…¶ä»–æ“ä½œã€‚è™½ç„¶<code>socket.readyState</code>æœ¬èº«å¹¶ä¸æä¾›äº‹ä»¶ç›‘å¬å™¨ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ç›‘å¬å…¶å®ƒç›¸å…³äº‹ä»¶ï¼ˆå¦‚<code>connect</code>ã€<code>close</code>ç­‰ï¼‰æ¥æ¨æ–­çŠ¶æ€å˜åŒ–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¿æ¥çŠ¶æ€: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">readyState</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åº”è¯¥æ‰“å° &#39;open&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬socketå…³é—­äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è¿æ¥çŠ¶æ€: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">readyState</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åº”è¯¥æ‰“å° &#39;closed&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„å®ä¾‹ä»£ç ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>socket.readyState</code>æ˜¯å¦‚ä½•åœ¨å®é™…åœºæ™¯ä¸­è¢«ç”¨æ¥ç›‘æµ‹å’Œå“åº” socket è¿æ¥çŠ¶æ€çš„ã€‚äº†è§£ socket çš„å½“å‰çŠ¶æ€å¯¹äºå¼€å‘ç¨³å®šä¸”é«˜æ•ˆçš„ç½‘ç»œåº”ç”¨è‡³å…³é‡è¦ã€‚</p><h2 id="net-connect" tabindex="-1"><a class="header-anchor" href="#net-connect"><span><a href="https://nodejs.org/docs/latest/api/net.html#netconnect" target="_blank" rel="noopener noreferrer">net.connect()</a></span></a></h2><p>Node.js çš„ <code>net.connect()</code> æ–¹æ³•æ˜¯ç”¨æ¥å»ºç«‹ä¸€ä¸ªç½‘ç»œè¿æ¥çš„ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºåˆ›å»º TCP å®¢æˆ·ç«¯ï¼Œå³ç”¨æ¥è¿æ¥åˆ° TCP æœåŠ¡å™¨ã€‚<code>net.connect()</code> å¯ä»¥æ¥å—ä¸åŒå½¢å¼çš„å‚æ•°æ¥æŒ‡å®šè¿æ¥çš„ç›®æ ‡ï¼Œæ¯”å¦‚ç«¯å£å·å’Œä¸»æœºåã€‚</p><p>å½“ä½ è°ƒç”¨ <code>net.connect()</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>net.Socket</code> å¯¹è±¡ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªå¯¹è±¡æ¥å‘é€æ•°æ®ã€æ¥æ”¶æ•°æ®ã€ç›‘å¬æ•°æ®äº‹ä»¶ç­‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-16"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨"><span>1. è¿æ¥åˆ° TCP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾æœ‰ä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°ï¼Œç›‘å¬ç«¯å£ 12345 çš„ TCP æœåŠ¡å™¨ã€‚ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>net.connect()</code> æ¥è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°æœ¬åœ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æœåŠ¡å™¨å‘é€çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ”¶åˆ°æ•°æ®åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸æœåŠ¡å™¨çš„è¿æ¥æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ä¸è¿œç¨‹æœåŠ¡äº¤äº’" tabindex="-1"><a class="header-anchor" href="#_2-ä¸è¿œç¨‹æœåŠ¡äº¤äº’"><span>2. ä¸è¿œç¨‹æœåŠ¡äº¤äº’</span></a></h4><p>å‡è®¾ä½ æƒ³è¦è¿æ¥åˆ°ä¸€ä¸ªè¿œç¨‹çš„å¤©æ°”æœåŠ¡è·å–å½“å‰çš„å¤©æ°”ä¿¡æ¯ï¼Œè¿™ä¸ªæœåŠ¡è¿è¡Œåœ¨ <code>weather.example.com</code> çš„ 80 ç«¯å£ä¸Šï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">weather.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°å¤©æ°”æœåŠ¡ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°å¤©æ°”æœåŠ¡</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">GET /current-weather HTTP/1.1</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#A3BE8C;">Host: weather.example.com</span><span style="color:#EBCB8B;">\r\n\r\n</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°å¤©æ°”ä¿¡æ¯ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ”¶åˆ°æ•°æ®åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸å¤©æ°”æœåŠ¡çš„è¿æ¥æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ³¨æ„äº‹é¡¹-3" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-3"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>åœ¨ä½¿ç”¨ <code>net.connect()</code> æ—¶ï¼Œéœ€è¦æ³¨æ„ç›®æ ‡æœåŠ¡å™¨çš„ç«¯å£å’Œ IP åœ°å€/åŸŸåæ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠä½ çš„å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™è¿æ¥åˆ°è¯¥æœåŠ¡å™¨ã€‚</li><li>åœ¨æ•°æ®äº¤äº’æ—¶ï¼Œç¡®ä¿æ­£ç¡®å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦è§£æç‰¹å®šæ ¼å¼æ•°æ®æ—¶ã€‚</li><li>ä¸è¦å¿˜è®°åœ¨å®Œæˆæ•°æ®äº¤äº’åå…³é—­è¿æ¥ï¼Œä»¥é¿å…èµ„æºæ³„éœ²ã€‚</li></ul><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¯¹å¦‚ä½•ä½¿ç”¨ <code>net.connect()</code> æ–¹æ³•æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£äº†ã€‚è¿™ä¸ªæ–¹æ³•åœ¨ç½‘ç»œç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ä¸å…¶ä»–æœåŠ¡å™¨æˆ–æœåŠ¡è¿›è¡Œé€šä¿¡æ—¶ã€‚</p><h3 id="net-connect-options-connectlistener" tabindex="-1"><a class="header-anchor" href="#net-connect-options-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#netconnectoptions-connectlistener" target="_blank" rel="noopener noreferrer">net.connect(options[, connectListener])</a></span></a></h3><p>Node.js çš„ <code>net.connect(options[, connectListener])</code> æ–¹æ³•æ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªåˆ° TCP server æˆ– UNIX socket server çš„è¿æ¥ã€‚è¿™æ˜¯ Node.js ä¸­ <code>net</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå»ºç«‹å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œé€šä¿¡ã€‚è®©æˆ‘ä»¬é€æ­¥åˆ†è§£è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥ç†è§£å®ƒçš„ç”¨é€”å’Œå·¥ä½œåŸç†ã€‚</p><h3 id="å‚æ•°è§£é‡Š-4" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-4"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><strong>options</strong>: è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«è¿æ¥çš„å„ç§é€‰é¡¹ã€‚å¸¸è§çš„é€‰é¡¹åŒ…æ‹¬ <code>port</code>ï¼ˆç«¯å£å·ï¼Œç”¨äº TCP è¿æ¥ï¼‰ã€<code>host</code>ï¼ˆä¸»æœºåæˆ– IP åœ°å€ï¼‰ã€<code>path</code>ï¼ˆç”¨äº UNIX å¥—æ¥å­—çš„è·¯å¾„ï¼‰ç­‰ã€‚</li><li><strong>connectListener</strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå½“è¿æ¥æˆåŠŸå»ºç«‹æ—¶ä¼šè¢«è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-8"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¿æ¥åˆ°-tcp-æœåŠ¡å™¨"><span>ä¾‹å­ 1: è¿æ¥åˆ° TCP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾æœ‰ä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°ï¼Œç«¯å£ä¸º <code>12345</code> çš„ TCP æœåŠ¡å™¨ï¼Œä½ æƒ³ä» Node.js å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºåˆ° TCP æœåŠ¡å™¨çš„è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ–­å¼€è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è¿æ¥å…³é—­</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸æœåŠ¡å™¨çš„è¿æ¥æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é¦–å…ˆå¼•å…¥äº† <code>net</code> æ¨¡å—ï¼Œå¹¶ä½¿ç”¨ <code>net.connect</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªè¿æ¥åˆ°ç«¯å£ <code>12345</code> çš„ TCP æœåŠ¡å™¨ã€‚åœ¨è¿æ¥æˆåŠŸå»ºç«‹æ—¶ï¼Œä¼šè¾“å‡ºâ€œè¿æ¥åˆ°æœåŠ¡å™¨ï¼â€çš„ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œå®¢æˆ·ç«¯ç›‘å¬ä»æœåŠ¡å™¨æ¥æ”¶çš„æ•°æ®ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°æ•°æ®åæ–­å¼€è¿æ¥ã€‚</p><h4 id="ä¾‹å­-2-è¿æ¥åˆ°-unix-å¥—æ¥å­—" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è¿æ¥åˆ°-unix-å¥—æ¥å­—"><span>ä¾‹å­ 2: è¿æ¥åˆ° UNIX å¥—æ¥å­—</span></a></h4><p>å¦‚æœä½ çš„æœåŠ¡å™¨æ˜¯é€šè¿‡ UNIX å¥—æ¥å­—åœ¨æœ¬åœ°é€šä¿¡çš„ï¼Œè¿æ¥æ–¹å¼ä¼šç•¥æœ‰ä¸åŒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/tmp/echo.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºåˆ° UNIX å¥—æ¥å­—çš„è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> path</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> path</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ° UNIX å¥—æ¥å­—æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ä¸ TCP ä¾‹å­ç›¸åŒçš„æ–¹å¼ç›‘å¬æ•°æ®å’Œæ–­å¼€äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸ UNIX å¥—æ¥å­—æœåŠ¡å™¨çš„è¿æ¥æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®š <code>path</code> é€‰é¡¹æ¥è¿æ¥åˆ° UNIX å¥—æ¥å­—ã€‚å…¶ä½™çš„æ“ä½œï¼ˆå¦‚ç›‘å¬æ•°æ®å’Œæ–­å¼€è¿æ¥ï¼‰ä¸è¿æ¥åˆ° TCP æœåŠ¡å™¨çš„æ–¹å¼ç›¸åŒã€‚</p><h3 id="å°ç»“-11" tabindex="-1"><a class="header-anchor" href="#å°ç»“-11"><span>å°ç»“</span></a></h3><p><code>net.connect</code> æ–¹æ³•æ˜¯ Node.js ä¸­å»ºç«‹å®¢æˆ·ç«¯ç½‘ç»œè¿æ¥çš„ä¸€ç§åŸºç¡€è€Œå¼ºå¤§çš„æ–¹å¼ã€‚é€šè¿‡æŒ‡å®šä¸åŒçš„é€‰é¡¹ï¼Œä½ å¯ä»¥è½»æ¾åœ°è¿æ¥åˆ° TCP æˆ– UNIX å¥—æ¥å­—æœåŠ¡å™¨ï¼Œå¹¶è¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™åœ¨å¼€å‘éœ€è¦ç½‘ç»œé€šä¿¡çš„åº”ç”¨æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚æ•°æ®åº“å®¢æˆ·ç«¯ã€èŠå¤©åº”ç”¨æˆ–ä»»ä½•éœ€è¦ä¸è¿œç¨‹æœåŠ¡å™¨äº¤äº’çš„æœåŠ¡ã€‚</p><h3 id="net-connect-path-connectlistener" tabindex="-1"><a class="header-anchor" href="#net-connect-path-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#netconnectpath-connectlistener" target="_blank" rel="noopener noreferrer">net.connect(path[, connectListener])</a></span></a></h3><p>Node.js çš„ <code>net.connect(path[, connectListener])</code> æ–¹æ³•æ˜¯åœ¨ Node.js çš„ <code>net</code> æ¨¡å—ä¸­ï¼Œè¿™ä¸ªæ¨¡å—ä¸»è¦ç”¨äºå®ç°åº•å±‚çš„ç½‘ç»œé€šä¿¡åŠŸèƒ½ã€‚ä½¿ç”¨ <code>net.connect</code> æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šè·¯å¾„çš„ socket è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•é€šå¸¸ç”¨äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚</p><h3 id="å‚æ•°è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯´æ˜"><span>å‚æ•°è¯´æ˜</span></a></h3><ul><li><strong>path</strong>: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦è¿æ¥çš„è·¯å¾„ã€‚æ ¹æ®ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ª Unix å¥—æ¥å­—è·¯å¾„ï¼ˆåœ¨ç±» Unix ç³»ç»Ÿä¸­ï¼‰æˆ–è€…ä¸€ä¸ªå‘½åç®¡é“è·¯å¾„ï¼ˆåœ¨ Windows ä¸­ï¼‰ã€‚</li><li><strong>connectListener</strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå½“è¿æ¥æˆåŠŸå»ºç«‹æ—¶ä¼šè¢«è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-17"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¿æ¥åˆ°-unix-socket" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¿æ¥åˆ°-unix-socket"><span>ä¾‹å­ 1: è¿æ¥åˆ° Unix Socket</span></a></h4><p>å¦‚æœä½ åœ¨ä¸€ä¸ªç±» Unix ç³»ç»Ÿä¸Šè¿è¡Œ Node.jsï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>net.connect</code> è¿æ¥åˆ°ä¸€ä¸ª Unix å¥—æ¥å­—ã€‚æ¯”å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæœåŠ¡åœ¨ Unix å¥—æ¥å­— <code>/tmp/echo.sock</code> ä¸Šç›‘å¬ï¼Œä½ å¯ä»¥è¿™æ ·è¿æ¥åˆ°å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºè¿æ¥åˆ° Unix å¥—æ¥å­—çš„å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/tmp/echo.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-ä½¿ç”¨å‘½åç®¡é“åœ¨-windows-ä¸­è¿›è¡Œè¿æ¥" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨å‘½åç®¡é“åœ¨-windows-ä¸­è¿›è¡Œè¿æ¥"><span>ä¾‹å­ 2: ä½¿ç”¨å‘½åç®¡é“åœ¨ Windows ä¸­è¿›è¡Œè¿æ¥</span></a></h4><p>åœ¨ Windows ä¸Šï¼Œ<code>net.connect</code> å¯ä»¥ç”¨æ¥è¿æ¥åˆ°ä¸€ä¸ªå‘½åç®¡é“ã€‚å‡è®¾æœ‰ä¸€ä¸ªæœåŠ¡åœ¨å‘½åç®¡é“ <code>\\.\pipe\mypipe</code> ä¸Šç›‘å¬ï¼Œä½ å¯ä»¥è¿™æ ·è¿æ¥åˆ°å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºè¿æ¥åˆ°å‘½åç®¡é“çš„å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#EBCB8B;">\\\\</span><span style="color:#A3BE8C;">.</span><span style="color:#EBCB8B;">\\</span><span style="color:#A3BE8C;">pipe</span><span style="color:#EBCB8B;">\\</span><span style="color:#A3BE8C;">mypipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-7" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-7"><span>æ€»ç»“</span></a></h3><p><code>net.connect</code> æ–¹æ³•åœ¨ Node.js ä¸­éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä½å±‚æ¬¡ç½‘ç»œé€šä¿¡ã€‚é€šè¿‡æŒ‡å®šè¿æ¥çš„è·¯å¾„ï¼Œä½ å¯ä»¥è½»æ¾åœ°è¿æ¥åˆ° Unix å¥—æ¥å­—æˆ– Windows å‘½åç®¡é“ï¼Œä»è€Œä¸æœ¬åœ°æˆ–è¿œç¨‹çš„æœåŠ¡è¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™å¯¹äºå¼€å‘éœ€è¦åº•å±‚ç½‘ç»œé€šä¿¡èƒ½åŠ›çš„åº”ç”¨ç¨‹åºæ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><h3 id="net-connect-port-host-connectlistener" tabindex="-1"><a class="header-anchor" href="#net-connect-port-host-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#netconnectport-host-connectlistener" target="_blank" rel="noopener noreferrer">net.connect(port[, host][, connectListener])</a></span></a></h3><p><code>net.connect(port[, host][, connectListener])</code> æ˜¯ Node.js ä¸­ <code>net</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šç«¯å£å’Œä¸»æœºçš„ TCP è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ä½ çš„ Node.js åº”ç”¨ç¨‹åºå¯ä»¥ä½œä¸ºå®¢æˆ·ç«¯ï¼Œä¸å…¶ä»–æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ç°åœ¨ï¼Œè®©æˆ‘æ¥è¯¦ç»†è§£é‡Šå¹¶ä¸”ç»™å‡ºä¸€äº›å®é™…çš„è¿ç”¨ä¾‹å­ã€‚</p><h3 id="å‚æ•°è§£é‡Š-5" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-5"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>port</code>ï¼šè¿™æ˜¯ä½ æƒ³è¦è¿æ¥çš„è¿œç¨‹æœåŠ¡å™¨çš„ç«¯å£å·ã€‚</li><li><code>host</code> (å¯é€‰)ï¼šè¿™æ˜¯è¿œç¨‹æœåŠ¡å™¨çš„ä¸»æœºåæˆ–è€… IP åœ°å€ã€‚å¦‚æœä¸æŒ‡å®šï¼Œ<code>host</code> é»˜è®¤ä¸º <code>localhost</code>ã€‚</li><li><code>connectListener</code> (å¯é€‰)ï¼šè¿™æ˜¯ä¸€ä¸ªåœ¨è¿æ¥å»ºç«‹æ—¶è‡ªåŠ¨æ·»åŠ åˆ° <code>&#39;connect&#39;</code> äº‹ä»¶çš„ç›‘å¬å™¨å‡½æ•°ã€‚</li></ul><h3 id="ä½¿ç”¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ–¹å¼"><span>ä½¿ç”¨æ–¹å¼</span></a></h3><p><code>net.connect()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>net.Socket</code> å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥ç›‘å¬æ•°æ®ã€å†™å…¥æ•°æ®ã€ç»“æŸè¿æ¥ç­‰ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-3"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¿æ¥åˆ°-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¿æ¥åˆ°-http-æœåŠ¡å™¨"><span>ä¾‹å­ 1ï¼šè¿æ¥åˆ° HTTP æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æƒ³ä½¿ç”¨ Node.js è¿æ¥åˆ°ä¸€ä¸ªè¿è¡Œåœ¨ç«¯å£ 80 ä¸Šçš„ HTTP æœåŠ¡å™¨ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°æŒ‡å®šç«¯å£å’Œä¸»æœºçš„ socket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // ä¸€æ—¦è¿æ¥ï¼Œå‘é€ä¸€ä¸ª HTTP GET è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">GET / HTTP/1.1</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#A3BE8C;">Host: example.com</span><span style="color:#EBCB8B;">\r\n\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æ¥æ”¶åˆ°æ•°æ®åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-ç®€å•çš„-echo-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç®€å•çš„-echo-å®¢æˆ·ç«¯"><span>ä¾‹å­ 2ï¼šç®€å•çš„ Echo å®¢æˆ·ç«¯</span></a></h4><p>å¦‚æœæœ‰ä¸€ä¸ª Echo æœåŠ¡å™¨ï¼Œå®ƒä¼šå°†æ‰€æœ‰æ¥æ”¶åˆ°çš„æ¶ˆæ¯åŸæ ·å‘é€å›å®¢æˆ·ç«¯ï¼Œä½ å¯ä»¥è¿™æ ·è¿æ¥åˆ°å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2222</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ° echo æœåŠ¡å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘é€ä¸€æ¡æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server! Echo back to me.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æ”¶åˆ°å›å£°åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>net.connect()</code> å¦‚ä½•ä½¿å¾— Node.js åº”ç”¨èƒ½å¤Ÿä½œä¸ºå®¢æˆ·ç«¯ï¼Œä¸å…¶ä»–æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œæ— è®ºæ˜¯å‘é€ HTTP è¯·æ±‚è¿˜æ˜¯ä¸ Echo æœåŠ¡å™¨äº¤äº’ã€‚è¿™ç§èƒ½åŠ›è®© Node.js åœ¨å®ç°å„ç§ç½‘ç»œåº”ç”¨æ—¶éå¸¸çµæ´»å’Œå¼ºå¤§ã€‚</p><h2 id="net-createconnection" tabindex="-1"><a class="header-anchor" href="#net-createconnection"><span><a href="https://nodejs.org/docs/latest/api/net.html#netcreateconnection" target="_blank" rel="noopener noreferrer">net.createConnection()</a></span></a></h2><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>net.createConnection()</code> æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šç«¯å£å’Œä¸»æœºçš„ TCP è¿æ¥çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å±äº <code>net</code> æ¨¡å—ï¼Œè¿™æ˜¯ Node.js æä¾›çš„ç”¨äºå¤„ç†ç½‘ç»œæ“ä½œçš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ã€‚åˆ›å»ºçš„è¿æ¥å¯ä»¥ç”¨äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>ä½¿ç”¨ <code>net.createConnection()</code> æ–¹æ³•æ—¶ï¼Œä½ å¯ä»¥ä¼ é€’ä¸åŒçš„å‚æ•°æ¥æŒ‡å®šè¿æ¥çš„ç›®æ ‡ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å‚æ•°å½¢å¼ï¼š</p><ol><li><p><strong>æŒ‡å®šç«¯å£å’Œä¸»æœºå</strong>ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç«¯å£å·ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸»æœºåã€‚å¦‚æœä¸æŒ‡å®šä¸»æœºåï¼Œé»˜è®¤ä¼šè¿æ¥åˆ° <code>localhost</code>ã€‚</p></li><li><p><strong>ä½¿ç”¨é€‰é¡¹å¯¹è±¡</strong>ï¼šä½ ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªå¯¹è±¡æ¥æŒ‡å®šè¿æ¥çš„è¯¦ç»†é€‰é¡¹ï¼Œå¦‚ç«¯å£ï¼ˆ<code>port</code>ï¼‰ã€ä¸»æœºï¼ˆ<code>host</code>ï¼‰å’Œæœ¬åœ°åœ°å€ï¼ˆ<code>localAddress</code>ï¼‰ç­‰ã€‚</p></li></ol><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p><strong>1. åˆ›å»ºåˆ°æœ¬åœ°æœåŠ¡å™¨çš„è¿æ¥</strong></p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°çš„æœåŠ¡å™¨ç›‘å¬åœ¨ç«¯å£ 3000 ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>net.createConnection()</code> åˆ›å»ºä¸€ä¸ªåˆ°è¯¥æœåŠ¡å™¨çš„è¿æ¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºåˆ°æœ¬åœ°æœåŠ¡å™¨çš„è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æ•°æ®äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬å…³é—­äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²ä»æœåŠ¡å™¨æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥åˆ°æœ¬åœ°ä¸»æœºçš„ 3000 ç«¯å£ã€‚å½“è¿æ¥å»ºç«‹åï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°æœåŠ¡å™¨ï¼Œæ¥æ”¶æœåŠ¡å™¨çš„å“åº”ï¼Œç„¶åå…³é—­è¿æ¥ã€‚</p><p><strong>2. åˆ›å»ºåˆ°è¿œç¨‹æœåŠ¡å™¨çš„è¿æ¥</strong></p><p>å¦‚æœä½ æƒ³è¿æ¥åˆ°ä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨ï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨äº’è”ç½‘ä¸Šçš„ API æœåŠ¡ï¼Œåªéœ€æ”¹å˜ä¸»æœºå’Œç«¯å£å·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿œç¨‹æœåŠ¡å™¨çš„åœ°å€æ˜¯ example.comï¼Œç«¯å£æ˜¯ 1234</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1234</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¤„ç†æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“è¿æ¥å…³é—­</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸è¿œç¨‹æœåŠ¡å™¨çš„è¿æ¥å·²å…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥å»ºç«‹ä¸€ä¸ª TCP å®¢æˆ·ç«¯ï¼Œå®ƒèƒ½å¤Ÿä¸æœ¬åœ°æˆ–è¿œç¨‹çš„ TCP æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚<code>net.createConnection()</code> æ–¹æ³•æ˜¯ Node.js ä¸­å¤„ç† TCP ç½‘ç»œé€šä¿¡çš„åŸºç¡€ï¼Œéå¸¸é€‚åˆéœ€è¦åº•å±‚ç½‘ç»œé€šä¿¡èƒ½åŠ›çš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="net-createconnection-options-connectlistener" tabindex="-1"><a class="header-anchor" href="#net-createconnection-options-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#netcreateconnectionoptions-connectlistener" target="_blank" rel="noopener noreferrer">net.createConnection(options[, connectListener])</a></span></a></h3><p>Node.js ä¸­çš„ <code>net.createConnection(options[, connectListener])</code> æ–¹æ³•æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šæœåŠ¡å™¨çš„ TCP è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸å…³é”®ï¼Œå› ä¸ºå®ƒå…è®¸ä½ çš„ Node.js åº”ç”¨ç¨‹åºä¸å…¶ä»–æœåŠ¡å™¨æˆ–æœåŠ¡å»ºç«‹ç½‘ç»œé€šä¿¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸åŒçš„é€‰é¡¹ï¼ˆå¦‚ç«¯å£å·ã€ä¸»æœºåç§°ç­‰ï¼‰æ¥é…ç½®è¿™ä¸ªè¿æ¥ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨è¿æ¥æˆåŠŸå»ºç«‹åæ‰§è¡Œã€‚</p><h3 id="å‚æ•°è§£é‡Š-6" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-6"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><strong>options</strong>: ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†è¿æ¥çš„è¯¦ç»†é€‰é¡¹ã€‚æœ€å¸¸è§çš„é€‰é¡¹åŒ…æ‹¬ï¼š <ul><li><code>port</code>ï¼ˆå¿…é¡»ï¼‰: è¦è¿æ¥çš„è¿œç¨‹æœåŠ¡å™¨çš„ç«¯å£å·ã€‚</li><li><code>host</code>: è¦è¿æ¥çš„è¿œç¨‹æœåŠ¡å™¨çš„åŸŸåæˆ–è€… IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œé»˜è®¤æ˜¯ <code>&#39;localhost&#39;</code>ã€‚</li><li>å…¶ä»–é«˜çº§é€‰é¡¹ï¼Œæ¯”å¦‚ <code>family</code> ï¼ˆIP åè®®ç‰ˆæœ¬ï¼‰ï¼Œ<code>localAddress</code> å’Œ <code>localPort</code> ï¼ˆæœ¬åœ°åœ°å€å’Œç«¯å£ï¼‰ï¼Œç­‰ç­‰ã€‚</li></ul></li><li><strong>connectListener</strong>: å½“è¿æ¥æˆåŠŸå»ºç«‹æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚è¿™æ˜¯å¯é€‰çš„ã€‚</li></ul><h3 id="åŸºæœ¬ç”¨æ³•-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•-1"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>net.createConnection</code> åˆ›å»ºåˆ°æŸä¸ªæœåŠ¡å™¨çš„è¿æ¥å¹¶å‘é€æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªåˆ°ç«¯å£ 80 çš„è¿æ¥ï¼Œç›®æ ‡æœåŠ¡å™¨æ˜¯ example.com</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿æ¥å»ºç«‹åçš„å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">GET / HTTP/1.1</span><span style="color:#EBCB8B;">\r\n</span><span style="color:#A3BE8C;">Host: example.com</span><span style="color:#EBCB8B;">\r\n\r\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ä»æœåŠ¡å™¨æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å®Œæˆæ¥æ”¶æ•°æ®åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Disconnected from server</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨åœºæ™¯-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-4"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨åº”ç”¨</strong>ï¼šæœ€ç›´æ¥çš„ç”¨é€”æ˜¯åœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ä¸­ã€‚æ¯”å¦‚ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¸è¿œç¨‹ API æœåŠ¡å™¨äº¤äº’çš„åº”ç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>net.createConnection</code> æ¥å»ºç«‹åˆ°è¯¥æœåŠ¡å™¨çš„è¿æ¥å¹¶è¯·æ±‚æ•°æ®ã€‚</p></li><li><p><strong>èŠå¤©åº”ç”¨</strong>ï¼šä½ å¯ä»¥ä½¿ç”¨ Node.js æ„å»ºä¸€ä¸ªç®€å•çš„èŠå¤©æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¹‹é—´é€šè¿‡ TCP è¿æ¥äº¤æ¢æ¶ˆæ¯ã€‚</p></li><li><p><strong>å‘½ä»¤è¡Œå·¥å…·</strong>ï¼šå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¸å…¶å®ƒæœåŠ¡å™¨ï¼ˆå¦‚æ•°æ®åº“æœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨ç­‰ï¼‰è¿›è¡Œé€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé‚£ä¹ˆ <code>net.createConnection</code> å¯ä»¥å¸®åŠ©ä½ å»ºç«‹å¿…è¦çš„è¿æ¥ã€‚</p></li><li><p><strong>ç‰©è”ç½‘ï¼ˆIoTï¼‰</strong>ï¼šåœ¨ç‰©è”ç½‘é¢†åŸŸï¼Œä½ å¯èƒ½éœ€è¦å¼€å‘è®¾å¤‡ä¹‹é—´æˆ–è®¾å¤‡ä¸æœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„åŠŸèƒ½ã€‚åˆ©ç”¨ Node.js çš„ <code>net</code> æ¨¡å—å¯ä»¥è½»æ¾å®ç°è¿™ä¸€ç‚¹ã€‚</p></li></ol><p>é€šè¿‡ä»¥ä¸Šçš„ä»‹ç»å’Œç¤ºä¾‹ï¼Œä½ åº”è¯¥å¯¹ <code>net.createConnection</code> æœ‰äº†åˆæ­¥çš„äº†è§£ã€‚å®ƒæ˜¯ Node.js ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥è®©ä½ çš„åº”ç”¨ä¸ä¸–ç•Œä¸Šçš„ä»»ä½•æœåŠ¡å™¨è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p><h3 id="net-createconnection-path-connectlistener" tabindex="-1"><a class="header-anchor" href="#net-createconnection-path-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#netcreateconnectionpath-connectlistener" target="_blank" rel="noopener noreferrer">net.createConnection(path[, connectListener])</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>net.createConnection(path[, connectListener])</code>æ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å±äº<code>net</code>æ¨¡å—ï¼Œä¸€ä¸ªç”¨äºå„ç§ç½‘ç»œæ“ä½œçš„æ¨¡å—ã€‚è®©æˆ‘ä»¬é€æ­¥äº†è§£è¿™ä¸ªå‡½æ•°å¦‚ä½•å·¥ä½œä»¥åŠå®ƒçš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="å‡½æ•°è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°è§£é‡Š"><span>å‡½æ•°è§£é‡Š</span></a></h3><ul><li><p><strong>path</strong>: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¿æ¥çš„è·¯å¾„ã€‚åœ¨ Unix ç³»ç»Ÿä¸Šï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œç”¨äº UNIX åŸŸå¥—æ¥å­—ï¼ˆIPCï¼‰é€šä¿¡ã€‚åœ¨ Windows ç³»ç»Ÿä¸Šï¼Œä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„å‘½åç®¡é“è·¯å¾„ã€‚</p></li><li><p><strong>connectListener</strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå½“è¿æ¥æˆåŠŸå»ºç«‹æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°ç›¸å½“äºç›‘å¬å™¨ï¼Œä¸“é—¨ç”¨äºå¤„ç†&quot;connect&quot;äº‹ä»¶ã€‚</p></li></ul><h3 id="åŸºæœ¬ç”¨æ³•-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•-2"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºåˆ°æŒ‡å®šè·¯å¾„çš„è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/tmp/echo.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å·²å»ºç«‹</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥å·²å…³é—­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå‡å®šæœ‰ä¸€ä¸ªä½äº<code>/tmp/echo.sock</code>çš„ UNIX åŸŸå¥—æ¥å­—æœåŠ¡å™¨æ­£åœ¨è¿è¡Œã€‚æˆ‘ä»¬é€šè¿‡<code>net.createConnection</code>åˆ›å»ºäº†ä¸€ä¸ªåˆ°è¯¥æœåŠ¡å™¨çš„è¿æ¥ï¼Œå¹¶æ³¨å†Œäº†å‡ ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼š</p><ul><li>å½“è¿æ¥æˆåŠŸå»ºç«‹åï¼Œæ§åˆ¶å°ä¼šæ‰“å°å‡º&quot;è¿æ¥å·²å»ºç«‹&quot;ï¼Œå¹¶å‘æœåŠ¡å™¨å‘é€ä¸€æ¡æ¶ˆæ¯&quot;ä½ å¥½ï¼&quot;ã€‚</li><li>å½“å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ—¶ï¼Œå®ƒä¼šå°†æ•°æ®æ‰“å°åˆ°æ§åˆ¶å°ï¼Œå¹¶éšåå…³é—­è¿æ¥ã€‚</li><li>å½“è¿æ¥å…³é—­æ—¶ï¼Œä¼šè¾“å‡º&quot;è¿æ¥å·²å…³é—­&quot;åˆ°æ§åˆ¶å°ã€‚</li></ul><h3 id="å®é™…åº”ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨æ¡ˆä¾‹"><span>å®é™…åº”ç”¨æ¡ˆä¾‹</span></a></h3><ol><li><p><strong>è¿›ç¨‹é—´é€šè®¯(IPC)</strong>: å¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å¤šä¸ªè¿›ç¨‹å…±åŒå·¥ä½œçš„ Node.js åº”ç”¨ï¼Œæ¯”å¦‚ä¸»è¿›ç¨‹éœ€è¦ä¸å­è¿›ç¨‹é€šä¿¡ï¼Œä½ å¯ä»¥é€šè¿‡ UNIX åŸŸå¥—æ¥å­—ï¼ˆåœ¨ Unix/Linux ç³»ç»Ÿï¼‰æˆ–å‘½åç®¡é“ï¼ˆåœ¨ Windows ç³»ç»Ÿï¼‰æ¥å®ç°è¿›ç¨‹é—´çš„é€šä¿¡ã€‚ä½¿ç”¨<code>net.createConnection</code>å°±å¯ä»¥åœ¨è¿™äº›è¿›ç¨‹ä¹‹é—´å»ºç«‹è¿æ¥ã€‚</p></li><li><p><strong>å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡é€šä¿¡</strong>: åœ¨åŸºäºå¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¸åŒçš„æœåŠ¡å¯èƒ½éœ€è¦åœ¨åŒä¸€å°æœºå™¨ä¸Šé€šä¿¡ã€‚ä½¿ç”¨ UNIX åŸŸå¥—æ¥å­—ï¼Œä½ å¯ä»¥åˆ›å»ºé«˜æ•ˆçš„ã€ä½å¼€é”€çš„æœåŠ¡é—´é€šä¿¡æœºåˆ¶ã€‚</p></li><li><p><strong>ç½‘ç»œä»£ç†</strong>: æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç½‘ç»œä»£ç†æœåŠ¡å™¨ï¼Œæ¯”å¦‚ç”¨äºè°ƒè¯•æˆ–åˆ†æç½‘ç»œè¯·æ±‚å’Œå“åº”ã€‚é€šè¿‡<code>net.createConnection</code>ï¼Œä½ å¯ä»¥è½»æ¾åœ°å»ºç«‹ä¸ç›®æ ‡æœåŠ¡å™¨çš„è¿æ¥ï¼Œè¿›è€Œè¯»å–æˆ–ä¿®æ”¹ç»è¿‡çš„æ•°æ®ã€‚</p></li></ol><p>è¿™ä¸ªå‡½æ•°åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠåº•å±‚ç½‘ç»œé€šä¿¡æˆ–è€…è¦æ±‚é«˜æ€§èƒ½ IPC é€šä¿¡çš„åœºæ™¯ä¸­ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p><h3 id="net-createconnection-port-host-connectlistener" tabindex="-1"><a class="header-anchor" href="#net-createconnection-port-host-connectlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#netcreateconnectionport-host-connectlistener" target="_blank" rel="noopener noreferrer">net.createConnection(port[, host][, connectListener])</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ° Node.js ä¸­çš„<code>net.createConnection(port[, host][, connectListener])</code>ï¼Œæˆ‘ä»¬åœ¨è®¨è®ºçš„æ˜¯ Node.js çš„ç½‘ç»œï¼ˆ<code>net</code>ï¼‰æ¨¡å—ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ TCP æˆ– IPC è¿æ¥çš„æ–¹æ³•ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯ç¼–å†™ç½‘ç»œåº”ç”¨ç¨‹åºæ—¶ç»å¸¸ç”¨åˆ°çš„ã€‚Node.js åœ¨å¤„ç†ç½‘ç»œæ“ä½œæ–¹é¢éå¸¸å¼ºå¤§ï¼Œæ¯”å¦‚ä½ å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ç½‘ç»œé€šä¿¡åº”ç”¨ã€‚</p><h3 id="å‚æ•°è§£é‡Š-7" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-7"><span>å‚æ•°è§£é‡Š</span></a></h3><p>è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><code>port</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„ç«¯å£å·ã€‚å¦‚æœä½ æƒ³ä¸æŸä¸ªæœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå°±éœ€è¦çŸ¥é“è¯¥æœåŠ¡ç›‘å¬çš„ç«¯å£å·ã€‚</li><li><code>host</code>ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šæœåŠ¡å™¨çš„ä¸»æœºåæˆ– IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œä¼šé»˜è®¤ä¸º<code>localhost</code>ã€‚</li><li><code>connectListener</code>ï¼ˆå¯é€‰ï¼‰ï¼šå½“è¿æ¥æˆåŠŸå»ºç«‹æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-18"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-å®¢æˆ·ç«¯"><span>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP å®¢æˆ·ç«¯</span></a></h4><p>å‡è®¾ä½ æƒ³æ„å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¥ä¸è¿è¡Œåœ¨æœ¬åœ°è®¡ç®—æœºçš„ TCP æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚è¯¥æœåŠ¡å™¨ç›‘å¬ç«¯å£ 12345 ä¸Šçš„è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯è¿æ¥åˆ°ç«¯å£12345ä¸Šçš„æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“è¿æ¥å»ºç«‹æ—¶ï¼Œè¾“å‡º&quot;Connected to server!&quot;ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç„¶åå®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯ç»™æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from client!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“ä»æœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œæ‰“å°å‡ºæ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å®Œæˆäº¤äº’åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“è¿æ¥å…³é—­æ—¶ï¼Œæ‰“å°ä¸€æ¡ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Disconnected from server</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP å®¢æˆ·ç«¯ï¼Œå®ƒè¿æ¥åˆ°æœ¬åœ°è®¡ç®—æœºçš„ 12345 ç«¯å£ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€æ¡æ¶ˆæ¯&quot;Hello from client!&quot;ã€‚ä¹‹åï¼Œå®ƒä¼šç›‘å¬ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„ä»»ä½•æ•°æ®ï¼Œå¹¶åœ¨å®Œæˆé€šä¿¡åå…³é—­è¿æ¥ã€‚</p><h4 id="_2-é€šè¿‡æŒ‡å®šä¸»æœºè¿æ¥è¿œç¨‹æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_2-é€šè¿‡æŒ‡å®šä¸»æœºè¿æ¥è¿œç¨‹æœåŠ¡å™¨"><span>2. é€šè¿‡æŒ‡å®šä¸»æœºè¿æ¥è¿œç¨‹æœåŠ¡å™¨</span></a></h4><p>å¦‚æœæœåŠ¡å™¨ä¸åœ¨æœ¬åœ°è¿è¡Œï¼Œä½ éœ€è¦æŒ‡å®šå…¶ IP åœ°å€æˆ–ä¸»æœºåã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> host</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">  ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to remote server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from client to remote server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°è¯•è¿æ¥åˆ°<code>example.com</code>ä¸Šçš„ 12345 ç«¯å£ã€‚å…¶ä»–è¡Œä¸ºä¸å‰è¿°æœ¬åœ°ç¤ºä¾‹ç›¸ä¼¼ã€‚</p><h3 id="å°ç»“-12" tabindex="-1"><a class="header-anchor" href="#å°ç»“-12"><span>å°ç»“</span></a></h3><p>é€šè¿‡<code>net.createConnection()</code>æ–¹æ³•ï¼ŒNode.js å…è®¸ä½ åˆ›å»ºå®¢æˆ·ç«¯ä¸ TCP/IP æœåŠ¡å™¨çš„è¿æ¥ï¼Œæ— è®ºæ˜¯å±€åŸŸç½‘å†…çš„è¿˜æ˜¯äº’è”ç½‘ä¸Šçš„ã€‚è¿™å¯¹äºå¼€å‘éœ€è¦ç½‘ç»œé€šä¿¡çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚èŠå¤©åº”ç”¨ã€æ–‡ä»¶ä¼ è¾“å·¥å…·æˆ–ä»»ä½•éœ€è¦å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„çš„åº”ç”¨ã€‚</p><h2 id="net-createserver-options-connectionlistener" tabindex="-1"><a class="header-anchor" href="#net-createserver-options-connectionlistener"><span><a href="https://nodejs.org/docs/latest/api/net.html#netcreateserveroptions-connectionlistener" target="_blank" rel="noopener noreferrer">net.createServer([options][, connectionListener])</a></span></a></h2><p>Node.js çš„ <code>net.createServer([options][, connectionListener])</code> æ–¹æ³•æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ TCP æˆ– IPC æœåŠ¡å™¨çš„ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸ä½ çš„ Node.js åº”ç”¨ç¨‹åºèƒ½å¤Ÿå¤„ç†ç½‘ç»œé€šä¿¡ï¼Œæ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚ç°åœ¨ï¼Œæˆ‘ä¼šç®€å•è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼Œç„¶åç»™ä½ å‡ ä¸ªå®é™…çš„åº”ç”¨ç¤ºä¾‹ã€‚</p><h3 id="åŸºæœ¬è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è§£é‡Š"><span>åŸºæœ¬è§£é‡Š</span></a></h3><ul><li><strong>options</strong>: è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºè‡ªå®šä¹‰æœåŠ¡å™¨çš„è¡Œä¸ºã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥è®¾ç½® <code>allowHalfOpen</code>ï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼ŒæœåŠ¡å™¨å°†ä¸ä¼šè‡ªåŠ¨å‘é€ FIN åŒ…ç»“æŸè¿æ¥ï¼Œè¿™åœ¨æŸäº›ç‰¹å®šçš„åº”ç”¨åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚</li><li><strong>connectionListener</strong>: å½“æ–°çš„è¿æ¥å»ºç«‹æ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè¢«è‡ªåŠ¨æ·»åŠ ä¸º &#39;connection&#39; äº‹ä»¶çš„ç›‘å¬å™¨ã€‚</li></ul><p>åˆ›å»ºæœåŠ¡å™¨ä¹‹åï¼Œå®ƒä¼šç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚æ¯å½“æœ‰æ–°çš„è¿æ¥è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šè§¦å‘ &#39;connection&#39; äº‹ä»¶ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šçš„ <code>connectionListener</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ª <code>net.Socket</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡ä½ å¯ä»¥ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚</p><h3 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„-tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„-tcp-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1: åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ TCP æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¥æ”¶åˆ°æ•°æ®:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿å…‰ä¸´æˆ‘çš„æœåŠ¡å™¨ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ç«¯å£ 8080 ä¸Šçš„è¿æ¥è¯·æ±‚ã€‚å½“ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬å‘é€ä¸€æ¡æ¬¢è¿æ¶ˆæ¯ç»™è¿™ä¸ªå®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ‰“å°å‡ºä»»ä½•ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨-options-åˆ›å»ºæœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨-options-åˆ›å»ºæœåŠ¡å™¨"><span>ç¤ºä¾‹ 2: ä½¿ç”¨ options åˆ›å»ºæœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  allowHalfOpen</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†è¿æ¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>options</code> å¯¹è±¡è®¾ç½®äº† <code>allowHalfOpen</code> ä¸º <code>true</code>ï¼Œè¿™æ„å‘³ç€è¿æ¥åœ¨å¦ä¸€ç«¯å‘é€ FIN åŒ…æ—¶ä¸ä¼šç«‹å³ç»“æŸï¼Œé™¤éæˆ‘ä»¬æ‰‹åŠ¨ç»“æŸå®ƒã€‚è¿™åœ¨éœ€è¦æ§åˆ¶è¿æ¥ç»“æŸæ–¹å¼çš„åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹å‡º <code>net.createServer</code> æ–¹æ³•åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å¤„ç†ç½‘ç»œé€šä¿¡æ–¹é¢çš„å¼ºå¤§èƒ½åŠ›ã€‚æ— è®ºæ˜¯å»ºç«‹åŸºæœ¬çš„ TCP é€šä¿¡æœåŠ¡å™¨ï¼Œè¿˜æ˜¯éœ€è¦æ›´ç»†ç²’åº¦æ§åˆ¶çš„å¤æ‚ç½‘ç»œåº”ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•éƒ½æ˜¯æ„å»ºè¿™ç±»åŠŸèƒ½ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚</p><h2 id="net-getdefaultautoselectfamily" tabindex="-1"><a class="header-anchor" href="#net-getdefaultautoselectfamily"><span><a href="https://nodejs.org/docs/latest/api/net.html#netgetdefaultautoselectfamily" target="_blank" rel="noopener noreferrer">net.getDefaultAutoSelectFamily()</a></span></a></h2><p><code>net.getDefaultAutoSelectFamily()</code> æ˜¯ Node.js ç½‘ç»œ (<code>net</code>) æ¨¡å—ä¸­ä¸€ä¸ªè¾ƒä¸ºç‰¹æ®Šçš„å‡½æ•°ã€‚è¦ç†è§£è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ˜ç™½ IP åœ°å€æ—ï¼ˆIPv4 å’Œ IPv6ï¼‰çš„æ¦‚å¿µã€‚</p><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼ŒIP åœ°å€æ˜¯ç”¨æ¥æ ‡è¯†ç½‘ç»œä¸Šçš„æ¯ä¸€å°è®¾å¤‡çš„å”¯ä¸€å·ç ã€‚æœ‰ä¸¤ç§ä¸»è¦çš„ IP ç‰ˆæœ¬ï¼š</p><ul><li>IPv4: ç›®å‰æœ€å¹¿æ³›ä½¿ç”¨çš„ IP ç‰ˆæœ¬ï¼Œæ ¼å¼é€šå¸¸ä¸ºå››ç»„æ•°å­—ï¼Œå¦‚ <code>192.168.1.1</code>ã€‚</li><li>IPv6: æ˜¯æ–°ä¸€ä»£çš„ IP åœ°å€æ ¼å¼ï¼Œç”±äº IPv4 åœ°å€çš„è€—å°½ï¼ŒIPv6 è¢«è®¾è®¡æ¥æ‰©å±•åœ°å€ç©ºé—´ï¼Œæ ¼å¼çœ‹èµ·æ¥åƒ <code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code>ã€‚</li></ul><p>åœ¨ Node.js ä¸­åˆ›å»ºæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°éœ€è¦è§£å†³ä¸»æœºåå¯¹åº”çš„ IP åœ°å€ç±»å‹é—®é¢˜ã€‚å½“ä½ è¯•å›¾è¿æ¥æˆ–ç»‘å®šåˆ°ä¸€ä¸ªä¸»æœºåï¼ˆæ¯”å¦‚ <code>example.com</code>ï¼‰ï¼Œç³»ç»Ÿéœ€è¦å†³å®šæ˜¯ä½¿ç”¨ IPv4 åœ°å€è¿˜æ˜¯ IPv6 åœ°å€ã€‚</p><p><code>net.getDefaultAutoSelectFamily()</code> å‡½æ•°å°±æ˜¯ç”¨æ¥è·å– Node.js é»˜è®¤çš„ IP æ—è‡ªåŠ¨é€‰æ‹©ç­–ç•¥ã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¸éœ€è¦ä¼ é€’ä»»ä½•å‚æ•°ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜ Node.js åœ¨æ²¡æœ‰æŒ‡å®š IP æ—æ—¶é»˜è®¤ä¼šé€‰æ‹© IPv4 è¿˜æ˜¯ IPv6ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼æ˜¯ IPv4ï¼Œå› ä¸ºå®ƒæ›´åŠ æ™®åŠå’Œå…¼å®¹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥æ¼”ç¤ºå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>net.getDefaultAutoSelectFamily()</code>ã€‚</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºï¼Œä½ æƒ³çŸ¥é“ç³»ç»Ÿé»˜è®¤ä¼šé€‰æ‹©å“ªç§ IP åœ°å€æ—æ¥è§£ææœªæŒ‡å®š IP æ—çš„ä¸»æœºåï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è·å–é»˜è®¤çš„IPæ—è‡ªåŠ¨é€‰æ‹©ç­–ç•¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> defaultFamily</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getDefaultAutoSelectFamily</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">é»˜è®¤çš„IPæ—è‡ªåŠ¨é€‰æ‹©ç­–ç•¥æ˜¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">defaultFamily</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œè¿™æ®µä»£ç ï¼Œè¾“å‡ºå°†å‘Šè¯‰ä½ ç³»ç»Ÿé»˜è®¤ä½¿ç”¨ IPv4 è¿˜æ˜¯ IPv6ã€‚</p><p>è®°ä½ï¼Œ<code>net.getDefaultAutoSelectFamily()</code> ä¸»è¦æ˜¯ç”¨äºè¯Šæ–­å’Œäº†è§£ Node.js åº”ç”¨ç¨‹åºåœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶çš„å†…éƒ¨è¡Œä¸ºï¼Œå¹¶ä¸æ˜¯ç”¨æ¥æ§åˆ¶æˆ–æ”¹å˜è¿™ç§è¡Œä¸ºçš„ã€‚å¦‚æœä½ éœ€è¦æŒ‡å®šä½¿ç”¨ç‰¹å®šçš„ IP ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨åˆ›å»ºæœåŠ¡å™¨æˆ–å‘èµ·ç½‘ç»œè¯·æ±‚æ—¶æ˜ç¡®æŒ‡å®š IP ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œåœ¨ <code>net.createConnection</code> æˆ– <code>http.createServer</code> æ–¹æ³•ä¸­è®¾ç½® <code>family</code> é€‰é¡¹ï¼‰ã€‚</p><h2 id="net-setdefaultautoselectfamily-value" tabindex="-1"><a class="header-anchor" href="#net-setdefaultautoselectfamily-value"><span><a href="https://nodejs.org/docs/latest/api/net.html#netsetdefaultautoselectfamilyvalue" target="_blank" rel="noopener noreferrer">net.setDefaultAutoSelectFamily(value)</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œæœ‰ä¸€ä¸ª <code>net.setDefaultAutoSelectFamily(value)</code> çš„ APIï¼Œè¿™æ˜¯ç½‘ç»œï¼ˆnetï¼‰æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºè®¾ç½®å¦‚ä½•è‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-ip-åœ°å€æ—" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-ip-åœ°å€æ—"><span>ä»€ä¹ˆæ˜¯ IP åœ°å€æ—ï¼Ÿ</span></a></h3><ul><li><strong>IPv4</strong> å’Œ <strong>IPv6</strong> æ˜¯äº’è”ç½‘ä¸Šè®¾å¤‡äº’ç›¸é€šä¿¡æ—¶ä½¿ç”¨çš„ä¸¤ç§ä¸»è¦çš„ IP åœ°å€æ ¼å¼ã€‚IPv4 åœ°å€è¾ƒçŸ­ï¼Œå¦‚ <code>192.168.1.1</code>ï¼Œè€Œ IPv6 åœ°å€è¾ƒé•¿ï¼Œå¦‚ <code>2404:6800:4003:808::200e</code>ã€‚</li><li>ç”±äº IPv4 åœ°å€çš„æ•°é‡æœ‰é™ï¼Œä¸–ç•Œæ­£åœ¨é€æ­¥è¿‡æ¸¡åˆ°æä¾›æ›´å¤šåœ°å€ç©ºé—´çš„ IPv6ã€‚</li></ul><h3 id="net-setdefaultautoselectfamily-value-1" tabindex="-1"><a class="header-anchor" href="#net-setdefaultautoselectfamily-value-1"><span>net.setDefaultAutoSelectFamily(value)</span></a></h3><p>è¿™ä¸ªæ–¹æ³•å…è®¸ä½ è®¾ç½® Node.js åº”ç”¨ç¨‹åºåœ¨è§£æåŸŸåæ—¶åº”è¯¥é¦–é€‰å“ªç§ IP åœ°å€æ—ã€‚è¿™ä¸ªè®¾ç½®å¯¹æ•´ä¸ªè¿›ç¨‹ç”Ÿæ•ˆï¼Œå¹¶å½±å“æ‰€æœ‰çš„ç½‘ç»œè¿æ¥ã€‚</p><ul><li><code>value</code> å‚æ•°å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ï¼š <ul><li><code>4</code>ï¼šå¼ºåˆ¶åªä½¿ç”¨ IPv4 åœ°å€ã€‚</li><li><code>6</code>ï¼šå¼ºåˆ¶åªä½¿ç”¨ IPv6 åœ°å€ã€‚</li><li><code>0</code>ï¼šè‡ªåŠ¨é€‰æ‹©ï¼ˆé»˜è®¤ï¼‰ã€‚Node.js å°†åŸºäºæ“ä½œç³»ç»Ÿçš„æ”¯æŒå’Œç½‘ç»œç¯å¢ƒæ¥è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ IP åœ°å€æ—ã€‚</li></ul></li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-å¼ºåˆ¶ä½¿ç”¨-ipv4" tabindex="-1"><a class="header-anchor" href="#_1-å¼ºåˆ¶ä½¿ç”¨-ipv4"><span>1. å¼ºåˆ¶ä½¿ç”¨ IPv4</span></a></h4><p>å¦‚æœä½ çŸ¥é“ä½ çš„æœåŠ¡å™¨æˆ–æœåŠ¡ä»…æ”¯æŒ IPv4ï¼Œæˆ–è€…ä½ æƒ³ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºåªé€šè¿‡ IPv4 è¿›è¡Œé€šä¿¡ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setDefaultAutoSelectFamily</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">4</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å°†ç¡®ä¿å½“ä½ çš„åº”ç”¨ç¨‹åºå°è¯•è¿æ¥åˆ°ç½‘ç»œä¸Šçš„å…¶ä»–æœåŠ¡æ—¶ï¼Œå³ä½¿ç³»ç»Ÿæ”¯æŒ IPv6ï¼Œå®ƒä¹Ÿä¼šä¼˜å…ˆé€‰æ‹© IPv4 åœ°å€ã€‚</p><h4 id="_2-å¼€å‘é¢å‘æœªæ¥çš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-å¼€å‘é¢å‘æœªæ¥çš„åº”ç”¨"><span>2. å¼€å‘é¢å‘æœªæ¥çš„åº”ç”¨</span></a></h4><p>éšç€è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿå’Œç½‘ç»œå¼€å§‹æ”¯æŒ IPv6ï¼Œä½ å¯èƒ½æƒ³è¦ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¼˜å…ˆä½¿ç”¨ IPv6ï¼ˆå¦‚æœå¯ç”¨ï¼‰ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°ä¸ºæœªæ¥çš„è½¬æ¢åšå‡†å¤‡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setDefaultAutoSelectFamily</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">6</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¼šè®©ä½ çš„åº”ç”¨ç¨‹åºåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä¼˜å…ˆä½¿ç”¨ IPv6 åœ°å€ï¼Œæœ‰åŠ©äºæµ‹è¯•å’Œå‡†å¤‡ IPv6 çš„éƒ¨ç½²ã€‚</p><h4 id="_3-è‡ªåŠ¨é€‰æ‹©-é»˜è®¤è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#_3-è‡ªåŠ¨é€‰æ‹©-é»˜è®¤è¡Œä¸º"><span>3. è‡ªåŠ¨é€‰æ‹©ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰</span></a></h4><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè®© Node.js æ ¹æ®å½“å‰çš„ç½‘ç»œç¯å¢ƒå’Œç³»ç»Ÿæ”¯æŒè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ IP åœ°å€æ—æ˜¯æœ€æ–¹ä¾¿çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ–è€…é€šè¿‡æ˜¾å¼è®¾ç½®ä¸º0æ¥å¯ç”¨è‡ªåŠ¨é€‰æ‹©</span></span>
<span class="line"><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setDefaultAutoSelectFamily</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œç¯å¢ƒä¸­çµæ´»è¿è¡Œï¼Œæ— è®ºæ˜¯ IPv4 è¿˜æ˜¯ IPv6ã€‚</p><p>é€šè¿‡è¿™æ ·çš„è®¾ç½®ï¼ŒNode.js åº”ç”¨ç¨‹åºå¯ä»¥æ›´å¥½åœ°é€‚åº”ä¸åŒçš„ç½‘ç»œç¯å¢ƒï¼Œæé«˜å…¼å®¹æ€§å’Œæœªæ¥çš„å¯æ‰©å±•æ€§ã€‚</p><h2 id="net-getdefaultautoselectfamilyattempttimeout" tabindex="-1"><a class="header-anchor" href="#net-getdefaultautoselectfamilyattempttimeout"><span><a href="https://nodejs.org/docs/latest/api/net.html#netgetdefaultautoselectfamilyattempttimeout" target="_blank" rel="noopener noreferrer">net.getDefaultAutoSelectFamilyAttemptTimeout()</a></span></a></h2><p><code>net.getDefaultAutoSelectFamilyAttemptTimeout()</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥è‡ª Node.js ä¸­çš„ <code>net</code> æ¨¡å—ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è·å–ç³»ç»Ÿåœ¨å°è¯•è¿æ¥ IPv4 æˆ– IPv6 åœ°å€æ—¶ä½¿ç”¨çš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ Node.js çš„ <code>net</code> æ¨¡å—åˆ›å»ºç½‘ç»œè¿æ¥æ—¶ï¼Œå°¤å…¶æ˜¯åœ¨è°ƒç”¨ <code>net.connect()</code> å‡½æ•°æ—¶ï¼ŒNode.js å¯èƒ½ä¼šå°è¯•è¿æ¥åˆ°ä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨çš„ IPv4 æˆ– IPv6 åœ°å€ã€‚æœ‰æ—¶å€™ï¼Œä¸€ä¸ªä¸»æœºå¯èƒ½åŒæ—¶æ‹¥æœ‰ IPv4 å’Œ IPv6 åœ°å€ã€‚Node.js ä¼šæ ¹æ®ç³»ç»Ÿé…ç½®æ¥è‡ªåŠ¨é€‰æ‹©ä½¿ç”¨å“ªä¸€ç§ IP åœ°å€æ—ã€‚å¦‚æœè‡ªåŠ¨é€‰æ‹©çš„è¿‡ç¨‹ä¸­è¿æ¥å°è¯•æœªèƒ½åŠæ—¶æˆåŠŸï¼Œå°±ä¼šå‘ç”Ÿè¶…æ—¶ï¼Œç„¶å Node.js ä¼šå°è¯•å¦å¤–ä¸€ç§ IP åœ°å€æ—ã€‚</p><p><code>getDefaultAutoSelectFamilyAttemptTimeout()</code> å‡½æ•°å°±æ˜¯ç”¨æ¥æŸ¥è¯¢è¿™ä¸ªè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯å•¥æˆ–è€…æ˜¯å½“å‰è®¾ç½®äº†å¤šå°‘ã€‚è¿™ä¸ªå€¼å¯¹äºç½‘ç»œç¼–ç¨‹ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºå®ƒå½±å“ç€ç¨‹åºåœ¨å°è¯•è¿æ¥ç½‘ç»œæœåŠ¡æ—¶çš„è¡¨ç°å’Œç­‰å¾…æ—¶é—´ã€‚</p><p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è·å–å½“å‰é»˜è®¤çš„è‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—å°è¯•è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> timeout</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getDefaultAutoSelectFamilyAttemptTimeout</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å½“å‰çš„é»˜è®¤è‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—å°è¯•è¶…æ—¶æ—¶é—´æ˜¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">timeout</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> æ¯«ç§’</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>net</code> æ¨¡å—ï¼Œç„¶åä½¿ç”¨ <code>getDefaultAutoSelectFamilyAttemptTimeout()</code> å‡½æ•°è·å–å½“å‰è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</p><p>äº†è§£è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ä½ çš„ Node.js ç¨‹åºåœ¨ç½‘ç»œè¿æ¥æ–¹é¢çš„è¡Œä¸ºï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å…·æœ‰ä¸åŒ IP åœ°å€æ—çš„ä¸»æœºæ—¶ã€‚å¦‚æœä½ å‘ç°ä½ çš„ç¨‹åºåœ¨å°è¯•è¿æ¥æŸäº›æœåŠ¡æ—¶ç»å¸¸è¶…æ—¶å¤±è´¥ï¼Œäº†è§£è¿™ä¸ªè¶…æ—¶è®¾ç½®å¯èƒ½ä¼šå¸®åŠ©ä½ æ‰¾åˆ°é—®é¢˜çš„åŸå› ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è°ƒä¼˜ã€‚</p><h2 id="net-setdefaultautoselectfamilyattempttimeout-value" tabindex="-1"><a class="header-anchor" href="#net-setdefaultautoselectfamilyattempttimeout-value"><span><a href="https://nodejs.org/docs/latest/api/net.html#netsetdefaultautoselectfamilyattempttimeoutvalue" target="_blank" rel="noopener noreferrer">net.setDefaultAutoSelectFamilyAttemptTimeout(value)</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå¸¸ç”¨äºå¼€å‘ç½‘ç»œåº”ç”¨ï¼Œå¦‚ç½‘ç«™åå°æœåŠ¡æˆ– API æ¥å£ã€‚åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®äº¤æ¢éœ€è¦é€šè¿‡ IP åœ°å€æ¥å®šä½å¯¹æ–¹ã€‚ç›®å‰ï¼Œæœ‰ä¸¤ç§ä¸»è¦çš„ IP åœ°å€æ ¼å¼ï¼šIPv4 å’Œ IPv6ã€‚</p><p>IPv4 æ˜¯è¾ƒæ—§çš„ç³»ç»Ÿï¼Œåœ°å€ç©ºé—´è¾ƒå°ï¼Œç±»ä¼¼äº<code>192.168.0.1</code>ã€‚è€Œ IPv6 æ˜¯ä¸ºäº†åº”å¯¹ IPv4 åœ°å€è€—å°½é—®é¢˜è€Œç”Ÿï¼Œæä¾›äº†æ›´å¤§çš„åœ°å€ç©ºé—´ï¼Œå…¶åœ°å€çœ‹èµ·æ¥åƒè¿™æ ·ï¼š<code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code>ã€‚</p><p>å½“ä½ çš„åº”ç”¨å°è¯•è¿æ¥åˆ°æŸä¸ªæœåŠ¡å™¨æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨éœ€è¦å†³å®šä½¿ç”¨å“ªä¸€ç§åè®®ç‰ˆæœ¬è¿›è¡Œè¿æ¥ã€‚è¿™å°±å¼•å‡ºäº†<code>net.setDefaultAutoSelectFamilyAttemptTimeout(value)</code>å‡½æ•°çš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="net-setdefaultautoselectfamilyattempttimeout-value-1" tabindex="-1"><a class="header-anchor" href="#net-setdefaultautoselectfamilyattempttimeout-value-1"><span><code>net.setDefaultAutoSelectFamilyAttemptTimeout(value)</code></span></a></h3><p>è¿™ä¸ªå‡½æ•°æ˜¯ Node.js v21.7.1 ç‰ˆæœ¬çš„ä¸€ä¸ªæ–°å¢åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼ˆ<code>value</code>ï¼‰ï¼Œç”¨äºè‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰æ—¶çš„å°è¯•æ“ä½œã€‚è¿™ä¸ªè®¾ç½®æ˜¯å…¨å±€çš„ï¼Œä¼šå½±å“æ‰€æœ‰ä¹‹ååˆ›å»ºçš„ socketã€‚å…¶ç›®çš„æ˜¯ä¼˜åŒ–è¿æ¥è¿‡ç¨‹ï¼Œé™ä½å› ä¸ºå°è¯•è¿æ¥åˆ°ä¸é€‚åˆçš„ IP åœ°å€æ—è€Œäº§ç”Ÿçš„å»¶è¿Ÿã€‚</p><h4 id="å‚æ•°è§£é‡Š-8" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-8"><span>å‚æ•°è§£é‡Šï¼š</span></a></h4><ul><li><code>value</code>ï¼šæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’(ms)ã€‚å½“å°è¯•è‡ªåŠ¨é€‰æ‹© IP åœ°å€æ—æ—¶ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰æˆåŠŸç¡®å®šä½¿ç”¨ IPv4 è¿˜æ˜¯ IPv6ï¼Œç³»ç»Ÿå°†æ ¹æ®å½“å‰çš„ç½‘ç»œç¯å¢ƒå’Œå¯ç”¨æ€§è‡ªåŠ¨åšå‡ºé€‰æ‹©ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ä¾‹å­-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-19"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦è¿æ¥åˆ°å¤šä¸ªå¤–éƒ¨æœåŠ¡ï¼Œå…¶ä¸­ä¸€äº›æœåŠ¡ä»…æ”¯æŒ IPv4ï¼Œå…¶ä»–çš„åˆ™åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6ã€‚</p><p><strong>æœªè®¾ç½®è¶…æ—¶çš„é»˜è®¤è¡Œä¸º</strong>ï¼š<br> å¦‚æœæœªæ˜¾å¼è®¾ç½®è¶…æ—¶ï¼ŒNode.js å¯èƒ½ä¼šé¦–å…ˆå°è¯• IPv6ï¼ˆå¦‚æœæœ¬åœ°ç½‘ç»œæ”¯æŒï¼‰ï¼Œå¦‚æœå¤±è´¥äº†å†å›é€€åˆ° IPv4ã€‚è¿™ä¸ªè¿‡ç¨‹è™½ç„¶æœ€ç»ˆèƒ½æ‰¾åˆ°æ­£ç¡®çš„åœ°å€ï¼Œä½†å¯èƒ½ä¼šå¢åŠ æ¯æ¬¡è¿æ¥çš„åˆå§‹åŒ–æ—¶é—´ã€‚</p><p><strong>è®¾ç½®äº†è¶…æ—¶çš„è¡Œä¸º</strong>ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setDefaultAutoSelectFamilyAttemptTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬è®¾ç½®äº† 100ms ä½œä¸ºå°è¯•ç¡®å®š IP åœ°å€æ—çš„è¶…æ—¶æ—¶é—´ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨ 100ms å†…æ— æ³•ç¡®è®¤ä½¿ç”¨ IPv4 è¿˜æ˜¯ IPv6ï¼ŒNode.js å°†åŸºäºå½“å‰ç½‘ç»œç¯å¢ƒå’Œå¯è¾¾æ€§è‡ªåŠ¨åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ï¼Œä»è€Œå‡å°‘ç­‰å¾…æ—¶é—´ï¼Œæé«˜åº”ç”¨çš„å“åº”é€Ÿåº¦ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½ç‰¹åˆ«æœ‰åŠ©äºé‚£äº›éœ€è¦ä¸å¤šä¸ªä¸åŒç½‘ç»œé…ç½®çš„æœåŠ¡è¿›è¡Œäº¤äº’çš„åº”ç”¨ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å› ä¸º IP ç‰ˆæœ¬å°è¯•å¯¼è‡´çš„å»¶è¿Ÿã€‚</p><h2 id="net-isip-input" tabindex="-1"><a class="header-anchor" href="#net-isip-input"><span><a href="https://nodejs.org/docs/latest/api/net.html#netisipinput" target="_blank" rel="noopener noreferrer">net.isIP(input)</a></span></a></h2><p>å½“ç„¶ï¼Œå¾ˆé«˜å…´å¸®ä½ è§£é‡Š Node.js ä¸­çš„ <code>net.isIP(input)</code> è¿™ä¸ªå‡½æ•°ã€‚</p><p><code>net.isIP(input)</code> æ˜¯ Node.js ä¸­ <code>net</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”¨æ¥æ£€æµ‹ç»™å®šçš„å­—ç¬¦ä¸² <code>input</code> æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IP åœ°å€ï¼Œå¦‚æœæ˜¯ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºè¿™ä¸ª IP åœ°å€æ˜¯ IPv4 æ ¼å¼è¿˜æ˜¯ IPv6 æ ¼å¼ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå®ƒçš„è¿”å›å€¼ä¼šæœ‰ä¸‰ç§å¯èƒ½ï¼š</p><ol><li>å¦‚æœ <code>input</code> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv4 åœ°å€ï¼Œå®ƒå°†è¿”å› <code>4</code>ã€‚</li><li>å¦‚æœ <code>input</code> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv6 åœ°å€ï¼Œå®ƒå°†è¿”å› <code>6</code>ã€‚</li><li>å¦‚æœ <code>input</code> ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IP åœ°å€ï¼Œå®ƒå°†è¿”å› <code>0</code>ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>ä¾‹å­ 1: æ£€æŸ¥ä¸€ä¸ªæœ‰æ•ˆçš„ IPv4 åœ°å€</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸ª IPv4 åœ°å€å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ipV4</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ net.isIP æ¥æ£€æŸ¥è¿™ä¸ªåœ°å€</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIP</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">ipV4</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºåº”è¯¥æ˜¯ 4ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv4 åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å­ 2: æ£€æŸ¥ä¸€ä¸ªæœ‰æ•ˆçš„ IPv6 åœ°å€</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸ª IPv6 åœ°å€å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ipV6</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2001:0db8:85a3:0000:0000:8a2e:0370:7334</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ net.isIP æ¥æ£€æŸ¥è¿™ä¸ªåœ°å€</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIP</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">ipV6</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºåº”è¯¥æ˜¯ 6ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv6 åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å­ 3: æ£€æŸ¥ä¸€ä¸ªæ— æ•ˆçš„ IP åœ°å€</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸ªé”™è¯¯çš„ IP åœ°å€å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> invalidIP</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">abc.def.gha.bcd</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ net.isIP æ¥æ£€æŸ¥è¿™ä¸ªåœ°å€</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIP</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">invalidIP</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºåº”è¯¥æ˜¯ 0ï¼Œå› ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IP åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ª <code>net.isIP</code> æ–¹æ³•éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“ä½ åœ¨ç¼–å†™éœ€è¦å¤„ç†ç½‘ç»œè¯·æ±‚å’Œé€šä¿¡çš„ç¨‹åºæ—¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ç¨‹åºåªæ”¯æŒ IPv4 åœ°å€ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç¡®ä¿ç”¨æˆ·è¾“å…¥äº†æ­£ç¡®æ ¼å¼çš„åœ°å€ã€‚æˆ–è€…ï¼Œå¦‚æœä½ åœ¨åšæ—¥å¿—åˆ†æï¼Œæƒ³è¦è¿‡æ»¤å‡ºæ‰€æœ‰çš„ IP åœ°å€ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿèƒ½å¸®åˆ°ä½ ã€‚ç®€å•æ¥è¯´ï¼Œ<code>net.isIP</code> å°±æ˜¯ä¸€ä¸ªéªŒè¯ IP åœ°å€æ˜¯å¦æœ‰æ•ˆåŠå…¶ç±»å‹çš„å¿«æ·æ‰‹æ®µã€‚</p><h2 id="net-isipv4-input" tabindex="-1"><a class="header-anchor" href="#net-isipv4-input"><span><a href="https://nodejs.org/docs/latest/api/net.html#netisipv4input" target="_blank" rel="noopener noreferrer">net.isIPv4(input)</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œ<code>net</code> æ¨¡å—æä¾›äº†ä¸€ç»„ç”¨äºç½‘ç»œæ“ä½œçš„å‡½æ•°ï¼Œæ¯”å¦‚åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç­‰ã€‚<code>net.isIPv4(input)</code> æ˜¯ <code>net</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­ç»™å®šçš„è¾“å…¥ï¼ˆ<code>input</code>ï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv4 åœ°å€ã€‚</p><p>IPv4 åœ°å€æ˜¯äº’è”ç½‘åè®®ï¼ˆIPï¼‰çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œç”±å››ç»„æ•°å­—ç»„æˆï¼Œæ¯ç»„æ•°å­—èŒƒå›´æ˜¯ 0-255ï¼Œç»„ä¹‹é—´ç”¨ç‚¹ï¼ˆ<code>.</code>ï¼‰åˆ†éš”ã€‚ä¾‹å¦‚ï¼Œ<code>192.168.1.1</code> å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ IPv4 åœ°å€ã€‚</p><p><strong>ä½¿ç”¨ <code>net.isIPv4(input)</code> çš„ä¾‹å­ï¼š</strong></p><ol><li><strong>åŸºæœ¬ç”¨æ³•</strong> - åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ IPv4 åœ°å€ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIPv4</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼štrue</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIPv4</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">255.255.255.255</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼štrue</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIPv4</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">999.999.999.999</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼šfalse</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIPv4</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">::1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼šfalseï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª IPv6 åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>åœ¨ç½‘ç»œåº”ç”¨ä¸­çš„åº”ç”¨</strong> - å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œéœ€è¦éªŒè¯ç”¨æˆ·è¾“å…¥çš„ IP åœ°å€æ˜¯å¦æœ‰æ•ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>net.isIPv4</code> æ–¹æ³•æ¥ç¡®ä¿ç”¨æˆ·è¾“å…¥äº†æœ‰æ•ˆçš„ IPv4 åœ°å€ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> isValidIPv4Address</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">input</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIPv4</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">input</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ç”¨æˆ·è¾“å…¥çš„ IP åœ°å€</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> userInput</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#88C0D0;">isValidIPv4Address</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">userInput</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœ‰æ•ˆçš„ IPv4 åœ°å€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ— æ•ˆçš„ IPv4 åœ°å€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–¹æ³•åœ¨ç½‘ç»œç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦åŒºåˆ† IPv4 å’Œ IPv6 åœ°å€ã€æˆ–è€…éªŒè¯ç½‘ç»œé…ç½®æ—¶ã€‚ç®€å•æ¥è¯´ï¼Œ<code>net.isIPv4</code> ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¿«é€Ÿã€ç®€ä¾¿çš„æ–¹å¼æ¥ç¡®è®¤ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆ IPv4 åœ°å€çš„æ ‡å‡†æ ¼å¼ã€‚</p><h2 id="net-isipv6-input" tabindex="-1"><a class="header-anchor" href="#net-isipv6-input"><span><a href="https://nodejs.org/docs/latest/api/net.html#netisipv6input" target="_blank" rel="noopener noreferrer">net.isIPv6(input)</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯çš„è½¯ä»¶ã€‚å®ƒå…·æœ‰éé˜»å¡ I/Oï¼ˆè¾“å…¥/è¾“å‡ºï¼‰å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§ï¼Œä½¿å¾— Node.js éå¸¸é€‚åˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œä¾‹å¦‚ç½‘ç«™åç«¯æœåŠ¡ã€‚</p><p>åœ¨ Node.js çš„ <code>net</code> æ¨¡å—ä¸­ï¼Œæœ‰å¾ˆå¤šç”¨äºç½‘ç»œæ“ä½œçš„åŠŸèƒ½ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æ£€æŸ¥ä¸€ä¸ªç»™å®šçš„å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ IPv6 åœ°å€çš„æ–¹æ³•ï¼š<code>net.isIPv6(input)</code>ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-ipv6-åœ°å€" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-ipv6-åœ°å€"><span>ä»€ä¹ˆæ˜¯ IPv6 åœ°å€ï¼Ÿ</span></a></h3><p>åœ¨è§£é‡Š <code>net.isIPv6(input)</code> æ–¹æ³•ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ IPv6 åœ°å€ã€‚IPv6 åœ°å€æ˜¯äº’è”ç½‘åè®®ç‰ˆæœ¬ 6 (Internet Protocol version 6, ç®€ç§° IPv6) çš„åœ°å€æ ¼å¼ï¼Œè¢«è®¾è®¡æ¥å–ä»£ IPv4ã€‚ç”±äº IPv4 åœ°å€çš„æ•°é‡é€æ¸è€—å°½ï¼ŒIPv6 åº”è¿è€Œç”Ÿï¼Œæä¾›äº†æ›´å¤šçš„åœ°å€ç©ºé—´ã€‚IPv6 åœ°å€ç”± 128 ä½ç»„æˆï¼Œé€šå¸¸è¡¨ç¤ºä¸º 8 ç»„æ¯ç»„ 4 ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œç»„ä¹‹é—´ç”¨å†’å·åˆ†éš”ï¼Œä¾‹å¦‚ <code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code>ã€‚</p><h3 id="net-isipv6-input-1" tabindex="-1"><a class="header-anchor" href="#net-isipv6-input-1"><span>net.isIPv6(input)</span></a></h3><p><code>net.isIPv6(input)</code> æ–¹æ³•ç”¨äºæ£€æŸ¥ç»™å®šçš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv6 åœ°å€ã€‚å¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv6 åœ°å€ï¼Œè¯¥æ–¹æ³•è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</p><h4 id="å‚æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-1"><span>å‚æ•°</span></a></h4><ul><li><code>input</code>ï¼šè¦æ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚</li></ul><h4 id="è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼"><span>è¿”å›å€¼</span></a></h4><ul><li>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœ <code>input</code> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ IPv6 åœ°å€ï¼Œåˆ™è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-4"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>è¿‡æ»¤æœ‰æ•ˆçš„ IPv6 åœ°å€</strong></p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ç”¨æˆ·è¾“å…¥ IP åœ°å€çš„åº”ç”¨ç¨‹åºï¼Œä½ å¸Œæœ›ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æœ‰æ•ˆçš„ IPv6 åœ°å€ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>net.isIPv6(input)</code> æ–¹æ³•æ¥éªŒè¯è¾“å…¥ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> isValidIPv6Address</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIPv6</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">address</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">isValidIPv6Address</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2001:0db8:85a3:0000:0000:8a2e:0370:7334</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // true</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">isValidIPv6Address</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // falseï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª IPv4 åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ—¥å¿—è®°å½•ä¸åˆ†æ</strong></p><p>åœ¨å¤„ç†æœåŠ¡å™¨æ—¥å¿—æ—¶ï¼Œå¯èƒ½éœ€è¦åŒºåˆ†è¯·æ±‚æ˜¯é€šè¿‡ IPv4 è¿˜æ˜¯ IPv6 åœ°å€å‘èµ·çš„ã€‚ä½¿ç”¨ <code>net.isIPv6</code> å¯ä»¥å¸®åŠ©è¯†åˆ« IPv6 åœ°å€çš„è¯·æ±‚ï¼Œä»è€Œè¿›è¡Œç›¸åº”çš„æ—¥å¿—è®°å½•æˆ–åˆ†æå¤„ç†ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> logRequest</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">ipAddress</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">isIPv6</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">ipAddress</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received request from IPv6 address: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">ipAddress</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">Received request from non-IPv6 (possibly IPv4) address: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">ipAddress</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">logRequest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2001:0db8:85a3:0000:0000:8a2e:0370:7334</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // Received request from IPv6 address: ...</span></span>
<span class="line"><span style="color:#88C0D0;">logRequest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">192.168.1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // Received request from non-IPv6 (possibly IPv4) address: ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>net.isIPv6(input)</code> æ–¹æ³•åœ¨ç½‘ç»œç¼–ç¨‹ä¸­çš„å®é™…åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¤„ç†ã€éªŒè¯æˆ–è®°å½• IPv6 åœ°å€ä¿¡æ¯æ—¶ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Modules: Packages</div></a><a class="route-link auto-link next" href="/document/node-doc/Node-API.html" aria-label="Node-API"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Node-API<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.8acf974b.js" defer></script><script src="/assets/js/4485.e6fe7c7b.js" defer></script><script src="/assets/js/app.fff57528.js" defer></script>
  </body>
</html>
