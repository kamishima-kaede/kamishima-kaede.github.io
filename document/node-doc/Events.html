<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Events.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Events"><meta property="og:description" content="Events Node.js ä¸­çš„ Eventsï¼ˆäº‹ä»¶ï¼‰æ¨¡å—æ˜¯ä¸€ä¸ªè®©æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå·±çš„äº‹ä»¶çš„æ¨¡å—ã€‚è¿™åœ¨æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºæ—¶å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬ç»„ç»‡å’Œç®¡ç†å¤æ‚çš„å¼‚æ­¥ä»£ç ã€‚ ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­çš„äº‹ä»¶â€”â€”å®ƒä»¬è¡¨ç¤ºåœ¨ç³»ç»Ÿä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ç½‘é¡µä¸Šçš„æŒ‰é’®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼›æˆ–è€…å½“ä»æ–‡ä»¶ä¸­å®Œæˆ..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Events","description":"Events Node.js ä¸­çš„ Eventsï¼ˆäº‹ä»¶ï¼‰æ¨¡å—æ˜¯ä¸€ä¸ªè®©æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå·±çš„äº‹ä»¶çš„æ¨¡å—ã€‚è¿™åœ¨æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºæ—¶å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬ç»„ç»‡å’Œç®¡ç†å¤æ‚çš„å¼‚æ­¥ä»£ç ã€‚ ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­çš„äº‹ä»¶â€”â€”å®ƒä»¬è¡¨ç¤ºåœ¨ç³»ç»Ÿä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ç½‘é¡µä¸Šçš„æŒ‰é’®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼›æˆ–è€…å½“ä»æ–‡ä»¶ä¸­å®Œæˆ..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Events | hanekawa-shiki</title><meta name="description" content="Events Node.js ä¸­çš„ Eventsï¼ˆäº‹ä»¶ï¼‰æ¨¡å—æ˜¯ä¸€ä¸ªè®©æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå·±çš„äº‹ä»¶çš„æ¨¡å—ã€‚è¿™åœ¨æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºæ—¶å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬ç»„ç»‡å’Œç®¡ç†å¤æ‚çš„å¼‚æ­¥ä»£ç ã€‚ ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­çš„äº‹ä»¶â€”â€”å®ƒä»¬è¡¨ç¤ºåœ¨ç³»ç»Ÿä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ç½‘é¡µä¸Šçš„æŒ‰é’®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼›æˆ–è€…å½“ä»æ–‡ä»¶ä¸­å®Œæˆ...">
    <link rel="stylesheet" href="/assets/css/styles.a84c0532.css">
    <link rel="preload" href="/assets/js/runtime~app.be370b10.js" as="script"><link rel="preload" href="/assets/css/styles.a84c0532.css" as="style"><link rel="preload" href="/assets/js/4485.e6fe7c7b.js" as="script"><link rel="preload" href="/assets/js/app.bf6f64e3.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Events</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 188 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT188M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 56517 å­—</span><meta property="wordCount" content="56517"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯äº‹ä»¶">ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-eventemitter">Node.js ä¸­çš„ EventEmitter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#passing-arguments-and-this-to-listeners">Passing arguments and this to listeners</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä¼ é€’å‚æ•°">å¦‚ä½•ä¼ é€’å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ”¹å˜thisçš„æŒ‡å‘">æ”¹å˜thisçš„æŒ‡å‘</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-v21-7-1-ä¸­çš„æ–°ç‰¹æ€§">Node.js v21.7.1 ä¸­çš„æ–°ç‰¹æ€§</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#asynchronous-vs-synchronous">Asynchronous vs. synchronous</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŒæ­¥-synchronous">åŒæ­¥ï¼ˆSynchronousï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¼‚æ­¥-asynchronous">å¼‚æ­¥ï¼ˆAsynchronousï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-node-js-ä¸­çš„å®é™…åº”ç”¨">åœ¨ Node.js ä¸­çš„å®é™…åº”ç”¨ï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#handling-events-only-once">Handling events only once</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#error-events">Error events</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é”™è¯¯äº‹ä»¶-error-events">é”™è¯¯äº‹ä»¶ï¼ˆError Eventsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#capture-rejections-of-promises">Capture rejections of promises</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-promise">ä»€ä¹ˆæ˜¯ Promiseï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#promise-æ‹’ç»æ•è·">Promise æ‹’ç»æ•è·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹è¯´æ˜">å®ä¾‹è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-eventemitter">Class: EventEmitter</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹åŒ–-eventemitter">å®ä¾‹åŒ– EventEmitter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-eventemitter">ä½¿ç”¨ EventEmitter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-newlistener">Event: &#39;newListener&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-newlistener-äº‹ä»¶">ç†è§£ newListener äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-removelistener">Event: &#39;removeListener&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶-removelistener">äº‹ä»¶: &#39;removeListener&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-addlistener-eventname-listener">emitter.addListener(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯emitter-addlistener-eventname-listener">ä»€ä¹ˆæ˜¯emitter.addListener(eventName, listener)?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è¯¦è§£">å‚æ•°è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-emit-eventname-args">emitter.emit(eventName[, ...args])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-eventnames">emitter.eventNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitter">EventEmitter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶ç›‘å¬å™¨-event-listener">äº‹ä»¶ç›‘å¬å™¨ (Event Listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-eventnames-1">emitter.eventNames()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-getmaxlisteners">emitter.getMaxListeners()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-getmaxlisteners-1">emitter.getMaxListeners()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦æœ‰æœ€å¤§ç›‘å¬å™¨æ•°é‡çš„é™åˆ¶">ä¸ºä»€ä¹ˆè¦æœ‰æœ€å¤§ç›‘å¬å™¨æ•°é‡çš„é™åˆ¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¿®æ”¹æœ€å¤§ç›‘å¬å™¨æ•°é‡">ä¿®æ”¹æœ€å¤§ç›‘å¬å™¨æ•°é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-listenercount-eventname-listener">emitter.listenerCount(eventName[, listener])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-listeners-eventname">emitter.listeners(eventName)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-4">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-off-eventname-listener">emitter.off(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-off-eventname-listener-1">emitter.off(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-on-eventname-listener">emitter.on(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-2">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-3">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-once-eventname-listener">emitter.once(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-once-eventname-listener-1">emitter.once(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-prependlistener-eventname-listener">emitter.prependListener(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-5">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-prependoncelistener-eventname-listener">emitter.prependOnceListener(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨prependoncelistener">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨prependOnceListener?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-removealllisteners-eventname">emitter.removeAllListeners([eventName])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-removealllisteners-eventname-1">emitter.removeAllListeners([eventName])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-removelistener-eventname-listener">emitter.removeListener(eventName, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-setmaxlisteners-n">emitter.setMaxListeners(n)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-setmaxlisteners-n-1">emitter.setMaxListeners(n)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-rawlisteners-eventname">emitter.rawListeners(eventName)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-rawlisteners-eventname-1">emitter.rawListeners(eventName)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-symbol-for-nodejs-rejection-err-eventname-args">emitter[Symbol.for(&#39;nodejs.rejection&#39;)](err, eventName[, ...args])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emitter-symbol-for-nodejs-rejection-err-eventname-args-1">emitter[Symbol.for(&#39;nodejs.rejection&#39;)](err, eventName[, ...args])</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-defaultmaxlisteners">events.defaultMaxListeners</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#events-defaultmaxlisteners-1">events.defaultMaxListeners</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-errormonitor">events.errorMonitor</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1">ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-geteventlisteners-emitterortarget-eventname">events.getEventListeners(emitterOrTarget, eventName)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-events-geteventlisteners">ä½¿ç”¨ events.getEventListeners</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-getmaxlisteners-emitterortarget">events.getMaxListeners(emitterOrTarget)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç†è§£">åŸºæœ¬ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦å…³å¿ƒç›‘å¬å™¨çš„æ•°é‡">ä¸ºä»€ä¹ˆè¦å…³å¿ƒç›‘å¬å™¨çš„æ•°é‡ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-once-emitter-name-options">events.once(emitter, name[, options])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-events-once-emitter-name-options">ä»€ä¹ˆæ˜¯ events.once(emitter, name[, options])?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£æ">å‚æ•°è§£æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è¯­">ç»“è¯­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#awaiting-multiple-events-emitted-on-process-nexttick">Awaiting multiple events emitted on process.nextTick()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#awaiting-multiple-events-emitted-on-process-nexttick-1">Awaiting Multiple Events Emitted on process.nextTick()</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-capturerejections">events.captureRejections</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-1">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-rejections">ä»€ä¹ˆæ˜¯ Rejectionsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#capturerejections-çš„å¼•å…¥">captureRejections çš„å¼•å…¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-capturerejections">å¦‚ä½•ä½¿ç”¨ captureRejectionsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-capturerejectionsymbol">events.captureRejectionSymbol</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitter-ç®€ä»‹">EventEmitter ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#promise-å’Œ-unhandled-rejections">Promise å’Œ Unhandled Rejections</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#events-capturerejectionsymbol-è§£é‡Š">events.captureRejectionSymbol è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-4">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-listenercount-emitter-eventname">events.listenerCount(emitter, eventName)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#events-listenercount-emitter-eventname-1">events.listenerCount(emitter, eventName)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-6">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-on-emitter-eventname-options">events.on(emitter, eventName[, options])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£è¯»">å‚æ•°è§£è¯»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-5">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-setmaxlisteners-n-eventtargets">events.setMaxListeners(n[, ...eventTargets])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#events-setmaxlisteners-n-eventtargets-1">events.setMaxListeners(n[, ...eventTargets])</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#events-addabortlistener-signal-listener">events.addAbortListener(signal, listener)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-events-eventemitterasyncresource-extends-eventemitter">Class: events.EventEmitterAsyncResource extends EventEmitter</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitterasyncresource">EventEmitterAsyncResource</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-events-eventemitterasyncresource-options">new events.EventEmitterAsyncResource([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#events-eventemitterasyncresource">events.EventEmitterAsyncResource</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitterasyncresource-asyncid">eventemitterasyncresource.asyncId</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitterasyncresource-1">EventEmitterAsyncResource</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#asyncid">asyncId</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨æ¡ˆä¾‹">å®é™…è¿ç”¨æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitterasyncresource-asyncresource">eventemitterasyncresource.asyncResource</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•çš„èƒŒæ™¯çŸ¥è¯†">ç®€å•çš„èƒŒæ™¯çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitterasyncresource-asyncresource-1">eventemitterasyncresource.asyncResource</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitterasyncresource-emitdestroy">eventemitterasyncresource.emitDestroy()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-eventemitterasyncresource-emitdestroy">è§£é‡Š EventEmitterAsyncResource.emitDestroy()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-9">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-6">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitterasyncresource-triggerasyncid">eventemitterasyncresource.triggerAsyncId</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#eventtarget-and-event-api">EventTarget and Event API</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventtarget-å’Œ-event">EventTarget å’Œ Event</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ-1">å¦‚ä½•å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-7">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-eventtarget-vs-dom-eventtarget">Node.js EventTarget vs. DOM EventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-eventtarget">Node.js EventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dom-eventtarget">DOM EventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å·®å¼‚">å·®å¼‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nodeeventtarget-vs-eventemitter">NodeEventTarget vs. EventEmitter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventemitter-2">EventEmitter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nodeeventtarget">NodeEventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŒºåˆ«æ€»ç»“">åŒºåˆ«æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-listener">Event listener</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬å™¨">ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬å™¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ-2">å¦‚ä½•å·¥ä½œï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-1">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventtarget-error-handling">EventTarget error handling</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventtarget-é”™è¯¯å¤„ç†çš„åŸºç¡€">EventTarget é”™è¯¯å¤„ç†çš„åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•ç¤ºä¾‹">ç®€å•ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨">å®é™…åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-event">Class: Event</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€ä»‹">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨æ­¥éª¤">ä½¿ç”¨æ­¥éª¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹è®²è§£">å®ä¾‹è®²è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-event-cancelbubble">ä»€ä¹ˆæ˜¯ event.cancelBubbleï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-node-js-ä¸­å¤„ç†äº‹ä»¶">åœ¨ Node.js ä¸­å¤„ç†äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-3">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-äº‹ä»¶ç³»ç»Ÿ">Node.js äº‹ä»¶ç³»ç»Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-13">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åŸºæœ¬æ¦‚å¿µ">1. åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-event-currenttarget-çš„æ¦‚å¿µ">2. event.currentTarget çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-eventemitter-ä¸­çš„-this-å…³é”®å­—">3. EventEmitter ä¸­çš„ this å…³é”®å­—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨">äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-ä½¿ç”¨-eventtarget-åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶">ä¾‹å­ 1ï¼šä½¿ç”¨ EventTarget åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-ç»§æ‰¿-eventtarget-æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»">ä¾‹å­ 2ï¼šç»§æ‰¿ EventTarget æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´">ç¤ºä¾‹ 1ï¼šæµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-è®°å½•äº‹ä»¶çš„é¡ºåºå’Œæ—¶é—´é—´éš”">ç¤ºä¾‹ 2ï¼šè®°å½•äº‹ä»¶çš„é¡ºåºå’Œæ—¶é—´é—´éš”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-type-1">event.type</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-eventtarget">Class: EventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eventtarget-çš„åŸºæœ¬æ¦‚å¿µ">EventTarget çš„åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-2">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-http-æœåŠ¡å™¨è¯·æ±‚ç›‘å¬">å®ä¾‹ 1ï¼šHTTP æœåŠ¡å™¨è¯·æ±‚ç›‘å¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-å•æ¬¡äº‹ä»¶ç›‘å¬å™¨">å®ä¾‹ 2ï¼šå•æ¬¡äº‹ä»¶ç›‘å¬å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-dispatchevent">è§£é‡Š dispatchEvent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2">ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹æ­¥éª¤">ç¤ºä¾‹æ­¥éª¤ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-9">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-customevent">Class: CustomEvent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºä¸€ä¸ª-customevent">åˆ›å»ºä¸€ä¸ª CustomEvent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç›‘å¬-customevent">ç›‘å¬ CustomEvent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§¦å‘-customevent">è§¦å‘ CustomEvent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-10">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-nodeeventtarget">Class: NodeEventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nodeeventtarget-çš„åŸºæœ¬ç”¨æ³•">NodeEventTarget çš„åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-http-æœåŠ¡å™¨è¯·æ±‚äº‹ä»¶">å®ä¾‹ 1ï¼šHTTP æœåŠ¡å™¨è¯·æ±‚äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-è‡ªå®šä¹‰äº‹ä»¶">å®ä¾‹ 2ï¼šè‡ªå®šä¹‰äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#emit-æ–¹æ³•çš„ä½œç”¨">emit() æ–¹æ³•çš„ä½œç”¨ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è¯´æ˜">å‚æ•°è¯´æ˜ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-11">å®é™…è¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-3">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-10">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-æœåŠ¡å™¨è¯·æ±‚">ä¾‹å­ 1: æœåŠ¡å™¨è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-æ¸…ç†èµ„æº">ä¾‹å­ 2: æ¸…ç†èµ„æº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-3-ç”¨æˆ·åªèƒ½ä¸€æ¬¡æ€§æ³¨å†Œ">ä¾‹å­ 3: ç”¨æˆ·åªèƒ½ä¸€æ¬¡æ€§æ³¨å†Œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nodeeventtarget-1">NodeEventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶ç›‘å¬å™¨">äº‹ä»¶ç›‘å¬å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#removealllisteners-type-æ–¹æ³•">removeAllListeners([type]) æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-12">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="events" tabindex="-1"><a class="header-anchor" href="#events"><span><a href="https://nodejs.org/docs/latest/api/events.html#events" target="_blank" rel="noopener noreferrer">Events</a></span></a></h1><p>Node.js ä¸­çš„ Eventsï¼ˆäº‹ä»¶ï¼‰æ¨¡å—æ˜¯ä¸€ä¸ªè®©æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå·±çš„äº‹ä»¶çš„æ¨¡å—ã€‚è¿™åœ¨æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºæ—¶å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬ç»„ç»‡å’Œç®¡ç†å¤æ‚çš„å¼‚æ­¥ä»£ç ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯äº‹ä»¶"><span>ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­çš„äº‹ä»¶â€”â€”å®ƒä»¬è¡¨ç¤ºåœ¨ç³»ç»Ÿä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ç½‘é¡µä¸Šçš„æŒ‰é’®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼›æˆ–è€…å½“ä»æ–‡ä»¶ä¸­å®Œæˆæ•°æ®è¯»å–æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¸€ä¸ªè¯»å–å®Œæˆäº‹ä»¶ã€‚</p><h3 id="node-js-ä¸­çš„-eventemitter" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-eventemitter"><span>Node.js ä¸­çš„ EventEmitter</span></a></h3><p>Node.js æä¾›äº†ä¸€ä¸ª<code>EventEmitter</code>ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰å¯ä»¥å‘å‡ºäº‹ä»¶çš„å¯¹è±¡çš„åŸºç¡€ã€‚ä½ å¯ä»¥é€šè¿‡ç»§æ‰¿<code>EventEmitter</code>æ¥åˆ›å»ºèƒ½å¤Ÿå‘å‡ºè‡ªå®šä¹‰äº‹ä»¶çš„å¯¹è±¡ã€‚æ­¤å¤–ï¼ŒNode.js ä¸­å¾ˆå¤šå†…ç½®å¯¹è±¡ä¹Ÿæ˜¯åŸºäº<code>EventEmitter</code>çš„ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨å¯¹è±¡å°±èƒ½å‘å‡ºåƒ&#39;request&#39;ï¼ˆè¯·æ±‚æ¥äº†ï¼‰ã€&#39;connection&#39;ï¼ˆæœ‰æ–°è¿æ¥ï¼‰ç­‰äº‹ä»¶ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</span></a></h3><ol><li><p><strong>å¼•å…¥ Events æ¨¡å—</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ Node.js ä¸­çš„<code>events</code>æ¨¡å—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>åˆ›å»º EventEmitter å®ä¾‹</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>ç›‘å¬äº‹ä»¶</strong>ï¼šä½ å¯ä»¥ä½¿ç”¨<code>.on()</code>æ–¹æ³•æ¥ç›‘å¬ç‰¹å®šäº‹ä»¶ã€‚å½“è¿™ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œä¼ é€’ç»™<code>.on()</code>çš„å›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An event occurred!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è§¦å‘äº‹ä»¶</strong>ï¼šä½¿ç”¨<code>.emit()</code>æ–¹æ³•æ¥è§¦å‘äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªç®€å•çš„åœ¨çº¿èŠå¤©åº”ç”¨ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†ç”¨æˆ·æ¶ˆæ¯çš„ä¾‹å­ï¼š</p><ol><li><p><strong>ç”¨æˆ·å‘é€æ¶ˆæ¯</strong>ï¼šå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¹¿æ’­è¿™æ¡æ¶ˆæ¯ç»™æ‰€æœ‰å…¶ä»–åœ¨çº¿ç”¨æˆ·ã€‚</p></li><li><p><strong>åˆ›å»ºç”¨æˆ·æ¶ˆæ¯äº‹ä»¶</strong>ï¼šæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªäº‹ä»¶æ¥ä»£è¡¨ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chatEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;message&#39; äº‹ä»¶ä»¥æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">New message: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥æ·»åŠ å°†æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰ç”¨æˆ·çš„ä»£ç </span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è§¦å‘ &#39;message&#39; äº‹ä»¶</strong>ï¼šå½“ç”¨æˆ·å®é™…å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬è§¦å‘&#39;message&#39;äº‹ä»¶å¹¶ä¼ é€’æ¶ˆæ¯å†…å®¹ä½œä¸ºå‚æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ç”¨æˆ·å‘é€äº†ä¸€æ¡æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Node.js ä¸­çš„ Events æ¨¡å—æ¥å¤„ç†ä¸€ä¸ªå®é™…é—®é¢˜â€”â€”åœ¨èŠå¤©åº”ç”¨ä¸­å¹¿æ’­æ¶ˆæ¯ã€‚ç±»ä¼¼åœ°ï¼Œä½ å¯ä»¥åœ¨å¾ˆå¤šä¸åŒçš„åœºæ™¯ä¸‹åˆ©ç”¨äº‹ä»¶ï¼Œæ¯”å¦‚å¤„ç† HTTP è¯·æ±‚ã€å¤„ç†ç”¨æˆ·è¾“å…¥ã€è¿›è¡Œå¼‚æ­¥æ“ä½œç­‰ç­‰ã€‚</p><p>æ€»ä¹‹ï¼ŒNode.js ä¸­çš„äº‹ä»¶å’Œ<code>EventEmitter</code>ç±»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å¼ºå¤§ä¸”çµæ´»çš„æ–¹å¼æ¥å¤„ç†å„ç§äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹åœºæ™¯ï¼Œä½¿å¾—æˆ‘ä»¬çš„åº”ç”¨æ›´åŠ æ¨¡å—åŒ–å’Œæ˜“äºç®¡ç†ã€‚</p><h2 id="passing-arguments-and-this-to-listeners" tabindex="-1"><a class="header-anchor" href="#passing-arguments-and-this-to-listeners"><span><a href="https://nodejs.org/docs/latest/api/events.html#passing-arguments-and-this-to-listeners" target="_blank" rel="noopener noreferrer">Passing arguments and this to listeners</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œ<code>events</code>æ¨¡å—æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ›å»ºã€ç›‘å¬å’Œå‘å‡ºäº‹ä»¶ã€‚è¿™æ˜¯ Node.js å¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¶æ„çš„æ ¸å¿ƒã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå…³äºå¦‚ä½•å‘ç›‘å¬å™¨ä¼ é€’å‚æ•°å’Œ<code>this</code>ä¸Šä¸‹æ–‡çš„ä»‹ç»å˜å¾—æ›´åŠ æ˜ç¡®å’Œå®ç”¨ã€‚æˆ‘å°†é€šè¿‡ç®€å•çš„è§£é‡Šå’Œä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£è¿™ä¸€ç‚¹ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬å™¨å¾ˆé‡è¦ã€‚å½“æˆ‘ä»¬è¯´â€œç›‘å¬â€æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ç­‰å¾…æŸä¸ªç‰¹å®šäº‹ä»¶å‘ç”Ÿçš„è¿‡ç¨‹ã€‚ä¸€æ—¦è¿™ä¸ªäº‹ä»¶å‘ç”Ÿï¼ˆè¢«è§¦å‘ï¼‰ï¼Œå°±ä¼šè°ƒç”¨ä¸ä¹‹ç›¸å…³è”çš„å‡½æ•°ï¼ˆå³ç›‘å¬å™¨æˆ–å›è°ƒå‡½æ•°ï¼‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>EventEmitter</code>ç±»æ¥å¤„ç†äº‹ä»¶ã€‚ä¸€ä¸ª<code>EventEmitter</code>å®ä¾‹èƒ½å¤Ÿåˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶ã€è§¦å‘äº‹ä»¶ä»¥åŠå¯¹äº‹ä»¶è¿›è¡Œç›‘å¬ã€‚</p><p>ä½†æœ‰æ—¶å€™ï¼Œä»…ä»…è§¦å‘äº‹ä»¶å¹¶æ‰§è¡Œç›‘å¬å™¨å¯èƒ½ä¸è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æƒ³åœ¨è§¦å‘äº‹ä»¶æ—¶å‘ç›‘å¬å™¨ä¼ é€’é¢å¤–çš„æ•°æ®æˆ–è€…æ”¹å˜ç›‘å¬å™¨å‡½æ•°å†…<code>this</code>çš„æŒ‡å‘ã€‚</p><h3 id="å¦‚ä½•ä¼ é€’å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¼ é€’å‚æ•°"><span>å¦‚ä½•ä¼ é€’å‚æ•°</span></a></h3><p>åœ¨ä»¥å‰çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æƒ³å‘äº‹ä»¶ç›‘å¬å™¨ä¼ é€’å‚æ•°ï¼Œä½ å¿…é¡»ç›´æ¥åœ¨<code>emit</code>æ–¹æ³•ä¸­æ·»åŠ è¿™äº›å‚æ•°ã€‚ç›‘å¬å™¨å‡½æ•°ä¼šæŒ‰é¡ºåºæ¥æ”¶è¿™äº›å‚æ•°ã€‚</p><h4 id="ä¾‹å­-1-ä¼ ç»Ÿæ–¹å¼ä¼ é€’å‚æ•°" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ä¼ ç»Ÿæ–¹å¼ä¼ é€’å‚æ•°"><span>ä¾‹å­ 1: ä¼ ç»Ÿæ–¹å¼ä¼ é€’å‚æ•°</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;event&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘&#39;event&#39;äº‹ä»¶ï¼ŒåŒæ—¶ä¼ é€’å‚æ•°&#39;a&#39;å’Œ&#39;b&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">a</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">b</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>MyEmitter</code>çš„å®ä¾‹<code>myEmitter</code>ï¼Œç„¶åç›‘å¬äº†ä¸€ä¸ªåä¸º<code>event</code>çš„äº‹ä»¶ï¼Œå¹¶åœ¨è§¦å‘è¯¥äº‹ä»¶æ—¶ä¼ é€’äº†ä¸¤ä¸ªå‚æ•°<code>&#39;a&#39;</code>å’Œ<code>&#39;b&#39;</code>ç»™ç›‘å¬å™¨å‡½æ•°ã€‚</p><h3 id="æ”¹å˜thisçš„æŒ‡å‘" tabindex="-1"><a class="header-anchor" href="#æ”¹å˜thisçš„æŒ‡å‘"><span>æ”¹å˜<code>this</code>çš„æŒ‡å‘</span></a></h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨å‡½æ•°å†…<code>this</code>çš„æŒ‡å‘æ˜¯å…¶æ‰€å±çš„<code>EventEmitter</code>å®ä¾‹ã€‚ä½†æœ‰æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›æ›´æ”¹<code>this</code>çš„æŒ‡å‘åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p><h4 id="ä¾‹å­-2-æ”¹å˜-this-æŒ‡å‘" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ”¹å˜-this-æŒ‡å‘"><span>ä¾‹å­ 2: æ”¹å˜ this æŒ‡å‘</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> myListener</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ .bind() æ–¹æ³•æ”¹å˜thisæŒ‡å‘</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> myListener</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">bind</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">someOtherObject</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>.bind()</code>æ–¹æ³•æ”¹å˜äº†<code>myListener</code>å‡½æ•°ä¸­<code>this</code>çš„æŒ‡å‘ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œ<code>myListener</code>é‡Œçš„<code>this</code>å°†æŒ‡å‘<code>someOtherObject</code>ã€‚</p><h3 id="node-js-v21-7-1-ä¸­çš„æ–°ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#node-js-v21-7-1-ä¸­çš„æ–°ç‰¹æ€§"><span>Node.js v21.7.1 ä¸­çš„æ–°ç‰¹æ€§</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œæä¾›äº†æ›´ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†å‘ç›‘å¬å™¨ä¼ é€’é¢å¤–å‚æ•°å’Œæ”¹å˜<code>this</code>æŒ‡å‘çš„é—®é¢˜ã€‚è™½ç„¶å…·ä½“çš„ API å¯èƒ½éšç‰ˆæœ¬ç¨æœ‰å˜åŒ–ï¼Œä½ å¯ä»¥æŸ¥é˜…æœ€æ–°çš„ Node.js æ–‡æ¡£æ¥è·å–å‡†ç¡®ä¿¡æ¯ã€‚é€šå¸¸ï¼Œè¿™äº›ç‰¹æ€§é€šè¿‡æä¾›æ–°çš„æ–¹æ³•æˆ–è€…é€‰é¡¹æ¥ç®€åŒ–ä»£ç ï¼Œä½¿å¾—ç®¡ç†äº‹ä»¶ç›‘å¬å™¨å˜å¾—æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚</p><p>è®°ä½ï¼Œé˜…è¯»å®˜æ–¹æ–‡æ¡£å§‹ç»ˆæ˜¯äº†è§£å’ŒæŒæ¡æœ€æ–°ç‰¹æ€§çš„æœ€å¥½æ–¹å¼ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£åœ¨ Node.js ä¸­å¦‚ä½•å‘ç›‘å¬å™¨ä¼ é€’å‚æ•°åŠå…¶<code>this</code>ä¸Šä¸‹æ–‡çš„æ”¹å˜ã€‚</p><h2 id="asynchronous-vs-synchronous" tabindex="-1"><a class="header-anchor" href="#asynchronous-vs-synchronous"><span><a href="https://nodejs.org/docs/latest/api/events.html#asynchronous-vs-synchronous" target="_blank" rel="noopener noreferrer">Asynchronous vs. synchronous</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œå¤„ç†äº‹ä»¶å’Œæ•°æ®æµçš„æ–¹å¼é€šå¸¸åˆ†ä¸ºä¸¤ç§ï¼š<code>åŒæ­¥(synchronous)</code>å’Œ<code>å¼‚æ­¥(asynchronous)</code>ã€‚</p><h3 id="åŒæ­¥-synchronous" tabindex="-1"><a class="header-anchor" href="#åŒæ­¥-synchronous"><span>åŒæ­¥ï¼ˆSynchronousï¼‰</span></a></h3><p>åŒæ­¥æ“ä½œæ„å‘³ç€ä»£ç æŒ‰ç…§å®ƒè¢«å†™å…¥çš„é¡ºåºä¸€æ­¥æ¥ä¸€æ­¥åœ°æ‰§è¡Œã€‚æ¯ä¸ªæ“ä½œå¿…é¡»ç­‰å‰ä¸€ä¸ªæ“ä½œå®Œæˆåæ‰èƒ½å¼€å§‹ã€‚è¿™ç§æ–¹å¼å¾ˆç›´è§‚ï¼Œå› ä¸ºå®ƒç±»ä¼¼äºæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­æ‰§è¡Œä»»åŠ¡çš„æ–¹å¼ï¼šå…ˆåšä¸€ä»¶äº‹ï¼Œå®Œæˆåå†åšä¸‹ä¸€ä»¶äº‹ã€‚</p><h4 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­"><span>ä¾‹å­ï¼š</span></a></h4><p>æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ã€‚å¦‚æœæœåŠ¡æ¨¡å¼æ˜¯åŒæ­¥çš„ï¼Œé‚£ä¹ˆå½“ä½ ç‚¹èœæ—¶ï¼Œå¨å¸ˆä¼šå…ˆå‡†å¤‡ä½ çš„å¤´ç›˜ï¼Œä¸Šå®Œå¤´ç›˜å¹¶æ¸…ç†æ¡Œé¢åï¼Œå†å¼€å§‹å‡†å¤‡ä¸»èœï¼Œæœ€åæ˜¯ç”œç‚¹ã€‚æ¯æ ·èœéƒ½å¿…é¡»ç­‰å‰ä¸€æ ·èœå®Œæˆåæ‰èƒ½å¼€å§‹å‡†å¤‡ã€‚</p><h3 id="å¼‚æ­¥-asynchronous" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥-asynchronous"><span>å¼‚æ­¥ï¼ˆAsynchronousï¼‰</span></a></h3><p>ç›¸å¯¹åœ°ï¼Œå¼‚æ­¥æ“ä½œå…è®¸å¤šä¸ªè¿‡ç¨‹åŒæ—¶è¿›è¡Œï¼Œè€Œä¸éœ€è¦ç­‰å¾…å‰ä¸€ä¸ªè¿‡ç¨‹å®Œæˆå°±å¯ä»¥å¯åŠ¨æ–°çš„è¿‡ç¨‹ã€‚è¿™å¯¹äºéœ€è¦å¤§é‡è¾“å…¥/è¾“å‡ºæ“ä½œï¼Œå¦‚ç½‘ç»œè¯·æ±‚æˆ–æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„åº”ç”¨ç¨‹åºæ¥è¯´éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™äº›æ“ä½œå¯èƒ½éœ€è¦ä¸ç¡®å®šçš„æ—¶é—´æ¥å®Œæˆã€‚</p><p>å¼‚æ­¥æ“ä½œæ˜¯é€šè¿‡å›è°ƒ(callbacks)ã€æ‰¿è¯º(promises)ã€å¼‚æ­¥/ç­‰å¾…(async/await)ç­‰æŠ€æœ¯æ¥ç®¡ç†çš„ã€‚</p><h4 id="ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1"><span>ä¾‹å­ï¼š</span></a></h4><p>é‡‡ç”¨å¼‚æ­¥æ–¹å¼çš„é¤å…æœåŠ¡å°†å¤§ä¸ç›¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ä½ ç‚¹äº†å…¨å¥—é¤åï¼Œå¨å¸ˆå¯ä»¥åŒæ—¶å¼€å§‹å‡†å¤‡å¤´ç›˜ã€ä¸»èœå’Œç”œç‚¹ã€‚ä¾‹å¦‚ï¼Œå½“å¤´ç›˜æ­£åœ¨çƒ¹é¥ªæ—¶ï¼ŒåŒæ—¶å¯ä»¥å¼€å§‹å¤‡æ–™å’Œçƒ˜ç„™ç”œç‚¹ã€‚è¿™æ ·ï¼Œå„ç§èœå“çš„å‡†å¤‡å·¥ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œå¤§å¤§æé«˜æ•ˆç‡ã€‚</p><h3 id="åœ¨-node-js-ä¸­çš„å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ä¸­çš„å®é™…åº”ç”¨"><span>åœ¨ Node.js ä¸­çš„å®é™…åº”ç”¨ï¼š</span></a></h3><ol><li><p><strong>è¯»å–æ–‡ä»¶ï¼ˆå¼‚æ­¥æ–¹å¼ï¼‰</strong></p><p>Node.js ä¸­è¯»å–æ–‡ä»¶é€šå¸¸ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼Œä»¥é¿å…é˜»å¡ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>fs.readFile</code>å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç„¶åä½¿ç”¨å›è°ƒå‡½æ•°å¤„ç†ç»“æœã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ•°æ®åº“æ“ä½œï¼ˆå¼‚æ­¥æ–¹å¼ï¼‰</strong></p><p>å¤§å¤šæ•°å¯¹æ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œåœ¨ Node.js ä¸­ä¹Ÿæ˜¯å¼‚æ­¥è¿›è¡Œçš„ã€‚è¿™æ ·å¯ä»¥å‘é€æŸ¥è¯¢è¯·æ±‚åç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œè€Œä¸å¿…ç­‰å¾…æŸ¥è¯¢ç»“æœè¿”å›ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">database</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">query</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SELECT * FROM users</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> results</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">results</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>HTTP è¯·æ±‚ï¼ˆå¼‚æ­¥æ–¹å¼ï¼‰</strong></p><p>å‘é€ HTTP è¯·æ±‚ï¼Œå¦‚ API è°ƒç”¨ï¼Œé€šå¸¸ä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚Node.js å¯ä»¥åœ¨ç­‰å¾…å“åº”çš„åŒæ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">https</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://api.example.com/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ¥æ”¶æ•°æ®ç‰‡æ®µã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ•°æ®æ¥æ”¶å®Œæ¯•ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>æ³¨æ„ï¼Œè™½ç„¶å¼‚æ­¥æ“ä½œæé«˜äº†æ•ˆç‡ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ›´ä¸ºå¤æ‚çš„é”™è¯¯å¤„ç†å’Œæµç¨‹æ§åˆ¶é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­é€‰æ‹©æ­£ç¡®çš„å¤„ç†æ–¹å¼è‡³å…³é‡è¦ã€‚</p><h2 id="handling-events-only-once" tabindex="-1"><a class="header-anchor" href="#handling-events-only-once"><span><a href="https://nodejs.org/docs/latest/api/events.html#handling-events-only-once" target="_blank" rel="noopener noreferrer">Handling events only once</a></span></a></h2><p>ç†è§£ Node.js ä¸­çš„â€œHandling events only onceï¼ˆå•æ¬¡äº‹ä»¶å¤„ç†ï¼‰â€æ¦‚å¿µï¼Œæˆ‘ä»¬é¦–å…ˆå¾—æ˜ç™½å‡ ä¸ªåŸºæœ¬ç‚¹ï¼šNode.jsã€äº‹ä»¶ã€ä»¥åŠäº‹ä»¶ç›‘å¬å™¨ã€‚</p><ul><li><strong>Node.js</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>äº‹ä»¶</strong> åœ¨ Node.js ä¸­æ˜¯ä¸€ç§é‡è¦çš„æ¦‚å¿µï¼Œå¤§å¤šæ•°æ“ä½œéƒ½æ˜¯å›´ç»•ç€äº‹ä»¶å’Œå›è°ƒå‡½æ•°è¿›è¡Œçš„ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ–‡ä»¶è¯»å–å®Œæˆæ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼›å½“ HTTP æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ä¹Ÿä¼šè§¦å‘äº‹ä»¶ã€‚</li><li><strong>äº‹ä»¶ç›‘å¬å™¨</strong>ï¼ˆæˆ–ç§°äº‹ä»¶å¤„ç†å™¨ï¼‰æ˜¯ä¸ç‰¹å®šäº‹ä»¶ç›¸å…³è”çš„å‡½æ•°ï¼Œå½“é‚£ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚</li></ul><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨æ¯æ¬¡äº‹ä»¶å‘ç”Ÿæ—¶éƒ½æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä½†æœ‰äº›åœºæ™¯ä¸‹ï¼Œä½ åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡äº‹ä»¶å‘ç”Ÿæ—¶åšå‡ºå“åº”ï¼Œä¹‹åå³ä½¿äº‹ä»¶å†æ¬¡å‘ç”Ÿä¹Ÿæ— éœ€å†æ¬¡å“åº”ã€‚è¿™å°±æ˜¯â€œHandling events only onceâ€çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>events</code>æ¨¡å—æä¾›äº†<code>.once()</code>æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¸<code>.on()</code>æ–¹æ³•ä¸åŒï¼Œ<code>.on()</code>ä¼šåœ¨æ¯æ¬¡äº‹ä»¶å‘ç”Ÿæ—¶éƒ½è°ƒç”¨ç›‘å¬å™¨ï¼Œ<code>.once()</code>åˆ™ä¿è¯äº†ç›‘å¬å™¨ä»…è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ— è®ºäº‹ä»¶è¢«è§¦å‘å¤šå°‘æ¬¡ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-http-æœåŠ¡å™¨åªè®°å½•é¦–æ¬¡è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-http-æœåŠ¡å™¨åªè®°å½•é¦–æ¬¡è¯·æ±‚"><span>ä¾‹å­ 1: HTTP æœåŠ¡å™¨åªè®°å½•é¦–æ¬¡è¯·æ±‚</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ æƒ³è®°å½•æœåŠ¡å™¨å¯åŠ¨åæ”¶åˆ°çš„ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚çš„ä¿¡æ¯ï¼Œä½†åç»­çš„è¯·æ±‚åˆ™ä¸åšè®°å½•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨.once()ç¡®ä¿å›è°ƒå‡½æ•°åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">é¦–æ¬¡æ”¶åˆ°è¯·æ±‚çš„URL:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡<code>.once()</code>æ·»åŠ çš„ç›‘å¬å™¨ï¼Œåœ¨é¦–æ¬¡æ”¶åˆ° HTTP è¯·æ±‚æ—¶è¾“å‡ºè¯·æ±‚çš„ URLï¼Œä¹‹åå³ä¾¿æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥ï¼Œä¹Ÿä¸ä¼šå†æ¬¡è®°å½•ã€‚</p><h4 id="ä¾‹å­-2-æ–‡ä»¶åªè¯»å–ä¸€æ¬¡çš„é€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ–‡ä»¶åªè¯»å–ä¸€æ¬¡çš„é€šçŸ¥"><span>ä¾‹å­ 2: æ–‡ä»¶åªè¯»å–ä¸€æ¬¡çš„é€šçŸ¥</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªè„šæœ¬æ­£åœ¨ç›‘è§†æŸä¸ªæ–‡ä»¶çš„å˜åŒ–ï¼Œå¹¶åœ¨æ–‡ä»¶å†…å®¹å˜æ›´æ—¶è‡ªåŠ¨è¯»å–æœ€æ–°çš„å†…å®¹ã€‚ç„¶è€Œï¼Œä½ åªæƒ³åœ¨ç¬¬ä¸€æ¬¡æ–‡ä»¶æ”¹å˜æ—¶è·å–é€šçŸ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ .once() æ¥ç›‘å¬ &#39;change&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">watchFile</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> interval</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#88C0D0;">  once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">change</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">curr</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> prev</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–‡ä»¶é¦–æ¬¡è¢«ä¿®æ”¹</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨<code>.once()</code>æ–¹æ³•ç¡®ä¿åœ¨<code>example.txt</code>æ–‡ä»¶é¦–æ¬¡è¢«ä¿®æ”¹æ—¶æ‰“å°æ¶ˆæ¯ï¼Œä¹‹åçš„ä¿®æ”¹å°†ä¸ä¼šè§¦å‘ä»»ä½•ååº”ã€‚</p><p>é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹å‡º<code>.once()</code>æ–¹æ³•åœ¨å¤„ç†ä¸€æ¬¡æ€§äº‹ä»¶æ—¶çš„ä¾¿åˆ©æ€§å’Œæ•ˆåŠ›ã€‚å®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿæ›´ç®€æ´åœ°ç¼–å†™åªéœ€è¦å“åº”ä¸€æ¬¡äº‹ä»¶çš„é€»è¾‘ï¼Œé¿å…äº†æ‰‹åŠ¨ç§»é™¤äº‹ä»¶ç›‘å¬å™¨çš„éº»çƒ¦ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚</p><h2 id="error-events" tabindex="-1"><a class="header-anchor" href="#error-events"><span><a href="https://nodejs.org/docs/latest/api/events.html#error-events" target="_blank" rel="noopener noreferrer">Error events</a></span></a></h2><p>åœ¨è§£é‡Š Node.js ä¸­çš„é”™è¯¯äº‹ä»¶å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µï¼š<code>Node.js</code>å’Œ<code>äº‹ä»¶é©±åŠ¨æ¶æ„</code>ã€‚</p><p><strong>Node.js ç®€ä»‹</strong>ï¼š<br> Node.js æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œéå¸¸é€‚åˆå¼€å‘éœ€è¦é«˜æ€§èƒ½ã€éé˜»å¡å¼ I/O æ“ä½œçš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p><strong>äº‹ä»¶é©±åŠ¨æ¶æ„</strong>ï¼š<br> äº‹ä»¶é©±åŠ¨æ¶æ„æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå…¶ä¸­ç»„ä»¶ä¹‹é—´çš„äº¤äº’æ˜¯åŸºäºäº‹ä»¶è¿›è¡Œçš„ã€‚è¿™æ„å‘³ç€å½“æŸäº›äº‹æƒ…ï¼ˆäº‹ä»¶ï¼‰å‘ç”Ÿæ—¶ï¼Œä¼šè§¦å‘ç‰¹å®šçš„åŠ¨ä½œæˆ–å›è°ƒå‡½æ•°æ‰§è¡Œã€‚Node.js å¤§é‡ä½¿ç”¨äº†è¿™ç§æ¨¡å¼ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç½‘ç»œæ“ä½œã€æ–‡ä»¶ç³»ç»Ÿä»»åŠ¡ç­‰å¼‚æ­¥æ“ä½œæ—¶ã€‚</p><h3 id="é”™è¯¯äº‹ä»¶-error-events" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯äº‹ä»¶-error-events"><span>é”™è¯¯äº‹ä»¶ï¼ˆError Eventsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½æ˜¯<code>EventEmitter</code>çš„å®ä¾‹ã€‚è¿™æ„å‘³ç€å®ƒä»¬èƒ½å¤Ÿå‘é€ï¼ˆemitï¼‰äº‹ä»¶å’Œç›‘å¬ï¼ˆon æˆ–è€… addListener æ–¹æ³•ï¼‰äº‹ä»¶ã€‚å½“é‡åˆ°é”™è¯¯æ—¶ï¼Œé€šå¸¸ä¼šå‘é€ä¸€ä¸ªåä¸º<code>error</code>çš„äº‹ä»¶ã€‚</p><p>å¦‚æœè¿™ä¸ª<code>error</code>äº‹ä»¶æ²¡æœ‰è¢«ç›‘å¬ï¼ŒNode.js ä¼šé»˜è®¤å°†è¿™ä¸ªé”™è¯¯æ‰“å°åˆ°æ§åˆ¶å°ï¼Œå¹¶é€€å‡ºå½“å‰è¿›ç¨‹ã€‚è¿™æ˜¯å› ä¸ºæœªæ•è·çš„é”™è¯¯é€šå¸¸æŒ‡ç¤ºç¨‹åºå­˜åœ¨ä¸èƒ½å¿½è§†çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œæ­£ç¡®åœ°å¤„ç†<code>error</code>äº‹ä»¶éå¸¸é‡è¦ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç»´æŠ¤åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p><strong>1. HTTP æœåŠ¡å™¨é”™è¯¯å¤„ç†ï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œè¿™æ˜¯ Node.js ä¸­éå¸¸å¸¸è§çš„ç”¨é€”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æ­£ç¡®å¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨é”™è¯¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨é‡åˆ°é”™è¯¯ï¼ˆä¾‹å¦‚ç«¯å£å·²è¢«å ç”¨ï¼‰ï¼Œ<code>&#39;error&#39;</code>äº‹ä»¶ç›‘å¬å™¨å°†æ•è·è¿™ä¸ªé”™è¯¯ï¼Œå¹¶é€šè¿‡æ§åˆ¶å°è¾“å‡ºé”™è¯¯è¯¦æƒ…ï¼Œè€Œä¸æ˜¯ä½¿æ•´ä¸ªè¿›ç¨‹å´©æºƒã€‚</p><p><strong>2. æµé”™è¯¯å¤„ç†ï¼š</strong></p><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ“ä½œçš„ä¸€ç§æ–¹å¼ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€‚æµåŒæ ·ä¼šå‘å‡º<code>error</code>äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸å­˜åœ¨çš„æ–‡ä»¶.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å‘ç”Ÿé”™è¯¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°è¯•è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶å°†å¯¼è‡´é”™è¯¯ã€‚å› ä¸ºæˆ‘ä»¬ç›‘å¬äº†<code>error</code>äº‹ä»¶ï¼Œç¨‹åºä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯å¼‚å¸¸ç»ˆæ­¢ã€‚</p><p><strong>æ€»ç»“</strong>ï¼š</p><p>ç›‘å¬å¹¶æ­£ç¡®å¤„ç†<code>error</code>äº‹ä»¶å¯¹äºå¼€å‘ç¨³å®šçš„ Node.js åº”ç”¨è‡³å…³é‡è¦ã€‚å®ƒä¸ä»…å¯ä»¥å¸®åŠ©é¿å…ç¨‹åºå› æœªå¤„ç†çš„é”™è¯¯è€Œå´©æºƒï¼Œè¿˜å¯ä»¥æä¾›é”™è¯¯å‘ç”Ÿæ—¶çš„åé¦ˆï¼Œä½¿å¾—é—®é¢˜å¯ä»¥æ›´å®¹æ˜“è¢«è¯Šæ–­å’Œä¿®å¤ã€‚</p><h2 id="capture-rejections-of-promises" tabindex="-1"><a class="header-anchor" href="#capture-rejections-of-promises"><span><a href="https://nodejs.org/docs/latest/api/events.html#capture-rejections-of-promises" target="_blank" rel="noopener noreferrer">Capture rejections of promises</a></span></a></h2><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„â€œCapture rejections of promisesâ€ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨è®¨è®ºçš„æ˜¯ä¸€ç§å¤„ç† Promise æ‹’ç»ï¼ˆå³ Promise ä¸­å‡ºç°çš„é”™è¯¯æˆ–è€…æœªè¢«æ•è·çš„å¼‚å¸¸ï¼‰çš„æœºåˆ¶ã€‚åœ¨ Node.jsï¼ˆå°¤å…¶æ˜¯åœ¨ 21.7.1 ç‰ˆæœ¬ä¸­ï¼‰ä¸­ï¼Œè¿™ä¸ªç‰¹æ€§å…è®¸å¼€å‘è€…ä»¥ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼æ¥ç®¡ç†å’Œå¤„ç†å¼‚æ­¥æ“ä½œä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-promise" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-promise"><span>ä»€ä¹ˆæ˜¯ Promiseï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Promiseã€‚åœ¨ JavaScript ä¸­ï¼ŒPromise æ˜¯ä¸€ç§ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„å¯¹è±¡ã€‚å®ƒä»£è¡¨äº†ä¸€ä¸ªå¯èƒ½ç°åœ¨ã€ä¹Ÿå¯èƒ½å°†æ¥æ‰ä¼šå®Œæˆçš„æ“ä½œå’Œå®ƒçš„ç»“æœã€‚Promise æœ‰ä¸‰ç§çŠ¶æ€ï¼š</p><ul><li>Pendingï¼ˆç­‰å¾…ä¸­ï¼‰: åˆå§‹çŠ¶æ€ï¼Œæ—¢ä¸æ˜¯æˆåŠŸï¼Œä¹Ÿä¸æ˜¯å¤±è´¥ã€‚</li><li>Fulfilledï¼ˆå·²æˆåŠŸï¼‰: æ“ä½œæˆåŠŸå®Œæˆã€‚</li><li>Rejectedï¼ˆå·²å¤±è´¥ï¼‰: æ“ä½œå¤±è´¥ã€‚</li></ul><h3 id="promise-æ‹’ç»æ•è·" tabindex="-1"><a class="header-anchor" href="#promise-æ‹’ç»æ•è·"><span>Promise æ‹’ç»æ•è·</span></a></h3><p>å½“ä¸€ä¸ª Promise å› ä¸ºæŸäº›åŸå› è¢«æ‹’ç»ï¼ˆæ¯”å¦‚æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼‰ï¼Œè€Œè¿™ä¸ªæ‹’ç»æ²¡æœ‰è¢«ç›¸åº”çš„<code>.catch()</code>æ–¹æ³•æˆ–<code>reject</code>å›è°ƒå‡½æ•°å¤„ç†æ—¶ï¼Œé€šå¸¸ä¼šåœ¨æ§åˆ¶å°äº§ç”Ÿä¸€ä¸ªè­¦å‘Šï¼Œæç¤ºæœ‰ä¸€ä¸ª&quot;Unhandled promise rejection&quot;ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºä¸­å‡ºç°éš¾ä»¥è¿½è¸ªå’Œå®šä½çš„ bugã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNode.js æä¾›äº†å‡ ç§æœºåˆ¶æ¥æ•è·å’Œå¤„ç†è¿™äº›æœªè¢«å¤„ç†çš„ Promise æ‹’ç»ã€‚ä» Node.js v12.17.0 å’Œ v13.7.0 å¼€å§‹ï¼Œå¼•å…¥äº†<code>captureRejectionSymbol</code>å±æ€§å’Œ<code>--unhandled-rejections</code>å‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><h3 id="å®ä¾‹è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹è¯´æ˜"><span>å®ä¾‹è¯´æ˜</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°<code>fetchData</code>ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª Promiseï¼Œæ¨¡æ‹Ÿå¼‚æ­¥è·å–ä¸€äº›æ•°æ®ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ŒPromise å°†ä¼šè¢«æ‹’ç»ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> fetchData</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> true;</span><span style="color:#616E88;"> // å‡è®¾å‘ç”Ÿäº†é”™è¯¯</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">      reject</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error fetching data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> id</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Success</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¼ ç»Ÿçš„å¤„ç†æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä¼ ç»Ÿçš„å¤„ç†æ–¹å¼"><span>ä¼ ç»Ÿçš„å¤„ç†æ–¹å¼ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">fetchData</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™é‡Œæ•è·å¹¶å¤„ç†Promiseè¢«æ‹’ç»çš„æƒ…å†µ</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½¿ç”¨eventemitterå’Œcapturerejections" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨eventemitterå’Œcapturerejections"><span>ä½¿ç”¨<code>EventEmitter</code>å’Œ<code>captureRejections</code>ï¼š</span></a></h4><p>Node.js å…è®¸<code>EventEmitter</code>å®ä¾‹é€šè¿‡è®¾ç½®<code>captureRejections</code>ä¸º<code>true</code>æ¥è‡ªåŠ¨æ•è· Promise çš„æ‹’ç»ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> captureRejections</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">Symbol</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">for</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nodejs.rejection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)] </span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> eventName</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">A promise rejection was caught from an event: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">eventName</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, with error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>EventEmitter</code>å®ä¾‹ï¼Œå¹¶é€šè¿‡è®¾ç½®<code>captureRejections: true</code>æ¥å¯ç”¨ Promise æ‹’ç»çš„è‡ªåŠ¨æ•è·ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒæ•…æ„æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†<code>Symbol.for(&#39;nodejs.rejection&#39;)</code>æ¥å®šä¹‰ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œå½“ Promise è¢«æ‹’ç»æ—¶ï¼Œè¿™ä¸ªå¤„ç†å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œä»è€Œå…è®¸æˆ‘ä»¬ä¼˜é›…åœ°å¤„ç†é”™è¯¯ã€‚</p><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä½¿ç”¨ Node.js çš„è¿™äº›ç‰¹æ€§ï¼Œä½ å¯ä»¥æ›´æœ‰æ•ˆåœ°ç®¡ç†å’Œå“åº”å¼‚æ­¥æ“ä½œä¸­çš„é”™è¯¯ï¼Œé¿å…åº”ç”¨ç¨‹åºå› æœªå¤„ç†çš„ Promise æ‹’ç»è€Œå´©æºƒæˆ–è¡¨ç°å‡ºä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚è¿™å¯¹äºç¼–å†™å¥å£®ã€å¯ç»´æŠ¤çš„ Node.js åº”ç”¨ç¨‹åºæ˜¯éå¸¸é‡è¦çš„ã€‚</p><h2 id="class-eventemitter" tabindex="-1"><a class="header-anchor" href="#class-eventemitter"><span><a href="https://nodejs.org/docs/latest/api/events.html#class-eventemitter" target="_blank" rel="noopener noreferrer">Class: EventEmitter</a></span></a></h2><p>Node.js çš„ <code>EventEmitter</code> ç±»æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒç»„ä»¶ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¹¿æ’­ç«™ï¼Œä¸åŒçš„æ¨¡å—æˆ–è€…ä»£ç ç‰‡æ®µå¯ä»¥å‘è¿™ä¸ªå¹¿æ’­ç«™å‘é€ï¼ˆè§¦å‘ï¼‰æ¶ˆæ¯ï¼ˆäº‹ä»¶ï¼‰ï¼Œè€Œå…¶ä»–æ¨¡å—å¯ä»¥ç›‘å¬ï¼ˆè®¢é˜…ï¼‰è¿™äº›æ¶ˆæ¯å¹¶ä½œå‡ºå“åº”ã€‚è¿™ç§æœºåˆ¶ä½¿å¾—ä¸åŒéƒ¨åˆ†çš„ä»£ç èƒ½å¤Ÿä»¥éå¸¸æ¾æ•£è€¦åˆçš„æ–¹å¼è¿›è¡Œäº¤äº’ï¼Œä»è€Œå¢å¼ºäº†ä»£ç çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨æ·±å…¥ç ”ç©¶ä¹‹å‰ï¼Œå…ˆä»‹ç»å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ul><li><strong>äº‹ä»¶ï¼ˆEventsï¼‰</strong>ï¼šä¸€ä¸ªæ ‡è¯†ï¼Œè¡¨æ˜æŸç§äº‹æƒ…å·²ç»å‘ç”Ÿã€‚ä¾‹å¦‚ï¼Œâ€œè¿æ¥æˆåŠŸâ€æˆ–â€œæ–‡ä»¶è¯»å–å®Œæˆâ€ã€‚</li><li><strong>è§¦å‘ï¼ˆEmitï¼‰</strong>ï¼šå½“æŸä¸ªç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡ <code>EventEmitter</code> å‘å‡ºä¿¡å·çš„åŠ¨ä½œã€‚</li><li><strong>ç›‘å¬ï¼ˆListenï¼‰</strong>ï¼šå¯¹ç‰¹å®šäº‹ä»¶æ„Ÿå…´è¶£å¹¶æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œç›¸å…³æ“ä½œã€‚</li></ul><h3 id="å®ä¾‹åŒ–-eventemitter" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åŒ–-eventemitter"><span>å®ä¾‹åŒ– EventEmitter</span></a></h3><p>åœ¨ Node.js ä¸­ä½¿ç”¨ <code>EventEmitter</code> éœ€è¦å…ˆå¯¼å…¥ <code>events</code> æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥å¯ä»¥åˆ›å»º <code>EventEmitter</code> çš„å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨-eventemitter" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-eventemitter"><span>ä½¿ç”¨ EventEmitter</span></a></h3><p>ä¸€æ—¦æœ‰äº† <code>EventEmitter</code> çš„å®ä¾‹ï¼Œå°±å¯ä»¥å¼€å§‹å®šä¹‰äº‹ä»¶å’Œç›‘å¬å™¨äº†ã€‚</p><h4 id="è§¦å‘äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#è§¦å‘äº‹ä»¶"><span>è§¦å‘äº‹ä»¶</span></a></h4><p>ä½¿ç”¨ <code>.emit()</code> æ–¹æ³•è§¦å‘äº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶åç§°ï¼Œåé¢çš„å‚æ•°æ˜¯ä¼ é€’ç»™ç›‘å¬å™¨çš„æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="ç›‘å¬äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬äº‹ä»¶"><span>ç›‘å¬äº‹ä»¶</span></a></h4><p>ä½¿ç”¨ <code>.on()</code> æ–¹æ³•ç›‘å¬äº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹ä»¶è§¦å‘æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å½“ &#39;event&#39; è¢«è§¦å‘æ—¶ï¼Œè¾“å‡º &#39;Hello World!&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-ç®€å•çš„äº‹ä»¶ç›‘å¬ä¸è§¦å‘" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç®€å•çš„äº‹ä»¶ç›‘å¬ä¸è§¦å‘"><span>ç¤ºä¾‹ 1ï¼šç®€å•çš„äº‹ä»¶ç›‘å¬ä¸è§¦å‘</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ä¸€ä¸ªåä¸º &#39;greet&#39; çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;greet&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœå°†ä¼šæ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Hello world!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å¸¦å‚æ•°çš„äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¸¦å‚æ•°çš„äº‹ä»¶"><span>ç¤ºä¾‹ 2ï¼šå¸¦å‚æ•°çš„äº‹ä»¶</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬å¸¦å‚æ•°çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">say</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> says: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;say&#39; äº‹ä»¶ï¼Œå¹¶ä¼ é€’å‚æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">say</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Alice says: Hello!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-3-å¼‚æ­¥äº‹ä»¶ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-å¼‚æ­¥äº‹ä»¶ç›‘å¬"><span>ç¤ºä¾‹ 3ï¼šå¼‚æ­¥äº‹ä»¶ç›‘å¬</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ process.nextTick æ¥ç¡®ä¿å¼‚æ­¥æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">nextTick</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This happens asynchronously.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ç¡®ä¿äº‹ä»¶ç›‘å¬å™¨å¼‚æ­¥åœ°æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p><code>EventEmitter</code> æ˜¯ Node.js ä¸­ç®¡ç†å’Œå¤„ç†äº‹ä»¶çš„åŸºçŸ³ã€‚å®ƒå…è®¸ä½ åˆ›å»ºé«˜åº¦è§£è€¦çš„ç³»ç»Ÿï¼Œå…¶ä¸­ç»„ä»¶å¯ä»¥è‡ªç”±åœ°å‘å‡ºå’Œç›‘å¬å…¨å±€äº‹ä»¶ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>EventEmitter</code> å¦‚ä½•åœ¨å®é™…ä¸­åº”ç”¨ï¼Œä»è€Œå¸®åŠ©æ„å»ºçµæ´»ä¸”å¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="event-newlistener" tabindex="-1"><a class="header-anchor" href="#event-newlistener"><span><a href="https://nodejs.org/docs/latest/api/events.html#event-newlistener" target="_blank" rel="noopener noreferrer">Event: &#39;newListener&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¨¡å—å«åš <code>events</code> æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—ç”¨äºå¤„ç†äº‹ä»¶ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªé‚®å±€ï¼Œæ¯å½“æœ‰äººï¼ˆå³äº‹ä»¶ç›‘å¬å™¨ï¼‰æƒ³è¦æ¥æ”¶æŸç§ç±»å‹çš„ä¿¡ä»¶ï¼ˆå³ç‰¹å®šäº‹ä»¶ï¼‰ï¼Œä»–ä»¬å°±å»é‚®å±€ç™»è®°ï¼ˆå³æ³¨å†Œç›‘å¬å™¨ï¼‰ã€‚å½“è¿™ç§ç±»å‹çš„ä¿¡ä»¶åˆ°æ¥æ—¶ï¼ˆå³äº‹ä»¶å‘ç”Ÿï¼‰ï¼Œé‚®å±€å°±ä¼šæŠŠä¿¡ä»¶åˆ†å‘ç»™æ‰€æœ‰ç™»è®°æ¥æ”¶è¯¥ç±»å‹ä¿¡ä»¶çš„äººï¼ˆå³è°ƒç”¨æ‰€æœ‰å¯¹åº”äº‹ä»¶çš„ç›‘å¬å™¨ï¼‰ã€‚</p><p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œâ€œnewListenerâ€äº‹ä»¶æ‰®æ¼”ç€ç‰¹æ®Šçš„è§’è‰²ã€‚æ¯å½“æœ‰æ–°çš„ç›‘å¬å™¨è¢«æ·»åŠ åˆ°äº‹ä»¶è§¦å‘å™¨ä¸Šæ—¶ï¼Œ&quot;newListener&quot;äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚è¿™æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç›‘å¬å™¨è¢«çœŸæ­£æ·»åŠ åˆ°äº‹ä»¶è§¦å‘å™¨ä¹‹å‰åšä¸€äº›æ“ä½œï¼Œæ¯”å¦‚å¢åŠ é¢å¤–çš„æ—¥å¿—ã€åšä¸€äº›åˆå§‹åŒ–å·¥ä½œç­‰ã€‚</p><h3 id="ç†è§£-newlistener-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç†è§£-newlistener-äº‹ä»¶"><span>ç†è§£ <code>newListener</code> äº‹ä»¶</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç»„ç»‡ä¸€åœºèšä¼šï¼ˆå³ä¸€ä¸ªäº‹ä»¶ï¼‰ï¼Œå¹¶ä¸”ä½ æƒ³çŸ¥é“æ¯å½“æœ‰äººå†³å®šå‚åŠ ï¼ˆå³æ·»åŠ æ–°çš„ç›‘å¬å™¨ï¼‰è¿™åœºèšä¼šæ—¶å¾—åˆ°é€šçŸ¥ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>newListener</code> äº‹ä»¶æ¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ <code>newListener</code> äº‹ä»¶çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ³¨å†Œ &#39;newListener&#39; äº‹ä»¶çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newListener</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listener</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœ‰æ–°çš„ç›‘å¬å™¨æ·»åŠ åˆ° </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> äº‹ä»¶</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ ä¸€ä¸ªåä¸º &#39;joinParty&#39; çš„äº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">joinParty</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœ‰äººå†³å®šå‚åŠ èšä¼šï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æˆ‘ä»¬æ·»åŠ  &#39;joinParty&#39; ç›‘å¬å™¨æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#616E88;">// æˆ‘ä»¬ä¼šçœ‹åˆ° &#39;newListener&#39; äº‹ä»¶è¢«è§¦å‘ï¼Œå¹¶æ‰“å°å‡ºæ¶ˆæ¯ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>events</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>EventEmitter</code> çš„å®ä¾‹ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>.on()</code> æ–¹æ³•æ¥ä¸º <code>newListener</code> äº‹ä»¶æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨ç®€å•åœ°æ‰“å°å‡ºäº†ä¸€æ¡æ¶ˆæ¯å‘Šè¯‰æˆ‘ä»¬æœ‰æ–°çš„ç›‘å¬å™¨è¢«æ·»åŠ ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä¸ºè‡ªå®šä¹‰çš„ <code>joinParty</code> äº‹ä»¶æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ã€‚å› ä¸º <code>joinParty</code> ç›‘å¬å™¨çš„æ·»åŠ ï¼Œ<code>newListener</code> äº‹ä»¶è¢«è§¦å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°äº†ç›¸åº”çš„æç¤ºä¿¡æ¯ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><p><code>newListener</code> äº‹ä»¶çš„å®é™…åº”ç”¨åœºæ™¯åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li><strong>é¢„å¤„ç†</strong>: åœ¨ç›‘å¬å™¨è¢«æ­£å¼æ·»åŠ ä¹‹å‰è¿›è¡Œä¸€äº›é¢„å¤„ç†å·¥ä½œã€‚ä¾‹å¦‚ï¼ŒéªŒè¯ç›‘å¬å™¨çš„å‚æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæˆ–è€…æ ¹æ®éœ€è¦è¿›è¡Œä¸€äº›åˆå§‹åŒ–è®¾ç½®ã€‚</li><li><strong>æ—¥å¿—è®°å½•</strong>: åœ¨æ·»åŠ æ–°ç›‘å¬å™¨æ—¶è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œå¸®åŠ©å¼€å‘è€…ç†è§£ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œæ¯”å¦‚è·Ÿè¸ªäº‹ä»¶ç›‘å¬å™¨çš„æ•°é‡å’Œç§ç±»ã€‚</li><li><strong>æ¡ä»¶æ€§é˜»æ­¢</strong>: åŸºäºæŸäº›æ¡ä»¶é€»è¾‘å†³å®šæ˜¯å¦çœŸçš„æ·»åŠ è¿™ä¸ªç›‘å¬å™¨ï¼Œæ¯”å¦‚å½“å·²ç»æœ‰å¤ªå¤šçš„ç›‘å¬å™¨æ—¶æ‹’ç»æ·»åŠ ï¼Œä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚</li></ul><p>ä½¿ç”¨ <code>newListener</code> äº‹ä»¶èƒ½å¤Ÿæä¾›æ›´å¥½çš„æ§åˆ¶å’Œå¯è§‚æµ‹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ç®¡ç†äº‹ä»¶ç›‘å¬å™¨æ—¶ã€‚</p><h3 id="event-removelistener" tabindex="-1"><a class="header-anchor" href="#event-removelistener"><span><a href="https://nodejs.org/docs/latest/api/events.html#event-removelistener" target="_blank" rel="noopener noreferrer">Event: &#39;removeListener&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒä½¿ç”¨éé˜»å¡ã€äº‹ä»¶é©±åŠ¨çš„æ¶æ„ï¼Œå…è®¸å¼€å‘äººå‘˜ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯è„šæœ¬ã€‚åœ¨ Node.js ä¸­æœ‰ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¨¡å—å«åš <code>events</code>ï¼Œè¿™ä¸ªæ¨¡å—ç”¨äºå¤„ç†äº‹ä»¶ï¼Œå¦‚åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘äº‹ä»¶ç­‰ã€‚</p><h3 id="äº‹ä»¶-removelistener" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶-removelistener"><span>äº‹ä»¶: &#39;removeListener&#39;</span></a></h3><p>åœ¨ Node.js çš„ <code>events</code> æ¨¡å—ä¸­, <code>removeListener</code> äº‹ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„äº‹ä»¶ï¼Œå®ƒåœ¨æ¯å½“ <code>.removeListener()</code> æˆ– <code>.off()</code> æ–¹æ³•è¢«è°ƒç”¨ä»¥ç§»é™¤æŸä¸ªç›‘å¬å™¨æ—¶è§¦å‘ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ä½ ä¸å†éœ€è¦ç›‘å¬æŸä¸ªäº‹ä»¶æ—¶ï¼Œä½ ä¼šç”¨ <code>.removeListener()</code> æ–¹æ³•æŠŠä¹‹å‰æ·»åŠ çš„ç›‘å¬å™¨ç§»é™¤æ‰ï¼Œè¿™ä¸ªåŠ¨ä½œå®Œæˆæ—¶ï¼Œ<code>removeListener</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œä½ å¯èƒ½ä¼šç›‘å¬ <code>message</code> äº‹ä»¶æ¥æ¥æ”¶æ–°æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œå½“ç”¨æˆ·ç¦»å¼€èŠå¤©å®¤æ—¶ï¼Œä½ ä¸å†éœ€è¦æ¥æ”¶æ¶ˆæ¯ï¼Œå› æ­¤ä½ ä¼šç§»é™¤è¿™ä¸ª <code>message</code> äº‹ä»¶çš„ç›‘å¬å™¨ã€‚è¿™æ—¶å€™ï¼Œ<code>removeListener</code> äº‹ä»¶å°±å¯ä»¥è¢«ç”¨æ¥æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œæˆ–è€…è®°å½•æ—¥å¿—ç­‰æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> ChatRoom</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª ChatRoom å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chatRoom</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ChatRoom</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">content</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">New message: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">content</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ message äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onMessage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬å†³å®šä¸å†ç›‘å¬ message äº‹ä»¶</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onMessage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">No longer listening to &quot;message&quot; events.</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ removeListener äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">removeListener</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listener</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">A listener was removed from the event: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿæ¥æ”¶æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»è¿‡ä¸€æ®µæ—¶é—´åï¼ŒremoveListener äº‹ä»¶è¢«è§¦å‘ï¼Œå¹¶è¾“å‡ºä¿¡æ¯åˆ°æ§åˆ¶å°ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>events</code> æ¨¡å—ï¼Œå¹¶é€šè¿‡ç»§æ‰¿ <code>EventEmitter</code> ç±»åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>ChatRoom</code> çš„æ–°ç±»ã€‚</li><li>æ¥ç€ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–äº† <code>ChatRoom</code> ç±»ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>onMessage</code> çš„å›è°ƒå‡½æ•°ï¼Œç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚</li><li>é€šè¿‡ <code>.on()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°† <code>onMessage</code> å‡½æ•°ä½œä¸º <code>message</code> äº‹ä»¶çš„ç›‘å¬å™¨ã€‚</li><li>ä½¿ç”¨ <code>setTimeout</code> æ¨¡æ‹Ÿäº†ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>.removeListener()</code> æ–¹æ³•ç§»é™¤äº† <code>message</code> äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œæ­¤æ—¶ <code>removeListener</code> äº‹ä»¶è¢«è§¦å‘ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸Šè¾“å‡ºç›¸å…³ä¿¡æ¯ã€‚</li><li>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿè®¾ç½®äº†å¯¹ <code>removeListener</code> äº‹ä»¶çš„ç›‘å¬ï¼Œå½“ä»»ä½•ç›‘å¬å™¨è¢«ç§»é™¤æ—¶ï¼Œéƒ½ä¼šæ‰§è¡ŒæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</li></ol><p>é€šè¿‡è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>removeListener</code> äº‹ä»¶çš„å®é™…åº”ç”¨åœºæ™¯åŠå…¶ä½œç”¨ï¼šå³åœ¨ç›‘å¬å™¨è¢«ç§»é™¤æ—¶è¿›è¡Œé¢å¤–çš„æ“ä½œæˆ–é€šçŸ¥ã€‚</p><h3 id="emitter-addlistener-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-addlistener-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitteraddlistenereventname-listener" target="_blank" rel="noopener noreferrer">emitter.addListener(eventName, listener)</a></span></a></h3><p>åœ¨æ·±å…¥è§£é‡Š<code>emitter.addListener(eventName, listener)</code>ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Node.js çš„åŸºæœ¬æ¦‚å¿µã€‚Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå«äº‹ä»¶é©±åŠ¨ï¼ˆEvent-Drivenï¼‰ï¼Œè¿™æ„å‘³ç€å¾ˆå¤šæ“ä½œï¼ˆæ¯”å¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰éƒ½æ˜¯åŸºäºäº‹ä»¶å®Œæˆçš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯emitter-addlistener-eventname-listener" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯emitter-addlistener-eventname-listener"><span>ä»€ä¹ˆæ˜¯<code>emitter.addListener(eventName, listener)</code>?</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>emitter.addListener(eventName, listener)</code>æ˜¯äº‹ä»¶æ¨¡å—ï¼ˆ<code>events</code>æ¨¡å—ï¼‰ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå‘æŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°<code>eventName</code>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦ç›‘å¬çš„äº‹ä»¶åç§°ï¼›ç¬¬äºŒä¸ªå‚æ•°<code>listener</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å…è®¸ä½ å®šä¹‰å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶åº”è¯¥æ‰§è¡Œçš„åŠ¨ä½œã€‚</p><h3 id="å‚æ•°è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯¦è§£"><span>å‚æ•°è¯¦è§£</span></a></h3><ul><li><code>eventName</code>: äº‹ä»¶åç§°ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œè¡¨ç¤ºä½ æƒ³è¦ç›‘å¬çš„ç‰¹å®šäº‹ä»¶ã€‚</li><li><code>listener</code>: ç›‘å¬å™¨å‡½æ•°ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒNode.js ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶ä»»ä½•ç”±äº‹ä»¶è§¦å‘æ—¶ä¼ é€’çš„å‚æ•°ã€‚</li></ul><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶"><span>ä¾‹å­ 1: ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œæ¯å½“æ–°ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œä½ æƒ³è®°å½•æ—¥å¿—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºäº‹ä»¶å‘å°„å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ addListener æ–¹æ³•ä¸º &#39;newUser&#39; äº‹ä»¶æ·»åŠ ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newUser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">userName</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ–°ç”¨æˆ·æ³¨å†Œ: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">userName</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿç”¨æˆ·æ³¨å†Œäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newUser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">å¼ ä¸‰</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„<code>events</code>æ¨¡å—å¹¶åˆ›å»ºäº†ä¸€ä¸ª<code>EventEmitter</code>å®ä¾‹ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>addListener</code>æ–¹æ³•ä¸º<code>newUser</code>äº‹ä»¶æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>emit</code>æ–¹æ³•æ¨¡æ‹Ÿäº†ä¸€ä¸ªç”¨æˆ·æ³¨å†Œçš„äº‹ä»¶ï¼Œå¹¶ä¼ é€’äº†ç”¨æˆ·åâ€œå¼ ä¸‰â€ä½œä¸ºå‚æ•°ã€‚è¿™ä¼šè§¦å‘æˆ‘ä»¬ä¹‹å‰æ·»åŠ çš„ç›‘å¬å™¨ï¼Œæ‰“å°å‡ºâ€œæ–°ç”¨æˆ·æ³¨å†Œ: å¼ ä¸‰â€ã€‚</p><h4 id="ä¾‹å­-2-ç›‘å¬å†…ç½®äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç›‘å¬å†…ç½®äº‹ä»¶"><span>ä¾‹å­ 2: ç›‘å¬å†…ç½®äº‹ä»¶</span></a></h4><p>é™¤äº†è‡ªå®šä¹‰äº‹ä»¶ï¼Œ<code>addListener</code>ä¹Ÿå¯ä»¥ç”¨æ¥ç›‘å¬ Node.js å†…ç½®çš„äº‹ä»¶ï¼Œä¾‹å¦‚ï¼Œç›‘æ§ä¸€ä¸ª HTTP æœåŠ¡å™¨çš„<code>request</code>äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¸º &#39;request&#39; äº‹ä»¶æ·»åŠ ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#81A1C1;"> ${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯åŠ¨æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨<code>addListener</code>æ–¹æ³•ç›‘å¬<code>request</code>äº‹ä»¶ã€‚æ¯å½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ª HTTP è¯·æ±‚æ—¶ï¼Œå°±ä¼šè§¦å‘<code>request</code>äº‹ä»¶ï¼Œè°ƒç”¨æˆ‘ä»¬æä¾›çš„ç›‘å¬å™¨å‡½æ•°ï¼Œè®°å½•è¯·æ±‚çš„æ–¹æ³•å’Œ URLï¼Œç„¶åå“åº”â€œHello World!â€ã€‚</p><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h3><p>æ€»çš„æ¥è¯´ï¼Œ<code>emitter.addListener(eventName, listener)</code>æ˜¯ Node.js ä¸­å¤„ç†äº‹ä»¶çš„é‡è¦æ–¹æ³•ä¹‹ä¸€ã€‚å®ƒä½¿å¾—åœ¨åº”ç”¨ä¸­æ·»åŠ å¯¹ç‰¹å®šäº‹ä»¶çš„ç›‘å¬å˜å¾—éå¸¸ç®€å•ï¼Œæ— è®ºæ˜¯è‡ªå®šä¹‰äº‹ä»¶è¿˜æ˜¯å†…ç½®äº‹ä»¶ï¼Œéƒ½èƒ½æœ‰æ•ˆæ”¯æŒå¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ Node.js åº”ç”¨ç¨‹åºã€‚</p><h3 id="emitter-emit-eventname-args" tabindex="-1"><a class="header-anchor" href="#emitter-emit-eventname-args"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitteremiteventname-args" target="_blank" rel="noopener noreferrer">emitter.emit(eventName[, ...args])</a></span></a></h3><p>å½“ä½ æƒ³è¦ç†è§£<code>emitter.emit(eventName[, ...args])</code>è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œå¯ä»¥å°†å®ƒæƒ³è±¡æˆä¸€ä¸ªæ— çº¿ç”µå°çš„å¹¿æ’­ç³»ç»Ÿã€‚åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼Œ<code>emit</code>æ–¹æ³•å…¶å®å°±æ˜¯å¹¿æ’­ç”µå°å‘é€ä¿¡å·çš„æ–¹å¼ï¼Œè€Œ<code>eventName</code>åˆ™æ˜¯ç‰¹å®šçš„é¢‘é“ã€‚ä»»ä½•è®¢é˜…äº†è¿™ä¸ªé¢‘é“ï¼ˆå³æ³¨å†Œäº†è¯¥äº‹ä»¶åç§°çš„ç›‘å¬å™¨ï¼‰çš„æ¥æ”¶å™¨ï¼ˆæˆ–è€…è¯´ç›‘å¬å™¨ï¼‰éƒ½å¯ä»¥æ¥æ”¶åˆ°è¿™ä¸ªä¿¡å·ï¼Œå¹¶æ ¹æ®æ”¶åˆ°çš„ä¿¡æ¯åšå‡ºç›¸åº”çš„ååº”ã€‚å‚æ•°<code>...args</code>å°±å¥½æ¯”æ˜¯å¹¿æ’­å†…å®¹ï¼Œå¯ä»¥ä¼ é€’ç»™ç›‘å¬äº‹ä»¶çš„å¤„ç†å‡½æ•°ã€‚</p><p>Node.js ä¸­çš„ EventEmitter ç±»æ˜¯ç”¨äºå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒã€‚å®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªäº‹ä»¶å‘å°„å™¨å®ä¾‹ï¼Œå¹¶é€šè¿‡è¿™ä¸ªå®ä¾‹ç®¡ç†äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨ã€‚è¿™ç§æœºåˆ¶åœ¨ Node.js ä¸­éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒæ”¯æŒäº† Node.js çš„éé˜»å¡äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œä½¿å¾— Node.js å¯ä»¥å¤„ç†é«˜å¹¶å‘è€Œä¸ä¼šä¸¢å¤±æ•°æ®ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h3><h4 id="ç¤ºä¾‹-1-ç®€å•çš„äº‹ä»¶è§¦å‘" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç®€å•çš„äº‹ä»¶è§¦å‘"><span>ç¤ºä¾‹ 1: ç®€å•çš„äº‹ä»¶è§¦å‘</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­¦ä¹ å¹³å°ï¼Œæ¯å½“æœ‰æ–°è¯¾ç¨‹å‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€šçŸ¥æ‰€æœ‰åœ¨çº¿çš„å­¦ç”Ÿã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªè¿™ä¸ªç±»çš„å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰å½“æ–°è¯¾ç¨‹å‘å¸ƒäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ€æ ·é€šçŸ¥å­¦ç”Ÿï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;newCourse&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newCourse</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">course</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ–°è¯¾ç¨‹å‘å¸ƒäº†: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">course</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œå½“æ–°è¯¾ç¨‹çœŸæ­£å‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬è§¦å‘<code>newCourse</code>äº‹ä»¶å¹¶ä¼ é€’è¯¾ç¨‹ä¿¡æ¯ä½œä¸ºå‚æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// è§¦å‘&#39;newCourse&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newCourse</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.jså…¥é—¨åˆ°æ”¾å¼ƒ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å¤šä¸ªå‚æ•°çš„äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¤šä¸ªå‚æ•°çš„äº‹ä»¶"><span>ç¤ºä¾‹ 2: å¤šä¸ªå‚æ•°çš„äº‹ä»¶</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªæ›´å¤æ‚çš„åœºæ™¯ï¼Œè¯¾ç¨‹å‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬ä¸ä»…è¦å‘å¸ƒè¯¾ç¨‹åï¼Œè¿˜è¦å‘å¸ƒè®²å¸ˆä¿¡æ¯å’Œå¼€å§‹æ—¶é—´ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾ç½®ç›‘å¬å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;newCourse&#39;äº‹ä»¶ï¼Œè¿™æ¬¡æˆ‘ä»¬ç›‘å¬ä¸‰ä¸ªå‚æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newCourse</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">course</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> instructor</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">æ–°è¯¾ç¨‹å‘å¸ƒäº†: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">course</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, è®²å¸ˆ: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">instructor</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, å¼€å§‹æ—¶é—´: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">startTime</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œå½“è¯¾ç¨‹å‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬ä¼ é€’æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// è§¦å‘&#39;newCourse&#39;äº‹ä»¶ï¼Œä¼ é€’é¢å¤–çš„å‚æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newCourse</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.jsé«˜çº§ç¼–ç¨‹</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ç‹è€å¸ˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2023-05-01 10:00</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸¤ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>emitter.emit(eventName[, ...args])</code>å¦‚ä½•åœ¨ Node.js åº”ç”¨ä¸­ä¸ºä¸åŒçš„äº‹ä»¶æºå’Œç›‘å¬å™¨æä¾›ä¸€ç§é€šä¿¡æœºåˆ¶ã€‚è¿™ç§æ¨¡å¼éå¸¸çµæ´»ä¸”å¼ºå¤§ï¼Œæ˜¯ Node.js å¼‚æ­¥éé˜»å¡æ¶æ„çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</p><h3 id="emitter-eventnames" tabindex="-1"><a class="header-anchor" href="#emitter-eventnames"><span><a href="https://nodejs.org/docs/latest/api/events.html#emittereventnames" target="_blank" rel="noopener noreferrer">emitter.eventNames()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>emitter.eventNames()</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå±äº Events æ¨¡å—ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯åˆ—å‡ºä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼ˆEventEmitterï¼‰å®ä¾‹ä¸Šå½“å‰æ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨çš„äº‹ä»¶åã€‚</p><p>è¦ç†è§£ <code>emitter.eventNames()</code>ï¼Œé¦–å…ˆéœ€è¦äº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼š<code>EventEmitter</code> å’Œ äº‹ä»¶ç›‘å¬å™¨ï¼ˆEvent Listenerï¼‰ã€‚</p><h3 id="eventemitter" tabindex="-1"><a class="header-anchor" href="#eventemitter"><span>EventEmitter</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªç±»ï¼Œç”¨äºå¤„ç†äº‹ä»¶å’Œäº‹ä»¶è§¦å‘çš„æœºåˆ¶ã€‚ä½ å¯ä»¥å°†å…¶çœ‹ä½œæ˜¯ä¸€ä¸ªäº‹ä»¶çš„ä¸­å¿ƒç«™ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºã€è§¦å‘å’Œç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨å¯¹è±¡ä¸­ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚å°±æ˜¯é€šè¿‡è¿™ç§æœºåˆ¶å®ç°çš„ã€‚</p><h3 id="äº‹ä»¶ç›‘å¬å™¨-event-listener" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶ç›‘å¬å™¨-event-listener"><span>äº‹ä»¶ç›‘å¬å™¨ (Event Listener)</span></a></h3><p>äº‹ä»¶ç›‘å¬å™¨æ˜¯ç»‘å®šåœ¨ç‰¹å®šäº‹ä»¶ä¸Šçš„å‡½æ•°ï¼Œå½“è¿™ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå¯¹åº”çš„ç›‘å¬å™¨å°±ä¼šè¢«è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½®äº†ä¸€ä¸ªç›‘å¬å™¨æ¥å“åº”ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„äº‹ä»¶ï¼Œé‚£ä¹ˆæ¯å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œè¯¥ç›‘å¬å™¨å°±ä¼šæ‰§è¡Œã€‚</p><h3 id="emitter-eventnames-1" tabindex="-1"><a class="header-anchor" href="#emitter-eventnames-1"><span>emitter.eventNames()</span></a></h3><p>ç°åœ¨å›åˆ° <code>emitter.eventNames()</code>ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„åŒ…å«äº†ç»‘å®šåˆ°ç‰¹å®š <code>EventEmitter</code> å®ä¾‹ä¸Šçš„æ‰€æœ‰äº‹ä»¶åç§°ã€‚è¿™å¯ä»¥ç”¨äºè°ƒè¯•ï¼Œæˆ–è€…ç®€å•åœ°äº†è§£æŸä¸ªæ—¶åˆ»äº‹ä»¶å‘å°„å™¨ä¸Šæœ‰å“ªäº›äº‹ä»¶æ­£åœ¨ç›‘å¬ã€‚</p><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„ç½‘ç»œåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦å¤„ç†ç”¨æˆ·çš„è¿æ¥å’Œæ–­å¼€è¿æ¥äº‹ä»¶ã€‚ä¸ºäº†ç®¡ç†è¿™äº›äº‹ä»¶ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·ç¼–ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;connection&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸€ä¸ªç”¨æˆ·è¿æ¥äº†</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;disconnection&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">disconnection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸€ä¸ªç”¨æˆ·æ–­å¼€äº†è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ­¤æ—¶ï¼Œä½¿ç”¨ emitter.eventNames() å°†ä¼šè¿”å› [&#39;connection&#39;, &#39;disconnection&#39;]</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">eventNames</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¾“å‡º: [ &#39;connection&#39;, &#39;disconnection&#39; ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥ <code>events</code> æ¨¡å—å¹¶ä½¿ç”¨ <code>EventEmitter</code> ç±»æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å‘å°„å™¨å®ä¾‹ <code>myEmitter</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>.on()</code> æ–¹æ³•ä¸ºè¿™ä¸ªå®ä¾‹æ·»åŠ äº†ä¸¤ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œåˆ†åˆ«ç›‘å¬ <code>&#39;connection&#39;</code> å’Œ <code>&#39;disconnection&#39;</code> äº‹ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>emitter.eventNames()</code> æ¥è·å–å¹¶æ‰“å°å‡ºå½“å‰æ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶åç§°ï¼Œè¾“å‡ºç»“æœå°†ä¼šæ˜¯ä¸€ä¸ªåŒ…å« <code>&#39;connection&#39;</code> å’Œ <code>&#39;disconnection&#39;</code> çš„æ•°ç»„ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ <code>emitter.eventNames()</code> æ–¹æ³•åŠå…¶ç”¨é€”ã€‚</p><h3 id="emitter-getmaxlisteners" tabindex="-1"><a class="header-anchor" href="#emitter-getmaxlisteners"><span><a href="https://nodejs.org/docs/latest/api/events.html#emittergetmaxlisteners" target="_blank" rel="noopener noreferrer">emitter.getMaxListeners()</a></span></a></h3><p>äº†è§£ <code>emitter.getMaxListeners()</code> å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„äº‹ä»¶æœºåˆ¶å’Œ EventEmitter ç±»ã€‚</p><p>Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œè¿™æ„å‘³ç€å¾ˆå¤š Node.js çš„æ ¸å¿ƒ API éƒ½æ˜¯å›´ç»•ç€äº‹ä»¶æ„å»ºçš„ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ–‡ä»¶è¯»å–å®Œæˆæˆ–è€…ç½‘ç»œè¯·æ±‚æ¥æ”¶åˆ°å“åº”æ—¶ï¼Œä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ã€‚åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ EventEmitter ç±»æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚</p><p>EventEmitter æ˜¯ Node.js çš„ä¸€ä¸ªæ ¸å¿ƒç±»ï¼Œç”¨äºå¤„ç†äº‹ä»¶ã€‚ä½ å¯ä»¥å°†å®ƒæƒ³è±¡æˆä¸€ä¸ªäº‹ä»¶è°ƒåº¦ä¸­å¿ƒï¼Œå®ƒå¯ä»¥è®©ä½ åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘äº‹ä»¶ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥ <code>emitter.getMaxListeners()</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="emitter-getmaxlisteners-1" tabindex="-1"><a class="header-anchor" href="#emitter-getmaxlisteners-1"><span><code>emitter.getMaxListeners()</code></span></a></h3><ul><li><strong>ä½œç”¨</strong>ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºè¿”å›å½“å‰ EventEmitter å®ä¾‹ä¸Šé¢çš„æœ€å¤§ç›‘å¬å™¨ï¼ˆå³å›è°ƒå‡½æ•°ï¼‰æ•°é‡é™åˆ¶ã€‚</li><li><strong>é»˜è®¤å€¼</strong>ï¼šEventEmitter é»˜è®¤å…è®¸æ¯ä¸ªäº‹ä»¶æœ€å¤šæ·»åŠ  10 ä¸ªç›‘å¬å™¨ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªé™åˆ¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦æœ‰æœ€å¤§ç›‘å¬å™¨æ•°é‡çš„é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦æœ‰æœ€å¤§ç›‘å¬å™¨æ•°é‡çš„é™åˆ¶"><span>ä¸ºä»€ä¹ˆè¦æœ‰æœ€å¤§ç›‘å¬å™¨æ•°é‡çš„é™åˆ¶ï¼Ÿ</span></a></h3><p>è¿™ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒåœ¨åŒä¸€ä¸ªäº‹ä»¶ä¸Šæ·»åŠ äº†å¤ªå¤šçš„ç›‘å¬å™¨ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œè¿™å°†å¯¼è‡´ç¨‹åºæ€§èƒ½é—®é¢˜ï¼Œç”šè‡³å´©æºƒã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™æœåŠ¡å™¨ï¼Œä½ ä½¿ç”¨ EventEmitter æ¥å¤„ç† http è¯·æ±‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyServer</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬ä¸º &#39;request&#39; äº‹ä»¶æ³¨å†Œäº†å¾ˆå¤šç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¤„ç†ç¬¬ä¸€ä¸ªè¯·æ±‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¤„ç†å¦ä¸€ä¸ªè¯·æ±‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ...æ›´å¤šç›‘å¬å™¨...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æŸ¥çœ‹æœ€å¤§ç›‘å¬å™¨æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getMaxListeners</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºé»˜è®¤å°†ä¼šæ˜¯ <code>10</code>ï¼Œå› ä¸ºè¿™æ˜¯é»˜è®¤çš„æœ€å¤§ç›‘å¬å™¨æ•°é‡ã€‚</p><h3 id="ä¿®æ”¹æœ€å¤§ç›‘å¬å™¨æ•°é‡" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹æœ€å¤§ç›‘å¬å™¨æ•°é‡"><span>ä¿®æ”¹æœ€å¤§ç›‘å¬å™¨æ•°é‡</span></a></h3><p>å¦‚æœä½ çŸ¥é“ä½ çš„åº”ç”¨éœ€æ±‚éœ€è¦æ›´å¤šçš„ç›‘å¬å™¨ï¼Œå¹¶ä¸”ä½ å·²ç»å¯¹æ­¤è¿›è¡Œäº†ç›¸åº”çš„å†…å­˜ç®¡ç†ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>emitter.setMaxListeners(n)</code> æ¥ä¿®æ”¹æœ€å¤§ç›‘å¬å™¨æ•°é‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getMaxListeners</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç°åœ¨è¾“å‡º 20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“ï¼Œ<code>emitter.getMaxListeners()</code> æ–¹æ³•å¸®åŠ©ä½ ç®¡ç†å’Œè°ƒæ•´äº‹ä»¶ç›‘å¬å™¨çš„æ•°é‡ï¼Œç¡®ä¿åº”ç”¨è¿è¡Œç¨³å®šï¼Œé¿å…å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚åœ¨è®¾è®¡äº‹ä»¶å¯†é›†å‹åº”ç”¨æ—¶ï¼Œåˆç†åˆ©ç”¨è¿™ä¸€åŠŸèƒ½éå¸¸é‡è¦ã€‚</p><h3 id="emitter-listenercount-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-listenercount-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitterlistenercounteventname-listener" target="_blank" rel="noopener noreferrer">emitter.listenerCount(eventName[, listener])</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•ä¸”æ˜“æ‡‚çš„æ–¹å¼æ¥è§£é‡Š Node.js ä¸­ <code>emitter.listenerCount(eventName[, listener])</code> çš„æ¦‚å¿µå’Œç”¨é€”ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>: è¿™æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚</li><li><strong>EventEmitter ç±»</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªæ ¸å¿ƒç±»ï¼Œç”¨äºå¤„ç†äº‹ä»¶ã€‚ä½ å¯ä»¥åˆ›å»ºå®ä¾‹ï¼ˆå¯¹è±¡ï¼‰æ¥ç»‘å®šï¼ˆç›‘å¬ï¼‰å’Œè§¦å‘ï¼ˆå‘å°„ï¼‰äº‹ä»¶ã€‚</li><li><strong>äº‹ä»¶</strong>: è¿™äº›æ˜¯ç”± <code>EventEmitter</code> å®ä¾‹ç®¡ç†çš„åŠ¨ä½œæˆ–è€…å‘ç”Ÿçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå½“æ–‡ä»¶è¢«è¯»å–å®Œæˆæ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘ä¸€ä¸ª &quot;read&quot; äº‹ä»¶ã€‚</li><li><strong>ç›‘å¬å™¨</strong>: è¿™äº›æ˜¯é™„åŠ åˆ°ç‰¹å®šäº‹ä»¶ä¸Šçš„å‡½æ•°ï¼Œå½“é‚£ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè¿™äº›å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>emitter.listenerCount(eventName[, listener])</code> æ–¹æ³•ï¼š</p><ul><li><strong>ç›®çš„</strong>: è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›æŒ‡å®šäº‹ä»¶åçš„ç›‘å¬å™¨æ•°é‡ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå‘Šè¯‰ä½ æœ‰å¤šå°‘ä¸ªç›‘å¬å™¨å‡½æ•°è¢«ç»‘å®šåˆ°äº†ç‰¹å®šçš„äº‹ä»¶ä¸Šã€‚</li><li><strong>å‚æ•°</strong>: <ul><li><code>eventName</code>: è¿™æ˜¯äº‹ä»¶åç§°çš„å­—ç¬¦ä¸²å€¼ï¼Œä»£è¡¨ä½ æƒ³æŸ¥è¯¢ç›‘å¬å™¨æ•°é‡çš„äº‹ä»¶ã€‚</li><li><code>listener</code> (å¯é€‰): è¿™æ˜¯ä¸€ä¸ªç‰¹å®šçš„ç›‘å¬å™¨å‡½æ•°ã€‚å¦‚æœæä¾›ï¼Œæ–¹æ³•å°†æ£€æŸ¥æ­¤ç‰¹å®šç›‘å¬å™¨æ˜¯å¦å­˜åœ¨äºäº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨ä¸­ã€‚</li></ul></li></ul><p><strong>å®é™…åº”ç”¨ç¤ºä¾‹</strong>:</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œä½ ä½¿ç”¨ Node.js æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚æ¯å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œä½ å¯èƒ½å¸Œæœ›çŸ¥é“å½“å‰å·²ç»æœ‰å¤šå°‘è¿æ¥è¢«å»ºç«‹ï¼Œä»¥ä¾¿è¿›è¡Œé€‚å½“çš„èµ„æºåˆ†é…æˆ–é™æµã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å¼•å…¥ EventEmitter ç±»ã€‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º EventEmitter å®ä¾‹ã€‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿå®¢æˆ·ç«¯è¿æ¥äº‹ä»¶å¹¶æ·»åŠ ç›‘å¬å™¨ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–°çš„å®¢æˆ·ç«¯è¿æ¥!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å†æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ä½œä¸ºç¤ºä¾‹ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">åˆä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨æŸä¸ªæ—¶åˆ»æˆ‘ä»¬æƒ³çŸ¥é“æœ‰å¤šå°‘ä¸ªç›‘å¬å™¨å“åº”&#39;connection&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listenerCount</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// è¿™å°†è¾“å‡º: 2ï¼Œå› ä¸ºæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªç›‘å¬å™¨æ¥å“åº”&#39;connection&#39;äº‹ä»¶ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>server.listenerCount(&#39;connection&#39;)</code> æ¥è·å–ç»‘å®šåˆ° &#39;connection&#39; äº‹ä»¶çš„ç›‘å¬å™¨æ•°é‡ã€‚è¿™ç§æ–¹æ³•éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©ä½ æ ¹æ®ç›‘å¬å™¨çš„æ•°é‡æ¥åšå‡ºä¸€äº›é€»è¾‘å†³ç­–ï¼Œæ¯”å¦‚æ˜¯å¦éœ€è¦æ·»åŠ æ›´å¤šçš„ç›‘å¬å™¨ï¼Œæˆ–è€…æ˜¯å¦éœ€è¦ç§»é™¤ä¸€äº›ç›‘å¬å™¨æ¥é¿å…å†…å­˜æ³„æ¼ã€‚</p><h3 id="emitter-listeners-eventname" tabindex="-1"><a class="header-anchor" href="#emitter-listeners-eventname"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitterlistenerseventname" target="_blank" rel="noopener noreferrer">emitter.listeners(eventName)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¤„ç†æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒå…è®¸ä½ å“åº”ç‰¹å®šçš„è¡Œä¸ºï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»ã€å®Œæˆæ–‡ä»¶è¯»å–ç­‰ï¼‰ã€‚</p><p><code>emitter.listeners(eventName)</code> æ˜¯ Node.js äº‹ä»¶æ¨¡å—ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨æ¥è·å–æŒ‡å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ï¼ˆä¹Ÿå°±æ˜¯å½“è¯¥äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨çš„å‡½æ•°ï¼‰çš„æ•°ç»„ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©ä½ äº†è§£æŸä¸ªäº‹ä»¶æœ‰å¤šå°‘ä¸ªç›‘å¬å™¨ï¼Œä»¥åŠå®ƒä»¬æ˜¯ä»€ä¹ˆï¼Œä»è€Œå¸®åŠ©ä½ è¿›è¡Œè°ƒè¯•æˆ–ç®¡ç†è¿™äº›äº‹ä»¶ç›‘å¬å™¨ã€‚</p><h3 id="è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š"><span>è§£é‡Š</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> ç±»æ˜¯ç”¨æ¥å¤„ç†äº‹ä»¶çš„ã€‚ä¸€ä¸ª <code>EventEmitter</code> å®ä¾‹å¯ä»¥å®šä¹‰å’Œè§¦å‘äº‹ä»¶ã€‚æ¯ä¸ªäº‹ä»¶å¯ä»¥æœ‰å¤šä¸ªç›‘å¬å™¨å‡½æ•°ï¼Œå®ƒä»¬æŒ‰ç…§æ·»åŠ çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p><ul><li><strong>eventName</strong>: è¿™æ˜¯ä½ æƒ³è¦æŸ¥è¯¢ç›‘å¬å™¨çš„äº‹ä»¶åç§°ã€‚</li></ul><p>ä½¿ç”¨ <code>emitter.listeners(eventName)</code> æ–¹æ³•ï¼Œä½ å¯ä»¥è·å–åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº†ä¸ºç‰¹å®šäº‹ä»¶åæ³¨å†Œçš„æ‰€æœ‰ç›‘å¬å™¨å‡½æ•°å¼•ç”¨ã€‚è¿™å¯¹äºç†è§£äº‹ä»¶æµã€ä¼˜åŒ–æ€§èƒ½æˆ–ä»…ä»…æ˜¯è°ƒè¯•æ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„ç½‘ç»œåº”ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›è·Ÿè¸ªâ€œè¿æ¥â€äº‹ä»¶ï¼ˆå½“æ–°ç”¨æˆ·è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨æ—¶å‘ç”Ÿï¼‰çš„æ‰€æœ‰ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ ä¸¤ä¸ªç›‘å¬å™¨åˆ° &#39;connection&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> firstListener</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from the first listener!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> secondListener</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">arg1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> arg2</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Hello from the second listener! Got </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">arg1</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> and </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">arg2</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ emitter.listeners(eventName) è·å–æ‰€æœ‰ &#39;connection&#39; äº‹ä»¶çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> listeners</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">listeners</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: 2 - è¡¨ç¤ºæœ‰ä¸¤ä¸ªç›‘å¬å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è°ƒç”¨æ¯ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">listeners</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forEach</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">listener</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  listener</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">call</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">arg1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">arg2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>events</code> æ¨¡å—å¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>EventEmitter</code> çš„å®ä¾‹ <code>myEmitter</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¸ºä¸€ä¸ªåä¸º <code>connection</code> çš„äº‹ä»¶æ·»åŠ äº†ä¸¤ä¸ªç›‘å¬å™¨ã€‚é€šè¿‡è°ƒç”¨ <code>emitter.listeners(&#39;connection&#39;)</code>ï¼Œæˆ‘ä»¬è·å–åˆ°äº†ä¸€ä¸ªåŒ…å«è¿™ä¸¤ä¸ªç›‘å¬å™¨çš„æ•°ç»„ã€‚æœ€åï¼Œæˆ‘ä»¬éå†è¿™ä¸ªæ•°ç»„ï¼Œå¹¶æ‰‹åŠ¨è°ƒç”¨æ¯ä¸ªç›‘å¬å™¨å‡½æ•°ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•° <code>arg1</code> å’Œ <code>arg2</code>ã€‚</p><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>emitter.listeners(eventName)</code> æ–¹æ³•æ¥è·å–ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ï¼Œå¹¶ä¸”æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡è¿™äº›ç›‘å¬å™¨æ¥è¿›ä¸€æ­¥æ“ä½œæˆ–è°ƒè¯•ã€‚è¿™åœ¨å¼€å‘å¤æ‚çš„ Node.js åº”ç”¨æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ç²¾ç¡®æ§åˆ¶äº‹ä»¶ç›‘å¬å™¨çš„åœºæ™¯ä¸‹ã€‚</p><h3 id="emitter-off-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-off-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitteroffeventname-listener" target="_blank" rel="noopener noreferrer">emitter.off(eventName, listener)</a></span></a></h3><p>å½“ç„¶ï¼Œæˆ‘å¾ˆä¹æ„ä¸ºä½ è§£é‡Š Node.js ä¸­çš„ <code>emitter.off(eventName, listener)</code> æ–¹æ³•ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼ˆæ¯”å¦‚ä¸€ä¸ªç½‘ç»œè¯·æ±‚å®Œæˆäº†ï¼Œæ–‡ä»¶è¯»å–ç»“æŸäº†ç­‰ï¼‰ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Node.js çš„ <code>events</code> æ¨¡å—æ¥ç›‘å¬å’Œå¤„ç†è¿™äº›äº‹ä»¶ã€‚åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæœ€æ ¸å¿ƒçš„éƒ¨åˆ†æ˜¯ <code>EventEmitter</code> ç±»ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç±»å¯ä»¥åˆ›å»ºäº‹ä»¶è§¦å‘å™¨å¯¹è±¡ï¼ˆç®€ç§°ä¸ºâ€œå‘å°„å™¨â€æˆ–â€œå‘å¸ƒè€…â€ï¼‰ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥å‘å‡ºè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è®©æˆ‘ä»¬ç»‘å®šä¸€äº›å‡½æ•°ä½œä¸ºè¿™äº›äº‹ä»¶çš„å¤„ç†ç¨‹åºï¼ˆä¹Ÿå°±æ˜¯â€œç›‘å¬å™¨â€æˆ–â€œè®¢é˜…è€…â€ï¼‰ã€‚</p><h3 id="emitter-off-eventname-listener-1" tabindex="-1"><a class="header-anchor" href="#emitter-off-eventname-listener-1"><span><code>emitter.off(eventName, listener)</code></span></a></h3><ul><li><p><strong>åŠŸèƒ½æè¿°</strong>ï¼š</p><ul><li>è¿™ä¸ªæ–¹æ³•ç”¨äºä»æŒ‡å®šçš„äº‹ä»¶ä¸Šç§»é™¤ä¸€ä¸ªç›‘å¬å™¨ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœä½ ä¹‹å‰é€šè¿‡ <code>.on()</code> æˆ– <code>.addListener()</code> æ–¹æ³•ç»™ä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ <code>emitter.off()</code> æ–¹æ³•æŠŠè¿™ä¸ªå¤„ç†å‡½æ•°å†ç§»é™¤æ‰ã€‚</li></ul></li><li><p><strong>å‚æ•°è§£é‡Š</strong>ï¼š</p><ul><li><code>eventName</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œä»£è¡¨ä½ æƒ³è¦åœæ­¢ç›‘å¬çš„äº‹ä»¶åç§°ã€‚</li><li><code>listener</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ˜¯ä½ æƒ³è¦ä»è¯¥äº‹ä»¶ä¸Šç§»é™¤çš„ç›‘å¬å™¨ã€‚</li></ul></li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„äº‹ä»¶ç›‘å¬å¹¶å–æ¶ˆç›‘å¬" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„äº‹ä»¶ç›‘å¬å¹¶å–æ¶ˆç›‘å¬"><span>ç¤ºä¾‹ 1ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„äº‹ä»¶ç›‘å¬å¹¶å–æ¶ˆç›‘å¬</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¸Œæœ›è®°å½•æ¯æ¬¡æœ‰æ–°çš„è¿æ¥æ—¶çš„æ—¶é—´ã€‚ä½†åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è®°å½•è¿™ä¸ªä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœæ­¢ç›‘å¬è¿™ä¸ªäº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> logNewConnection</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœ‰æ–°çš„è¿æ¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Date</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬åä¸º &#39;connection&#39; çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> logNewConnection</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è®°å½•æ–°è¿æ¥</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç§»é™¤å¯¹ &#39;connection&#39; äº‹ä»¶çš„ç›‘å¬</span></span>
<span class="line"><span style="color:#D8DEE9;">  myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">off</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> logNewConnection</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸å†è®°å½•æ–°è¿æ¥ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>events</code> æ¨¡å—å¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>EventEmitter</code> å®ä¾‹ <code>myEmitter</code>ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¤„ç†å‡½æ•° <code>logNewConnection</code> å¹¶è®©å®ƒç›‘å¬ <code>connection</code> äº‹ä»¶ã€‚5 ç§’åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>off</code> æ–¹æ³•ç§»é™¤äº†è¿™ä¸ªç›‘å¬å™¨ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨ç§»é™¤ç›‘å¬å™¨å <code>connection</code> äº‹ä»¶å†æ¬¡è¢«è§¦å‘ï¼Œ<code>logNewConnection</code> å‡½æ•°å°†ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><h4 id="ç¤ºä¾‹-2-å¤šä¸ªç›‘å¬å™¨çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¤šä¸ªç›‘å¬å™¨çš„æƒ…å†µ"><span>ç¤ºä¾‹ 2ï¼šå¤šä¸ªç›‘å¬å™¨çš„æƒ…å†µ</span></a></h4><p>å¦‚æœä¸€ä¸ªäº‹ä»¶ä¸Šç»‘å®šäº†å¤šä¸ªç›‘å¬å™¨ï¼Œ<code>emitter.off()</code> æ–¹æ³•å¯ä»¥ç²¾ç¡®åœ°ç§»é™¤ç‰¹å®šçš„ä¸€ä¸ªç›‘å¬å™¨ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¬¬ä¸€ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> listenerOne</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç›‘å¬å™¨ä¸€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// ç¬¬äºŒä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> listenerTwo</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç›‘å¬å™¨äºŒ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»‘å®šç›‘å¬å™¨åˆ° &#39;eventOne&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">eventOne</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listenerOne</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">eventOne</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listenerTwo</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç§»é™¤ &#39;eventOne&#39; ä¸Šçš„ç¬¬ä¸€ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">off</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">eventOne</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listenerOne</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;eventOne&#39;ï¼Œæ­¤æ—¶åªæœ‰ listenerTwo ä¼šè¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">eventOne</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å³ä½¿ä¸€ä¸ªäº‹ä»¶ä¸Šæœ‰å¤šä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½é€šè¿‡ <code>emitter.off()</code> æ–¹æ³•å‡†ç¡®åœ°ç§»é™¤å…¶ä¸­çš„ä¸€ä¸ªç›‘å¬å™¨ã€‚</p><h3 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h3><p><code>emitter.off(eventName, listener)</code> æ–¹æ³•åœ¨ Node.js çš„äº‹ä»¶å¤„ç†ä¸­éå¸¸æœ‰ç”¨ï¼Œå®ƒæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å–æ¶ˆå¯¹ç‰¹å®šäº‹ä»¶çš„ç›‘å¬ï¼Œä»è€Œä½¿ä»£ç æ›´åŠ å¯æ§ï¼Œä¹Ÿä¾¿äºç®¡ç†èµ„æºå’Œé¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p><h3 id="emitter-on-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-on-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitteroneventname-listener" target="_blank" rel="noopener noreferrer">emitter.on(eventName, listener)</a></span></a></h3><p>Node.js ä¸­çš„<code>emitter.on(eventName, listener)</code>æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œç”¨äºäº‹ä»¶é©±åŠ¨ç¼–ç¨‹ã€‚æˆ‘ä¼šåˆ†æ­¥éª¤åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼Œå¹¶ç»™å‡ºä¸€äº›å®é™…çš„ä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-2"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½èƒ½å‘å°„ï¼ˆemitï¼‰äº‹ä»¶ï¼Œè¿™äº›å¯¹è±¡å®ä¾‹é€šå¸¸è¢«ç§°ä¸ºâ€œå‘å°„å™¨â€ï¼ˆemittersï¼‰ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç½‘ç»œè¿æ¥ï¼ˆnet.Socketï¼‰ä¼šåœ¨æ–°å®¢æˆ·ç«¯è¿æ¥æ—¶å‘å°„äº‹ä»¶ï¼Œä¸€ä¸ªæ–‡ä»¶æµï¼ˆfs.ReadStreamï¼‰ä¼šåœ¨æ–‡ä»¶è¢«æ‰“å¼€æ—¶å‘å°„äº‹ä»¶ã€‚è¿™äº›å‘å°„å™¨å¯¹è±¡éƒ½æ˜¯åŸºäº Node.js çš„<code>EventEmitter</code>ç±»çš„ã€‚</p><p><code>emitter.on(eventName, listener)</code>æ–¹æ³•å…è®¸ä½ åœ¨è¿™äº›å‘å°„å™¨å¯¹è±¡ä¸Šæ³¨å†Œç›‘å¬å‡½æ•°ï¼Œè¿™äº›ç›‘å¬å‡½æ•°åœ¨ç‰¹å®šäº‹ä»¶åï¼ˆ<code>eventName</code>ï¼‰çš„äº‹ä»¶è¢«å‘å°„æ—¶è°ƒç”¨ã€‚ç®€å•æ¥è¯´ï¼Œè¿™å°±åƒæ˜¯å‘Šè¯‰ç³»ç»Ÿï¼šâ€œå˜¿ï¼Œå½“è¿™ä»¶äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œè¯·è¿è¡Œè¿™æ®µä»£ç ã€‚â€</p><ul><li><code>eventName</code>ï¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºä½ æƒ³è¦ç›‘å¬çš„äº‹ä»¶çš„åç§°ã€‚</li><li><code>listener</code>ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“æŒ‡å®šçš„äº‹ä»¶è¢«å‘å°„æ—¶ï¼Œè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”è¯·æ±‚"><span>ç¤ºä¾‹ 1ï¼šHTTP æœåŠ¡å™¨å“åº”è¯·æ±‚</span></a></h4><p>è®©æˆ‘ä»¬ç”¨<code>http</code>æ¨¡å—åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨ä¼šåœ¨æ¯æ¬¡æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œé€šè¿‡<code>&#39;request&#39;</code>äº‹ä»¶å‘å°„å™¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;request&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ HTTP æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šå‘å°„ä¸€ä¸ª<code>&#39;request&#39;</code>äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œæˆ‘ä»¬æä¾›çš„å›è°ƒå‡½æ•°ï¼Œå‘é€äº†ä¸€ä¸ªç®€å•çš„å“åº”ã€‚</p><h4 id="ç¤ºä¾‹-2-è¯»å–æ–‡ä»¶æµäº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è¯»å–æ–‡ä»¶æµäº‹ä»¶"><span>ç¤ºä¾‹ 2ï¼šè¯»å–æ–‡ä»¶æµäº‹ä»¶</span></a></h4><p>å‡è®¾æˆ‘ä»¬æƒ³è¦è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶å¹¶ä¸”å¤„ç†æ¯ä¸€å—æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>fs.createReadStream</code>æ¥åˆ›å»ºä¸€ä¸ªè¯»å–æµï¼Œå¹¶ä¸”ç”¨<code>.on()</code>æ–¹æ³•æ¥ç›‘å¬æ•°æ®äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./largeFile.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œ&#39;data&#39; äº‹ä»¶è¢«è§¦å‘</span></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">length</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> bytes of data.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ–‡ä»¶è¯»å–å®Œæˆæ—¶ï¼Œ&#39;end&#39; äº‹ä»¶è¢«è§¦å‘</span></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Read finished.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœ‰æ–°çš„æ•°æ®å—å‡†å¤‡å¥½ä»<code>largeFile.txt</code>ä¸­è¯»å–æ—¶ï¼Œ<code>&#39;data&#39;</code>äº‹ä»¶å°±ä¼šè¢«å‘å°„ï¼Œå¹¶è§¦å‘ç›¸åº”çš„ç›‘å¬å‡½æ•°æ¥å¤„ç†è¿™å—æ•°æ®ã€‚æœ€ç»ˆï¼Œå½“æ‰€æœ‰æ•°æ®éƒ½è¢«è¯»å–å®Œæ¯•ï¼Œ<code>&#39;end&#39;</code>äº‹ä»¶è¢«å‘å°„ï¼Œè¡¨æ˜å…¨éƒ¨è¿‡ç¨‹å®Œæˆã€‚</p><h3 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡<code>emitter.on(eventName, listener)</code>æ–¹æ³•ï¼ŒNode.js å…è®¸ä½ ä»¥ä¸€ç§éå¸¸çµæ´»å’Œé«˜æ•ˆçš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥äº‹ä»¶ã€‚æ— è®ºæ˜¯åœ¨åˆ›å»ºç½‘ç»œæœåŠ¡ã€å¤„ç†æ–‡ä»¶æµï¼Œè¿˜æ˜¯åœ¨æ„å»ºå¤æ‚çš„äº‹ä»¶é©±åŠ¨åº”ç”¨æ—¶ï¼Œè¿™ä¸ªæ¨¡å¼éƒ½éå¸¸æœ‰ç”¨ã€‚ç†è§£å¹¶æŒæ¡è¿™ä¸ªæ¦‚å¿µå°†å¯¹ä½ ä½¿ç”¨ Node.js è¿›è¡Œå¼€å‘å¤§æœ‰è£¨ç›Šã€‚</p><h3 id="emitter-once-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-once-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitteronceeventname-listener" target="_blank" rel="noopener noreferrer">emitter.once(eventName, listener)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js ä¸­, <code>EventEmitter</code> ç±»æ˜¯ç”¨æ¥å¤„ç†äº‹ä»¶çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»º <code>EventEmitter</code> å®ä¾‹æ¥ç»‘å®šå’Œç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ã€‚å…¶ä¸­ï¼Œ<code>.once()</code> æ–¹æ³•æ˜¯ <code>EventEmitter</code> çš„ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ã€‚</p><h3 id="emitter-once-eventname-listener-1" tabindex="-1"><a class="header-anchor" href="#emitter-once-eventname-listener-1"><span>emitter.once(eventName, listener)</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>emitter.once(eventName, listener)</code> æ–¹æ³•å…è®¸ä½ ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ª<strong>ä¸€æ¬¡æ€§</strong>ç›‘å¬å™¨ã€‚è¿™æ„å‘³ç€ï¼Œä¸€æ—¦è¯¥äº‹ä»¶è¢«è§¦å‘ï¼Œç›‘å¬å™¨ä¼šå“åº”äº‹ä»¶ï¼Œç„¶åç«‹å³è§£é™¤ç»‘å®šï¼Œä¸ä¼šå†æ¬¡å“åº”è¯¥äº‹ä»¶ã€‚</p><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°</span></a></h4><ul><li><code>eventName</code>: è¦ç›‘å¬çš„äº‹ä»¶åç§°ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚</li><li><code>listener</code>: å½“äº‹ä»¶è¢«è§¦å‘æ—¶è¦è°ƒç”¨çš„å‡½æ•°ã€‚</li></ul><h4 id="ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#ä½œç”¨"><span>ä½œç”¨</span></a></h4><p>è¿™ä¸ªæ–¹æ³•ç‰¹åˆ«é€‚åˆé‚£äº›åªéœ€è¦è§¦å‘ä¸€æ¬¡çš„äº‹ä»¶åœºæ™¯ï¼Œæ¯”å¦‚åªå¤„ç†ä¸€æ¬¡ç”¨æˆ·çš„è¾“å…¥ã€åªå“åº”ä¸€æ¬¡è¿æ¥æˆ–åªæ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–æ“ä½œã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><ol><li><p><strong>åªå“åº”ä¸€æ¬¡çš„ç‚¹å‡»äº‹ä»¶</strong>ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå½“ç”¨æˆ·é¦–æ¬¡ç‚¹å‡»æ—¶éœ€è¦æ˜¾ç¤ºä¸€ä¸ªæç¤ºï¼Œè€Œä¹‹åçš„ç‚¹å‡»åˆ™ä¸åšä»»ä½•ååº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åªç›‘å¬ä¸€æ¬¡ click äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿç‚¹å‡»æŒ‰é’®</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ­¤æ—¶ä¸ä¼šæœ‰è¾“å‡º</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åªå¤„ç†ä¸€æ¬¡çš„è¿æ¥äº‹ä»¶</strong>ï¼šå¦‚æœä½ å¼€å‘äº†ä¸€ä¸ªæœåŠ¡ï¼Œå®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡æ—¶ï¼Œä½ å¯èƒ½åªæƒ³å¯¹é¦–æ¬¡è¿æ¥å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> serverEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">serverEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¬¢è¿é¦–æ¬¡è®¿é—®ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿå®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">serverEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">serverEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç¬¬äºŒæ¬¡è¿æ¥æ—¶ï¼Œä¸ä¼šè¾“å‡ºæ¬¢è¿ä¿¡æ¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åªæ‰§è¡Œä¸€æ¬¡çš„åˆå§‹åŒ–æ“ä½œ</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ‰§è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–æ“ä½œï¼Œä¾‹å¦‚è¯»å–é…ç½®æ–‡ä»¶æˆ–è€…æ•°æ®åº“è¿æ¥ç­‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> initEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">initEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">init</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç³»ç»Ÿåˆå§‹åŒ–...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚åŠ è½½é…ç½®æ–‡ä»¶ç­‰</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘åˆå§‹åŒ–</span></span>
<span class="line"><span style="color:#D8DEE9;">initEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">init</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// åœ¨æ­¤å°è¯•å†æ¬¡åˆå§‹åŒ–æ— æ•ˆ</span></span>
<span class="line"><span style="color:#D8DEE9;">initEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">init</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä½¿ç”¨<code>.once()</code>æ–¹æ³•ç¡®ä¿äº†ç‰¹å®šæ“ä½œåªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™å¯¹äºé¿å…é‡å¤å¤„ç†æˆ–ä¿è¯èµ„æºä»…è¢«åˆ©ç”¨ä¸€æ¬¡éå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="emitter-prependlistener-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-prependlistener-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitterprependlistenereventname-listener" target="_blank" rel="noopener noreferrer">emitter.prependListener(eventName, listener)</a></span></a></h3><p>ç†è§£ <code>emitter.prependListener(eventName, listener)</code> çš„æœ€å¥½æ–¹å¼æ˜¯é¦–å…ˆäº†è§£äº‹ä»¶ç›‘å¬å™¨ï¼ˆEvent Listenersï¼‰å’Œ Node.js ä¸­çš„äº‹ä»¶è§¦å‘æœºåˆ¶ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½èƒ½è§¦å‘äº‹ä»¶ï¼›æ¯”å¦‚ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚å¯ä»¥è§¦å‘ &#39;data&#39;ã€&#39;end&#39; ç­‰äº‹ä»¶ï¼Œæ–‡ä»¶è¯»å–ä¹Ÿæœ‰ &#39;open&#39;ã€&#39;error&#39; ç­‰äº‹ä»¶ã€‚ä¸ºäº†å“åº”è¿™äº›äº‹ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨æ¥â€œç›‘å¬â€å®ƒä»¬ã€‚å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šæ‰§è¡Œä¸ä¹‹å…³è”çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯â€œç›‘å¬å™¨â€æˆ–â€œå›è°ƒå‡½æ•°â€ï¼‰ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>.on()</code> æ–¹æ³•æ¥æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚å¦‚æœå¯¹åŒä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†å¤šä¸ªç›‘å¬å™¨ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§æ·»åŠ çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p><p>ç„¶è€Œï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½å¸Œæœ›æŸä¸ªç›‘å¬å™¨èƒ½ä¼˜å…ˆäºå…¶ä»–å·²ç»æ·»åŠ çš„ç›‘å¬å™¨æ‰§è¡Œã€‚è¿™å°±æ˜¯ <code>emitter.prependListener(eventName, listener)</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿æ–°æ·»åŠ çš„ç›‘å¬å™¨è¢«æ”¾ç½®åœ¨ç›‘å¬å™¨é˜Ÿåˆ—çš„æœ€å‰é¢ï¼Œä»è€Œé¦–å…ˆå¾—åˆ°æ‰§è¡Œã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„èŠå¤©åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦åœ¨æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œã€‚é¦–å…ˆè®°å½•æ¶ˆæ¯ï¼Œæ¥ç€æ£€æµ‹æ˜¯å¦åŒ…å«ä¸å½“å†…å®¹ï¼Œæœ€åå¹¿æ’­ç»™æ‰€æœ‰ç”¨æˆ·ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> ChatApp</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chat</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ChatApp</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®°å½•æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">chat</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">è®°å½•æ¶ˆæ¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">msg</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ£€æµ‹ä¸å½“å†…å®¹</span></span>
<span class="line"><span style="color:#D8DEE9;">chat</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸å½“å†…å®¹</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å‘ç°ä¸å½“å†…å®¹ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åæ¥ä½ æƒ³è¦ç¡®ä¿åœ¨è¿›è¡Œä»»ä½•å¤„ç†ä¹‹å‰ï¼Œé¦–å…ˆéªŒè¯æ¶ˆæ¯çš„æ¥æºã€‚</span></span>
<span class="line"><span style="color:#616E88;">// ä½ å¯ä»¥ä½¿ç”¨ prependListener æ¥æ·»åŠ è¿™ä¸ªæ–°çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">chat</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">prependListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">é¦–å…ˆï¼ŒéªŒè¯æ¶ˆæ¯çš„æ¥æºã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“ä¸€ä¸ªæ¶ˆæ¯è¢«å‘é€æ—¶</span></span>
<span class="line"><span style="color:#D8DEE9;">chat</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">å¤§å®¶å¥½</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼š</p><ul><li>æˆ‘ä»¬é¦–å…ˆä¸º &#39;message&#39; äº‹ä»¶æ·»åŠ äº†ä¸¤ä¸ªç›‘å¬å™¨ï¼šä¸€ä¸ªç”¨äºè®°å½•æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªç”¨äºæ£€æµ‹ä¸å½“å†…å®¹ã€‚</li><li>éšåï¼Œæˆ‘ä»¬å†³å®šåœ¨å¤„ç†ä»»ä½•æ¶ˆæ¯ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦éªŒè¯æ¶ˆæ¯çš„æ¥æºã€‚é€šè¿‡ä½¿ç”¨ <code>prependListener</code>ï¼Œæˆ‘ä»¬ç¡®ä¿äº†æºéªŒè¯çš„ç›‘å¬å™¨ä¼šæœ€å…ˆæ‰§è¡Œï¼Œå³ä½¿å®ƒæ˜¯æœ€åæ·»åŠ çš„ã€‚</li></ul><p>è¿™æ ·ï¼Œæ— è®ºä½•æ—¶å‘é€æ¶ˆæ¯ï¼Œç¨‹åºéƒ½ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œæ“ä½œï¼š</p><ol><li>éªŒè¯æ¶ˆæ¯çš„æ¥æºã€‚</li><li>è®°å½•æ¶ˆæ¯ã€‚</li><li>æ£€æµ‹ä¸å½“å†…å®¹ã€‚</li></ol><p>ä½¿ç”¨ <code>prependListener</code> çš„å…³é”®ä¼˜åŠ¿åœ¨äºå®ƒæä¾›äº†æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå…è®¸å¼€å‘è€…è°ƒæ•´äº‹ä»¶å¤„ç†çš„ä¼˜å…ˆçº§ï¼Œä»¥é€‚åº”ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚</p><h3 id="emitter-prependoncelistener-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-prependoncelistener-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitterprependoncelistenereventname-listener" target="_blank" rel="noopener noreferrer">emitter.prependOnceListener(eventName, listener)</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­<code>emitter.prependOnceListener(eventName, listener)</code>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å’Œè¿ç”¨ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>: Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚</li><li><strong>Eventsï¼ˆäº‹ä»¶ï¼‰</strong>: åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼šæ¯”å¦‚ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚å¯¹è±¡å¯èƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼Œè¡¨ç¤ºæ•°æ®å·²ç»æ¥æ”¶å®Œæ¯•æˆ–è€…è¿æ¥å·²ç»å…³é—­ç­‰ã€‚è¿™äº›äº‹ä»¶å¯ä»¥è¢« Node.js ä»£ç ç›‘å¬å’Œå¤„ç†ã€‚</li><li><strong>EventEmitter ç±»</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code>æ˜¯ä¸€ä¸ªå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒç±»ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>EventEmitter</code>å®ä¾‹ï¼Œå¹¶ç”¨å®ƒæ¥å‘å‡ºè‡ªå®šä¹‰äº‹ä»¶ï¼Œæˆ–è€…ç›‘å¬å…¶ä»–å¯¹è±¡å‘å‡ºçš„äº‹ä»¶ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯¦ç»†äº†è§£<code>emitter.prependOnceListener(eventName, listener)</code>è¿™ä¸ªæ–¹æ³•ï¼š</p><ul><li>å½“ä½ æƒ³å¯¹æŸä¸ªç‰¹å®šäº‹ä»¶è¿›è¡Œä¸€æ¬¡æ€§ç›‘å¬æ—¶ï¼Œå³ç›‘å¬å™¨æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</li><li>è¿™ä¸ªæ–¹æ³•å°†æ–°çš„ç›‘å¬å™¨æ·»åŠ åˆ°ç›‘å¬å™¨æ•°ç»„çš„<strong>å¼€å§‹</strong>ã€‚</li><li><code>eventName</code>å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€… Symbolï¼Œä»£è¡¨ä½ æƒ³è¦ç›‘å¬çš„äº‹ä»¶åã€‚</li><li><code>listener</code>å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨prependoncelistener" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨prependoncelistener"><span>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>prependOnceListener</code>?</span></a></h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œäº‹ä»¶ç›‘å¬å™¨æŒ‰ç…§æ·»åŠ çš„é¡ºåºè¢«è°ƒç”¨ã€‚ä½†æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½å¸Œæœ›ä½ çš„ç›‘å¬å™¨èƒ½å¤Ÿé¦–å…ˆæ¥æ”¶åˆ°äº‹ä»¶ï¼Œå³ä½¿å®ƒä¸æ˜¯æœ€å…ˆè¢«æ·»åŠ çš„ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦é¢„å¤„ç†äº‹ä»¶æ•°æ®ï¼Œæˆ–è€…åœ¨å…¶å®ƒç›‘å¬å™¨ä¹‹å‰å…ˆè¡Œå–æ¶ˆäº‹ä»¶ä¼ æ’­ã€‚<code>prependOnceListener</code>æ­£æ˜¯ä¸ºè¿™ç§éœ€æ±‚è®¾è®¡çš„ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„ç½‘ç«™æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨éœ€è¦è®°å½•æ¯å½“æœ‰æ–°çš„è¿æ¥å»ºç«‹æ—¶çš„æ—¥å¿—ã€‚ä½†æ˜¯ï¼Œå¯¹äºç¬¬ä¸€æ¬¡è¿æ¥ï¼Œæˆ‘ä»¬æƒ³è¦è¾“å‡ºä¸€äº›ç‰¹åˆ«çš„æ¬¢è¿ä¿¡æ¯ï¼Œå¹¶ä¸”åªè¾“å‡ºä¸€æ¬¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ™®é€šè¿æ¥æ—¥å¿—ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Someone connected.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç‰¹åˆ«æ¬¢è¿æ¶ˆæ¯ï¼Œåªå¸Œæœ›åœ¨ç¬¬ä¸€æ¬¡è¿æ¥æ—¶è¾“å‡º</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">prependOnceListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to our website! This is your first time connecting.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿä¸¤æ¬¡è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  /* connection details */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  /* connection details */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ— è®ºæˆ‘ä»¬æ·»åŠ äº†å¤šå°‘ä¸ªæ™®é€šçš„è¿æ¥æ—¥å¿—ç›‘å¬å™¨ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨äº†<code>prependOnceListener</code>ï¼Œé‚£ä¸ªç‰¹åˆ«çš„æ¬¢è¿æ¶ˆæ¯æ€»ä¼šåœ¨ç¬¬ä¸€æ¬¡å‘ç”Ÿè¿æ¥æ—¶é¦–å…ˆè¾“å‡ºï¼Œå¹¶ä¸”ä¹‹åå°±ä¸å†è¾“å‡ºäº†ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>prependOnceListener</code>æ–¹æ³•æä¾›äº†ä¸€ç§çµæ´»çš„æ§åˆ¶äº‹ä»¶ç›‘å¬å™¨æ‰§è¡Œé¡ºåºå’Œæ‰§è¡Œæ¬¡æ•°çš„æœºåˆ¶ã€‚</p><h3 id="emitter-removealllisteners-eventname" tabindex="-1"><a class="header-anchor" href="#emitter-removealllisteners-eventname"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitterremovealllistenerseventname" target="_blank" rel="noopener noreferrer">emitter.removeAllListeners([eventName])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯é€»è¾‘ï¼Œå°±åƒä½ åœ¨æµè§ˆå™¨ä¸­ç¼–å†™å‰ç«¯ä»£ç ä¸€æ ·ã€‚å…¶ä¸­ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§æ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œè€Œ<code>emitter.removeAllListeners([eventName])</code>æ–¹æ³•æ˜¯å¤„ç†äº‹ä»¶ç›‘å¬å™¨çš„æœ‰ç”¨å·¥å…·ä¹‹ä¸€ã€‚</p><p>é¦–å…ˆï¼Œç†è§£ Node.js ä¸­çš„äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨è‡³å…³é‡è¦ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ä¼šå‘å‡ºäº‹ä»¶ï¼Œæ–‡ä»¶è¯»å–æ“ä½œå®Œæˆæ—¶ä¹Ÿä¼šå‘å‡ºäº‹ä»¶ç­‰ã€‚å½“è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½ å¯èƒ½æƒ³æ‰§è¡Œä¸€äº›å“åº”çš„ä»£ç ï¼Œè¿™æ­£æ˜¯â€œç›‘å¬å™¨â€æˆ–è€…è¯´â€œäº‹ä»¶å¤„ç†å‡½æ•°â€ä½œç”¨çš„åœ°æ–¹ã€‚</p><h3 id="emitter-removealllisteners-eventname-1" tabindex="-1"><a class="header-anchor" href="#emitter-removealllisteners-eventname-1"><span><code>emitter.removeAllListeners([eventName])</code></span></a></h3><p>è¿™ä¸ªæ–¹æ³•å±äº<code>EventEmitter</code>ç±»ï¼Œåœ¨ Node.js çš„<code>events</code>æ¨¡å—ä¸­å®šä¹‰ã€‚ç”¨äºç§»é™¤ä¸€ä¸ªäº‹ä»¶ä¸Šæ‰€æœ‰çš„ç›‘å¬å™¨ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰æŒ‡å®šäº‹ä»¶ï¼Œåˆ™ç§»é™¤æ‰€æœ‰äº‹ä»¶ä¸Šçš„ç›‘å¬å™¨ã€‚</p><h4 id="å‚æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-1"><span>å‚æ•°</span></a></h4><ul><li><code>eventName</code>ï¼ˆå¯é€‰ï¼‰: æŒ‡å®šè¦ç§»é™¤ç›‘å¬å™¨çš„äº‹ä»¶åç§°ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ã€‚</li></ul><h4 id="è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼"><span>è¿”å›å€¼</span></a></h4><ul><li>è¿”å›<code>emitter</code>æœ¬èº«ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥é“¾å¼è°ƒç”¨å…¶ä»–<code>EventEmitter</code>æ–¹æ³•ã€‚</li></ul><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><p><strong>1. åˆ›å»º HTTP æœåŠ¡å™¨ï¼Œå¹¶åœ¨è¯·æ±‚åˆ°æ¥æ—¶å‘å‡ºè‡ªå®šä¹‰äº‹ä»¶</strong></p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œæ¯å½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä½ å¸Œæœ›è®°å½•ä¿¡æ¯ï¼Œç„¶åå“åº”å®¢æˆ·ç«¯ã€‚ä½†æ˜¯ï¼Œå‡ºäºæŸç§åŸå› ï¼ˆæ¯”å¦‚æœåŠ¡å™¨å³å°†å…³é—­ï¼‰ï¼Œä½ éœ€è¦åœæ­¢è®°å½•è¯·æ±‚ä¿¡æ¯ã€‚è¿™æ—¶å€™ï¼Œ<code>removeAllListeners</code>æ–¹æ³•å°±éå¸¸æœ‰ç”¨äº†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">requestReceived</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A request was received</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å‡ºè‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">requestReceived</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾åœ¨5ç§’åæˆ‘ä»¬æƒ³åœæ­¢ç›‘å¬requestReceivedäº‹ä»¶</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeAllListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">requestReceived</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">No longer listening to requestReceived events.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨</strong></p><p>è€ƒè™‘å¦å¤–ä¸€ä¸ªåœºæ™¯ï¼Œä½ æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒç›‘å¬å¤šä¸ªä¸åŒçš„äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ç”¨æˆ·é€€å‡ºï¼Œä½ æƒ³ä¸€æ¬¡æ€§ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ä¼ é€’ä»»ä½•å‚æ•°ç»™<code>removeAllListeners</code>ä¼šéå¸¸æ–¹ä¾¿ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾myEmitterå·²ç»ç›‘å¬äº†å¤šä¸ªä¸åŒçš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Event 1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Event 2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”¨æˆ·é€€å‡ºåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬æƒ³ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeAllListeners</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">All listeners removed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“æ¥è¯´ï¼Œ<code>emitter.removeAllListeners([eventName])</code>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–¹æ³•ï¼Œç”¨äºç®¡ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œæ— è®ºæ˜¯ç§»é™¤æŒ‡å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨è¿˜æ˜¯ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å™¨ã€‚æŒæ¡è¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿå¸®åŠ©ä½ æœ‰æ•ˆåœ°æ§åˆ¶äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼Œå¹¶ä¿æŒåº”ç”¨ç¨‹åºçš„é«˜æ•ˆè¿è¡Œã€‚</p><h3 id="emitter-removelistener-eventname-listener" tabindex="-1"><a class="header-anchor" href="#emitter-removelistener-eventname-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitterremovelistenereventname-listener" target="_blank" rel="noopener noreferrer">emitter.removeListener(eventName, listener)</a></span></a></h3><p>ç†è§£<code>emitter.removeListener(eventName, listener)</code>è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>EventEmitter</strong>: åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼ŒEventEmitter æ˜¯ä¸€ä¸ªå¤„ç†å’Œè§¦å‘è¿™äº›äº‹ä»¶çš„æœºåˆ¶ã€‚æ¯”å¦‚è¯´ï¼Œå½“ä¸€ä¸ª web æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šå‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚</li></ol><p>å¥½ï¼Œç°åœ¨æ¥è§£é‡Šä¸€ä¸‹<code>emitter.removeListener(eventName, listener)</code>:</p><ul><li><code>emitter</code>: è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼ˆEventEmitterï¼‰å®ä¾‹ï¼Œè´Ÿè´£ç®¡ç†ä¸€ç³»åˆ—çš„äº‹ä»¶å’Œå›è°ƒå‡½æ•°(listener)ã€‚</li><li><code>removeListener</code>: è¿™æ„å‘³ç€ä»ç‰¹å®šäº‹ä»¶çš„ç›‘å¬å™¨æ•°ç»„ä¸­ç§»é™¤ä¸€ä¸ªç›‘å¬å™¨ã€‚</li><li><code>eventName</code>: è¿™æ˜¯ä½ æƒ³è¦åœæ­¢ç›‘å¬çš„å…·ä½“äº‹ä»¶çš„åç§°ã€‚</li><li><code>listener</code>: è¿™æ˜¯å½“äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œå³ä½ æƒ³è¦ç§»é™¤çš„é‚£ä¸ªç›‘å¬å™¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œå½“æœ‰æ–°æ¶ˆæ¯æ—¶ï¼Œç³»ç»Ÿä¼šå‘å‡ºä¸€ä¸ª<code>newMessage</code>äº‹ä»¶ã€‚å¦‚æœç”¨æˆ·é€‰æ‹©å…³é—­é€šçŸ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦åœæ­¢ç›‘å¬è¿™ä¸ªäº‹ä»¶ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„<code>EventEmitter</code>å®ä¾‹ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª<code>newMessage</code>äº‹ä»¶çš„ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> emitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onNewMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">content</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°æ–°æ¶ˆæ¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">content</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»™newMessageäº‹ä»¶æ·»åŠ ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newMessage</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onNewMessage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœå‘å‡º<code>newMessage</code>äº‹ä»¶ï¼Œ<code>onNewMessage</code>å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newMessage</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼Œä¸–ç•Œï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœç”¨æˆ·å†³å®šä¸å†æ¥æ”¶æ¶ˆæ¯é€šçŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ç§»é™¤<code>onNewMessage</code>ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ç§»é™¤ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newMessage</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onNewMessage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤åï¼Œå³ä½¿<code>newMessage</code>äº‹ä»¶è¢«è§¦å‘ï¼Œ<code>onNewMessage</code>ç›‘å¬å™¨ä¹Ÿä¸ä¼šå†è¢«è°ƒç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å°†å…¶ä»ç›‘å¬å™¨åˆ—è¡¨ä¸­ç§»é™¤ã€‚</p><p>ä½¿ç”¨<code>emitter.removeListener(eventName, listener)</code>æ–¹æ³•ï¼Œå¯ä»¥çµæ´»åœ°æ§åˆ¶äº‹ä»¶ç›‘å¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥é€‚åº”åº”ç”¨ç¨‹åºçš„éœ€æ±‚å˜åŒ–ã€‚è¿™å¯¹äºç®¡ç†èµ„æºã€é¿å…å†…å­˜æ³„æ¼ç­‰æ–¹é¢éå¸¸é‡è¦ã€‚</p><h3 id="emitter-setmaxlisteners-n" tabindex="-1"><a class="header-anchor" href="#emitter-setmaxlisteners-n"><span><a href="https://nodejs.org/docs/latest/api/events.html#emittersetmaxlistenersn" target="_blank" rel="noopener noreferrer">emitter.setMaxListeners(n)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ¨¡å—å«åš <code>events</code>ï¼Œè¿™ä¸ªæ¨¡å—ç”¨äºå¤„ç†äº‹ä»¶ï¼Œæ¯”å¦‚ç‚¹å‡»æŒ‰é’®æ—¶å‘ç”Ÿçš„åŠ¨ä½œã€‚åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå·±çš„äº‹ä»¶ã€‚</p><h3 id="emitter-setmaxlisteners-n-1" tabindex="-1"><a class="header-anchor" href="#emitter-setmaxlisteners-n-1"><span><code>emitter.setMaxListeners(n)</code></span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>emitter.setMaxListeners(n)</code> æ–¹æ³•ã€‚æ¯ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼ˆ<code>EventEmitter</code> å®ä¾‹ï¼‰é»˜è®¤å¯ä»¥æ·»åŠ ä¸è¶…è¿‡ 10 ä¸ªç›‘å¬å™¨ï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚è¿™ä¸ªé™åˆ¶æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ç¡®ä¿¡ä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œå¯èƒ½éœ€è¦ä¸ºç‰¹å®šçš„äº‹ä»¶ç›‘å¬å™¨å¢åŠ æ›´å¤šçš„ç›‘å¬å™¨ã€‚è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <code>emitter.setMaxListeners(n)</code> æ–¹æ³•æ¥å®ç°ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ä½ å¸Œæœ›è®¾ç½®çš„ç›‘å¬å™¨çš„æœ€å¤§æ•°é‡ã€‚</p><h4 id="å¦‚ä½•ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-1"><span>å¦‚ä½•ä½¿ç”¨ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®æ­¤ç‰¹å®š emitter å®ä¾‹çš„æœ€å¤§ç›‘å¬å™¨æ•°ä¸º 20</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç„¶åå°±å¯ä»¥æ·»åŠ å¤šäº 10 ä¸ªçš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 20</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">äº‹ä»¶ç›‘å¬å™¨è¢«è°ƒç”¨</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;event&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­:</span></a></h3><h4 id="_1-å¤šä¸ªæ—¥å¿—çº§åˆ«çš„æ—¥å¿—è®°å½•å™¨" tabindex="-1"><a class="header-anchor" href="#_1-å¤šä¸ªæ—¥å¿—çº§åˆ«çš„æ—¥å¿—è®°å½•å™¨"><span>1. å¤šä¸ªæ—¥å¿—çº§åˆ«çš„æ—¥å¿—è®°å½•å™¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼ˆå¦‚ debug, info, warn, errorï¼‰æ¥è®°å½•æ—¥å¿—ã€‚å¯¹äºæ¯ç§æ—¥å¿—çº§åˆ«ï¼Œä½ å¯èƒ½æƒ³è¦æ·»åŠ å¤šä¸ªç›‘å¬å™¨æ¥å¤„ç†æ—¥å¿—ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªå°†æ—¥å¿—å†™å…¥æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªå°†æ—¥å¿—å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç­‰ç­‰ï¼‰ã€‚</p><p>å¦‚æœæ—¥å¿—çº§åˆ«å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªçº§åˆ«éƒ½æœ‰å¤šä¸ªå¤„ç†å‡½æ•°ï¼Œå¾ˆå®¹æ˜“è¶…è¿‡é»˜è®¤çš„ 10 ä¸ªç›‘å¬å™¨é™åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>setMaxListeners</code> æ¥å¢åŠ ç›‘å¬å™¨çš„ä¸Šé™ï¼Œä»¥é¿å…è­¦å‘Šä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> logger</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">50</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ æ—¥å¿—å¤„ç†ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">debug</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  /* å†™å…¥æ–‡ä»¶ */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">info</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  /* å†™å…¥æ–‡ä»¶ */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// å¯ä»¥ç»§ç»­ä¸ºä¸åŒçš„çº§åˆ«æˆ–ç›¸åŒçº§åˆ«æ·»åŠ æ›´å¤šçš„ç›‘å¬å™¨...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘æ—¥å¿—äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">info</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This is an info log.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-åœ¨æ¸¸æˆå¼€å‘ä¸­ç®¡ç†ç©å®¶äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-åœ¨æ¸¸æˆå¼€å‘ä¸­ç®¡ç†ç©å®¶äº‹ä»¶"><span>2. åœ¨æ¸¸æˆå¼€å‘ä¸­ç®¡ç†ç©å®¶äº‹ä»¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤šäººåœ¨çº¿æ¸¸æˆï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†å„ç§ç©å®¶äº‹ä»¶ï¼Œå¦‚ç§»åŠ¨ã€æ”»å‡»æˆ–ä½¿ç”¨ç‰©å“ã€‚æ¯ç§äº‹ä»¶å¯èƒ½éœ€è¦å¤šä¸ªç›‘å¬å™¨æ¥å¤„ç†ä¸åŒçš„é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œæ›´æ–°ç©å®¶çŠ¶æ€ã€é€šçŸ¥å…¶ä»–ç©å®¶ã€æ£€æŸ¥æ¸¸æˆè§„åˆ™ç­‰ï¼‰ã€‚</p><p>å¦‚æœæ¸¸æˆå…·æœ‰å¤æ‚çš„é€»è¾‘ï¼Œæ¯ä¸ªäº‹ä»¶å¯èƒ½éœ€è¦å¾ˆå¤šç›‘å¬å™¨ã€‚è¿™æ—¶ï¼Œé€‚å½“åœ°ä½¿ç”¨ <code>setMaxListeners</code> å¯ä»¥å¸®åŠ©ä½ ç®¡ç†è¿™äº›ç›‘å¬å™¨ï¼Œè€Œä¸ä¼šè§¦å‘è­¦å‘Šï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> gameEvents</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">gameEvents</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ä¸º &#39;move&#39; äº‹ä»¶æ·»åŠ å¤šä¸ªç›‘å¬å™¨...</span></span>
<span class="line"><span style="color:#D8DEE9;">gameEvents</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">move</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">playerId</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> newPosition</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  /* æ›´æ–°ç©å®¶ä½ç½® */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">gameEvents</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">move</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">playerId</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> newPosition</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  /* æ£€æŸ¥æ˜¯å¦è§¦å‘é™·é˜± */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// æ›´å¤šçš„ &#39;move&#39; ç›‘å¬å™¨...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç©å®¶ç§»åŠ¨æ—¶è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">gameEvents</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">move</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> playerId</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> x</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 10</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> y</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 15</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>emitter.setMaxListeners(n)</code> çš„ç”¨é€”åŠå…¶åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­çš„ä¸€äº›åœºæ™¯ã€‚è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æé«˜çµæ´»æ€§å’Œé¿å…ä¸å¿…è¦çš„è­¦å‘Šï¼ŒåŒæ—¶è¿˜éœ€è¦å¼€å‘è€…å¯¹å¯èƒ½å‘ç”Ÿçš„å†…å­˜æ³„æ¼ä¿æŒè­¦æƒ•ã€‚</p><h3 id="emitter-rawlisteners-eventname" tabindex="-1"><a class="header-anchor" href="#emitter-rawlisteners-eventname"><span><a href="https://nodejs.org/docs/latest/api/events.html#emitterrawlistenerseventname" target="_blank" rel="noopener noreferrer">emitter.rawListeners(eventName)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>emitter.rawListeners(eventName)</code> æ–¹æ³•ï¼Œå¹¶ä¸”å°½é‡ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼æ¥è§£é‡Šå®ƒã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ Node.js çš„ <code>events</code> æ¨¡å—ä¸­ï¼Œç”¨äºè·å–æŒ‡å®šäº‹ä»¶çš„ç›‘å¬å™¨ï¼ˆlistenersï¼‰æ•°ç»„ï¼Œä½†ä¸ <code>emitter.listeners(eventName)</code> ä¸åŒçš„æ˜¯ï¼Œ<code>emitter.rawListeners(eventName)</code> è¿”å›çš„æ˜¯å°šæœªè¢«å¯èƒ½å­˜åœ¨çš„ä»»ä½•åŒ…è£…å™¨å°è£…çš„åŸå§‹ç›‘å¬å™¨ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦çŸ¥é“ Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿè®©ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¤„ç†æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼ŒNode.js è‡ªèº«å°±æ˜¯å»ºç«‹åœ¨â€œäº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/Oâ€æ¨¡å‹ä¸Šçš„ã€‚</p><ul><li><strong>äº‹ä»¶ï¼ˆEventsï¼‰</strong>ï¼šå½“æŸäº›ç‰¹å®šçš„äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¼šè§¦å‘äº‹ä»¶ï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å–å®Œæˆã€HTTP è¯·æ±‚ç­‰ã€‚</li><li><strong>äº‹ä»¶ç›‘å¬å™¨ï¼ˆEvent Listenersï¼‰</strong>ï¼šæ˜¯å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç”¨æ¥å“åº”äº‹ä»¶çš„å‡½æ•°ã€‚</li></ul><p>åœ¨ Node.js ä¸­ï¼Œ<code>events</code> æ¨¡å—å…è®¸ä½ åˆ›å»ºã€è§¦å‘å’Œç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ã€‚è¿™ä¸ªæ¨¡å—ä¸­æœ€é‡è¦çš„ç±»æ˜¯ <code>EventEmitter</code>ã€‚</p><h3 id="emitter-rawlisteners-eventname-1" tabindex="-1"><a class="header-anchor" href="#emitter-rawlisteners-eventname-1"><span><code>emitter.rawListeners(eventName)</code></span></a></h3><p>è¿™ä¸ªæ–¹æ³•ç”¨äºè¿”å›æŒ‡å®šäº‹ä»¶åçš„æ‰€æœ‰ç›‘å¬å™¨æ•°ç»„ï¼Œä½†è¿™äº›ç›‘å¬å™¨æ˜¯â€œåŸå§‹â€çš„ï¼Œæ„å‘³ç€å¦‚æœæœ‰ä½¿ç”¨ <code>.once()</code> æ–¹æ³•æ·»åŠ çš„å•æ¬¡ç›‘å¬å™¨ï¼Œè¿”å›çš„å°†ä¼šæ˜¯è¿™äº›ç›‘å¬å™¨çš„åŒ…è£…ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥æ˜¯è°ƒç”¨ <code>.once()</code> æ—¶ä¼ å…¥çš„é‚£ä¸ªç›‘å¬å™¨å‡½æ•°ã€‚</p><h4 id="å‚æ•°-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-2"><span>å‚æ•°</span></a></h4><ul><li><code>eventName</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ç¬¦å·ï¼ˆSymbolï¼‰ï¼Œè¡¨ç¤ºä½ æƒ³è·å–ç›‘å¬å™¨çš„äº‹ä»¶åç§°ã€‚</li></ul><h4 id="è¿”å›å€¼-1" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-1"><span>è¿”å›å€¼</span></a></h4><ul><li>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œçš„æ‰€æœ‰ç›‘å¬å™¨ï¼ˆåŒ…æ‹¬é€šè¿‡ <code>.on()</code> å’Œ <code>.once()</code> æ·»åŠ çš„ï¼‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œéœ€è¦å¯¹ç”¨æˆ·è¿æ¥è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œå¹¶åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è¿æ¥æ—¶åšä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> Connection</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Connection å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> conn</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Connection</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ .once() ç›‘å¬ &#39;connect&#39; äº‹ä»¶ï¼Œå› æ­¤åªä¼šåœ¨é¦–æ¬¡è¿æ¥æ—¶è§¦å‘</span></span>
<span class="line"><span style="color:#D8DEE9;">conn</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç”¨æˆ·é¦–æ¬¡è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨åº”ç”¨çš„å…¶ä»–éƒ¨åˆ†ï¼Œä½ æƒ³æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®äº†å¯¹ &#39;connect&#39; äº‹ä»¶çš„ç›‘å¬</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> rawListeners</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> conn</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">rawListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">rawListeners</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨äº† <code>.once()</code> æ¥æ·»åŠ ä¸€ä¸ªåªä¼šæ‰§è¡Œä¸€æ¬¡çš„ç›‘å¬å™¨ï¼Œ<code>rawListeners</code> æ–¹æ³•ä¾ç„¶èƒ½å¤Ÿè¿”å›è¿™ä¸ªç›‘å¬å™¨ï¼ˆå®é™…ä¸Šæ˜¯å®ƒçš„åŒ…è£…å‡½æ•°ï¼‰ã€‚è¿™å¯¹äºè°ƒè¯•å’Œé«˜çº§äº‹ä»¶ç®¡ç†åœºæ™¯éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å½“ä½ æƒ³çŸ¥é“æŸä¸ªäº‹ä»¶æœ‰å¤šå°‘ä¸ªç›‘å¬å™¨ï¼Œæˆ–è€…ä½ æƒ³æ“ä½œè¿™äº›ç›‘å¬å™¨ä½†åˆä¸å½±å“å®ƒä»¬åŸæœ‰çš„è¡Œä¸ºæ—¶ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>emitter.rawListeners(eventName)</code> æä¾›äº†ä¸€ç§æ–¹å¼å»è·å–äº‹ä»¶çš„ç›‘å¬å™¨æ•°ç»„ï¼ŒåŒ…æ‹¬é‚£äº›å¯èƒ½åªè¢«è§¦å‘ä¸€æ¬¡çš„ç›‘å¬å™¨ï¼Œè€Œä¸”æä¾›çš„æ˜¯å®ƒä»¬çš„åŸå§‹å½¢å¼ã€‚è¿™åœ¨éœ€è¦æ·±å…¥äº†è§£äº‹ä»¶ç›‘å¬å™¨çŠ¶æ€ï¼Œæˆ–è€…è¿›è¡Œè¾ƒä¸ºå¤æ‚çš„äº‹ä»¶ç›‘å¬ç®¡ç†æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="emitter-symbol-for-nodejs-rejection-err-eventname-args" tabindex="-1"><a class="header-anchor" href="#emitter-symbol-for-nodejs-rejection-err-eventname-args"><span><a href="https://nodejs.org/docs/latest/api/events.html#emittersymbolfornodejsrejectionerr-eventname-args" target="_blank" rel="noopener noreferrer">emitter[Symbol.for(&#39;nodejs.rejection&#39;)](err, eventName[, ...args])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ç”¨ JavaScript ç¼–å†™åç«¯ä»£ç ã€‚Node.js ä»¥å…¶éé˜»å¡ I/O å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§è€Œé—»åï¼Œè¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œéå¸¸é€‚åˆæ„å»ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶æ˜¯æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚Node.js æœ‰ä¸€ä¸ªå†…ç½®çš„æ¨¡å—å«åš <code>events</code>ï¼Œå…è®¸ä½ åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå·±çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æ—¶è§¦å‘äº‹ä»¶ï¼Œæˆ–è€…å½“è¯»å–æ–‡ä»¶å®Œæˆæ—¶è§¦å‘äº‹ä»¶ã€‚</p><h3 id="emitter-symbol-for-nodejs-rejection-err-eventname-args-1" tabindex="-1"><a class="header-anchor" href="#emitter-symbol-for-nodejs-rejection-err-eventname-args-1"><span>emitter[Symbol.for(&#39;nodejs.rejection&#39;)](err, eventName[, ...args])</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„ <code>emitter[Symbol.for(&#39;nodejs.rejection&#39;)](err, eventName[, ...args])</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶å¤„ç†å™¨ï¼Œå…³è”äºå¤„ç†æœªæ•è·çš„ Promise æ‹’ç»ï¼ˆä¹Ÿå°±æ˜¯æœªè¢« <code>.catch</code> æˆ– <code>try/catch</code> å—å¤„ç†çš„é”™è¯¯ï¼‰ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½é€šè¿‡ä½¿ç”¨ç‰¹æ®Šçš„ç¬¦å· <code>Symbol.for(&#39;nodejs.rejection&#39;)</code> æ¥æ‰©å±• EventEmitter å®ä¾‹ï¼Œä½¿å…¶èƒ½å¤Ÿä¸“é—¨å¤„ç†æœªæ•è·çš„æ‹’ç»ã€‚è¿™æ˜¯ Node.js æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜ä»¥æ›´ä¼˜é›…çš„æ–¹å¼å¤„ç†å’ŒæŠ¥å‘Šå¼‚æ­¥æ“ä½œä¸­å‡ºç°çš„é”™è¯¯ã€‚</p><h4 id="å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ"><span>å¦‚ä½•å·¥ä½œï¼š</span></a></h4><ol><li>å½“ Promise è¢«æ‹’ç»ï¼Œå¹¶ä¸”è¿™ä¸ªæ‹’ç»æ²¡æœ‰è¢«ç›¸åº”åœ°å¤„ç†ï¼ˆå³æ²¡æœ‰ <code>.catch</code> æ–¹æ³•æˆ– <code>try/catch</code> åŒ…è£¹ï¼‰ï¼ŒNode.js ä¼šå¯»æ‰¾æ˜¯å¦æœ‰æ³¨å†Œäº† <code>emitter[Symbol.for(&#39;nodejs.rejection&#39;)]</code> çš„å¤„ç†å‡½æ•°ã€‚</li><li>å¦‚æœæ‰¾åˆ°äº†ï¼Œè¿™ä¸ªå¤„ç†å‡½æ•°å°†è¢«è°ƒç”¨ï¼Œå¹¶ä¼ å…¥ç›¸å…³çš„é”™è¯¯å¯¹è±¡ <code>err</code>ã€äº‹ä»¶åç§° <code>eventName</code> å’Œä»»ä½•é¢å¤–çš„å‚æ•° <code>...args</code>ã€‚</li><li>è¿™å…è®¸å¼€å‘è€…åœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹å¤„ç†æ‰€æœ‰æœªæ•è·çš„ Promise æ‹’ç»ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æ—¥å¿—ã€å‘é€è­¦æŠ¥æˆ–è€…æ ¹æ®éœ€è¦æ‰§è¡Œå…¶ä»–æ“ä½œã€‚</li></ol><h4 id="å®é™…åº”ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3"><span>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œå¦‚æ•°æ®åº“æŸ¥è¯¢æˆ–å¤–éƒ¨ API è¯·æ±‚ã€‚è¿™äº›æ“ä½œé€šå¸¸è¿”å› Promiseã€‚ä½†å¦‚æœæŸä¸ªåœ°æ–¹å¿˜è®°äº†æ·»åŠ  <code>.catch</code> æ–¹æ³•æ¥å¤„ç†å¯èƒ½çš„é”™è¯¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–è€…å¤„äºä¸ç¨³å®šçŠ¶æ€ã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>emitter[Symbol.for(&#39;nodejs.rejection&#39;)]</code>ï¼Œä½ å¯ä»¥å…¨å±€ç›‘å¬è¿™äº›æœªæ•è·çš„æ‹’ç»ï¼Œä»è€Œç¡®ä¿å³ä½¿åœ¨å‡ºé”™çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ä¹Ÿèƒ½ä»¥å¯æ§çš„æ–¹å¼å“åº”ã€‚è¿™æ ·ï¼Œä¸ä»…èƒ½å¤Ÿé˜²æ­¢ç¨‹åºå´©æºƒï¼Œè¿˜èƒ½æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œæ˜“äºè°ƒè¯•çš„ç¯å¢ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">Symbol</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">for</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nodejs.rejection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)] </span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> eventName</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An unhandled rejection occurred in </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">eventName</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿä¸€ä¸ªæœªå¤„ç†çš„æ‹’ç»</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Oops!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SomeEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>MyEmitter</code> ç±»ï¼Œç»§æ‰¿è‡ª Node.js çš„ <code>EventEmitter</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¸ºè¿™ä¸ªç±»çš„å®ä¾‹æ·»åŠ äº†æœªæ•è·çš„æ‹’ç»å¤„ç†å‡½æ•°ã€‚å½“ <code>emit</code> è°ƒç”¨æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯äº‹ä»¶æ—¶ï¼Œè¿™ä¸ªå¤„ç†å‡½æ•°å°†è¢«è§¦å‘ï¼Œæ‰“å°å‡ºé”™è¯¯ä¿¡æ¯å’Œç›¸å…³äº‹ä»¶åç§°ï¼Œä»è€Œå¸®åŠ©å¼€å‘è€…è¯†åˆ«å’Œå¤„ç†é—®é¢˜ã€‚</p><h2 id="events-defaultmaxlisteners" tabindex="-1"><a class="header-anchor" href="#events-defaultmaxlisteners"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventsdefaultmaxlisteners" target="_blank" rel="noopener noreferrer">events.defaultMaxListeners</a></span></a></h2><p>ç†è§£ <code>events.defaultMaxListeners</code> ä¹‹å‰ï¼Œå…ˆè¦æ˜ç™½ Node.js ä¸­çš„äº‹ä»¶ç›‘å¬å™¨å’Œ EventEmitter ç±»ã€‚</p><p>Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œè¿™æ„å‘³ç€å¾ˆå¤šæ“ä½œï¼ˆæ¯”å¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰æ˜¯é€šè¿‡ç›‘å¬äº‹ä»¶æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„ç»“æœçš„ã€‚Node.js æä¾›äº†ä¸€ä¸ª <code>EventEmitter</code> ç±»ï¼Œç”¨äºå¤„ç†äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨ã€‚ç®€å•è¯´ï¼Œä½ å¯ä»¥åˆ›å»ºå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥å‘å¸ƒï¼ˆemitï¼‰äº‹ä»¶ï¼Œå…¶ä»–åœ°æ–¹çš„ä»£ç å¯ä»¥è®¢é˜…ï¼ˆlisten toï¼‰è¿™äº›äº‹ä»¶ï¼Œä»è€Œå½“äº‹ä»¶å‘ç”Ÿæ—¶èƒ½æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p><p>æ¯æ¬¡ä½¿ç”¨ <code>.on()</code> æ–¹æ³•å‘ EventEmitter å®ä¾‹æ·»åŠ ç›‘å¬å™¨æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨å‘Šè¯‰è¿™ä¸ªå®ä¾‹ï¼šå½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¯·è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ä½†å¦‚æœå¯¹åŒä¸€ä¸ªäº‹ä»¶æ·»åŠ å¤ªå¤šç›‘å¬å™¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼é—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªäº‹ä»¶æœ€å¤šå¯ä»¥æœ‰ 10 ä¸ªç›‘å¬å™¨ã€‚è¿™å°±æ˜¯ <code>defaultMaxListeners</code> çš„ä½œç”¨ã€‚</p><h3 id="events-defaultmaxlisteners-1" tabindex="-1"><a class="header-anchor" href="#events-defaultmaxlisteners-1"><span><code>events.defaultMaxListeners</code></span></a></h3><p><code>events.defaultMaxListeners</code> æ˜¯ <code>EventEmitter</code> ç±»çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè®¾ç½®æ‰€æœ‰ EventEmitter å®ä¾‹çš„é»˜è®¤æœ€å¤§ç›‘å¬å™¨æ•°é‡ã€‚é»˜è®¤å€¼ä¸º 10ã€‚å¦‚æœè§‰å¾—é»˜è®¤å€¼ä¸é€‚åˆä½ çš„åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥ä¿®æ”¹è¿™ä¸ªå±æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¿®æ”¹é»˜è®¤æœ€å¤§ç›‘å¬å™¨æ•°ä¸º 15</span></span>
<span class="line"><span style="color:#D8DEE9;">EventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">defaultMaxListeners</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 15</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå°å‹çš„èŠå¤©æœåŠ¡å™¨ï¼Œéœ€è¦ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ã€æ¶ˆæ¯æ¥æ”¶ã€æ–­å¼€è¿æ¥ç­‰äº‹ä»¶ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šæœ‰è¶…è¿‡ 10 ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥ï¼Œå¦‚æœæ¯ä¸ªè¿æ¥éƒ½éœ€è¦å•ç‹¬ç›‘å¬å‡ ä¸ªäº‹ä»¶ï¼Œå¾ˆå¿«å°±ä¼šè¾¾åˆ°æˆ–è¶…è¿‡é»˜è®¤çš„ç›‘å¬å™¨æ•°é‡é™åˆ¶ã€‚è¿™æ—¶å€™å°±éœ€è¦è°ƒæ•´ <code>defaultMaxListeners</code> çš„å€¼ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> serverEventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è°ƒæ•´ä¸ºæ›´é«˜çš„å€¼ä»¥æ”¯æŒæ›´å¤šç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">serverEventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">30</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">serverEventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Client connected: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">id</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿˜æœ‰ä¸å°‘ç±»ä¼¼çš„äº‹ä»¶ç›‘å¬å™¨...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">serverEventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> id</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>EventEmitter</code> ç±»ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ <code>serverEventEmitter</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>setMaxListeners</code> æ–¹æ³•è°ƒæ•´äº†è¯¥å‘å°„å™¨çš„æœ€å¤§ç›‘å¬å™¨æ•°é‡ï¼Œä»¥æ”¯æŒæ›´å¤šçš„å¹¶å‘å®¢æˆ·ç«¯äº‹ä»¶ç›‘å¬ã€‚æœ€åï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡ <code>.on()</code> æ–¹æ³•æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶é€šè¿‡ <code>.emit()</code> è§¦å‘ä¸€ä¸ªåä¸º &#39;connect&#39; çš„äº‹ä»¶ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>ä¿®æ”¹ <code>defaultMaxListeners</code> éœ€è°¨æ…ï¼Œç¡®ä¿ä¸ä¼šæ— æ„ä¸­å¼•èµ·å†…å­˜æ³„æ¼ã€‚</li><li>åœ¨æœ‰è®¸å¤šå¯¹è±¡éœ€è¦é¢‘ç¹æ·»åŠ å’Œç§»é™¤ç›‘å¬å™¨çš„åœºæ™¯ï¼Œé€‚å½“å¢åŠ  <code>defaultMaxListeners</code> çš„å€¼å¯èƒ½æ˜¯å¿…è¦çš„ã€‚</li><li>ä½¿ç”¨ <code>emitter.setMaxListeners(n)</code> å¯ä»¥ä¸ºç‰¹å®šçš„ EventEmitter å®ä¾‹è®¾ç½®æœ€å¤§ç›‘å¬å™¨æ•°ï¼Œè€Œä¸å½±å“å…¨å±€é»˜è®¤å€¼ã€‚</li></ul><h2 id="events-errormonitor" tabindex="-1"><a class="header-anchor" href="#events-errormonitor"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventserrormonitor" target="_blank" rel="noopener noreferrer">events.errorMonitor</a></span></a></h2><p>Node.js ä¸­çš„ <code>events.errorMonitor</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¬¦å·ï¼Œå®ƒç”¨äºä½œä¸º <code>EventEmitter</code> å®ä¾‹ä¸Šçš„ä¸€ä¸ªç‰¹æ®Šç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨ä¼šåœ¨æ™®é€šçš„ &#39;error&#39; äº‹ä»¶ç›‘å¬å™¨ä¹‹å‰è§¦å‘ã€‚è¿™å¯¹äºé”™è¯¯ç›‘æµ‹å’Œé¢„é˜²æœªå¤„ç†é”™è¯¯å¯¼è‡´ç¨‹åºå´©æºƒéå¸¸æœ‰ç”¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªç”¨äºå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„çš„ç±»ï¼Œè®¸å¤šå†…ç½®æ¨¡å—éƒ½ç»§æ‰¿è‡ªå®ƒï¼Œå¦‚ httpã€fs ç­‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ å‘ EventEmitter çš„å®ä¾‹æ·»åŠ  &#39;error&#39; äº‹ä»¶ç›‘å¬å™¨æ—¶ï¼Œå¦‚æœè¯¥äº‹ä»¶è¢«è§¦å‘è€Œæ²¡æœ‰æ³¨å†Œä»»ä½•ç›‘å¬å™¨ï¼ŒNode.js ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒã€‚</p><p>ä½¿ç”¨ <code>events.errorMonitor</code> å¯ä»¥ä½¿ä½ åœ¨ä¸å¹²æ‰° &#39;error&#39; äº‹ä»¶æ­£å¸¸æµç¨‹çš„æƒ…å†µä¸‹ï¼Œé¢å¤–æ”¶é›†åˆ°é”™è¯¯ä¿¡æ¯ï¼Œä»è€Œè¿›è¡Œæ—¥å¿—è®°å½•ã€æŠ¥å‘Šæˆ–è€…å…¶ä»–å½¢å¼çš„é”™è¯¯å¤„ç†ï¼Œè€Œä¸ä¼šé˜»æ­¢å…¶ä»– &#39;error&#39; äº‹ä»¶ç›‘å¬å™¨æ‰§è¡Œã€‚</p><h3 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŸºäº Node.js çš„ç®€å• web åº”ç”¨ï¼Œæˆ‘ä»¬æƒ³è¦ç›‘å¬æœåŠ¡å™¨å¯èƒ½é‡åˆ°çš„é”™è¯¯ï¼ŒåŒæ—¶ç¡®ä¿è¿™äº›é”™è¯¯èƒ½å¤Ÿè¢«æ°å½“åœ°è®°å½•ï¼Œå¹¶ä¸”ä¸å½±å“åº”ç”¨çš„æ­£å¸¸è¿è¡Œã€‚</p><p>é¦–å…ˆï¼Œå¼•å…¥å¿…è¦çš„æ¨¡å—å¹¶åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ errorMonitor ä¸Šçš„é”™è¯¯ï¼Œç”¨äºè®°å½•é”™è¯¯</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">EventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">errorMonitor</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">é€šè¿‡ errorMonitor ç›‘æ§åˆ°çš„é”™è¯¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¹Ÿå¯ä»¥ç›‘å¬æ™®é€šçš„ &#39;error&#39; äº‹ä»¶ï¼Œæ¯”å¦‚ç”¨æ¥æ¢å¤æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¤„ç†é”™è¯¯:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿé”™è¯¯äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å‡ºé”™å•¦ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyEmitter</code> ç±»ç”¨æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>events.errorMonitor</code>ã€‚æˆ‘ä»¬é¦–å…ˆå¯¹ <code>myEmitter</code> å®ä¾‹ä½¿ç”¨ <code>.on()</code> æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ªç›‘å¬å™¨åˆ° <code>EventEmitter.errorMonitor</code>ï¼Œè¿™æ ·å½“ &#39;error&#39; äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—é”™è¯¯ä¿¡æ¯ä½†ä¸å¹²æ‰°æ­£å¸¸çš„ &#39;error&#39; äº‹ä»¶æµç¨‹ã€‚ç´§æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡ <code>.emit(&#39;error&#39;, new Error(&#39;å‡ºé”™å•¦ï¼&#39;))</code> æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯ï¼Œæ¥çœ‹çœ‹ <code>errorMonitor</code> æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>è®°ä½ï¼Œè™½ç„¶è¿™ä¸ªç‰¹æ€§è®©é”™è¯¯å¤„ç†å˜å¾—æ›´åŠ çµæ´»ï¼Œä½†æ˜¯æ­£ç¡®åœ°ç®¡ç† &#39;error&#39; äº‹ä»¶ä»ç„¶å¾ˆé‡è¦ï¼Œä»¥é¿å…å¯èƒ½çš„ç¨‹åºå´©æºƒã€‚</p><h2 id="events-geteventlisteners-emitterortarget-eventname" tabindex="-1"><a class="header-anchor" href="#events-geteventlisteners-emitterortarget-eventname"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventsgeteventlistenersemitterortarget-eventname" target="_blank" rel="noopener noreferrer">events.getEventListeners(emitterOrTarget, eventName)</a></span></a></h2><p>Node.js ä¸­çš„ <code>events.getEventListeners(emitterOrTarget, eventName)</code> æ–¹æ³•æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨ä¸”å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ æŸ¥è¯¢å’Œè·å–ç»‘å®šåˆ°ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ï¼ˆlistenerï¼‰å‡½æ•°ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨å¤„ç†äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºæ—¶å°¤å…¶é‡è¦ã€‚</p><p>è®©æˆ‘ä»¬å…ˆç†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ul><li><strong>äº‹ä»¶</strong>ï¼ˆEventï¼‰: åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½ä¼šå‘å‡ºäº‹ä»¶ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚å¯¹è±¡å¯èƒ½ä¼šå‘å‡º &#39;data&#39; äº‹ä»¶æ¥è¡¨ç¤ºæ•°æ®æ¥æ”¶ä¸­ï¼Œæˆ–è€… &#39;end&#39; äº‹ä»¶æ¥è¡¨ç¤ºæ•°æ®ä¼ è¾“å®Œæˆã€‚</li><li><strong>äº‹ä»¶å‘å°„å™¨</strong>ï¼ˆEventEmitterï¼‰: Node.js æä¾›äº† <code>EventEmitter</code> ç±»ï¼Œç”¨äºå¤„ç†äº‹ä»¶å’Œç›‘å¬å™¨ã€‚ä»»ä½•æƒ³è¦å‘å‡ºäº‹ä»¶çš„å¯¹è±¡é€šå¸¸éƒ½æ˜¯ <code>EventEmitter</code> çš„å®ä¾‹ã€‚</li><li><strong>ç›‘å¬å™¨</strong>ï¼ˆListenerï¼‰: æ˜¯è¢«è§¦å‘æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œç”¨æ¥å“åº”ç‰¹å®šäº‹ä»¶çš„å‘ç”Ÿã€‚</li></ul><h3 id="ä½¿ç”¨-events-geteventlisteners" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-events-geteventlisteners"><span>ä½¿ç”¨ <code>events.getEventListeners</code></span></a></h3><p>å½“ä½ éœ€è¦äº†è§£æŸä¸ªäº‹ä»¶ä¸Šæ³¨å†Œäº†å“ªäº›ç›‘å¬å™¨ï¼Œæˆ–è€…ä½ éœ€è¦è¿›è¡Œé”™è¯¯æ’æŸ¥ã€æ€§èƒ½åˆ†ææ—¶ï¼Œ<code>events.getEventListeners</code> å°±å˜å¾—éå¸¸æœ‰ç”¨ã€‚</p><h4 id="å‡½æ•°ç­¾å" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°ç­¾å"><span>å‡½æ•°ç­¾å</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> listeners</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getEventListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">emitterOrTarget</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> eventName</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>emitterOrTarget</code>: è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼ˆ<code>EventEmitter</code> å®ä¾‹ï¼‰æˆ–ä»»ä½•æ”¯æŒäº‹ä»¶çš„å¯¹è±¡ã€‚</li><li><code>eventName</code>: è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºä½ æƒ³è¦æŸ¥è¯¢çš„äº‹ä»¶åç§°ã€‚</li></ul><p>å‡½æ•°è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰æ³¨å†Œåˆ°æŒ‡å®šäº‹ä»¶çš„ç›‘å¬å™¨å‡½æ•°ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨äº† Node.js çš„ <code>http</code> æ¨¡å—ã€‚</p><ol><li><p><strong>æœåŠ¡å™¨äº‹ä»¶ç›‘å¬å™¨æŸ¥è¯¢</strong></p><p>å‡è®¾æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç›‘å¬ &#39;request&#39; äº‹ä»¶ä»¥å¤„ç†è¿›æ¥çš„ HTTP è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> events</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æƒ³çŸ¥é“ &#39;request&#39; äº‹ä»¶ä¸Šæ³¨å†Œäº†å¤šå°‘ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestListeners</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getEventListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">requestListeners</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™å°†è¾“å‡ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬å®šä¹‰çš„å›è°ƒå‡½æ•°çš„æ•°ç»„</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨æŸ¥è¯¢</strong></p><p>å¦‚æœä½ åœ¨è‡ªå·±çš„ä»£ç ä¸­ä½¿ç”¨äº† <code>EventEmitter</code> æ¥å¤„ç†è‡ªå®šä¹‰äº‹ä»¶ï¼Œ<code>events.getEventListeners</code> åŒæ ·å¯ä»¥å¸®åŠ©ä½ æŸ¥è¯¢è¿™äº›äº‹ä»¶çš„ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸¤ä¸ªç›‘å¬å™¨å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> listener1</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">listener1 called</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> listener2</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">listener2 called</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å°†è¿™ä¸¤ä¸ªç›‘å¬å™¨ç»‘å®šåˆ°è‡ªå®šä¹‰äº‹ä»¶ &#39;event1&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listener1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listener2</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æŸ¥è¯¢ &#39;event1&#39; äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> event1Listeners</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getEventListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">event1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">event1Listeners</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºï¼š2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨å¼€å‘å¤æ‚çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œèƒ½å¤ŸæŸ¥è¯¢äº‹ä»¶çš„ç›‘å¬å™¨éå¸¸æœ‰åŠ©äºç†è§£äº‹ä»¶æµå’Œè¿›è¡Œè°ƒè¯•ã€‚é€šè¿‡ä½¿ç”¨ <code>events.getEventListeners</code>ï¼Œä½ å¯ä»¥è½»æ¾åœ°è·å–åˆ°è¿™äº›ä¿¡æ¯ï¼Œå¹¶æ›´åŠ æœ‰æ•ˆåœ°ç®¡ç†ä½ çš„äº‹ä»¶ç›‘å¬å™¨ã€‚</p><h2 id="events-getmaxlisteners-emitterortarget" tabindex="-1"><a class="header-anchor" href="#events-getmaxlisteners-emitterortarget"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventsgetmaxlistenersemitterortarget" target="_blank" rel="noopener noreferrer">events.getMaxListeners(emitterOrTarget)</a></span></a></h2><p>å½“ä½ å¼€å§‹ä½¿ç”¨ Node.jsï¼Œä¸€ä¸ªéå¸¸é‡è¦ä¸”å¼ºå¤§çš„æ¦‚å¿µå°±æ˜¯â€œäº‹ä»¶â€ã€‚Node.js å†…éƒ¨æœ‰ä¸€ä¸ªæ¨¡å—å«åš<code>events</code>ã€‚è¿™ä¸ªæ¨¡å—å…è®¸ä½ åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå·±çš„äº‹ä»¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œäº‹ä»¶å°±åƒæ˜¯ç”Ÿæ´»ä¸­çš„é€šçŸ¥ï¼Œä¾‹å¦‚ï¼Œå½“ä½ çš„ç”µè¯é“ƒå£°å“èµ·æ—¶ï¼Œè¿™æ„å‘³ç€æœ‰äººæ­£åœ¨æ‰“ç”µè¯ç»™ä½ ï¼›æˆ–è€…å½“å¾®æ³¢ç‚‰â€œå®â€åœ°ä¸€å£°å“æ—¶ï¼Œæ„å‘³ç€ä½ åŠ çƒ­çš„é£Ÿç‰©å·²ç»å‡†å¤‡å¥½äº†ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œè¿™ç§äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯ç”¨äºå¤„ç†ç½‘ç»œæ“ä½œï¼Œæ–‡ä»¶æ“ä½œç­‰å¼‚æ­¥ä»»åŠ¡ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº<code>events.getMaxListeners(emitterOrTarget)</code>è¿™ä¸ªå‡½æ•°ä¸Šã€‚</p><h3 id="åŸºæœ¬ç†è§£" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç†è§£"><span>åŸºæœ¬ç†è§£</span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä»€ä¹ˆæ˜¯â€œç›‘å¬å™¨â€ã€‚ç›‘å¬å™¨å…¶å®å°±æ˜¯ä¸€æ®µä»£ç ï¼ˆä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œå®ƒä¼šåœ¨æŸä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ª HTTP æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„è¯·æ±‚æ—¶ï¼Œå®ƒå¯èƒ½ä¼šè§¦å‘ä¸€ä¸ªâ€œrequestâ€äº‹ä»¶ï¼Œå¹¶å¯¹æ­¤äº‹ä»¶è¿›è¡Œç›‘å¬ï¼Œä»¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</p><p>ç„¶è€Œï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼ŒNode.js å¯¹æ¯ä¸ªäº‹ä»¶å¯ä»¥æ·»åŠ çš„ç›‘å¬å™¨æ•°é‡æœ‰é»˜è®¤çš„é™åˆ¶ï¼Œè¿™ä¸ªé»˜è®¤å€¼é€šå¸¸æ˜¯ 10 ä¸ªã€‚è¿™æ„å‘³ç€å¦‚æœä½ å‘åŒä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†è¶…è¿‡ 10 ä¸ªç›‘å¬å™¨ï¼ŒNode.js ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå†…å­˜æ³„éœ²çš„è¿¹è±¡å¹¶ç»™å‡ºè­¦å‘Šã€‚</p><p>è¿™é‡Œå°±æ˜¯<code>getMaxListeners</code>å‡½æ•°æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹äº†ã€‚<code>events.getMaxListeners(emitterOrTarget)</code>å…è®¸ä½ æŸ¥çœ‹ä»»ä½•ç»™å®šçš„äº‹ä»¶å‘å°„å™¨ï¼ˆemitterï¼‰ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥å‘å‡ºäº‹ä»¶çš„å¯¹è±¡ï¼‰æˆ–è€…äº‹ä»¶ç›®æ ‡ï¼ˆæ¯”å¦‚è¯´ DOM å…ƒç´ ï¼Œåœ¨ Node.js ä¸­é€šå¸¸æŒ‡äº‹ä»¶å‘å°„å™¨ï¼‰çš„æœ€å¤§ç›‘å¬å™¨é™åˆ¶ã€‚è¿™ä¸ªä¿¡æ¯å¯¹äºè°ƒè¯•æˆ–è€…ä¼˜åŒ–åº”ç”¨ç¨‹åºæ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><strong>åˆ›å»ºä¸€ä¸ªç®€å•çš„äº‹ä»¶å‘å°„å™¨</strong></li></ol><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼Œå¹¶å°è¯•äº†è§£å®ƒçš„æœ€å¤§ç›‘å¬å™¨é™åˆ¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">EventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myEmitter</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é»˜è®¤æƒ…å†µä¸‹è¾“å‡º 10</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ä¿®æ”¹æœ€å¤§ç›‘å¬å™¨é™åˆ¶å¹¶éªŒè¯</strong></li></ol><p>å¦‚æœä½ å› ä¸ºæŸäº›åŸå› éœ€è¦æ›´å¤šçš„ç›‘å¬å™¨ï¼Œä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªé™åˆ¶ã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å½“å‰çš„é™åˆ¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">EventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myEmitter</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º 20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å¹¶ç›‘æ§äº‹ä»¶ç›‘å¬å™¨çš„æ•°é‡ä¸Šé™ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦å…³å¿ƒç›‘å¬å™¨çš„æ•°é‡" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦å…³å¿ƒç›‘å¬å™¨çš„æ•°é‡"><span>ä¸ºä»€ä¹ˆè¦å…³å¿ƒç›‘å¬å™¨çš„æ•°é‡ï¼Ÿ</span></a></h3><ul><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šæ¯ä¸ªç›‘å¬å™¨éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ‰€æœ‰çš„ç›‘å¬å™¨éƒ½ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœç›‘å¬å™¨å¤ªå¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œç¼“æ…¢ã€‚</li><li><strong>å†…å­˜æ³„éœ²</strong>ï¼šæ— é™åˆ¶åœ°æ·»åŠ ç›‘å¬å™¨å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºä¸€äº›å¯èƒ½ä¸å†éœ€è¦çš„ç›‘å¬å™¨å æ®äº†å†…å­˜ç©ºé—´ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œ<code>events.getMaxListeners(emitterOrTarget)</code>æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·ï¼Œå®ƒå¸®åŠ©ä½ ç®¡ç†å’Œè°ƒè¯•äº‹ä»¶ç›‘å¬å™¨ï¼Œç¡®ä¿äº† Node.js åº”ç”¨çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><h2 id="events-once-emitter-name-options" tabindex="-1"><a class="header-anchor" href="#events-once-emitter-name-options"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventsonceemitter-name-options" target="_blank" rel="noopener noreferrer">events.once(emitter, name[, options])</a></span></a></h2><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>events.once(emitter, name[, options])</code> å‡½æ•°ï¼Œå¹¶é€šè¿‡ä¸€äº›ç®€å•çš„ç¤ºä¾‹æ¥æ¢ç´¢å®ƒåœ¨å®é™…åº”ç”¨ä¸­çš„ä½¿ç”¨ã€‚</p><p>é¦–å…ˆï¼ŒåŸºæœ¬ä¸Šï¼ŒNode.js æ˜¯ä¸€ä¸ªå¼€æºå’Œè·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯&quot;äº‹ä»¶é©±åŠ¨ç¼–ç¨‹&quot;ï¼šç¨‹åºçš„æ‰§è¡Œæµç”±ç­‰å¾…å’Œè§¦å‘äº‹ä»¶æ¥æ§åˆ¶ã€‚ä¸ºäº†å¤„ç†äº‹ä»¶ï¼ŒNode.js æä¾›äº†ä¸€ä¸ªå†…ç½®æ¨¡å—å«åš <code>events</code>ï¼Œè®©ä½ å¯ä»¥åˆ›å»ºã€å‘å°„å’Œç›‘å¬ä½ è‡ªå·±çš„äº‹ä»¶ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-events-once-emitter-name-options" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-events-once-emitter-name-options"><span>ä»€ä¹ˆæ˜¯ <code>events.once(emitter, name[, options])</code>?</span></a></h3><p><code>events.once</code> å‡½æ•°æ˜¯ <code>events</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºåªç›‘å¬ä¸€æ¬¡ç»™å®šçš„äº‹ä»¶ï¼Œç„¶åè‡ªåŠ¨ç§»é™¤ç›‘å¬å™¨ã€‚è¿™éå¸¸æœ‰ç”¨ï¼Œå½“ä½ åªæƒ³å¯¹ä¸‹ä¸€æ¬¡å‘ç”Ÿçš„äº‹ä»¶ä½œå‡ºå“åº”ï¼Œè€Œä¸å…³å¿ƒä¹‹åå‘ç”Ÿçš„åŒç±»äº‹ä»¶æ—¶ã€‚</p><h3 id="å‚æ•°è§£æ" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£æ"><span>å‚æ•°è§£æ</span></a></h3><ul><li><code>emitter</code>: æ˜¯ä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼ˆEventEmitterï¼‰å®ä¾‹ï¼Œä½ éœ€è¦ç›‘å¬å…¶ä¸Šçš„äº‹ä»¶ã€‚</li><li><code>name</code>: æ˜¯ä½ æƒ³è¦ç›‘å¬çš„äº‹ä»¶åã€‚</li><li><code>options</code>: æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œæä¾›é…ç½®ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-ç›‘å¬æœåŠ¡å™¨åªå“åº”ä¸€æ¬¡çš„è¿æ¥äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç›‘å¬æœåŠ¡å™¨åªå“åº”ä¸€æ¬¡çš„è¿æ¥äº‹ä»¶"><span>ç¤ºä¾‹ 1: ç›‘å¬æœåŠ¡å™¨åªå“åº”ä¸€æ¬¡çš„è¿æ¥äº‹ä»¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ åªæƒ³åœ¨ç¬¬ä¸€æ¬¡æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶æ‰“å°ä¿¡æ¯ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> once</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Ahoy! We got our first visitor!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>once(server, &#39;connection&#39;)</code> ç›‘å¬äº†æœåŠ¡å™¨çš„<code>&#39;connection&#39;</code>äº‹ä»¶ï¼Œä½†åªä¼šåœ¨ç¬¬ä¸€æ¬¡äº‹ä»¶å‘ç”Ÿæ—¶è§¦å‘ã€‚ä¸€æ—¦æœ‰äººè®¿é—®ä½ çš„æœåŠ¡å™¨ï¼Œå®ƒå°±ä¼šæ‰“å°å‡ºæ¶ˆæ¯â€œAhoy! We got our first visitor!â€ã€‚</p><h4 id="ç¤ºä¾‹-2-ç­‰å¾…è¯»å–æµå®Œæˆ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç­‰å¾…è¯»å–æµå®Œæˆ"><span>ç¤ºä¾‹ 2: ç­‰å¾…è¯»å–æµå®Œæˆ</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶ä¸”åªå…³å¿ƒä½•æ—¶å®Œæˆã€‚ä½ å¯ä»¥åˆ©ç”¨<code>once</code>æ¥ç›‘å¬<code>&#39;end&#39;</code>äº‹ä»¶ï¼Œä»£è¡¨æ²¡æœ‰æ›´å¤šæ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> once</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">length</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> bytes of data.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Stream ended, no more data.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>.on()</code>æ–¹æ³•æ¥ç›‘å¬æ¯ä¸ªæ•°æ®å—çš„åˆ°è¾¾ï¼Œå¹¶ä½¿ç”¨<code>once()</code>æ¥çŸ¥é“ä½•æ—¶æ•°æ®ä¼ è¾“å®Œæˆï¼Œå³æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶ã€‚</p><h3 id="ç»“è¯­" tabindex="-1"><a class="header-anchor" href="#ç»“è¯­"><span>ç»“è¯­</span></a></h3><p>é€šè¿‡<code>events.once</code>ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°å¤„ç†åªéœ€è¦ä¸€æ¬¡å“åº”çš„äº‹ä»¶ï¼Œè€Œæ— éœ€æ‰‹åŠ¨æ·»åŠ å’Œå»é™¤ç›‘å¬å™¨ã€‚è¿™å¯¹äºç®¡ç†èµ„æºå’Œé¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼åœ¨ç¼–å†™ç¨³å¥çš„ Node.js åº”ç”¨ç¨‹åºæ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="awaiting-multiple-events-emitted-on-process-nexttick" tabindex="-1"><a class="header-anchor" href="#awaiting-multiple-events-emitted-on-process-nexttick"><span><a href="https://nodejs.org/docs/latest/api/events.html#awaiting-multiple-events-emitted-on-processnexttick" target="_blank" rel="noopener noreferrer">Awaiting multiple events emitted on process.nextTick()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js v21.7.1 ä¸­æåˆ°çš„ â€œAwaiting multiple events emitted on process.nextTick()â€ çš„æ¦‚å¿µï¼Œå¹¶å°è¯•ç”¨ä¸€ç§é€šä¿—æ˜“æ‡‚çš„æ–¹å¼æ¥è§£é‡Šå®ƒã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š<code>process.nextTick()</code>, äº‹ä»¶ (<code>events</code>), å’Œå¼‚æ­¥ç¼–ç¨‹ã€‚</p><h3 id="å…³é”®æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#å…³é”®æ¦‚å¿µ"><span>å…³é”®æ¦‚å¿µ</span></a></h3><ol><li><p><strong>process.nextTick()</strong>:</p><ul><li>åœ¨ Node.js ä¸­ï¼Œ<code>process.nextTick()</code> æ˜¯ä¸€ä¸ªå°†å›è°ƒå‡½æ•°æ”¾å…¥ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯çš„æ–¹æ³•ã€‚è¿™æ„å‘³ç€æ— è®ºä½•æ—¶ä½ è°ƒç”¨ <code>process.nextTick()</code>ï¼Œä¼ é€’ç»™å®ƒçš„å‡½æ•°éƒ½ä¼šåœ¨å½“å‰æ“ä½œå®Œæˆåã€ä»»ä½•å…¶ä»–å¼‚æ­¥æ“ä½œå¼€å§‹ä¹‹å‰è¢«æ‰§è¡Œã€‚</li></ul></li><li><p><strong>äº‹ä»¶ (Events)</strong>:</p><ul><li>Node.js ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼ŒæŸäº›ç±»å‹çš„å¯¹è±¡ï¼ˆç§°ä¸º &quot;emitters&quot;ï¼‰å¯ä»¥å‘å‡ºäº‹ä»¶ï¼Œå…¶ä»–å¯¹è±¡ï¼ˆ&quot;listeners&quot; æˆ– &quot;handlers&quot;ï¼‰å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶å¹¶åšå‡ºç›¸åº”çš„ååº”ã€‚è¿™æ˜¯å®ç°éé˜»å¡ï¼ˆå¼‚æ­¥ï¼‰I/O æ“ä½œçš„åŸºç¡€ã€‚</li></ul></li><li><p><strong>å¼‚æ­¥ç¼–ç¨‹</strong>:</p><ul><li>å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§å…è®¸ç¨‹åºç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡è€Œä¸å¿…ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆçš„ç¼–ç¨‹èŒƒå¼ã€‚Node.js å¤§é‡ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰æ–¹é¢ã€‚</li></ul></li></ol><h3 id="awaiting-multiple-events-emitted-on-process-nexttick-1" tabindex="-1"><a class="header-anchor" href="#awaiting-multiple-events-emitted-on-process-nexttick-1"><span>Awaiting Multiple Events Emitted on process.nextTick()</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œâ€œAwaiting multiple events emitted on process.nextTick()â€æŒ‡çš„æ˜¯ä¸€ç§èƒ½åŠ›ï¼Œå³åœ¨åŒä¸€ä¸ª <code>process.nextTick()</code> è°ƒç”¨ä¸­ç­‰å¾…å¤šä¸ªäº‹ä»¶å‘ç”Ÿï¼Œå¹¶å¯¹è¿™äº›äº‹ä»¶è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåœ¨çº¿èŠå¤©åº”ç”¨ï¼Œä½ æƒ³è¦åœ¨ç”¨æˆ·åŠ å…¥èŠå¤©å®¤çš„ç¬é—´æ£€æµ‹åˆ°å¹¶ä½œå‡ºå‡ ä¸ªå“åº”ï¼š</p><ol><li>å‘é€æ¬¢è¿æ¶ˆæ¯ç»™æ–°ç”¨æˆ·ã€‚</li><li>é€šçŸ¥å…¶ä»–ç”¨æˆ·æœ‰æ–°æˆå‘˜åŠ å…¥ã€‚</li><li>æ›´æ–°èŠå¤©å®¤çš„æˆå‘˜åˆ—è¡¨ã€‚</li></ol><p>ä¸ºäº†å®ç°è¿™ä¸‰ä¸ªæ“ä½œï¼Œä½ å¯èƒ½ä¼šå®šä¹‰ä¸€ä¸ªäº‹ä»¶ <code>userJoined</code>ï¼Œç„¶åé’ˆå¯¹è¿™ä¸ªäº‹ä»¶ç¼–å†™å‡ ä¸ªäº‹ä»¶ç›‘å¬å™¨å¤„ç†ä¸Šè¿°ä»»åŠ¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> ChatRoom</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chatRoom</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ChatRoom</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;userJoined&#39; äº‹ä»¶å‘é€æ¬¢è¿æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userJoined</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">user</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Welcome, </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">user</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">!</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬åŒä¸€äº‹ä»¶é€šçŸ¥å…¶ä»–ç”¨æˆ·</span></span>
<span class="line"><span style="color:#D8DEE9;">chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userJoined</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">user</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">user</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> has joined the chat.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬åŒä¸€äº‹ä»¶æ›´æ–°èŠå¤©å®¤æˆå‘˜åˆ—è¡¨</span></span>
<span class="line"><span style="color:#D8DEE9;">chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userJoined</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">user</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾ updateMemberList æ˜¯æ›´æ–°æˆå‘˜åˆ—è¡¨çš„å‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">  updateMemberList</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">user</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿç”¨æˆ·åŠ å…¥</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">nextTick</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userJoined</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>process.nextTick()</code> æ¥æ¨¡æ‹Ÿç”¨æˆ·åŠ å…¥èŠå¤©å®¤çš„æƒ…å†µã€‚å½“è°ƒç”¨ <code>chatRoom.emit(&#39;userJoined&#39;, &#39;Alice&#39;);</code> æ—¶ï¼Œå·²ç»æ³¨å†Œçš„æ‰€æœ‰ <code>&#39;userJoined&#39;</code> äº‹ä»¶ç›‘å¬å™¨ï¼ˆå‘é€æ¬¢è¿æ¶ˆæ¯ã€é€šçŸ¥å…¶ä»–ç”¨æˆ·å’Œæ›´æ–°æˆå‘˜åˆ—è¡¨ï¼‰å°†ä¼šåœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯è½®æ¬¡ä¸­æŒ‰é¡ºåºå¼‚æ­¥æ‰§è¡Œã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ç¡®ä¿å³ä½¿æœ‰å¤šä¸ªä»»åŠ¡éœ€è¦å¯¹åŒä¸€ä¸ªäº‹ä»¶ä½œå‡ºå“åº”ï¼Œå®ƒä»¬ä¹Ÿéƒ½èƒ½åœ¨æ­£ç¡®çš„æ—¶é—´ç‚¹å¾—åˆ°å¤„ç†ï¼Œä¸”ä¸ä¼šé˜»å¡ä»£ç çš„å…¶ä»–éƒ¨åˆ†ã€‚è¿™å°±æ˜¯ Node.js ä¸­å¤„ç†å¤šä¸ªäº‹ä»¶ç›‘å¬å™¨çš„ä¼˜é›…æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¸Œæœ›è¿™äº›ç›‘å¬å™¨èƒ½å¤Ÿåœ¨ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯ä¸­ç«‹å³æ‰§è¡Œè€Œä¸äº’ç›¸å¹²æ‰°æ—¶ã€‚</p><h2 id="events-capturerejections" tabindex="-1"><a class="header-anchor" href="#events-capturerejections"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventscapturerejections" target="_blank" rel="noopener noreferrer">events.captureRejections</a></span></a></h2><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>events.captureRejections</code> åŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£ <code>events.captureRejections</code>ï¼Œæˆ‘ä»¬éœ€è¦ä» Node.js çš„äº‹ä»¶ç³»ç»Ÿå’Œå¼‚æ­¥ç¼–ç¨‹è¯´èµ·ã€‚åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¤„ç†æ˜¯éå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå®ƒå…è®¸ä½ åœ¨å‘ç”Ÿç‰¹å®šäº‹æƒ…æ—¶è¿è¡Œä»£ç ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ EventEmitter ç±»æ¥å®ç°çš„ï¼Œå®ƒæ˜¯ Node.js çš„äº‹ä»¶é©±åŠ¨æ¶æ„çš„åŸºçŸ³ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-1"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><h4 id="eventemitter-1" tabindex="-1"><a class="header-anchor" href="#eventemitter-1"><span>EventEmitter</span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªç±»ï¼Œç”¨äºå¤„ç†äº‹ä»¶ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>EventEmitter</code> å®ä¾‹ï¼Œå¹¶ç”¨å®ƒæ¥å‘å°„ï¼ˆemitï¼‰äº‹ä»¶å’Œç›‘å¬ï¼ˆlistenï¼‰è¿™äº›äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå½“ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®å®Œæˆæ—¶ï¼Œå¯ä»¥å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-rejections" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-rejections"><span>ä»€ä¹ˆæ˜¯ Rejectionsï¼Ÿ</span></a></h3><p>åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼ŒPromises æ˜¯ç®¡ç†å¼‚æ­¥æ“ä½œçš„å¸¸ç”¨æ–¹å¼ã€‚ä¸€ä¸ª Promise å¯ä»¥æœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆç­‰å¾…ä¸­ï¼‰ï¼Œfulfilledï¼ˆå·²æˆåŠŸï¼‰ï¼Œæˆ– rejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚å½“æˆ‘ä»¬è°ˆåˆ° &quot;rejection&quot; æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ Promise å› ä¸ºæŸäº›åŸå› å¤±è´¥äº†çš„çŠ¶æ€ã€‚</p><h3 id="capturerejections-çš„å¼•å…¥" tabindex="-1"><a class="header-anchor" href="#capturerejections-çš„å¼•å…¥"><span>captureRejections çš„å¼•å…¥</span></a></h3><p>åœ¨è¿‡å»ï¼Œå¦‚æœä¸€ä¸ªç”± EventEmitter è§¦å‘çš„äº‹ä»¶å¤„ç†å™¨æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼ˆè¿”å› Promiseï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚æ­¥å‡½æ•°è¢«æ‹’ç»ï¼ˆrejectedï¼‰ï¼Œåˆ™è¿™ä¸ªé”™è¯¯å¾€å¾€ä¸å®¹æ˜“æ•è·ã€‚</p><p>Node.js v12.17.0 å¼•å…¥äº†å¯¹äº EventEmitter çš„å¼‚æ­¥å‡½æ•°çš„æ‹’ç»å¤„ç†çš„æ”¹è¿›ï¼Œå³ <code>captureRejections</code>ã€‚è¿™ä¸ªåŠŸèƒ½çš„ç›®çš„æ˜¯ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´å®¹æ˜“åœ°ç®¡ç†å’Œå¤„ç†ç”±äºå¼‚æ­¥äº‹ä»¶å¤„ç†å™¨æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-capturerejections" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-capturerejections"><span>å¦‚ä½•ä½¿ç”¨ captureRejectionsï¼Ÿ</span></a></h3><ol><li><p><strong>å¯ç”¨ captureRejections</strong></p><p>ä½ å¯ä»¥å…¨å±€åœ°é€šè¿‡è®¾ç½® <code>EventEmitter.captureRejections = true</code> æ¥å¯ç”¨å®ƒï¼Œæˆ–è€…å¯¹ç‰¹å®šçš„ EventEmitter å®ä¾‹è®¾ç½® <code>emitter.captureRejections = true</code>ã€‚</p></li><li><p><strong>å¤„ç† rejection</strong></p><p>å½“ <code>captureRejections</code> è¢«å¯ç”¨åï¼Œå¦‚æœä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨è¿”å›ä¸€ä¸ªè¢«æ‹’ç»çš„ Promiseï¼Œ<code>EventEmitter</code> å°†ä¼šè‡ªåŠ¨æ•è·è¿™ä¸ªæ‹’ç»ï¼Œå¹¶è§¦å‘ä¸€ä¸ªç‰¹æ®Šçš„ <code>&#39;error&#39;</code> äº‹ä»¶ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥æ·»åŠ ä¸€ä¸ª <code>&#39;error&#39;</code> äº‹ä»¶ç›‘å¬å™¨æ¥ç»Ÿä¸€å¤„ç†è¿™äº›é”™è¯¯ã€‚</p></li></ol><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„æ—¥å¿—æœåŠ¡ï¼Œè¯¥æœåŠ¡ç›‘å¬ &quot;log&quot; äº‹ä»¶ï¼Œå¹¶å¼‚æ­¥åœ°å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥æ–‡ä»¶ã€‚è€ƒè™‘åˆ°æ–‡ä»¶æ“ä½œå¯èƒ½å¤±è´¥ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¼˜é›…åœ°æ•è·è¿™äº›é”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">node:events</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> Logger</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">captureRejections</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> true;</span><span style="color:#616E88;"> // å¯ç”¨ captureRejections</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  async</span><span style="color:#88C0D0;"> log</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼ˆä¾‹å¦‚å†™å…¥æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">Math</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">random</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 0.5</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">      throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Failed to write log</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Logged:</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> logger</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Logger</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ log äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">log</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»Ÿä¸€å¤„ç† &#39;error&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Logging failed:</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ log äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">log</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>Logger</code> ç±»ï¼Œå®ƒç»§æ‰¿è‡ª <code>EventEmitter</code>ã€‚æˆ‘ä»¬é‡å†™äº†æ„é€ å‡½æ•°ä»¥å¯ç”¨ <code>captureRejections</code>ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥æ–¹æ³• <code>log</code>ï¼Œæ¨¡æ‹Ÿæ—¥å¿—å†™å…¥æ“ä½œã€‚å½“ <code>log</code> æ–¹æ³•å› ä¸ºä»»æ„åŸå› å¤±è´¥å¹¶æŠ›å‡ºé”™è¯¯æ—¶ï¼Œè¿™ä¸ªé”™è¯¯ä¼šè¢«è‡ªåŠ¨æ•è·ï¼Œå¹¶è§¦å‘ <code>&#39;error&#39;</code> äº‹ä»¶ï¼Œç„¶åæˆ‘ä»¬åœ¨ <code>&#39;error&#39;</code> äº‹ä»¶çš„ç›‘å¬å™¨ä¸­å¤„ç†è¿™ä¸ªé”™è¯¯ã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>captureRejections</code>ï¼Œæˆ‘ä»¬çš„ä»£ç å˜å¾—æ›´åŠ å¥å£®å’Œæ˜“äºç»´æŠ¤ï¼Œå› ä¸ºæ‰€æœ‰ä¸å¼‚æ­¥æ“ä½œç›¸å…³çš„é”™è¯¯éƒ½å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œç®¡ç†ä¸å¤„ç†ã€‚</p><h2 id="events-capturerejectionsymbol" tabindex="-1"><a class="header-anchor" href="#events-capturerejectionsymbol"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventscapturerejectionsymbol" target="_blank" rel="noopener noreferrer">events.captureRejectionSymbol</a></span></a></h2><p>è¦ç†è§£ <code>events.captureRejectionSymbol</code>ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—ç¨å¾®äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>EventEmitter</code> ç±»ä»¥åŠ Promisesã€‚</p><h3 id="eventemitter-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#eventemitter-ç®€ä»‹"><span>EventEmitter ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¤„ç†æ˜¯é€šè¿‡ä½¿ç”¨ <code>EventEmitter</code> ç±»æ¥å®ç°çš„ã€‚è¿™ä¸ªç±»ç”¨äºå¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡èƒ½å¤Ÿè§¦å‘äº‹ä»¶ï¼Œå¹¶ä¸”å…¶ä»–å¯¹è±¡å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶å¹¶ä½œå‡ºååº”ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚å®Œæˆæ—¶è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åç›¸åº”çš„å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p><h3 id="promise-å’Œ-unhandled-rejections" tabindex="-1"><a class="header-anchor" href="#promise-å’Œ-unhandled-rejections"><span>Promise å’Œ Unhandled Rejections</span></a></h3><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå®ƒä»£è¡¨ä¸€ä¸ªå°šæœªå®Œæˆä½†é¢„æœŸå°†ä¼šå®Œæˆçš„æ“ä½œçš„ç»“æœã€‚ç„¶è€Œï¼Œåœ¨å¤„ç† Promise æ—¶ï¼Œå¦‚æœä¸€ä¸ª Promise è¢«æ‹’ç»ï¼ˆrejectï¼‰äº†ï¼Œå¹¶ä¸”æ²¡æœ‰ç›¸åº”çš„æ‹’ç»å¤„ç†ç¨‹åºï¼ˆå³ catch å—ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸€ä¸ª &quot;Unhandled Rejection&quot; çš„æƒ…å†µã€‚</p><h3 id="events-capturerejectionsymbol-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#events-capturerejectionsymbol-è§£é‡Š"><span>events.captureRejectionSymbol è§£é‡Š</span></a></h3><p><code>events.captureRejectionSymbol</code> æ˜¯ Node.js å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸ <code>EventEmitter</code> å®ä¾‹æ•è· Promise æ‹’ç»ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰è¢« <code>.catch()</code> å¤„ç†çš„é”™è¯¯ï¼‰ã€‚å½“ä½ åœ¨ Emitting äº‹ä»¶æ—¶ä½¿ç”¨äº†ä¸€ä¸ªè¿”å› Promise çš„ç›‘å¬å™¨ï¼Œå¹¶ä¸”è¿™ä¸ª Promise è¢«æ‹’ç»äº†ï¼ŒNode.js å…è®¸è¿™ä¸ªé”™è¯¯è¢«æ•è·å’Œå¤„ç†ï¼Œè€Œä¸æ˜¯æ— å£°åœ°å¤±è´¥æˆ–è€…å¯¼è‡´æœªå¤„ç†çš„ Promise rejectionã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-ä¸ä½¿ç”¨-events-capturerejectionsymbol" tabindex="-1"><a class="header-anchor" href="#_1-ä¸ä½¿ç”¨-events-capturerejectionsymbol"><span>1. ä¸ä½¿ç”¨ <code>events.captureRejectionSymbol</code></span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„äº‹ä»¶ç›‘å¬å™¨å¤„ç†å¼‚æ­¥æ“ä½œï¼Œæ²¡æœ‰ç”¨åˆ° <code>events.captureRejectionSymbol</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;asyncEvent&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Oops! An error occurred.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™é‡Œä¼šäº§ç”Ÿä¸€ä¸ªæœªå¤„ç†çš„Promiseæ‹’ç»è­¦å‘Š</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºæˆ‘ä»¬æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”æ²¡æœ‰æ•è·å®ƒï¼Œæ‰€ä»¥ Node.js ä¼šæç¤ºä¸€ä¸ªæœªå¤„ç†çš„ Promise rejection è­¦å‘Šã€‚</p><h4 id="_2-ä½¿ç”¨-events-capturerejectionsymbol" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨-events-capturerejectionsymbol"><span>2. ä½¿ç”¨ <code>events.captureRejectionSymbol</code></span></a></h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>events.captureRejectionSymbol</code> æ¥æ”¹è¿›ä¸Šé¢çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> captureRejectionSymbol</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨ EventEmitter ä¸Šä½¿ç”¨ captureRejectionSymbol</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#D8DEE9FF;">[</span><span style="color:#D8DEE9;">captureRejectionSymbol</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred in the listener for </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;asyncEvent&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Oops! An error occurred.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç°åœ¨é”™è¯¯è¢«æ•è·å¹¶å¤„ç†äº†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ”¹è¿›åçš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸º <code>MyEmitter</code> å®ä¾‹æ·»åŠ äº†å¯¹ <code>captureRejectionSymbol</code> çš„æ”¯æŒã€‚è¿™æ ·ï¼Œå¦‚æœ <code>&#39;asyncEvent&#39;</code> äº‹ä»¶çš„ç›‘å¬å™¨ä¸­æœ‰ä»»ä½•æœªæ•è·çš„ Promise æ‹’ç»ï¼Œå®ƒä»¬ä¼šè¢«æ•è·å¹¶ä¼ é€’ç»™ <code>captureRejectionSymbol</code> å‡½æ•°å¤„ç†ï¼Œè€Œä¸æ˜¯äº§ç”Ÿä¸€ä¸ªæœªå¤„ç†çš„ Promise rejection è­¦å‘Šã€‚è¿™ä½¿å¾—é”™è¯¯å¤„ç†å˜å¾—æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚</p><h3 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h3><p><code>events.captureRejectionSymbol</code> æä¾›äº†ä¸€ç§åœ¨ Node.js ä¸­ä¼˜é›…å¤„ç† EventEmitter å¼‚æ­¥äº‹ä»¶ä¸­æœªæ•è· Promise æ‹’ç»çš„æœºåˆ¶ã€‚é€šè¿‡å…¶ä½¿ç”¨ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œç®¡ç†å¼‚æ­¥æµç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯æƒ…å†µã€‚</p><h2 id="events-listenercount-emitter-eventname" tabindex="-1"><a class="header-anchor" href="#events-listenercount-emitter-eventname"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventslistenercountemitter-eventname" target="_blank" rel="noopener noreferrer">events.listenerCount(emitter, eventName)</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å®ƒè®© JavaScript ä¸ä»…èƒ½å¤Ÿåˆ›å»ºå‰ç«¯äº¤äº’é€»è¾‘ï¼Œè¿˜èƒ½å¤„ç†åç«¯æœåŠ¡å™¨é€»è¾‘ã€‚å…¶ä¸­ï¼Œä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†å°±æ˜¯<strong>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹</strong>ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¾ˆå¤šäº‹æƒ…éƒ½æ˜¯åŸºäºäº‹ä»¶æ¥è¿›è¡Œçš„ï¼Œæ¯”å¦‚å½“ä½ æŒ‰ä¸‹ç”µæ¢¯æŒ‰é’®æ—¶ï¼Œç”µæ¢¯çŸ¥é“è¦æ¥æ¥ä½ ï¼›å½“ä½ è®¢è´­äº†ä¸œè¥¿åœ¨çº¿ï¼Œå•†å®¶çŸ¥é“è¦ç»™ä½ å‘è´§ã€‚åœ¨ Node.js ä¸­ï¼Œç±»ä¼¼çš„â€œäº‹ä»¶â€å’Œâ€œååº”â€æ¨¡å¼é€šè¿‡æ¨¡å—<code>events</code>å¾—ä»¥å®ç°ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…·ä½“èšç„¦äº<code>events.listenerCount(emitter, eventName)</code>è¿™ä¸ªåŠŸèƒ½ã€‚</p><h3 id="events-listenercount-emitter-eventname-1" tabindex="-1"><a class="header-anchor" href="#events-listenercount-emitter-eventname-1"><span><code>events.listenerCount(emitter, eventName)</code></span></a></h3><p>é¦–å…ˆï¼Œè§£é‡Šä¸€ä¸‹å‚æ•°:</p><ul><li><code>emitter</code>: æ˜¯æŒ‡äº‹ä»¶å‘å°„å™¨çš„å®ä¾‹ï¼Œç®€å•ç†è§£ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯äº‹ä»¶çš„å‘å¸ƒè€…ã€‚</li><li><code>eventName</code>: æ˜¯ä½ æ„Ÿå…´è¶£çš„äº‹ä»¶åç§°ï¼Œå³ä½ æƒ³çŸ¥é“æœ‰å¤šå°‘ç›‘å¬å™¨(listener)å…³æ³¨ç€è¿™ä¸ªç‰¹å®šçš„äº‹ä»¶ã€‚</li></ul><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›æŸä¸ªäº‹ä»¶ä¸Šå½“å‰æ³¨å†Œçš„ç›‘å¬å™¨æ•°é‡ã€‚åœ¨å¤„ç†å¤æ‚çš„äº‹ä»¶é€»è¾‘æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½ä¼šéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©ä½ æŒæ¡æœ‰å¤šå°‘å‡½æ•°æˆ–æ“ä½œæ­£åœ¨ç­‰å¾…å“åº”æŸä¸ªäº‹ä»¶ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£å’Œè°ƒè¯•ä½ çš„ç¨‹åºã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-6"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ç›‘å¬å™¨è®¡æ•°" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ç›‘å¬å™¨è®¡æ•°"><span>ä¾‹å­ 1: ç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ç›‘å¬å™¨è®¡æ•°</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªç½‘ç«™æœåŠ¡å™¨ï¼Œæ¯æ¬¡æœ‰ç”¨æˆ·è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸€ä¸ª<code>visit</code>äº‹ä»¶ã€‚ä½†æ˜¯ï¼Œåœ¨ä¸åŒçš„æ—¶é—´ç‚¹ï¼Œä½ å¯èƒ½ä¼šæ·»åŠ æˆ–åˆ é™¤å¯¹<code>visit</code>äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œä»¥å¤„ç†ä¸åŒçš„ä»»åŠ¡ï¼Œæ¯”å¦‚è®°å½•è®¿é—®æ•°æ®ã€æ£€æŸ¥ç”¨æˆ·èº«ä»½ç­‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> events</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> eventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ ä¸¤ä¸ªç›‘å¬å™¨å¤„ç†è®¿é—®</span></span>
<span class="line"><span style="color:#D8DEE9;">eventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">visit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">User visit logged.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">eventEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">visit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">User authentication checked.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åæ¥å†³å®šä¸å†æ£€æŸ¥ç”¨æˆ·èº«ä»½</span></span>
<span class="line"><span style="color:#616E88;">// ç§»é™¤å¯¹åº”çš„ç›‘å¬å™¨...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listenerCount</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">eventEmitter</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">visit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// è¾“å‡ºå¯èƒ½æ˜¯ 1 æˆ–è€… 2ï¼Œå–å†³äºæ˜¯å¦ç§»é™¤äº†ç›‘å¬å™¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-èŠå¤©åº”ç”¨æ¶ˆæ¯é€šçŸ¥ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-èŠå¤©åº”ç”¨æ¶ˆæ¯é€šçŸ¥ç›‘å¬å™¨"><span>ä¾‹å­ 2: èŠå¤©åº”ç”¨æ¶ˆæ¯é€šçŸ¥ç›‘å¬å™¨</span></a></h4><p>åœ¨ä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ª<code>message</code>äº‹ä»¶ï¼Œæ¯å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶è§¦å‘ã€‚æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ï¼Œä½ å¯èƒ½ä¼šæ·»åŠ å¤šä¸ªç›‘å¬å™¨æ¥å¤„ç†æ¶ˆæ¯ï¼Œæ¯”å¦‚è¿‡æ»¤æ•æ„Ÿè¯ã€é€šçŸ¥å…¶ä»–ç”¨æˆ·ã€æ—¥å¿—è®°å½•ç­‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> events</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chatEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¶ˆæ¯ç›¸å…³çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> filterSensitiveWords</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> notifyUsers</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> logMessage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åŠ¨æ€æ£€æŸ¥æœ‰å¤šå°‘ç›‘å¬å™¨æ­£åœ¨ç›‘å¬`message`äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listenerCount</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// è¾“å‡ºå°†æ˜¯ 3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°<code>events.listenerCount(emitter, eventName)</code>å¦‚ä½•åœ¨å®è·µä¸­è¢«åº”ç”¨ï¼Œä»¥åŠå®ƒå¦‚ä½•å¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†å’Œç†è§£äº‹ä»¶ç›‘å¬å™¨çš„ä½¿ç”¨æƒ…å†µã€‚è¿™å¯¹äºæ„å»ºç¨³å¥ä¸”æ˜“äºç»´æŠ¤çš„ Node.js åº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</p><h2 id="events-on-emitter-eventname-options" tabindex="-1"><a class="header-anchor" href="#events-on-emitter-eventname-options"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventsonemitter-eventname-options" target="_blank" rel="noopener noreferrer">events.on(emitter, eventName[, options])</a></span></a></h2><p>å½“ä½ å¼€å§‹ä½¿ç”¨ Node.jsï¼Œä¸€ä¸ªä½ ä¼šé¢‘ç¹æ‰“äº¤é“çš„å†…ç½®æ¨¡å—å°±æ˜¯ <code>Events</code> æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—å…è®¸æŸäº›å¯¹è±¡ï¼ˆç§°ä¸º &quot;emitters&quot;ï¼‰å‘å‡ºå‘½åäº‹ä»¶ï¼Œç„¶åå‡½æ•°èƒ½å¤Ÿå“åº”è¿™äº›äº‹ä»¶ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç§å®ç°äº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„æ–¹å¼ï¼Œéå¸¸é€‚åˆå¤„ç†å¦‚ç”¨æˆ·è¾“å…¥ã€æœåŠ¡å™¨è¯·æ±‚ç­‰å¼‚æ­¥æ“ä½œã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„ <code>events.on(emitter, eventName[, options])</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ ç›‘å¬æˆ–è€…è¯´è®¢é˜…äº‹ä»¶ç›´åˆ° Promise ç»“æŸã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä»¥æ›´ç°ä»£çš„å¼‚æ­¥å¤„ç†æ–¹å¼æ¥å¤„ç†äº‹ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ async/await ä¸Šä¸‹æ–‡ä¸­ã€‚</p><h3 id="å‚æ•°è§£è¯»" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£è¯»"><span>å‚æ•°è§£è¯»</span></a></h3><ul><li><strong>emitter</strong>: å‘å‡ºäº‹ä»¶çš„å¯¹è±¡ã€‚</li><li><strong>eventName</strong>: ä½ æƒ³è¦ç›‘å¬çš„äº‹ä»¶åç§°ã€‚</li><li><strong>options</strong> (å¯é€‰): ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¯ä»¥ç”¨äºè°ƒæ•´è¡Œä¸ºï¼Œæ¯”å¦‚è®¾ç½®æ˜¯å¦æ•è·ä¸€æ¬¡æ€§äº‹ä»¶ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h3><h4 id="åœºæ™¯ä¸€-æ–‡ä»¶è¯»å†™ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯ä¸€-æ–‡ä»¶è¯»å†™ç›‘å¬"><span>åœºæ™¯ä¸€ï¼šæ–‡ä»¶è¯»å†™ç›‘å¬</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç¨‹åºï¼Œéœ€è¦è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶å¤„ç†é‡Œé¢çš„æ•°æ®ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>fs.createReadStream</code> æ¥åˆ›å»ºä¸€ä¸ªè¯»å–æµï¼Œç„¶åé€šè¿‡ <code>events.on</code> ç›‘å¬ <code>&#39;data&#39;</code> äº‹ä»¶ï¼Œæ¯å½“æœ‰æ–°æ•°æ®å¯ç”¨æ—¶å°±å¤„ç†è¿™äº›æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> on</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> processFile</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;"> of</span><span style="color:#88C0D0;"> on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æ¯ä¸€å—æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">processFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./bigfile.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åœºæ™¯äºŒ-http-æœåŠ¡å™¨è¯·æ±‚ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯äºŒ-http-æœåŠ¡å™¨è¯·æ±‚ç›‘å¬"><span>åœºæ™¯äºŒï¼šHTTP æœåŠ¡å™¨è¯·æ±‚ç›‘å¬</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js æ„å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ å¯èƒ½æƒ³å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚ä½œå‡ºå“åº”ã€‚é€šè¿‡ç›‘å¬ <code>&#39;request&#39;</code> äº‹ä»¶ï¼Œä½ å¯ä»¥æ‹¿åˆ°æ¯ä¸€ä¸ª HTTP è¯·æ±‚å¹¶å¤„ç†å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> on</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> [</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> of</span><span style="color:#88C0D0;"> on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç„¶åä½¿ç”¨ <code>for await...of</code> å¾ªç¯å’Œ <code>events.on</code> æ–¹æ³•ç›‘å¬ <code>&#39;request&#39;</code> äº‹ä»¶ã€‚è¿™æ ·ï¼Œæ¯å½“æœ‰æ–°çš„ HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å‘é€ä¸€ä¸ªç®€å•çš„å“åº”ã€‚</p><h3 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h3><p><code>events.on()</code> æ–¹æ³•ä¸ºåŸºäºäº‹ä»¶çš„ Node.js åº”ç”¨æä¾›äº†ä¸€ç§ä¼˜é›…çš„å¼‚æ­¥å¤„ç†æ–¹å¼ï¼Œå°¤å…¶æ˜¯é…åˆ async/await ä½¿ç”¨æ—¶ã€‚é€šè¿‡ç›‘å¬ emit å‡ºçš„äº‹ä»¶ï¼Œä½ çš„ä»£ç å¯ä»¥åœ¨æ­£ç¡®çš„æ—¶æœºä»¥å£°æ˜å¼çš„æ–¹å¼å“åº”ï¼Œä»è€Œä½¿å¾—äº‹ä»¶é©±åŠ¨çš„é€»è¾‘æ›´åŠ æ¸…æ™°å’Œæ˜“äºç®¡ç†ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹å‡ºè¿™ä¸ªæ–¹æ³•å¦‚ä½•è¢«è¿ç”¨äºä¸åŒçš„æƒ…æ™¯ä¸­å»å“åº”ç³»ç»Ÿçº§äº‹ä»¶æˆ–è‡ªå®šä¹‰äº‹ä»¶ã€‚</p><h2 id="events-setmaxlisteners-n-eventtargets" tabindex="-1"><a class="header-anchor" href="#events-setmaxlisteners-n-eventtargets"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventssetmaxlistenersn-eventtargets" target="_blank" rel="noopener noreferrer">events.setMaxListeners(n[, ...eventTargets])</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œ<code>events</code>æ¨¡å—æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¨¡å—ï¼Œå®ƒç”¨äºå¤„ç†äº‹ä»¶ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ç§æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶èƒ½è®©å¯¹è±¡ï¼ˆé€šå¸¸æˆ‘ä»¬ç§°ä¹‹ä¸º&quot;å‘å°„å™¨&quot;æˆ–&quot;è§¦å‘å™¨&quot;ï¼‰ç›‘å¬å’Œå‘å‡ºè‡ªå®šä¹‰çš„äº‹ä»¶ã€‚è¿™åœ¨æ„å»ºå¤æ‚çš„åº”ç”¨ç¨‹åºæ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¸®åŠ©æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºåˆ’åˆ†ä¸ºé«˜åº¦è§£è€¦çš„éƒ¨åˆ†ï¼Œé€šè¿‡äº‹ä»¶è¿›è¡Œäº¤äº’ã€‚</p><h3 id="events-setmaxlisteners-n-eventtargets-1" tabindex="-1"><a class="header-anchor" href="#events-setmaxlisteners-n-eventtargets-1"><span><code>events.setMaxListeners(n[, ...eventTargets])</code></span></a></h3><p>å½“æˆ‘ä»¬åœ¨ä½¿ç”¨ Node.js çš„<code>events</code>æ¨¡å—æ¥å¤„ç†äº‹ä»¶æ—¶ï¼Œæ¯ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼ˆæˆ–ç§°ä¸º&quot;äº‹ä»¶å¤„ç†å‡½æ•°&quot;ï¼‰éƒ½æ˜¯é™„åŠ åˆ°ç‰¹å®šçš„äº‹ä»¶ä¸Šçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºæ¯ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥æ·»åŠ æœ€å¤š 10 ä¸ªç›‘å¬å™¨ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ·»åŠ æ›´å¤šçš„ç›‘å¬å™¨ã€‚è¿™å°±æ˜¯<code>setMaxListeners</code>æ–¹æ³•æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚</p><p><code>setMaxListeners</code>æ–¹æ³•å…è®¸ä½ æ”¹å˜å•ä¸ª<code>EventEmitter</code>å®ä¾‹é»˜è®¤çš„ç›‘å¬å™¨çš„æœ€å¤§æ•°é‡ã€‚è¿™ä¸ªè®¾ç½®å¯¹æ‰€æœ‰é€šè¿‡è¯¥å®ä¾‹æ³¨å†Œçš„äº‹ä»¶éƒ½æœ‰æ•ˆã€‚</p><ul><li><strong>å‚æ•°</strong>: <ul><li><code>n</code>: æ˜¯ä½ æƒ³è¦è®¾ç½®çš„æœ€å¤§ç›‘å¬å™¨æ•°é‡ã€‚</li><li><code>...eventTargets</code>: è¿™æ˜¯å¯é€‰å‚æ•°ï¼Œå…è®¸ä½ åŒæ—¶ä¸ºå¤šä¸ª<code>EventEmitter</code>å®ä¾‹è®¾ç½®æœ€å¤§ç›‘å¬å™¨æ•°é‡ã€‚</li></ul></li></ul><h4 id="å®é™…è¿ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-7"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œå®ƒå¤„ç†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ã€‚ä¸ºäº†æå‡æ€§èƒ½ï¼Œä½ å†³å®šå…è®¸æ¯ä¸ªæ–‡ä»¶çš„ä¸Šä¼ è¿‡ç¨‹è§¦å‘å¤šç§äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼šâ€œå¼€å§‹ä¸Šä¼ â€ã€â€œä¸Šä¼ ä¸­â€ã€â€œä¸Šä¼ å®Œæ¯•â€ç­‰ç­‰ï¼‰ï¼Œå¹¶ä¸”æ ¹æ®å…·ä½“æƒ…å†µæ·»åŠ ä¸åŒçš„ç›‘å¬å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ï¼ˆæ¯”å¦‚è®°å½•æ—¥å¿—ã€æ›´æ–° UI ç­‰ï¼‰ã€‚</p><p>ç”±äºè¿™ä¸ªä¸Šä¼ åŠŸèƒ½éå¸¸å¤æ‚ï¼Œä½ å‘ç°é»˜è®¤çš„ 10 ä¸ªç›‘å¬å™¨é™åˆ¶å¤ªä½ï¼Œå¾ˆå¿«å°±è¾¾åˆ°äº†ä¸Šé™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>setMaxListeners</code>æ¥è°ƒæ•´é™åˆ¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> UploadManager</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªUploadManagerå®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> uploader</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> UploadManager</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¢åŠ æœ€å¤§ç›‘å¬å™¨æ•°é‡åˆ°15</span></span>
<span class="line"><span style="color:#D8DEE9;">uploader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">15</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨ï¼Œä½ å¯ä»¥ä¸ºuploaderå®ä¾‹æ·»åŠ å¤šè¾¾15ä¸ªç›‘å¬å™¨äº†</span></span>
<span class="line"><span style="color:#D8DEE9;">uploader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸Šä¼ å¼€å§‹</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ æ›´å¤šäº‹ä»¶ç›‘å¬å™¨...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†<code>EventEmitter</code>ç±»ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>UploadManager</code>çš„æ–°ç±»ï¼Œå®ƒç»§æ‰¿è‡ª<code>EventEmitter</code>ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>UploadManager</code>çš„ä¸€ä¸ªå®ä¾‹<code>uploader</code>ï¼Œå¹¶ä½¿ç”¨<code>setMaxListeners</code>æ–¹æ³•å°†å…¶æœ€å¤§ç›‘å¬å™¨æ•°é‡è®¾ç½®ä¸º 15ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ·»åŠ æ›´å¤šçš„ç›‘å¬å™¨æ¥å¤„ç†ä¸Šä¼ è¿‡ç¨‹ä¸­è§¦å‘çš„å„ç§äº‹ä»¶äº†ã€‚</p><p>è®°ä½ï¼šè™½ç„¶å¢åŠ ç›‘å¬å™¨çš„æ•°é‡å¯ä»¥æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†è¿‡å¤šçš„ç›‘å¬å™¨å¯èƒ½ä¼šå¯¼è‡´å†…å­˜é—®é¢˜ï¼Œå› æ­¤è¯·è°¨æ…ä½¿ç”¨ã€‚</p><h2 id="events-addabortlistener-signal-listener" tabindex="-1"><a class="header-anchor" href="#events-addabortlistener-signal-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventsaddabortlistenersignal-listener" target="_blank" rel="noopener noreferrer">events.addAbortListener(signal, listener)</a></span></a></h2><p>ç†è§£ <code>events.addAbortListener(signal, listener)</code> çš„ç”¨æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š<code>events</code>ã€<code>AbortSignal</code>ï¼Œä»¥åŠäº‹ä»¶ç›‘å¬åœ¨ Node.js ä¸­çš„ä½œç”¨ã€‚</p><ol><li><p><strong>events</strong> - åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½ä¼šè§¦å‘äº‹ä»¶ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚å¯ä»¥å‘å‡ºå®Œæˆæˆ–å¤±è´¥çš„äº‹ä»¶ï¼Œä¸€ä¸ªæ–‡ä»¶è¯»å†™æ“ä½œä¹Ÿå¯èƒ½æœ‰æˆåŠŸæˆ–é”™è¯¯çš„äº‹ä»¶ã€‚Node.js æœ‰ä¸€ä¸ªå†…ç½®çš„æ¨¡å—å«åš <code>events</code>ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è¿™äº›äº‹ä»¶ã€‚</p></li><li><p><strong>AbortController å’Œ AbortSignal</strong> - è¿™æ˜¯ Web æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè¢« Node.js é‡‡çº³ï¼Œå…è®¸ä½ å‘å‡ºå–æ¶ˆä¿¡å·æ¥ç»ˆæ­¢ä¸€ä¸ªæˆ–å¤šä¸ª Web API æˆ–å…¶ä»–ä»»åŠ¡ã€‚<code>AbortController</code> å¯ä»¥ç”Ÿæˆä¸€ä¸ª <code>AbortSignal</code>ï¼ˆç®€ç§°ä¿¡å·ï¼‰ï¼Œå½“è°ƒç”¨ <code>AbortController</code> çš„ <code>abort()</code> æ–¹æ³•æ—¶ï¼Œä¸ä¹‹ç›¸å…³çš„æ“ä½œå°±ä¼šè¢«å–æ¶ˆã€‚</p></li></ol><p>ç°åœ¨ï¼Œç†è§£äº†è¿™äº›æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥çœ‹ <code>events.addAbortListener(signal, listener)</code> æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><ul><li><p><strong>signal</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª <code>AbortSignal</code> å¯¹è±¡ï¼Œä»£è¡¨äº†å–æ¶ˆçš„ä¿¡å·ã€‚</p></li><li><p><strong>listener</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“ <code>signal</code> å¯¹è±¡è§¦å‘å–æ¶ˆï¼ˆå³è°ƒç”¨äº†å¯¹åº” <code>AbortController</code> çš„ <code>abort()</code> æ–¹æ³•ï¼‰æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°†è¢«æ‰§è¡Œã€‚</p></li></ul><p><strong>å®é™…è¿ç”¨çš„ä¾‹å­</strong></p><p>æƒ³è±¡ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œéœ€è¦åœ¨ç”¨æˆ·è¯·æ±‚æ•°æ®æ—¶ä»å¤–éƒ¨ API è·å–æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·çªç„¶å–æ¶ˆäº†è¯·æ±‚ï¼ˆä¾‹å¦‚å…³é—­äº†ç½‘é¡µæˆ–è€…ç‚¹å‡»äº†å–æ¶ˆæŒ‰é’®ï¼‰ï¼Œä½ ä¸å¸Œæœ›ç»§ç»­æµªè´¹èµ„æºå»è·å–è¿™äº›æ•°æ®ã€‚è¿™æ—¶ï¼Œ<code>AbortController</code> å’Œ <code>events.addAbortListener</code> å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> addAbortListener</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fetch</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node-fetch</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾ä½¿ç”¨ node-fetch æ¨¡å—è¿›è¡Œç½‘ç»œè¯·æ±‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª AbortController å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> controller</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> AbortController</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signal</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> controller</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">signal</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿç”¨æˆ·å–æ¶ˆæ“ä½œï¼ˆ5ç§’åè‡ªåŠ¨è§¦å‘ï¼‰</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  controller</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¯·æ±‚è¢«å–æ¶ˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">addAbortListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signal</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ“ä½œå·²ç»ˆæ­¢</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿå‘èµ·ç½‘ç»œè¯·æ±‚</span></span>
<span class="line"><span style="color:#88C0D0;">fetch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://api.example.com/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> signal</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">json</span><span style="color:#D8DEE9FF;">())</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AbortError</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // è¯·æ±‚è¢«å–æ¶ˆï¼Œä¼šæ•è·åˆ° AbortError</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Fetchæ“ä½œè¢«ç»ˆæ­¢</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Fetchå¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª <code>AbortController</code> å®ä¾‹å’Œç›¸åº”çš„ <code>AbortSignal</code>ã€‚é€šè¿‡ <code>setTimeout</code> æ¨¡æ‹Ÿç”¨æˆ·åœ¨ 5 ç§’åå–æ¶ˆæ“ä½œï¼Œå¹¶ä¸”åœ¨å–æ¶ˆæ—¶è°ƒç”¨ <code>controller.abort()</code>ã€‚<code>addAbortListener</code> è¢«ç”¨æ¥æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ï¼Œå½“å–æ¶ˆè¯·æ±‚æ—¶å®ƒä¼šæ‰§è¡Œå¹¶æ‰“å° &quot;æ“ä½œå·²ç»ˆæ­¢&quot;ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å°è¯•å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¦‚æœåœ¨æ•°æ®è¿”å›ä¹‹å‰ç”¨æˆ·å–æ¶ˆäº†è¯·æ±‚ï¼Œ<code>fetch</code>æ“ä½œä¼šæŠ›å‡º <code>AbortError</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ•è·è¿™ä¸ªé”™è¯¯å¹¶ç›¸åº”åœ°å¤„ç†ã€‚</p><p>è¿™å°±æ˜¯ <code>events.addAbortListener(signal, listener)</code> åœ¨ Node.js ä¸­çš„åŸºæœ¬ç”¨æ³•å’Œä¸€ä¸ªå®é™…åº”ç”¨åœºæ™¯ã€‚è¿™ç§æ¨¡å¼ç‰¹åˆ«æœ‰ç”¨äºç®¡ç†å’Œå–æ¶ˆå¼‚æ­¥æ“ä½œï¼Œæé«˜åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p><h2 id="class-events-eventemitterasyncresource-extends-eventemitter" tabindex="-1"><a class="header-anchor" href="#class-events-eventemitterasyncresource-extends-eventemitter"><span><a href="https://nodejs.org/docs/latest/api/events.html#class-eventseventemitterasyncresource-extends-eventemitter" target="_blank" rel="noopener noreferrer">Class: events.EventEmitterAsyncResource extends EventEmitter</a></span></a></h2><p>å¾ˆå¥½ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥äº†è§£ <code>EventEmitterAsyncResource</code> è¿™ä¸ªç±»ï¼Œåœ¨ Node.js v21.7.1 çš„ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™ä¸ªç±»æ˜¯ <code>events</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ‰©å±•äº†åŸºç¡€çš„ <code>EventEmitter</code> ç±»ï¼Œä¸ºå¤„ç†å¼‚æ­¥èµ„æºæä¾›äº†é¢å¤–çš„åŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ol><li><p><strong>äº‹ä»¶è§¦å‘å™¨ï¼ˆEventEmitterï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†äº‹ä»¶çš„ç±»ã€‚ä½ å¯ä»¥å°†å®ƒæƒ³è±¡æˆä¸€ä¸ªç”µå°å¹¿æ’­ç«™ï¼Œå®ƒå¯ä»¥å¹¿æ’­ï¼ˆemitï¼‰ä¿¡å·æˆ–äº‹ä»¶ï¼Œå¹¶ä¸”æœ‰å¤šä¸ªæ”¶éŸ³æœºï¼ˆlistenersï¼‰å¯ä»¥æ¥æ”¶è¿™äº›ä¿¡å·å¹¶åšå‡ºç›¸åº”çš„ååº”ã€‚</p></li><li><p><strong>å¼‚æ­¥èµ„æº</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œå¤§å¤šæ•°æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚è¯»å–æ–‡ä»¶ã€æ•°æ®åº“æ“ä½œæˆ–ç½‘ç»œè¯·æ±‚ã€‚å¼‚æ­¥èµ„æºå°±æ˜¯æŒ‡é‚£äº›éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆçš„èµ„æºï¼Œæ¯”å¦‚è¯´ï¼Œå½“ä½ è¯·æ±‚ç½‘ç»œæ•°æ®æ—¶ï¼Œç¨‹åºä¸ä¼šåœä¸‹æ¥ç­‰å¾…æ•°æ®åˆ°æ¥ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç›´åˆ°æ•°æ®åˆ°è¾¾æ—¶å†å¤„ç†è¿™ä¸ªæ•°æ®ã€‚</p></li><li><p><strong>Async Hooks</strong>ï¼šè¿™æ˜¯ Node.js æä¾›çš„ä¸€ä¸ª APIï¼Œå…è®¸è·Ÿè¸ªå¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œå¦‚åˆå§‹åŒ–ã€å›è°ƒè¢«è°ƒç”¨ç­‰ã€‚</p></li></ol><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ <code>EventEmitterAsyncResource</code>ï¼š</p><h3 id="eventemitterasyncresource" tabindex="-1"><a class="header-anchor" href="#eventemitterasyncresource"><span>EventEmitterAsyncResource</span></a></h3><p>è¿™ä¸ªç±»æ˜¯ä¸“é—¨ä¸ºå¼‚æ­¥èµ„æºè®¾è®¡çš„ï¼Œå®ƒæ‰©å±•äº† <code>EventEmitter</code>ï¼Œä½¿å¾—äº‹ä»¶è§¦å‘èƒ½å¤Ÿä¸å¼‚æ­¥èµ„æºçš„ä¸Šä¸‹æ–‡ç®¡ç†ç»“åˆèµ·æ¥ã€‚å½“ä½ åˆ›å»ºå¼‚æ­¥æ“ä½œï¼Œå¹¶å¸Œæœ›é€šè¿‡äº‹ä»¶æ¥é€šçŸ¥ç›‘å¬è€…æ—¶ï¼Œä½¿ç”¨ <code>EventEmitterAsyncResource</code> å¯ä»¥ç¡®ä¿äº‹ä»¶å¤„ç†æ˜¯åœ¨æ­£ç¡®çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œçš„ã€‚è¿™å¯¹äºä¿æŒå¼‚æ­¥æ“ä½œçš„çŠ¶æ€å’Œé¿å…æ½œåœ¨çš„ä¸Šä¸‹æ–‡æ··ä¹±è‡³å…³é‡è¦ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-8"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·æäº¤è¡¨å•å¹¶ä¸Šä¼ æ•°æ®ã€‚æ¯å½“æ•°æ®ä¸Šä¼ å®Œæˆæ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›é€šçŸ¥ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œå¦‚ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ã€‚</p><ol><li><strong>åˆ›å»ºå®ä¾‹</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitterAsyncResource</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥èµ„æºå®ä¾‹ï¼Œå‘½åä¸º &#39;uploadHandler&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> uploadEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitterAsyncResource</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">uploadHandler</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ç›‘å¬äº‹ä»¶</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;dataUploaded&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">uploadEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dataUploaded</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Data uploaded:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥åŠ å…¥ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>è§¦å‘äº‹ä»¶</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾è¿™ä¸ªå‡½æ•°åœ¨æ•°æ®ä¸Šä¼ å®Œæˆåè¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onUploadComplete</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è§¦å‘ &#39;dataUploaded&#39; äº‹ä»¶ï¼Œä¼ é€’ä¸Šä¼ çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  uploadEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dataUploaded</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ <code>onUploadComplete</code> è¢«è°ƒç”¨æ—¶ï¼Œä»»ä½•æ³¨å†Œåˆ° <code>&#39;dataUploaded&#39;</code> äº‹ä»¶çš„ç›‘å¬å™¨éƒ½ä¼šè¢«è§¦å‘ï¼Œå¹¶ä¸”æ¥æ”¶åˆ°ä¸Šä¼ çš„æ•°æ®ä½œä¸ºå‚æ•°ã€‚ä½¿ç”¨ <code>EventEmitterAsyncResource</code>ï¼Œä½ å¯ä»¥ç¡®ä¿è¿™ç§ç±»å‹çš„äº‹ä»¶é€šçŸ¥å’Œå¤„ç†æ˜¯åœ¨æ­£ç¡®çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œçš„ï¼Œè¿™åœ¨å¤æ‚çš„å¼‚æ­¥æµç¨‹æ§åˆ¶ä¸­éå¸¸é‡è¦ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>EventEmitterAsyncResource</code> æä¾›äº†ä¸€ç§æ–¹å¼æ¥ç¡®ä¿äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ“ä½œèƒ½å¤Ÿåœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­å®‰å…¨åœ°æ‰§è¡Œï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠåˆ°å¼‚æ­¥èµ„æºç®¡ç†å’Œè·Ÿè¸ªçš„åœºæ™¯ä¸­ã€‚</p><h3 id="new-events-eventemitterasyncresource-options" tabindex="-1"><a class="header-anchor" href="#new-events-eventemitterasyncresource-options"><span><a href="https://nodejs.org/docs/latest/api/events.html#new-eventseventemitterasyncresourceoptions" target="_blank" rel="noopener noreferrer">new events.EventEmitterAsyncResource([options])</a></span></a></h3><p>äº†è§£<code>events.EventEmitterAsyncResource</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ol><li><strong>EventEmitter</strong>: Node.js ä¸­ä¸€ä¸ªç”¨äºå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒç±»ã€‚å®ƒå¯ä»¥è®©ä½ åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªç½‘ç»œè¯·æ±‚å®Œæˆæ—¶è§¦å‘ä¸€ä¸ªâ€œå®Œæˆâ€äº‹ä»¶ã€‚</li><li><strong>å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsynchronous Programmingï¼‰</strong>: åœ¨ Node.js ä¸­éå¸¸é‡è¦ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨ç­‰å¾…æŸäº›æ“ä½œå®Œæˆï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€æ•°æ®åº“æ“ä½œç­‰ï¼‰æ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œè€Œä¸æ˜¯é˜»å¡ç­‰å¾…ã€‚</li><li><strong>Async Hooks</strong>: è¿™æ˜¯ Node.js çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒæä¾›äº†å‡ ä¸ª API æ¥è¿½è¸ªå¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯èƒ½è®©ä½ çŸ¥é“å¼‚æ­¥æ“ä½œä½•æ—¶å¼€å§‹ã€ç»“æŸç­‰ã€‚</li></ol><h3 id="events-eventemitterasyncresource" tabindex="-1"><a class="header-anchor" href="#events-eventemitterasyncresource"><span><code>events.EventEmitterAsyncResource</code></span></a></h3><p>è¿™ä¸ªæ„é€ å‡½æ•°æ˜¯ä¸ºäº†ç»“åˆä¸Šè¿°ä¸¤ä¸ªä¸–ç•Œï¼šäº‹ä»¶å¤„ç†ä¸å¼‚æ­¥èµ„æºè¿½è¸ªã€‚<code>EventEmitterAsyncResource</code>æ‰©å±•äº†æ™®é€šçš„<code>EventEmitter</code>ï¼Œç»™å®ƒåŠ ä¸Šäº†å¯¹å¼‚æ­¥èµ„æºçš„æ”¯æŒã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨ï¼ˆemitterï¼‰ï¼ŒåŒæ—¶å°†å…¶ä¸ç‰¹å®šçš„å¼‚æ­¥èµ„æºç›¸å…³è”ï¼Œå¹¶é€šè¿‡ async hooks è¿½è¸ªè¿™ä¸ªèµ„æºçš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h4 id="å‚æ•°-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-3"><span>å‚æ•°</span></a></h4><ul><li><strong>options</strong> ï¼ˆå¯é€‰ï¼‰: å¯¹è±¡ï¼Œå…¶ä¸­å¯ä»¥åŒ…å«ä»¥ä¸‹å­—æ®µï¼š <ul><li><strong>name</strong> (å­—ç¬¦ä¸²): å¼‚æ­¥èµ„æºçš„åç§°ã€‚è¿™å¯¹äºè°ƒè¯•å’Œè¿½è¸ªå¾ˆæœ‰å¸®åŠ©ã€‚</li><li>å…¶ä»–<code>EventEmitter</code>æˆ–<code>AsyncResource</code>å¯èƒ½æ¥å—çš„é€‰é¡¹ã€‚</li></ul></li></ul><h4 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®æ—¶èŠå¤©åº”ç”¨ã€‚æ¯å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¼‚æ­¥æ“ä½œå»ä¿å­˜è¿™æ¡æ¶ˆæ¯åˆ°æ•°æ®åº“ã€‚ä½¿ç”¨<code>EventEmitterAsyncResource</code>ï¼Œä½ å¯ä»¥æ›´å¥½åœ°è¿½è¸ªè¿™äº›å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ç›‘æ§æ‰€æœ‰æ¶ˆæ¯ä¿å­˜æ“ä½œçš„å¼€å§‹å’Œç»“æŸï¼Œç”šè‡³æ˜¯åœ¨é‡åˆ°é—®é¢˜æ—¶è¿›è¡Œè°ƒè¯•ã€‚</p><h4 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitterAsyncResource</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå…·æœ‰è‡ªå®šä¹‰åç§°çš„å¼‚æ­¥èµ„æºäº‹ä»¶å‘å°„å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> asyncEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitterAsyncResource</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">MessageProcessor</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">asyncEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received message:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥è¿›è¡Œæ¶ˆæ¯å¤„ç†çš„å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä¿å­˜åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿæ¥æ”¶åˆ°æ–°æ¶ˆæ¯å¹¶è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">asyncEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>MessageProcessor</code>çš„<code>EventEmitterAsyncResource</code>å®ä¾‹ã€‚æˆ‘ä»¬ç›‘å¬ä¸€ä¸ªåä¸º<code>message</code>çš„äº‹ä»¶ï¼Œå½“è¿™ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå°±æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚é€šè¿‡å°†äº‹ä»¶å‘å°„å™¨ä¸å¼‚æ­¥èµ„æºç›¸ç»“åˆï¼Œå¦‚æœåœ¨å¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­æ¶‰åŠå¼‚æ­¥æ“ä½œï¼ˆä¾‹å¦‚æ•°æ®åº“æ“ä½œï¼‰ï¼ŒNode.js çš„å¼‚æ­¥é’©å­ API å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°è·Ÿè¸ªè¿™äº›æ“ä½œçš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>EventEmitterAsyncResource</code>æä¾›äº†ä¸€ç§ç»“åˆäº‹ä»¶å¤„ç†å’Œå¼‚æ­¥èµ„æºè¿½è¸ªçš„é«˜æ•ˆæ–¹å¼ï¼Œå°¤å…¶é€‚åˆéœ€è¦ç²¾ç»†ç®¡ç†å¼‚æ­¥æ“ä½œçš„åœºæ™¯ã€‚</p><h3 id="eventemitterasyncresource-asyncid" tabindex="-1"><a class="header-anchor" href="#eventemitterasyncresource-asyncid"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventemitterasyncresourceasyncid" target="_blank" rel="noopener noreferrer">eventemitterasyncresource.asyncId</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js æä¾›äº†å¤§é‡çš„å†…ç½®æ¨¡å—ï¼Œä½¿å¾—å¼€å‘é«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨å˜å¾—æ›´åŠ å¿«æ·å’Œç®€å•ã€‚å…¶ä¸­ï¼Œ<code>events</code> æ¨¡å—æ˜¯ Node.js ä¸­ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¨¡å—ï¼Œå®ƒç”¨äºå¤„ç†äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹ã€‚</p><h3 id="eventemitterasyncresource-1" tabindex="-1"><a class="header-anchor" href="#eventemitterasyncresource-1"><span>EventEmitterAsyncResource</span></a></h3><p>åœ¨ç†è§£ <code>EventEmitterAsyncResource</code> ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ <code>EventEmitter</code> å’Œ <code>AsyncResource</code>ã€‚</p><ul><li><p><strong>EventEmitter</strong>: Node.js çš„ <code>events</code> æ¨¡å—ä¸­æœ€ä¸»è¦çš„ç±»ã€‚å®ƒç”¨äºå¤„ç†äº‹ä»¶ï¼šåˆ›å»ºã€ç›‘å¬å’Œå‘å°„äº‹ä»¶ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå†…ç½®å¯¹è±¡éƒ½æ˜¯ EventEmitter çš„å®ä¾‹ï¼Œè¿™è¡¨æ˜è¿™äº›å¯¹è±¡å¯ä»¥å‘å°„äº‹ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ EventEmitter å®ä¾‹æ¥å¤„ç†äº‹ä»¶ã€‚</p></li><li><p><strong>AsyncResource</strong>: å±äº <code>async_hooks</code> æ¨¡å—ï¼Œä¸»è¦ç”¨äºä¸ºå¼‚æ­¥æ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥èµ„æºï¼Œå¹¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ ID (<code>asyncId</code>) ç»™æ¯ä¸ªèµ„æºã€‚è¿™æœ‰åŠ©äºè·Ÿè¸ªå¼‚æ­¥èµ„æºä¹‹é—´çš„å…³ç³»å’Œæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ˜¯ç†è§£å’Œç›‘æ§ Node.js åº”ç”¨ä¸­å¼‚æ­¥æ“ä½œçš„é‡è¦å·¥å…·ã€‚</p></li></ul><p><code>EventEmitterAsyncResource</code> æ˜¯ <code>events</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒç»“åˆäº† <code>EventEmitter</code> å’Œ <code>AsyncResource</code> çš„åŠŸèƒ½ã€‚è¿™æ„å‘³ç€å®ƒä¸ä»…èƒ½å¤Ÿå¤„ç†äº‹ä»¶ï¼Œè¿˜èƒ½å¤Ÿè¿½è¸ªå’Œç®¡ç†ä¸è¿™äº›äº‹ä»¶ç›¸å…³è”çš„å¼‚æ­¥æ“ä½œçš„ä¸Šä¸‹æ–‡ã€‚</p><h3 id="asyncid" tabindex="-1"><a class="header-anchor" href="#asyncid"><span>asyncId</span></a></h3><p>å½“æˆ‘ä»¬è¯´åˆ° <code>eventemitterasyncresource.asyncId</code>ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯è¯¥å®ä¾‹å¯¹åº”çš„å¼‚æ­¥èµ„æºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆIDï¼‰ã€‚æ¯ä¸ª <code>EventEmitterAsyncResource</code> å®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ª <code>asyncId</code>ï¼Œè¿™ä¸ª ID å¯¹äºç›‘æ§å’Œè¯Šæ–­å¼‚æ­¥æ“ä½œæµéå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="å®é™…è¿ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨æ¡ˆä¾‹"><span>å®é™…è¿ç”¨æ¡ˆä¾‹</span></a></h3><p>å‡è®¾æ‚¨æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦å¤„ç†ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼Œå¹¶ä¸”åœ¨å¤„ç†è¿‡ç¨‹ä¸­æ¶‰åŠå¤šä¸ªå¼‚æ­¥æ­¥éª¤ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€ç¬¬ä¸‰æ–¹æœåŠ¡éªŒè¯ç­‰ï¼‰ã€‚ä¸ºäº†æœ‰æ•ˆåœ°è¿½è¸ªæ¯ä¸ªç™»å½•è¯·æ±‚çš„å¤„ç†æµç¨‹ï¼Œå°¤å…¶æ˜¯åœ¨é¢å¯¹å¹¶å‘è¯·æ±‚æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>EventEmitterAsyncResource</code> æ¥å‘å°„å’Œç›‘å¬ç™»å½•è¿‡ç¨‹ä¸­çš„ä¸åŒäº‹ä»¶ï¼Œå¹¶åˆ©ç”¨ <code>asyncId</code> æ¥è¿½è¸ªæ¯ä¸ªè¯·æ±‚çš„å¤„ç†æµç¨‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitterAsyncResource</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤„ç†ç™»å½•çš„å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> handleLogin</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä¸ºè¿™ä¸ªç™»å½•è¯·æ±‚åˆ›å»ºä¸€ä¸ª EventEmitterAsyncResource å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> asyncResource</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitterAsyncResource</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">LOGIN_REQUEST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ asyncResource.emit ç»™ &#39;loginStart&#39; äº‹ä»¶é™„åŠ ä¸€ä¸ª listener</span></span>
<span class="line"><span style="color:#D8DEE9;">  asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">loginStart</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> request</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¼‚æ­¥æ“ä½œï¼šæ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#D8DEE9;">  database</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">query</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SELECT * FROM users WHERE ...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      return;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#616E88;">    // æˆåŠŸæŸ¥è¯¢åï¼Œå‘å‡º loginSuccess äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">    asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">loginSuccess</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Handling login request with async ID: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">asyncId</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸ºå½“å‰çš„ç™»å½•è¯·æ±‚å¤„ç†æµç¨‹åˆ†é…çš„ unique asyncId</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ä¸Šè¿°å‡½æ•°å¤„ç†ç™»å½•è¯·æ±‚</span></span>
<span class="line"><span style="color:#88C0D0;">handleLogin</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> password</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>asyncResource.asyncId</code> æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿè¿½è¸ªæ¯ä¸ªç™»å½•è¯·æ±‚çš„å¼‚æ­¥å¤„ç†æµç¨‹ï¼Œå³ä½¿æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ¸…æ™°åœ°çŸ¥é“å“ªä¸ªäº‹ä»¶å±äºå“ªä¸ªè¯·æ±‚ã€‚è¿™å¯¹äºè°ƒè¯•ã€æ—¥å¿—è®°å½•ä»¥åŠç›‘æ§åº”ç”¨ç¨‹åºçš„æ€§èƒ½éå¸¸æœ‰ä»·å€¼ã€‚</p><h3 id="eventemitterasyncresource-asyncresource" tabindex="-1"><a class="header-anchor" href="#eventemitterasyncresource-asyncresource"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventemitterasyncresourceasyncresource" target="_blank" rel="noopener noreferrer">eventemitterasyncresource.asyncResource</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º<code>eventemitterasyncresource.asyncResource</code>æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®º Node.js ä¸­çš„å¼‚æ­¥ç¼–ç¨‹å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§ã€‚é¦–å…ˆï¼Œæˆ‘ä¼šç®€å•è§£é‡Šä¸‹ç›¸å…³æ¦‚å¿µï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸€ç‰¹æ€§ã€‚</p><h3 id="ç®€å•çš„èƒŒæ™¯çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#ç®€å•çš„èƒŒæ™¯çŸ¥è¯†"><span>ç®€å•çš„èƒŒæ™¯çŸ¥è¯†</span></a></h3><h4 id="_1-node-js-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1-node-js-æ˜¯ä»€ä¹ˆ"><span>1. Node.js æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚Node.js çš„è®¾è®¡å“²å­¦æ˜¯é«˜æ€§èƒ½ã€éé˜»å¡ï¼ˆasynchronousï¼‰ã€äº‹ä»¶é©±åŠ¨ã€‚</p><h4 id="_2-ä»€ä¹ˆæ˜¯-eventemitter" tabindex="-1"><a class="header-anchor" href="#_2-ä»€ä¹ˆæ˜¯-eventemitter"><span>2. ä»€ä¹ˆæ˜¯ EventEmitterï¼Ÿ</span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code>æ˜¯ä¸€ä¸ªå¤„ç†äº‹ä»¶çš„ç±»ï¼Œå…è®¸ä½ åœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’æ¶ˆæ¯æˆ–è§¦å‘äº‹ä»¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå¯ä»¥è®©ä½ åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨(listener)ç­‰å¾…ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿï¼Œå¹¶å®šä¹‰å½“è¯¥äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</p><h4 id="_3-å¼‚æ­¥èµ„æºä¸-async-hooks" tabindex="-1"><a class="header-anchor" href="#_3-å¼‚æ­¥èµ„æºä¸-async-hooks"><span>3. å¼‚æ­¥èµ„æºä¸ Async Hooks</span></a></h4><p>å¼‚æ­¥èµ„æºä»£è¡¨äº†ç³»ç»Ÿå†…æ­£åœ¨è¿›è¡Œçš„å¼‚æ­¥æ“ä½œï¼Œè€Œ Async Hooks API æä¾›äº†å¯¹è¿™äº›æ“ä½œçš„è§‚å¯Ÿï¼Œæ¯”å¦‚å¯ä»¥ç›‘å¬åˆ°ä½•æ—¶å¼€å§‹ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½•æ—¶ç»“æŸã€‚</p><h3 id="eventemitterasyncresource-asyncresource-1" tabindex="-1"><a class="header-anchor" href="#eventemitterasyncresource-asyncresource-1"><span>eventemitterasyncresource.asyncResource</span></a></h3><p><code>eventemitterasyncresource.asyncResource</code> æ˜¯ Node.js ä¸­ç”¨äºä¸º EventEmitter å®ä¾‹å…³è”ä¸€ä¸ªå¼‚æ­¥èµ„æºçš„æ–¹æ³•ã€‚è¿™æ ·ï¼ŒEventEmitter å°±å¯ä»¥åœ¨ Async Hooks ç³»ç»Ÿä¸­è¢«è¿½è¸ªï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œç›‘æ§äº‹ä»¶å¤„ç†å’Œå¼‚æ­¥æ“ä½œçš„æµç¨‹ã€‚</p><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½è¦ç›‘æ§ç”¨æˆ·çš„è¿æ¥çŠ¶æ€ï¼Œä¾‹å¦‚ä½•æ—¶æœ‰ç”¨æˆ·åŠ å…¥èŠå¤©å®¤æˆ–é€€å‡ºèŠå¤©å®¤ã€‚ä½ å¯ä»¥ä½¿ç”¨ EventEmitter æ¥è§¦å‘å’Œç›‘å¬è¿™äº›äº‹ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³æ·±å…¥äº†è§£å¼‚æ­¥æ“ä½œçš„æ‰§è¡Œæµç¨‹ï¼Œä¾‹å¦‚ä½ æƒ³çŸ¥é“å¤„ç†ç”¨æˆ·åŠ å…¥èŠå¤©å®¤çš„äº‹ä»¶å…·ä½“æ¶‰åŠäº†å“ªäº›å¼‚æ­¥ä»»åŠ¡ï¼Œé‚£ä¹ˆ<code>eventemitterasyncresource.asyncResource</code>å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> EventEmitterAsyncResource</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥èµ„æºï¼Œä»¥åŠä¸ä¹‹å…³è”çš„EventEmitterå®ä¾‹ã€‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> asyncResource</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitterAsyncResource</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">chatRoom</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">join</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> has joined the chat.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">join</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>chatRoom</code>çš„<code>EventEmitterAsyncResource</code>å®ä¾‹ã€‚è¿™å…è®¸æˆ‘ä»¬æ—¢èƒ½è§¦å‘å’Œç›‘å¬äº‹ä»¶ï¼ˆæ¯”å¦‚ç”¨æˆ·åŠ å…¥èŠå¤©å®¤ï¼‰ï¼Œä¹Ÿèƒ½é€šè¿‡å¼‚æ­¥é’©å­ API æ¥è§‚å¯Ÿå’Œè·Ÿè¸ªè¿™äº›äº‹ä»¶å¤„ç†è¿‡ç¨‹ä¸­çš„å¼‚æ­¥èµ„æºã€‚</p><p>è¿™é¡¹æŠ€æœ¯ç‰¹åˆ«æœ‰ç”¨äºå¤æ‚åº”ç”¨çš„æ€§èƒ½è°ƒä¼˜å’Œé—®é¢˜æ’æŸ¥ï¼Œå› ä¸ºå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°åœ¨äº‹ä»¶é©±åŠ¨çš„æ¶æ„èƒŒåå‘ç”Ÿçš„å¼‚æ­¥æ“ä½œç»†èŠ‚ã€‚</p><h3 id="eventemitterasyncresource-emitdestroy" tabindex="-1"><a class="header-anchor" href="#eventemitterasyncresource-emitdestroy"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventemitterasyncresourceemitdestroy" target="_blank" rel="noopener noreferrer">eventemitterasyncresource.emitDestroy()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯å’Œç½‘ç»œåº”ç”¨ã€‚åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶é©±åŠ¨æ˜¯æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œè€Œ EventEmitter æ˜¯å®ç°è¿™ç§æ¨¡å¼çš„å…³é”®ç±»ã€‚åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>EventEmitterAsyncResource</code> æ˜¯ <code>EventEmitter</code> çš„ä¸€ä¸ªæ‰©å±•ï¼Œä¸“ä¸ºå¼‚æ­¥èµ„æºè®¾è®¡ï¼Œä»¥ä¾¿æé«˜è·Ÿè¸ªå’Œç®¡ç†å¼‚æ­¥æ“ä½œçš„èƒ½åŠ›ã€‚</p><h3 id="è§£é‡Š-eventemitterasyncresource-emitdestroy" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-eventemitterasyncresource-emitdestroy"><span>è§£é‡Š <code>EventEmitterAsyncResource.emitDestroy()</code></span></a></h3><p><code>EventEmitterAsyncResource</code> ç±»æ˜¯ä¸“é—¨ä¸ºå¼‚æ­¥èµ„æºæ“ä½œè€Œè®¾è®¡çš„ï¼Œå®ƒç»§æ‰¿è‡ªå¸¸è§„çš„ EventEmitterã€‚åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶ï¼Œæ¯ä¸ªå¼‚æ­¥èµ„æºéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç±»æ¥è§¦å‘å’Œç›‘å¬äº‹ä»¶ã€‚æ­¤ç±»è¿˜æä¾›äº†<code>emitDestroy()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯æ˜¾å¼åœ°æ ‡è®°å¼‚æ­¥èµ„æºä¸ºå·²é”€æ¯ã€‚</p><p>åœ¨ Node.js çš„å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œè¿½è¸ªèµ„æºä½•æ—¶è¢«åˆ›å»ºå’Œé”€æ¯æ˜¯å¾ˆé‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨æ€§èƒ½åˆ†æå’Œè°ƒè¯•å†…å­˜æ³„æ¼ç­‰é—®é¢˜æ—¶ã€‚å½“ä½ è®¤ä¸ºä¸€ä¸ªå¼‚æ­¥èµ„æºä¸å†éœ€è¦æ—¶ï¼Œè°ƒç”¨<code>emitDestroy()</code>ä¼šå‘ç›¸å…³çš„ç›‘æ§å·¥å…·æˆ–ç»„ä»¶å‘é€ä¸€ä¸ªä¿¡å·ï¼ŒæŒ‡ç¤ºè¯¥èµ„æºå·²ç»å®Œæˆå…¶ç”Ÿå‘½å‘¨æœŸå¹¶å¯ä»¥è¢«å›æ”¶ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-9"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»ºè‡ªå®šä¹‰å¼‚æ­¥èµ„æº" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºè‡ªå®šä¹‰å¼‚æ­¥èµ„æº"><span>ç¤ºä¾‹ 1ï¼šåˆ›å»ºè‡ªå®šä¹‰å¼‚æ­¥èµ„æº</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„ç½‘ç»œè¯·æ±‚å·¥å…·ï¼Œæ¯å½“å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œä½ å¸Œæœ›èƒ½å¤Ÿè¿½è¸ªè¿™ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitterAsyncResource</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> HttpRequest</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitterAsyncResource</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HttpRequest</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> url</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  fetch</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    https</span></span>
<span class="line"><span style="color:#ECEFF4;">      .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">          data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">        res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">          // è¯·æ±‚æˆåŠŸç»“æŸï¼Œé€šçŸ¥è¯·æ±‚å®Œæˆ</span></span>
<span class="line"><span style="color:#81A1C1;">          this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">success</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">          // æ ‡è®°å¼‚æ­¥èµ„æºå·²é”€æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">          this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emitDestroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">      .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">        // è¯·æ±‚å¤±è´¥ï¼Œè§¦å‘ &#39;error&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">        this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">        // å³ä½¿åœ¨å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ ‡è®°å¼‚æ­¥èµ„æºå·²é”€æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">        this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emitDestroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> HttpRequest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">success</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">fetch</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>HttpRequest</code> ç±»ç»§æ‰¿è‡ª <code>EventEmitterAsyncResource</code>ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªç½‘ç»œè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ª <code>HttpRequest</code> å®ä¾‹ï¼Œå¹¶é€šè¿‡ <code>fetch</code> æ–¹æ³•å‘èµ·è¯·æ±‚ã€‚æ— è®ºè¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæˆ‘ä»¬éƒ½é€šè¿‡è°ƒç”¨ <code>emitDestroy()</code> æ–¹æ³•æ˜¾å¼åœ°æ ‡è®°è¿™ä¸ªå¼‚æ­¥èµ„æºï¼ˆå³ç½‘ç»œè¯·æ±‚ï¼‰ä¸ºå·²é”€æ¯ã€‚</p><h4 id="ç¤ºä¾‹-2-é…åˆå¼‚æ­¥é’©å­ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-é…åˆå¼‚æ­¥é’©å­ä½¿ç”¨"><span>ç¤ºä¾‹ 2ï¼šé…åˆå¼‚æ­¥é’©å­ä½¿ç”¨</span></a></h4><p>åœ¨å¤æ‚çš„åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦æ›´ç²¾ç»†åœ°è¿½è¸ªå¼‚æ­¥èµ„æºçš„åˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ã€‚Node.js æä¾›äº† <code>async_hooks</code> æ¨¡å—ï¼Œç”¨äºè¿½è¸ªå¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸã€‚<code>emitDestroy()</code> åœ¨è¿™ç§åœºæ™¯ä¸‹å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿èµ„æºæ­£ç¡®åœ°ä»å¼‚æ­¥é’©å­çš„è·Ÿè¸ªä¸­ç§»é™¤ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> asyncHooks</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">async_hooks</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆå§‹åŒ–å¼‚æ­¥é’©å­</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> hook</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> asyncHooks</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHook</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  init</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">asyncId</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> type</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> triggerAsyncId</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">Async resource </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> created: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">asyncId</span><span style="color:#81A1C1;">}</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#88C0D0;">  destroy</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">asyncId</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">Async resource destroyed: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">asyncId</span><span style="color:#81A1C1;">}</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯ç”¨é’©å­</span></span>
<span class="line"><span style="color:#D8DEE9;">hook</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">enable</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¥ä¸‹æ¥ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­åˆ›å»ºå’Œé”€æ¯å¼‚æ­¥èµ„æºï¼Œå¹¶è§‚å¯Ÿåˆ°ç›¸åº”çš„æ—¥å¿—è¾“å‡º</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥æ¼”ç¤º <code>emitDestroy()</code> çš„è°ƒç”¨ï¼Œä½†æ˜¯å¦‚æœåœ¨ä¸€ä¸ªä½¿ç”¨ <code>async_hooks</code> è¿½è¸ªçš„åœºæ™¯ä¸­ï¼Œä½ åˆ›å»ºäº†è‡ªå®šä¹‰çš„å¼‚æ­¥èµ„æºå¹¶åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨ <code>emitDestroy()</code>ï¼Œå°±ä¼šè§¦å‘ <code>destroy</code> é’©å­çš„æ‰§è¡Œï¼Œä»è€Œå¯ä»¥ç›‘æ§åˆ°èµ„æºçš„é”€æ¯äº‹ä»¶ã€‚</p><h3 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h3><p><code>EventEmitterAsyncResource.emitDestroy()</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œå®ƒä½¿å¼€å‘è€…èƒ½å¤Ÿæ˜¾å¼åœ°æ ‡è®°å¼‚æ­¥èµ„æºä¸ºå·²é”€æ¯ï¼Œæé«˜èµ„æºç®¡ç†çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒåœ¨å®é™…åº”ç”¨ä¸­å¦‚ä½•å¸®åŠ©è¿½è¸ªå’Œç®¡ç†å¼‚æ­¥æ“ä½œçš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h3 id="eventemitterasyncresource-triggerasyncid" tabindex="-1"><a class="header-anchor" href="#eventemitterasyncresource-triggerasyncid"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventemitterasyncresourcetriggerasyncid" target="_blank" rel="noopener noreferrer">eventemitterasyncresource.triggerAsyncId</a></span></a></h3><p>ç†è§£<code>eventemitterasyncresource.triggerAsyncId</code>åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®²ä¸€ä¸‹ Node.js ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼šäº‹ä»¶å¾ªç¯ã€å¼‚æ­¥ç¼–ç¨‹ã€EventEmitter ç±»å’Œå¼‚æ­¥é’©å­ã€‚</p><ol><li><p><strong>äº‹ä»¶å¾ªç¯(Event Loop)ä¸å¼‚æ­¥ç¼–ç¨‹ï¼š</strong> Node.js æ˜¯å•çº¿ç¨‹çš„ï¼Œå®ƒé€šè¿‡äº‹ä»¶å¾ªç¯æ¥å®ç°éé˜»å¡ï¼ˆå¼‚æ­¥ï¼‰æ“ä½œã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼ˆå¦‚è¯»å–æ–‡ä»¶ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰æ—¶ï¼ŒNode.js ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œè€Œä¸æ˜¯ç­‰å¾…è¿™ä¸ªæ“ä½œå®Œæˆã€‚å½“å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œé€šè¿‡å›è°ƒå‡½æ•°æ¥å¤„ç†ç»“æœï¼Œè¿™å°±å…è®¸äº†å¹¶è¡Œå¤„ç†å¤šä¸ªæ“ä½œã€‚</p></li><li><p><strong>EventEmitter ç±»ï¼š</strong> åœ¨ Node.js ä¸­ï¼ŒEventEmitter ç±»ç”¨äºå¤„ç†äº‹ä»¶ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¥ç»§æ‰¿ EventEmitterï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ¥å‘å°„ï¼ˆemitï¼‰äº‹ä»¶å’Œç›‘å¬ï¼ˆonï¼‰äº‹ä»¶ã€‚è¿™æ˜¯ Node.js å®ç°äº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„åŸºç¡€ã€‚</p></li><li><p><strong>å¼‚æ­¥é’©å­ï¼ˆAsync Hooksï¼‰ï¼š</strong> å¼‚æ­¥é’©å­æ˜¯ Node.js æä¾›çš„ä¸€ä¸ª APIï¼Œå…è®¸ä½ è¿½è¸ªå¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ä½•åˆ›å»ºã€é”€æ¯ç­‰ï¼‰ã€‚æ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆasyncIdï¼‰ï¼Œé€šè¿‡è¿™ä¸ªæ ‡è¯ˆç¬¦ï¼Œä½ å¯ä»¥å¾—çŸ¥å¼‚æ­¥æ“ä½œçš„çŠ¶æ€ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº<code>eventemitterasyncresource.triggerAsyncId</code>ï¼š</p><p><code>eventemitterasyncresource</code>æ˜¯ EventEmitte ç±»çš„ä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬ï¼Œç”¨äºå¼‚æ­¥äº‹ä»¶å¤„ç†åœºæ™¯ã€‚å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸å¼‚æ­¥èµ„æºå…³è”çš„<code>asyncId</code>ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª<code>eventemitterasyncresource</code>å¯¹è±¡æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªè§¦å‘å™¨ IDï¼ˆtriggerAsyncIdï¼‰ï¼Œè¿™ä¸ª ID é€šå¸¸æ˜¯çˆ¶å¼‚æ­¥èµ„æºçš„ IDã€‚</p><p><code>eventemitterasyncresource.triggerAsyncId</code>å±æ€§å°±æ˜¯ç”¨æ¥è·å–è¿™ä¸ªè§¦å‘å™¨ ID çš„ã€‚è¿™ä¸ªå±æ€§çš„å€¼ä»£è¡¨äº†å½“å‰å¼‚æ­¥äº‹ä»¶æˆ–æ“ä½œæ˜¯ç”±å“ªä¸ªçˆ¶å¼‚æ­¥èµ„æºè§¦å‘çš„ã€‚è¿™å¯¹äºè¿½è¸ªå’Œè°ƒè¯•å¼‚æ­¥æ“ä½œçš„æµç¨‹éå¸¸æœ‰ç”¨ã€‚</p><p><strong>å®é™…è¿ç”¨ä¾‹å­ï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œç”¨æˆ·è¯·æ±‚è§¦å‘äº†ä¸€ä¸ªå¼‚æ­¥è¯»å–æ•°æ®åº“çš„æ“ä½œã€‚ä½ å¯èƒ½æƒ³è¦è¿½è¸ªè¿™ä¸ªæ•°æ®åº“æŸ¥è¯¢æ˜¯ç”±å“ªä¸ªç”¨æˆ·è¯·æ±‚è§¦å‘çš„ã€‚é€šè¿‡ä½¿ç”¨<code>eventemitterasyncresource</code>åŠå…¶<code>triggerAsyncId</code>ï¼Œä½ å¯ä»¥è½»æ¾åœ°è¿½è¸ªè¿™ç§â€œè¯·æ±‚-å“åº”â€é“¾ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> AsyncResource</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿è‡ª EventEmitter</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> queryDatabase</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">asyncResource</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”¨ setImmediate æ¥æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="color:#88C0D0;">  setImmediate</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">Operation triggered by asyncId: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">triggerAsyncId</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">    asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¸»å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> asyncResource</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> AsyncResource</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">queryDatabase</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    triggerAsyncId</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å‡è®¾çˆ¶å¼‚æ­¥èµ„æºçš„ ID æ˜¯ 1</span></span>
<span class="line"><span style="color:#88C0D0;">    requireManualDestroy</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // éœ€è¦æ‰‹åŠ¨é”€æ¯èµ„æº</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬æ•°æ®äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  asyncResource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#88C0D0;">  queryDatabase</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">asyncResource</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">main</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>queryDatabase</code> å‡½æ•°æ¥æ”¶ä¸€ä¸ª<code>asyncResource</code>å‚æ•°ï¼Œè¯¥èµ„æºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚æˆ‘ä»¬é€šè¿‡<code>setImmediate</code>æ¨¡æ‹Ÿå¼‚æ­¥è¡Œä¸ºï¼Œå¹¶åœ¨å…¶ä¸­æ‰“å°å‡ºè§¦å‘è¯¥å¼‚æ­¥æ“ä½œçš„<code>triggerAsyncId</code>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ¯ä¸ªå¼‚æ­¥äº‹ä»¶æ˜¯å¦‚ä½•è¢«è¿½è¸ªçš„ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>eventemitterasyncresource.triggerAsyncId</code>å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨å¤æ‚çš„å¼‚æ­¥æ“ä½œä¸­ï¼Œè¿½è¸ªäº‹ä»¶çš„æ¥æºï¼Œä»è€Œæ›´å¥½åœ°ç†è§£å’Œè°ƒè¯•ç¨‹åºã€‚</p><h2 id="eventtarget-and-event-api" tabindex="-1"><a class="header-anchor" href="#eventtarget-and-event-api"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtarget-and-event-api" target="_blank" rel="noopener noreferrer">EventTarget and Event API</a></span></a></h2><p>ç†è§£ Node.js ä¸­çš„ <code>EventTarget</code> å’Œ <code>Event API</code>ï¼Œå…¶å®å°±åƒæ˜¯å­¦ä¹ å¦‚ä½•åœ¨ä¸€ä¸ªèšä¼šä¸­ä¸äººäº¤æµã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨ä¸€åœºå¤§å‹æ´¾å¯¹ï¼ˆç±»ä¼¼äºåœ¨åº”ç”¨ç¨‹åºä¸­è¿è¡Œçš„å„ç§è¿›ç¨‹ï¼‰ä¸­ï¼Œäººä»¬ï¼ˆäº‹ä»¶ï¼‰ä¸æ–­åœ°æ¥æ¥å¾€å¾€ï¼Œè¿›è¡Œç€äº¤æµã€‚è€Œä½ ï¼ˆ<code>EventTarget</code>ï¼‰ï¼Œä½œä¸ºæ´¾å¯¹çš„å®¿ä¸»ï¼Œéœ€è¦ä¸è¿™äº›äººè¿›è¡Œäº’åŠ¨ã€‚</p><h3 id="eventtarget-å’Œ-event" tabindex="-1"><a class="header-anchor" href="#eventtarget-å’Œ-event"><span>EventTarget å’Œ Event</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><strong>EventTarget</strong>ï¼šå¯ä»¥ç†è§£ä¸ºâ€œäº‹ä»¶ç›®æ ‡â€æˆ–è€…â€œäº‹ä»¶ç›‘å¬å™¨â€ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä»¥æ¥æ”¶äº‹ä»¶å¹¶å¯¹è¿™äº›äº‹ä»¶åšå‡ºå“åº”çš„å¯¹è±¡ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½å¯ä»¥ä½œä¸º EventTargetï¼Œä¾‹å¦‚ HTTP æœåŠ¡å™¨ã€æ–‡ä»¶æµç­‰ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä»»ä½•å¯ä»¥å‘ç”Ÿäº‹æƒ…ï¼ˆäº‹ä»¶ï¼‰çš„å¯¹è±¡ã€‚</li><li><strong>Event</strong>ï¼šäº‹ä»¶æœ¬èº«ã€‚åœ¨ä¸Šè¿°æ´¾å¯¹çš„ä¾‹å­ä¸­ï¼Œæ¯å½“æœ‰äººä¸ä½ äº¤æµï¼Œé‚£ä¸ªäº¤æµçš„è¡Œä¸ºå°±æ˜¯ä¸€ä¸ªâ€œäº‹ä»¶â€ã€‚</li></ul><h3 id="å¦‚ä½•å·¥ä½œ-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ-1"><span>å¦‚ä½•å·¥ä½œ</span></a></h3><ol><li><p><strong>æ³¨å†Œç›‘å¬å™¨</strong>ï¼š<br> å°±åƒä½ å‘Šè¯‰ä½ çš„æœ‹å‹ï¼Œå¦‚æœè§åˆ°æŸä½åå« Alice çš„æœ‹å‹æ¥æ´¾å¯¹ï¼Œè¯·é€šçŸ¥ä½ ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œåœ¨ç¼–ç¨‹ä¸­ç§°ä¹‹ä¸ºâ€œæ³¨å†Œç›‘å¬å™¨â€æˆ–â€œè®¢é˜…äº‹ä»¶â€ã€‚ä½ é€šè¿‡è°ƒç”¨ <code>addEventListner</code> æ–¹æ³•ï¼Œå¯¹ç‰¹å®šç±»å‹çš„äº‹ä»¶è¡¨è¾¾ä½ çš„å…´è¶£ã€‚</p></li><li><p><strong>å‘ç”Ÿäº‹ä»¶</strong>ï¼š<br> å½“äº‹ä»¶ï¼ˆæ¯”å¦‚ Alice åˆ°è¾¾æ´¾å¯¹ï¼‰å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€šçŸ¥ä½ ã€‚åœ¨ Node.js ä¸­ï¼Œå½“å…³è”çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¹‹å‰æ³¨å†Œçš„å›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p></li><li><p><strong>å¤„ç†äº‹ä»¶</strong>ï¼š<br> æ”¶åˆ°é€šçŸ¥åï¼Œä½ å¯èƒ½ä¼šå»è¿æ¥ Aliceï¼Œè¿™ç›¸å½“äºåœ¨ä½ çš„ä»£ç ä¸­æ‰§è¡Œä¸€æ®µç‰¹å®šçš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å›è°ƒå‡½æ•°ä¸­å®šä¹‰çš„é‚£éƒ¨åˆ†ã€‚</p></li></ol><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”è¯·æ±‚-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-http-æœåŠ¡å™¨å“åº”è¯·æ±‚-1"><span>ç¤ºä¾‹ 1ï¼šHTTP æœåŠ¡å™¨å“åº”è¯·æ±‚</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;request&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æœ‰ HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>server</code> æ˜¯ä¸€ä¸ª <code>EventTarget</code>ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>.on()</code> æ–¹æ³•æ³¨å†Œç›‘å¬ <code>&#39;request&#39;</code> äº‹ä»¶ã€‚å½“ HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼ˆäº‹ä»¶å‘ç”Ÿï¼‰ï¼Œæ‰§è¡Œç›¸å…³çš„å›è°ƒå‡½æ•°ï¼Œå‘é€å› &quot;Hello, World!&quot; çš„å“åº”ã€‚</p><h4 id="ç¤ºä¾‹-2-è‡ªå®šä¹‰äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è‡ªå®šä¹‰äº‹ä»¶"><span>ç¤ºä¾‹ 2ï¼šè‡ªå®šä¹‰äº‹ä»¶</span></a></h4><p>ä» Node.js v14.5.0 å¼€å§‹ï¼Œä½¿ç”¨ <code>EventTarget</code> æ¥å£åˆ›å»ºæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶çš„å¯¹è±¡å·²ç»æˆä¸ºå¯èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª EventTarget å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEventTarget</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ &#39;greet&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">detail</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">!</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;greet&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> event</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> detail</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>EventTarget</code> å®ä¾‹ï¼Œå¹¶ç›‘å¬ä¸€ä¸ªåä¸º <code>&#39;greet&#39;</code> çš„è‡ªå®šä¹‰äº‹ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬æ„é€ äº†ä¸€ä¸ªå¸¦æœ‰è¯¦æƒ…ï¼ˆdetailï¼ŒåŒ…å«åå­—æ˜¯ Aliceï¼‰çš„ <code>greet</code> äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ <code>dispatchEvent</code> æ–¹æ³•æ¥è§¦å‘è¯¥äº‹ä»¶ã€‚è¿™æ ·ï¼Œç›‘å¬å™¨å°±ä¼šæ”¶åˆ°æ¶ˆæ¯å¹¶æ‰“å°å‡ºæ¥ã€‚</p><h3 id="æ€»ç»“-7" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-7"><span>æ€»ç»“</span></a></h3><p><code>EventTarget</code> å’Œ <code>Event API</code> æä¾›äº†ä¸€å¥—éå¸¸å¼ºå¤§çš„æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…åœ¨ Node.js ç¯å¢ƒä¸­ä»¥äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ç¼–å†™åº”ç”¨ã€‚é€šè¿‡ç›‘å¬å’Œå“åº”ä¸åŒçš„äº‹ä»¶ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶åº”ç”¨ç¨‹åºçš„æµç¨‹ï¼Œæ— è®ºæ˜¯å¤„ç† HTTP è¯·æ±‚è¿˜æ˜¯åœ¨ç³»ç»Ÿå†…éƒ¨ç»„ä»¶ä¹‹é—´ä¼ é€’æ¶ˆæ¯ã€‚</p><h3 id="node-js-eventtarget-vs-dom-eventtarget" tabindex="-1"><a class="header-anchor" href="#node-js-eventtarget-vs-dom-eventtarget"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodejs-eventtarget-vs-dom-eventtarget" target="_blank" rel="noopener noreferrer">Node.js EventTarget vs. DOM EventTarget</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ç®€å•åœ°æ¢è®¨ä¸€ä¸‹ Node.js ä¸­çš„<code>EventTarget</code>ä¸ DOM ä¸­çš„<code>EventTarget</code>ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶é€šè¿‡ç¤ºä¾‹æ¥ç†è§£å®ƒä»¬æ˜¯å¦‚ä½•è¢«åº”ç”¨çš„ã€‚é¦–å…ˆï¼Œéœ€è¦äº†è§£äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼šè¿™æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå…¶ä¸­ç¨‹åºçš„æ‰§è¡Œæµç”±äº‹ä»¶æ¥æ§åˆ¶ï¼Œå¦‚ç”¨æˆ·æ“ä½œã€æ¶ˆæ¯ä¼ é€’ç­‰ã€‚</p><h3 id="node-js-eventtarget" tabindex="-1"><a class="header-anchor" href="#node-js-eventtarget"><span>Node.js <code>EventTarget</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventTarget</code>æ˜¯ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ç±»ï¼Œå…è®¸ä½ åˆ›å»ºå¯ä»¥åˆ†å‘å’Œç›‘å¬äº‹ä»¶çš„å¯¹è±¡ã€‚è¿™ä¸ªæ¦‚å¿µæ˜¯ä»æµè§ˆå™¨çš„ç¯å¢ƒä¸­å€Ÿé‰´è¿‡æ¥çš„ï¼Œä½†åœ¨ Node.js ä¸­æœ‰äº›ä¸åŒçš„å®ç°ç»†èŠ‚ã€‚Node.js ä¸­çš„<code>EventTarget</code>ä¸»è¦ç”¨äºæ„å»ºè·¨ç¯å¢ƒï¼ˆæ¯”å¦‚æœåŠ¡å™¨ç«¯å’Œæµè§ˆå™¨ï¼‰å…±äº«çš„ä»£ç ã€‚</p><h4 id="å¦‚ä½•ä½¿ç”¨-2" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-2"><span>å¦‚ä½•ä½¿ç”¨ï¼š</span></a></h4><ol><li><strong>åˆ›å»ºä¸€ä¸ª EventTarget å®ä¾‹</strong>:</li></ol><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> eventTarget</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li><strong>ç›‘å¬äº‹ä»¶</strong>: ä½¿ç”¨<code>addEventListener</code>æ–¹æ³•ç›‘å¬ç‰¹å®šç±»å‹çš„äº‹ä»¶ã€‚</li></ol><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">eventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sayHello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">detail</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°äº‹ä»¶çš„&#39;detail&#39;å±æ€§</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>åˆ†å‘äº‹ä»¶</strong>: ä½¿ç”¨<code>dispatchEvent</code>æ–¹æ³•åˆ†å‘äº‹ä»¶ï¼Œå¯ä»¥é™„å¸¦æ•°æ®ã€‚</li></ol><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> helloEvent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> CustomEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sayHello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> detail</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">eventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">helloEvent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dom-eventtarget" tabindex="-1"><a class="header-anchor" href="#dom-eventtarget"><span>DOM <code>EventTarget</code></span></a></h3><p>DOM ä¸­çš„<code>EventTarget</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…è®¸å¯¹è±¡æ¥æ”¶äº‹ä»¶å¹¶å¯¹å®ƒä»¬åšå‡ºå“åº”ã€‚æ‰€æœ‰èƒ½æ¥æ”¶äº‹ä»¶çš„ DOM èŠ‚ç‚¹ï¼Œå¦‚å…ƒç´ ã€æ–‡æ¡£å’Œçª—å£éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ã€‚æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¤„ç†æ¨¡å‹åŸºäºè¿™ä¸ªæ¦‚å¿µã€‚</p><h4 id="å¦‚ä½•ä½¿ç”¨-3" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-3"><span>å¦‚ä½•ä½¿ç”¨ï¼š</span></a></h4><p>å‡ ä¹æ‰€æœ‰çš„ DOM å…ƒç´ éƒ½å¯ä»¥è¢«è§†ä¸º EventTargetï¼Œå¸¸è§çš„åº”ç”¨å¦‚ä¸‹ï¼š</p><ol><li><strong>ç›‘å¬äº‹ä»¶</strong>: åœ¨ HTML å…ƒç´ ä¸Šç›‘å¬ç‚¹å‡»äº‹ä»¶ã€‚</li></ol><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">`</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`button id=&quot;myButton&quot;&gt;Click me`</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`/button&gt; `</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`script&gt;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">document.getElementById(&#39;myButton&#39;).addEventListener(&#39;click&#39;, function() {</span></span>
<span class="line"><span style="color:#D8DEE9FF;">alert(&#39;Button was clicked!&#39;); }); `</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`/script&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>è‡ªå®šä¹‰äº‹ä»¶</strong>: åœ¨ DOM å…ƒç´ ä¸Šåˆ†å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚</li></ol><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">`</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`script&gt; const event = new CustomEvent(&#39;myCustomEvent&#39;, { detail: { someData:</span></span>
<span class="line"><span style="color:#D8DEE9FF;">&#39;Some data&#39; } }); // ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ document.addEventListener(&#39;myCustomEvent&#39;,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">function(e) { console.log(e.detail.someData); // è¾“å‡º&quot;Some data&quot; }); //</span></span>
<span class="line"><span style="color:#D8DEE9FF;">åˆ†å‘è‡ªå®šä¹‰äº‹ä»¶ document.dispatchEvent(event); `</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`/script&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å·®å¼‚" tabindex="-1"><a class="header-anchor" href="#å·®å¼‚"><span>å·®å¼‚</span></a></h3><ul><li><strong>ç¯å¢ƒ</strong>: Node.js çš„<code>EventTarget</code>ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯ä»£ç ï¼Œè€Œ DOM çš„<code>EventTarget</code>ç”¨äºå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä»£ç ã€‚</li><li><strong>ç”¨ä¾‹</strong>: å°½ç®¡ä¸¤è€…éƒ½ç”¨äºäº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼Œä½† Node.js çš„<code>EventTarget</code>æ›´å¤šç”¨äºå¤„ç†é UI ç›¸å…³çš„åå°äº‹ä»¶ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚å®Œæˆã€æ–‡ä»¶è¯»å–ç»“æŸç­‰ï¼‰ï¼Œè€Œ DOM çš„<code>EventTarget</code>ä¸»è¦ç”¨äºå¤„ç† UI äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»ã€é”®ç›˜è¾“å…¥ç­‰ï¼‰ã€‚</li><li><strong>å®ç°ç»†èŠ‚</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>EventTarget</code>æ˜¯æœ€è¿‘æ‰å¼•å…¥çš„ï¼Œä¸»è¦ä¸ºäº†æé«˜ä¸ Web æ ‡å‡†çš„å…¼å®¹æ€§ã€‚ç„¶è€Œï¼ŒNode.js å·²ç»æœ‰äº†ä¸€ä¸ªéå¸¸æµè¡Œçš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œå³<code>EventEmitter</code>ç±»ã€‚ä¸<code>EventTarget</code>ç›¸æ¯”ï¼Œ<code>EventEmitter</code>æä¾›äº†æ›´ä¸°å¯Œçš„ API æ¥å¤„ç†äº‹ä»¶ï¼Œä¾‹å¦‚<code>once</code>ã€<code>removeListener</code>ç­‰æ–¹æ³•ï¼Œè¿™äº›åœ¨<code>EventTarget</code>ä¸­ä¸ä¸€å®šéƒ½æœ‰å¯¹åº”ã€‚</li></ul><p>é€šè¿‡æ¯”è¾ƒ Node.js å’Œ DOM ä¸­çš„<code>EventTarget</code>ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå°½ç®¡å®ƒä»¬åœ¨ä¸åŒç¯å¢ƒä¸­åº”ç”¨ï¼Œä½†éƒ½æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æ”¯æŒäº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹èŒƒå¼ã€‚</p><h3 id="nodeeventtarget-vs-eventemitter" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-vs-eventemitter"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtarget-vs-eventemitter" target="_blank" rel="noopener noreferrer">NodeEventTarget vs. EventEmitter</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¤„ç†äº‹ä»¶æ˜¯éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚Node.js æä¾›äº†ä¸¤ç§ä¸»è¦çš„æ–¹å¼æ¥å¤„ç†äº‹ä»¶ï¼š<code>NodeEventTarget</code> å’Œ <code>EventEmitter</code>ã€‚è¿™ä¸¤ç§æœºåˆ¶è™½ç„¶éƒ½æ˜¯ä¸ºäº†å®ç°äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼Œä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€äº›å·®å¼‚ã€‚ç†è§£è¿™ä¸¤è€…çš„åŒºåˆ«å¯¹äºé€‰æ‹©æœ€é€‚åˆä½ çš„åº”ç”¨åœºæ™¯çš„äº‹ä»¶å¤„ç†æ¨¡å¼å¾ˆé‡è¦ã€‚</p><h3 id="eventemitter-2" tabindex="-1"><a class="header-anchor" href="#eventemitter-2"><span>EventEmitter</span></a></h3><p><code>EventEmitter</code> æ˜¯ Node.js æœ€ä¼ ç»Ÿä¹Ÿæ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚å®ƒå±äº <code>events</code> æ¨¡å—ï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»º <code>EventEmitter</code> ç±»çš„å®ä¾‹æ¥ä½¿ç”¨å®ƒã€‚è¿™ç§æ–¹å¼å…è®¸å¯¹è±¡ç›‘å¬å’Œè§¦å‘äº‹ä»¶ã€‚æ¯ä¸ªäº‹ä»¶å¯ä»¥æœ‰å¤šä¸ªç›‘å¬å™¨å‡½æ•°ï¼Œå½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œç›‘å¬å™¨å‡½æ•°æŒ‰ç…§æ·»åŠ é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç®€å•çš„èŠå¤©åº”ç”¨ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>EventEmitter</code> æ¥å¤„ç†æ¥æ”¶æ¶ˆæ¯çš„äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª eventEmitter å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chatRoom</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;message&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">user</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">user</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;message&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">chatRoom</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, everyone!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨ <code>chatRoom.emit(&#39;message&#39;, ...)</code> æ—¶ï¼Œæ‰€æœ‰æ³¨å†Œåˆ° &#39;message&#39; äº‹ä»¶çš„ç›‘å¬å™¨å°†è¢«æŒ‰é¡ºåºè°ƒç”¨ï¼Œä»è€Œè¾“å‡º &quot;Alice: Hello, everyone!&quot;ã€‚</p><h3 id="nodeeventtarget" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget"><span>NodeEventTarget</span></a></h3><p>å¦ä¸€æ–¹é¢ï¼Œ<code>NodeEventTarget</code> æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„æœºåˆ¶ï¼Œå®ƒæ›´æ¥è¿‘ Web çš„ EventTarget APIã€‚å®ƒä¸ä»…åœ¨ Node.js ç¯å¢ƒä¸‹å·¥ä½œï¼Œä¹Ÿèƒ½æ›´å¥½åœ°ä¸ Web æ ‡å‡†ä¿æŒä¸€è‡´ã€‚NodeEventTarget ä¸»è¦ç”¨äºä¸€äº›å†…ç½®çš„ Node.js å¯¹è±¡ï¼Œæ¯”å¦‚ <code>AbortController</code> æˆ–æ˜¯ç”¨äºå¤„ç† HTTP2 çš„å¯¹è±¡ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><p>å‡è®¾ä½ éœ€è¦åœ¨åŠŸèƒ½ä¸­ä½¿ç”¨ <code>AbortController</code> æ¥å–æ¶ˆä¸€ä¸ªæ“ä½œï¼Œè¿™å°±æ˜¯ <code>NodeEventTarget</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> AbortController</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:abort-controller</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> controller</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> AbortController</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> signal</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> controller</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">signal</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">abort</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The operation was aborted!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬å†³å®šå–æ¶ˆæ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">controller</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°å‡º &quot;The operation was aborted!&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>AbortController</code> å’Œå®ƒçš„ä¿¡å· (<code>signal</code>) æ¥æ§åˆ¶æ“ä½œçš„å–æ¶ˆã€‚å½“è°ƒç”¨ <code>controller.abort()</code> æ—¶ï¼Œç»‘å®šåœ¨ä¿¡å·çš„ &#39;abort&#39; äº‹ä»¶ä¸Šçš„ç›‘å¬å™¨å°†è¢«è§¦å‘ã€‚</p><h3 id="åŒºåˆ«æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#åŒºåˆ«æ€»ç»“"><span>åŒºåˆ«æ€»ç»“</span></a></h3><ul><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<code>EventEmitter</code> é€‚åˆäºè‡ªå®šä¹‰äº‹ä»¶æˆ–è€… Node.js å†…éƒ¨çš„äº‹ä»¶ï¼Œè€Œ <code>NodeEventTarget</code> æ›´ç¬¦åˆ Web æ ‡å‡†ï¼Œé€šå¸¸ç”¨äºä¸€äº›ç‰¹å®šçš„å†…ç½®å¯¹è±¡ã€‚</li><li><strong>API é£æ ¼</strong>ï¼š<code>EventEmitter</code> æä¾›æ›´ä¸°å¯Œçš„ APIï¼ˆä¾‹å¦‚ <code>once()</code>, <code>removeListener()</code> ç­‰ï¼‰ï¼Œ<code>NodeEventTarget</code> åˆ™æä¾›äº†æ›´è´´è¿‘æµè§ˆå™¨ç¯å¢ƒçš„ APIï¼ˆå¦‚ <code>addEventListener()</code>, <code>removeEventListener()</code>ï¼‰ã€‚</li></ul><p>é€‰æ‹©å“ªä¸€ç§å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ä»¥åŠä½ å¸Œæœ›ä»£ç ä¸å“ªä¸€å¥—æ ‡å‡†ï¼ˆNode.js æˆ– Webï¼‰ä¿æŒä¸€è‡´æ€§ã€‚</p><h3 id="event-listener" tabindex="-1"><a class="header-anchor" href="#event-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#event-listener" target="_blank" rel="noopener noreferrer">Event listener</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶ç›‘å¬æ˜¯ä¸€ç§æ ¸å¿ƒæ¦‚å¿µï¼Œä½¿å¾—å¤„ç†å¼‚æ­¥æ“ä½œæ›´åŠ é«˜æ•ˆå’Œæ–¹ä¾¿ã€‚è¿™é‡Œæˆ‘ä¼šè§£é‡Šä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬å™¨ï¼ˆEvent listenerï¼‰ï¼Œå¹¶é€šè¿‡ä¸€äº›å®é™…ä¾‹å­æ¥å±•ç¤ºå…¶åº”ç”¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬å™¨"><span>ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬å™¨ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ª HTTP è¯·æ±‚å¯¹è±¡å¯èƒ½ä¼šå‘å‡º &#39;data&#39; å’Œ &#39;end&#39; äº‹ä»¶ã€‚äº‹ä»¶ç›‘å¬å™¨å°±æ˜¯å½“è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨çš„å‡½æ•°ã€‚ä½ å¯ä»¥æŠŠäº‹ä»¶ç›‘å¬å™¨æƒ³è±¡æˆæ˜¯å¯¹æŸä¸ªç‰¹å®šäº‹ä»¶å…³æ³¨çš„ä»£ç æ®µï¼Œä¸€æ—¦é‚£ä¸ªäº‹ä»¶å‘ç”Ÿï¼Œç›¸å…³çš„å‡½æ•°å°±ä¼šæ‰§è¡Œã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ-2" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ-2"><span>å¦‚ä½•å·¥ä½œï¼Ÿ</span></a></h3><p>ä½¿ç”¨ Node.js çš„ <code>events</code> æ¨¡å—ï¼Œä½ å¯ä»¥åˆ›å»ºã€è§¦å‘å’Œç›‘å¬è‡ªå·±çš„äº‹ä»¶ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€ä¸ª <code>EventEmitter</code> ç±»ï¼Œä½ å¯ä»¥ä»è¿™ä¸ªç±»ç»§æ‰¿æˆ–è€…åˆ›å»ºå®ƒçš„å®ä¾‹æ¥ç®¡ç†äº‹ä»¶å’Œç›‘å¬å™¨ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºå’Œç›‘å¬ç®€å•äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºå’Œç›‘å¬ç®€å•äº‹ä»¶"><span>1. åˆ›å»ºå’Œç›‘å¬ç®€å•äº‹ä»¶</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šå½“ç”¨æˆ·æ³¨å†Œåˆ°ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å‘é€ä¸€ä¸ªæ¬¢è¿é‚®ä»¶ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨æ¥å®ç°è¿™ä¸€åŠŸèƒ½çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> UserRegistry</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> userRegistry</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> UserRegistry</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;registration&#39; äº‹ä»¶å¹¶å®šä¹‰å“åº”åŠ¨ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9;">userRegistry</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">registration</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">email</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å‘é€æ¬¢è¿é‚®ä»¶åˆ° </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">email</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨ç”¨æˆ·æ³¨å†Œæ—¶è§¦å‘ &#39;registration&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">userRegistry</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">registration</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user@example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>UserRegistry</code> çš„æ–°ç±»ï¼Œå®ƒç»§æ‰¿è‡ª <code>EventEmitter</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ç›‘å¬åä¸º &#39;registration&#39; çš„äº‹ä»¶ï¼Œå¹¶å®šä¹‰å½“è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶è¦æ‰§è¡Œçš„åŠ¨ä½œï¼ˆå³å‘é€é‚®ä»¶ï¼‰ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ <code>emit</code> å‡½æ•°è§¦å‘ &#39;registration&#39; äº‹ä»¶ï¼Œå¹¶ä¼ é€’ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ä½œä¸ºå‚æ•°ã€‚</p><h4 id="_2-å¤„ç†-http-æœåŠ¡å™¨çš„äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-å¤„ç†-http-æœåŠ¡å™¨çš„äº‹ä»¶"><span>2. å¤„ç† HTTP æœåŠ¡å™¨çš„äº‹ä»¶</span></a></h4><p>Node.js å¸¸ç”¨äºåˆ›å»º web æœåŠ¡å™¨ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ç›‘å¬ç”± Node.js HTTP æœåŠ¡å™¨è§¦å‘çš„äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬æœåŠ¡å™¨çš„ &#39;request&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°æ¥è‡ª </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> çš„è¯·æ±‚</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒå¯¹æ‰€æœ‰æ¥æ”¶åˆ°çš„è¯·æ±‚ç®€å•åœ°è¿”å› &quot;Hello World!&quot;ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ç›‘å¬äº†æœåŠ¡å™¨çš„ &#39;request&#39; äº‹ä»¶ï¼Œæ¯å½“æœ‰æ–°çš„è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæˆ‘ä»¬å°±è®°å½•è¯·æ±‚çš„ URLã€‚è¿™å¸®åŠ©æˆ‘ä»¬ç›‘æ§æ­£åœ¨åˆ°è¾¾æœåŠ¡å™¨çš„è¯·æ±‚ç±»å‹ã€‚</p><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p>äº‹ä»¶ç›‘å¬å™¨æ˜¯ Node.js å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œå…è®¸ä½ ä»¥éé˜»å¡çš„æ–¹å¼å¤„ç†å„ç§äº‹ä»¶ã€‚é€šè¿‡ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨ï¼Œä½ å¯ä»¥è½»æ¾åœ°æ„å»ºå‡ºååº”çµæ•ã€é«˜æ•ˆå¤„ç†å¹¶å‘çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="eventtarget-error-handling" tabindex="-1"><a class="header-anchor" href="#eventtarget-error-handling"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtarget-error-handling" target="_blank" rel="noopener noreferrer">EventTarget error handling</a></span></a></h3><p>Node.js ä¸­çš„<code>EventTarget</code>æ˜¯ä¸€ä¸ªå¤„ç†äº‹ä»¶çš„æœºåˆ¶ï¼Œå®ƒæ¥æºäºæµè§ˆå™¨ç«¯çš„ Web APIsï¼Œä½†åœ¨ Node.js é‡Œä¹Ÿæœ‰å®ç°ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºã€ç›‘å¬å’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚äº†è§£<code>EventTarget</code>çš„é”™è¯¯å¤„ç†æ˜¯ç†è§£å¦‚ä½•ä¼˜é›…åœ°ç®¡ç†é”™è¯¯äº‹ä»¶çš„å…³é”®ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå½“ä½ ä½¿ç”¨<code>EventTarget</code>æ¥å£æ—¶ï¼Œå¦‚æœäº‹ä»¶ç›‘å¬å™¨æŠ›å‡ºé”™è¯¯ï¼Œè¿™äº›é”™è¯¯ä¼šè¢«ä¼ æ’­å¹¶å¯ä»¥è¢«æ•è·å¤„ç†ã€‚é”™è¯¯å¤„ç†æ˜¯ç¼–ç¨‹ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨ï¼Œå°¤å…¶æ˜¯åœ¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œæ°å½“åœ°å¤„ç†é”™è¯¯èƒ½å¤Ÿç¡®ä¿ç¨‹åºçš„å¥å£®æ€§å’Œç¨³å®šæ€§ã€‚</p><h3 id="eventtarget-é”™è¯¯å¤„ç†çš„åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#eventtarget-é”™è¯¯å¤„ç†çš„åŸºç¡€"><span>EventTarget é”™è¯¯å¤„ç†çš„åŸºç¡€</span></a></h3><p>å½“ä½¿ç”¨<code>EventTarget</code>æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆlistenerï¼‰æ—¶ï¼Œå¦‚æœç›‘å¬å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æˆ–é”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯ä¸ä¼šç›´æ¥æŠ›å‡ºè‡³å…¨å±€ï¼Œè€Œæ˜¯ä¼šè§¦å‘<code>EventTarget</code>å¯¹è±¡ä¸Šçš„<code>error</code>äº‹ä»¶ã€‚ä½ å¯ä»¥å¯¹è¿™ä¸ª<code>error</code>äº‹ä»¶æ·»åŠ ç›‘å¬å™¨æ¥æ•è·å’Œå¤„ç†è¿™äº›é”™è¯¯ã€‚</p><h3 id="ç®€å•ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç®€å•ç¤ºä¾‹"><span>ç®€å•ç¤ºä¾‹</span></a></h3><p>ä»¥ä¸‹æ˜¯ Node.js ä¸­åˆ©ç”¨<code>EventTarget</code>çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼ŒåŒ…æ‹¬é”™è¯¯å¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªEventTargetå®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">customEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å¤„ç†è‡ªå®šä¹‰äº‹ä»¶: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // äº§ç”Ÿä¸€ä¸ªé”™è¯¯</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å“å‘€ï¼Œå‡ºé”™äº†ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬é”™è¯¯äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ•è·åˆ°é”™è¯¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">customEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº†<code>EventTarget</code>å’Œ<code>Event</code>ç±»ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ª<code>EventTarget</code>å®ä¾‹<code>myEmitter</code>ï¼Œå¹¶ä¸ºå®ƒæ·»åŠ äº†ä¸€ä¸ªç›‘å¬<code>customEvent</code>äº‹ä»¶çš„ç›‘å¬å™¨ã€‚åœ¨è¿™ä¸ªç›‘å¬å™¨å†…éƒ¨ï¼Œæˆ‘ä»¬æ•…æ„æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸º<code>myEmitter</code>æ·»åŠ äº†å¦ä¸€ä¸ªç›‘å¬å™¨ï¼Œä¸“é—¨ç”¨æ¥æ•è·<code>error</code>äº‹ä»¶ã€‚æœ€åï¼Œé€šè¿‡è°ƒç”¨<code>dispatchEvent()</code>æ–¹æ³•å¹¶ä¼ é€’ä¸€ä¸ªæ–°çš„<code>Event</code>å®ä¾‹æ¥è§¦å‘<code>customEvent</code>äº‹ä»¶ã€‚</p><p>å½“<code>customEvent</code>äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå¯¹åº”çš„ç›‘å¬å™¨ä¼šæ‰§è¡Œï¼Œä½†ç”±äºå…¶ä¸­æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯å°±ä¼šè¢«è½¬æ¢æˆä¸€ä¸ª<code>error</code>äº‹ä»¶ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»ä¸º<code>error</code>äº‹ä»¶æ³¨å†Œäº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œæ‰€ä»¥èƒ½å¤Ÿæ•è·å¹¶æ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><h3 id="å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨"><span>å®é™…åº”ç”¨</span></a></h3><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ­£ç¡®å¤„ç†äº‹ä»¶çš„é”™è¯¯å°¤ä¸ºé‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰å¯èƒ½ä¼šå¤±è´¥çš„æ“ä½œæ—¶ã€‚é€šè¿‡ä½¿ç”¨<code>EventTarget</code>çš„é”™è¯¯å¤„ç†ï¼Œä½ å¯ä»¥ä¼˜é›…åœ°ç®¡ç†è¿™äº›é”™è¯¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li>åœ¨ç½‘ç»œæœåŠ¡ä¸­ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚å¯¼è‡´æœåŠ¡å™¨ç«¯é”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡äº‹ä»¶é”™è¯¯å¤„ç†é€šçŸ¥å®¢æˆ·ç«¯ã€‚</li><li>åœ¨åŸºäºäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ä¸­ï¼Œæ¯”å¦‚æ¸¸æˆæˆ–å®æ—¶æ•°æ®å¤„ç†åº”ç”¨ï¼Œé”™è¯¯å¤„ç†å¯ä»¥å¸®åŠ©å¼€å‘è€…åŠæ—¶å‘ç°å¹¶ä¿®å¤é—®é¢˜ï¼Œé¿å…åº”ç”¨å´©æºƒã€‚</li></ul><p>æ€»ä¹‹ï¼ŒNode.js ä¸­çš„<code>EventTarget</code>é”™è¯¯å¤„ç†æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æœºåˆ¶æ¥ä¼˜é›…åœ°å¤„ç†ç¨‹åºä¸­çš„å¼‚æ­¥äº‹ä»¶é”™è¯¯ã€‚é€šè¿‡åˆç†åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¥å£®æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p><h3 id="class-event" tabindex="-1"><a class="header-anchor" href="#class-event"><span><a href="https://nodejs.org/docs/latest/api/events.html#class-event" target="_blank" rel="noopener noreferrer">Class: Event</a></span></a></h3><p>Node.js ä¸­çš„ <code>Event</code> ç±»æ˜¯äº‹ä»¶å¤„ç†çš„æ ¸å¿ƒï¼Œå±äº <code>events</code> æ¨¡å—ã€‚å®ƒå…è®¸ä½ åœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’æ¶ˆæ¯æˆ–è§¦å‘å“åº”è¡Œä¸ºã€‚è¿™ç§æ¨¡å¼è¢«ç§°ä¸ºâ€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼ï¼Œå¹¿æ³›ç”¨äºæ„å»ºæ¾æ•£è€¦åˆçš„ç³»ç»Ÿï¼Œä½¿å¾—åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†èƒ½å¤Ÿé«˜æ•ˆåœ°é€šä¿¡è€Œä¸å¿…ç›´æ¥äº†è§£å¯¹æ–¹ã€‚</p><h3 id="ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹"><span>ç®€ä»‹</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦çŸ¥é“ Node.js çš„<code>events</code>æ¨¡å—æä¾›äº†<code>EventEmitter</code>ç±»ï¼Œè¿™ä¸ªç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯å…è®¸å¯¹è±¡è®¢é˜…å’Œå‘å¸ƒäº‹ä»¶ã€‚è™½ç„¶ä½ æåˆ°çš„æ˜¯<code>Event</code>ç±»ï¼Œä½†å®é™…ä¸Šåœ¨ Node.js æ–‡æ¡£ä¸­ï¼Œæœ€å¸¸è§å’Œæ ¸å¿ƒçš„ç±»æ˜¯<code>EventEmitter</code>ï¼Œå®ƒç”¨äºåˆ›å»ºå¯ä»¥å‘å°„ï¼ˆemitï¼‰äº‹ä»¶çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è¿™äº›äº‹ä»¶è¿›è¡Œç›‘å¬ã€‚</p><h3 id="ä½¿ç”¨æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ­¥éª¤"><span>ä½¿ç”¨æ­¥éª¤</span></a></h3><ol><li><strong>å¯¼å…¥æ¨¡å—</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥<code>events</code>æ¨¡å—ã€‚</li><li><strong>åˆ›å»ºå®ä¾‹</strong>ï¼šç„¶åï¼Œé€šè¿‡<code>new EventEmitter()</code>æ¥åˆ›å»ºä¸€ä¸ªäº‹ä»¶å‘å°„å™¨çš„å®ä¾‹ã€‚</li><li><strong>ç»‘å®šäº‹ä»¶ç›‘å¬å™¨</strong>ï¼šä½¿ç”¨<code>.on(eventName, listener)</code>æ–¹æ³•ç»‘å®šäº‹ä»¶åŠå…¶ç›‘å¬å‡½æ•°ã€‚</li><li><strong>è§¦å‘äº‹ä»¶</strong>ï¼šé€šè¿‡<code>.emit(eventName, [...args])</code>æ–¹æ³•æ¥è§¦å‘äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œç»‘å®šçš„ç›‘å¬å‡½æ•°ã€‚</li></ol><h3 id="å®ä¾‹è®²è§£" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹è®²è§£"><span>å®ä¾‹è®²è§£</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„ç”µå•†å¹³å°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯å½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘é€ä¸€å°ç¡®è®¤é‚®ä»¶ç»™ç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥ç”¨<code>EventEmitter</code>æ¥å®ç°è¿™ä¸ªæµç¨‹ã€‚</p><h4 id="æ­¥éª¤-1-å¯¼å…¥-events-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-å¯¼å…¥-events-æ¨¡å—"><span>æ­¥éª¤ 1: å¯¼å…¥ Events æ¨¡å—</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-åˆ›å»º-eventemitter-å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-åˆ›å»º-eventemitter-å®ä¾‹"><span>æ­¥éª¤ 2: åˆ›å»º EventEmitter å®ä¾‹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-3-ç»‘å®šäº‹ä»¶ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-ç»‘å®šäº‹ä»¶ç›‘å¬å™¨"><span>æ­¥éª¤ 3: ç»‘å®šäº‹ä»¶ç›‘å¬å™¨</span></a></h4><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªäº‹ä»¶<code>orderPlaced</code>ï¼Œå¹¶ä¸ºå®ƒç»‘å®šä¸€ä¸ªç›‘å¬å™¨ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼Œç”¨äºå‘é€é‚®ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">orderPlaced</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">email</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Sending confirmation email to </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">email</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œå¯ä»¥æ”¾ç½®å‘é€é‚®ä»¶çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-4-è§¦å‘äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-4-è§¦å‘äº‹ä»¶"><span>æ­¥éª¤ 4: è§¦å‘äº‹ä»¶</span></a></h4><p>å½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œæˆ‘ä»¬è§¦å‘<code>orderPlaced</code>äº‹ä»¶ï¼Œå¹¶ä¼ å…¥ç”¨æˆ·çš„é‚®ç®±ä½œä¸ºå‚æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">orderPlaced</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user@example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœå°†æ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Sending confirmation email to user@example.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†<code>EventEmitter</code>åœ¨ Node.js ä¸­æ€æ ·ç”¨äºå¤„ç†å¼‚æ­¥äº‹ä»¶ã€‚å®ƒéå¸¸é€‚åˆé‚£äº›éœ€è¦å¤šä¸ªéƒ¨åˆ†ç›¸äº’é€šä¿¡çš„åº”ç”¨ï¼Œæ¯”å¦‚ web æœåŠ¡å™¨ç›‘å¬ HTTP è¯·æ±‚æˆ–è€…åœ¨æŸä¸ªæ“ä½œå®Œæˆåé€šçŸ¥å…¶ä»–éƒ¨åˆ†ã€‚è¿™æ ·çš„æ¶æ„è®¾è®¡ä½¿å¾— Node.js åº”ç”¨å¯ä»¥æ›´åŠ æ¨¡å—åŒ–ï¼Œå¢å¼ºäº†ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>å¸Œæœ›è¿™è§£é‡Šèƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Node.js ä¸­çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼</p><h4 id="event-cancelbubble" tabindex="-1"><a class="header-anchor" href="#event-cancelbubble"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventcancelbubble" target="_blank" rel="noopener noreferrer">event.cancelBubble</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å®ƒè¢«å¹¿æ³›åº”ç”¨äºæ„å»ºç½‘ç»œæœåŠ¡å’Œåº”ç”¨ç¨‹åºã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-event-cancelbubble" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-event-cancelbubble"><span>ä»€ä¹ˆæ˜¯ <code>event.cancelBubble</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js çš„äº‹ä»¶ç³»ç»Ÿä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æåˆ° <code>event.cancelBubble</code> è¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæ¦‚å¿µä¸»è¦æ¥æºäºæµè§ˆå™¨ç«¯çš„ JavaScriptã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œ<code>event.cancelBubble</code> ç”¨äºåœæ­¢äº‹ä»¶å†’æ³¡ã€‚å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨æŸä¸ªå…ƒç´ ä¸Šæ—¶ï¼Œè¯¥äº‹ä»¶ä¸ä»…ä»…ä¼šåœ¨è¯¥å…ƒç´ ä¸Šè§¦å‘ï¼Œè¿˜ä¼šæŒ‰ç…§ä»å†…å‘å¤–çš„é¡ºåºä¾æ¬¡è§¦å‘å…¶çˆ¶å…ƒç´ ä¸Šçš„ç›¸åŒäº‹ä»¶ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºâ€œäº‹ä»¶å†’æ³¡â€ã€‚é€šè¿‡è®¾ç½® <code>event.cancelBubble = true</code>ï¼Œå¯ä»¥é˜»æ­¢äº‹ä»¶ç»§ç»­å†’æ³¡ã€‚</p><h3 id="åœ¨-node-js-ä¸­å¤„ç†äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ä¸­å¤„ç†äº‹ä»¶"><span>åœ¨ Node.js ä¸­å¤„ç†äº‹ä»¶</span></a></h3><p>è™½ç„¶ Node.js è‡ªèº«å¹¶ä¸ç›´æ¥ä½¿ç”¨ <code>event.cancelBubble</code>ï¼Œä½†å®ƒæœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œä¸»è¦é€šè¿‡ <code>events</code> æ¨¡å—æ¥å®ç°ã€‚Node.js ä¸­çš„å¾ˆå¤šå¯¹è±¡éƒ½ä¼šå‘å°„äº‹ä»¶ï¼šä¸€ä¸ª <code>net.Server</code> å¯¹è±¡ä¼šåœ¨æ–°å®¢æˆ·ç«¯è¿æ¥æ—¶å‘å°„ä¸€ä¸ª &#39;connection&#39; äº‹ä»¶ï¼›ä¸€ä¸ª <code>fs.readStream</code> å¯¹è±¡ä¼šåœ¨æ–‡ä»¶è¢«æ‰“å¼€æ—¶å‘å°„ä¸€ä¸ª &#39;open&#39; äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">an event occurred!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„èŠå¤©åº”ç”¨ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å“åº”ç”¨æˆ·å‘é€æ¶ˆæ¯çš„åŠ¨ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> chatEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">New message: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">//æ¥æºï¼šdoc.cherrychat.org è¯·å‹¿rwå“’å•†ç”¨doc.cherrychat.org</span></span>
<span class="line"><span style="color:#D8DEE9;">chatEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬å‘ <code>chatEmitter</code> å‘å‡º &#39;message&#39; äº‹ä»¶æ—¶ï¼Œç›‘å¬å™¨ä¼šæ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶å¹¶æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œæ‰“å°å‡ºæ¶ˆæ¯å†…å®¹ã€‚</p><h4 id="æ€»ç»“-8" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-8"><span>æ€»ç»“</span></a></h4><p>Node.js ä½¿ç”¨ <code>EventEmitter</code> ç±»å’Œäº‹ä»¶ç›‘å¬å™¨æ¨¡å¼æ¥å¤„ç†äº‹ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åƒ <code>event.cancelBubble</code> è¿™æ ·çš„æµè§ˆå™¨ç‰¹å®šåŠŸèƒ½æ¥æ§åˆ¶äº‹ä»¶æµã€‚è¿™ç§æ¨¡å‹éå¸¸é€‚åˆæ„å»ºé«˜æ€§èƒ½ã€äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ï¼Œå¦‚ç½‘ç»œæœåŠ¡å™¨ã€å®æ—¶é€šä¿¡ç³»ç»Ÿç­‰ã€‚ç†è§£ Node.js ä¸­çš„äº‹ä»¶å¤„ç†æœºåˆ¶å¯¹äºå¼€å‘é«˜æ•ˆä¸”å¯æ‰©å±•çš„ Node.js åº”ç”¨è‡³å…³é‡è¦ã€‚</p><h4 id="event-cancelable" tabindex="-1"><a class="header-anchor" href="#event-cancelable"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventcancelable" target="_blank" rel="noopener noreferrer">event.cancelable</a></span></a></h4><p>Node.js ä¸­çš„ <code>event.cancelable</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå’Œäº‹ä»¶ç³»ç»Ÿç›¸å…³ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä¸€ä¸‹ Node.js ä¸­çš„äº‹ä»¶ç³»ç»Ÿã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶ä¸»è¦æ˜¯ç”± <code>EventEmitter</code> ç±»ç®¡ç†çš„ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¹¿æ’­ç«™ï¼Œå„ç§äº‹ä»¶åœ¨è¿™é‡Œè¢«å‘é€ï¼ˆemitï¼‰å’Œç›‘å¬ï¼ˆonï¼‰ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ä¸­ï¼Œå½“æœ‰æ–°è¿æ¥æ—¶ï¼Œå¯èƒ½ä¼šå‘å‡ºä¸€ä¸ªâ€œæ–°è¿æ¥â€äº‹ä»¶ï¼›åœ¨æ–‡ä»¶è¯»å†™è¿‡ç¨‹ä¸­ï¼Œå®Œæˆè¯»å–åå¯èƒ½ä¼šå‘å‡ºä¸€ä¸ªâ€œè¯»å–å®Œæˆâ€äº‹ä»¶ã€‚</p><p><code>event.cancelable</code> å…³è”åˆ°äº†è¿™ä¸ªäº‹ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼Œç”¨æ¥æŒ‡ç¤ºæŸä¸ªç‰¹å®šçš„äº‹ä»¶æ˜¯å¦å¯ä»¥è¢«å–æ¶ˆã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶æ˜¯å¯å–æ¶ˆçš„ (<code>true</code>)ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ <code>event.preventDefault()</code> æ–¹æ³•æ¥å–æ¶ˆè¯¥äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºã€‚å¦‚æœæ˜¯ä¸å¯å–æ¶ˆçš„ (<code>false</code>)ï¼Œè°ƒç”¨ <code>event.preventDefault()</code> å°†ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-3"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="_1-è‡ªå®šä¹‰äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-è‡ªå®šä¹‰äº‹ä»¶"><span>1. è‡ªå®šä¹‰äº‹ä»¶</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ¸¸æˆï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªè§’è‰²å‡çº§çš„äº‹ä»¶ã€‚ä½ å¸Œæœ›åœ¨æŸäº›æƒ…å†µä¸‹é˜»æ­¢è§’è‰²å‡çº§ï¼ˆæ¯”å¦‚è§’è‰²èº«ä¸Šæœ‰æŸç§ç‰¹å®šçš„çŠ¶æ€æ—¶ï¼‰ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥åœ¨è§¦å‘è§’è‰²å‡çº§äº‹ä»¶ä¹‹å‰æ£€æŸ¥ <code>event.cancelable</code> å±æ€§ï¼Œå¹¶æ®æ­¤å†³å®šæ˜¯å¦å–æ¶ˆäº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> Game</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> game</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Game</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è§’è‰²å‡çº§äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">game</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">levelUp</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cancelable</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> someCondition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    event</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">preventDefault</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å‡çº§äº‹ä»¶è¢«å–æ¶ˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è§’è‰²æˆåŠŸå‡çº§</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘è§’è‰²å‡çº§äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">game</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">levelUp</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> cancelable</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šåœ¨æ ‡å‡†çš„ Node.js <code>EventEmitter</code> ä¸­ï¼Œå¹¶æ²¡æœ‰åŸç”Ÿæ”¯æŒ <code>event.cancelable</code> å’Œ <code>event.preventDefault()</code>ã€‚è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜å¦‚æœæœ‰ç±»ä¼¼æœºåˆ¶æ—¶ï¼Œä½ å¯ä»¥å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚</p><h4 id="_2-ç½‘ç»œè¯·æ±‚æ‹¦æˆª" tabindex="-1"><a class="header-anchor" href="#_2-ç½‘ç»œè¯·æ±‚æ‹¦æˆª"><span>2. ç½‘ç»œè¯·æ±‚æ‹¦æˆª</span></a></h4><p>å¦ä¸€ä¸ªä¾‹å­å¯èƒ½æ¶‰åŠåˆ°æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªåŸºäº Node.js çš„ web åº”ç”¨ï¼Œä½ æƒ³åœ¨å¤„ç† POST è¯·æ±‚ä¹‹å‰è¿›è¡Œä¸€ç³»åˆ—æ£€æŸ¥ï¼Œæ¯”å¦‚éªŒè¯ç”¨æˆ·èº«ä»½ã€æ£€æŸ¥è¯·æ±‚ä½“çš„å†…å®¹ç­‰ã€‚å¦‚æœæŸäº›æ£€æŸ¥å¤±è´¥ï¼Œä½ å¯èƒ½æƒ³å–æ¶ˆè¿™ä¸ªè¯·æ±‚çš„è¿›ä¸€æ­¥å¤„ç†ã€‚</p><p>è¿™ç§åœºæ™¯é€šå¸¸ä¼šåœ¨æ›´é«˜å±‚æ¬¡çš„æ¡†æ¶ä¸­é‡åˆ°ï¼Œæ¯”å¦‚ Express æˆ– Koaï¼Œè¿™äº›æ¡†æ¶å¯èƒ½æä¾›äº†è‡ªå·±çš„æœºåˆ¶æ¥å¤„ç†å¯å–æ¶ˆçš„äº‹ä»¶æˆ–ä¸­é—´ä»¶ã€‚</p><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p><code>event.cancelable</code> åœ¨ Node.js æ ‡å‡† <code>EventEmitter</code> ä¸­å¹¶ä¸ç›´æ¥å­˜åœ¨ï¼Œä½†ç†è§£è¿™ä¸ªæ¦‚å¿µå¯¹äºå¤„ç†è‡ªå®šä¹‰äº‹ä»¶æˆ–ä½¿ç”¨ä¸€äº›é«˜çº§æ¡†æ¶ä¸­çš„äº‹ä»¶éå¸¸é‡è¦ã€‚å®ƒä»£è¡¨äº†å¯¹äº‹ä»¶å¤„ç†æµç¨‹çš„æ›´ç»†ç²’åº¦æ§åˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦é¢„é˜²é»˜è®¤è¡Œä¸ºçš„æƒ…å†µä¸‹ã€‚</p><h4 id="event-composed" tabindex="-1"><a class="header-anchor" href="#event-composed"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventcomposed" target="_blank" rel="noopener noreferrer">event.composed</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>event.composed</code> å±æ€§æ˜¯ä¸äº‹ä»¶çš„æ„æˆï¼ˆcompositionï¼‰æœ‰å…³çš„ä¸€ä¸ªæ¦‚å¿µã€‚ç„¶è€Œï¼Œä»ä½ æä¾›çš„é“¾æ¥å’Œ Node.js v21.7.1 çš„æ–‡æ¡£æ¥çœ‹ï¼Œä¼¼ä¹æœ‰äº›è¯¯è§£ã€‚Node.js çš„å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰ç›´æ¥æåˆ°åä¸º <code>event.composed</code> çš„å±æ€§ã€‚è¿™ä¸ªå±æ€§æ›´å¤šåœ°ä¸ Web å¼€å‘ä¸­çš„äº‹ä»¶ä¼ æ’­ç›¸å…³ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†è‡ªå®šä¹‰äº‹ä»¶æ—¶ã€‚å¯èƒ½ä½ æ‰€æŒ‡çš„æ˜¯æŸç§ç‰¹å®šçš„åº“æˆ–æ¡†æ¶ä¸­çš„æ¦‚å¿µï¼Œæˆ–è€…æ˜¯å¯¹äº Node.js äº‹ä»¶æœºåˆ¶çš„å¹¿ä¹‰ç†è§£ã€‚</p><p>ä¸è¿‡ï¼Œè®©æˆ‘ç»™ä½ ä¸€ä¸ªå…³äº Node.js ä¸­äº‹ä»¶å¤„ç†åŠå…¶åœ¨å®é™…åº”ç”¨ä¸­å¦‚ä½•ä½¿ç”¨çš„æ¦‚æ‹¬è§£é‡Šï¼Œè¿™å¯èƒ½å¸®åŠ©ä½ ç†è§£ Node.js é‡Œé¢äº‹ä»¶ç›¸å…³çš„æ¦‚å¿µã€‚</p><h3 id="node-js-äº‹ä»¶ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#node-js-äº‹ä»¶ç³»ç»Ÿ"><span>Node.js äº‹ä»¶ç³»ç»Ÿ</span></a></h3><p>Node.js å†…éƒ¨å¤§é‡ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œæ ¸å¿ƒåŸºç¡€ä¹‹ä¸€å°±æ˜¯ <code>EventEmitter</code> ç±»ã€‚è¿™ä¸ªç±»ç”¨äºå¤„ç†äº‹ä»¶ï¼šå¯ä»¥åˆ›å»ºã€ç›‘å¬ã€è§¦å‘äº‹ä»¶ã€‚è¿™åœ¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ä¸­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†åƒæ–‡ä»¶æ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆçš„æƒ…å†µã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-13"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-æ–‡ä»¶è¯»å–" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ–‡ä»¶è¯»å–"><span>ç¤ºä¾‹ 1: æ–‡ä»¶è¯»å–</span></a></h4><p>å‡è®¾ä½ æƒ³å¼‚æ­¥è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶åœ¨è¯»å–å®Œæˆååšä¸€äº›å¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> ReadFileEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readFileEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ReadFileEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜… read-complete äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">readFileEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">read-complete</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">content</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–‡ä»¶å†…å®¹:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> content</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è§¦å‘ read-complete äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  readFileEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">read-complete</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>EventEmitter</code> å®ä¾‹ <code>readFileEmitter</code> æ¥å¤„ç†æ–‡ä»¶è¯»å–ç»“æŸçš„é€šçŸ¥ã€‚</p><h4 id="ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚"><span>ç¤ºä¾‹ 2: ç½‘ç»œè¯·æ±‚</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒåœ¨æ¥æ”¶åˆ°è¯·æ±‚åå“åº”å®¢æˆ·ç«¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> RequestEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> RequestEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">requestEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">new-request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å“åº”è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è§¦å‘ new-request äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">    requestEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">new-request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæ¯å½“æœåŠ¡å™¨æ”¶åˆ°æ–°çš„ HTTP è¯·æ±‚æ—¶ï¼Œé€šè¿‡ <code>requestEmitter</code> å‘å‡º <code>new-request</code> äº‹ä»¶ï¼Œå¹¶å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</p><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p>ä»¥ä¸Šä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚è™½ç„¶ <code>event.composed</code> å¹¶ä¸ç›´æ¥é€‚ç”¨äºè¿™äº›æƒ…å†µï¼Œä½†ç†è§£äº‹ä»¶çš„åŸºæœ¬æ¦‚å¿µå’Œå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„è®¾è®¡æ¨¡å¼å¯¹äºæ·±å…¥å­¦ä¹  Node.js éå¸¸é‡è¦ã€‚</p><p>å¦‚æœä½ æŒ‡çš„ <code>event.composed</code> æ˜¯ç‰¹å®šåœºæ™¯ä¸‹çš„å±æ€§ï¼Œè¯·å°è¯•æŸ¥æ‰¾è¯¥å±æ€§æ‰€åœ¨åº“çš„æ–‡æ¡£ä»¥è·å–æ›´å‡†ç¡®çš„ä¿¡æ¯ã€‚</p><h4 id="event-composedpath" tabindex="-1"><a class="header-anchor" href="#event-composedpath"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventcomposedpath" target="_blank" rel="noopener noreferrer">event.composedPath()</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>event.composedPath()</code>æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„åŒ…å«äº†äº‹ä»¶ä¼ æ’­è¿‡ç¨‹ä¸­é‡åˆ°çš„æ‰€æœ‰å¯¹è±¡ã€‚è¿™ä¸ªæ¦‚å¿µæ¥æºäº Web æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¤„ç†ï¼Œå°¤å…¶æ˜¯åœ¨äº‹ä»¶å†’æ³¡ï¼ˆbubblingï¼‰æˆ–æ•è·ï¼ˆcapturingï¼‰é˜¶æ®µä¸­ã€‚</p><p>ä½†æ˜¯ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Node.js v21.7.1 çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æåˆ°<code>event.composedPath()</code>è¿™ä¸ªæ–¹æ³•ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•æ›´å¸¸è§äº Web å‰ç«¯å¼€å‘ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç† DOM äº‹ä»¶æ—¶ã€‚å› æ­¤ï¼Œåœ¨è§£é‡Šè¿™ä¸ªæ–¹æ³•æ—¶ï¼Œæˆ‘ä¼šåŸºäº Web ç¯å¢ƒæ¥è¿›è¡Œè¯´æ˜ã€‚</p><p>åœ¨ Web æµè§ˆå™¨ä¸­ï¼Œå½“ä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šç»è¿‡ä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li>æ•è·é˜¶æ®µï¼ˆCapturing Phaseï¼‰ï¼šäº‹ä»¶ä»çª—å£å¯¹è±¡å¼€å§‹ï¼Œæ²¿ç€ DOM æ ‘å‘ä¸‹ä¼ é€’ï¼Œç›´åˆ°è¾¾åˆ°è§¦å‘äº‹ä»¶çš„æœ€æ·±å±‚èŠ‚ç‚¹ã€‚</li><li>ç›®æ ‡é˜¶æ®µï¼ˆTarget Phaseï¼‰ï¼šäº‹ä»¶åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ ã€‚</li><li>å†’æ³¡é˜¶æ®µï¼ˆBubbling Phaseï¼‰ï¼šäº‹ä»¶ä»ç›®æ ‡èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç€ DOM æ ‘å‘ä¸Šå†’æ³¡ï¼Œç›´åˆ°å†æ¬¡åˆ°è¾¾çª—å£å¯¹è±¡ã€‚</li></ol><p><code>event.composedPath()</code>æ–¹æ³•å°±æ˜¯ç”¨æ¥è·å–è¿™ä¸ªäº‹ä»¶ä¼ æ’­è·¯å¾„ä¸Šçš„æ‰€æœ‰å¯¹è±¡çš„ã€‚å®ƒè¿”å›çš„æ•°ç»„æŒ‰ç…§äº‹ä»¶ä¼ æ’­çš„é¡ºåºæ’åˆ—ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æœ€å†…å±‚çš„ç›®æ ‡å…ƒç´ ï¼Œæœ€åä¸€ä¸ªå…ƒç´ æ˜¯æœ€å¤–å±‚çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ <code>Window</code> å¯¹è±¡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€æ®µ HTML ä»£ç ï¼Œé‡Œé¢æœ‰åµŒå¥—çš„å…ƒç´ ï¼š</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">`</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`div id=&quot;parent&quot;&gt; `</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`button id=&quot;child&quot;&gt;Click me!`</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`/button&gt; `</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`/div&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ç”¨æˆ·åœ¨é¡µé¢ä¸Šç‚¹å‡» &quot;Click me!&quot; æŒ‰é’®æ—¶ï¼Œå‡è®¾æˆ‘ä»¬ä¸ºè¿™ä¸ªæŒ‰é’®æ·»åŠ äº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨äº†<code>event.composedPath()</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getElementById</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> event</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">composedPath</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™å°†æ‰“å°å‡ºäº‹ä»¶çš„ä¼ æ’­è·¯å¾„</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œ<code>event.composedPath()</code>å°†è¿”å›ä»¥ä¸‹æ•°ç»„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">[</span></span>
<span class="line"><span style="color:#ECEFF4;">  `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;">button</span><span style="color:#D8DEE9;"> id</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">&gt;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›®æ ‡èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#ECEFF4;">  `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;">div</span><span style="color:#D8DEE9;"> id</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">parent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">&gt;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;">   // çˆ¶èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#ECEFF4;">  `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;">body</span><span style="color:#81A1C1;">&gt;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;">              // bodyèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#ECEFF4;">  `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;">html</span><span style="color:#81A1C1;">&gt;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;">              // htmlèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#D8DEE9;">  document</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;">            // documentå¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9;">  Window</span><span style="color:#616E88;">               // Windowå¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9FF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ•°ç»„è¡¨ç¤ºäº†äº‹ä»¶ä»æŒ‰é’®å…ƒç´ å¼€å§‹ï¼Œç»è¿‡çˆ¶å…ƒç´ ï¼Œç„¶åæ˜¯<code>body</code>, <code>html</code>, æœ€ç»ˆåˆ°è¾¾<code>document</code>å’Œ<code>Window</code>å¯¹è±¡çš„ä¼ æ’­è·¯å¾„ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>event.composedPath()</code>åœ¨ Node.js çš„å¸¸è§„ç¯å¢ƒä¸‹ä¸é€‚ç”¨ï¼Œå®ƒä¸»è¦ç”¨äº Web æµè§ˆå™¨ä¸­çš„ DOM äº‹ä»¶å¤„ç†ã€‚å¦‚æœä½ æ­£åœ¨å­¦ä¹  Node.jsï¼Œå¹¶ä¸”ä¸“æ³¨äºåç«¯å¼€å‘ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœä½ æ­£åœ¨å­¦ä¹ å‰ç«¯å¼€å‘ï¼Œå¹¶ä¸”ä¸ DOM äº¤äº’ï¼Œé‚£è¿™ä¸ªæ–¹æ³•å¯ä»¥å¸®åŠ©ä½ ç†è§£å’Œè¿½è¸ªäº‹ä»¶çš„ä¼ æ’­è·¯å¾„ã€‚</p><h4 id="event-currenttarget" tabindex="-1"><a class="header-anchor" href="#event-currenttarget"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventcurrenttarget" target="_blank" rel="noopener noreferrer">event.currentTarget</a></span></a></h4><p>Node.js ä¸­çš„ <code>event.currentTarget</code> å±äºäº‹ä»¶æ¨¡å—ï¼Œå®ƒæ˜¯åœ¨å¤„ç†äº‹ä»¶æ—¶ä½¿ç”¨çš„å±æ€§ã€‚è¦ç†è§£ <code>event.currentTarget</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ Node.js ä¸­çš„äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½èƒ½è§¦å‘äº‹ä»¶ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨æ¯æ¬¡æ¥æ”¶è¯·æ±‚æ—¶éƒ½ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚æˆ‘ä»¬é€šå¸¸ä¼šä¸ºè¿™äº›äº‹ä»¶æ·»åŠ å›è°ƒå‡½æ•°æ¥â€œç›‘å¬â€è¿™äº›äº‹ä»¶ï¼Œå¹¶ä¸”å½“äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œè¿™äº›å›è°ƒå‡½æ•°ã€‚</p><p>Node.js ä½¿ç”¨ EventEmitter ç±»æ¥å¤„ç†äº‹ä»¶ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­æ¥å…·ä½“äº†è§£ <code>event.currentTarget</code> åœ¨å®é™…ä¸­çš„åº”ç”¨ï¼š</p><h3 id="_1-åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-åŸºæœ¬æ¦‚å¿µ"><span>1. åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>EventEmitter æ˜¯ Node.js ä¸­æ‰€æœ‰èƒ½å¤Ÿå‘å‡ºäº‹ä»¶çš„å¯¹è±¡çš„åŸºç¡€ã€‚ä¸€ä¸ª EventEmitter å®ä¾‹æœ‰ä¸€ä¸ª <code>on</code> æ–¹æ³•ï¼Œç”¨äºç»‘å®šäº‹ä»¶åŠå…¶å¤„ç†å‡½æ•°ï¼ˆç›‘å¬å™¨ï¼‰ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå¯¹åº”çš„ç›‘å¬å™¨å°±ä¼šè¢«è°ƒç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> this</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> this</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">a</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">b</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ EventEmitter å®ä¾‹ <code>myEmitter</code> å¹¶ç›‘å¬äº†ä¸€ä¸ªå«åš <code>event</code> çš„äº‹ä»¶ã€‚å½“äº‹ä»¶é€šè¿‡ <code>emit</code> è¢«è§¦å‘æ—¶ï¼Œæ³¨å†Œçš„å›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p><p>**æ³¨æ„ï¼š**åœ¨ Node.js v21.7.1 å½“ä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æåˆ° <code>event.currentTarget</code>ã€‚ä¸è¿‡ï¼Œä¸ºäº†ä¿æŒå¯¹è¯çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è§£é‡Šå®ƒå¦‚æœå­˜åœ¨ä¼šæ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><h3 id="_2-event-currenttarget-çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_2-event-currenttarget-çš„æ¦‚å¿µ"><span>2. event.currentTarget çš„æ¦‚å¿µ</span></a></h3><p>åœ¨æµè§ˆå™¨çš„ JavaScript ä¸­ï¼Œ<code>event.currentTarget</code> æŒ‡å‘ç»‘å®šäº‹ä»¶ç›‘å¬å™¨çš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œåœ¨ Node.js ä¸­ï¼Œäº‹ä»¶æ¨¡å‹ç¨æœ‰ä¸åŒï¼Œå› ä¸ºæˆ‘ä»¬é€šå¸¸ä¸å¤„ç† DOM å…ƒç´ ï¼Œè€Œæ˜¯å¤„ç†è¯¸å¦‚æµã€æœåŠ¡å™¨è¯·æ±‚ç­‰ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚</p><p>å¦‚æœ <code>event.currentTarget</code> åœ¨ Node.js ä¸­çš„ EventEmitter ä¸­æœ‰å¯¹åº”çš„æ¦‚å¿µï¼Œå®ƒå°†æŒ‡å‘è§¦å‘äº‹ä»¶çš„ EventEmitter å¯¹è±¡ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœ <code>event.currentTarget</code> å­˜åœ¨ï¼Œå®ƒå°†æŒ‡å‘ <code>myEmitter</code> å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨äº‹ä»¶ç›‘å¬å™¨å†…éƒ¨ï¼Œ<code>this</code> å…³é”®å­—é€šå¸¸æŒ‡å‘ç»‘å®šç›‘å¬å™¨çš„ EventEmitter å®ä¾‹ï¼Œç±»ä¼¼äº <code>event.currentTarget</code> çš„è¡Œä¸ºã€‚</p><h3 id="_3-eventemitter-ä¸­çš„-this-å…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#_3-eventemitter-ä¸­çš„-this-å…³é”®å­—"><span>3. EventEmitter ä¸­çš„ this å…³é”®å­—</span></a></h3><p>åœ¨ EventEmitter çš„å›è°ƒä¸­ï¼Œ<code>this</code> å…³é”®å­—é»˜è®¤æŒ‡å‘è§¦å‘äº‹ä»¶çš„ EventEmitter å®ä¾‹ã€‚è¿™ä¸ <code>event.currentTarget</code> åœ¨æ¦‚å¿µä¸Šæ˜¯ç›¸ä¼¼çš„ï¼Œå°½ç®¡ <code>event.currentTarget</code> è¿™ä¸ªç‰¹å®šå±æ€§åœ¨ Node.js çš„ EventEmitter ä¸­å¹¶ä¸å­˜åœ¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // true</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šæ˜¯å¯¹ <code>event.currentTarget</code> åœ¨ Node.js ä¸­çš„ EventEmitter å¯¹è±¡ä¸­çš„æ¦‚å¿µæ€§è§£é‡Šã€‚ç”±äº Node.js ä¸­å®˜æ–¹æ–‡æ¡£ç›´åˆ°ç‰ˆæœ¬ v21.7.1 å¹¶æœªåŒ…å« <code>event.currentTarget</code> å±æ€§ï¼Œæ‰€ä»¥åœ¨ç¼–å†™ Node.js åº”ç”¨ç¨‹åºæ—¶å¹¶ä¸ä¼šç›´æ¥ä½¿ç”¨è¯¥å±æ€§ã€‚ç›¸åï¼Œä½ ä¼šä½¿ç”¨ <code>this</code> å…³é”®å­—æˆ–è€…æ˜¾å¼åœ°å¼•ç”¨äº‹ä»¶è§¦å‘å™¨çš„å®ä¾‹æ¥è·å–å½“å‰æ­£åœ¨å¤„ç†äº‹ä»¶çš„å¯¹è±¡çš„ä¸Šä¸‹æ–‡ã€‚</p><h4 id="event-defaultprevented" tabindex="-1"><a class="header-anchor" href="#event-defaultprevented"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventdefaultprevented" target="_blank" rel="noopener noreferrer">event.defaultPrevented</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>event.defaultPrevented</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒé€šå¸¸å­˜åœ¨äºäº‹ä»¶å¯¹è±¡ä¸Šã€‚å½“ä½ å¤„ç†åƒæµè§ˆå™¨ä¸­çš„ DOM äº‹ä»¶ä¸€æ ·çš„äº‹ä»¶ç³»ç»Ÿæ—¶ï¼Œè¿™ä¸ªå±æ€§ä¼šç”¨åˆ°ã€‚ä½†åœ¨ Node.js çš„ <code>EventEmitter</code> ç±»ä¸­ï¼Œé»˜è®¤å¹¶ä¸ç›´æ¥æ”¯æŒ <code>event.defaultPrevented</code> å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªè¾ƒä½çº§çš„æ¨¡å—ï¼Œä¸»è¦ç”¨äºè‡ªå®šä¹‰äº‹ä»¶å’ŒåŒæ­¥æˆ–å¼‚æ­¥çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚</p><p>ç„¶è€Œï¼Œä½ å¯èƒ½ä¼šåœ¨ä½¿ç”¨æŸäº› Node.js çš„åº“æˆ–æ¡†æ¶æ—¶é‡åˆ° <code>event.defaultPrevented</code> çš„æ¦‚å¿µï¼Œå°¤å…¶æ˜¯é‚£äº›æ¨¡ä»¿äº†æµè§ˆå™¨äº‹ä»¶å¤„ç†è¡Œä¸ºçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœäº‹ä»¶å¯¹è±¡æœ‰ä¸€ä¸ª <code>preventDefault</code> æ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œé‚£ä¹ˆ <code>event.defaultPrevented</code> å±æ€§å°†ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ã€‚è¿™è¡¨ç¤ºäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºå·²ç»è¢«é˜»æ­¢ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ç±»ä¼¼ <code>event.defaultPrevented</code> çš„æœºåˆ¶ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„äº‹ä»¶å‘å°„å™¨ï¼Œæ¨¡æ‹Ÿç‚¹å‡»æ“ä½œï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥é˜»æ­¢æŸäº›é»˜è®¤è¡Œä¸ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> ClickEventEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // æ·»åŠ ä¸€ä¸ªæ ‡å¿—æ¥è¡¨ç¤ºé»˜è®¤è¡Œä¸ºæ˜¯å¦è¢«é˜»æ­¢</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">defaultPrevented</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  emitClick</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      preventDefault</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span><span style="color:#81A1C1;"> this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">defaultPrevented</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> true;</span><span style="color:#ECEFF4;"> }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> clickEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClickEventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ³¨å†Œä¸€ä¸ª click äº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">clickEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#616E88;">/* æŸäº›æ¡ä»¶æ»¡è¶³ï¼Œæ¯”å¦‚ç‚¹å‡»çš„æ˜¯ç¦ç”¨çš„æŒ‰é’® */</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    event</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">preventDefault</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é˜»æ­¢é»˜è®¤è¡Œä¸º</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Button clicked!</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">clickEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emitClick</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è§¦å‘ç‚¹å‡»äº‹ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ£€æŸ¥æ˜¯å¦æœ‰é»˜è®¤è¡Œä¸ºè¢«é˜»æ­¢</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">clickEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">defaultPrevented</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">The default action was prevented.</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">No default action was prevented.</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>ClickEventEmitter</code> ç±»ï¼Œå®ƒç»§æ‰¿è‡ª Node.js çš„ <code>EventEmitter</code>ã€‚æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª <code>defaultPrevented</code> å±æ€§å’Œä¸€ä¸ª <code>emitClick</code> æ–¹æ³•æ¥è§¦å‘ä¸€ä¸ª <code>&#39;click&#39;</code> äº‹ä»¶ã€‚ç›‘å¬å™¨å‡½æ•°é€šè¿‡åˆ¤æ–­ä¸€å®šçš„æ¡ä»¶æ¥å†³å®šæ˜¯å¦è°ƒç”¨ <code>preventDefault</code> æ–¹æ³•æ¥é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä½¿ç”¨ Node.js å®ç°ç±»ä¼¼äºæµè§ˆå™¨ä¸­ <code>event.defaultPrevented</code> åŠŸèƒ½çš„ç®€å•ç¤ºä¾‹ã€‚åœ¨å®é™…çš„ Node.js å¼€å‘ä¸­ï¼Œå¤§å¤šæ•°äº‹ä»¶å¤„ç†éƒ½æ›´åŠ ç›´æ¥ï¼Œæ²¡æœ‰é˜»æ­¢é»˜è®¤è¡Œä¸ºè¿™ä¸€è¯´æ³•ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸ä¸æ¶‰åŠç”¨æˆ·ç•Œé¢äº¤äº’ã€‚è€Œæ˜¯å¤„ç†å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰åç«¯æ“ä½œã€‚</p><h4 id="event-eventphase" tabindex="-1"><a class="header-anchor" href="#event-eventphase"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventeventphase" target="_blank" rel="noopener noreferrer">event.eventPhase</a></span></a></h4><p><code>event.eventPhase</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ‰€å±çš„æ˜¯ <code>Event</code> ç±»ã€‚è¿™ä¸ªå±æ€§æœ‰åŠ©äºä½ äº†è§£äº‹ä»¶å¤„ç†è¿‡ç¨‹ä¸­äº‹ä»¶ç›®å‰çš„é˜¶æ®µã€‚åœ¨ DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰äº‹ä»¶æµä¸­ï¼Œäº‹ä»¶æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li>æ•è·é˜¶æ®µï¼ˆCapturing Phaseï¼‰ï¼šä»å¤–å±‚å…ƒç´ å¼€å§‹ï¼Œå‘å†…é€å±‚ä¼ æ’­è‡³è§¦å‘äº‹ä»¶çš„æœ€æ·±å±‚å…ƒç´ ã€‚</li><li>ç›®æ ‡é˜¶æ®µï¼ˆTarget Phaseï¼‰ï¼šåˆ°è¾¾æœ€æ·±å±‚æ¬¡çš„äº‹ä»¶ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ ã€‚</li><li>å†’æ³¡é˜¶æ®µï¼ˆBubbling Phaseï¼‰ï¼šä»äº‹ä»¶ç›®æ ‡å¼€å§‹ï¼Œé€†å‘å‘ä¸Šå†’æ³¡ï¼Œç›´åˆ°æœ€å¤–å±‚å…ƒç´ ã€‚</li></ol><p>åœ¨ Node.js çš„äº‹ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬æ¥è¯´åªæ¶‰åŠå•ä¸€å¯¹è±¡ï¼Œè€Œä¸åƒæµè§ˆå™¨ä¸­æ¶‰åŠå¾ˆå¤šåµŒå¥—çš„ DOM å…ƒç´ ï¼Œå› æ­¤ <code>event.eventPhase</code> å±æ€§é€šå¸¸ç”¨å¤„ä¸å¤§ï¼Œä¸”å…¶å€¼é€šå¸¸ä¸º <code>0</code>ã€‚è¿™æ„å‘³ç€ Node.js ä¸­çš„äº‹ä»¶å¹¶ä¸æ˜ç¡®åŒºåˆ†æ•è·å’Œå†’æ³¡é˜¶æ®µï¼Œäº‹ä»¶å¤„ç†æ›´åŠ ç®€å•ç›´æ¥ã€‚</p><p>å°½ç®¡åœ¨ Node.js ä¸­ <code>event.eventPhase</code> ä¸æ˜¯éå¸¸æœ‰ç”¨ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ªå‡æƒ³çš„ä¾‹å­æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‰é’®å…ƒç´ ï¼ˆbuttonï¼‰ï¼Œå½“ç‚¹å‡»æ—¶ä¼šè§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">var</span><span style="color:#D8DEE9;"> button</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getElementById</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myButton</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»™æŒ‰é’®æ·»åŠ ä¸€ä¸ªæ•è·é˜¶æ®µçš„äº‹ä»¶ç›‘å¬</span></span>
<span class="line"><span style="color:#D8DEE9;">button</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">  function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">eventPhase</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">CAPTURING_PHASE</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ•è·é˜¶æ®µ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ³¨æ„è¿™é‡Œçš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºåœ¨æ•è·é˜¶æ®µè°ƒç”¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»™æŒ‰é’®æ·»åŠ ä¸€ä¸ªå†’æ³¡é˜¶æ®µçš„äº‹ä»¶ç›‘å¬</span></span>
<span class="line"><span style="color:#D8DEE9;">button</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">  function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">eventPhase</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">BUBBLING_PHASE</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å†’æ³¡é˜¶æ®µ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#81A1C1;">  false</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™é‡Œçš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º false æˆ–è€…ä¸è®¾ç½®ï¼Œé»˜è®¤åœ¨å†’æ³¡é˜¶æ®µè°ƒç”¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œé¦–å…ˆä¼šæ‰§è¡Œæ•è·é˜¶æ®µçš„ç›‘å¬å‡½æ•°æ‰“å° &quot;æ•è·é˜¶æ®µ&quot;ï¼Œ</span></span>
<span class="line"><span style="color:#616E88;">// éšååˆ°è¾¾äº‹ä»¶ç›®æ ‡ï¼Œå¦‚æœç›®æ ‡ä¸Šä¹Ÿæœ‰äº‹ä»¶ç›‘å¬ï¼Œé‚£ä¹ˆæ­¤æ—¶event.eventPhase === Event.AT_TARGETï¼Œ</span></span>
<span class="line"><span style="color:#616E88;">// æœ€åæ˜¯å†’æ³¡é˜¶æ®µï¼Œå°†æ‰§è¡Œå†’æ³¡é˜¶æ®µçš„ç›‘å¬å‡½æ•°æ‰“å° &quot;å†’æ³¡é˜¶æ®µ&quot;ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è™½ç„¶ä¸Šé¢çš„ä¾‹å­æ˜¯é’ˆå¯¹æµè§ˆå™¨ç¯å¢ƒçš„ï¼Œä½†å®ƒæœ‰åŠ©äºä½ ç†è§£ <code>event.eventPhase</code> è¿™ä¸ªå±æ€§ã€‚ç„¶è€Œï¼Œåœ¨ Node.js ä¸­ï¼Œä½ å‡ ä¹ç”¨ä¸åˆ°è¿™ä¸ªå±æ€§ï¼Œå› ä¸º Node.js çš„ <code>events</code> æ¨¡å—å¤„ç†çš„éƒ½æ˜¯è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¸æ¶‰åŠåƒ DOM é‚£æ ·å¤æ‚çš„äº‹ä»¶ä¼ æ’­æœºåˆ¶ã€‚åœ¨ Node.js ä¸­åˆ›å»ºå’Œè§¦å‘äº‹ä»¶é€šå¸¸æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¼•å…¥ events æ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆ›å»º EventEmitter å®ä¾‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">an event occurred!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ª Node.js çš„ä¾‹å­ä¸­ï¼Œå½“äº‹ä»¶ &#39;event&#39; è¢«è§¦å‘æ—¶ï¼Œç›‘å¬å‡½æ•°è¢«è°ƒç”¨ï¼Œæ‰“å°å‡º &#39;an event occurred!&#39;ã€‚è¿™é‡Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒ <code>event.eventPhase</code>ï¼Œå› ä¸ºäº‹ä»¶ç›´æ¥åœ¨ <code>myEmitter</code> ä¸Šè§¦å‘å’Œç›‘å¬ï¼Œæ²¡æœ‰æ•è·æˆ–å†’æ³¡è¿‡ç¨‹ã€‚</p><h4 id="event-initevent-type-bubbles-cancelable" tabindex="-1"><a class="header-anchor" href="#event-initevent-type-bubbles-cancelable"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventiniteventtype-bubbles-cancelable" target="_blank" rel="noopener noreferrer">event.initEvent(type[, bubbles[, cancelable]])</a></span></a></h4><p>ç†è§£<code>event.initEvent(type[, bubbles[, cancelable]])</code>åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ä¸€äº›åŸºç¡€ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>events</code>æ¨¡å—å…è®¸æˆ‘ä»¬åˆ›å»ºã€è§¦å‘å’Œç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ã€‚è¿™å¯¹äºæ„å»ºå¤æ‚çš„ã€äº¤äº’å¼çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç»„ç»‡å’Œå¤„ç†å¼‚æ­¥ä»£ç ä»¥åŠä¸åŒç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>ç„¶è€Œï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œæˆªè‡³æˆ‘æœ€åæ›´æ–°çš„çŸ¥è¯†ï¼ˆ2023 å¹´ï¼‰ï¼Œ<code>event.initEvent()</code>æ–¹æ³•å®é™…ä¸Šå¹¶ä¸å­˜åœ¨äº Node.js çš„<code>events</code>æ¨¡å—ä¸­ã€‚è¿™ä¸ªæ–¹æ³•æ¥æºäº Web APIsï¼Œç‰¹åˆ«æ˜¯ç”¨äºæµè§ˆå™¨ç¯å¢ƒä¸­çš„<code>Event</code>æ¥å£ï¼Œå®ƒç”¨äºåˆå§‹åŒ–åœ¨åˆ›å»ºä¹‹åçš„æŸä¸ªæ—¶é—´ç‚¹è¢«æ‰‹åŠ¨è§¦å‘çš„äº‹ä»¶å¯¹è±¡ã€‚å°½ç®¡è¿™æ ·ï¼Œä¸ºäº†å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ç±»ä¼¼æ¦‚å¿µï¼Œåœ¨ Node.js ä¸­å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä¼šä» Node.js çš„è§’åº¦æ¥è§£é‡Šäº‹ä»¶çš„åˆ›å»ºå’Œè§¦å‘ï¼ŒåŒæ—¶ä¹Ÿæ¶‰åŠåˆ°ç±»ä¼¼<code>initEvent</code>çš„æ¦‚å¿µã€‚</p><h3 id="äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨"><span>äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>events</code>æ¨¡å—çš„<code>EventEmitter</code>æ¥å¤„ç†äº‹ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª eventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªäº‹ä»¶åŠå…¶å“åº”è¡Œä¸º</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">an event occurred!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨<code>initEvent</code>ï¼Œä½†æˆ‘ä»¬é€šè¿‡<code>emit</code>æ–¹æ³• &quot;åˆå§‹åŒ–&quot; å¹¶è§¦å‘äº†ä¸€ä¸ªäº‹ä»¶ã€‚<code>on</code>æ–¹æ³•ç”¨äºå®šä¹‰å½“æŒ‡å®šäº‹ä»¶è¢«è§¦å‘æ—¶åº”è¯¥æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>æ–‡ä»¶è¯»å–å®Œæˆé€šçŸ¥</strong>ï¼šå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦åœ¨è¯»å–æ–‡ä»¶å®Œæˆåè¿›è¡Œä¸€äº›æ“ä½œã€‚ä½ å¯ä»¥åœ¨è¯»å–å®Œæ–‡ä»¶åè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æ–‡ä»¶è¯»å–å®Œæˆæ—¶ï¼Œè§¦å‘&#39;fileRead&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fileRead</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">filename</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">filename</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> has been read</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æ–‡ä»¶è¯»å–å®Œæˆï¼Œè§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fileRead</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æœåŠ¡å™¨è¯·æ±‚å¤„ç†</strong>ï¼šåœ¨ä¸€ä¸ª Node.js web æœåŠ¡å™¨ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†ç‰¹å®šç±»å‹çš„è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰å¯¹&#39;login&#39;è¯·æ±‚çš„å“åº”</span></span>
<span class="line"><span style="color:#D8DEE9;">requestEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">login</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">User logged in</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/login</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // è§¦å‘&#39;login&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">    requestEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">login</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Login successful</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä»¥ä¸Šç¤ºä¾‹å±•ç°äº†å¦‚ä½•åœ¨ Node.js ä¸­ç”¨<code>EventEmitter</code>åˆ›å»ºå’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè™½ç„¶å®ƒä¸<code>initEvent</code>çš„æ¦‚å¿µä¸å®Œå…¨ç›¸åŒï¼Œä½†è¿™æ˜¯åœ¨ Node.js ç¯å¢ƒä¸‹å¤„ç†äº‹ä»¶çš„æ­£ç¡®æ–¹å¼ã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£ Node.js ä¸­çš„äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚</p><h4 id="event-istrusted" tabindex="-1"><a class="header-anchor" href="#event-istrusted"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventistrusted" target="_blank" rel="noopener noreferrer">event.isTrusted</a></span></a></h4><p>Node.js ä¸­çš„ <code>event.isTrusted</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒé€šå¸¸ç”¨äºæµè§ˆå™¨ç¯å¢ƒä¸­çš„äº‹ä»¶å¯¹è±¡ï¼ˆEventï¼‰æ¥è¡¨æ˜æŸä¸ªäº‹ä»¶æ˜¯å¦æ˜¯ç”±ç”¨æˆ·çš„å®é™…æ“ä½œæ‰€äº§ç”Ÿçš„ã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶æ˜¯ç”±ç”¨æˆ·è¡Œä¸ºï¼ˆä¾‹å¦‚é¼ æ ‡ç‚¹å‡»ã€é”®ç›˜è¾“å…¥ç­‰ï¼‰ç›´æ¥è§¦å‘çš„ï¼Œåˆ™ <code>isTrusted</code> å±æ€§ä¸º <code>true</code>ï¼›ç›¸åï¼Œå¦‚æœäº‹ä»¶æ˜¯ç”±è„šæœ¬ä»£ç ç¨‹åºåŒ–ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆ <code>isTrusted</code> å°†ä¸º <code>false</code>ã€‚</p><p>ç„¶è€Œï¼Œä½ æåˆ°çš„ Node.js v21.7.1 æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒé€šå¸¸ä¸ä¼šå¤„ç†ç”¨æˆ·çš„ç›´æ¥äº¤äº’ï¼Œè¿™æ„å‘³ç€å®ƒå¹¶ä¸åƒæµè§ˆå™¨ä¸­é‚£æ ·æœ‰åŸç”Ÿçš„ Event å¯¹è±¡å’Œäº¤äº’äº‹ä»¶ã€‚</p><p>åœ¨ Node.js çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æä¾› <code>event.isTrusted</code> å±æ€§ï¼Œå› ä¸º Node.js çš„äº‹ä»¶ç³»ç»Ÿä¸»è¦é€šè¿‡ <code>EventEmitter</code> ç±»æ¥å®ç°ï¼Œå®ƒä¸æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¯¹è±¡ä¸åŒã€‚<code>EventEmitter</code> ç”¨äºå®ç°å¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œå…è®¸å¯¹è±¡å‘å¸ƒï¼ˆemitï¼‰å¸¦æœ‰åç§°çš„äº‹ä»¶ï¼Œå…¶ä»–å¯¹è±¡å¯ä»¥ç›‘å¬ï¼ˆlisten toï¼‰è¿™äº›äº‹ä»¶ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ Node.js ä¸­çš„ <code>EventEmitter</code> å¦‚ä½•å·¥ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼ˆlistenerï¼‰æ¥å¤„ç†åä¸º &#39;message&#39; çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received message:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;message&#39; äº‹ä»¶ï¼Œå¹¶ä¼ é€’æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºäº‹ä»¶å‘å°„å™¨ï¼ˆemitterï¼‰ã€æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ä»¥åŠè§¦å‘äº‹ä»¶ã€‚å½“æˆ‘ä»¬è°ƒç”¨ <code>myEmitter.emit(&#39;message&#39;, &#39;Hello, World!&#39;);</code> æ—¶ï¼Œæ³¨å†Œåœ¨ <code>message</code> äº‹ä»¶ä¸Šçš„ç›‘å¬å™¨å°†è¢«æ¿€æ´»ï¼Œå¹¶è¾“å‡ºä¿¡æ¯ &quot;Received message: Hello, World!&quot;ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> ç»å¸¸è¢«ç”¨äºå„ç§æ¨¡å—å’Œç³»ç»Ÿï¼Œæ¯”å¦‚å¤„ç† HTTP æœåŠ¡å™¨çš„è¯·æ±‚å“åº”ã€æµï¼ˆStreamsï¼‰çš„æ•°æ®è¯»å†™ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Node.js åˆ›å»ºç®€å• HTTP æœåŠ¡å™¨çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º HTTP æœåŠ¡å™¨å¹¶ç›‘å¬ &#39;request&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒHTTP æœåŠ¡å™¨å¯¹è±¡ <code>server</code> ç»§æ‰¿è‡ª <code>EventEmitter</code>ï¼Œæˆ‘ä»¬ç›‘å¬äº† <code>request</code> äº‹ä»¶ï¼Œæ¯å½“æœ‰æ–°çš„ HTTP è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå°±ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œè™½ç„¶ Node.js æ²¡æœ‰ <code>event.isTrusted</code> å±æ€§ï¼Œä½† Node.js ä¸­çš„ <code>EventEmitter</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¨¡å‹ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨åº”ç”¨ç¨‹åºä¸­è½»æ¾åœ°å¤„ç†å„ç§å¼‚æ­¥äº‹ä»¶ã€‚</p><h4 id="event-preventdefault" tabindex="-1"><a class="header-anchor" href="#event-preventdefault"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventpreventdefault" target="_blank" rel="noopener noreferrer">event.preventDefault()</a></span></a></h4><p><code>event.preventDefault()</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js çš„äº‹ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯å½“ä½ åœ¨ä½¿ç”¨ <code>EventTarget</code> æ¥å£æ—¶ä¼šé‡åˆ°å®ƒã€‚Node.js ä» v15.4.0 å¼€å§‹æ”¯æŒäº†éƒ¨åˆ† <code>EventTarget</code> æ¥å£åŠŸèƒ½ï¼ˆé€šå¸¸åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼‰ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ä¹‹ç›¸å…³çš„ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œ<code>event.preventDefault()</code> è¢«ç”¨äºå–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå½“ä½ ç‚¹å‡»ä¸€ä¸ªé“¾æ¥æ—¶ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯è·³è½¬åˆ°é“¾æ¥æŒ‡å®šçš„ URLã€‚å¦‚æœä½ ä¸å¸Œæœ›é“¾æ¥è·³è½¬å‘ç”Ÿï¼Œå¯ä»¥åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ <code>event.preventDefault()</code> æ–¹æ³•æ¥å–æ¶ˆè¿™ä¸€é»˜è®¤è¡Œä¸ºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>event.preventDefault()</code> ä¹Ÿæœ‰ç±»ä¼¼çš„ä½œç”¨ï¼Œä½†å®ƒç”¨åœ¨è‡ªå®šä¹‰çš„äº‹ä»¶ä¸­ï¼Œä»¥æŒ‡ç¤ºæŸä¸ªäº‹ä»¶æ˜¯å¦åº”è¯¥æ‰§è¡Œå®ƒçš„â€œé»˜è®¤è¡Œä¸ºâ€ã€‚åœ¨ Node.js ä¸­å®šä¹‰â€œé»˜è®¤è¡Œä¸ºâ€çš„æ¦‚å¿µæ˜¯æ¯”è¾ƒæŠ½è±¡çš„ï¼Œå› ä¸ºå®ƒå–å†³äºä½ å¦‚ä½•è®¾è®¡ä½ çš„äº‹ä»¶ç³»ç»Ÿã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå¦‚æœä½ åœ¨æ´¾å‘äº‹ä»¶æ—¶è®¾ç½®äº† <code>{ cancelable: true }</code> é€‰é¡¹ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªäº‹ä»¶æ˜¯å¯ä»¥è¢«å–æ¶ˆçš„ã€‚ç„¶åï¼Œå¦‚æœä½ åœ¨äº‹ä»¶ç›‘å¬å™¨ä¸­è°ƒç”¨äº† <code>event.preventDefault()</code>ï¼Œå¹¶ä¸”æ£€æŸ¥äº†äº‹ä»¶çš„ <code>defaultPrevented</code> å±æ€§ï¼Œä½ å°±å¯ä»¥æ ¹æ®è¿™ä¸ªå€¼æ¥å†³å®šæ˜¯å¦è¦ç»§ç»­æ‰§è¡ŒæŸäº›åŠ¨ä½œã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventTarget å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> et</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">et</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cancelable</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸º</span></span>
<span class="line"><span style="color:#D8DEE9;">    event</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">preventDefault</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ´¾å‘ä¸€ä¸ªå¯å–æ¶ˆçš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> evt</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> cancelable</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">et</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">evt</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ£€æŸ¥äº‹ä»¶æ˜¯å¦è¢«å–æ¶ˆäº†é»˜è®¤è¡Œä¸º</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">evt</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">defaultPrevented</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">é»˜è®¤è¡Œä¸ºè¢«å–æ¶ˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">é»˜è®¤è¡Œä¸ºæœªè¢«å–æ¶ˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¾“å‡ºï¼šé»˜è®¤è¡Œä¸ºè¢«å–æ¶ˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>events</code> æ¨¡å—ä¸­çš„ <code>EventTarget</code> å’Œ <code>Event</code> ç±»ã€‚æ¥ç€æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>EventTarget</code> å®ä¾‹ï¼Œå¹¶ç»™å®ƒæ·»åŠ äº†ä¸€ä¸ªåä¸º <code>&#39;my-event&#39;</code> çš„äº‹ä»¶ç›‘å¬å™¨ã€‚åœ¨è¿™ä¸ªç›‘å¬å™¨é‡Œï¼Œå¦‚æœäº‹ä»¶å¯¹è±¡å…·æœ‰ <code>cancelable</code> å±æ€§å¹¶è¢«è®¾ç½®ä¸º <code>true</code>ï¼Œåˆ™è°ƒç”¨ <code>event.preventDefault()</code> æ¥å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºã€‚</p><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>Event</code> å®ä¾‹å¹¶å°†å…¶æ´¾å‘æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥ <code>defaultPrevented</code> å±æ€§æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸå–æ¶ˆäº†é»˜è®¤è¡Œä¸ºï¼Œå¹¶ç›¸åº”åœ°è¾“å‡ºä¿¡æ¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Node.js è‡ªå®šä¹‰äº‹ä»¶ç³»ç»Ÿä¸­ï¼Œâ€œé»˜è®¤è¡Œä¸ºâ€æ˜¯ä¸€ä¸ªç”±å¼€å‘è€…è§£é‡Šå’Œå®ç°çš„æ¦‚å¿µï¼Œæ‰€ä»¥å®ƒå¯èƒ½ä¸åƒåœ¨æµè§ˆå™¨ä¸­é‚£ä¹ˆç›´è§‚ã€‚é€šå¸¸ï¼Œå®ƒæ¶‰åŠåˆ°åœ¨äº‹ä»¶å¤„ç†æµç¨‹ä¸­åšå‡ºå†³ç­–ï¼Œå³æ˜¯å¦æ‰§è¡Œä¸€äº›ä»£ç æˆ–è€…è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œè¿™å®Œå…¨å–å†³äºä½ çš„åº”ç”¨é€»è¾‘ã€‚</p><h4 id="event-returnvalue" tabindex="-1"><a class="header-anchor" href="#event-returnvalue"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventreturnvalue" target="_blank" rel="noopener noreferrer">event.returnValue</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€ä¸‹ Node.js ä¸­çš„ <code>event.returnValue</code>ã€‚</p><p>åœ¨ Node.js çš„äº‹ä»¶å¤„ç†ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä½ ä¼šé‡åˆ°ä¸€ç§æ¨¡å¼ï¼Œé‚£å°±æ˜¯ç›‘å¬å’Œè§¦å‘äº‹ä»¶ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼ˆä¹Ÿå°±æ˜¯äº‹ä»¶çš„å¤„ç†å‡½æ•°ï¼‰æ˜¯å¦é˜»æ­¢äº†äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºã€‚è¿™åœ¨æµè§ˆå™¨çš„äº‹ä»¶å¤„ç†ä¸­æ˜¯å¾ˆå¸¸è§çš„ï¼Œæ¯”å¦‚ï¼Œå½“ä½ ç‚¹å‡»ä¸€ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯è·³è½¬åˆ°è¯¥é“¾æ¥æŒ‡å‘çš„åœ°å€ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡äº‹ä»¶ç›‘å¬å™¨æ¥é˜»æ­¢è¿™ä¸€é»˜è®¤è¡Œä¸ºã€‚</p><p>åœ¨ Node.js çš„ <code>EventEmitter</code> ç±»ä¸­ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œäº‹ä»¶ç›‘å¬å™¨æ˜¯ä¸å¤„ç†é»˜è®¤è¡Œä¸ºçš„ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºè‡ªå®šä¹‰äº‹ä»¶çš„å¤„ç†ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ŒNode.js å…è®¸ä½¿ç”¨ <code>event.returnValue</code> æ¥è¡¨ç¤ºäº‹ä»¶ç›‘å¬å™¨æ˜¯å¦æƒ³è¦é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚è¿™å¹¶ä¸å¸¸è§ï¼Œè€Œä¸”åªé€‚ç”¨äºä¸€äº›ç‰¹å®šçš„å†…å»ºäº‹ä»¶ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js å†…å»ºçš„ <code>EventEmitter</code> æ¥å¤„ç†ä¸€äº›è‡ªå®šä¹‰äº‹ä»¶ã€‚é€šå¸¸ä½ ä¼šè¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> emitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ &#39;doSomething&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">doSomething</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">doSomething event triggered!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶ &#39;doSomething&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">doSomething</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠ <code>event.returnValue</code>ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯ç®€å•åœ°è§¦å‘å’Œç›‘å¬ä¸€ä¸ªäº‹ä»¶ã€‚</p><p>ä½†å‡è®¾å­˜åœ¨ä¸€ä¸ª fictitiousï¼ˆè™šæ„çš„ï¼‰çš„ Node.js æ ¸å¿ƒæ¨¡å—äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å…è®¸ä½ é€šè¿‡è®¾ç½® <code>event.returnValue</code> æ¥é˜»æ­¢ä¸€ä¸ªé»˜è®¤è¡Œä¸ºã€‚ä»£ç å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> specialEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> getSomeSpecialEventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾è¿™æ˜¯ä¸€ä¸ªæä¾›ç‰¹æ®Šäº‹ä»¶çš„æ ¸å¿ƒæ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">specialEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">specialEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">someCondition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæ»¡è¶³æŸäº›æ¡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦é˜»æ­¢é»˜è®¤è¡Œä¸º</span></span>
<span class="line"><span style="color:#D8DEE9;">    event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">returnValue</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">specialEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">specialEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªå‡è®¾çš„ä¾‹å­ä¸­ï¼Œå¦‚æœ <code>someCondition</code> ä¸ºçœŸï¼Œæˆ‘ä»¬è®¾ç½®äº† <code>event.returnValue = false;</code>ï¼Œæ„æ€æ˜¯æˆ‘ä»¬å¸Œæœ›é˜»æ­¢é»˜è®¤è¡Œä¸ºçš„å‘ç”Ÿã€‚è¿™ç±»ä¼¼äºåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­è°ƒç”¨ <code>event.preventDefault()</code>ã€‚</p><p>ç„¶è€Œï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Node.js çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰ <code>event.returnValue</code> è¿™ä¸ªå±æ€§ã€‚è¿™ä¸ªæ¦‚å¿µæ¥æºäºæµè§ˆå™¨ç¯å¢ƒä¸­çš„äº‹ä»¶å¤„ç†ã€‚åœ¨ Node.js çš„ <code>EventEmitter</code> ä¸­ï¼Œå¹¶æ²¡æœ‰é»˜è®¤çš„æ“ä½œå¯ä»¥è¢«å–æ¶ˆï¼Œå› æ­¤è¿™ä¸ªå±æ€§åœ¨ Node.js ä¸­æ˜¯ä¸å­˜åœ¨çš„ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œä½œä¸ºç¼–ç¨‹æ–°æ‰‹ï¼Œä½ åº”è¯¥çŸ¥é“ Node.js ä¸­çš„äº‹ä»¶ç›‘å¬é€šå¸¸æ²¡æœ‰ &quot;é»˜è®¤è¡Œä¸º&quot; å¯ä»¥è¢«å–æ¶ˆï¼Œæ‰€ä»¥åœ¨å¤§å¤šæ•°åœºæ™¯ä¸­ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒ <code>event.returnValue</code>ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç«¯ JavaScript ä¸­æ›´å¸¸è§çš„æ¦‚å¿µè€Œä¸æ˜¯åœ¨ Node.js ä¸­ã€‚å¦‚æœä½ åœ¨ Node.js çš„æŸäº›æ–‡æ¡£æˆ–ç¬¬ä¸‰æ–¹åº“ä¸­é‡åˆ°äº† <code>event.returnValue</code>ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯é‚£ä¸ªç‰¹å®šä¸Šä¸‹æ–‡æˆ–åº“å®šä¹‰çš„ç‰¹æ€§ï¼Œè€Œä¸æ˜¯ Node.js æ ¸å¿ƒ API çš„ä¸€éƒ¨åˆ†ã€‚</p><h4 id="event-srcelement" tabindex="-1"><a class="header-anchor" href="#event-srcelement"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventsrcelement" target="_blank" rel="noopener noreferrer">event.srcElement</a></span></a></h4><p><code>event.srcElement</code> å±æ€§æ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨çš„äº‹ä»¶å¤„ç†ä¸­å¸¸è§çš„å±æ€§ï¼Œä½†ä½ åœ¨ Node.js å®˜æ–¹æ–‡æ¡£é‡Œé¢çœ‹åˆ°çš„å¯èƒ½æ˜¯ä¸€ç§è¯¯è§£æˆ–è€…æ··æ·†ã€‚Node.js æ˜¯ä¸€ä¸ªæœåŠ¡ç«¯çš„ JavaScript ç¯å¢ƒï¼Œè€Œ <code>event.srcElement</code> é€šå¸¸å‡ºç°äºå‰ç«¯ JavaScript çš„äº‹ä»¶å¯¹è±¡ä¸­ï¼Œä¸»è¦ç”¨äºè·å–è§¦å‘äº‹ä»¶çš„å…ƒç´ ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¤„ç†çš„æ˜¯æœåŠ¡å™¨ç«¯çš„äº‹ä»¶ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å–å®Œæˆã€ç½‘ç»œè¯·æ±‚æ”¶åˆ°å“åº”ç­‰ï¼Œå¹¶ä¸ç›´æ¥å¤„ç† DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ç›¸å…³çš„äº‹ä»¶ï¼Œå› ä¸ºè¿™äº›æ˜¯åœ¨æµè§ˆå™¨ç«¯å‘ç”Ÿçš„ã€‚Node.js çš„ <code>events</code> æ¨¡å—å…è®¸æˆ‘ä»¬åœ¨ä»£ç ä¸­åˆ›å»ºå’Œç®¡ç†è‡ªå·±çš„äº‹ä»¶ï¼Œè¿™ä¸æµè§ˆå™¨ä¸­çš„äº‹ä»¶æœ‰æ‰€ä¸åŒã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>events</code> æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ª Event Emitterï¼ˆäº‹ä»¶å‘å°„å™¨ï¼‰ï¼Œç„¶åç›‘å¬å’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨æ¥å¤„ç†åä¸º &#39;log&#39; çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">log</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æ—¥å¿—:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;log&#39; äº‹ä»¶ï¼Œå¹¶ä¼ é€’æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">log</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">è¿™æ˜¯ç¬¬ä¸€æ¡æ—¥å¿—ä¿¡æ¯ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼š</p><ul><li>æˆ‘ä»¬å¯¼å…¥äº† <code>events</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>EventEmitter</code> å®ä¾‹ã€‚</li><li>ä½¿ç”¨ <code>on</code> æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒä¼šåœ¨åä¸º <code>log</code> çš„äº‹ä»¶è¢«å‘å°„æ—¶æ‰§è¡Œã€‚</li><li>ä½¿ç”¨ <code>emit</code> æ–¹æ³•å‘å°„äº† <code>log</code> äº‹ä»¶ï¼Œå¹¶ä¼ é€’äº†ä¸€æ¡æ¶ˆæ¯ä½œä¸ºå‚æ•°ã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°äº‹ä»¶çš„ç›‘å¬å’Œå‘å°„ï¼Œä½†å¹¶æ²¡æœ‰æ¶‰åŠç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„ <code>srcElement</code> å±æ€§ï¼Œå› ä¸ºè¿™åœ¨æœåŠ¡ç«¯çš„äº‹ä»¶æ¨¡å‹ä¸­æ˜¯ä¸é€‚ç”¨çš„ã€‚</p><p>å¦‚æœä½ åœ¨ Node.js æ–‡æ¡£ä¸­çœ‹åˆ°æåˆ°äº† <code>event.srcElement</code>ï¼Œé‚£ä¹ˆæœ€å¯èƒ½çš„æƒ…å†µæ˜¯æŒ‡çš„æ˜¯æŸç§ç‰¹æ®Šåœºæ™¯ä¸‹çš„å±æ€§ï¼Œæˆ–è€…æ˜¯æ–‡æ¡£ä¸­çš„é”™è¯¯ã€‚åœ¨æ ‡å‡† Node.js åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ä¸­ï¼Œ<code>event.srcElement</code> å¹¶ä¸æ˜¯ä¸€ä¸ªå­˜åœ¨çš„å±æ€§ã€‚å¦‚æœéœ€è¦å¤„ç†ç‰¹å®šçš„å®ä¾‹ç›¸å…³äº‹ä»¶ï¼Œé€šå¸¸éƒ½æ˜¯é€šè¿‡ç»‘å®šåˆ°é‚£ä¸ªå®ä¾‹ä¸Šçš„æ–¹æ³•æ¥è¿›è¡Œï¼Œè€Œä¸æ˜¯é€šè¿‡ç±»ä¼¼ <code>srcElement</code> è¿™æ ·çš„å±æ€§ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>event.srcElement</code> ä¸»è¦æ˜¯æµè§ˆå™¨ç¯å¢ƒä¸­çš„æ¦‚å¿µï¼Œè€Œé Node.js ä¸­çš„æ¦‚å¿µã€‚åœ¨æœåŠ¡å™¨ç«¯ç¼–ç¨‹ä¸­ï¼Œä½ ä¼šä½¿ç”¨ Node.js æä¾›çš„äº‹ä»¶ç³»ç»Ÿæ¥å¤„ç†äº‹ä»¶ï¼Œä½†ä¸ä¼šç”¨åˆ° <code>srcElement</code> è¿™æ ·çš„å±æ€§ã€‚</p><h4 id="event-stopimmediatepropagation" tabindex="-1"><a class="header-anchor" href="#event-stopimmediatepropagation"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventstopimmediatepropagation" target="_blank" rel="noopener noreferrer">event.stopImmediatePropagation()</a></span></a></h4><p>Node.js ä¸­çš„ <code>event.stopImmediatePropagation()</code> æ–¹æ³•ç”¨äºé˜»æ­¢ä¸€ä¸ªäº‹ä»¶è¢«è¿›ä¸€æ­¥ä¼ æ’­åˆ°å…¶ä»–çš„äº‹ä»¶ç›‘å¬å™¨ã€‚åœ¨ Node.js é‡Œï¼Œè¿™é€šå¸¸ä¸ EventEmitter å¯¹è±¡ç›¸å…³ã€‚</p><p>EventEmitter æ˜¯ Node.js çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒç”¨æ¥å¤„ç†äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¹¿æ’­ç«™ï¼šå½“æŸä¸ªç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½å®Œæˆï¼‰ï¼Œå®ƒä¼šå‘æ‰€æœ‰è®¢é˜…äº†è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å™¨å‘é€ä¸€ä¸ªä¿¡å·ã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾æœ‰å¤šä¸ªç›‘å¬å™¨è®¢é˜…äº†åŒä¸€ä¸ªäº‹ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“è¿™ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ‰€æœ‰çš„ç›‘å¬å™¨éƒ½ä¼šæŒ‰ç…§å®ƒä»¬æ·»åŠ çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨æŸä¸ªç›‘å¬å™¨ä¸­è°ƒç”¨äº† <code>event.stopImmediatePropagation()</code>ï¼Œé‚£ä¹ˆä½äºè¿™ä¸ªç›‘å¬å™¨ä¹‹åçš„æ‰€æœ‰å…¶ä»–ç›‘å¬å™¨å°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œå³ä½¿å®ƒä»¬ä¹Ÿè®¢é˜…äº†åŒä¸€ä¸ªäº‹ä»¶ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸ªæ¦‚å¿µï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> emitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¬¬ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬ä¸€ä¸ªç›‘å¬å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è°ƒç”¨ stopImmediatePropagation å°†é˜»æ­¢åç»­ç›‘å¬å™¨è¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  event</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stopImmediatePropagation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¬¬äºŒä¸ªäº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™ä¸ªç›‘å¬å™¨å°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºå‰ä¸€ä¸ªç›‘å¬å™¨å·²ç»åœæ­¢äº†ä¼ æ’­</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬äºŒä¸ªç›‘å¬å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  stopImmediatePropagation</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">åœæ­¢ä¼ æ’­</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ§åˆ¶å°å°†åªè¾“å‡ºï¼š</span></span>
<span class="line"><span style="color:#616E88;">// ç¬¬ä¸€ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#616E88;">// åœæ­¢ä¼ æ’­</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>myEvent</code> çš„äº‹ä»¶ï¼Œå¹¶ä¸”æ³¨å†Œäº†ä¸¤ä¸ªç›‘å¬å™¨ã€‚å½“ <code>myEvent</code> äº‹ä»¶è¢«è§¦å‘æ—¶ï¼ˆé€šè¿‡ <code>emitter.emit</code> æ–¹æ³•ï¼‰ï¼Œç¬¬ä¸€ä¸ªç›‘å¬å™¨ä¼šæ‰“å°å‡ºæ¶ˆæ¯å¹¶è°ƒç”¨ <code>event.stopImmediatePropagation()</code> æ¥åœæ­¢äº‹ä»¶è¿›ä¸€æ­¥ä¼ æ’­ã€‚ç»“æœæ˜¯ï¼Œç¬¬äºŒä¸ªç›‘å¬å™¨ä¸ä¼šæ”¶åˆ°äº‹ä»¶é€šçŸ¥ï¼Œä¹Ÿå°±ä¸ä¼šæ‰§è¡Œã€‚</p><p>è¿™ä¸ªæ–¹æ³•çš„å®é™…åº”ç”¨åœºæ™¯å¯èƒ½åŒ…æ‹¬ï¼š</p><ol><li>å¤„ç†ä¼˜å…ˆçº§ï¼šåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ å¸Œæœ›ä¼˜å…ˆå¤„ç†æŸäº›ç›‘å¬å™¨çš„é€»è¾‘ï¼Œå¹¶åœ¨æ¡ä»¶æ»¡è¶³æ—¶é˜»æ­¢å…¶ä»–ç›‘å¬å™¨è¿è¡Œã€‚</li><li>é˜²æ­¢é‡å¤æ“ä½œï¼šå¦‚æœä½ æœ‰å¤šä¸ªç›‘å¬å™¨å¯èƒ½å¯¹åŒä¸€ä¸ªäº‹ä»¶è¿›è¡Œç›¸åŒçš„æ“ä½œï¼Œä½¿ç”¨ <code>stopImmediatePropagation</code> å¯ä»¥é¿å…ä¸å¿…è¦çš„é‡å¤è®¡ç®—æˆ–æ“ä½œã€‚</li><li>å®‰å…¨æ§åˆ¶ï¼šåœ¨å®‰å…¨ç›¸å…³çš„ç¨‹åºä¸­ï¼Œä½ å¯èƒ½éœ€è¦ç¡®ä¿åªæœ‰éªŒè¯é€šè¿‡çš„å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†äº‹ä»¶ï¼Œæ­¤æ—¶åœ¨éªŒè¯å¤±è´¥æ—¶è°ƒç”¨ <code>stopImmediatePropagation</code> å¯ä»¥é˜»æ­¢åç»­å¤„ç†å™¨çš„æ‰§è¡Œã€‚</li></ol><p>è®°ä½ï¼Œ<code>stopImmediatePropagation</code> åªå½±å“å½“å‰æ­£åœ¨å¤„ç†çš„äº‹ä»¶ï¼›å®ƒä¸ä¼šå½±å“åç»­ç›¸åŒäº‹ä»¶çš„å…¶ä»–å‘å°„ï¼ˆemitï¼‰ã€‚æ¯æ¬¡äº‹ä»¶è§¦å‘æ—¶ï¼Œæ‰€æœ‰çš„ç›‘å¬å™¨éƒ½ä¼šæœ‰æœºä¼šè¢«è°ƒç”¨ï¼Œé™¤éå…¶ä¸­ä¹‹ä¸€æ˜¾å¼åœ°è°ƒç”¨äº† <code>stopImmediatePropagation</code>ã€‚</p><h4 id="event-stoppropagation" tabindex="-1"><a class="header-anchor" href="#event-stoppropagation"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventstoppropagation" target="_blank" rel="noopener noreferrer">event.stopPropagation()</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>events</code> æ¨¡å—æ˜¯éå¸¸æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª <code>EventEmitter</code> ç±»ï¼Œè¿™ä¸ªç±»æ˜¯ç”¨æ¥å¤„ç†äº‹ä»¶å’Œè§¦å‘äº‹ä»¶çš„ã€‚</p><p>å½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª EventEmitter å®ä¾‹å¹¶äº§ç”Ÿï¼ˆå‘å°„ï¼‰äº‹ä»¶æ—¶ï¼Œå¯ä»¥ç»‘å®šä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ï¼ˆç›‘å¬å™¨ï¼‰åˆ°è¿™ä¸ªäº‹ä»¶ä¸Šã€‚ä¸€æ—¦è¿™ä¸ªäº‹ä»¶è¢«è§¦å‘ï¼Œæ‰€æœ‰ç»‘å®šçš„å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨éƒ½å“åº”æŸä¸ªäº‹ä»¶ï¼Œè€Œåªæ˜¯å¸Œæœ›ç‰¹å®šçš„å‡ ä¸ªç›‘å¬å™¨èƒ½å¤Ÿå“åº”ã€‚è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <code>event.stopPropagation()</code> æ–¹æ³•æ¥é˜»æ­¢äº‹ä»¶ç»§ç»­å‘å…¶ä»–ç›‘å¬å™¨ä¼ æ’­ã€‚</p><p><code>event.stopPropagation()</code> æ–¹æ³•æ˜¯åœ¨ &#39;events&#39; æ¨¡å—ä¸­ï¼Œé€šè¿‡ <code>Event</code> ç±»æš´éœ²çš„ã€‚åœ¨äº‹ä»¶ç›‘å¬å™¨å‡½æ•°å†…éƒ¨ï¼Œä½ å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥é˜»æ­¢äº‹ä»¶è¿›ä¸€æ­¥ä¼ æ’­åˆ°å…¶ä»–ç›‘å¬å™¨ã€‚</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ç¬¬ä¸€ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> firstListener</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from the first listener!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è°ƒç”¨ stopPropagation æ–¹æ³•æ¥é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ æ’­</span></span>
<span class="line"><span style="color:#81A1C1;">  this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stopPropagation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ç¬¬äºŒä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> secondListener</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”±äºå‰ä¸€ä¸ªç›‘å¬å™¨åœæ­¢äº†ä¼ æ’­ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä¼šæ‰§è¡Œ</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from the second listener!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»‘å®šä¸¤ä¸ªç›‘å¬å™¨åˆ° &#39;myEvent&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> firstListener</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> secondListener</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;myEvent&#39;ï¼Œå°†å¯¼è‡´ç›‘å¬å™¨è¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬è§¦å‘ &#39;myEvent&#39; äº‹ä»¶æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨ <code>firstListener</code> å¹¶æ‰“å° &quot;Hello from the first listener!&quot;ã€‚ç„¶å <code>firstListener</code> ä¼šè°ƒç”¨ <code>this.stopPropagation()</code> æ–¹æ³•æ¥é˜»æ­¢äº‹ä»¶ç»§ç»­å‘ä¸‹ä¼ æ’­ã€‚å› æ­¤ <code>secondListener</code> å°±ä¸ä¼šè¢«è°ƒç”¨ï¼Œä¹Ÿå°±ä¸ä¼šæ‰“å° &quot;Hello from the second listener!&quot;ã€‚</p><p>è¿™ä¸ªæœºåˆ¶åœ¨å®é™…çš„åº”ç”¨ç¨‹åºä¸­å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚åœ¨å¤„ç†åµŒå¥—ç»„ä»¶çš„äº‹ä»¶æ—¶ï¼Œä½ å¯èƒ½åªæƒ³å“åº”æœ€å†…å±‚ç»„ä»¶ä¸Šçš„äº‹ä»¶ï¼Œè€Œä¸æ˜¯è®©æ‰€æœ‰çš„çˆ¶ç»„ä»¶éƒ½å“åº”è¯¥äº‹ä»¶ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>stopPropagation</code> å¯ä»¥å¸®åŠ©ä½ æ›´ç²¾ç¡®åœ°æ§åˆ¶äº‹ä»¶å¤„ç†çš„æµç¨‹ã€‚</p><h4 id="event-target" tabindex="-1"><a class="header-anchor" href="#event-target"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtarget" target="_blank" rel="noopener noreferrer">event.target</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>events</code> æ¨¡å—æ˜¯æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œç”¨äºå¤„ç†äº‹ä»¶é©±åŠ¨çš„ç¨‹åºè®¾è®¡ã€‚</p><p><code>EventTarget</code> æ˜¯ <code>events</code> æ¨¡å—æ–°å¢åŠ çš„ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾— Node.js æ›´åŠ æ¥è¿‘æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¤„ç†æ–¹å¼ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œ<code>EventTarget</code> æ˜¯æ‰€æœ‰èƒ½å¤Ÿæ¥æ”¶äº‹ä»¶å¹¶ä¸”èƒ½å¤Ÿåˆ›å»ºç›‘å¬äº‹ä»¶çš„å¯¹è±¡çš„åŸºç±»ã€‚åœ¨ Node.js v15.4.0 ç‰ˆæœ¬å¼•å…¥åï¼Œç›¸ä¼¼çš„æ¦‚å¿µä¹Ÿè¢«å¸¦åˆ°äº† Node.js ä¸­ã€‚</p><p>å®é™…ä¸Šï¼Œ<code>event.target</code> å±æ€§ä»£è¡¨äº†äº‹ä»¶çš„ç›®æ ‡å¯¹è±¡ï¼Œå³å‘å‡ºäº‹ä»¶çš„å¯¹è±¡ã€‚åœ¨ Node.js çš„ <code>EventTarget</code> æ¥å£ä¸­ï¼Œè¿™ä¸ªå±æ€§åŒæ ·è¡¨ç¤ºè§¦å‘äº‹ä»¶çš„å¯¹è±¡ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥ç†è§£ <code>event.target</code> åœ¨ Node.js ä¸­çš„åº”ç”¨ï¼š</p><h3 id="ä¾‹å­-1-ä½¿ç”¨-eventtarget-åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ä½¿ç”¨-eventtarget-åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶"><span>ä¾‹å­ 1ï¼šä½¿ç”¨ <code>EventTarget</code> åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª EventTarget å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEventTarget</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ &quot;greet&quot;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">target</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">!</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &quot;greet&quot; äº‹ä»¶æ—¶ä¼ å…¥é¢å¤–çš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">myEventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> target</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºäº†ä¸€ä¸ª <code>EventTarget</code> çš„å®ä¾‹ <code>myEventTarget</code>ã€‚ç„¶åæˆ‘ä»¬ç»™è¿™ä¸ªå¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬åä¸º &quot;greet&quot; çš„äº‹ä»¶ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>dispatchEvent</code> æ–¹æ³•è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªæ–°åˆ›å»ºçš„ <code>Event</code> å¯¹è±¡æ—¶ï¼Œç›‘å¬å‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œå¹¶é€šè¿‡ <code>event.target</code> è®¿é—®åˆ°ä¼ é€’çš„é¢å¤–ä¿¡æ¯ <code>{ name: &#39;Alice&#39; }</code>ã€‚</p><h3 id="ä¾‹å­-2-ç»§æ‰¿-eventtarget-æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç»§æ‰¿-eventtarget-æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»"><span>ä¾‹å­ 2ï¼šç»§æ‰¿ <code>EventTarget</code> æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç»§æ‰¿è‡ª EventTarget</span></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventTarget</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  greet</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ä½¿ç”¨ dispatchEvent è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Bob</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">greet</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Hi there, I am </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">target</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è°ƒç”¨ greet æ–¹æ³•ï¼Œå°†ä¼šè§¦å‘&quot;greet&quot;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">greet</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±» <code>MyEmitter</code>ï¼Œå®ƒç»§æ‰¿è‡ª <code>EventTarget</code>ã€‚æˆ‘ä»¬ç»™è¿™ä¸ªç±»ä¸€ä¸ªæ–¹æ³• <code>greet</code>ï¼Œè¯¥æ–¹æ³•å¯ä»¥è§¦å‘ &quot;greet&quot; äº‹ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºäº† <code>MyEmitter</code> çš„å®ä¾‹ <code>myEmitter</code>ï¼Œå¹¶ä¸ºå®ƒæ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚å½“æˆ‘ä»¬è°ƒç”¨ <code>myEmitter.greet()</code> æ—¶ï¼Œ&quot;greet&quot; äº‹ä»¶è¢«è§¦å‘ï¼Œç›‘å¬å™¨å¯¹åº”çš„å›è°ƒå‡½æ•°æ‰§è¡Œï¼Œæ‰“å°å‡º <code>&quot;Hi there, I am Bob&quot;</code>ã€‚</p><p>ä»¥ä¸Šä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>EventTarget</code> å’Œ <code>event.target</code> æ¥å¤„ç†å’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚</p><h4 id="event-timestamp" tabindex="-1"><a class="header-anchor" href="#event-timestamp"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtimestamp" target="_blank" rel="noopener noreferrer">event.timeStamp</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome&#39;s V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚åœ¨ Node.js ä¸­ï¼Œ<code>event.timeStamp</code> æ˜¯ä¸€ä¸ªä¸äº‹ä»¶ç›¸å…³è”çš„æ—¶é—´æˆ³å±æ€§ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒæ¥äº†è§£æŸä¸ªäº‹ä»¶å‘ç”Ÿçš„å…·ä½“æ—¶é—´ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­, <code>event.timeStamp</code> æ˜¯æŒ‡åœ¨è§¦å‘ EventEmitter ä¸Šçš„äº‹ä»¶æ—¶ç”Ÿæˆçš„é«˜ç²¾åº¦æ—¶é—´æˆ³ã€‚è¿™ä¸ªæ—¶é—´æˆ³è¡¨ç¤ºäº‹ä»¶è¢«è§¦å‘çš„ç¡®åˆ‡æ—¶é—´ï¼Œå®ƒæ˜¯ä»¥æ¯«ç§’ä¸ºå•ä½çš„ï¼Œä½†æ˜¯å†…éƒ¨è¡¨ç¤ºåˆ™åŒ…å«äº†æ›´é«˜çš„ç²¾åº¦ï¼ˆå¯èƒ½åˆ°å¾®ç§’æˆ–çº³ç§’çº§åˆ«ï¼‰ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½ä¸»è¦ç”¨äºæ€§èƒ½æµ‹é‡ï¼Œè°ƒè¯•ï¼Œæˆ–è€…è®°å½•äº‹ä»¶å‘ç”Ÿçš„é¡ºåºå’Œæ—¶é—´é—´éš”ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å®é™…ä½¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ç¤ºä¾‹-1-æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´"><span>ç¤ºä¾‹ 1ï¼šæµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´</span></a></h3><p>å‡è®¾ä½ æƒ³è¦æµ‹é‡ä¸€æ®µä»£ç æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´ï¼Œä½ å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨ä»£ç æ‰§è¡Œå‰ååˆ†åˆ«è§¦å‘ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>event.timeStamp</code> æ¥è®¡ç®—å·®å¼‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;start&#39; å’Œ &#39;end&#39; äº‹ä»¶ï¼Œå¹¶è®°å½•æ—¶é—´æˆ³</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  startTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">timeStamp</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Operation started at: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">startTime</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> endTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">timeStamp</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Operation ended at: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">endTime</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> duration</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> endTime</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Operation took </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">duration</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> milliseconds.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;start&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> timeStamp</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ‰§è¡Œä¸€äº›æ“ä½œ...</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 1000000</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾çš„è€—æ—¶æ“ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;end&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> timeStamp</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-2-è®°å½•äº‹ä»¶çš„é¡ºåºå’Œæ—¶é—´é—´éš”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è®°å½•äº‹ä»¶çš„é¡ºåºå’Œæ—¶é—´é—´éš”"><span>ç¤ºä¾‹ 2ï¼šè®°å½•äº‹ä»¶çš„é¡ºåºå’Œæ—¶é—´é—´éš”</span></a></h3><p>å¦‚æœä½ æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­å¤šä¸ªäº‹ä»¶ä»¥ä¸ç¡®å®šçš„é¡ºåºå‘ç”Ÿï¼Œä½ å¯èƒ½æƒ³è¦è®°å½•æ¯ä¸ªäº‹ä»¶çš„å‘ç”Ÿæ—¶é—´ï¼Œä»¥ä¾¿ç¨ååˆ†æã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> eventTracker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¾ç½®ç›‘å¬å™¨æ¥è·Ÿè¸ªäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">eventTracker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An event occurred with timestamp: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">timeStamp</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨ä¸åŒçš„æ—¶é—´è§¦å‘å‡ æ¬¡äº‹ä»¶</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  eventTracker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> timeStamp</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  eventTracker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> timeStamp</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 300</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  eventTracker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> timeStamp</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>performance.now()</code>å‡½æ•°äº§ç”Ÿä¸€ä¸ªé«˜ç²¾åº¦çš„æ—¶é—´æˆ³ä½œä¸º<code>event.timeStamp</code>çš„å€¼ï¼Œç„¶åå°†äº‹ä»¶è§¦å‘æ—¶çš„ç²¾ç¡®æ—¶é—´è®°å½•ä¸‹æ¥ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>event.timeStamp</code> ä¸æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä½ éœ€è¦æ‰‹åŠ¨åœ¨è§¦å‘äº‹ä»¶æ—¶æä¾›ä¸€ä¸ªæ—¶é—´æˆ³ã€‚è¿™å¯ä»¥é€šè¿‡è¯¸å¦‚ <code>Date.now()</code> æˆ– <code>performance.now()</code> è¿™æ ·çš„å‡½æ•°æ¥è·å¾—å½“å‰æ—¶é—´æˆ³ã€‚</p><p>å¸Œæœ›ä»¥ä¸Šä¾‹å­èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£ Node.js ä¸­ <code>event.timeStamp</code> çš„æ¦‚å¿µå’Œç”¨æ³•ã€‚</p><h4 id="event-type" tabindex="-1"><a class="header-anchor" href="#event-type"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtype" target="_blank" rel="noopener noreferrer">event.type</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®© JavaScript å¯ä»¥è„±ç¦»æµè§ˆå™¨è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸æ ¸å¿ƒä¸”å¼ºå¤§çš„æ¨¡å—å«ä½œâ€œEventsâ€ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ç¼–å†™ä»£ç ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å®šä¹‰å‘ç”Ÿç‰¹å®šäº‹ä»¶æ—¶è§¦å‘çš„æ“ä½œï¼Œè€Œä¸æ˜¯æŒ‰ç…§ä»£ç çš„é¡ºåºæ‰§è¡Œã€‚è¿™å¯¹äºå¤„ç†å¼‚æ­¥æ“ä½œã€ç”¨æˆ·äº¤äº’æˆ–å…¶ä»–ç³»ç»Ÿäº‹ä»¶æ¥è¯´æå…¶æœ‰ç”¨ã€‚</p><h3 id="event-type-1" tabindex="-1"><a class="header-anchor" href="#event-type-1"><span>event.type</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>event.type</code> å…³é”®å­—æŒ‡çš„æ˜¯åœ¨ä½¿ç”¨ <code>EventTarget</code> æ¥å£ä¸‹ï¼Œæ¯ä¸ªäº‹ä»¶å®ä¾‹ï¼ˆå³ <code>Event</code> å¯¹è±¡ï¼‰éƒ½ä¼šæœ‰ä¸€ä¸ª <code>type</code> å±æ€§ã€‚è¿™ä¸ªå±æ€§åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯¥äº‹ä»¶çš„ç±»å‹ã€‚ç®€å•æ¥è¯´ï¼Œ<code>event.type</code> å°±æ˜¯å‘Šè¯‰ä½ è¿™ä¸ªäº‹ä»¶æ˜¯ä»€ä¹ˆç±»å‹çš„ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h4><h5 id="_1-æœåŠ¡å™¨äº‹ä»¶ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#_1-æœåŠ¡å™¨äº‹ä»¶ç›‘å¬"><span>1. æœåŠ¡å™¨äº‹ä»¶ç›‘å¬</span></a></h5><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™çš„åç«¯æœåŠ¡ï¼Œå¹¶ä¸”ä½ éœ€è¦åœ¨æŸäº›å…³é”®ç‚¹ä¸Šè¿›è¡Œæ—¥å¿—è®°å½•ï¼Œæ¯”å¦‚å½“æ–°ç”¨æˆ·æ³¨å†Œæ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šå‘å‡ºä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶åœ¨è¯¥äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œä¸€äº›ä»£ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰äº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newUser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">Received an event of type: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">; New user registered with username: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newUser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">newUser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">john_doe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>event.type</code> æ˜¯ <code>&#39;newUser&#39;</code>ï¼Œè¿™è¡¨æ˜å‘ç”Ÿçš„äº‹ä»¶ç±»å‹ä¸ºæ–°ç”¨æˆ·æ³¨å†Œã€‚</p><h5 id="_2-æµè§ˆå™¨ç¯å¢ƒçš„äº‹ä»¶ç›‘å¬-è™½ç„¶-node-js-ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯-ä½†æ­¤ä¾‹å¸®åŠ©ç†è§£" tabindex="-1"><a class="header-anchor" href="#_2-æµè§ˆå™¨ç¯å¢ƒçš„äº‹ä»¶ç›‘å¬-è™½ç„¶-node-js-ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯-ä½†æ­¤ä¾‹å¸®åŠ©ç†è§£"><span>2. æµè§ˆå™¨ç¯å¢ƒçš„äº‹ä»¶ç›‘å¬ ï¼ˆè™½ç„¶ Node.js ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œä½†æ­¤ä¾‹å¸®åŠ©ç†è§£ï¼‰</span></a></h5><p>åœ¨å®¢æˆ·ç«¯ JavaScript ä¸­ï¼Œå‡è®¾ä½ æ­£åœ¨ç›‘å¬ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œå½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶ä¸”é€šè¿‡äº‹ä»¶å¯¹è±¡å¯ä»¥è·å–åˆ°äº‹ä»¶çš„ç±»å‹ã€‚</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">`</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`button id=&quot;myButton&quot;&gt;Click me!`</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`/button&gt; `</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`script&gt;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">document.getElementById(&#39;myButton&#39;).addEventListener(&#39;click&#39;, (event) =&gt; {</span></span>
<span class="line"><span style="color:#D8DEE9FF;">alert(`Event Type: ${event.type}`); // Event Type: click }); `</span><span style="color:#D8DEE9;">&lt;</span><span style="color:#D8DEE9FF;">`/script&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°½ç®¡è¿™æ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„ç¤ºä¾‹ï¼Œä½†å®ƒæœ‰åŠ©äºè¯´æ˜ <code>event.type</code> å¦‚ä½•åœ¨äº‹ä»¶å¯¹è±¡ä¸­æ ‡è¯†äº‹ä»¶çš„ç±»å‹ã€‚è¿”å›åˆ° Node.jsï¼Œæ— è®ºä½•æ—¶ä½ åœ¨å¤„ç†ç±»ä¼¼çš„äº‹ä»¶ï¼ˆå°½ç®¡ä¸Šä¸‹æ–‡å’Œç”¨ä¾‹å¯èƒ½ä¸åŒï¼‰ï¼Œ<code>event.type</code> éƒ½æä¾›äº†ä¸€ä¸ªåŒºåˆ†ä¸åŒäº‹ä»¶ç±»å‹çš„ç®€ä¾¿æ–¹æ³•ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>event.type</code> åœ¨ Node.js ä¸­ä½œä¸ºäº‹ä»¶å¯¹è±¡çš„å±æ€§å­˜åœ¨ï¼Œå®ƒæä¾›äº†äº‹ä»¶ç±»å‹çš„ä¿¡æ¯ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ ¹æ®ä¸åŒçš„äº‹ä»¶ç±»å‹ç¼–å†™ç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚è¿™åœ¨æ„å»ºèƒ½å¤Ÿå“åº”å„ç§äº‹ä»¶çš„å¤æ‚åº”ç”¨ç¨‹åºæ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="class-eventtarget" tabindex="-1"><a class="header-anchor" href="#class-eventtarget"><span><a href="https://nodejs.org/docs/latest/api/events.html#class-eventtarget" target="_blank" rel="noopener noreferrer">Class: EventTarget</a></span></a></h3><p>å½“ç„¶å¯ä»¥è§£é‡Šã€‚Node.js ä¸­çš„ EventTarget æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒæä¾›äº†ä¸€ç§å¤„ç†äº‹ä»¶çš„æœºåˆ¶ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œ&quot;äº‹ä»¶&quot;æ˜¯æŒ‡å‘ç”Ÿçš„äº‹æƒ…æˆ–åŠ¨ä½œï¼Œæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ã€æ–‡ä»¶ä¸‹è½½å®Œæˆç­‰ã€‚EventTarget ç±»è®©ä½ èƒ½å¤Ÿç›‘å¬è¿™äº›äº‹ä»¶å¹¶ä¸”å½“å®ƒä»¬å‘ç”Ÿæ—¶åšå‡ºå“åº”ã€‚</p><h3 id="eventtarget-çš„åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#eventtarget-çš„åŸºæœ¬æ¦‚å¿µ"><span>EventTarget çš„åŸºæœ¬æ¦‚å¿µ</span></a></h3><ol><li><p><strong>äº‹ä»¶ç›‘å¬å™¨ï¼ˆEvent Listenersï¼‰</strong>ï¼š</p><ul><li>è¿™äº›æ˜¯ç»‘å®šåˆ°ç‰¹å®šäº‹ä»¶ä¸Šçš„å‡½æ•°ï¼Œå½“è¯¥äº‹ä»¶å‘ç”Ÿæ—¶ä¼šè¢«è°ƒç”¨ã€‚</li></ul></li><li><p><strong>äº‹ä»¶è§¦å‘ï¼ˆEvent Firingï¼‰</strong>ï¼š</p><ul><li>å½“ç‰¹å®šçš„åŠ¨ä½œå‘ç”Ÿæ—¶ï¼Œä¸ä¹‹ç›¸å…³çš„äº‹ä»¶å°±ä¼šè¢«&quot;è§¦å‘&quot;ï¼Œä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶å¯èƒ½ä¼šè§¦å‘ä¸€ä¸ª&quot;click&quot;äº‹ä»¶ã€‚</li></ul></li><li><p><strong>äº‹ä»¶å¯¹è±¡ï¼ˆEvent Objectï¼‰</strong>ï¼š</p><ul><li>å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªäº‹ä»¶å¯¹è±¡è¢«åˆ›å»ºå¹¶ä¼ é€’ç»™äº‹ä»¶ç›‘å¬å™¨ï¼Œé‡Œé¢åŒ…å«äº†å…³äºè¯¥äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚è§¦å‘äº‹ä»¶çš„å…ƒç´ ã€äº‹ä»¶ç±»å‹ç­‰ã€‚</li></ul></li></ol><h3 id="å®é™…ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬åœ¨ç½‘ç«™ä¸Šæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªæŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è¾“å‡ºä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°(console)ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ EventTarget åŠå…¶æ–¹æ³•æ¥è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Node.js çš„ EventTarget æ¥è®¾ç½®ä¸€ä¸ªç®€å•çš„äº‹ä»¶ç›‘å¬å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventTarget å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myButton</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> handleClick</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Button clicked!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ addEventListener æ–¹æ³•å°†ç›‘å¬å™¨ç»‘å®šåˆ° &#39;click&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myButton</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> handleClick</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¨åæŸä¸ªæ—¶åˆ»ï¼Œæ¨¡æ‹ŸæŒ‰é’®ç‚¹å‡»</span></span>
<span class="line"><span style="color:#D8DEE9;">myButton</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">click</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: Button clicked!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† Node.js æä¾›çš„ <code>EventTarget</code> å’Œ <code>Event</code> ç±»ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>myButton</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨ä¸€ä¸ªæŒ‰é’®ã€‚ç„¶åå®šä¹‰äº†ä¸€ä¸ªåä¸º <code>handleClick</code> çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æˆ‘ä»¬çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒè´Ÿè´£å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬å°† <code>handleClick</code> å‡½æ•°ç»‘å®šåˆ° <code>myButton</code> å¯¹è±¡çš„ &#39;click&#39; äº‹ä»¶ä¸Šã€‚è¿™æ„å‘³ç€å½“ <code>myButton</code> ä¸Šå‘ç”Ÿ &#39;click&#39; äº‹ä»¶æ—¶ï¼Œ<code>handleClick</code> å‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>dispatchEvent</code> æ–¹æ³•æ¨¡æ‹Ÿäº†ä¸€ä¸ª &#39;click&#39; äº‹ä»¶çš„å‘ç”Ÿã€‚è¿™å°†å¯¼è‡´ <code>handleClick</code> å‡½æ•°æ‰§è¡Œï¼Œå¹¶åœ¨æ§åˆ¶å°è¾“å‡º &quot;Button clicked!&quot;ã€‚</p><p>åœ¨çœŸå®çš„ Web åº”ç”¨ä¸­ï¼Œè¿™æ ·çš„äº‹ä»¶ç›‘å¬å’Œå¤„ç†éå¸¸æ™®éã€‚Node.js çš„ <code>EventTarget</code> ç±»ä½¿å¾—å¤„ç†è‡ªå®šä¹‰äº‹ä»¶ï¼ˆæˆ–ç³»ç»Ÿäº‹ä»¶ï¼‰å˜å¾—å®¹æ˜“ï¼Œå¹¶å…è®¸ä½ ä»¥æ¨¡å—åŒ–å’Œå¯é‡ç”¨çš„æ–¹å¼æ„å»ºåº”ç”¨é€»è¾‘ã€‚</p><h4 id="eventtarget-addeventlistener-type-listener-options" tabindex="-1"><a class="header-anchor" href="#eventtarget-addeventlistener-type-listener-options"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtargetaddeventlistenertype-listener-options" target="_blank" rel="noopener noreferrer">eventTarget.addEventListener(type, listener[, options])</a></span></a></h4><p>Node.js ä¸­çš„ <code>eventTarget.addEventListener()</code> æ–¹æ³•æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚åœ¨è¿™ä¸ªæ¶æ„é‡Œï¼Œäº‹ä»¶å¤„ç†å™¨ï¼ˆEvent Handlersï¼‰æˆ–ç›‘å¬å™¨ï¼ˆListenersï¼‰ç”¨äºç›¸åº”åœ°å“åº”ä¸åŒçš„äº‹ä»¶ã€‚è¿™ç§æ¨¡å¼åœ¨ Node.js çš„è®¾è®¡ä¸­éå¸¸æ ¸å¿ƒï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç½‘ç»œæ“ä½œã€æ–‡ä»¶ I/O æˆ–å…¶ä»–å¼‚æ­¥æ´»åŠ¨æ—¶ã€‚</p><p><code>addEventListener()</code> å‡½æ•°å…è®¸ä½ æŒ‡å®šå½“æŸä¸ªç‰¹å®šç±»å‹çš„äº‹ä»¶å‘ç”Ÿæ—¶è¦è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼ˆå³ç›‘å¬å™¨ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•é€šå¸¸ä¸æµè§ˆå™¨ä¸­çš„äº‹ä»¶ç›‘å¬æœ‰å…³ï¼Œä½†åœ¨ Node.js çš„æŸäº›å¯¹è±¡ä¸­ä¹Ÿå®ç°äº†ç±»ä¼¼çš„æœºåˆ¶ã€‚</p><p>è¿™ä¸ªæ–¹æ³•çš„å‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š</p><ol><li><code>type</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»£è¡¨ä½ å¸Œæœ›ç›‘å¬çš„äº‹ä»¶çš„åç§°ã€‚</li><li><code>listener</code>ï¼šè¿™æ˜¯å½“äº‹ä»¶å‘ç”Ÿæ—¶å°†è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚</li><li><code>options</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥æŒ‡å®šä¸€äº›é¢å¤–çš„é…ç½®é€‰é¡¹ï¼Œæ¯”å¦‚äº‹ä»¶æ˜¯å¦åº”è¯¥åªè§¦å‘ä¸€æ¬¡ç­‰ã€‚</li></ol><p>ä¸‹é¢æ˜¯å‡ ä¸ª <code>eventTarget.addEventListener()</code> çš„å®ä¾‹ä½¿ç”¨ï¼š</p><h3 id="å®ä¾‹-1-http-æœåŠ¡å™¨è¯·æ±‚ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-http-æœåŠ¡å™¨è¯·æ±‚ç›‘å¬"><span>å®ä¾‹ 1ï¼šHTTP æœåŠ¡å™¨è¯·æ±‚ç›‘å¬</span></a></h3><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ æƒ³ä¸ºæ¯ä¸ªè¿›æ¥çš„è¯·æ±‚è®¾ç½®ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨addEventListeneræ¥ç›‘å¬&#39;è¯·æ±‚&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°è¯·æ±‚ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœ‰æ–°çš„ HTTP è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œéƒ½ä¼šè§¦å‘ <code>&#39;request&#39;</code> äº‹ä»¶ï¼Œå¹¶è°ƒç”¨æˆ‘ä»¬æä¾›çš„å›è°ƒå‡½æ•°ã€‚</p><h3 id="å®ä¾‹-2-å•æ¬¡äº‹ä»¶ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-å•æ¬¡äº‹ä»¶ç›‘å¬å™¨"><span>å®ä¾‹ 2ï¼šå•æ¬¡äº‹ä»¶ç›‘å¬å™¨</span></a></h3><p>ä½ å¯èƒ½æƒ³ç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œä½†åªå“åº”ä¸€æ¬¡ï¼Œä¹‹åå°±ä¸å†å¤„ç†å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onlyOnce</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ åªä¼šçœ‹åˆ°æˆ‘ä¸€æ¬¡</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œé…ç½®ä¸ºåªæ‰§è¡Œä¸€æ¬¡</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">something</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onlyOnce</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> once</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">something</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: &quot;ä½ åªä¼šçœ‹åˆ°æˆ‘ä¸€æ¬¡&quot;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">something</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä¸ä¼šæœ‰è¾“å‡ºï¼Œç›‘å¬å™¨å·²ç»ç§»é™¤äº†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>{ once: true }</code> è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ <code>addEventListener</code> å½“ç›‘å¬å™¨è¢«è§¦å‘ä¸€æ¬¡ååº”è¯¥è‡ªåŠ¨ç§»é™¤ã€‚</p><p>æ³¨æ„ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ <code>on</code> æˆ–è€… <code>once</code> æ–¹æ³•æ¥é™„åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚<code>addEventListener</code> é€šå¸¸ç”¨äºå…¼å®¹æµè§ˆå™¨ç«¯çš„ä»£ç æˆ–è€…ç‰¹å®šçš„ Node.js APIï¼Œå®ƒå¯èƒ½å¹¶ä¸åƒåœ¨ Web API ä¸­é‚£æ ·æ™®éã€‚å› æ­¤ï¼Œåœ¨ç¼–å†™æ™®é€šçš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ æ›´æœ‰å¯èƒ½ä½¿ç”¨ <code>on</code> æ›¿ä»£ <code>addEventListener</code>ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œç†è§£äº‹ä»¶ç›‘å¬å™¨çš„å·¥ä½œåŸç†å¯¹äºå­¦ä¹  Node.js éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚</p><h4 id="eventtarget-dispatchevent-event" tabindex="-1"><a class="header-anchor" href="#eventtarget-dispatchevent-event"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtargetdispatcheventevent" target="_blank" rel="noopener noreferrer">eventTarget.dispatchEvent(event)</a></span></a></h4><p>å½“ç„¶ï¼Œå¾ˆé«˜å…´è¯¦ç»†è§£é‡Š <code>eventTarget.dispatchEvent(event)</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><p>Node.js ä¸­çš„ <code>EventTarget</code> æ˜¯ä¸€ä¸ªç±»ä¼¼äºç½‘é¡µæµè§ˆå™¨ç¯å¢ƒä¸­çš„ <code>EventTarget</code> çš„æ¥å£ã€‚å®ƒå…è®¸å¯¹è±¡ç›‘å¬å’Œè§¦å‘äº‹ä»¶ï¼Œè¿™æ˜¯ä¸€ç§ç»„ä»¶ä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ–¹å¼ã€‚åœ¨ Node.js çš„äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ï¼Œå®ƒæ˜¯éå¸¸æ ¸å¿ƒçš„æ¦‚å¿µã€‚</p><h3 id="è§£é‡Š-dispatchevent" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-dispatchevent"><span>è§£é‡Š <code>dispatchEvent</code></span></a></h3><p><code>dispatchEvent</code> æ–¹æ³•ç”¨äºè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œè¯¥äº‹ä»¶å¯ä»¥æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ï¼Œæˆ–è€…ç”±å¼€å‘è€…è‡ªå®šä¹‰ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ª <code>Event</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦è§¦å‘äº†äº‹ä»¶ç›‘å¬å™¨ã€‚</p><h3 id="ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2"><span>ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦å¤„ç†ç”¨æˆ·æ³¨å†Œæµç¨‹ã€‚åœ¨ç”¨æˆ·æ³¨å†Œå®Œæˆåï¼Œä½ å¯èƒ½æƒ³è¦è§¦å‘ä¸€ä¸ª <code>&quot;userRegistered&quot;</code> äº‹ä»¶ï¼Œä»¥ä¾¿å…¶ä»–éƒ¨åˆ†çš„ç¨‹åºå¯ä»¥å“åº”è¿™ä¸ªäº‹ä»¶ï¼Œæ¯”å¦‚å‘é€æ¬¢è¿é‚®ä»¶ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>EventTarget</code> å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> eventTarget</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥å¤„ç† <code>&quot;userRegistered&quot;</code> äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onUserRegistered</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">User registered: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å¯ä»¥åœ¨è¿™é‡ŒåŠ å…¥å‘é€æ¬¢è¿é‚®ä»¶çš„ä»£ç </span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ `addEventListener` å‘ `eventTarget` æ·»åŠ äº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">eventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userRegistered</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onUserRegistered</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå½“ç”¨æˆ·æ³¨å†Œå®Œæˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¹¶åˆ†æ´¾ä¸€ä¸ª <code>&quot;userRegistered&quot;</code> äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> registerUser</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨è¿™é‡Œç¼–å†™ç”¨æˆ·æ³¨å†Œçš„é€»è¾‘</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> is being registered...</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ³¨å†Œé€»è¾‘å®Œæˆåï¼Œåˆ›å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> event</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userRegistered</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> username</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å°†ç”¨æˆ·åé™„åˆ°äº‹ä»¶å¯¹è±¡ä¸Š</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  eventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œè§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#88C0D0;">registerUser</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºå°†ä¼šæ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Alice is being registered...</span></span>
<span class="line"><span>User registered: Alice</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç›®æ ‡ï¼ˆ<code>EventTarget</code>ï¼‰ï¼Œç›‘å¬ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶ï¼Œå¹¶é€šè¿‡è°ƒç”¨ <code>dispatchEvent</code> æ¥è§¦å‘äº‹ä»¶ã€‚å…¶ä»–éƒ¨åˆ†çš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡æ·»åŠ ç›‘å¬å™¨æ¥å“åº”è¿™äº›äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p><h4 id="eventtarget-removeeventlistener-type-listener-options" tabindex="-1"><a class="header-anchor" href="#eventtarget-removeeventlistener-type-listener-options"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventtargetremoveeventlistenertype-listener-options" target="_blank" rel="noopener noreferrer">eventTarget.removeEventListener(type, listener[, options])</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆåˆ° Node.js ä¸­çš„<code>eventTarget.removeEventListener(type, listener[, options])</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨è®¨è®ºçš„æ˜¯ä¸€ç§åœ¨ä»£ç æ‰§è¡ŒæœŸé—´ä»æŸä¸ªäº‹ä»¶ç›®æ ‡ï¼ˆ<code>eventTarget</code>ï¼‰ä¸Šç§»é™¤ä¹‹å‰æ³¨å†Œçš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆ<code>listener</code>ï¼‰çš„æ–¹å¼ã€‚è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹å¤æ‚ï¼Œä½†åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šé€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥å¸®ä½ ç†è§£å®ƒã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><p><strong>äº‹ä»¶ç›®æ ‡ï¼ˆEvent Targetï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥è§¦å‘äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è¿™äº›äº‹ä»¶æ·»åŠ æˆ–ç§»é™¤ç›‘å¬å™¨ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½å¯ä»¥æˆä¸ºäº‹ä»¶ç›®æ ‡ï¼Œæ¯”å¦‚æœåŠ¡å™¨å¯¹è±¡ã€æ–‡ä»¶æµç­‰ã€‚</p></li><li><p><strong>äº‹ä»¶ç±»å‹ï¼ˆTypeï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡ç¤ºäº†è¦ç›‘å¬ä»€ä¹ˆäº‹ä»¶çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œ&#39;click&#39;ã€&#39;data&#39;ã€&#39;error&#39;ç­‰ã€‚</p></li><li><p><strong>äº‹ä»¶ç›‘å¬å™¨ï¼ˆListenerï¼‰</strong>ï¼šè¿™æ˜¯å½“äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨çš„å‡½æ•°ã€‚å®ƒå¯¹å‘ç”Ÿçš„äº‹ä»¶è¿›è¡Œå“åº”ã€‚</p></li><li><p><strong>é€‰é¡¹ï¼ˆOptionsï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œæä¾›äº†é¢å¤–çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æ˜¯å¦ä½¿ç”¨æ•è·ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨éœ€è¦åœ¨æ¯æ¬¡æ”¶åˆ°è¯·æ±‚æ—¶æ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚ç„¶åï¼Œåœ¨æŸä¸€åˆ»ï¼Œä½ å†³å®šä¸å†å…³æ³¨è¿™äº›è¯·æ±‚äº‹ä»¶ã€‚è¿™é‡Œå°±å¯ä»¥ç”¨åˆ°<code>removeEventListener</code>æ–¹æ³•ã€‚</p><h3 id="ç¤ºä¾‹æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹æ­¥éª¤"><span>ç¤ºä¾‹æ­¥éª¤ï¼š</span></a></h3><ol><li><strong>åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨</strong>ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä»¥è§¦å‘äº‹ä»¶çš„äº‹ä»¶ç›®æ ‡ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒåœ¨æ¯æ¬¡æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶éƒ½ä¼šè§¦å‘&#39;request&#39;äº‹ä»¶ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> requestListener</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å°†ç›‘å¬å™¨æ·»åŠ åˆ°&#39;request&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> requestListener</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯åŠ¨æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ç§»é™¤äº‹ä»¶ç›‘å¬å™¨</strong>ï¼šç°åœ¨ï¼Œå‡è®¾å‡ºäºæŸç§åŸå› ï¼Œæˆ‘ä»¬ä¸å†å¸Œæœ›æœåŠ¡å™¨å“åº”æ–°çš„è¯·æ±‚ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä»&#39;request&#39;äº‹ä»¶ä¸­ç§»é™¤ä¹‹å‰æ·»åŠ çš„ç›‘å¬å™¨ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ç§»é™¤&#39;request&#39;äº‹ä»¶çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> requestListener</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œ<code>removeListener</code>æ–¹æ³•åœ¨ Node.js æ–‡æ¡£ä¸­æ˜¯å¦ä¸€ä¸ªå¸¸è§æ–¹æ³•æ¥ç§»é™¤ç›‘å¬å™¨ï¼Œè€Œ<code>removeEventListener</code>æä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äº API çš„è®¾è®¡é£æ ¼ï¼ˆ<code>removeEventListener</code>æ›´æ¥è¿‘ Web æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¤„ç†ï¼‰åŠæ”¯æŒçš„å‚æ•°ã€‚</p><p>åœ¨ä½¿ç”¨<code>removeEventListener</code>æ—¶ï¼Œå¦‚æœä½ æœ‰ä¼ é€’<code>options</code>å‚æ•°ç»™<code>addEventListener</code>ï¼ŒåŒæ ·éœ€è¦ä¼ é€’ç»™<code>removeEventListener</code>ä»¥ç¡®ä¿æ­£ç¡®åŒ¹é…ç›‘å¬å™¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªéœ€å…³æ³¨äº‹ä»¶ç±»å‹å’Œç›‘å¬å™¨å‡½æ•°å³å¯ã€‚</p><h3 id="æ€»ç»“-9" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-9"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨ Node.js ä¸­å‘äº‹ä»¶ç›®æ ‡æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œä»¥åŠå¦‚ä½•åœ¨ä¸å†éœ€è¦æ—¶ç§»é™¤å®ƒä»¬ã€‚è¿™å¯¹äºç®¡ç†èµ„æºã€é¿å…å†…å­˜æ³„éœ²å’Œæ§åˆ¶ç¨‹åºè¡Œä¸ºéå¸¸é‡è¦ã€‚åœ¨å¼€å‘ Node.js åº”ç”¨æ—¶ï¼Œåˆç†åœ°ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨å’ŒåŠæ—¶æ¸…ç†æ˜¯è‰¯å¥½ç¼–ç¨‹ä¹ æƒ¯çš„ä½“ç°ã€‚</p><h3 id="class-customevent" tabindex="-1"><a class="header-anchor" href="#class-customevent"><span><a href="https://nodejs.org/docs/latest/api/events.html#class-customevent" target="_blank" rel="noopener noreferrer">Class: CustomEvent</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚Node.js å¼•å…¥äº†è®¸å¤šç‹¬ç‰¹çš„æ¨¡å—å’Œç±»ï¼Œä»¥å¸®åŠ©ä½ æ„å»ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚å…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯äº‹ä»¶å¤„ç†ç›¸å…³çš„æ¨¡å—ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>CustomEvent</code> ç±»æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºåˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶çš„ç±»ã€‚å®ƒç»§æ‰¿è‡ª <code>Event</code> ç±»ï¼Œæ„å‘³ç€å®ƒå…·å¤‡äº† <code>Event</code> ç±»çš„æ‰€æœ‰ç‰¹æ€§ï¼Œå¹¶ä¸”å¯ä»¥é¢å¤–æºå¸¦ä¸€äº›è‡ªå®šä¹‰æ•°æ®ã€‚è¿™æ ·ï¼Œå½“è¿™ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œä»»ä½•ç›‘å¬è¯¥äº‹ä»¶çš„å¤„ç†å‡½æ•°éƒ½å¯ä»¥æ¥æ”¶åˆ°è¿™äº›æ•°æ®ã€‚</p><p>ä»¥ä¸‹æ˜¯å…³äº <code>CustomEvent</code> ç±»çš„ç®€å•ä»‹ç»å’Œå‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="åˆ›å»ºä¸€ä¸ª-customevent" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-customevent"><span>åˆ›å»ºä¸€ä¸ª CustomEvent</span></a></h3><p>è¦ä½¿ç”¨ <code>CustomEvent</code> ç±»ï¼Œä½ é¦–å…ˆéœ€è¦å¯¼å…¥ Node.js çš„ <code>events</code> æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> CustomEvent</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>CustomEvent</code> å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEvent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> CustomEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">testEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  detail</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>testEvent</code> çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¸”ä¼ é€’äº†ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨ <code>detail</code> å±æ€§ä¸­ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¶ˆæ¯ã€‚</p><h3 id="ç›‘å¬-customevent" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬-customevent"><span>ç›‘å¬ CustomEvent</span></a></h3><p>åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶åï¼Œä½ é€šå¸¸æƒ³è¦åœ¨æŸä¸ªåœ°æ–¹ç›‘å¬è¿™ä¸ªäº‹ä»¶ã€‚ä¸ºäº†ç›‘å¬äº‹ä»¶ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>EventEmitter</code> ç±»ï¼Œè¿™ä¹Ÿæ˜¯ Node.js äº‹ä»¶æ¨¡å—æä¾›çš„ä¸€ä¸ªæ ¸å¿ƒç±»ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»º EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> emitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">testEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">detail</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º &quot;Hello, world!&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è§¦å‘-customevent" tabindex="-1"><a class="header-anchor" href="#è§¦å‘-customevent"><span>è§¦å‘ CustomEvent</span></a></h3><p>æœ€åï¼Œä½ å¯èƒ½æƒ³è¦åœ¨æŸä¸ªæ—¶åˆ»è§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>EventEmitter</code> å®ä¾‹çš„ <code>dispatchEvent</code> æ–¹æ³•æ¥è§¦å‘äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myEvent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è§¦å‘äº‹ä»¶æ—¶ï¼Œç»‘å®šåˆ°è¯¥äº‹ä»¶ç±»å‹çš„æ‰€æœ‰ç›‘å¬å™¨å°†è¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä¼šæ¥æ”¶åˆ° <code>CustomEvent</code> å®ä¾‹ä½œä¸ºå‚æ•°ï¼Œä»è€Œå¯ä»¥è®¿é—®ä½ ä¹‹å‰è®¾ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-10"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„èŠå¤©åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä¼šç”¨åˆ°è‡ªå®šä¹‰äº‹ä»¶æ¥å¤„ç†ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>newMessage</code> äº‹ä»¶ï¼Œæ¯å½“æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶å°±è§¦å‘å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ CustomEvent æ¥è¡¨ç¤ºæ–°æ¶ˆæ¯äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> newMessageEvent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> CustomEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">newMessage</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  detail</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> text</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hi Bob!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æ–°æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œè§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">newMessageEvent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç æ®µå±•ç¤ºäº†å¦‚ä½•åœ¨æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶æºå¸¦ç”¨æˆ·çš„åå­—å’Œæ¶ˆæ¯æ–‡æœ¬ä½œä¸ºæ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ã€‚ç›‘å¬è¿™ä¸ªäº‹ä»¶çš„ä»»ä½•éƒ¨åˆ†éƒ½å¯ä»¥å¾—åˆ°é€šçŸ¥å¹¶ç›¸åº”åœ°å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚</p><p>é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶å’Œ <code>EventEmitter</code>ï¼Œä½ å¯ä»¥åˆ›å»ºéå¸¸çµæ´»å’Œå¼ºå¤§çš„å¼‚æ­¥å’Œäº‹ä»¶é©±åŠ¨çš„ Node.js åº”ç”¨ç¨‹åºã€‚</p><h4 id="event-detail" tabindex="-1"><a class="header-anchor" href="#event-detail"><span><a href="https://nodejs.org/docs/latest/api/events.html#eventdetail" target="_blank" rel="noopener noreferrer">event.detail</a></span></a></h4><p><code>event.detail</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œä½ å¯ä»¥åœ¨ä½¿ç”¨ Node.js çš„ <code>EventTarget</code> æ¥å£æ—¶é‡åˆ°å®ƒã€‚<code>EventTarget</code> æ˜¯ä¸€ä¸ªç”±æµè§ˆå™¨ä¸­çš„è®¸å¤šå¯¹è±¡å®ç°çš„æ¥å£ï¼ŒNode.js åœ¨å…¶ 15.x ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†ä¸€äº›ä¸æµè§ˆå™¨å…¼å®¹çš„ APIï¼ŒåŒ…æ‹¬ <code>EventTarget</code>ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—æ˜ç™½ Node.js ä¸­çš„äº‹ä»¶ç³»ç»Ÿå¦‚ä½•å·¥ä½œã€‚åœ¨ Node.js é‡Œï¼Œäº‹ä»¶æ˜¯ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„åŸºæœ¬æ¦‚å¿µä¹‹ä¸€ã€‚æ¯”å¦‚è¯´ï¼Œå½“è¯»å–ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ä¸€ä¸ªç½‘ç»œè¯·æ±‚å®Œæˆæ—¶ï¼Œç›¸å…³çš„å¯¹è±¡ä¼šå‘å‡ºï¼ˆemitï¼‰ä¸€ä¸ªäº‹ä»¶ã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥ç›‘å¬ï¼ˆlisten toï¼‰è¿™äº›äº‹ä»¶ï¼Œå¹¶å®šä¹‰å½“è¿™äº›äº‹ä»¶å‘å‡ºæ—¶åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚</p><p>ç°åœ¨æ¥çœ‹å…·ä½“çš„ <code>event.detail</code> å±æ€§ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦ä¼ é€’ä¸€äº›é¢å¤–çš„ä¿¡æ¯ç»™é‚£ä¸ªå¤„ç†äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚è¿™å°±æ˜¯ <code>event.detail</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> EventTarget</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onUserSignup</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">User signup with detail: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">detail</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> eventTarget</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventTarget</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">eventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">signup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onUserSignup</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signupEvent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">signup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">signupEvent</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">detail</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">newuser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> plan</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">premium</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">eventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signupEvent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>å¯¼å…¥äº† Node.js çš„ <code>events</code> æ¨¡å—ä¸­çš„ <code>Event</code> å’Œ <code>EventTarget</code> ç±»ã€‚</li><li>å®šä¹‰äº†ä¸€ä¸ª <code>onUserSignup</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†ä½œä¸ºäº‹ä»¶å¤„ç†å™¨ï¼Œå½“ç”¨æˆ·æ³¨å†Œäº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚è¯¥å‡½æ•°ä¼šæ‰“å°å‡ºäº‹ä»¶çš„ <code>detail</code> å±æ€§ã€‚</li><li>åˆ›å»ºäº†ä¸€ä¸ª <code>EventTarget</code> å®ä¾‹ï¼Œè¿™å¯ä»¥çœ‹ä½œæ˜¯ä½ çš„äº‹ä»¶å‘å¸ƒè€…ã€‚</li><li>å‘ <code>eventTarget</code> æ·»åŠ äº†ä¸€ä¸ªå¯¹ <code>signup</code> äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œå¹¶æŒ‡å®š <code>onUserSignup</code> ä¸ºå›è°ƒå‡½æ•°ã€‚</li><li>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>Event</code> å®ä¾‹ï¼Œè¡¨ç¤º <code>signup</code> äº‹ä»¶ï¼Œå¹¶è®¾ç½®äº† <code>detail</code> å±æ€§ä»¥åŒ…å«ç›¸å…³çš„ç”¨æˆ·æ•°æ®ã€‚</li><li>ä½¿ç”¨ <code>dispatchEvent</code> æ–¹æ³•è§¦å‘äº† <code>signup</code> äº‹ä»¶ï¼Œå¹¶å› æ­¤è°ƒç”¨äº† <code>onUserSignup</code> å›è°ƒå‡½æ•°ï¼Œè¾“å‡ºäº†ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚</li></ol><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»»ä½•æ—¶å€™å½“ <code>signup</code> äº‹ä»¶è¢«è§¦å‘ï¼Œæ‰€æœ‰ç›‘å¬è¯¥äº‹ä»¶çš„å‡½æ•°éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä½ æ”¾å…¥ <code>detail</code> å±æ€§ä¸­çš„æ•°æ®ã€‚è¿™æ ·ï¼Œäº‹ä»¶çš„å¤„ç†ç¨‹åºå¯ä»¥è·å¾—å…³äºå‘ç”Ÿäº‹ä»¶çš„é¢å¤–ä¿¡æ¯ï¼Œä½¿å¾—äº‹ä»¶å¤„ç†æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚</p><h3 id="class-nodeeventtarget" tabindex="-1"><a class="header-anchor" href="#class-nodeeventtarget"><span><a href="https://nodejs.org/docs/latest/api/events.html#class-nodeeventtarget" target="_blank" rel="noopener noreferrer">Class: NodeEventTarget</a></span></a></h3><p><code>NodeEventTarget</code>æ˜¯ Node.js ä¸­äº‹ä»¶æ¨¡å—çš„ä¸€ä¸ªæ ¸å¿ƒç±»ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å¯¹è±¡ç›‘å¬å’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚è¿™ä¸ªæœºåˆ¶åœ¨ JavaScript ä¸­éå¸¸å¸¸è§ï¼Œå› ä¸ºå®ƒå¸®åŠ©ä½ åˆ›å»ºå“åº”å¼çš„ç¨‹åºï¼Œå³å½“æŸäº›æƒ…å†µæˆ–åŠ¨ä½œå‘ç”Ÿæ—¶ï¼Œç¨‹åºèƒ½å¤Ÿåšå‡ºååº”ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>NodeEventTarget</code>ç±»ä¼¼äºæµè§ˆå™¨ç¯å¢ƒä¸‹çš„<code>EventTarget</code>ã€‚å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šå¸¸ä¸ä¼šç›´æ¥å®ä¾‹åŒ–ã€‚ç›¸åï¼Œå…¶ä»–ç±»ç»§æ‰¿è‡ª<code>NodeEventTarget</code>ä»¥è·å¾—äº‹ä»¶å¤„ç†åŠŸèƒ½ã€‚</p><h3 id="nodeeventtarget-çš„åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-çš„åŸºæœ¬ç”¨æ³•"><span>NodeEventTarget çš„åŸºæœ¬ç”¨æ³•</span></a></h3><p>åœ¨<code>NodeEventTarget</code>ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨å‡ ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š</p><ul><li><code>addEventListener(type, listener)</code>: ç”¨æ¥ç›‘å¬ç‰¹å®šç±»å‹çš„äº‹ä»¶ã€‚</li><li><code>removeEventListener(type, listener)</code>: ç”¨æ¥ç§»é™¤ä¹‹å‰æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨ã€‚</li><li><code>dispatchEvent(event)</code>: è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œè°ƒç”¨æ‰€æœ‰ç›¸å…³çš„ç›‘å¬å™¨ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ä¾‹å­-1-ç®€å•çš„äº‹ä»¶ç›‘å¬å’Œè§¦å‘" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç®€å•çš„äº‹ä»¶ç›‘å¬å’Œè§¦å‘"><span>ä¾‹å­ 1ï¼šç®€å•çš„äº‹ä»¶ç›‘å¬å’Œè§¦å‘</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> NodeEventTarget</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> NodeEventTarget</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®ä¾‹åŒ–è‡ªå®šä¹‰äº‹ä»¶å‘å°„å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;event&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘&#39;event&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥ Node.js ä¸­çš„<code>NodeEventTarget</code>ç±»ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>MyEmitter</code>çš„æ–°ç±»ï¼Œè¯¥ç±»ä»<code>NodeEventTarget</code>ç»§æ‰¿ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>MyEmitter</code>çš„å®ä¾‹ï¼Œè®¾ç½®äº†ä¸€ä¸ªç›‘å¬å™¨æ¥ç›‘å¬åä¸º<code>&#39;event&#39;</code>çš„äº‹ä»¶ï¼Œå¹¶åœ¨ä¹‹åæ‰‹åŠ¨è§¦å‘äº†è¿™ä¸ªäº‹ä»¶ã€‚è¿™å°†å¯¼è‡´æ‰“å°å‡ºâ€œä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘ï¼â€ã€‚</p><h4 id="ä¾‹å­-2-ä¼ é€’æ•°æ®ç»™äº‹ä»¶ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä¼ é€’æ•°æ®ç»™äº‹ä»¶ç›‘å¬å™¨"><span>ä¾‹å­ 2ï¼šä¼ é€’æ•°æ®ç»™äº‹ä»¶ç›‘å¬å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> NodeEventTarget</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Event</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> NodeEventTarget</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®ä¾‹åŒ–è‡ªå®šä¹‰äº‹ä»¶å‘å°„å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;event&#39;äº‹ä»¶å¹¶æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°æ¶ˆæ¯: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªå«æœ‰é¢å¤–å±æ€§çš„Eventå®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> customEvent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Event</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">customEvent</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘&#39;event&#39;äº‹ä»¶ï¼Œå¹¶ä¼ é€’æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">dispatchEvent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">customEvent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å‘äº‹ä»¶å¯¹è±¡æ·»åŠ ä¸€ä¸ª<code>.message</code>å±æ€§æ¥ä¼ é€’æ•°æ®ã€‚å½“è§¦å‘<code>&#39;event&#39;</code>äº‹ä»¶æ—¶ï¼Œç›‘å¬å™¨å°±å¯ä»¥æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>NodeEventTarget</code>æ˜¯ Node.js ä¸­å¤„ç†äº‹ä»¶çš„åŸºç¡€ï¼Œè€Œä¸”åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½ ä¼šç»å¸¸é‡åˆ°å®ƒï¼Œæ¯”å¦‚åœ¨å¤„ç† HTTP æœåŠ¡å™¨çš„è¯·æ±‚ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€æµæ•°æ®ç­‰åœºæ™¯ä¸­ã€‚é€šè¿‡ä½¿ç”¨äº‹ä»¶ï¼Œä½ å¯ä»¥ç¼–å†™é«˜æ•ˆä¸”æ˜“äºç®¡ç†çš„å¼‚æ­¥ä»£ç ã€‚</p><h4 id="nodeeventtarget-addlistener-type-listener" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-addlistener-type-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetaddlistenertype-listener" target="_blank" rel="noopener noreferrer">nodeEventTarget.addListener(type, listener)</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­æœ‰ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µå«åšäº‹ä»¶é©±åŠ¨ï¼ˆEvent-drivenï¼‰ï¼Œè€Œ <code>nodeEventTarget.addListener</code> å°±æ˜¯ä¸è¿™ä¸ªæ¦‚å¿µå¯†åˆ‡ç›¸å…³çš„æ–¹æ³•ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œ<code>nodeEventTarget.addListener(type, listener)</code> æ˜¯ä¸€ä¸ªç”¨äºæ³¨å†Œç›‘å¬å™¨åˆ°ç‰¹å®šäº‹ä»¶çš„å‡½æ•°ã€‚å½“è¿™ä¸ªè¢«ç›‘å¬çš„äº‹ä»¶è§¦å‘æ—¶ï¼Œå°±ä¼šè°ƒç”¨å¯¹åº”çš„ç›‘å¬å™¨å‡½æ•°ã€‚</p><p>è¿™é‡Œçš„å‚æ•°è§£é‡Šä¸€ä¸‹ï¼š</p><ul><li><code>type</code>: ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºä½ æƒ³è¦ç›‘å¬çš„äº‹ä»¶åç§°ã€‚</li><li><code>listener</code>: ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚</li></ul><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ–¹æ³•çš„å·¥ä½œåŸç†ã€‚</p><h3 id="å®ä¾‹-1-http-æœåŠ¡å™¨è¯·æ±‚äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-http-æœåŠ¡å™¨è¯·æ±‚äº‹ä»¶"><span>å®ä¾‹ 1ï¼šHTTP æœåŠ¡å™¨è¯·æ±‚äº‹ä»¶</span></a></h3><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œæ¯å½“æœ‰æ–°çš„è¯·æ±‚è¿›æ¥æ—¶ï¼Œä½ éƒ½å¸Œæœ›å¾—åˆ°é€šçŸ¥å¹¶ä½œå‡ºå¤„ç†ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ addListener æ³¨å†Œ &#39;request&#39; äº‹ä»¶çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°äº†ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæ¯å½“æœ‰ HTTP è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨æ—¶ï¼Œ<code>&#39;request&#39;</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œè€Œæˆ‘ä»¬é€šè¿‡ <code>addListener</code> æ·»åŠ çš„ç›‘å¬å™¨å‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚åœ¨ç›‘å¬å™¨å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ‰“å°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶å›å¤äº†å®¢æˆ·ç«¯ä¸€ä¸ª &quot;Hello World!&quot; çš„å“åº”ã€‚</p><h3 id="å®ä¾‹-2-è‡ªå®šä¹‰äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-è‡ªå®šä¹‰äº‹ä»¶"><span>å®ä¾‹ 2ï¼šè‡ªå®šä¹‰äº‹ä»¶</span></a></h3><p>é™¤äº†å†…ç½®çš„äº‹ä»¶ï¼Œä½ è¿˜å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶å¹¶ç›‘å¬å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>EventEmitter</code> å®ä¾‹ï¼Œç”¨æ¥å‘å°„å’Œç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ³¨å†Œè‡ªå®šä¹‰äº‹ä»¶ &#39;eventTest&#39; çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">eventTest</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">eventTest äº‹ä»¶è§¦å‘äº†ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨æŸä¸ªæ—¶åˆ»ï¼Œè§¦å‘ &#39;eventTest&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">eventTest</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 2000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>MyEmitter</code> çš„æ–°ç±»ï¼Œå®ƒç»§æ‰¿è‡ª <code>EventEmitter</code> ç±»ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºäº† <code>MyEmitter</code> çš„ä¸€ä¸ªå®ä¾‹ <code>myEmitter</code>ï¼Œå¹¶ä½¿ç”¨ <code>addListener</code> æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ªç›‘å¬ <code>&#39;eventTest&#39;</code> äº‹ä»¶çš„ç›‘å¬å™¨ã€‚ä¹‹åï¼Œåœ¨ä¸¤ç§’åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>emit</code> æ–¹æ³•è§¦å‘äº† <code>&#39;eventTest&#39;</code> äº‹ä»¶ï¼Œè¿™å¯¼è‡´æˆ‘ä»¬çš„ç›‘å¬å™¨å‡½æ•°è¢«æ‰§è¡Œå¹¶æ‰“å°å‡ºä¿¡æ¯ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>nodeEventTarget.addListener</code> çš„ä½œç”¨æ˜¯ç»™æŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œæ¯å½“è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰æ³¨å†Œçš„å¤„ç†å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚è¿™æ ·ä½¿å¾—ä½ çš„ç¨‹åºèƒ½å¼‚æ­¥åœ°å“åº”å„ç§äº‹ä»¶ï¼Œå¦‚ç”¨æˆ·è¯·æ±‚ã€æ–‡ä»¶è¯»å†™å®Œæˆç­‰ï¼Œæ˜¯ç¼–å†™é«˜æ•ˆä¸”å¯æ‰©å±• Node.js åº”ç”¨çš„åŸºç¡€ã€‚</p><h4 id="nodeeventtarget-emit-type-arg" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-emit-type-arg"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetemittype-arg" target="_blank" rel="noopener noreferrer">nodeEventTarget.emit(type, arg)</a></span></a></h4><p>å¥½çš„ï¼Œæˆ‘ä¼šç›´æ¥è¿›å…¥ä¸»é¢˜ã€‚</p><p><code>nodeEventTarget.emit(type, arg)</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå±äº Node.js çš„â€œeventsâ€æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—å…è®¸æˆ‘ä»¬åˆ›å»ºå’Œç®¡ç†è‡ªå®šä¹‰äº‹ä»¶ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå†…ç½®å¯¹è±¡éƒ½æ˜¯åŸºäºäº‹ä»¶çš„ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨ã€æ–‡ä»¶æµç­‰ï¼Œå®ƒä»¬ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨çš„æ¶æ„ã€‚</p><h3 id="emit-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#emit-æ–¹æ³•çš„ä½œç”¨"><span><code>emit()</code> æ–¹æ³•çš„ä½œç”¨ï¼š</span></a></h3><p><code>emit()</code>æ–¹æ³•çš„ä½œç”¨æ˜¯è§¦å‘æŒ‡å®šçš„äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ä¼ é€’å‚æ•°ç»™äº‹ä»¶ç›‘å¬å™¨ï¼ˆevent listenersï¼‰ã€‚å½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œæ‰€æœ‰ç»‘å®šåˆ°è¯¥ç‰¹å®šäº‹ä»¶ç±»å‹çš„ç›‘å¬å™¨éƒ½ä¼šè¢«åŒæ­¥åœ°è°ƒç”¨ã€‚</p><h3 id="å‚æ•°è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯´æ˜"><span>å‚æ•°è¯´æ˜ï¼š</span></a></h3><ul><li><code>type</code>: è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¡¨ç¤ºè¦è§¦å‘çš„äº‹ä»¶çš„åç§°ã€‚</li><li><code>arg</code>: è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œä»£è¡¨äº‹ä»¶å¤„ç†å‡½æ•°æ—¶æ¥æ”¶çš„æ•°æ®ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-11"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h3><h4 id="ç¤ºä¾‹-1-æ™®é€šäº‹ä»¶çš„è§¦å‘" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ™®é€šäº‹ä»¶çš„è§¦å‘"><span>ç¤ºä¾‹ 1ï¼šæ™®é€šäº‹ä»¶çš„è§¦å‘</span></a></h4><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„äº‹ä»¶å‘å°„å™¨ï¼Œå½“æŸä¸ªæ“ä½œå®Œæˆæ—¶ï¼Œä½ æƒ³è¦å‘å‡ºä¸€ä¸ªä¿¡å·ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬äº‹ä»¶ï¼Œå½“&#39;event&#39;äº‹ä»¶è¢«è§¦å‘æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">äº‹ä»¶å·²è¢«è§¦å‘ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨æŸä¸ªæ—¶é—´ç‚¹è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºå°†ä¼šæ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>äº‹ä»¶å·²è¢«è§¦å‘ï¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>myEmitter</code>æ˜¯è‡ªå®šä¹‰çš„äº‹ä»¶å‘å°„å™¨ï¼Œå®ƒé€šè¿‡<code>.on()</code>æ–¹æ³•è®¾ç½®äº†ä¸€ä¸ªç›‘å¬å™¨æ¥ç›‘å¬åä¸º<code>&#39;event&#39;</code>çš„äº‹ä»¶ã€‚ç„¶åï¼Œé€šè¿‡<code>.emit()</code>æ–¹æ³•è§¦å‘äº†è¿™ä¸ªäº‹ä»¶ï¼Œå¯¼è‡´ä¸Šé¢å®šä¹‰çš„å›è°ƒå‡½æ•°è¢«æ‰§è¡Œã€‚</p><h4 id="ç¤ºä¾‹-2-å¸¦å‚æ•°çš„äº‹ä»¶-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¸¦å‚æ•°çš„äº‹ä»¶-1"><span>ç¤ºä¾‹ 2ï¼šå¸¦å‚æ•°çš„äº‹ä»¶</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyEmitter</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> EventEmitter</span><span style="color:#ECEFF4;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬äº‹ä»¶ï¼Œåœ¨äº‹ä»¶è§¦å‘æ—¶æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°çŠ¶æ€ç ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> å’Œä¿¡æ¯ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">msg</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘äº‹ä»¶å¹¶å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ok</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºå°†ä¼šæ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>æ”¶åˆ°çŠ¶æ€ç ï¼š200 å’Œä¿¡æ¯ï¼šok</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>.emit()</code>æ–¹æ³•é™¤äº†äº‹ä»¶å<code>&#39;status&#39;</code>ä¹‹å¤–ï¼Œè¿˜ä¼ é€’äº†ä¸¤ä¸ªå‚æ•°<code>200</code>å’Œ<code>&#39;ok&#39;</code>ã€‚ç›‘å¬<code>&#39;status&#39;</code>äº‹ä»¶çš„ç›‘å¬å™¨æ¥æ”¶è¿™äº›å‚æ•°ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿç†è§£<code>emit()</code>æ–¹æ³•åœ¨ Node.js ä¸­çš„ä½¿ç”¨æ–¹å¼åŠå…¶é‡è¦æ€§äº†ã€‚å®ƒæ˜¯äº‹ä»¶é©±åŠ¨ç¼–ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œéå¸¸æœ‰ç”¨äºå¤„ç†ä¾‹å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰å¼‚æ­¥ä»»åŠ¡çš„ç»“æœå’Œé”™è¯¯ã€‚</p><h4 id="nodeeventtarget-eventnames" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-eventnames"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargeteventnames" target="_blank" rel="noopener noreferrer">nodeEventTarget.eventNames()</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„å¹³å°ï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶æ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå…è®¸ä½ åœ¨å‘ç”ŸæŸäº›äº‹æƒ…ï¼ˆä¾‹å¦‚ç”¨æˆ·è¿æ¥ã€æ–‡ä»¶è¯»å–å®Œæˆç­‰ï¼‰æ—¶æ‰§è¡Œç›¸åº”çš„ä»£ç ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º <code>EventEmitter</code> çš„æ ¸å¿ƒæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—ç”¨äºå¤„ç†äº‹ä»¶ã€‚ä»»ä½•ä¸€ä¸ªç»§æ‰¿è‡ª <code>EventEmitter</code> ç±»çš„å¯¹è±¡éƒ½èƒ½å¤Ÿå‘å¸ƒï¼ˆemitï¼‰äº‹ä»¶å’Œç›‘å¬ï¼ˆonï¼‰äº‹ä»¶ã€‚</p><p>å…¶ä¸­ï¼Œ<code>eventNames()</code> æ–¹æ³•æ˜¯ <code>EventEmitter</code> çš„ä¸€ä¸ªå®ç”¨å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†å½“å‰ EventEmitter å®ä¾‹ä¸Šæ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨çš„åç§°ã€‚è¿™ä¸ªæ–¹æ³•å¯¹äºè°ƒè¯•æˆ–è€…äº†è§£ä¸€ä¸ª EventEmitter å®ä¾‹çš„çŠ¶æ€å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•ä½¿ç”¨ <code>eventNames()</code> æ–¹æ³•çš„ç®€å•ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬ä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬äºŒä¸ªäº‹ä»¶è¢«è§¦å‘ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ eventNames() è·å–æ³¨å†Œçš„äº‹ä»¶å</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> eventNames</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">eventNames</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">eventNames</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: [ &#39;event1&#39;, &#39;event2&#39; ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬å¼•å…¥äº†å†…ç½®çš„ <code>events</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>myEmitter</code> çš„ <code>EventEmitter</code> å®ä¾‹ã€‚</li><li>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>on()</code> æ–¹æ³•ç»™ <code>myEmitter</code> æ·»åŠ äº†ä¸¤ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œåˆ†åˆ«ç›‘å¬åä¸º <code>event1</code> å’Œ <code>event2</code> çš„äº‹ä»¶ã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>eventNames()</code> æ–¹æ³•å¹¶æ‰“å°å…¶è¿”å›å€¼ï¼Œè¿™å°†è¾“å‡ºä¸€ä¸ªåŒ…å« <code>&#39;event1&#39;</code> å’Œ <code>&#39;event2&#39;</code> çš„æ•°ç»„ã€‚</li></ol><p>å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œ<code>eventNames()</code> æ–¹æ³•é€šå¸¸ç”¨äºè°ƒè¯•ï¼Œå½“ä½ æƒ³çŸ¥é“ä¸€ä¸ªå¤æ‚çš„ EventEmitter å®ä¾‹ä¸Šç©¶ç«Ÿç›‘å¬äº†å“ªäº›äº‹ä»¶æ—¶ï¼Œæˆ–è€…åœ¨åšå•å…ƒæµ‹è¯•çš„æ—¶å€™æ£€æŸ¥äº‹ä»¶æ˜¯å¦æ­£ç¡®æ·»åŠ æˆ–ç§»é™¤ï¼Œ<code>eventNames()</code> æ–¹æ³•å°±æ˜¾å¾—ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h4 id="nodeeventtarget-listenercount-type" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-listenercount-type"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetlistenercounttype" target="_blank" rel="noopener noreferrer">nodeEventTarget.listenerCount(type)</a></span></a></h4><p><code>nodeEventTarget.listenerCount(type)</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒç”¨æ¥è®¡ç®—æŒ‡å®šäº‹ä»¶çš„ç›‘å¬å™¨ï¼ˆä¹Ÿå°±æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰æ•°é‡ã€‚åœ¨è¿™é‡Œï¼Œ<code>nodeEventTarget</code> é€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªç»§æ‰¿äº† <code>EventEmitter</code> ç±»çš„å¯¹è±¡ã€‚<code>EventEmitter</code> æ˜¯ Node.js ä¸­ç”¨äºå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒç±»ã€‚</p><p>ç°åœ¨æˆ‘æ¥é€šä¿—åœ°è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µï¼š</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ç»„ç»‡äº†ä¸€ä¸ªèšä¼šï¼Œå¹¶å‡†å¤‡äº†ä¸€ç³»åˆ—æ´»åŠ¨ã€‚ä½ å¸Œæœ›æ¯å½“ä¸€ä¸ªç‰¹å®šçš„æ´»åŠ¨å¼€å§‹æ—¶ï¼Œå‚åŠ çš„äººèƒ½å¤Ÿåšå‡ºç›¸åº”çš„ååº”ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œè¿™æ ·çš„â€œæ´»åŠ¨â€å«åšâ€œäº‹ä»¶â€ï¼Œè€Œå¯¹åº”çš„â€œååº”â€å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œç›‘å¬å™¨â€æˆ–â€œäº‹ä»¶å¤„ç†å‡½æ•°â€ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>EventEmitter</code> æ¥ç»„ç»‡å’Œç®¡ç†è¿™äº›äº‹ä»¶ä¸ç›‘å¬å™¨ã€‚æ¯ä¸ªäº‹ä»¶éƒ½æœ‰ä¸€ä¸ªåç§°ï¼ˆæ¯”å¦‚ &quot;å¼€å§‹&quot;ã€&quot;ç»“æŸ&quot; ç­‰ï¼‰ï¼Œè€Œå¯¹åº”çš„ç›‘å¬å™¨åˆ™æ˜¯å½“è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶éœ€è¦æ‰§è¡Œçš„ä»£ç ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³çŸ¥é“æœ‰å¤šå°‘äººï¼ˆå³ç›‘å¬å™¨ï¼‰åœ¨å…³æ³¨æŸä¸ªæ´»åŠ¨ï¼ˆå³äº‹ä»¶ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>listenerCount</code> æ–¹æ³•æ¥è·å¾—è¿™ä¸ªä¿¡æ¯ã€‚</p><p>ä¸¾ä¸ªå®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª eventEmitter å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;connection&#39; äº‹ä»¶ï¼Œæ·»åŠ ä¸¤ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬ä¸€ä¸ªè¿æ¥ç›‘å¬å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç¬¬äºŒä¸ªè¿æ¥ç›‘å¬å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ listenerCount è·å– &#39;connection&#39; äº‹ä»¶çš„ç›‘å¬å™¨æ•°é‡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> connectionListenerCount</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listenerCount</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  `</span><span style="color:#A3BE8C;">&#39;connection&#39; äº‹ä»¶æœ‰ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">connectionListenerCount</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> ä¸ªç›‘å¬å™¨æ­£åœ¨ç›‘å¬ã€‚</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>events</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>EventEmitter</code> å®ä¾‹ <code>myEmitter</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>myEmitter.on</code> æ–¹æ³•ç»™ &#39;connection&#39; äº‹ä»¶æ·»åŠ äº†ä¸¤ä¸ªç›‘å¬å™¨ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>myEmitter.listenerCount(&#39;connection&#39;)</code> æ¥è·å–å¹¶æ‰“å° &#39;connection&#39; äº‹ä»¶çš„ç›‘å¬å™¨æ•°é‡ã€‚</p><p>å½“è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œä½ ä¼šåœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>&#39;connection&#39; äº‹ä»¶æœ‰ 2 ä¸ªç›‘å¬å™¨æ­£åœ¨ç›‘å¬ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ„å‘³ç€å½“å‰æœ‰ä¸¤ä¸ªç›‘å¬å™¨å…³æ³¨ç€ &#39;connection&#39; äº‹ä»¶ã€‚è¿™ç§ç»Ÿè®¡ç›‘å¬å™¨æ•°é‡çš„åŠŸèƒ½åœ¨ç®¡ç†äº‹ä»¶æ—¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ ¹æ®ç›‘å¬å™¨çš„æ•°é‡å†³å®šæ˜¯å¦ç»§ç»­æ·»åŠ æ–°çš„ç›‘å¬å™¨æˆ–è€…ç§»é™¤ä¸€äº›ä¸å†éœ€è¦çš„ç›‘å¬å™¨ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼æˆ–å…¶ä»–æ½œåœ¨é—®é¢˜ã€‚</p><h4 id="nodeeventtarget-setmaxlisteners-n" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-setmaxlisteners-n"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetsetmaxlistenersn" target="_blank" rel="noopener noreferrer">nodeEventTarget.setMaxListeners(n)</a></span></a></h4><p><code>nodeEventTarget.setMaxListeners(n)</code> æ˜¯ Node.js äº‹ä»¶æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè®¾ç½®æŸä¸ªç‰¹å®š EventEmitterï¼ˆäº‹ä»¶å‘å°„å™¨ï¼‰å®ä¾‹å¯ä»¥ç»‘å®šçš„æœ€å¤§äº‹ä»¶ç›‘å¬å™¨æ•°é‡ã€‚åœ¨è§£é‡Šè¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº› Node.js ä¸­äº‹ä»¶å¤„ç†çš„åŸºç¡€æ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒç±»ï¼Œå¾ˆå¤š Node.js çš„å†…ç½®æ¨¡å—éƒ½ç»§æ‰¿è‡ªè¿™ä¸ªç±»ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¹¿æ’­ç«™ï¼Œå„ç§äº‹ä»¶å°±åƒä¸åŒçš„èŠ‚ç›®ï¼Œè€Œç›‘å¬å™¨åˆ™å¥½æ¯”æ”¶éŸ³æœºï¼Œå½“å¹¿æ’­ç«™æ’­æ”¾æŸä¸ªèŠ‚ç›®æ—¶ï¼Œå¯¹åº”é¢‘é“çš„æ”¶éŸ³æœºå°±èƒ½æ¥æ”¶åˆ°ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œä¸€ä¸ª EventEmitter é»˜è®¤æœ€å¤šåªèƒ½æ·»åŠ  10 ä¸ªç›‘å¬å™¨åˆ°ä¸€ä¸ªäº‹ä»¶ä¸Šã€‚å¦‚æœä½ æ·»åŠ äº†è¶…è¿‡ 10 ä¸ªç›‘å¬å™¨ï¼ŒNode.js å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºä½ å¯èƒ½åˆ›å»ºäº†å†…å­˜æ³„æ¼ã€‚</p><p>æœ‰æ—¶å€™ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å…è®¸è¶…è¿‡ 10 ä¸ªç›‘å¬å™¨ç»‘å®šåˆ°ä¸€ä¸ªäº‹ä»¶ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤§å‹æœåŠ¡å™¨åº”ç”¨ï¼Œå¯èƒ½æœ‰å¤šäº 10 ä¸ªåœ°æ–¹éœ€è¦å“åº”åŒä¸€ä¸ªäº‹ä»¶ï¼Œè¿™æ ·é»˜è®¤çš„é™åˆ¶å°±å¤ªå°äº†ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>setMaxListeners(n)</code> æ–¹æ³•æ¥è°ƒæ•´è¿™ä¸ªé™åˆ¶ã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>nodeEventTarget.setMaxListeners(n)</code> æ–¹æ³•çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ EventEmitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”¨ setMaxListeners æ–¹æ³•æé«˜ç›‘å¬å™¨çš„æœ€å¤§æ•°é‡</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ è¶…è¿‡ 10 ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 15</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Listener number </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">i</span><span style="color:#81A1C1;"> +</span><span style="color:#B48EAD;"> 1</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> is listening</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;event&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>events</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª <code>myEmitter</code> å®ä¾‹ã€‚æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>setMaxListeners(20)</code> å°† <code>myEmitter</code> ä¸Šå¯é™„åŠ çš„æœ€å¤§ç›‘å¬å™¨æ•°é‡è®¾ç½®ä¸º 20 ä¸ªã€‚ç„¶åæˆ‘ä»¬æ·»åŠ äº† 15 ä¸ªç›‘å¬å™¨ï¼Œè¿™äº›ç›‘å¬å™¨æ‰“å°å‡ºä¸€æ¡æ¶ˆæ¯è¡¨æ˜å®ƒä»¬æ­£åœ¨ç›‘å¬ï¼Œæœ€åæˆ‘ä»¬è§¦å‘äº† &#39;event&#39; äº‹ä»¶ï¼Œæ‰€æœ‰çš„ç›‘å¬å™¨ä¾æ¬¡æ‰“å°å‡ºæ¶ˆæ¯ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>nodeEventTarget.setMaxListeners(n)</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ ¹æ®å…·ä½“åº”ç”¨éœ€æ±‚è°ƒæ•´äº‹ä»¶ç›‘å¬å™¨çš„æœ€å¤§æ•°é‡é™åˆ¶ï¼Œè¿›è€Œé¿å… Node.js é»˜è®¤çš„ç›‘å¬å™¨æ•°é‡é™åˆ¶æ‰€å¼•å‘çš„è­¦å‘Šï¼Œå¹¶å…è®¸ç¨‹åºæ­£å¸¸å·¥ä½œã€‚</p><h4 id="nodeeventtarget-getmaxlisteners" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-getmaxlisteners"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetgetmaxlisteners" target="_blank" rel="noopener noreferrer">nodeEventTarget.getMaxListeners()</a></span></a></h4><p>Node.js ä¸­çš„ <code>EventEmitter</code> ç±»æ˜¯ç”¨æ¥å¤„ç†äº‹ä»¶çš„æ ¸å¿ƒã€‚ä½ å¯ä»¥è®¤ä¸ºå®ƒå°±åƒä¸€ä¸ªç”µå°ï¼Œè€Œäº‹ä»¶å°±åƒä¸åŒçš„é¢‘é“ã€‚å½“ä½ æƒ³è¦ç›‘å¬ï¼ˆå³è®¢é˜…ï¼‰æŸä¸ªç‰¹å®šé¢‘é“æ—¶ï¼Œä½ å°±ä¼šç»™è¿™ä¸ªé¢‘é“è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ï¼ˆlistenerï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚æ¯å½“é‚£ä¸ªé¢‘é“æ’­æ”¾å†…å®¹æ—¶ï¼ˆå³äº‹ä»¶è§¦å‘æ—¶ï¼‰ï¼Œå¯¹åº”çš„ç›‘å¬å™¨å°±ä¼šè¢«è°ƒç”¨ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šç›‘å¬å™¨ç»‘å®šåˆ°åŒä¸€ä¸ªäº‹ä»¶ä¸Šã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªäº‹ä»¶ä¸Šæ·»åŠ äº†å¤ªå¤šçš„ç›‘å¬å™¨ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå†…å­˜æ³„æ¼çš„ä¿¡å·ã€‚ä¸ºäº†é¢„é˜²æ½œåœ¨çš„é—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†è¶…è¿‡ 10 ä¸ªç›‘å¬å™¨ï¼ŒNode.js ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šã€‚</p><p><code>getMaxListeners()</code> è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è·å–æŸä¸ª <code>EventEmitter</code> å®ä¾‹æ‰€å…è®¸ç»‘å®šçš„æœ€å¤§ç›‘å¬å™¨æ•°é‡ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä»£ç ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªå‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p><p>é¦–å…ˆï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ <code>EventEmitter</code> å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> emitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>getMaxListeners()</code> å‡½æ•°æ¥æŸ¥çœ‹æœ€å¤§ç›‘å¬å™¨æ•°é‡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getMaxListeners</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é»˜è®¤æƒ…å†µä¸‹è¾“å‡º 10</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¼šè¾“å‡ºâ€œ10â€ï¼Œå› ä¸ºè¿™æ˜¯ Node.js çš„é»˜è®¤å€¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æ”¹å˜è¿™ä¸ªé™åˆ¶ï¼Œå¯èƒ½ä¼šä½¿ç”¨ <code>emitter.setMaxListeners(n)</code> æ–¹æ³•ï¼Œå…¶ä¸­ <code>n</code> æ˜¯æ–°çš„é™åˆ¶æ•°ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setMaxListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getMaxListeners</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç°åœ¨ä¼šè¾“å‡º 20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠæœ€å¤§ç›‘å¬å™¨çš„æ•°é‡ä» 10 å¢åŠ åˆ°äº† 20ï¼Œéšåç¡®è®¤äº†è¿™ä¸€å˜åŒ–ã€‚</p><p><code>getMaxListeners()</code> å‡½æ•°çš„å…¸å‹ç”¨é€”æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ£€æŸ¥å’Œè°ƒè¯•ï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ— æ„ä¸­è¶…è¿‡ç›‘å¬å™¨çš„æ¨èé™åˆ¶ï¼Œæˆ–è€…åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°è°ƒæ•´è¿™ä¸ªé™åˆ¶ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š<code>getMaxListeners()</code> å°±åƒæ˜¯ä½ æŸ¥çœ‹ä¸€æ¬¡ç”µè§†æœºèƒ½æ¥å—å¤šå°‘ä¸ªé¢‘é“çš„é¥æ§å™¨çš„æŒ‰é’®ä¸€æ ·ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®ƒæ˜¾ç¤ºçš„æ•°å­—æ˜¯ 10ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è¦æ›´å¤šï¼Œä½ å¯ä»¥é€šè¿‡å…¶ä»–çš„æŒ‰é’®ï¼ˆæ–¹æ³•ï¼‰<code>setMaxListeners(n)</code> æ¥å¢åŠ è¿™ä¸ªæ•°å­—ã€‚è¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†å¸®åŠ©ä½ ç®¡ç†ä½ çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…å› ä¸ºè®¾ç½®äº†å¤ªå¤šç›‘å¬å™¨è€Œå¯¼è‡´ç”µè§†ï¼ˆç¨‹åºï¼‰å‡ºé—®é¢˜ã€‚</p><h4 id="nodeeventtarget-off-type-listener-options" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-off-type-listener-options"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetofftype-listener-options" target="_blank" rel="noopener noreferrer">nodeEventTarget.off(type, listener[, options])</a></span></a></h4><p>å½“ç„¶ï¼Œæˆ‘å¾ˆä¹æ„è§£é‡Šç»™ä½ å¬ã€‚Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒèƒ½è®©ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¸®åŠ©æˆ‘ä»¬å¤„ç†å¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­æœ‰ä¸€ä¸ªç§°ä¸º <code>EventEmitter</code> çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒç”¨äºå¤„ç†äº‹ä»¶ã€‚ä»»ä½•ç»§æ‰¿äº† <code>EventEmitter</code> çš„å¯¹è±¡éƒ½å¯ä»¥å‘å‡ºï¼ˆemitï¼‰å’Œç›‘å¬ï¼ˆonï¼‰äº‹ä»¶ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ <code>nodeEventTarget.off(type, listener[, options])</code> è¿™ä¸ªæ–¹æ³•æ˜¯æ€æ ·å·¥ä½œçš„ã€‚</p><p>é¦–å…ˆï¼Œè¿™é‡Œçš„å‡ ä¸ªæœ¯è¯­è§£é‡Šä¸€ä¸‹ï¼š</p><ul><li><code>type</code>: äº‹ä»¶çš„åç§°ã€‚</li><li><code>listener</code>: å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œä¼šè°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚</li><li><code>options</code>: é¢å¤–çš„é…ç½®é€‰é¡¹ï¼Œé€šå¸¸æ˜¯å¯é€‰çš„ã€‚</li></ul><p><code>off</code> æ–¹æ³•å±äº <code>events</code> æ¨¡å—ï¼Œå¹¶ä¸”æ˜¯ <code>EventEmitter</code> çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ä»æŒ‡å®šçš„äº‹ä»¶ç›‘å¬å™¨æ•°ç»„ä¸­ç§»é™¤ä¸€ä¸ªç›‘å¬å™¨ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºåœæ­¢ç›‘å¬ä¹‹å‰é€šè¿‡ <code>.on()</code> æˆ– <code>.addListener()</code> æ–¹æ³•æ·»åŠ çš„ç‰¹å®šäº‹ä»¶ã€‚</p><p>æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª event emitter å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> myListener</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">äº‹ä»¶è¢«è§¦å‘äº†ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ .on() æ–¹æ³•ç›‘å¬ &#39;myEvent&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> myListener</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è§¦å‘ &#39;myEvent&#39;ï¼Œä¼šçœ‹åˆ°æ§åˆ¶å°æ‰“å° &quot;äº‹ä»¶è¢«è§¦å‘äº†ï¼&quot;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¸å†éœ€è¦ myListener å›è°ƒå“åº” &#39;myEvent&#39; äº‹ä»¶äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒç§»é™¤</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">off</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> myListener</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å†æ¬¡è§¦å‘ &#39;myEvent&#39;ï¼Œä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºï¼Œå› ä¸ºç›‘å¬å™¨å·²ç»è¢«ç§»é™¤äº†</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myEvent</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>myEmitter</code> çš„ <code>EventEmitter</code> å®ä¾‹ã€‚</li><li>å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° <code>myListener</code> ä½œä¸ºäº‹ä»¶çš„å›è°ƒã€‚</li><li>ä½¿ç”¨ <code>myEmitter.on(&#39;myEvent&#39;, myListener)</code> ç›‘å¬äº†ä¸€ä¸ªåä¸º <code>&#39;myEvent&#39;</code> çš„äº‹ä»¶ï¼Œå¹¶ä¸”å½“è¿™ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡º <code>&quot;äº‹ä»¶è¢«è§¦å‘äº†ï¼&quot;</code>ã€‚</li><li>é€šè¿‡ <code>myEmitter.emit(&#39;myEvent&#39;)</code> è§¦å‘äº†äº‹ä»¶ã€‚</li><li>ç„¶åæˆ‘ä»¬å†³å®šä¸å†ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½¿ç”¨ <code>myEmitter.off(&#39;myEvent&#39;, myListener)</code> ç§»é™¤äº†ä¹‹å‰è®¾ç½®çš„ç›‘å¬å™¨ã€‚</li><li>æœ€åï¼Œå½“æˆ‘ä»¬å†æ¬¡å°è¯•è§¦å‘ <code>&#39;myEvent&#39;</code> æ—¶ï¼Œæ²¡æœ‰ä»»ä½•ååº”ï¼Œå› ä¸ºæ²¡æœ‰ç›‘å¬å™¨ä¸ä¹‹å…³è”ã€‚</li></ol><p>æ‰€ä»¥ï¼Œ<code>off</code> æ–¹æ³•å°±åƒæ˜¯ä¸€ä¸ªå¼€å…³ï¼Œå¯ä»¥å…³é—­æˆ‘ä»¬å¯¹æŸä¸ªäº‹ä»¶çš„ç›‘å¬ï¼Œç¡®ä¿å½“ç‰¹å®šçš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¸å†è°ƒç”¨æŸä¸ªç‰¹å®šçš„å›è°ƒå‡½æ•°ã€‚è¿™åœ¨ä½ ä¸å†éœ€è¦å“åº”æŸä¸ªäº‹ä»¶ï¼Œæˆ–è€…æƒ³è¦æ¸…ç†èµ„æºä»¥é˜²å†…å­˜æ³„æ¼æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h4 id="nodeeventtarget-on-type-listener" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-on-type-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetontype-listener" target="_blank" rel="noopener noreferrer">nodeEventTarget.on(type, listener)</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>nodeEventTarget.on(type, listener)</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨è®¨è®ºäº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µã€‚è¿™é‡Œæˆ‘å°†å°½å¯èƒ½é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šå®ƒï¼Œå¹¶ä¸¾ä¸€äº›å®é™…çš„ä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-3"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œ<code>nodeEventTarget.on(type, listener)</code>æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨ Node.js çš„ EventTarget å¯¹è±¡ä¸Šæ³¨å†Œç›‘å¬å™¨ï¼ˆlistenerï¼‰ã€‚è¿™ä¸ªç›‘å¬å™¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šåœ¨æŒ‡å®šç±»å‹ï¼ˆtypeï¼‰çš„äº‹ä»¶å‘ç”Ÿæ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><ul><li><strong>type</strong>ï¼šäº‹ä»¶çš„ç±»å‹ï¼Œæ¯”å¦‚&#39;click&#39;, &#39;load&#39;, &#39;error&#39;ç­‰ï¼Œè¿™å–å†³äºä½ æ­£åœ¨ä½¿ç”¨çš„å…·ä½“å¯¹è±¡å’Œå®ƒæ”¯æŒçš„äº‹ä»¶ç±»å‹ã€‚</li><li><strong>listener</strong>ï¼šå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¦è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶åˆ°ä¸äº‹ä»¶ç›¸å…³çš„å‚æ•°ï¼Œå¹¶æ ¹æ®è¿™äº›å‚æ•°è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</li></ul><p>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ˜¯ Node.js çš„ä¸€ä¸ªåŸºçŸ³ï¼Œå®ƒå…è®¸æˆ‘ä»¬çš„ç¨‹åºåœ¨ç­‰å¾…æŸäº›äº‹æƒ…å‘ç”Ÿæ—¶ç»§ç»­è¿è¡Œå…¶ä»–ä»£ç ï¼Œè€Œä¸æ˜¯é™æ­¢ä¸åŠ¨ã€‚å½“æ‰€ç­‰å¾…çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªæ–‡ä»¶åŠ è½½å®Œæˆï¼‰ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ‰§è¡Œç›¸å…³çš„å¤„ç†å‡½æ•°ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ Node.js æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åæ‰“å°ä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨&#39;on&#39;æ–¹æ³•ç›‘å¬&#39;listening&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">listening</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„<code>http</code>æ¨¡å—ï¼Œç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>server.on(&#39;listening&#39;, callback)</code>æ¥ç›‘å¬æœåŠ¡å™¨çš„<code>listening</code>äº‹ä»¶ã€‚å½“æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£æ—¶ï¼ˆå³æˆåŠŸå¯åŠ¨åï¼‰ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ª<code>listening</code>äº‹ä»¶ï¼Œéšåè°ƒç”¨æˆ‘ä»¬æä¾›çš„å›è°ƒå‡½æ•°ï¼Œåœ¨æ§åˆ¶å°æ‰“å°å‡ºä¸€æ¡æ¶ˆæ¯ã€‚</p><p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬æ›´å¤šçš„äº‹ä»¶ï¼Œå¦‚é”™è¯¯å¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ä½¿ç”¨&#39;on&#39;æ–¹æ³•ç›‘å¬&#39;error&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨å°è¯•å¯åŠ¨æ—¶é‡åˆ°ä»»ä½•é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œç«¯å£å·²è¢«å ç”¨ï¼‰ï¼Œ<code>error</code>äº‹ä»¶å°†è¢«è§¦å‘ï¼Œæˆ‘ä»¬çš„ç›‘å¬å™¨å‡½æ•°æ¥æ”¶åˆ°é”™è¯¯å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œéšååœ¨æ§åˆ¶å°æ‰“å°å‡ºé”™è¯¯è¯¦æƒ…ã€‚</p><h3 id="æ€»ç»“-10" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-10"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä½¿ç”¨<code>nodeEventTarget.on(type, listener)</code>ï¼Œä½ å¯ä»¥è®©ä½ çš„ Node.js åº”ç”¨å“åº”å„ç§äº‹ä»¶ï¼Œè¿™å¯¹äºåˆ›å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚ä¸Šè¿°ä¾‹å­åªæ˜¯å†°å±±ä¸€è§’ï¼Œä½†åº”è¯¥è¶³ä»¥è®©ä½ å¼€å§‹æ€è€ƒå¦‚ä½•åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­åˆ©ç”¨äº‹ä»¶æ¥è§¦å‘ä»£ç çš„æ‰§è¡Œã€‚</p><h4 id="nodeeventtarget-once-type-listener" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-once-type-listener"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetoncetype-listener" target="_blank" rel="noopener noreferrer">nodeEventTarget.once(type, listener)</a></span></a></h4><p>å½“ç„¶ï¼Œæˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹<code>nodeEventTarget.once(type, listener)</code>è¿™ä¸ªæ–¹æ³•ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶æ˜¯ä¸€ç§é‡è¦çš„æœºåˆ¶ï¼Œå…è®¸å¯¹è±¡ï¼ˆç§°ä¸ºâ€œå‘å°„å™¨â€ï¼‰å‘å‡ºï¼ˆå³â€œå‘å°„â€ï¼‰å‘½åäº‹ä»¶ï¼Œä»è€Œå¯¼è‡´é¢„å…ˆæŒ‡å®šçš„å‡½æ•°ï¼ˆç§°ä¸ºâ€œç›‘å¬å™¨â€æˆ–â€œå¤„ç†ç¨‹åºâ€ï¼‰è¢«è°ƒç”¨ã€‚Node.js è‡ªå¸¦äº† <code>events</code> æ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†æ„å»ºäº‹ä»¶é©±åŠ¨ç¨‹åºçš„èƒ½åŠ›ã€‚</p><p>åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªé‡è¦çš„ç±»ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ›å»ºå‘å°„å™¨å®ä¾‹ã€‚<code>nodeEventTarget.once()</code> æ–¹æ³•æ˜¯ <code>EventEmitter</code> çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸ºç‰¹å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªå•æ¬¡ç›‘å¬å™¨ã€‚è¿™æ„å‘³ç€ä¸€æ—¦åŒ¹é…çš„äº‹ä»¶è¢«å‘å°„ï¼Œç›‘å¬å™¨å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åå®ƒä¼šè‡ªåŠ¨ç§»é™¤ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>type</code>: è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç›‘å¬çš„äº‹ä»¶åç§°ã€‚</li><li><code>listener</code>: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“äº‹ä»¶è¢«å‘å°„å¹¶ä¸”ç±»å‹åŒ¹é…æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›å®é™…çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-æœåŠ¡å™¨è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æœåŠ¡å™¨è¯·æ±‚"><span>ä¾‹å­ 1: æœåŠ¡å™¨è¯·æ±‚</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ æƒ³è¦è®°å½•æ¯ä¸ªå®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>.once()</code> æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™ä¸ªå›è°ƒæ¯æ¬¡æœ‰è¯·æ±‚æ¥éƒ½ä¼šè°ƒç”¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request received</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™ä¸ªå›è°ƒåªåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶è°ƒç”¨</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">First request received</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨å¯¹æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ‰“å° <code>&quot;Request received&quot;</code>ã€‚ä½†æ˜¯ï¼Œå®ƒåªä¼šåœ¨æ”¶åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚æ—¶æ‰“å° <code>&quot;First request received&quot;</code>ã€‚</p><h3 id="ä¾‹å­-2-æ¸…ç†èµ„æº" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ¸…ç†èµ„æº"><span>ä¾‹å­ 2: æ¸…ç†èµ„æº</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œå¦‚è¯»å–å¤§æ–‡ä»¶ï¼Œå¹¶ä¸”ä½ å¸Œæœ›åœ¨æ“ä½œå®Œæˆåæ¸…ç†èµ„æºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./large-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ–‡ä»¶è¯»å–å®Œæ¯•åï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè§¦å‘ä¸€æ¬¡</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Stream closed, resources cleaned up.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†æ–‡ä»¶æ•°æ®...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶å¤„ç†å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œç¡®ä¿äº†åœ¨æ–‡ä»¶æµå…³é—­åè¿›è¡Œå¿…è¦çš„èµ„æºæ¸…ç†ã€‚</p><h3 id="ä¾‹å­-3-ç”¨æˆ·åªèƒ½ä¸€æ¬¡æ€§æ³¨å†Œ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-ç”¨æˆ·åªèƒ½ä¸€æ¬¡æ€§æ³¨å†Œ"><span>ä¾‹å­ 3: ç”¨æˆ·åªèƒ½ä¸€æ¬¡æ€§æ³¨å†Œ</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> userEvents</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">userEvents</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">once</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">register</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> has registered.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨æ¨¡æ‹Ÿç”¨æˆ·æ³¨å†Œè¿‡ç¨‹</span></span>
<span class="line"><span style="color:#D8DEE9;">userEvents</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">register</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: Alice has registered.</span></span>
<span class="line"><span style="color:#D8DEE9;">userEvents</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">register</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Bob</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä¸è¾“å‡ºï¼Œå› ä¸ºç›‘å¬å™¨å·²ç»ç§»é™¤</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ· <code>Alice</code> è§¦å‘äº† <code>&#39;register&#39;</code> äº‹ä»¶ï¼Œç›‘å¬å™¨å“åº”äº†è¿™æ¬¡æ³¨å†Œã€‚ä½†å¦‚æœå°è¯•å†æ¬¡è§¦å‘ <code>&#39;register&#39;</code> äº‹ä»¶ï¼Œæ¯”å¦‚ç”¨æˆ· <code>Bob</code> æ³¨å†Œï¼Œé‚£ä¹ˆä¸ä¼šæœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºä¹‹å‰æ·»åŠ çš„ç›‘å¬å™¨åªæ‰§è¡Œäº†ä¸€æ¬¡å¹¶ä¸”éšåè¢«ç§»é™¤äº†ã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>.once()</code>ï¼Œä½ å¯ä»¥ç¡®ä¿æŸäº›ä»£ç å—åªè¿è¡Œä¸€æ¬¡ï¼Œå³ä¾¿åœ¨æœªæ¥å¯èƒ½å¤šæ¬¡è§¦å‘ç›¸åº”çš„äº‹ä»¶ã€‚è¿™åœ¨ç®¡ç†èµ„æºã€é¿å…é‡å¤å¤„ç†ï¼Œæˆ–è€…ç¡®ä¿ä¸€äº›æ“ä½œä»…å‘ç”Ÿä¸€æ¬¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h4 id="nodeeventtarget-removealllisteners-type" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-removealllisteners-type"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetremovealllistenerstype" target="_blank" rel="noopener noreferrer">nodeEventTarget.removeAllListeners([type])</a></span></a></h4><p><code>nodeEventTarget.removeAllListeners([type])</code> æ˜¯ Node.js ä¸­ç”¨äºæ“ä½œäº‹ä»¶çš„å‡½æ•°ä¹‹ä¸€ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½èƒ½äº§ç”Ÿäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯ä»¥è¢«ç›‘å¬å™¨ï¼ˆListenerï¼‰æ•è·å¹¶ä½œå‡ºç›¸åº”çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª HTTP æœåŠ¡å™¨å°±ä¼šåœ¨æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æ—¶äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ã€‚</p><p>è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ NodeEventTarget å’Œ äº‹ä»¶ç›‘å¬å™¨ï¼š</p><h3 id="nodeeventtarget-1" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-1"><span>NodeEventTarget</span></a></h3><p><code>NodeEventTarget</code> æ˜¯ä¸€ä¸ªäº‹ä»¶çš„å‘å°„å™¨ï¼ˆEmitterï¼‰ï¼Œå³ä¸€ä¸ªèƒ½å¤Ÿäº§ç”Ÿå’Œç®¡ç†äº‹ä»¶åŠäº‹ä»¶ç›‘å¬å™¨çš„å¯¹è±¡ã€‚åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå†…å»ºçš„æ¨¡å—å¯¹è±¡éƒ½ç»§æ‰¿è‡ª <code>EventEmitter</code> ç±»ï¼Œä»è€Œæˆä¸ºäº† <code>NodeEventTarget</code> çš„å®ä¾‹ï¼Œæ¯”å¦‚ HTTP servers, streams, æˆ–æ˜¯å…¶ä»–çš„å·¥å…·ã€‚</p><h3 id="äº‹ä»¶ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶ç›‘å¬å™¨"><span>äº‹ä»¶ç›‘å¬å™¨</span></a></h3><p>äº‹ä»¶ç›‘å¬å™¨æ˜¯é™„åŠ åˆ°æŸä¸ª <code>NodeEventTarget</code> ä¸Šçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨ç‰¹å®šç±»å‹çš„äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚</p><h3 id="removealllisteners-type-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#removealllisteners-type-æ–¹æ³•"><span><code>removeAllListeners([type])</code> æ–¹æ³•</span></a></h3><p><code>removeAllListeners([type])</code> æ˜¯ <code>EventEmitter</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒç”¨äºç§»é™¤ä¸€ä¸ª <code>NodeEventTarget</code> å®ä¾‹ä¸Šçš„ä¸€ä¸ªæˆ–å…¨éƒ¨äº‹ä»¶ç›‘å¬å™¨ã€‚å¦‚æœä½ ä¸ä¼ é€’ä»»ä½•å‚æ•°ç»™ <code>removeAllListeners()</code> ï¼Œåˆ™ä¼šç§»é™¤æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å™¨ï¼›å¦‚æœä½ æŒ‡å®šäº†ä¸€ä¸ªäº‹ä»¶ç±»å‹ï¼ˆé€šè¿‡ <code>type</code> å‚æ•°ï¼‰ï¼Œé‚£ä¹ˆåªä¼šç§»é™¤è¯¥ç‰¹å®šäº‹ä»¶ç±»å‹çš„æ‰€æœ‰ç›‘å¬å™¨ã€‚</p><h4 id="ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3"><span>ä¾‹å­</span></a></h4><h5 id="ç§»é™¤ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#ç§»é™¤ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨"><span>ç§»é™¤ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨</span></a></h5><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœåŠ¡å™¨å¯¹è±¡ <code>server</code>ï¼Œå®ƒåœ¨æ¯æ¬¡æœ‰æ–°çš„è¿æ¥æ—¶ä¼šè§¦å‘ &#39;connection&#39; äº‹ä»¶ã€‚ä½ å¯èƒ½æ·»åŠ äº†å¤šä¸ªç›‘å¬å™¨æ¥å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onNewConnection</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">conn</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ–°çš„è¿æ¥å·²å»ºç«‹ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> logConnectionDetails</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">conn</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿æ¥è¯¦æƒ…ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> conn</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">remoteAddress</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ server æ˜¯ä¸€ä¸ª HTTP æˆ– TCP æœåŠ¡å™¨çš„å®ä¾‹</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onNewConnection</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> logConnectionDetails</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ... åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦ç§»é™¤ &#39;connection&#39; äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ï¼š</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeAllListeners</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ <code>server.removeAllListeners(&#39;connection&#39;)</code> åï¼Œ<code>server</code> å¯¹è±¡ä¸Šæ‰€æœ‰ç›‘å¬ &#39;connection&#39; äº‹ä»¶çš„ç›‘å¬å™¨å°†è¢«ç§»é™¤ã€‚</p><h5 id="ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨"><span>ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨</span></a></h5><p>ç°åœ¨å‡è®¾åŒä¸€ä¸ª <code>server</code> å¯¹è±¡è¿˜ç›‘å¬ &#39;error&#39; äº‹ä»¶æ¥å¤„ç†é”™è¯¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨é”™è¯¯ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨æˆ‘ä»¬æƒ³è¦ç§»é™¤ server ä¸Šçš„æ‰€æœ‰ç›‘å¬å™¨ï¼Œä¸ç®¡å®ƒä»¬ç›‘å¬çš„æ˜¯å“ªä¸ªäº‹ä»¶ï¼š</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeAllListeners</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ‰§è¡Œåï¼Œserver å°†ä¸å†å“åº” &#39;connection&#39; å’Œ &#39;error&#39; äº‹ä»¶ï¼Œå› ä¸ºå…¶ä¸Šçš„æ‰€æœ‰ç›‘å¬å™¨éƒ½å·²è¢«ç§»é™¤ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>removeAllListeners()</code> å¯ä»¥å¸®åŠ©ä½ åœ¨ä¸éœ€è¦æŸäº›äº‹ä»¶å¤„ç†æ—¶æ¸…ç†å’Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œé¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p><p>é‡è¦çš„æ˜¯è¦æ˜ç™½çš„æ˜¯ï¼Œå½“ä½ ä¸å†éœ€è¦æŸä¸ªç›‘å¬å™¨æ—¶ï¼ŒåŠæ—¶åœ°ç§»é™¤å®ƒæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå³ä½¿ Node.js ä¼šåœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œä¸»åŠ¨ç®¡ç†ç›‘å¬å™¨ä¹Ÿæ˜¯é«˜æ•ˆå’Œå®‰å…¨ç¼–ç¨‹çš„æ ‡å¿—ã€‚</p><h4 id="nodeeventtarget-removelistener-type-listener-options" tabindex="-1"><a class="header-anchor" href="#nodeeventtarget-removelistener-type-listener-options"><span><a href="https://nodejs.org/docs/latest/api/events.html#nodeeventtargetremovelistenertype-listener-options" target="_blank" rel="noopener noreferrer">nodeEventTarget.removeListener(type, listener[, options])</a></span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js ä¸­çš„<code>EventEmitter</code>ç±»æˆ–è€…å…¶ä»–åŸºäºå®ƒçš„äº‹ä»¶å‘å°„å™¨æ—¶ï¼Œé€šå¸¸ä¼šç”¨åˆ°ç›‘å¬äº‹ä»¶ã€‚ç›‘å¬äº‹ä»¶å°±æ˜¯ç»™ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨äº‹ä»¶å‘ç”Ÿæ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><p>æœ‰æ—¶å€™ï¼Œä½ ä¸å†éœ€è¦ç›‘å¬æŸä¸ªäº‹ä»¶äº†ï¼Œæˆ–è€…ä½ åªæƒ³è®©ç›‘å¬å™¨æ‰§è¡Œä¸€å®šæ¬¡æ•°ç„¶åå°±è‡ªåŠ¨ç§»é™¤ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨<code>removeListener</code>æ–¹æ³•æ¥æ‰‹åŠ¨ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€‚</p><p>åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­ï¼Œ<code>nodeEventTarget.removeListener</code>çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">nodeEventTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">type</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> listener</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> options</span><span style="color:#D8DEE9FF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>type</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¡¨ç¤ºè¦ä»ä¸­ç§»é™¤ç›‘å¬å™¨çš„äº‹ä»¶çš„åç§°ã€‚</li><li><code>listener</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‡çš„æ˜¯å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œä½ å¸Œæœ›æ‰§è¡Œçš„é‚£ä¸ªå›è°ƒå‡½æ•°ã€‚</li><li><code>options</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®šä¸€äº›é¢å¤–è®¾ç½®ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-12"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¸Œæœ›è®°å½•æ¯æ¬¡æœ‰æ–°å®¢æˆ·ç«¯è¿æ¥çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç‰¹å®šå®¢æˆ·ç«¯è¿æ¥ä¸Šä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¸æƒ³å†ç»§ç»­ç›‘å¬è¿™ä¸ªäº‹ä»¶äº†ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><p><strong>æ­¥éª¤ 1ï¼šåˆ›å»ºæœåŠ¡å™¨å¹¶ç›‘å¬è¿æ¥äº‹ä»¶</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰è¿æ¥å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onConnection</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> è¿æ¥æˆåŠŸã€‚</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬&#39;connection&#39;äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onConnection</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ­¥éª¤ 2ï¼šå®ç°æ¡ä»¶ä¸‹ç§»é™¤ç›‘å¬å™¨</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾æŸä¸ªå®¢æˆ·ç«¯IDä¸º12345ï¼Œæˆ‘ä»¬åªå…³å¿ƒå®ƒçš„ç¬¬ä¸€æ¬¡è¿æ¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> specialClient</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç‰¹æ®Šé€»è¾‘å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onSpecialConnection</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">client</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> specialClient</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ç‰¹æ®Šå®¢æˆ·ç«¯ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">client</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> è¿æ¥ï¼Œå°†ä¸å†ç›‘è§†æ­¤å®¢æˆ·ç«¯ã€‚</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // ç§»é™¤ç›‘å¬å™¨ï¼Œé¿å…å®ƒä»¥åå†æ¬¡è§¦å‘</span></span>
<span class="line"><span style="color:#D8DEE9;">    myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onSpecialConnection</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ ç‰¹æ®Šé€»è¾‘çš„ç›‘å¬å™¨</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onSpecialConnection</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿå®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">67890</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶å‘å°„å™¨<code>myEmitter</code>ï¼Œç„¶åæ·»åŠ äº†ä¸€ä¸ªç›‘å¬&#39;connection&#39;äº‹ä»¶çš„<code>onConnection</code>å‡½æ•°ã€‚å¯¹äºç‰¹æ®Šå®¢æˆ·ç«¯<code>specialClient</code>ï¼ˆå‡è®¾å…¶ ID ä¸º&#39;12345&#39;ï¼‰ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>onSpecialConnection</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨ç‰¹æ®Šå®¢æˆ·ç«¯è¿æ¥æ—¶æ‰§è¡Œï¼Œå¹¶ä¸”ä½¿ç”¨<code>myEmitter.removeListener</code>æ–¹æ³•ç§»é™¤äº†è¿™ä¸ªç‰¹æ®Šé€»è¾‘çš„ç›‘å¬å™¨ã€‚è¿™æ ·ï¼Œåœ¨<code>specialClient</code>è¿æ¥åï¼Œ<code>onSpecialConnection</code>ç›‘å¬å™¨å°±ä¸ä¼šå†æ¬¡è¢«è§¦å‘äº†ã€‚</p><p>è¯·æ³¨æ„ï¼Œä½¿ç”¨<code>removeListener</code>æ—¶ï¼Œä½ å¿…é¡»ä¼ å…¥å®Œå…¨ç›¸åŒçš„å‡½æ•°å¼•ç”¨ã€‚æ‰€ä»¥å¦‚æœä½ åœ¨æ·»åŠ ç›‘å¬å™¨æ—¶ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œé‚£ä¹ˆåœ¨ç§»é™¤æ—¶å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼Œå› ä¸ºä½ æ— æ³•æä¾›åŸå§‹çš„å‡½æ•°å¼•ç”¨ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Errors.html" aria-label="Errors"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Errors</div></a><a class="route-link auto-link next" href="/document/node-doc/File%20system.html" aria-label="File system"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">File system<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.be370b10.js" defer></script><script src="/assets/js/4485.e6fe7c7b.js" defer></script><script src="/assets/js/app.bf6f64e3.js" defer></script>
  </body>
</html>
