<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Global%20objects.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Global objects"><meta property="og:description" content="Global objects Node.js ä¸­çš„å…¨å±€å¯¹è±¡æ˜¯åœ¨æ‰€æœ‰æ¨¡å—ä¸­å§‹ç»ˆå¯ç”¨çš„å¯¹è±¡ã€‚ä½ ä¸éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œç‰¹æ®Šçš„å¯¼å…¥æˆ–å£°æ˜ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚ä¸‹é¢æˆ‘å°†è§£é‡Šä¸€äº›åŸºæœ¬çš„å…¨å±€å¯¹è±¡ï¼Œå¹¶ç»™å‡ºå®é™…ä½¿ç”¨çš„ä¾‹å­ã€‚ globalï¼š è¿™ä¸ªå¯¹è±¡ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„windowå¯¹è±¡ï¼Œæ˜¯å…¨å±€å‘½åç©ºé—´çš„ä¸€ä¸ªä»£è¡¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ åœ¨æœ€é¡¶å±‚èŒƒå›´å†…å£°æ˜å˜é‡æ—¶ï¼Œè¿™äº›å˜é‡..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Global objects","description":"Global objects Node.js ä¸­çš„å…¨å±€å¯¹è±¡æ˜¯åœ¨æ‰€æœ‰æ¨¡å—ä¸­å§‹ç»ˆå¯ç”¨çš„å¯¹è±¡ã€‚ä½ ä¸éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œç‰¹æ®Šçš„å¯¼å…¥æˆ–å£°æ˜ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚ä¸‹é¢æˆ‘å°†è§£é‡Šä¸€äº›åŸºæœ¬çš„å…¨å±€å¯¹è±¡ï¼Œå¹¶ç»™å‡ºå®é™…ä½¿ç”¨çš„ä¾‹å­ã€‚ globalï¼š è¿™ä¸ªå¯¹è±¡ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„windowå¯¹è±¡ï¼Œæ˜¯å…¨å±€å‘½åç©ºé—´çš„ä¸€ä¸ªä»£è¡¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ åœ¨æœ€é¡¶å±‚èŒƒå›´å†…å£°æ˜å˜é‡æ—¶ï¼Œè¿™äº›å˜é‡..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Global objects | hanekawa-shiki</title><meta name="description" content="Global objects Node.js ä¸­çš„å…¨å±€å¯¹è±¡æ˜¯åœ¨æ‰€æœ‰æ¨¡å—ä¸­å§‹ç»ˆå¯ç”¨çš„å¯¹è±¡ã€‚ä½ ä¸éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œç‰¹æ®Šçš„å¯¼å…¥æˆ–å£°æ˜ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚ä¸‹é¢æˆ‘å°†è§£é‡Šä¸€äº›åŸºæœ¬çš„å…¨å±€å¯¹è±¡ï¼Œå¹¶ç»™å‡ºå®é™…ä½¿ç”¨çš„ä¾‹å­ã€‚ globalï¼š è¿™ä¸ªå¯¹è±¡ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„windowå¯¹è±¡ï¼Œæ˜¯å…¨å±€å‘½åç©ºé—´çš„ä¸€ä¸ªä»£è¡¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ åœ¨æœ€é¡¶å±‚èŒƒå›´å†…å£°æ˜å˜é‡æ—¶ï¼Œè¿™äº›å˜é‡...">
    <link rel="stylesheet" href="/assets/css/styles.6fad2577.css">
    <link rel="preload" href="/assets/js/runtime~app.2cf91084.js" as="script"><link rel="preload" href="/assets/css/styles.6fad2577.css" as="style"><link rel="preload" href="/assets/js/7531.f2f134c8.js" as="script"><link rel="preload" href="/assets/js/app.a2d0f323.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-CommonJS%20modules.html" aria-label="Modules: CommonJS modules"><!---->Modules: CommonJS modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-ECMAScript%20modules.html" aria-label="Modules: ECMAScript modules"><!---->Modules: ECMAScript modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-node%20module%20API.html" aria-label="Modules: node:module API"><!---->Modules: node:module API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><!---->Modules: Packages<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Global objects</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 200 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT200M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 59902 å­—</span><meta property="wordCount" content="59902"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-abortcontroller">Class: AbortController</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-å–æ¶ˆ-http-è¯·æ±‚">ä¾‹å­ 1ï¼šå–æ¶ˆ HTTP è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-å–æ¶ˆäº‹ä»¶ç›‘å¬å™¨">ä¾‹å­ 2ï¼šå–æ¶ˆäº‹ä»¶ç›‘å¬å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abortcontroller-abort-reason">abortController.abort([reason])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abortcontroller-signal">abortController.signal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-abortcontroller-signal">ä»€ä¹ˆæ˜¯ AbortController.signal?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-abortsignal">Class: AbortSignal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºä¸€ä¸ª-abortsignal">åˆ›å»ºä¸€ä¸ª AbortSignal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-abortsignal">ä½¿ç”¨ AbortSignal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-abortsignal">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ AbortSignal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abortsignal-abort-reason">AbortSignal.abort([reason])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š">è§£é‡Šï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹">å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-1">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¾‹è¯´æ˜">ä¸¾ä¾‹è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abort-äº‹ä»¶æ˜¯ä»€ä¹ˆ">&#39;abort&#39;äº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-abortsignal">ä»€ä¹ˆæ˜¯ AbortSignal?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abortsignal-aborted-å±æ€§">abortSignal.aborted å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-1">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-å–æ¶ˆ-http-è¯·æ±‚-1">ç¤ºä¾‹ 1: å–æ¶ˆ HTTP è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-å–æ¶ˆæ–‡ä»¶è¯»å–æ“ä½œ">ç¤ºä¾‹ 2: å–æ¶ˆæ–‡ä»¶è¯»å–æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abortcontroller-å’Œ-abortsignal">AbortController å’Œ AbortSignal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abortsignal-reason-1">abortSignal.reason</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-ä½¿ç”¨-fetch-è¿›è¡Œç½‘ç»œè¯·æ±‚">ä¾‹å­ 1ï¼šä½¿ç”¨ fetch è¿›è¡Œç½‘ç»œè¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-ä½¿ç”¨-fs-promises-è¯»å–æ–‡ä»¶">ä¾‹å­ 2ï¼šä½¿ç”¨ fs.promises è¯»å–æ–‡ä»¶</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-blob">Class: Blob</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-blob">ä»€ä¹ˆæ˜¯ Blobï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#blob-ç±»çš„å…³é”®ç‰¹æ€§">Blob ç±»çš„å…³é”®ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-3">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-buffer">Class: Buffer</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-buffer">ç†è§£ Buffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»º-buffer">åˆ›å»º Buffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®è·µåº”ç”¨ä¾‹å­">å®è·µåº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-4">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-bytelengthqueuingstrategy">Class: ByteLengthQueuingStrategy</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-1">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#bytelengthqueuingstrategy-ç±»">ByteLengthQueuingStrategy ç±»</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#dirname">__dirname</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-dirname-å¾ˆé‡è¦">ä¸ºä»€ä¹ˆ __dirname å¾ˆé‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#filename">__filename</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-æ‰“å°å½“å‰æ–‡ä»¶è·¯å¾„">ä¾‹å­ 1ï¼šæ‰“å°å½“å‰æ–‡ä»¶è·¯å¾„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-åŸºäºæ–‡ä»¶è·¯å¾„è¿›è¡Œæ“ä½œ">ä¾‹å­ 2ï¼šåŸºäºæ–‡ä»¶è·¯å¾„è¿›è¡Œæ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-3-åŠ¨æ€å¼•å…¥æ¨¡å—">ä¾‹å­ 3ï¼šåŠ¨æ€å¼•å…¥æ¨¡å—</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#atob-data">atob(data)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-atob-data">å¦‚ä½•ä½¿ç”¨ atob(data)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#broadcastchannel">BroadcastChannel</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#broadcastchannel-åŸºç¡€">BroadcastChannel åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ">å¦‚ä½•å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#btoa-data">btoa(data)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦-base64-ç¼–ç ">ä¸ºä»€ä¹ˆéœ€è¦ Base64 ç¼–ç ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-btoa-å‡½æ•°">å¦‚ä½•ä½¿ç”¨ btoa å‡½æ•°ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-1">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#clearimmediate-immediateobject">clearImmediate(immediateObject)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-setimmediate-å’Œ-clearimmediate">ç†è§£ setImmediate() å’Œ clearImmediate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-clearimmediate">ä½¿ç”¨ clearImmediate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#clearinterval-intervalobject">clearInterval(intervalObject)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-ç®€å•çš„è®¡æ—¶å™¨">ä¾‹å­ 1ï¼šç®€å•çš„è®¡æ—¶å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-åŠ¨ç”»æˆ–è½®è¯¢ä»»åŠ¡">ä¾‹å­ 2ï¼šåŠ¨ç”»æˆ–è½®è¯¢ä»»åŠ¡</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cleartimeout-timeoutobject">clearTimeout(timeoutObject)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-compressionstream">Class: CompressionStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€ç†è§£">åŸºç¡€ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-2">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#console">console</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-countqueuingstrategy">Class: CountQueuingStrategy</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#crypto">Crypto</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ•°æ®æ•£åˆ—-hashing">1. æ•°æ®æ•£åˆ—(Hashing)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åŠ å¯†å’Œè§£å¯†">2. åŠ å¯†å’Œè§£å¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æ•°å­—ç­¾åä¸éªŒè¯">3. æ•°å­—ç­¾åä¸éªŒè¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#crypto-1">crypto</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å“ˆå¸Œç®—æ³•-hashing">å“ˆå¸Œç®—æ³•ï¼ˆHashingï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯¹ç§°åŠ å¯†">å¯¹ç§°åŠ å¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#éå¯¹ç§°åŠ å¯†">éå¯¹ç§°åŠ å¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-5">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cryptokey">CryptoKey</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-cryptokey">ä»€ä¹ˆæ˜¯ CryptoKeyï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokey-çš„ä½¿ç”¨åœºæ™¯">CryptoKey çš„ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨-cryptokey">å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ CryptoKey</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#customevent">CustomEvent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#customevent-ç®€ä»‹">CustomEvent ç®€ä»‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºä¸€ä¸ª-customevent">åˆ›å»ºä¸€ä¸ª CustomEvent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§¦å‘-customevent">è§¦å‘ CustomEvent</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ç”¨æˆ·æ³¨å†ŒæˆåŠŸå‘é€æ¬¢è¿é‚®ä»¶">1. ç”¨æˆ·æ³¨å†ŒæˆåŠŸå‘é€æ¬¢è¿é‚®ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-decompressionstream">Class: DecompressionStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯å‹ç¼©ä¸è§£å‹">ä»€ä¹ˆæ˜¯å‹ç¼©ä¸è§£å‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-decompressionstream">å¦‚ä½•ä½¿ç”¨ DecompressionStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#event">Event</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-node-js-ä¸­çš„-event">ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„ Eventï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-æ¨¡å—çš„åŸºæœ¬ç»„ä»¶">Event æ¨¡å—çš„åŸºæœ¬ç»„ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-3">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-1">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#eventtarget">EventTarget</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨eventtarget">ä½¿ç”¨EventTarget</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-3">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#exports">exports</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-å¯¼å‡ºå•ä¸ªåŠŸèƒ½">ç¤ºä¾‹ 1ï¼šå¯¼å‡ºå•ä¸ªåŠŸèƒ½</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-å¯¼å‡ºæ•´ä¸ªå¯¹è±¡">ç¤ºä¾‹ 2ï¼šå¯¼å‡ºæ•´ä¸ªå¯¹è±¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-3-ç»„åˆä½¿ç”¨-exports-å’Œ-module-exports">ç¤ºä¾‹ 3ï¼šç»„åˆä½¿ç”¨ exports å’Œ module.exports</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#fetch">fetch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#fetch-çš„åŸºæœ¬ç”¨æ³•">fetch çš„åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-file">Class: File</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#fileç±»çš„å…³é”®æ–¹æ³•å’Œå±æ€§">Fileç±»çš„å…³é”®æ–¹æ³•å’Œå±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-formdata">Class FormData</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-formdata">ä»€ä¹ˆæ˜¯ FormDataï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#global">global</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#global-å¯¹è±¡">Global å¯¹è±¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-headers">Class Headers</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#headers-ç±»çš„æ ¸å¿ƒåŠŸèƒ½">Headers ç±»çš„æ ¸å¿ƒåŠŸèƒ½</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-7">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#messagechannel">MessageChannel</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#messagechannelçš„ç»„æˆ">MessageChannelçš„ç»„æˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#messageevent">MessageEvent</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-2">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸»è¦å±æ€§">ä¸»è¦å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹åº”ç”¨">å®ä¾‹åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#messageport">MessagePort</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-2">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-4">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-8">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#module">module</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#module-å¯¹è±¡">module å¯¹è±¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-module-exports-å¯¼å‡ºæ¨¡å—">ä½¿ç”¨ module.exports å¯¼å‡ºæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»å…¶ä»–æ¨¡å—å¯¼å…¥">ä»å…¶ä»–æ¨¡å—å¯¼å…¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#navigator">Navigator</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å¦‚æœæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„-navigator">1. å¦‚æœæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„ Navigator</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åœ¨-node-js-ä¸­ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½">2. åœ¨ Node.js ä¸­ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#navigator-1">navigator</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#navigator-hardwareconcurrency">navigator.hardwareConcurrency</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-4">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-2">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#navigator-language">navigator.language</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨æµè§ˆå™¨ä¸­navigator-language">åœ¨æµè§ˆå™¨ä¸­navigator.language</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-node-js-ç¯å¢ƒä¸­å¤„ç†ç±»ä¼¼éœ€æ±‚">åœ¨ Node.js ç¯å¢ƒä¸­å¤„ç†ç±»ä¼¼éœ€æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#navigator-languages">navigator.languages</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-navigator-languages">ç†è§£ navigator.languages</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-5">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-2">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-3">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#navigator-platform">navigator.platform</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#navigator-platformç®€ä»‹">navigator.platformç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-node-js-ä¸­å¤„ç†å¹³å°ä¿¡æ¯">åœ¨ Node.js ä¸­å¤„ç†å¹³å°ä¿¡æ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#navigator-useragent">navigator.userAgent</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#performanceentry">PerformanceEntry</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-node-js-ä¸­ä½¿ç”¨-performanceentry">åœ¨ Node.js ä¸­ä½¿ç”¨ PerformanceEntry</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-9">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#performancemark">PerformanceMark</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-performancemark">å¦‚ä½•ä½¿ç”¨ PerformanceMark</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¸¾ä¾‹">å®é™…è¿ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-10">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#performancemeasure">PerformanceMeasure</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-performancemeasure">å¦‚ä½•ä½¿ç”¨ PerformanceMeasure</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#performanceobserver">PerformanceObserver</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#performanceobserverentrylist">PerformanceObserverEntryList</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#performanceresourcetiming">PerformanceResourceTiming</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-performanceresourcetiming">ä»€ä¹ˆæ˜¯ PerformanceResourceTiming?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#performanceresourcetiming-çš„å±æ€§">PerformanceResourceTiming çš„å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-5">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-6">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#performance">performance</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-æµ‹é‡ä»£ç å—æ‰§è¡Œæ—¶é—´">å®ä¾‹ 1: æµ‹é‡ä»£ç å—æ‰§è¡Œæ—¶é—´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-ä½¿ç”¨æ ‡è®°å’Œæµ‹é‡">å®ä¾‹ 2: ä½¿ç”¨æ ‡è®°å’Œæµ‹é‡</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#process">process</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-env">process.env</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-argv">process.argv</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-exit">process.exit()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-cwd">process.cwd()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-nexttick">process.nextTick()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-on">process.on()</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#queuemicrotask-callback">queueMicrotask(callback)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-queuemicrotask-callback">ä»€ä¹ˆæ˜¯ queueMicrotask(callback)?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-6">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-11">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-readablebytestreamcontroller">Class: ReadableByteStreamController</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-readablestream">Class: ReadableStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-stream">ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readablestream-çš„ä½œç”¨">ReadableStream çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readablestream-çš„å®é™…åº”ç”¨">ReadableStream çš„å®é™…åº”ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-readablestreambyobreader">Class: ReadableStreamBYOBReader</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readablestreambyobreader-ç±»">ReadableStreamBYOBReader ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-7">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-readablestreambyobrequest">Class: ReadableStreamBYOBRequest</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-readablestreamdefaultcontroller">Class: ReadableStreamDefaultController</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js">Node.js</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream">æµï¼ˆStreamï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ">å¯è¯»æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readablestreamdefaultcontroller">ReadableStreamDefaultController</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨æ¡ˆä¾‹">å®é™…åº”ç”¨æ¡ˆä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-readablestreamdefaultreader">Class: ReadableStreamDefaultReader</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-3">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readablestreamdefaultreader">ReadableStreamDefaultReader</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-1">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-12">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#require">require()</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#require-è§£æ">require()è§£æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å†…ç½®æ¨¡å—">å†…ç½®æ¨¡å—</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#response">Response</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºä¸€ä¸ª-http-æœåŠ¡å™¨">åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#response-å¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•">Response å¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•ï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#request">Request</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-æœåŠ¡å™¨ç«¯ç¤ºä¾‹">HTTP æœåŠ¡å™¨ç«¯ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-å®¢æˆ·ç«¯ç¤ºä¾‹">HTTP å®¢æˆ·ç«¯ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-4">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#setimmediate-callback-args">setImmediate(callback[, ...args])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-8">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-13">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#setinterval-callback-delay-args">setInterval(callback, delay[, ...args])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-3">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-setinterval">å¦‚ä½•ä½¿ç”¨ setInterval()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-9">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœæ­¢-setinterval">åœæ­¢ setInterval()</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#settimeout-callback-delay-args">setTimeout(callback, delay[, ...args])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¿”å›å€¼-1">è¿”å›å€¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-10">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#structuredclone-value-options">structuredClone(value[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#subtlecrypto">SubtleCrypto</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtlecrypto-çš„å…³é”®ç‰¹æ€§">SubtleCrypto çš„å…³é”®ç‰¹æ€§ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-1">å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#domexception">DOMException</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-domexception">ä»€ä¹ˆæ˜¯ DOMExceptionï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-node-js-è¦åŒ…å«-domexception">ä¸ºä»€ä¹ˆ Node.js è¦åŒ…å« DOMExceptionï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-14">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#textdecoder">TextDecoder</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦-textdecoder">ä¸ºä»€ä¹ˆéœ€è¦ TextDecoderï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-textdecoder">å¦‚ä½•ä½¿ç”¨ TextDecoderï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-3">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-textdecoderstream">Class: TextDecoderStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-textdecoderstream">ç†è§£ TextDecoderStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-11">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-15">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#textencoder">TextEncoder</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-12">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-16">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-textencoderstream">Class: TextEncoderStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®ç‚¹ç†è§£">å…³é”®ç‚¹ç†è§£ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-3">å®é™…åº”ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç æ®µ">ç¤ºä¾‹ä»£ç æ®µï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-transformstream">Class: TransformStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-transformstream">ç†è§£ TransformStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transformstream-çš„ç”¨æ³•">TransformStream çš„ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-transformstreamdefaultcontroller">Class: TransformStreamDefaultController</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#url">URL</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…¨å±€-url-ç±»">å…¨å±€ URL ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-4">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#urlsearchparams">URLSearchParams</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ä½¿ç”¨-1">åŸºæœ¬ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹åŒ–">å®ä¾‹åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¯»å–å‚æ•°">è¯»å–å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ·»åŠ æˆ–ä¿®æ”¹å‚æ•°">æ·»åŠ æˆ–ä¿®æ”¹å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ é™¤å‚æ•°">åˆ é™¤å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#éå†å‚æ•°">éå†å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-4">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#webassembly">WebAssembly</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ­¥éª¤">æ­¥éª¤ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-1">å®é™…ä¾‹å­ï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#websocket">WebSocket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-writablestream">Class: WritableStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-writablestream">ç†è§£ WritableStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ ¸å¿ƒç‰¹æ€§">æ ¸å¿ƒç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-13">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-writablestreamdefaultcontroller">Class: WritableStreamDefaultController</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-writablestreamdefaultwriter">Class: WritableStreamDefaultWriter</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writablestreamdefaultwriter-ç±»">WritableStreamDefaultWriter ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®æ–¹æ³•å’Œå±æ€§">å…³é”®æ–¹æ³•å’Œå±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="global-objects" tabindex="-1"><a class="header-anchor" href="#global-objects"><span><a href="https://nodejs.org/docs/latest/api/globals.html#global-objects" target="_blank" rel="noopener noreferrer">Global objects</a></span></a></h1><p>Node.js ä¸­çš„å…¨å±€å¯¹è±¡æ˜¯åœ¨æ‰€æœ‰æ¨¡å—ä¸­å§‹ç»ˆå¯ç”¨çš„å¯¹è±¡ã€‚ä½ ä¸éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œç‰¹æ®Šçš„å¯¼å…¥æˆ–å£°æ˜ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚ä¸‹é¢æˆ‘å°†è§£é‡Šä¸€äº›åŸºæœ¬çš„å…¨å±€å¯¹è±¡ï¼Œå¹¶ç»™å‡ºå®é™…ä½¿ç”¨çš„ä¾‹å­ã€‚</p><ol><li><p><strong><code>global</code></strong>ï¼š<br> è¿™ä¸ªå¯¹è±¡ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„<code>window</code>å¯¹è±¡ï¼Œæ˜¯å…¨å±€å‘½åç©ºé—´çš„ä¸€ä¸ªä»£è¡¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ åœ¨æœ€é¡¶å±‚èŒƒå›´å†…å£°æ˜å˜é‡æ—¶ï¼Œè¿™äº›å˜é‡ä¼šè‡ªåŠ¨æˆä¸º<code>global</code>å¯¹è±¡çš„å±æ€§ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®å…¨å±€å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myGlobalVar</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨å…¶ä»–æ–‡ä»¶ä¸­æ— éœ€ä»»ä½•import/require</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myGlobalVar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šHello, World!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>process</code></strong>ï¼š<br><code>process</code>å¯¹è±¡æä¾›äº†ä¸å½“å‰ Node.js è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯å’Œæ§åˆ¶æ‰‹æ®µã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥è®¿é—®ç¯å¢ƒä¿¡æ¯ã€è¯»å†™æ ‡å‡†è¾“å…¥è¾“å‡ºã€æ•è·å¼‚å¸¸ç­‰ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°å¹³å°ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">platform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é€€å‡ºç¨‹åº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>console</code></strong>ï¼š<br> ç”¨äºæ‰“å°å„ç§çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ï¼Œæ¯”å¦‚<code>console.log</code>, <code>console.error</code>, å’Œ <code>console.warn</code>ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°ä¿¡æ¯åˆ° stdout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Log message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°é”™è¯¯åˆ° stderr</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>Buffer</code></strong>ï¼š<br> åœ¨ Node.js ä¸­ï¼Œ<code>Buffer</code> ç±»æ˜¯ç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„ã€‚ä¾‹å¦‚ï¼Œä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶æ—¶ï¼Œæ•°æ®ä¼šè¢«å­˜å‚¨åœ¨<code>Buffer</code>å¯¹è±¡ä¸­ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª Buffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buf</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å° Buffer å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šHello, World!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>__dirname</code></strong> å’Œ <strong><code>__filename</code></strong>ï¼š<br> è¿™ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«è¡¨ç¤ºå½“å‰æ‰§è¡Œè„šæœ¬çš„ç›®å½•è·¯å¾„å’Œæ–‡ä»¶è·¯å¾„ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå½“å‰æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>setTimeout</code>, <code>setInterval</code>, <code>clearTimeout</code>, <code>clearInterval</code></strong>ï¼š<br> è¿™äº›å‡½æ•°ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œä¸­çš„æ—¶é—´é—®é¢˜ã€‚<code>setTimeout</code>ç”¨äºå»¶æ—¶æ‰§è¡Œï¼Œè€Œ<code>setInterval</code>ç”¨äºå®šæ—¶é‡å¤æ‰§è¡ŒæŸé¡¹ä»»åŠ¡ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»¶æ—¶ 1 ç§’åæ‰“å°ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This message is shown after 1 second.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯éš” 2 ç§’æ‰“å°ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> intervalId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This message is shown every 2 seconds.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœæ­¢å®šæ—¶é‡å¤æ‰§è¡Œçš„ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¿™äº›åªæ˜¯ Node.js ä¸­å¤šä¸ªå…¨å±€å¯¹è±¡çš„ç®€å•ä»‹ç»å’Œä¾‹å­ã€‚å…¨å±€å¯¹è±¡è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ï¼Œæ¯”å¦‚<code>require</code>ã€<code>module</code>ç­‰ï¼Œå®ƒä»¬åœ¨ Node.js ç¼–ç¨‹ä¸­éƒ½æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ã€‚éšç€ä½ é€æ¸æ·±å…¥å­¦ä¹ ï¼Œä½ ä¼šé€æ¸ç†è§£å¹¶ç†Ÿç»ƒè¿ç”¨è¿™äº›å…¨å±€å¯¹è±¡ã€‚</p><h2 id="class-abortcontroller" tabindex="-1"><a class="header-anchor" href="#class-abortcontroller"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-abortcontroller" target="_blank" rel="noopener noreferrer">Class: AbortController</a></span></a></h2><p>Node.js ä¸­çš„ <code>AbortController</code> æ˜¯ä¸€ä¸ªå…è®¸ä½ å‘é€ä¸€ä¸ªä¸­æ­¢ä¿¡å·ä»¥å–æ¶ˆæŸäº›å¼‚æ­¥ä»»åŠ¡çš„ç±»ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯ä»æµè§ˆå™¨çš„ Web API ä¸­å¼•å…¥åˆ° Node.js çš„ï¼Œç”¨æ¥å–æ¶ˆä¾‹å¦‚ Fetch API è¯·æ±‚ï¼Œæˆ–è€…æ˜¯ä»»ä½•å¯ä»¥ä½¿ç”¨ <code>AbortSignal</code> çš„æ“ä½œã€‚</p><p>åˆ›å»ºä¸€ä¸ª <code>AbortController</code> å®ä¾‹åï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª <code>signal</code> å±æ€§ï¼Œè¿™ä¸ªä¿¡å·å¯ä»¥ä¼ é€’ç»™æ”¯æŒå–æ¶ˆæ“ä½œçš„å‡½æ•°æˆ–å‘½ä»¤ã€‚å¦‚æœä½ æƒ³è¦å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„æ“ä½œï¼Œåªéœ€è°ƒç”¨ <code>abort()</code> æ–¹æ³•å³å¯ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šä¸¾ä¸€äº›å®é™…çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-å–æ¶ˆ-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å–æ¶ˆ-http-è¯·æ±‚"><span>ä¾‹å­ 1ï¼šå–æ¶ˆ HTTP è¯·æ±‚</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Node.js å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œä½†æˆ‘ä»¬å¸Œæœ›åœ¨æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼ˆæ¯”å¦‚ç”¨æˆ·å–æ¶ˆæ“ä½œï¼Œæˆ–è€…è¶…æ—¶ï¼‰å–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬ä½¿ç”¨ node-fetch æ¨¡å—æ¥å‘èµ·è¯·æ±‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch aborted!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨5ç§’åå¦‚æœè¯·æ±‚è¿˜æ²¡å®Œæˆå°±å–æ¶ˆå®ƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>AbortController</code> å¯¹è±¡ï¼Œå¹¶é€šè¿‡å…¶ <code>signal</code> å±æ€§ä¼ é€’ç»™ <code>fetch</code> å‡½æ•°ã€‚å¦‚æœ 5 ç§’é’Ÿå†…è¯·æ±‚æ²¡æœ‰å®Œæˆï¼Œæˆ‘ä»¬é€šè¿‡ <code>setTimeout</code> è°ƒç”¨ <code>controller.abort()</code> æ¥å–æ¶ˆè¯·æ±‚ã€‚å¦‚æœè¯·æ±‚è¢«å–æ¶ˆï¼Œ<code>fetch</code> å°†ä¼šæŠ›å‡ºä¸€ä¸ªåä¸º <code>AbortError</code> çš„é”™è¯¯ã€‚</p><h3 id="ä¾‹å­-2-å–æ¶ˆäº‹ä»¶ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å–æ¶ˆäº‹ä»¶ç›‘å¬å™¨"><span>ä¾‹å­ 2ï¼šå–æ¶ˆäº‹ä»¶ç›‘å¬å™¨</span></a></h3><p><code>AbortController</code> ä¹Ÿå¯ä»¥ç”¨æ¥å–æ¶ˆäº‹ä»¶ç›‘å¬å™¨ã€‚å½“ä½ ä¸å†éœ€è¦ç›‘å¬æŸä¸ªäº‹ä»¶æ—¶ï¼Œå¯ä»¥å‘é€ä¸€ä¸ªä¸­æ­¢ä¿¡å·æ¥ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> emitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> eventHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Event fired!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myEvent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">eventHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ äº‹ä»¶ç›‘å¬å¹¶å…³è”ä¸­æ­¢ä¿¡å·</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myEvent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æˆ‘ä»¬ä¸å†æƒ³ç›‘å¬äº‹ä»¶æ—¶å¯ä»¥å–æ¶ˆç›‘å¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å› ä¸ºå·²ç»å–æ¶ˆç›‘å¬ï¼Œæ‰€ä»¥ä»¥ä¸‹ä»£ç ä¸ä¼šå¯¼è‡´ eventHandler è¢«è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myEvent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸º <code>myEvent</code> äº‹ä»¶æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼ŒåŒæ—¶å°† <code>signal</code> å…³è”åˆ°è¯¥ç›‘å¬å™¨ä¸Šã€‚å½“æˆ‘ä»¬è°ƒç”¨ <code>controller.abort()</code> åï¼Œå’Œè¯¥ä¿¡å·å…³è”çš„äº‹ä»¶ç›‘å¬å™¨ä¼šè¢«è‡ªåŠ¨ç§»é™¤ï¼Œå› æ­¤å†æ¬¡è§¦å‘ <code>myEvent</code> äº‹ä»¶æ—¶ï¼Œ<code>eventHandler</code> ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>AbortController</code> å’Œå®ƒçš„ <code>signal</code> çš„ä¸»è¦ç”¨é€”æ˜¯æä¾›äº†ä¸€ç§æœºåˆ¶æ¥å–æ¶ˆä¸€ç³»åˆ—ä¸åŒç±»å‹çš„å¼‚æ­¥æ“ä½œã€‚è¿™å¯¹äºæ„å»ºå¯é ä¸”å“åº”ç”¨æˆ·è¡Œä¸ºçš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é‚£äº›å¯èƒ½éœ€è¦é•¿æ—¶é—´æ‰èƒ½å®Œæˆçš„æ“ä½œæ—¶ã€‚</p><h3 id="abortcontroller-abort-reason" tabindex="-1"><a class="header-anchor" href="#abortcontroller-abort-reason"><span><a href="https://nodejs.org/docs/latest/api/globals.html#abortcontrollerabortreason" target="_blank" rel="noopener noreferrer">abortController.abort([reason])</a></span></a></h3><p>Node.js ä¸­çš„<code>abortController.abort([reason])</code>æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åœ¨ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸»åŠ¨åœæ­¢æŸäº›æ­£åœ¨è¿›è¡Œçš„æ“ä½œã€‚è¿™ä¸ªåŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚å½“ä½ ä¸å†éœ€è¦å®Œæˆä¸€ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œï¼Œæˆ–è€…ç”¨æˆ·å–æ¶ˆäº†ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚æ—¶ã€‚ä¸‹é¢æˆ‘å°†é€šè¿‡å‡ ä¸ªå®é™…ä¾‹å­æ¥è§£é‡Šå®ƒçš„ç”¨æ³•å’Œé‡è¦æ€§ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œ<code>AbortController</code> æ˜¯ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ç±»ï¼Œåœ¨ Node.js ç¯å¢ƒä¸­ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªä¸­æ­¢ä¿¡å·æ§åˆ¶å™¨çš„å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹é€šè¿‡è°ƒç”¨å…¶ <code>abort</code> æ–¹æ³•å¯ä»¥å‘é€ä¸€ä¸ªä¸­æ­¢ä¿¡å·ï¼Œç”¨äºå–æ¶ˆä¸€äº›æ”¯æŒå–æ¶ˆæ“ä½œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚ HTTP è¯·æ±‚ã€æ–‡ä»¶è¯»å†™æ“ä½œç­‰ã€‚</p><p><code>abort([reason])</code> æ–¹æ³•å…è®¸ä½ ï¼ˆå¯é€‰åœ°ï¼‰æä¾›ä¸€ä¸ªåŸå› ï¼ˆ<code>reason</code>ï¼‰ï¼Œè¿™ä¸ªåŸå› ä¼šè¢«ä¼ é€’ç»™ç›‘å¬è¯¥ä¸­æ­¢ä¿¡å·çš„ä»»åŠ¡ï¼Œä»¥ä¾¿äºç†è§£ä¸ºä»€ä¹ˆä»»åŠ¡è¢«å–æ¶ˆäº†ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å–æ¶ˆ-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å–æ¶ˆ-http-è¯·æ±‚"><span>ç¤ºä¾‹ 1: å–æ¶ˆ HTTP è¯·æ±‚</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»å¤–éƒ¨ API è·å–ä¸€äº›æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·çªç„¶å†³å®šä¸éœ€è¦è¿™äº›æ•°æ®äº†ï¼Œæˆ–è€…æƒ³è¦æŸ¥è¯¢å…¶ä»–ä¿¡æ¯ï¼Œé‚£ä¹ˆç»§ç»­ç­‰å¾…å½“å‰è¯·æ±‚å®Œæˆå°±æµªè´¹èµ„æºäº†ã€‚è¿™æ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>AbortController</code> æ¥å–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º AbortController å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘èµ· HTTP è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`çŠ¶æ€ç : </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å“åº”ä¸»ä½“: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœè¯·æ±‚è¢«ä¸­æ­¢ï¼Œåˆ™æ‰“å°é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤±è´¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¾‹å¦‚ï¼Œç”¨æˆ·å˜æ›´äº†è¯·æ±‚ï¼Œ2ç§’åå–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç”¨æˆ·å–æ¶ˆè¯·æ±‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>AbortController</code> åˆ›å»ºäº†ä¸€ä¸ªä¸­æ­¢ä¿¡å·ï¼Œå¹¶å°†è¿™ä¸ªä¿¡å·ä½œä¸ºè¯·æ±‚é€‰é¡¹ä¼ é€’ç»™ <code>http.get</code> æ–¹æ³•ã€‚å¦‚æœåœ¨è¯·æ±‚å®Œæˆå‰è°ƒç”¨äº† <code>controller.abort()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆè¯·æ±‚ä¼šè¢«å–æ¶ˆï¼Œä¸”ç›¸å…³çš„é”™è¯¯å¤„ç†å‡½æ•°ä¼šæ¥æ”¶åˆ°ä¸€ä¸ª <code>AbortError</code>ï¼Œå‘ŠçŸ¥è¯·æ±‚å·²è¢«å–æ¶ˆã€‚</p><h4 id="ç¤ºä¾‹-2-å–æ¶ˆä¸€ä¸ªæ–‡ä»¶è¯»å–æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å–æ¶ˆä¸€ä¸ªæ–‡ä»¶è¯»å–æ“ä½œ"><span>ç¤ºä¾‹ 2: å–æ¶ˆä¸€ä¸ªæ–‡ä»¶è¯»å–æ“ä½œ</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„åº”ç”¨éœ€è¦è¯»å–ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ï¼Œè€Œåœ¨æ–‡ä»¶è¯»å–æœŸé—´ï¼Œç”¨æˆ·å¸Œæœ›å–æ¶ˆè¿™ä¸ªæ“ä½œï¼Œè½¬è€Œæ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>AbortController</code> æ¥å–æ¶ˆæ–‡ä»¶è¯»å–æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º AbortController å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¥æ”¶åˆ°æ–‡ä»¶å†…å®¹:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶è¯»å–è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¾‹å¦‚ï¼Œ5ç§’åç”¨æˆ·å–æ¶ˆæ–‡ä»¶è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç”¨æˆ·å–æ¶ˆæ“ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åŒæ ·åˆ›å»ºäº†ä¸€ä¸ª <code>AbortController</code> å®ä¾‹å’Œå¯¹åº”çš„ä¸­æ­¢ä¿¡å·ï¼Œå°†å…¶ä¼ é€’ç»™ <code>fs.createReadStream</code> æ–¹æ³•ä»¥å¼€å§‹è¯»å–æ–‡ä»¶ã€‚å¦‚æœåœ¨æ–‡ä»¶è¯»å–å®Œæˆä¹‹å‰è°ƒç”¨äº† <code>controller.abort()</code>ï¼Œåˆ™æ–‡ä»¶è¯»å–ä¼šè¢«å–æ¶ˆï¼Œç›¸åº”çš„é”™è¯¯å¤„ç†ä¼šè¢«è§¦å‘ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p><code>AbortController</code> å’Œå®ƒçš„ <code>abort([reason])</code> æ–¹æ³•ä¸º Node.js æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å–æ¶ˆæ”¯æŒå–æ¶ˆæ“ä½œçš„ä»»åŠ¡ï¼Œè®©èµ„æºç®¡ç†å˜å¾—æ›´åŠ é«˜æ•ˆå’Œç²¾ç¡®ã€‚é€šè¿‡åœ¨é€‚å½“çš„æ—¶å€™å–æ¶ˆä¸å†éœ€è¦çš„æ“ä½œï¼Œä½ å¯ä»¥æå‡åº”ç”¨çš„å“åº”æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p><h3 id="abortcontroller-signal" tabindex="-1"><a class="header-anchor" href="#abortcontroller-signal"><span><a href="https://nodejs.org/docs/latest/api/globals.html#abortcontrollersignal" target="_blank" rel="noopener noreferrer">abortController.signal</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>AbortController</code>æ˜¯ä¸€ä¸ªå†…ç½®çš„å…¨å±€ç±»ï¼Œç”¨äºå‘é€å–æ¶ˆä¿¡å·ä»¥ä¸­æ­¢ä¸€ä¸ªæˆ–å¤šä¸ª Web API ä»»åŠ¡ã€‚è¿™ä¸ªæ¦‚å¿µæºè‡ªæµè§ˆå™¨ç¯å¢ƒï¼Œä½†åœ¨ Node.js ä¸­ä¹Ÿè¢«é‡‡ç”¨ä»¥æä¾›ç±»ä¼¼çš„åŠŸèƒ½ã€‚<code>AbortController.signal</code>å±æ€§å°±æ˜¯è¿™ä¸ªæœºåˆ¶ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-abortcontroller-signal" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-abortcontroller-signal"><span>ä»€ä¹ˆæ˜¯ <code>AbortController.signal</code>?</span></a></h3><p><code>AbortController</code> å®ä¾‹æœ‰ä¸€ä¸ªåä¸º <code>signal</code> çš„å±æ€§ï¼Œè¿™ä¸ªå±æ€§è¿”å›ä¸€ä¸ª <code>AbortSignal</code> å¯¹è±¡ã€‚<code>AbortSignal</code> å¯¹è±¡å¯ä»¥è¢«ä¼ é€’ç»™æ”¯æŒå–æ¶ˆæ“ä½œçš„ APIï¼Œä½œä¸ºå–æ¶ˆè¯·æ±‚æˆ–ä»»åŠ¡çš„ä¿¡å·ã€‚å½“è°ƒç”¨ <code>AbortController</code> å®ä¾‹çš„ <code>abort()</code> æ–¹æ³•æ—¶ï¼Œä¸ä¹‹å…³è”çš„æ‰€æœ‰ <code>AbortSignal</code> éƒ½ä¼šå˜å¾—å·²ä¸­æ­¢ï¼ˆå³å®ƒä»¬çš„ <code>aborted</code> å±æ€§ä¼šå˜ä¸º <code>true</code>ï¼‰ï¼ŒåŒæ—¶è¿˜ä¼šè§¦å‘ <code>abort</code> äº‹ä»¶ã€‚è¿™å…è®¸ä½ æ ¹æ®éœ€è¦å–æ¶ˆæ“ä½œï¼Œæ¯”å¦‚ç»ˆæ­¢ HTTP è¯·æ±‚ã€ç»ˆæ­¢è¯»å–æ–‡ä»¶ç­‰ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</span></a></h3><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå®é™…çš„ä½¿ç”¨åœºæ™¯ï¼š</p><h4 id="åœºæ™¯-1-å–æ¶ˆ-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯-1-å–æ¶ˆ-http-è¯·æ±‚"><span>åœºæ™¯ 1: å–æ¶ˆ HTTP è¯·æ±‚</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„<code>fetch</code> APIï¼ˆä» Node.js v17.5 èµ·å¼•å…¥ï¼‰æ¥è¿›è¡Œ HTTP è¯·æ±‚ï¼Œå¹¶ä¸”ä½ æƒ³è¦åœ¨è¯·æ±‚èŠ±è´¹å¤ªé•¿æ—¶é—´æ—¶å–æ¶ˆå®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®è¶…æ—¶æ¥ä¸­æ­¢è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤±è´¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åœºæ™¯-2-å–æ¶ˆæ–‡ä»¶è¯»å–" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯-2-å–æ¶ˆæ–‡ä»¶è¯»å–"><span>åœºæ™¯ 2: å–æ¶ˆæ–‡ä»¶è¯»å–</span></a></h4><p>å‡è®¾ä½ ä½¿ç”¨<code>fs.promises.readFile</code>æ¥å¼‚æ­¥è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶ä¸”ä½ å¸Œæœ›å¦‚æœç”¨æˆ·çªç„¶ä¸å†éœ€è¦è¿™ä¸ªæ–‡ä»¶å†…å®¹ï¼Œèƒ½ç«‹å³åœæ­¢è¯»å–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs/promises&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æŸä¸ªæ¡ä»¶æ»¡è¶³åï¼Œæˆ‘ä»¬å†³å®šä¸å†éœ€è¦æ–‡ä»¶å†…å®¹ï¼Œåˆ™è°ƒç”¨abort</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¾‹å¦‚1ç§’åå–æ¶ˆ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/bigfile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å†…å®¹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–æ“ä½œè¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–æ–‡ä»¶å‡ºé”™&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h3><p><code>AbortController</code> å’Œå®ƒçš„ <code>signal</code> å±æ€§æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æœºåˆ¶æ¥ä¸­æ­¢æ­£åœ¨æ‰§è¡Œçš„æ“ä½œã€‚è¿™åœ¨å¤„ç†é‚£äº›å¯èƒ½éœ€è¦é•¿æ—¶é—´æ‰§è¡Œï¼Œä½†åˆå¯èƒ½ç”±äºå„ç§åŸå› éœ€è¦æå‰ç»“æŸçš„ä»»åŠ¡æ—¶éå¸¸æœ‰ç”¨ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒå¦‚ä½•ç®€åŒ–å¯¹è¿™ç±»æ“ä½œçš„æ§åˆ¶ï¼Œä½¿ä»£ç æ—¢æ¸…æ™°åˆæ˜“äºç®¡ç†ã€‚</p><h3 id="class-abortsignal" tabindex="-1"><a class="header-anchor" href="#class-abortsignal"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-abortsignal" target="_blank" rel="noopener noreferrer">Class: AbortSignal</a></span></a></h3><p>Node.js ä¸­çš„ <code>AbortSignal</code> ç±»æ˜¯ç”¨æ¥å¤„ç†å¯å–æ¶ˆçš„æ“ä½œçš„ã€‚å½“ä½ æœ‰ä¸€äº›å¼‚æ­¥ä»»åŠ¡ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€å‘èµ·ç½‘ç»œè¯·æ±‚ç­‰ï¼Œå¹¶ä¸”ä½ å¸Œæœ›æœ‰èƒ½åŠ›åœ¨è¿™äº›æ“ä½œè¿˜æ²¡å®Œæˆæ—¶å–æ¶ˆå®ƒä»¬ï¼Œ<code>AbortSignal</code> å°±éå¸¸æœ‰ç”¨ã€‚</p><p><code>AbortSignal</code> ç±»æ˜¯åŸºäº DOM çš„ <code>AbortController</code> è§„èŒƒå®ç°çš„ï¼Œå› æ­¤å¦‚æœä½ ç†Ÿæ‚‰å‰ç«¯å¼€å‘ä¸­çš„ <code>fetch</code> API å’Œ <code>AbortController</code> çš„ä½¿ç”¨ï¼Œé‚£ä¹ˆåœ¨ Node.js ä¸­ä½¿ç”¨ <code>AbortSignal</code> ä¼šæ„Ÿåˆ°å¾ˆç†Ÿæ‚‰ã€‚</p><h3 id="åˆ›å»ºä¸€ä¸ª-abortsignal" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-abortsignal"><span>åˆ›å»ºä¸€ä¸ª AbortSignal</span></a></h3><p>è¦ä½¿ç”¨ <code>AbortSignal</code>ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª <code>AbortController</code> å®ä¾‹ï¼Œç„¶åä»ä¸­è·å– <code>signal</code> å±æ€§ã€‚è¿™ä¸ª <code>signal</code> å±æ€§å°±æ˜¯ <code>AbortSignal</code> å¯¹è±¡ï¼Œå®ƒå¯ä»¥ä¼ é€’ç»™æ”¯æŒå–æ¶ˆæ“ä½œçš„å¼‚æ­¥å‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª AbortController å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å– signal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨-abortsignal" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-abortsignal"><span>ä½¿ç”¨ AbortSignal</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šå†…ç½®æ¨¡å—çš„ API æ”¯æŒæ¥æ”¶ä¸€ä¸ª <code>AbortSignal</code> å¯¹è±¡ä¸ºå‚æ•°ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ä½¿ç”¨ <code>fs.promises.readFile</code>ï¼ˆå¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼‰æˆ–è€… <code>http.request</code>ï¼ˆå‘èµ· HTTP è¯·æ±‚ï¼‰æ—¶ä¼ å…¥ <code>AbortSignal</code> æ¥å–æ¶ˆè¿™äº›æ“ä½œã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>AbortSignal</code> å–æ¶ˆ HTTP è¯·æ±‚çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º AbortController å®ä¾‹å’Œå¯¹åº”çš„ signal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘èµ· HTTP GET è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`çŠ¶æ€ç : </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å“åº”ä¸»ä½“: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœè¯·æ±‚è¶…è¿‡ä¸€å®šæ—¶é—´æœªå“åº”ï¼Œå°±å–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å·²è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬è¯·æ±‚æ˜¯å¦å› å–æ¶ˆè€Œç»ˆæ­¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚è¢«ä¸­æ–­&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP GET è¯·æ±‚åˆ° <code>example.com</code>ã€‚æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ª 5 ç§’çš„è®¡æ—¶å™¨ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æœåŠ¡å™¨æ²¡æœ‰å“åº”ï¼Œæˆ‘ä»¬å°±è°ƒç”¨ <code>controller.abort()</code> å–æ¶ˆè¯·æ±‚ã€‚ä¸€æ—¦è¯·æ±‚è¢«å–æ¶ˆï¼Œ<code>AbortError</code> ä¼šè¢«æŠ›å‡ºï¼Œæˆ‘ä»¬åœ¨ç›‘å¬ <code>req</code> å¯¹è±¡çš„ <code>&#39;error&#39;</code> äº‹ä»¶ä¸­æ•è·è¿™ä¸ªé”™è¯¯å¹¶æ‰“å° &#39;è¯·æ±‚è¢«ä¸­æ–­&#39;ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-abortsignal" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-abortsignal"><span>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ AbortSignal</span></a></h3><p>ä½¿ç”¨ <code>AbortSignal</code> æä¾›äº†æ›´å¥½çš„èµ„æºç®¡ç†å’Œç”¨æˆ·ä½“éªŒã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·ç¦»å¼€äº†ä¸€ä¸ªæ­£åœ¨åŠ è½½æ•°æ®çš„é¡µé¢ï¼Œä½ å¯èƒ½ä¸æƒ³ç»§ç»­è¿›è¡Œæ•°æ®åŠ è½½ï¼Œå› ä¸ºè¿™å°†æµªè´¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºã€‚é€šè¿‡ <code>AbortSignal</code>ï¼Œä½ å¯ä»¥ç«‹å³åœæ­¢è¿™äº›ä¸å†éœ€è¦çš„æ“ä½œã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>AbortSignal</code> æ˜¯ Node.js ä¸­å¤„ç†å¯å–æ¶ˆæ“ä½œçš„å¼ºå¤§å·¥å…·ï¼Œå®ƒå…è®¸å¼€å‘è€…ç¼–å†™æ›´åŠ å¥å£®å’Œèµ„æºé«˜æ•ˆçš„ä»£ç ã€‚</p><h4 id="static-method-abortsignal-abort-reason" tabindex="-1"><a class="header-anchor" href="#static-method-abortsignal-abort-reason"><span><a href="https://nodejs.org/docs/latest/api/globals.html#static-method-abortsignalabortreason" target="_blank" rel="noopener noreferrer">Static method: AbortSignal.abort([reason])</a></span></a></h4><p>åœ¨è§£é‡Š <code>AbortSignal.abort([reason])</code> è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>AbortSignal</code>ã€‚<code>AbortSignal</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒç”¨æ¥ä¸å¯ä¸­æ–­çš„æ“ä½œè¿›è¡Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªå¯ä»¥èŠ±è´¹å¾ˆé•¿æ—¶é—´çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å–ç­‰ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›åœ¨æŸäº›æ¡ä»¶ä¸‹å–æ¶ˆè¿™ä¸ªä»»åŠ¡ã€‚<code>AbortSignal</code> å°±æ˜¯ç”¨æ¥æä¾›è¿™ç§å–æ¶ˆæœºåˆ¶çš„ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ <code>AbortSignal.abort([reason])</code> æ–¹æ³•ï¼š</p><h3 id="abortsignal-abort-reason" tabindex="-1"><a class="header-anchor" href="#abortsignal-abort-reason"><span>AbortSignal.abort([reason])</span></a></h3><p>è¿™ä¸ªé™æ€æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>AbortSignal</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å·²ç»è¢«è®¾ç½®æˆ &quot;aborted&quot; çŠ¶æ€ã€‚ä½ å¯ä»¥é€‰æ‹©æ€§åœ°ä¼ é€’ä¸€ä¸ª <code>reason</code> å‚æ•°ï¼Œæ¥è¯´æ˜ä¸ºä»€ä¹ˆè¦ç»ˆæ­¢è¿™ä¸ªä¿¡å·ã€‚</p><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°:</span></a></h4><ul><li><code>reason</code>ï¼ˆå¯é€‰ï¼‰: è¡¨ç¤ºå–æ¶ˆåŸå› çš„å€¼ï¼Œä»»ä½•ç±»å‹éƒ½å¯ä»¥ï¼Œä½†ä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²ã€‚</li></ul><h4 id="è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼"><span>è¿”å›å€¼:</span></a></h4><p>è¿”å›ä¸€ä¸ªå·²ç»å¤„äº &quot;aborted&quot; çŠ¶æ€çš„ <code>AbortSignal</code> å®ä¾‹ã€‚</p><h4 id="ä½¿ç”¨å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨å®ä¾‹"><span>ä½¿ç”¨å®ä¾‹:</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»è¿œç«¯ API è·å–ä¸€äº›æ•°æ®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>fetch</code> æ–¹æ³•æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·çªç„¶å…³é—­é¡µé¢æˆ–è€…å¯¼èˆªåˆ°å…¶å®ƒé¡µé¢ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›è¿™ä¸ªè¯·æ±‚ç»§ç»­æ¶ˆè€—èµ„æºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>AbortSignal</code> æ¥å–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>AbortSignal.abort()</code> æ¥å–æ¶ˆ HTTP è¯·æ±‚çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ åœ¨ Node.js ä¸­ä½¿ç”¨ &#39;node-fetch&#39; æ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå·²ç»æ ‡è®°ä¸º &quot;aborted&quot; çš„ AbortSignal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°è¯•ä½¿ç”¨è¿™ä¸ª signal å‘èµ·ä¸€ä¸ª fetch è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¦‚æœè¯·æ±‚æ²¡æœ‰è¢«å–æ¶ˆï¼Œå°±ä¼šæ‰§è¡Œè¿™é‡Œçš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch completed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å½“è¯·æ±‚å› ä¸º abort è¢«å–æ¶ˆæ—¶ï¼Œæ•è·é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch was aborted:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å¤„ç†å…¶å®ƒç±»å‹çš„é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ±‚ä¼šç«‹å³è¢«å–æ¶ˆï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå·²ç»è¢«è®¾ç½®æˆ &quot;aborted&quot; çŠ¶æ€çš„ signalã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œä½ å¯èƒ½ä¼šæ ¹æ®æŸäº›äº‹ä»¶æ¯”å¦‚ç”¨æˆ·äº¤äº’æ¥å†³å®šä»€ä¹ˆæ—¶å€™å–æ¶ˆä¸€ä¸ªæ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª UI åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»äº†ä¸€ä¸ª &quot;å–æ¶ˆ&quot; æŒ‰é’®ï¼Œä½ å¯ä»¥åœ¨é‚£ä¸ªæ—¶é—´ç‚¹è°ƒç”¨ <code>AbortSignal.abort()</code> æ¥å–æ¶ˆç›¸å…³çš„æ“ä½œã€‚</p><p>è®°ä½ï¼Œ<code>AbortSignal</code> ä¸é™äº <code>fetch</code> è¯·æ±‚ï¼Œå®ƒä¹Ÿå¯ç”¨äºå…¶ä»–æ”¯æŒå¯ä¸­æ–­æ“ä½œçš„ APIï¼Œå¦‚æµå¤„ç†ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ã€‚æ€»çš„æ¥è¯´ï¼Œ<code>AbortSignal</code> å’Œ <code>AbortController</code> æä¾›ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥ç®¡ç†å’Œå–æ¶ˆä¸€äº›å¯èƒ½éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„å¼‚æ­¥æ“ä½œã€‚</p><h4 id="static-method-abortsignal-timeout-delay" tabindex="-1"><a class="header-anchor" href="#static-method-abortsignal-timeout-delay"><span><a href="https://nodejs.org/docs/latest/api/globals.html#static-method-abortsignaltimeoutdelay" target="_blank" rel="noopener noreferrer">Static method: AbortSignal.timeout(delay)</a></span></a></h4><p><code>AbortSignal.timeout(delay)</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå±äº<code>AbortSignal</code>ç±»ã€‚è¿™ä¸ªæ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥åœ¨æŒ‡å®šæ—¶é—´ä¹‹åè‡ªåŠ¨å–æ¶ˆï¼ˆabortï¼‰çš„ä¿¡å·ã€‚è¿™ç§åŠŸèƒ½å¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“ä½ æƒ³è¦åœ¨ä¸€å®šæ—¶é—´å†…é™åˆ¶æŸä¸ªæ“ä½œçš„æ‰§è¡Œæ—¶é—´æ—¶ã€‚</p><h3 id="è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š"><span>è§£é‡Šï¼š</span></a></h3><p>é¦–å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯<code>AbortSignal</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæä¾›äº†ä¸€ä¸ªé€šç”¨çš„ APIï¼Œå…è®¸ä½ å‘é€å–æ¶ˆä¿¡å·åˆ°æŸäº›å¼‚æ­¥æˆ–åŸºäºæ—¶é—´çš„æ“ä½œä¸Šã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ å‘èµ·äº†ä¸€ä¸ªç½‘ç»œè¯·æ±‚ä½†ä¸æƒ³ç­‰å¾…å¤ªä¹…ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>AbortSignal</code>æ¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶ï¼Œå¦‚æœè¯·æ±‚åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰å®Œæˆï¼Œå°±è‡ªåŠ¨å–æ¶ˆå®ƒã€‚</p><p>ç°åœ¨æ¥çœ‹<code>AbortSignal.timeout(delay)</code>æ–¹æ³•ï¼š</p><ul><li><code>delay</code>å‚æ•°ä»£è¡¨è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼ˆmsï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥è®¾å®šå¤šä¹…ä¹‹åéœ€è¦è§¦å‘å–æ¶ˆæ“ä½œã€‚</li><li>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>AbortSignal</code>å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹ä¼šåœ¨æŒ‡å®šçš„<code>delay</code>æ—¶é—´åè¢«è‡ªåŠ¨æ ‡è®°ä¸º&quot;aborted&quot;ï¼ˆå·²å–æ¶ˆï¼‰çŠ¶æ€ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h3><h4 id="ç¤ºä¾‹-1-é™åˆ¶-http-è¯·æ±‚è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-é™åˆ¶-http-è¯·æ±‚è¶…æ—¶"><span>ç¤ºä¾‹ 1ï¼šé™åˆ¶ HTTP è¯·æ±‚è¶…æ—¶</span></a></h4><p>å‡è®¾ä½ åœ¨ Node.js åº”ç”¨ä¸­éœ€è¦å‘å¤–éƒ¨æœåŠ¡å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œä½†ä½ å¸Œæœ›å¦‚æœè¯¥è¯·æ±‚åœ¨ 5 ç§’å†…æ²¡æœ‰å“åº”ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆå®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort_controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåœ¨5000æ¯«ç§’åè‡ªåŠ¨å–æ¶ˆçš„AbortSignal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¤„ç†å“åº”...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å› è¶…æ—¶è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†å…¶ä»–ç±»å‹çš„é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ 5 ç§’å†…æœåŠ¡å™¨æ²¡æœ‰å“åº”ï¼Œ<code>AbortSignal</code>å¯¹è±¡ä¼šå˜æˆå–æ¶ˆçŠ¶æ€ï¼Œä»è€Œè§¦å‘ HTTP è¯·æ±‚çš„&#39;error&#39;äº‹ä»¶ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªåä¸º&#39;AbortError&#39;çš„é”™è¯¯å¯¹è±¡ã€‚</p><h4 id="ç¤ºä¾‹-2-é™åˆ¶æŸä¸ªå¼‚æ­¥æ“ä½œçš„æ‰§è¡Œæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-é™åˆ¶æŸä¸ªå¼‚æ­¥æ“ä½œçš„æ‰§è¡Œæ—¶é—´"><span>ç¤ºä¾‹ 2ï¼šé™åˆ¶æŸä¸ªå¼‚æ­¥æ“ä½œçš„æ‰§è¡Œæ—¶é—´</span></a></h4><p>æƒ³è±¡ä½ æœ‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°<code>doSomethingAsync</code>ï¼Œè¿™ä¸ªå‡½æ•°é€šå¸¸éœ€è¦ä¸€äº›æ—¶é—´æ¥å®Œæˆã€‚å¦‚æœä½ æƒ³é™åˆ¶å®ƒçš„æ‰§è¡Œæ—¶é—´ï¼Œé˜²æ­¢å®ƒè¿è¡Œå¾—å¤ªä¹…ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort_controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doSomethingAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¨¡æ‹Ÿä¸€äº›å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> timeoutId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®Œæˆäº†!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™ä¸ªæ“ä½œéœ€è¦3ç§’é’Ÿ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // ç›‘å¬abortä¿¡å·ï¼Œå¦‚æœæ”¶åˆ°åˆ™æ¸…é™¤å®šæ—¶å™¨å¹¶æŠ›å‡ºé”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        clearTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timeoutId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ“ä½œè¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåœ¨2ç§’åä¼šè‡ªåŠ¨å–æ¶ˆçš„AbortSignal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¼ å…¥AbortSignal</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doSomethingAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœå‡½æ•°<code>doSomethingAsync</code>åœ¨ 2 ç§’å†…æ²¡æœ‰å®Œæˆï¼Œé‚£ä¹ˆ<code>signal</code>ä¼šå˜ä¸ºå–æ¶ˆçŠ¶æ€ï¼Œå¯¼è‡´ç›‘å¬å™¨è¢«è°ƒç”¨ï¼Œè¿›è€Œæ¸…é™¤å®šæ—¶å™¨å¹¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸåœ°é™åˆ¶äº†è¯¥æ“ä½œçš„æœ€é•¿æ‰§è¡Œæ—¶é—´ã€‚</p><h4 id="static-method-abortsignal-any-signals" tabindex="-1"><a class="header-anchor" href="#static-method-abortsignal-any-signals"><span><a href="https://nodejs.org/docs/latest/api/globals.html#static-method-abortsignalanysignals" target="_blank" rel="noopener noreferrer">Static method: AbortSignal.any(signals)</a></span></a></h4><h3 id="è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-1"><span>è§£é‡Š</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>AbortSignal.any(signals)</code>æ˜¯ä¸€ç§é™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„<code>AbortSignal</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šåœ¨ä¼ å…¥çš„ä»»ä½•ä¸€ä¸ª<code>AbortSignal</code>å¯¹è±¡è§¦å‘ä¸­æ­¢æ—¶ä¹Ÿè§¦å‘ä¸­æ­¢ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå…è®¸ä½ å°†å¤šä¸ªå–æ¶ˆä¿¡å·ï¼ˆ<code>AbortSignal</code>ï¼‰ç»„åˆæˆä¸€ä¸ªï¼Œåªè¦ç»„åˆé‡Œçš„ä»»ä½•ä¸€ä¸ªä¿¡å·è¢«è§¦å‘äº†â€œä¸­æ­¢â€ï¼Œè¿™ä¸ªæ–°åˆ›å»ºçš„ä¿¡å·å°±ä¼šè·Ÿç€è¢«è§¦å‘ã€‚</p><p><code>AbortSignal</code>é€šå¸¸ç”¨äºå¯ä¸­æ­¢çš„æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ï¼Œä»¥æä¾›ä¸€ç§å–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„æ“ä½œçš„æ‰‹æ®µã€‚</p><h3 id="ä¸¾ä¾‹è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¾‹è¯´æ˜"><span>ä¸¾ä¾‹è¯´æ˜</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘ç«™åç«¯æœåŠ¡ï¼Œä½ éœ€è¦åŒæ—¶ä»ä¸¤ä¸ªä¸åŒçš„ API è·å–æ•°æ®ï¼Œä½†ä½ å¸Œæœ›å¦‚æœå…¶ä¸­ä¸€ä¸ª API å“åº”æ—¶é—´è¿‡é•¿ï¼Œå°±å–æ¶ˆå¯¹ä¸¤ä¸ª API çš„è°ƒç”¨ï¼Œä»¥èŠ‚çº¦èµ„æºå’Œæ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort_controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ ä½¿ç”¨node-fetchæ¥å‘é€HTTPè¯·æ±‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸¤ä¸ªAbortControllerå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨AbortSignal.anyé™æ€æ–¹æ³•åˆå¹¶ä¸¤ä¸ªä¿¡å·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> combinedSignal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾å®šè¶…æ—¶å‡½æ•°ï¼Œå¦‚æœ5ç§’å†…æœªå®Œæˆï¼Œåˆ™è§¦å‘ä¸­æ­¢</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œä»…è§¦å‘ä¸€ä¸ªä¸­æ­¢ï¼Œä½†ç”±äºä½¿ç”¨äº†AbortSignal.anyï¼Œä¸¤ä¸ªè¯·æ±‚éƒ½ä¼šè¢«å–æ¶ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿå‘ç¬¬ä¸€ä¸ªAPIå‘è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">combinedSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚1è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿå‘ç¬¬äºŒä¸ªAPIå‘è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example2.com/data2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">combinedSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚2è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼š</p><ul><li>æˆ‘ä»¬åˆ†åˆ«ä¸ºä¸¤ä¸ª API è¯·æ±‚åˆ›å»ºäº†å„è‡ªçš„<code>AbortController</code>ã€‚</li><li>ä½¿ç”¨<code>AbortSignal.any</code>æŠŠä¸¤ä¸ªå–æ¶ˆä¿¡å·åˆå¹¶æˆä¸€ä¸ªã€‚</li><li>å¦‚æœä»»æ„ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œäº†ä¸­æ­¢æ“ä½œï¼ˆæœ¬ä¾‹ä¸­æ˜¯é€šè¿‡<code>setTimeout</code>æ¨¡æ‹Ÿçš„ 5 ç§’è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰ä½¿ç”¨è¯¥åˆå¹¶ä¿¡å·çš„è¯·æ±‚éƒ½ä¼šè¢«å–æ¶ˆã€‚</li><li>è¿™æ ·åšå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç®¡ç†å¤šä¸ªå¯èƒ½éœ€è¦åŒæ—¶å–æ¶ˆçš„å¼‚æ­¥æ“ä½œï¼Œä¿è¯å®ƒä»¬èƒ½å¤ŸåŒæ­¥åœ°è¢«ä¸­æ–­ï¼Œé¿å…èµ„æºæµªè´¹ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¢åŠ ä»£ç çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚</p><h4 id="event-abort" tabindex="-1"><a class="header-anchor" href="#event-abort"><span><a href="https://nodejs.org/docs/latest/api/globals.html#event-abort" target="_blank" rel="noopener noreferrer">Event: &#39;abort&#39;</a></span></a></h4><p>å½“ä½ å¼€å§‹å­¦ä¹  Node.jsï¼Œäº†è§£å®ƒå¦‚ä½•å¤„ç†å„ç§äº‹ä»¶æ˜¯éå¸¸é‡è¦çš„ã€‚åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå¯¹è±¡éƒ½ä¼šè§¦å‘äº‹ä»¶ï¼›æ¯”å¦‚è¯´ï¼Œå½“ä¸€ä¸ª HTTP è¯·æ±‚è¢«å–æ¶ˆæ—¶ï¼Œæˆ–æ˜¯å½“ä¸€ä¸ª streamï¼ˆæ•°æ®æµï¼‰è¢«å…³é—­æ—¶ã€‚ä»Šå¤©æˆ‘ä»¬è¦è°ˆè®ºçš„æ˜¯<code>&#39;abort&#39;</code>äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶é€šå¸¸ä¸ä¸­æ–­æ“ä½œæœ‰å…³ã€‚</p><h3 id="abort-äº‹ä»¶æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#abort-äº‹ä»¶æ˜¯ä»€ä¹ˆ"><span><code>&#39;abort&#39;</code>äº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œå½“æŸä¸ªæ“ä½œæˆ–ä»»åŠ¡ï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å–ç­‰ï¼‰è¢«ä¸­æ–­æ—¶ï¼Œä¼šè§¦å‘<code>&#39;abort&#39;</code>äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶æœ€å¸¸è§çš„ç”¨é€”ä¹‹ä¸€æ˜¯ä¸ AbortController æ¥å£ç»“åˆä½¿ç”¨ï¼Œè¯¥æ¥å£å…è®¸ä½ é€šè¿‡å‘é€ä¸­æ–­ä¿¡å·æ¥å–æ¶ˆä¸€ä¸ªæˆ–å¤šä¸ª Web è¯·æ±‚ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-å–æ¶ˆ-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_1-å–æ¶ˆ-http-è¯·æ±‚"><span>1. å–æ¶ˆ HTTP è¯·æ±‚</span></a></h4><p>åœ¨è¿›è¡Œ Web å¼€å‘æ—¶ï¼Œå¯èƒ½éœ€è¦æ ¹æ®ç”¨æˆ·äº¤äº’å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ HTTP è¯·æ±‚ã€‚æ¯”æ–¹è¯´ï¼Œç”¨æˆ·å¡«å†™è¡¨å•å¹¶æäº¤ï¼Œä½†çªç„¶å†³å®šå–æ¶ˆæ“ä½œå¹¶ä¸”ç‚¹å‡»äº†&quot;å–æ¶ˆ&quot;æŒ‰é’®ã€‚æ­¤æ—¶ï¼Œå¦‚æœ HTTP è¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ï¼Œä½¿ç”¨<code>&#39;abort&#39;</code>äº‹ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœæ­¢è¿™ä¸ªè¯·æ±‚ï¼Œä»è€ŒèŠ‚çœèµ„æºï¼Œæé«˜åº”ç”¨æ€§èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªAbortControllerå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`çŠ¶æ€ç : </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å“åº”...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœsignalæ”¶åˆ°äº†abortäº‹ä»¶ï¼Œå–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å·²è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿç”¨æˆ·å–æ¶ˆæ“ä½œ, 5ç§’åå–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>AbortController</code>å®ä¾‹å’Œå®ƒçš„<code>signal</code>ã€‚å½“è°ƒç”¨<code>controller.abort()</code>æ–¹æ³•æ—¶ï¼Œæ‰€æœ‰ç›‘å¬è¯¥<code>signal</code>å¯¹è±¡çš„<code>&#39;abort&#39;</code>äº‹ä»¶å¤„ç†å‡½æ•°éƒ½ä¼šè¢«æ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>req.destroy()</code>æ–¹æ³•å–æ¶ˆäº† HTTP è¯·æ±‚ï¼Œå¹¶æ‰“å°å‡ºäº†<code>è¯·æ±‚å·²è¢«å–æ¶ˆ</code>ã€‚</p><h4 id="_2-node-fetch-ä¸­ä½¿ç”¨-abort" tabindex="-1"><a class="header-anchor" href="#_2-node-fetch-ä¸­ä½¿ç”¨-abort"><span>2. node-fetch ä¸­ä½¿ç”¨<code>&#39;abort&#39;</code></span></a></h4><p>åœ¨ä½¿ç”¨<code>node-fetch</code>åº“å‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨<code>&#39;abort&#39;</code>äº‹ä»¶æ¥å–æ¶ˆè¯·æ±‚ã€‚<code>node-fetch</code>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ¨¡å—ï¼Œä½¿å¾—åœ¨ Node.js ç¯å¢ƒä¸­ä½¿ç”¨ Fetch API æˆä¸ºå¯èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªAbortControllerå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘èµ·ä¸€ä¸ªfetchè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚è¢«å–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤±è´¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡ä»¿ç”¨æˆ·æ“ä½œï¼Œ5ç§’åå–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“<code>controller.abort()</code>è¢«è°ƒç”¨æ—¶ï¼Œå¦‚æœ fetch è¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ï¼Œå®ƒä¼šç«‹å³è¢«å–æ¶ˆï¼Œå¹¶ä¸”æŠ›å‡ºä¸€ä¸ªåä¸º<code>AbortError</code>çš„é”™è¯¯ã€‚æˆ‘ä»¬é€šè¿‡æ•è·è¿™ä¸ªé”™è¯¯ï¼Œå¯ä»¥ç¡®å®šè¯·æ±‚ç¡®å®å› ä¸ºè¢«å–æ¶ˆè€Œç»ˆæ­¢ã€‚</p><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h3><p><code>&#39;abort&#39;</code>äº‹ä»¶åœ¨ Node.js ä¸­æ˜¯å¤„ç†å¯ä»¥è¢«ä¸­æ–­çš„æ“ä½œçš„ä¸€ä¸ªæœ‰ç”¨å·¥å…·ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒå¦‚ä½•å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆç®¡ç†èµ„æºï¼Œå¹¶å¯¹ç”¨æˆ·çš„å®æ—¶æ“ä½œåšå‡ºå¿«é€Ÿå“åº”ã€‚ä¸ä»…é™äº HTTP è¯·æ±‚ï¼Œä»»ä½•æ”¯æŒ Signal å’Œ<code>&#39;abort&#39;</code>äº‹ä»¶çš„ API éƒ½å¯ä»¥åˆ©ç”¨è¿™ç§æœºåˆ¶æ¥æé«˜åº”ç”¨çš„å“åº”æ€§å’Œæ€§èƒ½ã€‚</p><h4 id="abortsignal-aborted" tabindex="-1"><a class="header-anchor" href="#abortsignal-aborted"><span><a href="https://nodejs.org/docs/latest/api/globals.html#abortsignalaborted" target="_blank" rel="noopener noreferrer">abortSignal.aborted</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä»¥ç®€å•ã€æ˜“æ‡‚çš„æ–¹å¼æ¥è®¨è®º Node.js ä¸­çš„ <code>abortSignal.aborted</code> å±æ€§ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-abortsignal" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-abortsignal"><span>ä»€ä¹ˆæ˜¯ AbortSignal?</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>AbortSignal</code>ã€‚åœ¨ Node.js (åŒæ ·é€‚ç”¨äºç°ä»£æµè§ˆå™¨çš„ JavaScript)ä¸­ï¼Œ<code>AbortSignal</code> å¯¹è±¡æ˜¯ç”¨æ¥ä¸ä¸€ä¸ªæˆ–å¤šä¸ª DOM è¯·æ±‚ï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼‰é€šä¿¡çš„æœºåˆ¶ï¼Œå…è®¸ä½ éšæ—¶å–æ¶ˆè¿™äº›è¯·æ±‚ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœä½ å¯åŠ¨äº†ä¸€ä¸ªä»»åŠ¡ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸‹è½½ã€API è°ƒç”¨ç­‰ï¼Œè€Œåœ¨æŸä¸€æ—¶åˆ»ä½ æƒ³è¦å–æ¶ˆè¿™ä¸ªä»»åŠ¡ï¼Œ<code>AbortSignal</code> å’Œ <code>AbortController</code> å°±æ´¾ä¸Šäº†ç”¨åœºã€‚</p><h3 id="abortsignal-aborted-å±æ€§" tabindex="-1"><a class="header-anchor" href="#abortsignal-aborted-å±æ€§"><span>abortSignal.aborted å±æ€§</span></a></h3><p><code>abortSignal.aborted</code> æ˜¯ <code>AbortSignal</code> å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚å®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼Œè¡¨ç¤ºä¸è¯¥ <code>AbortSignal</code> ç›¸å…³è”çš„æ“ä½œæ˜¯å¦å·²ç»è¢«å–æ¶ˆã€‚å¦‚æœæ“ä½œå·²è¢«å–æ¶ˆï¼Œ<code>aborted</code> å±æ€§å°±ä¼šæ˜¯ <code>true</code>ï¼›å¦åˆ™ä¸º <code>false</code>ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-1"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><ol><li><p><strong>åˆ›å»º <code>AbortController</code></strong></p><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª <code>AbortController</code> çš„å®ä¾‹ã€‚<code>AbortController</code> æä¾›äº†ä¸€ä¸ª <code>signal</code> å±æ€§ï¼Œå¯ä»¥ä¼ ç»™æ”¯æŒå–æ¶ˆçš„å¼‚æ­¥æ“ä½œï¼Œä»¥åŠä¸€ä¸ª <code>abort</code> æ–¹æ³•ï¼Œç”¨äºå–æ¶ˆæ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¿›è¡Œå–æ¶ˆæ“ä½œ</strong></p><p>åœ¨æ‰§è¡Œéœ€è¦å¯å–æ¶ˆæ“ä½œçš„å‡½æ•°æ—¶ï¼Œä½ å°† <code>signal</code> ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ç„¶åï¼Œåœ¨éœ€è¦å–æ¶ˆæ“ä½œçš„æ—¶å€™ï¼Œè°ƒç”¨ <code>controller.abort()</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿä¸€ä¸ªéœ€è¦å–æ¶ˆçš„å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">aborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Operation was already aborted&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Operation aborted!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ç­‰å¾…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Operation completed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 1ç§’åå–æ¶ˆæ“ä½œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="å–æ¶ˆç½‘ç»œè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#å–æ¶ˆç½‘ç»œè¯·æ±‚"><span>å–æ¶ˆç½‘ç»œè¯·æ±‚</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨å¦‚ Fetch API å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ç”¨æˆ·ç¦»å¼€é¡µé¢æˆ–åˆ‡æ¢ç»„ä»¶æ—¶å–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚é€šè¿‡ä¼ é€’ <code>signal</code> ç»™ fetch æ–¹æ³•ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨ <code>abort</code> æ–¹æ³•ï¼Œå¯ä»¥è½»æ¾å®ç°è¿™ä¸€ç‚¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/api/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch aborted&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨æ•°æ®è¿˜æ²¡å›æ¥å‰ç”¨æˆ·è·³è½¬äº†é¡µé¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h3><ul><li><code>AbortSignal</code> å’Œ <code>AbortController</code> æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ä½ å–æ¶ˆä¸€äº›å¼‚æ­¥æ“ä½œï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€‚</li><li><code>abortSignal.aborted</code> å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç›¸å…³æ“ä½œæ˜¯å¦å·²è¢«å–æ¶ˆã€‚</li><li>ä½¿ç”¨ <code>AbortController</code> åˆ›å»º <code>signal</code>ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°å¼‚æ­¥æ“ä½œä¸­ã€‚å½“éœ€è¦å–æ¶ˆæ“ä½œæ—¶ï¼Œåªéœ€è¦è°ƒç”¨ <code>controller.abort()</code>ã€‚</li></ul><h4 id="abortsignal-onabort" tabindex="-1"><a class="header-anchor" href="#abortsignal-onabort"><span><a href="https://nodejs.org/docs/latest/api/globals.html#abortsignalonabort" target="_blank" rel="noopener noreferrer">abortSignal.onabort</a></span></a></h4><p>Node.js ä¸­çš„ <code>abortSignal.onabort</code> æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ï¼Œå®ƒå…³è”äº <code>AbortSignal</code> å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æ˜¯ç”¨æ¥ä¸ <code>AbortController</code> ä¸€èµ·å·¥ä½œçš„ï¼Œå…è®¸ä½ å–æ¶ˆæŸäº›å¼‚æ­¥ä»»åŠ¡ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™æ“ä½œæˆ–ä»»ä½•è¿”å› <code>Promise</code> çš„æ“ä½œã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•ç†è§£ä¸‹ <code>AbortController</code> å’Œ <code>AbortSignal</code>ï¼š</p><ul><li><strong><code>AbortController</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œç”¨äºå‘å‡ºå–æ¶ˆä¿¡å·ã€‚å½“ä½ æƒ³å–æ¶ˆä¸€é¡¹æ“ä½œæ—¶ï¼Œä½ ä¼šé€šè¿‡è¿™ä¸ªæ§åˆ¶å™¨å‘å‡ºä¸€ä¸ªä¿¡å·ã€‚</li><li><strong><code>AbortSignal</code></strong>ï¼šè¿™æ˜¯ä» <code>AbortController</code> è·å¾—çš„ä¿¡å·å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«ä¼ é€’åˆ°ä»»ä½•æ”¯æŒå–æ¶ˆæ“ä½œçš„å¼‚æ­¥ä»»åŠ¡ä¸­ã€‚è¿™ä¸ªä¿¡å·åŒ…å«äº†å–æ¶ˆçš„çŠ¶æ€å’Œä¸€ä¸ª <code>onabort</code> äº‹ä»¶å¤„ç†å™¨ï¼Œå½“ä¿¡å·å˜ä¸ºâ€œå·²å–æ¶ˆâ€æ—¶ï¼Œ<code>onabort</code> äº‹ä»¶å°†è¢«è§¦å‘ã€‚</li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸¾å‡ ä¸ªå®è·µä¸­çš„ä¾‹å­æ¥çœ‹çœ‹ <code>abortSignal.onabort</code> æ˜¯æ€æ ·å·¥ä½œçš„ã€‚</p><h3 id="ç¤ºä¾‹-1-å–æ¶ˆ-http-è¯·æ±‚-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å–æ¶ˆ-http-è¯·æ±‚-1"><span>ç¤ºä¾‹ 1: å–æ¶ˆ HTTP è¯·æ±‚</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„ <code>fetch()</code> API å‘é€ HTTP è¯·æ±‚ï¼Œä½†å› ä¸ºæŸäº›åŸå› ï¼ˆæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»äº†å–æ¶ˆæŒ‰é’®ï¼‰ï¼Œä½ éœ€è¦å–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¡®ä¿ä½ å®‰è£…äº†node-fetchåº“</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">onabort</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚è¢«å–æ¶ˆ!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯åŠ¨ä¸€ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å› ä¸ºè°ƒç”¨ abort() è€Œå–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤±è´¥: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨5ç§’åï¼Œæˆ‘ä»¬å†³å®šå–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-2-å–æ¶ˆæ–‡ä»¶è¯»å–æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å–æ¶ˆæ–‡ä»¶è¯»å–æ“ä½œ"><span>ç¤ºä¾‹ 2: å–æ¶ˆæ–‡ä»¶è¯»å–æ“ä½œ</span></a></h3><p>å¦‚æœä½ æ­£åœ¨è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä½†ç”¨æˆ·å¸Œæœ›åœæ­¢è¿™ä¸ªæ“ä½œï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>AbortController</code> æ¥å–æ¶ˆå®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs/promises&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¡®ä¿ä½ å®‰è£…äº†abort-controlleråº“</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">onabort</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶è¯»å–è¢«å–æ¶ˆ!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/largefile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å†…å®¹: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶è¯»å–å› ä¸ºè°ƒç”¨ abort() è€Œå–æ¶ˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–æ–‡ä»¶å¤±è´¥: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨2ç§’åï¼Œæˆ‘ä»¬å†³å®šå–æ¶ˆæ–‡ä»¶è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œ<code>abortSignal.onabort</code> å…è®¸ä½ è®¾ç½®å½“æ“ä½œè¢«å–æ¶ˆæ—¶æ‰§è¡Œçš„ä»£ç ï¼Œè¿™å¯¹äºæ¸…ç†èµ„æºã€æ›´æ–° UI æç¤ºä¿¡æ¯ç­‰éå¸¸æœ‰ç”¨ã€‚ä½¿ç”¨ <code>AbortController</code> å’Œ <code>AbortSignal</code> æä¾›äº†ä¸€ç§ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†éœ€è¦å–æ¶ˆçš„å¼‚æ­¥ä»»åŠ¡ã€‚</p><h4 id="abortsignal-reason" tabindex="-1"><a class="header-anchor" href="#abortsignal-reason"><span><a href="https://nodejs.org/docs/latest/api/globals.html#abortsignalreason" target="_blank" rel="noopener noreferrer">abortSignal.reason</a></span></a></h4><p>ç†è§£<code>abortSignal.reason</code>ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆèŠèŠ Node.js ä¸­çš„<code>AbortController</code>å’Œ<code>AbortSignal</code>ï¼Œè¿™ä¼šå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£<code>abortSignal.reason</code>çš„ä½œç”¨ã€‚</p><h3 id="abortcontroller-å’Œ-abortsignal" tabindex="-1"><a class="header-anchor" href="#abortcontroller-å’Œ-abortsignal"><span>AbortController å’Œ AbortSignal</span></a></h3><p>åœ¨ Node.jsï¼ˆå’Œç°ä»£ JavaScriptï¼‰ä¸­ï¼Œ<code>AbortController</code>æ˜¯ä¸€ä¸ªç”¨äºå‘å‡ºå–æ¶ˆä¿¡å·çš„å·¥å…·ã€‚å®ƒå¯ä»¥ä¸å„ç§ APIs ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æä¾›å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„å¼‚æ­¥ä»»åŠ¡çš„èƒ½åŠ›ã€‚å½“ä½ åˆ›å»ºäº†ä¸€ä¸ª<code>AbortController</code>å®ä¾‹ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒçš„<code>signal</code>å±æ€§è·å¾—ä¸€ä¸ª<code>AbortSignal</code>å¯¹è±¡ã€‚è¿™ä¸ª<code>AbortSignal</code>å¯ä»¥ä¼ é€’ç»™æ”¯æŒå–æ¶ˆæ“ä½œçš„ä»»ä½•å¼‚æ­¥ APIï¼Œä»¥å…è®¸ä½ åœ¨éœ€è¦æ—¶å–æ¶ˆè¯¥æ“ä½œã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚è·å–æ•°æ®ï¼Œä½†ç”±äºæŸç§åŸå› ï¼ˆæ¯”å¦‚ç”¨æˆ·å¯¼èˆªç¦»å¼€å½“å‰é¡µé¢ï¼‰ï¼Œä½ æƒ³è¦å–æ¶ˆè¿™ä¸ªè¿˜åœ¨è¿›è¡Œä¸­çš„è¯·æ±‚ã€‚è¿™æ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>AbortController</code>å’Œ<code>AbortSignal</code>æ¥è¾¾æˆè¿™ä¸ªç›®æ ‡ã€‚</p><h3 id="abortsignal-reason-1" tabindex="-1"><a class="header-anchor" href="#abortsignal-reason-1"><span>abortSignal.reason</span></a></h3><p>ä» Node.js v16.5.0 å¼€å§‹ï¼ŒAbortSignal å¢åŠ äº†ä¸€ä¸ªæ–°çš„å±æ€§ï¼š<code>reason</code>ã€‚è¿™ä¸ªå±æ€§æä¾›äº†ä¸€ä¸ªæ–¹å¼æ¥å­˜å‚¨å–æ¶ˆæ“ä½œçš„åŸå› ï¼Œä½¿å¾—é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ›´åŠ ç›´æ¥å’Œç®€å•ã€‚</p><p>å½“ä½ è°ƒç”¨<code>AbortController</code>çš„<code>abort([reason])</code>æ–¹æ³•å–æ¶ˆä¸€ä¸ªæ“ä½œæ—¶ï¼Œä½ å¯ä»¥å¯é€‰åœ°æä¾›ä¸€ä¸ªâ€œåŸå› â€ï¼Œè¿™ä¸ªåŸå› ä¼šè¢«å­˜å‚¨åœ¨å…³è”<code>AbortSignal</code>çš„<code>reason</code>å±æ€§ä¸­ã€‚å¦‚æœæ²¡æœ‰æä¾›åŸå› ï¼Œæˆ–è€…<code>abort()</code>åœ¨æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œåˆ™<code>reason</code>å°†æ˜¯ä¸€ä¸ªé€šç”¨çš„<code>AbortError</code>ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä½¿ç”¨<code>fetch</code>æ¥å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼Œå¹¶ä¸”ä½ æƒ³è¦èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„æƒ…å†µå–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾1ç§’åï¼Œæˆ‘ä»¬å‡ºäºæŸç§åŸå› éœ€è¦å–æ¶ˆè¿™ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚è¶…æ—¶&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œå¤„ç†ä½ çš„å“åº”æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¯·æ±‚è¢«å–æ¶ˆ: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reason</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // è¾“å‡º: è¯·æ±‚è¢«å–æ¶ˆ: è¯·æ±‚è¶…æ—¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å¤„ç†å…¶ä»–å¯èƒ½çš„é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è°ƒç”¨å‡½æ•°è¿›è¡Œæµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>controller.abort(&#39;è¯·æ±‚è¶…æ—¶&#39;);</code>è¿™è¡Œä»£ç ä¼šå–æ¶ˆè¯·æ±‚ï¼Œå¹¶å°†å­—ç¬¦ä¸²<code>&#39;è¯·æ±‚è¶…æ—¶&#39;</code>è®¾ç½®ä¸ºå–æ¶ˆæ“ä½œçš„åŸå› ã€‚è¿™ä¸ªåŸå› éšåå¯ä»¥é€šè¿‡<code>signal.reason</code>è®¿é—®åˆ°ï¼Œè¿™åœ¨å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•ä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæä¾›äº†å–æ¶ˆæ“ä½œèƒŒåçš„å…·ä½“åŸå› ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>abortSignal.reason</code>ç»™äºˆäº†å¼€å‘è€…ä¸€ä¸ªåœ¨å–æ¶ˆå¼‚æ­¥æ“ä½œæ—¶é™„å¸¦åŸå› çš„èƒ½åŠ›ï¼Œè¿™å¯¹äºé”™è¯¯å¤„ç†ã€è°ƒè¯•å’Œé€šçŸ¥ç”¨æˆ·å–æ¶ˆçš„åŸå› éå¸¸æœ‰å¸®åŠ©ã€‚</p><h4 id="abortsignal-throwifaborted" tabindex="-1"><a class="header-anchor" href="#abortsignal-throwifaborted"><span><a href="https://nodejs.org/docs/latest/api/globals.html#abortsignalthrowifaborted" target="_blank" rel="noopener noreferrer">abortSignal.throwIfAborted()</a></span></a></h4><p>Node.js ä¸­çš„ <code>AbortSignal</code> å¯¹è±¡æ˜¯ç”¨æ¥é€šä¿¡çš„ï¼Œå®ƒå…è®¸ä½ å‘é€ä¸€ä¸ªä¿¡å·ä»¥è¡¨æ˜æŸä¸ªæ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ï¼‰åº”è¯¥è¢«å–æ¶ˆã€‚<code>AbortSignal</code> æ˜¯ <code>AbortController</code> çš„ä¸€éƒ¨åˆ†ï¼Œè€Œ <code>AbortController</code> å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯ä»¥ä¼ é€’åˆ°éœ€è¦æ”¯æŒå–æ¶ˆæ“ä½œçš„å‡½æ•°ä¸­çš„ä¿¡å·ã€‚</p><p>åœ¨ Node.js é‡Œï¼Œ<code>AbortSignal.throwIfAborted()</code> æ–¹æ³•æ˜¯ç”¨æ¥æ£€æŸ¥æ˜¯å¦æœ‰å–æ¶ˆä¿¡å·å‘å‡ºçš„ä¸€ç§å¿«æ·æ–¹å¼ã€‚å¦‚æœ <code>AbortSignal</code> å·²ç»è¢«è§¦å‘ï¼ˆå³æ“ä½œå·²è¢«è¯·æ±‚å–æ¶ˆï¼‰ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ª <code>AbortError</code> é”™è¯¯ï¼›å¦‚æœæ²¡æœ‰è¢«è§¦å‘ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>AbortSignal.throwIfAborted()</code> çš„å‡ ä¸ªå®é™…ä½¿ç”¨ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-ä½¿ç”¨-fetch-è¿›è¡Œç½‘ç»œè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ä½¿ç”¨-fetch-è¿›è¡Œç½‘ç»œè¯·æ±‚"><span>ä¾‹å­ 1ï¼šä½¿ç”¨ <code>fetch</code> è¿›è¡Œç½‘ç»œè¯·æ±‚</span></a></h3><p>å½“ä½ ä½¿ç”¨æ”¯æŒ <code>AbortSignal</code> çš„ <code>fetch</code> å‡½æ•°è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å–æ¶ˆè¯·æ±‚ã€‚æ¯”å¦‚è¯´ï¼Œç”¨æˆ·ç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®åå¼€å§‹åŠ è½½æ•°æ®ï¼Œä½†æ˜¯åˆè¿…é€Ÿç‚¹å‡»å–æ¶ˆã€‚è¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨ <code>AbortController</code> å’Œ <code>AbortSignal</code> æ¥å–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch aborted by the user.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æŸäº›æ¡ä»¶ä¸‹æˆ‘ä»¬æƒ³è¦å–æ¶ˆè¯·æ±‚ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€å–æ¶ˆä¿¡å·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯”å¦‚åœ¨1ç§’åå–æ¶ˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¾‹å­-2-ä½¿ç”¨-fs-promises-è¯»å–æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨-fs-promises-è¯»å–æ–‡ä»¶"><span>ä¾‹å­ 2ï¼šä½¿ç”¨ <code>fs.promises</code> è¯»å–æ–‡ä»¶</span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼ˆ<code>fs</code>ï¼‰ä¸­çš„ promises API è¯»å–æ–‡ä»¶æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥å–æ¶ˆè¿™ä¸ªæ“ä½œï¼Œå¦‚æœè¯¥æ“ä½œé•¿æ—¶é—´æœªå®Œæˆï¼Œæ¯”å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs/promises&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> filePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/path/to/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Read file operation was aborted.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error reading file:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœ5ç§’å†…æ–‡ä»¶è¿˜æœªè¯»å®Œï¼Œå°±å–æ¶ˆè¿™æ¬¡æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½æ²¡æœ‰ç›´æ¥ä½¿ç”¨ <code>throwIfAborted()</code>ã€‚ä½†æ˜¯ï¼Œåœ¨ä½ è‡ªå·±çš„ä»£ç ä¸­ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ç¼–å†™ä¸€ä¸ªéœ€è¦å“åº”å–æ¶ˆä¿¡å·çš„å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨æ“ä½œå¼€å§‹å‰ç«‹å³æ£€æŸ¥æ˜¯å¦å·²ç»è¢«å–æ¶ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">throwIfAborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ... æ‰§è¡Œä¸€äº›æ“ä½œ ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨æ“ä½œè¿‡ç¨‹ä¸­å®šæœŸæ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">aborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">throwIfAborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœå·²ç»å–æ¶ˆï¼Œä¼šæŠ›å‡ºé”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ... å®Œæˆæ“ä½œ ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Operation aborted by the user.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…¶ä»–é”™è¯¯ç»§ç»­æŠ›å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å–æ¶ˆæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>doSomething</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>signal.throwIfAborted()</code> æ¥ç¡®ä¿åœ¨å‡½æ•°æ‰§è¡Œçš„ä»»ä½•é˜¶æ®µå¦‚æœæ”¶åˆ°äº†å–æ¶ˆä¿¡å·ï¼Œå°±ç«‹å³åœæ­¢æ‰§è¡Œå¹¶æŠ›å‡º <code>AbortError</code>ï¼Œä»è€Œä½¿å¾—è°ƒç”¨è€…èƒ½å¤ŸçŸ¥é“æ“ä½œå·²ç»è¢«å–æ¶ˆå¹¶å¤„ç†è¿™ç§æƒ…å†µã€‚</p><h2 id="class-blob" tabindex="-1"><a class="header-anchor" href="#class-blob"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-blob" target="_blank" rel="noopener noreferrer">Class: Blob</a></span></a></h2><p>ç†è§£ Node.js ä¸­çš„ <code>Blob</code> ç±»éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨ä½ éœ€è¦å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ã€å›¾åƒå¤„ç†ç­‰åœºæ™¯ï¼‰æ—¶ã€‚æˆ‘ä¼šé¦–å…ˆè§£é‡Šä»€ä¹ˆæ˜¯ <code>Blob</code>ï¼Œç„¶åé€šè¿‡ä¸€äº›å®é™…ä¾‹å­æ¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-blob" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-blob"><span>ä»€ä¹ˆæ˜¯ Blobï¼Ÿ</span></a></h3><p><code>Blob</code>ï¼ˆBinary Large Objectï¼‰è¡¨ç¤ºä¸å¯å˜çš„åŸå§‹æ•°æ®å—ã€‚å®ƒé€šå¸¸ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ã€‚åœ¨ Node.js çš„ç¯å¢ƒä¸‹ï¼Œ<code>Blob</code> ç±»æä¾›äº†ä¸€ç§æ–¹å¼æ¥å¤„ç†è¿™äº›äºŒè¿›åˆ¶æ•°æ®ï¼Œä½¿å¾—æ–‡ä»¶çš„è¯»å–å’Œä¼ è¾“å˜å¾—æ›´åŠ é«˜æ•ˆå’Œç®€ä¾¿ã€‚</p><h3 id="blob-ç±»çš„å…³é”®ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#blob-ç±»çš„å…³é”®ç‰¹æ€§"><span>Blob ç±»çš„å…³é”®ç‰¹æ€§</span></a></h3><ul><li><strong>ä¸å¯å˜æ€§</strong>ï¼šBlob ä¸€æ—¦è¢«åˆ›å»ºï¼Œå…¶å†…å®¹å°±ä¸èƒ½è¢«æ”¹å˜ã€‚å¦‚æœæƒ³è¦ä¿®æ”¹ Blob ä¸­çš„æ•°æ®ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Blob å®ä¾‹ã€‚</li><li><strong>æ”¯æŒå¤šç§æ•°æ®ç±»å‹</strong>ï¼šä½ å¯ä»¥ä»å­—ç¬¦ä¸²ã€ArrayBuffer ç­‰å¤šç§æ ¼å¼åˆ›å»º Blob å¯¹è±¡ã€‚</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼šBlob è®¾è®¡ç”¨æ¥é«˜æ•ˆå¤„ç†å¤§å‹äºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-æ–‡ä»¶ä¸Šä¼ " tabindex="-1"><a class="header-anchor" href="#_1-æ–‡ä»¶ä¸Šä¼ "><span>1. æ–‡ä»¶ä¸Šä¼ </span></a></h4><p>åœ¨ç½‘é¡µåº”ç”¨ä¸­ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦ä¸Šä¼ å›¾ç‰‡æˆ–æ–‡æ¡£ã€‚ä½¿ç”¨ Blobï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°è¯»å–è¿™äº›æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶ä»¥äºŒè¿›åˆ¶å½¢å¼å‘é€åˆ°æœåŠ¡å™¨ã€‚</p><p>Node.js ç¤ºä¾‹ä»£ç ï¼ˆå‡è®¾æœ‰ä¸€ä¸ªè¡¨å•æäº¤äº†æ–‡ä»¶ï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ req æ˜¯è¯·æ±‚å¯¹è±¡ï¼ŒfileInputField æ˜¯ input è¡¨å•çš„ name å±æ€§å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">files</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileInputField</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º Blob å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">], { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;application/octet-stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯ä»¥å°† blob ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿæˆ–å‘é€åˆ°æœåŠ¡å™¨...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-å›¾åƒå¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-å›¾åƒå¤„ç†"><span>2. å›¾åƒå¤„ç†</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚å‹ç¼©ã€è½¬æ¢æ ¼å¼ç­‰ï¼‰ã€‚ä½¿ç”¨ Blobï¼Œä½ å¯ä»¥è½»æ¾å¤„ç†è¿™äº›å›¾åƒæ•°æ®ã€‚</p><p>Node.js ç¤ºä¾‹ä»£ç ï¼ˆå‹ç¼©å›¾åƒæ•°æ®ï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„ï¼šå®é™…å›¾åƒå¤„ç†éœ€è¦ä½¿ç”¨ä¸“é—¨çš„åº“ï¼Œå¦‚ Sharp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sharp</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sharp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> compressImage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">blob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾ blob åŒ…å«å›¾åƒæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> blob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">arrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°† Blob è½¬æ¢ä¸º ArrayBuffer ä»¥ä¾›å¤„ç†</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  sharp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬è¦å°†å›¾åƒçš„å°ºå¯¸è°ƒæ•´ä¸º 200x200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å›¾åƒå·²ç»è¢«å¤„ç†å¹¶ä¿å­˜ä¸º output.jpg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-æ•°æ®ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#_3-æ•°æ®ä¼ è¾“"><span>3. æ•°æ®ä¼ è¾“</span></a></h4><p>å½“ä½ éœ€è¦åœ¨ä¸åŒçš„ç³»ç»Ÿé—´ä¼ è¾“å¤§é‡æ•°æ®æ—¶ï¼ˆä¾‹å¦‚ï¼Œä»æµè§ˆå™¨ä¼ è¾“åˆ°æœåŠ¡å™¨æˆ–è€…æœåŠ¡é—´ä¼ è¾“ï¼‰ï¼ŒBlob å¯ä»¥ä½œä¸ºä¸€ç§é«˜æ•ˆçš„æ•°æ®å®¹å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ éœ€è¦å°†ä¸€ä»½æŠ¥å‘Šä½œä¸º Blob å‘é€åˆ°å¦ä¸€ä¸ªæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> reportData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> generateReport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™ä¸ªå‡½æ•°ç”ŸæˆæŠ¥å‘Šçš„åŸå§‹æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> reportBlob</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reportData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">], { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sendBlobToService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reportBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// sendBlobToService æ˜¯å‡è®¾çš„å‡½æ•°ï¼Œè´Ÿè´£å‘é€ Blob åˆ°æœåŠ¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h3><p><code>Blob</code> ç±»åœ¨ Node.js ä¸­æ˜¯å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„å¼ºå¤§å·¥å…·ï¼Œç‰¹åˆ«æ˜¯å½“æ¶‰åŠåˆ°æ–‡ä»¶å’Œæ•°æ®ä¼ è¾“æ—¶ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>Blob</code> å¦‚ä½•åœ¨ä¸åŒæƒ…å¢ƒä¸‹è¢«åº”ç”¨ï¼Œä»è€ŒåŠ æ·±ä½ å¯¹å®ƒçš„ç†è§£ã€‚è®°ä½ï¼Œåœ¨å¤„ç†å¤æ‚æ•°æ®æˆ–å¤§æ–‡ä»¶æ—¶ï¼Œåˆ©ç”¨ <code>Blob</code> çš„ç‰¹æ€§å¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p><h2 id="class-buffer" tabindex="-1"><a class="header-anchor" href="#class-buffer"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-buffer" target="_blank" rel="noopener noreferrer">Class: Buffer</a></span></a></h2><p>Node.js çš„<code>Buffer</code>ç±»æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ åœ¨ç½‘ä¸Šæµè§ˆæ—¶ï¼Œä½ æ‰€çœ‹åˆ°çš„å›¾ç‰‡ã€è§†é¢‘å’Œä¸‹è½½çš„æ–‡ä»¶å®é™…ä¸Šéƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼åœ¨äº’è”ç½‘ä¸Šä¼ è¾“çš„ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>Buffer</code>ç±»å°±æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†è¿™ç§ç±»å‹çš„æ•°æ®çš„ã€‚</p><h3 id="ç†è§£-buffer" tabindex="-1"><a class="header-anchor" href="#ç†è§£-buffer"><span>ç†è§£ Buffer</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>Buffer</code>å¯ä»¥è¢«ç†è§£ä¸ºä¸´æ—¶å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®çš„å®¹å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªæ›´æ¥è¿‘äºåº•å±‚çš„æ•°æ®ç»“æ„ï¼Œå…è®¸ä½ æ“ä½œæˆ–è®¿é—®åŸå§‹çš„å†…å­˜ç©ºé—´ã€‚æ¯ä¸ª<code>Buffer</code>å¯¹è±¡éƒ½æ˜¯ä¸€å—é¢„å…ˆåˆ†é…å¥½çš„å†…å­˜ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¯»å†™è¿™å—å†…å­˜ã€‚</p><h3 id="åˆ›å»º-buffer" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-buffer"><span>åˆ›å»º Buffer</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œåˆ›å»º<code>Buffer</code>å¯¹è±¡é€šå¸¸ä¸ä½¿ç”¨<code>new Buffer()</code>ï¼ˆè¿™æ˜¯æ—§æ–¹æ³•ï¼Œç°åœ¨å·²å¼ƒç”¨ï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li><code>Buffer.from()</code>ï¼šä»ä¸€ä¸ªå­—ç¬¦ä¸²ã€æ•°ç»„æˆ–å¦ä¸€ä¸ª Buffer å®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°çš„ Bufferã€‚</li><li><code>Buffer.alloc(size)</code>ï¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„æ–° Bufferï¼Œå…¶å†…å®¹å°†è¢«åˆå§‹åŒ–ä¸º 0ã€‚</li><li><code>Buffer.allocUnsafe(size)</code>ï¼šåŒæ ·åˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„æ–° Bufferï¼Œä½†å…¶å†…å®¹æœªè¢«åˆå§‹åŒ–ï¼Œå¯èƒ½åŒ…å«æ•æ„Ÿæ•°æ®ã€‚</li></ol><h3 id="å®è·µåº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®è·µåº”ç”¨ä¾‹å­"><span>å®è·µåº”ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-å­—ç¬¦ä¸²ä¸-buffer-çš„è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å­—ç¬¦ä¸²ä¸-buffer-çš„è½¬æ¢"><span>ä¾‹å­ 1ï¼šå­—ç¬¦ä¸²ä¸ Buffer çš„è½¬æ¢</span></a></h4><p>å‡è®¾ä½ éœ€è¦å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®å¯èƒ½æ˜¯åŠ å¯†çš„æ–‡æœ¬ã€‚ä½ å¯èƒ½ä¼šå…ˆå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥<code>Buffer</code>ï¼Œç„¶åå¯¹å…¶è¿›è¡Œè§£ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å­—ç¬¦ä¸²è½¬æ¢æˆBuffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufFromString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†Bufferè½¬æ¢å›å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> strFromBuf</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> bufFromString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">strFromBuf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Hello World</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-è¯»å–æ–‡ä»¶å¹¶å¤„ç†äºŒè¿›åˆ¶æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è¯»å–æ–‡ä»¶å¹¶å¤„ç†äºŒè¿›åˆ¶æ•°æ®"><span>ä¾‹å­ 2ï¼šè¯»å–æ–‡ä»¶å¹¶å¤„ç†äºŒè¿›åˆ¶æ•°æ®</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦è¯»å–ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œç„¶åä¿å­˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼‚æ­¥è¯»å–å›¾ç‰‡æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/image.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ­¤æ—¶dataå°±æ˜¯ä¸€ä¸ªBufferå¯¹è±¡ï¼ŒåŒ…å«äº†å›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿›è¡ŒæŸäº›å¤„ç†ï¼Œä¾‹å¦‚å›¾ç‰‡å‹ç¼©ã€æ ¼å¼è½¬æ¢ç­‰</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å®Œæˆåï¼Œå¯ä»¥å°†ç»“æœå†™å…¥åˆ°æ–°æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/new_image.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Image processed and saved.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fs.readFile</code>æ–¹æ³•ç”¨æ¥å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¿”å›çš„<code>data</code>å¯¹è±¡å°±æ˜¯ä¸€ä¸ª Bufferï¼Œå…¶åŒ…å«äº†æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ã€‚å¤„ç†å®Œæ¯•åï¼Œä½ å¯ä»¥ä½¿ç”¨<code>fs.writeFile</code>æ–¹æ³•å°† Buffer çš„å†…å®¹å†™å…¥åˆ°æ–°çš„æ–‡ä»¶ä¸­ã€‚</p><h3 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h3><p><code>Buffer</code>ç±»åœ¨ Node.js ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†åƒ TCP æµã€æ–‡ä»¶ I/O ç­‰æ¶‰åŠäºŒè¿›åˆ¶æ•°æ®çš„åœºæ™¯ã€‚é€šè¿‡ç®€å•çš„ APIï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°åœ¨ JavaScript ä¸­æ“ä½œè¿™äº›ä½çº§çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œä½¿å¾— Node.js æˆä¸ºå¤„ç†ç½‘ç»œå’Œæ–‡ä»¶ç³»ç»Ÿç›¸å…³ä»»åŠ¡çš„å¼ºå¤§å·¥å…·ã€‚</p><h2 id="class-bytelengthqueuingstrategy" tabindex="-1"><a class="header-anchor" href="#class-bytelengthqueuingstrategy"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-bytelengthqueuingstrategy" target="_blank" rel="noopener noreferrer">Class: ByteLengthQueuingStrategy</a></span></a></h2><p>åœ¨è§£é‡Š<code>ByteLengthQueuingStrategy</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼šStreamsï¼ˆæµï¼‰ã€Backpressureï¼ˆèƒŒå‹ï¼‰ä»¥åŠ Queuing Strategiesï¼ˆé˜Ÿåˆ—ç­–ç•¥ï¼‰ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-1"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><p><strong>Streams:</strong> åœ¨ç¼–ç¨‹ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯éšç€æ—¶é—´æ¨ç§»è¿ç»­ä¼ é€’çš„æ•°æ®åºåˆ—ã€‚Node.js ä¸­ä½¿ç”¨æµå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚</p></li><li><p><strong>Backpressure:</strong> å½“æ•°æ®é€šè¿‡æµä¼ è¾“æ—¶ï¼Œå¯èƒ½ç”Ÿäº§è€…ï¼ˆäº§ç”Ÿæ•°æ®çš„ä¸€æ–¹ï¼‰çš„é€Ÿåº¦è¶…è¿‡æ¶ˆè´¹è€…ï¼ˆæ¥æ”¶æ•°æ®çš„ä¸€æ–¹ï¼‰èƒ½å¤Ÿå¤„ç†çš„é€Ÿåº¦ï¼Œè¿™æ—¶å°±ä¼šé€ æˆæ‰€è°“çš„â€œèƒŒå‹â€ã€‚ç³»ç»Ÿéœ€è¦æœ‰æœºåˆ¶æ¥åº”å¯¹è¿™ç§æƒ…å†µï¼Œç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”ä¸ä¼šä½¿å†…å­˜æ¶ˆè€—è¿‡å¤šå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p></li><li><p><strong>Queuing Strategies:</strong> é˜Ÿåˆ—ç­–ç•¥æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥æ§åˆ¶å½“èƒŒå‹å‡ºç°æ—¶ï¼Œæ•°æ®åº”è¯¥å¦‚ä½•è¢«ç¼“å­˜ã€‚å®ƒå®šä¹‰äº†æµä¸­æ•°æ®ç¼“å†²çš„è¡Œä¸ºã€‚</p></li></ul><h3 id="bytelengthqueuingstrategy-ç±»" tabindex="-1"><a class="header-anchor" href="#bytelengthqueuingstrategy-ç±»"><span>ByteLengthQueuingStrategy ç±»</span></a></h3><p><code>ByteLengthQueuingStrategy</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªç±»ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—ç­–ç•¥ã€‚è¿™ä¸ªç­–ç•¥æ ¹æ®æ•°æ®å—ï¼ˆchunkï¼‰çš„å­—èŠ‚é•¿åº¦æ¥ç®¡ç†æµä¸­çš„èƒŒå‹ã€‚ç»™å®šä¸€ä¸ªæŒ‡å®šçš„ &quot;highWaterMark&quot; ï¼ˆé«˜æ°´ä½æ ‡ï¼‰ï¼Œè¿™ä¸ªç­–ç•¥å°†å…è®¸æµä¸­çš„æ•°æ®é‡ç´¯ç§¯åˆ°æ¥è¿‘è¿™ä¸ªå€¼ï¼Œä½†ä¸è¶…è¿‡å®ƒã€‚å½“é˜Ÿåˆ—ä¸­çš„æ€»å­—èŠ‚æ•°è¾¾åˆ°é«˜æ°´ä½æ ‡æ—¶ï¼Œæµä¼šåœæ­¢ä»æºå¤´è¯»å–æ•°æ®ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ•°æ®è¢«æ¶ˆè€—åˆ°è¶³å¤Ÿä½ã€‚</p><h4 id="ä½¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¾‹å­"><span>ä½¿ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ä»£ç ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">ReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">ByteLengthQueuingStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ ReadableStream çš„å®ä¾‹å’Œ ByteLengthQueuingStrategy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> queuingStrategy</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ByteLengthQueuingStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> webReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å½“æµå¼€å§‹æ—¶ï¼Œä½ å¯ä»¥è®¾ç½®ä¸€äº›åˆå§‹åŒ–é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    pull</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // è¿™é‡Œæ˜¯å½“æ¶ˆè´¹è€…è¦æ±‚æ›´å¤šæ•°æ®æ—¶çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–ä¸€å—æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ•°æ®æ·»åŠ åˆ°æµçš„é˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœæ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œå…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    cancel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // è¿™é‡Œæ˜¯å¦‚æœæ¶ˆè´¹è€…å–æ¶ˆäº†æµæ—¶çš„æ¸…ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  queuingStrategy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ webReadableStream è¡¨ç¤ºæµï¼Œå¯ä»¥ç”¨äº web API æˆ–å…¶ä»–æ”¯æŒæ ‡å‡†æµçš„åœºæ™¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>ByteLengthQueuingStrategy</code> è¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ç­–ç•¥ï¼Œå…¶ä¸­ <code>highWaterMark</code> è®¾ç½®ä¸º 1MBï¼ˆ1024 * 1024 å­—èŠ‚ï¼‰ã€‚è¿™æ„å‘³ç€æµå°†å°½åŠ›ç»´æŒé˜Ÿåˆ—å¤§å°åœ¨ 1MB å·¦å³ï¼Œå¦‚æœé˜Ÿåˆ—å¤§å°è¶…è¿‡è¿™ä¸ªå€¼ï¼Œå°†æš‚åœä»æ–‡ä»¶ä¸­è¯»å–æ›´å¤šæ•°æ®ï¼Œç­‰å¾…æ•°æ®è¢«æ¶ˆè´¹åå†ç»§ç»­ã€‚</p><p>é€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼Œå³ä¾¿æ˜¯å¤„ç†éå¸¸å¤§çš„æ–‡ä»¶ï¼Œä½ çš„åº”ç”¨ä¹Ÿå¯ä»¥é¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šæ•°æ®åˆ°å†…å­˜ä¸­ï¼Œä»è€Œé¿å…å†…å­˜æº¢å‡ºé—®é¢˜ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªå¹³æ»‘çš„æ•°æ®å¤„ç†æµç¨‹ã€‚</p><h2 id="dirname" tabindex="-1"><a class="header-anchor" href="#dirname"><span><a href="https://nodejs.org/docs/latest/api/globals.html#__dirname" target="_blank" rel="noopener noreferrer">__dirname</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œè€Œéä»…ä»…åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚è¿™è®© JavaScript èƒ½å¤Ÿç”¨äºå¼€å‘æœåŠ¡å™¨ç«¯çš„è½¯ä»¶ï¼ŒåŒ…æ‹¬ç½‘ç«™åç«¯ã€API ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>__dirname</code> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦ä¸”å®ç”¨çš„å…¨å±€å˜é‡ã€‚å®ƒç»™å‡ºäº†å½“å‰æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚è¿™æ„å‘³ç€ï¼Œæ— è®ºä½ çš„é¡¹ç›®éƒ¨ç½²åœ¨å“ªé‡Œï¼Œ<code>__dirname</code> éƒ½èƒ½å‡†ç¡®åœ°æŒ‡å‘ä½ çš„ä»£ç æ–‡ä»¶æ‰€å¤„çš„æ–‡ä»¶å¤¹ä½ç½®ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-dirname-å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-dirname-å¾ˆé‡è¦"><span>ä¸ºä»€ä¹ˆ <code>__dirname</code> å¾ˆé‡è¦ï¼Ÿ</span></a></h3><ul><li><strong>è·¯å¾„çš„å¯é æ€§</strong>ï¼šå½“ä½ çš„ä»£ç éœ€è¦å¼•ç”¨å…¶ä»–æ–‡ä»¶æˆ–æ¨¡å—æ—¶ï¼ˆæ¯”å¦‚è¯»å–é…ç½®æ–‡ä»¶ã€åŠ è½½é™æ€èµ„æºç­‰ï¼‰ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼Œå°¤å…¶æ˜¯å½“ä½ çš„é¡¹ç›®ç»“æ„å˜åŒ–æˆ–åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹è¿è¡Œæ—¶ã€‚<code>__dirname</code> ç¡®ä¿ä½ æ€»æ˜¯ä»å½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç»å¯¹è·¯å¾„å¼€å§‹å¼•ç”¨ï¼Œæé«˜äº†ä»£ç çš„ç¨³å®šæ€§ã€‚</li><li><strong>è·¨å¹³å°å…¼å®¹</strong>ï¼šWindows å’Œ Unix ç³»ç»Ÿï¼ˆå¦‚ Linux å’Œ macOSï¼‰åœ¨æ–‡ä»¶è·¯å¾„çš„è¡¨ç¤ºä¸Šæœ‰æ‰€ä¸åŒï¼ˆä¾‹å¦‚ï¼Œåˆ†éš”ç¬¦åˆ†åˆ«æ˜¯ <code>\</code> å’Œ <code>/</code>ï¼‰ã€‚ä½¿ç”¨ <code>__dirname</code> å¯ä»¥å¸®åŠ©ä½ çš„ä»£ç è·¨å¹³å°å…¼å®¹ï¼Œå› ä¸º Node.js ä¼šå¤„ç†è¿™äº›å·®å¼‚ã€‚</li></ul><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>myProject/</span></span>
<span class="line"><span>â”‚</span></span>
<span class="line"><span>â”œâ”€â”€ data/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ myData.json</span></span>
<span class="line"><span>â”‚</span></span>
<span class="line"><span>â”œâ”€â”€ scripts/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ readData.js</span></span>
<span class="line"><span>â”‚</span></span>
<span class="line"><span>â””â”€â”€ index.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-1-è¯»å–æ•°æ®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¯»å–æ•°æ®æ–‡ä»¶"><span>ç¤ºä¾‹ 1ï¼šè¯»å–æ•°æ®æ–‡ä»¶</span></a></h4><p>åœ¨ <code>scripts/readData.js</code> ä¸­ï¼Œä½ æƒ³è¯»å– <code>data/myData.json</code> æ–‡ä»¶ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯èƒ½ä¼šå‡ºé”™ï¼Œå› ä¸ºç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äºæ‰§è¡Œ Node å‘½ä»¤çš„å½“å‰ç›®å½•ï¼Œè€Œä¸æ˜¯è„šæœ¬æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚è¿™é‡Œ <code>__dirname</code> å°±æ´¾ä¸Šç”¨åœºäº†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ„å»º data æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dataPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myData.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä¸­ï¼Œ<code>__dirname</code> æ˜¯ <code>scripts</code> ç›®å½•çš„è·¯å¾„ã€‚é€šè¿‡ <code>path.join(__dirname, &#39;..&#39;, &#39;data&#39;, &#39;myData.json&#39;)</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡º <code>myData.json</code> çš„æ­£ç¡®ç»å¯¹è·¯å¾„ï¼Œæ— è®ºè¿™æ®µä»£ç åœ¨å“ªé‡Œæ‰§è¡Œã€‚</p><h4 id="ç¤ºä¾‹-2-é…ç½®æ–‡ä»¶å¼•å…¥" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-é…ç½®æ–‡ä»¶å¼•å…¥"><span>ç¤ºä¾‹ 2ï¼šé…ç½®æ–‡ä»¶å¼•å…¥</span></a></h4><p>å‡è®¾åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½• (<code>myProject/</code>) ä¸‹æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>config.json</code>ã€‚åœ¨é¡¹ç›®çš„ä»»ä½•åœ°æ–¹å¼•ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ <code>__dirname</code> æ¥ç¡®ä¿è·¯å¾„çš„æ­£ç¡®æ€§ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> configPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;config.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">configPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someSetting</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºæŸé¡¹é…ç½®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ— è®ºä½ çš„ä»£ç æ”¾åœ¨é¡¹ç›®çš„å“ªä¸ªä½ç½®æˆ–æ·±åº¦ï¼Œä½¿ç”¨ <code>path.join(__dirname, &#39;config.json&#39;)</code> éƒ½å¯ä»¥å®‰å…¨åœ°å¼•ç”¨åˆ°æ ¹ç›®å½•ä¸‹çš„ <code>config.json</code> æ–‡ä»¶ã€‚</p><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p><code>__dirname</code> åœ¨ Node.js ä¸­æä¾›äº†ä¸€ç§ç¨³å®šä¸”è·¨å¹³å°çš„æ–¹å¼æ¥å¤„ç†æ–‡ä»¶è·¯å¾„ã€‚é€šè¿‡å®ä¾‹åŒ–è¿™ä¸ªå…¨å±€å˜é‡ï¼Œä½ å¯ä»¥æ›´å®‰å…¨ã€æ›´çµæ´»åœ°ç®¡ç†æ–‡ä»¶å’Œç›®å½•è·¯å¾„ï¼Œè®©ä½ çš„åº”ç”¨æ›´åŠ å¥å£¯å’Œå¯ç»´æŠ¤ã€‚</p><h2 id="filename" tabindex="-1"><a class="header-anchor" href="#filename"><span><a href="https://nodejs.org/docs/latest/api/globals.html#__filename" target="_blank" rel="noopener noreferrer">__filename</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œ<code>__filename</code>æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å…¨å±€å˜é‡ï¼Œå®ƒè¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬çš„æ–‡ä»¶è·¯å¾„ã€‚è¿™ä¸ªè·¯å¾„æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒç»™å‡ºäº†ä»ä½ ç”µè„‘çš„æ ¹ç›®å½•ä¸€ç›´åˆ°è¯¥æ–‡ä»¶ä½ç½®çš„å®Œæ•´è·¯å¾„ã€‚</p><p>è®©æˆ‘é€šè¿‡ä¸€äº›ç®€å•çš„ä¾‹å­æ¥è§£é‡Š<code>__filename</code>çš„ç”¨é€”å’Œå¦‚ä½•åœ¨å®é™…ç¼–ç¨‹ä¸­è¿ç”¨å®ƒã€‚</p><h3 id="ä¾‹å­-1-æ‰“å°å½“å‰æ–‡ä»¶è·¯å¾„" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ‰“å°å½“å‰æ–‡ä»¶è·¯å¾„"><span>ä¾‹å­ 1ï¼šæ‰“å°å½“å‰æ–‡ä»¶è·¯å¾„</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º<code>example.js</code>çš„ Node.js è„šæœ¬ï¼Œä½äº<code>/Users/yourname/projects/myapp</code>ç›®å½•ä¸‹ã€‚å¦‚æœä½ åœ¨è¿™ä¸ªè„šæœ¬ä¸­å†™ä¸Šä»¥ä¸‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œè¿™ä¸ªè„šæœ¬æ—¶ï¼ˆä½¿ç”¨<code>node example.js</code>å‘½ä»¤ï¼‰ï¼Œè¾“å‡ºå°†ä¼šæ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/Users/yourname/projects/myapp/example.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å‘Šè¯‰ä½ å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬çš„å®Œæ•´è·¯å¾„ã€‚</p><h3 id="ä¾‹å­-2-åŸºäºæ–‡ä»¶è·¯å¾„è¿›è¡Œæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-åŸºäºæ–‡ä»¶è·¯å¾„è¿›è¡Œæ“ä½œ"><span>ä¾‹å­ 2ï¼šåŸºäºæ–‡ä»¶è·¯å¾„è¿›è¡Œæ“ä½œ</span></a></h3><p><code>__filename</code>å¯ä»¥ç”¨æ¥è·å–å½“å‰æ–‡ä»¶çš„ç›®å½•ï¼Œä»è€Œæ„å»ºç›¸å…³æ–‡ä»¶çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³è¦è¯»å–ä¸è„šæœ¬ä½äºåŒä¸€ç›®å½•ä¸‹çš„å¦ä¸€ä¸ªæ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>path</code>æ¨¡å—æ¥å¸®åŠ©å¤„ç†è·¯å¾„ç›¸å…³æ“ä½œã€‚</p><p>å‡è®¾åœ¨ç›¸åŒçš„ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ª<code>data.txt</code>æ–‡æœ¬æ–‡ä»¶ï¼Œä½ çš„<code>example.js</code>è„šæœ¬æƒ³è¦è¯»å–å®ƒï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> directoryName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ„å»ºdata.txtæ–‡ä»¶çš„è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> filePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">directoryName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é¦–å…ˆå¯¼å…¥äº†<code>fs</code>æ¨¡å—ï¼ˆç”¨äºæ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼‰å’Œ<code>path</code>æ¨¡å—ï¼ˆç”¨äºè·¯å¾„æ“ä½œï¼‰ã€‚ç„¶åï¼Œåˆ©ç”¨<code>path.dirname</code>å‡½æ•°è·å–å½“å‰è„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼Œå¹¶ä½¿ç”¨<code>path.join</code>æ‹¼æ¥å‡º<code>data.txt</code>çš„å®Œæ•´è·¯å¾„ã€‚æœ€åï¼Œä½¿ç”¨<code>fs.readFile</code>è¯»å–å¹¶æ‰“å°å‡ºæ–‡ä»¶å†…å®¹ã€‚</p><h3 id="ä¾‹å­-3-åŠ¨æ€å¼•å…¥æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-åŠ¨æ€å¼•å…¥æ¨¡å—"><span>ä¾‹å­ 3ï¼šåŠ¨æ€å¼•å…¥æ¨¡å—</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®ä¸åŒçš„æ¡ä»¶åŠ¨æ€åœ°å¼•å…¥æ¨¡å—ã€‚<code>__filename</code>å¯ä»¥å¸®åŠ©ä½ è®¡ç®—å‡ºæ¨¡å—æ–‡ä»¶çš„ç¡®åˆ‡è·¯å¾„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModulePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myModule.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myModulePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åŠ¨æ€åœ°æ„å»ºäº†ä¸€ä¸ªæ¨¡å—æ–‡ä»¶<code>myModule.js</code>çš„è·¯å¾„ï¼Œå¹¶ä¸”ä½¿ç”¨<code>require</code>å‡½æ•°æ¥åŠ è½½è¿™ä¸ªæ¨¡å—ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨äº†è¿™ä¸ªæ¨¡å—ä¸­çš„<code>doSomething</code>æ–¹æ³•ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>__filename</code>åœ¨ Node.js ä¸­ç”¨æ¥è·å–å½“å‰æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œè¿™å¯¹äºæ–‡ä»¶æ“ä½œã€æ¨¡å—ç®¡ç†ä»¥åŠè°ƒè¯•ç­‰åœºæ™¯éƒ½éå¸¸æœ‰ç”¨ã€‚é€šè¿‡ä»¥ä¸Šä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿç†è§£<code>__filename</code>çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ä½ è‡ªå·±çš„é¡¹ç›®ä¸­çµæ´»è¿ç”¨å®ƒã€‚</p><h2 id="atob-data" tabindex="-1"><a class="header-anchor" href="#atob-data"><span><a href="https://nodejs.org/docs/latest/api/globals.html#atobdata" target="_blank" rel="noopener noreferrer">atob(data)</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚è€Œ <code>atob(data)</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js ç¯å¢ƒä¸­ç”¨æ¥è§£ç ç”± base64 ç¼–ç çš„å­—ç¬¦ä¸²çš„å‡½æ•°ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä¸€ä¸‹ base64 ç¼–ç æ˜¯ä»€ä¹ˆã€‚Base64 æ˜¯ä¸€ç§ç”¨ 64 ä¸ªå­—ç¬¦è¡¨ç¤ºæ‰€æœ‰äºŒè¿›åˆ¶æ•°æ®çš„ç¼–ç æ–¹æ³•ã€‚è¿™ä¸ªç¼–ç è¢«è®¾è®¡ç”¨æ¥å¤„ç†é‚£äº›ä¸å®¹æ˜“ç”¨æ–‡æœ¬æ–¹å¼ä¼ è¾“çš„æ•°æ®ã€‚æ¯”å¦‚ï¼Œä½ æƒ³åœ¨ç½‘ç»œä¸Šå‘é€ä¸€ä¸ªå›¾ç‰‡æˆ–è€…å…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨ base64 ç¼–ç æ¥å®ç°ã€‚å®ƒä¸»è¦å°†æ•°æ®åˆ†æˆ 6 ä½ä¸€ç»„ï¼ˆå› ä¸º 2^6 = 64ï¼‰ï¼Œç„¶åå¯¹åº”åˆ°ä¸€ä¸ªå¯æ‰“å°çš„å­—ç¬¦é›†åˆä¸­ï¼šA-Z, a-z, 0-9, + å’Œ /ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-atob-data" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-atob-data"><span>å¦‚ä½•ä½¿ç”¨ <code>atob(data)</code></span></a></h3><p><code>atob(data)</code> å‡½æ•°æ¥æ”¶ä¸€ä¸ªç”¨ base64 ç¼–ç çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªè§£ç åçš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå‡½æ•°åœ¨å¤„ç†æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­éå¸¸æœ‰ç”¨ã€‚æ¯”å¦‚ï¼Œå½“ä½ ä»ä¸€ä¸ª API è·å–äº†ä¸€äº›ä»¥ base64 ç¼–ç çš„æ•°æ®ï¼Œæˆ–è€…éœ€è¦å¤„ç†ä»¥ base64 ç¼–ç çš„ç”¨æˆ·è¾“å…¥æ—¶ã€‚</p><p>å®é™…è¿ç”¨ä¾‹å­åŒ…æ‹¬ï¼š</p><ol><li><p><strong>å¤„ç†å›¾ç‰‡æ–‡ä»¶</strong>ï¼šå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥ä¸Šä¼ å›¾ç‰‡ä½œä¸ºä»–ä»¬çš„å¤´åƒã€‚ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡å¯èƒ½ä¼šè¢«è½¬æ¢æˆ base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿é€šè¿‡ç½‘ç»œä¼ è¾“ã€‚å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>atob()</code> æ¥è§£ç è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå¤„ç†åŸå§‹çš„å›¾åƒæ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> base64Image</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ç»è¿‡base64ç¼–ç çš„å­—ç¬¦ä¸²</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨atobè§£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> imageBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">atob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">base64Image</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;binary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¥ä¸‹æ¥å¯ä»¥ç”¨è¿™ä¸ªbufferæ¥ä¿å­˜å›¾ç‰‡åˆ°æœåŠ¡å™¨ç£ç›˜ï¼Œæˆ–è¿›è¡Œå…¶ä»–å¤„ç†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å®‰å…¨ä¼ è¾“å°å‹æ•°æ®</strong>ï¼šæ¯”å¦‚è¯´ï¼Œä½ å¼€å‘äº†ä¸€ä¸ªç½‘é¡µæ¸¸æˆï¼Œéœ€è¦åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é—´ä¼ é€’åŠ å¯†çš„æ¸¸æˆçŠ¶æ€ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å…ˆè¢«åŠ å¯†ï¼Œç„¶åè½¬æˆ base64 å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°åï¼Œå¯ä»¥ç”¨ <code>atob()</code> è§£ç ï¼Œå†è¿›è¡Œè§£å¯†å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encodedGameState</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;c29tZSBnYW1lIHN0YXRlIGVuY29kZWQ=&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯åŠ å¯†å¹¶ä¸”è½¬æˆbase64çš„æ¸¸æˆçŠ¶æ€ä¿¡æ¯</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨æœåŠ¡å™¨ç«¯è§£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decodedGameState</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> atob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encodedGameState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¥ä¸‹æ¥å¯ä»¥è§£å¯†decodedGameStateæ¥è·å–æ¸¸æˆçŠ¶æ€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åœ¨ Web å¼€å‘ä¸­å¤„ç†ç¼–ç </strong>ï¼šå½“ä½ éœ€è¦åœ¨å‰åç«¯ä¹‹é—´å®‰å…¨åœ°ä¼ é€’å¯èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬ä¿¡æ¯æ—¶ï¼Œå¦‚ JSON å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥å°†å…¶ç¼–ç ä¸º base64 æ ¼å¼ï¼Œç¡®ä¿åœ¨ HTTP è¯·æ±‚/å“åº”è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°ç¼–ç é”™è¯¯æˆ–æ•°æ®æŸåã€‚</p></li></ol><p>è¿™äº›ä¾‹å­å±•ç¤ºäº† <code>atob(data)</code> åœ¨å¤„ç†ç»è¿‡ base64 ç¼–ç çš„æ•°æ®æ—¶çš„å®é™…è¿ç”¨åœºæ™¯ã€‚è®°ä½ï¼Œå½“ä½ å¤„ç†ä»»ä½•å½¢å¼çš„ç¼–ç å’Œè§£ç æ—¶ï¼Œå…³æ³¨æ•°æ®çš„å®‰å…¨æ€§æ˜¯éå¸¸é‡è¦çš„ï¼Œå°¤å…¶æ˜¯æ¶‰åŠç”¨æˆ·è¾“å…¥æˆ–æ•æ„Ÿä¿¡æ¯æ—¶ã€‚</p><h2 id="broadcastchannel" tabindex="-1"><a class="header-anchor" href="#broadcastchannel"><span><a href="https://nodejs.org/docs/latest/api/globals.html#broadcastchannel" target="_blank" rel="noopener noreferrer">BroadcastChannel</a></span></a></h2><p>ç†è§£ <code>BroadcastChannel</code> æ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠä¸€ä¸‹å®ƒä¸ºä»€ä¹ˆä¼šå­˜åœ¨ã€‚åœ¨å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µã€Web Workers æˆ–è€…å…¶ä»–æ”¯æŒ JavaScript çš„ç¯å¢ƒä¸­è¿è¡Œçš„ç‹¬ç«‹è„šæœ¬ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œé€šå¸¸æ˜¯ç›¸å½“å¤æ‚çš„ã€‚è€Œ <code>BroadcastChannel</code> API æä¾›äº†ä¸€ç§ç®€å•çš„é€šä¿¡æ–¹å¼ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­å¼•å…¥çš„è¿™ä¸ª APIï¼Œå…è®¸ä¸åŒçš„ Node.js è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ä¹‹é—´ä¹Ÿèƒ½å¤Ÿä½¿ç”¨ç±»ä¼¼çš„æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚</p><h3 id="broadcastchannel-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#broadcastchannel-åŸºç¡€"><span>BroadcastChannel åŸºç¡€</span></a></h3><p><code>BroadcastChannel</code> å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæ¶ˆæ¯å¹¿æ’­ç³»ç»Ÿï¼Œå…è®¸ä»»ä½•åŠ å…¥åŒä¸€é¢‘é“çš„æˆå‘˜æ¥æ”¶åˆ°å¹¿æ’­çš„æ¶ˆæ¯ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª <code>BroadcastChannel</code> å®ä¾‹å¹¶æŒ‡å®šä¸€ä¸ªé¢‘é“åç§°æ—¶ï¼Œä»»ä½•åœ¨ç›¸åŒè¿›ç¨‹ä¸­æˆ–å…¶ä»–è¿›ç¨‹ä¸­ç›‘å¬è¿™ä¸ªé¢‘é“çš„ <code>BroadcastChannel</code> å®ä¾‹éƒ½å¯ä»¥æ”¶åˆ°é€šè¿‡è¯¥é¢‘é“å‘é€çš„æ¶ˆæ¯ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ"><span>å¦‚ä½•å·¥ä½œ</span></a></h3><ol><li><p><strong>åˆ›å»º</strong>: é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª <code>BroadcastChannel</code> çš„å®ä¾‹ï¼Œå¹¶ç»™å®ƒä¸€ä¸ªé¢‘é“åç§°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">BroadcastChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:globals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> channel</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> BroadcastChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my_channel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å‘é€æ¶ˆæ¯</strong>: ä½¿ç”¨ <code>postMessage</code> æ–¹æ³•å‘é€æ¶ˆæ¯åˆ°é¢‘é“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, BroadcastChannel!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ¥æ”¶æ¶ˆæ¯</strong>: åœ¨åŒä¸€ä¸ªæˆ–ä¸åŒçš„è¿›ç¨‹ä¸­ï¼Œç›‘å¬ç›¸åŒé¢‘é“å°†æ”¶åˆ°æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å° &quot;Hello, BroadcastChannel!&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å…³é—­é¢‘é“</strong>: å½“ä¸å†éœ€è¦æ—¶ï¼Œåº”è¯¥å…³é—­é¢‘é“é‡Šæ”¾èµ„æºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-å¤šè¿›ç¨‹çŠ¶æ€åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_1-å¤šè¿›ç¨‹çŠ¶æ€åŒæ­¥"><span>1. å¤šè¿›ç¨‹çŠ¶æ€åŒæ­¥</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨æœ‰å¤šä¸ªå­è¿›ç¨‹ï¼Œéœ€è¦åŒæ­¥æŸäº›çŠ¶æ€ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ¸¸æˆæœåŠ¡å™¨ä¸Šï¼Œä¸€ä¸ªç©å®¶çš„åŠ¨ä½œéœ€è¦é€šçŸ¥å…¶ä»–æ‰€æœ‰å­è¿›ç¨‹æ›´æ–°çŠ¶æ€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å­è¿›ç¨‹ A å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> channelA</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> BroadcastChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;game_state&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channelA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Player1 Moved&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å­è¿›ç¨‹ B æ¥æ”¶æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> channelB</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> BroadcastChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;game_state&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channelB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// &quot;Player1 Moved&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-è·¨æœåŠ¡äº‹ä»¶é€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_2-è·¨æœåŠ¡äº‹ä»¶é€šçŸ¥"><span>2. è·¨æœåŠ¡äº‹ä»¶é€šçŸ¥</span></a></h4><p>å¦‚æœä½ çš„ Node.js åº”ç”¨ç”±å¤šä¸ªå¾®æœåŠ¡ç»„æˆï¼Œå¯èƒ½éœ€è¦åœ¨æœåŠ¡ä¹‹é—´ä¼ é€’é€šçŸ¥æˆ–äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç”µå­å•†åŠ¡ç³»ç»Ÿä¸­ï¼Œè®¢å•æœåŠ¡éœ€è¦é€šçŸ¥åº“å­˜æœåŠ¡å‡å°‘åº“å­˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¢å•æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> orderChannel</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> BroadcastChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;order_service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">orderChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Order Placed - Reduce Stock&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åº“å­˜æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stockChannel</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> BroadcastChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;order_service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stockChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Order Placed - Reduce Stock&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Reducing stock...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li><code>BroadcastChannel</code> åœ¨ Node.js ä¸­æ˜¯ä¸€ä¸ªç›¸å¯¹æ–°çš„ç‰¹æ€§ï¼Œç¡®ä¿ä½ çš„ Node.js ç¯å¢ƒè‡³å°‘è¾¾åˆ° v21.7.1 ç‰ˆæœ¬ã€‚</li><li>ä½¿ç”¨å®Œ <code>BroadcastChannel</code> åï¼Œè®°å¾—è°ƒç”¨ <code>close()</code> æ–¹æ³•æ¥æ¸…ç†èµ„æºã€‚</li><li><code>BroadcastChannel</code> æ›´é€‚åˆäºè¾ƒå°è§„æ¨¡çš„ã€å®æ—¶æ€§è¦æ±‚ä¸æé«˜çš„é€šä¿¡åœºæ™¯ã€‚å¯¹äºå¤§è§„æ¨¡ã€é«˜å¯é æ€§çš„æ¶ˆæ¯ä¼ é€’éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘æ›´ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—æˆ–æµå¤„ç†ç³»ç»Ÿã€‚</li></ul><p>é€šè¿‡ä¸Šè¿°ä»‹ç»å’Œç¤ºä¾‹ï¼Œä½ åº”è¯¥å¯¹ Node.js ä¸­çš„ <code>BroadcastChannel</code> æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œå®ƒä¸ºè·¨è¿›ç¨‹æˆ–çº¿ç¨‹é—´çš„é€šä¿¡æä¾›äº†ä¸€ç§ä¾¿æ·çš„æœºåˆ¶ã€‚</p><h2 id="btoa-data" tabindex="-1"><a class="header-anchor" href="#btoa-data"><span><a href="https://nodejs.org/docs/latest/api/globals.html#btoadata" target="_blank" rel="noopener noreferrer">btoa(data)</a></span></a></h2><p><code>btoa(data)</code> æ˜¯ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç”¨äºå°†ç»™å®šçš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼‰ç¼–ç æˆä¸€ç§å«åš Base64 çš„æ ¼å¼ã€‚Base64 ç¼–ç æ˜¯ä¸€ç§ç¼–ç æ–¹æ³•ï¼Œå®ƒå°†ä»»æ„çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆäº†ä¸€ç»„ä»…åŒ…å« 64 ä¸ªå­—ç¬¦çš„ ASCII å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦åŒ…æ‹¬å¤§å†™å­—æ¯ A-Zã€å°å†™å­—æ¯ a-zã€æ•°å­— 0-9ã€åŠ å·ï¼ˆ+ï¼‰å’Œæ–œæ ï¼ˆ/ï¼‰ã€‚Node.js ä¸­çš„<code>btoa</code>å‡½æ•°å®é™…ä¸Šæºè‡ªæµè§ˆå™¨ JavaScript ä¸­çš„åŒå APIã€‚</p><p>ä¸‹é¢æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼Œå¹¶ä¸¾ä¸€äº›å®ä¾‹è¯´æ˜å…¶ä½¿ç”¨ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-base64-ç¼–ç " tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-base64-ç¼–ç "><span>ä¸ºä»€ä¹ˆéœ€è¦ Base64 ç¼–ç ï¼Ÿ</span></a></h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨ä¸æ”¯æŒäºŒè¿›åˆ¶æ•°æ®ä¼ è¾“çš„åœºåˆï¼ˆæ¯”å¦‚ç”µå­é‚®ä»¶æˆ–æŸäº›æ–‡æœ¬åè®®ï¼‰å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ˆæ¯”å¦‚å›¾ç‰‡æˆ–è€…å…¶ä»–æ–‡ä»¶ç±»å‹ï¼‰ã€‚Base64 ç¼–ç å°±æ˜¯ä¸ºæ­¤è®¾è®¡çš„ï¼Œå®ƒå¯ä»¥å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆçº¯æ–‡æœ¬å½¢å¼ï¼Œè€Œä¸”åœ¨æ¥æ”¶ç«¯å¯ä»¥å®Œç¾åœ°è¿˜åŸå›åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-btoa-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-btoa-å‡½æ•°"><span>å¦‚ä½•ä½¿ç”¨ <code>btoa</code> å‡½æ•°ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¦‚æœä½ æƒ³è¦å°†ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œ Base64 ç¼–ç ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨<code>btoa</code>å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encodedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> btoa</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¼–ç å­—ç¬¦ä¸²&#39;Hello, world!&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encodedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºç¼–ç åçš„å­—ç¬¦ä¸²: &#39;SGVsbG8sIHdvcmxkIQ==&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå­—ç¬¦ä¸²<code>&#39;Hello, world!&#39;</code>è¢«è½¬æ¢æˆäº† Base64 ç¼–ç çš„å­—ç¬¦ä¸²<code>&#39;SGVsbG8sIHdvcmxkIQ==&#39;</code>ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-1" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-1"><span>æ³¨æ„äº‹é¡¹</span></a></h3><p>åœ¨ Node.js ä¸­ä½¿ç”¨<code>btoa</code>æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°<code>btoa</code>å‡½æ•°è¢«è®¾è®¡ä¸ºå¤„ç† Unicode å­—ç¬¦ä¸²ã€‚å¦‚æœä½ å°è¯•å¯¹åŒ…å«æ‰©å±•å­—ç¬¦é›†çš„å­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼Œå¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼Œå› ä¸º<code>btoa</code>æœŸæœ›æ¥æ”¶çš„æ˜¯äºŒè¿›åˆ¶æ•°æ®ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœä½ éœ€è¦å¯¹éæ ‡å‡† ASCII å­—ç¬¦è¿›è¡Œ Base64 ç¼–ç ï¼Œé€šå¸¸éœ€è¦å…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆ Buffer æˆ–è€…å¤„ç†ä¸º UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•å°†ä¸­æ–‡å­—ç¬¦ä¸²è½¬æ¢ä¸º Base64 ç¼–ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä½ å¥½ï¼Œä¸–ç•Œï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é¦–å…ˆåˆ›å»ºä¸€ä¸ªBuffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> base64Encoded</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;base64&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç„¶åå°†Bufferè½¬æ¢ä¸ºBase64å­—ç¬¦ä¸²</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">base64Encoded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºBase64ç¼–ç åçš„å­—ç¬¦ä¸²</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ç¤ºä¾‹åˆ©ç”¨äº† Node.js ä¸­<code>Buffer</code>å¯¹è±¡çš„èƒ½åŠ›æ¥æ­£ç¡®å¤„ç† UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º Base64 ç¼–ç ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>btoa</code>å‡½æ•°åœ¨ Node.js ä¸­æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥è¿›è¡Œ Base64 ç¼–ç ï¼Œä½†è¦æ³¨æ„æ­£ç¡®å¤„ç†å­—ç¬¦ç¼–ç ä»¥é¿å…æ½œåœ¨çš„é—®é¢˜ã€‚</p><h2 id="clearimmediate-immediateobject" tabindex="-1"><a class="header-anchor" href="#clearimmediate-immediateobject"><span><a href="https://nodejs.org/docs/latest/api/globals.html#clearimmediateimmediateobject" target="_blank" rel="noopener noreferrer">clearImmediate(immediateObject)</a></span></a></h2><p>Node.js ä¸­çš„ <code>clearImmediate(immediateObject)</code> æ˜¯ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç”¨æ¥å–æ¶ˆç”± <code>setImmediate()</code> å‡½æ•°è®¾ç½®çš„ä¸€ä¸ªæ“ä½œã€‚è¿™ä¸ªæœºåˆ¶å…è®¸ä½ å®‰æ’ä¸€äº›ä»£ç åœ¨å½“å‰äº‹ä»¶å¾ªç¯å‘¨æœŸç»“æŸåå°½å¿«è¿è¡Œï¼Œè€Œ <code>clearImmediate()</code> åˆ™æä¾›äº†ä¸€ç§æ–¹å¼æ¥é˜»æ­¢é‚£äº›å°šæœªæ‰§è¡Œçš„æ“ä½œã€‚</p><h3 id="ç†è§£-setimmediate-å’Œ-clearimmediate" tabindex="-1"><a class="header-anchor" href="#ç†è§£-setimmediate-å’Œ-clearimmediate"><span>ç†è§£ <code>setImmediate()</code> å’Œ <code>clearImmediate()</code></span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—äº†è§£ <code>setImmediate()</code> å‡½æ•°ã€‚å½“ä½ è°ƒç”¨ <code>setImmediate()</code> æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯å‘Šè¯‰ Node.jsï¼š &quot;å˜¿ï¼Œæˆ‘æœ‰è¿™å—ä»£ç ï¼Œæˆ‘å¸Œæœ›åœ¨å½“å‰äº‹ä»¶å¾ªç¯å®Œæˆåï¼Œå°½å¿«æ‰§è¡Œå®ƒï¼Œä½†ä¸æ˜¯é©¬ä¸Šã€‚&quot; è¿™å¯¹äºæƒ³è¦ç¡®ä¿ä»£ç å¼‚æ­¥æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œä¹‹åå°†æ§åˆ¶æƒè¿”å›ç»™äº‹ä»¶å¾ªç¯ï¼Œä»¥ä¾¿å¤„ç†å…¶ä»–å¾…å¤„ç†çš„äº‹ä»¶ï¼Œéå¸¸æœ‰ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> immediateId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ®µä»£ç ç¨åæ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å½“å‰äº‹ä»¶å¾ªç¯ç»“æŸå‰æ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå³ä½¿ <code>setImmediate()</code> è¢«é¦–å…ˆè°ƒç”¨ï¼Œç”±äºå®ƒè¢«å®‰æ’åœ¨äº‹ä»¶å¾ªç¯çš„å½“å‰é˜¶æ®µä¹‹åè¿è¡Œï¼Œæ‰€ä»¥ <code>&#39;å½“å‰äº‹ä»¶å¾ªç¯ç»“æŸå‰æ‰§è¡Œ&#39;</code> å°†é¦–å…ˆè¾“å‡ºï¼Œéšåæ‰æ˜¯ <code>&#39;è¿™æ®µä»£ç ç¨åæ‰§è¡Œ&#39;</code>ã€‚</p><h3 id="ä½¿ç”¨-clearimmediate" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-clearimmediate"><span>ä½¿ç”¨ <code>clearImmediate()</code></span></a></h3><p>ç°åœ¨ï¼Œå¦‚æœåœ¨æŸä¸ªæ—¶åˆ»ï¼Œå‡ºäºä»»ä½•åŸå› ï¼Œä½ å†³å®šä½ ä¸å†éœ€è¦æ‰§è¡Œé€šè¿‡ <code>setImmediate()</code> å®‰æ’çš„æ“ä½œï¼Œè¿™å°±æ˜¯ <code>clearImmediate()</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚é€šè¿‡ä¼ é€’ <code>setImmediate()</code> è¿”å›çš„ ID ç»™ <code>clearImmediate()</code>ï¼Œä½ å¯ä»¥å–æ¶ˆè¯¥æ“ä½œã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> immediateId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ®µä»£ç ä¸ä¼šè¢«æ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å–æ¶ˆä¸Šé¢å®‰æ’çš„æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">immediateId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ä¾‹ä¸­ï¼Œå°½ç®¡æˆ‘ä»¬ä½¿ç”¨ <code>setImmediate()</code> å®‰æ’äº†ä¸€æ®µä»£ç ç¨åæ‰§è¡Œï¼Œä½†æˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>clearImmediate()</code> å¹¶ä¼ å…¥ä» <code>setImmediate()</code> è·å–çš„ IDï¼Œå–æ¶ˆäº†è¯¥æ“ä½œã€‚å› æ­¤ï¼Œ<code>&#39;è¿™æ®µä»£ç ä¸ä¼šè¢«æ‰§è¡Œ&#39;</code> å®é™…ä¸Šæ°¸è¿œä¸ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>åŠ¨æ€å†³ç­–</strong>ï¼šå‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªå®æ—¶æ•°æ®å¤„ç†ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šåŸºäºæ–°æ”¶åˆ°çš„æ•°æ®åŠ¨æ€åœ°å†³å®šæ˜¯å¦ç»§ç»­æŸäº›å·²ç»å®‰æ’çš„ä»»åŠ¡ã€‚é€šè¿‡ä½¿ç”¨ <code>clearImmediate()</code>ï¼Œä½ å¯ä»¥æ ¹æ®æœ€æ–°çš„ä¿¡æ¯çµæ´»åœ°å–æ¶ˆé‚£äº›ä¸å†éœ€è¦çš„ä»»åŠ¡ã€‚</p></li><li><p><strong>é¿å…ä¸å¿…è¦çš„æ“ä½œ</strong>ï¼šåœ¨ç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰çš„äº¤äº’è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çš„æ“ä½œå¯èƒ½è§¦å‘ä¸€äº›å³æ—¶ååº”çš„ä»£ç æ‰§è¡Œã€‚å¦‚æœç”¨æˆ·è¿…é€Ÿæ›´æ”¹äº†ä»–ä»¬çš„å†³å®šï¼ˆæ¯”å¦‚å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾ï¼‰ï¼Œä½¿ç”¨ <code>clearImmediate()</code> å¯ä»¥é¿å…æ‰§è¡Œå› ä¹‹å‰çš„æ“ä½œè€Œå®‰æ’çš„ã€ç°åœ¨å·²ä¸å†éœ€è¦çš„ä»»åŠ¡ï¼Œè¿™æœ‰åŠ©äºèŠ‚çœèµ„æºå¹¶æé«˜åº”ç”¨ç¨‹åºçš„å“åº”æ€§èƒ½ã€‚</p></li></ol><p>ç†è§£å’Œä½¿ç”¨ <code>setImmediate()</code> ä¸ <code>clearImmediate()</code>ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶ä½ çš„å¼‚æ­¥ä»£ç æ‰§è¡Œæµç¨‹ï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºæ—¢é«˜æ•ˆåˆå¯é ã€‚</p><h2 id="clearinterval-intervalobject" tabindex="-1"><a class="header-anchor" href="#clearinterval-intervalobject"><span><a href="https://nodejs.org/docs/latest/api/globals.html#clearintervalintervalobject" target="_blank" rel="noopener noreferrer">clearInterval(intervalObject)</a></span></a></h2><p><code>clearInterval(intervalObject)</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç”¨äºåœæ­¢ç”± <code>setInterval()</code> è®¾ç½®çš„å®šæ—¶æ‰§è¡Œçš„åŠ¨ä½œã€‚å½“ä½ ä½¿ç”¨ <code>setInterval()</code> å‡½æ•°åˆ›å»ºäº†å®šæœŸé‡å¤æ‰§è¡Œçš„ä»»åŠ¡åï¼Œå¯ä»¥é€šè¿‡ <code>clearInterval()</code> æ¥å–æ¶ˆè¿™ä¸ªä»»åŠ¡ã€‚</p><p>è®©æˆ‘ä»¬æ¥å…·ä½“çœ‹å‡ ä¸ªä¾‹å­æ¥ç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h3 id="ä¾‹å­-1-ç®€å•çš„è®¡æ—¶å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç®€å•çš„è®¡æ—¶å™¨"><span>ä¾‹å­ 1ï¼šç®€å•çš„è®¡æ—¶å™¨</span></a></h3><p>å‡è®¾ä½ æƒ³æ¯éš”ä¸€ç§’é’Ÿæ‰“å°ä¸€æ¬¡ &quot;Hello, World!&quot; åˆ°æ§åˆ¶å°(console)ï¼Œå¹¶ä¸”åœ¨æ‰“å°äº† 5 æ¬¡ä¹‹ååœæ­¢æ‰“å°ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> intervalId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“æ‰“å°æ¬¡æ•°è¾¾åˆ°5æ¬¡ï¼Œåœæ­¢é—´éš”è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼š</p><ul><li>æˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå˜é‡ <code>count</code> æ¥è®°å½•å½“å‰å·²ç»æ‰“å°äº†å¤šå°‘æ¬¡ã€‚</li><li>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>setInterval()</code> åˆ›å»ºäº†ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œè®¾ç½®å®ƒæ¯éš” 1000 æ¯«ç§’ï¼ˆå³ä¸€ç§’é’Ÿï¼‰æ‰§è¡Œä¸€æ¬¡åŒ¿åå‡½æ•°ã€‚</li><li>åœ¨åŒ¿åå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬æ‰“å°å‡º &quot;Hello, World!&quot; çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å°† <code>count</code> å˜é‡çš„å€¼å¢åŠ  1ã€‚</li><li>æ¥ç€æˆ‘ä»¬æ£€æŸ¥ <code>count</code> çš„å€¼æ˜¯å¦è¾¾åˆ°äº† 5ã€‚å¦‚æœè¾¾åˆ°äº†ï¼Œæˆ‘ä»¬å°±è°ƒç”¨ <code>clearInterval()</code> å¹¶ä¼ å…¥ <code>intervalId</code>ï¼ˆè¿™æ˜¯ <code>setInterval()</code> è¿”å›çš„ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼‰ï¼Œä»¥åœæ­¢åç»­çš„å®šæ—¶è°ƒç”¨ã€‚</li></ul><h3 id="ä¾‹å­-2-åŠ¨ç”»æˆ–è½®è¯¢ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-åŠ¨ç”»æˆ–è½®è¯¢ä»»åŠ¡"><span>ä¾‹å­ 2ï¼šåŠ¨ç”»æˆ–è½®è¯¢ä»»åŠ¡</span></a></h3><p>æƒ³è±¡ä¸€ä¸ªç½‘é¡µåº”ç”¨ï¼Œä½ éœ€è¦å®šæœŸå»æ£€æŸ¥æœåŠ¡å™¨ä¸Šæ˜¯å¦æœ‰æ–°çš„æ•°æ®æ›´æ–°ã€‚ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ª <code>setInterval()</code> å®šæ—¶å™¨å®šæœŸå‘é€è¯·æ±‚ï¼Œå¹¶ä¸”åœ¨æŸäº›æ¡ä»¶æ»¡è¶³ä¹‹åï¼Œä½¿ç”¨ <code>clearInterval()</code> åœæ­¢è½®è¯¢ã€‚</p><p>å‡è®¾ä»¥ä¸‹æ˜¯ä¼ªä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> intervalId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡æ‹Ÿå‘èµ·ç½‘ç»œè¯·æ±‚æ£€æŸ¥æ•°æ®æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  checkForUpdates</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœæ»¡è¶³æŸäº›æ¡ä»¶ï¼Œæ¯”å¦‚ç”¨æˆ·å¯¼èˆªç¦»å¼€äº†å½“å‰é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…é™¤å®šæ—¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userLeftPage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li>æˆ‘ä»¬æ¯ 5 ç§’é’Ÿé€šè¿‡ <code>checkForUpdates()</code> å‡½æ•°æ¨¡æ‹Ÿå‘é€ä¸€æ¬¡è¯·æ±‚å»æ£€æŸ¥æ›´æ–°ã€‚</li><li>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼ˆ<code>userLeftPage</code>ï¼‰æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç¦»å¼€äº†é¡µé¢ï¼Œå¦‚æœç¦»å¼€äº†ï¼Œæˆ‘ä»¬å°±é€šè¿‡ <code>clearInterval(intervalId)</code> åœæ­¢å®šæ—¶å™¨ã€‚</li></ul><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œä½ åº”è¯¥èƒ½çœ‹å‡º <code>clearInterval()</code> æ˜¯å¦‚ä½•é…åˆ <code>setInterval()</code> ä½¿ç”¨çš„ï¼Œä»¥ä¾¿åœ¨ç‰¹å®šæƒ…å†µä¸‹å–æ¶ˆå®šæœŸæ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™æ˜¯åœ¨ç¼–å†™æ¶‰åŠæ—¶é—´é—´éš”å¤„ç†çš„ JavaScript æˆ– Node.js ä»£ç æ—¶ä¸€ä¸ªéå¸¸å¸¸è§å’Œæœ‰ç”¨çš„åŠŸèƒ½ã€‚</p><h2 id="cleartimeout-timeoutobject" tabindex="-1"><a class="header-anchor" href="#cleartimeout-timeoutobject"><span><a href="https://nodejs.org/docs/latest/api/globals.html#cleartimeouttimeoutobject" target="_blank" rel="noopener noreferrer">clearTimeout(timeoutObject)</a></span></a></h2><p><code>clearTimeout(timeoutObject)</code> æ˜¯ JavaScript ä¸­æ¸…é™¤å®šæ—¶å™¨çš„ä¸€ä¸ªå‡½æ•°ã€‚åœ¨ Node.js ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯å¯ç”¨çš„ï¼Œå¹¶ä¸”å’Œæµè§ˆå™¨ä¸­çš„ JavaScript è¡¨ç°åŸºæœ¬ä¸€è‡´ã€‚</p><p>å½“ä½ è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>setTimeout()</code> å‡½æ•°ï¼Œå®ƒå°†åœ¨æŒ‡å®šçš„å»¶è¿Ÿä¹‹åæ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚å¦‚æœåœ¨è¿™æ®µå»¶è¿Ÿæ—¶é—´ç»“æŸä¹‹å‰ä½ å†³å®šä¸æƒ³è¦è¿™ä¸ªå®šæ—¶å™¨ç»§ç»­æ‰§è¡Œäº†ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>clearTimeout()</code> å‡½æ•°æ¥å–æ¶ˆå®ƒã€‚</p><p>ä¸‹é¢æ˜¯ <code>clearTimeout()</code> å‡½æ•°çš„ä½¿ç”¨ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè®©å®ƒåœ¨3000æ¯«ç§’ï¼ˆ3ç§’ï¼‰åæ‰§è¡Œä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> timeoutObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ¡æ¶ˆæ¯ä¼šåœ¨3ç§’åæ˜¾ç¤º&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾å‡ºäºæŸç§åŸå› ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä¸Šé¢é‚£ä¸ªå®šæ—¶å™¨äº†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ clearTimeout() æ¥å–æ¶ˆå®ƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timeoutObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å› ä¸ºå®šæ—¶å™¨å·²ç»è¢«æ¸…é™¤ï¼Œä¸Šé¢çš„console.logè¯­å¥ä¸ä¼šè¢«æ‰§è¡Œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<code>clearTimeout()</code> å¯èƒ½ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li><strong>ç”¨æˆ·äº¤äº’</strong>ï¼šå‡å¦‚æœ‰ä¸€ä¸ªç½‘ç«™æé†’ç”¨æˆ·ä»–ä»¬çš„ä¼šè¯å³å°†è¿‡æœŸï¼Œä½†å¦‚æœç”¨æˆ·è¿›è¡Œäº†æŸäº›æ“ä½œï¼Œæ¯”å¦‚ç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®ï¼Œä½ å¯èƒ½æƒ³è¦å–æ¶ˆé‚£ä¸ªè®¡æ—¶å™¨ã€‚</li><li><strong>ä¼˜åŒ–æ€§èƒ½</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨å®šæ—¶æ‹‰å–æœåŠ¡å™¨æ›´æ–°ï¼Œä½†ç”¨æˆ·å…³é—­äº†ç›¸åº”çš„è§†å›¾æˆ–ç»„ä»¶ï¼Œä½ å¯èƒ½æƒ³è¦æ¸…é™¤ç›¸å…³çš„å®šæ—¶å™¨ï¼Œä»¥é˜²ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚å’Œ CPU å ç”¨ã€‚</li><li><strong>æ¡ä»¶é€»è¾‘æ§åˆ¶</strong>ï¼šå¯èƒ½ä½ è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨å»æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ ¹æ®åç»­çš„ç¨‹åºé€»è¾‘ï¼Œä½ å†³å®šé‚£ä¸ªä»»åŠ¡ä¸å†éœ€è¦æ‰§è¡Œï¼Œè¿™æ—¶å€™å¯ä»¥ç”¨ <code>clearTimeout()</code> æ¥å–æ¶ˆã€‚</li></ol><p>è®°ä½ï¼Œ<code>clearTimeout()</code> éœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œå³åŸå…ˆç”± <code>setTimeout()</code> è¿”å›çš„å®šæ—¶å™¨å¯¹è±¡ï¼Œè¿™æ · JavaScript æ‰çŸ¥é“è¦å–æ¶ˆå“ªä¸€ä¸ªå®šæ—¶å™¨ã€‚å¦‚æœä½ å°è¯•æ¸…é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„å®šæ—¶å™¨ï¼Œæˆ–è€…ä¼ å…¥äº†é”™è¯¯çš„å‚æ•°ï¼Œé€šå¸¸ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ï¼ˆä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼‰ï¼Œä»£ç çš„å…¶ä»–éƒ¨åˆ†è¿˜ä¼šæ­£å¸¸è¿è¡Œã€‚</p><h2 id="class-compressionstream" tabindex="-1"><a class="header-anchor" href="#class-compressionstream"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-compressionstream" target="_blank" rel="noopener noreferrer">Class: CompressionStream</a></span></a></h2><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>CompressionStream</code>ç±»ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸€ç§ç”¨äºæ•°æ®å‹ç¼©çš„å·¥å…·ã€‚è¿™ä¸ªæ¦‚å¿µå¬èµ·æ¥å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œä½†æˆ‘ä¼šé€šè¿‡ä¸€äº›ç®€å•çš„ä¾‹å­æ¥è§£é‡Šå®ƒã€‚</p><h3 id="åŸºç¡€ç†è§£" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ç†è§£"><span>åŸºç¡€ç†è§£</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ•°æ®å‹ç¼©ã€‚æ•°æ®å‹ç¼©ï¼Œå°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œæ˜¯å‡å°æ–‡ä»¶æˆ–æ•°æ®çš„å¤§å°çš„è¿‡ç¨‹ã€‚æƒ³è±¡ä½ æœ‰ä¸€ä¸ªè£…æ»¡æ°”çƒçš„å¤§ç›’å­ï¼Œå¦‚æœä½ æŠŠæ‰€æœ‰æ°”çƒæ”¾æ°”ï¼Œé‚£ä¹ˆè¿™äº›æ°”çƒå ç”¨çš„ç©ºé—´å°±ä¼šå˜å°ï¼Œä½ ç”šè‡³å¯ä»¥æŠŠæ›´å¤šçš„æ°”çƒæ”¾è¿›ç›’å­é‡Œã€‚æ•°æ®å‹ç¼©ä¹Ÿéµå¾ªåŒæ ·çš„åŸç†ï¼Œå®ƒé€šè¿‡å„ç§ç®—æ³•ç§»é™¤æˆ–é‡æ–°ç¼–ç ä¿¡æ¯ï¼Œä»è€Œå‡å°‘æ•°æ®å ç”¨çš„ç©ºé—´ã€‚</p><p><code>CompressionStream</code>æ˜¯å®ç°è¿™ç§å‹ç¼©çš„ä¸€ä¸ªæ‰‹æ®µã€‚åœ¨ Node.jsï¼ˆä¸€ä¸ª JavaScript è¿è¡Œç¯å¢ƒï¼‰ä¸­ï¼Œ<code>CompressionStream</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„â€œæµâ€ç±»ï¼Œè®¾è®¡ç”¨æ¥å¤„ç†æµå¼æ•°æ®çš„å‹ç¼©ã€‚æµå¼æ•°æ®æ˜¯æŒ‡é‚£äº›å¯ä»¥ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†å‘é€çš„æ•°æ®ï¼Œå¦‚è§†é¢‘æˆ–éŸ³é¢‘æµã€æˆ–æ˜¯å¤§å‹æ–‡ä»¶ä¼ è¾“ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-ç½‘ç«™æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-ç½‘ç«™æ€§èƒ½ä¼˜åŒ–"><span>1. ç½‘ç«™æ€§èƒ½ä¼˜åŒ–</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œä¸Šé¢æœ‰å¤§é‡çš„å›¾ç‰‡å’Œè§†é¢‘å†…å®¹ã€‚ä¸ºäº†æé«˜é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨<code>CompressionStream</code>å¯¹è¿™äº›èµ„æºè¿›è¡Œå‹ç¼©ï¼Œç„¶åå†å‘é€ç»™ç”¨æˆ·çš„æµè§ˆå™¨ã€‚æµè§ˆå™¨æ¥æ”¶åˆ°å‹ç¼©åçš„æ•°æ®ï¼Œè§£å‹ç¼©ï¼Œå¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œä½†å¤§å¤§æé«˜äº†ç½‘é¡µçš„åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚</p><h4 id="_2-å‡å°‘å­˜å‚¨æˆæœ¬" tabindex="-1"><a class="header-anchor" href="#_2-å‡å°‘å­˜å‚¨æˆæœ¬"><span>2. å‡å°‘å­˜å‚¨æˆæœ¬</span></a></h4><p>å¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å­˜å‚¨å¤§é‡æ–‡æ¡£æˆ–è®°å½•çš„åº”ç”¨ç¨‹åºï¼Œç£ç›˜ç©ºé—´å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚åœ¨ä¿å­˜è¿™äº›æ–‡æ¡£ä¹‹å‰ï¼Œä½¿ç”¨<code>CompressionStream</code>è¿›è¡Œå‹ç¼©å¯ä»¥æ˜¾è‘—å‡å°‘æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ï¼Œä»è€Œé™ä½æˆæœ¬ã€‚</p><h4 id="_3-æé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡" tabindex="-1"><a class="header-anchor" href="#_3-æé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡"><span>3. æé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡</span></a></h4><p>åœ¨æ„å»ºä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’çš„åº”ç”¨æ—¶ï¼Œè‹¥éœ€è¦ä¼ è¾“å¤§é‡æ•°æ®ï¼Œç›´æ¥å‘é€åŸå§‹æ•°æ®å¯èƒ½ä¼šä½¿ç½‘ç»œé€šä¿¡éå¸¸ç¼“æ…¢ã€‚é€šè¿‡åœ¨å‘é€ä¹‹å‰ä½¿ç”¨<code>CompressionStream</code>å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå¯ä»¥å‡å°‘éœ€è¦ä¼ è¾“çš„æ•°æ®é‡ï¼Œä»è€ŒåŠ å¿«ä¼ è¾“é€Ÿåº¦ï¼Œæé«˜æ•ˆç‡ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-2" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-2"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>åœ¨ Node.js ä¸­ä½¿ç”¨<code>CompressionStream</code>ç±»ç›¸å¯¹ç®€å•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•å‹ç¼©æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥zlibæ¨¡å—ï¼Œå®ƒæä¾›äº†å‹ç¼©åŠŸèƒ½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªCompressionStreamå®ä¾‹ï¼Œè¿™é‡Œä»¥gzipå‹ç¼©ä¸ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> compressionStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºè¾“å…¥å’Œè¾“å‡ºæµï¼Œä»¥æ–‡ä»¶æ“ä½œä¸ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> input</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€è¦è¢«å‹ç¼©çš„æ–‡ä»¶input.txt</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> output</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºæ–‡ä»¶å°†æ˜¯å‹ç¼©åçš„ç‰ˆæœ¬</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ç®¡é“æ“ä½œå°†è¾“å…¥æµè¿æ¥åˆ°å‹ç¼©æµï¼Œç„¶åå°†ç»“æœè¾“å‡ºåˆ°ç›®æ ‡æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">compressionStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">output</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª gzip å‹ç¼©æµï¼Œå°†ä¸€ä¸ªæ–‡ä»¶æµé€šè¿‡å®ƒè¿›è¡Œå‹ç¼©ï¼Œç„¶åè¾“å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™åªæ˜¯<code>CompressionStream</code>åº”ç”¨çš„å†°å±±ä¸€è§’ï¼Œä½†åŸºæœ¬ä¸Šï¼Œå·¥ä½œåŸç†éƒ½æ˜¯ç±»ä¼¼çš„ï¼šè¯»å–åŸå§‹æ•°æ®ï¼Œé€šè¿‡å‹ç¼©æµå¤„ç†ï¼Œç„¶åè¾“å‡ºå‹ç¼©åçš„æ•°æ®ã€‚</p><p>å¸Œæœ›è¿™äº›ä¿¡æ¯å’Œä¾‹å­èƒ½å¸®åŠ©ä½ ç†è§£ Node.js ä¸­<code>CompressionStream</code>ç±»çš„ç”¨å¤„å’Œå·¥ä½œæ–¹å¼ï¼</p><h2 id="console" tabindex="-1"><a class="header-anchor" href="#console"><span><a href="https://nodejs.org/docs/latest/api/globals.html#console" target="_blank" rel="noopener noreferrer">console</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯éé˜»å¡ I/Oï¼Œå³ä½¿ç›¸å¯¹å¤§é‡çš„æ•°æ®ä¹Ÿèƒ½é«˜æ•ˆå¤„ç†ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>console</code> å¯¹è±¡æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥è¾“å‡ºä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰æˆ–æ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰ã€‚è¿™äº›æ–¹æ³•ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„ <code>console</code> å¯¹è±¡ï¼Œå› æ­¤å¦‚æœä½ æœ‰åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨è¿‡ <code>console</code> çš„ç»éªŒï¼Œä½ ä¼šå‘ç°å®ƒä»¬å¾ˆç†Ÿæ‚‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›æœ€å¸¸ç”¨çš„ <code>console</code> æ–¹æ³•åŠå…¶ç”¨æ³•ï¼š</p><ol><li><p><code>console.log()</code>: è¿™æ˜¯æœ€å¸¸è§çš„æ§åˆ¶å°è¾“å‡ºæ–¹æ³•ï¼Œç”¨äºæ‰“å°æ™®é€šçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Hello, World!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>console.error()</code>: ç”¨äºè¾“å‡ºé”™è¯¯æ¶ˆæ¯åˆ° stderrã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Something went wrong!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºé”™è¯¯æ¶ˆæ¯: Something went wrong!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>console.warn()</code>: ç”¨äºè¾“å‡ºè­¦å‘Šä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is a warning!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºè­¦å‘Šä¿¡æ¯: This is a warning!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>console.info()</code>: ç”¨äºè¾“å‡ºä¿¡æ¯æ€§æ¶ˆæ¯ï¼ŒåŠŸèƒ½ä¸ <code>console.log()</code> ç±»ä¼¼ï¼Œä½†åœ¨æŸäº›å¹³å°ä¸Šå¯èƒ½ä¼šä»¥ä¸åŒçš„æ–¹å¼æ ‡è®°æˆ–è®°å½•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Informative message.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Informative message.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>console.debug()</code>: ç±»ä¼¼äº <code>console.log()</code>ï¼Œä½†é€šå¸¸åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹æ‰æ˜¾ç¤ºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Debugging message.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åªæœ‰åœ¨å¯ç”¨è°ƒè¯•æ—¶æ‰ä¼šæ˜¾ç¤º</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>console.table()</code>: å¯ä»¥å°†æ•°ç»„æˆ–å¯¹è±¡çš„å†…å®¹ä»¥è¡¨æ ¼å½¢å¼æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿æŸ¥çœ‹å¤æ‚æ•°æ®ç»“æ„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">table</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Y&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜¾ç¤º:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// â”‚ (index) â”‚  a  â”‚  b  â”‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// â”‚    0    â”‚  1  â”‚ &#39;Y&#39; â”‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// â”‚    1    â”‚  2  â”‚ &#39;Z&#39; â”‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>console.assert()</code>: ç”¨äºæ–­è¨€æµ‹è¯•ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸º <code>false</code>ï¼Œåˆ™è¾“å‡ºåé¢çš„æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This will not be printed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Assertion failed: 2 is not equal to 3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Assertion failed: 2 is not equal to 3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>console.time()</code> å’Œ <code>console.timeEnd()</code>: ç”¨äºè®¡ç®—ä»£ç æ‰§è¡Œæ—¶é—´é—´éš”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;100-elements&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡æ‹Ÿä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">timeEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;100-elements&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°å‡º100æ¬¡å¾ªç¯æ‰€èŠ±è´¹çš„æ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>console.trace()</code>: æ‰“å°å½“å‰çš„å †æ ˆè½¨è¿¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> bar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">trace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  bar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">foo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜¾ç¤ºfooå’Œbarå‡½æ•°è¢«è°ƒç”¨çš„è½¨è¿¹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä»¥ä¸Šå°±æ˜¯ Node.js ä¸­ <code>console</code> å¯¹è±¡çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ã€‚é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œä½ å¯ä»¥å¸®åŠ©è‡ªå·±è¿›è¡Œè°ƒè¯•ã€ç›‘æ§ç¨‹åºçš„è¡Œä¸ºæˆ–è€…ä»…ä»…æ˜¯è¾“å‡ºä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦å¿«é€Ÿå®šä½é—®é¢˜æˆ–ç†è§£ç¨‹åºæµç¨‹æ—¶ã€‚</p><h2 id="class-countqueuingstrategy" tabindex="-1"><a class="header-anchor" href="#class-countqueuingstrategy"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-countqueuingstrategy" target="_blank" rel="noopener noreferrer">Class: CountQueuingStrategy</a></span></a></h2><p><code>CountQueuingStrategy</code> æ˜¯ Node.js ä¸­ç”¨æ¥å¤„ç†æµï¼ˆstreamsï¼‰çš„ä¸€ç§ç­–ç•¥ï¼Œä¸»è¦ç”¨äºèƒŒå‹ç®¡ç†ã€‚èƒŒå‹ï¼ˆbackpressureï¼‰æ˜¯å½“ä½ å¤„ç†æ•°æ®æµæ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç”Ÿäº§é€Ÿåº¦æ¯”æ¶ˆè´¹é€Ÿåº¦å¿«ï¼Œå¯¼è‡´æ•°æ®ç§¯å‹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNode.js æä¾›äº†å‡ ç§é˜Ÿåˆ—ç­–ç•¥ï¼Œ<code>CountQueuingStrategy</code> å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>CountQueuingStrategy</code> ä¼šæ ¹æ®â€œè®¡æ•°â€æ¥æ§åˆ¶é˜Ÿåˆ—ä¸­çš„å—ï¼ˆchunksï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šè·Ÿè¸ªåœ¨å†…éƒ¨é˜Ÿåˆ—ä¸­çš„å¯¹è±¡æ•°é‡ï¼Œå¹¶æ ¹æ®è¿™ä¸ªæ•°é‡æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æš‚åœæ¥æ”¶æ›´å¤šçš„æ•°æ®å—ï¼Œä»è€Œæ§åˆ¶èƒŒå‹ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ <code>CountQueuingStrategy</code> æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p><p>å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªå¯ä»¥è¯»å–æ•°æ®å¹¶é€ä¸ªå¤„ç†çš„æµç¨‹ã€‚ä½†æ˜¯æˆ‘ä»¬çš„å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œä¸èƒ½å¤„ç†å¤ªå¤šçš„æ•°æ®å—ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>CountQueuingStrategy</code> æ¥é™åˆ¶å†…éƒ¨é˜Ÿåˆ—ä¸­å¯ä»¥å­˜æ”¾çš„æ•°æ®å—æ•°é‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">ReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">CountQueuingStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°æ®æºæ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;d&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œå¹¶ä½¿ç”¨ CountQueuingStrategy æ§åˆ¶èƒŒå‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CountQueuingStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ç›‘å¬å™¨æ¥è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> done</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ((({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()), </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†æ¯ä¸ªæ•°æ®å—ï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹å¤„ç†æµ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å­—æ¯ &#39;a&#39; åˆ° &#39;d&#39; çš„æ•°ç»„ä½œä¸ºæˆ‘ä»¬çš„æ•°æ®æºã€‚</li><li>æ¥ç€åˆ›å»ºäº†ä¸€ä¸ª <code>ReadableStream</code> å¯¹è±¡ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªèµ·å§‹å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ˆå³æ•°æ®å—ï¼‰åŠ å…¥åˆ°æµä¸­ã€‚</li><li>åœ¨å®ä¾‹åŒ– <code>ReadableStream</code> æ—¶ï¼Œæˆ‘ä»¬ä¼ å…¥äº† <code>CountQueuingStrategy</code> å¯¹è±¡ï¼Œå¹¶è®¾ç½® <code>highWaterMark</code>ï¼ˆé«˜æ°´ä½æ ‡è®°ï¼‰ä¸º 1ã€‚è¿™æ„å‘³ç€å½“é˜Ÿåˆ—ä¸­çš„æ•°æ®å—è¾¾åˆ°æˆ–è¶…è¿‡ 1 æ—¶ï¼Œæµä¾¿ä¸å†æ¥å—æ–°çš„æ•°æ®å—ï¼Œç›´åˆ°ç°æœ‰çš„æ•°æ®å—è¢«å¤„ç†å®Œæ¯•ã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬å®šä¹‰å¹¶è°ƒç”¨ <code>processStream</code> å‡½æ•°æ¥å¼‚æ­¥åœ°è¯»å–å’Œæ‰“å°æµä¸­çš„æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®å—å¤„ç†å®Œæ¯•ä¹‹åä¼šç­‰å¾… 100 æ¯«ç§’ï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œçš„æ—¶é—´æ¶ˆè€—ã€‚</li></ol><p>ä½¿ç”¨ <code>CountQueuingStrategy</code> å¯ä»¥æœ‰æ•ˆç®¡ç†å¤§é‡æ•°æ®çš„å¤„ç†ï¼Œé¿å…æ¶ˆè´¹è€…å¤„ç†ä¸è¿‡æ¥æ—¶é€ æˆç¨‹åºå´©æºƒæˆ–å†…å­˜æº¢å‡ºã€‚åœ¨ Node.js ä¸­ç®¡ç†æµå¼æ•°æ®æ—¶ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„æœºåˆ¶ï¼Œå°¤å…¶é€‚ç”¨äºæ–‡ä»¶å¤„ç†ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚</p><h2 id="crypto" tabindex="-1"><a class="header-anchor" href="#crypto"><span><a href="https://nodejs.org/docs/latest/api/globals.html#crypto" target="_blank" rel="noopener noreferrer">Crypto</a></span></a></h2><p>Node.js ä¸­çš„<code>crypto</code>æ¨¡å—æ˜¯ä¸€ä¸ªæä¾›åŠ å¯†åŠŸèƒ½çš„åº“ï¼ŒåŒ…æ‹¬ä¸€ç³»åˆ—ç”¨äºå¤„ç†åŠ å¯†æŠ€æœ¯çš„å·¥å…·ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ è¿›è¡Œæ•°æ®çš„æ•£åˆ—(hash)ï¼Œåˆ›å»ºæ•°å­—ç­¾åï¼ŒåŠ å¯†æ•°æ®ä¼ è¾“ï¼Œä»¥åŠæ‰§è¡Œå…¶ä»–ä¸åŠ å¯†ç›¸å…³çš„ä»»åŠ¡ã€‚</p><p>ä»¥ä¸‹æ˜¯å‡ ä¸ª<code>crypto</code>æ¨¡å—å®é™…åº”ç”¨çš„ä¾‹å­ï¼š</p><h3 id="_1-æ•°æ®æ•£åˆ—-hashing" tabindex="-1"><a class="header-anchor" href="#_1-æ•°æ®æ•£åˆ—-hashing"><span>1. æ•°æ®æ•£åˆ—(Hashing)</span></a></h3><p>æ•°æ®æ•£åˆ—æ˜¯å°†ä»»æ„é•¿åº¦çš„è¾“å…¥é€šè¿‡æ•£åˆ—ç®—æ³•è½¬æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºä¸²ï¼ˆé€šå¸¸æ›´çŸ­ã€çœ‹èµ·æ¥éšæœºï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å•å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»æ•£åˆ—å€¼é€šå¸¸æ— æ³•é€†å‘æ¨å¯¼å‡ºåŸå§‹æ•°æ®ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>: å­˜å‚¨ç”¨æˆ·å¯†ç æ—¶ï¼Œä¸åº”è¯¥æ˜æ–‡å­˜å‚¨ï¼Œè€Œåº”è¯¥å­˜å‚¨å¯†ç çš„æ•£åˆ—å€¼ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ•£åˆ—å™¨(hasher)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hasher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hasher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¡ç®—æ•£åˆ—å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> hasher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºæ•£åˆ—å€¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-åŠ å¯†å’Œè§£å¯†" tabindex="-1"><a class="header-anchor" href="#_2-åŠ å¯†å’Œè§£å¯†"><span>2. åŠ å¯†å’Œè§£å¯†</span></a></h3><p>åŠ å¯†ç”¨äºå°†æ•°æ®è½¬æ¢æˆä¸èƒ½ç›´æ¥é˜…è¯»çš„æ ¼å¼ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚è§£å¯†æ˜¯åŠ å¯†çš„é€†è¿‡ç¨‹ï¼Œç”¨äºå°†åŠ å¯†åçš„æ•°æ®æ¢å¤åˆ°å…¶åŸå§‹æ ¼å¼ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>: å‘é€æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ä¿¡ç”¨å¡ä¿¡æ¯æˆ–ç§äººå¯¹è¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®šä¹‰åŠ å¯†çš„å¯†é’¥å’Œç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> algorithm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;aes-192-cbc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> password</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;password-used-to-generate-key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨å¯†ç å’Œç®—æ³•ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">scryptSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;salt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">24</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> iv</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some clear text data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ å¯†åçš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§£å¯†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createDecipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">decrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§£å¯†åçš„åŸæ–‡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ•°å­—ç­¾åä¸éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_3-æ•°å­—ç­¾åä¸éªŒè¯"><span>3. æ•°å­—ç­¾åä¸éªŒè¯</span></a></h3><p>æ•°å­—ç­¾åæ˜¯ä½¿ç”¨å‘é€è€…çš„ç§é’¥åŠ å¯†ä¿¡æ¯çš„æ•£åˆ—å€¼ï¼Œæ¥æ”¶æ–¹å¯ä»¥ä½¿ç”¨å…¬é’¥æ¥éªŒè¯è¯¥ä¿¡æ¯æ˜¯å¦æœªè¢«ç¯¡æ”¹ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>: ç¡®è®¤æ–‡ä»¶æˆ–ä¿¡æ¯æœªè¢«ä¿®æ”¹ï¼Œæ¯”å¦‚è½¯ä»¶å‘å¸ƒæ—¶ç¡®ä¿ä¸‹è½½çš„è½¯ä»¶æœªè¢«ç¯¡æ”¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”Ÿæˆä¸€å¯¹å¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">publicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">privateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateKeyPairSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rsa&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  modulusLength</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2048</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;important data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ç§é’¥åˆ›å»ºç­¾å</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSign</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">signer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signature</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> signer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">privateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signature</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºç­¾å</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨å…¬é’¥æ¥éªŒè¯ç­¾å</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> verifier</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createVerify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">verifier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> isVerified</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> verifier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">verify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">publicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signature</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">isVerified</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœä¸º trueï¼Œåˆ™ç­¾åæœ‰æ•ˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›ä¾‹å­åªæ˜¯<code>crypto</code>æ¨¡å—åŠŸèƒ½çš„å†°å±±ä¸€è§’ï¼Œä½†å®ƒä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ç”¨ç®€å•çš„æ–¹å¼æ¥æ‰§è¡ŒåŸºæœ¬çš„åŠ å¯†æ“ä½œã€‚éšç€ä½ å¯¹ç¼–ç¨‹å’Œå®‰å…¨æ€§ç†è§£çš„åŠ æ·±ï¼Œä½ ä¼šå‘ç°æ›´å¤šå¤æ‚ä¸”åŠŸèƒ½å¼ºå¤§çš„ç”¨æ³•ã€‚è®°ä½ï¼Œåœ¨å¤„ç†åŠ å¯†å’Œå®‰å…¨ç›¸å…³çš„ä»£ç æ—¶è¦æ ¼å¤–å°å¿ƒï¼Œå› ä¸ºé”™è¯¯çš„åšæ³•å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚</p><h2 id="crypto-1" tabindex="-1"><a class="header-anchor" href="#crypto-1"><span><a href="https://nodejs.org/docs/latest/api/globals.html#crypto_1" target="_blank" rel="noopener noreferrer">crypto</a></span></a></h2><p>Node.js çš„ <code>crypto</code> æ¨¡å—æ˜¯ä¸€ä¸ªç”¨äºåŠ å¯†çš„å†…å»ºåº“ï¼Œå®ƒæä¾›äº†å„ç§åŠ å¯†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å“ˆå¸Œç®—æ³•ç­‰ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ä¸ªæ¨¡å—ä»ç„¶æ˜¯æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬æ¥é€šè¿‡å‡ ä¸ªä¾‹å­ï¼Œæ·±å…¥ç†è§£å®ƒçš„å®é™…åº”ç”¨ã€‚</p><h3 id="å“ˆå¸Œç®—æ³•-hashing" tabindex="-1"><a class="header-anchor" href="#å“ˆå¸Œç®—æ³•-hashing"><span>å“ˆå¸Œç®—æ³•ï¼ˆHashingï¼‰</span></a></h3><p>å“ˆå¸Œç®—æ³•å¯ä»¥å°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬æ¢æˆå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆé€šå¸¸çœ‹èµ·æ¥æ˜¯ä¸€ä¸²ä¹±ç ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å•å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¸èƒ½ä»å“ˆå¸Œå€¼é€†å‘å¾—åˆ°åŸå§‹æ•°æ®ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—å“ˆå¸Œç®—æ³•åœ¨å­˜å‚¨å¯†ç ã€éªŒè¯æ•°æ®å®Œæ•´æ€§ç­‰æ–¹é¢éå¸¸æœ‰ç”¨ã€‚</p><p><strong>ä¾‹å­ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª SHA-256 çš„å“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”Ÿæˆå“ˆå¸Œå€¼è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† SHA-256 ç®—æ³•å¯¹å­—ç¬¦ä¸² &quot;hello world&quot; è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶ä»¥åå…­è¿›åˆ¶æ ¼å¼è¾“å‡ºç»“æœã€‚</p><h3 id="å¯¹ç§°åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#å¯¹ç§°åŠ å¯†"><span>å¯¹ç§°åŠ å¯†</span></a></h3><p>å¯¹ç§°åŠ å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚è¿™ç§æ–¹å¼åœ¨éœ€è¦å¿«é€ŸåŠ è§£å¯†å¤§é‡æ•°æ®æ—¶å¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿå¸¦æ¥äº†å¯†é’¥ç®¡ç†ä¸Šçš„æŒ‘æˆ˜ï¼Œå› ä¸ºä½ å¿…é¡»ç¡®ä¿å¯†é’¥åœ¨é€šä¿¡åŒæ–¹ä¹‹é—´å®‰å…¨å…±äº«ã€‚</p><p><strong>ä¾‹å­ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> algorithm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;aes-192-cbc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> password</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;å¯†ç &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨è¶³å¤Ÿå¤æ‚çš„å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">scryptSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç›å€¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">24</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯†é’¥æ´¾ç”Ÿå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> iv</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¦åŠ å¯†çš„æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ AES-192-CBC ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯†é’¥å’Œåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰è¿›è¡ŒåŠ å¯†ã€‚</p><h3 id="éå¯¹ç§°åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#éå¯¹ç§°åŠ å¯†"><span>éå¯¹ç§°åŠ å¯†</span></a></h3><p>éå¯¹ç§°åŠ å¯†ä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥å¯ä»¥åˆ†äº«ç»™ä»»ä½•äººï¼Œç”¨æ¥åŠ å¯†æ•°æ®ï¼›è€Œç§é’¥ä¿ç•™åœ¨æ•°æ®æ¥æ”¶è€…æ‰‹é‡Œï¼Œç”¨æ¥è§£å¯†ã€‚è¿™ç§æ–¹æ³•åœ¨æ•°å­—ç­¾åå’Œå»ºç«‹å®‰å…¨é€šä¿¡ï¼ˆæ¯”å¦‚ HTTPSï¼‰æ—¶éå¸¸é‡è¦ã€‚</p><p><strong>ä¾‹å­ï¼š</strong></p><p>æœªç›´æ¥åˆ—å‡ºï¼Œå› ä¸ºéå¯¹ç§°åŠ å¯†é€šå¸¸æ¶‰åŠåˆ°å¯†é’¥çš„ç”Ÿæˆã€å­˜å‚¨å’Œä½¿ç”¨ï¼Œæ­¥éª¤è¾ƒä¸ºå¤æ‚ã€‚ä½†åŸºæœ¬æ€è·¯æ˜¯ä½¿ç”¨ <code>crypto.generateKeyPair()</code> æˆ– <code>crypto.generateKeyPairSync()</code> æ–¹æ³•ç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œç„¶åä½¿ç”¨å…¬é’¥åŠ å¯†æ•°æ®ï¼Œç§é’¥è§£å¯†æ•°æ®ã€‚</p><h3 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h3><p>Node.js çš„ <code>crypto</code> æ¨¡å—æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„åŠ å¯†åŠŸèƒ½ï¼Œæ—¢å¯ä»¥ç”¨äºåŸºæœ¬çš„æ•°æ®åŠ å¯†å’Œå“ˆå¸Œè®¡ç®—ï¼Œä¹Ÿæ”¯æŒé«˜çº§åœºæ™¯å¦‚ SSL/TLS å®‰å…¨é€šä¿¡ã€‚ä¸ç®¡ä½ æ˜¯åœ¨å¼€å‘ Web åº”ç”¨ã€æ„å»º API è¿˜æ˜¯å¤„ç†æ•æ„Ÿæ•°æ®ï¼Œåˆç†ä½¿ç”¨ <code>crypto</code> æ¨¡å—éƒ½èƒ½å¤§å¤§å¢å¼ºä½ åº”ç”¨çš„å®‰å…¨æ€§ã€‚</p><h2 id="cryptokey" tabindex="-1"><a class="header-anchor" href="#cryptokey"><span><a href="https://nodejs.org/docs/latest/api/globals.html#cryptokey" target="_blank" rel="noopener noreferrer">CryptoKey</a></span></a></h2><p>ç†è§£ Node.js ä¸­çš„ <code>CryptoKey</code> å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´å¯èƒ½ç¨æ˜¾å¤æ‚ï¼Œä½†æˆ‘ä¼šå°½é‡ç”¨ç®€å•çš„è¯­è¨€æ¥è¯´æ˜ã€‚</p><p>é¦–å…ˆï¼Œè¦çŸ¥é“ Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨ JavaScript æ¥å†™åç«¯ä»£ç ã€‚è€Œåœ¨å¾ˆå¤šåç«¯åº”ç”¨ä¸­ï¼Œæ•°æ®å®‰å…¨æ€§æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°åŠ å¯†æŠ€æœ¯ã€‚Node.js é€šè¿‡æä¾›ä¸€ä¸ªåä¸º <code>crypto</code> çš„æ¨¡å—ï¼Œä½¿å¾—å®ç°å„ç§åŠ å¯†æŠ€æœ¯å˜å¾—å¯èƒ½ã€‚â€œCryptoKeyâ€æ˜¯è¿™ä¸ªæ¨¡å—çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-cryptokey" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-cryptokey"><span>ä»€ä¹ˆæ˜¯ CryptoKeyï¼Ÿ</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>CryptoKey</code> æ˜¯ä»£è¡¨ä¸€ä¸ªåŠ å¯†å¯†é’¥çš„å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥ç”¨äºå„ç§åŠ å¯†æ“ä½œï¼Œæ¯”å¦‚åŠ å¯†æ•°æ®ã€è§£å¯†æ•°æ®ã€ç­¾ç½²æ•°æ®æˆ–éªŒè¯æ•°æ®çš„ç­¾åç­‰ã€‚åœ¨ç½‘ç»œé€šä¿¡å’Œæ•°æ®å­˜å‚¨é¢†åŸŸï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§æ˜¯æå…¶é‡è¦çš„ï¼Œ<code>CryptoKey</code> å°±æ˜¯ç”¨æ¥åŠ å¼ºè¿™ä¸€å®‰å…¨æ€§çš„å·¥å…·ä¹‹ä¸€ã€‚</p><h3 id="cryptokey-çš„ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#cryptokey-çš„ä½¿ç”¨åœºæ™¯"><span>CryptoKey çš„ä½¿ç”¨åœºæ™¯</span></a></h3><p>ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p><strong>HTTPS é€šä¿¡</strong>ï¼šå½“ä½ æµè§ˆç½‘é¡µæ—¶ï¼Œå°¤å…¶æ˜¯è¾“å…¥æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚æ”¯ä»˜ä¿¡æ¯ï¼‰çš„æ—¶å€™ï¼Œä½ çš„æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚è¿™ç§åŠ å¯†è¿‡ç¨‹å°±å¯èƒ½ç”¨åˆ° <code>CryptoKey</code>ã€‚æœåŠ¡å™¨ä¼šæœ‰ä¸€å¯¹å¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ã€‚å…¬é’¥ç”¨æ¥åŠ å¯†æ•°æ®ï¼Œç§é’¥ç”¨æ¥è§£å¯†æ•°æ®ã€‚åªæœ‰è¿™æ ·ï¼Œå³ä¾¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«æˆªè·ï¼Œæ²¡æœ‰å¯†é’¥çš„äººä¹Ÿæ— æ³•è§£è¯»æ•°æ®çš„çœŸå®å†…å®¹ã€‚</p></li><li><p><strong>ç”¨æˆ·å¯†ç å­˜å‚¨</strong>ï¼šå½“ä½ åœ¨ä¸€ä¸ªç½‘ç«™æ³¨å†Œè´¦å·æ—¶ï¼Œä½ çš„å¯†ç éœ€è¦è¢«å®‰å…¨åœ°å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šã€‚å¼€å‘è€…é€šå¸¸ä¸ä¼šç›´æ¥å­˜å‚¨ä½ çš„å¯†ç ï¼Œè€Œæ˜¯å­˜å‚¨å¯†ç çš„åŠ å¯†ç‰ˆæœ¬ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>CryptoKey</code> å¯ä»¥ç”¨æ¥å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ã€‚</p></li><li><p><strong>æ•°å­—ç­¾å</strong>ï¼šå‡è®¾ä½ åœ¨ä½¿ç”¨ä¸€ä¸ªæ–‡æ¡£ç­¾åçš„åº”ç”¨ï¼Œå½“ä½ ç­¾ç½²ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªåº”ç”¨å¯èƒ½ä¼šä½¿ç”¨ <code>CryptoKey</code> æ¥åˆ›å»ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç­¾åï¼Œè¿™ä¸ªç­¾ååŸºäºä½ çš„ç§é’¥å’Œæ–‡ä»¶çš„å†…å®¹ç”Ÿæˆã€‚æ¥æ”¶æ–¹å¯ä»¥ä½¿ç”¨ä½ çš„å…¬é’¥æ¥éªŒè¯è¿™ä¸ªç­¾åç¡®å®æ˜¯ç”±ä½ åˆ›å»ºçš„ï¼Œä»è€Œç¡®è®¤æ–‡ä»¶çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ã€‚</p></li></ol><h3 id="å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨-cryptokey" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨-cryptokey"><span>å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ CryptoKey</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä½¿ç”¨ <code>crypto</code> æ¨¡å—çš„ <code>subtle</code> å±æ€§å¯ä»¥åˆ›å»ºå’Œç®¡ç† <code>CryptoKey</code>ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„ç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">webcrypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”ŸæˆåŠ å¯†å¯†é’¥çš„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> keyParams</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES-GCM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ å¯†ç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”Ÿæˆä¸€ä¸ªåŠ å¯†å¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">subtle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    keyParams</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;encrypt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;decrypt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç å±•ç¤ºäº†å¦‚ä½•ç”Ÿæˆä¸€ä¸ªç”¨äºåŠ å¯†å’Œè§£å¯†çš„å¯†é’¥ã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½æ¶‰åŠæ›´å¤æ‚çš„å‚æ•°å’Œé”™è¯¯å¤„ç†é€»è¾‘ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>CryptoKey</code> æ˜¯ Node.js æä¾›çš„ä¸€ç§æ–¹å¼ï¼Œç”¨äºå¤„ç†åŠ å¯†å¯†é’¥ï¼Œä»¥ä¿éšœæ•°æ®ä¼ è¾“å’Œå­˜å‚¨çš„å®‰å…¨æ€§ã€‚é€šè¿‡ <code>crypto</code> æ¨¡å—çš„ APIï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°ç”Ÿæˆå¯†é’¥ã€åŠ å¯†æ•°æ®ã€è§£å¯†æ•°æ®ç­‰ï¼Œä»è€Œä¸ºåº”ç”¨æ·»åŠ å®‰å…¨ä¿æŠ¤å±‚ã€‚</p><h2 id="customevent" tabindex="-1"><a class="header-anchor" href="#customevent"><span><a href="https://nodejs.org/docs/latest/api/globals.html#customevent" target="_blank" rel="noopener noreferrer">CustomEvent</a></span></a></h2><p>Node.js åœ¨å…¶ç‰ˆæœ¬ 21.7.1 ä¸­åŠ å…¥äº†å¯¹ <code>CustomEvent</code> çš„æ”¯æŒï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚åœ¨æ·±å…¥è§£é‡Šä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä»€ä¹ˆæ˜¯ <code>CustomEvent</code>ã€‚</p><h2 id="customevent-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#customevent-ç®€ä»‹"><span>CustomEvent ç®€ä»‹</span></a></h2><p><code>CustomEvent</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„äº‹ä»¶ï¼Œå¯ä»¥è®©ä½ åˆ›å»ºè‡ªå®šä¹‰çš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿæºå¸¦ç‰¹å®šçš„ä¿¡æ¯ã€‚å®ƒåŸæœ¬æ˜¯æµè§ˆå™¨ä¸­çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºåœ¨å‰ç«¯ JavaScript ä»£ç ä¸­åˆ›å»ºå’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚Node.js å¼•å…¥è¿™ä¸ªç‰¹æ€§åï¼Œå¼€å‘è€…ç°åœ¨ä¹Ÿèƒ½åœ¨åç«¯ç¯å¢ƒä¸­ä½¿ç”¨è¿™ä¸ªå¼ºå¤§çš„åŠŸèƒ½ã€‚</p><h3 id="åˆ›å»ºä¸€ä¸ª-customevent" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-customevent"><span>åˆ›å»ºä¸€ä¸ª CustomEvent</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>CustomEvent</code> æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ã€‚æ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šäº‹ä»¶åç§°å’Œä¸€ä¸ªåŒ…å«äº‹ä»¶é€‰é¡¹çš„å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä¸­å¯ä»¥æŒ‡å®šä»»æ„çš„æ•°æ®ä½œä¸ºäº‹ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ <code>detail</code> å±æ€§ä¼ é€’ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-custom-event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">detail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>my-custom-event</code> çš„äº‹ä»¶ï¼Œå¹¶ä¸”é€šè¿‡ <code>detail</code> å±æ€§ä¼ é€’äº†ä¸€ä¸ªå¯¹è±¡ <code>{ key: &#39;value&#39; }</code> ä½œä¸ºäº‹ä»¶çš„è½½è·ï¼ˆpayloadï¼‰ã€‚</p><h3 id="è§¦å‘-customevent" tabindex="-1"><a class="header-anchor" href="#è§¦å‘-customevent"><span>è§¦å‘ CustomEvent</span></a></h3><p>åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶åï¼Œä½ éœ€è¦ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨æ¥â€œç›‘å¬â€è¿™ä¸ªäº‹ä»¶ï¼Œç„¶åä½ å¯ä»¥ä½¿ç”¨ <code>dispatchEvent</code> æ–¹æ³•æ¥è§¦å‘è¯¥äº‹ä»¶ã€‚ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒNode.js ç¯å¢ƒä¸‹å¹¶æ²¡æœ‰åƒæµè§ˆå™¨ä¸­é‚£æ ·çš„å…¨å±€ <code>dispatchEvent</code> æ–¹æ³•ã€‚åœ¨ Node.js ä¸­ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ EventEmitter ç±»æ¥ä»£æ›¿è¿™ä¸ªåŠŸèƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-custom-event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">detail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š{ key: &#39;value&#39; }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§¦å‘äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;my-custom-event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-custom-event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">detail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h2><h3 id="_1-ç”¨æˆ·æ³¨å†ŒæˆåŠŸå‘é€æ¬¢è¿é‚®ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-ç”¨æˆ·æ³¨å†ŒæˆåŠŸå‘é€æ¬¢è¿é‚®ä»¶"><span>1. ç”¨æˆ·æ³¨å†ŒæˆåŠŸå‘é€æ¬¢è¿é‚®ä»¶</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç”¨æˆ·æ³¨å†Œçš„åç«¯æœåŠ¡ï¼Œå½“ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œä½ æƒ³å‘é€ä¸€å°æ¬¢è¿é‚®ä»¶ç»™ç”¨æˆ·ã€‚ä½¿ç”¨ <code>CustomEvent</code> å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> UserEventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> userEvents</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> UserEventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ç”¨æˆ·æ³¨å†ŒæˆåŠŸäº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">userEvents</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;user-registered&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  sendWelcomeEmail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">detail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”¨æˆ·æ³¨å†Œå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> registerUser</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">userData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾è¿™é‡Œæ˜¯ç”¨æˆ·æ³¨å†Œé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;User registered:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è§¦å‘ç”¨æˆ·æ³¨å†ŒæˆåŠŸäº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  userEvents</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;user-registered&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;user-registered&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">detail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">userData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€æ¬¢è¿é‚®ä»¶çš„å‡è®¾å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sendWelcomeEmail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Sending welcome email to </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¤ºèŒƒå¦‚ä½•æ³¨å†Œç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerUser</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;newuser@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>UserEventEmitter</code> æ¥å¤„ç†ç”¨æˆ·ç›¸å…³çš„äº‹ä»¶ã€‚å½“è°ƒç”¨ <code>registerUser</code> å‡½æ•°æ³¨å†Œç”¨æˆ·æˆåŠŸåï¼Œæˆ‘ä»¬è§¦å‘äº†ä¸€ä¸ª <code>user-registered</code> è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶é€šè¿‡ <code>detail</code> å‚æ•°ä¼ é€’äº†ç”¨æˆ·çš„é‚®ç®±åœ°å€ã€‚è€Œäº‹ä»¶ç›‘å¬å™¨åˆ™è´Ÿè´£è°ƒç”¨å‘é€æ¬¢è¿é‚®ä»¶çš„é€»è¾‘ã€‚</p><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p><code>CustomEvent</code> åœ¨ Node.js ä¸­çš„å¼•å…¥ä¸ºåç«¯å¼€å‘æä¾›äº†æ›´å¤šçµæ´»æ€§å’Œå¯èƒ½æ€§ï¼Œä½¿å¾—äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å¼æ›´åŠ å¼ºå¤§ã€‚é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶çš„åˆ›å»ºã€è§¦å‘å’Œç›‘å¬ï¼Œå¼€å‘è€…å¯ä»¥ä»¥æ›´è§£è€¦çš„æ–¹å¼ç¼–å†™æ¨¡å—åŒ–ä»£ç ï¼Œå¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h2 id="class-decompressionstream" tabindex="-1"><a class="header-anchor" href="#class-decompressionstream"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-decompressionstream" target="_blank" rel="noopener noreferrer">Class: DecompressionStream</a></span></a></h2><p>Node.js ä¸­çš„<code>DecompressionStream</code>ç±»æ˜¯ä¸€ä¸ªç”¨äºè§£å‹æ•°æ®æµçš„å·¥å…·ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥å¸®åŠ©ä½ å°†å‹ç¼©è¿‡çš„æ•°æ®è¿˜åŸå›åŸå§‹å½¢å¼ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨å¤„ç†ç½‘ç»œä¼ è¾“ã€æ–‡ä»¶å­˜å‚¨ç­‰åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæ•°æ®å‹ç¼©å¯ä»¥æ˜¾è‘—å‡å°‘æ‰€éœ€çš„å­˜å‚¨ç©ºé—´å’Œä¼ è¾“æ—¶é—´ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å‹ç¼©ä¸è§£å‹" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å‹ç¼©ä¸è§£å‹"><span>ä»€ä¹ˆæ˜¯å‹ç¼©ä¸è§£å‹ï¼Ÿ</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œå‹ç¼©å°±æ˜¯é€šè¿‡æŸç§ç®—æ³•å‡å°æ–‡ä»¶æˆ–æ•°æ®çš„å¤§å°ï¼Œè€Œè§£å‹åˆ™æ˜¯æ¢å¤æ•°æ®åˆ°åŸå§‹çŠ¶æ€çš„è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼Œä½ ä¸‹è½½çš„.zip æ–‡ä»¶å°±æ˜¯å‹ç¼©åçš„ï¼Œéœ€è¦è§£å‹æ‰èƒ½å¾—åˆ°é‡Œé¢çš„å†…å®¹ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-decompressionstream" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-decompressionstream"><span>å¦‚ä½•ä½¿ç”¨ <code>DecompressionStream</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>DecompressionStream</code>ç±»é€šå¸¸ä¸æµ(Stream)ä¸€èµ·ä½¿ç”¨ï¼Œæµæ˜¯ä¸€ç§å¤„ç†å¤§é‡æ•°æ®çš„æœ‰æ•ˆæ–¹å¼ï¼Œå…è®¸ä½ ä»¥è¿ç»­çš„æ–¹å¼è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé€šè¿‡ gzip ç®—æ³•å‹ç¼©çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œ<code>example.gz</code>ï¼‰ï¼Œæˆ‘ä»¬æƒ³è¦è§£å‹è¿™ä¸ªæ–‡ä»¶å¹¶è¯»å–å…¶ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createDecompressionStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè¯»å–å‹ç¼©æ–‡ä»¶çš„æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> compressedStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè§£å‹ç¼©æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decompressionStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createDecompressionStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;gzip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå†™å…¥è§£å‹ç¼©æ•°æ®çš„æµï¼ˆä¾‹å¦‚è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> output</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬ç›´æ¥å°†è§£å‹åçš„å†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å‹ç¼©çš„æ•°æ®æµè¿æ¥åˆ°è§£å‹ç¼©æµï¼Œç„¶åè¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">compressedStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">decompressionStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">output</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡<code>fs.createReadStream</code>åˆ›å»ºäº†ä¸€ä¸ªè¯»å–è¢«å‹ç¼©æ–‡ä»¶<code>example.gz</code>çš„æµã€‚ç„¶åï¼Œæˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸€ä¸ª<code>DecompressionStream</code>ç”¨äºè§£å‹ gzip å‹ç¼©çš„æ•°æ®ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è§£å‹åçš„æ•°æ®æµå¯¼å‘è¾“å‡ºï¼ˆè¿™é‡Œæ˜¯æ§åˆ¶å°ï¼‰ã€‚å¦‚æœä½ æƒ³å°†è§£å‹åçš„æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ï¼Œåªéœ€å°†<code>output</code>æ”¹ä¸ºæŒ‡å‘ä¸€ä¸ªæ–‡ä»¶å†™å…¥æµå³å¯ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><p><strong>ç½‘ç»œä¼ è¾“ä¼˜åŒ–</strong>ï¼šå½“æˆ‘ä»¬éœ€è¦é€šè¿‡ç½‘ç»œå‘é€å¤§é‡æ•°æ®æ—¶ï¼Œä¾‹å¦‚ä¸€ä¸ªç½‘ç«™çš„é™æ€èµ„æºï¼ˆJS, CSS, å›¾ç‰‡ç­‰ï¼‰ï¼Œé€šå¸¸ä¼šå…ˆè¿›è¡Œå‹ç¼©ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯è¿›è¡Œè§£å‹ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘ä¼ è¾“æ‰€éœ€æ—¶é—´ã€‚</p></li><li><p><strong>æ—¥å¿—æ–‡ä»¶å¤„ç†</strong>ï¼šæœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ–‡ä»¶å¾€å¾€éå¸¸åºå¤§ï¼Œé€šè¿‡å‹ç¼©å­˜å‚¨å¯ä»¥èŠ‚çœç©ºé—´ã€‚å½“éœ€è¦åˆ†æè¿™äº›æ—¥å¿—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>DecompressionStream</code>æ¥å®æ—¶è§£å‹æ—¥å¿—æ–‡ä»¶ï¼Œè¿›è¡Œå¤„ç†æˆ–æŸ¥çœ‹ã€‚</p></li><li><p><strong>æ¸¸æˆèµ„æºç®¡ç†</strong>ï¼šåœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œèµ„æºå¦‚å›¾åƒã€å£°éŸ³æ–‡ä»¶ç­‰ï¼Œç»å¸¸è¢«å‹ç¼©ä»¥å‡å°‘ä¸‹è½½æ—¶é—´å’Œç£ç›˜ç©ºé—´å ç”¨ã€‚ä½¿ç”¨<code>DecompressionStream</code>å¯ä»¥åœ¨æ¸¸æˆè¿è¡Œæ—¶è§£å‹è¿™äº›èµ„æºï¼Œæ— éœ€é¢„å…ˆè§£å‹æ‰€æœ‰å†…å®¹ã€‚</p></li></ol><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹å‡º<code>DecompressionStream</code>ç±»åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­çš„é‡è¦æ€§åŠå…¶å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€‚ç†è§£å’ŒæŒæ¡å¦‚ä½•å¤„ç†å‹ç¼©å’Œè§£å‹ç¼©æ•°æ®æ˜¯è¿›è¡Œé«˜æ•ˆæ•°æ®å¤„ç†å’Œä¼˜åŒ–ä¼ è¾“çš„å…³é”®ã€‚</p><h2 id="event" tabindex="-1"><a class="header-anchor" href="#event"><span><a href="https://nodejs.org/docs/latest/api/globals.html#event" target="_blank" rel="noopener noreferrer">Event</a></span></a></h2><p>Node.js çš„ <code>Event</code> æ¨¡å—æ˜¯ä¸€ä¸ªå…è®¸ä½ åˆ›å»ºã€è§¦å‘å’Œç›‘å¬è‡ªå®šä¹‰äº‹ä»¶çš„æå…¶é‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ï¼Œè®©æˆ‘ä»¬ä»åŸºç¡€å¼€å§‹ï¼Œé€æ­¥æ·±å…¥ï¼Œå¹¶é€šè¿‡å®é™…çš„ä¾‹å­æ¥é˜è¿°å®ƒçš„ç”¨æ³•ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-node-js-ä¸­çš„-event" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-node-js-ä¸­çš„-event"><span>ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„ Eventï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šå†…ç½®å¯¹è±¡éƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚å¯èƒ½ä¼šå‘å‡ºäº‹ä»¶ï¼Œè¡¨ç¤ºæ•°æ®å·²æ¥æ”¶æˆ–è¿æ¥å·²å…³é—­ã€‚è¿™äº›äº‹ä»¶å¯ä»¥è¢« Node.js ä¸­çš„ä»»ä½•å…¶ä»–å¯¹è±¡&quot;ç›‘å¬&quot;ï¼ˆä¹Ÿå°±æ˜¯ç­‰å¾…å¹¶å“åº”ï¼‰ã€‚è¿™ç§æ¨¡å¼éå¸¸é€‚åˆå¤„ç†å¼‚æ­¥æ“ä½œï¼Œå¹¶åœ¨æ•´ä¸ª Node.js ç”Ÿæ€ç³»ç»Ÿä¸­å¹¿æ³›ä½¿ç”¨ã€‚</p><h3 id="event-æ¨¡å—çš„åŸºæœ¬ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#event-æ¨¡å—çš„åŸºæœ¬ç»„ä»¶"><span>Event æ¨¡å—çš„åŸºæœ¬ç»„ä»¶</span></a></h3><ol><li><p><strong>EventsEmitter</strong>: è¿™æ˜¯ Node.js ä¸­æ‰€æœ‰èƒ½è§¦å‘äº‹ä»¶çš„å¯¹è±¡çš„åŸºç¡€ã€‚å®ƒæä¾›äº†è§¦å‘äº‹ä»¶(<code>emit</code>)å’Œç›‘å¬äº‹ä»¶(<code>on</code>)çš„æ–¹æ³•ã€‚</p></li><li><p><strong>Event listeners</strong>: è¿™äº›æ˜¯ç»‘å®šåˆ°ç‰¹å®šäº‹ä»¶ä¸Šçš„å‡½æ•°ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè¿™äº›å‡½æ•°å°†è¢«æ‰§è¡Œã€‚</p></li></ol><h3 id="å¦‚ä½•ä½¿ç”¨-3" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-3"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>å‡è®¾æˆ‘ä»¬è¦å»ºç«‹ä¸€ä¸ªç®€å•çš„äº‹ä»¶ç³»ç»Ÿï¼Œæ¯å½“æ–°ç”¨æˆ·æ³¨å†Œæ—¶å‘é€æ¬¢è¿é‚®ä»¶ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Node.js çš„ <code>EventEmitter</code> ç±»æ¥å®ç°ï¼š</p><h4 id="æ­¥éª¤-1-å¯¼å…¥-events-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-å¯¼å…¥-events-æ¨¡å—"><span>æ­¥éª¤ 1: å¯¼å…¥ <code>events</code> æ¨¡å—</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-åˆ›å»ºä¸€ä¸ª-eventemitter-å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-åˆ›å»ºä¸€ä¸ª-eventemitter-å®ä¾‹"><span>æ­¥éª¤ 2: åˆ›å»ºä¸€ä¸ª EventEmitter å®ä¾‹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-3-ç›‘å¬äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-ç›‘å¬äº‹ä»¶"><span>æ­¥éª¤ 3: ç›‘å¬äº‹ä»¶</span></a></h4><p>åœ¨å‘é€é‚®ä»¶å‰ï¼Œæˆ‘ä»¬éœ€è¦&quot;ç›‘å¬&quot;æ³¨å†Œäº‹ä»¶ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªå‡½æ•°ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶è¿è¡Œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;userRegistered&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Sending welcome email to </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨è¿™é‡Œæ·»åŠ å‘é€é‚®ä»¶çš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-4-è§¦å‘äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-4-è§¦å‘äº‹ä»¶"><span>æ­¥éª¤ 4: è§¦å‘äº‹ä»¶</span></a></h4><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ç›‘å¬å™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·æ³¨å†Œæ—¶è§¦å‘<code>userRegistered</code>äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;userRegistered&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;user@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä¸Šé¢çš„ä»£ç è¿è¡Œæ—¶ï¼Œå®ƒä¼šè¾“å‡ºï¼š&quot;Sending welcome email to <a href="mailto:user@example.com" target="_blank" rel="noopener noreferrer">user@example.com</a>&quot;ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-1"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>Web æœåŠ¡å™¨</strong>ï¼šåœ¨ Node.js ä¸­ï¼ŒHTTP æœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚æ—¶å‘å‡ºäº‹ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡ç›‘å¬è¿™äº›äº‹ä»¶æ¥å“åº”ä¸åŒçš„ HTTP è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;request&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬äº†æœåŠ¡å™¨çš„<code>request</code>äº‹ä»¶ï¼Œç„¶åå‘é€å›ä¸€æ¡æ¶ˆæ¯ã€‚</p></li><li><p><strong>æ–‡ä»¶æ“ä½œ</strong>ï¼šæ–‡ä»¶ç³»ç»Ÿï¼ˆfsï¼‰æ¨¡å—å…è®¸ä½ å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚è¿™äº›æ“ä½œå¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”å‘å‡ºäº‹ä»¶ï¼Œæ¯”å¦‚å®Œæˆè¯»å–æ–‡ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> WithTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  execute</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;begin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;execute&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    asyncFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">timeEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;execute&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> withTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> WithTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">withTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;begin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;About to execute&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">withTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Done with execute&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">withTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰è‡ªå®šä¹‰äº‹ä»¶ï¼ˆå¦‚<code>begin</code>, <code>data</code>, <code>end</code>ï¼‰çš„ç±»<code>WithTime</code>ï¼Œä»¥ç›‘æ§æ–‡ä»¶è¯»å–æ“ä½œçš„ä¸åŒé˜¶æ®µã€‚</p></li></ol><p>Node.js çš„äº‹ä»¶ç³»ç»Ÿæ˜¯æ„å»ºé«˜æ•ˆã€å¯æ‰©å±•ç½‘ç»œåº”ç”¨çš„æ ¸å¿ƒã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒå¦‚ä½•ä½¿å¾—ç®¡ç†å’Œå“åº”å¼‚æ­¥æ“ä½œå˜å¾—ç®€å•ã€‚</p><h2 id="eventtarget" tabindex="-1"><a class="header-anchor" href="#eventtarget"><span><a href="https://nodejs.org/docs/latest/api/globals.html#eventtarget" target="_blank" rel="noopener noreferrer">EventTarget</a></span></a></h2><p>Node.js ä¸­çš„<code>EventTarget</code>æ˜¯ä¸€ä¸ªéå¸¸é‡è¦ä¸”åŸºç¡€çš„æ¦‚å¿µï¼Œç›´æ¥å…³è”åˆ°äº† Node.js å¼ºå¤§çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>EventTarget</code>ç»§ç»­è¢«æ”¯æŒå’Œç»´æŠ¤ï¼Œç¡®ä¿å¼€å‘è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥åˆ›å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£<code>EventTarget</code>ï¼Œæˆ‘ä»¬å°†ä»å®ƒçš„åŸºæœ¬æ¦‚å¿µè¯´èµ·ï¼Œå¹¶é€šè¿‡å®é™…çš„ä¾‹å­æ¥å±•ç¤ºå…¶ç”¨æ³•ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œ<code>EventTarget</code>æ˜¯ä¸€ä¸ªå¯ä»¥æ‹¥æœ‰ç›‘å¬å™¨ï¼ˆListenersï¼‰çš„å¯¹è±¡ï¼Œè¿™äº›ç›‘å¬å™¨ç”¨äºç›‘å¬å’Œå“åº”ä¸åŒç±»å‹çš„â€œäº‹ä»¶â€ï¼ˆEventsï¼‰ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šæ ¸å¿ƒå¯¹è±¡éƒ½æ˜¯<code>EventTarget</code>çš„å®ä¾‹ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨ï¼ˆhttp.Serverï¼‰ï¼Œæ–‡ä»¶æµï¼ˆfs.ReadStreamï¼‰ç­‰ã€‚</p><p>äº‹ä»¶æœ¬èº«å¯ä»¥è§†ä¸ºä¸€ä¸ªç‰¹å®šçš„ä¿¡å·ï¼Œè¡¨ç¤ºæŸç§äº‹æƒ…å·²ç»å‘ç”Ÿã€‚ä¾‹å¦‚ï¼Œåœ¨ HTTP æœåŠ¡å™¨ä¸Šï¼Œæ¯å½“æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚</p><h3 id="ä½¿ç”¨eventtarget" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨eventtarget"><span>ä½¿ç”¨<code>EventTarget</code></span></a></h3><p>ä½¿ç”¨<code>EventTarget</code>çš„åŸºæœ¬æ­¥éª¤åŒ…æ‹¬ï¼š</p><ol><li><strong>åˆ›å»º</strong>ä¸€ä¸ª<code>EventTarget</code>çš„å®ä¾‹æˆ–è·å–ä¸€ä¸ªå·²ç»å­˜åœ¨çš„<code>EventTarget</code>çš„å®ä¾‹ã€‚</li><li><strong>æ·»åŠ </strong>äº‹ä»¶ç›‘å¬å™¨ï¼Œä»¥ä¾¿å½“ç‰¹å®šçš„äº‹ä»¶å‘ç”Ÿæ—¶èƒ½å¤Ÿæ‰§è¡Œä¸€äº›æ“ä½œã€‚</li><li><strong>è§¦å‘</strong>äº‹ä»¶ï¼Œè¿™é€šå¸¸ç”± Node.js å†…éƒ¨å¤„ç†ï¼Œä½†ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ã€‚</li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-http-æœåŠ¡å™¨"><span>ä¾‹å­ 1ï¼šHTTP æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTP server</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;listening&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;listening&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is listening on port 8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬8080ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚æˆ‘ä»¬ä½¿ç”¨<code>server.on()</code>æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨å…³æ³¨çš„æ˜¯æœåŠ¡å™¨å¼€å§‹ç›‘å¬ç«¯å£æ—¶è§¦å‘çš„<code>listening</code>äº‹ä»¶ã€‚å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ§åˆ¶å°å°†è¾“å‡ºä¸€æ¡æ¶ˆæ¯è¡¨æ˜æœåŠ¡å™¨å·²ç»å‡†å¤‡å¥½æ¥å—è¿æ¥äº†ã€‚</p><h4 id="ä¾‹å­-2-è‡ªå®šä¹‰äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è‡ªå®šä¹‰äº‹ä»¶"><span>ä¾‹å­ 2ï¼šè‡ªå®šä¹‰äº‹ä»¶</span></a></h4><p>é™¤äº†å†…ç½®çš„äº‹ä»¶å¤–ï¼ŒNode.js è¿˜å…è®¸ä½ åˆ›å»ºå¹¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">EventTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª EventTarget å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myTarget</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EventTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬ &#39;myEvent&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myEvent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Handled: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¹¶è§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myEvent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dispatchEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º &quot;Handled: myEvent&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>EventTarget</code>å®ä¾‹ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨æ¥å¤„ç†è‡ªå®šä¹‰çš„<code>myEvent</code>äº‹ä»¶ã€‚éšåï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>myEvent</code>äº‹ä»¶å¹¶é€šè¿‡è°ƒç”¨<code>dispatchEvent</code>æ–¹æ³•æ¥è§¦å‘å®ƒï¼Œå¯¼è‡´æˆ‘ä»¬çš„ç›‘å¬å™¨å‡½æ•°è¢«æ‰§è¡Œã€‚</p><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>EventTarget</code>åœ¨ Node.js ä¸­å¦‚ä½•ç”¨æ¥å¤„ç†å„ç§äº‹ä»¶ï¼Œæ— è®ºæ˜¯ç³»ç»Ÿäº‹ä»¶è¿˜æ˜¯è‡ªå®šä¹‰äº‹ä»¶ã€‚è¿™ç§åŸºäºäº‹ä»¶çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ˜¯ Node.js éå¸¸å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œä½¿å¾— Node.js éå¸¸é€‚åˆå¤„ç† I/O å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚ç½‘ç»œæœåŠ¡å™¨ã€å®æ—¶é€šè®¯ç­‰ã€‚</p><h2 id="exports" tabindex="-1"><a class="header-anchor" href="#exports"><span><a href="https://nodejs.org/docs/latest/api/globals.html#exports" target="_blank" rel="noopener noreferrer">exports</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œ<code>exports</code> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºå¯ä»¥è¢«å…¶ä»–æ–‡ä»¶ï¼ˆæ¨¡å—ï¼‰ä½¿ç”¨çš„ä»£ç ã€‚æ¯ä¸ª Node.js æ–‡ä»¶éƒ½è¢«è§†ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œé€šè¿‡ <code>exports</code> å…³é”®å­—ï¼Œä½ å¯ä»¥å°†å‡½æ•°ã€å¯¹è±¡æˆ–å˜é‡ä»ä¸€ä¸ªæ¨¡å—è¾“å‡ºï¼Œä½¿å¾—å…¶ä»–æ¨¡å—èƒ½å¤Ÿé€šè¿‡ <code>require</code> å‡½æ•°å¼•å…¥å¹¶ä½¿ç”¨è¿™äº›å¯¼å‡ºçš„ä»£ç ã€‚</p><p>å½“ä½ åˆ›å»ºä¸€ä¸ª Node.js æ¨¡å—æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæœ‰ä¸€ä¸ªç©ºçš„ <code>exports</code> å¯¹è±¡ã€‚ä½ å¯ä»¥ç»™è¿™ä¸ªå¯¹è±¡æ·»åŠ å±æ€§ï¼Œè¿™äº›å±æ€§å°±æ˜¯ä½ æƒ³è¦æš´éœ²ç»™å…¶ä»–æ¨¡å—çš„éƒ¨åˆ†ã€‚</p><h3 id="ç¤ºä¾‹-1-å¯¼å‡ºå•ä¸ªåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å¯¼å‡ºå•ä¸ªåŠŸèƒ½"><span>ç¤ºä¾‹ 1ï¼šå¯¼å‡ºå•ä¸ªåŠŸèƒ½</span></a></h3><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>math.js</code> çš„æ–‡ä»¶ï¼Œæä¾›äº†ä¸€äº›æ•°å­¦ç›¸å…³çš„å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// math.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®šä¹‰ä¸¤ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯¼å‡ºå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">subtract</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ä½ å¯ä»¥åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥mathæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> math</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./math&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨mathæ¨¡å—çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> difference</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š15</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">difference</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-2-å¯¼å‡ºæ•´ä¸ªå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¯¼å‡ºæ•´ä¸ªå¯¹è±¡"><span>ç¤ºä¾‹ 2ï¼šå¯¼å‡ºæ•´ä¸ªå¯¹è±¡</span></a></h3><p>å¦‚æœä½ æƒ³ä¸€æ¬¡æ€§å¯¼å‡ºå¤šä¸ªåŠŸèƒ½æˆ–å€¼ï¼Œä½ å¯ä»¥ç›´æ¥å¯¹ <code>module.exports</code> è¿›è¡Œèµ‹å€¼ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// greetings.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªé—®å€™è¯­çš„å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> greetings</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  hello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Hello, </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">!`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  goodbye</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Goodbye, </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">!`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›´æ¥å°†æ•´ä¸ªå¯¹è±¡å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> greetings</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ä¸Šé¢çš„æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥greetingsæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> greetings</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./greetings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨greetingsæ¨¡å—çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> greetingMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> greetings</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">hello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> farewellMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> greetings</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">goodbye</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Bob&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">greetingMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šHello, Alice!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">farewellMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šGoodbye, Bob!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-3-ç»„åˆä½¿ç”¨-exports-å’Œ-module-exports" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-ç»„åˆä½¿ç”¨-exports-å’Œ-module-exports"><span>ç¤ºä¾‹ 3ï¼šç»„åˆä½¿ç”¨ exports å’Œ module.exports</span></a></h3><p>è™½ç„¶é€šå¸¸æ¨èä½¿ç”¨å…¶ä¸­ä¸€ç§æ–¹å¼è¿›è¡Œå¯¼å‡ºï¼Œä½†ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªæ¨¡å—ä¸­æ··åˆä½¿ç”¨ <code>exports</code> å’Œ <code>module.exports</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// mixedExports.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ åˆ°exportså¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">simpleMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ›¿æ¢æ•´ä¸ªmodule.exportså¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  complexFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is a more complex function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºæœ€åä¸€è¡Œæ›¿æ¢äº†æ•´ä¸ª <code>module.exports</code> å¯¹è±¡ï¼Œæ‰€ä»¥ <code>simpleMessage</code> å°†ä¸ä¼šè¢«å¯¼å‡ºã€‚åªæœ‰ <code>complexFunction</code> å¯ç”¨äºå¼•å…¥æ­¤æ¨¡å—çš„å…¶ä»–æ–‡ä»¶ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>exports</code> æ˜¯ Node.js ä¸­å®ç°æ¨¡å—åŒ–çš„åŸºç¡€è®¾æ–½ä¹‹ä¸€ã€‚å®ƒå…è®¸å¼€å‘è€…ç¼–å†™å¯å¤ç”¨çš„ä»£ç ï¼Œå¹¶ç®¡ç†ä¾èµ–å…³ç³»ã€‚åœ¨ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œå…¶åŸºæœ¬æ¦‚å¿µå’Œç”¨é€”ä¸ä¹‹å‰çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚</p><h2 id="fetch" tabindex="-1"><a class="header-anchor" href="#fetch"><span><a href="https://nodejs.org/docs/latest/api/globals.html#fetch" target="_blank" rel="noopener noreferrer">fetch</a></span></a></h2><p>Node.js v21.7.1 å¼•å…¥çš„<code>fetch</code>åŠŸèƒ½æ˜¯åŸºäºå…¨çƒç½‘è”ç›Ÿï¼ˆW3Cï¼‰å’Œç½‘ç»œåº”ç”¨å¼€æ”¾æ ‡å‡†è”åˆä¼šï¼ˆWHATWGï¼‰å®šä¹‰çš„ Web æ ‡å‡†ã€‚è¿™æ„å‘³ç€ï¼ŒNode.js ç°æä¾›äº†ä¸€ä¸ªåŸç”Ÿçš„æ–¹å¼æ¥æ‰§è¡Œ HTTP(S)è¯·æ±‚ï¼Œè€Œä¸éœ€è¦ä¾èµ–å¤–éƒ¨åº“å¦‚<code>request</code>æˆ–<code>axios</code>ã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æƒ³å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œé€šå¸¸éœ€è¦å®‰è£…å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ã€‚ç°åœ¨ï¼Œé€šè¿‡<code>fetch</code> API çš„é›†æˆï¼ŒNode.js ä½¿å¾—å‘é€ç½‘ç»œè¯·æ±‚å˜å¾—æ›´åŠ ç®€å•å’Œç›´æ¥ã€‚</p><h3 id="fetch-çš„åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#fetch-çš„åŸºæœ¬ç”¨æ³•"><span><code>fetch</code> çš„åŸºæœ¬ç”¨æ³•</span></a></h3><p><code>fetch</code>å‡½æ•°å…è®¸ä½ å‘èµ·ç½‘ç»œè¯·æ±‚å¹¶è·å–å“åº”ã€‚å®ƒè¿”å›ä¸€ä¸ª Promiseï¼Œå› æ­¤ä½ å¯ä»¥ä½¿ç”¨<code>.then()</code>å’Œ<code>.catch()</code>æ–¹æ³•å¤„ç†æˆåŠŸçš„å“åº”æˆ–æ•è·é”™è¯¯ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å®é™…ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨<code>fetch</code>ã€‚</p><h4 id="ç¤ºä¾‹-1-è·å–æ–‡æœ¬æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è·å–æ–‡æœ¬æ•°æ®"><span>ç¤ºä¾‹ 1: è·å–æ–‡æœ¬æ•°æ®</span></a></h4><p>å‡è®¾æˆ‘ä»¬è¦ä»ä¸€ä¸ªåœ¨çº¿èµ„æºè·å–ä¸€äº›æ–‡æœ¬æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å“åº”ä½“è½¬æ¢ä¸ºæ–‡æœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetching data failed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-è·å–-json-æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è·å–-json-æ•°æ®"><span>ç¤ºä¾‹ 2: è·å– JSON æ•°æ®</span></a></h4><p>é€šå¸¸ API ä¼šè¿”å› JSON æ ¼å¼çš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯å¦‚ä½•å¤„ç†è¿™ç§ç±»å‹çš„å“åº”ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/items&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å“åº”ä½“è½¬æ¢ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetching JSON failed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-3-å‘é€å¸¦æœ‰æ•°æ®çš„-post-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-å‘é€å¸¦æœ‰æ•°æ®çš„-post-è¯·æ±‚"><span>ç¤ºä¾‹ 3: å‘é€å¸¦æœ‰æ•°æ®çš„ POST è¯·æ±‚</span></a></h4><p>å¦‚æœä½ éœ€è¦å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œæäº¤è¡¨å•ï¼‰ï¼Œå¯ä»¥å°†<code>method</code>, <code>headers</code>, å’Œ <code>body</code>é€‰é¡¹æ·»åŠ åˆ°<code>fetch</code>è°ƒç”¨ä¸­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/submit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;John&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    age</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error submitting data:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯å¤„ç†"><span>é”™è¯¯å¤„ç†</span></a></h3><p>ä½¿ç”¨<code>fetch</code>æ—¶ï¼Œæœ‰ä¸¤ç§ä¸»è¦ç±»å‹çš„é”™è¯¯éœ€è¦å¤„ç†ï¼šç½‘ç»œé”™è¯¯å’Œ HTTP é”™è¯¯çŠ¶æ€ï¼ˆä¾‹å¦‚ 404 æˆ– 500ï¼‰ã€‚<code>fetch</code>åªåœ¨é‡åˆ°ç½‘ç»œé”™è¯¯æ—¶ï¼ˆä¾‹å¦‚æ–­ç½‘ï¼‰æ‰ä¼šæ‹’ç»ï¼ˆrejectï¼‰Promiseã€‚å³ä½¿ HTTP å“åº”çŠ¶æ€è¡¨ç¤ºé”™è¯¯ï¼ˆå¦‚ 404 æˆ– 500ï¼‰ï¼Œ<code>fetch</code>ä¹Ÿä¼šè§£æå¹¶è¿”å› Promiseã€‚å› æ­¤ï¼Œæ£€æŸ¥å“åº”çš„<code>ok</code>å±æ€§æˆ–çŠ¶æ€ç æ˜¯å¾ˆé‡è¦çš„ï¼Œä»¥è¯†åˆ«è¿™ç±»é”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/might-not-exist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ok</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Network response was not ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;There has been a problem with your fetch operation:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šæ˜¯ Node.js ä¸­<code>fetch</code>çš„ä¸€äº›åŸºç¡€ç”¨æ³•ç¤ºä¾‹ã€‚æ­£å¦‚ä½ æ‰€è§ï¼Œ<code>fetch</code>æä¾›äº†ä¸€ç§æ ‡å‡†ä¸”æ˜“äºä½¿ç”¨çš„æ–¹å¼æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œå®ƒå°†åœ¨å¤„ç†å„ç§ web å¼€å‘ä»»åŠ¡æ—¶å¤§æœ‰è£¨ç›Šã€‚</p><h2 id="class-file" tabindex="-1"><a class="header-anchor" href="#class-file"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-file" target="_blank" rel="noopener noreferrer">Class: File</a></span></a></h2><p>Node.js v21.7.1 ä¸­çš„<code>File</code>ç±»æ˜¯ä¸€ä¸ªä»£è¡¨æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶çš„æŠ½è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•å’Œå±æ€§æ¥ä¸æ–‡ä»¶äº¤äº’ã€‚è¿™æ„å‘³ç€å½“ä½ åœ¨ç¼–å†™ Node.js ç¨‹åºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>File</code>ç±»æ¥è¯»å–ã€å†™å…¥æˆ–ä¿®æ”¹æ–‡ä»¶ç­‰æ“ä½œã€‚ä¸‹é¢æˆ‘å°†é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šè¿™ä¸ªç±»ï¼Œå¹¶ç»™å‡ºå‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p><p>é¦–å…ˆï¼Œäº†è§£ä¸€ç‚¹åŸºç¡€çŸ¥è¯†ï¼šNode.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚Node.js éå¸¸æ“…é•¿å¤„ç† I/O å¯†é›†å‹ä»»åŠ¡ï¼Œæ¯”å¦‚ç½‘ç»œé€šä¿¡ã€æ–‡ä»¶æ“ä½œç­‰ï¼Œæ­£å› ä¸ºæ­¤ï¼Œ<code>File</code>ç±»åœ¨ Node.js ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚</p><h3 id="fileç±»çš„å…³é”®æ–¹æ³•å’Œå±æ€§" tabindex="-1"><a class="header-anchor" href="#fileç±»çš„å…³é”®æ–¹æ³•å’Œå±æ€§"><span><code>File</code>ç±»çš„å…³é”®æ–¹æ³•å’Œå±æ€§</span></a></h3><ul><li><code>read()</code>å’Œ<code>write()</code>æ–¹æ³•ï¼šå…è®¸ä½ è¯»å–å’Œå†™å…¥æ–‡ä»¶å†…å®¹ã€‚</li><li><code>copy()</code>æ–¹æ³•ï¼šå¯ä»¥å¤åˆ¶æ–‡ä»¶ã€‚</li><li><code>move()</code>æ–¹æ³•ï¼šæ”¯æŒç§»åŠ¨æ–‡ä»¶åˆ°æ–°ä½ç½®ã€‚</li><li><code>delete()</code>æ–¹æ³•ï¼šç”¨äºåˆ é™¤æ–‡ä»¶ã€‚</li><li><code>path</code>å±æ€§ï¼šè¡¨ç¤ºæ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><code>size</code>å±æ€§ï¼šæ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚</li></ul><p>äº‹å®ä¸Šï¼Œåœ¨ Node.js çš„å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰ç›´æ¥æåˆ°ä¸€ä¸ªåä¸º<code>File</code>çš„ç±»ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡<code>fs</code>æ¨¡å—ï¼ˆæ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼‰æ¥è¿›è¡Œæ–‡ä»¶æ“ä½œã€‚<code>fs</code>æ¨¡å—æä¾›äº†ä¸€å¥—ç”¨äºæ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„ APIï¼ŒåŒ…æ‹¬è¯»å–æ–‡ä»¶ã€å†™å…¥æ–‡ä»¶ã€ä¿®æ”¹æ–‡ä»¶æƒé™ç­‰åŠŸèƒ½ã€‚ä½†ä¸ºäº†æœ¬æ¬¡è§£é‡Šçš„éœ€è¦ï¼Œæˆ‘ä»¬å‡è®¾å­˜åœ¨ä¸€ä¸ª<code>File</code>ç±»ï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹æ³•çš„ä¸€äº›ç¤ºä¾‹ã€‚</p><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹</span></a></h3><h4 id="è¯»å–æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#è¯»å–æ–‡ä»¶å†…å®¹"><span>è¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŒæ­¥è¯»å–æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å†™å…¥æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#å†™å…¥æ–‡ä»¶å†…å®¹"><span>å†™å…¥æ–‡ä»¶å†…å®¹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> content</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼‚æ­¥å†™å…¥æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File has been written&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŒæ­¥å†™å…¥æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File has been written&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¤åˆ¶æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶æ–‡ä»¶"><span>å¤åˆ¶æ–‡ä»¶</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼‚æ­¥å¤åˆ¶æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">copyFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File copied successfully&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­è¿›è¡ŒåŸºæœ¬çš„æ–‡ä»¶æ“ä½œã€‚è™½ç„¶ç›´æ¥ä½¿ç”¨<code>File</code>ç±»çš„æè¿°åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾ä¸åˆ°ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡<code>fs</code>æ¨¡å—ï¼ˆæ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼‰æ¥æ‰§è¡Œæ‰€æœ‰è¿™äº›æ–‡ä»¶æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯å¤„ç†æ–‡ä»¶æœ€å¸¸è§çš„æ–¹å¼ä¹‹ä¸€ã€‚</p><p>å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Node.js ä¸­å¦‚ä½•è¿›è¡Œæ–‡ä»¶æ“ä½œã€‚éšç€ä½ é€æ¸æ·±å…¥å­¦ä¹ ï¼Œä½ ä¼šå‘ç°è¿˜æœ‰æ›´å¤šé«˜çº§ç‰¹æ€§å’ŒæŠ€å·§ç­‰å¾…ç€ä½ å»æ¢ç´¢ã€‚</p><h2 id="class-formdata" tabindex="-1"><a class="header-anchor" href="#class-formdata"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-formdata" target="_blank" rel="noopener noreferrer">Class FormData</a></span></a></h2><p>ç†è§£ Node.js ä¸­çš„<code>FormData</code>ç±»å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢å…¥æ‰‹ï¼šé¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯<code>FormData</code>ï¼Œå…¶æ¬¡æ¢è®¨å®ƒåœ¨å®é™…åº”ç”¨ä¸­çš„å‡ ä¸ªä¾‹å­ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-formdata" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-formdata"><span>ä»€ä¹ˆæ˜¯ FormDataï¼Ÿ</span></a></h3><p><code>FormData</code>ç±»æ˜¯ç”¨äºæ„é€ ä¸€ç»„é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹ä»£è¡¨è¡¨å•å­—æ®µå’Œå®ƒä»¬çš„å€¼ï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œå‘é€ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒé‡Œï¼Œå®ƒç»å¸¸ç”¨æ¥åœ¨å‰ç«¯ä¸åç«¯ä¹‹é—´ä¼ é€è¡¨å•æ•°æ®ã€‚è€Œåœ¨ Node.js ä¸­ï¼Œ<code>FormData</code>çš„æ¦‚å¿µè¢«å¼•è¿›æ¥ï¼Œå…è®¸æœåŠ¡å™¨ç«¯ä»£ç ä¹Ÿèƒ½æ„å»ºå’Œæ“ä½œç±»ä¼¼è¡¨å•çš„æ•°æ®ï¼Œå¹¶å‘é€ HTTP è¯·æ±‚ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨"><span>1. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ éœ€è¦é€šè¿‡ Node.js ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>FormData</code>æ¥æ„å»ºè¯·æ±‚ä½“ï¼Œé™„ä¸Šæ–‡ä»¶æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> FormData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;form-data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> axios</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;axios&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨axiosåº“æ¥å‘é€HTTPè¯·æ±‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªFormDataå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> form</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> FormData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ æ–‡ä»¶åˆ°è¡¨å•æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åç«¯æ¥æ”¶çš„key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./photo.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€POSTè¯·æ±‚ä¸Šä¼ æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">axios</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/upload&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">      ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä¸Šä¼ å¤±è´¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä½¿ç”¨<code>fs.createReadStream</code>æ¥è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œç„¶åé€šè¿‡<code>form.append</code>æ–¹æ³•æŠŠæ–‡ä»¶æ·»åŠ åˆ°<code>FormData</code>å¯¹è±¡ä¸­ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®æ­£ç¡®çš„è¯·æ±‚å¤´ï¼Œ<code>form.getHeaders()</code>æ–¹æ³•å¸®åŠ©æˆ‘ä»¬è·å–äº†æ­£ç¡®çš„<code>Content-Type</code>ï¼ŒåŒ…æ‹¬è¾¹ç•Œå­—ç¬¦ä¸²ã€‚</p><h4 id="_2-æäº¤è¡¨å•æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2-æäº¤è¡¨å•æ•°æ®"><span>2. æäº¤è¡¨å•æ•°æ®</span></a></h4><p>å‡å®šä½ æƒ³é€šè¿‡ Node.js å‘æŸä¸ª API æäº¤ä¸€ä»½è¡¨å•ï¼ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> FormData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;form-data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> axios</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;axios&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºFormDataå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> form</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> FormData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘è¡¨å•ä¸­æ·»åŠ å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JohnDoe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">axios</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/api/submit-form&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">      ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¡¨å•æäº¤æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¡¨å•æäº¤å¤±è´¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>FormData</code>å¯¹è±¡ï¼Œå¹¶é€šè¿‡<code>append</code>æ–¹æ³•æ·»åŠ äº†ä¸¤ä¸ªå­—æ®µï¼šç”¨æˆ·åå’Œå¹´é¾„ã€‚ç„¶åï¼Œä½¿ç”¨<code>axios</code>åº“å‘é€äº†ä¸€ä¸ª POST è¯·æ±‚ï¼Œå°†è¡¨å•æ•°æ®æäº¤åˆ°æŒ‡å®šçš„ URLã€‚</p><h4 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h4><p><code>FormData</code>ç±»åœ¨ Node.js ä¸­æ˜¯å¤„ç†è¡¨å•æ•°æ®ã€æ–‡ä»¶ä¸Šä¼ ç­‰åœºæ™¯çš„æœ‰åŠ›å·¥å…·ã€‚é€šè¿‡æ„é€ <code>FormData</code>å¯¹è±¡å¹¶åˆ©ç”¨ç°æœ‰çš„ HTTP å®¢æˆ·ç«¯åº“ï¼ˆå¦‚<code>axios</code>ï¼‰ï¼Œä½ å¯ä»¥è½»æ¾åœ°å‘é€å¤æ‚çš„ POST è¯·æ±‚ï¼Œä»¥æ»¡è¶³å„ç§å¼€å‘éœ€æ±‚ã€‚</p><h2 id="global" tabindex="-1"><a class="header-anchor" href="#global"><span><a href="https://nodejs.org/docs/latest/api/globals.html#global" target="_blank" rel="noopener noreferrer">global</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡ŒäºæœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®© JavaScript ä¹Ÿèƒ½å¼€å‘åç«¯ç¨‹åºã€å‘½ä»¤è¡Œå·¥å…·ç­‰ï¼Œè€Œä¸ä»…é™äºåœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€äº›å…¨å±€å¯¹è±¡å’Œå˜é‡æ˜¯éšå¤„å¯ç”¨çš„ï¼Œä½ ä¸éœ€è¦é€šè¿‡<code>require</code>æˆ–è€…<code>import</code>æ¥å¼•å…¥å®ƒä»¬ã€‚è¿™äº›å°±æ˜¯æ‰€è°“çš„å…¨å±€ï¼ˆglobalï¼‰å¯¹è±¡ã€‚</p><h3 id="global-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#global-å¯¹è±¡"><span>Global å¯¹è±¡</span></a></h3><p>åœ¨ Node.js é‡Œï¼Œæœ€é¡¶å±‚çš„ä½œç”¨åŸŸä¸æ˜¯å…¨å±€ï¼ˆglobalï¼‰ï¼Œä¸åœ¨æµè§ˆå™¨ä¸­çš„ JavaScript ä¸åŒã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œé¡¶å±‚ä½œç”¨åŸŸæ˜¯å…¨å±€ä½œç”¨åŸŸã€‚è¿™æ„å‘³ç€åœ¨æµè§ˆå™¨ä¸­å£°æ˜çš„å˜é‡ï¼ˆä¸ä½¿ç”¨<code>var</code>, <code>let</code>, æˆ– <code>const</code>ï¼‰å°†ä¼šæˆä¸ºå…¨å±€å˜é‡ã€‚ä½†åœ¨ Node.js ä¸­ï¼Œæ¨¡å—æ–‡ä»¶å†…éƒ¨çš„é¡¶å±‚ä½œç”¨åŸŸå®é™…ä¸Šæ˜¯è¯¥æ¨¡å—æœ¬èº«ï¼Œå› æ­¤å®šä¹‰çš„å˜é‡å±äºæ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚</p><p>ç„¶è€Œï¼ŒNode.js æä¾›äº†ä¸€ä¸ª<code>global</code>å…³é”®å­—ï¼Œå®ƒç±»ä¼¼äºæµè§ˆå™¨ç¯å¢ƒä¸­çš„<code>window</code>å¯¹è±¡ã€‚é€šè¿‡<code>global</code>å¯¹è±¡ï¼Œå¯ä»¥è®¿é—®åˆ°æ‰€æœ‰çš„å…¨å±€å˜é‡ï¼Œå³é‚£äº›ä¸éœ€è¦ä½¿ç”¨ä»»ä½•ç‰¹å®šæ¨¡å—å°±èƒ½å¤Ÿä½¿ç”¨çš„å˜é‡ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="_1-å…¨å±€å˜é‡" tabindex="-1"><a class="header-anchor" href="#_1-å…¨å±€å˜é‡"><span>1. å…¨å±€å˜é‡</span></a></h4><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>global</code>å¯¹è±¡æ¥å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè¿™æ ·åœ¨å…¶ä»–çš„ä»»ä½•æ¨¡å—ä¸­éƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå˜é‡ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨module1.jsä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myGlobalVar</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç„¶ååœ¨module2.jsä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myGlobalVar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Hello, world</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-å†…ç½®æ¨¡å—å’Œå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_2-å†…ç½®æ¨¡å—å’Œå‡½æ•°"><span>2. å†…ç½®æ¨¡å—å’Œå‡½æ•°</span></a></h4><p><code>global</code>å¯¹è±¡è¿˜åŒ…å«äº†å¾ˆå¤šå†…ç½®çš„å±æ€§å’Œå‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p><ul><li><code>console</code>: ç”¨äºè¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯ã€‚</li><li><code>setTimeout()</code>, <code>clearTimeout()</code>, <code>setInterval()</code>, <code>clearInterval()</code>: ç”¨äºå¤„ç†æ—¶é—´ç›¸å…³çš„æ“ä½œã€‚</li></ul><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>setTimeout()</code>å‡½æ•°æ¥åœ¨æŒ‡å®šçš„å»¶è¿Ÿåæ‰§è¡Œä»£ç ï¼Œè€Œè¿™ä¸ªå‡½æ•°å°±æ˜¯<code>global</code>å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This message is shown after 3 seconds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-globalthis" tabindex="-1"><a class="header-anchor" href="#_3-globalthis"><span>3. globalThis</span></a></h4><p>ä» Node.js v12 å¼€å§‹å¼•å…¥äº†<code>globalThis</code>å…³é”®å­—ï¼Œæä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥è·å–å…¨å±€å¯¹è±¡ï¼Œæ— è®ºä»£ç æ˜¯åœ¨ä»€ä¹ˆç¯å¢ƒä¸‹æ‰§è¡Œçš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨<code>globalThis</code>æ¥ä»£æ›¿<code>global</code>ã€<code>window</code>ã€<code>self</code>ç­‰ï¼Œä»¥ä¾¿è·¨å¹³å°å…¼å®¹ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">globalThis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">setTimeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>global</code>å¯¹è±¡åœ¨ Node.js ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œä½¿å¾—å®šä¹‰å…¨å±€å˜é‡å’Œè®¿é—®å†…ç½®åŠŸèƒ½å˜å¾—å¯èƒ½ã€‚åŒæ—¶ï¼Œé€šè¿‡å¼•å…¥<code>globalThis</code>ï¼ŒNode.js åœ¨ä¿ƒè¿›è·¨ç¯å¢ƒä»£ç å…±äº«æ–¹é¢ä¹Ÿåšå‡ºäº†åŠªåŠ›ã€‚</p><h2 id="class-headers" tabindex="-1"><a class="header-anchor" href="#class-headers"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-headers" target="_blank" rel="noopener noreferrer">Class Headers</a></span></a></h2><p>Node.js ä¸­çš„ <code>Headers</code> ç±»æ˜¯ç”¨äºå¤„ç† HTTP è¯·æ±‚å’Œå“åº”å¤´çš„ä¸€ä¸ªå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè®©ä½ èƒ½å¤Ÿæ–¹ä¾¿åœ°æ“ä½œè¿™äº›å¤´ä¿¡æ¯ã€‚ç†è§£ <code>Headers</code> ç±»å¯ä»¥å¸®åŠ©ä½ åœ¨æ„å»ºç½‘ç»œåº”ç”¨æ—¶æ›´ç²¾ç»†åœ°æ§åˆ¶æ•°æ®äº¤æ¢è¿‡ç¨‹ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨ HTTP åè®®ä¸­ï¼Œå¤´éƒ¨ï¼ˆHeadersï¼‰æ‰¿è½½ç€å…³é”®çš„ä¿¡æ¯ï¼Œå¦‚å®¢æˆ·ç«¯æ”¯æŒçš„å†…å®¹ç±»å‹ã€æœåŠ¡å™¨å‘é€çš„å†…å®¹ç±»å‹ã€è¯·æ±‚èº«ä»½éªŒè¯ä¿¡æ¯ç­‰ã€‚å½“æµè§ˆå™¨ï¼ˆæˆ–å…¶ä»–å®¢æˆ·ç«¯ï¼‰å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶ï¼Œä¼šé™„å¸¦è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰ï¼ŒæœåŠ¡å™¨å“åº”æ—¶åŒæ ·ä¼šå¸¦æœ‰å“åº”å¤´ï¼ˆResponse Headersï¼‰ã€‚</p><h3 id="headers-ç±»çš„æ ¸å¿ƒåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#headers-ç±»çš„æ ¸å¿ƒåŠŸèƒ½"><span><code>Headers</code> ç±»çš„æ ¸å¿ƒåŠŸèƒ½</span></a></h3><ul><li><strong>æ·»åŠ ã€è·å–ã€åˆ é™¤å¤´ä¿¡æ¯</strong>ï¼šä½ å¯ä»¥è½»æ¾åœ°ä¸ºè¯·æ±‚æˆ–å“åº”æ·»åŠ æ–°çš„å¤´ä¿¡æ¯ï¼Œæ£€ç´¢å·²å­˜åœ¨çš„å¤´ä¿¡æ¯ï¼Œæˆ–åˆ é™¤ä¸éœ€è¦çš„å¤´ä¿¡æ¯ã€‚</li><li><strong>è¿­ä»£å¤´ä¿¡æ¯</strong>ï¼š<code>Headers</code> ç±»æä¾›äº†æ–¹æ³•ï¼Œä½¿å¾—éå†æ‰€æœ‰å¤´ä¿¡æ¯å˜å¾—ç®€å•ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦å‘å¦ä¸€ä¸ªæœåŠ¡å‘é€ API è¯·æ±‚ï¼Œå¹¶ä¸”ä½ éœ€è¦åœ¨è¿™ä¸ªè¯·æ±‚ä¸­åŒ…å«ä¸€äº›ç‰¹å®šçš„å¤´ä¿¡æ¯ï¼Œæ¯”å¦‚<code>Content-Type</code>ï¼ˆå†…å®¹ç±»å‹ï¼‰å’Œ<code>Authorization</code>ï¼ˆæˆæƒä¿¡æ¯ï¼‰ã€‚</p><h4 id="ç¤ºä¾‹ä¸€-åˆ›å»ºå¹¶å‘é€å¸¦æœ‰è‡ªå®šä¹‰å¤´çš„-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä¸€-åˆ›å»ºå¹¶å‘é€å¸¦æœ‰è‡ªå®šä¹‰å¤´çš„-http-è¯·æ±‚"><span>ç¤ºä¾‹ä¸€ï¼šåˆ›å»ºå¹¶å‘é€å¸¦æœ‰è‡ªå®šä¹‰å¤´çš„ HTTP è¯·æ±‚</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½¿ç”¨node-fetchåº“è¿›è¡ŒHTTPè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Bearer your_token_here&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>append</code>æ–¹æ³•ç»™è¯·æ±‚æ·»åŠ äº†ä¸¤ä¸ªå¤´ä¿¡æ¯ï¼š<code>Content-Type</code>å’Œ<code>Authorization</code>ã€‚è¿™è¡¨æ˜æˆ‘ä»¬å°†ä»¥ JSON æ ¼å¼å‘é€è¯·æ±‚çš„ä¸»ä½“å†…å®¹ï¼Œå¹¶ä¸”è¯·æ±‚å·²ç»è¢«é€‚å½“åœ°æˆæƒã€‚</p><h4 id="ç¤ºä¾‹äºŒ-å¤„ç†æ¥æ”¶åˆ°çš„å“åº”å¤´" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹äºŒ-å¤„ç†æ¥æ”¶åˆ°çš„å“åº”å¤´"><span>ç¤ºä¾‹äºŒï¼šå¤„ç†æ¥æ”¶åˆ°çš„å“åº”å¤´</span></a></h4><p>å½“ä½ ä»æœåŠ¡å™¨æ¥æ”¶å“åº”æ—¶ï¼Œå¯èƒ½éœ€è¦è¯»å–æŸäº›å“åº”å¤´ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥å†…å®¹ç±»å‹æˆ–è€…åˆ†é¡µä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è·å–å¹¶æ‰“å°å†…å®¹ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€é¡µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> linkHeader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Link&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">linkHeader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> linkHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;rel=&quot;next&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœ‰ä¸‹ä¸€é¡µæ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¤„ç†å“åº”æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>get</code>æ–¹æ³•æ¥è·å–ç‰¹å®šçš„å¤´ä¿¡æ¯ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†å†…å®¹ç±»å‹ï¼Œä¹ŸæŸ¥çœ‹äº†<code>Link</code>å¤´æ¥åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤šçš„é¡µé¢æ•°æ®å¯ä¾›è¯·æ±‚ã€‚</p><h3 id="æ€»ç»“-7" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-7"><span>æ€»ç»“</span></a></h3><p><code>Headers</code> ç±»æ˜¯å¤„ç† HTTP å¤´éƒ¨ä¿¡æ¯çš„å¼ºå¤§å·¥å…·ï¼Œæ— è®ºæ˜¯åœ¨å‘é€è¯·æ±‚è¿˜æ˜¯æ¥æ”¶å“åº”æ—¶ã€‚é€šè¿‡å…¶æä¾›çš„æ–¹æ³•ï¼Œä½ å¯ä»¥çµæ´»åœ°è®¾ç½®ã€è·å–å’Œæ“ä½œå¤´ä¿¡æ¯ï¼Œä»¥æ»¡è¶³ä½ çš„ç½‘ç»œé€šä¿¡éœ€æ±‚ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†åˆ©ç”¨å¤´ä¿¡æ¯å¯ä»¥å¸®åŠ©ä½ æ„å»ºæ›´é«˜æ•ˆã€æ›´å®‰å…¨çš„ç½‘ç»œåº”ç”¨ã€‚</p><h2 id="messagechannel" tabindex="-1"><a class="header-anchor" href="#messagechannel"><span><a href="https://nodejs.org/docs/latest/api/globals.html#messagechannel" target="_blank" rel="noopener noreferrer">MessageChannel</a></span></a></h2><p>Node.js çš„<code>MessageChannel</code>æ˜¯ä¸€ç§ APIï¼Œå®ƒå…è®¸ä¸åŒçš„ JavaScript ç¯å¢ƒï¼ˆæ¯”å¦‚ä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´ï¼‰è¿›è¡Œç®€å•çš„é€šä¿¡ã€‚åœ¨è§£é‡Š<code>MessageChannel</code>å‰ï¼Œä½ éœ€è¦ç†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ol><li><p><strong>Node.js ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼ˆWorker Threadsï¼‰</strong>ï¼šNode.js å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œè¿™å¯¹äºæ‰§è¡Œè€—æ—¶æ“ä½œéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å¼‚æ­¥æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p></li><li><p><strong>ä¸»çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹çš„é€šä¿¡é—®é¢˜</strong>ï¼šè™½ç„¶å·¥ä½œçº¿ç¨‹èƒ½å¤Ÿæå‡åº”ç”¨çš„æ€§èƒ½ï¼Œä½†å®ƒå¼•å…¥äº†çº¿ç¨‹é—´é€šä¿¡çš„å¤æ‚æ€§ã€‚ä¸¤ä¸ªçº¿ç¨‹éœ€è¦èƒ½å¤Ÿå®‰å…¨ã€é«˜æ•ˆåœ°äº¤æ¢ä¿¡æ¯ã€‚</p></li></ol><p>è¿™å°±æ˜¯<code>MessageChannel</code>æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚å®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ä¸¤ä¸ª JavaScript ç¯å¢ƒé€šè¿‡ä¼ é€’æ¶ˆæ¯è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸æ˜¯å…±äº«å†…å­˜ï¼Œè¿™æ ·åšæ›´å®‰å…¨ã€æ›´ç®€å•ã€‚</p><h3 id="messagechannelçš„ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#messagechannelçš„ç»„æˆ"><span><code>MessageChannel</code>çš„ç»„æˆ</span></a></h3><p><code>MessageChannel</code>åŒ…å«ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p><ol><li><p><strong>ç«¯å£ï¼ˆPortsï¼‰</strong>ï¼šæ¯ä¸ª<code>MessageChannel</code>æœ‰ä¸¤ä¸ªç«¯å£ï¼ˆ<code>port1</code>å’Œ<code>port2</code>ï¼‰ï¼Œè¿™ä¸¤ä¸ªç«¯å£ç›¸äº’è¿æ¥ï¼Œå…è®¸æ•°æ®ä»ä¸€ä¸ªç«¯å£å‘é€åˆ°å¦ä¸€ä¸ªç«¯å£ã€‚</p></li><li><p><strong>æ¶ˆæ¯äº‹ä»¶ï¼ˆMessage eventsï¼‰</strong>ï¼šå½“ä¸€ä¸ªç«¯å£æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œå¯ä»¥åœ¨è¿™ä¸ªäº‹ä»¶çš„å¤„ç†ç¨‹åºä¸­è¯»å–æ¶ˆæ¯æ•°æ®ã€‚</p></li></ol><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œæ¯”å¦‚ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‰ N é¡¹ï¼Œæˆ‘ä»¬ä¸æƒ³åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šé€ æˆåº”ç”¨å“åº”ç¼“æ…¢ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨<code>MessageChannel</code>ä¸ä¸»çº¿ç¨‹é€šä¿¡ã€‚</p><h4 id="æ­¥éª¤-1-åˆ›å»ºå·¥ä½œçº¿ç¨‹æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-åˆ›å»ºå·¥ä½œçº¿ç¨‹æ–‡ä»¶"><span>æ­¥éª¤ 1ï¼šåˆ›å»ºå·¥ä½œçº¿ç¨‹æ–‡ä»¶</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// fibonacciWorker.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;worker_threads&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> generateFibonacci</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> fib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        fib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> fib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> fib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> fib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateFibonacci</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨messagechannelä¸å·¥ä½œçº¿ç¨‹é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨messagechannelä¸å·¥ä½œçº¿ç¨‹é€šä¿¡"><span>æ­¥éª¤ 2ï¼šåœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨<code>MessageChannel</code>ä¸å·¥ä½œçº¿ç¨‹é€šä¿¡</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">MessageChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªMessageChannel</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">port1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">port2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå·¥ä½œçº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./fibonacciWorker.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨port2ä¸å·¥ä½œçº¿ç¨‹é€šä¿¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, [</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ä»å·¥ä½œçº¿ç¨‹å‘æ¥çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">port1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°ç”Ÿæˆçš„æ–æ³¢é‚£å¥‘æ•°åˆ—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€æ¶ˆæ¯ç»™å·¥ä½œçº¿ç¨‹ï¼Œè¯·æ±‚ç”Ÿæˆå‰10é¡¹æ–æ³¢é‚£å¥‘æ•°åˆ—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">port1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œå¹¶é€šè¿‡<code>MessageChannel</code>çš„ä¸¤ä¸ªç«¯å£åœ¨ä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ä¸»çº¿ç¨‹é€šè¿‡<code>port1</code>å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™å·¥ä½œçº¿ç¨‹ï¼ˆæŒ‡å®šè¦ç”Ÿæˆçš„é¡¹æ•°ï¼‰ï¼Œå·¥ä½œçº¿ç¨‹æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ï¼Œå®Œæˆè®¡ç®—åï¼Œå†é€šè¿‡<code>port2</code>å›å‘æ¶ˆæ¯ç»™ä¸»çº¿ç¨‹ã€‚è¿™æ ·æ—¢é¿å…äº†ä¸»çº¿ç¨‹é˜»å¡ï¼Œåˆå®ç°äº†å®‰å…¨æœ‰æ•ˆçš„çº¿ç¨‹é—´é€šä¿¡ã€‚</p><h2 id="messageevent" tabindex="-1"><a class="header-anchor" href="#messageevent"><span><a href="https://nodejs.org/docs/latest/api/globals.html#messageevent" target="_blank" rel="noopener noreferrer">MessageEvent</a></span></a></h2><p>Node.js çš„ <code>MessageEvent</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js ä¸­ç”¨æ¥è¡¨ç¤ºä¿¡æ¯ä¼ é€’äº‹ä»¶çš„å¯¹è±¡ã€‚è¿™ç±»äº‹ä»¶é€šå¸¸åœ¨ä½¿ç”¨å¦‚ Worker çº¿ç¨‹æˆ–è€…å…¶ä»–çš„å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨çš„æ¥å£æ—¶å‘ç”Ÿï¼Œæ¯”å¦‚ WebSocketsã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>MessageEvent</code> ä¸»è¦ä¸è¿™æ ·çš„åœºæ™¯ç›¸å…³è”ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-2"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>MessageEvent</code>ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒæ˜¯å½“ä¸€ä¸ªæ¶ˆæ¯è¢«å‘é€åˆ°æŸä¸ªå¯¹è±¡ï¼ˆæ¯”å¦‚ Worker çº¿ç¨‹ã€WebSocketï¼‰æ—¶æ‰€è§¦å‘çš„äº‹ä»¶çš„è¡¨ç¤ºã€‚è¿™ä¸ªäº‹ä»¶å¯¹è±¡åŒ…å«äº†å…³äºæ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚æ¶ˆæ¯çš„å†…å®¹ä»¥åŠå¯èƒ½çš„å…¶ä»–å…ƒæ•°æ®ã€‚</p><h3 id="ä¸»è¦å±æ€§" tabindex="-1"><a class="header-anchor" href="#ä¸»è¦å±æ€§"><span>ä¸»è¦å±æ€§</span></a></h3><ul><li><code>data</code>ï¼šå®ƒåŒ…å«äº†å®é™…å‘é€çš„æ¶ˆæ¯ã€‚è¿™å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€Bufferã€ArrayBuffer æˆ–å…¶ä»–æ ¼å¼çš„æ•°æ®ã€‚</li><li><code>type</code>ï¼šäº‹ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸º &quot;message&quot;ã€‚</li><li><code>origin</code>ï¼šå‘é€æ¶ˆæ¯çš„æºçš„æ ‡è¯†ç¬¦ï¼Œä½†åœ¨ Node.js ä¸­è¿™ä¸ªå±æ€§å¯èƒ½ä¸å¸¸ç”¨ã€‚</li><li><code>lastEventId</code>ï¼šå’Œ <code>origin</code> ç±»ä¼¼ï¼Œè¿™ä¸ªå±æ€§åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹æ›´å¸¸è§ï¼Œç”¨äºæ ‡è¯†äº‹ä»¶çš„å”¯ä¸€ IDã€‚</li></ul><h3 id="å®ä¾‹åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åº”ç”¨"><span>å®ä¾‹åº”ç”¨</span></a></h3><h4 id="ä½¿ç”¨-worker-çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-worker-çº¿ç¨‹"><span>ä½¿ç”¨ Worker çº¿ç¨‹</span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>MessageEvent</code> æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ä¹‹ä¸€å°±æ˜¯è·¨ Worker çº¿ç¨‹çš„é€šä¿¡ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤„ç† CPU å¯†é›†å‹ä»»åŠ¡çš„åœºæ™¯ï¼Œä½ å¯èƒ½ä¼šæƒ³æŠŠè¿™äº›ä»»åŠ¡æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">isMainThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">isMainThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸»çº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ”¶åˆ°æ¥è‡ª Worker çš„æ¶ˆæ¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, Worker!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // Worker çº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ”¶åˆ°æ¥è‡ªä¸»çº¿ç¨‹çš„æ¶ˆæ¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å·²æ”¶åˆ°ï¼šâ€œ</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">â€`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸»çº¿ç¨‹åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Worker çº¿ç¨‹ï¼Œå¹¶é€šè¿‡ <code>postMessage</code> å‘é€æ¶ˆæ¯ã€‚Worker çº¿ç¨‹æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šå“åº”å¹¶å°†å¦ä¸€ä¸ªæ¶ˆæ¯å‘é€å›ä¸»çº¿ç¨‹ã€‚æ³¨æ„ï¼Œæ¯æ¬¡æ¶ˆæ¯äº¤æ¢å®é™…ä¸Šæ¶‰åŠåˆ°äº† <code>MessageEvent</code> å¯¹è±¡ï¼Œå®ƒé€šè¿‡ <code>event.data</code> å±æ€§æºå¸¦æ¶ˆæ¯å†…å®¹ã€‚</p><h4 id="ä½¿ç”¨-websocket" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-websocket"><span>ä½¿ç”¨ WebSocket</span></a></h4><p>å¦ä¸€ä¸ª <code>MessageEvent</code> çš„åº”ç”¨ç¤ºä¾‹æ˜¯åœ¨å®ç°åŸºäº WebSocket çš„å®æ—¶é€šä¿¡æ—¶ã€‚WebSocket å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŒä¹…çš„è¿æ¥ï¼Œé€šè¿‡è¿™ä¸ªè¿æ¥åŒå‘ä¼ è¾“æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> WebSocket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ws&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wss</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> WebSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">wss</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> incoming</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯ï¼š </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello from server!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ <code>ws</code> åº“åˆ›å»ºäº†ä¸€ä¸ª WebSocket æœåŠ¡ï¼Œå¹¶ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚å½“æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯æ—¶ï¼Œ<code>message</code> äº‹ä»¶è¢«è§¦å‘ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶åˆ°ä¸€ä¸ª <code>MessageEvent</code> å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯å†…å®¹ã€‚</p><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p><code>MessageEvent</code> åœ¨ Node.js ä¸­æ˜¯å¤„ç†å„ç§æ¶ˆæ¯ä¼ é€’æœºåˆ¶çš„æ ¸å¿ƒã€‚æ— è®ºæ˜¯åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­è·¨çº¿ç¨‹é€šä¿¡ï¼Œè¿˜æ˜¯åœ¨æ„å»ºå®æ—¶ã€åŒå‘é€šä¿¡çš„ç½‘ç»œåº”ç”¨ç¨‹åºä¸­ï¼Œ<code>MessageEvent</code> éƒ½æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚é€šè¿‡å®ƒæä¾›çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¼€å‘è€…èƒ½å¤Ÿé«˜æ•ˆåœ°ç®¡ç†å’Œå¤„ç†æ¶ˆæ¯æ•°æ®ï¼Œä¸ºç”¨æˆ·å¸¦æ¥æ›´å¿«é€Ÿã€å¹³æ»‘çš„äº¤äº’ä½“éªŒã€‚</p><h2 id="messageport" tabindex="-1"><a class="header-anchor" href="#messageport"><span><a href="https://nodejs.org/docs/latest/api/globals.html#messageport" target="_blank" rel="noopener noreferrer">MessagePort</a></span></a></h2><p>Node.js ä¸­çš„ <code>MessagePort</code> æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸ä¸åŒçš„ JavaScript ç¯å¢ƒï¼ˆæˆ–ç§°ä¸ºçº¿ç¨‹ï¼‰ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡ã€‚æƒ³è±¡ä½ æœ‰ä¸¤ä¸ªå²›å±¿ï¼ˆçº¿ç¨‹ï¼‰ï¼Œè€Œ <code>MessagePort</code> å°±åƒæ˜¯è¿æ¥è¿™ä¸¤ä¸ªå²›å±¿çš„æ¡¥æ¢ï¼Œè®©å®ƒä»¬å¯ä»¥ç›¸äº’å‘é€ä¿¡æ¯ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-2"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œé€šå¸¸æƒ…å†µä¸‹ä»£ç æ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œæ„å‘³ç€ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä»¶äº‹ã€‚ç„¶è€Œï¼Œæœ‰äº›ä»»åŠ¡ç‰¹åˆ«è€—æ—¶ï¼Œæ¯”å¦‚è¯»å–å¤§æ–‡ä»¶ã€è¿›è¡Œå¤æ‚è®¡ç®—ç­‰ï¼Œè¿™ä¼šé˜»å¡çº¿ç¨‹ï¼Œå½±å“æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒNode.js å…è®¸å¼€å‘è€…åˆ›å»ºå¤šä¸ªçº¿ç¨‹æ¥å¹¶è¡Œå¤„ç†ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œä¸»çº¿ç¨‹å¦‚ä½•ä¸è¿™äº›æ–°çº¿ç¨‹æ²Ÿé€šå°±æˆäº†ä¸€ä¸ªé—®é¢˜ã€‚è¿™æ­£æ˜¯ <code>MessagePort</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><h3 id="å®é™…è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨"><span>å®é™…è¿ç”¨</span></a></h3><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ <code>MessagePort</code> çš„å®é™…è¿ç”¨ï¼š</p><ol><li><p><strong>èƒŒæ™¯ä»»åŠ¡å¤„ç†</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™åç«¯ï¼Œéœ€è¦ç”Ÿæˆä¸€ä»½å¤æ‚çš„æŠ¥å‘Šï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸è€—æ—¶ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†æŠ¥å‘Šç”Ÿæˆï¼ŒåŒæ—¶ä¸»çº¿ç¨‹ç»§ç»­å“åº”å…¶ä»–ç”¨æˆ·è¯·æ±‚ã€‚å½“æŠ¥å‘Šç”Ÿæˆå®Œæ¯•ï¼Œé€šè¿‡ <code>MessagePort</code> é€šçŸ¥ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹éšåå¯ä»¥å°†æŠ¥å‘Šå‘é€ç»™ç”¨æˆ·ã€‚</p></li><li><p><strong>Web Workers</strong>ï¼šè™½ç„¶ Web Workers æ˜¯ Web æµè§ˆå™¨çš„æ¦‚å¿µï¼Œä½†å®ƒå’Œ Node.js ä¸­çš„å¤šçº¿ç¨‹ä½¿ç”¨ <code>MessagePort</code> è¿›è¡Œé€šä¿¡çš„æ¦‚å¿µç›¸ä¼¼ã€‚åœ¨ä¸€ä¸ªå¤æ‚çš„å‰ç«¯åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦åœ¨åå°æ‰§è¡Œä¸€äº›æ•°æ®å¤„ç†ä»»åŠ¡ï¼Œè€Œä¸å¹²æ‰°ä¸»ç•Œé¢çš„å“åº”æ€§ã€‚é€šè¿‡ Web Workers å’Œ <code>MessagePort</code>ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œå¹¶å°†ç»“æœå‘é€å›ä¸»çº¿ç¨‹æ›´æ–° UIã€‚</p></li><li><p><strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šåœ¨ä¸€ä¸ªæ›´å¤§çš„ç³»ç»Ÿä¸­ï¼Œä½ å¯èƒ½ä¼šå°†åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªå°æœåŠ¡ï¼ˆå³å¾®æœåŠ¡ï¼‰ï¼Œå®ƒä»¬å„è‡ªå¤„ç†ä¸åŒçš„åŠŸèƒ½ã€‚å‡è®¾è¿™äº›æœåŠ¡éœ€è¦åœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œå¹¶ä¸”é¢‘ç¹äº¤æ¢æ•°æ®ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>MessagePort</code> åœ¨è¿™äº›æœåŠ¡ä¹‹é—´å»ºç«‹é€šä¿¡æ¸ é“ï¼Œè®©å®ƒä»¬èƒ½å¤Ÿé«˜æ•ˆåœ°äº¤æ¢æ¶ˆæ¯ã€‚</p></li></ol><h3 id="å¦‚ä½•ä½¿ç”¨-4" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-4"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>åœ¨ Node.js é‡Œä½¿ç”¨ <code>MessagePort</code> é€šå¸¸æ¶‰åŠåˆ° <code>worker_threads</code> æ¨¡å—ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">isMainThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">isMainThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸»çº¿ç¨‹é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ‰§è¡Œå½“å‰æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ”¶åˆ°: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬å·¥ä½œçº¿ç¨‹å‘æ¥çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä½ å¥½ï¼Œå·¥ä½œçº¿ç¨‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘å·¥ä½œçº¿ç¨‹å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å·¥ä½œçº¿ç¨‹é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å·¥ä½œçº¿ç¨‹æ”¶åˆ°æ¶ˆæ¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;å·¥ä½œçº¿ç¨‹å·²æ¥æ”¶&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å›å¤æ¶ˆæ¯ç»™ä¸»çº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸»çº¿ç¨‹åˆ›å»ºäº†ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¹¶é€šè¿‡ <code>postMessage()</code> æ–¹æ³•å‘å®ƒå‘é€äº†ä¸€æ¡æ¶ˆæ¯ã€‚å·¥ä½œçº¿ç¨‹æ¥æ”¶è¿™æ¡æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡ <code>postMessage()</code> æ–¹æ³•å›å¤ã€‚è¿™ä¸ªå¾€è¿”è¿‡ç¨‹å°±æ˜¯é€šè¿‡ <code>MessagePort</code> å®Œæˆçš„ã€‚</p><h3 id="æ€»ç»“-8" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-8"><span>æ€»ç»“</span></a></h3><p><code>MessagePort</code> æä¾›äº†ä¸€ç§å¼ºå¤§æ–¹å¼ï¼Œä½¿å¾—åœ¨ Node.js åº”ç”¨ä¸­ä¸åŒçº¿ç¨‹æˆ–ç¯å¢ƒé—´çš„åŒå‘é€šä¿¡å˜å¾—å¯èƒ½ã€‚æ— è®ºæ˜¯å¤„ç†è€—æ—¶çš„åå°ä»»åŠ¡ï¼Œè¿˜æ˜¯åœ¨å¤æ‚çš„ç³»ç»Ÿæ¶æ„ä¸­å®ç°å¾®æœåŠ¡é—´çš„é€šä¿¡ï¼Œ<code>MessagePort</code> éƒ½æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚</p><h2 id="module" tabindex="-1"><a class="header-anchor" href="#module"><span><a href="https://nodejs.org/docs/latest/api/globals.html#module" target="_blank" rel="noopener noreferrer">module</a></span></a></h2><p>Node.js ä¸­çš„ <code>module</code> æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå®ƒæŒ‡çš„æ˜¯ä¸€ä¸ªå¯ä»¥è¢«å…¶ä»–æ–‡ä»¶é‡ç”¨çš„ä»£ç å—ã€‚æ¯ä¸ª Node.js æ–‡ä»¶éƒ½è¢«è§†ä¸ºä¸€ä¸ªæ¨¡å—ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ª <code>.js</code> æ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶å†…éƒ¨ä¸ä»…ä»…åŒ…å«äº†ä½ å†™çš„ä»£ç ï¼Œè¿˜æœ‰ä¸€äº›éšè—çš„ç»“æ„ã€‚Node.js ä¼šä¸ºæ¯ä¸ªæ–‡ä»¶æä¾›ä¸€ä¸ª <code>module</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†å½“å‰æ–‡ä»¶æˆ–æ¨¡å—æœ¬èº«ã€‚è€Œé€šè¿‡ <code>module.exports</code> å±æ€§ï¼Œä½ å¯ä»¥å†³å®šå“ªäº›éƒ¨åˆ†å¯ä»¥è¢«å…¶ä»–æ¨¡å—è®¿é—®æˆ–ä½¿ç”¨ï¼Œå³å¯¼å‡ºæˆå‘˜ã€‚</p><h3 id="module-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#module-å¯¹è±¡"><span>module å¯¹è±¡</span></a></h3><p><code>module</code> å¯¹è±¡æ˜¯å½“å‰æ¨¡å—çš„ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®çš„å±æ€§ï¼š</p><ul><li><code>module.exports</code>ï¼šå®ƒæ˜¯å¯¹å¤–æš´éœ²æ¥å£çš„å¯¹è±¡ã€‚å¦‚æœä½ æƒ³è¦æŸä¸ªåŠŸèƒ½è¢«å…¶ä»–æ–‡ä»¶é‡ç”¨ï¼Œä½ å°±éœ€è¦å°†å…¶æ·»åŠ åˆ° <code>module.exports</code> ä¸­ã€‚</li><li><code>module.require</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå’Œå…¨å±€çš„ <code>require</code> å‡½æ•°ç±»ä¼¼ï¼Œç”¨äºå¯¼å…¥å…¶ä»–æ¨¡å—çš„å¯¼å‡ºå†…å®¹ã€‚</li><li><code>module.id</code>ï¼šå½“å‰æ¨¡å—çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li><li><code>module.filename</code>ï¼šå½“å‰æ¨¡å—çš„æ–‡ä»¶åï¼Œå¸¦æœ‰å®Œæ•´è·¯å¾„ã€‚</li><li><code>module.loaded</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ¨¡å—æ˜¯å¦å·²ç»åŠ è½½å®Œæˆã€‚</li><li><code>module.parent</code>ï¼šä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªè¦æ±‚è¯¥æ¨¡å—çš„æ¨¡å—ã€‚</li></ul><h3 id="ä½¿ç”¨-module-exports-å¯¼å‡ºæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-module-exports-å¯¼å‡ºæ¨¡å—"><span>ä½¿ç”¨ module.exports å¯¼å‡ºæ¨¡å—</span></a></h3><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>module.exports</code>ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>mathUtils.js</code> æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦å…±äº«ä¸€äº›æ•°å­¦ç›¸å…³çš„å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// mathUtils.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªå‡½æ•° <code>add</code> å’Œ <code>subtract</code>ï¼Œç„¶åæˆ‘ä»¬æŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ åˆ° <code>module.exports</code>ã€‚è¿™æ„å‘³ç€ä»»ä½•å¯¼å…¥ <code>mathUtils.js</code> çš„æ–‡ä»¶ç°åœ¨éƒ½å¯ä»¥è®¿é—®è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p><h3 id="ä»å…¶ä»–æ¨¡å—å¯¼å…¥" tabindex="-1"><a class="header-anchor" href="#ä»å…¶ä»–æ¨¡å—å¯¼å…¥"><span>ä»å…¶ä»–æ¨¡å—å¯¼å…¥</span></a></h3><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ <code>mathUtils.js</code> çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> mathUtils</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./mathUtils&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">mathUtils</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: 3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">mathUtils</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>app.js</code> ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å†…ç½®çš„ <code>require</code> å‡½æ•°æ¥åŠ è½½ <code>mathUtils.js</code> æ¨¡å—ã€‚Node.js è§£æ <code>mathUtils.js</code> æ–‡ä»¶å¹¶æ‰§è¡Œå®ƒï¼Œç„¶åè¿”å› <code>module.exports</code> å¯¹è±¡ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>mathUtils</code> å˜é‡è®¿é—® <code>add</code> å’Œ <code>subtract</code> å‡½æ•°äº†ã€‚</p><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js æ”¯æŒæ¨¡å—åŒ–ç¼–ç¨‹ï¼Œä½¿å¾—ä»£ç ç»„ç»‡æ›´åŠ æ¸…æ™°ï¼Œä¾¿äºç®¡ç†ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½å°è£…äº†ç‰¹å®šçš„é€»è¾‘ï¼Œé€šè¿‡ <code>module.exports</code> å’Œ <code>require()</code> æ–¹æ³•è¿›è¡Œäº¤äº’ï¼Œå½¢æˆäº†ä¸€ä¸ªç”±å¤šä¸ªå°æ¨¡å—æ„å»ºèµ·æ¥çš„å¤§å‹åº”ç”¨ç¨‹åºã€‚</p><h2 id="navigator" tabindex="-1"><a class="header-anchor" href="#navigator"><span><a href="https://nodejs.org/docs/latest/api/globals.html#navigator" target="_blank" rel="noopener noreferrer">Navigator</a></span></a></h2><p>ä»æˆ‘æ‰€äº†è§£çš„ä¿¡æ¯æ¥çœ‹ï¼Œæˆªè‡³ 2023 å¹´ 4 æœˆï¼ŒNode.js çš„å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰ç›´æ¥æåˆ° <code>Navigator</code> ä½œä¸º Node.js çš„ä¸€éƒ¨åˆ†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>Navigator</code> å¯¹è±¡æ˜¯ä¸ Web æµè§ˆå™¨ç›¸å…³çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç”¨äºåœ¨ JavaScript ä¸­è·å–ç”¨æˆ·æµè§ˆå™¨çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ Node.js çš„ç‰¹æ€§ã€‚è¿™å¯èƒ½å¯¼è‡´äº†ä¸€äº›æ··æ·†ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œä¸»è¦ç”¨äºæ„å»ºæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸æµè§ˆå™¨äº¤äº’ã€‚å› æ­¤ï¼ŒNode.js ä¸»è¦å…³æ³¨çš„æ˜¯å¦‚ä½•å¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œä»¥åŠä¸å…¶ä»–åå°æœåŠ¡çš„äº¤äº’ç­‰ã€‚</p><p>å°½ç®¡å¦‚æ­¤ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ä½ çš„é—®é¢˜èƒŒæ™¯ï¼Œå¹¶è¯•å›¾ä»ä¸¤ä¸ªè§’åº¦ç»™äºˆè§£é‡Šå’Œå®é™…ä½¿ç”¨ä¾‹å­ï¼š</p><h3 id="_1-å¦‚æœæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„-navigator" tabindex="-1"><a class="header-anchor" href="#_1-å¦‚æœæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„-navigator"><span>1. å¦‚æœæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„ <code>Navigator</code></span></a></h3><p>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œ<code>Navigator</code> å¯¹è±¡æä¾›äº†æœ‰å…³æµè§ˆå™¨çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç‰ˆæœ¬å·ã€å®‰è£…çš„æ’ä»¶ç­‰ã€‚è¿™å¯¹äºéœ€è¦æ ¹æ®ç”¨æˆ·æµè§ˆå™¨èƒ½åŠ›è°ƒæ•´è‡ªå·±åŠŸèƒ½çš„å‰ç«¯ Web åº”ç”¨éå¸¸æœ‰ç”¨ã€‚</p><p><strong>ä¾‹å­ï¼š</strong></p><ul><li><p><strong>æ£€æŸ¥æ˜¯å¦æ”¯æŒæŸä¸ªç‰¹æ€§</strong>ï¼šå¦‚æœä½ æƒ³æ£€æŸ¥ç”¨æˆ·çš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒåœ°ç†ä½ç½®æœåŠ¡ï¼ˆGeolocationï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;geolocation&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Geolocation is available&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">geolocation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCurrentPosition</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">position</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">position</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Geolocation is not available&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç”¨æˆ·ä»£ç†æ£€æµ‹</strong>ï¼šè·å–æµè§ˆå™¨çš„ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ï¼Œå¸®åŠ©åˆ¤æ–­ç”¨æˆ·æ­£åœ¨ä½¿ç”¨å“ªç§æµè§ˆå™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> userAgent</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_2-åœ¨-node-js-ä¸­ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#_2-åœ¨-node-js-ä¸­ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½"><span>2. åœ¨ Node.js ä¸­ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½</span></a></h3><p>è™½ç„¶ Node.js æœ¬èº«ä¸åŒ…æ‹¬ <code>Navigator</code> å¯¹è±¡ï¼Œä½†ä½ å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è·å–è¿è¡Œ Node.js åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨æˆ–ç¯å¢ƒçš„ä¿¡æ¯ã€‚</p><ul><li><p><strong>æ“ä½œç³»ç»Ÿä¿¡æ¯</strong>ï¼šä½¿ç”¨ Node.js çš„ <code>os</code> æ¨¡å—å¯ä»¥è·å–æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Operating system: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Free memory: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">freemem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Total memory: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">totalmem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;CPU details: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cpus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç¯å¢ƒå˜é‡è®¿é—®</strong>ï¼šä½ ä¹Ÿå¯ä»¥è®¿é—®ç¯å¢ƒå˜é‡ï¼Œè¿™åœ¨é…ç½®åº”ç”¨ç¨‹åºæ—¶å¾ˆæœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// The document is from Ying Chao Tea.Do not use for commercial purposes.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">NODE_ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Environment: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">NODE_ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>Navigator</code> æ›´å¤šåœ°ä¸æµè§ˆå™¨ç¯å¢ƒç›¸å…³ï¼Œè€Œ Node.js ä½œä¸ºæœåŠ¡å™¨ç«¯ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½é›†ä¸­åœ¨æœåŠ¡å™¨ç«¯æ“ä½œä¸Šã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£è¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ä»¥åŠå¦‚ä½•åœ¨å„è‡ªçš„é¢†åŸŸå†…åˆ©ç”¨å®ƒä»¬ã€‚</p><h2 id="navigator-1" tabindex="-1"><a class="header-anchor" href="#navigator-1"><span><a href="https://nodejs.org/docs/latest/api/globals.html#navigator_1" target="_blank" rel="noopener noreferrer">navigator</a></span></a></h2><p>Node.js v21.7.1 ä¸­çš„<code>navigator</code>å¯¹è±¡æ˜¯ä¸€é¡¹æ–°åŠ å…¥çš„å…¨å±€ APIï¼Œå®ƒæ¨¡æ‹Ÿäº†åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å¸¸è§çš„<code>navigator</code>å¯¹è±¡ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œ<code>navigator</code>å¯¹è±¡åŒ…å«æœ‰å…³ç”¨æˆ·çš„æµè§ˆå™¨ä¿¡æ¯ï¼Œæ¯”å¦‚ç‰ˆæœ¬ã€æ˜¯å¦å¯ç”¨ cookie ä»¥åŠæ“ä½œç³»ç»Ÿç­‰ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js è¿™æ ·çš„æœåŠ¡å™¨ç«¯ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¸éœ€è¦åƒåœ¨æµè§ˆå™¨é‚£æ ·å¤„ç†å®¢æˆ·ç«¯ç‰¹å®šçš„ä¿¡æ¯ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯èƒ½å¸Œæœ›è®©æœåŠ¡å™¨ç«¯ä»£ç èƒ½å¤Ÿå…¼å®¹æˆ–è€…æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œä¾‹å¦‚å½“ä»–ä»¬æ­£åœ¨ä½¿ç”¨ä¸€äº›æ—¢å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„åŒæ„ JavaScript ä»£ç æ—¶ã€‚</p><p>æˆªè‡³æˆ‘çŸ¥è¯†åº“æœ€åæ›´æ–°çš„æ—¶é—´ç‚¹ï¼Œæ­£å¼çš„ Node.js æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰æä¾›åä¸º<code>navigator</code>çš„å…¨å±€å¯¹è±¡ã€‚å› æ­¤ï¼Œä»¥ä¸‹å†…å®¹æ˜¯åŸºäºä½ æä¾›çš„é“¾æ¥å’Œå½“å‰å·²çŸ¥ä¿¡æ¯è¿›è¡Œæ¨æ–­çš„ï¼Œä¸ä»£è¡¨æœ€ç»ˆçš„å®˜æ–¹å®ç°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ Node.js ç¡®å®åŒ…å«äº†ä¸€ä¸ªç±»ä¼¼æµè§ˆå™¨ä¸­çš„<code>navigator</code>å…¨å±€å¯¹è±¡ï¼Œå®ƒå¯èƒ½ä¼šè¢«ç”¨æ¥æ£€æµ‹å½“å‰æ‰§è¡Œä»£ç çš„ Node.js ç‰ˆæœ¬ï¼Œå°±åƒåœ¨æµè§ˆå™¨ä¸­å¯ä»¥é€šè¿‡<code>navigator.userAgent</code>æ¥è·å–æµè§ˆå™¨çš„ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ä¸€æ ·ã€‚ä½†å®ƒåœ¨æœåŠ¡å™¨ç«¯çš„æ„ä¹‰å°†æ˜¾è‘—ä¸åŒï¼Œå› ä¸ºæœåŠ¡å™¨ä¸éœ€è¦é€‚é…ä¸åŒçš„ç”¨æˆ·æµè§ˆå™¨ç¯å¢ƒã€‚</p><p>å‡å®šåœ¨ Node.js 21.7.1 ä¸­å­˜åœ¨è¿™æ ·ä¸€ä¸ªå…¨å±€çš„<code>navigator</code>å¯¹è±¡ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ç±»ä¼¼ä¸‹é¢çš„ç”¨æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‰“å°å‡ºäº†<code>userAgent</code>å±æ€§çš„å€¼ï¼Œè¿™åœ¨æµè§ˆå™¨ä¸­é€šå¸¸åŒ…å«äº†æµè§ˆå™¨åç§°ã€ç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿç­‰ä¿¡æ¯ã€‚åœ¨ Node.js ä¸­ï¼Œè¿™å¯èƒ½ä¼šè¿”å›å…³äº Node.js è‡ªèº«ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæµè§ˆå™¨ã€‚</p><p>è¯·æ³¨æ„ï¼Œç”±äº Node.js ç¯å¢ƒä¸æµè§ˆå™¨ç¯å¢ƒå·®å¼‚å¾ˆå¤§ï¼Œå³ä½¿å¼•å…¥äº†<code>navigator</code>å¯¹è±¡ï¼Œå…¶åŠŸèƒ½å’Œå±æ€§ä¹Ÿå¯èƒ½éå¸¸æœ‰é™ï¼Œå¹¶ä¸”ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§è€ƒè™‘ï¼Œè€Œä¸æ˜¯å®é™…çš„ä¿¡æ¯æŸ¥è¯¢éœ€æ±‚ã€‚</p><p>å¦‚æœä½ éœ€è¦åœ¨ Node.js ä¸­è·å–å…³äºå½“å‰ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé€šå¸¸ä¼šä½¿ç”¨è¯¸å¦‚<code>process</code>å…¨å±€å¯¹è±¡ä¸­çš„æ–¹æ³•å’Œå±æ€§ï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°Node.jsç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">platform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°æ“ä½œç³»ç»Ÿå¹³å°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯å¯¹ Node.js ä¸­å‡è®¾å­˜åœ¨çš„<code>navigator</code>å…¨å±€å¯¹è±¡çš„è§£é‡Šã€‚å¦‚æœåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ç¡®å®å¼•å…¥äº†è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼Œå…·ä½“çš„åº”ç”¨å’Œå®ç°ç»†èŠ‚å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå»ºè®®æŸ¥é˜…å½“æ—¶çš„å®˜æ–¹æ–‡æ¡£ä»¥è·å–å‡†ç¡®ä¿¡æ¯ã€‚</p><h3 id="navigator-hardwareconcurrency" tabindex="-1"><a class="header-anchor" href="#navigator-hardwareconcurrency"><span><a href="https://nodejs.org/docs/latest/api/globals.html#navigatorhardwareconcurrency" target="_blank" rel="noopener noreferrer">navigator.hardwareConcurrency</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„ <code>navigator.hardwareConcurrency</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js ç¯å¢ƒä¸­è¾ƒæ–°åŠ å…¥çš„ç‰¹æ€§ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªå±æ€§å·²ç»å­˜åœ¨ä¸€æ®µæ—¶é—´äº†ï¼Œç”¨äºå±•ç¤ºç”¨æˆ·è®¾å¤‡ä¸Šå¯ç”¨çš„é€»è¾‘å¤„ç†å™¨æ ¸å¿ƒçš„æ•°é‡ã€‚è¿™é€šå¸¸è¢«ç”¨æ¥ç¡®å®šå¹¶å‘æ‰§è¡Œä»»åŠ¡çš„æœ€ä¼˜æ•°é‡ï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„èƒ½åŠ›ã€‚</p><p>åœ¨ Node.js ä¸­å¼•å…¥ <code>navigator.hardwareConcurrency</code> è¡¨æ˜äº†å¯¹äºè¿™ç§è·¨å¹³å°ä»£ç å…±äº«å’Œä¸€è‡´æ€§ä½“éªŒçš„é‡è§†ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒå…è®¸ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ£€æµ‹è¿è¡Œå®ƒçš„æœåŠ¡å™¨æˆ–è®¡ç®—æœºæœ‰å¤šå°‘é€»è¾‘å¤„ç†å™¨ï¼ˆCPU æ ¸å¿ƒï¼‰ã€‚é€šè¿‡äº†è§£å¯ç”¨çš„é€»è¾‘å¤„ç†å™¨æ•°é‡ï¼Œä½ å¯ä»¥ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠåˆ°éœ€è¦å¤§é‡è®¡ç®—èµ„æºçš„åœºæ™¯ä¸‹ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>å¹¶è¡Œå¤„ç†ä»»åŠ¡</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦å¤„ç†å¤§é‡çš„æ•°æ®åˆ†æä»»åŠ¡ã€‚å¦‚æœæ²¡æœ‰åˆç†åœ°ç®¡ç†ï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½ä¼šä¸²è¡Œæ‰§è¡Œï¼Œå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚é€šè¿‡ä½¿ç”¨ <code>navigator.hardwareConcurrency</code>ï¼Œä½ å¯ä»¥å¾—çŸ¥ç³»ç»Ÿçš„é€»è¾‘å¤„ç†å™¨æ•°é‡ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œå°†ä»»åŠ¡åˆ’åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼Œå¹¶è¡Œåœ°æ‰§è¡Œå®ƒä»¬ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> numCPUs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hardwareConcurrency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> numCPUs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åˆ›å»ºWorkerçº¿ç¨‹æˆ–å­è¿›ç¨‹å¤„ç†éƒ¨åˆ†ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å¤§å°</strong></p><p>åœ¨ä½¿ç”¨è¯¸å¦‚ Web æœåŠ¡å™¨ä¹‹ç±»çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å¯èƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± æ¥å¤„ç†å¹¶å‘è¯·æ±‚ã€‚é€šå¸¸ï¼Œçº¿ç¨‹æ± çš„å¤§å°ç›´æ¥å½±å“ç€åº”ç”¨ç¨‹åºå¤„ç†èƒ½åŠ›ã€‚é€šè¿‡<code>navigator.hardwareConcurrency</code>ï¼Œä½ å¯ä»¥åŠ¨æ€è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°ä¸ºé€»è¾‘å¤„ç†å™¨çš„æ•°é‡ï¼Œæˆ–è€…åŸºäºè¯¥å€¼çš„æŸä¸ªæ¯”ä¾‹ï¼Œä»¥æ­¤æ¥æœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> poolSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hardwareConcurrency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŸºäºpoolSizeåˆå§‹åŒ–çº¿ç¨‹æ± </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è´Ÿè½½å‡è¡¡</strong></p><p>åœ¨è¿›è¡Œé«˜æ€§èƒ½è®¡ç®—æˆ–è€…éœ€è¦é«˜å¹¶å‘å¤„ç†çš„æœåŠ¡ä¸­ï¼Œäº†è§£æœåŠ¡å™¨çš„ CPU æ ¸å¿ƒæ•°å¯ä»¥å¸®åŠ©å®ç°æ›´ä¼˜çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®ä¸åŒæœåŠ¡å™¨çš„<code>navigator.hardwareConcurrency</code>å€¼åˆ†é…ä¸åŒçš„ä»»åŠ¡é‡ï¼Œç¡®ä¿æ¯ä¸ªæœåŠ¡å™¨éƒ½åœ¨å…¶æœ€ä½³æ€§èƒ½èŒƒå›´å†…è¿è¡Œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ¹æ® navigator.hardwareConcurrency å€¼ï¼Œå†³å®šå°†å¤šå°‘ä»»åŠ¡åˆ†é…ç»™å½“å‰æœåŠ¡å™¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h3 id="æ³¨æ„äº‹é¡¹-2" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-2"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>è™½ç„¶äº†è§£é€»è¾‘å¤„ç†å™¨çš„æ•°é‡æ˜¯æœ‰ç›Šçš„ï¼Œä½†åœ¨è®¾è®¡å¹¶å‘ç­–ç•¥æ—¶è¿˜éœ€è¦è€ƒè™‘å…¶ä»–å› ç´ ï¼Œä¾‹å¦‚ï¼Œå•ä¸ªä»»åŠ¡çš„å†…å­˜éœ€æ±‚ã€I/O å¯†é›†å‹ä¸ CPU å¯†é›†å‹ä»»åŠ¡çš„åŒºåˆ«ç­‰ã€‚</li><li>è¿‡åº¦çš„å¹¶è¡Œå¯èƒ½ä¼šå¯¼è‡€èµ„æºç«äº‰ï¼Œåè€Œé™ä½ç¨‹åºæ€§èƒ½ã€‚å› æ­¤ï¼Œåˆç†çš„ä½¿ç”¨<code>navigator.hardwareConcurrency</code>æä¾›çš„ä¿¡æ¯è‡³å…³é‡è¦ã€‚</li></ul><p>æ€»ä¹‹ï¼Œ<code>navigator.hardwareConcurrency</code>ä¸º Node.js åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å’Œåˆ©ç”¨åº•å±‚ç¡¬ä»¶èµ„æºï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½å’Œèµ„æºä½¿ç”¨ã€‚</p><h3 id="navigator-language" tabindex="-1"><a class="header-anchor" href="#navigator-language"><span><a href="https://nodejs.org/docs/latest/api/globals.html#navigatorlanguage" target="_blank" rel="noopener noreferrer">navigator.language</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>navigator.language</code>å±æ€§å®é™…ä¸Šå¹¶ä¸ç›´æ¥å­˜åœ¨æˆ–è¢«æ”¯æŒï¼Œè¿™æ˜¯å› ä¸º<code>navigator</code>å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ Web APIs çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸å­˜åœ¨äºæµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œç”¨äºè·å–ç”¨æˆ·æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚è¯­è¨€åå¥½ã€ç‰ˆæœ¬å·ç­‰ã€‚Node.js æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä¸»è¦èšç„¦äºæœåŠ¡å™¨ç«¯æˆ–åå°åº”ç”¨å¼€å‘ï¼Œå¹¶ä¸åŒ…å«<code>navigator</code>å¯¹è±¡æˆ–ä¸ä¹‹ç›¸å…³çš„ Web APIã€‚</p><p>ä¸è¿‡ï¼Œä¸ºäº†è§£ç­”ä½ å…³äº<code>navigator.language</code>çš„å¥½å¥‡ï¼Œè®©æˆ‘ä»¬å…ˆæ¥äº†è§£å®ƒåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„ä½œç”¨ï¼Œç„¶åè®¨è®ºåœ¨ Node.js ç¯å¢ƒä¸‹å¦‚ä½•å¤„ç†ç›¸ä¼¼çš„éœ€æ±‚ã€‚</p><h3 id="åœ¨æµè§ˆå™¨ä¸­navigator-language" tabindex="-1"><a class="header-anchor" href="#åœ¨æµè§ˆå™¨ä¸­navigator-language"><span>åœ¨æµè§ˆå™¨ä¸­<code>navigator.language</code></span></a></h3><p>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œ<code>navigator.language</code>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç”¨æˆ·çš„é¦–é€‰è¯­è¨€ã€‚è¿™é€šå¸¸æ˜¯ç”¨æˆ·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­æŒ‡å®šçš„è¯­è¨€ï¼Œä¾‹å¦‚<code>en-US</code>ä»£è¡¨ç¾å›½è‹±è¯­ï¼Œ<code>zh-CN</code>ä»£è¡¨ä¸­å›½å¤§é™†åœ°åŒºçš„ç®€ä½“ä¸­æ–‡ã€‚</p><p><strong>ä¸¾ä¾‹</strong>ï¼š</p><ul><li>å¦‚æœä½ çš„ç½‘ç«™éœ€è¦æ ¹æ®ç”¨æˆ·çš„è¯­è¨€åå¥½æ˜¾ç¤ºä¸åŒè¯­è¨€çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨<code>navigator.language</code>æ¥è·å–ç”¨æˆ·çš„é¦–é€‰è¯­è¨€ï¼Œç„¶åæ®æ­¤æ˜¾ç¤ºç›¸åº”çš„é¡µé¢ç‰ˆæœ¬ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> userLanguage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">language</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userLanguage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// navigator.userLanguage æ˜¯ä¸ºäº†å…¼å®¹IEæµè§ˆå™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userLanguage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;zh-CN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ˜¾ç¤ºä¸­æ–‡å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userLanguage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;en-US&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ˜¾ç¤ºè‹±æ–‡å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åœ¨-node-js-ç¯å¢ƒä¸­å¤„ç†ç±»ä¼¼éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ç¯å¢ƒä¸­å¤„ç†ç±»ä¼¼éœ€æ±‚"><span>åœ¨ Node.js ç¯å¢ƒä¸­å¤„ç†ç±»ä¼¼éœ€æ±‚</span></a></h3><p>å°½ç®¡ Node.js æ²¡æœ‰<code>navigator</code>å¯¹è±¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è·å–ç”¨æˆ·çš„è¯­è¨€åå¥½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ã€‚HTTP è¯·æ±‚å¤´ä¸­æœ‰ä¸€ä¸ª<code>Accept-Language</code>å­—æ®µï¼Œå®ƒæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå³æ ‡æ˜å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰ä¼˜å…ˆæ¥æ”¶å“ªç§è¯­è¨€çš„å†…å®¹ã€‚</p><p><strong>ä¸¾ä¾‹</strong>ï¼š</p><p>å½“ä½ åœ¨ Node.js åº”ç”¨ä¸­åˆ›å»ºä¸€ä¸ª web æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥è¯»å–è¯·æ±‚å¤´<code>Accept-Language</code>æ¥å†³å®šå“åº”çš„è¯­è¨€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> language</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;accept-language&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾é»˜è®¤è¯­è¨€æ˜¯è‹±è¯­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> responseText</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">language</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zh-CN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      responseText</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä½ å¥½ï¼Œä¸–ç•Œï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">responseText</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://127.0.0.1:8080/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨æ£€æŸ¥ HTTP è¯·æ±‚çš„<code>Accept-Language</code>å¤´éƒ¨ï¼Œå¦‚æœå‘ç°ç”¨æˆ·åå¥½çš„è¯­è¨€æ˜¯ä¸­æ–‡ï¼ˆ<code>zh-CN</code>ï¼‰ï¼Œåˆ™ç”¨ä¸­æ–‡å“åº”ï¼›å¦åˆ™ï¼Œé»˜è®¤ç”¨è‹±è¯­å“åº”ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œå°½ç®¡ Node.js æœ¬èº«ä¸æ”¯æŒ<code>navigator.language</code>è¿™æ ·çš„æµè§ˆå™¨ä¸“æœ‰ APIï¼Œä½†ä½ ä»ç„¶å¯ä»¥é€šè¿‡åˆ†æ HTTP è¯·æ±‚ä¸­çš„<code>Accept-Language</code>å¤´éƒ¨ï¼Œåœ¨ Node.js åº”ç”¨ä¸­å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå³æ ¹æ®ç”¨æˆ·çš„è¯­è¨€åå¥½å®šåˆ¶å†…å®¹ã€‚</p><h3 id="navigator-languages" tabindex="-1"><a class="header-anchor" href="#navigator-languages"><span><a href="https://nodejs.org/docs/latest/api/globals.html#navigatorlanguages" target="_blank" rel="noopener noreferrer">navigator.languages</a></span></a></h3><p>Node.js ç‰ˆæœ¬ 21.7.1 ä¸­çš„ <code>navigator.languages</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªç›¸å¯¹æ–°å¼•å…¥çš„å…¨å±€å±æ€§ï¼Œå®ƒæ¨¡ä»¿äº†åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å­˜åœ¨çš„ <code>window.navigator.languages</code> å±æ€§ã€‚è¿™ä¸ªå±æ€§æ—¨åœ¨å¸®åŠ©å¼€å‘è€…è·å–ç”¨æˆ·çš„é¦–é€‰è¯­è¨€åˆ—è¡¨ï¼Œé€šå¸¸æŒ‰ç…§ç”¨æˆ·åå¥½çš„é¡ºåºæ’åˆ—ã€‚ç„¶è€Œï¼Œåœ¨ Node.js ç¯å¢ƒä¸­ï¼Œ<code>navigator.languages</code> çš„å¼•å…¥æ˜¯ä¸ºäº†å¢åŠ ä¸ Web å¹³å°çš„å…¼å®¹æ€§ï¼Œå¹¶éç›´æ¥åæ˜ æ“ä½œç³»ç»Ÿçš„è¯­è¨€è®¾ç½®ã€‚</p><h3 id="ç†è§£-navigator-languages" tabindex="-1"><a class="header-anchor" href="#ç†è§£-navigator-languages"><span>ç†è§£ <code>navigator.languages</code></span></a></h3><p>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œ<code>navigator.languages</code> è¿”å›çš„æ˜¯ç”¨æˆ·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­æŒ‡å®šçš„é¦–é€‰è¯­è¨€åˆ—è¡¨ï¼Œä¾‹å¦‚ <code>[&#39;en-US&#39;, &#39;fr&#39;, &#39;de&#39;]</code>ã€‚è¿™æœ‰åŠ©äºå¼€å‘è€…æä¾›æ›´åŠ ä¸ªæ€§åŒ–å’Œæœ¬åœ°åŒ–çš„ç½‘é¡µå†…å®¹ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>navigator.languages</code> çš„è®¾è®¡åˆè¡·ç±»ä¼¼ â€”â€” æä¾›ä¸€ä¸ªæ¥å£æ¥äº†è§£ç”¨æˆ·çš„è¯­è¨€åå¥½ï¼Œå°½ç®¡ Node.js æ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ç¯å¢ƒã€‚ä» Node.js v21.7.1 å¼€å§‹ï¼Œ<code>navigator.languages</code> è¢«å¼•å…¥ä½œä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºä¸æµè§ˆå™¨çš„ API å¯¹é½ï¼Œæé«˜ä»£ç çš„è·¨è¿è¡Œç¯å¢ƒå…¼å®¹æ€§ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-5" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-5"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>ä½¿ç”¨ <code>navigator.languages</code> å¾ˆç®€å•ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®è¿™ä¸ªå…¨å±€å˜é‡æ¥è·å–å½“å‰è®¾ç½®çš„è¯­è¨€åˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">languages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå¯èƒ½æ˜¯ [&#39;en-US&#39;, &#39;fr&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº Node.js ä¸»è¦è¿è¡ŒäºæœåŠ¡å™¨ç«¯ï¼Œ<code>navigator.languages</code> åœ¨ Node.js ä¸­çš„å€¼éœ€è¦ä½ åœ¨åº”ç”¨ç¨‹åºçš„æŸä¸ªåœ°æ–¹æ‰‹åŠ¨è®¾ç½®ï¼Œä»¥ä¾¿æ¨¡æ‹Ÿæˆ–ä¼ é€’å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰çš„é¦–é€‰è¯­è¨€ä¿¡æ¯ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-2"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>å›½é™…åŒ–ï¼ˆi18nï¼‰å¤„ç†</strong>ï¼šå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤šè¯­è¨€æ”¯æŒçš„ç½‘ç«™æˆ–åº”ç”¨ï¼Œä½¿ç”¨ <code>navigator.languages</code> å¯ä»¥å¸®åŠ©ä½ å†³å®šå‘ç”¨æˆ·å±•ç¤ºå“ªç§è¯­è¨€çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ç”¨æˆ·çš„è¯­è¨€åå¥½è‡ªåŠ¨é€‰æ‹©é‚®ä»¶æ¨¡æ¿çš„è¯­è¨€ã€‚</p></li><li><p><strong>æ—¥å¿—è®°å½•å’Œåˆ†æ</strong>ï¼šäº†è§£ä½¿ç”¨ä½ çš„åº”ç”¨çš„ç”¨æˆ·åå¥½å“ªäº›è¯­è¨€ï¼Œå¯ä»¥å¸®åŠ©ä½ è¿›è¡Œå¸‚åœºå®šä½å’Œå†…å®¹è§„åˆ’ã€‚é€šè¿‡è®°å½• <code>navigator.languages</code> çš„å€¼ï¼Œå¯ä»¥è·å–åˆ°è¿™ä¸€ä¿¡æ¯ã€‚</p></li><li><p><strong>å†…å®¹åå•†</strong>ï¼šåœ¨æœåŠ¡å™¨ç«¯ï¼Œæ ¹æ® <code>navigator.languages</code> æŒ‡å®šçš„ä¼˜å…ˆçº§é€‰æ‹©æœ€åˆé€‚çš„è¯­è¨€ç‰ˆæœ¬èµ„æºè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚é€‰æ‹©åˆé€‚çš„æœ¬åœ°åŒ–è§†é¢‘æˆ–æ–‡æ¡£ã€‚</p></li></ol><h3 id="æ³¨æ„äº‹é¡¹-3" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-3"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>åœ¨ Node.js ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>navigator.languages</code> å¯èƒ½æœªå®šä¹‰ï¼Œå› ä¸ºå®ƒä¾èµ–äºå¤–éƒ¨è¾“å…¥ï¼ˆä¾‹å¦‚ HTTP è¯·æ±‚å¤´ï¼‰æ¥æ¨¡æ‹Ÿæˆ–è®¾ç½®ã€‚</li><li>ç”±äº <code>navigator.languages</code> åœ¨ Node.js ä¸­æ˜¯ä¸€ä¸ªæ–°ç‰¹æ€§å¹¶ä¸”æ ‡è®°ä¸ºå®éªŒæ€§çš„ï¼Œå®ƒçš„è¡Œä¸ºåœ¨æœªæ¥ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šæœ‰æ‰€æ”¹å˜ã€‚å› æ­¤ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶åº”è°¨æ…å¹¶ä¿æŒå…³æ³¨ Node.js çš„æ›´æ–°ã€‚</li></ul><p>æ€»ç»“ï¼Œ<code>navigator.languages</code> åœ¨ Node.js ä¸­çš„å¼•å…¥ä¸ºæœåŠ¡å™¨ç«¯çš„åº”ç”¨æä¾›äº†æ›´å¤šä¸å®¢æˆ·ç«¯å…¼å®¹çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”ä¸ºå›½é™…åŒ–å’Œæœ¬åœ°åŒ–çš„å®ç°æä¾›äº†ä¾¿åˆ©ã€‚ç„¶è€Œï¼Œç”±äºå…¶å®éªŒæ€§è´¨å’Œä¸åŒäºæµè§ˆå™¨ç¯å¢ƒçš„å·¥ä½œæ–¹å¼ï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p><h3 id="navigator-platform" tabindex="-1"><a class="header-anchor" href="#navigator-platform"><span><a href="https://nodejs.org/docs/latest/api/globals.html#navigatorplatform" target="_blank" rel="noopener noreferrer">navigator.platform</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼€æºå’Œè·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œè¿™æ„å‘³ç€å¯ä»¥æ„å»ºæœåŠ¡å™¨ã€å·¥å…·æˆ–è€…ç”šè‡³æ˜¯å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œä½ æåˆ°çš„<code>navigator.platform</code>å®é™…ä¸Šå¹¶ä¸å±äº Node.js çš„éƒ¨åˆ†ï¼Œè€Œæ˜¯ Web APIs çš„ä¸€éƒ¨åˆ†ï¼Œç»å¸¸ç”¨äºæµè§ˆå™¨ä¸­çš„ JavaScript ç¯å¢ƒã€‚</p><p>ä¸è¿‡ï¼Œä¸ºäº†å¸®åŠ©ä½ ç†è§£<code>navigator.platform</code>åœ¨ç±»ä¼¼ç¯å¢ƒä¸­çš„ä½œç”¨ï¼ˆæ¯”å¦‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼‰ï¼Œä»¥åŠå¦‚ä½•åœ¨ Node.js ä¸­å¤„ç†ç›¸ä¼¼çš„éœ€æ±‚ï¼Œæˆ‘ä¼šè¯¦ç»†è§£é‡Šä¸‹ã€‚</p><h3 id="navigator-platformç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#navigator-platformç®€ä»‹"><span><code>navigator.platform</code>ç®€ä»‹</span></a></h3><p>åœ¨ Web å¼€å‘ä¸­ï¼Œ<code>navigator.platform</code>æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæµè§ˆå™¨æ‰€è¿è¡Œçš„æ“ä½œç³»ç»Ÿæˆ–å¹³å°çš„ä¿¡æ¯ã€‚å¼€å‘è€…ç»å¸¸åˆ©ç”¨è¿™ä¸ªå±æ€§æ¥è·å–ç”¨æˆ·è®¾å¤‡çš„æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼Œä»è€Œä¸ºç”¨æˆ·æä¾›æ›´ä¼˜åŒ–çš„ä½“éªŒæˆ–æ‰§è¡Œç‰¹å®šæ“ä½œç³»ç»Ÿç›¸å…³çš„åŠŸèƒ½ã€‚</p><h4 id="å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹"><span>å®ä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·çš„æ“ä½œç³»ç»Ÿè°ƒæ•´å¸ƒå±€æˆ–åŠŸèƒ½ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">platform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Win&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Looks like you are using Windows.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸ºWindowsç”¨æˆ·æä¾›ç‰¹å®šçš„æ“ä½œæˆ–è§†è§‰æ•ˆæœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">platform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Mac&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Looks like you are using macOS.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸ºmacOSç”¨æˆ·æä¾›ç‰¹å®šçš„æ“ä½œæˆ–è§†è§‰æ•ˆæœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Unknown platform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æä¾›ä¸€ä¸ªé€šç”¨çš„å¸ƒå±€æˆ–åŠŸèƒ½</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åœ¨-node-js-ä¸­å¤„ç†å¹³å°ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ä¸­å¤„ç†å¹³å°ä¿¡æ¯"><span>åœ¨ Node.js ä¸­å¤„ç†å¹³å°ä¿¡æ¯</span></a></h3><p>è™½ç„¶åœ¨ Node.js ä¸­æ²¡æœ‰<code>navigator.platform</code>ï¼ˆå› ä¸º<code>navigator</code>å¯¹è±¡æ˜¯ Web API çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºæµè§ˆå™¨ç¯å¢ƒï¼‰ï¼ŒNode.js æœ‰è‡ªå·±çš„æ–¹å¼æ¥æä¾›å…³äºè¿è¡Œç¯å¢ƒçš„ä¿¡æ¯ã€‚</p><p>Node.js æä¾›äº†<code>os</code>æ¨¡å—ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›ç”¨äºè·å–æ“ä½œç³»ç»Ÿç›¸å…³ä¿¡æ¯çš„æ–¹æ³•ï¼Œæ¯”å¦‚<code>os.platform()</code>æ–¹æ³•å°±å¯ä»¥ç”¨æ¥è·å–è¿è¡Œ Node.js ç¨‹åºçš„æ“ä½œç³»ç»Ÿå¹³å°ã€‚</p><h4 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Your platform is </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">os</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">platform</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†è¾“å‡ºç±»ä¼¼ &#39;darwin&#39;, &#39;win32&#39;, &#39;linux&#39; ç­‰ï¼Œå–å†³äºä½ çš„æ“ä½œç³»ç»Ÿã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Node.js ä¸­ï¼Œä½¿ç”¨<code>os</code>æ¨¡å—å¯ä»¥è®©ä½ ç¼–å†™è·¨å¹³å°çš„ä»£ç ï¼Œä¾‹å¦‚ï¼Œæ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿæ‰§è¡Œä¸åŒçš„ä»»åŠ¡æˆ–è€…è°ƒæ•´åº”ç”¨ç¨‹åºçš„æ€§èƒ½å‚æ•°ç­‰ã€‚</p><p>æ€»ä¹‹ï¼Œè™½ç„¶ä½ æœ€åˆçš„é—®é¢˜å…³äº<code>navigator.platform</code>å¹¶ä¸ç›´æ¥é€‚ç”¨äº Node.jsï¼Œä½†é€šè¿‡ç†è§£å¦‚ä½•åœ¨ä¸åŒçš„ç¯å¢ƒï¼ˆå¦‚æµè§ˆå™¨ä¸ Node.jsï¼‰ä¸­è·å–å’Œä½¿ç”¨å¹³å°ä¿¡æ¯ï¼Œä½ å¯ä»¥æ›´å¥½åœ°å¼€å‘è·¨å¹³å°çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="navigator-useragent" tabindex="-1"><a class="header-anchor" href="#navigator-useragent"><span><a href="https://nodejs.org/docs/latest/api/globals.html#navigatoruseragent" target="_blank" rel="noopener noreferrer">navigator.userAgent</a></span></a></h3><p>Node.js é€šå¸¸ç”¨äºæœåŠ¡å™¨ç«¯çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¹¶ä¸åƒæµè§ˆå™¨ç¯å¢ƒæ‹¥æœ‰ <code>navigator</code> å¯¹è±¡ã€‚ä¸è¿‡ï¼ŒNode.js v16.0.0 å¼•å…¥äº†ä¸€ä¸ªå®éªŒæ€§çš„åŠŸèƒ½ï¼Œå¯ä»¥æ¨¡æ‹Ÿä¸€äº›æµè§ˆå™¨ç‰¹æœ‰çš„å…¨å±€å˜é‡ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ <code>navigator.userAgent</code>ã€‚</p><p>åœ¨æµè§ˆå™¨ä¸­ï¼Œ<code>navigator.userAgent</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‡çš„æ˜¯ç”¨æˆ·ä»£ç†ï¼ˆUser Agentï¼‰çš„ä¿¡æ¯ï¼Œå³æµè§ˆå™¨è‡ªèº«çš„èº«ä»½æ ‡è¯†ã€‚è¿™ä¸ªå­—ç¬¦ä¸²é€šå¸¸åŒ…å«äº†æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ç±»å‹ã€æµè§ˆå™¨ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œç½‘ç«™å¯ä»¥é€šè¿‡è¿™ä¸ªå­—ç¬¦ä¸²æ¥åˆ¤æ–­è®¿é—®è€…ä½¿ç”¨çš„æ˜¯å“ªç§æµè§ˆå™¨ï¼Œä»è€Œæä¾›é€‚é…åçš„å†…å®¹æˆ–åŠŸèƒ½ã€‚</p><p>ç”±äº Node.js ä¸»è¦è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œå®ƒæœ¬èº«å¹¶ä¸éœ€è¦ <code>navigator</code> å¯¹è±¡ã€‚ä½†ä¸ºäº†å…¼å®¹æŸäº›åŸæœ¬è®¾è®¡åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç ï¼Œæˆ–è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ï¼ŒNode.js é€šè¿‡ <code>global.navigator</code> æ¨¡æ‹Ÿå®ç°äº†è¿™æ ·ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>åœ¨ Node.js ä¸­ä½¿ç”¨è¿™ä¸ªå±æ€§ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ç‰ˆæœ¬æ”¯æŒè¯¥ç‰¹æ€§ï¼Œå¹¶ä¸”ä½ å·²ç»å¯ç”¨äº†ç›¸åº”çš„å®éªŒæ€§åŠŸèƒ½ã€‚ä» Node.js v21.7.1 ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœä½ ç›´æ¥å°è¯•è®¿é—® <code>navigator.userAgent</code>ï¼Œå¯èƒ½ä¼šé‡åˆ°æœªå®šä¹‰çš„é”™è¯¯ï¼Œå› ä¸ºå®ƒä¸æ˜¯ Node.js æ ¸å¿ƒ API çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜å¦‚ä½•åœ¨ Node.js ç¯å¢ƒä¸­ä½¿ç”¨ <code>navigator.userAgent</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ çš„ Node.js ç¯å¢ƒå¯ç”¨äº†å¯¹ navigator.userAgent çš„æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªæ¨¡æ‹Ÿçš„ user-agent å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">navigator</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  userAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;Mozilla/5.0 (Linux; U; Android 4.2.2; en-us; Nexus 4 Build/JOP40D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç„¶åå°±å¯ä»¥åœ¨ Node.js ä»£ç ä¸­è¯»å–è¿™ä¸ªå€¼äº†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºç¤ºä¾‹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Mozilla/5.0 (Linux; U; Android 4.2.2; en-us; Nexus 4 Build/JOP40D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½¿ç”¨ <code>global.navigator</code> æ›´å¤šçš„æ˜¯ä¸ºäº†ä¸é‚£äº›æœŸæœ›åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è¿è¡Œçš„åº“æˆ–æ¡†æ¶å…¼å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨äº†ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œè€Œè¿™äº›åº“åœ¨æŸäº›åœ°æ–¹ä¾èµ–äºæµè§ˆå™¨çš„ <code>navigator</code> å¯¹è±¡ï¼Œåˆ™ä½ å¯èƒ½éœ€è¦æ¨¡æ‹Ÿ <code>global.navigator</code> æ¥é¿å…å‡ºé”™ã€‚å½“ç„¶ï¼Œè¿™ç§åšæ³•éœ€è¦è°¨æ…ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°å¯¹å…¨å±€å¯¹è±¡çš„ä¿®æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼šåœ¨ Node.js ä¸­ï¼Œ<code>navigator.userAgent</code> æ˜¯ä¸€ä¸ªéæ ‡å‡†çš„ã€æ¨¡æ‹Ÿçš„æµè§ˆå™¨å…¨å±€å˜é‡ï¼Œç”¨äºç‰¹å®šæƒ…å†µä¸‹çš„å…¼å®¹æ€§å¤„ç†ã€‚åœ¨å¤§å¤šæ•°åç«¯å¼€å‘åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½éƒ½ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªå±æ€§ã€‚</p><h2 id="performanceentry" tabindex="-1"><a class="header-anchor" href="#performanceentry"><span><a href="https://nodejs.org/docs/latest/api/globals.html#performanceentry" target="_blank" rel="noopener noreferrer">PerformanceEntry</a></span></a></h2><p>Node.js ä¸­çš„ <code>PerformanceEntry</code> æ¥å£æ¥è‡ªäºæ€§èƒ½æ—¶é—´çº¿ APIï¼ˆPerformance Timeline APIï¼‰ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥è·å–å’Œåˆ†æç½‘ç«™æˆ–åº”ç”¨ç¨‹åºçš„æ€§èƒ½æŒ‡æ ‡ã€‚è™½ç„¶æœ€åˆè¿™ä¸ªæ¥å£æ˜¯ä¸ºæµè§ˆå™¨ç¯å¢ƒè®¾è®¡çš„ï¼Œä½†åœ¨ Node.js ä¸­ï¼Œå®ƒä¹Ÿè¢«å¼•å…¥ä»¥ä¾¿å¼€å‘è€…å¯ä»¥ç›‘æ§å’Œåˆ†æåç«¯æ“ä½œçš„æ€§èƒ½ã€‚</p><p>ä¸€ä¸ª <code>PerformanceEntry</code> å¯¹è±¡åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><strong>name</strong>: æè¿°æ€§èƒ½æ¡ç›®åç§°çš„å­—ç¬¦ä¸²ï¼Œå¦‚èµ„æºåç§°ã€æ ‡è®°åç­‰ã€‚</li><li><strong>entryType</strong>: è¡¨ç¤ºæ€§èƒ½æ¡ç›®ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ &quot;mark&quot;ã€&quot;measure&quot;ã€&quot;frame&quot; ç­‰ã€‚</li><li><strong>startTime</strong>: æ€§èƒ½æ¡ç›®çš„å¼€å§‹æ—¶é—´ç‚¹ã€‚</li><li><strong>duration</strong>: æ€§èƒ½æ¡ç›®æŒç»­çš„æ—¶é—´é•¿åº¦ã€‚</li></ul><h3 id="åœ¨-node-js-ä¸­ä½¿ç”¨-performanceentry" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ä¸­ä½¿ç”¨-performanceentry"><span>åœ¨ Node.js ä¸­ä½¿ç”¨ <code>PerformanceEntry</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥åˆ©ç”¨ <code>performance</code> æ¨¡å—ä¸­çš„ API æ¥åˆ›å»ºå¹¶è·å–æ€§èƒ½æ¡ç›®ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æ¼”ç¤ºå®ƒçš„å®é™…åº”ç”¨ã€‚</p><h4 id="å®ä¾‹-1-ä½¿ç”¨-performance-mark-å’Œ-performance-measure" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-ä½¿ç”¨-performance-mark-å’Œ-performance-measure"><span>å®ä¾‹ 1: ä½¿ç”¨ <code>performance.mark()</code> å’Œ <code>performance.measure()</code></span></a></h4><p>å‡è®¾ä½ æƒ³è¦æµ‹é‡ä¸€æ®µä»£ç çš„æ‰§è¡Œæ—¶é—´ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>performance.mark()</code> æ–¹æ³•åœ¨ä»£ç æ‰§è¡Œå‰åå„è®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œç„¶åä½¿ç”¨ <code>performance.measure()</code> æ¥è®¡ç®—ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„æ—¶é—´å·®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ä¸€ä¸ªåˆå§‹æ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;start_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿä¸€äº›éœ€è¦æµ‹é‡çš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½®ç»“æŸæ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æµ‹é‡ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„æ—¶é—´å·®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;My Special Process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;start_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨ PerformanceObserver ç›‘å¬æ€§èƒ½æ¡ç›®çš„è®°å½•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> observer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> entries</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    entries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  observer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;measure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€æ®µè€—æ—¶çš„æ“ä½œï¼ˆé€šè¿‡ <code>setTimeout</code>ï¼‰ï¼Œç„¶åé€šè¿‡ <code>performance.mark()</code> åœ¨æ“ä½œå¼€å§‹å’Œç»“æŸæ—¶å„è®¾ç½®äº†ä¸€ä¸ªæ ‡è®°ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>performance.measure()</code> æ–¹æ³•æ¥æµ‹é‡è¿™ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„æ—¶é—´å·®ã€‚<code>PerformanceObserver</code> è¢«ç”¨æ¥è§‚æµ‹å’Œæ‰“å°å‡ºæµ‹é‡ç»“æœã€‚</p><h4 id="å®ä¾‹-2-ç›‘æ§å¼‚æ­¥æ“ä½œçš„æ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-ç›‘æ§å¼‚æ­¥æ“ä½œçš„æ€§èƒ½"><span>å®ä¾‹ 2: ç›‘æ§å¼‚æ­¥æ“ä½œçš„æ€§èƒ½</span></a></h4><p>Node.js çš„ <code>performance</code> API ä¸ä»…é™äºåŒæ­¥ä»£ç ã€‚å€ŸåŠ© <code>PerformanceObserver</code> å’Œç‰¹å®šçš„æ€§èƒ½æ¡ç›®ï¼ˆå¦‚ <code>&#39;function&#39;</code> ç±»å‹ï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥è§‚å¯Ÿå¼‚æ­¥æ“ä½œçš„æ€§èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> someAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;done&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> someAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> observer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> entries</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    entries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  observer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffered</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ³¨æ„ï¼šåœ¨ Node.js v21.7.1 ä¸­ï¼Œç›´æ¥ç›‘æ§å¼‚æ­¥å‡½æ•°çš„æ€§èƒ½å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è®¾ç½®æˆ–ç¬¬ä¸‰æ–¹åº“çš„æ”¯æŒï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸Šé¢çš„ä»£ç æ›´å¤šåœ°å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ PerformanceObserverã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œç›´æ¥é€šè¿‡ <code>PerformanceObserver</code> ç›‘æ§å¼‚æ­¥æ“ä½œçš„æ€§èƒ½å¯èƒ½éœ€è¦é’ˆå¯¹æ€§çš„é…ç½®æˆ–åˆ©ç”¨ç‰¹å®šçš„ API è°ƒç”¨ï¼Œå› æ­¤åœ¨å…·ä½“é¡¹ç›®ä¸­ï¼Œå®ç°æ–¹å¼å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p><h3 id="æ€»ç»“-9" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-9"><span>æ€»ç»“</span></a></h3><p><code>PerformanceEntry</code> å’Œç›¸å…³çš„ API åœ¨ Node.js ä¸­å…è®¸å¼€å‘è€…è¿›è¡Œç»†ç²’åº¦çš„æ€§èƒ½ç›‘æ§å’Œæµ‹é‡ã€‚é€šè¿‡æ ‡è®°å’Œæµ‹é‡ä»£ç çš„æ‰§è¡Œæ—¶é—´ï¼Œä½ å¯ä»¥è·å¾—å…³äºä½ çš„åº”ç”¨æ€§èƒ½çš„æ·±å…¥è§è§£ï¼Œä»è€Œä¼˜åŒ–å’Œæé«˜å…¶æ•ˆç‡ã€‚</p><h2 id="performancemark" tabindex="-1"><a class="header-anchor" href="#performancemark"><span><a href="https://nodejs.org/docs/latest/api/globals.html#performancemark" target="_blank" rel="noopener noreferrer">PerformanceMark</a></span></a></h2><p>Node.js ä¸­çš„ <code>PerformanceMark</code> æ˜¯ä¸€ä¸ªæ€§èƒ½æµ‹é‡å·¥å…·ï¼Œå®ƒå…è®¸ä½ æ ‡è®°ç¨‹åºä¸­çš„ç‰¹å®šæ—¶é—´ç‚¹ã€‚è¿™äº›æ—¶é—´ç‚¹åæ¥å¯ä»¥ç”¨æ¥è®¡ç®—ä»£ç æ‰§è¡Œçš„æ—¶é•¿æˆ–è€…æ¯”è¾ƒä¸åŒä»£ç ç‰‡æ®µä¹‹é—´çš„æ‰§è¡Œæ•ˆç‡ã€‚ç†è§£ <code>PerformanceMark</code> å¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ–åº”ç”¨çš„æ€§èƒ½ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒæµç•…ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-performancemark" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-performancemark"><span>å¦‚ä½•ä½¿ç”¨ <code>PerformanceMark</code></span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦äº†è§£å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ ‡è®°ï¼ˆmarkï¼‰ã€‚Node.js æä¾›äº†ä¸€ä¸ªå…¨å±€çš„ <code>performance</code> å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡ä½ å¯ä»¥è°ƒç”¨ <code>mark()</code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ ‡è®°ã€‚çœ‹ä¸‹é¢çš„åŸºç¡€ç”¨æ³•ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ ‡è®°åä¸º &quot;start&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸€äº›ä½ æƒ³è¦æµ‹é‡çš„ä»£ç ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡æ‹Ÿä¸€äº›å¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚ä»æ•°æ®åº“è·å–æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨æ“ä½œç»“æŸæ—¶åˆ›å»ºå¦ä¸€ä¸ªæ ‡è®°åä¸º &quot;end&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¡ç®—ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„æ—¶é—´å·®ï¼Œå³æ“ä½œçš„æŒç»­æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> measure</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;measure between start and end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;end&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† Node.js çš„ <code>perf_hooks</code> æ¨¡å—ï¼Œè¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º <code>performance</code> API æ˜¯å…¶ä¸­æä¾›çš„åŠŸèƒ½ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>performance.mark()</code> æ¥è®¾ç½®èµ·å§‹å’Œç»“æŸçš„æ ‡è®°ç‚¹ã€‚é€šè¿‡ <code>setTimeout</code> æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¯ä»¥æ˜¯ä»»ä½•æ“ä½œï¼Œæ¯”å¦‚è¯·æ±‚ç½‘ç»œèµ„æºæˆ–è€…è¯»å–æ–‡ä»¶ç­‰ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ <code>performance.measure()</code> æ–¹æ³•è®¡ç®—èµ·å§‹å’Œç»“æŸä¹‹é—´çš„æ—¶é—´å·®ï¼Œå³è¿™æ¬¡æ“ä½œçš„æŒç»­æ—¶é—´ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</p><h3 id="å®é™…è¿ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¸¾ä¾‹"><span>å®é™…è¿ç”¨ä¸¾ä¾‹</span></a></h3><p><strong>ä¾‹ 1ï¼šæµ‹é‡ API è¯·æ±‚æ—¶é—´</strong></p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web æœåŠ¡ï¼Œå¹¶æƒ³è¦æµ‹é‡ä¸€ä¸ªç‰¹å®š API è¯·æ±‚å¤„ç†æ‰€éœ€çš„æ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ‡è®°è¯·æ±‚å¼€å§‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;apiStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://some-api.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ•°æ®å¤„ç†</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ ‡è®°è¯·æ±‚ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;apiEnd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æµ‹é‡è¯·æ±‚æ€»è€—æ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> measure</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      &quot;API request time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      &quot;apiStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      &quot;apiEnd&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`APIè¯·æ±‚è€—æ—¶: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">measure</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¾‹ 2ï¼šæµ‹é‡æ–‡ä»¶è¯»å†™æ“ä½œçš„æ—¶é—´</strong></p><p>åœ¨è¿›è¡Œæ–‡ä»¶æ“ä½œæ—¶ï¼Œäº†è§£è¯»å†™æ“ä½œçš„æ€§èƒ½ä¹Ÿå¾ˆé‡è¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;writeStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;writeEnd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;write operation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;writeStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;writeEnd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> measureWrite</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntriesByName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;write operation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    `File write operation took </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">measureWrite</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> milliseconds`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readEnd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;read operation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readEnd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> measureRead</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntriesByName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;read operation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      `File read operation took </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">measureRead</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> milliseconds`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-10" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-10"><span>æ€»ç»“</span></a></h3><p><code>PerformanceMark</code> å’Œ Node.js ä¸­çš„ <code>performance</code> API ä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´ã€‚é€šè¿‡åˆç†åœ°åˆ©ç”¨è¿™äº›å·¥å…·ï¼Œä½ å¯ä»¥ç²¾ç¡®åœ°äº†è§£åˆ°ä»£ç ä¸­çš„å“ªä¸€éƒ¨åˆ†å¯èƒ½ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¹¶æ®æ­¤ä½œå‡ºç›¸åº”çš„ä¼˜åŒ–ã€‚è¿™å¯¹äºæ„å»ºé«˜æ€§èƒ½çš„åº”ç”¨æ¥è¯´è‡³å…³é‡è¦ã€‚</p><h2 id="performancemeasure" tabindex="-1"><a class="header-anchor" href="#performancemeasure"><span><a href="https://nodejs.org/docs/latest/api/globals.html#performancemeasure" target="_blank" rel="noopener noreferrer">PerformanceMeasure</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™ä½¿å¾— JavaScript ä¸ä»…å¯ä»¥ç”¨äºæ„å»ºå‰ç«¯ç½‘é¡µäº¤äº’ï¼Œä¹Ÿèƒ½ç”¨äºåç«¯æœåŠ¡å™¨çš„å¼€å‘ã€‚Node.js æä¾›äº†å¤§é‡çš„å†…ç½®æ¨¡å—ï¼Œä»¥ä¾¿äºè¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚å…¶ä¸­ï¼Œæ€§èƒ½ç›‘æµ‹æ˜¯ Node.js ä¸­ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œå®ƒå¸®åŠ©å¼€å‘äººå‘˜è¯†åˆ«å’Œä¼˜åŒ–ç¨‹åºä¸­çš„æ€§èƒ½ç“¶é¢ˆã€‚</p><p><code>PerformanceMeasure</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå…¨å±€æ¥å£ï¼Œç”¨äºæµ‹é‡å’Œè®°å½•ä»£ç çš„æ‰§è¡Œæ—¶é—´ã€‚é€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥éå¸¸ç²¾ç¡®åœ°æµ‹é‡ä»£ç ç‰‡æ®µçš„æ‰§è¡Œæ—¶é•¿ï¼Œä»è€Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£åº”ç”¨çš„æ€§èƒ½ç‰¹æ€§ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-performancemeasure" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-performancemeasure"><span>å¦‚ä½•ä½¿ç”¨ <code>PerformanceMeasure</code></span></a></h3><ol><li><p><strong>å¼€å§‹å’Œç»“æŸæ ‡è®°</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦æ ‡è®°å‡ºæƒ³è¦æµ‹é‡çš„ä»£ç æ®µçš„å¼€å§‹å’Œç»“æŸã€‚è¿™æ˜¯é€šè¿‡è°ƒç”¨ <code>performance.mark()</code> æ–¹æ³•å®Œæˆçš„ï¼Œä½ å¯ä»¥ä¸ºæ¯ä¸ªæ ‡è®°æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„åç§°ã€‚</p></li><li><p><strong>æµ‹é‡</strong>ï¼šä¸€æ—¦ä½ æœ‰äº†å¼€å§‹å’Œç»“æŸçš„æ ‡è®°ï¼Œå°±å¯ä»¥é€šè¿‡è°ƒç”¨ <code>performance.measure()</code> æ–¹æ³•æ¥æµ‹é‡å®ƒä»¬ä¹‹é—´çš„æ—¶é—´å·®ã€‚è¿™ä¸ªæ–¹æ³•åŒæ ·éœ€è¦ä¸€ä¸ªåç§°ï¼ˆç”¨äºè¯†åˆ«è¿™æ¬¡æµ‹é‡ï¼‰ï¼Œä»¥åŠå¼€å§‹å’Œç»“æŸæ ‡è®°çš„åç§°ã€‚</p></li><li><p><strong>è·å–ç»“æœ</strong>ï¼šæµ‹é‡å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹ <code>performance.getEntriesByName()</code> æˆ– <code>performance.getEntriesByType(&#39;measure&#39;)</code> æ¥è·å–å…·ä½“çš„æµ‹é‡ç»“æœï¼Œå…¶ä¸­åŒ…å«äº†å¼€å§‹å’Œç»“æŸæ—¶é—´ç‚¹ä»¥åŠäºŒè€…ä¹‹é—´çš„æ—¶é—´å·®ã€‚</p></li></ol><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œå¹¶æƒ³è¦æµ‹é‡æŸä¸ªæ•°æ®å¤„ç†å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨å†Œä¸€ä¸ªæ€§èƒ½è§‚å¯Ÿè€…æ¥å¼‚æ­¥åœ°æ•è·æ€§èƒ½æµ‹é‡ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> obs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">items</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">items</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearMarks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¸…é™¤æ‰€æœ‰å·²ç»è®°å½•çš„æ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">obs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;measure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ‡è®°â€œå¼€å§‹â€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;start_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰§è¡Œä½ æƒ³è¦æµ‹é‡çš„å‡½æ•°æˆ–ä»£ç æ®µ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ‡è®°â€œç»“æŸâ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æµ‹é‡ä»â€œstart_processâ€åˆ°â€œend_processâ€çš„æ‰§è¡Œæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Process Time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;start_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>processData</code> å‡½æ•°æ˜¯æˆ‘ä»¬æƒ³è¦æµ‹é‡æ‰§è¡Œæ—¶é—´çš„ä»£ç éƒ¨åˆ†ã€‚é€šè¿‡åœ¨å‡½æ•°æ‰§è¡Œå‰ååˆ†åˆ«è®¾ç½®å¼€å§‹(<code>start_process</code>)å’Œç»“æŸ(<code>end_process</code>)æ ‡è®°ï¼Œç„¶åè°ƒç”¨ <code>performance.measure()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°è¿™æ®µä»£ç æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´ã€‚æ€§èƒ½è§‚å¯Ÿè€… (<code>PerformanceObserver</code>) ç”¨äºå¼‚æ­¥æ•è·å¹¶æ‰“å°å‡ºæµ‹é‡ç»“æœã€‚</p><p>æ€»ç»“è€Œè¨€ï¼Œ<code>PerformanceMeasure</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…å‡†ç¡®åœ°æµ‹é‡å’Œåˆ†æä»£ç çš„æ‰§è¡Œæ—¶é—´ï¼Œè¿™å¯¹äºæ€§èƒ½ä¼˜åŒ–å’Œé—®é¢˜è¯Šæ–­æ¥è¯´è‡³å…³é‡è¦ã€‚</p><h2 id="performanceobserver" tabindex="-1"><a class="header-anchor" href="#performanceobserver"><span><a href="https://nodejs.org/docs/latest/api/globals.html#performanceobserver" target="_blank" rel="noopener noreferrer">PerformanceObserver</a></span></a></h2><p>äº†è§£ Node.js ä¸­çš„<code>PerformanceObserver</code>æ˜¯ä¸€ä¸ªæœ‰è¶£ä¸”é‡è¦çš„è¯é¢˜ï¼Œå®ƒæ¶‰åŠç›‘æµ‹å’Œæ”¹è¿›ä½ çš„ç¨‹åºæ€§èƒ½ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥è§£æè¿™ä¸ªæ¦‚å¿µï¼Œå¹¶é€šè¿‡ä¾‹å­æ¥åŠ æ·±ç†è§£ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯ PerformanceObserver?</strong></p><p>åœ¨ Node.js ä¸­ï¼Œ<code>PerformanceObserver</code>ç±»ç”¨äºè§‚å¯Ÿæ€§èƒ½æµ‹é‡äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯ä»¥æ˜¯ç”±ç”¨æˆ·å®šä¹‰çš„æ ‡è®°ã€æµ‹é‡æˆ–è€…æ˜¯ Node.js å†…éƒ¨æ“ä½œçš„æ€§èƒ½æŒ‡æ ‡ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¸®åŠ©ä½ æ”¶é›†å’Œåˆ†æä»£ç è¿è¡Œæ—¶çš„æ€§èƒ½æ•°æ®ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ PerformanceObserverï¼Ÿ</strong></p><p>å½“ä½ å¼€å‘åº”ç”¨æ—¶ï¼Œç¡®ä¿å®ƒè¿è¡Œå¾—æ—¢å¿«åˆé«˜æ•ˆéå¸¸å…³é”®ã€‚ä½†æ˜¯ï¼Œä¸ä½¿ç”¨å·¥å…·çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾å‡†ç¡®çŸ¥é“å“ªéƒ¨åˆ†ä»£ç å¯¼è‡´äº†æ€§èƒ½ç“¶é¢ˆã€‚<code>PerformanceObserver</code>å°±åƒæ˜¯ç»™ä½ æä¾›äº†ä¸€å‰¯â€œçœ¼é•œâ€ï¼Œé€šè¿‡å®ƒï¼Œä½ å¯ä»¥çœ‹åˆ°å“ªäº›æ“ä½œè€—æ—¶æœ€é•¿ï¼Œä»è€Œå¯¹å®ƒä»¬è¿›è¡Œä¼˜åŒ–ã€‚</p><p><strong>å¦‚ä½•ä½¿ç”¨ PerformanceObserverï¼Ÿ</strong></p><p>ä½¿ç”¨<code>PerformanceObserver</code>é€šå¸¸åŒ…æ‹¬å‡ ä¸ªæ­¥éª¤ï¼šæ³¨å†Œè§‚å¯Ÿè€…ã€æŒ‡å®šæƒ³è¦ç›‘å¬çš„æ€§èƒ½æ¡ç›®ç±»å‹ã€å¼€å§‹æ”¶é›†æ€§èƒ½æ•°æ®ï¼Œæœ€åæ˜¯å¤„ç†è¿™äº›æ•°æ®ã€‚</p><p><strong>ä¾‹ 1ï¼šç›‘æµ‹è‡ªå®šä¹‰æ€§èƒ½æ ‡è®°</strong></p><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä¸€æ®µå¯èƒ½ä¼šå½±å“æ•´ä½“æ€§èƒ½çš„ä»£ç ã€‚ä½ æƒ³çŸ¥é“è¿™æ®µä»£ç è¿è¡Œäº†å¤šä¹…ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;perf_hooks&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ€§èƒ½è§‚å¯Ÿè€…æ¥æ”¶é›†æ€§èƒ½æŒ‡æ ‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> observer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> entries</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®©è§‚å¯Ÿè€…å…³æ³¨ç‰¹å®šç±»å‹çš„æ€§èƒ½æŒ‡æ ‡ï¼Œè¿™é‡Œæ˜¯&#39;mark&#39;å’Œ&#39;measure&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">observer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;mark&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;measure&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹æ ‡è®°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä½ æƒ³è¦æµ‹è¯•æ€§èƒ½çš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸæ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;My Special Loop&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æµ‹é‡ä»å¼€å§‹åˆ°ç»“æŸæ ‡è®°ä¹‹é—´çš„æ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>performance.mark()</code>æ–¹æ³•æ¥æ ‡è®°ä»£ç æ‰§è¡Œçš„èµ·æ­¢ç‚¹ï¼Œç„¶åç”¨<code>performance.measure()</code>è®¡ç®—è¿™ä¸¤ç‚¹ä¹‹é—´çš„æŒç»­æ—¶é—´ã€‚<code>PerformanceObserver</code>åˆ™ç”¨æ¥æ•è·å’Œæ‰“å°å‡ºè¿™æ®µæ—¶é—´ã€‚</p><p><strong>ä¾‹ 2ï¼šç›‘æ§å¼‚æ­¥æ“ä½œçš„æ€§èƒ½</strong></p><p>ç°ä»£ Web åº”ç”¨ä¸­ï¼Œå¼‚æ­¥æ“ä½œæ— å¤„ä¸åœ¨ï¼Œäº†è§£æŸä¸ªå¼‚æ­¥æ“ä½œè€—æ—¶å¤šä¹…å¯¹äºæ€§èƒ½è°ƒä¼˜åŒæ ·é‡è¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> observer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> entries</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">observer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;measure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fetchStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fetchEnd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Fetch Data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fetchStart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fetchEnd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼ˆå‡è®¾æ˜¯ä»æŸå¤„è·å–æ•°æ®ï¼‰ï¼Œå¹¶ä¸”é€šè¿‡æ ‡è®°å’Œæµ‹é‡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šè¿™ä¸ªå¼‚æ­¥æ“ä½œçš„å…·ä½“è€—æ—¶ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>PerformanceObserver</code>æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå¼ºå¤§å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®ä½ æ´å¯Ÿç¨‹åºçš„æ€§èƒ½çŠ¶å†µï¼Œé€šè¿‡æ”¶é›†å’Œåˆ†ææ€§èƒ½æ•°æ®ï¼Œä»è€Œåšå‡ºç›¸åº”çš„ä¼˜åŒ–ã€‚å¸Œæœ›ä»¥ä¸Šçš„è§£è¯»å’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¹¶å¼€å§‹ä½¿ç”¨<code>PerformanceObserver</code>æ¥æå‡ä½ çš„åº”ç”¨æ€§èƒ½ã€‚</p><h2 id="performanceobserverentrylist" tabindex="-1"><a class="header-anchor" href="#performanceobserverentrylist"><span><a href="https://nodejs.org/docs/latest/api/globals.html#performanceobserverentrylist" target="_blank" rel="noopener noreferrer">PerformanceObserverEntryList</a></span></a></h2><p><code>PerformanceObserverEntryList</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¥è®¿é—®ç”± <code>PerformanceObserver</code> å¯¹è±¡æ”¶é›†çš„æ€§èƒ½åº¦é‡äº‹ä»¶ (<code>PerformanceEntry</code> å¯¹è±¡)ã€‚è¿™äº›åº¦é‡äº‹ä»¶å¯ä»¥åŒ…æ‹¬ä¸åŒç±»å‹çš„æ€§èƒ½ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚æ—¶é—´æ ‡è®°ã€èµ„æºåŠ è½½æ—¶é—´ç­‰ã€‚</p><p>å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>PerformanceObserver</code> å¹¶ä¸”å¼€å§‹è§‚å¯Ÿä¸€å®šç±»å‹çš„æ€§èƒ½æ¡ç›®æ—¶ï¼Œæ¯å½“æœ‰æ–°çš„æ€§èƒ½æ¡ç›®è¢«è®°å½•ï¼ŒèŠ‚ç‚¹ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶ä¼ é€’ <code>PerformanceObserverEntryList</code> å¯¹è±¡ç»™è¿™ä¸ªå›è°ƒã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªåˆ—è¡¨æŸ¥è¯¢å’Œåˆ†ææ€§èƒ½æ•°æ®ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ <code>PerformanceObserverEntryList</code> çš„ä¸€ä¸ªç®€å•ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ€§èƒ½è§‚å¯Ÿè€…å®ä¾‹æ¥è§‚å¯Ÿâ€œmeasureâ€ç±»å‹çš„æ€§èƒ½æ¡ç›®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> obs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">items</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è·å–æ‰€æœ‰çš„æ€§èƒ½æ¡ç›®åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> entries</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> items</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // éå†æ¯ä¸ªæ¡ç›®å¹¶æ‰“å°å‡ºæ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  entries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Name: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, Duration: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¸…é™¤å½“å‰å­˜å‚¨çš„æ€§èƒ½æ¡ç›®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearMarks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹è§‚å¯Ÿç‰¹å®šç±»å‹çš„æ€§èƒ½æ¡ç›®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">obs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;measure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ ä¸€äº›æ€§èƒ½æ ‡è®°ï¼ˆmarksï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ... åœ¨è¿™é‡Œä½ å¯èƒ½ä¼šæ‰§è¡ŒæŸäº›ä»£ç  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æµ‹é‡ä»â€œAâ€åˆ°â€œBâ€çš„æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A to B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä»£ç åšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>å¯¼å…¥äº† Node.js æ€§èƒ½ API ä¸­çš„ <code>perf_hooks</code> æ¨¡å—ã€‚</li><li>åˆ›å»ºäº†ä¸€ä¸ª <code>PerformanceObserver</code> å®ä¾‹ï¼Œè¯¥å®ä¾‹é€šè¿‡ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ¥æ”¶æ€§èƒ½äº‹ä»¶ã€‚</li><li>å›è°ƒå‡½æ•°ä½¿ç”¨ <code>getEntries</code> æ–¹æ³•ä» <code>PerformanceObserverEntryList</code> è·å–äº†æ‰€æœ‰æ€§èƒ½æ¡ç›®ï¼Œå¹¶éå†è¾“å‡ºæ¡ç›®åç§°å’ŒæŒç»­æ—¶é—´ã€‚</li><li>é€šè¿‡ <code>observe</code> æ–¹æ³•å¼€å§‹è§‚å¯Ÿåä¸ºâ€œmeasureâ€çš„æ€§èƒ½æ¡ç›®ã€‚</li><li>ä½¿ç”¨ <code>performance.mark</code> åˆ›å»ºæ€§èƒ½æ ‡è®°ï¼Œä¹‹åæµ‹é‡å®ƒä»¬ä¹‹é—´çš„å·®å¼‚å¹¶å°†å…¶å‘½åä¸ºâ€œA to Bâ€ã€‚</li></ol><p>å½“ <code>performance.measure</code> è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªç±»å‹ä¸º &quot;measure&quot; çš„æ€§èƒ½æ¡ç›®ï¼Œ<code>PerformanceObserver</code> æ£€æµ‹åˆ°è¿™ä¸€å˜åŒ–ï¼Œå¹¶è§¦å‘å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶ <code>PerformanceObserverEntryList</code> å¯¹è±¡å°±ä¼šåŒ…å«è¿™ä¸ªåˆšç”Ÿæˆçš„ measure æ¡ç›®ã€‚è¿™æ ·ä½ å°±å¯ä»¥åˆ†æç¨‹åºä¸­æŸäº›æ“ä½œçš„æ€§èƒ½è¡¨ç°äº†ã€‚</p><h2 id="performanceresourcetiming" tabindex="-1"><a class="header-anchor" href="#performanceresourcetiming"><span><a href="https://nodejs.org/docs/latest/api/globals.html#performanceresourcetiming" target="_blank" rel="noopener noreferrer">PerformanceResourceTiming</a></span></a></h2><p>Node.js çš„ <code>PerformanceResourceTiming</code> æ˜¯ä¸€ä¸ªé‡è¦çš„æ¥å£ï¼Œå®ƒæä¾›äº†ç½‘ç»œè¯·æ±‚çš„è¯¦ç»†è®¡æ—¶ä¿¡æ¯ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦ç”¨äºæ€§èƒ½åˆ†æï¼Œå¸®åŠ©å¼€å‘è€…äº†è§£ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç½‘ç»œè¯·æ±‚çš„æ€§èƒ½è¡¨ç°ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-performanceresourcetiming" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-performanceresourcetiming"><span>ä»€ä¹ˆæ˜¯ PerformanceResourceTiming?</span></a></h3><p><code>PerformanceResourceTiming</code> æ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸€æ¬¡ç‰¹å®šç½‘ç»œè¯·æ±‚ï¼ˆå¦‚ HTTPã€HTTPS è¯·æ±‚ï¼‰æ€§èƒ½æ•°æ®çš„å¯¹è±¡ã€‚å®ƒç»§æ‰¿è‡ª <code>PerformanceEntry</code> æ¥å£ï¼Œå¹¶å¢åŠ äº†ä¸èµ„æºåŠ è½½ç›¸å…³çš„å±æ€§ã€‚</p><h3 id="performanceresourcetiming-çš„å±æ€§" tabindex="-1"><a class="header-anchor" href="#performanceresourcetiming-çš„å±æ€§"><span>PerformanceResourceTiming çš„å±æ€§</span></a></h3><p>è¿™ä¸ªå¯¹è±¡åŒ…æ‹¬äº†ä»è¯·æ±‚å¼€å§‹åˆ°è¯·æ±‚ç»“æŸçš„å„ä¸ªé˜¶æ®µçš„æ—¶é—´æˆ³ï¼Œæ¯”å¦‚ï¼š</p><ul><li><code>startTime</code>: è¯·æ±‚å¼€å§‹çš„æ—¶é—´ã€‚</li><li><code>redirectStart</code> å’Œ <code>redirectEnd</code>: å¦‚æœè¯·æ±‚è¢«é‡å®šå‘ï¼Œè¿™ä¸¤ä¸ªå±æ€§è¡¨ç¤ºé‡å®šå‘å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ã€‚</li><li><code>fetchStart</code>: æµè§ˆå™¨å‡†å¤‡å¥½ä½¿ç”¨ç½‘ç»œå‘é€è¯·æ±‚çš„æ—¶é—´ã€‚</li><li><code>domainLookupStart</code> å’Œ <code>domainLookupEnd</code>: åŸŸåæŸ¥è¯¢å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ã€‚</li><li><code>connectStart</code> å’Œ <code>connectEnd</code>: ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚</li><li><code>requestStart</code>: æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚çš„æ—¶é—´ã€‚</li><li><code>responseStart</code> å’Œ <code>responseEnd</code>: æ¥æ”¶åˆ°å“åº”çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚</li></ul><p>é€šè¿‡è¿™äº›æ—¶é—´æˆ³ï¼Œä½ å¯ä»¥è¡¡é‡ç½‘ç»œè¯·æ±‚çš„æ€§èƒ½ï¼Œæ¯”å¦‚æ€»ä½“è€—æ—¶ã€è¿æ¥å»ºç«‹æ—¶é—´ã€å“åº”æ¥æ”¶æ—¶é—´ç­‰ç­‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ€§èƒ½åˆ†æ</strong>ï¼šå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå¹¶ä¸”æ³¨æ„åˆ°æŸäº›æ“ä½œå“åº”å¾ˆæ…¢ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>PerformanceResourceTiming</code> æ¥æµ‹é‡ä¸åŒç½‘ç»œè¯·æ±‚çš„æ€§èƒ½ï¼Œè¿›è€Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆã€‚</p></li><li><p><strong>ç›‘æ§å’Œæ—¥å¿—</strong>ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥åˆ©ç”¨ <code>PerformanceResourceTiming</code> æ•°æ®è¿›è¡Œå®æ—¶æ€§èƒ½ç›‘æ§ã€‚å¦‚æœå‘ç°æŸä¸ªè¯·æ±‚çš„æ€§èƒ½çªç„¶ä¸‹é™ï¼Œå¯ä»¥åŠæ—¶è°ƒæ•´æˆ–ä¼˜åŒ–ä»£ç ã€‚</p></li><li><p><strong>ç”¨æˆ·ä½“éªŒåˆ†æ</strong>ï¼šäº†è§£é¡µé¢æˆ–åº”ç”¨åŠ è½½è¿‡ç¨‹ä¸­å„ä¸ªèµ„æºçš„åŠ è½½æ—¶é—´ï¼Œå¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ å‘ç°å›¾ç‰‡åŠ è½½ç‰¹åˆ«æ…¢ï¼Œå¯èƒ½éœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©æˆ–ä½¿ç”¨æ›´å¿«çš„ CDNã€‚</p></li></ol><h3 id="å¦‚ä½•ä½¿ç”¨-6" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-6"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>åœ¨ Node.js ä¸­ä½¿ç”¨ <code>PerformanceResourceTiming</code> é€šå¸¸ä¸ <code>performance</code> API ç»“åˆä½¿ç”¨ã€‚é¦–å…ˆï¼Œä½ éœ€è¦å¯ç”¨å’Œè®¿é—® performance APIï¼Œç„¶åé€šè¿‡ä¸€å®šçš„æ–¹æ³•è·å–åˆ°ç‰¹å®šè¯·æ±‚çš„ <code>PerformanceResourceTiming</code> å¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿä¸€ä¸ªè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œæ˜¯å‘èµ·è¯·æ±‚çš„é€»è¾‘ï¼Œæ¯”å¦‚ä½¿ç”¨ fetch API æˆ–å…¶ä»– HTTP å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Fetching </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">...`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¯·æ±‚å®Œæˆåï¼Œæµ‹é‡å¹¶è®°å½•æ€§èƒ½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> end</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Fetch completed in </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">end</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> milliseconds.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ç¤ºä¾‹åªæ˜¯ä¸ºäº†æ¼”ç¤ºå¦‚ä½•æ‰‹åŠ¨æµ‹é‡æ€§èƒ½ã€‚åœ¨ Node.js ç¯å¢ƒä¸­ï¼Œç”±äºæ²¡æœ‰å†…ç½®çš„ <code>fetch</code> API ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Axiosã€node-fetch ç­‰ï¼‰æ¥å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚åŒæ—¶ï¼ŒNode.js çš„ <code>perf_hooks</code> æ¨¡å—æä¾›äº†æ›´å¤šä¸“é—¨çš„å·¥å…·æ¥æµ‹é‡å’Œç›‘æ§æ€§èƒ½æ•°æ®ï¼Œä½† <code>PerformanceResourceTiming</code> ä¸»è¦æ˜¯ä¸€ä¸ª Web APIï¼Œå…¶ç›´æ¥åº”ç”¨æ›´å¤šåœ°ä½“ç°åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ç¯å¢ƒä¸­ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œè™½ç„¶ <code>PerformanceResourceTiming</code> åœ¨ Node.js ä¸­ä¸æ˜¯ç›´æ¥ä½¿ç”¨çš„ APIï¼Œäº†è§£å®ƒæœ‰åŠ©äºä½ æ·±å…¥ç†è§£æ€§èƒ½åˆ†æçš„æ¦‚å¿µï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨é€‚å½“çš„åœºæ™¯ä¸‹ï¼ˆå¦‚å®¢æˆ·ç«¯æµè§ˆå™¨ç¯å¢ƒæˆ–å€ŸåŠ©ç›¸åº”çš„ Node.js åº“ï¼‰åº”ç”¨è¿™äº›æ¦‚å¿µã€‚</p><h2 id="performance" tabindex="-1"><a class="header-anchor" href="#performance"><span><a href="https://nodejs.org/docs/latest/api/globals.html#performance" target="_blank" rel="noopener noreferrer">performance</a></span></a></h2><p>Node.js çš„ <code>performance</code> API æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹å¼æ¥æµ‹é‡ä»£ç çš„æ€§èƒ½ã€‚è¿™ä¸ª API æ¥è‡ªäº Web æµè§ˆå™¨ä¸­çš„ Performance æ¥å£ï¼Œç‰¹åˆ«æ˜¯ High Resolution Time API å’Œ Performance Timeline APIï¼Œå®ƒä»¬å…è®¸ä½ ä»¥æé«˜çš„ç²¾åº¦ï¼ˆé€šå¸¸æ˜¯å¾®ç§’çº§åˆ«ï¼‰è·å–æ—¶é—´ä¿¡æ¯ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>performance</code> API èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£åº”ç”¨ç¨‹åºè¿è¡Œçš„å…·ä½“æƒ…å†µï¼Œæ¯”å¦‚å‡½æ•°æ‰§è¡Œå¤šä¹…ï¼Œæˆ–è€…æŸäº›å¼‚æ­¥æ“ä½œéœ€è¦å¤šå°‘æ—¶é—´æ‰èƒ½å®Œæˆã€‚è¿™æœ‰åŠ©äºè¯†åˆ«å’Œä¼˜åŒ–ç¨‹åºä¸­çš„ç“¶é¢ˆã€‚</p><p>ä»¥ä¸‹æ˜¯è¯¥ API çš„ä¸€äº›å…³é”®éƒ¨åˆ†ï¼š</p><ol><li><code>performance.now()</code>: è¿”å›å½“å‰æ—¶é—´çš„é«˜ç²¾åº¦æ—¶é—´æˆ³ï¼Œç›¸å¯¹äº <code>performance.timeOrigin</code>ã€‚å®ƒéå¸¸é€‚åˆç”¨æ¥æµ‹é‡å°æ®µä»£ç çš„æ‰§è¡Œæ—¶é—´ã€‚</li><li><code>performance.mark()</code>: ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ—¶é—´æ ‡è®°ï¼ˆç§°ä¸º&quot;æ ‡è®°ç‚¹&quot;ï¼‰ï¼Œå¯ä»¥ç”¨è¿™äº›æ ‡è®°ç‚¹æ¥è¡¡é‡ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®èŠ‚ç‚¹ã€‚</li><li><code>performance.measure()</code>: åˆ›å»ºä¸€ä¸ªå‘½åçš„æ—¶é—´é—´éš”ï¼Œé€šè¿‡æŒ‡å®šä¸¤ä¸ªæ ‡è®°ç‚¹ï¼ˆå¼€å§‹å’Œç»“æŸï¼‰æ¥è®¡ç®—å®ƒä»¬ä¹‹é—´çš„æ—¶é—´å·®ã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¸€äº›å®é™…çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼š</p><h3 id="å®ä¾‹-1-æµ‹é‡ä»£ç å—æ‰§è¡Œæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-æµ‹é‡ä»£ç å—æ‰§è¡Œæ—¶é—´"><span>å®ä¾‹ 1: æµ‹é‡ä»£ç å—æ‰§è¡Œæ—¶é—´</span></a></h3><p>å‡è®¾ä½ æƒ³è¦æµ‹é‡ä¸€ä¸ªå‡½æ•°<code>doSomething()</code>çš„æ‰§è¡Œæ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹è®¡æ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> startTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰§è¡Œä½ çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸè®¡æ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> endTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`doSomething å‡½æ•°æ‰§è¡Œè€—æ—¶ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">endTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> startTime</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æ¯«ç§’`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®ä¾‹-2-ä½¿ç”¨æ ‡è®°å’Œæµ‹é‡" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-ä½¿ç”¨æ ‡è®°å’Œæµ‹é‡"><span>å®ä¾‹ 2: ä½¿ç”¨æ ‡è®°å’Œæµ‹é‡</span></a></h3><p>å¦‚æœä½ çš„ç¨‹åºåŒ…å«äº†ä¸€ç³»åˆ—å¤æ‚çš„æ“ä½œï¼Œä½ å¯èƒ½æƒ³è¦è¯¦ç»†äº†è§£æ¯ä¸ªæ­¥éª¤çš„è€—æ—¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®æ€§èƒ½è§‚å¯Ÿè€…ï¼Œç›‘å¬æµ‹é‡äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> obs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearMarks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">obs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;measure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹ç¬¬ä¸€ä¸ªæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A-start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doFirstThing</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A-end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æµ‹é‡ç¬¬ä¸€ä¸ªæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;First thing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A-start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A-end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹ç¬¬äºŒä¸ªæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;B-start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doSecondThing</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;B-end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æµ‹é‡ç¬¬äºŒä¸ªæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">measure</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Second thing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;B-start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;B-end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doFirstThing</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ... å‡è®¾è¿™é‡Œæœ‰ä¸€äº›ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doSecondThing</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ... å‡è®¾è¿™é‡Œä¹Ÿæœ‰ä¸€äº›ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é€šè¿‡è®¾ç½® <code>PerformanceObserver</code> æ¥ç›‘å¬æµ‹é‡äº‹ä»¶ï¼Œå¹¶åœ¨æ‰§è¡Œæ¯ä¸ªæ“ä½œå‰åæ”¾ç½®æ ‡è®°ã€‚ç„¶åï¼Œå®ƒè°ƒç”¨ <code>performance.measure()</code> æ¥è·å–ä¸¤ä¸ªæ ‡è®°ç‚¹ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚å½“æ¯æ¬¡æµ‹é‡å®Œæˆæ—¶ï¼Œæ€§èƒ½è§‚å¯Ÿè€…ä¼šè¾“å‡ºæµ‹é‡ç»“æœã€‚</p><p>ä½¿ç”¨ Node.js çš„ <code>performance</code> API å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä½ çš„ä»£ç æ€§èƒ½ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥å¼€å§‹åŸºæœ¬çš„æ€§èƒ½ç›‘æ§ï¼Œå¹¶é€æ­¥æ·±å…¥åˆ°æ›´å¤æ‚çš„æ€§èƒ½åˆ†æä¸­å»ã€‚</p><h2 id="process" tabindex="-1"><a class="header-anchor" href="#process"><span><a href="https://nodejs.org/docs/latest/api/globals.html#process" target="_blank" rel="noopener noreferrer">process</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>process</code> æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæä¾›äº†å½“å‰ Node.js è¿›ç¨‹çš„ä¿¡æ¯å’Œæ§åˆ¶èƒ½åŠ›ã€‚é€šè¿‡ <code>process</code> å¯¹è±¡ï¼Œä½ å¯ä»¥ä¸æ­£åœ¨è¿è¡Œçš„ Node.js ç¨‹åºäº¤äº’ï¼Œè·å–ç¯å¢ƒä¿¡æ¯ï¼Œç›‘å¬è¿è¡Œæ—¶äº‹ä»¶ç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº› <code>process</code> å¯¹è±¡æœ€å¸¸ç”¨çš„å±æ€§å’Œæ–¹æ³•çš„è§£é‡Šå’Œä¾‹å­ï¼š</p><h3 id="process-env" tabindex="-1"><a class="header-anchor" href="#process-env"><span>process.env</span></a></h3><p><code>process.env</code> å±æ€§è¿”å›åŒ…å«ç”¨æˆ·ç¯å¢ƒä¿¡æ¯çš„å¯¹è±¡ã€‚è¿™é€šå¸¸ç”¨æ¥è¯»å–ç¯å¢ƒå˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥ä¿å­˜æ•æ„Ÿæ•°æ®ï¼ˆæ¯”å¦‚æ•°æ®åº“å¯†ç ï¼‰ï¼Œæˆ–è€…ç”¨æ¥å†³å®šç¨‹åºåœ¨ä¸åŒç¯å¢ƒä¸‹ï¼ˆä¾‹å¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰çš„è¡Œä¸ºã€‚</p><p>ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°ç¯å¢ƒå˜é‡PATH</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ æœ‰ä¸€ä¸ªåä¸º <code>DATABASE_PASSWORD</code> çš„ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥è¿™æ ·è·å–å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dbPassword</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DATABASE_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="process-argv" tabindex="-1"><a class="header-anchor" href="#process-argv"><span>process.argv</span></a></h3><p><code>process.argv</code> å±æ€§è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å½“å¯åŠ¨ Node.js è¿›ç¨‹æ—¶ä¼ å…¥çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ node å‘½ä»¤çš„å®Œæ•´è·¯å¾„ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œè€Œå…¶ä»–çš„å…ƒç´ æ˜¯ä»»ä½•é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ã€‚</p><p>ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿è¡Œ node script.js arg1 arg2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºç±»ä¼¼äºï¼š[&#39;node è·¯å¾„&#39;, &#39;/path/to/script.js&#39;, &#39;arg1&#39;, &#39;arg2&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="process-exit" tabindex="-1"><a class="header-anchor" href="#process-exit"><span>process.exit()</span></a></h3><p><code>process.exit()</code> æ–¹æ³•ç”¨æ¥é€€å‡ºå½“å‰è¿›ç¨‹ã€‚ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªé€€å‡ºç ï¼ˆé»˜è®¤ä¸º 0ï¼‰ï¼Œè¡¨ç¤ºæˆåŠŸæˆ–è€…é”™è¯¯çš„å®Œæˆã€‚</p><p>ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é»˜è®¤é€€å‡ºç ä¸º 0ï¼Œä»£è¡¨æˆåŠŸæ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é€€å‡ºç ä¸º 1ï¼Œé€šå¸¸è¡¨ç¤ºå‡ºç°äº†é”™è¯¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="process-cwd" tabindex="-1"><a class="header-anchor" href="#process-cwd"><span>process.cwd()</span></a></h3><p><code>process.cwd()</code> æ–¹æ³•è¿”å› Node.js è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚è¿™æ˜¯æ‰§è¡Œ shell å‘½ä»¤æˆ–æ“ä½œæ–‡ä»¶ç³»ç»Ÿæ—¶éå¸¸æœ‰ç”¨çš„ã€‚</p><p>ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cwd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°å‡ºå½“å‰å·¥ä½œç›®å½•</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="process-nexttick" tabindex="-1"><a class="header-anchor" href="#process-nexttick"><span>process.nextTick()</span></a></h3><p><code>process.nextTick()</code> æ–¹æ³•å…è®¸ä½ æŠŠä¸€ä¸ªå›è°ƒå‡½æ•°æ”¾åˆ°äº‹ä»¶å¾ªç¯çš„ä¸‹ä¸€ä¸ªè½®æ¬¡ã€‚è¿™æ„å‘³ç€æ— è®ºä½•æ—¶è°ƒç”¨ <code>nextTick()</code>ï¼Œæ‰€ä¼ é€’çš„å›è°ƒå‡½æ•°éƒ½ä¼šåœ¨å…¶ä½™ä»£ç æ‰§è¡Œå®Œæ¯•åã€äº‹ä»¶å¾ªç¯ç»§ç»­ä¹‹å‰è¢«è§¦å‘ã€‚</p><p>ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼€å§‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼‚æ­¥æ“ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å·²è®¡åˆ’&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºé¡ºåºå°†ä¼šæ˜¯ &quot;å¼€å§‹&quot; -&gt; &quot;å·²è®¡åˆ’&quot; -&gt; &quot;å¼‚æ­¥æ“ä½œ&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="process-on" tabindex="-1"><a class="header-anchor" href="#process-on"><span>process.on()</span></a></h3><p><code>process.on()</code> æ–¹æ³•ç”¨æ¥ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç›‘å¬ç‰¹å®šçš„äº‹ä»¶ã€‚Node.js è¿›ç¨‹å¯¹è±¡å¯ä»¥è§¦å‘å¤šç§äº‹ä»¶ï¼Œæ¯”å¦‚ <code>exit</code>ã€<code>uncaughtException</code> ç­‰ã€‚</p><p>ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å³å°†é€€å‡ºï¼Œé€€å‡ºç ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“è¿›ç¨‹é€€å‡ºæ—¶ï¼Œä¼šæ‰“å°é€€å‡ºç </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯é’ˆå¯¹ Node.js ä¸­ <code>process</code> å¯¹è±¡çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ç‚¹ä»¥åŠå®ç”¨çš„ä¾‹å­ã€‚å› ä¸º <code>process</code> æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä»»ä½• Node.js æ¨¡å—ä¸­ç›´æ¥ä½¿ç”¨å®ƒï¼Œè€Œä¸éœ€è¦åƒä½¿ç”¨å…¶ä»–æ¨¡å—é‚£æ ·å¯¼å…¥å®ƒã€‚</p><h2 id="queuemicrotask-callback" tabindex="-1"><a class="header-anchor" href="#queuemicrotask-callback"><span><a href="https://nodejs.org/docs/latest/api/globals.html#queuemicrotaskcallback" target="_blank" rel="noopener noreferrer">queueMicrotask(callback)</a></span></a></h2><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ·±å…¥äº†è§£ <code>queueMicrotask(callback)</code> è¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶é€šè¿‡ç®€å•æ˜“æ‡‚çš„æ–¹å¼æ¥æ¢ç´¢å®ƒåœ¨ Node.js ä¸­çš„åº”ç”¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-queuemicrotask-callback" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-queuemicrotask-callback"><span>ä»€ä¹ˆæ˜¯ <code>queueMicrotask(callback)</code>?</span></a></h3><p>åœ¨ JavaScript ä¸­ï¼Œ<code>queueMicrotask</code> æ˜¯ä¸€ç§å°†ä¸€ä¸ªä»»åŠ¡æ’è¿›å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆmicrotask queueï¼‰çš„æ–¹æ³•ã€‚è¿™æ„å‘³ç€ä½ é€šè¿‡è¿™ä¸ªæ–¹æ³•æ·»åŠ çš„ä»»åŠ¡ä¼šåœ¨å½“å‰æ‰§è¡Œæ ˆæ¸…ç©ºä¹‹åç«‹å³æ‰§è¡Œï¼Œä½†æ˜¯åœ¨ä»»ä½•å…¶ä»–å®ä»»åŠ¡ï¼ˆä¾‹å¦‚è®¾ç½®æ—¶é—´å»¶è¿Ÿçš„ <code>setTimeout</code>ã€<code>setInterval</code>ï¼‰ä¹‹å‰æ‰§è¡Œã€‚</p><p>å¾®ä»»åŠ¡ï¼ˆmicrotasksï¼‰ä¸»è¦åŒ…æ‹¬ Promise å›è°ƒå’Œé€šè¿‡ <code>queueMicrotask</code> æ·»åŠ çš„ä»»åŠ¡ã€‚ä½¿ç”¨ <code>queueMicrotask</code> ç›¸æ¯”ç›´æ¥ä½¿ç”¨ Promiseï¼ˆä¾‹å¦‚ <code>Promise.resolve().then(callback)</code>ï¼‰ï¼Œæä¾›äº†ä¸€ç§æ›´ç›´æ¥ã€è¯­ä¹‰åŒ–çš„æ–¹å¼è¿›è¡Œå¾®ä»»åŠ¡è°ƒåº¦ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-6"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ›´æ–°çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ›´æ–°çŠ¶æ€"><span>ä¾‹å­ 1: åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ›´æ–°çŠ¶æ€</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦åœ¨æ•°æ®å¤„ç†å®Œæ¯•åæ›´æ–°æŸäº›çŠ¶æ€ï¼Œä½†æƒ³ç¡®ä¿è¿™ä¸ªæ›´æ–°æ“ä½œå‘ç”Ÿåœ¨å½“å‰äº‹ä»¶å¾ªç¯ç»“æŸä¹‹åï¼Œä»¥é¿å…é˜»å¡å…¶å®ƒç´§æ€¥æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¼‚æ­¥çš„æ•°æ®å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å¤„ç†æ•°æ®: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ•°æ®å¤„ç†å®Œæˆåï¼Œæˆ‘ä»¬å¸Œæœ›æ›´æ–°çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  queueMicrotask</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ›´æ–°çŠ¶æ€å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¤ºä¾‹æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ— è®º <code>processData</code> å‡½æ•°çš„å¤„ç†é€»è¾‘å¤šå¤æ‚ï¼ŒçŠ¶æ€æ›´æ–°çš„ä»£ç æ€»æ˜¯åœ¨å½“å‰ JavaScript æ‰§è¡Œæ ˆå®Œæˆåã€ä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹å‰æ‰§è¡Œã€‚</p><h4 id="ä¾‹å­-2-é¿å…å †æ ˆæº¢å‡º" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-é¿å…å †æ ˆæº¢å‡º"><span>ä¾‹å­ 2: é¿å…å †æ ˆæº¢å‡º</span></a></h4><p>å½“ä½ æœ‰ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨æ²¡æœ‰åˆ°è¾¾é€’å½’ç»ˆç‚¹æ—¶ä¼šä¸æ–­åœ°è°ƒç”¨è‡ªå·±ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å †æ ˆæº¢å‡ºé”™è¯¯ã€‚ä½¿ç”¨ <code>queueMicrotask</code> å¯ä»¥æœ‰æ•ˆé¿å…è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒæŠŠæ–°çš„è°ƒç”¨æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·å¯ä»¥ä¿æŒå †æ ˆçš„æ¸…æ´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> recursiveFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    queueMicrotask</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> recursiveFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">recursiveFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ä¸ä¼šå¯¼è‡´å †æ ˆæº¢å‡º</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨éƒ½è¢«æ’å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»å‰ä¸€ä¸ªè°ƒç”¨ä¸­åŒæ­¥åœ°è¿›è¡Œï¼Œä»è€Œé¿å…äº†å †æ ˆæº¢å‡ºçš„é£é™©ã€‚</p><h3 id="æ€»ç»“-11" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-11"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>queueMicrotask</code> åœ¨ Node.js çš„å®ç”¨æ€§ã€‚å®ƒä½¿å¾—å¾®ä»»åŠ¡è°ƒåº¦å˜å¾—ç®€å•ä¸”ç›´è§‚ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ç¡®ä¿æŸäº›ä»»åŠ¡åœ¨å½“å‰æ‰§è¡Œç¯å¢ƒç»“æŸåç«‹å³æ‰§è¡Œï¼Œä½†åˆä¸å¸Œæœ›é˜»å¡åç»­å®ä»»åŠ¡æ—¶éå¸¸æœ‰ç”¨ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜èƒ½å¸®åŠ©æˆ‘ä»¬ä¼˜é›…åœ°å¤„ç†åƒé€’å½’è¿™ç±»å¯èƒ½å¯¼è‡´å †æ ˆæº¢å‡ºçš„æ“ä½œã€‚</p><h2 id="class-readablebytestreamcontroller" tabindex="-1"><a class="header-anchor" href="#class-readablebytestreamcontroller"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-readablebytestreamcontroller" target="_blank" rel="noopener noreferrer">Class: ReadableByteStreamController</a></span></a></h2><p>Node.js ä¸­çš„<code>ReadableByteStreamController</code>æ˜¯ä¸€ä¸ªå†…éƒ¨æ„å»ºçš„ç±»ï¼Œå®ƒæ˜¯ç”¨æ¥æ§åˆ¶å¯è¯»æµï¼ˆReadable Streamï¼‰çš„å­—èŠ‚æ•°æ®çš„ä¸€ä¸ªæ¥å£ã€‚åœ¨è§£é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼š</p><ol><li><p><strong>æµï¼ˆStreamsï¼‰</strong>: åœ¨ç¼–ç¨‹ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—è¿ç»­çš„æ•°æ®å…ƒç´ ï¼Œè¿™äº›å…ƒç´ å¯ä»¥é€ä¸ªåœ°è¿›è¡Œå¤„ç†ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®ã€‚æµå¯ä»¥ç”¨äºè¯»å–æˆ–å†™å…¥å¤§æ–‡ä»¶ï¼Œç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚</p></li><li><p><strong>å¯è¯»æµï¼ˆReadable Streamsï¼‰</strong>: è¿™ç§ç±»å‹çš„æµç”¨äºè¯»å–æ•°æ®ã€‚ä½ å¯ä»¥æƒ³è±¡æˆæ°´æµä»ä¸€ç«¯æµå‘å¦ä¸€ç«¯ï¼Œå…¶ä¸­æ•°æ®ä»æºå¤´ï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰æµå‘æ¶ˆè´¹è€…ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ°<code>ReadableByteStreamController</code>ã€‚è¿™ä¸ªç±»æ˜¯ Node.js å†…éƒ¨ä½¿ç”¨çš„ï¼Œå¹¶ä¸å¸¸ç›´æ¥æš´éœ²ç»™æ™®é€šå¼€å‘è€…ã€‚å®ƒè¢«ç”¨äºåº•å±‚çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯å½“ä½ åˆ›å»ºè‡ªå·±çš„å®šåˆ¶çš„å¯è¯»æµæ—¶ã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€äº›æ–¹æ³•å’Œå±æ€§æ¥ç›‘è§†å’Œæ§åˆ¶æµçš„çŠ¶æ€å’Œè¡Œä¸ºã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯è¯»æµæ¥å¤„ç†åƒæ–‡ä»¶çš„å­—èŠ‚æ•°æ®ï¼Œ<code>ReadableByteStreamController</code>å¯ä»¥å¸®åŠ©ä½ æ§åˆ¶æ•°æ®çš„ä¼ è¾“ï¼Œæ¯”å¦‚ç¡®å®šä½•æ—¶ä¸€ä¸ªæ•°æ®å—å·²ç»è¢«å‘é€ï¼Œæˆ–è€…æµåº”è¯¥ç»“æŸäº†ã€‚</p><p>ä¸‹é¢æ˜¯<code>ReadableByteStreamController</code>çš„å‡ ä¸ªå…³é”®ç‰¹æ€§ï¼š</p><ul><li><strong>enqueue(chunk)</strong>: ç”¨æ¥å°†ä¸€ä¸ªæ–°çš„æ•°æ®å—æ·»åŠ åˆ°æµä¸­ã€‚<code>chunk</code>å¿…é¡»æ˜¯ä¸€ä¸ª<code>Buffer</code>æˆ–è€…ä¸€ä¸ª<code>Uint8Array</code>ï¼Œè¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®ã€‚</li><li><strong>close()</strong>: å½“æ²¡æœ‰æ›´å¤šçš„æ•°æ®éœ€è¦æ·»åŠ åˆ°æµæ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ¥å…³é—­æµã€‚</li><li><strong>error(e)</strong>: å¦‚æœåœ¨å¤„ç†æµæ—¶é‡åˆ°é”™è¯¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä¼šä¼ æ’­é”™è¯¯ä¿¡æ¯ã€‚</li><li><strong>desiredSize</strong>: è¿™æ˜¯ä¸€ä¸ª getter å±æ€§ï¼Œè¿”å›æµä¸­è¿˜èƒ½æ¥å—å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œå¦‚æœæµå·²ç»æ»¡äº†å°±è¿”å› 0ã€‚</li></ul><p>å› ä¸º<code>ReadableByteStreamController</code>é€šå¸¸ç”¨äºåº•å±‚å¼€å‘ï¼Œæ‰€ä»¥å®ƒä¸å¤ªé€‚åˆç¼–ç¨‹åˆå­¦è€…ã€‚ç›¸å¯¹æ¥è¯´ï¼Œä½ å¯èƒ½ä¼šæ›´å¸¸ä¸<code>fs.createReadStream</code>è¿™æ ·çš„ API æ‰“äº¤é“ï¼Œç”¨äºè¯»å–æ–‡ä»¶ç­‰æ“ä½œã€‚</p><p>ä¸¾ä¸€ä¸ªæŠ½è±¡çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œç”¨äºé€æ­¥è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶å¹¶è¿›è¡Œå¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyCustomReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆå§‹åŒ–ä»£ç ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // _readæ˜¯å†…éƒ¨æ–¹æ³•ï¼ŒNode.jsä¼šåœ¨éœ€è¦æ•°æ®çš„æ—¶å€™è°ƒç”¨å®ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¨¡æ‹Ÿå¼‚æ­¥è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™ä¸ªå‡½æ•°è´Ÿè´£è·å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨pushæ–¹æ³•æ¥å‘é€æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœæ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œå‘é€nullæ¥å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyCustomReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;There will be no more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨<code>ReadableByteStreamController</code>ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨äº†<code>Readable</code>ç±»æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¯è¯»æµã€‚åœ¨å†…éƒ¨ï¼ŒNode.js å¯èƒ½ä¼šä½¿ç”¨ç±»ä¼¼<code>ReadableByteStreamController</code>çš„æœºåˆ¶æ¥ç®¡ç†ç”±<code>_read</code>æ–¹æ³•æä¾›çš„æ•°æ®æµã€‚</p><h2 id="class-readablestream" tabindex="-1"><a class="header-anchor" href="#class-readablestream"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-readablestream" target="_blank" rel="noopener noreferrer">Class: ReadableStream</a></span></a></h2><p>å½“ä½ å¬åˆ° Node.js ä¸­çš„<code>ReadableStream</code>ï¼Œå¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªä¸æ–­æµåŠ¨çš„æ°´ç®¡ã€‚åœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œï¼Œè¿™ä¸ªâ€œæ°´ç®¡â€ä¸æ˜¯ä¼ è¾“æ°´ï¼Œè€Œæ˜¯ä¼ è¾“æ•°æ®ã€‚<code>ReadableStream</code>æ˜¯ä¸€ç§èƒ½è®©ä½ ä»¥ä¸€ç§é«˜æ•ˆã€é¡ºåºçš„æ–¹å¼å¤„ç†æ•°æ®æµçš„å·¥å…·ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-stream" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-stream"><span>ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStream æ˜¯å¤„ç†è¯»å†™å¤§é‡æ•°æ®çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ï¼Œä¸€æ¬¡æ€§è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜ä¸­å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–è¿è¡Œç¼“æ…¢ã€‚ä½¿ç”¨ Streamï¼Œä½ å¯ä»¥åˆ†æ‰¹æ¬¡åœ°è¯»å–å’Œå¤„ç†æ•°æ®ï¼Œå°±åƒä½ å¯ä»¥æŠŠä¸€å£¶æ°´å€’å…¥æ¯å­ä¸€æ ·ä¸€ç‚¹ä¸€ç‚¹å€’ï¼Œè€Œä¸æ˜¯è¯•å›¾ä¸€æ¬¡æ€§å…¨éƒ¨åä¸‹ã€‚</p><h3 id="readablestream-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#readablestream-çš„ä½œç”¨"><span>ReadableStream çš„ä½œç”¨</span></a></h3><p><code>ReadableStream</code>ç‰¹åˆ«æŒ‡çš„æ˜¯é‚£äº›ç”¨äºè¯»å–æ•°æ®çš„ Streamã€‚è¿™æ„å‘³ç€æ•°æ®å¯ä»¥ä»ä¸€ä¸ª<code>ReadableStream</code>&quot;æµå‡º&quot;ï¼Œå°±åƒæ°´ä»æ°´ç®¡æµå‡ºä¸€æ ·ã€‚è¿™å¯¹äºå¤„ç†è¯¸å¦‚æ¥è‡ªæ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚æˆ–å…¶ä»–è¾“å…¥æºçš„å¤§é‡æ•°æ®å°¤å…¶æœ‰ç”¨ã€‚</p><h3 id="readablestream-çš„å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#readablestream-çš„å®é™…åº”ç”¨"><span>ReadableStream çš„å®é™…åº”ç”¨</span></a></h3><ol><li><p><strong>æ–‡ä»¶å¤„ç†</strong>ï¼š<br> å‡è®¾ä½ éœ€è¦è¯»å–ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶å¹¶åˆ†æé‡Œé¢çš„å†…å®¹ã€‚ä½¿ç”¨<code>fs.createReadStream()</code>æ–¹æ³•ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥æ–‡ä»¶çš„<code>ReadableStream</code>ï¼Œç„¶åé€å—è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶è½½å…¥å†…å­˜ã€‚è¿™æ ·åšå¯ä»¥æ˜¾è‘—é™ä½å†…å­˜ä½¿ç”¨ï¼Œå¹¶æé«˜åº”ç”¨æ€§èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘å¤§æ–‡ä»¶çš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received a chunk of data with size </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼š<br> å½“ä½ å‘é€ä¸€ä¸ª HTTP è¯·æ±‚è·å–æŸäº›èµ„æºï¼ˆæ¯”å¦‚ä» API è·å–æ•°æ®ï¼‰æ—¶ï¼Œå“åº”ä½“å¯èƒ½éå¸¸å¤§ã€‚å¦‚æœä½¿ç”¨<code>ReadableStream</code>ï¼Œä½ å¯ä»¥é€æ­¥å¤„ç†è¿™äº›æ•°æ®ï¼Œæ¯”å¦‚è§£æ JSON æ•°æ®æµï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªæ•°æ®ä¸‹è½½å®Œæˆã€‚è¿™æœ‰åŠ©äºæå‡åº”ç”¨å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚</p></li><li><p><strong>æ•°æ®è½¬æ¢</strong>ï¼š<br><code>ReadableStream</code>å¯ä»¥ä¸<code>WritableStream</code>ç»“åˆä½¿ç”¨ï¼Œå®ç°æ•°æ®çš„å®æ—¶è½¬æ¢ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦å°†ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­çš„æ•°æ®è¯»å–å‡ºæ¥ï¼Œè½¬æ¢æ ¼å¼åå†å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚é€šè¿‡<code>pipe</code>æ–¹æ³•ï¼Œå¯ä»¥è½»æ¾åœ°å°†<code>ReadableStream</code>çš„è¾“å‡ºè¿æ¥åˆ°<code>WritableStream</code>çš„è¾“å…¥ï¼Œå®ç°æ•°æ®çš„æµå¼è½¬æ¢ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Node.jsæ ¸å¿ƒæ¨¡å—ï¼Œç”¨äºæ•°æ®å‹ç¼©</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè¯»å–æµå’Œä¸€ä¸ªå†™å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨zlib.createGzip()åˆ›å»ºä¸€ä¸ªè½¬æ¢æµï¼Œå°†æ•°æ®å‹ç¼©æˆ.gzæ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç®¡é“é“¾ï¼šè¯»å– -&gt; å‹ç¼© -&gt; å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>ReadableStream</code>åœ¨å¤„ç†å¤§å‹æ•°æ®ã€ä¼˜åŒ–æ€§èƒ½å’Œå¢å¼ºç”¨æˆ·ä½“éªŒæ–¹é¢çš„é‡è¦æ€§ã€‚åœ¨ Node.js çš„ä¸–ç•Œé‡Œï¼Œç†Ÿç»ƒæŒæ¡ Streams æ— ç–‘æ˜¯ä¸€é¡¹éå¸¸æœ‰ä»·å€¼çš„æŠ€èƒ½ã€‚</p><h2 id="class-readablestreambyobreader" tabindex="-1"><a class="header-anchor" href="#class-readablestreambyobreader"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-readablestreambyobreader" target="_blank" rel="noopener noreferrer">Class: ReadableStreamBYOBReader</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œ<code>ReadableStreamBYOBReader</code>ï¼ˆBring Your Own Buffer Readerï¼‰æ˜¯ä¸€ä¸ªç›¸å¯¹é«˜çº§çš„æ¦‚å¿µï¼Œå®ƒå±äºæµ(Streams) API çš„ä¸€éƒ¨åˆ†ã€‚è¦ç†è§£<code>ReadableStreamBYOBReader</code>ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><p><strong>æµ (Streams):</strong> åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œæ˜¯æ•°æ®çš„ç®¡é“ã€‚é€šè¿‡æµï¼Œæˆ‘ä»¬å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¿…ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨æ‰å¼€å§‹å¤„ç†ã€‚</p></li><li><p><strong>å¯è¯»æµ (Readable Streams):</strong> æ˜¯ä¸€ç§æµï¼Œå…è®¸ä½ è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶æˆ–è€…ä»ç½‘ç»œè¯·æ±‚ä¸­æ¥æ”¶æ•°æ®æ—¶ï¼Œä½ ä¼šä½¿ç”¨åˆ°å¯è¯»æµã€‚</p></li><li><p><strong>BYOBï¼ˆBring Your Own Bufferï¼‰:</strong> è¿™æ˜¯ä¸€ç§é«˜æ•ˆå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„æœºåˆ¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå…è®¸ä½ æä¾›ä¸€ä¸ªè‡ªå·±çš„ç¼“å†²åŒºï¼ˆä¸€ä¸ªå­˜æ”¾æ•°æ®çš„å®¹å™¨ï¼‰ï¼Œç„¶åç›´æ¥å°†æ•°æ®è¯»å…¥è¿™ä¸ªç¼“å†²åŒºä¸­ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†…å­˜çš„ä½¿ç”¨å’Œå¤åˆ¶æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥<code>ReadableStreamBYOBReader</code>ï¼š</p><h3 id="readablestreambyobreader-ç±»" tabindex="-1"><a class="header-anchor" href="#readablestreambyobreader-ç±»"><span><code>ReadableStreamBYOBReader</code> ç±»</span></a></h3><p><code>ReadableStreamBYOBReader</code>ç±»å…è®¸ä½ ä»¥ä¸€ç§æ›´æ§åˆ¶å’Œé«˜æ•ˆçš„æ–¹å¼è¯»å–æµä¸­çš„æ•°æ®ã€‚å®ƒçš„â€œBYOBâ€ç‰¹æ€§ä½¿å¾—ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„ç¼“å†²åŒºï¼ˆBufferï¼‰ï¼Œç›´æ¥å°†æ•°æ®è¯»å–åˆ°è¿™ä¸ªç¼“å†²åŒºä¸­ï¼Œè€Œæ— éœ€æµè‡ªåŠ¨ä¸ºä½ åˆ›å»ºæ–°çš„ç¼“å†²åŒºã€‚è¿™ç§æ–¹æ³•ä¸»è¦ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚æ–‡ä»¶å’Œç½‘ç»œé€šä¿¡ï¼Œå…¶ä¸­æ€§èƒ½éå¸¸å…³é”®ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-7"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><p>è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li><p><strong>æ–‡ä»¶å¤„ç†:</strong> å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§å‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨<code>ReadableStreamBYOBReader</code>ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œæ¯”å¦‚æ¯æ¬¡è¯»å– 4KB çš„æ•°æ®ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨æ§åˆ¶å†…å­˜ä½¿ç”¨çš„åŒæ—¶ï¼Œæœ‰æ•ˆç‡åœ°é€æ­¥å¤„ç†æ•´ä¸ªæ–‡ä»¶ã€‚</p></li><li><p><strong>è§†é¢‘æµå¤„ç†:</strong> å¦‚æœä½ æ­£åœ¨å®ç°ä¸€ä¸ªéœ€è¦å¤„ç†è§†é¢‘æ•°æ®çš„åŠŸèƒ½ï¼Œå¯èƒ½éœ€è¦ä»ç½‘ç»œè·å–è§†é¢‘æµå¹¶è¿›è¡Œå¤„ç†ã€‚é€šè¿‡ä½¿ç”¨<code>ReadableStreamBYOBReader</code>ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªç¼“å†²åŒºæ¥æ¥æ”¶è§†é¢‘æ•°æ®å—ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°ç®¡ç†å†…å­˜å’Œå¤„ç†é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†é«˜æ¸…è§†é¢‘æµæ—¶ã€‚</p></li><li><p><strong>ç½‘ç»œé€šä¿¡:</strong> å½“ä½ çš„åº”ç”¨ä¸å…¶ä»–æœåŠ¡é€šè¿‡ TCP æˆ– UDP åè®®äº¤æ¢å¤§é‡æ•°æ®æ—¶ï¼Œä½¿ç”¨<code>ReadableStreamBYOBReader</code>å¯ä»¥å¸®åŠ©ä½ æ›´ç²¾ç¡®åœ°æ§åˆ¶æ•°æ®çš„æ¥æ”¶æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ ¹æ®å½“å‰çš„å¤„ç†èƒ½åŠ›å’Œå†…å­˜ä½¿ç”¨æƒ…å†µåŠ¨æ€è°ƒæ•´ç¼“å†²åŒºçš„å¤§å°ã€‚</p></li></ol><h3 id="å¦‚ä½•ä½¿ç”¨-7" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-7"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>ä½¿ç”¨<code>ReadableStreamBYOBReader</code>çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>è·å–ä¸€ä¸ªå¯è¯»æµã€‚</li><li>åˆ›å»ºä¸€ä¸ª<code>ReadableStreamBYOBReader</code>å®ä¾‹ï¼Œä¼ å…¥è¿™ä¸ªå¯è¯»æµã€‚</li><li>åˆ›å»ºä¸€ä¸ª Bufferï¼ˆä½ çš„â€œBYOBâ€ï¼‰ã€‚</li><li>ä½¿ç”¨<code>read()</code>æ–¹æ³•è¯»å–æ•°æ®åˆ°ä½ çš„ Buffer ä¸­ã€‚</li></ol><p>è¯·æ³¨æ„ï¼Œç”±äºæ­¤ API çš„å¤æ‚æ€§å’Œä¸“ä¸šæ€§ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®ƒä¸»è¦è¢«ç”¨äºç‰¹å®šçš„æ€§èƒ½æ•æ„Ÿåœºæ™¯ã€‚å¦‚æœä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œå»ºè®®é¦–å…ˆç†Ÿæ‚‰åŸºæœ¬çš„æµæ“ä½œå’Œæ¦‚å¿µï¼Œç„¶åå†æ·±å…¥äº†è§£å’Œä½¿ç”¨<code>ReadableStreamBYOBReader</code>ã€‚</p><h2 id="class-readablestreambyobrequest" tabindex="-1"><a class="header-anchor" href="#class-readablestreambyobrequest"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-readablestreambyobrequest" target="_blank" rel="noopener noreferrer">Class: ReadableStreamBYOBRequest</a></span></a></h2><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>ReadableStreamBYOBRequest</code> æ˜¯ä¸€ä¸ªç±»ï¼Œä»£è¡¨äº† &quot;Bring Your Own Buffer&quot; (BYOB) è¯»å–è¯·æ±‚çš„æ¦‚å¿µã€‚å®ƒæ˜¯ç”¨äºæµå¼æ•°æ®å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”ä¸ <code>ReadableStream</code> ç±»å‹çš„æµç´§å¯†ç›¸å…³ã€‚è¿™ä¸ªç±»ä¸æ˜¯ç»å¸¸ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨åº•å±‚ç³»ç»Ÿå’Œåº“ä¸­å¤„ç†å­—èŠ‚æ•°æ®æ—¶ç”¨åˆ°ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><strong>æµ (Stream)</strong>ï¼šåœ¨ç¼–ç¨‹ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—è¿ç»­çš„æ•°æ®å…ƒç´ ï¼Œè¿™äº›æ•°æ®å…ƒç´ å¯ä»¥ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«è®¿é—®ã€‚å®ƒä»¬æ˜¯åŠ¨æ€çš„æ•°æ®é›†åˆï¼Œä½ å¯ä»¥ä»ä¸­è¯»å–æ•°æ®æˆ–å‘å…¶ä¸­å†™å…¥æ•°æ®ã€‚</li><li><strong>å¯è¯»æµ (Readable Stream)</strong>ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æµï¼Œä»ä¸­ä½ å¯ä»¥è¯»å–æ•°æ®ã€‚æ¯”å¦‚ï¼Œåœ¨ Node.js ä¸­ï¼Œå½“ä½ ä»æ–‡ä»¶ã€ç½‘ç»œç­‰æ¥æºè¯»å–æ•°æ®æ—¶ï¼Œä½ ä¼šä½¿ç”¨åˆ°å¯è¯»æµã€‚</li><li><strong>BYOB (&quot;Bring Your Own Buffer&quot;)</strong>ï¼šæ˜¯ä¸€ä¸ªé«˜çº§åˆ«çš„æ¦‚å¿µï¼Œå…è®¸è°ƒç”¨è€…æä¾›è‡ªå·±çš„ç¼“å†²åŒºï¼ˆå³å†…å­˜å—ï¼‰ï¼Œä»¥ä¾¿ä»æµä¸­è¯»å–æ•°æ®ç›´æ¥å¡«å……åˆ°è¿™ä¸ªç¼“å†²åŒºä¸­ã€‚è¿™å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºå®ƒå‡å°‘äº†å†…å­˜å¤åˆ¶æ“ä½œã€‚</li></ul><p>ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>ReadableStreamBYOBRequest</code> ç±»ï¼š</p><p><code>ReadableStreamBYOBRequest</code> å®ä¾‹æ˜¯ç”±æ”¯æŒ BYOB è¯»å–çš„å¯è¯»æµåˆ›å»ºçš„ã€‚å½“æµå‡†å¤‡å¥½å°†æ•°æ®å¡«å……è¿›è°ƒç”¨è€…æä¾›çš„ç¼“å†²åŒºæ—¶ï¼Œå®ƒä¼šç»™å‡ºä¸€ä¸ªè¯·æ±‚ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œä½ é€šå¸¸ä¸éœ€è¦ç›´æ¥åˆ›å»ºæˆ–ä½¿ç”¨è¿™ä¸ªç±»ï¼Œå®ƒæ›´å¤šå‡ºç°åœ¨å®ç°è‡ªå®šä¹‰å¯è¯»æµæˆ–è€…ä¸åº•å±‚ç³»ç»Ÿäº¤äº’æ—¶ã€‚</p><p>è¿™ä¸ªç±»ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>respond(bytesWritten)</code>ï¼šå®Œæˆè¯»å–æ“ä½œå¹¶æŒ‡ç¤ºå·²ç»å†™å…¥<code>bytesWritten</code>å­—èŠ‚æ•°åˆ°ç¼“å†²åŒºã€‚</li><li><code>respondWithNewView(view)</code>ï¼šå®Œæˆè¯»å–æ“ä½œä½†ä½¿ç”¨ä¸€ä¸ªæ–°çš„ <code>ArrayBufferView</code> æ¥æ›¿ä»£åŸæ¥çš„ç¼“å†²åŒºã€‚</li></ul><p>å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¸ä¼šç›´æ¥è·Ÿ<code>ReadableStreamBYOBRequest</code>æ‰“äº¤é“ï¼Œä½†å¦‚æœä½ åœ¨åˆ›å»ºæ›´åŠ åº•å±‚çš„åº“æˆ–è€…éœ€è¦å¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œç†è§£è¿™ä¸ªç±»å°±å¾ˆé‡è¦äº†ã€‚</p><p>ä¸¾ä¸ªå®ä¾‹æ¥è¯´æ˜ï¼Œå‡è®¾ä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªéå¸¸å¤§çš„æ•°æ®æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼Œä½ æƒ³è¾¹è¯»è¾¹å¤„ç†è¿™ä¸ªæ–‡ä»¶ã€‚ä½¿ç”¨ä¼ ç»Ÿçš„æµå¤„ç†æ–¹å¼ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å†…å­˜ç®¡ç†ä¸å½“æˆ–è€…æ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜ã€‚è€Œåˆ©ç”¨ BYOB æ¨¡å¼ï¼Œä½ å¯ä»¥æ§åˆ¶æ•°æ®æ˜¯å¦‚ä½•è¢«è¯»å–å’Œå¡«å……åˆ°ç¼“å†²åŒºçš„ï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°ç®¡ç†å†…å­˜ï¼Œå®ç°é«˜æ•ˆçš„æ•°æ®å¤„ç†ã€‚</p><p>ç®€å•ä»£ç ç¤ºä¾‹:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ”¯æŒBYOBçš„å¯è¯»æµsource</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getSomeBYOBCompatibleReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æµå‡†å¤‡å¥½æ¥å—ç¼“å†²åŒºæ—¶ä¼šè§¦å‘&#39;byob-request&#39;äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;byob-request&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åˆ›å»ºä¸€ä¸ª8KBå¤§å°çš„ç¼“å†²åŒº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ArrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8192</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Uint8Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç°åœ¨æˆ‘ä»¬æŠŠç¼“å†²åŒºæä¾›ç»™æµï¼Œå®ƒä¼šå¡«å……æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">view</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">view</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾æˆ‘ä»¬å®Œæˆäº†æ•°æ®çš„è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">respond</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8192</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®°ä½ï¼Œè¿™åªæ˜¯ä¸ºäº†å±•ç¤º <code>ReadableStreamBYOBRequest</code> çš„æ¦‚å¿µï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªçœŸå®çš„å®Œæ•´ç¤ºä¾‹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒBYOB é€šå¸¸ç»“åˆç€æµçš„æ§åˆ¶å™¨ï¼ˆ<code>ReadableStreamDefaultController</code>ï¼‰ç­‰å…¶ä»–ç»„ä»¶æ¥ä½¿ç”¨ã€‚</p><h2 id="class-readablestreamdefaultcontroller" tabindex="-1"><a class="header-anchor" href="#class-readablestreamdefaultcontroller"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-readablestreamdefaultcontroller" target="_blank" rel="noopener noreferrer">Class: ReadableStreamDefaultController</a></span></a></h2><p>åœ¨äº†è§£<code>ReadableStreamDefaultController</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç¡®å‡ ä¸ªæ¦‚å¿µï¼šNode.jsã€æµï¼ˆStreamï¼‰ã€ä»¥åŠå¯è¯»æµã€‚è®©æˆ‘æ¥ä¾æ¬¡ä¸ºä½ è§£é‡Šã€‚</p><h3 id="node-js" tabindex="-1"><a class="header-anchor" href="#node-js"><span>Node.js</span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚</p><h3 id="æµ-stream" tabindex="-1"><a class="header-anchor" href="#æµ-stream"><span>æµï¼ˆStreamï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“æ•°æ®é‡å¤§æˆ–è€…æ•°æ®è¿˜åœ¨äº§ç”Ÿæ—¶ã€‚æµå¯ä»¥å°†æ•°æ®åˆ†æˆå°å—è¿›è¡Œå¤„ç†å’Œä¼ è¾“ï¼Œè¿™æ ·å°±ä¸å¿…ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨æ‰å¼€å§‹å¤„ç†ã€‚</p><h3 id="å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ"><span>å¯è¯»æµ</span></a></h3><p>å¯è¯»æµæ˜¯ä¸€ç§æµï¼Œå®ƒç”¨äºä»æŸå¤„ï¼ˆå¦‚æ–‡ä»¶ã€HTTP å“åº”ç­‰ï¼‰è¯»å–æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£ç”¨ä¸€æ ¹å¸ç®¡å–å¥¶æ˜”ï¼Œå¸ç®¡é‡Œçš„å¥¶æ˜”å°±åƒæ˜¯é€šè¿‡å¯è¯»æµä¼ é€çš„æ•°æ®ã€‚</p><h3 id="readablestreamdefaultcontroller" tabindex="-1"><a class="header-anchor" href="#readablestreamdefaultcontroller"><span>ReadableStreamDefaultController</span></a></h3><p><code>ReadableStreamDefaultController</code>æ˜¯ Node.js ä¸­æµ API çš„ä¸€éƒ¨åˆ†ã€‚å®ƒæ˜¯ä¸€ä¸ªåº•å±‚æ¥å£ï¼Œä¸»è¦ç”¨äºç”±å¼€å‘äººå‘˜åˆ›å»ºçš„è‡ªå®šä¹‰å¯è¯»æµã€‚ç›´ç™½ç‚¹è¯´ï¼Œå¦‚æœä½ æƒ³è‡ªå®šä¹‰æµçš„è¡Œä¸ºï¼ˆæ¯”å¦‚æ€ä¹ˆè¯»æ•°æ®ï¼Œä½•æ—¶åœæ­¢è¯»æ•°æ®ç­‰ï¼‰ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ°å®ƒã€‚</p><p><code>ReadableStreamDefaultController</code>æä¾›äº†å‡ ä¸ªå…³é”®çš„æ–¹æ³•æ¥æ§åˆ¶æµçš„çŠ¶æ€å’Œè¡Œä¸ºï¼š</p><ul><li><code>close()</code>: è°ƒç”¨æ­¤æ–¹æ³•ä¼šå…³é—­æµï¼Œæ„å‘³ç€æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯ä»¥è¯»å–ã€‚</li><li><code>enqueue(chunk)</code>: é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å‘æµä¸­æ·»åŠ æ•°æ®å—ï¼ˆchunkï¼‰ã€‚è¿™ç›¸å½“äºè¯´ï¼Œâ€œè¿™é‡Œæœ‰æ›´å¤šæ•°æ®å¯ä»¥è¯»ã€‚â€</li><li><code>error(e)</code>: å¦‚æœåœ¨å¤„ç†æµçš„è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œå¯ä»¥è°ƒç”¨æ­¤æ–¹æ³•æ¥æŠ¥å‘Šé”™è¯¯ã€‚</li></ul><h3 id="å®é™…åº”ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨æ¡ˆä¾‹"><span>å®é™…åº”ç”¨æ¡ˆä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§å‹æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶ä¸”å®æ—¶åœ°å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚ä½¿ç”¨æ ‡å‡†çš„è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­çš„æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å¯è¯»æµæ¥é€æ¸—è¯»å–å’Œå‘é€æ–‡ä»¶å†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿæ•°æ®ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å‡è®¾å½“è¯»åˆ°10æ¬¡æ•°æ®åç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ null æ¥è¡¨ç¤ºæµçš„ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Data chunk </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataIndex</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨é€æ•°æ®åˆ°æµä¸­</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»¶è¿Ÿæ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»<code>MyReadableStream</code>ï¼Œç»§æ‰¿å¹¶å®ç°äº†<code>Readable</code>ç±»çš„<code>_read</code>æ–¹æ³•ã€‚åœ¨<code>_read</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿå¼‚æ­¥åœ°è¯»å–æ•°æ®ï¼ˆè¿™é‡Œç®€åŒ–ä¸ºä½¿ç”¨<code>setTimeout</code>ï¼‰ï¼Œå¹¶ä½¿ç”¨<code>push</code>æ–¹æ³•å°†æ•°æ®å—å‘é€å‡ºå»ã€‚å½“æ•°æ®è¯»å–å®Œæ¯•æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>push(null)</code>æ¥é€šçŸ¥æµç»“æŸã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>ReadableStreamDefaultController</code>æ˜¯åœ¨ Node.js ä¸­ç®¡ç†å’Œæ§åˆ¶è‡ªå®šä¹‰å¯è¯»æµè¡Œä¸ºçš„å…³é”®å·¥å…·ï¼Œå°½ç®¡ç›´æ¥ä½¿ç”¨çš„åœºæ™¯ä¸å¤šï¼Œä½†å®ƒä¸º Node.js ä¸­çš„æ•°æ®æµæ“ä½œæä¾›äº†å¼ºå¤§çš„åº•å±‚æ”¯æŒã€‚</p><h2 id="class-readablestreamdefaultreader" tabindex="-1"><a class="header-anchor" href="#class-readablestreamdefaultreader"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-readablestreamdefaultreader" target="_blank" rel="noopener noreferrer">Class: ReadableStreamDefaultReader</a></span></a></h2><p>Node.js çš„<code>ReadableStreamDefaultReader</code>æ˜¯ä¸€ä¸ªä¸æµï¼ˆæ•°æ®çš„è¿ç»­ä¼ è¾“ï¼‰ç›¸å…³çš„å¯¹è±¡ï¼Œç”¨äºé€æ®µè¯»å–æ¥è‡ªä¸€ä¸ª<code>ReadableStream</code>çš„æ•°æ®ã€‚è¿™ä¸ªæ¦‚å¿µå¯èƒ½å¬èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œä½†æˆ‘ä¼šé€šè¿‡ä¸€äº›å®é™…ä¾‹å­å¸®ä½ æ›´å¥½åœ°ç†è§£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-3"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><strong>æµï¼ˆStreamï¼‰</strong>ï¼šåœ¨ç¼–ç¨‹ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—è¿ç»­çš„æ•°æ®ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®å¦‚åŒæ°´æ»´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚åœ¨ Node.js ä¸­ï¼Œæµè¢«ç”¨äºå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®åˆ†å—å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®é›†åˆåˆ°å†…å­˜ä¸­ã€‚</li><li><strong>ReadableStream</strong>ï¼šä¸€ä¸ªå¯è¯»æµå…è®¸ä½ è¯»å–æ•°æ®ã€‚å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªæ•°æ®æºï¼Œä¾‹å¦‚æ–‡ä»¶ã€HTTP å“åº”ä½“ç­‰ã€‚</li></ul><h3 id="readablestreamdefaultreader" tabindex="-1"><a class="header-anchor" href="#readablestreamdefaultreader"><span><code>ReadableStreamDefaultReader</code></span></a></h3><p><code>ReadableStreamDefaultReader</code>æ˜¯ç”¨äºæŒ‰é¡ºåºä»<code>ReadableStream</code>ä¸­è¯»å–æ•°æ®çš„æ ‡å‡†æ¥å£ã€‚å½“ä½ æœ‰ä¸€ä¸ª<code>ReadableStream</code>å®ä¾‹æ—¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>ReadableStreamDefaultReader</code>æ¥æŒ‰å—ï¼ˆchunkï¼‰è¯»å–æµä¸­çš„æ•°æ®ã€‚</p><h4 id="å¦‚ä½•ä½¿ç”¨-8" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-8"><span>å¦‚ä½•ä½¿ç”¨</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³è¦é€è¡Œè¯»å–æ­¤æ–‡ä»¶è€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä½¿ç”¨<code>ReadableStreamDefaultReader</code>å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿™æ ·åšã€‚</p><h5 id="æ­¥éª¤-1-åˆ›å»º-readablestream" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-åˆ›å»º-readablestream"><span>æ­¥éª¤ 1: åˆ›å»º ReadableStream</span></a></h5><p>é¦–å…ˆï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª<code>ReadableStream</code>ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å„ç§æ–¹å¼è·å–å®ƒï¼Œä¾‹å¦‚ä» HTTP å“åº”æˆ–è€…ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªReadableStream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ­¥éª¤-2-ä½¿ç”¨-readablestreamdefaultreader-è¯»å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-ä½¿ç”¨-readablestreamdefaultreader-è¯»å–æ•°æ®"><span>æ­¥éª¤ 2: ä½¿ç”¨ ReadableStreamDefaultReader è¯»å–æ•°æ®</span></a></h5><p>ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨<code>ReadableStream</code>åˆ›å»ºä¸€ä¸ª<code>ReadableStreamDefaultReader</code>æ¥è¯»å–æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™é‡Œçš„readableStreamæ˜¯ä½ å·²ç»è·å–çš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶é€€å‡ºå¾ªç¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°å‡ºæ¥çš„å€¼å°±æ˜¯è¯»å–åˆ°çš„æ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ–‡ä»¶å¤„ç†</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦å¤„ç†éå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ã€‚ä½¿ç”¨<code>ReadableStreamDefaultReader</code>å¯ä»¥å¸®åŠ©ä½ é€è¡Œè¯»å–æ—¥å¿—ï¼Œè¿›è¡Œåˆ†ææˆ–è€…ç»Ÿè®¡ï¼Œè€Œä¸éœ€è¦å°†æ•´ä¸ªæ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ã€‚</p></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼šå½“ä½ ä»ä¸€ä¸ª API è·å–å¤§é‡æ•°æ®æ—¶ï¼Œæ¯”å¦‚ä¸‹è½½ä¸€ä¸ªå¤§æ–‡ä»¶æˆ–è€…è§†é¢‘æµæ—¶ï¼Œ<code>ReadableStreamDefaultReader</code>å¯ä»¥å¸®åŠ©ä½ æŒ‰å—å¤„ç†è¿™äº›æ•°æ®ï¼Œä¾‹å¦‚è¾¹ä¸‹è½½è¾¹å¤„ç†æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªä¸‹è½½å®Œæˆã€‚</p></li></ol><h3 id="æ€»ç»“-12" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-12"><span>æ€»ç»“</span></a></h3><p><code>ReadableStreamDefaultReader</code>æä¾›äº†ä¸€ç§é«˜æ•ˆçš„æ–¹æ³•æ¥å¤„ç†å¤§é‡æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨èµ„æºå—é™çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚å†…å­˜ï¼‰ã€‚é€šè¿‡æŒ‰éœ€é€å—è¯»å–æ•°æ®ï¼Œå®ƒä½¿å¾—å³ä½¿æ˜¯å¤„ç†å¤§å‹æ–‡ä»¶æˆ–æ•°æ®æµä¹Ÿå˜å¾—å®¹æ˜“å’Œå¯ç®¡ç†ã€‚</p><h2 id="require" tabindex="-1"><a class="header-anchor" href="#require"><span><a href="https://nodejs.org/docs/latest/api/globals.html#require" target="_blank" rel="noopener noreferrer">require()</a></span></a></h2><p>Node.js ä¸­çš„<code>require()</code>å‡½æ•°æ˜¯ä¸€ä¸ªç”¨æ¥åŠ è½½æ¨¡å—çš„å…³é”®åŠŸèƒ½ã€‚å½“ä½ æƒ³è¦åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨å¦ä¸€ä¸ªæ–‡ä»¶æˆ–æ¨¡å—å¯¼å‡ºçš„ä»£ç æ—¶ï¼Œä½ ä¼šç”¨åˆ°<code>require()</code>ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½è¢«è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ã€‚å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚<code>main.js</code>ï¼‰ä¸­è®¿é—®å¦ä¸€ä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚<code>module.js</code>ï¼‰å¯¼å‡ºçš„å˜é‡ã€å‡½æ•°æˆ–å¯¹è±¡ï¼Œä½ éœ€è¦ä½¿ç”¨<code>require()</code>å‡½æ•°æ¥å¯¼å…¥å®ƒä»¬ã€‚</p><p>ä¸‹é¢æ˜¯<code>require()</code>çš„åŸºæœ¬ç”¨æ³•ï¼š</p><h3 id="åŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä½¿ç”¨"><span>åŸºæœ¬ä½¿ç”¨</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º<code>math.js</code>çš„æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€äº›æ•°å­¦ç›¸å…³çš„å‡½æ•°ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›å‡½æ•°ã€‚</p><p><strong>math.js:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> x</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> x</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨module.exportså¯¼å‡ºå‡½æ•°ï¼Œä½¿å¾—å…¶å®ƒæ–‡ä»¶å¯ä»¥é€šè¿‡require()è·å–</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨å¦ä¸€ä¸ªæ–‡ä»¶<code>main.js</code>ä¸­ä½¿ç”¨è¿™äº›æ•°å­¦å‡½æ•°ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨<code>require()</code>å¯¼å…¥<code>math.js</code>ã€‚</p><p><strong>main.js:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯¼å…¥math.jsæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> math</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./math&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mathæ¨¡å—ä¸­çš„å‡½æ•°äº†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> difference</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Sum: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sum</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Sum: 15</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Difference: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">difference</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Difference: 5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œåœ¨<code>require()</code>å‡½æ•°ä¸­æˆ‘ä»¬æä¾›äº†ç›¸å¯¹è·¯å¾„ï¼ˆ&#39;./math&#39;ï¼‰ï¼Œè¿™æ„å‘³ç€<code>math.js</code>å’Œ<code>main.js</code>ä½äºåŒä¸€ä¸ªç›®å½•ä¸‹ã€‚<code>require()</code>å‡½æ•°è¿”å›çš„æ˜¯<code>math.js</code>æ–‡ä»¶ä¸­é€šè¿‡<code>module.exports</code>å¯¼å‡ºçš„å†…å®¹ã€‚</p><h3 id="require-è§£æ" tabindex="-1"><a class="header-anchor" href="#require-è§£æ"><span><code>require()</code>è§£æ</span></a></h3><p>å½“ä½ è°ƒç”¨<code>require()</code>æ—¶ï¼ŒNode.js éµå¾ªä»¥ä¸‹æ­¥éª¤æ¥è§£æå’ŒåŠ è½½æ¨¡å—ï¼š</p><ol><li>è§£æç»™å®šçš„è·¯å¾„ï¼Œå¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚&#39;./module&#39;ï¼‰ï¼Œå®ƒå°†æ ¹æ®å½“å‰æ–‡ä»¶çš„ä½ç½®è¿›è¡Œè§£æã€‚</li><li>æŸ¥çœ‹æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</li><li>å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åŠ è½½è¯¥æ–‡ä»¶å¹¶æ‰§è¡Œå…¶å†…éƒ¨ä»£ç ã€‚</li><li>æœ€åï¼Œè¿”å›è¯¥æ–‡ä»¶é€šè¿‡<code>module.exports</code>å¯¼å‡ºçš„å†…å®¹ï¼Œä»¥ä¾¿åœ¨<code>require()</code>è¢«è°ƒç”¨çš„åœ°æ–¹ä½¿ç”¨ã€‚</li></ol><h3 id="å†…ç½®æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#å†…ç½®æ¨¡å—"><span>å†…ç½®æ¨¡å—</span></a></h3><p>Node.js è¿˜å…·æœ‰è®¸å¤šå†…ç½®æ¨¡å—ï¼Œä¾‹å¦‚<code>fs</code>ï¼ˆç”¨äºæ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼‰ã€<code>http</code>ï¼ˆç”¨äºåˆ›å»º HTTP æœåŠ¡å™¨ï¼‰ç­‰ï¼Œè¿™äº›æ¨¡å—ä¹Ÿå¯ä»¥ä½¿ç”¨<code>require()</code>æ¥åŠ è½½ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„<code>fs</code>æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯¼å…¥fsæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨fsæ¨¡å—è¯»å–æ–‡ä»¶çš„å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›ç›¸å¯¹è·¯å¾„æ¥åŠ è½½<code>fs</code>æ¨¡å—ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼ŒNode.js çŸ¥é“å¦‚ä½•æ‰¾åˆ°å®ƒã€‚</p><p>æ€»ä¹‹ï¼Œ<code>require()</code>å‡½æ•°æ˜¯ Node.js ä¸­ç”¨äºæ¨¡å—åŠ è½½å’Œå¯¼å…¥å…¶ä»–æ–‡ä»¶æˆ–æ¨¡å—åŠŸèƒ½çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå…è®¸ä½ ç»„ç»‡å’Œé‡ç”¨ä»£ç ã€‚é€šè¿‡æ¨¡å—åŒ–å¼€å‘ï¼Œä½ å¯ä»¥åˆ›å»ºå¯ç»´æŠ¤æ€§æ›´é«˜ã€ç»“æ„æ›´æ¸…æ™°çš„åº”ç”¨ç¨‹åºã€‚</p><h2 id="response" tabindex="-1"><a class="header-anchor" href="#response"><span><a href="https://nodejs.org/docs/latest/api/globals.html#response" target="_blank" rel="noopener noreferrer">Response</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼ŒResponse å¯¹è±¡æ˜¯ HTTP å“åº”çš„å°è£…ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å±æ€§å’Œæ–¹æ³•æ¥æ§åˆ¶æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>Response</code> æŒ‡çš„æ˜¯ <code>http.ServerResponse</code> ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨ HTTP äº¤äº’è¿‡ç¨‹ä¸­è¡¨ç¤ºæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å›åº”ã€‚å®ƒé€šå¸¸ç”± Node.js å†…éƒ¨åˆ›å»ºï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å®ä¾‹åŒ–å®ƒã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼ŒNode.js å°†ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ª Response å¯¹è±¡ï¼Œå¹¶å°†å®ƒä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™æˆ‘ä»¬å®šä¹‰çš„è¯·æ±‚å¤„ç†å‡½æ•°ã€‚</p><p>ä¸‹é¢æ˜¯å…³äº <code>Response</code> å¯¹è±¡çš„ä¸€äº›è¯´æ˜å’Œç®€å•ä½¿ç”¨ä¾‹å­ï¼š</p><h3 id="åˆ›å»ºä¸€ä¸ª-http-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-http-æœåŠ¡å™¨"><span>åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // req æ˜¯ IncomingMessage å®ä¾‹ï¼Œä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // res æ˜¯ ServerResponse å®ä¾‹ï¼Œç”¨äºæ„å»ºæœåŠ¡å™¨çš„å“åº”</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½® HTTP å¤´ä¿¡æ¯ï¼šçŠ¶æ€ç  200ã€å†…å®¹ç±»å‹ä¸º text/plain</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘é€å“åº”ä½“ &quot;Hello, World!&quot; å¹¶ç»“æŸå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://127.0.0.1:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬æœ¬åœ°çš„ 3000 ç«¯å£ã€‚å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®ƒå‘é€ä¸€ä¸ªæ–‡æœ¬å“åº” &quot;Hello, World!&quot; åˆ°å®¢æˆ·ç«¯ã€‚</p><h3 id="response-å¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#response-å¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•"><span>Response å¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•ï¼š</span></a></h3><ul><li><p><code>res.writeHead(statusCode[, statusMessage][, headers])</code>: å†™å…¥ HTTP å“åº”å¤´ã€‚<code>statusCode</code> æ˜¯çŠ¶æ€ç ï¼ˆå¦‚ 200ï¼Œ404 ç­‰ï¼‰ï¼Œ<code>statusMessage</code> æ˜¯å¯é€‰çš„çŠ¶æ€æ¶ˆæ¯ï¼Œé»˜è®¤æƒ…å†µä¸‹çŠ¶æ€ç å¯¹åº”çš„é»˜è®¤æ–‡æœ¬ä¼šè¢«è‡ªåŠ¨å¡«å……ï¼Œ<code>headers</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†è¦å‘é€çš„ HTTP å“åº”å¤´ã€‚</p></li><li><p><code>res.end([data][, encoding][, callback])</code>: ç»“æŸå“åº”è¿‡ç¨‹ã€‚å¦‚æœæŒ‡å®šäº†<code>data</code>ï¼Œåˆ™åœ¨ç»“æŸå“åº”ä¹‹å‰å‘é€æ•°æ®ï¼›<code>encoding</code> æ˜¯ç¼–ç æ–¹å¼ï¼›<code>callback</code> æ˜¯å½“å“åº”æµç»“æŸæ—¶çš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p><code>res.write(data[, encoding][, callback])</code>: å‘å“åº”ä½“å†™å…¥æ•°æ®ã€‚ä½¿ç”¨å¤šæ¬¡ <code>write</code> å¯ä»¥ç”Ÿæˆæ›´å¤æ‚çš„å“åº”å†…å®¹ã€‚é€šå¸¸åœ¨è°ƒç”¨ <code>end</code> æ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚</p></li></ul><p>è¯·æ³¨æ„ï¼ŒNode.js v21.7.1 æ˜¯æŒ‡ç‰¹å®šç‰ˆæœ¬çš„ Node.jsï¼Œåœ¨å…¶ä»–ç‰ˆæœ¬ä¸­ï¼ŒAPI å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†åŸºæœ¬åŸç†æ˜¯ç±»ä¼¼çš„ã€‚ä»¥ä¸Šå°±æ˜¯å…³äº Node.js ä¸­ <code>Response</code> å¯¹è±¡çš„ä»‹ç»å’Œä½¿ç”¨ç¤ºä¾‹ã€‚é€šè¿‡è¿™ä¸ªå¯¹è±¡ï¼Œä½ å¯ä»¥æ§åˆ¶è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”å†…å®¹å’Œæ ¼å¼ã€‚</p><h2 id="request" tabindex="-1"><a class="header-anchor" href="#request"><span><a href="https://nodejs.org/docs/latest/api/globals.html#request" target="_blank" rel="noopener noreferrer">Request</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js ä½¿ç”¨éé˜»å¡ã€äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼Œä½¿å…¶è½»é‡ä¸”é«˜æ•ˆï¼Œç‰¹åˆ«é€‚åˆå¤„ç†æ•°æ®å¯†é›†å‹æˆ–éœ€è¦å®æ—¶åŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>Request</code> ä¸æ˜¯ä¸€ä¸ªç›´æ¥æä¾›çš„å…¨å±€å¯¹è±¡æˆ–å‡½æ•°ã€‚è¿™é‡Œå¯èƒ½æœ‰äº›è¯¯è§£ã€‚é€šå¸¸åœ¨ Node.js çš„æ–‡æ¡£ä¸­ï¼Œ<code>request</code> æŒ‡çš„æ˜¯ HTTP è¯·æ±‚çš„æ¦‚å¿µï¼Œè¿™å¯èƒ½å‡ºç°åœ¨æŸäº›æ¨¡å—ä¸­ï¼Œæ¯”å¦‚ <code>http</code> æ¨¡å—ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºæœåŠ¡å™¨æˆ–è¿›è¡Œ HTTP å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šç»™ä½ ä»‹ç»ä¸€ä¸‹ Node.js ä¸­å’Œ HTTP è¯·æ±‚ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶ç»™å‡ºå‡ ä¸ªä¾‹å­ï¼š</p><h3 id="http-æœåŠ¡å™¨ç«¯ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#http-æœåŠ¡å™¨ç«¯ç¤ºä¾‹"><span>HTTP æœåŠ¡å™¨ç«¯ç¤ºä¾‹</span></a></h3><p>å½“ä½ åœ¨ Node.js åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œä½ ä¼šç”¨åˆ° <code>http.createServer()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå›è°ƒä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>req</code>ï¼ˆrequest è¯·æ±‚ï¼‰å’Œ <code>res</code>ï¼ˆresponse å“åº”ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘å®¢æˆ·ç«¯å‘é€å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„ <code>(&#39;/&#39;)</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› &quot;Hello World!&quot;ã€‚</p><h3 id="http-å®¢æˆ·ç«¯ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#http-å®¢æˆ·ç«¯ç¤ºä¾‹"><span>HTTP å®¢æˆ·ç«¯ç¤ºä¾‹</span></a></h3><p>å¦‚æœä½ æƒ³åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª HTTP å®¢æˆ·ç«¯æ¥å‘é€è¯·æ±‚åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>http.request()</code> æ–¹æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;www.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/upload&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`çŠ¶æ€ç : </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¯·æ±‚é‡åˆ°é—®é¢˜: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®åˆ°è¯·æ±‚ä¸»ä½“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>http.request()</code> å‘é€äº†ä¸€ä¸ª POST è¯·æ±‚åˆ° <code>www.example.com</code> çš„ <code>/upload</code> è·¯å¾„ã€‚æˆ‘ä»¬è¿˜è®¾ç½®äº†è¯·æ±‚å¤´ <code>Content-Type</code> ä¸º <code>application/json</code>ï¼Œå¹¶å°† JSON å­—ç¬¦ä¸²ä½œä¸ºè¯·æ±‚æ­£æ–‡å‘é€ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-4" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-4"><span>æ³¨æ„äº‹é¡¹</span></a></h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéšç€ Node.js ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒAPI å¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›æ–°ç‰ˆæœ¬ä¸­ï¼Œ<code>http/2</code> æˆ–å…¶ä»–æ¨¡å—å¯èƒ½ä¼šæä¾›æ›´å…ˆè¿›çš„æœºåˆ¶æ¥å¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚å› æ­¤ï¼Œå»ºè®®æŸ¥çœ‹å…·ä½“çš„ Node.js ç‰ˆæœ¬æ–‡æ¡£ä»¥è·å–æœ€å‡†ç¡®çš„ä¿¡æ¯ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯å…³äº Node.js ä¸­ HTTP è¯·æ±‚ (<code>request</code>) çš„åŸºç¡€çŸ¥è¯†å’Œç®€å•åº”ç”¨ã€‚å¸Œæœ›è¿™å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p><h2 id="setimmediate-callback-args" tabindex="-1"><a class="header-anchor" href="#setimmediate-callback-args"><span><a href="https://nodejs.org/docs/latest/api/globals.html#setimmediatecallback-args" target="_blank" rel="noopener noreferrer">setImmediate(callback[, ...args])</a></span></a></h2><p>Node.js ä¸­çš„ <code>setImmediate(callback[, ...args])</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œå®ƒç”¨äºå®‰æ’åœ¨å½“å‰äº‹ä»¶å¾ªç¯å‘¨æœŸå®Œæˆåå°½å¿«æ‰§è¡Œä¸€ä¸ªè„šæœ¬ã€‚ç®€å•æ¥è¯´ï¼Œ<code>setImmediate</code> å‡½æ•°å…è®¸ä½ å‘Šè¯‰ Node.jsï¼šâ€œå˜¿ï¼Œä¸€æ—¦ä½ å®Œæˆäº†ç°æœ‰çš„å·¥ä½œï¼Œç«‹å³è¿è¡Œè¿™ä¸ªå‡½æ•°ã€‚â€</p><h3 id="åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><ul><li><strong>callback</strong>: è¿™æ˜¯å½“è®¡æ—¶å™¨åˆ°æœŸæ—¶è¦æ‰§è¡Œçš„å‡½æ•°ã€‚</li><li><strong>...args</strong>ï¼ˆå¯é€‰ï¼‰: è¿™äº›æ˜¯ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„é¢å¤–å‚æ•°ã€‚</li></ul><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-8"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åŸºç¡€ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_1-åŸºç¡€ç¤ºä¾‹"><span>1. åŸºç¡€ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œéœ€è¦å…ˆå®ŒæˆæŸäº›åŒæ­¥ä»»åŠ¡ï¼Œç„¶åå†å¼‚æ­¥æ‰§è¡Œå…¶ä»–æ“ä½œã€‚è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨ <code>setImmediate</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼€å§‹æ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼‚æ­¥æ“ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç»“æŸæ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºå°†ä¼šæ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>å¼€å§‹æ‰§è¡Œ</span></span>
<span class="line"><span>ç»“æŸæ‰§è¡Œ</span></span>
<span class="line"><span>å¼‚æ­¥æ“ä½œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œå°½ç®¡ <code>setImmediate</code> è¢«æ”¾ç½®åœ¨ä¸­é—´ï¼Œå…¶å›è°ƒå‡½æ•°çš„æ‰§è¡Œå®é™…ä¸Šæ˜¯åœ¨æ‰€æœ‰åŒæ­¥ä»»åŠ¡å®Œæˆä¹‹åã€‚</p><h4 id="_2-ç»“åˆå…¶ä»–å¼‚æ­¥æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_2-ç»“åˆå…¶ä»–å¼‚æ­¥æ“ä½œ"><span>2. ç»“åˆå…¶ä»–å¼‚æ­¥æ“ä½œ</span></a></h4><p>å‡è®¾ä½ åœ¨å¤„ç†æ–‡ä»¶ï¼Œéœ€è¦åœ¨è¯»å–å®Œæ–‡ä»¶ä¹‹åç«‹å³å¤„ç†æ•°æ®ï¼Œè¿™æ—¶ <code>setImmediate</code> å°±éå¸¸æœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶è¯»å–å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¤„ç†æ–‡ä»¶æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼€å§‹æ–‡ä»¶æ“ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºé¡ºåºå°†æ˜¯ï¼šâ€œå¼€å§‹æ–‡ä»¶æ“ä½œâ€ -&gt; â€œæ–‡ä»¶è¯»å–å®Œæˆâ€ -&gt; â€œå¤„ç†æ–‡ä»¶æ•°æ®â€ã€‚é€šè¿‡ <code>setImmediate</code>ï¼Œæˆ‘ä»¬ç¡®ä¿æ–‡ä»¶è¯»å–å’Œåˆæ­¥å¤„ç†å®Œæ¯•åï¼Œå†å¤„ç†æ¥ä¸‹æ¥çš„ä»»åŠ¡ã€‚</p><h4 id="_3-ä½¿ç”¨å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨å‚æ•°"><span>3. ä½¿ç”¨å‚æ•°</span></a></h4><p>ä½ å¯ä»¥å‘ <code>setImmediate</code> çš„å›è°ƒå‡½æ•°ä¼ é€’å‚æ•°ï¼Œè¿™åœ¨å¤„ç†å…·ä½“çš„æ•°æ®æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processUserData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;John Doe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processUserData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š { id: 123, name: &#39;John Doe&#39; }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>setImmediate</code> ç”¨æ¥æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œçš„å¼‚æ­¥å›è°ƒï¼Œå…¶ä¸­ <code>null</code> å’Œç”¨æˆ·æ•°æ®ä½œä¸ºå‚æ•°ä¼ ç»™å›è°ƒå‡½æ•°ã€‚</p><h3 id="æ€»ç»“-13" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-13"><span>æ€»ç»“</span></a></h3><p><code>setImmediate()</code> ä¸ºä½ æä¾›äº†ä¸€ç§æ–¹å¼æ¥æ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œè¿™åœ¨ä½ éœ€è¦ç¡®ä¿å½“å‰æ‰§è¡Œæ ˆä¸­çš„æ‰€æœ‰åŒæ­¥å’Œå¼‚æ­¥ä»£ç éƒ½å®Œæˆåéå¸¸æœ‰ç”¨ã€‚æ— è®ºæ˜¯åœ¨å¤„ç† I/Oã€ç½‘ç»œè¯·æ±‚è¿˜æ˜¯ä»…ä»…å¸Œæœ›å»¶è¿Ÿæ‰§è¡Œä»£ç ï¼Œ<code>setImmediate()</code> éƒ½èƒ½æ´¾ä¸Šç”¨åœºã€‚é€šè¿‡å®é™…ç¤ºä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨ä¸åŒæƒ…æ™¯ä¸‹åˆ©ç”¨è¯¥æ–¹æ³•ä¼˜åŒ–æˆ‘ä»¬çš„ä»£ç æ‰§è¡Œæµç¨‹ã€‚</p><h2 id="setinterval-callback-delay-args" tabindex="-1"><a class="header-anchor" href="#setinterval-callback-delay-args"><span><a href="https://nodejs.org/docs/latest/api/globals.html#setintervalcallback-delay-args" target="_blank" rel="noopener noreferrer">setInterval(callback, delay[, ...args])</a></span></a></h2><p>å½“ä½ å¼€å§‹å­¦ä¹ ç¼–ç¨‹ï¼Œå°¤å…¶æ˜¯ JavaScript å’Œ Node.js æ—¶ï¼Œä½ ä¼šé‡åˆ°å¾ˆå¤šç”¨äºæ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„å‡½æ•°ã€‚<code>setInterval()</code>å°±æ˜¯è¿™æ ·ä¸€ä¸ªéå¸¸å®ç”¨çš„å‡½æ•°ã€‚åœ¨ Node.jsï¼ˆåŒ…æ‹¬ v21.7.1 ç‰ˆæœ¬ï¼‰ä¸­ï¼Œ<code>setInterval()</code>çš„åŸºæœ¬ä½œç”¨æ˜¯æŒ‰ç…§æŒ‡å®šçš„æ—¶é—´é—´éš”é‡å¤æ‰§è¡ŒæŸä¸ªå‡½æ•°ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-3"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><strong>callback</strong>: è¿™æ˜¯ä½ å¸Œæœ›å‘¨æœŸæ€§æ‰§è¡Œçš„å‡½æ•°ã€‚</li><li><strong>delay</strong>: å®šæ—¶å™¨åº”è¯¥ç­‰å¾…å¤šå°‘æ¯«ç§’ï¼ˆä¸€ç§’ç­‰äº 1000 æ¯«ç§’ï¼‰ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œå›è°ƒå‡½æ•°ä¹‹é—´ã€‚</li><li><strong>...args</strong>: ï¼ˆå¯é€‰å‚æ•°ï¼‰è¿™äº›æ˜¯ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„é¢å¤–å‚æ•°ã€‚</li></ul><h3 id="å¦‚ä½•ä½¿ç”¨-setinterval" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-setinterval"><span>å¦‚ä½•ä½¿ç”¨ <code>setInterval()</code></span></a></h3><p>åŸºæœ¬è¯­æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> intervalID</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">delay</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>intervalID</code> æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥åœæ­¢è¿™ä¸ªå®šæ—¶å™¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-9"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ç®€å•çš„å€’æ•°è®¡æ—¶å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç®€å•çš„å€’æ•°è®¡æ—¶å™¨"><span>ä¾‹å­ 1: ç®€å•çš„å€’æ•°è®¡æ—¶å™¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ¶ä½œä¸€ä¸ªç®€å•çš„å€’æ•°è®¡æ—¶å™¨ï¼Œæ¯éš”ä¸€ç§’é’Ÿå‡å°‘è®¡æ•°ï¼Œç›´è‡³ 0ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> countdown</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> timer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">countdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    countdown</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">countdown</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">intervalID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœæ­¢å®šæ—¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;å€’æ•°å®Œæ¯•ï¼&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®å®šæ—¶å™¨ï¼Œæ¯1000æ¯«ç§’ï¼ˆå³1ç§’ï¼‰è°ƒç”¨ä¸€æ¬¡timerå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> intervalID</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ¯éš”ä¸€ç§’æ‰“å°å‡ºå€’æ•°è®¡æ—¶å™¨çš„å€¼ï¼Œç›´åˆ°å®ƒå‡åˆ° 0ã€‚</p><h4 id="ä¾‹å­-2-æ›´æ–°ç½‘ç«™å†…å®¹" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ›´æ–°ç½‘ç«™å†…å®¹"><span>ä¾‹å­ 2: æ›´æ–°ç½‘ç«™å†…å®¹</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®šæœŸä»æœåŠ¡å™¨è·å–æœ€æ–°ä¿¡æ¯å¹¶æ›´æ–°ç½‘é¡µå†…å®¹çš„ç½‘ç«™ã€‚ä¸ºäº†æ¨¡æ‹Ÿè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>setInterval()</code>å®šæœŸæ‰§è¡Œä¸€ä¸ªå‡½æ•°æ¥è·å–æ•°æ®ï¼ˆåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨æ¨¡æ‹Ÿæ•°æ®ä»£æ›¿å®é™…çš„ç½‘ç»œè¯·æ±‚ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchLatestNews</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå‡è£…æˆ‘ä»¬ç”¨æŸç§æ–¹å¼è·å–äº†æœ€æ–°æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è·å–å¹¶æ˜¾ç¤ºæœ€æ–°æ–°é—»&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯5ç§’åˆ·æ–°ä¸€æ¬¡æ–°é—»</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fetchLatestNews</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>setInterval()</code>æ¥æ¨¡ä»¿å®šæœŸä»æœåŠ¡å™¨è·å–æ•°æ®å¹¶æ›´æ–°å†…å®¹çš„è¡Œä¸ºã€‚</p><h4 id="ä¾‹å­-3-åŠ¨æ€æ›´æ”¹ç½‘é¡µèƒŒæ™¯è‰²" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-åŠ¨æ€æ›´æ”¹ç½‘é¡µèƒŒæ™¯è‰²"><span>ä¾‹å­ 3: åŠ¨æ€æ›´æ”¹ç½‘é¡µèƒŒæ™¯è‰²</span></a></h4><p>å¦‚æœä½ æƒ³è®©ä½ çš„ç½‘é¡µèƒŒæ™¯è‰²æ¯éš”å‡ ç§’å°±è‡ªåŠ¨æ”¹å˜ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>setInterval()</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> changeBackgroundColor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> document</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç”Ÿæˆéšæœºé¢œè‰²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;#&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">floor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 16777215</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">backgroundColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> color</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯2ç§’æ”¹å˜ä¸€æ¬¡èƒŒæ™¯è‰²</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">changeBackgroundColor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥ä»£ç æ®µå°†ç½‘é¡µçš„èƒŒæ™¯è‰²æ¯ä¸¤ç§’æ›´æ”¹ä¸€æ¬¡ï¼Œå±•ç¤ºäº†<code>setInterval()</code>åœ¨ç”¨æˆ·ç•Œé¢åŠ¨æ€æ•ˆæœä¸­çš„åº”ç”¨ã€‚</p><h3 id="åœæ­¢-setinterval" tabindex="-1"><a class="header-anchor" href="#åœæ­¢-setinterval"><span>åœæ­¢ <code>setInterval()</code></span></a></h3><p>è¦åœæ­¢<code>setInterval()</code>å®šæ—¶å™¨ï¼Œä½ éœ€è¦ä½¿ç”¨<code>clearInterval()</code>å‡½æ•°ï¼Œå¹¶ä¼ å…¥ç”±<code>setInterval()</code>è¿”å›çš„æ ‡è¯†ç¬¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">intervalID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œæ— è®ºä½ çš„å®šæ—¶å™¨æ˜¯ç”¨æ¥æ›´æ–°æ•°æ®ã€åŠ¨æ€æ”¹å˜ UI è¿˜æ˜¯åˆ«çš„ä»€ä¹ˆï¼Œå½“å®ƒä¸å†éœ€è¦æ—¶ï¼Œä½ éƒ½å¯ä»¥è½»æ¾åœ°åœæ­¢å®ƒã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ˜ç™½<code>setInterval()</code>åœ¨ Node.js ä¸­çš„åŸºæœ¬ç”¨æ³•åŠå…¶åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨ã€‚</p><h2 id="settimeout-callback-delay-args" tabindex="-1"><a class="header-anchor" href="#settimeout-callback-delay-args"><span><a href="https://nodejs.org/docs/latest/api/globals.html#settimeoutcallback-delay-args" target="_blank" rel="noopener noreferrer">setTimeout(callback, delay[, ...args])</a></span></a></h2><p><code>setTimeout(callback, delay[, ...args])</code> åœ¨ Node.js ä¸­æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„å‡½æ•°ï¼Œç”¨æ¥åœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åæ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨ç¼–ç¨‹ä¸­ç»å¸¸ç”¨äºå»¶è¿Ÿä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡æˆ–è€…åœ¨ä¸é˜»å¡ç¨‹åºå…¶ä»–éƒ¨åˆ†çš„æƒ…å†µä¸‹æ‰§è¡Œä»£ç ã€‚</p><h3 id="å‚æ•°è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>callback</code>: è¿™æ˜¯ä½ å¸Œæœ›åœ¨ç­‰å¾…äº†ç‰¹å®šçš„<code>delay</code>æ¯«ç§’æ•°åæ‰§è¡Œçš„å‡½æ•°ã€‚</li><li><code>delay</code>: è¡¨ç¤ºç­‰å¾…å¤šé•¿æ—¶é—´ä»¥æ¯«ç§’ä¸ºå•ä½çš„æ•°å­—ã€‚ï¼ˆ1000 æ¯«ç§’=1 ç§’ï¼‰</li><li><code>[...args]</code>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¯ä»¥ä¼ é€’ä»»æ„æ•°é‡çš„å‚æ•°ç»™<code>callback</code>å‡½æ•°ã€‚</li></ul><h3 id="è¿”å›å€¼-1" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-1"><span>è¿”å›å€¼</span></a></h3><p>å½“ä½ è°ƒç”¨<code>setTimeout</code>æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª<code>timeout</code>å¯¹è±¡ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªå¯¹è±¡æ¥å–æ¶ˆå»¶æ—¶ï¼ˆä½¿ç”¨<code>clearTimeout()</code>æ–¹æ³•ï¼‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-10"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åŸºæœ¬ç”¨æ³•"><span>ä¾‹å­ 1ï¼šåŸºæœ¬ç”¨æ³•</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ªç¨‹åºï¼Œéœ€è¦åœ¨ 2 ç§’åæ‰“å°å‡º&quot;Hello, world!&quot;åˆ°æ§åˆ¶å°ã€‚ä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨<code>setTimeout</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®timeoutä»¥åœ¨2000æ¯«ç§’ï¼ˆå³2ç§’ï¼‰åè°ƒç”¨greetå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-å¸¦æœ‰é¢å¤–å‚æ•°çš„ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å¸¦æœ‰é¢å¤–å‚æ•°çš„ç”¨æ³•"><span>ä¾‹å­ 2ï¼šå¸¦æœ‰é¢å¤–å‚æ•°çš„ç”¨æ³•</span></a></h4><p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³è¦ä¼ é€’ä¸€äº›å‚æ•°ç»™ä½ çš„<code>greet</code>å‡½æ•°å‘¢ï¼Ÿæ¯”å¦‚ä½ æƒ³è¦å®šåˆ¶åŒ–æ‰“æ‹›å‘¼ä¿¡æ¯ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨setTimeoutå¹¶åœ¨2ç§’åä¼ é€’&#39;Node.js&#39;ä½œä¸ºå‚æ•°ç»™greetå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ 2 ç§’åï¼Œè¿™æ®µä»£ç å°†æ‰“å°å‡º&quot;Hello, Node.js!&quot;ã€‚</p><h4 id="ä¾‹å­-3-å–æ¶ˆå»¶æ—¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-å–æ¶ˆå»¶æ—¶"><span>ä¾‹å­ 3ï¼šå–æ¶ˆå»¶æ—¶</span></a></h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦å–æ¶ˆå°šæœªæ‰§è¡Œçš„å»¶è¿Ÿå‡½æ•°ã€‚ä½ å¯ä»¥ä¿å­˜<code>setTimeout</code>çš„è¿”å›å€¼ï¼Œå¹¶ä½¿ç”¨<code>clearTimeout</code>æ¥å–æ¶ˆå®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ä¸€ä¸ªå»¶æ—¶å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> timeoutId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†³å®šåœ¨2ç§’åå–æ¶ˆè¿™ä¸ªå»¶æ—¶å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  clearTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timeoutId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Timeout is cleared!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ&quot;Hello, world!&quot;æ°¸è¿œä¸ä¼šè¢«æ‰“å°ï¼Œå› ä¸ºåœ¨ 2 ç§’ä¹‹åï¼Œæˆ‘ä»¬å–æ¶ˆäº†åŸæ¥è®¾ç½®ä¸º 5 ç§’åæ‰§è¡Œçš„<code>greet</code>å‡½æ•°ã€‚</p><p>è¿™äº›ä¾‹å­æ¼”ç¤ºäº†<code>setTimeout</code>åœ¨å®é™…åº”ç”¨ä¸­çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ã€‚å®ƒéå¸¸æœ‰ç”¨ï¼Œåœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½è§åˆ°å®ƒçš„èº«å½±ï¼Œæ¯”å¦‚åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶ï¼Œé¿å…ç«‹å³æ‰§è¡ŒæŸäº›ä»£ç ç‰‡æ®µï¼Œæˆ–è€…æ˜¯åœ¨åˆ›å»ºåŠ¨ç”»ã€è½®è¯¢æœåŠ¡å™¨ç­‰æ–¹é¢ã€‚</p><h2 id="structuredclone-value-options" tabindex="-1"><a class="header-anchor" href="#structuredclone-value-options"><span><a href="https://nodejs.org/docs/latest/api/globals.html#structuredclonevalue-options" target="_blank" rel="noopener noreferrer">structuredClone(value[, options])</a></span></a></h2><p>Node.js é‡Œçš„<code>structuredClone(value[, options])</code>å‡½æ•°æ˜¯ä¸€ä¸ªç”¨äºæ·±æ‹·è´ JavaScript å¯¹è±¡çš„å…¨å±€å‡½æ•°ã€‚æ·±æ‹·è´æ„å‘³ç€å®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶ä¸”å¤åˆ¶åŸå§‹å¯¹è±¡ä¸­æ‰€æœ‰å±‚çº§çš„å±æ€§åˆ°æ–°å¯¹è±¡ä¸­ï¼ŒåŒ…æ‹¬é‚£äº›åµŒå¥—çš„å¯¹è±¡ã€‚</p><p>åœ¨ JavaScript ä¸­ï¼Œå½“ä½ å°†ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œå®é™…ä¸Šä½ åªæ˜¯åœ¨å¤åˆ¶è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œéå¯¹è±¡æœ¬èº«ã€‚è¿™æ„å‘³ç€å¦‚æœä½ ä¿®æ”¹äº†æ–°çš„å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼ŒåŸå§‹çš„å¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œå› ä¸ºå®ƒä»¬æŒ‡å‘äº†åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚ä½¿ç”¨<code>structuredClone</code>å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Œå› ä¸ºå®ƒä¼šåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å‰¯æœ¬ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œ<code>structuredClone</code>çš„ä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å¤åˆ¶å“ï¼Œæ”¹å˜å¤åˆ¶å“ä¸ä¼šå½±å“åŸå¯¹è±¡ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨<code>structuredClone</code>çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«å¤šå±‚åµŒå¥—å¯¹è±¡çš„å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> original</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Original&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  details</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    created</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    tags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;javascript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ structuredClone æ–¹æ³•æ¥åˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„æ·±æ‹·è´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cloned</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> structuredClone</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">original</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ cloned å¯¹è±¡çš„å±æ€§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cloned</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Cloned&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cloned</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">details</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;clone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å° original å¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå¹¶æ²¡æœ‰è¢«ä¿®æ”¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">original</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//   name: &#39;Original&#39;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//   details: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//     created: [Date object representing creation time],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//     tags: [&#39;node&#39;, &#39;javascript&#39;] // æ³¨æ„è¿™é‡Œæ²¡æœ‰ &#39;clone&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//   }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å° cloned å¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°å®ƒä¸ original ä¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cloned</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//   name: &#39;Cloned&#39;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//   details: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//     created: [Date object representing creation time],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//     tags: [&#39;node&#39;, &#39;javascript&#39;, &#39;clone&#39;]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//   }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°å¯¹<code>cloned</code>å¯¹è±¡è¿›è¡Œçš„æ›´æ”¹æ²¡æœ‰å½±å“åˆ°<code>original</code>å¯¹è±¡ã€‚è¿™è¡¨æ˜<code>structuredClone</code>æˆåŠŸåœ°åˆ›å»ºäº†ä¸€ä¸ªæ·±æ‹·è´ã€‚</p><p>æ­¤å¤–ï¼Œ<code>structuredClone</code>è¿˜æ”¯æŒä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚ä½ å¯ä»¥è®¾ç½®è½¬æ¢ç‰¹å®šç±»å‹çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ª<code>transfer</code>é€‰é¡¹æ¥è½¬ç§»<code>ArrayBuffer</code>çš„æ‰€æœ‰æƒï¼ˆè¿™æ˜¯é«˜çº§åŠŸèƒ½ï¼Œé€šå¸¸ç”¨äºå¤„ç†æ€§èƒ½æ•æ„Ÿçš„æ“ä½œï¼Œæ¯”å¦‚åœ¨ Web Workers ä¹‹é—´ä¼ è¾“æ•°æ®ï¼‰ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>structuredClone</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‡½æ•°ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦ç¡®ä¿å¤åˆ¶çš„å¯¹è±¡ä¸åŸå§‹å¯¹è±¡ç›¸äº’ç‹¬ç«‹æ—¶ï¼Œè¿™åœ¨å¤„ç†å¤æ‚çš„æ•°æ®ç»“æ„æˆ–è€…éœ€è¦éš”ç¦»ä¿®æ”¹çš„åœºæ™¯ä¸‹æä¸ºé‡è¦ã€‚</p><h2 id="subtlecrypto" tabindex="-1"><a class="header-anchor" href="#subtlecrypto"><span><a href="https://nodejs.org/docs/latest/api/globals.html#subtlecrypto" target="_blank" rel="noopener noreferrer">SubtleCrypto</a></span></a></h2><p>Node.js çš„<code>SubtleCrypto</code>æ¨¡å—æä¾›äº†ä¸€å¥—ç”¨äºæ‰§è¡Œä½çº§åŠ å¯†æ“ä½œçš„ APIã€‚è¿™äº›æ“ä½œåŒ…æ‹¬å“ˆå¸Œã€ç­¾åã€éªŒè¯ã€åŠ å¯†å’Œè§£å¯†ç­‰åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºå¤„ç† Web åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§éœ€æ±‚ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>SubtleCrypto</code>ä½œä¸ºå…¨å±€èŒƒå›´å†…çš„ä¸€ä¸ªå¯¹è±¡å¯ç”¨ï¼Œå³æ— éœ€é€šè¿‡ require æˆ– import å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><h3 id="subtlecrypto-çš„å…³é”®ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#subtlecrypto-çš„å…³é”®ç‰¹æ€§"><span>SubtleCrypto çš„å…³é”®ç‰¹æ€§ï¼š</span></a></h3><ul><li><strong>å®‰å…¨æ€§</strong>ï¼šè®¾è®¡ç”¨äºå¤„ç†å®‰å…¨æ•æ„Ÿçš„æ“ä½œï¼Œå¦‚å¯†ç å­¦å‡½æ•°ã€‚</li><li><strong>å¼‚æ­¥ API</strong>ï¼šå¤§å¤šæ•°æ–¹æ³•è¿”å›<code>Promise</code>ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œä½¿å¾—å®ƒé€‚åˆäº I/O å¯†é›†å‹çš„ Node.js åº”ç”¨ã€‚</li><li><strong>æ ‡å‡†åŒ–</strong>ï¼šåŸºäº Web æ ‡å‡†ï¼Œç¡®ä¿äº†è·¨å¹³å°å…¼å®¹æ€§å’Œå‰ç»æ€§ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ª<code>SubtleCrypto</code>çš„å…·ä½“åº”ç”¨å®ä¾‹ã€‚</p><h4 id="_1-å“ˆå¸Œç”Ÿæˆ-hashing" tabindex="-1"><a class="header-anchor" href="#_1-å“ˆå¸Œç”Ÿæˆ-hashing"><span>1. å“ˆå¸Œç”Ÿæˆ(Hashing)</span></a></h4><p>å‡è®¾ä½ æƒ³è¦ä¸ºä¸€ä¸ªå¯†ç æˆ–ä»»æ„æ•°æ®ç”Ÿæˆä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œä»¥ä¾¿å®‰å…¨å­˜å‚¨æˆ–éªŒè¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> generateHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encodedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> encoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hashBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">subtle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;SHA-256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encodedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hashArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Uint8Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hashBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hashHex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hashArray</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">padStart</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hashHex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿”å›åå…­è¿›åˆ¶æ ¼å¼çš„å“ˆå¸Œå€¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°å‡º&quot;hello world&quot;çš„SHA-256å“ˆå¸Œå€¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-æ•°æ®åŠ å¯†å’Œè§£å¯†" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®åŠ å¯†å’Œè§£å¯†"><span>2. æ•°æ®åŠ å¯†å’Œè§£å¯†</span></a></h4><p>å¦‚æœä½ éœ€è¦å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ï¼Œæ¯”å¦‚å‘é€ä¸€ä¸ªåŠ å¯†çš„æ¶ˆæ¯ç»™æŸäººï¼Œä½ å¯ä»¥ä½¿ç”¨<code>SubtleCrypto</code>è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºåŠ å¯†å¯†é’¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> generateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> window</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">subtle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES-GCM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;encrypt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;decrypt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½¿ç”¨è¯¥å¯†é’¥åŠ å¯†æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> encryptData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">secretData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> iv</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> window</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getRandomValues</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Uint8Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encodedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> encoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">secretData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encryptedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> window</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">subtle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES-GCM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    encodedData</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å’Œ IVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰æ¥è§£å¯†æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> decryptData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decryptedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> window</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">subtle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">decrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES-GCM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    encryptedData</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextDecoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">decryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1"><span>å°ç»“</span></a></h3><p><code>SubtleCrypto</code>æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼Œä»¥æ”¯æŒå„ç§å®‰å…¨æ€§éœ€æ±‚ï¼Œä»ç®€å•çš„æ•°æ®å“ˆå¸Œåˆ°å¤æ‚çš„åŠ å¯†/è§£å¯†æ“ä½œã€‚ä½¿ç”¨è¿™äº›å·¥å…·æ—¶ï¼Œé‡è¦çš„æ˜¯è¦ç†è§£å®ƒä»¬çš„å·¥ä½œåŸç†ä»¥åŠå¦‚ä½•æ­£ç¡®å®‰å…¨åœ°å®ç°ç›¸å…³åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æ•æ„Ÿä¿¡æ¯æ—¶ã€‚</p><h2 id="domexception" tabindex="-1"><a class="header-anchor" href="#domexception"><span><a href="https://nodejs.org/docs/latest/api/globals.html#domexception" target="_blank" rel="noopener noreferrer">DOMException</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript çš„ç¯å¢ƒï¼Œå…è®¸ä½ æ„å»ºå¿«é€Ÿã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ã€‚Node.js v21.7.1 ä¸­æåŠçš„<code>DOMException</code>å¹¶ä¸æ˜¯ Node.js ç‹¬æœ‰çš„æ¦‚å¿µï¼Œè€Œæ˜¯æºè‡ªäºæµè§ˆå™¨ç¯å¢ƒä¸‹çš„ Web APIsã€‚åœ¨ Node.js ä¸­å¼•å…¥<code>DOMException</code>æ„å‘³ç€ Node.js å¸Œæœ›åœ¨å¤„ç†ç±»ä¼¼ Web çš„åœºæ™¯æ—¶æä¾›æ›´ä¸€è‡´çš„å¼€å‘ä½“éªŒã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-domexception" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-domexception"><span>ä»€ä¹ˆæ˜¯ DOMExceptionï¼Ÿ</span></a></h3><p><code>DOMException</code>æœ¬æ¥æ˜¯ Web API çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæŠ¥å‘Šåœ¨å¤„ç†æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰æ—¶é‡åˆ°çš„é”™è¯¯å’Œå¼‚å¸¸æƒ…å†µã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œå½“æ“ä½œ DOMï¼ˆå³ç½‘é¡µä¸Šçš„å„ç§å…ƒç´ ï¼‰æ—¶ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼ˆå¦‚å°è¯•ä½¿ç”¨ä¸å­˜åœ¨çš„å±æ€§æˆ–æ–¹æ³•ï¼‰ï¼Œæµè§ˆå™¨ä¼šæŠ›å‡º<code>DOMException</code>ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-node-js-è¦åŒ…å«-domexception" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-node-js-è¦åŒ…å«-domexception"><span>ä¸ºä»€ä¹ˆ Node.js è¦åŒ…å« DOMExceptionï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­åŒ…å«<code>DOMException</code>ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒé‚£äº›åŒæ—¶åœ¨æœåŠ¡å™¨ç«¯å’Œæµè§ˆå™¨ç«¯å·¥ä½œï¼Œä¸”éœ€è¦å¤„ç†æˆ–æŠ›å‡ºä¸ DOM æ“ä½œç›¸å…³å¼‚å¸¸çš„ä»£ç åº“ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—åœ¨ Node.js ç¯å¢ƒä¸­è¿è¡Œçš„ä»£ç åœ¨å¤„ç†æŸäº›ç‰¹å®šç±»å‹çš„é”™è¯¯æ—¶èƒ½å¤Ÿæ›´åŠ ç¬¦åˆ Web æ ‡å‡†ï¼Œæé«˜ä»£ç çš„å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰</strong>ï¼š</p><ul><li>å½“ä½ åœ¨ä½¿ç”¨ Reactã€Vue æˆ– Angular è¿™ç±»å‰ç«¯æ¡†æ¶è¿›è¡ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ï¼Œæœ‰æ—¶éœ€è¦æ“ä½œè™šæ‹Ÿ DOMã€‚è‹¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œåˆ©ç”¨<code>DOMException</code>å¯ä»¥åˆ›å»ºä¸å®¢æˆ·ç«¯æµè§ˆå™¨ç›¸ä¼¼çš„é”™è¯¯å¤„ç†ä½“éªŒã€‚</li></ul></li><li><p><strong>ä½¿ç”¨ JSDOM ç­‰åº“</strong>ï¼š</p><ul><li>JSDOM æ˜¯ä¸€ä¸ªåœ¨ Node.js ä¸­æ¨¡æ‹Ÿ Web æµè§ˆå™¨ç¯å¢ƒçš„åº“ã€‚å½“ä½ ä½¿ç”¨ JSDOM æ¥è¿è¡ŒåŸæœ¬è®¾è®¡è¿è¡Œåœ¨ Web æµè§ˆå™¨ä¸­çš„ JavaScript ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°éœ€è¦æŠ›å‡ºæˆ–å¤„ç†<code>DOMException</code>çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¯•å›¾é€šè¿‡ JSDOM æ¨¡æ‹Ÿçš„ DOM å…ƒç´ æ‰§è¡Œæ— æ•ˆæ“ä½œï¼ŒæŠ›å‡º<code>DOMException</code>å¯ä»¥æ¸…æ™°åœ°æŒ‡ç¤ºé”™è¯¯ç±»å‹ã€‚</li></ul></li><li><p><strong>Web API çš„æœåŠ¡å™¨ç«¯å®ç°</strong>ï¼š</p><ul><li>å¦‚æœä½ æ­£åœ¨ Node.js ä¸­å®ç°æˆ–æ¨¡æ‹Ÿä¸€ä¸ª Web APIï¼Œé‚£ä¹ˆåœ¨é€‚å½“çš„æƒ…å†µä¸‹ä½¿ç”¨<code>DOMException</code>å¯ä»¥ä½¿é”™è¯¯å¤„ç†æ›´åŠ æ ‡å‡†åŒ–ã€‚æ¯”å¦‚ï¼Œå½“ API ç”¨æˆ·è¯•å›¾è®¿é—®ä¸€ä¸ªæœªå®šä¹‰çš„å±æ€§æˆ–è°ƒç”¨æœªå®ç°çš„æ–¹æ³•æ—¶ï¼ŒæŠ›å‡º<code>DOMException</code>å¯ä»¥è®©é”™è¯¯ä¿¡æ¯æ›´ç›´æ¥ã€æ›´æ˜“äºç†è§£ã€‚</li></ul></li></ol><h3 id="æ€»ç»“-14" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-14"><span>æ€»ç»“</span></a></h3><p>è™½ç„¶ Node.js ä¸»è¦å…³æ³¨äºæœåŠ¡å™¨ç«¯ç¼–ç¨‹ï¼Œå¼•å…¥<code>DOMException</code>è¿™æ ·çš„æ¦‚å¿µæœ‰åŠ©äºå¤„ç†è·¨ç¯å¢ƒï¼ˆå³æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼‰ç¼–ç æ—¶çš„é”™è¯¯å¤„ç†ä¸€è‡´æ€§ã€‚è¿™å¯¹äºéœ€è¦å¤§é‡ä¸ DOM æ“ä½œæˆ–æµè§ˆå™¨ API äº¤äº’çš„åº”ç”¨å¼€å‘ï¼ˆå¦‚ SSRã€ä½¿ç”¨ JSDOM ç­‰åœºæ™¯ï¼‰å°¤å…¶æœ‰ç”¨ã€‚</p><h2 id="textdecoder" tabindex="-1"><a class="header-anchor" href="#textdecoder"><span><a href="https://nodejs.org/docs/latest/api/globals.html#textdecoder" target="_blank" rel="noopener noreferrer">TextDecoder</a></span></a></h2><p>Node.js ä¸­çš„ <code>TextDecoder</code> æ˜¯ç”¨äºå°†ç¼–ç çš„æ–‡æœ¬æ•°æ®è½¬æ¢æˆå­—ç¬¦ä¸²çš„å·¥å…·ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç½‘ç»œé€šä¿¡æˆ–æ–‡ä»¶è¯»å–æ—¶ï¼Œå› ä¸ºè¿™äº›æ“ä½œå¾€å¾€ä¼šæ¶‰åŠåˆ°ä¸åŒçš„å­—ç¬¦ç¼–ç æ ¼å¼ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-textdecoder" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-textdecoder"><span>ä¸ºä»€ä¹ˆéœ€è¦ <code>TextDecoder</code>ï¼Ÿ</span></a></h3><p>åœ¨è®¡ç®—æœºä¸­ï¼Œæ‰€æœ‰çš„ä¿¡æ¯æœ€ç»ˆéƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºæ–‡æœ¬ä¿¡æ¯æ¥è¯´ï¼Œå­˜åœ¨å¤šç§ä¸åŒçš„ç¼–ç æ–¹å¼æ¥è¡¨ç¤ºè¿™äº›äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚ UTF-8ã€UTF-16ã€ISO-8859-1 ç­‰ã€‚ä¸åŒçš„ç³»ç»Ÿæˆ–ç¨‹åºå¯èƒ½ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œæ•°æ®äº¤æ¢æ—¶ï¼Œèƒ½å¤Ÿè¯†åˆ«å’Œè½¬æ¢è¿™äº›ç¼–ç å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-textdecoder" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-textdecoder"><span>å¦‚ä½•ä½¿ç”¨ <code>TextDecoder</code>ï¼Ÿ</span></a></h3><p><code>TextDecoder</code> æ˜¯ Node.js çš„å…¨å±€å¯¹è±¡ï¼Œä½ ä¸éœ€è¦å®‰è£…æˆ–å¼•å…¥ä»»ä½•é¢å¤–çš„æ¨¡å—æ¥ä½¿ç”¨å®ƒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>TextDecoder</code> å°† UTF-8 ç¼–ç çš„æ–‡æœ¬è½¬æ¢æˆå­—ç¬¦ä¸²ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸² UTF-8 ç¼–ç çš„äºŒè¿›åˆ¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encodedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Uint8Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  72</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">101</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">108</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">108</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">111</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">87</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">111</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">114</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">108</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">33</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª TextDecoder å®ä¾‹ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯é’ˆå¯¹ UTF-8 ç¼–ç çš„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextDecoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ decode æ–¹æ³•å°†ç¼–ç çš„æ•°æ®è½¬æ¢æˆå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decodedString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encodedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">decodedString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Hello World!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨åœºæ™¯-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-3"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>ç½‘ç»œé€šä¿¡ï¼š</strong> å½“ä½ é€šè¿‡ AJAX æˆ– WebSocket æ¥æ”¶æœåŠ¡å™¨å‘é€çš„æ•°æ®æ—¶ï¼Œè¿™äº›æ•°æ®é€šå¸¸æ˜¯ä»¥å­—èŠ‚æµçš„å½¢å¼å­˜åœ¨çš„ã€‚å¦‚æœæœåŠ¡å™¨ç«¯å‘é€çš„æ˜¯æ–‡æœ¬æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦ä½¿ç”¨ <code>TextDecoder</code> æ¥å°†è¿™äº›å­—èŠ‚æµè½¬æ¢æˆå¯è¯»çš„å­—ç¬¦ä¸²ã€‚</p></li><li><p><strong>æ–‡ä»¶å¤„ç†ï¼š</strong> åœ¨ Node.js ä¸­è¯»å–æ–‡ä»¶æ—¶ï¼Œå°¤å…¶æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹é€šå¸¸è¢«è¯»å–ä¸º Bufferï¼ˆä¸€ä¸ªå­—èŠ‚çš„æ•°ç»„ï¼‰ã€‚å¦‚æœä½ çŸ¥é“æ–‡ä»¶ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ï¼Œå¯ä»¥åˆ©ç”¨ <code>TextDecoder</code> å°†è¿™äº›å­—èŠ‚è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä¾¿äºåç»­å¤„ç†ã€‚</p></li><li><p><strong>æ•°æ®è§£æï¼š</strong> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä»æ•°æ®åº“æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡è·å–çš„æ•°æ®å¯èƒ½æ˜¯ç»è¿‡ç¼–ç çš„ã€‚ä½¿ç”¨ <code>TextDecoder</code> å¯ä»¥å¸®åŠ©ä½ å°†è¿™äº›æ•°æ®è½¬æ¢æˆäººç±»å¯è¯»çš„æ ¼å¼ï¼Œä»è€Œæ›´å®¹æ˜“åœ°è¿›è¡Œæ•°æ®åˆ†æå’Œå¤„ç†ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>TextDecoder</code> åœ¨å¤„ç†ç°ä»£ Web å’Œ Node.js åº”ç”¨ä¸­çš„æ–‡æœ¬æ•°æ®æ—¶ï¼Œæ‰®æ¼”ç€ä¸€ä¸ªéå¸¸å…³é”®çš„è§’è‰²ã€‚é€šè¿‡æ­£ç¡®åœ°ä½¿ç”¨å®ƒï¼Œä½ å¯ä»¥è½»æ¾åœ°è·¨è¶Šä¸åŒç¼–ç æ ¼å¼å¸¦æ¥çš„éšœç¢ï¼Œè®©æ•°æ®å¤„ç†å˜å¾—æ›´åŠ é«˜æ•ˆå’Œå‡†ç¡®ã€‚</p><h2 id="class-textdecoderstream" tabindex="-1"><a class="header-anchor" href="#class-textdecoderstream"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-textdecoderstream" target="_blank" rel="noopener noreferrer">Class: TextDecoderStream</a></span></a></h2><p>å½“ç„¶ï¼Œæˆ‘ä¼šå°½é‡ç”¨ç®€å•çš„è¯­è¨€æ¥è§£é‡Š Node.js ä¸­çš„ <code>TextDecoderStream</code> ç±»ç»™ä½ ã€‚</p><p>åœ¨ Node.js v21.7.1 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œ<code>TextDecoderStream</code> æ˜¯ <code>globals</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªç±»ï¼Œå®ƒä¸»è¦ç”¨äºå°†æµå¼çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆæ¯”å¦‚æ¥è‡ªæ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰è½¬æ¢æˆæ–‡æœ¬å½¢å¼ã€‚å®ƒæ˜¯ <code>TextDecoder</code> çš„ä¸€ä¸ªæ‰©å±•ï¼Œä¸“ä¸ºå¤„ç†æµæ•°æ®è€Œè®¾è®¡ã€‚</p><h3 id="ç†è§£-textdecoderstream" tabindex="-1"><a class="header-anchor" href="#ç†è§£-textdecoderstream"><span>ç†è§£ <code>TextDecoderStream</code></span></a></h3><p>è®©æˆ‘ä»¬å…ˆä»åŸºç¡€è¯´èµ·ã€‚é€šå¸¸åœ¨è®¡ç®—æœºä¸­ï¼Œæ–‡æœ¬è¢«å­˜å‚¨ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚è¿™äº›äºŒè¿›åˆ¶æ•°æ®æ ¹æ®ä¸åŒçš„ç¼–ç æ–¹å¼ï¼ˆå¦‚ UTF-8, UTF-16 ç­‰ï¼‰è¢«è§£è¯»æˆäººç±»å¯ä»¥ç†è§£çš„æ–‡æœ¬ã€‚<code>TextDecoderStream</code> å°±æ˜¯ç”¨æ¥åšè¿™æ ·çš„äº‹æƒ…ï¼Œä½†ç‰¹åˆ«é’ˆå¯¹â€œæµâ€æ•°æ®ã€‚æ‰€è°“â€œæµâ€æ•°æ®ï¼Œå°±æ˜¯æ•°æ®ä¸€å°å—ä¸€å°å—åœ°è¿ç»­ä¼ è¾“ï¼Œè€Œéä¸€æ¬¡æ€§å…¨éƒ¨å‘é€ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-11"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ•°æ®æµ" tabindex="-1"><a class="header-anchor" href="#_1-å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ•°æ®æµ"><span>1. å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ•°æ®æµ</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»æŸä¸ª API è·å–æ•°æ®ã€‚è¿™äº›æ•°æ®ä»¥æµçš„å½¢å¼è¿”å›ï¼Œä½¿ç”¨ <code>TextDecoderStream</code> å¯ä»¥è½»æ¾å°†è¿™äº›äºŒè¿›åˆ¶æµæ•°æ®è§£ç æˆæ–‡æœ¬ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">TextDecoderStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextDecoderStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Decoded chunk:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Request failed with status code: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ é€šè¿‡ HTTP GET è¯·æ±‚è·å–æ•°æ®ï¼Œç„¶åé€šè¿‡ <code>TextDecoderStream</code> å°†å…¶è½¬æ¢æˆ UTF-8 ç¼–ç çš„æ–‡æœ¬ã€‚</p><h4 id="_2-è¯»å–æ–‡ä»¶æ•°æ®æµ" tabindex="-1"><a class="header-anchor" href="#_2-è¯»å–æ–‡ä»¶æ•°æ®æµ"><span>2. è¯»å–æ–‡ä»¶æ•°æ®æµ</span></a></h4><p>å¦‚æœä½ æœ‰ä¸€ä¸ªå¤§å‹çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå¸Œæœ›é€æ­¥è¯»å–å¹¶å¤„ç†å®ƒçš„å†…å®¹ï¼Œ<code>TextDecoderStream</code> ä¹Ÿå¾ˆé€‚åˆè¿™ä¸ªåœºæ™¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">TextDecoderStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> textStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextDecoderStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">textStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;New text chunk:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">textStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished reading file.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>fs.createReadStream</code> åˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµæ¥è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ç®¡é“ <code>pipe()</code> æ–¹æ³•å°†è¿™ä¸ªå¯è¯»æµè¿æ¥åˆ° <code>TextDecoderStream</code> ä¸Šï¼Œè¿™æ ·å¯ä»¥é€å—åœ°å°†è¯»å–åˆ°çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸º UTF-8 ç¼–ç çš„æ–‡æœ¬ã€‚</p><h3 id="æ€»ç»“-15" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-15"><span>æ€»ç»“</span></a></h3><p><code>TextDecoderStream</code> æä¾›äº†ä¸€ç§é«˜æ•ˆä¸”ç®€ä¾¿çš„æ–¹æ³•æ¥å¤„ç†äºŒè¿›åˆ¶æµæ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ–‡æœ¬ã€‚æ— è®ºæ˜¯å¤„ç†ç½‘ç»œå“åº”ã€æ–‡ä»¶è¯»å–è¿˜æ˜¯å…¶ä»–ç±»å‹çš„æµæ•°æ®ï¼Œä½¿ç”¨ <code>TextDecoderStream</code> éƒ½èƒ½è®©ä½ çš„å·¥ä½œå˜å¾—æ›´åŠ ç®€å•ã€‚</p><h2 id="textencoder" tabindex="-1"><a class="header-anchor" href="#textencoder"><span><a href="https://nodejs.org/docs/latest/api/globals.html#textencoder" target="_blank" rel="noopener noreferrer">TextEncoder</a></span></a></h2><p>å½“ç„¶ï¼Œè®©æˆ‘å¸®ä½ äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„<code>TextEncoder</code>ã€‚</p><p>é¦–å…ˆè¦çŸ¥é“ï¼Œ<code>TextEncoder</code>æ˜¯ä¸€ä¸ªå…¨å±€çš„å·¥å…·ç±»ï¼ˆUtility classï¼‰ï¼Œå®ƒç”¨æ¥å°† JavaScript å­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ UTF-16 ç¼–ç ï¼‰è½¬æ¢æˆå­—èŠ‚æµï¼ˆbyte streamï¼‰ï¼Œé€šå¸¸æ˜¯ä¸ºäº†ä»¥ UTF-8 æ ¼å¼å­˜å‚¨æˆ–ä¼ è¾“æ•°æ®ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠä½ èƒ½è¯»æ‡‚çš„æ–‡æœ¬è½¬æ¢æˆè®¡ç®—æœºåº•å±‚å¯ä»¥å¤„ç†çš„æ•°å­—æ ¼å¼ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>TextEncoder</code>é»˜è®¤æ”¯æŒ UTF-8 ç¼–ç ã€‚UTF-8 æ˜¯ä¸€ç§éå¸¸æµè¡Œçš„å­—ç¬¦ç¼–ç æ–¹å¼ï¼Œèƒ½å¤Ÿç¼–ç ä¸–ç•Œä¸Šå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦ï¼Œå¹¶ä¸”æ˜¯ Internet ä¸Šæœ€å¸¸ç”¨çš„ç¼–ç æ–¹å¼ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-12"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º-uint8array" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º-uint8array"><span>ä¾‹å­ 1ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸º Uint8Array</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> textEncoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encoded</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> textEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encoded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º Uint8Array</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>TextEncoder</code>å®ä¾‹ï¼Œç„¶åè°ƒç”¨<code>encode</code>æ–¹æ³•æ¥è½¬æ¢å­—ç¬¦ä¸²<code>&#39;Hello, World!&#39;</code>ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª<code>Uint8Array</code>ç±»å‹çš„å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†åŸå­—ç¬¦ä¸²æŒ‰ç…§ UTF-8 ç¼–ç åçš„å­—èŠ‚æ•°æ®ã€‚</p><h4 id="ä¾‹å­-2-ä¸-node-js-buffer-ç»“åˆä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä¸-node-js-buffer-ç»“åˆä½¿ç”¨"><span>ä¾‹å­ 2ï¼šä¸ Node.js Buffer ç»“åˆä½¿ç”¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> textEncoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, Node.js!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encoded</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> textEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è½¬æ¢ Uint8Array åˆ° Buffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">encoded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º Buffer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆè½¬æ¢äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸è¿‡è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨<code>Buffer.from()</code>æ–¹æ³•å°†<code>Uint8Array</code>è½¬æ¢æˆäº† Node.js ä¸­çš„<code>Buffer</code>ã€‚<code>Buffer</code>æ˜¯ Node.js ä¸“é—¨ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„ç±»ã€‚</p><h4 id="ä¾‹å­-3-å†™å…¥æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-å†™å…¥æ–‡ä»¶"><span>ä¾‹å­ 3ï¼šå†™å…¥æ–‡ä»¶</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> textEncoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, file system!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encoded</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> textEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†ç¼–ç åçš„å†…å®¹å†™å…¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encoded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The file has been saved!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Node.js çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼ˆ<code>fs</code>ï¼‰ã€‚æˆ‘ä»¬å…ˆç¼–ç ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡<code>fs.writeFile</code>æ–¹æ³•å°†ç¼–ç åçš„æ•°æ®å†™å…¥åˆ°<code>output.txt</code>æ–‡ä»¶ä¸­ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œæ§åˆ¶å°ä¼šæ‰“å°å‡ºâ€œæ–‡ä»¶å·²ç»è¢«ä¿å­˜â€çš„æ¶ˆæ¯ã€‚</p><h3 id="æ€»ç»“-16" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-16"><span>æ€»ç»“</span></a></h3><p>æ€»çš„æ¥è¯´ï¼Œ<code>TextEncoder</code>å…è®¸æˆ‘ä»¬åœ¨ Node.js ç¯å¢ƒä¸­è½»æ¾åœ°å°†å­—ç¬¦ä¸²ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶å†…å®¹ç­‰ï¼‰è½¬æ¢ä¸ºå­—èŠ‚æ•°æ®ï¼Œè¿™æ ·çš„è½¬æ¢å¯¹äºç½‘ç»œé€šä¿¡ã€æ–‡ä»¶æ“ä½œç­‰åœºæ™¯éå¸¸æœ‰ç”¨ã€‚è¿™äº›æ“ä½œèƒŒåçš„åŸºæœ¬æ€æƒ³æ˜¯ç¡®ä¿æ•°æ®å¯ä»¥åœ¨ä¸åŒç³»ç»Ÿé—´æ­£ç¡®æ— è¯¯åœ°ä¼ é€’å’Œå­˜å‚¨ã€‚</p><h2 id="class-textencoderstream" tabindex="-1"><a class="header-anchor" href="#class-textencoderstream"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-textencoderstream" target="_blank" rel="noopener noreferrer">Class: TextEncoderStream</a></span></a></h2><p>éå¸¸å¥½ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„<code>TextEncoderStream</code>ç±»ã€‚</p><p>é¦–å…ˆï¼Œä»æœ€åŸºç¡€çš„æ¦‚å¿µå¼€å§‹ï¼Œ<code>TextEncoderStream</code>æ˜¯ä¸€ä¸ªåœ¨ Node.js ç¯å¢ƒä¸‹å¯ç”¨çš„å…¨å±€ç±»ï¼Œå®ƒä¸»è¦ç”¨äºå°†æ–‡æœ¬ï¼ˆå³å­—ç¬¦ä¸²ï¼‰è½¬æ¢ä¸ºæµå¼çš„äºŒè¿›åˆ¶æ ¼å¼ã€‚è¿™ä¸ªç±»å®é™…ä¸Šæ˜¯ Web å¹³å° API çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ä¸ Streams API ç´§å¯†ç»“åˆä½¿ç”¨ï¼Œä½†å®ƒä¹Ÿè¢« Node.js é‡‡çº³ä»¥æå‡å…¶å¯¹å¤„ç†æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ•°æ®çš„èƒ½åŠ›ã€‚</p><h3 id="å…³é”®ç‚¹ç†è§£" tabindex="-1"><a class="header-anchor" href="#å…³é”®ç‚¹ç†è§£"><span>å…³é”®ç‚¹ç†è§£ï¼š</span></a></h3><ul><li><strong>æ–‡æœ¬åˆ°äºŒè¿›åˆ¶çš„è½¬æ¢</strong>ï¼š<code>TextEncoderStream</code>å…è®¸ä½ æŠŠæ–‡æœ¬ï¼ˆé€šå¸¸æ˜¯ UTF-8 æ ¼å¼çš„å­—ç¬¦ä¸²ï¼‰è½¬æ¢æˆäºŒè¿›åˆ¶æ•°æ®æµï¼ˆUint8Array æ ¼å¼ï¼‰ã€‚è¿™åœ¨å¤„ç†éœ€è¦å¤§é‡æ–‡æœ¬æ•°æ®è½¬åŒ–ä¸ºå¯ä»¥åœ¨ç½‘ç»œä¸Šå‘é€æˆ–å­˜å‚¨ä¸ºæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚</li><li><strong>æµå¼å¤„ç†</strong>ï¼šä¸å•æ¬¡è½¬æ¢ä¸åŒï¼Œ<code>TextEncoderStream</code>æ”¯æŒæµå¼å¤„ç†ï¼Œæ„å‘³ç€å®ƒå¯ä»¥é€æ­¥å¤„ç†å¤§é‡æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®ä¼ è¾“å°¤å…¶é‡è¦ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-3"><span>å®é™…åº”ç”¨ä¾‹å­ï¼š</span></a></h3><ol><li><p><strong>æ–‡ä»¶ç¼–ç </strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦è¯»å–ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆä¾‹å¦‚.log æ—¥å¿—æ–‡ä»¶ï¼‰ï¼Œå¹¶æŠŠå®ƒè½¬æ¢æˆäºŒè¿›åˆ¶æ ¼å¼æ¥è¿›è¡Œå‹ç¼©æˆ–åŠ å¯†åå­˜å‚¨ã€‚ä½¿ç”¨<code>TextEncoderStream</code>ï¼Œä½ å¯ä»¥è½»æ¾åœ°å®ç°è¿™ä¸ªæ–‡æœ¬åˆ°äºŒè¿›åˆ¶çš„è½¬æ¢è¿‡ç¨‹ã€‚</p></li><li><p><strong>ç½‘ç»œä¼ è¾“</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨éœ€è¦é€šè¿‡ç½‘ç»œå‘é€æ–‡æœ¬æ•°æ®ï¼ˆæ¯”å¦‚ JSONï¼‰ï¼Œä½ å¯èƒ½æƒ³è¦å…ˆå°†æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼æ¥ä¼˜åŒ–ä¼ è¾“æ•ˆç‡ã€‚è¿™é‡Œï¼Œ<code>TextEncoderStream</code>å¯ä»¥ä½œä¸ºè¿™ä¸ªè½¬æ¢è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå¸®åŠ©å‡å°‘å‘é€æ•°æ®æ—¶æ‰€éœ€çš„å¸¦å®½ã€‚</p></li><li><p><strong>æ•°æ®å¤„ç†ç®¡é“</strong>ï¼šè€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œå…¶ä¸­ä½ çš„ Node.js åº”ç”¨éœ€è¦ä»ä¸€ä¸ªæºï¼ˆæ¯”å¦‚ API æˆ–æ•°æ®åº“ï¼‰è·å–æ–‡æœ¬ï¼Œç»è¿‡è½¬æ¢ï¼ˆåŠ å¯†ã€å‹ç¼©ç­‰ï¼‰åå†å‘é€ç»™å¦ä¸€ä¸ªç›®çš„åœ°ã€‚<code>TextEncoderStream</code>å¯ä»¥è¢«æ’å…¥åˆ°è¿™ä¸ªæ•°æ®å¤„ç†é“¾ä¸­ï¼Œè´Ÿè´£å°†æ–‡æœ¬è½¬æ¢ä¸ºäºŒè¿›åˆ¶æµï¼Œä»¥ä¾¿åç»­çš„å¤„ç†æµç¨‹å¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡Œã€‚</p></li></ol><h3 id="ç¤ºä¾‹ä»£ç æ®µ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç æ®µ"><span>ç¤ºä¾‹ä»£ç æ®µï¼š</span></a></h3><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨<code>TextEncoderStream</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">TextEncoderStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªä»æ–‡æœ¬æ–‡ä»¶è¯»å–çš„æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªTextEncoderStreamï¼Œå°†æ–‡æœ¬è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextEncoderStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå†™å…¥æµï¼Œè¾“å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.bin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨pipelineå°†è¿™äº›æµè¿æ¥èµ·æ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline succeeded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª pipelineï¼Œå…¶ä¸­åŒ…å«ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶è¯»å–ã€å°†è¯»å–çš„æ–‡æœ¬è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œç„¶åå°†è½¬æ¢åçš„æ•°æ®å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶çš„è¿‡ç¨‹ã€‚è¿™åªæ˜¯<code>TextEncoderStream</code>æ½œåŠ›çš„ä¸€ä¸ªå°çª¥ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥åº”ç”¨äºæ›´å¤šå¤æ‚ä¸”å¼ºå¤§çš„æ•°æ®å¤„ç†åœºæ™¯ä¸­ã€‚</p><h2 id="class-transformstream" tabindex="-1"><a class="header-anchor" href="#class-transformstream"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-transformstream" target="_blank" rel="noopener noreferrer">Class: TransformStream</a></span></a></h2><p>Node.js çš„<code>TransformStream</code>ç±»æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨æ•°æ®è¢«è¯»å–å’Œå†™å…¥ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚è¿™æ„å‘³ç€æ•°æ®å¯ä»¥åœ¨è¢«æœ€ç»ˆå¤„ç†å‰ä»¥æŸç§æ–¹å¼è¢«ä¿®æ”¹æˆ–è€…å˜åŒ–ã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å–å’Œå†™å…¥æ•°æ®çš„ä¸€ç§é«˜æ•ˆæ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“å¤„ç†å¤§é‡æ•°æ®æˆ–è€…æ¥è‡ªå¤–éƒ¨èµ„æºï¼ˆæ¯”å¦‚æ–‡ä»¶æˆ–ç½‘ç»œè¯·æ±‚ï¼‰çš„æ•°æ®æ—¶ã€‚<code>TransformStream</code>åˆ™è¿›ä¸€æ­¥æ‰©å±•äº†è¿™äº›èƒ½åŠ›ã€‚</p><h3 id="ç†è§£-transformstream" tabindex="-1"><a class="header-anchor" href="#ç†è§£-transformstream"><span>ç†è§£ TransformStream</span></a></h3><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>TransformStream</code>æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æµï¼Œå®ƒè¡¨ç°ä¸ºåŒæ—¶å¯è¯»ä¹Ÿå¯å†™çš„æµï¼Œå¹¶ä¸”åœ¨è¾“å…¥ä¸è¾“å‡ºä¹‹é—´è¿›è¡ŒæŸç§å½¢å¼çš„è½¬æ¢æˆ–æ“ä½œã€‚å®ƒç»§æ‰¿è‡ª Node.js ä¸­çš„<code>Duplex</code>æµï¼Œä½†æ·»åŠ äº†è½¬æ¢åŠŸèƒ½ã€‚ä½ å¯ä»¥å°†å®ƒæƒ³è±¡æˆä¸€ä¸ªç®¡é“æ®µï¼Œåœ¨è¿™ä¸ªç®¡é“æ®µå†…éƒ¨ï¼ŒæµåŠ¨çš„æ•°æ®ä¼šè¢«ä»¥æŸç§æ–¹å¼åŠ å·¥æˆ–ä¿®æ”¹ã€‚</p><h3 id="transformstream-çš„ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#transformstream-çš„ç”¨æ³•"><span>TransformStream çš„ç”¨æ³•</span></a></h3><p>ä¸ºäº†ä½¿ç”¨<code>TransformStream</code>ï¼Œä½ é€šå¸¸éœ€è¦é€šè¿‡æ‰©å±•<code>TransformStream</code>ç±»æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„è½¬æ¢æµï¼Œå®ç°ä½ è‡ªå·±çš„<code>transform</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå®šä¹‰å¦‚ä½•å¤„ç†è¾“å…¥çš„æ•°æ®å¹¶ç”Ÿæˆè¾“å‡ºæ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">TransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„ï¼šä»Node.js 16.5.0å¼€å§‹æ”¯æŒ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyTransformStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> TransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è¿™é‡Œå®šä¹‰å¦‚ä½•å¤„ç†æ¯ä¸ªæ•°æ®å—ï¼ˆchunkï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ä¾‹å¦‚ï¼Œå°†æ‰€æœ‰æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> transformedChunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">transformedChunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†è½¬æ¢åçš„æ•°æ®å—æ”¾å…¥é˜Ÿåˆ—ç­‰å¾…ä¸‹æ¸¸å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-æ–‡ä»¶å†…å®¹è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ–‡ä»¶å†…å®¹è½¬æ¢"><span>ç¤ºä¾‹ 1ï¼šæ–‡ä»¶å†…å®¹è½¬æ¢</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³å°†å…¶ä¸­çš„æ‰€æœ‰æ–‡å­—è½¬æ¢ä¸ºå¤§å†™ï¼Œç„¶åä¿å­˜åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">TransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè½¬æ¢æµå®ä¾‹ï¼Œç”¨äºå°†æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> uppercaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨pipelineæ–¹æ³•æ¥ç®€åŒ–æµçš„è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä»input.txtæ–‡ä»¶ä¸­è¯»å–å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  uppercaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é€šè¿‡æˆ‘ä»¬çš„è½¬æ¢æµå°†å†…å®¹è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†è½¬æ¢åçš„å†…å®¹å†™å…¥output.txtæ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline succeeded.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å®æ—¶æ•°æ®å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å®æ—¶æ•°æ®å‹ç¼©"><span>ç¤ºä¾‹ 2ï¼šå®æ—¶æ•°æ®å‹ç¼©</span></a></h4><p>å¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦æ¥æ”¶æ•°æ®ï¼Œç„¶åå³æ—¶å‹ç¼©å¹¶ä¼ è¾“è¯¥æ•°æ®çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨<code>zlib</code>æ¨¡å—æä¾›çš„å‹ç¼©åŠŸèƒ½ç»“åˆ<code>TransformStream</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">TransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream/web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªgzipå‹ç¼©æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬è¦å‹ç¼©çš„æ•°æ®æ¥è‡ªä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†å…¶å†™å…¥å¦ä¸€ä¸ª.gzæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ•°æ®é€šè¿‡gzipæµè¿›è¡Œå‹ç¼©</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline succeeded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°<code>TransformStream</code>èƒ½å¤Ÿåœ¨æ•°æ®çš„è¯»å–ã€å¤„ç†å’Œè¾“å‡ºè¿‡ç¨‹ä¸­èµ·åˆ°æ¡¥æ¢çš„ä½œç”¨ï¼Œæ— è®ºæ˜¯å¯¹æ•°æ®è¿›è¡Œæ ¼å¼è½¬æ¢è¿˜æ˜¯å‹ç¼©éƒ½å±•ç¤ºäº†å…¶å¼ºå¤§çš„çµæ´»æ€§ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä½¿ç”¨ Node.js çš„æµï¼Œä½ å¯ä»¥æ›´é«˜æ•ˆåœ°å¤„ç†æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹æ–‡ä»¶æˆ–æ•°æ®æµæ—¶ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®åˆ°å†…å­˜ä¸­ã€‚</p><h2 id="class-transformstreamdefaultcontroller" tabindex="-1"><a class="header-anchor" href="#class-transformstreamdefaultcontroller"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-transformstreamdefaultcontroller" target="_blank" rel="noopener noreferrer">Class: TransformStreamDefaultController</a></span></a></h2><p>Node.js ä¸­çš„<code>TransformStreamDefaultController</code>æ˜¯ç”¨äºå¤„ç†æµæ•°æ®ï¼ˆstreamï¼‰çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨æ•°æ®ä»æºå¤´åˆ°ç›®çš„åœ°ä¼ è¾“çš„è¿‡ç¨‹ä¸­å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹æˆ–è½¬æ¢ã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚è¦ç†è§£<code>TransformStreamDefaultController</code>ï¼Œé¦–å…ˆéœ€è¦ç®€å•äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><p><strong>æµï¼ˆStreamï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—æ•°æ®å…ƒç´ ï¼Œè¿™äº›æ•°æ®å…ƒç´ å¯ä»¥é€ä¸ªåœ°è¢«å¤„ç†å’Œä¼ è¾“ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…å³å¯è¯»åˆå¯å†™ã€‚</p></li><li><p><strong>Transform Stream</strong>ï¼šè½¬æ¢æµï¼ˆTransform Streamï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åŒå·¥æµï¼ˆDuplex Streamï¼‰ï¼Œå®ƒæ—¢æ˜¯å¯è¯»çš„ä¹Ÿæ˜¯å¯å†™çš„ã€‚å…¶ç‰¹ç‚¹æ˜¯å¯ä»¥åœ¨è¯»å–è¾“å…¥æ•°æ®å’Œç”Ÿæˆè¾“å‡ºæ•°æ®ä¹‹é—´æ‰§è¡ŒæŸç§è½¬æ¢æˆ–æ“ä½œã€‚</p></li></ol><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ·±å…¥äº†è§£<code>TransformStreamDefaultController</code>çš„è§’è‰²å’ŒåŠŸèƒ½ã€‚åœ¨ Node.js çš„ Streams API ä¸­ï¼Œ<code>TransformStreamDefaultController</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº†æ§åˆ¶è½¬æ¢æµè¡Œä¸ºçš„æ–¹æ³•ï¼Œæ¯”å¦‚å‘æµä¸­æ·»åŠ æ•°æ®ã€ç»ˆæ­¢æµæˆ–æŠ¥å‘Šé”™è¯¯ç­‰ã€‚å½“ä½ åˆ›å»ºè‡ªå®šä¹‰çš„è½¬æ¢æµæ—¶ï¼ŒNode.js ä¼šåœ¨èƒŒåä¸ºä½ åˆ›å»ºä¸€ä¸ª<code>TransformStreamDefaultController</code>å®ä¾‹ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå®ä¾‹æ¥æ§åˆ¶æµçš„è¡Œä¸ºã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠ‚ç‚¹åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œå‹ç¼©æˆ–åŠ å¯†ï¼Œæœ€åå°†å¤„ç†åçš„æ•°æ®å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶æˆ–å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</p><ol><li><strong>æ—¥å¿—æ–‡ä»¶è½¬æ¢</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨ç”Ÿæˆäº†å¤§é‡çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”ä½ å¸Œæœ›å®æ—¶ç›‘è§†å¹¶åˆ†æè¿™äº›æ—¥å¿—ï¼Œä½†åªå…³å¿ƒå…¶ä¸­çš„è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯ã€‚ä½ å¯ä»¥ä½¿ç”¨è½¬æ¢æµæ¥å®ç°è¿™ä¸€ç‚¹ï¼Œé€šè¿‡è®¾ç½®ä¸€ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä»…æŠŠåŒ…å«ç‰¹å®šå…³é”®è¯ï¼ˆå¦‚&quot;ERROR&quot;æˆ–&quot;WARNING&quot;ï¼‰çš„æ—¥å¿—è¡Œè¾“å‡ºåˆ°å¤„ç†æµä¸­ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè½¬æ¢æµï¼Œä»…ä¿ç•™å«æœ‰â€œERRORâ€æˆ–â€œWARNINGâ€çš„æ—¥å¿—è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> filterLogs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> line</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ERROR&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;WARNING&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯ä»¥æŠŠè¿™ä¸ªè½¬æ¢æµè¿æ¥åˆ°æ—¥å¿—æ–‡ä»¶çš„è¯»å–æµå’Œè¾“å‡ºæµä¹‹é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>æ•°æ®åŠ å¯†</strong>ï¼šåœ¨å°†æ•°æ®å†™å…¥ç£ç›˜ä¹‹å‰ï¼Œå¯èƒ½æƒ³è¦å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªè½¬æ¢æµï¼Œå®ƒè¯»å–åŸå§‹æ•°æ®ï¼Œä½¿ç”¨åŠ å¯†ç®—æ³•å¤„ç†æ•°æ®ï¼Œç„¶åè¾“å‡ºåŠ å¯†åçš„æ•°æ®ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æœ‰ä¸€ä¸ªåŠ å¯†å‡½æ•°encryptData</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encryptStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encryptedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> encryptData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç„¶åï¼Œä½ å¯ä»¥å°†è¿™ä¸ªæµæ’å…¥åˆ°æ•°æ®çš„å†™å…¥è¿‡ç¨‹ä¸­</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç†è§£<code>TransformStreamDefaultController</code>åŠå…¶åœ¨ Node.js ä¸­çš„åº”ç”¨ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°åˆ©ç”¨ Node.js å¤„ç†å¤æ‚çš„æ•°æ®æµåœºæ™¯ã€‚é€šè¿‡è‡ªå®šä¹‰è½¬æ¢æµï¼Œä½ å¯ä»¥é«˜æ•ˆåœ°å¯¹æ•°æ®æµè¿›è¡Œè¯»å–ã€è½¬æ¢å’Œå†™å…¥æ“ä½œï¼Œæ»¡è¶³å„ç§å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p><h2 id="url" tabindex="-1"><a class="header-anchor" href="#url"><span><a href="https://nodejs.org/docs/latest/api/globals.html#url" target="_blank" rel="noopener noreferrer">URL</a></span></a></h2><p>Node.js ä¸­çš„ URL æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—å®ç”¨åŠŸèƒ½ï¼Œç”¨ä»¥å¤„ç†å’Œè§£æ URLã€‚URLï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰æ˜¯äº’è”ç½‘ä¸Šç”¨äºæ ‡è¯†èµ„æºä½ç½®çš„åœ°å€ã€‚åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­ï¼Œå…³äº URL çš„ä¿¡æ¯ä¸»è¦é›†ä¸­åœ¨å…¨å±€ URL ç±»ä»¥åŠä¸ä¹‹ç›¸å…³çš„å‡ ä¸ªé‡è¦ç»„ä»¶ä¸Šã€‚ä¸‹é¢æˆ‘å°†é€šè¿‡ä¸€äº›é€šä¿—æ˜“æ‡‚çš„è§£é‡Šå’Œå®é™…ä¾‹å­æ¥ä¸ºä½ ä»‹ç»è¿™äº›å†…å®¹ã€‚</p><h3 id="å…¨å±€-url-ç±»" tabindex="-1"><a class="header-anchor" href="#å…¨å±€-url-ç±»"><span>å…¨å±€ URL ç±»</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>URL</code> ç±»æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒä½¿å¾—ä¸éœ€è¦é€šè¿‡ <code>require(&#39;url&#39;)</code> æ¥å¯¼å…¥å³å¯ä½¿ç”¨ã€‚è¿™ä¸ªç±»æä¾›äº†æ„é€ ã€è§£æå’Œç¼–ç  URL çš„ APIã€‚</p><h4 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><p><strong>åˆ›å»ºå’Œè§£æ URLï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myURL</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/p/a/t/h?query=string#hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: example.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: /p/a/t/h</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">search</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: ?query=string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: #hash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ URL å¯¹è±¡ï¼Œå…¶åŒ…å«äº†ç½‘ç«™çš„åè®® (<code>https</code>)ã€ä¸»æœºå (<code>example.com</code>)ã€è·¯å¾„ (<code>/p/a/t/h</code>)ã€æŸ¥è¯¢å‚æ•° (<code>?query=string</code>) å’Œç‰‡æ®µ (<code>#hash</code>) ç­‰éƒ¨åˆ†ã€‚</p><p><strong>ä¿®æ”¹ URL ç»„ä»¶ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/a/b/c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">search</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;?type=test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: https://example.com/a/b/c?type=test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤ä¾‹å±•ç¤ºäº†å¦‚ä½•ä¿®æ”¹ URL çš„è·¯å¾„å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”é€šè¿‡ <code>toString()</code> æ–¹æ³•è¾“å‡ºæœ€ç»ˆçš„ URL å­—ç¬¦ä¸²ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-4"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>å¼€å‘ RESTful API</strong>ï¼šåœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œç»å¸¸éœ€è¦è§£æè¯·æ±‚ä¸­çš„ URL æ¥è·å–èµ„æºè·¯å¾„ã€æŸ¥è¯¢å‚æ•°ç­‰ä¿¡æ¯ï¼Œä»è€Œå†³å®šç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚</p></li><li><p><strong>ç½‘é¡µçˆ¬è™«</strong>ï¼šå¯¹äºçˆ¬è™«åº”ç”¨ï¼Œç»å¸¸éœ€è¦ä»ç½‘é¡µä¸­æå–é“¾æ¥å¹¶è§£æè¿™äº›é“¾æ¥çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œä»¥æ–¹ä¾¿åç»­çš„é¡µé¢ä¸‹è½½å’Œæ•°æ®æå–ã€‚</p></li><li><p><strong>æ„å»º Web åº”ç”¨</strong>ï¼šåœ¨æ„å»º Web åº”ç”¨æ—¶ï¼Œé€šå¸¸éœ€è¦æ ¹æ®ä¸åŒçš„ URL è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°æ¸²æŸ“ä¸åŒçš„é¡µé¢å†…å®¹æˆ–æ‰§è¡Œç‰¹å®šçš„åç«¯é€»è¾‘ã€‚</p></li><li><p><strong>æ•°æ®åˆ†æ</strong>ï¼šåœ¨è¿›è¡Œæ—¥å¿—åˆ†ææˆ–ç”¨æˆ·è¡Œä¸ºåˆ†ææ—¶ï¼Œè§£æè®¿é—®ç½‘ç«™çš„ URL å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ç”¨æˆ·çš„æ„å›¾å’Œåå¥½ã€‚</p></li></ol><p>Node.js ä¸­çš„ URL æ¨¡å—æ˜¯å¤„ç†ç½‘ç»œç¼–ç¨‹ä»»åŠ¡æ—¶ä¸å¯æˆ–ç¼ºçš„å·¥å…·ä¹‹ä¸€ï¼Œæ— è®ºæ˜¯ç®€å•çš„ URL è§£æè¿˜æ˜¯å¤æ‚çš„ Web åº”ç”¨å¼€å‘ï¼Œéƒ½å¯èƒ½ä¼šç”¨åˆ°å®ƒã€‚å¸Œæœ›ä»¥ä¸Šçš„ä»‹ç»å’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œå­¦ä¹  Node.js ä¸­çš„ URL å¤„ç†æœºåˆ¶ã€‚</p><h2 id="urlsearchparams" tabindex="-1"><a class="header-anchor" href="#urlsearchparams"><span><a href="https://nodejs.org/docs/latest/api/globals.html#urlsearchparams" target="_blank" rel="noopener noreferrer">URLSearchParams</a></span></a></h2><p>Node.js ä¸­çš„ <code>URLSearchParams</code> æ˜¯ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ç±»ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å¤„ç† URL ä¸­çš„æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªå·¥å…·ç®±ï¼Œå®ƒè®©ä½ è½»æ¾åœ°è¯»å–ã€ä¿®æ”¹ã€æ£€æŸ¥æˆ–è€…åˆ é™¤ URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„å‚æ•°ã€‚</p><h3 id="åŸºæœ¬ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä½¿ç”¨-1"><span>åŸºæœ¬ä½¿ç”¨</span></a></h3><p>å½“ä½ åœ¨ç½‘é¡µåœ°å€ï¼ˆURLï¼‰ä¸­çœ‹åˆ° <code>?</code> åé¢è·Ÿç€çš„æ–‡æœ¬æ—¶ï¼Œé‚£äº›å°±æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼Œåœ¨ URL <code>https://example.com/?name=John&amp;age=30</code> ä¸­ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯ <code>name=John&amp;age=30</code>ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>name</code> çš„å€¼æ˜¯ <code>John</code>ï¼Œ<code>age</code> çš„å€¼æ˜¯ <code>30</code>ã€‚</p><h3 id="å®ä¾‹åŒ–" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åŒ–"><span>å®ä¾‹åŒ–</span></a></h3><p>é¦–å…ˆï¼Œä½ å¯ä»¥é€šè¿‡ç›´æ¥ä¼ é€’æŸ¥è¯¢å­—ç¬¦ä¸²æ¥åˆ›å»ºä¸€ä¸ª <code>URLSearchParams</code> çš„å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> params</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name=John&amp;age=30&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªå¯¹è±¡æ¥åˆ›å»ºå®ä¾‹ï¼Œå¯¹è±¡çš„é”®å€¼å¯¹ä¼šè¢«è½¬æ¢æˆæŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„å‚æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> params</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;John&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="è¯»å–å‚æ•°" tabindex="-1"><a class="header-anchor" href="#è¯»å–å‚æ•°"><span>è¯»å–å‚æ•°</span></a></h3><p>ä½ å¯ä»¥ä½¿ç”¨ <code>.get()</code> æ–¹æ³•æ¥è·å–ç‰¹å®šå‚æ•°çš„å€¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: John</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: 30</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ·»åŠ æˆ–ä¿®æ”¹å‚æ•°" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ æˆ–ä¿®æ”¹å‚æ•°"><span>æ·»åŠ æˆ–ä¿®æ”¹å‚æ•°</span></a></h3><p>å¦‚æœä½ æƒ³æ·»åŠ æ–°çš„å‚æ•°ï¼Œæˆ–è€…ä¿®æ”¹ç°æœ‰å‚æ•°çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>.set()</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;job&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Developer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Jane&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœä½ è¾“å‡ºæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œä¼šçœ‹åˆ° <code>name</code> å·²ç»è¢«æ”¹æˆ <code>Jane</code>ï¼Œå¹¶ä¸”æ–°å¢äº†ä¸€ä¸ª <code>job</code> å‚æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: name=Jane&amp;age=30&amp;job=Developer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="åˆ é™¤å‚æ•°" tabindex="-1"><a class="header-anchor" href="#åˆ é™¤å‚æ•°"><span>åˆ é™¤å‚æ•°</span></a></h3><p>è¦åˆ é™¤ä¸€ä¸ªå‚æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>.delete()</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: name=Jane&amp;job=Developer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="éå†å‚æ•°" tabindex="-1"><a class="header-anchor" href="#éå†å‚æ•°"><span>éå†å‚æ•°</span></a></h3><p>å¦‚æœä½ æƒ³éå†æ‰€æœ‰çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>.forEach()</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">è¾“å‡º:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name: Jane</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">job: Developer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">*/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-4"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="ç®¡ç†ç½‘å€å‚æ•°" tabindex="-1"><a class="header-anchor" href="#ç®¡ç†ç½‘å€å‚æ•°"><span>ç®¡ç†ç½‘å€å‚æ•°</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ä¸Šå•†åŸçš„å‰ç«¯ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²æ¥è¿‡æ»¤æœç´¢ç»“æœï¼Œæ¯”å¦‚æŒ‰ç…§å“ç‰Œå’Œä»·æ ¼åŒºé—´ç­›é€‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>URLSearchParams</code> æ¥è½»æ¾ç®¡ç†è¿™äº›æŸ¥è¯¢å‚æ•°ã€‚</p><h4 id="ajax-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ajax-è¯·æ±‚"><span>AJAX è¯·æ±‚</span></a></h4><p>åœ¨å‘é€ AJAX è¯·æ±‚æ—¶ï¼Œç»å¸¸éœ€è¦å°†æ•°æ®é™„åŠ åˆ°æŸ¥è¯¢å­—ç¬¦ä¸²ä¸Šã€‚ä½¿ç”¨ <code>URLSearchParams</code>ï¼Œä½ å¯ä»¥è½»æ¾æ„å»ºè¿™éƒ¨åˆ†å†…å®¹ï¼Œå¹¶ç¡®ä¿æ•°æ®ä»¥æ­£ç¡®çš„æ ¼å¼å‘é€ã€‚</p><h4 id="é¡µé¢é‡å®šå‘" tabindex="-1"><a class="header-anchor" href="#é¡µé¢é‡å®šå‘"><span>é¡µé¢é‡å®šå‘</span></a></h4><p>å¦‚æœä½ çš„ç½‘ç«™æˆ–åº”ç”¨éœ€è¦æ ¹æ®æŸäº›æ¡ä»¶é‡å®šå‘ç”¨æˆ·ï¼Œå¹¶åœ¨æ–°çš„ URL ä¸Šé™„åŠ æ•°æ®ï¼ˆå¦‚çŠ¶æ€æ¶ˆæ¯ï¼‰ï¼Œ<code>URLSearchParams</code> å¯ä»¥å¸®åŠ©ä½ ä»¥ç¼–ç¨‹æ–¹å¼æ„å»ºè¿™äº› URLã€‚</p><p>æ€»ä¹‹ï¼Œ<code>URLSearchParams</code> æ˜¯å¤„ç† Web å¼€å‘ä¸­å¸¸è§ä»»åŠ¡çš„å¼ºå¤§å·¥å…·ã€‚é€šè¿‡æä¾›æ¸…æ™°ã€ç®€æ´çš„ APIï¼Œå®ƒè®©æ“ä½œ URL æŸ¥è¯¢å­—ç¬¦ä¸²å˜å¾—ç®€å•ç›´æ¥ã€‚</p><h2 id="webassembly" tabindex="-1"><a class="header-anchor" href="#webassembly"><span><a href="https://nodejs.org/docs/latest/api/globals.html#webassembly" target="_blank" rel="noopener noreferrer">WebAssembly</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚WebAssemblyï¼ˆç¼©å†™ä¸º Wasmï¼‰æ˜¯ä¸€ç§ä½çº§è¯­è¨€ï¼Œå®ƒå…è®¸åœ¨ç½‘ç»œä¸Šé«˜æ•ˆåœ°æ‰§è¡Œä»£ç ï¼Œå¹¶ä¸”å¯ç”±å¤šç§ç¼–ç¨‹è¯­è¨€ç¼–å†™ç„¶åç¼–è¯‘æˆ WebAssemblyã€‚</p><p>åœ¨ Node.js ä¸­ä½¿ç”¨ WebAssembly æœ‰å¾ˆå¤šå¥½å¤„ï¼š</p><ol><li><strong>æ€§èƒ½</strong>ï¼šWebAssembly èƒ½å¤Ÿæä¾›æ¥è¿‘åŸç”Ÿçš„æ‰§è¡Œé€Ÿåº¦ï¼Œè¿™å¯¹äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡éå¸¸æœ‰åˆ©ã€‚</li><li><strong>è·¨å¹³å°</strong>ï¼šç¼–å†™ä¸€æ¬¡ï¼Œéšå¤„è¿è¡Œã€‚é€šè¿‡ WebAssemblyï¼Œä½ å¯ä»¥ç¼–å†™ç¨‹åºå¹¶å°†å…¶ç¼–è¯‘æˆä¸€ç§æ ¼å¼ï¼Œè¯¥æ ¼å¼åœ¨æ‰€æœ‰æ”¯æŒ WebAssembly çš„å¹³å°ä¸Šéƒ½èƒ½è¿è¡Œã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šWebAssembly åœ¨ä¸€ä¸ªæ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒã€‚</li></ol><p>Node.js v21.7.1 å¯¹ WebAssembly çš„æ”¯æŒæ„å‘³ç€ä½ å¯ä»¥åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­åŠ è½½å’Œè¿è¡Œ WebAssembly æ¨¡å—ã€‚ä¸‹é¢æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ WebAssembly çš„æ­¥éª¤åŠä¾‹å­ï¼š</p><h3 id="æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤"><span>æ­¥éª¤ï¼š</span></a></h3><ol><li><p><strong>ç¼–è¯‘åˆ° WebAssembly</strong>: é¦–å…ˆï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªç¼–è¯‘ä¸º <code>.wasm</code> æ ¼å¼çš„æ¨¡å—ã€‚è¿™é€šå¸¸æ„å‘³ç€ä½ ä¼šä» C/C++ã€Rust ç­‰è¯­è¨€å†™ä»£ç ï¼Œç„¶åä½¿ç”¨ç›¸åº”çš„å·¥å…·é“¾å°†å…¶ç¼–è¯‘æˆ WebAssembly æ¨¡å—ã€‚</p></li><li><p><strong>åŠ è½½ WebAssembly æ¨¡å—</strong>: åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>WebAssembly.instantiate()</code> æˆ– <code>WebAssembly.instantiateStreaming()</code> æ–¹æ³•æ¥åŠ è½½ <code>.wasm</code> æ–‡ä»¶ã€‚</p></li></ol><h3 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­ï¼š</span></a></h3><p>å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªåä¸º <code>simple.wasm</code> çš„ WebAssembly æ¨¡å—æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªå¢åŠ ä¸¤ä¸ªæ•°çš„å‡½æ•°ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·åŠ è½½å’Œä½¿ç”¨å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promises</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> loadWasmFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">fileName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> filePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ³¨æ„ï¼šå®é™…çš„å®ä¾‹åŒ–æ–¹æ³•å¯èƒ½å›  Node.js ç‰ˆæœ¬è€Œå¼‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> WebAssembly</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">instantiate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">wasmBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmInstance</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> loadWasmFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;simple.wasm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾ simple.wasm å¯¼å‡ºäº†ä¸€ä¸ªå«åš &#39;add&#39; çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> wasmInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Result of add function: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åº”è¯¥æ‰“å° 8ï¼Œå¦‚æœ add å‡½æ•°æ˜¯å°†ä¸¤ä¸ªæ•°ç›¸åŠ çš„è¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error loading WebAssembly module:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Node.js çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆ<code>fs</code>ï¼‰æ¨¡å—ä»¥å¼‚æ­¥æ–¹å¼è¯»å– <code>.wasm</code> æ–‡ä»¶ã€‚ç„¶åä½¿ç”¨ <code>WebAssembly.instantiate()</code> æ–¹æ³•å°†äºŒè¿›åˆ¶æ•°æ®å®ä¾‹åŒ–ä¸ºä¸€ä¸ªå¯ä»¥æ“ä½œçš„ WebAssembly å®ä¾‹ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨æ­¤å®ä¾‹ä¸­å¯¼å‡ºçš„ <code>add</code> å‡½æ•°ï¼Œå¹¶æ‰“å°ç»“æœã€‚</p><p>è¯·æ³¨æ„ï¼ŒWebAssembly åœ¨ä¸åŒçš„ç¯å¢ƒå’Œåº”ç”¨åœºæ™¯ä¸­å¯èƒ½è¡¨ç°ä¸åŒï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•ä¹Ÿå¯èƒ½éš Node.js ç‰ˆæœ¬çš„å˜åŒ–è€Œå˜åŒ–ã€‚å› æ­¤ï¼Œå»ºè®®æ£€æŸ¥ Node.js çš„å®˜æ–¹æ–‡æ¡£ä»¥è·å–ç›¸å…³ API çš„æœ€æ–°ä¿¡æ¯å’Œä½¿ç”¨æŒ‡å—ã€‚</p><h2 id="websocket" tabindex="-1"><a class="header-anchor" href="#websocket"><span><a href="https://nodejs.org/docs/latest/api/globals.html#websocket" target="_blank" rel="noopener noreferrer">WebSocket</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚WebSocket åˆ™æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ï¼Œå®ƒæä¾›äº†åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šè®¯çš„èƒ½åŠ›ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼ŒWebSocket è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç›´æ¥åœ¨ Node.js ä»£ç ä¸­ä½¿ç”¨ WebSocket è€Œä¸éœ€è¦é¢å¤–å®‰è£…æ¨¡å—ã€‚</p><p>WebSocket ä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¯ä»¥å»ºç«‹æŒä¹…çš„è¿æ¥ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¯ä»¥å®æ—¶åœ°å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ã€‚è¿™ä¸ªæœºåˆ¶éå¸¸é€‚åˆéœ€è¦å®æ—¶æ€§è¾ƒé«˜çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚åœ¨çº¿æ¸¸æˆã€èŠå¤©åº”ç”¨ã€å®æ—¶é€šçŸ¥ç³»ç»Ÿç­‰ã€‚</p><p>å½“ä½ ä½¿ç”¨ WebSocket çš„æ—¶å€™ï¼Œä¼šéµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªç‰¹æ®Šçš„ HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè¿™ä¸ªè¯·æ±‚è¢«ç§°ä½œ &quot;WebSocket æ¡æ‰‹&quot; è¯·æ±‚ã€‚</li><li>å¦‚æœæœåŠ¡å™¨æ”¯æŒ WebSocketï¼Œå®ƒä¼šå“åº”ä¸€ä¸ª &quot;æ¡æ‰‹&quot; å“åº”ï¼Œç„¶åè¿æ¥å°±ä¼šä» HTTP å‡çº§åˆ° WebSocket åè®®ã€‚</li><li>ä¸€æ—¦è¿æ¥æˆåŠŸå‡çº§ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å°±å¯ä»¥é€šè¿‡æ­¤è¿æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯äº†ã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ WebSocketï¼š</p><p><strong>æœåŠ¡å™¨ç«¯ (server.js):</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">WebSocketServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ws&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª WebSocket æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wss</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> WebSocketServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">wss</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä¸€ä¸ªå®¢æˆ·ç«¯å·²è¿æ¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯æ—¶è§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> incoming</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä½ å¥½ï¼Œå®¢æˆ·ç«¯ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£ 8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¢æˆ·ç«¯ (client.html):</strong></p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`!DOCTYPE html&gt; `</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`html&gt; `</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`body&gt; `</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`script&gt; let ws = new</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">WebSocket(&quot;ws://localhost:8080&quot;); // å½“ WebSocket è¿æ¥æ‰“å¼€æ—¶è§¦å‘ ws.onopen =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">function(event) { console.log(&quot;è¿æ¥å·²æ‰“å¼€&quot;); // å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ws.send(&quot;ä½ å¥½ï¼ŒæœåŠ¡å™¨ï¼&quot;); }; // å½“ WebSocket æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è§¦å‘ ws.onmessage =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">function(event) { console.log(&quot;æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯ï¼š&quot;, event.data); }; // å½“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">WebSocket å…³é—­æ—¶è§¦å‘ ws.onclose = function(event) { console.log(&quot;è¿æ¥å·²å…³é—­&quot;);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}; `</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`/script&gt; `</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`/body&gt; `</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">`/html&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š</p><ul><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå¹¶åœ¨è¯¥æœåŠ¡å™¨ä¸ŠæŒ‚è½½äº†ä¸€ä¸ª WebSocket æœåŠ¡å™¨ã€‚</li><li>å½“ WebSocket æœåŠ¡å™¨æ¥æ”¶åˆ°æ–°çš„è¿æ¥æ—¶ï¼Œå®ƒä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶è®¾ç½®äº‹ä»¶ç›‘å¬å™¨æ¥å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯ã€‚</li><li>åœ¨å®¢æˆ·ç«¯ HTML ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ WebSocket å®ä¾‹å¹¶è¿æ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚</li><li>å®¢æˆ·ç«¯åœ¨è¿æ¥æ‰“å¼€åå‘é€ä¸€æ¡æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼ŒåŒæ—¶å‡†å¤‡æ¥æ”¶ä»æœåŠ¡å™¨å‘æ¥çš„æ¶ˆæ¯ã€‚</li></ul><p>ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„ WebSocket åœ¨ Node.js ä¸­çš„ä½¿ç”¨ç¤ºä¾‹ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œä½ åº”è¯¥å¯ä»¥ç†è§£å¦‚ä½•åœ¨ Node.js ä¸­åˆ›å»º WebSocket æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œå¹¶è¿›è¡Œç®€å•çš„é€šä¿¡ã€‚</p><h2 id="class-writablestream" tabindex="-1"><a class="header-anchor" href="#class-writablestream"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-writablestream" target="_blank" rel="noopener noreferrer">Class: WritableStream</a></span></a></h2><p>Node.js ä¸­çš„ <code>WritableStream</code> æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨ä¸€ä¸ªç›®æ ‡ï¼Œä½ å¯ä»¥å‘è¿™ä¸ªç›®æ ‡å†™å…¥æ•°æ®ã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œè¿™ä¸ªâ€œç›®æ ‡â€å¯èƒ½æ˜¯æ–‡ä»¶ã€HTTP å“åº”æˆ–è€…æ˜¯ä»»ä½•å¯ä»¥æ¥æ”¶æ•°æ®çš„ç³»ç»Ÿç»„ä»¶ã€‚</p><h3 id="ç†è§£-writablestream" tabindex="-1"><a class="header-anchor" href="#ç†è§£-writablestream"><span>ç†è§£ WritableStream</span></a></h3><p>æƒ³è±¡ <code>WritableStream</code> å°±åƒä¸€ä¸ªæ°´æ¡¶ï¼Œä½ å¯ä»¥å¾€é‡Œé¢å€’æ°´ï¼ˆå†™å…¥æ•°æ®ï¼‰ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ°´æ¡¶ä¸ä»…ä»…å¯ä»¥è£…æ°´ï¼Œå®ƒå¯ä»¥è£…ä»»ä½•ä¸œè¥¿ï¼ˆå³ä»»ä½•ç±»å‹çš„æ•°æ®ï¼‰ã€‚</p><h3 id="æ ¸å¿ƒç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç‰¹æ€§"><span>æ ¸å¿ƒç‰¹æ€§</span></a></h3><ol><li><strong>å¼‚æ­¥å†™å…¥ï¼š</strong> Node.js çš„ <code>WritableStream</code> è®¾è®¡ä¸ºå¼‚æ­¥çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä¸é˜»å¡ç¨‹åºå…¶ä»–éƒ¨åˆ†è¿è¡Œçš„æƒ…å†µä¸‹å‘å…¶å†™å…¥æ•°æ®ã€‚</li><li><strong>èƒŒå‹ç®¡ç†ï¼š</strong> å½“ä½ å‘æµä¸­å†™å…¥æ•°æ®çš„é€Ÿåº¦è¶…è¿‡äº†å®ƒå¤„ç†æ•°æ®çš„é€Ÿåº¦æ—¶ï¼Œ<code>WritableStream</code> èƒ½å¤Ÿé€šè¿‡å†…éƒ¨æœºåˆ¶æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</li><li><strong>å¤šç§æ•°æ®æºï¼š</strong> ä½ å¯ä»¥ä»å¤šç§æ•°æ®æºï¼ˆå¦‚æ–‡ä»¶ã€ç¼“å†²åŒºã€å…¶ä»–æµç­‰ï¼‰å†™å…¥æ•°æ®åˆ° <code>WritableStream</code>ã€‚</li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-13"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªç®€å•çš„ä¾‹å­æ¥æ›´å¥½åœ°ç†è§£ <code>WritableStream</code> çš„åº”ç”¨ï¼š</p><h4 id="ä¾‹å­-1-å†™å…¥æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å†™å…¥æ–‡ä»¶"><span>ä¾‹å­ 1: å†™å…¥æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æƒ³ä¿å­˜ä¸€äº›æ•°æ®åˆ°æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥æ–‡ä»¶çš„ <code>WritableStream</code>ï¼Œç„¶åå°†æ•°æ®å†™å…¥å…¶ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘ &#39;example.txt&#39; çš„ WritableStream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®Œæˆå†™å…¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-http-å“åº”" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-http-å“åº”"><span>ä¾‹å­ 2: HTTP å“åº”</span></a></h4><p>å½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª web æœåŠ¡å™¨æ—¶ï¼Œæ¯å½“æœ‰è¯·æ±‚è¿›æ¥ï¼Œä½ éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªå…³äºè¯¥è¯·æ±‚çš„å“åº”å¯¹è±¡ã€‚è¿™ä¸ªå“åº”å¯¹è±¡å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª <code>WritableStream</code>ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // res (å“åº”å¯¹è±¡) æ˜¯ä¸€ä¸ª WritableStream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, Client!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on port 3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-3-æµå¼å¤„ç†å¤§æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-æµå¼å¤„ç†å¤§æ–‡ä»¶"><span>ä¾‹å­ 3: æµå¼å¤„ç†å¤§æ–‡ä»¶</span></a></h4><p>å¦‚æœä½ è¦å¤„ç†éå¸¸å¤§çš„æ–‡ä»¶ï¼Œä¸€æ¬¡æ€§è¯»å–å¯èƒ½ä¼šå ç”¨å¤ªå¤šå†…å­˜ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>WritableStream</code> æ¥è¿›è¡Œæµå¼å†™å…¥ï¼Œè¾¹è¯»è¾¹å†™ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµå’Œä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;large-input-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å¤§æ–‡ä»¶çš„å†…å®¹æµå¼ä¼ è¾“åˆ°å¦ä¸€ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä¾‹å­å±•ç¤ºäº† <code>WritableStream</code> åœ¨ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨ï¼Œå¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£å®ƒçš„ä½œç”¨å’Œå¦‚ä½•åˆ©ç”¨å®ƒæ¥è¿›è¡Œæœ‰æ•ˆçš„æ•°æ®å¤„ç†ã€‚</p><h2 id="class-writablestreamdefaultcontroller" tabindex="-1"><a class="header-anchor" href="#class-writablestreamdefaultcontroller"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-writablestreamdefaultcontroller" target="_blank" rel="noopener noreferrer">Class: WritableStreamDefaultController</a></span></a></h2><p>å¥½çš„ï¼ŒNode.js ä¸­çš„ <code>WritableStreamDefaultController</code> æ˜¯ä¸€ä¸ªåœ¨æµï¼ˆStreamsï¼‰API ä¸­ä½¿ç”¨çš„æ§åˆ¶å™¨ç±»ã€‚ä½ å¯ä»¥æŠŠæµæ¯”ä½œæ˜¯æ•°æ®çš„ç®¡é“ï¼Œè€Œè¿™ä¸ªæ§åˆ¶å™¨åˆ™ç”¨äºç®¡ç†è¿™äº›æ•°æ®å¦‚ä½•å†™å…¥ç›®æ ‡ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ¦‚å¿µï¼š</p><ul><li><strong>æµ</strong>ï¼šæµæ˜¯ä¸€ç»„æœ‰åºçš„ã€å¯è¯»å–æˆ–å¯å†™å…¥çš„æ•°æ®åºåˆ—ã€‚æƒ³è±¡ä½ æœ‰ä¸€æ ¹æ°´ç®¡ï¼Œæ°´å¯ä»¥ä»ä¸€ç«¯æµåˆ°å¦ä¸€ç«¯ï¼Œæµåœ¨ Node.js ä¸­å°±æ˜¯è¿™æ ·ï¼Œåªä¸è¿‡æµåŠ¨çš„æ˜¯æ•°æ®è€Œä¸æ˜¯æ°´ã€‚</li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦åœ¨ <strong>å¯å†™æµ</strong>ï¼ˆWritable Streamsï¼‰ä¸Šï¼š</p><ul><li><strong>å¯å†™æµ</strong>ï¼šè¿™ç§æµå…è®¸ä½ å°†æ•°æ®å†™å…¥åˆ°æŸå¤„ï¼Œæ¯”å¦‚æ–‡ä»¶ã€HTTP å“åº”ä½“ã€æˆ–è€…æ˜¯å…¶ä»–ä»»ä½•å½¢å¼çš„æ¶ˆè´¹è€…ã€‚</li></ul><p><code>WritableStreamDefaultController</code> æ­£æ˜¯ç”¨æ¥æ§åˆ¶è¿™ç§å¯å†™æµçš„ã€‚å®ƒæä¾›äº†å‡ ä¸ªå…³é”®çš„æ–¹æ³•å’Œå±æ€§æ¥ç®¡ç†æµçš„çŠ¶æ€å’Œè¡Œä¸ºã€‚ä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œä½ ä¸éœ€è¦ç›´æ¥ä¸è¿™ä¸ªæ§åˆ¶å™¨æ‰“äº¤é“ã€‚è¿™ä¸ªæ§åˆ¶å™¨ä¸»è¦è¢«åº•å±‚ç³»ç»Ÿä½¿ç”¨ï¼Œä»¥ç¡®ä¿æ•°æ®æ­£ç¡®åœ°å†™å…¥æµä¸­ã€‚</p><p>ä¸è¿‡ï¼Œäº†è§£å…¶å­˜åœ¨å’ŒåŠŸèƒ½å¯¹äºç†è§£æµçš„å†…éƒ¨å·¥ä½œæœºåˆ¶æ˜¯æœ‰å¸®åŠ©çš„ã€‚è¿™é‡Œæœ‰ä¸€äº› <code>WritableStreamDefaultController</code> çš„å…³é”®ç‰¹æ€§ï¼š</p><ol><li><strong>error()</strong>: å¦‚æœåœ¨å†™å…¥æµçš„è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥æŠ¥å‘Šé”™è¯¯ã€‚</li><li><strong>signal</strong>: è¿™æ˜¯ä¸€ä¸ª <code>AbortSignal</code> å¯¹è±¡ï¼Œå®ƒå…è®¸ä½ é€šè¿‡ä¸€ä¸ªä¿¡å·æ¥åœæ­¢å†™å…¥æ“ä½œã€‚</li></ol><p>ç”±äº <code>WritableStreamDefaultController</code> æ˜¯ä¸€ä¸ªç›¸å¯¹åº•å±‚çš„ APIï¼Œåœ¨æ—¥å¸¸ç¼–ç¨‹ä¸­å¾ˆå°‘ç›´æ¥ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥ä¸¾å®é™…ä¾‹å­å¯èƒ½ä¼šè¶…å‡ºåˆå­¦è€…çš„åº”ç”¨åœºæ™¯ã€‚ä¸è¿‡ï¼Œæˆ‘å¯ä»¥ç»™ä½ å±•ç¤ºä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨é«˜çº§ API æ¥åˆ›å»ºå¯å†™æµï¼Œå¹¶é€šè¿‡å®ƒå†™å…¥æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myWritableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“å‘æµå†™å…¥æ•°æ®æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è°ƒç”¨å›è°ƒè¡¨ç¤ºå®Œæˆå†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å·²å†™å…¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç»“æŸå†™å…¥æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯å†™æµï¼Œå¹¶ä¸”å®šä¹‰äº†å½“æ•°æ®å†™å…¥è¯¥æµæ—¶åº”è¯¥æ‰§è¡Œçš„é€»è¾‘ã€‚æ¯æ¬¡è°ƒç”¨ <code>write()</code> æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šè§¦å‘ <code>write</code> å‡½æ•°ï¼Œå¹¶æ‰“å°ä¼ å…¥çš„æ•°æ®ã€‚å½“è°ƒç”¨ <code>end()</code> æ–¹æ³•æ—¶ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®éœ€è¦å†™å…¥ï¼Œæµåº”è¯¥å…³é—­ã€‚è¿™ä¸ªè¿‡ç¨‹èƒŒåï¼Œ<code>WritableStreamDefaultController</code> å¯èƒ½åœ¨èµ·ç€ä½œç”¨ï¼Œä½†è¿™æ˜¯éšè—åœ¨ Node.js æµå®ç°ä¹‹ä¸‹çš„ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>WritableStreamDefaultController</code> æ˜¯ Node.js æµ API çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåœ¨å¹•åå¸®åŠ©æ§åˆ¶æ•°æ®å¦‚ä½•å†™å…¥å¯å†™æµï¼Œè™½ç„¶ä¸å¸¸ç›´æ¥ä½¿ç”¨å®ƒï¼Œä½†ç†è§£å…¶åŸç†æœ‰åŠ©äºæ·±å…¥ç†è§£ Node.js ä¸­çš„æµå¤„ç†ã€‚</p><h2 id="class-writablestreamdefaultwriter" tabindex="-1"><a class="header-anchor" href="#class-writablestreamdefaultwriter"><span><a href="https://nodejs.org/docs/latest/api/globals.html#class-writablestreamdefaultwriter" target="_blank" rel="noopener noreferrer">Class: WritableStreamDefaultWriter</a></span></a></h2><p>å¥½çš„ï¼Œè®©æˆ‘æ¥ä»¥ç®€å•æ˜“æ‡‚çš„æ–¹å¼è¯´æ˜ Node.js ä¸­çš„ <code>WritableStreamDefaultWriter</code> ç±»ã€‚</p><p>é¦–å…ˆï¼Œç†è§£æµï¼ˆStreamï¼‰æ˜¯å…³é”®ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œæµæ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯æ•°æ®çš„ä¸€è¿ä¸²ä¼ è¾“ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®å°±åƒæ°´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ã€æˆ–è€…ä¸¤è€…å…¼å…·ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>WritableStream</code> æ˜¯è¡¨ç¤ºâ€œå¯å†™æµâ€çš„ä¸€ç§å¯¹è±¡ã€‚è¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿæ¥æ”¶æ•°æ®å¹¶å°†å…¶å‘é€åˆ°æŸä¸ªç›®çš„åœ°ï¼Œæ¯”å¦‚æ–‡ä»¶ã€è¿›ç¨‹ã€HTTP å“åº”ç­‰ã€‚</p><h3 id="writablestreamdefaultwriter-ç±»" tabindex="-1"><a class="header-anchor" href="#writablestreamdefaultwriter-ç±»"><span><code>WritableStreamDefaultWriter</code> ç±»</span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ° <code>WritableStreamDefaultWriter</code> æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨è®¨è®ºä¸€ä¸ªç”¨äºæ“ä½œ <code>WritableStream</code> çš„å·¥å…·ã€‚è¿™ä¸ªç±»æä¾›äº†å¤šç§æ–¹æ³•ï¼Œå…è®¸ä½ é«˜æ•ˆåœ°å‘æµä¸­å†™å…¥æ•°æ®ï¼Œæ§åˆ¶æ•°æ®çš„æµåŠ¨ï¼Œä»¥åŠå¤„ç†å„ç§ä¸æµç›¸å…³çš„äº‹ä»¶ã€‚</p><h3 id="å…³é”®æ–¹æ³•å’Œå±æ€§" tabindex="-1"><a class="header-anchor" href="#å…³é”®æ–¹æ³•å’Œå±æ€§"><span>å…³é”®æ–¹æ³•å’Œå±æ€§</span></a></h3><ul><li><strong>write()</strong>ï¼šå…è®¸ä½ å‘æµä¸­å†™å…¥æ•°æ®ã€‚</li><li><strong>close()</strong>ï¼šå…³é—­æµï¼Œæ„å‘³ç€æ²¡æœ‰æ›´å¤šçš„æ•°æ®å°†è¢«å†™å…¥ã€‚</li><li><strong>abort()</strong>ï¼šå¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•ä¸­æ­¢æµçš„å†™å…¥æ“ä½œã€‚</li><li><strong>ready</strong> å’Œ <strong>desiredSize</strong>ï¼šè¿™äº›å±æ€§æä¾›äº†å…³äºæµå½“å‰çŠ¶æ€çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å®ƒæ˜¯å¦å·²å‡†å¤‡å¥½æ¥æ”¶æ›´å¤šæ•°æ®ï¼Œä»¥åŠæµå¸Œæœ›æ¥æ”¶çš„æ•°æ®å¤§å°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å‘æ–‡ä»¶å†™å…¥å†…å®¹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å‘æ–‡ä»¶å†™å…¥å†…å®¹"><span>ç¤ºä¾‹ 1ï¼šå‘æ–‡ä»¶å†™å…¥å†…å®¹</span></a></h4><p>å‡è®¾ä½ æƒ³é€šè¿‡ Node.js å°†æ—¥å¿—ä¿¡æ¯å†™å…¥æ–‡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥æ–‡ä»¶çš„ <code>WritableStream</code>ï¼Œç„¶åä½¿ç”¨ <code>WritableStreamDefaultWriter</code> æ¥å‘å…¶ä¸­å†™å…¥æ—¥å¿—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºæŒ‡å‘ &#39;log.txt&#39; æ–‡ä»¶çš„ WritableStream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å– WritableStream çš„ writer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯ã€‚</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ—¥å¿—å·²å†™å…¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®Œæˆåå…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å‘-http-å“åº”å†™å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å‘-http-å“åº”å†™å…¥æ•°æ®"><span>ç¤ºä¾‹ 2ï¼šå‘ HTTP å“åº”å†™å…¥æ•°æ®</span></a></h4><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js æ„å»º Web æœåŠ¡å™¨æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚HTTP å“åº”æœ¬èº«å°±æ˜¯ä¸€ä¸ª <code>WritableStream</code>ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ <code>WritableStreamDefaultWriter</code> å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è·å– HTTP å“åº”çš„ writer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‘ HTTP å“åº”ä¸­å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å·²å‘é€è‡³å®¢æˆ·ç«¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ç»“æŸå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œç¬¬äºŒä¸ªç¤ºä¾‹æ˜¯ä¸€ä¸ªæ¦‚å¿µæ€§çš„ç¤ºä¾‹ï¼Œæ—¨åœ¨æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>WritableStreamDefaultWriter</code> åœ¨ä¸åŒç±»å‹çš„æµï¼ˆè¿™é‡Œæ˜¯ HTTP å“åº”ï¼‰ä¸­å†™å…¥æ•°æ®ã€‚åœ¨å®é™…çš„ Node.js HTTP æœåŠ¡å™¨ä»£ç ä¸­ï¼Œä½ ä¼šç›´æ¥ä½¿ç”¨ <code>response.write()</code> å’Œ <code>response.end()</code> æ–¹æ³•æ¥å†™å…¥å’Œç»“æŸå“åº”ï¼Œå› ä¸º HTTP å“åº”å¯¹è±¡ç›´æ¥æä¾›äº†è¿™äº›æ–¹æ³•ï¼Œæ— éœ€æ˜¾å¼è·å– <code>WritableStreamDefaultWriter</code>ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>WritableStreamDefaultWriter</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç±»ï¼Œä½¿å¾—åœ¨ Node.js ä¸­å¤„ç†æµå¼å†™å…¥å˜å¾—æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ åº”è¯¥èƒ½å¤Ÿå¼€å§‹æ¢ç´¢å¦‚ä½•åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­åˆ©ç”¨è¿™äº›æŠ€æœ¯ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/File%20system.html" aria-label="File system"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->File system</div></a><a class="route-link auto-link next" href="/document/node-doc/HTTP.html" aria-label="HTTP"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">HTTP<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2022-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.2cf91084.js" defer></script><script src="/assets/js/7531.f2f134c8.js" defer></script><script src="/assets/js/app.a2d0f323.js" defer></script>
  </body>
</html>
