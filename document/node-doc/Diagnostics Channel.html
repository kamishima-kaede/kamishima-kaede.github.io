<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Diagnostics%20Channel.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Diagnostics Channel"><meta property="og:description" content="Diagnostics Channel å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ Diagnostics Channelï¼ˆè¯Šæ–­é€šé“ï¼‰ã€‚ Diagnostics Channelæ˜¯ä¸€ä¸ª Node.js å†…ç½®çš„æ¨¡å—ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªå‘½åçš„é€šé“ï¼Œè¿™äº›é€šé“å¯ä»¥ç”¨æ¥å‘å¸ƒå’Œè®¢é˜…é’ˆå¯¹ç‰¹å®šäº‹ä»¶æˆ–åŠ¨ä½œçš„æ¶ˆæ¯ã€‚å®ƒä¸»è¦è¢«ç”¨äºç›‘æ§å’Œè°ƒè¯•åº”ç”¨ç¨‹åºï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒèƒ½..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Diagnostics Channel","description":"Diagnostics Channel å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ Diagnostics Channelï¼ˆè¯Šæ–­é€šé“ï¼‰ã€‚ Diagnostics Channelæ˜¯ä¸€ä¸ª Node.js å†…ç½®çš„æ¨¡å—ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªå‘½åçš„é€šé“ï¼Œè¿™äº›é€šé“å¯ä»¥ç”¨æ¥å‘å¸ƒå’Œè®¢é˜…é’ˆå¯¹ç‰¹å®šäº‹ä»¶æˆ–åŠ¨ä½œçš„æ¶ˆæ¯ã€‚å®ƒä¸»è¦è¢«ç”¨äºç›‘æ§å’Œè°ƒè¯•åº”ç”¨ç¨‹åºï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒèƒ½..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Diagnostics Channel | hanekawa-shiki</title><meta name="description" content="Diagnostics Channel å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ Diagnostics Channelï¼ˆè¯Šæ–­é€šé“ï¼‰ã€‚ Diagnostics Channelæ˜¯ä¸€ä¸ª Node.js å†…ç½®çš„æ¨¡å—ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªå‘½åçš„é€šé“ï¼Œè¿™äº›é€šé“å¯ä»¥ç”¨æ¥å‘å¸ƒå’Œè®¢é˜…é’ˆå¯¹ç‰¹å®šäº‹ä»¶æˆ–åŠ¨ä½œçš„æ¶ˆæ¯ã€‚å®ƒä¸»è¦è¢«ç”¨äºç›‘æ§å’Œè°ƒè¯•åº”ç”¨ç¨‹åºï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒèƒ½...">
    <link rel="stylesheet" href="/assets/css/styles.a84c0532.css">
    <link rel="preload" href="/assets/js/runtime~app.be370b10.js" as="script"><link rel="preload" href="/assets/css/styles.a84c0532.css" as="style"><link rel="preload" href="/assets/js/4485.e6fe7c7b.js" as="script"><link rel="preload" href="/assets/js/app.bf6f64e3.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Diagnostics Channel</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 72 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT72M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 21608 å­—</span><meta property="wordCount" content="21608"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#public-api">Public API</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åˆ›å»ºé€šé“-channel">1. åˆ›å»ºé€šé“ï¼ˆChannelï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å‘å¸ƒæ¶ˆæ¯-publish-messages">2. å‘å¸ƒæ¶ˆæ¯ï¼ˆPublish Messagesï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-è®¢é˜…æ¶ˆæ¯-subscribe-to-messages">3. è®¢é˜…æ¶ˆæ¯ï¼ˆSubscribe to Messagesï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#overview">Overview</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é€šä¿—æ˜“æ‡‚çš„è§£é‡Š">é€šä¿—æ˜“æ‡‚çš„è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºå’Œä½¿ç”¨é€šé“">åˆ›å»ºå’Œä½¿ç”¨é€šé“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç›‘å¬é€šé“æ¶ˆæ¯">ç›‘å¬é€šé“æ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-åŸºæœ¬ä½¿ç”¨">ç¤ºä¾‹ 1ï¼šåŸºæœ¬ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-ä½¿ç”¨é¢„å®šä¹‰çš„-node-js-é€šé“">ç¤ºä¾‹ 2ï¼šä½¿ç”¨é¢„å®šä¹‰çš„ Node.js é€šé“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-channel">Class: Channel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºå’Œä½¿ç”¨-channel">åˆ›å»ºå’Œä½¿ç”¨ Channelï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‘å¸ƒæ¶ˆæ¯">å‘å¸ƒæ¶ˆæ¯ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è®¢é˜…æ¶ˆæ¯">è®¢é˜…æ¶ˆæ¯ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åˆ›å»ºé€šé“">1. åˆ›å»ºé€šé“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å‘å¸ƒæ¶ˆæ¯">2. å‘å¸ƒæ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-è®¢é˜…æ¶ˆæ¯">3. è®¢é˜…æ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subscribe-æ–¹æ³•">subscribe æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-tracingchannel">Class: TracingChannel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»º-tracingchannel">åˆ›å»º TracingChannel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tracingchannel-subscribe-subscribers-1">tracingChannel.subscribe(subscribers)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-è·Ÿè¸ªä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°">ç¤ºä¾‹ 1ï¼šè·Ÿè¸ªä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-è·Ÿè¸ªä¸€ä¸ªæœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°">ç¤ºä¾‹ 2ï¼šè·Ÿè¸ªä¸€ä¸ªæœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tracingchannel-channels">TracingChannel Channels</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tracingchannel-channels-1">TracingChannel Channels</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯">ä¾‹å­ 1: åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ª-udp-æœåŠ¡å™¨">ä¾‹å­ 1ï¼šåˆ›å»ºä¸€ä¸ª UDP æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-åˆ›å»ºä¸€ä¸ª-udp-å®¢æˆ·ç«¯">ä¾‹å­ 2ï¼šåˆ›å»ºä¸€ä¸ª UDP å®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨">å®é™…è¿ç”¨ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-worker-threads">å¦‚ä½•ä½¿ç”¨ Worker Threads</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="diagnostics-channel" tabindex="-1"><a class="header-anchor" href="#diagnostics-channel"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#diagnostics-channel" target="_blank" rel="noopener noreferrer">Diagnostics Channel</a></span></a></h1><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ Diagnostics Channelï¼ˆè¯Šæ–­é€šé“ï¼‰ã€‚</p><p><code>Diagnostics Channel</code>æ˜¯ä¸€ä¸ª Node.js å†…ç½®çš„æ¨¡å—ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªå‘½åçš„é€šé“ï¼Œè¿™äº›é€šé“å¯ä»¥ç”¨æ¥å‘å¸ƒå’Œè®¢é˜…é’ˆå¯¹ç‰¹å®šäº‹ä»¶æˆ–åŠ¨ä½œçš„æ¶ˆæ¯ã€‚å®ƒä¸»è¦è¢«ç”¨äºç›‘æ§å’Œè°ƒè¯•åº”ç”¨ç¨‹åºï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…äº†è§£ä»£ç çš„è¿è¡Œæƒ…å†µï¼Œä»¥åŠå„ä¸ªéƒ¨åˆ†æ˜¯å¦‚ä½•äº¤äº’çš„ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨<code>Diagnostics Channel</code>ä¸­æœ‰ä¸¤ä¸ªå…³é”®çš„æ“ä½œï¼š<strong>å‘å¸ƒï¼ˆpublishï¼‰<strong>å’Œ</strong>è®¢é˜…ï¼ˆsubscribeï¼‰</strong>ã€‚</p><ul><li><strong>å‘å¸ƒ</strong>ï¼šå½“æŸä¸ªç‰¹å®šçš„äº‹ä»¶æˆ–åŠ¨ä½œå‘ç”Ÿæ—¶ï¼Œé€šè¿‡é€šé“å‘é€æ¶ˆæ¯ã€‚</li><li><strong>è®¢é˜…</strong>ï¼šç›‘å¬é€šé“ä¸Šçš„æ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œä¸€äº›å“åº”çš„æ“ä½œã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ€§èƒ½ç›‘æ§</strong>ï¼š<br> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“æ¯æ¬¡è¯·æ±‚å¤„ç†çš„æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºè¯·æ±‚å¤„ç†è®¾ç½®ä¸€ä¸ªè¯Šæ–­é€šé“ï¼Œå¹¶åœ¨è¯·æ±‚å¼€å§‹å’Œç»“æŸæ—¶å‘å¸ƒæ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request-time</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¯å½“ä¸€ä¸ªè¯·æ±‚å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬å°±å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onRequestStart</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¯·æ±‚ç»“æŸæ—¶ä¹Ÿå‘å¸ƒä¸€ä¸ªæ¶ˆæ¯</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onRequestEnd</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨è®¢é˜…è¿™ä¸ªé€šé“ï¼Œè®°å½•æ¯æ¬¡è¯·æ±‚çš„æ—¶é—´</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">time</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Request Time for </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">timeEnd</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Request Time for </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è‡ªå®šä¹‰æ—¥å¿—è®°å½•</strong>ï¼š<br> å¦‚æœä½ çš„åº”ç”¨ç¨‹åºåŒ…å«ä¸åŒçš„æ¨¡å—ï¼Œä½ å¯èƒ½æƒ³åœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹è®°å½•æ—¥å¿—ã€‚é€šè¿‡ä½¿ç”¨<code>Diagnostics Channel</code>ï¼Œæ¯ä¸ªæ¨¡å—å¯ä»¥å‘å¸ƒå®ƒä»¬è‡ªå·±çš„æ—¥å¿—åˆ°é€šé“ï¼Œè€Œä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å¯ä»¥è®¢é˜…è¿™ä¸ªé€šé“æ¥èšåˆæ—¥å¿—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> logChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">log</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¸€ä¸ªæ¨¡å—å‘é€æ—¥å¿—åˆ°è¯Šæ–­é€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> logMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">level</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  logChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;"> level</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¦ä¸€ä¸ªæ¨¡å—ç›‘å¬è¿™ä¸ªé€šé“ä¸Šçš„æ—¥å¿—å¹¶å¤„ç†</span></span>
<span class="line"><span style="color:#D8DEE9;">logChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">log</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">log</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">level</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">log</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">log</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">logMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">info</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This is an info message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">logMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This is an error message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>Diagnostics Channel</code>æä¾›äº†ä¸€ä¸ªçµæ´»çš„æœºåˆ¶ï¼Œå…è®¸ä¸åŒéƒ¨åˆ†çš„ä»£ç ç›¸äº’æ²Ÿé€šè€Œä¸éœ€è¦ç›´æ¥ä¾èµ–å¯¹æ–¹ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯ç»´æŠ¤ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ›´å®¹æ˜“åœ°è¿›è¡Œç›‘æ§å’Œè°ƒè¯•ã€‚</p><h2 id="public-api" tabindex="-1"><a class="header-anchor" href="#public-api"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#public-api" target="_blank" rel="noopener noreferrer">Public API</a></span></a></h2><p>Node.js ä¸­çš„ <code>diagnostics_channel</code> æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œç”¨äºæä¾›ä¸€ä¸ªé«˜æ•ˆã€æ— é”çš„æ–¹å¼æ¥ä¼ é€’æ¶ˆæ¯å’Œä¿¡å·ï¼Œç›®çš„æ˜¯ä¸ºäº†è¯Šæ–­å’Œè°ƒè¯•ã€‚è¿™ä¸ªæ¨¡å—å…è®¸ä½ åˆ›å»ºå‘½åçš„é€šé“ï¼ˆchannelsï¼‰ï¼Œè¿™äº›é€šé“å¯ä»¥ç”¨æ¥å‘å¸ƒæ¶ˆæ¯ï¼ˆpublish messagesï¼‰å’Œè®¢é˜…æ¶ˆæ¯ï¼ˆsubscribe to messagesï¼‰ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬çš„æ–‡æ¡£ä¸­ï¼Œ<code>diagnostics_channel</code> çš„ Public API æè¿°äº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ¨¡å—ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šè§£é‡Šå‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜å¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼š</p><h3 id="_1-åˆ›å»ºé€šé“-channel" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºé€šé“-channel"><span>1. åˆ›å»ºé€šé“ï¼ˆChannelï¼‰</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªé€šé“è¿›è¡Œæ¶ˆæ¯çš„å‘å¸ƒå’Œè®¢é˜…ã€‚é€šè¿‡è°ƒç”¨ <code>diagnostics_channel.channel(name)</code> æ–¹æ³•ï¼Œå¯ä»¥åˆ›å»ºæˆ–è·å–ä¸€ä¸ªå·²æœ‰çš„é€šé“å®ä¾‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>&#39;my-channel&#39;</code> çš„é€šé“ã€‚</p><h3 id="_2-å‘å¸ƒæ¶ˆæ¯-publish-messages" tabindex="-1"><a class="header-anchor" href="#_2-å‘å¸ƒæ¶ˆæ¯-publish-messages"><span>2. å‘å¸ƒæ¶ˆæ¯ï¼ˆPublish Messagesï¼‰</span></a></h3><p>å½“ä½ æƒ³è¦åˆ†äº«æŸäº›ä¿¡æ¯æ—¶ï¼Œä½ å¯ä»¥å‘å¸ƒï¼ˆpublishï¼‰æ¶ˆæ¯åˆ°é€šé“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">hasSubscribers</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // åªæœ‰å½“æœ‰è®¢é˜…è€…æ—¶æ‰å‘å¸ƒæ¶ˆæ¯ï¼Œä»¥æé«˜æ€§èƒ½</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> foo</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">bar</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æœ‰è®¢é˜…è€…ç›‘å¬ <code>&#39;my-channel&#39;</code> é€šé“ï¼Œå¦‚æœæœ‰ï¼Œæˆ‘ä»¬å‘å¸ƒåŒ…å« <code>{ foo: &#39;bar&#39; }</code> å¯¹è±¡çš„æ¶ˆæ¯ã€‚</p><h3 id="_3-è®¢é˜…æ¶ˆæ¯-subscribe-to-messages" tabindex="-1"><a class="header-anchor" href="#_3-è®¢é˜…æ¶ˆæ¯-subscribe-to-messages"><span>3. è®¢é˜…æ¶ˆæ¯ï¼ˆSubscribe to Messagesï¼‰</span></a></h3><p>å¦ä¸€æ–¹é¢ï¼Œä½ å¯èƒ½æƒ³è¦ç›‘å¬é€šé“ä¸Šçš„æ¶ˆæ¯ã€‚è¿™æ—¶å€™ä½ å°±éœ€è¦è®¢é˜…ï¼ˆsubscribeï¼‰é€šé“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received message on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¢é˜…äº† <code>&#39;my-channel&#39;</code> å¹¶æ‰“å°å‡ºæ”¶åˆ°çš„ä»»ä½•æ¶ˆæ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œæˆ‘ä»¬æƒ³è¦è®°å½•æ¯æ¬¡ HTTP è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºç›‘æ§ HTTP è¯·æ±‚çš„é€šé“ã€‚</p><p><strong>åˆ›å»ºå¹¶è®¢é˜… HTTP è¯·æ±‚é€šé“ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> httpChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http-request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">httpChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">requestDetails</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> channelName</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#81A1C1;">${</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Date</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> - Received HTTP request on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">channelName</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    requestDetails</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åœ¨ HTTP æœåŠ¡å™¨ä»£ç ä¸­å‘å¸ƒæ¶ˆæ¯ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  httpChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    headers</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯å½“æ¥æ”¶åˆ° HTTP è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å‘ <code>&#39;http-request&#39;</code> é€šé“å‘å¸ƒè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œè€Œé‚£ä¸ªè®¢é˜…äº†è¯¥é€šé“çš„è®¢é˜…è€…ä¼šè®°å½•è¿™äº›ä¿¡æ¯ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>diagnostics_channel</code> æ¨¡å—å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿½è¸ªå’Œè¯Šæ–­å¤æ‚çš„åº”ç”¨è¡Œä¸ºï¼Œè€Œä¸å½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><h3 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#overview" target="_blank" rel="noopener noreferrer">Overview</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js ç‰¹åˆ«é€‚åˆæ„å»ºé«˜æ€§èƒ½ã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js çš„ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªå«ä½œ <code>diagnostics_channel</code> çš„æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ªé«˜çº§ APIï¼Œå…è®¸å¼€å‘è€…åˆ›å»ºå‘½åçš„é€šé“å¹¶é€šè¿‡å®ƒä»¬å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼Œç±»ä¼¼äºäº‹ä»¶å‘å°„å™¨ï¼ˆEventEmitterï¼‰ï¼Œä½†ä¸“ä¸ºè¯Šæ–­ä¿¡æ¯è®¾è®¡ã€‚å®ƒå¯ä»¥è¢«æ ¸å¿ƒæ¨¡å—å’Œç”¨æˆ·ä»£ç ä½¿ç”¨æ¥ä¼ é€’ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä¸»è¦ç”¨äºæ§åˆ¶æµã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª web åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºåŒ…å«äº†å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢ã€èº«ä»½éªŒè¯ä»¥åŠæ—¥å¿—è®°å½•ç­‰ã€‚ä½¿ç”¨ <code>diagnostics_channel</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£åº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œå¹¶åœ¨å‡ºç°é—®é¢˜æ—¶æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ã€‚</p><h4 id="ç¤ºä¾‹-1-è·Ÿè¸ªæ•°æ®åº“æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è·Ÿè¸ªæ•°æ®åº“æŸ¥è¯¢"><span>ç¤ºä¾‹ 1: è·Ÿè¸ªæ•°æ®åº“æŸ¥è¯¢</span></a></h4><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„é€šé“æ¥è·Ÿè¸ªæ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢çš„ç»†èŠ‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dbQueryChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">db.query</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> simulateDbQuery</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">query</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å¸ƒæ¶ˆæ¯åˆ° &#39;db.query&#39; é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">  dbQueryChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;"> query</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // ...æ‰§è¡ŒæŸ¥è¯¢é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜… &#39;db.query&#39; é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">dbQueryChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ•°æ®åº“æŸ¥è¯¢ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">query</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">simulateDbQuery</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SELECT * FROM users</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æ•°æ®åº“æŸ¥è¯¢å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨ <code>&#39;db.query&#39;</code> é€šé“ä¸Šå‘å¸ƒä¸€æ¡æ¶ˆæ¯ã€‚ä»»ä½•è®¢é˜…è¿™ä¸ªé€šé“çš„ç›‘å¬å™¨éƒ½ä¼šæ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œç„¶åæ‰“å°å‡ºæŸ¥è¯¢è¯­å¥ã€‚è¿™å¯¹äºè°ƒè¯•æˆ–ç›‘æ§æ•°æ®åº“æ“ä½œéå¸¸æœ‰ç”¨ã€‚</p><h4 id="ç¤ºä¾‹-2-è·Ÿè¸ªè®¤è¯è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è·Ÿè¸ªè®¤è¯è¯·æ±‚"><span>ç¤ºä¾‹ 2: è·Ÿè¸ªè®¤è¯è¯·æ±‚</span></a></h4><p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¸ªè®¤è¯è¯·æ±‚çš„ç»†èŠ‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> authChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">auth.request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> authenticateUser</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">userCredentials</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...è®¤è¯é€»è¾‘...</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> success</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> true;</span><span style="color:#616E88;"> // å‡è®¾è®¤è¯æˆåŠŸ</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å¸ƒè®¤è¯ç»“æœæ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  authChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;"> userCredentials</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> success</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜… &#39;auth.request&#39; é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">authChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">success</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ç”¨æˆ·è®¤è¯æˆåŠŸï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">userCredentials</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ç”¨æˆ·è®¤è¯å¤±è´¥ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">userCredentials</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">authenticateUser</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> password</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">password123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯æ¬¡ç”¨æˆ·å°è¯•ç™»å½•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>&#39;auth.request&#39;</code> é€šé“ä¸Šå‘å¸ƒè®¤è¯ç»“æœã€‚é€šè¿‡è®¢é˜…è¯¥é€šé“ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•å“ªäº›è®¤è¯å°è¯•æˆåŠŸäº†ï¼Œå“ªäº›å¤±è´¥äº†ï¼Œä»¥åŠå¯èƒ½çš„å¤±è´¥åŸå› ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>diagnostics_channel</code> æ¨¡å—æä¾›äº†ä¸€ç§å¼ºå¤§çš„æœºåˆ¶æ¥ç›‘æ§å’Œè¯Šæ–­ Node.js åº”ç”¨ç¨‹åºä¸­çš„å„ç§æ´»åŠ¨ã€‚é€šè¿‡åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰çš„è¯Šæ–­é€šé“ï¼Œå¼€å‘è€…å¯ä»¥æ•è·å…³é”®çš„åº”ç”¨ç¨‹åºå·¥ä½œæµç¨‹å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œè¿›è€Œå®ç°æ›´æ·±å…¥çš„è§‚å¯Ÿå’Œåˆ†æï¼Œæ— è®ºæ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿˜æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p><h4 id="diagnostics-channel-hassubscribers-name" tabindex="-1"><a class="header-anchor" href="#diagnostics-channel-hassubscribers-name"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#diagnostics_channelhassubscribersname" target="_blank" rel="noopener noreferrer">diagnostics_channel.hasSubscribers(name)</a></span></a></h4><p><code>diagnostics_channel.hasSubscribers(name)</code> æ˜¯ Node.js ä¸­ <code>diagnostics_channel</code> æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥æ£€æŸ¥æ˜¯å¦æœ‰è®¢é˜…è€…ç›‘å¬æŸä¸ªç‰¹å®šçš„è¯Šæ–­é¢‘é“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦ç”¨äºæ€§èƒ½è°ƒä¼˜å’Œç›‘æµ‹åº”ç”¨ç¨‹åºçš„å†…éƒ¨æ“ä½œã€‚</p><p>åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­ï¼Œå¼€å‘è€…ç»å¸¸éœ€è¦äº†è§£åº”ç”¨è¿è¡Œæ—¶å„ç§äº‹ä»¶çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸€ä¸ª HTTP è¯·æ±‚ä½•æ—¶å¼€å§‹ï¼Œä½•æ—¶ç»“æŸï¼Œæ•°æ®åº“æŸ¥è¯¢è€—è´¹å¤šé•¿æ—¶é—´ç­‰ã€‚<code>diagnostics_channel</code> æ¨¡å—å…è®¸å¼€å‘è€…åˆ›å»ºå’Œä½¿ç”¨ä¸€ç§å‘å¸ƒ/è®¢é˜…ï¼ˆpub/subï¼‰æ¨¡å¼çš„é¢‘é“æ¥è·å–è¿™ç±»ä¿¡æ¯ã€‚</p><p>ä¸‹é¢æ˜¯å…³äº <code>diagnostics_channel.hasSubscribers(name)</code> çš„é€šä¿—æ˜“æ‡‚çš„è§£é‡Šä»¥åŠå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="é€šä¿—æ˜“æ‡‚çš„è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#é€šä¿—æ˜“æ‡‚çš„è§£é‡Š"><span>é€šä¿—æ˜“æ‡‚çš„è§£é‡Š</span></a></h3><p>æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªæŠ¥çº¸çš„å‡ºç‰ˆå•†ï¼Œä½ å¸Œæœ›çŸ¥é“æœ‰å¤šå°‘äººå¯¹ä½ å³å°†å‘å¸ƒçš„æ–°é—»æ„Ÿå…´è¶£ã€‚åœ¨å‘å‡ºä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆæ£€æŸ¥æ˜¯å¦æœ‰äººè®¢é˜…äº†è¿™æ¡æ–°é—»ã€‚å¦‚æœæœ‰äººè®¢é˜…ï¼Œé‚£ä¹ˆä½ å°±ä¼šå‡ºç‰ˆå¹¶å‘é€ç»™ä»–ä»¬ï¼›å¦‚æœæ²¡æœ‰è®¢é˜…è€…ï¼Œä½ å¯èƒ½å°±ä¸ä¼šæµªè´¹èµ„æºå»å°åˆ·å’Œåˆ†å‘ã€‚</p><p>åŒæ ·çš„ï¼Œåœ¨ Node.js ä¸­ï¼Œ<code>diagnostics_channel.hasSubscribers(name)</code> æ–¹æ³•å°±åƒæ˜¯æ£€æŸ¥æ˜¯å¦æœ‰äººå¯¹æŸä¸ªç‰¹å®šè¯é¢˜æ„Ÿå…´è¶£ã€‚å¦‚æœæœ‰ä»£ç éƒ¨åˆ†å¯¹è¿™ä¸ªè¯é¢˜è¿›è¡Œäº†è®¢é˜…ï¼Œå³è¡¨ç¤ºå®ƒä»¬å¯¹æ¥æ”¶è¯¥è¯é¢˜çš„ä¿¡æ¯æ„Ÿå…´è¶£ï¼Œç„¶åä½ çš„ä»£ç å°±å¯ä»¥å‘å¸ƒç›¸å…³ä¿¡æ¯äº†ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œä½ æƒ³ç›‘æ§ HTTP è¯·æ±‚çš„å¤„ç†æƒ…å†µã€‚é¦–å…ˆï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>http_request</code>çš„è¯Šæ–­é¢‘é“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯èƒ½æƒ³åœ¨å¤„ç† HTTP è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰å½“æœ‰è®¢é˜…è€…å­˜åœ¨æ—¶æ‰å‘é€è¯Šæ–­æ•°æ®ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>diagnostics_channel.hasSubscribers(name)</code>æ¥æ£€æŸ¥æ˜¯å¦æœ‰è®¢é˜…è€…ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæœ‰è®¢é˜…è€…ç›‘å¬ &#39;http_request&#39; é¢‘é“ï¼Œæˆ‘ä»¬å°†å‘å¸ƒä¸€äº›ä¿¡æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">hasSubscribers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> method</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // æ­£å¸¸å¤„ç†HTTPè¯·æ±‚...</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åˆ«çš„éƒ¨åˆ†çš„ä»£ç ä¸­ï¼Œå¦‚æœæœ‰å…´è¶£å¾—åˆ°è¿™äº› HTTP è¯·æ±‚çš„ä¿¡æ¯ï¼Œå¯ä»¥è®¢é˜…è¿™ä¸ªé¢‘é“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// åœ¨åº”ç”¨ç¨‹åºçš„å¦ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…å¯èƒ½æ˜¯ç¬¬ä¸‰æ–¹çš„ç›‘æ§å·¥å…·</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">Received HTTP request with method </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> on url </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå½“ HTTP æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚å¹¶ä¸”ç¡®å®šæœ‰è®¢é˜…è€…æ—¶ï¼Œå®ƒå°†é€šè¿‡<code>http_request</code>é¢‘é“å‘å¸ƒè¯·æ±‚ä¿¡æ¯ã€‚ç›‘å¬è¿™ä¸ªé¢‘é“çš„ä»£ç å°†æ¥æ”¶åˆ°è¿™äº›ä¿¡æ¯ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•è®¢é˜…è€…ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼ŒæœåŠ¡å™¨å°†ä¸ä¼šå‘å¸ƒä»»ä½•ä¿¡æ¯ã€‚</p><h4 id="diagnostics-channel-channel-name" tabindex="-1"><a class="header-anchor" href="#diagnostics-channel-channel-name"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#diagnostics_channelchannelname" target="_blank" rel="noopener noreferrer">diagnostics_channel.channel(name)</a></span></a></h4><p>Node.js çš„ <code>diagnostics_channel</code> æ˜¯ä¸€ä¸ª Node.js æä¾›çš„ APIï¼Œå®ƒå…è®¸ä½ åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´ä¼ é€’è¯Šæ–­ä¿¡æ¯ã€‚è¿™å¯¹äºç›‘æ§å’Œåˆ†æåº”ç”¨ç¨‹åºçš„è¡Œä¸ºéå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒè¯•é—®é¢˜æˆ–äº†è§£å¤æ‚ç³»ç»Ÿè¿ä½œæ–¹å¼æ—¶ã€‚</p><p><code>diagnostics_channel.channel(name)</code> æ–¹æ³•ç”¨äºåˆ›å»ºæˆ–è·å–ä¸€ä¸ªåä¸º <code>name</code> çš„é€šé“ã€‚å¦‚æœè¿™ä¸ªé€šé“å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå°±è¿”å›è¿™ä¸ªé€šé“ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„é€šé“ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å…³äºå¦‚ä½•ä½¿ç”¨ <code>diagnostics_channel</code> çš„åŸºæœ¬ä¾‹å­ï¼š</p><h3 id="åˆ›å»ºå’Œä½¿ç”¨é€šé“" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå’Œä½¿ç”¨é€šé“"><span>åˆ›å»ºå’Œä½¿ç”¨é€šé“</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸”æƒ³è¦ç›‘æ§æ¯æ¬¡è¯·æ±‚çš„ä¸€äº›ä¿¡æ¯ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>diagnostics_channel</code> æ¥å®ç°ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªé€šé“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> httpChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨ä½ çš„ HTTP æœåŠ¡å™¨ä¸­ï¼Œä½ å¯ä»¥åœ¨å¤„ç†è¯·æ±‚æ—¶å‘å¸ƒæ¶ˆæ¯åˆ°è¿™ä¸ªé€šé“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å‘å¸ƒæ¶ˆæ¯åˆ°é€šé“ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„æ–¹æ³•å’ŒURL</span></span>
<span class="line"><span style="color:#D8DEE9;">    httpChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">      method</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†è¯·æ±‚...</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œä»»ä½•æ—¶å€™ HTTP æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒéƒ½ä¼šå‘ <code>httpChannel</code> å‘é€ä¸€æ¡åŒ…å«è¯·æ±‚æ–¹æ³•å’Œ URL çš„æ¶ˆæ¯ã€‚</p><h3 id="ç›‘å¬é€šé“æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬é€šé“æ¶ˆæ¯"><span>ç›‘å¬é€šé“æ¶ˆæ¯</span></a></h3><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ æƒ³ç›‘å¬è¿™ä¸ªé€šé“ä¸Šçš„æ¶ˆæ¯å¹¶å¯¹å…¶è¿›è¡ŒæŸäº›æ“ä½œï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// è®¢é˜…httpChannelä¸Šçš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">httpChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ°HTTPè¯·æ±‚ï¼šæ–¹æ³• - </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, URL - </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯å½“ <code>httpChannel</code> ä¸Šå‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œè®¢é˜…å›è°ƒå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºå…³äºæ¯æ¬¡ HTTP è¯·æ±‚çš„ä¿¡æ¯ã€‚</p><p>è¿™ç§æœºåˆ¶ä½¿å¾—æ¨¡å—ä¹‹é—´å¯ä»¥è½»æ¾åœ°è¿›è¡Œé€šä¿¡è€Œä¸ç”¨ç›´æ¥ä¾èµ–å¯¹æ–¹ã€‚è¿™å¯¹äºæ„å»ºå¯ç»´æŠ¤å’Œè§£è€¦çš„å¤§å‹åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ul><li><strong>ç›‘æ§å’Œæ—¥å¿—è®°å½•</strong>ï¼šä½ å¯ä»¥ä½¿ç”¨ <code>diagnostics_channel</code> æ¥æ”¶é›†å…³äºä½ çš„åº”ç”¨ç¨‹åºæ€§èƒ½å’Œè¡Œä¸ºçš„ä¿¡æ¯ï¼Œç„¶åå°†å…¶ç”¨äºç›‘æ§ã€è­¦æŠ¥æˆ–æ—¥å¿—è®°å½•ã€‚</li><li><strong>æ’ä»¶ç³»ç»Ÿ</strong>ï¼šå¦‚æœä½ åœ¨æ„å»ºä¸€ä¸ªæ”¯æŒæ’ä»¶çš„åº”ç”¨ç¨‹åºï¼Œ<code>diagnostics_channel</code> å¯ä»¥è®©æ’ä»¶ä½œè€…è®¢é˜…ç‰¹å®šäº‹ä»¶ï¼Œè€Œä¸å¿…æ›´æ”¹æ ¸å¿ƒä»£ç åº“ã€‚</li><li><strong>è°ƒè¯•å’Œæ•…éšœæ’é™¤</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥è®¢é˜…åº”ç”¨ç¨‹åºçš„å…³é”®éƒ¨åˆ†çš„é€šé“ï¼Œä»¥å¸®åŠ©ç†è§£æµç¨‹å’Œè¯†åˆ«é—®é¢˜ã€‚</li></ul><p>æ€»ä¹‹ï¼Œ<code>diagnostics_channel</code> æä¾›äº†ä¸€ç§çµæ´»ã€ä½è€¦åˆçš„æ–¹å¼æ¥ä¼ é€’ä¿¡æ¯ï¼Œè¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å¸®åŠ©å¼€å‘è€…ç›‘æ§å’Œè°ƒè¯•åº”ç”¨ç¨‹åºã€‚</p><h4 id="diagnostics-channel-subscribe-name-onmessage" tabindex="-1"><a class="header-anchor" href="#diagnostics-channel-subscribe-name-onmessage"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#diagnostics_channelsubscribename-onmessage" target="_blank" rel="noopener noreferrer">diagnostics_channel.subscribe(name, onMessage)</a></span></a></h4><p>Node.js çš„ <code>diagnostics_channel</code> æ˜¯ä¸€ä¸ªå†…ç½®çš„æ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç§å‘å¸ƒ-è®¢é˜…ï¼ˆpub-subï¼‰çš„æœºåˆ¶ï¼Œå…è®¸ä½ åˆ›å»ºå‘½åçš„é¢‘é“å¹¶åœ¨å…¶ä¸Šå‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨äºç›‘æ§ Node.js åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€è¯Šæ–­é—®é¢˜ä»¥åŠè¿›è¡Œæ€§èƒ½åˆ†æç­‰ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>diagnostics_channel.subscribe(name, onMessage)</code> å‡½æ•°ä½¿ä½ èƒ½å¤Ÿè®¢é˜…ä¸€ä¸ªæŒ‡å®šåç§°çš„é€šé“ã€‚æ¯å½“æœ‰æ¶ˆæ¯è¢«å‘å¸ƒåˆ°è¿™ä¸ªé€šé“æ—¶ï¼Œæ³¨å†Œçš„å›è°ƒå‡½æ•° <code>onMessage</code> å°±ä¼šè¢«è§¦å‘ã€‚</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>name</code>ï¼šæ˜¯ä½ æƒ³è¦è®¢é˜…çš„é€šé“çš„åç§°ã€‚</li><li><code>onMessage</code>ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“æœ‰æ¶ˆæ¯å‘å¸ƒåˆ°æŒ‡å®šé€šé“æ—¶ï¼Œå®ƒå°†è¢«è°ƒç”¨ã€‚</li></ul><p>ç°åœ¨è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ç¤ºä¾‹-1-åŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åŸºæœ¬ä½¿ç”¨"><span>ç¤ºä¾‹ 1ï¼šåŸºæœ¬ä½¿ç”¨</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­æŸä¸ªæ¨¡å—è´Ÿè´£å¤„ç†ç”¨æˆ·ç™»å½•ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ç”¨æˆ·æ¯æ¬¡ç™»å½•æ—¶èƒ½ç›‘å¬åˆ°äº‹ä»¶ï¼Œå¹¶ä½œå‡ºç›¸åº”ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé€šé“æ¥å‘å¸ƒç”¨æˆ·ç™»å½•çš„äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> loginChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">user-login</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> loginUser</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”¨æˆ·ç™»å½•é€»è¾‘...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åœ¨ç”¨æˆ·æˆåŠŸç™»å½•åï¼Œå‘å¸ƒæ¶ˆæ¯åˆ°&#39;user-login&#39;é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">  loginChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;"> username</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ <code>subscribe</code> æ–¹æ³•è®¢é˜…è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶æ‰“å°ä¸€æ¡æ—¥å¿—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">user-login</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ({</span><span style="color:#D8DEE9;"> username</span><span style="color:#ECEFF4;"> })</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">User </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> has logged in.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æˆ‘ä»¬è°ƒç”¨ loginUser å‡½æ•°æ—¶ï¼Œè®¢é˜…è€…ä¼šæ”¶åˆ°é€šçŸ¥å¹¶æ‰§è¡Œå›è°ƒ</span></span>
<span class="line"><span style="color:#88C0D0;">loginUser</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">johndoe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨ <code>loginUser</code> å‡½æ•°æ—¶ï¼Œéƒ½ä¼šå‘ <code>user-login</code> é€šé“å‘å¸ƒä¸€æ¡æ¶ˆæ¯ã€‚ç”±äºæˆ‘ä»¬è®¢é˜…äº†è¿™ä¸ªé€šé“ï¼Œå› æ­¤æ¯æ¬¡å‘å¸ƒæ¶ˆæ¯æ—¶ <code>console.log</code> éƒ½ä¼šè¾“å‡ºå¯¹åº”çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚</p><h3 id="ç¤ºä¾‹-2-ä½¿ç”¨é¢„å®šä¹‰çš„-node-js-é€šé“" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨é¢„å®šä¹‰çš„-node-js-é€šé“"><span>ç¤ºä¾‹ 2ï¼šä½¿ç”¨é¢„å®šä¹‰çš„ Node.js é€šé“</span></a></h3><p>Node.js æœ¬èº«ä¹Ÿå¯èƒ½å‘å¸ƒä¸€äº›å†…éƒ¨äº‹ä»¶åˆ°ä¸åŒçš„è¯Šæ–­é€šé“ã€‚ä¾‹å¦‚ï¼ŒHTTP æœåŠ¡å™¨æ¯æ¬¡æ¥æ”¶åˆ°è¯·æ±‚æ—¶éƒ½ä¼šå‘å¸ƒæ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> createServer</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜…Node.jså†…ç½®çš„&#39;http_request&#39;é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received HTTP request with method: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥åˆ›å»ºé€šé“ï¼Œè€Œæ˜¯è®¢é˜…äº† Node.js å†…éƒ¨å·²ç»å­˜åœ¨çš„ <code>http_request</code> é€šé“ã€‚å½“ HTTP æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬çš„è®¢é˜…å›è°ƒå°±ä¼šæ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•ã€‚</p><p><code>diagnostics_channel</code> æä¾›çš„æœºåˆ¶éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å»ºç«‹è‡ªå·±çš„ç›‘æ§ç³»ç»Ÿï¼Œæˆ–è€…ä¸ç°æœ‰çš„ç›‘æ§å·¥å…·é›†æˆã€‚è¿™ç§æ–¹å¼çš„åº•å±‚é€šä¿¡èƒ½å¤Ÿè®©ä½ å¯¹åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€æœ‰æ›´æ·±å…¥çš„äº†è§£ã€‚</p><h4 id="diagnostics-channel-unsubscribe-name-onmessage" tabindex="-1"><a class="header-anchor" href="#diagnostics-channel-unsubscribe-name-onmessage"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#diagnostics_channelunsubscribename-onmessage" target="_blank" rel="noopener noreferrer">diagnostics_channel.unsubscribe(name, onMessage)</a></span></a></h4><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>diagnostics_channel.unsubscribe(name, onMessage)</code> è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>diagnostics_channel</code>ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>diagnostics_channel</code> æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºå‘½åçš„é€šé“ï¼Œè¿™äº›é€šé“å¯ä»¥ç”¨æ¥ä¼ é€’è¯Šæ–­ä¿¡æ¯ã€‚è¿™å¯¹äºåº“çš„ä½œè€…æˆ–è€…æƒ³è¦ç›‘æ§åº”ç”¨ç¨‹åºè¡Œä¸ºçš„å¼€å‘è€…æ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>unsubscribe</code> æ–¹æ³•ã€‚å½“ä½ ä¸å†å¸Œæœ›æ¥æ”¶æŒ‡å®šé€šé“ä¸Šçš„æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>diagnostics_channel.unsubscribe(name, onMessage)</code> æ¥åœæ­¢æ¥æ”¶ã€‚è¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li><code>name</code>ï¼šè¿™æ˜¯ä½ ä¹‹å‰é€šè¿‡ <code>subscribe</code> æ–¹æ³•è®¢é˜…çš„é‚£ä¸ªé€šé“çš„åç§°ã€‚</li><li><code>onMessage</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹‹å‰ä½ åœ¨è®¢é˜…é€šé“æ—¶æä¾›çš„å›è°ƒå‡½æ•°ï¼Œç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚</li></ul><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå…³äºæ•°æ®åº“æŸ¥è¯¢çš„è¯Šæ–­é€šé“ï¼Œä½ å¯èƒ½ä¼šæƒ³ç›‘å¬è¿™ä¸ªé€šé“æ¥è·å–æŸ¥è¯¢æ‰§è¡Œæ—¶çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥è¯¢èŠ±è´¹çš„æ—¶é—´ç­‰ã€‚ä¸€æ—¦ä½ å®Œæˆäº†ç›‘æ§æˆ–è€…å‡ºäºæŸç§åŸå› ä¸æƒ³å†æ¥æ”¶è¿™äº›ä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>unsubscribe</code> æ¥åœæ­¢æ¥æ”¶ã€‚</p><p>çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„é€šé“ï¼Œç”¨äºç›‘è§†æ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">database-query</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜…è¯¥é€šé“ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ”¶åˆ°æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onDatabaseQuery</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received a database query event: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">query</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">onDatabaseQuery</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ...åœ¨åº”ç”¨çš„å…¶ä»–åœ°æ–¹ï¼Œå½“æ•°æ®åº“æŸ¥è¯¢å‘ç”Ÿæ—¶å‘å¸ƒæ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> query</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SELECT * FROM users</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> durationMs</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 120</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨æŸä¸ªç‚¹ï¼Œæˆ‘ä»¬å†³å®šä¸å†éœ€è¦è®¢é˜…è¿™ä¸ªé€šé“çš„æ¶ˆæ¯äº†</span></span>
<span class="line"><span style="color:#D8DEE9;">diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unsubscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">database-query</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onDatabaseQuery</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨å³ä½¿é€šé“å‘å¸ƒæ¶ˆæ¯ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šå†æ”¶åˆ°ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å–æ¶ˆäº†è®¢é˜…</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>diagnostics_channel</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>&#39;database-query&#39;</code> çš„é€šé“ã€‚ç„¶åæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>onDatabaseQuery</code> å‡½æ•°æ¥å¤„ç†ä»è¿™ä¸ªé€šé“æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬è®¢é˜…äº†è¿™ä¸ªé€šé“ï¼Œæ‰€ä»¥æ¯æ¬¡æœ‰äººé€šè¿‡ <code>channel.publish()</code> å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œ<code>onDatabaseQuery</code> å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å†³å®šä¸å†ç›‘å¬è¿™ä¸ªé€šé“æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>diagnostics_channel.unsubscribe(&#39;database-query&#39;, onDatabaseQuery)</code>ï¼Œè¿™æ · <code>onDatabaseQuery</code> å°†ä¸ä¼šå†è¢«è°ƒç”¨ï¼Œæ— è®ºä½•æ—¶ <code>channel.publish()</code> è¢«æ‰§è¡Œã€‚</p><p>è®°ä½ï¼Œå¦‚æœä½ å°è¯•å–æ¶ˆè®¢é˜…ä¸€ä¸ªä½ æ²¡æœ‰è®¢é˜…è¿‡çš„é€šé“ï¼Œæˆ–è€…ä½¿ç”¨äº†é”™è¯¯çš„å›è°ƒå‡½æ•°ï¼ŒNode.js ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯ä¼šé™é»˜åœ°å¿½ç•¥è¿™ä¸ªè¯·æ±‚ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ <code>unsubscribe</code> æ—¶è¦ç¡®ä¿ä½ ä¼ é€’äº†æ­£ç¡®çš„é€šé“åç§°å’Œå›è°ƒå‡½æ•°ã€‚</p><h4 id="diagnostics-channel-tracingchannel-nameorchannels" tabindex="-1"><a class="header-anchor" href="#diagnostics-channel-tracingchannel-nameorchannels"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#diagnostics_channeltracingchannelnameorchannels" target="_blank" rel="noopener noreferrer">diagnostics_channel.tracingChannel(nameOrChannels)</a></span></a></h4><p>Node.js ä¸­çš„ <code>diagnostics_channel</code> æ¨¡å—æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºå‘½åçš„å‘å¸ƒ/è®¢é˜…é€šé“çš„æ ¸å¿ƒæ¨¡å—ï¼Œè¿™äº›é€šé“å¯ä»¥ç”¨äºè¯Šæ–­ä¿¡æ¯çš„ä¼ é€’ã€‚å¼€å‘è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è°ƒè¯•å’Œç›‘æ§åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚</p><p>åœ¨ Node.js çš„ <code>diagnostics_channel</code> æ¨¡å—ä¸­çš„ <code>tracingChannel</code> æ–¹æ³•ç”¨äºè·å–æˆ–åˆ›å»ºç”¨äºè¿½è¸ªç›®çš„çš„é€šé“ã€‚ä½ å¯ä»¥æƒ³è±¡æˆå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ä¸åŒéƒ¨åˆ†çš„ä»£ç å‘å…³æ³¨ç‰¹å®šäº‹ä»¶çš„ç›‘å¬å™¨æŠ¥å‘Šäº‹ä»¶å‘ç”Ÿã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>tracingChannel</code>ï¼š</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºä¸­åˆ›å»ºå’Œä½¿ç”¨ä¸€ä¸ªè¯Šæ–­é€šé“:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæˆ–è·å–ä¸€ä¸ªåç§°ä¸º&#39;my-channel&#39;çš„è¯Šæ–­é€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">tracingChannel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½ å¯ä»¥è®¢é˜…è¿™ä¸ªé€šé“ï¼Œä»¥ä¾¿å½“æœ‰æ¶ˆæ¯è¢«å‘å¸ƒæ—¶èƒ½å¤Ÿæ”¶åˆ°é€šçŸ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received a message:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œä½ å¯ä»¥å‘å¸ƒæ¶ˆæ¯åˆ°è¿™ä¸ªé€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> foo</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">bar</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>diagnostics_channel</code> æ¨¡å—ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨ <code>tracingChannel</code> æ–¹æ³•å¹¶ä¼ é€’ä¸€ä¸ªé€šé“å <code>&#39;my-channel&#39;</code> æ¥åˆ›å»ºæˆ–è·å–ä¸€ä¸ªè¯Šæ–­é€šé“ã€‚å¦‚æœè¿™ä¸ªåå­—çš„é€šé“å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›é‚£ä¸ªç°å­˜çš„é€šé“å®ä¾‹ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>subscribe</code> æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªç›‘å¬å‡½æ•°ã€‚è¿™ä¸ªç›‘å¬å‡½æ•°å°†ä¼šåœ¨æ¯æ¬¡æœ‰æ¶ˆæ¯å‘å¸ƒåˆ°é€šé“æ—¶è¢«è°ƒç”¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå½“æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šç®€å•åœ°æ‰“å°å‡ºæ¶ˆæ¯å†…å®¹ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>publish</code> æ–¹æ³•æ¥å‘é€ä¸€ä¸ªåŒ…å«æ•°æ® <code>{ foo: &#39;bar&#39; }</code> çš„æ¶ˆæ¯åˆ°é€šé“ã€‚ä¸€æ—¦æ¶ˆæ¯è¢«å‘å¸ƒï¼Œæ‰€æœ‰è®¢é˜…äº†è¯¥é€šé“çš„ç›‘å¬å™¨éƒ½ä¼šæ”¶åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚</p><p>åœ¨çœŸå®ä¸–ç•Œçš„åº”ç”¨ä¸­ï¼Œ<code>diagnostics_channel</code> å¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œæ¯”å¦‚ï¼š</p><ol><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šç›‘æ§åº”ç”¨ç¨‹åºçš„å…³é”®æ“ä½œï¼Œä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢æˆ– HTTP è¯·æ±‚ï¼Œå¹¶å‘å¸ƒæ€§èƒ½ç›¸å…³çš„æ•°æ®ã€‚</li><li><strong>é”™è¯¯è·Ÿè¸ª</strong>ï¼šåœ¨å¼‚å¸¸æƒ…å†µä¸‹å‘å¸ƒé”™è¯¯ä¿¡æ¯ï¼Œä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿè¯†åˆ«å’Œè§£å†³é—®é¢˜ã€‚</li><li><strong>è‡ªå®šä¹‰æ—¥å¿—è®°å½•</strong>ï¼šç”Ÿæˆè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼Œä»¥ä¾›å¼€å‘è€…åœ¨è°ƒè¯•æ—¶ä½¿ç”¨ã€‚</li></ol><p>è®°ä½ï¼Œ<code>diagnostics_channel.tracingChannel</code> å¹¶æœªç›´æ¥æä¾›è·¨åº”ç”¨ç¨‹åºæˆ–ç½‘ç»œä¼ è¾“çš„åŠŸèƒ½ï¼Œå®ƒä¸»è¦ç”¨äºåº”ç”¨ç¨‹åºå†…çš„æ¶ˆæ¯ä¼ é€’ã€‚å¦‚æœä½ éœ€è¦åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’è¯Šæ–­ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦ç»“åˆå…¶ä»–å·¥å…·æˆ–åº“æ¥å®ç°ã€‚</p><h3 id="class-channel" tabindex="-1"><a class="header-anchor" href="#class-channel"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#class-channel" target="_blank" rel="noopener noreferrer">Class: Channel</a></span></a></h3><p><code>Channel</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼Œå®ƒå±äºè¯Šæ–­é€šé“ï¼ˆ<code>diagnostics_channel</code>ï¼‰æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æ˜¯ç”¨æ¥å¸®åŠ©å¼€å‘è€…è°ƒè¯•å’Œç›‘æ§ä»–ä»¬çš„åº”ç”¨ç¨‹åºçš„ä¸€ç§é«˜çº§å·¥å…·ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ <code>Channel</code> çœ‹ä½œæ˜¯ä¸€ä¸ªå¹¿æ’­ç«™ï¼Œå®ƒå…è®¸æ‚¨å‘é€æ¶ˆæ¯ï¼ˆäº‹ä»¶ï¼‰ï¼ŒåŒæ—¶å…¶ä»–éƒ¨åˆ†çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¢é˜…è¿™äº›æ¶ˆæ¯å¹¶æ®æ­¤ä½œå‡ºååº”ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>Channel</code> ç±»çš„å®ä¾‹ä»£è¡¨äº†ä¸€ä¸ªå‘½åçš„é€šé“ï¼Œé€šè¿‡è¿™ä¸ªé€šé“ï¼Œæ•°æ®å¯ä»¥è¢«å‘é€ç»™ä»»æ„æ•°é‡çš„ç›‘å¬å™¨ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µï¼š</span></a></h3><p>é¦–å…ˆæƒ³ä¸€ä¸‹ç”µè§†æˆ–è€…æ— çº¿ç”µå¹¿æ’­ã€‚åœ¨é‚£é‡Œï¼Œä½ æœ‰å¤šä¸ªé¢‘é“ï¼Œæ¯ä¸ªé¢‘é“éƒ½ä¼šä¼ é€ä¸åŒçš„èŠ‚ç›®ã€‚å¦‚æœä½ æƒ³æ”¶å¬æˆ–è§‚çœ‹æŸä¸ªç‰¹å®šèŠ‚ç›®ï¼Œä½ éœ€è¦è°ƒåˆ°å¯¹åº”çš„é¢‘é“ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ Node.js ä¸­ï¼Œ<code>Channel</code> å¯ä»¥è¢«è®¤ä¸ºæ˜¯å¹¿æ’­æ•°æ®çš„é¢‘é“ã€‚è¿™äº›æ•°æ®å¯ä»¥æ˜¯æ—¥å¿—ã€é”™è¯¯ä¿¡æ¯ã€æ€§èƒ½æŒ‡æ ‡æˆ–è€…ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚</p><h3 id="åˆ›å»ºå’Œä½¿ç”¨-channel" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå’Œä½¿ç”¨-channel"><span>åˆ›å»ºå’Œä½¿ç”¨ Channelï¼š</span></a></h3><p>è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Channel</code>ï¼Œä½ é¦–å…ˆéœ€è¦å¯¼å…¥ <code>diagnostics_channel</code> æ¨¡å—ï¼Œå¹¶è°ƒç”¨ <code>channel</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>&#39;my-channel&#39;</code> æ˜¯ä½ åˆ›å»ºçš„é€šé“çš„åç§°ã€‚ä½ å¯ä»¥æŒ‰éœ€å®šä¹‰ä¸åŒçš„é€šé“æ¥ä¼ é€’ä¸åŒç§ç±»çš„ä¿¡æ¯ã€‚</p><h3 id="å‘å¸ƒæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒæ¶ˆæ¯"><span>å‘å¸ƒæ¶ˆæ¯ï¼š</span></a></h3><p>ä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ª <code>Channel</code> å®ä¾‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>publish</code> æ–¹æ³•å‘é€æ¶ˆæ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> some</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™äº›æ•°æ®å¯ä»¥æ˜¯ä»»ä½• JavaScript å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥å‘é€å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„æˆ–è€…æ›´å¤æ‚çš„å¯¹è±¡ã€‚</p><h3 id="è®¢é˜…æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#è®¢é˜…æ¶ˆæ¯"><span>è®¢é˜…æ¶ˆæ¯ï¼š</span></a></h3><p>å¦‚æœä½ æƒ³ç›‘å¬ä¸€ä¸ªé€šé“å¹¶æ¥æ”¶å®ƒå‘å¸ƒçš„æ¶ˆæ¯ï¼Œä½ å°±éœ€è¦&quot;è®¢é˜…&quot;è¿™ä¸ªé€šé“ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>channel.subscribe</code> æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received message on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ <code>channel.publish</code> è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰è®¢é˜…äº†è¯¥é€šé“çš„ç›‘å¬å™¨éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</span></a></h3><ol><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>performance-monitor</code> é¢‘é“æ¥å‘é€åº”ç”¨çš„æ€§èƒ½ç›¸å…³æ•°æ®ã€‚è¿™æ ·ï¼Œç›‘æ§å·¥å…·å¯ä»¥è®¢é˜…è¿™ä¸ªé¢‘é“ï¼Œå¹¶å®æ—¶æ¥æ”¶æ€§èƒ½æ•°æ®è¿›è¡Œåˆ†æã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> perfChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">performance-monitor</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™ä¸ªå‡½æ•°ç”¨äºç›‘æµ‹åº”ç”¨æ€§èƒ½å¹¶ä¸”ä¼šå‘¨æœŸæ€§åœ°è¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> monitorPerformance</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> performanceData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    cpuUsage</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cpuUsage</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    memoryUsage</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">memoryUsage</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  perfChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">performanceData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘æ§å·¥å…·éƒ¨åˆ†</span></span>
<span class="line"><span style="color:#D8DEE9;">perfChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Monitoring data received:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¼€å§‹ç›‘æ§åº”ç”¨æ€§èƒ½</span></span>
<span class="line"><span style="color:#88C0D0;">setInterval</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">monitorPerformance</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>error-logger</code> é¢‘é“æ¥å‘é€é”™è¯¯æ—¥å¿—ã€‚è¿™æ ·ï¼Œé”™è¯¯æ—¥å¿—ç³»ç»Ÿå¯ä»¥è®¢é˜…è¿™ä¸ªé¢‘é“ï¼Œå½“åº”ç”¨å‡ºé”™æ—¶æ¥æ”¶é”™è¯¯ä¿¡æ¯å¹¶è®°å½•ä¸‹æ¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> errorChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error-logger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™ä¸ªå‡½æ•°åœ¨åº”ç”¨ä¸­çš„æŸå¤„ï¼Œå½“å‘ç”Ÿé”™è¯¯æ—¶è¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> handleError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  errorChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> error</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> timestamp</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Date</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// é”™è¯¯æ—¥å¿—ç³»ç»Ÿéƒ¨åˆ†</span></span>
<span class="line"><span style="color:#D8DEE9;">errorChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // Code that might throw an error</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Something went wrong!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  handleError</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Node.js ä¸­çš„ <code>Channel</code> ç±»æ¥å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼Œä»¥ä¾¿äºåœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´äº¤æ¢ä¿¡æ¯ï¼Œæ— è®ºæ˜¯ç”¨äºç›‘æ§ã€æ—¥å¿—è®°å½•è¿˜æ˜¯å…¶ä»–ç”¨é€”ã€‚</p><h4 id="channel-hassubscribers" tabindex="-1"><a class="header-anchor" href="#channel-hassubscribers"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#channelhassubscribers" target="_blank" rel="noopener noreferrer">channel.hasSubscribers</a></span></a></h4><p><code>channel.hasSubscribers</code> æ˜¯ Node.js ä¸­ <code>diagnostics_channel</code> æ¨¡å—çš„ä¸€ä¸ªç‰¹æ€§ã€‚è¿™ä¸ªæ¨¡å—ç”¨äºä¸º Node.js åº”ç”¨ç¨‹åºæä¾›ä¸€ç§å‘å¸ƒå’Œè®¢é˜…è¯Šæ–­æ•°æ®çš„æ–¹å¼ï¼Œè¿™å¯¹äºç†è§£å’Œç›‘æ§åº”ç”¨ç¨‹åºçš„è¡Œä¸ºéå¸¸æœ‰å¸®åŠ©ã€‚</p><p>åœ¨è®²è§£ <code>channel.hasSubscribers</code> ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>Channelï¼ˆé€šé“ï¼‰</strong>: åœ¨ <code>diagnostics_channel</code> æ¨¡å—ä¸­ï¼Œä¸€ä¸ª Channel è¡¨ç¤ºä¸€æ¡å‘½åçš„æ¶ˆæ¯é€šé“ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å®ƒå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</li><li><strong>Publisherï¼ˆå‘å¸ƒè€…ï¼‰</strong>: å‘å¸ƒè€…ä¼šå‘ç‰¹å®šçš„ Channel å‘é€æ¶ˆæ¯ã€‚ä»»ä½•æ—¶å€™å½“ä½ çš„åº”ç”¨ç¨‹åºæ‰§è¡Œäº†æŸäº›å¯èƒ½å€¼å¾—å…³æ³¨çš„åŠ¨ä½œæ—¶ï¼Œå°±å¯ä»¥å‘å¸ƒä¸€æ¡æ¶ˆæ¯ã€‚</li><li><strong>Subscriberï¼ˆè®¢é˜…è€…ï¼‰</strong>: è®¢é˜…è€…ä¼šç›‘å¬ Channel ä¸Šçš„æ¶ˆæ¯ã€‚å½“æœ‰æ–°æ¶ˆæ¯æ—¶ï¼Œå®ƒä»¬å¯ä»¥åšå‡ºç›¸åº”çš„ååº”ï¼Œä¾‹å¦‚è®°å½•æ—¥å¿—ã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯æˆ–è§¦å‘å…¶ä»–æ“ä½œã€‚</li></ol><p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹ <code>channel.hasSubscribers</code>ï¼š</p><p>å½“ä½ åœ¨åº”ç”¨ç¨‹åºä¸­åˆ›å»ºäº†ä¸€ä¸ª Channel åï¼Œä½ å¯èƒ½åªæƒ³åœ¨æœ‰è®¢é˜…è€…ç›‘å¬æ—¶æ‰å‘é€æ¶ˆæ¯ï¼Œä»¥é¿å…æµªè´¹èµ„æºã€‚<code>channel.hasSubscribers</code> è¿™ä¸ªå±æ€§å¯ä»¥å¸®åŠ©ä½ æ£€æŸ¥ç‰¹å®š Channel æ˜¯å¦æœ‰è®¢é˜…è€…ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>channel.hasSubscribers</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªåä¸º&#39;my-channel&#39;çš„æ–°é€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æŸä¸ªå‡½æ•°ï¼Œå½“å®ƒæ‰§è¡Œç‰¹å®šä»»åŠ¡æ—¶ä½ å¸Œæœ›èƒ½å¤Ÿå‘å¸ƒæ¶ˆæ¯</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> doSomething</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ£€æŸ¥æ˜¯å¦æœ‰è®¢é˜…è€…åœ¨ç›‘å¬&#39;my-channel&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">hasSubscribers</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // å¦‚æœæœ‰è®¢é˜…è€…ï¼Œå‘å¸ƒä¸€æ¡ç›¸å…³æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> foo</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">bar</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // æ‰§è¡Œå…¶ä»–é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ·»åŠ ä¸€ä¸ªè®¢é˜…è€…æ¥ç›‘å¬&#39;my-channel&#39;ä¸Šçš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received message on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾åç»­ä»£ç è°ƒç”¨äº†doSomethingå‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">doSomething</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>diagnostics_channel</code> æ¨¡å—å¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Channelã€‚ç„¶åå®šä¹‰äº†ä¸€ä¸ª <code>doSomething</code> å‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>channel.hasSubscribers</code> æ¥åˆ¤æ–­æ˜¯å¦æœ‰è®¢é˜…è€…ç›‘å¬æˆ‘ä»¬çš„ Channelã€‚å¦‚æœæœ‰è®¢é˜…è€…ï¼Œæˆ‘ä»¬å°±é€šè¿‡ <code>channel.publish</code> æ–¹æ³•å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯ã€‚æœ€åï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªè®¢é˜…è€…æ¥ç›‘å¬ Channel çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”åœ¨æ¶ˆæ¯åˆ°è¾¾æ—¶æ‰“å°å®ƒã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>channel.hasSubscribers</code> å°±æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå‘Šè¯‰ä½ æŸä¸ª Channel æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªæ´»è·ƒçš„è®¢é˜…è€…ã€‚è¿™ä¸ªå±æ€§éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…åœ¨æ²¡æœ‰å¿…è¦æ—¶å‘é€æ¶ˆæ¯ã€‚</p><h4 id="channel-publish-message" tabindex="-1"><a class="header-anchor" href="#channel-publish-message"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#channelpublishmessage" target="_blank" rel="noopener noreferrer">channel.publish(message)</a></span></a></h4><p>Node.js çš„ <code>diagnostics_channel</code> æ¨¡å—æ˜¯ä¸€ä¸ªç”¨äºåº”ç”¨ç¨‹åºå†…éƒ¨é€šä¿¡å’Œè¯Šæ–­ä»£ç çš„æ¨¡å—ã€‚å®ƒå…è®¸ä½ åˆ›å»ºå‘½åçš„é€šé“ï¼Œç„¶åä½ å¯ä»¥åœ¨è¿™äº›é€šé“ä¸Šå‘å¸ƒï¼ˆpublishï¼‰æ¶ˆæ¯æˆ–è€…è®¢é˜…ï¼ˆsubscribeï¼‰æ¶ˆæ¯ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>channel.publish(message)</code> æ˜¯è¿™ä¸ªæ¨¡å—é‡Œç”¨æ¥å‘é€æ¶ˆæ¯åˆ°ç‰¹å®šé€šé“çš„å‡½æ•°ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šåˆ†æ­¥éª¤è§£é‡Šè¿™ä¸ªå‡½æ•°çš„å·¥ä½œæµç¨‹ï¼Œå¹¶æä¾›ä¸€äº›å®é™…çš„ä¾‹å­ï¼š</p><h3 id="_1-åˆ›å»ºé€šé“" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºé€šé“"><span>1. åˆ›å»ºé€šé“</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªè¯Šæ–­é€šé“ã€‚ä¸€ä¸ªé€šé“å°±åƒæ˜¯ä¸€ä¸ªå¹¿æ’­é¢‘é“ï¼Œä»»ä½•æ„Ÿå…´è¶£çš„éƒ¨åˆ†éƒ½å¯ä»¥ç›‘å¬ï¼ˆè®¢é˜…ï¼‰è¿™ä¸ªé¢‘é“ä¸Šçš„æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº† <code>diagnostics_channel</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>&#39;my-channel&#39;</code> çš„æ–°é€šé“ã€‚</p><h3 id="_2-å‘å¸ƒæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_2-å‘å¸ƒæ¶ˆæ¯"><span>2. å‘å¸ƒæ¶ˆæ¯</span></a></h3><p>ç°åœ¨ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>channel.publish(message)</code> æ–¹æ³•æ¥åˆ°è¿™ä¸ªé€šé“å‘å¸ƒæ¶ˆæ¯äº†ã€‚æ¶ˆæ¯å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‘é€ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘é€ä¸€ä¸ªåŒ…å«å¤šç§æ•°æ®çš„å¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">MessageName</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  payload</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    id</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 123</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    content</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This is a message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºç¬¬äºŒä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å‘é€šé“å‘å¸ƒäº†ä¸€ä¸ªå¤æ‚çš„æ¶ˆæ¯å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†æ¶ˆæ¯åç§°å’Œæœ‰æ•ˆè´Ÿè½½æ•°æ®ã€‚</p><h3 id="_3-è®¢é˜…æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_3-è®¢é˜…æ¶ˆæ¯"><span>3. è®¢é˜…æ¶ˆæ¯</span></a></h3><p>å…¶ä»–éƒ¨åˆ†çš„ä»£ç å¯ä»¥è®¢é˜…è¿™ä¸ªé€šé“ï¼Œä»¥ä¾¿å½“æœ‰æ¶ˆæ¯å‘å¸ƒæ—¶èƒ½å¤Ÿå¾—åˆ°é€šçŸ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received message on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªè®¢é˜…è€…ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¯å½“æœ‰æ¶ˆæ¯è¢«å‘å¸ƒåˆ° &#39;my-channel&#39; æ—¶å°±ä¼šè¢«è°ƒç”¨ã€‚å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<code>message</code> æ˜¯å‘å¸ƒåˆ°é€šé“çš„æ¶ˆæ¯ï¼Œ<code>name</code> æ˜¯é€šé“çš„åç§°ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œä½ å¸Œæœ›åœ¨æ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶è®°å½•ä¸€äº›è¯Šæ–­ä¿¡æ¯ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„è¯Šæ–­é€šé“æ¥å¤„ç†è¿™äº›ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å¸ƒè¯·æ±‚å¼€å§‹çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  requestChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ... å¤„ç†è¯·æ±‚ ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å¸ƒè¯·æ±‚ç»“æŸçš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  requestChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜…è¯·æ±‚è¯Šæ–­é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">requestChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Started processing request for </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Finished processing request for </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œæ¯æ¬¡æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šé€šè¿‡ <code>requestChannel</code> å‘å¸ƒæ¶ˆæ¯ã€‚ç„¶åæˆ‘ä»¬è®¢é˜…äº†è¿™ä¸ªé€šé“ï¼Œå¹¶ä¸”æ ¹æ®æ¶ˆæ¯ç±»å‹è¾“å‡ºå¼€å§‹æˆ–ç»“æŸå¤„ç†è¯·æ±‚çš„æ—¥å¿—ã€‚è¿™æ ·å°±èƒ½æä¾›å…³äºç³»ç»Ÿè¡Œä¸ºçš„æ´å¯Ÿï¼Œè€Œä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­ç›´æ¥ç¼–å†™æ—¥å¿—è®°å½•ä»£ç ã€‚</p><h4 id="channel-subscribe-onmessage" tabindex="-1"><a class="header-anchor" href="#channel-subscribe-onmessage"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#channelsubscribeonmessage" target="_blank" rel="noopener noreferrer">channel.subscribe(onMessage)</a></span></a></h4><p>Node.js çš„ <code>diagnostics_channel</code> æ¨¡å—æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„åŠŸèƒ½ï¼Œå®ƒæä¾›äº†ä¸€ç§å‘å¸ƒ/è®¢é˜…ï¼ˆpub/subï¼‰æœºåˆ¶æ¥ä¼ é€’è¯Šæ–­ä¿¡æ¯ã€‚è¿™ä¸ªæ¨¡å—å…è®¸ä½ åˆ›å»ºå‘½åçš„é€šé“ï¼ˆchannelï¼‰ï¼Œç„¶åä½ å¯ä»¥å‘è¿™äº›é€šé“å‘é€ï¼ˆpublishï¼‰æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥è®¢é˜…ï¼ˆsubscribeï¼‰è¿™äº›é€šé“ä»¥æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>channel.subscribe(onMessage)</code> æ–¹æ³•æ˜¯è¿™ä¸ªæœºåˆ¶ä¸­ç”¨æ¥è®¢é˜…æ¶ˆæ¯çš„æ–¹æ³•ã€‚ç°åœ¨æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥è§£é‡Šå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¹¶ç»™å‡ºä¸€äº›ä½¿ç”¨ä¾‹å­ã€‚</p><h3 id="subscribe-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#subscribe-æ–¹æ³•"><span>subscribe æ–¹æ³•</span></a></h3><p>å½“ä½ æƒ³è¦ç›‘å¬ä¸€ä¸ªç‰¹å®šé€šé“ä¸Šçš„æ¶ˆæ¯æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>subscribe</code> æ–¹æ³•ã€‚ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨æ¯æ¬¡æœ‰æ¶ˆæ¯å‘å¸ƒåˆ°é€šé“æ—¶è¢«è°ƒç”¨ã€‚</p><p><code>onMessage</code> å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š<code>message</code> å’Œ <code>name</code>ã€‚<code>message</code> æ˜¯å‘å¸ƒåˆ°é€šé“çš„æ•°æ®ï¼Œè€Œ <code>name</code> æ˜¯é€šé“çš„åç§°ã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>diagnostics_channel</code> æ¨¡å—ï¼š</p><h4 id="æ­¥éª¤-1-åˆ›å»ºé€šé“" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-åˆ›å»ºé€šé“"><span>æ­¥éª¤ 1: åˆ›å»ºé€šé“</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ <code>diagnostics_channel</code> æ¨¡å—å¹¶åˆ›å»ºä¸€ä¸ªé€šé“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º &quot;my-channel&quot; çš„é€šé“ã€‚</p><h4 id="æ­¥éª¤-2-è®¢é˜…é€šé“" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-è®¢é˜…é€šé“"><span>æ­¥éª¤ 2: è®¢é˜…é€šé“</span></a></h4><p>ç„¶åï¼Œä½ å¯ä»¥è®¢é˜…è¿™ä¸ªé€šé“å¹¶å®šä¹‰å½“æ¶ˆæ¯å‘å¸ƒåˆ°è¿™ä¸ªé€šé“æ—¶åº”è¯¥æ‰§è¡Œçš„æ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received message on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°æŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯å’Œé€šé“åç§°æ‰“å°å‡ºæ¥ã€‚</p><h4 id="æ­¥éª¤-3-å‘å¸ƒæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-å‘å¸ƒæ¶ˆæ¯"><span>æ­¥éª¤ 3: å‘å¸ƒæ¶ˆæ¯</span></a></h4><p>è®¢é˜…ä¹‹åï¼Œä½ æˆ–å…¶ä»–äººå¯ä»¥å¾€è¿™ä¸ªé€šé“å‘é€æ¶ˆæ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> foo</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">bar</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ¯å½“é€šè¿‡ <code>publish</code> æ–¹æ³•å‘ &quot;my-channel&quot; é€šé“å‘é€æ¶ˆæ¯æ—¶ï¼Œæ‰€æœ‰è®¢é˜…äº†è¯¥é€šé“çš„å›è°ƒå‡½æ•°éƒ½ä¼šæ‰§è¡Œï¼Œå¹¶æ‰“å°å‡ºæ¶ˆæ¯å†…å®¹ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p><code>diagnostics_channel</code> æ›´å¤šçš„æ˜¯ç”¨äºåº“å’Œæ¡†æ¶çš„å¼€å‘è€…è¿›è¡Œæ€§èƒ½ç›‘æ§å’Œé—®é¢˜æ’æŸ¥ï¼Œè€Œéæ—¥å¸¸çš„åº”ç”¨ç¨‹åºå¼€å‘ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä¸¾ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦è·Ÿè¸ªä¸€ä¸ª HTTP æœåŠ¡å™¨çš„è¯·æ±‚æƒ…å†µï¼š</p><h4 id="åˆ›å»º-http-æœåŠ¡å™¨å¹¶å®šä¹‰é€šé“" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-http-æœåŠ¡å™¨å¹¶å®šä¹‰é€šé“"><span>åˆ›å»º HTTP æœåŠ¡å™¨å¹¶å®šä¹‰é€šé“</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸“é—¨è·Ÿè¸ªHTTPè¯·æ±‚çš„é€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> httpRequestChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http-request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å½“æœ‰è¯·æ±‚è¿›æ¥æ—¶ï¼Œå‘å¸ƒæ¶ˆæ¯åˆ°é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">  httpRequestChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    headers</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è®¢é˜…é€šé“ä»¥è·å–è¯·æ±‚ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#è®¢é˜…é€šé“ä»¥è·å–è¯·æ±‚ä¿¡æ¯"><span>è®¢é˜…é€šé“ä»¥è·å–è¯·æ±‚ä¿¡æ¯</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">httpRequestChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">New HTTP request on </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“ HTTP æœåŠ¡å™¨æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æ—¶ï¼Œå®ƒéƒ½ä¼šå°†è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯å‘å¸ƒåˆ° &quot;http-request&quot; é€šé“ä¸Šã€‚å¦‚æœä½ åœ¨ä»»ä½•åœ°æ–¹è®¢é˜…äº†è¿™ä¸ªé€šé“ï¼Œå°±ä¼šæ¥æ”¶åˆ°è¿™äº›è¯·æ±‚çš„ä¿¡æ¯ï¼Œå¹¶å¯ä»¥å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚æ‰“å°æ—¥å¿—ã€è¿›è¡Œæ€§èƒ½ç›‘æ§ç­‰ã€‚</p><h4 id="channel-unsubscribe-onmessage" tabindex="-1"><a class="header-anchor" href="#channel-unsubscribe-onmessage"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#channelunsubscribeonmessage" target="_blank" rel="noopener noreferrer">channel.unsubscribe(onMessage)</a></span></a></h4><p>Node.js ä¸­çš„ <code>diagnostics_channel</code> æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€ç§å‘å¸ƒè®¢é˜…ï¼ˆpub-subï¼‰æœºåˆ¶ã€‚å®ƒå…è®¸ä»£ç åˆ›å»ºå‘½åé€šé“ï¼Œå…¶ä»–éƒ¨åˆ†çš„ä»£ç å¯ä»¥å‘è¿™ä¸ªé€šé“è®¢é˜…æ¶ˆæ¯ï¼Œæˆ–è€…å‘å®ƒå‘é€æ¶ˆæ¯ã€‚è¿™ç§æœºåˆ¶ç‰¹åˆ«æœ‰ç”¨äºæ”¶é›†è¯Šæ–­ä¿¡æ¯å’Œè°ƒè¯•ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>channel.unsubscribe(onMessage)</code> æ˜¯ <code>diagnostics_channel</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºä»ä¹‹å‰è®¢é˜…çš„é€šé“ä¸­å–æ¶ˆè®¢é˜…ã€‚</p><p>è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šå®ƒçš„å·¥ä½œåŸç†ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œä½ æƒ³ç›‘æ§æ¯æ¬¡æœ‰ HTTP è¯·æ±‚åˆ°æ¥æ—¶çš„ä¿¡æ¯ã€‚ä½ å¯èƒ½ä¼šä½¿ç”¨ <code>diagnostics_channel</code> æ¥åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°æ–°çš„ HTTP è¯·æ±‚æ—¶å‘é€æ¶ˆæ¯ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ <code>diagnostics_channel</code> æ¨¡å—å¹¶åˆ›å»ºä¸€ä¸ªé€šé“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http-requests</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯èƒ½åœ¨ HTTP æœåŠ¡å™¨çš„è¯·æ±‚å¤„ç†é€»è¾‘ä¸­å‘é€æ¶ˆæ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> method</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†è¯·æ±‚...</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œä½ å†³å®šè®¢é˜…è¿™ä¸ªé€šé“ï¼Œä»¥ä¾¿æ‰“å°å‡ºæ¯æ¬¡è¯·æ±‚çš„ä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> logRequest</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">Received request for </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> with method </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">logRequest</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæ¯æ¬¡ HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œ<code>logRequest</code> å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¹¶æ‰“å°å‡ºè¯·æ±‚çš„ URL å’Œæ–¹æ³•ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœåœ¨æŸä¸ªæ—¶é—´ç‚¹ä½ ä¸å†éœ€è¦æ‰“å°è¿™äº›ä¿¡æ¯ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>unsubscribe</code> æ–¹æ³•æ¥å–æ¶ˆè®¢é˜…ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾åœ¨æŸä¸ªæ¡ä»¶æ»¡è¶³åï¼Œä½ å†³å®šåœæ­¢æ—¥å¿—è®°å½•</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">someCondition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unsubscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">logRequest</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è°ƒç”¨ <code>channel.unsubscribe(logRequest)</code>ï¼Œä½ æŒ‡ç¤º Node.js ä¸å†è°ƒç”¨ <code>logRequest</code> å‡½æ•°æ¥å“åº”é€šé“ä¸­çš„æ¶ˆæ¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<code>unsubscribe</code> å°±æ˜¯ç”¨æ¥åœæ­¢ç›‘å¬ä¹‹å‰é€šè¿‡ <code>subscribe</code> æ³¨å†Œçš„äº‹ä»¶ã€‚</p><p>è¿™æ ·ï¼Œä½ å°±å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°å¼€å§‹å’Œç»“æŸå¯¹ç‰¹å®šç±»å‹äº‹ä»¶çš„ç›‘å¬ï¼Œè¿™å¯¹äºæ§åˆ¶èµ„æºæ¶ˆè€—ã€é¿å…ä¸å¿…è¦çš„å¤„ç†ä»¥åŠåœ¨è¿è¡Œæ—¶æ”¹å˜åº”ç”¨ç¨‹åºè¡Œä¸ºéƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><h4 id="channel-bindstore-store-transform" tabindex="-1"><a class="header-anchor" href="#channel-bindstore-store-transform"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#channelbindstorestore-transform" target="_blank" rel="noopener noreferrer">channel.bindStore(store[, transform])</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ Node.js v21.7.1 ä¸­çš„ <code>channel.bindStore(store[, transform])</code> è¿™ä¸ª APIã€‚</p><p>é¦–å…ˆï¼Œäº†è§£ <code>diagnostics_channel</code> æ¨¡å—æ˜¯éå¸¸é‡è¦çš„ã€‚è¿™ä¸ªæ¨¡å—äº Node.js 15 å¼•å…¥ï¼Œå¹¶åœ¨åç»­ç‰ˆæœ¬ä¸­å¾—åˆ°å®Œå–„ã€‚<code>diagnostics_channel</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªå‘å¸ƒ-è®¢é˜…ï¼ˆpub-subï¼‰æœºåˆ¶ï¼Œå…è®¸ä½ åˆ›å»ºå‘½åé€šé“å¹¶åœ¨è¿™äº›é€šé“ä¸Šå‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ã€‚è¿™å¯¹äºåº”ç”¨ç¨‹åºå’Œåº“çš„è¯Šæ–­æˆ–è°ƒè¯•éå¸¸æœ‰ç”¨ã€‚</p><p>ç°åœ¨ï¼Œè°ˆåˆ° <code>channel.bindStore(store[, transform])</code> æ–¹æ³•ï¼š</p><ul><li><code>channel</code> æ˜¯é€šè¿‡ <code>diagnostics_channel.channel(name)</code> åˆ›å»ºçš„ä¸€ä¸ªé€šé“å¯¹è±¡ã€‚</li><li><code>bindStore</code> æ˜¯ <code>channel</code> å¯¹è±¡ä¸Šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå…è®¸ä½ å°†ä¸€ä¸ª &quot;store&quot; ç»‘å®šåˆ°å½“å‰çš„å¼‚æ­¥èµ„æºï¼ˆæ¯”å¦‚ Promise, setTimeout, setImmediate ç­‰ï¼‰æˆ–è¯·æ±‚é“¾ä¸Šã€‚</li><li><code>store</code> å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ JavaScript å¯¹è±¡ï¼Œä½ å¸Œæœ›åœ¨æ•´ä¸ªå¼‚æ­¥æ“ä½œæœŸé—´ä¿æŒå¯è¿½è¸ªå’Œä½¿ç”¨ã€‚</li><li><code>transform</code> æ˜¯ä¸€ä¸ªå¯é€‰çš„å‡½æ•°ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒè½¬æ¢æˆ–è¿‡æ»¤å­˜å‚¨ï¼ˆstoreï¼‰ä¸­çš„æ•°æ®ã€‚</li></ul><p>å®é™…è¿ç”¨æ¡ˆä¾‹ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ï¼Œä½ æƒ³è·Ÿè¸ªç‰¹å®šè¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“ä»å¼€å§‹åˆ°ç»“æŸï¼Œæ¯ä¸ªè¯·æ±‚å¤„ç†äº†å¤šå°‘æ•°æ®åº“æŸ¥è¯¢ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>diagnostics_channel</code> æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> channel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªåä¸º &#39;request-context&#39; çš„é€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestContextChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request-context</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»ºä¸€ä¸ª store å¯¹è±¡æ¥ä¿å­˜è¯·æ±‚ç›¸å…³çš„æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> store</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> queryCount</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç»‘å®š store åˆ°å½“å‰å¼‚æ­¥ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="color:#D8DEE9;">  requestContextChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">bindStore</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">store</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾ handleRequest æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå®ƒå†…éƒ¨å¯èƒ½æ‰§è¡Œå¤šä¸ªæ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#88C0D0;">  handleRequest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å½“è¯·æ±‚å¤„ç†å®Œæˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è·å– store ä¸­çš„ queryCount</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">This request executed </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">store</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">queryCount</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> queries.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥çš„è¯·æ±‚å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> handleRequest</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚æŸ¥è¯¢æ•°æ®åº“...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™æ˜¯ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">  makeQuery</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¨¡æ‹Ÿä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> makeQuery</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è·å–å½“å‰å¼‚æ­¥èµ„æºçš„ store</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> store</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> requestContextChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">store</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">store</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€’å¢ store ä¸Šçš„ queryCount</span></span>
<span class="line"><span style="color:#D8DEE9;">    store</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">queryCount</span><span style="color:#81A1C1;"> +=</span><span style="color:#B48EAD;"> 1</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚å¯¹äºæ¯ä¸ªæ¥æ”¶åˆ°çš„è¯·æ±‚ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å« <code>queryCount</code> å±æ€§çš„ <code>store</code> å¯¹è±¡ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°å½“å‰çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ã€‚åœ¨ <code>handleRequest</code> å’Œ <code>makeQuery</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>requestContextChannel.store</code> è®¿é—®ç»‘å®šçš„ <code>store</code> ä»¥é€’å¢æŸ¥è¯¢è®¡æ•°å™¨ã€‚å½“è¯·æ±‚å¤„ç†å®Œæˆæ—¶ï¼Œæˆ‘ä»¬å°±èƒ½äº†è§£è¿™ä¸ªè¯·æ±‚å…±æ‰§è¡Œäº†å¤šå°‘æ¬¡æ•°æ®åº“æŸ¥è¯¢ã€‚</p><p>è¿™åªæ˜¯ <code>diagnostics_channel</code> å’Œ <code>bindStore</code> çš„ä¸€ä¸ªåŸºæœ¬ç”¨æ³•ç¤ºä¾‹ã€‚è¿™ä¸ª API çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒå¯ä»¥è®©åº“çš„å¼€å‘è€…å’Œåº”ç”¨ç¨‹åºå¼€å‘è€…åœ¨éœ€è¦æ—¶å…±äº«ä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œè€Œä¸éœ€è¦æ˜¾å¼ä¼ é€’å‚æ•°ã€‚è¿™å¯¹äºè·¨è¶Šå¤šä¸ªå¼‚æ­¥è¾¹ç•Œçš„å¤æ‚åº”ç”¨ç¨‹åºç‰¹åˆ«æœ‰ç”¨ã€‚</p><h4 id="channel-unbindstore-store" tabindex="-1"><a class="header-anchor" href="#channel-unbindstore-store"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#channelunbindstorestore" target="_blank" rel="noopener noreferrer">channel.unbindStore(store)</a></span></a></h4><p><code>diagnostics_channel</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç§å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼ï¼Œç”¨äºè¯Šæ–­ä¿¡æ¯çš„ä¼ é€’ã€‚è¿™ä¸ªæ¨¡å—å…è®¸åˆ›å»ºå‘½åçš„é€šé“ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡è¿™äº›é€šé“æ¥å‘å¸ƒæ¶ˆæ¯æˆ–è€…è®¢é˜…æ¶ˆæ¯ï¼Œè¿›è€Œè·å–åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€æˆ–æ€§èƒ½æ•°æ®ç­‰ã€‚</p><p>åœ¨ <code>diagnostics_channel</code> æ¨¡å—ä¸­ï¼Œ<code>channel.unbindStore(store)</code> è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥è§£é™¤ä¹‹å‰é€šè¿‡ <code>channel.bindStore(store)</code> æ–¹æ³•ç»‘å®šçš„å­˜å‚¨å¯¹è±¡ï¼ˆstoreï¼‰çš„ç»‘å®šå…³ç³»ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p><p>é¦–å…ˆï¼Œ<code>channel</code> æ˜¯ä½ ä¹‹å‰åˆ›å»ºçš„ä¸€ä¸ªè¯Šæ–­é€šé“å¯¹è±¡ã€‚æ¯ä¸ªé€šé“éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œå¹¶ä¸”å¯ä»¥æœ‰å¤šä¸ªè®¢é˜…è€…ç›‘å¬è¿™ä¸ªé€šé“å‘å¸ƒçš„äº‹ä»¶ã€‚</p><p><code>store</code> æ˜¯ä¸€ä¸ªå­˜å‚¨å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç”¨æ¥ä¿å­˜çŠ¶æ€æˆ–è€…ä¸Šä¸‹æ–‡ä¿¡æ¯çš„åœ°æ–¹ã€‚å½“ä½ åœ¨å¤„ç†ä¸€ä¸ªè®¢é˜…äº‹ä»¶æ—¶ï¼Œå¯èƒ½éœ€è¦è®¿é—®è¿™ä¸ªå­˜å‚¨å¯¹è±¡ã€‚</p><p>ä½¿ç”¨ <code>bindStore()</code> æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªå­˜å‚¨å¯¹è±¡ä¸é€šé“ç»‘å®šèµ·æ¥ã€‚è¿™æ„å‘³ç€å½“å‘å¸ƒåˆ°é€šé“çš„äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè®¢é˜…è€…å¯ä»¥è®¿é—®è¿™ä¸ªå­˜å‚¨å¯¹è±¡ã€‚</p><p>å¦‚æœä½ æƒ³è¦è§£é™¤è¿™ç§ç»‘å®šå…³ç³»ï¼Œæ¯”å¦‚ï¼Œä½ ä¸å†éœ€è¦ç›‘å¬æŸä¸ªç‰¹å®šçš„äº‹ä»¶ï¼Œæˆ–è€…ä½ æƒ³è¦å›æ”¶èµ„æºï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ <code>unbindStore()</code> æ–¹æ³•ã€‚è°ƒç”¨ <code>unbindStore(store)</code> åï¼Œè¯¥å­˜å‚¨å¯¹è±¡å°±ä¸ä¼šå†ä¸é€šé“å…³è”ï¼Œä¹Ÿå°±ä¸ä¼šä¼ é€’ç»™åç»­çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªæ¦‚å¿µï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æƒ³è¦è®°å½•æ¯æ¬¡è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>diagnostics_channel</code> åˆ›å»ºä¸€ä¸ªé€šé“æ¥å‘å¸ƒæ¯ä¸ªè¯·æ±‚çš„å¼€å§‹å’Œç»“æŸäº‹ä»¶ï¼Œç„¶åè®¢é˜…è¿™äº›äº‹ä»¶æ¥è®¡ç®—å¤„ç†æ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Channel</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªé€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å¸ƒè¯·æ±‚å¼€å§‹çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> request</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¤„ç†è¯·æ±‚...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å“åº”è¯·æ±‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å¸ƒè¯·æ±‚ç»“æŸçš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> request</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå­˜å‚¨å¯¹è±¡æ¥ä¿å­˜è¯·æ±‚çš„å¼€å§‹æ—¶é—´</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestTimes</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Map</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜…é€šé“äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // è¯·æ±‚å¼€å§‹ï¼Œè®°å½•å¼€å§‹æ—¶é—´</span></span>
<span class="line"><span style="color:#D8DEE9;">    requestTimes</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">set</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Date</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // è¯·æ±‚ç»“æŸï¼Œè®¡ç®—å¹¶æ‰“å°å¤„ç†æ—¶é—´</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> requestTimes</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">request</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> duration</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Date</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Request processed in </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">duration</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">ms</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // æ¸…ç†å­˜å‚¨å¯¹è±¡</span></span>
<span class="line"><span style="color:#D8DEE9;">    requestTimes</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">delete</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">request</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç»‘å®šå­˜å‚¨å¯¹è±¡åˆ°é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">bindStore</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">requestTimes</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>request-channel</code> çš„é€šé“ï¼Œå¹¶åœ¨ HTTP æœåŠ¡å™¨å¤„ç†æ¯ä¸ªè¯·æ±‚çš„å¼€å§‹å’Œç»“æŸæ—¶å‘å¸ƒäº‹ä»¶ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬é€šè¿‡è®¢é˜…è¿™ä¸ªé€šé“æ¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œå¹¶è®°å½•å¤„ç†æ—¶é—´ã€‚</p><p>å¦‚æœåœ¨æŸä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬å†³å®šä¸å†éœ€è¦è·Ÿè¸ªè¯·æ±‚æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>unbindStore()</code> æ¥è§£é™¤ <code>requestTimes</code> å­˜å‚¨å¯¹è±¡ä¸é€šé“çš„ç»‘å®šï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// è§£é™¤ç»‘å®š</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unbindStore</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">requestTimes</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œè¿™æ®µä»£ç åï¼Œå³ä½¿é€šé“ä»ç„¶åœ¨å‘å¸ƒäº‹ä»¶ï¼Œ<code>requestTimes</code> å°†ä¸å†è¢«ä¼ é€’ç»™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå› æ­¤ä¹Ÿä¸ä¼šè¢«è¿›ä¸€æ­¥å¤„ç†æˆ–æ›´æ–°ã€‚</p><h4 id="channel-runstores-context-fn-thisarg-args" tabindex="-1"><a class="header-anchor" href="#channel-runstores-context-fn-thisarg-args"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#channelrunstorescontext-fn-thisarg-args" target="_blank" rel="noopener noreferrer">channel.runStores(context, fn[, thisArg[, ...args]])</a></span></a></h4><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js çš„ <code>channel.runStores</code> æ–¹æ³•æ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¦‚ä½•å·¥ä½œçš„ã€‚</p><p>é¦–å…ˆï¼Œ<code>diagnostics_channel</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç§å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼çš„æ–¹å¼ï¼Œå¯ä»¥ç”¨äºç†è§£å’Œç›‘æ§ä»£ç çš„è¿è¡Œæƒ…å†µã€‚è¿™åœ¨æ€§èƒ½åˆ†æã€è°ƒè¯•æˆ–è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„ç‰¹å®šéƒ¨åˆ†æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p><code>channel.runStores</code> è¿™ä¸ªæ–¹æ³•æ˜¯ <code>diagnostics_channel</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åœ¨ç»™å®šçš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ä¸­æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼ˆfnï¼‰ï¼ŒåŒæ—¶ä¿ç•™è¯¥ä¸Šä¸‹æ–‡ä¸­çš„è¯Šæ–­é€šé“çš„çŠ¶æ€ã€‚è¿™æ ·åšçš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯åœ¨å¼‚æ­¥æ“ä½œä¸­ï¼Œç›¸å…³çš„è¯Šæ–­ä¿¡æ¯èƒ½å¤Ÿæ­£ç¡®åœ°ä¼ é€’å’Œå…³è”èµ·æ¥ã€‚</p><p>è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°è¯¦ç»†è§£é‡Šï¼š</p><ol><li><p><strong>Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰</strong>:</p><ul><li>ä¸Šä¸‹æ–‡æ˜¯æŒ‡åœ¨ç¼–ç¨‹ä¸­ä¿å­˜çŠ¶æ€å’Œå˜é‡çš„ä¸€ç§æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå½“ä½ åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä¿æŒç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å°±å¯ä»¥å­˜å‚¨åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­ã€‚</li></ul></li><li><p><strong>Function (fn)</strong>:</p><ul><li>è¿™æ˜¯ä½ å¸Œæœ›æ‰§è¡Œçš„å‡½æ•°ï¼Œå®ƒå°†åœ¨æŒ‡å®šçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚</li></ul></li><li><p><strong>thisArg</strong>:</p><ul><li>è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œå®ƒæŒ‡å®šäº†å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå†…éƒ¨çš„ <code>this</code> å…³é”®å­—åº”è¯¥æŒ‡å‘ä»€ä¹ˆå¯¹è±¡ã€‚</li></ul></li><li><p><strong>...args</strong>:</p><ul><li>ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œè¿™ä¸ªæ˜¯ä¸€ç³»åˆ—å‚æ•°ï¼Œä½ æƒ³è¦ä¼ é€’ç»™é‚£ä¸ªå°†è¦æ‰§è¡Œçš„å‡½æ•°ã€‚</li></ul></li></ol><p>å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¯ä»¥æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢çš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>channel.runStores</code> æ¥ç¡®ä¿æŸ¥è¯¢æœŸé—´çš„æ‰€æœ‰è¯Šæ–­äº‹ä»¶éƒ½èƒ½æ­£ç¡®å…³è”åˆ°ç›¸åŒçš„è¯·æ±‚ä¸Šä¸‹æ–‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-database-query-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> queryDatabase</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">query</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šå‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼Œè¡¨æ˜æ•°æ®åº“æŸ¥è¯¢å¼€å§‹äº†ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> event</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> query</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">nextTick</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some result</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™åº”è¯¥æ˜¯ä»æ•°æ®åº“ä¸­è·å–çš„ç»“æœ</span></span>
<span class="line"><span style="color:#616E88;">    // å‘å¸ƒå¦ä¸€ä¸ªäº‹ä»¶ï¼Œè¡¨æ˜æŸ¥è¯¢ç»“æŸäº†ã€‚</span></span>
<span class="line"><span style="color:#D8DEE9;">    channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> event</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> query</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥ä¿å­˜è¯·æ±‚çš„çŠ¶æ€ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> context</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> requestId</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1234</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ runStores æ–¹æ³•ï¼Œåœ¨ç»™å®šçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ queryDatabase å‡½æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">runStores</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">  context</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  queryDatabase</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">  null</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">SELECT * FROM users</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">      return</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#616E88;">    // å¤„ç†æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>runStores</code> æ–¹æ³•ç¡®ä¿åœ¨æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•é€šè¿‡ <code>channel.publish</code> å‘å¸ƒçš„äº‹ä»¶éƒ½èƒ½ä¸æˆ‘ä»¬å®šä¹‰çš„ <code>context</code> å¯¹è±¡å…³è”èµ·æ¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶è¿›è¡Œï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è¿½è¸ªæ¯ä¸ªè¯·æ±‚çš„è¯Šæ–­äº‹ä»¶ï¼Œå¹¶ä¸”çŸ¥é“å®ƒä»¬å±äºå“ªä¸ªè¯·æ±‚ä¸Šä¸‹æ–‡ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>channel.runStores</code> æ–¹æ³•æ˜¯åœ¨ Node.js ä¸­å¤„ç†å¼‚æ­¥æ“ä½œå¹¶ä¸”éœ€è¦ä¿ç•™çŠ¶æ€ä¸Šä¸‹æ–‡çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚é€šè¿‡ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿è¯Šæ–­ä¿¡æ¯çš„è¿è´¯æ€§å’Œå‡†ç¡®æ€§ï¼Œè¿™å¯¹äºå¤æ‚çš„å¼‚æ­¥æµæ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="class-tracingchannel" tabindex="-1"><a class="header-anchor" href="#class-tracingchannel"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#class-tracingchannel" target="_blank" rel="noopener noreferrer">Class: TracingChannel</a></span></a></h3><p>Node.js ä¸­çš„ <code>TracingChannel</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œå±äº <code>diagnostics_channel</code> æ¨¡å—ã€‚è¿™ä¸ªç±»æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªè½»é‡çº§çš„ã€å‘å¸ƒ/è®¢é˜…ï¼ˆPub/Subï¼‰é£æ ¼çš„é€šé“ï¼Œå®ƒå…è®¸ä½ åœ¨ä»£ç çš„ä¸åŒéƒ¨åˆ†ä¹‹é—´ä¼ é€’è¯Šæ–­ä¿¡æ¯æˆ–è€…è‡ªå®šä¹‰æ¶ˆæ¯ï¼Œä»¥ä¾¿è¿›è¡Œè°ƒè¯•æˆ–è·Ÿè¸ªç¨‹åºçš„è¿è¡Œæƒ…å†µã€‚</p><p>é¦–å…ˆï¼Œç†è§£â€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼éå¸¸é‡è¦ã€‚è¿™ç§æ¨¡å¼å…è®¸å¤šä¸ªç³»ç»Ÿç»„ä»¶è®¢é˜…æŸäº›äº‹ä»¶ï¼Œå¹¶ä¸”å½“è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰è®¢é˜…äº†è¯¥äº‹ä»¶çš„ç»„ä»¶éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ã€‚è¿™æ ·å¯ä»¥å®ç°æ¾è€¦åˆï¼Œå› ä¸ºå‘å¸ƒè€…ä¸éœ€è¦çŸ¥é“è°è®¢é˜…äº†ä»–ä»¬çš„äº‹ä»¶ï¼Œè®¢é˜…è€…ä¹Ÿä¸éœ€è¦çŸ¥é“äº‹ä»¶ä»ä½•è€Œæ¥ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­æ¥å…·ä½“çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ <code>TracingChannel</code> ç±»ã€‚</p><h3 id="åˆ›å»º-tracingchannel" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-tracingchannel"><span>åˆ›å»º TracingChannel</span></a></h3><p>å‡è®¾æˆ‘ä»¬æƒ³è¦è¿½è¸ªåº”ç”¨ä¸­ HTTP è¯·æ±‚çš„æ•°é‡å’Œè¯¦æƒ…ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªåä¸º &#39;http-request&#39; çš„ TracingChannel</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> httpChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http-request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜…&#39;http-request&#39;é€šé“</span></span>
<span class="line"><span style="color:#D8DEE9;">httpChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received a message from </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“HTTPæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå‘å¸ƒæ¶ˆæ¯åˆ°&#39;http-request&#39;é€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  httpChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>diagnostics_channel</code> æ¨¡å—å’Œ <code>http</code> æ¨¡å—ã€‚æˆ‘ä»¬æ¥ç€åˆ›å»ºäº†ä¸€ä¸ªåä¸º &#39;http-request&#39; çš„æ–°é€šé“ï¼Œå¹¶ä¸ºè¿™ä¸ªé€šé“æ·»åŠ äº†ä¸€ä¸ªè®¢é˜…è€…ï¼Œå½“é€šé“æœ‰æ¶ˆæ¯å‘å¸ƒæ—¶ï¼Œè¯¥è®¢é˜…è€…ä¼šæ‰“å°å‡ºæ¶ˆæ¯å†…å®¹å’Œæ¥æºã€‚</p><p>åœ¨ HTTP æœåŠ¡å™¨çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å‘å¸ƒæ¶ˆæ¯åˆ°è¿™ä¸ªé€šé“ï¼Œæ¶ˆæ¯åŒ…å«äº†è¯·æ±‚çš„ URL å’Œæ–¹æ³•ã€‚è¿™æ ·ï¼Œæ¯å½“æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œè®¢é˜…è€…å°±èƒ½å¤Ÿè·å–åˆ°è¿™ä¸ªä¿¡æ¯å¹¶æ‰“å°å‡ºæ¥ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p><code>TracingChannel</code> çš„å…³é”®ç”¨é€”å°±æ˜¯å°†åº”ç”¨ç¨‹åºçš„æŸäº›è¿è¡Œæ—¶ä¿¡æ¯ä¼ é€’åˆ°æ„Ÿå…´è¶£çš„ç›‘å¬å™¨ï¼Œæ— è®ºè¿™äº›ç›‘å¬å™¨æ˜¯ç”¨äºç›‘æ§ã€æ—¥å¿—è®°å½•è¿˜æ˜¯å…¶ä»–ç›®çš„ã€‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼æä¾›äº†é«˜åº¦çš„çµæ´»æ€§å’Œè§£è€¦ï¼Œä½¿å¾—ä½ å¯ä»¥æ ¹æ®éœ€æ±‚å‘åº”ç”¨ç¨‹åºçš„ä»»ä½•éƒ¨åˆ†æ·»åŠ è·Ÿè¸ªåŠŸèƒ½ï¼Œè€Œä¸å½±å“å…¶ä»–éƒ¨åˆ†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>TracingChannel</code> å¹¶ä¸ç›´æ¥ä¸å¤–éƒ¨è·Ÿè¸ªå·¥å…·é›†æˆï¼Œå®ƒåªæ˜¯åœ¨ Node.js åº”ç”¨å†…éƒ¨æä¾›äº†ä¸€ç§é€šä¿¡æœºåˆ¶ã€‚å¦‚æœä½ æƒ³è¦å°†è¿™äº›ä¿¡æ¯å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚ç›‘æ§æœåŠ¡ï¼Œä½ éœ€è¦è‡ªå·±å†™ä»£ç æ¥å¤„ç†è¿™äº›å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå¹¶å°†å®ƒä»¬è½¬å‘åˆ°ç›¸åº”çš„åœ°æ–¹ã€‚</p><h4 id="tracingchannel-subscribe-subscribers" tabindex="-1"><a class="header-anchor" href="#tracingchannel-subscribe-subscribers"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#tracingchannelsubscribesubscribers" target="_blank" rel="noopener noreferrer">tracingChannel.subscribe(subscribers)</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å„ç§å†…ç½®çš„æ¨¡å—å’Œ APIsï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ <code>diagnostics_channel</code> æ¨¡å—ï¼Œè¿™æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå®éªŒæ€§ç‰¹æ€§ï¼Œç”¨äºåº”ç”¨è¯Šæ–­å’Œæ€§èƒ½åˆ†æç­‰ç›®çš„ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>diagnostics_channel</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªæ–¹æ³•å«åš <code>tracingChannel.subscribe(subscribers)</code>ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ åˆ›å»ºå’Œç®¡ç† &quot;channels&quot;ï¼ˆé¢‘é“ï¼‰ï¼Œå®ƒä»¬æ˜¯ç”¨æ¥å‘å¸ƒå’Œè®¢é˜…åº”ç”¨ç¨‹åºä¸­ç‰¹å®šäº‹ä»¶å’Œä¿¡æ¯çš„é€”å¾„ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´å¥½åœ°ç›‘è§†å’Œç†è§£ä»–ä»¬çš„åº”ç”¨æ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p><h3 id="tracingchannel-subscribe-subscribers-1" tabindex="-1"><a class="header-anchor" href="#tracingchannel-subscribe-subscribers-1"><span>tracingChannel.subscribe(subscribers)</span></a></h3><p>è¿™ä¸ªå‡½æ•°å…è®¸ä½ è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªè¯Šæ–­é€šé“ã€‚å½“ä½ è®¢é˜…äº†ä¸€ä¸ªé€šé“ä¹‹åï¼Œæ¯å½“è¯¥é€šé“ä¸Šå‘ç”Ÿäº‹ä»¶æ—¶ï¼Œä½ å°±ä¼šæ”¶åˆ°é€šçŸ¥ã€‚ä½ å¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯æ¥è¿›è¡Œè¯Šæ–­æˆ–è·Ÿè¸ªä½ çš„åº”ç”¨ã€‚</p><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°ï¼š</span></a></h4><ul><li><code>subscribers</code>: è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†ä½ æƒ³è¦è®¢é˜…çš„ä¸€ä¸ªæˆ–å¤šä¸ªé€šé“çš„åç§°ã€‚</li></ul><h4 id="ä½¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¾‹å­"><span>ä½¿ç”¨ä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè´Ÿè´£å¤„ç†ç”¨æˆ·ç™»å½•çš„è¯·æ±‚ã€‚ä½ å¯èƒ½æƒ³è¦è¿½è¸ªè¿™ä¸ªç™»å½•å‡½æ•°ä½•æ—¶è¢«è°ƒç”¨ï¼Œä»¥åŠå®ƒçš„æ‰§è¡Œæƒ…å†µã€‚</p><p>é¦–å…ˆï¼Œä½ è¦ä½¿ç”¨ <code>diagnostics_channel</code> åˆ›å»ºä¸€ä¸ªåä¸º <code>login_attempt</code> çš„é¢‘é“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> loginAttemptChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">login_attempt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåœ¨ä½ çš„ç™»å½•å‡½æ•°ä¸­ï¼Œä½ å¯ä»¥å‘å¸ƒäº‹ä»¶åˆ°è¿™ä¸ªé¢‘é“ä¸Šï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> loginUser</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> password</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åœ¨ç™»å½•å°è¯•ä¹‹å‰å‘å¸ƒäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  loginAttemptChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    stage</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    username</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ... ç™»å½•é€»è¾‘ ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åœ¨ç™»å½•ç»“æŸåå‘å¸ƒäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">  loginAttemptChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    stage</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    username</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    result</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">success</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æˆ–è€… &#39;failure&#39; å¦‚æœç™»å½•å¤±è´¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œä»»ä½•æ—¶å€™å½“ <code>loginUser</code> å‡½æ•°è¢«è°ƒç”¨ï¼Œ<code>login_attempt</code> é¢‘é“å°±ä¼šå‘å¸ƒä¸¤æ¬¡äº‹ä»¶ï¼šä¸€æ¬¡åœ¨ç™»å½•å¼€å§‹ä¹‹å‰ï¼Œä¸€æ¬¡åœ¨ç™»å½•ç»“æŸåã€‚</p><p>æœ€åï¼Œä½ å¯ä»¥è®¢é˜…è¿™ä¸ªé¢‘é“æ¥è·Ÿè¸ªè¿™äº›ç™»å½•å°è¯•çš„ä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> subscription</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> loginAttemptChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stage</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Login attempt started for user: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stage</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">Login attempt ended for user: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> with result: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">result</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªè®¢é˜…å‡½æ•°å°†ä¼šæ‰“å°å‡ºç™»å½•å°è¯•çš„å¼€å§‹å’Œç»“æŸï¼Œå¹¶ä¸”ä¼šæ˜¾ç¤ºç”¨æˆ·åå’Œç»“æœã€‚</p><p>è¿™åªæ˜¯ <code>tracingChannel.subscribe(subscribers)</code> ä½¿ç”¨ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ã€‚è¿™ç§æœºåˆ¶å¯ä»¥ç”¨äºè®¢é˜…åº”ç”¨ä¸­å„ç§ä¸åŒçš„æ“ä½œå’Œäº‹ä»¶ï¼Œä»è€Œå¸®åŠ©ä½ è¯Šæ–­é—®é¢˜ã€ä¼˜åŒ–æ€§èƒ½æˆ–è€…è¿›è¡Œæ—¥å¿—è®°å½•ç­‰ã€‚</p><h4 id="tracingchannel-unsubscribe-subscribers" tabindex="-1"><a class="header-anchor" href="#tracingchannel-unsubscribe-subscribers"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#tracingchannelunsubscribesubscribers" target="_blank" rel="noopener noreferrer">tracingChannel.unsubscribe(subscribers)</a></span></a></h4><p>Node.js ä¸­çš„ <code>tracingChannel.unsubscribe(subscribers)</code> æ–¹æ³•æ˜¯è¯Šæ–­é€šé“ï¼ˆdiagnostics_channelï¼‰æ¨¡å—åŠŸèƒ½ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå–æ¶ˆä¹‹å‰è®¢é˜…çš„äº‹ä»¶ç›‘å¬å™¨ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„è¯Šæ–­é€šé“ã€‚</p><p>è¯Šæ–­é€šé“æ¨¡å—å…è®¸ä½ åˆ›å»ºå‘½åé€šé“ï¼Œç”¨æ¥ä¼ é€’ä¿¡æ¯å’Œä¿¡å·ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥è¢«å…¶ä»–ä»£ç è®¢é˜…å¹¶å¤„ç†ã€‚è¿™åœ¨ç›‘æ§ã€è·Ÿè¸ªæˆ–æ˜¯è°ƒè¯•åº”ç”¨ç¨‹åºæ—¶éå¸¸æœ‰ç”¨ã€‚</p><h4 id="ä¸¾ä¸ªä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¸ªä¾‹å­"><span>ä¸¾ä¸ªä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ä½ çš„åº”ç”¨ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ¨¡å—ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·ç™»å½•çš„æ“ä½œã€‚ä½ å¯èƒ½å¸Œæœ›åœ¨æ¯æ¬¡ç”¨æˆ·å°è¯•ç™»å½•æ—¶éƒ½è®°å½•ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·åå’Œç™»å½•æ˜¯å¦æˆåŠŸã€‚</p><p>é¦–å…ˆï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ªè¯Šæ–­é€šé“æ¥å‘å¸ƒç™»å½•å°è¯•äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> loginAttemptChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">user-login-attempt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¸€ä¸ªç”¨æˆ·å°è¯•ç™»å½•æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªé€šé“å‘é€äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onUserLoginAttempt</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> success</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  loginAttemptChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;"> username</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> success</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœæƒ³è¦ç›‘æ§è¿™äº›ç™»å½•å°è¯•ï¼Œä½ å¯ä»¥è®¢é˜…è¿™ä¸ªé€šé“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> loginAttemptSubscriber</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">ç”¨æˆ· </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">username</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> å°è¯•ç™»å½•ã€‚ç»“æœï¼š</span><span style="color:#81A1C1;">${</span></span>
<span class="line"><span style="color:#D8DEE9;">      message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">success</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">æˆåŠŸ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">å¤±è´¥</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">    }</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">loginAttemptChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">loginAttemptSubscriber</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éšåï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œå¦‚æœä½ å†³å®šä¸å†éœ€è¦è¿™ä¸ªè®¢é˜…ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æƒ³å†æ¥æ”¶è¿™äº›ç™»å½•å°è¯•çš„é€šçŸ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>unsubscribe</code> æ–¹æ³•æ¥åœæ­¢æ¥æ”¶äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">loginAttemptChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unsubscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">loginAttemptSubscriber</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå³ä½¿ <code>onUserLoginAttempt</code> å‡½æ•°ç»§ç»­å‘å¸ƒäº‹ä»¶åˆ° <code>loginAttemptChannel</code>ï¼Œç”±äºä½ å·²ç»å–æ¶ˆäº† <code>loginAttemptSubscriber</code> çš„è®¢é˜…ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå†æ¥æ”¶åˆ°ä»»ä½•æ¶ˆæ¯ï¼Œä¹Ÿå°±ä¸ä¼šæ‰“å°å‡ºç™»å½•å°è¯•çš„ä¿¡æ¯äº†ã€‚</p><h4 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“ï¼š</span></a></h4><ul><li>åˆ›å»ºè¯Šæ–­é€šé“ï¼Œç”¨æ¥å‘å¸ƒç‰¹å®šç±»å‹çš„äº‹ä»¶ã€‚</li><li>è®¢é˜…è¿™ä¸ªé€šé“ï¼Œæ¥ç›‘å¬è¿™äº›äº‹ä»¶å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</li><li>ä½¿ç”¨ <code>unsubscribe</code> æ–¹æ³•æ¥å–æ¶ˆç‰¹å®šçš„è®¢é˜…è€…ã€‚</li></ul><p>ä½¿ç”¨ <code>tracingChannel.unsubscribe(subscribers)</code> æ–¹æ³•ï¼Œä½ å¯ä»¥ç¡®ä¿å½“ä½ ä¸å†éœ€è¦æŸäº›ä¿¡æ¯æ—¶ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¸ä¼šç»§ç»­æ¥æ”¶é‚£äº›å¯èƒ½å¯¹æ€§èƒ½æœ‰å½±å“çš„é¢å¤–æ•°æ®ã€‚</p><h4 id="tracingchannel-tracesync-fn-context-thisarg-args" tabindex="-1"><a class="header-anchor" href="#tracingchannel-tracesync-fn-context-thisarg-args"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#tracingchanneltracesyncfn-context-thisarg-args" target="_blank" rel="noopener noreferrer">tracingChannel.traceSync(fn[, context[, thisArg[, ...args]]])</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚<code>tracingChannel.traceSync</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªé«˜çº§åŠŸèƒ½ï¼Œç”¨äºç›‘æ§å’Œè¯Šæ–­ç¨‹åºçš„æ€§èƒ½é—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>tracingChannel</code>ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>diagnostics_channel</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªåç§°ä¸º <code>tracingChannel</code> çš„ç‰¹æ®Šé€šé“ï¼ˆchannelï¼‰ï¼Œå…è®¸å¼€å‘è€…å‘å¸ƒï¼ˆemitï¼‰å’Œè®¢é˜…ï¼ˆsubscribeï¼‰åˆ°åº”ç”¨ç¨‹åºä¸­çš„å„ç§äº‹ä»¶ã€‚è¿™æœ‰åŠ©äºè·Ÿè¸ªå’Œè¯Šæ–­åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ <code>tracingChannel.traceSync</code> è¿™ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>fn</code>: è¿™æ˜¯ä½ æƒ³è¦è¿½è¸ªæ‰§è¡Œæ—¶é—´çš„å‡½æ•°ã€‚</li><li><code>context</code>: ï¼ˆå¯é€‰ï¼‰å¦‚æœä½ çš„å‡½æ•°éœ€è¦ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆå³ <code>this</code> çš„å€¼ï¼‰ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°ä¼ å…¥ã€‚</li><li><code>thisArg</code>: ï¼ˆå¯é€‰ï¼‰å½“ä½ è°ƒç”¨ <code>fn</code> æ—¶ï¼Œç”¨ä½œ <code>this</code> çš„å€¼ã€‚</li><li><code>...args</code>: ï¼ˆå¯é€‰ï¼‰ä½ å¯ä»¥ä¼ é€’ä»»ä½•æ•°é‡çš„å‚æ•°ç»™å‡½æ•° <code>fn</code>ã€‚</li></ul><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥åŒæ­¥åœ°è¿½è¸ªä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ªå°è£…äº†è®¡æ—¶å™¨çš„å‡½æ•°è°ƒç”¨ï¼Œå¸®åŠ©ä½ æµ‹é‡å‡½æ•°æ‰§è¡Œéœ€è¦å¤šå°‘æ—¶é—´ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾ä¸¤ä¸ªä¾‹å­æ¥ç†è§£è¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨ï¼š</p><h3 id="ç¤ºä¾‹-1-è·Ÿè¸ªä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è·Ÿè¸ªä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°"><span>ç¤ºä¾‹ 1ï¼šè·Ÿè¸ªä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> tracingChannel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> myFunction</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›å¤æ‚çš„åŒæ­¥æ“ä½œ</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 1000000</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ tracingChannel.traceSync æ¥è·Ÿè¸ª myFunction çš„æ‰§è¡Œæ—¶é—´</span></span>
<span class="line"><span style="color:#D8DEE9;">tracingChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">traceSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myFunction</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>myFunction</code> å‡½æ•°ï¼Œå®ƒæœ‰ä¸€äº›è€—æ—¶çš„åŒæ­¥æ“ä½œã€‚ç„¶åæˆ‘ä»¬ç”¨ <code>tracingChannel.traceSync</code> æ¥è·Ÿè¸ªè¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚è¯¥æ–¹æ³•ä¼šç«‹å³æ‰§è¡Œ <code>myFunction</code> å¹¶è¿”å›å…¶ç»“æœï¼ŒåŒæ—¶è®°å½•ä¸‹æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´ã€‚</p><h3 id="ç¤ºä¾‹-2-è·Ÿè¸ªä¸€ä¸ªæœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è·Ÿè¸ªä¸€ä¸ªæœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°"><span>ç¤ºä¾‹ 2ï¼šè·Ÿè¸ªä¸€ä¸ªæœ‰å‚æ•°çš„åŒæ­¥å‡½æ•°</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> tracingChannel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ tracingChannel.traceSync æ¥è·Ÿè¸ª add å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œå¹¶ä¼ é€’å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tracingChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">traceSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">add</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">The result of adding 5 and 3 is </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">result</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå« <code>add</code> çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚æˆ‘ä»¬ä½¿ç”¨ <code>tracingChannel.traceSync</code> æ¥è·Ÿè¸ªè¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œå¹¶é€šè¿‡ <code>...args</code> å‚æ•°ä¼ é€’äº† <code>5</code> å’Œ <code>3</code> ç»™ <code>add</code> å‡½æ•°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æµ‹é‡å‡½æ•°æ‰§è¡Œçš„æ—¶é—´ï¼ŒåŒæ—¶å¾—åˆ°è°ƒç”¨ç»“æœã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨å®é™…çš„ Node.js åº”ç”¨ç¨‹åºä¸­ï¼Œæ­¤æ–¹æ³•ä¸»è¦ç”¨äºè°ƒè¯•å’Œä¼˜åŒ–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå¯èƒ½æ¶‰åŠæ›´å¤šçš„é…ç½®æ­¥éª¤ï¼Œä¾‹å¦‚è®¾ç½®ç›‘å¬å™¨æ¥è®°å½•å’Œåˆ†æè¿½è¸ªæ•°æ®ã€‚ä½†å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œé‡ç‚¹æ˜¯ç†è§£ <code>tracingChannel.traceSync</code> æ–¹æ³•å¦‚ä½•å¸®åŠ©å¼€å‘è€…æµ‹é‡å‡½æ•°æ‰§è¡Œçš„åŒæ­¥æ—¶é—´ã€‚</p><h4 id="tracingchannel-tracepromise-fn-context-thisarg-args" tabindex="-1"><a class="header-anchor" href="#tracingchannel-tracepromise-fn-context-thisarg-args"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#tracingchanneltracepromisefn-context-thisarg-args" target="_blank" rel="noopener noreferrer">tracingChannel.tracePromise(fn[, context[, thisArg[, ...args]]])</a></span></a></h4><p><code>tracingChannel.tracePromise()</code> æ˜¯ Node.js ä¸­ <code>diagnostics_channel</code> æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ¨¡å—ç”¨äºä¸ºåº”ç”¨ç¨‹åºå’Œåº“æä¾›ä¸€ç§å‘å¸ƒå’Œè®¢é˜…è¯Šæ–­æ•°æ®çš„æ–¹æ³•ã€‚<code>tracePromise()</code> æ–¹æ³•ç‰¹åˆ«ç”¨äºè·Ÿè¸ªå¼‚æ­¥å‡½æ•°ï¼ˆè¿”å› Promise çš„å‡½æ•°ï¼‰çš„æ‰§è¡Œã€‚</p><p>åœ¨è¯¦ç»†è§£é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€äº›æ¦‚å¿µï¼š</p><ul><li><strong>å¼‚æ­¥å‡½æ•°ï¼ˆAsync Functionï¼‰</strong>ï¼šJavaScript ä¸­ï¼Œä¸€ä¸ªé€šè¿‡ <code>async</code> å…³é”®å­—å®šä¹‰çš„å‡½æ•°ï¼Œæˆ–è€…ä»»ä½•è¿”å› <code>Promise</code> å¯¹è±¡çš„å‡½æ•°ã€‚è¿™ç±»å‡½æ•°çš„è°ƒç”¨ä¸ä¼šç«‹å³è¿”å›ç»“æœï¼Œè€Œæ˜¯åœ¨å°†æ¥æŸä¸ªæ—¶é—´ç‚¹è§£æï¼ˆresolveï¼‰æˆ–æ‹’ç»ï¼ˆrejectï¼‰ä¸€ä¸ªå€¼ã€‚</li><li><strong>Promise</strong>ï¼šJavaScript ä¸­è¡¨ç¤ºå¼‚æ­¥æ“ä½œæœ€ç»ˆå®Œæˆæˆ–å¤±è´¥çš„å¯¹è±¡ã€‚</li><li><strong>Context</strong>ï¼šåœ¨ç¼–ç¨‹ä¸­ï¼Œä¸Šä¸‹æ–‡é€šå¸¸æŒ‡çš„æ˜¯å½“å‰çŠ¶æ€æˆ–ç¯å¢ƒä¿¡æ¯ï¼Œå®ƒå¯ä»¥åŒ…å«å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰ï¼Œæœ‰åŠ©äºå‡½æ•°æ‰§è¡Œæ—¶å¯¹å…¶ç¯å¢ƒæœ‰æ‰€äº†è§£ã€‚</li><li><strong>thisArg</strong> å’Œ <code>...args</code>ï¼šè¿™äº›å‚æ•°ç”¨äºæŒ‡å®šè°ƒç”¨å¼‚æ­¥å‡½æ•°æ—¶çš„ <code>this</code> å€¼ï¼ˆå³å‡½æ•°å†…çš„ <code>this</code> åº”è¯¥æŒ‡å‘ä»€ä¹ˆï¼‰å’Œå…¶ä»–ä¼ é€’ç»™è¯¥å‡½æ•°çš„å‚æ•°ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ <code>tracingChannel.tracePromise(fn[, context[, thisArg[, ...args]]])</code> å…·ä½“åšäº†ä»€ä¹ˆï¼š</p><ol><li><code>fn</code>: è¿™æ˜¯ä½ æƒ³è¦è·Ÿè¸ªçš„å¼‚æ­¥å‡½æ•°ã€‚</li><li><code>context</code>: ä¸€ä¸ªå¯é€‰å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸è¢«è·Ÿè¸ªå‡½æ•°è°ƒç”¨ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li><li><code>thisArg</code>: å¯é€‰å‚æ•°ï¼Œç”¨äºç»‘å®šåˆ° <code>fn</code> å‡½æ•°çš„ <code>this</code> å€¼ã€‚</li><li><code>...args</code>: å¯ä»¥ä¼ é€’ç»™ <code>fn</code> å‡½æ•°çš„é¢å¤–å‚æ•°ã€‚</li></ol><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç›‘è§†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå®ƒä¼šè‡ªåŠ¨è®°å½•å‡½æ•°ä½•æ—¶å¼€å§‹æ‰§è¡Œ(<code>before</code>)ï¼Œä½•æ—¶ç»“æŸ(<code>after</code>)ï¼Œä»¥åŠæ˜¯å¦æœ‰é”™è¯¯æŠ›å‡º(<code>error</code>)ã€‚è¿™æœ‰åŠ©äºç†è§£ç³»ç»Ÿçš„æ€§èƒ½å’Œè¡Œä¸ºï¼Œå°¤å…¶å¯¹äºè¯Šæ–­é—®é¢˜å’Œæ€§èƒ½åˆ†æéå¸¸æœ‰ä»·å€¼ã€‚</p><p>ç°åœ¨ï¼Œä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>tracingChannel.tracePromise()</code>ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>fetchData</code>ï¼Œè¯¥å‡½æ•°ä»ç½‘ç»œè·å–ä¸€äº›æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tracingChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-tracing-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">//æ¥æºï¼šdoc.cherrychat.org è¯·å‹¿å•†ç”¨</span></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> fetchData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹Ÿä»ç½‘è·¯è·å–æ•°æ®çš„å»¶è¿Ÿ</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">        resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾è·å–æ•°æ®æˆåŠŸ</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">        reject</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Invalid URL</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾URLæ— æ•ˆå¯¼è‡´æ•°æ®è·å–å¤±è´¥</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ tracePromise æ¥è·Ÿè¸ª fetchData å‡½æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">tracingChannel</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">tracePromise</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    fetchData</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> description</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Fetching data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    null</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Fetched data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error fetching data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜… my-tracing-channel é€šé“çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">tracingChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">before</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Starting async operation: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">description</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">after</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Completed async operation: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">description</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      `</span><span style="color:#A3BE8C;">Error during async operation: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">description</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>diagnostics_channel</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>my-tracing-channel</code> çš„é€šé“ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>fetchData</code> å¼‚æ­¥å‡½æ•°ï¼Œå®ƒä¼šæ ¹æ®æä¾›çš„ URL è¿”å›æ•°æ®æˆ–æŠ›å‡ºé”™è¯¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ <code>tracePromise</code> æ¥è·Ÿè¸ª <code>fetchData</code> å‡½æ•°çš„æ‰§è¡Œæƒ…å†µï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡æè¿°ã€‚æœ€åï¼Œæˆ‘ä»¬è®¢é˜…äº† <code>my-tracing-channel</code>ï¼Œä»¥ä¾¿åœ¨ <code>fetchData</code> æ‰§è¡Œå‰åå’Œé‡åˆ°é”™è¯¯æ—¶æ‰“å°ç›¸åº”çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ç›‘æ§ä½ çš„å¼‚æ­¥å‡½æ•°ä½•æ—¶å¼€å§‹æ‰§è¡Œï¼Œä½•æ—¶å®Œæˆï¼Œä»¥åŠæ˜¯å¦æœ‰ä»»ä½•å¼‚å¸¸å‘ç”Ÿï¼Œä»è€Œæ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä½ çš„åº”ç”¨ç¨‹åºã€‚</p><h4 id="tracingchannel-tracecallback-fn-position-context-thisarg-args" tabindex="-1"><a class="header-anchor" href="#tracingchannel-tracecallback-fn-position-context-thisarg-args"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#tracingchanneltracecallbackfn-position-context-thisarg-args" target="_blank" rel="noopener noreferrer">tracingChannel.traceCallback(fn, position, context, thisArg, ...args)</a></span></a></h4><p>Node.js çš„ <code>diagnostics_channel</code> æ¨¡å—æä¾›äº†ä¸€ç§å‘å¸ƒå’Œè®¢é˜…åº”ç”¨ç¨‹åºä¸­çš„è‡ªå®šä¹‰äº‹ä»¶æˆ–çŠ¶æ€å˜åŒ–çš„èƒ½åŠ›ï¼Œè¿™åœ¨è°ƒè¯•å’Œç›‘æ§åº”ç”¨ç¨‹åºè¡Œä¸ºæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>tracingChannel.traceCallback(fn, position, context, thisArg, ...args)</code> æ˜¯ <code>diagnostics_channel</code> æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå…è®¸ä½ è¿½è¸ªå›è°ƒå‡½æ•°çš„æ‰§è¡Œã€‚</p><p>è¿™ä¸ªæ–¹æ³•çš„å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li><code>fn</code>ï¼šè¢«è¿½è¸ªçš„å›è°ƒå‡½æ•°ã€‚</li><li><code>position</code>ï¼šå›è°ƒå‡½æ•°åœ¨è¿½è¸ªé¢‘é“ä¸­çš„ä½ç½®æ ‡è¯†ï¼Œé€šå¸¸æ˜¯å­—ç¬¦ä¸²ã€‚</li><li><code>context</code>ï¼šè¿½è¸ªä¸Šä¸‹æ–‡ï¼Œå¯ä»¥åŒ…å«å…³äºå½“å‰æ“ä½œçš„é¢å¤–ä¿¡æ¯ã€‚</li><li><code>thisArg</code>ï¼šå½“è°ƒç”¨ <code>fn</code> æ—¶ï¼Œå®ƒåº”è¯¥ç»‘å®šåˆ°çš„ <code>this</code> å€¼ã€‚</li><li><code>...args</code>ï¼šä¼ é€’ç»™ <code>fn</code> çš„å‚æ•°åˆ—è¡¨ã€‚</li></ul><p>ä½¿ç”¨ <code>tracingChannel.traceCallback</code> æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨å›è°ƒå‡½æ•°æ‰§è¡Œå‰åå‘é€è¿½è¸ªä¿¡æ¯ï¼Œè¿™æ ·ä½ å°±èƒ½æ›´å¥½åœ°ç†è§£å’Œåˆ†æç¨‹åºè¿è¡Œæ—¶çš„è¡Œä¸ºã€‚è¿™å¯¹äºæ€§èƒ½åˆ†æã€æ•…éšœè¯Šæ–­å’Œç†è§£å¤æ‚çš„å¼‚æ­¥æµç‰¹åˆ«æœ‰ä»·å€¼ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channelName</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tracingChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">channelName</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> myFunction</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åšä¸€äº›äº‹æƒ…...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç°åœ¨æˆ‘ä»¬æƒ³è¦è¿½è¸ªå›è°ƒå‡½æ•°çš„æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> traceData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> when</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> Date</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> otherInfo</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">something</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  tracingChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">traceCallback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">before-callback</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> traceData</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> this</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç„¶åæ­£å¸¸æ‰§è¡Œå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">  callback</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¹‹åå†æ¬¡è¿½è¸ª</span></span>
<span class="line"><span style="color:#D8DEE9;">  tracingChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">traceCallback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">after-callback</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> traceData</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> this</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜…è¿½è¸ªé¢‘é“</span></span>
<span class="line"><span style="color:#D8DEE9;">tracingChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Event &#39;</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">&#39; occurred with data:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨å®šä¹‰çš„å‡½æ•°å¹¶ä¼ å…¥ä¸€ä¸ªå›è°ƒ</span></span>
<span class="line"><span style="color:#88C0D0;">myFunction</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Callback is called.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>my-channel</code> çš„è¿½è¸ªé¢‘é“ï¼Œå¹¶åœ¨ <code>myFunction</code> å‡½æ•°ä¸­ç”¨ <code>tracingChannel.traceCallback</code> æ¥è¿½è¸ªä¸€ä¸ªå›è°ƒå‡½æ•°çš„æ‰§è¡Œã€‚æˆ‘ä»¬å°†å›è°ƒå‡½æ•°çš„æ‰§è¡Œç‚¹ï¼ˆ&#39;before-callback&#39; å’Œ &#39;after-callback&#39;ï¼‰ä»¥åŠä¸€äº›è¿½è¸ªä¸Šä¸‹æ–‡æ•°æ®å‘é€åˆ°è¿½è¸ªé¢‘é“ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>subscribe</code> æ–¹æ³•è®¢é˜…è¿™ä¸ªé¢‘é“ï¼Œä¸€æ—¦æœ‰è¿½è¸ªä¿¡æ¯å‘é€ï¼Œå°±ä¼šè§¦å‘è®¢é˜…å›è°ƒå¹¶è¾“å‡ºç›¸å…³ä¿¡æ¯ã€‚</p><p>é€šè¿‡è¿™æ ·çš„è¿½è¸ªæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è·å–å›è°ƒæ‰§è¡Œå‰åçš„æ—¶é—´æˆ³ã€æ‰§è¡Œç¯å¢ƒå’Œå…¶ä»–å¯èƒ½æœ‰ç”¨çš„ä¿¡æ¯ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬åˆ†æç¨‹åºçš„è¡Œä¸ºï¼Œæ‰¾å‡ºæ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆæˆ–è€…é”™è¯¯åŸå› ã€‚</p><h3 id="tracingchannel-channels" tabindex="-1"><a class="header-anchor" href="#tracingchannel-channels"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#tracingchannel-channels" target="_blank" rel="noopener noreferrer">TracingChannel Channels</a></span></a></h3><p>Node.js çš„ <code>diagnostics_channel</code> æ˜¯ä¸€ä¸ª Node.js æ ¸å¿ƒæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç§å‘å¸ƒå’Œè®¢é˜…è‡ªå®šä¹‰äº‹ä»¶çš„é«˜çº§ APIã€‚è¿™ä¸ªæ¨¡å—é€šå¸¸ç”¨äºç›‘æµ‹å’Œè¯Šæ–­è¿è¡Œä¸­çš„ Node.js åº”ç”¨ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­, <code>TracingChannel</code> æ˜¯ <code>diagnostics_channel</code> ä¸­çš„ä¸€ä¸ªç‰¹æ€§ã€‚</p><h3 id="tracingchannel-channels-1" tabindex="-1"><a class="header-anchor" href="#tracingchannel-channels-1"><span>TracingChannel Channels</span></a></h3><p><code>TracingChannel</code> channels å®é™…ä¸Šæ˜¯ä¸€ç»„é¢„å®šä¹‰çš„é€šé“ï¼ˆchannelsï¼‰ï¼Œé€šè¿‡å®ƒä»¬ï¼Œå†…éƒ¨çš„ Node.js æ“ä½œå¯ä»¥å¹¿æ’­ä¿¡æ¯ï¼Œå¼€å‘è€…å¯ä»¥è®¢é˜…è¿™äº›é€šé“ä»¥æ¥æ”¶ä¿¡æ¯ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿè¿½è¸ª Node.js åº”ç”¨ä¸­çš„ç‰¹å®šæ´»åŠ¨ï¼Œæ¯”å¦‚å¼‚æ­¥æ“ä½œçš„å¼€å§‹å’Œç»“æŸã€æ€§èƒ½ç“¶é¢ˆç­‰ã€‚</p><p>æ¯ä¸ª channel å¯¹åº”äº†ä¸€ç§ç‰¹å®šç±»å‹çš„äº‹ä»¶æˆ–åŠ¨ä½œã€‚ä½ å¯ä»¥æŠŠ channel ç†è§£ä¸ºä¸€ä¸ªå¹¿æ’­ç«™ï¼Œå½“æŸä»¶äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œå®ƒå°±ä¼šå‘é€ä¸€ä¸ªä¿¡å·ï¼Œè€Œæ‰€æœ‰å¯¹è¿™ä¸ªä¿¡å·æ„Ÿå…´è¶£çš„ç›‘å¬è€…éƒ½å¯ä»¥æ¥æ”¶åˆ°è¿™ä¸ªä¿¡å·å¹¶æ®æ­¤åšå‡ºå“åº”ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><ol><li><p><strong>ç›‘æ§ HTTP è¯·æ±‚ï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œä½ æƒ³è¦ç›‘æ§å‘ç”Ÿçš„ HTTP è¯·æ±‚ã€‚ä½ å¯ä»¥è®¢é˜…ä¸ HTTP è¯·æ±‚ç›¸å…³çš„ channelï¼Œæ¯å½“æœ‰è¯·æ±‚è¿›æ¥æ—¶ï¼Œä½ å°±ä¼šæ”¶åˆ°åŒ…å«è¯·æ±‚è¯¦ç»†ä¿¡æ¯çš„æ¶ˆæ¯ï¼Œç„¶åä½ å¯ä»¥è®°å½•è¿™äº›ä¿¡æ¯æˆ–è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> httpChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜… HTTP è¯·æ±‚äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">httpChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ”¶åˆ° HTTP è¯·æ±‚ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ€§èƒ½åˆ†æï¼š</strong></p><p>åœ¨ä¸€ä¸ªå¤æ‚çš„åº”ç”¨ä¸­ï¼Œç†è§£å“ªäº›éƒ¨åˆ†æœ€è€—æ—¶è‡³å…³é‡è¦ã€‚é€šè¿‡è®¢é˜…ä¸æ€§èƒ½ç›¸å…³çš„ channelsï¼Œä½ å¯ä»¥å¾—åˆ°å‡½æ•°è°ƒç”¨æˆ–å¼‚æ­¥æ“ä½œæ‰€èŠ±è´¹æ—¶é—´çš„å…·ä½“æ•°æ®ï¼Œä»è€Œä¼˜åŒ–é‚£äº›ç“¶é¢ˆã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> performanceChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">performance</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">performanceChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ“ä½œåï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, è€—æ—¶ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">duration</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">æ¯«ç§’</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™é‡Œæœ‰ä¸€äº›ä»£ç ç”¨äºè®°å½•ä¸åŒæ“ä½œçš„æ€§èƒ½æŒ‡æ ‡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>é”™è¯¯è¿½è¸ªï¼š</strong></p><p>å½“ä½ çš„åº”ç”¨å‡ºç°é”™è¯¯æ—¶ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“æ˜¯åœ¨å“ªä¸ªéƒ¨åˆ†å‡ºç°çš„é—®é¢˜ã€‚é€šè¿‡è®¢é˜…ä¸é”™è¯¯ç›¸å…³çš„ channelï¼Œä½ å¯ä»¥åœ¨é”™è¯¯å‘ç”Ÿæ—¶ç«‹åˆ»å¾—åˆ°é€šçŸ¥ï¼Œå¹¶è·å–é”™è¯¯çš„å †æ ˆä¿¡æ¯ç­‰ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> errorChannel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">errorChannel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æ•è·åˆ°é”™è¯¯ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¿™é‡Œå¯èƒ½æœ‰ä¸€äº›å®¹æ˜“å‡ºé”™çš„ä»£ç </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç åªæ˜¯ç¤ºä¾‹ï¼Œå¯èƒ½å¹¶ä¸å®Œå…¨ç¬¦åˆ Node.js v21.7.1 ä¸­çš„ <code>TracingChannel</code> API çš„å®é™…ä½¿ç”¨æ–¹å¼ï¼Œå› ä¸ºè¿™äº› API å¯èƒ½ä¼šéšç‰ˆæœ¬å˜åŒ–è€Œæœ‰æ‰€ä¸åŒã€‚å»ºè®®æŸ¥é˜… Node.js å®˜æ–¹æ–‡æ¡£ä»¥è·å–æœ€æ–°å’Œæœ€å‡†ç¡®çš„ä¿¡æ¯ã€‚</p><h4 id="start-event" tabindex="-1"><a class="header-anchor" href="#start-event"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#startevent" target="_blank" rel="noopener noreferrer">start(event)</a></span></a></h4><p>Node.js ä¸­çš„ <code>diagnostics_channel</code> æ¨¡å—æ˜¯ä¸€ä¸ªå…è®¸ä½ åˆ›å»ºå‘½åé€šé“ï¼Œå¹¶é€šè¿‡è¿™äº›é€šé“å‘å¸ƒå’Œè®¢é˜…æ•°æ®çš„ APIï¼Œç”¨äºç›‘æµ‹å’Œè¯Šæ–­ä»£ç è¿è¡Œæ—¶çš„å„ç§äº‹ä»¶ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬çš„æ–‡æ¡£ä¸­ï¼Œ<code>start(event)</code> æ˜¯ <code>diagnostics_channel</code> æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ç”¨äºå¼€å§‹ç›‘å¬ç‰¹å®šçš„äº‹ä»¶ã€‚å½“ä½ è°ƒç”¨ <code>start(event)</code> æ—¶ï¼Œå¦‚æœè¿˜æ²¡æœ‰ç›‘å¬å™¨å…³æ³¨è¯¥äº‹ä»¶ï¼Œåˆ™ä¼šå¯åŠ¨å¯¹è¯¥äº‹ä»¶çš„ç›‘è§†ï¼›å¦‚æœå·²ç»æœ‰ç›‘å¬å™¨å­˜åœ¨ï¼Œåˆ™æ­¤è°ƒç”¨æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>start(event)</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªå‘½åé€šé“</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onEvent</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ”¶åˆ°æ¶ˆæ¯: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¼€å§‹ç›‘å¬ &#39;my-event&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">start</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬ &#39;my-event&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> onEvent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‘å¸ƒä¸€ä¸ª &#39;my-event&#39; äº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> payload</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>diagnostics_channel</code> æ¨¡å—ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>&#39;my-channel&#39;</code> çš„æ–°é€šé“ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•° <code>onEvent</code>ï¼Œå®ƒå°†æ‰“å°å‡ºå®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>start(&#39;my-event&#39;)</code> æ¥å‘ŠçŸ¥ Node.js æˆ‘ä»¬æƒ³è¦å¼€å§‹ç›‘å¬åä¸º <code>&#39;my-event&#39;</code> çš„äº‹ä»¶ã€‚è™½ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¹¶ä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨ <code>start()</code> æ–¹æ³•ï¼Œå› ä¸º <code>subscribe()</code> ä¼šè‡ªåŠ¨å¼€å§‹ç›‘è§†å®ƒæ‰€å…³æ³¨çš„äº‹ä»¶ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦åœ¨è¿˜æ²¡æœ‰ä»»ä½•ç›‘å¬å™¨çš„æƒ…å†µä¸‹é¢„å¯åŠ¨äº‹ä»¶ç›‘å¬ï¼Œä»¥é¿å…é”™è¿‡ä»»ä½•å¯èƒ½åœ¨æ·»åŠ ç›‘å¬å™¨ä¹‹å‰å°±å‘ç”Ÿçš„äº‹ä»¶ã€‚</p><p>ç„¶åæˆ‘ä»¬é€šè¿‡ <code>subscribe(&#39;my-event&#39;, onEvent)</code> è®© <code>onEvent</code> å‡½æ•°æˆä¸º <code>&#39;my-event&#39;</code> äº‹ä»¶çš„ä¸€ä¸ªç›‘å¬å™¨ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ <code>publish(&#39;my-event&#39;, { payload: &#39;Hello World!&#39; })</code> å‘å¸ƒ <code>&#39;my-event&#39;</code> äº‹ä»¶ï¼Œå¹¶ä¼ é€’äº†ä¸€ä¸ªåŒ…å«è‡ªå®šä¹‰ä¿¡æ¯çš„å¯¹è±¡ä½œä¸ºæ•°æ®è½½ä½“ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>start(event)</code> åœ¨ <code>diagnostics_channel</code> æ¨¡å—ä¸­çš„ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿æŸä¸ªäº‹ä»¶å¯ä»¥è¢«ç›‘å¬ï¼Œå³ä½¿åœ¨è¿˜æ²¡æœ‰ç›‘å¬å™¨çš„æƒ…å†µä¸‹ã€‚è¿™åœ¨éœ€è¦äº‹å…ˆæ•è·æ‰€æœ‰ç›¸å…³äº‹ä»¶çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚å®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥ä½¿ç”¨ <code>subscribe()</code> æ¥æ·»åŠ ç›‘å¬å™¨ï¼Œå®ƒä¹Ÿä¼šéšå¼åœ°å¼€å§‹ç›‘å¬ç›¸å…³çš„äº‹ä»¶ã€‚</p><h4 id="end-event" tabindex="-1"><a class="header-anchor" href="#end-event"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#endevent" target="_blank" rel="noopener noreferrer">end(event)</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œèƒ½è®©ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js çš„ä¼—å¤šåŠŸèƒ½ä¸­ï¼Œ<code>diagnostics_channel</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå®éªŒæ€§æ¨¡å—ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªå‘½åçš„é€šé“ï¼Œä»¥ä¾¿è·¨è¶Šæ¨¡å—è¾¹ç•Œä¼ é€’è¯Šæ–­ä¿¡æ¯ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>end(event)</code> æ˜¯ <code>diagnostics_channel</code> æ¨¡å—ä¸­ <code>Channel</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚ä¸»è¦ç”¨äºå‘å¸ƒä¸€æ¬¡æ€§äº‹ä»¶ï¼Œè¡¨æ˜æŸä¸ªå¼‚æ­¥æ“ä½œæˆ–èµ„æºçš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸã€‚</p><p>å½“ä½ è°ƒç”¨ <code>end(event)</code> æ–¹æ³•æ—¶ï¼Œæ‰€æœ‰è®¢é˜…äº†è¯¥é¢‘é“çš„ç›‘å¬å™¨éƒ½ä¼šæ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚è¿™å¯¹äºç›‘æ§å’Œè°ƒè¯•åº”ç”¨ç¨‹åºçš„ç‰¹å®šéƒ¨åˆ†éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è·Ÿè¸ª HTTP è¯·æ±‚çš„å¼€å§‹å’Œç»“æŸï¼Œæ•°æ®åº“æŸ¥è¯¢çš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>diagnostics_channel</code> æ¨¡å—ä¸­çš„ <code>end(event)</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// é¦–å…ˆï¼Œéœ€è¦å¼•å…¥ diagnostics_channel æ¨¡å—</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªæ–°çš„é€šé“ï¼Œå‘½åä¸º &#39;my-channel&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è®¢é˜…è¿™ä¸ªé€šé“ï¼Œä»¥ä¾¿å½“äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œå›è°ƒ</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Event received:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> event</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä»£è¡¨æŸç§èµ„æºæˆ–æ“ä½œçš„å¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> resource</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">databaseQuery</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  query</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SELECT * FROM users</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åœ¨èµ„æºçš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹æ—¶å‘å¸ƒä¸€ä¸ªäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resource</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ... åœ¨è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€äº›å¼‚æ­¥æ“ä½œ ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“èµ„æºçš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œä½¿ç”¨ end(event) å‘å¸ƒç»“æŸäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resource</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>diagnostics_channel</code> æ¨¡å—ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªé€šé“ <code>my-channel</code>ã€‚</li><li>ç„¶åæˆ‘ä»¬é€šè¿‡ <code>subscribe</code> æ–¹æ³•è®¾ç½®äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œç”¨äºæ¥æ”¶äº‹ä»¶å¹¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</li><li>æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ¨¡æ‹Ÿçš„èµ„æºå¯¹è±¡ <code>resource</code>ï¼Œä»£è¡¨ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ã€‚</li><li>é€šè¿‡è°ƒç”¨ <code>publish</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å‘å¸ƒäº†ä¸€ä¸ªè¡¨ç¤ºå¼€å§‹çš„äº‹ä»¶ã€‚</li><li>å‡æƒ³ä¸­çš„æ“ä½œæ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>end</code> æ–¹æ³•å‘å¸ƒäº†ä¸€ä¸ªè¡¨ç¤ºç»“æŸçš„äº‹ä»¶ã€‚</li></ol><p>è¿™æ ·çš„æœºåˆ¶ä½¿å¾—å¼€å‘è€…å¯ä»¥è¿½è¸ªå’Œè¯Šæ–­æ•´ä¸ªç³»ç»Ÿä¸­çš„ä¸åŒç»„ä»¶çš„çŠ¶æ€å’Œæ€§èƒ½é—®é¢˜ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äº <code>diagnostics_channel</code> æ˜¯ Node.js ä¸­çš„å®éªŒæ€§åŠŸèƒ½ï¼Œæ‰€ä»¥å®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ä¼šå‘ç”Ÿæ”¹å˜ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¹‹å‰ï¼Œå»ºè®®æ£€æŸ¥æœ€æ–°çš„æ–‡æ¡£ç¡®ä¿å…¼å®¹æ€§å’Œç¨³å®šæ€§ã€‚</p><h4 id="asyncstart-event" tabindex="-1"><a class="header-anchor" href="#asyncstart-event"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#asyncstartevent" target="_blank" rel="noopener noreferrer">asyncStart(event)</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ä¾§è¿è¡Œ JavaScript ä»£ç ã€‚<code>diagnostics_channel</code> æ˜¯ Node.js ä¸­ç”¨äºæä¾›ä¸€ç§å‘å¸ƒè®¢é˜…ï¼ˆpub/subï¼‰æ¨¡å¼æ¥ä¼ é€’è¯Šæ–­æ•°æ®çš„æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—å¯¹äºåº“å’Œåº”ç”¨ç¨‹åºå¼€å‘è€…éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥ç›‘æ§å’Œè°ƒè¯•ä»£ç çš„è¡Œä¸ºã€‚</p><p><code>asyncStart(event)</code> æ˜¯ <code>diagnostics_channel</code> æ¨¡å—ä¸­çš„åŠŸèƒ½ä¹‹ä¸€ã€‚è¿™ä¸ªæ–¹æ³•è¢«ç”¨æ¥é€šçŸ¥è®¢é˜…è€…å¼‚æ­¥æ“ä½œå·²ç»å¼€å§‹ã€‚åœ¨ Node.js çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ&quot;å¼‚æ­¥æ“ä½œ&quot;å¯èƒ½æ˜¯æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ Node.js ç¯å¢ƒä¸­æ‰§è¡Œè€Œä¸ä¼šç«‹å³å®Œæˆçš„ä»»åŠ¡ã€‚</p><p>å½“ä¸€ä¸ªå¼‚æ­¥æ“ä½œå¼€å§‹æ—¶ï¼Œä½¿ç”¨ <code>asyncStart(event)</code> æ–¹æ³•ä¼šå‘æ‰€æœ‰å¯¹ç‰¹å®šäº‹ä»¶æ„Ÿå…´è¶£çš„è®¢é˜…è€…å‘é€æ¶ˆæ¯ã€‚è¿™é‡Œçš„ <code>event</code> å¯¹è±¡åŒ…å«äº†å’Œå¼‚æ­¥æ“ä½œç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œå¹¶ä¸”ä½ æƒ³è¦ç›‘è§†æ‰€æœ‰å‘å‡ºçš„ HTTP è¯·æ±‚ä»¥ç¡®ä¿æ€§èƒ½å¹¶è°ƒè¯•é—®é¢˜ã€‚</p><h4 id="ç¬¬ä¸€æ­¥-åˆ›å»ºé¢‘é“" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ­¥-åˆ›å»ºé¢‘é“"><span>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¢‘é“</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª <code>diagnostics_channel</code> é¢‘é“ã€‚æ¯ä¸ªé¢‘é“éƒ½æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼Œç›¸å…³çš„å‘å¸ƒè€…å’Œè®¢é˜…è€…å°†é€šè¿‡è¿™ä¸ªæ ‡è¯†ç¬¦è¿›è¡Œé€šä¿¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http-request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¬¬äºŒæ­¥-ç›‘æ§å¼‚æ­¥æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒæ­¥-ç›‘æ§å¼‚æ­¥æ“ä½œ"><span>ç¬¬äºŒæ­¥ï¼šç›‘æ§å¼‚æ­¥æ“ä½œ</span></a></h4><p>ç°åœ¨ï¼Œä½ å¸Œæœ›åœ¨å‘é€ HTTP è¯·æ±‚æ—¶å‘é€ä¸€ä¸ªä¿¡å·è¡¨æ˜å¼‚æ­¥æ“ä½œå·²ç»å¼€å§‹ã€‚åœ¨å‘é€è¯·æ±‚çš„ä»£ç ä¸­ï¼Œä½ å¯ä»¥è°ƒç”¨ <code>asyncStart</code> æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> sendHttpRequest</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‘å¸ƒä¸€ä¸ªå¼‚æ­¥å¼€å§‹çš„ä¿¡å·</span></span>
<span class="line"><span style="color:#D8DEE9;">  channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">asyncStart</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> url</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> options</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å…¶ä½™çš„ HTTP è¯·æ±‚é€»è¾‘...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¬¬ä¸‰æ­¥-è®¢é˜…å¼‚æ­¥æ“ä½œäº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ­¥-è®¢é˜…å¼‚æ­¥æ“ä½œäº‹ä»¶"><span>ç¬¬ä¸‰æ­¥ï¼šè®¢é˜…å¼‚æ­¥æ“ä½œäº‹ä»¶</span></a></h4><p>åœ¨åˆ«çš„åœ°æ–¹ï¼Œä½ å¯èƒ½æƒ³è¦è®°å½•æ‰€æœ‰çš„ HTTP è¯·æ±‚æˆ–è€…è¿›è¡ŒæŸäº›å½¢å¼çš„ç›‘æ§ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦è®¢é˜…ä¹‹å‰åˆ›å»ºçš„é¢‘é“ï¼Œå¹¶å¤„ç†å¼‚æ­¥å¼€å§‹çš„äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">asyncStart</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Starting HTTP request to </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ¯å½“ <code>sendHttpRequest</code> å‡½æ•°è¢«è°ƒç”¨å¹¶ä¸”å‘å¸ƒäº† <code>asyncStart</code> äº‹ä»¶åï¼Œè®¢é˜…è€…å°±ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œå¹¶æ‰“å°å‡ºä¸€æ¡ä¿¡æ¯ï¼Œè¡¨æ˜ä¸€ä¸ªæ–°çš„ HTTP è¯·æ±‚å·²ç»å¼€å§‹ã€‚</p><p>è¿™æ ·ï¼Œä½¿ç”¨ <code>asyncStart</code> ä½ å°±èƒ½åœ¨å¼‚æ­¥æ“ä½œå¼€å§‹æ—¶å¾—åˆ°é€šçŸ¥äº†ã€‚ç±»ä¼¼åœ°ï¼Œ<code>diagnostics_channel</code> è¿˜æä¾›å…¶ä»–å·¥å…·æ¥å¸®åŠ©ä½ åœ¨å¼‚æ­¥æ“ä½œç»“æŸæ—¶ï¼ˆä½¿ç”¨ <code>asyncEnd</code>ï¼‰æˆ–è€…æœ‰ä»»ä½•å…¶ä»–éœ€è¦äº¤æµçš„è¯Šæ–­äº‹ä»¶æ—¶å‘é€å’Œæ¥æ”¶ä¿¡æ¯ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°ç†è§£å’Œç›‘æ§ä»–ä»¬çš„åº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚çš„å¼‚æ­¥æ“ä½œæ—¶ã€‚</p><h4 id="asyncend-event" tabindex="-1"><a class="header-anchor" href="#asyncend-event"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#asyncendevent" target="_blank" rel="noopener noreferrer">asyncEnd(event)</a></span></a></h4><p><code>asyncEnd(event)</code>æ˜¯ Node.js ä¸­è¯Šæ–­é¢‘é“ï¼ˆ<code>diagnostics_channel</code>ï¼‰æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„ç‰¹æ€§ï¼Œç”¨äºæä¾›ä¸€ç§å‘å¸ƒå’Œè®¢é˜…ç‰¹å®šäº‹ä»¶æˆ–è¡Œä¸ºçš„æ–¹æ³•ï¼Œä¾¿äºå¼€å‘è€…è¿›è¡Œè¯Šæ–­ã€è°ƒè¯•å’Œç›‘æ§åº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚å¼‚æ­¥æ“ä½œé€šå¸¸æ„å‘³ç€ä½ å¯åŠ¨äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†ä¸ä¼šç«‹å³ç­‰å¾…å®ƒå®Œæˆï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶é€šè¿‡å›è°ƒå‡½æ•°æ¥å¤„ç†ç»“æœã€‚è¿™æ ·å¯ä»¥ä½¿å¾— Node.js èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤§é‡å¹¶å‘æ“ä½œï¼Œå› ä¸ºå®ƒä¸éœ€è¦åœ¨æ¯ä¸ªæ“ä½œå®Œæˆå‰é˜»å¡æ‰§è¡Œã€‚</p><p>è€Œ<code>asyncEnd(event)</code>å‡½æ•°å°±æ˜¯åœ¨è¿™æ ·çš„å¼‚æ­¥æ“ä½œç»“æŸæ—¶è¢«è§¦å‘çš„ã€‚å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œå¦‚æœä½ æœ‰è®¢é˜…ç›¸å…³äº‹ä»¶ï¼Œä½ å¯ä»¥æ¥æ”¶åˆ°ä¸€ä¸ª<code>asyncEnd</code>äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œæˆ–ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šé€šè¿‡å‡ ä¸ªæ­¥éª¤è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><strong>1. å¼•å…¥<code>diagnostics_channel</code>æ¨¡å—ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2. åˆ›å»ºä¸€ä¸ªé¢‘é“ï¼š</strong></p><p>åˆ›å»ºä¸€ä¸ªåä¸º<code>my-channel</code>çš„é¢‘é“ï¼Œè¿™ä¸ªé¢‘é“å¯ä»¥ç”¨æ¥å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> channel</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">channel</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-channel</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>3. è®¢é˜…<code>asyncEnd</code>äº‹ä»¶ï¼š</strong></p><p>ç„¶åæˆ‘ä»¬å¯ä»¥è®¢é˜…è¿™ä¸ªé¢‘é“ä¸Šçš„<code>asyncEnd</code>äº‹ä»¶ã€‚è¿™æ„å‘³ç€æ¯å½“æœ‰äººåœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒ<code>asyncEnd</code>äº‹ä»¶æ—¶ï¼Œä¸‹é¢çš„å›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">subscribe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEnd</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">event</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">å¼‚æ­¥æ“ä½œç»“æŸï¼Œé™„å¸¦æ•°æ®: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">event</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. å‘å¸ƒ<code>asyncEnd</code>äº‹ä»¶ï¼š</strong></p><p>å½“ä¸€ä¸ªå¼‚æ­¥æ“ä½œç»“æŸæ—¶ï¼Œä½ å¯èƒ½æƒ³è¦é€šçŸ¥å…¶ä»–éƒ¨åˆ†çš„ä»£ç ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨é¢‘é“ä¸Šå‘å¸ƒ<code>asyncEnd</code>äº‹ä»¶æ¥å®ç°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> someAsyncOperation</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œä¾‹å¦‚è¯»å–æ–‡ä»¶ç­‰ï¼š</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå‘å¸ƒasyncEndäº‹ä»¶</span></span>
<span class="line"><span style="color:#D8DEE9;">    channel</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publish</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">asyncEnd</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">å¼‚æ­¥æ“ä½œå®Œæˆ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">æ“ä½œç»“æœ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œå¹¶ç›‘å¬ç»“æŸäº‹ä»¶ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">someAsyncOperation</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>someAsyncOperation</code>å‡½æ•°æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå½“æ“ä½œå®Œæˆæ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>channel.publish(&#39;asyncEnd&#39;, ...)</code>å‘å¸ƒäº†ä¸€ä¸ª<code>asyncEnd</code>äº‹ä»¶ï¼Œå¹¶ä¼ é€’äº†ä¸€äº›æ•°æ®ã€‚ä»»ä½•è®¢é˜…äº†è¿™ä¸ªäº‹ä»¶çš„åœ°æ–¹éƒ½ä¼šæ¥åˆ°é€šçŸ¥ï¼Œå¹¶å¯ä»¥æ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—ã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚</p><h4 id="error-event" tabindex="-1"><a class="header-anchor" href="#error-event"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#errorevent" target="_blank" rel="noopener noreferrer">error(event)</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js æä¾›äº†å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œä½¿å¾—ç¼–å†™ç½‘ç»œåº”ç”¨å˜å¾—å®¹æ˜“ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>diagnostics_channel</code> æ˜¯ Node.js çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç§å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼æ¥ä¼ é€’è¯Šæ–­æ•°æ®ã€‚è¿™ä¸ªæ¨¡å—ä¸»è¦æ˜¯ä¸ºäº†è®©åº“å’Œå·¥å…·çš„å¼€å‘è€…èƒ½å¤Ÿæ›´å¥½åœ°ç›‘æ§å’Œè°ƒè¯• Node.js åº”ç”¨ç¨‹åºã€‚</p><p><code>error(event)</code> æ˜¯ <code>diagnostics_channel</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªäº‹ä»¶ï¼Œå½“æŸäº›æ“ä½œè§¦å‘é”™è¯¯æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè¢«å‘å¸ƒã€‚</p><p>ä¸‹é¢ä»¥ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>diagnostics_channel</code> æ¨¡å—çš„ <code>error(event)</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> diagnostics_channel</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªåä¸º &#39;my-channel&#39; çš„é€šé“</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">### [</span><span style="color:#D8DEE9;">Built</span><span style="color:#81A1C1;">-in</span><span style="color:#D8DEE9;"> Channels</span><span style="color:#D8DEE9FF;">](</span><span style="color:#D8DEE9;">https</span><span style="color:#D8DEE9FF;">:</span><span style="color:#616E88;">//nodejs.org/docs/latest/api/diagnostics_channel.html#built-in-channels)</span></span>
<span class="line"><span style="color:#D8DEE9;">Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> çš„è¯Šæ–­é€šé“</span><span style="color:#D8DEE9FF;">ï¼ˆ</span><span style="color:#D8DEE9;">diagnostics_channel</span><span style="color:#D8DEE9FF;">ï¼‰</span><span style="color:#D8DEE9;">æ˜¯ä¸€ä¸ªåœ¨èŠ‚ç‚¹å†…éƒ¨ç”¨äºå‘å¸ƒå’Œè®¢é˜…ç‰¹å®šäº‹ä»¶æˆ–æ¶ˆæ¯çš„æ¨¡å—</span><span style="color:#D8DEE9FF;">ã€‚</span><span style="color:#D8DEE9;">è¿™ä¸ªåŠŸèƒ½å…è®¸å¼€å‘äººå‘˜ç›‘å¬å’Œå“åº”</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> å†…éƒ¨çš„å„ç§æ´»åŠ¨</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">æ¯”å¦‚</span><span style="color:#D8DEE9;"> HTTP</span><span style="color:#D8DEE9;"> è¯·æ±‚</span><span style="color:#D8DEE9FF;">ã€</span><span style="color:#D8DEE9;">æµæ“ä½œç­‰</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">è€Œä¸å¿…æ”¹å˜æ ¸å¿ƒ</span><span style="color:#D8DEE9;"> API</span><span style="color:#D8DEE9;"> çš„ä»£ç </span><span style="color:#D8DEE9FF;">ã€‚</span><span style="color:#D8DEE9;">è¿™å¯¹äºç›‘æ§å’Œè°ƒè¯•åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨</span><span style="color:#D8DEE9FF;">ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">ä»</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> v15</span><span style="color:#ECEFF4;">.</span><span style="color:#B48EAD;">1.0</span><span style="color:#D8DEE9;"> å¼€å§‹å¼•å…¥</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">å¹¶ä¸”éšç€åç»­ç‰ˆæœ¬ä¸æ–­å¾—åˆ°å¢å¼º</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> æ¨¡å—æä¾›äº†ä¸€ç§æœºåˆ¶</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">èƒ½å¤Ÿè®©ä½ åˆ›å»ºå‘½åçš„é€šé“</span><span style="color:#D8DEE9FF;">ï¼ˆ</span><span style="color:#D8DEE9;">channels</span><span style="color:#D8DEE9FF;">ï¼‰ï¼Œ</span><span style="color:#D8DEE9;">é€šè¿‡è¿™äº›é€šé“</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">ä»»ä½•éƒ¨åˆ†çš„åº”ç”¨æˆ–è€…åº“éƒ½å¯ä»¥å‘å¸ƒä¿¡æ¯</span><span style="color:#D8DEE9FF;">ï¼ˆ</span><span style="color:#D8DEE9;">ç§°ä¸ºæ¶ˆæ¯</span><span style="color:#D8DEE9FF;">ï¼‰ï¼Œ</span><span style="color:#D8DEE9;">è€Œå…¶ä»–éƒ¨åˆ†å¯ä»¥æ ¹æ®éœ€è¦è®¢é˜…è¿™äº›ä¿¡æ¯</span><span style="color:#D8DEE9FF;">ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">### </span><span style="color:#D8DEE9;">åŸºæœ¬ä½¿ç”¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">é¦–å…ˆ</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">ä½ å¯ä»¥é€šè¿‡</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">require</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> å¯¼å…¥</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> æ¨¡å—</span><span style="color:#D8DEE9FF;">ï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4;">```</span><span style="color:#A3BE8C;">javascript</span></span>
<span class="line"><span style="color:#A3BE8C;">const diagnosticsChannel = require(&#39;diagnostics_channel&#39;);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œå¯ä»¥åˆ›å»ºæˆ–è·å–ä¸€ä¸ªé€šé“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">#### [</span><span style="color:#D8DEE9;">HTTP</span><span style="color:#D8DEE9FF;">](</span><span style="color:#D8DEE9;">https</span><span style="color:#D8DEE9FF;">:</span><span style="color:#616E88;">//nodejs.org/docs/latest/api/diagnostics_channel.html#http)</span></span>
<span class="line"><span style="color:#D8DEE9;">Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> æ˜¯ä¸€ä¸ªåŸºäº</span><span style="color:#D8DEE9;"> Chrome</span><span style="color:#D8DEE9;"> V8</span><span style="color:#D8DEE9;"> å¼•æ“çš„</span><span style="color:#D8DEE9;"> JavaScript</span><span style="color:#D8DEE9;"> è¿è¡Œç¯å¢ƒ</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ</span><span style="color:#D8DEE9;"> JavaScript</span><span style="color:#D8DEE9FF;">ã€‚</span><span style="color:#D8DEE9;">HTTP</span><span style="color:#D8DEE9;"> åè®®æ˜¯ç”¨äºä»æœåŠ¡å™¨è·å–ä¿¡æ¯æˆ–å°†ä¿¡æ¯æäº¤åˆ°æœåŠ¡å™¨çš„åè®®ä¹‹ä¸€</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">åœ¨</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> ä¸­</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">ä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> æ¨¡å—æ¥åˆ›å»º</span><span style="color:#D8DEE9;"> HTTP</span><span style="color:#D8DEE9;"> æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</span><span style="color:#D8DEE9FF;">ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">åœ¨</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> v21</span><span style="color:#ECEFF4;">.</span><span style="color:#B48EAD;">7.1</span><span style="color:#D8DEE9;"> çš„æ–‡æ¡£ä¸­æåˆ°çš„</span><span style="color:#D8DEE9FF;">â€œ</span><span style="color:#D8DEE9;">HTTP</span><span style="color:#D8DEE9FF;">â€</span><span style="color:#D8DEE9;">éƒ¨åˆ†</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">å®é™…ä¸Šæ˜¯æŒ‡çš„</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> æ¨¡å—ä¸­ä¸</span><span style="color:#D8DEE9;"> HTTP</span><span style="color:#D8DEE9;"> ç›¸å…³çš„è¯Šæ–­é¢‘é“</span><span style="color:#D8DEE9FF;">ã€‚</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> æ˜¯</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> ä¸­çš„ä¸€ä¸ªè¾ƒæ–°çš„æ¨¡å—</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">å®ƒæä¾›äº†ä¸€ç§å‘å¸ƒå’Œè®¢é˜…è‡ªå®šä¹‰äº‹ä»¶çš„æœºåˆ¶</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">è¿™å¯¹äºç†è§£å’Œç›‘æ§åº”ç”¨ç¨‹åºçš„è¡Œä¸ºç‰¹åˆ«æœ‰å¸®åŠ©</span><span style="color:#D8DEE9FF;">ã€‚</span><span style="color:#D8DEE9;">è¿™ä¸ªæ¨¡å—ç‰¹åˆ«é€‚åˆç”¨äºå¼€å‘å·¥å…·å’Œåº“çš„ä½œè€…</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">å› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä»–ä»¬æ›´åŠ ç²¾ç»†åœ°ç›‘å¬å’Œè°ƒè¯•ä»–ä»¬çš„ä»£ç </span><span style="color:#D8DEE9FF;">ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">#### </span><span style="color:#D8DEE9;">å®é™…ä¾‹å­</span><span style="color:#D8DEE9FF;">ï¼š</span></span>
<span class="line"><span style="color:#D8DEE9;">å‡è®¾æˆ‘ä»¬æ­£åœ¨è¿è¡Œä¸€ä¸ª</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> HTTP</span><span style="color:#D8DEE9;"> æœåŠ¡å™¨</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">æˆ‘ä»¬æƒ³è¦ç›‘æ§ä½•æ—¶æœ‰è¯·æ±‚è¿›å…¥</span><span style="color:#D8DEE9FF;">ï¼Œ</span><span style="color:#D8DEE9;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">diagnostics_channel</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„</span><span style="color:#D8DEE9FF;">ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4;">```</span><span style="color:#A3BE8C;">javascript</span></span>
<span class="line"><span style="color:#A3BE8C;">const http = require(&#39;http&#39;);</span></span>
<span class="line"><span style="color:#A3BE8C;">const diagnostics_channel = require(&#39;diagnostics_channel&#39;);</span></span>
<span class="line"><span style="color:#A3BE8C;">const channel = diagnostics_channel.channel(&#39;http:request&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">// è®¢é˜… &#39;http:request&#39; é¢‘é“</span></span>
<span class="line"><span style="color:#A3BE8C;">channel.subscribe((message, name) =&gt; {</span></span>
<span class="line"><span style="color:#A3BE8C;">    console.log(</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;">æ”¶åˆ°æ¥è‡ª</span><span style="color:#D8DEE9;"> $</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9;"> çš„</span><span style="color:#D8DEE9;"> HTTP</span><span style="color:#D8DEE9;"> è¯·æ±‚</span><span style="color:#D8DEE9FF;">ï¼š</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">, message);</span></span>
<span class="line"><span style="color:#A3BE8C;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#A3BE8C;">http.createServer((req, res) =&gt; {</span></span>
<span class="line"><span style="color:#A3BE8C;">    // å‘å¸ƒä¸€ä¸ªäº‹ä»¶åˆ° &#39;http:request&#39; é¢‘é“</span></span>
<span class="line"><span style="color:#A3BE8C;">    channel.publish({</span></span>
<span class="line"><span style="color:#A3BE8C;">        url: req.url,</span></span>
<span class="line"><span style="color:#A3BE8C;">        method: req.method</span></span>
<span class="line"><span style="color:#A3BE8C;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">    res.writeHead(200, {&#39;Content-Type&#39;: &#39;text/plain&#39;});</span></span>
<span class="line"><span style="color:#A3BE8C;">    res.end(&#39;Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">&#39;);</span></span>
<span class="line"><span style="color:#A3BE8C;">}).listen(3000);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">console.log(&#39;Server running at http://127.0.0.1:3000/&#39;);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>http</code> å’Œ <code>diagnostics_channel</code> æ¨¡å—ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>diagnostics_channel.channel</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªåä¸º &#39;http:request&#39; çš„é¢‘é“ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>subscribe</code> æ–¹æ³•è®¢é˜…äº†è¿™ä¸ªé¢‘é“ï¼Œå½“æœ‰äº‹ä»¶å‘å¸ƒåˆ°è¿™ä¸ªé¢‘é“æ—¶ï¼Œè®¢é˜…çš„å›è°ƒå‡½æ•°ä¼šè¢«è§¦å‘ï¼Œè¾“å‡ºç›¸å…³ä¿¡æ¯ã€‚</p><p>åœ¨ HTTP æœåŠ¡å™¨çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>channel.publish</code> æ–¹æ³•å‘å¸ƒäº†ä¸€ä¸ªäº‹ä»¶ï¼Œè¯¥äº‹ä»¶åŒ…å«äº†å½“å‰ HTTP è¯·æ±‚çš„ URL å’Œæ–¹æ³•ï¼ˆæ¯”å¦‚ GET æˆ– POSTï¼‰ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¯åŠ¨äº†æœåŠ¡å™¨å¹¶ç›‘å¬æœ¬åœ°æœºå™¨çš„ 3000 ç«¯å£ã€‚</p><p>ç°åœ¨ï¼Œæ¯å½“æœ‰æ–°çš„ HTTP è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ç›¸å…³ä¿¡æ¯çš„è¾“å‡ºï¼Œè¿™å¯¹äºè¯Šæ–­é—®é¢˜å’Œç›‘æ§æœåŠ¡å™¨è¡Œä¸ºæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>diagnostics_channel</code> ä¸»è¦ç”¨äºåº“å’Œå·¥å…·ä½œè€…è¿›è¡Œåº•å±‚è°ƒè¯•ï¼Œå¹¶ä¸æ˜¯é€šå¸¸çš„åº”ç”¨å¼€å‘è€…ç»å¸¸éœ€è¦ä½¿ç”¨çš„åŠŸèƒ½ã€‚å¯¹äºå¤§å¤šæ•°å¼€å‘è€…è€Œè¨€ï¼Œç›´æ¥åˆ©ç”¨ <code>http</code> æ¨¡å—å¤„ç† HTTP è¯·æ±‚å’Œå“åº”å°±è¶³å¤Ÿäº†ã€‚</p><h4 id="net" tabindex="-1"><a class="header-anchor" href="#net"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#net" target="_blank" rel="noopener noreferrer">NET</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>net</code> æ¨¡å—æä¾›äº†ç”¨äºåº•å±‚ç½‘ç»œé€šä¿¡çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å»ºç«‹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ TCP æˆ– IPC é€šä¿¡ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œä½ æåˆ°çš„ &quot;NET&quot; é“¾æ¥å®é™…ä¸Šæ˜¯æŒ‡å‘ <code>diagnostics_channel</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªè¯¯å¯¼ã€‚<code>diagnostics_channel</code> æ¨¡å—å…è®¸å¼€å‘è€…åˆ›å»ºå‘½åçš„é€šé“ä»¥ä¼ é€’è¯Šæ–­ä¿¡æ¯ã€‚è€Œ <code>net</code> æ¨¡å—å¹¶ä¸ç›´æ¥å…³è”æ­¤å†…å®¹ã€‚</p><p>æˆ‘æ¥è§£é‡Šä¸‹ <code>net</code> æ¨¡å—çš„åŸºæœ¬ä½¿ç”¨ï¼š</p><h3 id="ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-tcp-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯"><span>ä¾‹å­ 1: åˆ›å»ºä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</span></a></h3><h4 id="tcp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#tcp-æœåŠ¡å™¨"><span>TCP æœåŠ¡å™¨</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª TCP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä»å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // å›é€ç›¸åŒçš„æ•°æ®ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„ 8000 ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ 8000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="tcp-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#tcp-å®¢æˆ·ç«¯"><span>TCP å®¢æˆ·ç«¯</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8000</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²è¿æ¥åˆ°æœåŠ¡å™¨</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ¥æ”¶ä»æœåŠ¡å™¨å›ä¼ çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ä»æœåŠ¡å™¨æ”¶åˆ°æ•°æ®ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å·²ä»æœåŠ¡å™¨æ–­å¼€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„ 8000 ç«¯å£ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ‰“å°æ¶ˆæ¯ï¼Œå¹¶ä¸”åœ¨æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®åï¼Œå°†åŒæ ·çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨åå‘é€ä¸€æ¡ä¿¡æ¯ï¼Œç„¶åæ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”å¹¶æ–­å¼€è¿æ¥ã€‚</p><p>è¯·æ³¨æ„ï¼ŒNode.js çš„æ–‡æ¡£ç»å¸¸æ›´æ–°ï¼Œç‰ˆæœ¬ä¹‹é—´å¯èƒ½å­˜åœ¨å˜åŒ–ï¼Œåœ¨ç¼–å†™ç¨‹åºæ—¶è¯·åŠ¡å¿…å‚è€ƒå¯¹åº”ç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ å¯¹å…¶ä»– Node.js çš„æ¨¡å—æˆ–æ¦‚å¿µè¿˜æœ‰ç–‘é—®ï¼Œéšæ—¶æ¬¢è¿æé—®ã€‚</p><h4 id="udp" tabindex="-1"><a class="header-anchor" href="#udp"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#udp" target="_blank" rel="noopener noreferrer">UDP</a></span></a></h4><p>Node.js ä¸­çš„ UDP æ¨¡å—å…è®¸ä½ é€šè¿‡ UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ç½‘ç»œåè®®æ¥å‘é€å’Œæ¥æ”¶æ•°æ®åŒ…ã€‚UDP æ˜¯ä¸€ä¸ªç®€å•çš„é¢å‘æ¶ˆæ¯çš„ä¼ è¾“å±‚åè®®ï¼Œä¸ TCP ç›¸æ¯”ï¼Œå®ƒä¸ä¿è¯æ¶ˆæ¯çš„é¡ºåºã€å¯é æ€§æˆ–æ•°æ®å®Œæ•´æ€§ã€‚è¿™å°±æ„å‘³ç€å®ƒé€šå¸¸ç”¨äºé‚£äº›å¯¹å®æ—¶æ€§æœ‰é«˜è¦æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚è§†é¢‘æµã€åœ¨çº¿æ¸¸æˆæˆ– DNS æŸ¥è¯¢ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>dgram</code>æ¨¡å—æä¾›äº† UDP é€šä¿¡çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªä½¿ç”¨ Node.js ä¸­ UDP æ¨¡å—çš„ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-åˆ›å»ºä¸€ä¸ª-udp-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-åˆ›å»ºä¸€ä¸ª-udp-æœåŠ¡å™¨"><span>ä¾‹å­ 1ï¼šåˆ›å»ºä¸€ä¸ª UDP æœåŠ¡å™¨</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &#39;udp4&#39; è¡¨ç¤ºIPv4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨å¼‚å¸¸ï¼š</span><span style="color:#EBCB8B;">\n</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> rinfo</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨æ”¶åˆ°ï¼š</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">msg</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> æ¥è‡ª </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">rinfo</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">rinfo</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">listening</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> address</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">æœåŠ¡å™¨ç›‘å¬ </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">:</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">address</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›‘å¬41234ç«¯å£</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">bind</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">41234</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª UDP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬æœ¬åœ° 41234 ç«¯å£ä¸Šçš„æ¶ˆæ¯ã€‚å½“æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šè¾“å‡ºæ¶ˆæ¯å†…å®¹å’Œå‘é€è€…çš„ä¿¡æ¯ã€‚</p><h3 id="ä¾‹å­-2-åˆ›å»ºä¸€ä¸ª-udp-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-åˆ›å»ºä¸€ä¸ª-udp-å®¢æˆ·ç«¯"><span>ä¾‹å­ 2ï¼šåˆ›å»ºä¸€ä¸ª UDP å®¢æˆ·ç«¯</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> message</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 41234</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¶ˆæ¯å·²å‘é€</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºä¸€ä¸ª UDP å®¢æˆ·ç«¯ï¼Œç„¶åå°†ä¸€æ¡æ¶ˆæ¯å‘é€åˆ°æœ¬åœ°çš„ 41234 ç«¯å£ã€‚å¦‚æœå‘é€æˆåŠŸï¼Œå®ƒä¼šæ‰“å°å‡º&quot;æ¶ˆæ¯å·²å‘é€&quot;ã€‚</p><h3 id="å®é™…è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨"><span>å®é™…è¿ç”¨ï¼š</span></a></h3><ol><li><strong>åœ¨çº¿æ¸¸æˆ</strong> - æ¸¸æˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä½¿ç”¨ UDP è¿›è¡Œå¿«é€Ÿã€å®æ—¶çš„æ•°æ®äº¤æ¢ã€‚</li><li><strong>è§†é¢‘ä¼šè®®ç³»ç»Ÿ</strong> - å®æ—¶ä¼ è¾“éŸ³é¢‘å’Œè§†é¢‘æµé€šå¸¸ä½¿ç”¨ UDPï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå‡å°‘å»¶è¿Ÿã€‚</li><li><strong>ç‰©è”ç½‘ (IoT) è®¾å¤‡</strong> - IoT è®¾å¤‡ä¹‹é—´ä¼ è¾“è½»é‡çº§å’Œå°å°ºå¯¸çš„æ•°æ®åŒ…ï¼Œç»å¸¸é€‰ç”¨ UDP æ¥èŠ‚çº¦èµ„æºã€‚</li></ol><p>è®°ä½ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äº UDP ä¸èƒ½ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œæ‰€ä»¥ä½ å¯èƒ½éœ€è¦åœ¨åº”ç”¨å±‚å®ç°é‡è¯•æœºåˆ¶ã€é¡ºåºå¤„ç†å’Œæ•°æ®éªŒè¯ç­‰åŠŸèƒ½æ¥ç¡®ä¿æ­£ç¡®æ€§ã€‚</p><h4 id="process" tabindex="-1"><a class="header-anchor" href="#process"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#process" target="_blank" rel="noopener noreferrer">Process</a></span></a></h4><p>Node.js ä¸­çš„ <code>process</code> å¯¹è±¡æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒæä¾›äº†å½“å‰è¿è¡Œçš„ Node.js è¿›ç¨‹çš„ä¿¡æ¯å’Œæ§åˆ¶èƒ½åŠ›ã€‚å¯ä»¥é€šè¿‡ <code>process</code> è®¿é—®åˆ°ç¯å¢ƒä¿¡æ¯ã€è¯»å–ç¯å¢ƒå˜é‡ã€ç®¡ç†è¿›ç¨‹çŠ¶æ€ã€ç›‘å¬è¿›ç¨‹äº‹ä»¶ç­‰ã€‚</p><p>ä¸‹é¢è¯¦ç»†è§£é‡Šä¸€äº› <code>process</code> å¯¹è±¡çš„å¸¸ç”¨åŠŸèƒ½ï¼Œå¹¶ç»™å‡ºå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p><strong>è®¿é—®ç¯å¢ƒå˜é‡</strong>ï¼š<code>process.env</code></p><p>ç¯å¢ƒå˜é‡é€šå¸¸ç”¨äºå­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€å¯†é’¥ç­‰ã€‚åœ¨ Node.js ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>process.env</code> æ¥è®¿é—®è¿™äº›å˜é‡ã€‚</p><p>ä¾‹å­ï¼š<br> å‡è®¾ä½ æœ‰ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>DATABASE_URL</code> å­˜å‚¨äº†æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">env</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">DATABASE_URL</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// è¾“å‡ºå¯èƒ½æ˜¯: &#39;postgres://user:password@localhost:5432/mydb&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¿›ç¨‹é€€å‡º</strong>ï¼š<code>process.exit()</code></p><p>å½“ä½ æƒ³è¦æ˜¾å¼åœ°ç»“æŸ Node.js è¿›ç¨‹æ—¶ï¼Œå¯ä»¥è°ƒç”¨ <code>process.exit()</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå¯é€‰çš„é€€å‡ºç å‚æ•°ï¼Œé»˜è®¤æ˜¯ <code>0</code> è¡¨ç¤ºæˆåŠŸï¼Œéé›¶å€¼é€šå¸¸è¡¨ç¤ºå‡ºç°é”™è¯¯ã€‚</p><p>ä¾‹å­ï¼š<br> å¦‚æœæ£€æµ‹åˆ°ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œä½ å¯èƒ½æƒ³è¦ç«‹å³é€€å‡ºç¨‹åºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">criticalErrorOccurred</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è·å–å‘½ä»¤è¡Œå‚æ•°</strong>ï¼š<code>process.argv</code></p><p>åœ¨ Node.js è„šæœ¬æ‰§è¡Œæ—¶ï¼Œä½ å¯ä»¥ä»å‘½ä»¤è¡Œä¼ é€’å‚æ•°ç»™å®ƒã€‚è¿™äº›å‚æ•°å¯ä»¥é€šè¿‡ <code>process.argv</code> æ•°ç»„è®¿é—®ã€‚</p><p>ä¾‹å­ï¼š<br> å‡è®¾ä½ è¿è¡Œäº† <code>node script.js arg1 arg2</code>ï¼Œé‚£ä¹ˆåœ¨ <code>script.js</code> ä¸­è®¿é—® <code>process.argv</code> å¯ä»¥å¾—åˆ°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> args</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">argv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">slice</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">args</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // [&#39;arg1&#39;, &#39;arg2&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç›‘å¬è¿›ç¨‹äº‹ä»¶</strong>ï¼šæ¯”å¦‚ <code>exit</code>, <code>uncaughtException</code></p><p>Node.js å…è®¸ä½ ç›‘å¬è¿›ç¨‹çš„ä¸åŒäº‹ä»¶ï¼Œæ¯”å¦‚å½“è¿›ç¨‹å°†è¦é€€å‡ºæ—¶ï¼Œæˆ–è€…æœªæ•è·çš„å¼‚å¸¸å‘ç”Ÿæ—¶ã€‚</p><p>ä¾‹å­ï¼š<br> ç›‘å¬ <code>exit</code> äº‹ä»¶æ¥ç¡®å®šè¿›ç¨‹ä½•æ—¶é€€å‡ºå¹¶è¿›è¡Œæ¸…ç†æ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">exit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">About to exit with code: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…æ•è·æœªå¤„ç†çš„å¼‚å¸¸ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">uncaughtException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An uncaught error occurred!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æµå’Œè¾“å…¥è¾“å‡º</strong>ï¼š<code>process.stdin</code>, <code>process.stdout</code>, <code>process.stderr</code></p><p><code>process</code> æä¾›äº†å¯¹æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼ˆstdin, stdout å’Œ stderrï¼‰çš„è®¿é—®ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›æµæ¥è¯»å–è¾“å…¥æ•°æ®æˆ–è¾“å‡ºä¿¡æ¯ã€‚</p><p>ä¾‹å­ï¼š<br> åˆ›å»ºä¸€ä¸ªç®€å•çš„äº¤äº’å¼å‘½ä»¤è¡Œåº”ç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">What is your name? </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdin</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">trim</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Hello </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exit</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å½“å‰å·¥ä½œç›®å½•</strong>ï¼š<code>process.cwd()</code></p><p><code>process.cwd()</code> ç”¨äºè¿”å› Node.js è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚è¿™å¯¹äºå¤„ç†æ–‡ä»¶è·¯å¾„å¾ˆæœ‰ç”¨ã€‚</p><p>ä¾‹å­ï¼š<br> è·å–å¹¶æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Current directory: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cwd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>å†…å­˜ä½¿ç”¨æƒ…å†µ</strong>ï¼š<code>process.memoryUsage()</code></p><p>æƒ³è¦ç›‘è§†åº”ç”¨çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ <code>process.memoryUsage()</code>ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº† Node.js è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ä¿¡æ¯ã€‚</p><p>ä¾‹å­ï¼š<br> æ‰“å°å‡ºå†…å­˜ä½¿ç”¨ä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> memoryUsage</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">memoryUsage</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">memoryUsage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>Node.js çš„ <code>process</code> å¯¹è±¡è¿˜æœ‰è®¸å¤šå…¶ä»–çš„å±æ€§ä¸æ–¹æ³•ï¼Œä¸Šè¿°åªæ˜¯æœ€å¸¸è§çš„ä¸€äº›ã€‚é€šå¸¸å®ƒä»¬ç”¨äºç³»ç»Ÿçº§åˆ«çš„æ“ä½œå’Œç¨‹åºçš„åŸºæœ¬æ§åˆ¶ã€‚åœ¨ç¼–å†™ Node.js åº”ç”¨æ—¶ï¼Œåˆç†ä½¿ç”¨ <code>process</code> å¯¹è±¡å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†ç¨‹åºè¡Œä¸ºå’Œèµ„æºã€‚</p><h4 id="worker-thread" tabindex="-1"><a class="header-anchor" href="#worker-thread"><span><a href="https://nodejs.org/docs/latest/api/diagnostics_channel.html#worker-thread" target="_blank" rel="noopener noreferrer">Worker Thread</a></span></a></h4><p>Node.js çš„ Worker Threadsï¼ˆå·¥ä½œçº¿ç¨‹ï¼‰æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åœ¨åå°æ‰§è¡Œ JavaScript ä»£ç ï¼Œè€Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚åœ¨å¤šæ ¸å¿ƒ CPU ä¸Šï¼Œè¿™å¯ä»¥å¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚è¿™ç±»ä¼¼äºåœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ Web Workersã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œä¸»çº¿ç¨‹é€šå¸¸ç”¨äºå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€æ“ä½œè¾“å…¥è¾“å‡º(IO)ç­‰ä»»åŠ¡ã€‚å½“æ¶‰åŠåˆ°è®¡ç®—å¯†é›†å‹æˆ–é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ—¶ï¼Œä¸»çº¿ç¨‹å¯èƒ½ä¼šè¢«é˜»å¡ï¼Œä»è€Œå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒWorker Threads åº”è¿è€Œç”Ÿã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-worker-threads" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-worker-threads"><span>å¦‚ä½•ä½¿ç”¨ Worker Threads</span></a></h3><p>è¦ä½¿ç”¨ Worker Threadsï¼Œä½ éœ€è¦å¯¼å…¥<code>worker_threads</code>æ¨¡å—ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„æ­¥éª¤æ¥åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼š</p><ol><li>å¯¼å…¥<code>worker_threads</code>æ¨¡å—ã€‚</li><li>ä½¿ç”¨<code>new Worker()</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Worker</code> å®ä¾‹ï¼Œå¹¶ä¼ é€’ä½ æƒ³åœ¨åå°è¿è¡Œçš„è„šæœ¬æˆ–è€…å‡½æ•°ã€‚</li><li>ä½¿ç”¨çˆ¶çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿæ¥äº¤æ¢ä¿¡æ¯ã€‚</li></ol><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼šå¯¹ä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„è¿›è¡Œæ’åºã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªä»»åŠ¡ç§»è‡³å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä»¥é¿å…ä¸»çº¿ç¨‹è¢«é•¿æ—¶é—´å æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parentPort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™éƒ¨åˆ†ä»£ç åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥å®Œæˆæ’åºä»»åŠ¡</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬ä»å·¥ä½œçº¿ç¨‹å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">sortedArray</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">sortedArray</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°æ’åºåçš„æ•°ç»„</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‘å·¥ä½œçº¿ç¨‹å‘é€è¦æ’åºçš„æ•°ç»„</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 6</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 4</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™éƒ¨åˆ†ä»£ç åœ¨å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç›‘å¬æ¥è‡ªçˆ¶çº¿ç¨‹çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">array</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    array</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¯¹æ•°ç»„è¿›è¡Œæ’åº</span></span>
<span class="line"><span style="color:#D8DEE9;">    parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">array</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æŠŠæ’åºåçš„æ•°ç»„é€å›çˆ¶çº¿ç¨‹</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬é€šè¿‡<code>__filename</code>å‘<code>Worker</code>æ„é€ å‡½æ•°ä¼ é€’å½“å‰æ–‡ä»¶åæ¥å‘Šè¯‰ Node.js æˆ‘ä»¬æƒ³åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡ŒåŒä¸€ä¸ªæ–‡ä»¶çš„ä»£ç ã€‚åœ¨å·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç ä¼šç›‘å¬æ¥è‡ªä¸»çº¿ç¨‹çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œæ’åºï¼Œç„¶åå°†æ’åºå¥½çš„æ•°ç»„å‘é€å›ä¸»çº¿ç¨‹ã€‚æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨<code>.sort()</code>æ–¹æ³•ä»…ä¸ºç¤ºä¾‹ï¼ŒçœŸå®åœºæ™¯ä¸­å¯èƒ½éœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„æ’åºé€»è¾‘ã€‚</p><p>å·¥ä½œçº¿ç¨‹çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œä½ å¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹æ¥å¹¶è¡Œå¤„ç†ä»»åŠ¡ã€‚ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ï¼Œä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½é€‚åˆæ”¾åœ¨å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œã€‚æ¯”å¦‚ï¼Œç®€å•çš„ I/O æ“ä½œé€šå¸¸ä¸éœ€è¦å·¥ä½œçº¿ç¨‹ï¼Œå› ä¸º Node.js çš„éé˜»å¡ I/O ç‰¹æ€§å·²ç»è¶³å¤Ÿé«˜æ•ˆã€‚</p><p>è¿˜è¦æ³¨æ„ï¼Œåœ¨ä½¿ç”¨å·¥ä½œçº¿ç¨‹çš„æ—¶å€™ï¼Œå¿…é¡»å°å¿ƒå¤„ç†çº¿ç¨‹é—´çš„é€šè®¯å’ŒçŠ¶æ€ç®¡ç†ï¼Œä»¥é¿å…ç«æ€æ¡ä»¶å’Œå…¶ä»–å¤šçº¿ç¨‹ç›¸å…³çš„é—®é¢˜ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Diagnostic report</div></a><a class="route-link auto-link next" href="/document/node-doc/DNS.html" aria-label="DNS"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">DNS<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.be370b10.js" defer></script><script src="/assets/js/4485.e6fe7c7b.js" defer></script><script src="/assets/js/app.bf6f64e3.js" defer></script>
  </body>
</html>
