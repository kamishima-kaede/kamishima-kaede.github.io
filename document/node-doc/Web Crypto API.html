<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Web%20Crypto%20API.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Web Crypto API"><meta property="og:description" content="Web Crypto API å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ Web Crypto APIã€‚ Node.js çš„ Web Crypto API æ˜¯ä»€ä¹ˆï¼Ÿ Web Crypto API æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ ‡å‡†ï¼Œå®ƒå…è®¸ä½ åœ¨ Web åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œä½çº§åˆ«çš„åŠ å¯†æ“ä½œã€‚è¿™äº›åŠ å¯†æ“ä½œå¯ä»¥åŒ…æ‹¬ä½†ä¸é™äºç”Ÿæˆå¯†é’¥ã€æ•£åˆ—æ•°æ®ã€ç­¾åå’ŒéªŒè¯ä¿¡æ¯ä»¥åŠåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚åœ¨..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Web Crypto API","description":"Web Crypto API å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ Web Crypto APIã€‚ Node.js çš„ Web Crypto API æ˜¯ä»€ä¹ˆï¼Ÿ Web Crypto API æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ ‡å‡†ï¼Œå®ƒå…è®¸ä½ åœ¨ Web åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œä½çº§åˆ«çš„åŠ å¯†æ“ä½œã€‚è¿™äº›åŠ å¯†æ“ä½œå¯ä»¥åŒ…æ‹¬ä½†ä¸é™äºç”Ÿæˆå¯†é’¥ã€æ•£åˆ—æ•°æ®ã€ç­¾åå’ŒéªŒè¯ä¿¡æ¯ä»¥åŠåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚åœ¨..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Web Crypto API | hanekawa-shiki</title><meta name="description" content="Web Crypto API å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ Web Crypto APIã€‚ Node.js çš„ Web Crypto API æ˜¯ä»€ä¹ˆï¼Ÿ Web Crypto API æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ ‡å‡†ï¼Œå®ƒå…è®¸ä½ åœ¨ Web åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œä½çº§åˆ«çš„åŠ å¯†æ“ä½œã€‚è¿™äº›åŠ å¯†æ“ä½œå¯ä»¥åŒ…æ‹¬ä½†ä¸é™äºç”Ÿæˆå¯†é’¥ã€æ•£åˆ—æ•°æ®ã€ç­¾åå’ŒéªŒè¯ä¿¡æ¯ä»¥åŠåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚åœ¨...">
    <link rel="stylesheet" href="/assets/css/styles.a84c0532.css">
    <link rel="preload" href="/assets/js/runtime~app.be370b10.js" as="script"><link rel="preload" href="/assets/css/styles.a84c0532.css" as="style"><link rel="preload" href="/assets/js/4485.e6fe7c7b.js" as="script"><link rel="preload" href="/assets/js/app.bf6f64e3.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Web Crypto API</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 245 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT245M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 73610 å­—</span><meta property="wordCount" content="73610"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-çš„-web-crypto-api-æ˜¯ä»€ä¹ˆ">Node.js çš„ Web Crypto API æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#examples">Examples</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#generating-keys">Generating keys</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ¦‚å¿µç®€ä»‹">1. æ¦‚å¿µç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä½¿ç”¨-node-js-ç”Ÿæˆå¯†é’¥">2. ä½¿ç”¨ Node.js ç”Ÿæˆå¯†é’¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å®é™…è¿ç”¨ä¾‹å­">3. å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aes-åŠ å¯†åŸºç¡€">AES åŠ å¯†åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-aes-å¯†é’¥">Node.js ä¸­çš„ AES å¯†é’¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-ecdsa-å¯†é’¥å¯¹">ä»€ä¹ˆæ˜¯ ECDSA å¯†é’¥å¯¹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdsa-å¯†é’¥å¯¹å¦‚ä½•å·¥ä½œ">ECDSA å¯†é’¥å¯¹å¦‚ä½•å·¥ä½œï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmac-keys-çš„ä½œç”¨">HMAC Keys çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-node-js-ä¸­ä½¿ç”¨-hmac-keys">åœ¨ Node.js ä¸­ä½¿ç”¨ HMAC Keys</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ç¤ºä¾‹">ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-rsa-å¯†é’¥å¯¹">ä»€ä¹ˆæ˜¯ RSA å¯†é’¥å¯¹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsa-å¯†é’¥å¯¹åœ¨-node-js-ä¸­çš„åº”ç”¨">RSA å¯†é’¥å¯¹åœ¨ Node.js ä¸­çš„åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#encryption-and-decryption">Encryption and decryption</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ç¤ºä¾‹-1">ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#exporting-and-importing-keys">Exporting and importing keys</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯†é’¥å¯¼å…¥å’Œå¯¼å‡ºçš„æ„ä¹‰">å¯†é’¥å¯¼å…¥å’Œå¯¼å‡ºçš„æ„ä¹‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#wrapping-and-unwrapping-keys">Wrapping and unwrapping keys</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-3">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sign-and-verify">Sign and verify</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç­¾åä¸éªŒè¯çš„è¿‡ç¨‹">ç­¾åä¸éªŒè¯çš„è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-4">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#deriving-bits-and-keys">Deriving bits and keys</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#digest">Digest</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦æ‘˜è¦">ä¸ºä»€ä¹ˆéœ€è¦æ‘˜è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­å¦‚ä½•ä½¿ç”¨-digest">Node.js ä¸­å¦‚ä½•ä½¿ç”¨ Digest</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-2">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#algorithm-matrix">Algorithm matrix</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-algorithm-matrix">ä»€ä¹ˆæ˜¯ Algorithm Matrix</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-crypto">Class: Crypto</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ç”Ÿæˆéšæœºå­—èŠ‚">1. ç”Ÿæˆéšæœºå­—èŠ‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åŠ å¯†å’Œè§£å¯†æ•°æ®">2. åŠ å¯†å’Œè§£å¯†æ•°æ®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼">3. è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#crypto-subtle">crypto.subtle</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åŠ å¯†å’Œè§£å¯†">1. åŠ å¯†å’Œè§£å¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -1">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-æ•°æ®ç­¾åå’ŒéªŒè¯">2. æ•°æ®ç­¾åå’ŒéªŒè¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -2">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#crypto-getrandomvalues-typedarray">crypto.getRandomValues(typedArray)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-typedarray">ç†è§£ typedArray</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-crypto-getrandomvalues-typedarray">ä½¿ç”¨ crypto.getRandomValues(typedArray)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹è¿ç”¨">å®ä¾‹è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆä½¿ç”¨-crypto-getrandomvalues-typedarray">ä¸ºä»€ä¹ˆä½¿ç”¨ crypto.getRandomValues(typedArray)ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#crypto-randomuuid">crypto.randomUUID()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#crypto-randomuuid-1">crypto.randomUUID()</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-cryptokey">Class: CryptoKey</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokeyçš„åŸºæœ¬æ¦‚å¿µ">CryptoKeyçš„åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-3">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokey-algorithm">cryptoKey.algorithm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokey-algorithm-1">cryptoKey.algorithm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokey-extractable">cryptoKey.extractable</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŠ å¯†å’Œå¯†é’¥">åŠ å¯†å’Œå¯†é’¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯†é’¥çš„å¯æå–æ€§-extractability">å¯†é’¥çš„å¯æå–æ€§ï¼ˆExtractabilityï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-6">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-4">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokey-type">cryptoKey.type</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokey-usages">cryptoKey.usages</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#web-åŠ å¯†-api-ç®€ä»‹">Web åŠ å¯† API ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯†é’¥ä½¿ç”¨åœºæ™¯">å¯†é’¥ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokey-usages-å±æ€§">cryptoKey.usages å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-cryptokeypair">Class: CryptoKeyPair</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…¬é’¥ä¸ç§é’¥">å…¬é’¥ä¸ç§é’¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-node-js-ä¸­å¦‚ä½•ä½¿ç”¨cryptokeypair">åœ¨ Node.js ä¸­å¦‚ä½•ä½¿ç”¨CryptoKeyPair</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokeypair-privatekey">cryptoKeyPair.privateKey</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokeypair-privatekey-1">cryptoKeyPair.privateKey</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokeypair-publickey">cryptoKeyPair.publicKey</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptokeypair-publickey-1">cryptoKeyPair.publicKey</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-subtlecrypto">Class: SubtleCrypto</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®æ¦‚å¿µ-1">å…³é”®æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨subtlecryptoçš„åœºæ™¯å’Œä¾‹å­">ä½¿ç”¨SubtleCryptoçš„åœºæ™¯å’Œä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-decrypt-algorithm-key-data">subtle.decrypt(algorithm, key, data)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-decrypt-çš„ç”¨é€”å’Œå·¥ä½œåŸç†">subtle.decrypt çš„ç”¨é€”å’Œå·¥ä½œåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­">ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-derivebits-algorithm-basekey-length">subtle.deriveBits(algorithm, baseKey, length)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-subtle-derivebits-algorithm-basekey-length">Node.js ä¸­çš„ subtle.deriveBits(algorithm, baseKey, length)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-derivekey-algorithm-basekey-derivedkeyalgorithm-extractable-keyusages">subtle.deriveKey(algorithm, baseKey, derivedKeyAlgorithm, extractable, keyUsages)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†-1">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-derivekey-è§£é‡Š">subtle.deriveKey() è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-1">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-digest-algorithm-data">subtle.digest(algorithm, data)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-subtle-digest-algorithm-data">ä»€ä¹ˆæ˜¯ subtle.digest(algorithm, data)ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-1">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-encrypt-algorithm-key-data">subtle.encrypt(algorithm, key, data)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬è§£é‡Š">åŸºæœ¬è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-5">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-exportkey-format-key">subtle.exportKey(format, key)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -5">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-generatekey-algorithm-extractable-keyusages">subtle.generateKey(algorithm, extractable, keyUsages)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®è·µä¾‹å­">å®è·µä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-importkey-format-keydata-algorithm-extractable-keyusages">subtle.importKey(format, keyData, algorithm, extractable, keyUsages)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‡½æ•°ç­¾å">å‡½æ•°ç­¾å</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®è·µä¾‹å­-1">å®è·µä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-sign-algorithm-key-data">subtle.sign(algorithm, key, data)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-1">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-7">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-unwrapkey-format-wrappedkey-unwrappingkey-unwrapalgo-unwrappedkeyalgo-extractable-keyusages">subtle.unwrapKey(format, wrappedKey, unwrappingKey, unwrapAlgo, unwrappedKeyAlgo, extractable, keyUsages)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£æ">å‚æ•°è§£æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-verify-algorithm-key-signature-data">subtle.verify(algorithm, key, signature, data)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³é”®æœ¯è¯­ç†è§£">å…³é”®æœ¯è¯­ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -6">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é‡è¦æ³¨æ„äº‹é¡¹">é‡è¦æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subtle-wrapkey-format-key-wrappingkey-wrapalgo">subtle.wrapKey(format, key, wrappingKey, wrapAlgo)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-2">å‚æ•°è§£é‡Šï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-8">å®é™…è¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#algorithm-parameters">Algorithm parameters</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¸¸è§çš„ç®—æ³•åŠå…¶å‚æ•°ä¸¾ä¾‹">å¸¸è§çš„ç®—æ³•åŠå…¶å‚æ•°ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-algorithmidentifier">Class: AlgorithmIdentifier</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£algorithmidentifier">ç†è§£AlgorithmIdentifier</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#algorithmidentifierçš„å½¢å¼">AlgorithmIdentifierçš„å½¢å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-algorithmidentifier">ç†è§£ algorithmIdentifier</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-name-å±æ€§å¾ˆé‡è¦">ä¸ºä»€ä¹ˆ name å±æ€§å¾ˆé‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-9">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-aescbcparams">Class: AesCbcParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aes-cbc-ç®€ä»‹">AES-CBC ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aescbcparams-ç±»">AesCbcParams ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-10">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aescbcparams-iv-è¯¦è§£">aesCbcParams.iv è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†-2">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aescbcparams-name-1">aesCbcParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-aesctrparams">Class: AesCtrParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-aes-ctr-åŠ å¯†">ä»€ä¹ˆæ˜¯ AES-CTR åŠ å¯†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aesctrparams-ç±»">AesCtrParams ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€ä»‹äº-aes-ctr-åŠ å¯†">ç®€ä»‹äº AES-CTR åŠ å¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aesctrparams-counter-1">aesCtrParams.counter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°ç‰¹æ€§">å‚æ•°ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-2">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-6">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-aes-ctr-åŠ å¯†">ç†è§£ AES-CTR åŠ å¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¸ªä¾‹å­">ä¸¾ä¸ªä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-aesgcmparams">Class: AesGcmParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-3">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aesgcmparams-additionaldata-1">aesGcmParams.additionalData</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-11">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŠ å¯†">åŠ å¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aes-gcm">AES-GCM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#iv-åˆå§‹åŒ–å‘é‡">IVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„aesgcmparams-iv">Node.js ä¸­çš„aesGcmParams.iv</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-1">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aesgcmparams-name-1">aesGcmParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-12">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-4">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#taglength">tagLength</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-aeskeygenparams">Class: AesKeyGenParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aeskeygenparams-ç®€ä»‹">AesKeyGenParams ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-13">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aeskeygenparams-length-çš„ä½œç”¨">aesKeyGenParams.length çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹-1">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µç†è§£">åŸºç¡€æ¦‚å¿µç†è§£ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aeskeygenparams-nameçš„ç”¨æ³•">aesKeyGenParams.nameçš„ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-14">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-7">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-ecdhkeyderiveparams">Class: EcdhKeyDeriveParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°">å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#web-åŠ å¯†-api">Web åŠ å¯† API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdh-elliptic-curve-diffie-hellman">ECDHï¼ˆElliptic Curve Diffie-Hellmanï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdhkeyderiveparams-name-1">ecdhKeyDeriveParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-2">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdhkeyderiveparams-public-è§£é‡Š">ecdhKeyDeriveParams.public è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-15">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-ecdsaparams">Class: EcdsaParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-5">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdsaparams-ç±»">EcdsaParams ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-node-js">ä»€ä¹ˆæ˜¯ Node.js?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-ecdsa">ä»€ä¹ˆæ˜¯ ECDSAï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-v21-7-1-ä¸­çš„ecdsaparams-hash">Node.js v21.7.1 ä¸­çš„ecdsaParams.hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-ecdsa-1">ä»€ä¹ˆæ˜¯ ECDSA?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdsaparams-name-åœ¨-node-js-ä¸­çš„ä½œç”¨">ecdsaParams.name åœ¨ Node.js ä¸­çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-eckeygenparams">Class: EcKeyGenParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¤­åœ†æ›²çº¿åŠ å¯†-ecc">æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-eckeygenparams">Node.js ä¸­çš„ EcKeyGenParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹">å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬è§£é‡Š-1">åŸºæœ¬è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-4">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#namedcurve-å±æ€§">namedCurve å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-13">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-eckeyimportparams">Class: EcKeyImportParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-3">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eckeyimportparams-è¯¦ç»†è§£é‡Š">EcKeyImportParams - è¯¦ç»†è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-16">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¤­åœ†æ›²çº¿åŠ å¯†-ecc-1">æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eckeyimportparams">ecKeyImportParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-6">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#namedcurve-å±æ€§-1">namedCurve å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-ed448params">Class: Ed448Params</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ed448-ç®€ä»‹">Ed448 ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-ed448params-1">Class: Ed448Params</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-17">å®é™…è¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-18">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-hkdfparams">Class: HkdfParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-4">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hkdfparams-è§£é‡Š">HkdfParams è§£é‡Šï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14">å®é™…è¿ç”¨ç¤ºä¾‹:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-5">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hkdfparams-hash-1">hkdfParams.hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-15">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-hkdf">ä»€ä¹ˆæ˜¯ HKDFï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hkdfparams-info-1">hkdfParams.info</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-19">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-6">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hkdfparams-name-1">hkdfParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-20">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-7">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„hkdfparams-salt">Node.js ä¸­çš„hkdfParams.salt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-1">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-hmacimportparams">Class: HmacImportParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-8">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmacimportparams-è¯¦è§£">HmacImportParams è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-9">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmacimportparams-hash-1">hmacImportParams.hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-16">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-8">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmacimportparams-length-1">hmacImportParams.length</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-9">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-hmac">ä»€ä¹ˆæ˜¯ HMACï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#web-crypto-api-1">Web Crypto API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmacimportparams-name-1">hmacImportParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-10">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-hmackeygenparams">Class: HmacKeyGenParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-7">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmackeygenparams-å‚æ•°è¯¦è§£">HmacKeyGenParams å‚æ•°è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-2">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-node-js">1. Node.js</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-web-crypto-api">2. Web Crypto API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-hmac-hash-based-message-authentication-code">3. HMAC (Hash-based Message Authentication Code)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmackeygenparams-hash-1">hmacKeyGenParams.hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-3">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-5">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmac-ç®€ä»‹">HMAC ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmackeygenparams-length-çš„ä½œç”¨">hmacKeyGenParams.length çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-17">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hmackeygenparams-name-1">hmacKeyGenParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-pbkdf2params">Class: Pbkdf2Params</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pbkdf2">PBKDF2</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#web-crypto-api-2">Web Crypto API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-pbkdf2params-1">Class: Pbkdf2Params</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-18">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-3">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#iterations-å‚æ•°çš„ä½œç”¨">iterations å‚æ•°çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-pbkdf2">ä»€ä¹ˆæ˜¯ PBKDF2ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pbkdf2params-nameçš„ä½œç”¨">pbkdf2Params.nameçš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-19">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-10">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pbkdf2-ç®€ä»‹">PBKDF2 ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pbkdf2params-salt-1">pbkdf2Params.salt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-21">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-rsahashedimportparams">Class: RsaHashedImportParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-22">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-11">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsahashedimportparams-hash-1">rsaHashedImportParams.hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-4">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-11">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#web-crypto-api-ç®€ä»‹">Web Crypto API ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsa-ç®€ä»‹">RSA ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsahashedimportparams-å¯¹è±¡">rsaHashedImportParams å¯¹è±¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsahashedimportparams-name-1">rsaHashedImportParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-23">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è¯­">ç»“è¯­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-rsahashedkeygenparams">Class: RsaHashedKeyGenParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-8">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsahashedkeygenparams">RsaHashedKeyGenParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨">å®é™…åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-12">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-4">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¦‚å¿µ">æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-6">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#web-åŠ å¯†-api-ç®€ä»‹-1">Web åŠ å¯† API ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsa-åŠ å¯†ç®—æ³•">RSA åŠ å¯†ç®—æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsahashedkeygenparams-1">rsaHashedKeyGenParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-20">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-9">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#publicexponent-è§£é‡Š">publicExponent è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-24">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-13">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-rsaoaepparams">Class: RsaOaepParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsa-oaep-æ˜¯ä»€ä¹ˆ">RSA-OAEP æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsaoaepparams-ç±»">RsaOaepParams ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸»è¦å±æ€§">ä¸»è¦å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-5">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-5">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-7">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#èƒƒå£éƒ¨åˆ†-rsa-å’Œ-oaep">èƒƒå£éƒ¨åˆ†: RSA å’Œ OAEP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsaoaepparams-label-1">rsaOaepParams.label</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆå®ƒé‡è¦">ä¸ºä»€ä¹ˆå®ƒé‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-21">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-10">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsaoaepparams-name-1">rsaOaepParams.name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-22">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-rsapssparams">Class: RsaPssParams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsa-pss-æ˜¯ä»€ä¹ˆ">RSA-PSS æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsapssparams-ç±»">RsaPssParams ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-6">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»£ç ç¤ºä¾‹-1">ä»£ç ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-25">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-12">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rsapssparams-saltlength-1">rsaPssParams.saltLength</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-7">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-14">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="web-crypto-api" tabindex="-1"><a class="header-anchor" href="#web-crypto-api"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#web-crypto-api" target="_blank" rel="noopener noreferrer">Web Crypto API</a></span></a></h1><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ Web Crypto APIã€‚</p><h3 id="node-js-çš„-web-crypto-api-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#node-js-çš„-web-crypto-api-æ˜¯ä»€ä¹ˆ"><span>Node.js çš„ Web Crypto API æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>Web Crypto API æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ ‡å‡†ï¼Œå®ƒå…è®¸ä½ åœ¨ Web åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œä½çº§åˆ«çš„åŠ å¯†æ“ä½œã€‚è¿™äº›åŠ å¯†æ“ä½œå¯ä»¥åŒ…æ‹¬ä½†ä¸é™äºç”Ÿæˆå¯†é’¥ã€æ•£åˆ—æ•°æ®ã€ç­¾åå’ŒéªŒè¯ä¿¡æ¯ä»¥åŠåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¯¥ API çš„å®ç°ä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨æœåŠ¡ç«¯ä¹Ÿèƒ½äº«å—åˆ°è¿™äº›åŠŸèƒ½ï¼Œè¿›è€Œæ„å»ºæ›´å®‰å…¨çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-ç”Ÿæˆå¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_1-ç”Ÿæˆå¯†é’¥"><span>1. ç”Ÿæˆå¯†é’¥</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦åŠ å¯†ç”¨æˆ·ä¿¡æ¯çš„ç³»ç»Ÿã€‚é¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä¼šç”Ÿæˆä¸€ä¸ªç”¨äº AES-GCM æ¨¡å¼çš„åŠ å¯†å¯†é’¥ï¼Œå¹¶ä¸”è¿™ä¸ªå¯†é’¥èƒ½ç”¨äºåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><h4 id="_2-åŠ å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2-åŠ å¯†æ•°æ®"><span>2. åŠ å¯†æ•°æ®</span></a></h4><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„å¯†é’¥æ¥åŠ å¯†ä¸€äº›æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">//æ¥æºï¼šdoc.cherrychat.org è¯·å‹¿å•†ç”¨</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°†å­—ç¬¦ä¸²æ•°æ®è½¬æ¢ä¸ºå­—èŠ‚ï¼Œç„¶åä½¿ç”¨<code>encrypt</code>å‡½æ•°è¿›è¡ŒåŠ å¯†ã€‚æ³¨æ„ï¼Œ<code>iv</code>å‚æ•°æ˜¯ä¸€ä¸ªåˆå§‹åŒ–å‘é‡ï¼Œå¯¹äºæ¯æ¬¡åŠ å¯†æ“ä½œéƒ½åº”å½“æ˜¯å”¯ä¸€çš„ï¼Œä»¥ä¿è¯åŠ å¯†çš„å®‰å…¨æ€§ã€‚</p><h4 id="_3-è§£å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_3-è§£å¯†æ•°æ®"><span>3. è§£å¯†æ•°æ®</span></a></h4><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè§£å¯†é‚£äº›å·²ç»è¢«åŠ å¯†çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„è¿‡ç¨‹ä¸åŠ å¯†ç±»ä¼¼ï¼Œä½†æ–¹å‘ç›¸åã€‚ä½ éœ€è¦æä¾›åŒæ ·çš„åˆå§‹åŒ–å‘é‡ï¼ˆ<code>iv</code>ï¼‰æ¥æ­£ç¡®è§£å¯†æ•°æ®ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä¸Šè¿°çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Node.js ä¸­çš„ Web Crypto API å¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­è¢«åˆ©ç”¨æ¥è¿›è¡ŒåŸºç¡€çš„åŠ å¯†å’Œè§£å¯†æ“ä½œã€‚è¿™åªæ˜¯ API èƒ½åŠ›çš„å†°å±±ä¸€è§’ï¼Œå®ƒè¿˜æ”¯æŒæ•°å­—ç­¾åã€å“ˆå¸Œè®¡ç®—ç­‰å¤šç§æœºåˆ¶ï¼Œä¸ºå¼€å‘å®‰å…¨çš„æœåŠ¡ç«¯åº”ç”¨æä¾›äº†å¼ºå¤§çš„å·¥å…·ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç†è§£å¹¶æ­£ç¡®åº”ç”¨è¿™äº›å·¥å…·å¯¹ä¿æŠ¤ç”¨æˆ·æ•°æ®ã€é˜²æ­¢æ¶æ„æ”»å‡»éå¸¸å…³é”®ã€‚</p><h2 id="examples" tabindex="-1"><a class="header-anchor" href="#examples"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#examples" target="_blank" rel="noopener noreferrer">Examples</a></span></a></h2><p>Node.js çš„ v21.7.1 ç‰ˆæœ¬ä¸­åŒ…å«äº†è®¸å¤šæ”¹è¿›å’Œæ–°ç‰¹æ€§ï¼Œå…¶ä¸­ <code>Web Cryptography API</code>ï¼ˆWeb åŠ å¯† APIï¼‰æ˜¯ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„éƒ¨åˆ†ã€‚è¿™ä¸ª API æä¾›äº†ä¸€å¥—è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œçš„æ ‡å‡†æ–¹æ³•ï¼Œå®ƒè®©åœ¨ Node.js ç¯å¢ƒä¸‹å¤„ç†åŠ å¯†æ•°æ®å˜å¾—æ›´åŠ ç®€å•å’Œå®‰å…¨ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œé‡è¦çš„æ˜¯ç†è§£ Web åŠ å¯† API æ˜¯ä»€ä¹ˆã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…è®¸ä½ æ‰§è¡Œå„ç§åŠ å¯†æ“ä½œï¼ˆå¦‚ç”Ÿæˆå¯†é’¥ã€æ•£åˆ—ã€ç­¾åå’ŒåŠ å¯†/è§£å¯†æ•°æ®ï¼‰çš„æ¥å£é›†åˆã€‚å®ƒæ—¨åœ¨ä¸º Web åº”ç”¨æä¾›ä¸€ç§å®‰å…¨ä¸”æ˜“äºä½¿ç”¨çš„æ–¹å¼æ¥å¤„ç†æ•æ„Ÿä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“çš„ä½¿ç”¨æ¡ˆä¾‹è¯´æ˜ï¼Œä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Web åŠ å¯† API åœ¨ Node.js ä¸­çš„åº”ç”¨ï¼š</p><h4 id="_1-ç”Ÿæˆå¯†é’¥-1" tabindex="-1"><a class="header-anchor" href="#_1-ç”Ÿæˆå¯†é’¥-1"><span>1. ç”Ÿæˆå¯†é’¥</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ Web åŠ å¯† API æ¥ç”Ÿæˆä¸€ä¸ªå¼ºå¯†é’¥ï¼Œç„¶åç”¨è¿™ä¸ªå¯†é’¥æ¥åŠ å¯†ç”¨æˆ·æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç”¨äºåŠ å¯†/è§£å¯†çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-æ•°æ®åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®åŠ å¯†"><span>2. æ•°æ®åŠ å¯†</span></a></h4><p>ç”Ÿæˆå¯†é’¥åï¼Œä½ å¯èƒ½æƒ³è¦ç”¨è¿™ä¸ªå¯†é’¥åŠ å¯†ä¸€äº›æ•æ„Ÿæ•°æ®ã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¹‹å‰ç”Ÿæˆçš„å¯†é’¥æ¥åŠ å¯†ä¸€æ®µæ–‡æœ¬ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ä½ çš„å¯†é’¥å’Œè¦åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> secretData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  encryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // è¾“å‡ºåŠ å¯†åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-æ•°æ®è§£å¯†" tabindex="-1"><a class="header-anchor" href="#_3-æ•°æ®è§£å¯†"><span>3. æ•°æ®è§£å¯†</span></a></h4><p>æœ€åï¼Œå¦‚æœä½ éœ€è¦è§£å¯†ä¹‹å‰åŠ å¯†çš„æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å¯†é’¥æ¥è¿›è¡Œè§£å¯†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ä¸åŠ å¯†æ—¶ç›¸åŒçš„åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> decodedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨å‰é¢çš„åŠ å¯†ç¤ºä¾‹ä¸­çš„å¯†é’¥å’ŒåŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™é‡Œä½ å·²ç»æœ‰äº†encryptedDataå’Œkey</span></span>
<span class="line"><span style="color:#88C0D0;">decryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¾“å‡ºè§£å¯†åçš„åŸå§‹æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ Web åŠ å¯† API æ¥è¿›è¡ŒåŸºæœ¬çš„åŠ å¯†å’Œè§£å¯†æ“ä½œã€‚å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½è¿˜éœ€è¦å¤„ç†æ›´å¤æ‚çš„åœºæ™¯ï¼Œæ¯”å¦‚å¤„ç†ä¸åŒç±»å‹çš„åŠ å¯†ç®—æ³•ã€ä¼˜åŒ–æ€§èƒ½ç­‰ã€‚ä½†è¿™äº›ä¾‹å­ä¸ºä½ æä¾›äº†ä¸€ä¸ªå¼€å§‹æ¢ç´¢å’Œä½¿ç”¨ Node.js ä¸­ Web åŠ å¯† API çš„è‰¯å¥½èµ·ç‚¹ã€‚éšç€ä½ å¯¹è¿™äº› API çš„æ›´æ·±å…¥å­¦ä¹ ï¼Œä½ å°†èƒ½å¤Ÿæ„å»ºæ›´åŠ å®‰å…¨å’Œé«˜æ•ˆçš„ Web åº”ç”¨ã€‚</p><h3 id="generating-keys" tabindex="-1"><a class="header-anchor" href="#generating-keys"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#generating-keys" target="_blank" rel="noopener noreferrer">Generating keys</a></span></a></h3><p>Node.js ä¸­çš„ Web Crypto API æä¾›äº†ä¸€ä¸ªç”¨äºåŠ å¯†æ“ä½œçš„æ¥å£ï¼ŒåŒ…æ‹¬å¯†é’¥çš„ç”Ÿæˆã€åŠ å¯†è§£å¯†ã€ç­¾åéªŒç­¾ç­‰åŠŸèƒ½ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šå‘ä½ è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Node.jsï¼ˆç‰ˆæœ¬ 21.7.1ï¼‰ä¸­çš„ Web Crypto API æ¥ç”Ÿæˆå¯†é’¥ï¼Œå¹¶ç»™å‡ºä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­ã€‚</p><h3 id="_1-æ¦‚å¿µç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1-æ¦‚å¿µç®€ä»‹"><span>1. æ¦‚å¿µç®€ä»‹</span></a></h3><p>é¦–å…ˆï¼Œæ˜ç™½ä»€ä¹ˆæ˜¯å¯†é’¥éå¸¸é‡è¦ã€‚åœ¨åŠ å¯†ä¸–ç•Œé‡Œï¼Œå¯†é’¥æ˜¯ä¸€ä¸²ç”¨äºåŠ å¯†æˆ–è§£å¯†ä¿¡æ¯çš„æ•°æ®ã€‚æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒï¼Œå¯†é’¥åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><strong>å¯¹ç§°å¯†é’¥</strong>ï¼šåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚</li><li><strong>éå¯¹ç§°å¯†é’¥</strong>ï¼šæœ‰ä¸€å¯¹å¯†é’¥ï¼Œä¸€ä¸ªå…¬å¼€ï¼ˆå…¬é’¥ï¼‰ï¼Œç”¨äºåŠ å¯†ï¼Œå¦ä¸€ä¸ªä¿å¯†ï¼ˆç§é’¥ï¼‰ï¼Œç”¨äºè§£å¯†ã€‚</li></ul><h3 id="_2-ä½¿ç”¨-node-js-ç”Ÿæˆå¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨-node-js-ç”Ÿæˆå¯†é’¥"><span>2. ä½¿ç”¨ Node.js ç”Ÿæˆå¯†é’¥</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½®çš„<code>crypto</code>æ¨¡å—æ¥ç”Ÿæˆè¿™ä¸¤ç§ç±»å‹çš„å¯†é’¥ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Web Crypto API è¿›è¡Œå¯†é’¥ç”Ÿæˆçš„æ­¥éª¤ï¼š</p><h4 id="_2-1-å¼•å…¥cryptoæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_2-1-å¼•å…¥cryptoæ¨¡å—"><span>2.1. å¼•å…¥<code>crypto</code>æ¨¡å—</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ Node.js çš„<code>crypto</code>æ¨¡å—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-2-ç”Ÿæˆå¯¹ç§°å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_2-2-ç”Ÿæˆå¯¹ç§°å¯†é’¥"><span>2.2. ç”Ÿæˆå¯¹ç§°å¯†é’¥</span></a></h4><p>å¯¹äºå¯¹ç§°å¯†é’¥ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦ç”Ÿæˆä¸€ä¸ªç”¨äº AES åŠ å¯†çš„å¯†é’¥ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯ä»¥æ˜¯ 128, 192, æˆ– 256</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å¼‚æ­¥ç”Ÿæˆäº†ä¸€ä¸ª AES-GCM ç®—æ³•ã€é•¿åº¦ä¸º 256 ä½çš„å¯¹ç§°å¯†é’¥ï¼Œè¯¥å¯†é’¥å¯ç”¨äºåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><h4 id="_2-3-ç”Ÿæˆéå¯¹ç§°å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_2-3-ç”Ÿæˆéå¯¹ç§°å¯†é’¥"><span>2.3. ç”Ÿæˆéå¯¹ç§°å¯†é’¥</span></a></h4><p>å¯¹äºéå¯¹ç§°å¯†é’¥ï¼Œä¾‹å¦‚ RSA å¯†é’¥å¯¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç”Ÿæˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¸¸è§çš„å…¬å¼€æŒ‡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å¼‚æ­¥ç”Ÿæˆäº†ä¸€ä¸ªç”¨äº RSA-OAEP ç®—æ³•çš„å¯†é’¥å¯¹ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ï¼Œå®ƒä»¬ç”¨äºåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><h3 id="_3-å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#_3-å®é™…è¿ç”¨ä¾‹å­"><span>3. å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_3-1-æ•°æ®åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#_3-1-æ•°æ®åŠ å¯†"><span>3.1. æ•°æ®åŠ å¯†</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨å¯¹ç§°å¯†é’¥æ¥åŠ å¯†ç”¨æˆ·æ•°æ®ã€‚å½“å­˜å‚¨ä¿¡æ¯å‰ï¼Œä½¿ç”¨ç”Ÿæˆçš„å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼›å½“è¯»å–ä¿¡æ¯æ—¶ï¼Œä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚</p><h4 id="_3-2-å®‰å…¨é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#_3-2-å®‰å…¨é€šä¿¡"><span>3.2. å®‰å…¨é€šä¿¡</span></a></h4><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†ç¡®ä¿ä¼ è¾“çš„ä¿¡æ¯å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨éå¯¹ç§°å¯†é’¥ã€‚æœåŠ¡å™¨å¯ä»¥ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼Œå°†å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä½¿ç”¨å…¬é’¥å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ï¼Œåªæœ‰æŒæœ‰ç§é’¥çš„æœåŠ¡å™¨æ‰èƒ½è§£å¯†ä¿¡æ¯ã€‚</p><p>é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œä½ åº”è¯¥å¯¹å¦‚ä½•ä½¿ç”¨ Node.js çš„ Web Crypto API ç”Ÿæˆå¯†é’¥æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚è®°ä½ï¼ŒåŠ å¯†æ˜¯ä¸€ä¸ªå¤æ‚ä¸”æ•æ„Ÿçš„é¢†åŸŸï¼Œæ­£ç¡®åœ°ç®¡ç†å’Œä½¿ç”¨å¯†é’¥è‡³å…³é‡è¦ã€‚</p><h4 id="aes-keys" tabindex="-1"><a class="header-anchor" href="#aes-keys"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aes-keys" target="_blank" rel="noopener noreferrer">AES keys</a></span></a></h4><p>Node.js ä¸­çš„ AES åŠ å¯†æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æŠ€æœ¯ï¼Œæ„å‘³ç€å®ƒä½¿ç”¨ç›¸åŒçš„å¯†é’¥æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„â€œAES keysâ€æ˜¯æŒ‡ç”¨äº AES åŠ å¯†ç®—æ³•çš„å¯†é’¥ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆå¤§æ¦‚äº†è§£ä¸‹ AES åŠ å¯†ï¼Œç„¶åé€šè¿‡å®ä¾‹æ¥å…·ä½“ç†è§£å¦‚ä½•åœ¨ Node.js ä¸­æ“ä½œ AES å¯†é’¥ã€‚</p><h3 id="aes-åŠ å¯†åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#aes-åŠ å¯†åŸºç¡€"><span>AES åŠ å¯†åŸºç¡€</span></a></h3><p>AESï¼ˆAdvanced Encryption Standardï¼‰æ˜¯ä¸€ç§ç”µå­æ•°æ®åŠ å¯†æ ‡å‡†ï¼Œå®ƒèƒ½æœ‰æ•ˆä¿æŠ¤æ•°å­—ä¿¡æ¯å…å—æœªæˆæƒè®¿é—®ã€‚AES åŠ å¯†ä½¿ç”¨å›ºå®šé•¿åº¦çš„å—æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®ï¼Œè¿™äº›å›ºå®šé•¿åº¦å¯ä»¥æ˜¯ 128ã€192 æˆ– 256 ä½ã€‚å¯†é’¥çš„é•¿åº¦å†³å®šäº†åŠ å¯†çš„å¼ºåº¦ï¼šå¯†é’¥è¶Šé•¿ï¼Œå®‰å…¨æ€§è¶Šé«˜ã€‚</p><h3 id="node-js-ä¸­çš„-aes-å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-aes-å¯†é’¥"><span>Node.js ä¸­çš„ AES å¯†é’¥</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>crypto</code>æ¨¡å—æä¾›äº†åŒ…æ‹¬ AES åœ¨å†…çš„åŠ å¯†åŠŸèƒ½ã€‚å¯¹äº AES å¯†é’¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„ WebCrypto API æ¥ç”Ÿæˆã€å¯¼å‡ºã€å¯¼å…¥ä»¥åŠä½¿ç”¨è¿™äº›å¯†é’¥è¿›è¡Œæ•°æ®çš„åŠ å¯†å’Œè§£å¯†ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><ol><li><p><strong>ç”Ÿæˆ AES å¯†é’¥</strong></p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ WebCrypto API ç”Ÿæˆä¸€ä¸ª AES å¯†é’¥çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateAesKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span></span>
<span class="line"><span style="color:#88C0D0;">        name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨AES-GCMæ¨¡å¼</span></span>
<span class="line"><span style="color:#88C0D0;">        length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦256ä½</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// æŒ‡å®šå¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">AES Key generated:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error generating AES key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateAesKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åŠ å¯†å’Œè§£å¯†æ•°æ®</strong></p><p>æœ‰äº† AES å¯†é’¥åï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥åŠ å¯†å’Œè§£å¯†æ•°æ®äº†ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ç”Ÿæˆçš„ AES å¯†é’¥è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Encrypted data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä¸åŠ å¯†æ—¶ä½¿ç”¨ç›¸åŒçš„åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Decrypted data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> runExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> generateAesKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">runExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé¦–å…ˆç”Ÿæˆäº†ä¸€ä¸ªç”¨äº AES-GCM æ¨¡å¼çš„ 256 ä½å¯†é’¥ã€‚ç„¶åï¼Œä½¿ç”¨è¯¥å¯†é’¥åŠ å¯†ä¸€æ®µå­—ç¬¦ä¸²æ•°æ®ï¼Œå¹¶å°†åŠ å¯†åçš„æ•°æ®è§£å¯†å›åŸå§‹å­—ç¬¦ä¸²ã€‚æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦å¦¥å–„å¤„ç†åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰å’Œå…¶ä»–ç›¸å…³å‚æ•°ä»¥ç¡®ä¿åŠ å¯†çš„å®‰å…¨æ€§ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js æ”¯æŒå¼€å‘äººå‘˜ä½¿ç”¨ AES åŠ å¯†æŠ€æœ¯æ¥ä¿æŠ¤æ•°æ®çš„å®‰å…¨ï¼Œæ— è®ºæ˜¯å­˜å‚¨è¿˜æ˜¯ä¼ è¾“è¿‡ç¨‹ä¸­éƒ½èƒ½æœ‰æ•ˆé˜²æ­¢æ•°æ®è¢«æœªæˆæƒè®¿é—®ã€‚</p><h4 id="ecdsa-key-pairs" tabindex="-1"><a class="header-anchor" href="#ecdsa-key-pairs"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ecdsa-key-pairs" target="_blank" rel="noopener noreferrer">ECDSA key pairs</a></span></a></h4><p>Node.js åœ¨å…¶ v21.7.1 ç‰ˆæœ¬ä¸­æä¾›äº†å¯¹ ECDSAï¼ˆElliptic Curve Digital Signature Algorithmï¼Œæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼‰å¯†é’¥å¯¹çš„æ”¯æŒã€‚æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ ECDSA å¯†é’¥å¯¹æ˜¯ä»€ä¹ˆã€å®ƒä»¬å¦‚ä½•å·¥ä½œä»¥åŠåœ¨å®é™…åº”ç”¨ä¸­çš„ä¸€äº›ç¤ºä¾‹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-ecdsa-å¯†é’¥å¯¹" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-ecdsa-å¯†é’¥å¯¹"><span>ä»€ä¹ˆæ˜¯ ECDSA å¯†é’¥å¯¹ï¼Ÿ</span></a></h3><p>ECDSA å¯†é’¥å¯¹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªå…¬é’¥ã€‚ç§é’¥ç”¨äºç”Ÿæˆæ•°å­—ç­¾åï¼Œè€Œå…¬é’¥ç”¨äºéªŒè¯è¯¥ç­¾åã€‚è¿™ç§æœºåˆ¶åŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„ RSA åŠ å¯†æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä½¿ç”¨è¾ƒçŸ­çš„å¯†é’¥é•¿åº¦æä¾›ç›¸åŒçº§åˆ«çš„å®‰å…¨æ€§ã€‚</p><ul><li><strong>ç§é’¥</strong>ï¼šæ˜¯ä¸€ä¸ªç§˜å¯†æ•°å­—ï¼Œåªèƒ½ç”±å¯†é’¥æ‰€æœ‰è€…çŸ¥é“ã€‚</li><li><strong>å…¬é’¥</strong>ï¼šé€šè¿‡ç‰¹å®šçš„æ•°å­¦è¿ç®—ä¸ç§é’¥ç›¸å…³è”ï¼Œå¯ä»¥å®‰å…¨åœ°å…¬å¼€ï¼Œç”¨äºéªŒè¯ç”±ç§é’¥åˆ›å»ºçš„ç­¾åã€‚</li></ul><h3 id="ecdsa-å¯†é’¥å¯¹å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#ecdsa-å¯†é’¥å¯¹å¦‚ä½•å·¥ä½œ"><span>ECDSA å¯†é’¥å¯¹å¦‚ä½•å·¥ä½œï¼Ÿ</span></a></h3><p>å½“ä½ æƒ³è¦å‘é€ä¸€ä¸ªå·²ç­¾åçš„æ¶ˆæ¯æ—¶ï¼Œä½ ä¼šä½¿ç”¨ä½ çš„ç§é’¥æ¥åˆ›å»ºä¸€ä¸ªç‹¬ç‰¹çš„æ•°å­—ç­¾åï¼Œå¹¶å°†è¿™ä¸ªç­¾åé™„åŠ åˆ°ä½ çš„æ¶ˆæ¯ä¸Šã€‚æ¥æ”¶è€…æ”¶åˆ°ä½ çš„æ¶ˆæ¯å’Œç­¾ååï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ä½ çš„å…¬é’¥æ¥éªŒè¯ç­¾åæ˜¯å¦ç¡®å®ç”±ä½ çš„ç§é’¥ç”Ÿæˆã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œå®ƒè¯æ˜äº†æ¶ˆæ¯ç¡®å®æ˜¯ç”±ç§é’¥çš„æŒæœ‰è€…å‘é€çš„ï¼Œå¹¶ä¸”æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-ç½‘ç»œé€šä¿¡å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#_1-ç½‘ç»œé€šä¿¡å®‰å…¨"><span>1. ç½‘ç»œé€šä¿¡å®‰å…¨</span></a></h4><p>åœ¨ HTTPS åè®®ä¸­ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å‘é€å…¶å…¬é’¥ã€‚å®¢æˆ·ç«¯ä½¿ç”¨æ­¤å…¬é’¥æ¥éªŒè¯ä»æœåŠ¡å™¨æ¥æ”¶çš„æ•°æ®çš„ç­¾åï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºçš„çœŸå®æ€§ã€‚ä¾‹å¦‚ï¼Œå½“ä½ è®¿é—®ä¸€ä¸ªé“¶è¡Œç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä½¿ç”¨é“¶è¡Œçš„å…¬é’¥æ¥éªŒè¯ä½ æ”¶åˆ°çš„é¡µé¢æ˜¯çœŸå®æœªç»ç¯¡æ”¹çš„ã€‚</p><h4 id="_2-æ•°å­—è´§å¸äº¤æ˜“" tabindex="-1"><a class="header-anchor" href="#_2-æ•°å­—è´§å¸äº¤æ˜“"><span>2. æ•°å­—è´§å¸äº¤æ˜“</span></a></h4><p>æ¯”ç‰¹å¸å’Œå…¶ä»–åŠ å¯†è´§å¸å¹¿æ³›ä½¿ç”¨ ECDSA è¿›è¡Œäº¤æ˜“ç­¾åã€‚å½“ä½ æƒ³è½¬è´¦ç»™æŸäººæ—¶ï¼Œä½ ä¼šä½¿ç”¨ä½ çš„ç§é’¥æ¥ç­¾ç½²äº¤æ˜“ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œé‡‘é¢å’Œæ”¶æ¬¾åœ°å€ï¼‰ã€‚ç½‘ç»œä¸Šçš„æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨ä½ çš„å…¬é’¥æ¥éªŒè¯è¿™ä¸ªç­¾åï¼Œä»è€Œç¡®ä¿äº¤æ˜“æ˜¯ç”±èµ„é‡‘æ‰€æœ‰è€…å‘èµ·ï¼Œå¹¶ä¸”è‡ªç­¾åä»¥æ¥æœªè¢«ä¿®æ”¹ã€‚</p><h4 id="_3-èº«ä»½è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_3-èº«ä»½è®¤è¯"><span>3. èº«ä»½è®¤è¯</span></a></h4><p>åœ¨ä¸€äº›é«˜å®‰å…¨éœ€æ±‚çš„ç¯å¢ƒä¸­ï¼ŒECDSA å¯†é’¥å¯¹å¯ä»¥ç”¨æ¥è¿›è¡Œèº«ä»½è®¤è¯ã€‚ç”¨æˆ·é€šè¿‡ä½¿ç”¨å…¶ç§é’¥æ¥ç­¾åä¸€ä¸ªæŒ‘æˆ˜æ¶ˆæ¯ï¼ˆchallenge messageï¼‰ï¼Œç„¶åæœåŠ¡ç«¯åˆ©ç”¨ç”¨æˆ·çš„å…¬é’¥æ¥éªŒè¯è¿™ä¸ªç­¾åã€‚å¦‚æœéªŒè¯é€šè¿‡ï¼Œç”¨æˆ·ä¾¿æˆåŠŸè¯æ˜äº†ä»–ä»¬çš„èº«ä»½ï¼Œæ— éœ€ä¼ é€å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯ã€‚</p><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h3><p>Node.js v21.7.1 é€šè¿‡ Web Crypto API æä¾›å¯¹ ECDSA å¯†é’¥å¯¹çš„æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨ Node.js åº”ç”¨ä¸­å®ç°åŸºäºæ¤­åœ†æ›²çº¿çš„æ•°å­—ç­¾åå’ŒéªŒè¯åŠŸèƒ½ã€‚è¿™ä¸ºä¿éšœæ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€å®ç°å®‰å…¨çš„èº«ä»½éªŒè¯æä¾›äº†å¼ºå¤§çš„å·¥å…·ã€‚ä¸è®ºæ˜¯åœ¨ç½‘ç»œé€šä¿¡å®‰å…¨ã€æ•°å­—è´§å¸äº¤æ˜“è¿˜æ˜¯èº«ä»½è®¤è¯ç­‰é¢†åŸŸï¼ŒECDSA å¯†é’¥å¯¹éƒ½æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚</p><h4 id="ed25519-ed448-x25519-x448-key-pairs" tabindex="-1"><a class="header-anchor" href="#ed25519-ed448-x25519-x448-key-pairs"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ed25519ed448x25519x448-key-pairs" target="_blank" rel="noopener noreferrer">Ed25519/Ed448/X25519/X448 key pairs</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ Ed25519ã€Ed448ã€X25519 å’Œ X448 å¯†é’¥å¯¹æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨è®¨è®ºä¸€ç§éå¸¸é«˜æ•ˆä¸”å®‰å…¨çš„åŠ å¯†æŠ€æœ¯ã€‚è¿™äº›åå­—å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æˆ‘ä¼šå°½é‡ç”¨ç®€å•é€šä¿—çš„è¯­è¨€æ¥è§£é‡Šã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£è¿™äº›å¯†é’¥å¯¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å®ƒä»¬å±äºå…¬é’¥åŠ å¯†çš„èŒƒç•´ã€‚åœ¨å…¬é’¥åŠ å¯†ä¸­ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ï¼šä¸€ä¸ªæ˜¯å…¬é’¥ï¼ˆå¯ä»¥å…¬å¼€åˆ†äº«çš„ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ç§é’¥ï¼ˆéœ€è¦ä¿å¯†çš„ï¼‰ã€‚è¿™ä¸¤ä¸ªå¯†é’¥åœ¨åŠ å¯†å’Œè§£å¯†æ•°æ®æ—¶é…åˆä½¿ç”¨ã€‚</p><ul><li><p><strong>Ed25519 å’Œ Ed448</strong> æ˜¯ä¸€ç§ç­¾åç®—æ³•ã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬æƒ³è±¡æˆä¸€ç§ç‰¹æ®Šçš„ç¬”è¿¹æˆ–å°ç« ï¼Œç”¨æ¥éªŒè¯ä¿¡æ¯çš„çœŸå®æ€§ã€‚æ¯”å¦‚ï¼ŒAlice ç»™ Bob å‘äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ç”¨å¥¹çš„ç§é’¥è¿›è¡Œäº†ç­¾åã€‚å½“ Bob æ”¶åˆ°è¿™æ¡æ¶ˆæ¯æ—¶ï¼Œä»–å¯ä»¥ç”¨ Alice çš„å…¬é’¥æ¥éªŒè¯è¿™ä¸ªç­¾åï¼Œä»è€Œç¡®ä¿¡è¿™æ¡æ¶ˆæ¯ç¡®å®æ˜¯ Alice å‘çš„ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ã€‚</p></li><li><p><strong>X25519 å’Œ X448</strong> åˆ™æ˜¯ç”¨äºå¯†é’¥äº¤æ¢çš„ç®—æ³•ã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒAlice å’Œ Bob æƒ³è¦åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸Šå®‰å…¨åœ°äº¤æ¢ç§˜å¯†ä¿¡æ¯ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›ç®—æ³•æ¥ç”Ÿæˆä¸€ä¸ªå…±äº«çš„ç§˜å¯†å¯†é’¥ï¼Œå³ä½¿æœ‰äººèƒ½å¤Ÿæ‹¦æˆªä»–ä»¬çš„äº¤æµï¼Œä¹Ÿæ— æ³•å¾—çŸ¥è¿™ä¸ªå…±äº«çš„å¯†é’¥æ˜¯ä»€ä¹ˆã€‚è¿™æ ·ï¼Œä»–ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªå…±äº«çš„å¯†é’¥æ¥åŠ å¯†é€šä¿¡äº†ã€‚</p></li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„åº”ç”¨åœºæ™¯æ¥ç†è§£è¿™äº›æŠ€æœ¯çš„ç”¨å¤„ï¼š</p><ol><li><p><strong>å®‰å…¨é€šä¿¡</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·é—´å‘é€çš„æ¶ˆæ¯å®‰å…¨ï¼Œä¸è¢«ç¬¬ä¸‰æ–¹çªƒå¬æˆ–ç¯¡æ”¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ X25519 ç®—æ³•æ¥ç”Ÿæˆæ¯æ¬¡ä¼šè¯çš„å…±äº«å¯†é’¥ï¼Œç„¶åç”¨è¿™ä¸ªå¯†é’¥æ¥åŠ å¯†æ¶ˆæ¯å†…å®¹ã€‚åŒæ—¶ï¼Œå‘é€æ–¹å¯ä»¥ä½¿ç”¨ Ed25519 ç®—æ³•å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ¶ˆæ¯åå¯ä»¥éªŒè¯ç­¾åï¼Œç¡®ä¿æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p></li><li><p><strong>æ•°å­—ç­¾å</strong>ï¼šå¦‚æœä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªè½¯ä»¶åˆ†å‘å¹³å°ï¼Œä½ ä¼šå¸Œæœ›ç”¨æˆ·ä¸‹è½½çš„è½¯ä»¶æ˜¯åŸç‰ˆä¸”æœªè¢«ç¯¡æ”¹çš„ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ Ed25519 æˆ– Ed448 è¿›è¡Œæ•°å­—ç­¾åã€‚å¼€å‘è€…åœ¨å‘å¸ƒè½¯ä»¶æ—¶å¯¹å…¶è¿›è¡Œç­¾åï¼Œç”¨æˆ·åœ¨ä¸‹è½½è½¯ä»¶æ—¶éªŒè¯è¿™ä¸ªç­¾åï¼Œä»¥ç¡®ä¿è½¯ä»¶çš„å®‰å…¨æ€§ã€‚</p></li><li><p><strong>å®‰å…¨çš„ Web æœåŠ¡</strong>ï¼šå»ºç«‹ä¸€ä¸ªç½‘ç«™ï¼Œå°¤å…¶æ˜¯æ¶‰åŠç”¨æˆ·æ•°æ®å’Œäº¤æ˜“çš„ç”µå­å•†åŠ¡ç½‘ç«™æ—¶ï¼Œå®‰å…¨æ˜¯æœ€é‡è¦çš„è€ƒè™‘ä¹‹ä¸€ã€‚ä½¿ç”¨ X25519 æˆ– X448 è¿›è¡Œ TLS æ¡æ‰‹æ—¶çš„å¯†é’¥äº¤æ¢ï¼Œå¯ä»¥ç¡®ä¿ç½‘ç«™ä¸ç”¨æˆ·æµè§ˆå™¨ä¹‹é—´å»ºç«‹çš„è¿æ¥æ˜¯å®‰å…¨çš„ã€‚è¿™æ„å‘³ç€ä»»ä½•ä¼ è¾“çš„æ•°æ®éƒ½å°†è¢«åŠ å¯†ï¼Œä¿éšœç”¨æˆ·æ•°æ®çš„éšç§å’Œå®‰å…¨ã€‚</p></li></ol><p>é€šè¿‡ä»¥ä¸Šä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°è¿™äº›ç®—æ³•åœ¨ç°ä»£åŠ å¯†å’Œç½‘ç»œå®‰å…¨ä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ã€‚Node.js v21.7.1 é€šè¿‡æä¾›å¯¹è¿™äº›ç®—æ³•çš„æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´å®¹æ˜“åœ°æ„å»ºå®‰å…¨å¯é çš„åº”ç”¨ç¨‹åºã€‚</p><h4 id="hmac-keys" tabindex="-1"><a class="header-anchor" href="#hmac-keys"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hmac-keys" target="_blank" rel="noopener noreferrer">HMAC keys</a></span></a></h4><p>HMAC å…¨ç§°ä¸º Hash-based Message Authentication Codeï¼Œå³åŸºäºå“ˆå¸Œçš„æ¶ˆæ¯è®¤è¯ç ã€‚å®ƒæ˜¯ä¸€ç§ç”¨äºæ¶ˆæ¯è®¤è¯çš„å®‰å…¨æŠ€æœ¯ï¼Œç»“åˆäº†åŠ å¯†å“ˆå¸Œå‡½æ•°å’Œä¸€ä¸ªå¯†é’¥ã€‚åœ¨ Node.js ä¸­ï¼ŒHMAC keys æ˜¯ä½¿ç”¨ Web Crypto API è¿›è¡Œæ“ä½œçš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ª API æä¾›äº†ä¸€å¥—ç”¨äºå¤„ç†åŠ å¯†æ“ä½œçš„ JavaScript æ¥å£ã€‚</p><h3 id="hmac-keys-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#hmac-keys-çš„ä½œç”¨"><span>HMAC Keys çš„ä½œç”¨</span></a></h3><p>HMAC ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼š</p><ol><li><strong>ç¡®ä¿ä¿¡æ¯çš„å®Œæ•´æ€§</strong>ï¼šç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</li><li><strong>èº«ä»½éªŒè¯</strong>ï¼šå‘é€æ–¹å’Œæ¥æ”¶æ–¹å…±äº«ä¸€ä¸ªå¯†é’¥ï¼Œé€šè¿‡æ£€éªŒ HMAC å€¼æ¥ç¡®è®¤å¯¹æ–¹çš„èº«ä»½ã€‚</li></ol><h3 id="åœ¨-node-js-ä¸­ä½¿ç”¨-hmac-keys" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ä¸­ä½¿ç”¨-hmac-keys"><span>åœ¨ Node.js ä¸­ä½¿ç”¨ HMAC Keys</span></a></h3><p>è¦åœ¨ Node.jsï¼ˆv21.7.1 æˆ–å…¶ä»–æ”¯æŒ Web Crypto API çš„ç‰ˆæœ¬ï¼‰ä¸­ä½¿ç”¨ HMAC keysï¼Œä½ éœ€è¦ä½¿ç”¨<code>crypto.subtle</code>æ¨¡å—ã€‚è¿™é‡Œæœ‰å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>ç”Ÿæˆ HMAC å¯†é’¥</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªç”¨äº HMAC æ“ä½œçš„å¯†é’¥ã€‚</li><li><strong>ä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡Œç­¾å</strong>ï¼šé€šè¿‡ HMAC ç®—æ³•å’Œä½ çš„å¯†é’¥å¯¹ç‰¹å®šæ•°æ®è¿›è¡Œç­¾åã€‚</li><li><strong>éªŒè¯ç­¾å</strong>ï¼šæœ€åï¼Œä½¿ç”¨ç›¸åŒçš„å¯†é’¥éªŒè¯ç­¾åæ˜¯å¦æœ‰æ•ˆï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒéªŒè¯èº«ä»½ã€‚</li></ol><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ è¦å‘é€ä¸€ä¸ªé‡è¦çš„æ¶ˆæ¯ç»™ä½ çš„æœ‹å‹ï¼Œå¹¶ä¸”éœ€è¦ç¡®ä¿æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒéªŒè¯ä½ çš„èº«ä»½ã€‚</p><h4 id="_1-ç”Ÿæˆ-hmac-å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_1-ç”Ÿæˆ-hmac-å¯†é’¥"><span>1. ç”Ÿæˆ HMAC å¯†é’¥</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯æå–å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯ä½¿ç”¨æ­¤å¯†é’¥çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡Œç­¾å" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡Œç­¾å"><span>2. ä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡Œç­¾å</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-éªŒè¯ç­¾å" tabindex="-1"><a class="header-anchor" href="#_3-éªŒè¯ç­¾å"><span>3. éªŒè¯ç­¾å</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifySignature</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨åœºæ™¯ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ç¤ºä¾‹"><span>ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</span></a></h3><ul><li><strong>API èº«ä»½éªŒè¯</strong>ï¼šå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ HMAC å¯¹è¯·æ±‚è¿›è¡Œç­¾åï¼ŒæœåŠ¡å™¨é€šè¿‡éªŒè¯ç­¾åæ¥è®¤è¯è¯·æ±‚æ¥æºã€‚</li><li><strong>å®‰å…¨çš„æ–‡ä»¶ä¼ è¾“</strong>ï¼šåœ¨å‘é€æ–‡ä»¶ä¹‹å‰ï¼Œå‘é€æ–¹å¯ä»¥è®¡ç®—æ–‡ä»¶çš„ HMAC å€¼å¹¶å°†å…¶ä¸æ–‡ä»¶ä¸€èµ·å‘é€ã€‚æ¥æ”¶æ–¹å†æ¬¡è®¡ç®—æ¥æ”¶åˆ°çš„æ–‡ä»¶çš„ HMAC å€¼ï¼Œå¯¹æ¯”ä¸¤ä¸ª HMAC å€¼æ¥éªŒè¯æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚</li><li><strong>é˜²æ­¢è¡¨å•ç¯¡æ”¹</strong>ï¼šåœ¨ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€è¡¨å•åŠå…¶ HMAC ç­¾åã€‚å½“ç”¨æˆ·æäº¤è¡¨å•å›æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨é€šè¿‡æ£€æŸ¥ HMAC ç­¾åæ¥ç¡®ä¿è¡¨å•æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</li></ul><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤å’Œç¤ºä¾‹ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½å¯¹ Node.js ä¸­å¦‚ä½•ä½¿ç”¨ HMAC keys æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œä»¥åŠå®ƒä»¬åœ¨å®é™…åº”ç”¨ä¸­çš„ä¸€äº›ç”¨é€”ã€‚</p><h4 id="rsa-key-pairs" tabindex="-1"><a class="header-anchor" href="#rsa-key-pairs"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsa-key-pairs" target="_blank" rel="noopener noreferrer">RSA key pairs</a></span></a></h4><p>å½“ç„¶ï¼Œå¾ˆé«˜å…´ä¸ºä½ è¯¦ç»†è§£é‡Š Node.js ä¸­çš„ RSA å¯†é’¥å¯¹ï¼Œç‰¹åˆ«æ˜¯åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­çš„åº”ç”¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-rsa-å¯†é’¥å¯¹" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-rsa-å¯†é’¥å¯¹"><span>ä»€ä¹ˆæ˜¯ RSA å¯†é’¥å¯¹ï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹ RSA å¯†é’¥å¯¹ã€‚RSA æ˜¯ä¸€ç§éå¸¸æµè¡Œçš„åŠ å¯†æŠ€æœ¯ï¼Œå®ƒä¾èµ–äºä¸€å¯¹å¯†é’¥ï¼šä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚è¿™ä¸¤ä¸ªå¯†é’¥åœ¨æ•°å­¦ä¸Šæ˜¯ç›¸å…³è”çš„ã€‚å…¬é’¥å¯ä»¥å®‰å…¨åœ°åˆ†äº«ç»™ä»»ä½•äººï¼Œè€Œç§é’¥åˆ™å¿…é¡»ä¿å¯†ã€‚</p><ul><li><strong>å…¬é’¥</strong> ä¸»è¦ç”¨äºåŠ å¯†æ•°æ®æˆ–éªŒè¯ç­¾åã€‚</li><li><strong>ç§é’¥</strong> ç”¨äºè§£å¯†æ•°æ®æˆ–ç”Ÿæˆç­¾åã€‚</li></ul><h3 id="rsa-å¯†é’¥å¯¹åœ¨-node-js-ä¸­çš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#rsa-å¯†é’¥å¯¹åœ¨-node-js-ä¸­çš„åº”ç”¨"><span>RSA å¯†é’¥å¯¹åœ¨ Node.js ä¸­çš„åº”ç”¨</span></a></h3><p>Node.js é€šè¿‡ Web Crypto API æä¾›å¯¹ RSA å¯†é’¥å¯¹çš„æ”¯æŒã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ Node.js ç¯å¢ƒä¸­è½»æ¾åœ°ç”Ÿæˆ RSA å¯†é’¥å¯¹ï¼Œè¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­¾åç­‰æ“ä½œã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼Œå¦‚ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯ä¼ è¾“ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œä½ å¸Œæœ›ç¡®ä¿å‘é€çš„æ¶ˆæ¯æ˜¯åŠ å¯†çš„ï¼Œå¹¶ä¸”åªèƒ½ç”±æŒ‡å®šçš„æ¥æ”¶è€…è¯»å–ã€‚</p><h5 id="æ­¥éª¤-1-ç”Ÿæˆ-rsa-å¯†é’¥å¯¹" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-ç”Ÿæˆ-rsa-å¯†é’¥å¯¹"><span>æ­¥éª¤ 1ï¼šç”Ÿæˆ RSA å¯†é’¥å¯¹</span></a></h5><p>é¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ª RSA å¯†é’¥å¯¹ã€‚è¿™å¯ä»¥ä½¿ç”¨ Node.js çš„ <code>crypto</code> æ¨¡å—ä¸­æä¾›çš„ <code>generateKeyPair</code> å‡½æ•°æ¥å®Œæˆã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> generateKeyPair</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">rsa</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      return;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // è¿™é‡Œä½ ä¼šå¾—åˆ° PEM æ ¼å¼çš„å…¬é’¥å’Œç§é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ­¥éª¤-2-ä½¿ç”¨å…¬é’¥åŠ å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-ä½¿ç”¨å…¬é’¥åŠ å¯†æ•°æ®"><span>æ­¥éª¤ 2ï¼šä½¿ç”¨å…¬é’¥åŠ å¯†æ•°æ®</span></a></h5><p>ç°åœ¨ï¼Œå½“ç”¨æˆ· A æƒ³è¦å‘é€åŠ å¯†æ¶ˆæ¯ç»™ç”¨æˆ· Bï¼Œç”¨æˆ· A å¯ä»¥ä½¿ç”¨ç”¨æˆ· B çš„å…¬é’¥æ¥åŠ å¯†æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicEncrypt</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> getUserB</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–åˆ°ç”¨æˆ· B çš„å…¬é’¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> publicEncrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello User B!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åŠ å¯†åçš„æ•°æ®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ­¥éª¤-3-ä½¿ç”¨ç§é’¥è§£å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-ä½¿ç”¨ç§é’¥è§£å¯†æ•°æ®"><span>æ­¥éª¤ 3ï¼šä½¿ç”¨ç§é’¥è§£å¯†æ•°æ®</span></a></h5><p>ç”¨æˆ· B æ”¶åˆ°åŠ å¯†çš„æ¶ˆæ¯åï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥è§£å¯†æ¶ˆæ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> privateDecrypt</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> getUserBPrivateKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è·å–ç”¨æˆ· B çš„ç§é’¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> privateDecrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &#39;Hello User B!&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h3><p>é€šè¿‡ä»¥ä¸Šçš„æ­¥éª¤ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ RSA å¯†é’¥å¯¹è¿›è¡ŒåŸºæœ¬çš„åŠ å¯†å’Œè§£å¯†æ“ä½œã€‚è¿™ä»…ä»…æ˜¯ RSA åº”ç”¨çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒRSA å¯†é’¥å¯¹è¿˜è¢«å¹¿æ³›ç”¨äºæ•°å­—ç­¾åã€èº«ä»½éªŒè¯ç­‰åœºæ™¯ï¼Œå¢å¼ºæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§å’Œä¿¡ä»»åº¦ã€‚</p><h3 id="encryption-and-decryption" tabindex="-1"><a class="header-anchor" href="#encryption-and-decryption"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#encryption-and-decryption" target="_blank" rel="noopener noreferrer">Encryption and decryption</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„â€œEncryption and decryptionâ€æŒ‡çš„æ˜¯ä½¿ç”¨ Node.js å†…ç½®çš„ Web Crypto API æ¥è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ã€‚è¿™æ˜¯ä¸€å¥—ç”¨äºåœ¨ç½‘ç»œåº”ç”¨ç¨‹åºä¸­æ‰§è¡ŒåŠ å¯†æ“ä½œçš„æ ‡å‡† APIï¼Œæœ€åˆè®¾è®¡ç”¨äºæµè§ˆå™¨ç¯å¢ƒï¼Œä½† Node.js ä¹Ÿå®ç°äº†è¿™ä¸ª APIï¼Œä½¿å¾—æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½å¤Ÿæ‰§è¡Œå®‰å…¨çš„åŠ å¯†æ“ä½œã€‚</p><h3 id="å…³é”®æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#å…³é”®æ¦‚å¿µ"><span>å…³é”®æ¦‚å¿µ</span></a></h3><ul><li><strong>åŠ å¯†(Encryption)</strong>: æ˜¯å°†åŸå§‹æ•°æ®ï¼ˆæ˜æ–‡ï¼‰è½¬æ¢ä¸ºä¸æ˜“è¯»çš„æ ¼å¼ï¼ˆå¯†æ–‡ï¼‰çš„è¿‡ç¨‹ï¼Œä»¥é˜²æ­¢æœªæˆæƒçš„è®¿é—®ã€‚</li><li><strong>è§£å¯†(Decryption)</strong>: æ˜¯å°†åŠ å¯†åçš„æ•°æ®ï¼ˆå¯†æ–‡ï¼‰è½¬æ¢å›åŸå§‹æ ¼å¼ï¼ˆæ˜æ–‡ï¼‰çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿å¯ä»¥ç†è§£å’Œå¤„ç†ã€‚</li><li><strong>å¯†é’¥(Key)</strong>: åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ä¸­ç”¨åˆ°çš„å¯†ç ï¼Œåªæœ‰æ‹¥æœ‰æ­£ç¡®å¯†é’¥çš„äººæ‰èƒ½è§£å¯†è·å–åˆ°å¯†æ–‡ä¸­çš„ä¿¡æ¯ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ç¤ºä¾‹-1"><span>ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</span></a></h3><ol><li><p><strong>ä¿æŠ¤ç”¨æˆ·æ•°æ®</strong>: å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåœ¨çº¿å•†åŠ¡ç½‘ç«™ï¼Œéœ€è¦ä¿æŠ¤ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œå¦‚ä¿¡ç”¨å¡å·ã€æ‰‹æœºå·ç­‰ã€‚ä½¿ç”¨åŠ å¯†æŠ€æœ¯ï¼Œå³ä½¿æ•°æ®è¢«ä¸æ³•åˆ†å­çªƒå–ï¼Œæ²¡æœ‰å¯†é’¥ä»–ä»¬ä¹Ÿæ— æ³•è¯»æ‡‚æ•°æ®å†…å®¹ã€‚</p></li><li><p><strong>å®‰å…¨é€šä¿¡</strong>: åœ¨ä¸¤ä¸ªç³»ç»Ÿé—´ä¼ é€’ä¿¡æ¯æ—¶ï¼Œæ¯”å¦‚æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä½¿ç”¨åŠ å¯†å¯ä»¥ç¡®ä¿ä¼ è¾“è¿‡ç¨‹ä¸­ä¿¡æ¯ä¸è¢«ç¬¬ä¸‰æ–¹çªƒå–ã€‚</p></li><li><p><strong>æ–‡ä»¶åŠ å¯†</strong>: å¦‚æœä½ å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦å°†æ•æ„Ÿä¿¡æ¯ä¿å­˜åœ¨ç”¨æˆ·çš„è®¾å¤‡ä¸Šï¼Œå¯ä»¥ä½¿ç”¨åŠ å¯†ç¡®ä¿å³ä½¿è®¾å¤‡ä¸¢å¤±æˆ–è¢«ç›—ï¼Œæ•°æ®ä¹Ÿä¸ä¼šè½»æ˜“æ³„éœ²ã€‚</p></li></ol><h3 id="å®ç°ç»†èŠ‚" tabindex="-1"><a class="header-anchor" href="#å®ç°ç»†èŠ‚"><span>å®ç°ç»†èŠ‚</span></a></h3><p>Node.js ä¸­å®ç°åŠ å¯†å’Œè§£å¯†ä¸»è¦ä¾èµ–äº<code>crypto</code>æ¨¡å—ä¸­çš„<code>subtle</code>å±æ€§ï¼Œè¯¥å±æ€§æä¾›äº†ä¸€ç³»åˆ—çš„åŠ å¯†ç®—æ³•ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ Node.js è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><h4 id="ç¤ºä¾‹-ä½¿ç”¨-aes-gcm-è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-ä½¿ç”¨-aes-gcm-è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†"><span>ç¤ºä¾‹ï¼šä½¿ç”¨ AES-GCM è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†</span></a></h4><p><strong>æ­¥éª¤ 1:</strong> å¼•å…¥å¿…è¦çš„æ¨¡å—</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>æ­¥éª¤ 2:</strong> åˆ›å»ºå¯†é’¥</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ª AES-GCM ç®—æ³•çš„å¯†é’¥ï¼Œé•¿åº¦ä¸º 256 ä½ã€‚</p><p><strong>æ­¥éª¤ 3:</strong> åŠ å¯†æ•°æ®</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoded</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encoded</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ­¥æˆ‘ä»¬å°†è¦åŠ å¯†çš„æ•°æ®è½¬åŒ–ä¸º Uint8Array æ ¼å¼ï¼Œå¹¶ç”Ÿæˆéšæœºçš„åˆå§‹åŒ–å‘é‡(iv)ï¼Œç„¶åä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</p><p><strong>æ­¥éª¤ 4:</strong> è§£å¯†æ•°æ®</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å¯†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œ iv å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯åœ¨ Node.js ä¸­ä½¿ç”¨ Web Crypto API è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†çš„ç®€å•ç¤ºä¾‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å‡ ä¸ªå…³é”®çš„æ­¥éª¤ï¼šç”Ÿæˆå¯†é’¥ã€åŠ å¯†æ•°æ®ã€è§£å¯†æ•°æ®ï¼Œæ¯ä¸€æ­¥éƒ½è‡³å…³é‡è¦ï¼Œç¼ºä¸€ä¸å¯ã€‚</p><h3 id="exporting-and-importing-keys" tabindex="-1"><a class="header-anchor" href="#exporting-and-importing-keys"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#exporting-and-importing-keys" target="_blank" rel="noopener noreferrer">Exporting and importing keys</a></span></a></h3><p>Node.js ä¸­çš„ Web Crypto API æä¾›äº†ä¸€å¥—ç”¨äºæ‰§è¡ŒåŠ å¯†æ“ä½œï¼ˆå¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­‰ï¼‰çš„å·¥å…·ã€‚åœ¨è¿™ä¸ª API ä¸­ï¼Œå¯†é’¥ç®¡ç†æ˜¯ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬äº†å¯†é’¥çš„å¯¼å…¥ï¼ˆimportingï¼‰å’Œå¯¼å‡ºï¼ˆexportingï¼‰ã€‚</p><h3 id="å¯†é’¥å¯¼å…¥å’Œå¯¼å‡ºçš„æ„ä¹‰" tabindex="-1"><a class="header-anchor" href="#å¯†é’¥å¯¼å…¥å’Œå¯¼å‡ºçš„æ„ä¹‰"><span>å¯†é’¥å¯¼å…¥å’Œå¯¼å‡ºçš„æ„ä¹‰</span></a></h3><ol><li><strong>å¯¼å…¥ï¼ˆImportingï¼‰</strong>ï¼šå°†å¤–éƒ¨ç”Ÿæˆçš„å¯†é’¥ï¼ˆå¯èƒ½æ˜¯ä»å…¶å®ƒç³»ç»Ÿæˆ–æ–‡ä»¶ä¸­è·å–çš„ï¼‰åŠ è½½åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œä»¥ä¾¿ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡ŒåŠ å¯†ã€è§£å¯†ç­‰æ“ä½œã€‚</li><li><strong>å¯¼å‡ºï¼ˆExportingï¼‰</strong>ï¼šä»ä½ çš„åº”ç”¨ä¸­æå–å¯†é’¥ï¼Œå¹¶ä»¥æŸç§æ ¼å¼å­˜å‚¨æˆ–å‘é€ç»™å…¶ä»–ç³»ç»Ÿï¼Œä½¿å¾—å…¶ä»–ç³»ç»Ÿèƒ½å¤Ÿä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ å¯†è§£å¯†æ“ä½œã€‚</li></ol><p>è¿™ä¸¤ä¸ªè¿‡ç¨‹å¯¹äºæ•°æ®çš„å®‰å…¨æ€§è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦è·¨ç³»ç»Ÿå…±äº«å¯†é’¥çš„åœºæ™¯ä¸‹ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬çœ‹å‡ ä¸ªç®€åŒ–çš„ä¾‹å­æ¥ç†è§£è¿™äº›æ¦‚å¿µï¼š</p><h4 id="_1-å¯¼å…¥ä¸€ä¸ªå¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_1-å¯¼å…¥ä¸€ä¸ªå¯†é’¥"><span>1. å¯¼å…¥ä¸€ä¸ªå¯†é’¥</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç”±å…¶ä»–ç³»ç»Ÿæä¾›çš„å¯†é’¥ï¼Œç°åœ¨ä½ å¸Œæœ›åœ¨ Node.js åº”ç”¨ä¸­ä½¿ç”¨è¿™ä¸ªå¯†é’¥æ¥è§£å¯†ä¸€æ®µä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ä»å¤–éƒ¨ç³»ç»Ÿè·å¾—çš„å¯†é’¥ï¼Œé€šå¸¸ä»¥Base64æˆ–å…¶ä»–ç¼–ç å½¢å¼æä¾›</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> externalKeyData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¯†é’¥æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä½¿ç”¨çš„ç®—æ³•åŠå…¶å‚æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å°†å¯†é’¥æ•°æ®è½¬æ¢æˆé€‚åˆå¯¼å…¥çš„æ ¼å¼</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keyBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">externalKeyData</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯¼å…¥å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¡¨ç¤ºä»¥åŸå§‹äºŒè¿›åˆ¶æ ¼å¼å¯¼å…¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyBuffer</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å…è®¸å¯¼å‡ºå¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å…è®¸ä½¿ç”¨å¯†é’¥è¿›è¡Œçš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ä½¿ç”¨å¯¼å…¥çš„å¯†é’¥è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚è§£å¯†</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-å¯¼å‡ºä¸€ä¸ªå¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_2-å¯¼å‡ºä¸€ä¸ªå¯†é’¥"><span>2. å¯¼å‡ºä¸€ä¸ªå¯†é’¥</span></a></h4><p>ç°åœ¨ï¼Œå‡è®¾ä½ åœ¨è‡ªå·±çš„ Node.js åº”ç”¨ä¸­ç”Ÿæˆäº†ä¸€ä¸ªå¯†é’¥ï¼Œä½ éœ€è¦å°†è¿™ä¸ªå¯†é’¥å®‰å…¨åœ°ä¼ è¾“ç»™å¦ä¸€ä¸ªç³»ç»Ÿä½¿ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä½¿ç”¨çš„ç®—æ³•åŠå…¶å‚æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // å¯¼å‡ºå¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exportKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">keyBuffer</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // å°†å¯†é’¥è½¬æ¢ä¸ºé€‚åˆä¼ è¾“çš„æ ¼å¼ï¼Œæ¯”å¦‚Base64</span></span>
<span class="line"><span style="color:#81A1C1;">      const</span><span style="color:#D8DEE9;"> exportedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyBuffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">      // ç°åœ¨ä½ å¯ä»¥å°†exportedKeyå‘é€ç»™éœ€è¦çš„ç³»ç»Ÿ</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>å¯¼å…¥å’Œå¯¼å‡ºå¯†é’¥æ—¶éœ€è¦æŒ‡å®šæ­£ç¡®çš„æ ¼å¼å’Œç®—æ³•å‚æ•°ï¼Œä»¥ç¡®ä¿å¯†é’¥çš„æœ‰æ•ˆæ€§å’Œå®‰å…¨æ€§ã€‚</li><li>åœ¨å¤„ç†å¯†é’¥å’Œæ•æ„Ÿæ•°æ®æ—¶ï¼Œå®‰å…¨æªæ–½éå¸¸å…³é”®ã€‚ä¾‹å¦‚ï¼Œé¿å…åœ¨ä¸å®‰å…¨çš„æ¸ é“ä¸Šæ˜æ–‡ä¼ è¾“å¯†é’¥ã€‚</li><li>Node.js çš„ Web Crypto API æä¾›çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦å¼€å‘è€…å¯¹åŠ å¯†å­¦æœ‰ä¸€å®šçš„äº†è§£ã€‚</li></ul><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°åœ¨å®é™…åº”ç”¨ä¸­å¦‚ä½•ä½¿ç”¨ Node.js å¤„ç†å¯†é’¥çš„å¯¼å…¥å’Œå¯¼å‡ºï¼Œè¿™å¯¹äºç»´æŠ¤ç³»ç»Ÿé—´æ•°æ®åŠ å¯†çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="wrapping-and-unwrapping-keys" tabindex="-1"><a class="header-anchor" href="#wrapping-and-unwrapping-keys"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#wrapping-and-unwrapping-keys" target="_blank" rel="noopener noreferrer">Wrapping and unwrapping keys</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®ºåˆ°åœ¨ Node.js ä¸­çš„å¯†é’¥åŒ…è£…ï¼ˆWrappingï¼‰å’Œè§£åŒ…ï¼ˆUnwrappingï¼‰æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸€ç§ç‰¹å®šçš„æ•°æ®åŠ å¯†ä¸è§£å¯†è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°ä¸¤å¯¹å¯†é’¥ï¼šä¸€ä¸ªç”¨æ¥â€œåŒ…è£…â€ï¼ˆå³åŠ å¯†ï¼‰å¦ä¸€å¯¹å¯†é’¥ï¼Œä»¥åŠä¸€ä¸ªç”¨æ¥â€œè§£åŒ…â€ï¼ˆå³è§£å¯†ï¼‰é‚£å¯¹è¢«åŒ…è£…çš„å¯†é’¥ã€‚è¿™é€šå¸¸ç”¨äºå®‰å…¨åœ°ä¼ è¾“æˆ–å­˜å‚¨å¯†é’¥ã€‚åœ¨åŠ å¯†æœ¯è¯­ä¸­ï¼Œâ€œåŒ…è£…â€çš„å¯†é’¥ç§°ä¸ºåŒ…è£…å¯†é’¥ï¼Œè€Œè¢«åŠ å¯†çš„å¯†é’¥ç§°ä¸ºåŒ…è£…ç›®æ ‡å¯†é’¥ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½é€šè¿‡ Web Crypto API å®ç°ï¼Œè¯¥ API æä¾›äº†ä¸€ä¸ªåŠ å¯†çš„æ ‡å‡†æ¥å£ï¼Œå…è®¸ä½ åœ¨åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œå„ç§å¯†ç å­¦æ“ä½œã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“ç”¨æˆ·åŠ å¯†æ•°æ®çš„åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯†é’¥å°è£…æŠ€æœ¯æ¥ç¡®ä¿å¯†é’¥çš„å®‰å…¨ä¼ è¾“ã€‚</p><h4 id="æ­¥éª¤-1-ç”Ÿæˆå¯†é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-ç”Ÿæˆå¯†é’¥"><span>æ­¥éª¤ 1: ç”Ÿæˆå¯†é’¥</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¯¹ç”¨äºåŠ è§£å¯†æ•°æ®çš„å¯†é’¥ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæ•°æ®å¯†é’¥â€ï¼‰ï¼Œä»¥åŠä¸€å¯¹ç”¨äºåŒ…è£…å’Œè§£åŒ…ç¬¬ä¸€å¯¹å¯†é’¥çš„å¯†é’¥ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œåŒ…è£…å¯†é’¥â€ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeys</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> wrapKeyAlgorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // RSAå¯†é’¥å¤§å°</span></span>
<span class="line"><span style="color:#88C0D0;">    publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0x01</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x00</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x01</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> dataKeyAlgorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”ŸæˆåŒ…è£…å¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> wrapKeyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">wrapKeyAlgorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">wrapKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">unwrapKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆæ•°æ®å¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> dataKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">dataKeyAlgorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> wrapKeyPair</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> dataKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-åŒ…è£…å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-åŒ…è£…å¯†é’¥"><span>æ­¥éª¤ 2: åŒ…è£…å¯†é’¥</span></a></h4><p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨åŒ…è£…å¯†é’¥å¯¹æ•°æ®å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼ˆåŒ…è£…ï¼‰ã€‚è¿™æ ·ï¼Œå³ä½¿æœ‰äººéæ³•è·å–äº†è¢«åŒ…è£…çš„å¯†é’¥ï¼Œä¹Ÿæ— æ³•åœ¨æ²¡æœ‰åŒ…è£…å¯†é’¥çš„æƒ…å†µä¸‹ä½¿ç”¨å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> wrapKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">wrapKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyToWrap</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> wrappedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">wrapKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯¼å‡ºå¯†é’¥çš„æ ¼å¼</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyToWrap</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¢«åŒ…è£…çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    wrapKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç”¨äºåŒ…è£…çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> wrappedKey</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™æ˜¯ä¸€ä¸ª ArrayBuffer å¯¹è±¡</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-3-è§£åŒ…å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-è§£åŒ…å¯†é’¥"><span>æ­¥éª¤ 3: è§£åŒ…å¯†é’¥</span></a></h4><p>æœ€åï¼Œåªæœ‰åœ¨æ­£ç¡®çš„åŒ…è£…å¯†é’¥å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ”¶ä»¶äººæ‰èƒ½è§£åŒ…ï¼ˆè§£å¯†ï¼‰è¢«åŒ…è£…çš„å¯†é’¥ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è§£å¯†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> unwrapKey</span><span style="color:#ECEFF4;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">  wrappedKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  unwrapKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  unwrappedKeyAlgorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  keyUsage</span></span>
<span class="line"><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> unwrappedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unwrapKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¢«åŒ…è£…å¯†é’¥çš„æ ¼å¼</span></span>
<span class="line"><span style="color:#D8DEE9;">    wrappedKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¢«åŒ…è£…çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    unwrapKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç”¨äºè§£åŒ…çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // ä½¿ç”¨ç›¸åŒçš„ç®—æ³•å‚æ•°</span></span>
<span class="line"><span style="color:#D8DEE9;">    unwrappedKeyAlgorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¢«è§£åŒ…å¯†é’¥çš„ç®—æ³•</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyUsage</span><span style="color:#616E88;"> // è¢«è§£åŒ…å¯†é’¥çš„ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> unwrappedKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä¾¿æ˜¯åœ¨ä¸å®‰å…¨çš„ç¯å¢ƒä¸­ï¼Œå¯†é’¥çš„ä¼ è¾“å’Œå­˜å‚¨ä¹Ÿèƒ½ä¿æŒä¸€å®šçš„å®‰å…¨æ€§ï¼Œå› ä¸ºæ²¡æœ‰åŒ…è£…å¯†é’¥ï¼Œå°±æ— æ³•è§£æå‡ºåŸå§‹çš„æ•°æ®å¯†é’¥æ¥åŠ è§£å¯†ä¿¡æ¯ã€‚è¿™åœ¨éœ€è¦é«˜åº¦ä¿å¯†æ€§çš„æ•°æ®ä¼ è¾“å’Œå­˜å‚¨åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨çº¿é“¶è¡Œç³»ç»Ÿã€åŒ»ç–—ä¿¡æ¯ç³»ç»Ÿç­‰ã€‚</p><h3 id="sign-and-verify" tabindex="-1"><a class="header-anchor" href="#sign-and-verify"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#sign-and-verify" target="_blank" rel="noopener noreferrer">Sign and verify</a></span></a></h3><p>å½“æˆ‘ä»¬åœ¨è°ˆè®º Node.js ä¸­çš„&quot;Sign and verify&quot;ï¼ˆç­¾åä¸éªŒè¯ï¼‰ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸€ç§ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹çš„æœºåˆ¶ã€‚è¿™æ¶‰åŠåˆ°äº†åŠ å¯†æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯éå¯¹ç§°åŠ å¯†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªå…³é”®å…ƒç´ ï¼šç§é’¥å’Œå…¬é’¥ã€‚ç§é’¥é€šå¸¸ç”±æ¶ˆæ¯çš„å‘é€æ–¹æŒæœ‰ï¼Œç”¨äºåˆ›å»ºæ¶ˆæ¯çš„æ•°å­—ç­¾åï¼›è€Œå…¬é’¥åˆ™æ˜¯ç”±æ¶ˆæ¯æ¥æ”¶æ–¹æŒæœ‰ï¼Œç”¨äºéªŒè¯è¯¥ç­¾åã€‚</p><h3 id="ç­¾åä¸éªŒè¯çš„è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#ç­¾åä¸éªŒè¯çš„è¿‡ç¨‹"><span>ç­¾åä¸éªŒè¯çš„è¿‡ç¨‹</span></a></h3><ol><li><p><strong>ç”Ÿæˆç­¾å</strong>ï¼š</p><ul><li>å‘é€æ–¹æœ‰ä¸€æ®µé‡è¦ä¿¡æ¯éœ€è¦å‘é€ç»™æ¥æ”¶æ–¹ã€‚</li><li>å‘é€æ–¹ä½¿ç”¨è‡ªå·±çš„ç§é’¥å¯¹è¿™æ®µä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆä¸€ä¸ªâ€œç­¾åâ€ã€‚</li></ul></li><li><p><strong>éªŒè¯ç­¾å</strong>ï¼š</p><ul><li>æ¥æ”¶æ–¹æ”¶åˆ°è¿™æ®µä¿¡æ¯ä»¥åŠå®ƒçš„ç­¾åã€‚</li><li>æ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬é’¥æ¥è§£å¯†ç­¾åã€‚</li><li>å¦‚æœä½¿ç”¨å…¬é’¥å¯ä»¥æˆåŠŸè§£å¯†ç­¾åå¹¶ä¸”è§£å¯†åçš„ä¿¡æ¯ä¸æ¥æ”¶åˆ°çš„åŸå§‹ä¿¡æ¯åŒ¹é…ï¼Œé‚£ä¹ˆå°±è¯æ˜äº†è¿™æ¡ä¿¡æ¯æ˜¯ç”±æŒæœ‰ç›¸åº”ç§é’¥çš„å‘é€æ–¹æ‰€å‘é€ï¼Œå¹¶ä¸”åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚</li></ul></li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p><strong>ä¾‹å­ 1ï¼šè½¯ä»¶æ›´æ–°</strong></p><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªè½¯ä»¶ï¼Œè½¯ä»¶å¼€å‘è€…å‘å¸ƒäº†ä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚ä¸ºäº†ç¡®ä¿ä¸‹è½½çš„æ›´æ–°æ–‡ä»¶æ˜¯ç”±çœŸæ­£çš„å¼€å‘è€…æä¾›ä¸”åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ä»–çš„ç§é’¥æ¥ç­¾åè¿™ä¸ªæ›´æ–°æ–‡ä»¶ã€‚ç”¨æˆ·åœ¨ä¸‹è½½æ›´æ–°æ–‡ä»¶æ—¶åŒæ ·ä¼šå¾—åˆ°è¿™ä¸ªç­¾åï¼Œç„¶åä½¿ç”¨å¼€å‘è€…çš„å…¬é’¥æ¥éªŒè¯ç­¾åã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œè¯´æ˜è¿™ä¸ªæ›´æ–°æ˜¯å®‰å…¨çš„ã€‚</p><p><strong>ä¾‹å­ 2ï¼šç”µå­é‚®ä»¶å®‰å…¨</strong></p><p>Alice æƒ³å‘ Bob å‘é€ä¸€å°åŠ å¯†çš„ç”µå­é‚®ä»¶ï¼Œç¡®ä¿åªæœ‰ Bob èƒ½å¤Ÿè¯»å–å®ƒã€‚Alice å°†é‚®ä»¶å†…å®¹ç”¨ Bob çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼ˆè¿™ä¿è¯äº†åªæœ‰æ‹¥æœ‰å¯¹åº”ç§é’¥çš„ Bob èƒ½è§£å¯†ï¼‰ã€‚åŒæ—¶ï¼ŒAlice è¿˜å¯ä»¥ä½¿ç”¨å¥¹è‡ªå·±çš„ç§é’¥å¯¹é‚®ä»¶è¿›è¡Œç­¾åã€‚å½“ Bob æ”¶åˆ°é‚®ä»¶æ—¶ï¼Œä»–é¦–å…ˆç”¨ Alice çš„å…¬é’¥éªŒè¯ç­¾åï¼Œç¡®è®¤é‚®ä»¶ç¡®å®æ˜¯ç”± Alice å‘é€ä¸”æœªè¢«ç¯¡æ”¹ï¼Œç„¶åç”¨è‡ªå·±çš„ç§é’¥è§£å¯†é‚®ä»¶å†…å®¹ã€‚</p><p><strong>ä¾‹å­ 3ï¼šåŒºå—é“¾çš„å·¥ä½œåŸç†</strong></p><p>åœ¨åŒºå—é“¾ä¸­ï¼Œæ¯ç¬”äº¤æ˜“éƒ½éœ€è¦ç”±å‘é€æ–¹çš„ç§é’¥ç­¾åã€‚è¿™ä¸ªç­¾åéšåä¼šè¢«ç½‘ç»œä¸­çš„å…¶ä»–å‚ä¸è€…ï¼ˆèŠ‚ç‚¹ï¼‰ä½¿ç”¨å…¬é’¥éªŒè¯ã€‚è¿™ç§æœºåˆ¶ä¸ä»…ç¡®ä¿äº†äº¤æ˜“çš„å®‰å…¨æ€§ï¼Œä¹Ÿæ”¯æŒäº†å»ä¸­å¿ƒåŒ–çš„ä¿¡ä»»æœºåˆ¶ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œâ€œç­¾åä¸éªŒè¯â€çš„æœºåˆ¶åœ¨å½“ä»Šæ•°å­—ä¸–ç•Œä¸­æ‰®æ¼”ç€æå…¶é‡è¦çš„è§’è‰²ï¼Œå®ƒå¸®åŠ©ç¡®ä¿äº†æ•°æ®çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ï¼Œæ— è®ºæ˜¯åœ¨é‡‘èäº¤æ˜“ã€è½¯ä»¶åˆ†å‘ã€é€šä¿¡é¢†åŸŸè¿˜æ˜¯å…¶ä»–è®¸å¤šé¢†åŸŸã€‚</p><h3 id="deriving-bits-and-keys" tabindex="-1"><a class="header-anchor" href="#deriving-bits-and-keys"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#deriving-bits-and-keys" target="_blank" rel="noopener noreferrer">Deriving bits and keys</a></span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ&quot;Deriving bits and keys&quot;ï¼ˆæ´¾ç”Ÿä½å’Œå¯†é’¥ï¼‰æ˜¯æŒ‡ä»ç°æœ‰çš„å¯†é’¥ææ–™ï¼ˆå¦‚å¯†ç æˆ–å…¶ä»–å¯†é’¥ï¼‰ç”Ÿæˆæ–°çš„å¯†é’¥æˆ–éšæœºä½åºåˆ—çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹äºå®ç°åŠ å¯†ç®—æ³•ä¸­çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é€šå¸¸ç”¨äºåˆ›å»ºåŠ å¯†æ“ä½œæ‰€éœ€çš„å¯†é’¥ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ç”¨æˆ·æä¾›çš„å¯†ç æˆ–åŸå§‹å¯†é’¥ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å¢å¼ºå®‰å…¨æ€§ï¼Œå¹¶ç¡®ä¿ç”Ÿæˆçš„å¯†é’¥é€‚åˆç‰¹å®šçš„åŠ å¯†ä»»åŠ¡ã€‚</p><h3 id="æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒæ¦‚å¿µ"><span>æ ¸å¿ƒæ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><strong>å¯†é’¥</strong>ï¼šåœ¨åŠ å¯†è¿‡ç¨‹ä¸­ç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®çš„å‚æ•°ã€‚å¯†é’¥åƒæ˜¯ä¸€æŠŠé”çš„é’¥åŒ™ï¼Œåªæœ‰æŒæœ‰æ­£ç¡®é’¥åŒ™çš„äººæ‰èƒ½è§£é”ã€‚</li><li><strong>æ´¾ç”Ÿ</strong>ï¼šæ´¾ç”Ÿæ˜¯ä»ä¸€ä¸ªå·²çŸ¥å€¼ï¼ˆå¦‚å¯†ç ï¼‰ç”Ÿæˆå¦ä¸€ä¸ªå€¼ï¼ˆå¦‚å¯†é’¥ï¼‰çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¾€å¾€æ¶‰åŠæ•°å­¦å‡½æ•°ï¼Œç›®çš„æ˜¯ç”Ÿæˆéš¾ä»¥é¢„æµ‹å’Œå›æº¯çš„ç»“æœã€‚</li><li><strong>Web Crypto API</strong>ï¼šNode.js å®ç°äº†ä¸€å¥—ç§°ä¸º Web Crypto API çš„åŠ å¯†æ ‡å‡†ï¼Œå®ƒæä¾›äº†åŠ å¯†å’Œå¯†é’¥ç®¡ç†çš„åŠŸèƒ½ã€‚&quot;Deriving bits and keys&quot; æ­£æ˜¯é€šè¿‡è¿™ä¸ª API æ¥å®ç°çš„ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>ä¸‹é¢æ˜¯ä¸€äº›å®é™…çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li><p><strong>ç”¨æˆ·å¯†ç åŠ å¯†</strong>ï¼šå½“ç”¨æˆ·è®¾ç½®å¯†ç æ—¶ï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨æ´¾ç”ŸæŠ€æœ¯ä»è¯¥å¯†ç ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå¯†é’¥æ¥åŠ å¯†ç”¨æˆ·æ•°æ®ã€‚å³ä½¿æœ‰äººæ‹¿åˆ°äº†åŠ å¯†åçš„æ•°æ®ï¼Œæ²¡æœ‰æ´¾ç”Ÿå‡ºçš„å¯†é’¥ä¹Ÿæ— æ³•è§£å¯†ã€‚</p></li><li><p><strong>å®‰å…¨é€šä¿¡</strong>ï¼šåœ¨ä¸¤å°è®¾å¤‡ä¹‹é—´å»ºç«‹å®‰å…¨é€šä¿¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§å«åšå¯†é’¥åå•†çš„æ–¹æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾å¤‡ç”Ÿæˆä¸´æ—¶çš„å¯†é’¥ææ–™ï¼Œå¹¶é€šè¿‡å®‰å…¨çš„æ–¹å¼å°†å…¶æ´¾ç”Ÿå‡ºçš„å¯†é’¥ä¼ é€’ç»™å¦ä¸€å°è®¾å¤‡ã€‚è¿™æ ·ï¼Œå³ä½¿æœ‰äººæˆªè·äº†ä¼ é€’è¿‡ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•å¾—çŸ¥æœ€ç»ˆçš„å¯†é’¥æ˜¯ä»€ä¹ˆã€‚</p></li></ol><h3 id="ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç "><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>å‡è®¾ä½ æƒ³ä»ç”¨æˆ·çš„å¯†ç ä¸­æ´¾ç”Ÿå‡ºä¸€ä¸ªåŠ å¯†å¯†é’¥ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Node.js ä¸­çš„ Web Crypto API æ¥å®Œæˆè¿™é¡¹å·¥ä½œçš„åŸºæœ¬æ­¥éª¤ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> deriveKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†ç”¨æˆ·çš„å¯†ç è½¬æ¢ä¸º ArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> enc</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> passwordBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> enc</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¯¼å…¥å¯†ç ï¼Œä½œä¸ºæ´¾ç”Ÿå¯†é’¥çš„åŸºç¡€</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    passwordBuffer</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveBits</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰æ´¾ç”Ÿå¯†é’¥çš„å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> deriveKeyParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨éšæœºç›å€¼</span></span>
<span class="line"><span style="color:#88C0D0;">    iterations</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿­ä»£æ¬¡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ´¾ç”Ÿå‡ºå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    deriveKeyParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // ç›®æ ‡å¯†é’¥çš„ç®—æ³•å’Œé•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">user_password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°æ´¾ç”Ÿå‡ºçš„å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†ç”¨æˆ·çš„å¯†ç è½¬æ¢æˆ <code>ArrayBuffer</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>importKey</code> æ–¹æ³•å°†è¿™ä¸ªç¼“å†²åŒºå¯¼å…¥ä¸ºåŠ å¯†æ“ä½œçš„åŸºç¡€ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ´¾ç”Ÿå¯†é’¥çš„å‚æ•°ï¼ŒåŒ…æ‹¬ä½¿ç”¨ PBKDF2 ç®—æ³•ã€éšæœºç›å€¼ã€è¿­ä»£æ¬¡æ•°ä»¥åŠå“ˆå¸Œå‡½æ•° SHA-256ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>deriveKey</code> æ–¹æ³•ç”Ÿæˆå¯†é’¥ï¼ŒæŒ‡å®šæˆ‘ä»¬æƒ³è¦çš„å¯†é’¥ç®—æ³•ï¼ˆAES-GCMï¼‰å’Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼Œå¹¶è§„å®šå¯†é’¥çš„ç”¨é€”ï¼ˆåŠ å¯†å’Œè§£å¯†ï¼‰ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»ä¸€ä¸ªç®€å•çš„å¯†ç æ´¾ç”Ÿå‡ºä¸€ä¸ªå¤æ‚ä¸”å®‰å…¨çš„åŠ å¯†å¯†é’¥ï¼Œè¿›ä¸€æ­¥æé«˜äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><h3 id="digest" tabindex="-1"><a class="header-anchor" href="#digest"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#digest" target="_blank" rel="noopener noreferrer">Digest</a></span></a></h3><p>Node.js ä¸­çš„<code>Digest</code>åŠŸèƒ½æ˜¯ä¸€ä¸ªæ¥è‡ªäº Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºç”Ÿæˆæ•°æ®ï¼ˆå¦‚æ–‡ä»¶æˆ–æ¶ˆæ¯ï¼‰çš„æ‘˜è¦ã€‚ç®€å•æ¥è¯´ï¼Œæ‘˜è¦å°±æ˜¯ä¸€ç§é€šè¿‡æ•£åˆ—ç®—æ³•ç”Ÿæˆçš„çŸ­å°çš„å›ºå®šå¤§å°çš„æ•°æ®è¡¨ç¤ºå½¢å¼ï¼Œé€šå¸¸ç”¨äºç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚å½“ä½ å¯¹ç›¸åŒçš„æ•°æ®ä½¿ç”¨ç›¸åŒçš„æ•£åˆ—ç®—æ³•æ—¶ï¼Œä½ æ€»ä¼šå¾—åˆ°ç›¸åŒçš„æ‘˜è¦å€¼ï¼Œä½†å³ä½¿åªæœ‰å¾ˆå°çš„æ•°æ®å˜åŒ–ï¼Œäº§ç”Ÿçš„æ‘˜è¦ä¹Ÿä¼šå¤§ä¸ç›¸åŒï¼Œè¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆæ£€æµ‹æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦æ‘˜è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦æ‘˜è¦"><span>ä¸ºä»€ä¹ˆéœ€è¦æ‘˜è¦ï¼Ÿ</span></a></h3><p>æ‘˜è¦åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>éªŒè¯æ–‡ä»¶å®Œæ•´æ€§</strong>ï¼šä¸‹è½½æ–‡ä»¶æ—¶ï¼Œç½‘ç«™ç»å¸¸æä¾›æ–‡ä»¶çš„æ‘˜è¦å€¼ï¼ˆå¦‚ SHA-256 æ‘˜è¦ï¼‰ã€‚ç”¨æˆ·å¯ä»¥åœ¨ä¸‹è½½æ–‡ä»¶åè®¡ç®—å…¶æ‘˜è¦ï¼Œå¹¶ä¸ç½‘ç«™æä¾›çš„æ‘˜è¦è¿›è¡Œå¯¹æ¯”ï¼Œä»¥éªŒè¯æ–‡ä»¶æ˜¯å¦åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚</li><li><strong>å¯†ç å­˜å‚¨</strong>ï¼šå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œç³»ç»Ÿä¸åº”ç›´æ¥å­˜å‚¨ç”¨æˆ·å¯†ç çš„æ˜æ–‡ã€‚ç›¸åï¼Œç³»ç»Ÿä¼šå­˜å‚¨å¯†ç çš„æ‘˜è¦ï¼Œå¹¶åœ¨ç”¨æˆ·ç™»å½•æ—¶æ¯”è¾ƒè¾“å…¥å¯†ç çš„æ‘˜è¦å’Œå­˜å‚¨çš„æ‘˜è¦ã€‚å› ä¸ºå³ä½¿æ˜¯å¾®å°çš„å¯†ç å˜åŠ¨ä¹Ÿä¼šäº§ç”Ÿæˆªç„¶ä¸åŒçš„æ‘˜è¦ï¼Œè¿™ç§æ–¹æ³•èƒ½æœ‰æ•ˆé˜²æ­¢å¯†ç è¢«çªƒå–ã€‚</li><li><strong>ç¼“å­˜éªŒè¯</strong>ï¼šWeb åº”ç”¨å¯ä»¥é€šè¿‡æ¯”è¾ƒèµ„æºå†…å®¹çš„æ‘˜è¦æ¥åˆ¤æ–­å†…å®¹æ˜¯å¦æ›´æ”¹ï¼Œä»è€Œå†³å®šæ˜¯å¦éœ€è¦é‡æ–°åŠ è½½èµ„æºï¼Œè¿™æ ·å¯ä»¥æé«˜åº”ç”¨çš„æ•ˆç‡ã€‚</li></ul><h3 id="node-js-ä¸­å¦‚ä½•ä½¿ç”¨-digest" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­å¦‚ä½•ä½¿ç”¨-digest"><span>Node.js ä¸­å¦‚ä½•ä½¿ç”¨ Digest</span></a></h3><p>åœ¨ Node.js ä¸­ä½¿ç”¨ <code>Digest</code> åŠŸèƒ½ï¼Œé¦–å…ˆä½ éœ€è¦äº†è§£å®ƒæ˜¯åŸºäº Web Crypto API å®ç°çš„ï¼Œä½ å¯ä»¥é€šè¿‡ <code>crypto.webcrypto</code> æä¾›çš„ <code>subtle</code> å±æ€§æ¥è®¿é—®å®ƒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•è®¡ç®—å­—ç¬¦ä¸² &quot;Hello, world!&quot; çš„ SHA-256 æ‘˜è¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> calculateDigest</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†å­—ç¬¦ä¸²è½¬æ¢æˆ ArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨SHA-256ç®—æ³•è®¡ç®—æ‘˜è¦</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> digest</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è½¬æ¢æ‘˜è¦ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä»¥ä¾¿é˜…è¯»</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashArray</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Array</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">digest</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashHex</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> hashArray</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">map</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">padStart</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hashHex</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">calculateDigest</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ <code>TextEncoder</code> å°†æ™®é€šå­—ç¬¦ä¸²è½¬æ¢ä¸º <code>ArrayBuffer</code>ï¼Œå› ä¸º <code>subtle.digest</code> æ–¹æ³•éœ€è¦çš„æ•°æ®ç±»å‹æ˜¯ <code>ArrayBuffer</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>subtle.digest</code> æ–¹æ³•å¹¶æŒ‡å®šä½¿ç”¨ <code>&quot;SHA-256&quot;</code> æ•£åˆ—ç®—æ³•æ¥è®¡ç®—æ‘˜è¦ã€‚æœ€åï¼Œæˆ‘ä»¬å°†å¾—åˆ°çš„æ‘˜è¦ï¼ˆä¸€ä¸ª <code>ArrayBuffer</code>ï¼‰è½¬æ¢æˆäº†ä¸€ä¸ªæ›´æ˜“äºé˜…è¯»çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚</p><h3 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h3><p><code>Digest</code> æ˜¯ä¸€ä¸ªç”Ÿæˆæ•°æ®æ‘˜è¦çš„å¼ºå¤§å·¥å…·ï¼Œç”¨äºç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥å¼€å§‹åœ¨è‡ªå·±çš„ Node.js åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæ— è®ºæ˜¯ä¸ºäº†éªŒè¯æ•°æ®ã€å®‰å…¨åœ°å­˜å‚¨å¯†ç ï¼Œè¿˜æ˜¯ä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚è®°ä½ï¼Œåœ¨å¤„ç†æ•æ„Ÿæ•°æ®æ—¶ï¼Œæ­£ç¡®ä½¿ç”¨æ‘˜è¦å’Œå…¶ä»–åŠ å¯†æŠ€æœ¯æ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥ä¿æŠ¤æ•°æ®å…é­æœªæˆæƒè®¿é—®ã€‚</p><h2 id="algorithm-matrix" tabindex="-1"><a class="header-anchor" href="#algorithm-matrix"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#algorithm-matrix" target="_blank" rel="noopener noreferrer">Algorithm matrix</a></span></a></h2><p>Node.js çš„ç‰ˆæœ¬ 21.7.1 ä¸­å¼•å…¥çš„â€œAlgorithm matrixâ€æ˜¯æŒ‡åœ¨å…¶ Web Crypto API éƒ¨åˆ†æä¾›çš„ä¸€ä¸ªè¯¦ç»†çš„ç®—æ³•æ”¯æŒçŸ©é˜µã€‚åœ¨è§£é‡Šè¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><ul><li><p><strong>Node.js</strong>: Node.js æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</p></li><li><p><strong>Web Crypto API</strong>: è¿™æ˜¯ä¸€ä¸ªä¸º Web åº”ç”¨æä¾›åŠ å¯†åŠŸèƒ½çš„ APIã€‚å®ƒå…è®¸å¼€å‘è€…æ‰§è¡Œå¦‚åŠ å¯†å’Œè§£å¯†ã€ç­¾åæ¶ˆæ¯ã€ç”Ÿæˆéšæœºæ•°ç­‰å®‰å…¨æ“ä½œã€‚</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯-algorithm-matrix" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-algorithm-matrix"><span>ä»€ä¹ˆæ˜¯ Algorithm Matrix</span></a></h3><p>ç®€è€Œè¨€ä¹‹ï¼Œâ€œAlgorithm matrixâ€æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ˜¾ç¤ºäº† Node.js çš„ Web Crypto API æ”¯æŒå“ªäº›åŠ å¯†ç®—æ³•ã€‚è¿™åŒ…æ‹¬äº†åŠ å¯†ç®—æ³•ã€å“ˆå¸Œç®—æ³•ã€ç­¾åç®—æ³•ç­‰å¤šç§ç±»å‹ã€‚æ¯ç§ç®—æ³•éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨é€”å’Œä¼˜åŠ¿ï¼Œé€‰æ‹©æ­£ç¡®çš„ç®—æ³•å¯¹äºç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¢è®¨å‡ ä¸ªä½¿ç”¨ Node.js Web Crypto APIï¼ˆåŠå…¶ç®—æ³•çŸ©é˜µï¼‰çš„å®é™…ä¾‹å­ï¼š</p><h4 id="ç¤ºä¾‹-1-æ•°æ®åŠ å¯†ä¸è§£å¯†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ•°æ®åŠ å¯†ä¸è§£å¯†"><span>ç¤ºä¾‹ 1: æ•°æ®åŠ å¯†ä¸è§£å¯†</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰ç®—æ³•æ¥åŠ å¯†ç”¨æˆ·æ•°æ®ã€‚å½“éœ€è¦è¯»å–è¿™äº›æ•°æ®æ—¶ï¼Œå†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡Œè§£å¯†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptDecryptExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">secret data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è§£å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encrypted</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &#39;secret data&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">encryptDecryptExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-æ•°å­—ç­¾åå’ŒéªŒè¯" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ•°å­—ç­¾åå’ŒéªŒè¯"><span>ç¤ºä¾‹ 2: æ•°å­—ç­¾åå’ŒéªŒè¯</span></a></h4><p>å¦‚æœä½ éœ€è¦éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºï¼Œæ•°å­—ç­¾åæ˜¯ä¸€é¡¹å¾ˆå¥½çš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³ç¡®ä¿å‘é€ç»™ç”¨æˆ·çš„æ–‡ä»¶æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signVerifyExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message to sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç­¾å</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // éªŒè¯</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">isValid</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // true or false</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">signVerifyExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä½•åˆ©ç”¨ Node.js çš„ Web Crypto API å’Œå®ƒæ‰€æ”¯æŒçš„ç®—æ³•çŸ©é˜µæ¥å®ç°åŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­‰æ“ä½œã€‚è¿™åªæ˜¯å†°å±±ä¸€è§’ï¼Œå®é™…ä¸Š Web Crypto API æ”¯æŒè®¸å¤šå…¶ä»–å¤æ‚ä¸”å¼ºå¤§çš„æ“ä½œï¼Œèƒ½å¤Ÿæ»¡è¶³å„ç§å®‰å…¨éœ€æ±‚ã€‚</p><h2 id="class-crypto" tabindex="-1"><a class="header-anchor" href="#class-crypto"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-crypto" target="_blank" rel="noopener noreferrer">Class: Crypto</a></span></a></h2><p>Node.js çš„ Crypto ç±»æ˜¯åœ¨ <code>crypto</code> æ¨¡å—ä¸­æä¾›çš„ï¼Œå®ƒå®ç°äº† Web Crypto API çš„åŠŸèƒ½ã€‚è¿™ä¸ª API ä¸ºå¼€å‘è€…æä¾›äº†ä¸€å¥—ç”¨äºæ‰§è¡Œå„ç§åŠ å¯†æ“ä½œçš„å·¥å…·ï¼Œä¾‹å¦‚ç”Ÿæˆå¯†é’¥ã€åŠ è§£å¯†æ•°æ®ã€è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼ç­‰ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>Crypto</code> ç±»æ˜¯ä¸€ä¸ªå†…ç½®çš„å…¨å±€å¯¹è±¡ï¼Œä¸éœ€è¦é€šè¿‡<code>require()</code>æ¥å¼•å…¥ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒï¼Œè€Œæ— éœ€å®‰è£…æˆ–å¼•å…¥ä»»ä½•é¢å¤–æ¨¡å—ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘å°†é€šè¿‡å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Node.js ä¸­çš„ <code>Crypto</code> ç±»ï¼š</p><h3 id="_1-ç”Ÿæˆéšæœºå­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#_1-ç”Ÿæˆéšæœºå­—èŠ‚"><span>1. ç”Ÿæˆéšæœºå­—èŠ‚</span></a></h3><p>ç”Ÿæˆä¸€å®šé•¿åº¦çš„éšæœºæ•°æ®æ˜¯è®¸å¤šåŠ å¯†æ“ä½œçš„åŸºç¡€ã€‚æ¯”å¦‚ï¼Œåœ¨åˆ›å»ºåŠ å¯†çš„å¯†ç æˆ–ä»¤ç‰Œæ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> randomBytes</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”Ÿæˆ16å­—èŠ‚çš„éšæœºæ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> bytes</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">bytes</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: `&lt;`Buffer ...&gt;ï¼Œæ¯æ¬¡è¿è¡Œç»“æœä¼šä¸åŒ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-åŠ å¯†å’Œè§£å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2-åŠ å¯†å’Œè§£å¯†æ•°æ®"><span>2. åŠ å¯†å’Œè§£å¯†æ•°æ®</span></a></h3><p>å‡è®¾ä½ è¦ä¿æŠ¤å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„å¯†ç ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>Crypto</code> ç±»ä¸­çš„æ–¹æ³•å¯¹è¿™äº›ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™å†è§£å¯†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptDecryptExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">secret data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è§£å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encrypted</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &quot;secret data&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">encryptDecryptExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼" tabindex="-1"><a class="header-anchor" href="#_3-è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼"><span>3. è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼</span></a></h3><p>åœ¨éªŒè¯æ•°æ®å®Œæ•´æ€§æˆ–è€…ä¿å­˜å¯†ç æ•£åˆ—æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼ã€‚å“ˆå¸Œæ˜¯ä¸€ç§å•å‘å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿä»ä»»æ„å¤§å°çš„æ•°æ®ç”Ÿæˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ã€‚ç”±äºå…¶ç‰¹æ€§ï¼Œå³ä½¿åŸå§‹æ•°æ®å‘ç”Ÿéå¸¸å°çš„å˜åŒ–ï¼Œç”Ÿæˆçš„å“ˆå¸Œå€¼ä¹Ÿä¼šæœ‰å¾ˆå¤§çš„ä¸åŒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> hashExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hash</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">hashExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯ Node.js ä¸­ <code>Crypto</code> ç±»çš„å‡ ä¸ªå®é™…åº”ç”¨ç¤ºä¾‹ã€‚é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ï¼Œä½¿ç”¨ Node.js æä¾›çš„åŠ å¯†å·¥å…·æ˜¯ç›¸å½“ç›´æ¥å’Œå¼ºå¤§çš„ï¼Œå¯ä»¥æ»¡è¶³ç»å¤§å¤šæ•°æ—¥å¸¸å¼€å‘ä¸­å…³äºæ•°æ®åŠ å¯†ä¸å®‰å…¨çš„éœ€æ±‚ã€‚</p><h3 id="crypto-subtle" tabindex="-1"><a class="header-anchor" href="#crypto-subtle"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptosubtle" target="_blank" rel="noopener noreferrer">crypto.subtle</a></span></a></h3><p><code>crypto.subtle</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—çš„åŠ å¯†å’Œè§£å¯†æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç”¨äºæ‰§è¡Œå„ç§å¯†ç å­¦æ“ä½œï¼Œå¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åéªŒè¯ç­‰ã€‚è¿™éƒ¨åˆ† API è¢«ç§°ä¸º Web Crypto APIï¼Œåœ¨æµè§ˆå™¨ç«¯ä¹Ÿæœ‰å¯¹åº”çš„å®ç°ï¼Œæ„åœ¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„åŠ å¯†æŠ€æœ¯æ ‡å‡†ã€‚ä½¿ç”¨ <code>crypto.subtle</code> å¯ä»¥å¸®åŠ©ä½ ä¿æŠ¤ä¿¡æ¯å®‰å…¨ï¼Œä¾‹å¦‚ä¿æŠ¤æ•æ„Ÿæ•°æ®ï¼ŒéªŒè¯ä¿¡æ¯å®Œæ•´æ€§ç­‰ã€‚</p><h3 id="_1-åŠ å¯†å’Œè§£å¯†" tabindex="-1"><a class="header-anchor" href="#_1-åŠ å¯†å’Œè§£å¯†"><span>1. åŠ å¯†å’Œè§£å¯†</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ç”¨æˆ·ç™»å½•çš„ Web åº”ç”¨ç¨‹åºã€‚ç”¨æˆ·çš„å¯†ç åœ¨å­˜å‚¨å‰åº”è¯¥è¢«åŠ å¯†ï¼Œä»¥ä¿éšœå®‰å…¨ä¸è¢«è½»æ˜“æ³„éœ²ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>crypto.subtle.encrypt</code>è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œå†ä½¿ç”¨<code>crypto.subtle.decrypt</code>è§£å¯†è¿›è¡Œå¯†ç æ¯”å¯¹ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -1"><span>ç¤ºä¾‹ä»£ç </span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptDecryptExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¦åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è§£å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encrypted</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: Hello, world!</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">encryptDecryptExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æ•°æ®ç­¾åå’ŒéªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®ç­¾åå’ŒéªŒè¯"><span>2. æ•°æ®ç­¾åå’ŒéªŒè¯</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªåŒºå—é“¾ç¨‹åºï¼Œå…¶ä¸­çš„æ¯ä¸ªäº¤æ˜“éƒ½éœ€è¦è¢«ç­¾ç½²ä»¥ç¡®ä¿äº¤æ˜“çš„çœŸå®æ€§ã€‚ä½¿ç”¨<code>crypto.subtle.sign</code>å¯ä»¥ä¸ºæ•°æ®ç”Ÿæˆç­¾åï¼Œåœ¨æ”¶åˆ°æ•°æ®æ—¶ï¼Œä½¿ç”¨<code>crypto.subtle.verify</code>æ¥éªŒè¯æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -2"><span>ç¤ºä¾‹ä»£ç </span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signVerifyExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, blockchain!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isVerified</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">isVerified</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¦‚æœæœªè¢«ç¯¡æ”¹ï¼Œè¾“å‡º: true</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">signVerifyExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°<code>crypto.subtle</code>å¦‚ä½•åœ¨å®é™…åœºæ™¯ä¸­è¢«ä½¿ç”¨ï¼Œä»ä¿æŠ¤ç”¨æˆ·å¯†ç çš„å®‰å…¨åˆ°éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œå®ƒæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼Œä»¥æ»¡è¶³ç°ä»£åº”ç”¨ç¨‹åºå¯¹å®‰å…¨æ€§çš„éœ€æ±‚ã€‚</p><h3 id="crypto-getrandomvalues-typedarray" tabindex="-1"><a class="header-anchor" href="#crypto-getrandomvalues-typedarray"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptogetrandomvaluestypedarray" target="_blank" rel="noopener noreferrer">crypto.getRandomValues(typedArray)</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®ºåˆ° Node.js ä¸­çš„<code>crypto.getRandomValues(typedArray)</code>åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºå¦‚ä½•å®‰å…¨åœ°ç”Ÿæˆéšæœºæ•°ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯ä» Web å¹³å°çš„ Crypto API å€Ÿé‰´è€Œæ¥çš„ï¼Œä¸“é—¨ç”¨äºç”Ÿæˆå¼ºéšæœºå€¼ã€‚åœ¨ç¼–ç¨‹å’Œç½‘ç»œå®‰å…¨é¢†åŸŸï¼Œèƒ½å¤Ÿäº§ç”Ÿä¸å¯é¢„æµ‹çš„éšæœºæ•°æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="ç†è§£-typedarray" tabindex="-1"><a class="header-anchor" href="#ç†è§£-typedarray"><span>ç†è§£ typedArray</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä¸€ä¸‹<code>typedArray</code>å‚æ•°ã€‚ç®€å•æ¥è¯´ï¼ŒtypedArray æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°ç»„ï¼Œå®ƒå­˜å‚¨çš„æ˜¯å›ºå®šç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚åªæœ‰æ•°å­—çš„æ•°ç»„ã€‚åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬æœ‰å¤šç§ç±»å‹çš„ typedArrayï¼Œä¾‹å¦‚ <code>Uint8Array</code>, <code>Uint16Array</code>, <code>Uint32Array</code>, <code>Int8Array</code>, <code>Int16Array</code>, <code>Int32Array</code> ç­‰ç­‰ã€‚è¿™äº›ç±»å‹ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬å¯ä»¥å­˜å‚¨çš„æ•´æ•°ç±»å‹ï¼ˆæ— ç¬¦å·ã€æœ‰ç¬¦å·ï¼‰ä»¥åŠå¤§å°ï¼ˆ8 ä½ã€16 ä½ã€32 ä½ï¼‰ã€‚</p><h3 id="ä½¿ç”¨-crypto-getrandomvalues-typedarray" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-crypto-getrandomvalues-typedarray"><span>ä½¿ç”¨ <code>crypto.getRandomValues(typedArray)</code></span></a></h3><p><code>crypto.getRandomValues(typedArray)</code> å‡½æ•°æ¥å—ä¸€ä¸ª typedArray ä½œä¸ºå‚æ•°ï¼Œç„¶åå°†è¯¥æ•°ç»„å¡«å……æ»¡éšæœºç”Ÿæˆçš„æ•°å€¼ã€‚è¿™æ„å‘³ç€å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œä½ ä¼ å…¥çš„æ•°ç»„ä¼šè¢«æ›´æ–°ï¼ŒåŒ…å«äº†éšæœºç”Ÿæˆçš„æ•°æ®ã€‚</p><h3 id="å®ä¾‹è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹è¿ç”¨"><span>å®ä¾‹è¿ç”¨</span></a></h3><p>è¿™é‡Œåˆ†äº«å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h4 id="ç”Ÿæˆä¸€ä¸ªéšæœºå­—èŠ‚åºåˆ—" tabindex="-1"><a class="header-anchor" href="#ç”Ÿæˆä¸€ä¸ªéšæœºå­—èŠ‚åºåˆ—"><span>ç”Ÿæˆä¸€ä¸ªéšæœºå­—èŠ‚åºåˆ—</span></a></h4><p>å‡è®¾æˆ‘ä»¬æƒ³ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º 16 çš„éšæœºå­—èŠ‚åºåˆ—ï¼ˆå¸¸è§äºç”Ÿæˆå¯†é’¥æˆ–ä»¤ç‰Œç­‰åœºæ™¯ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> getRandomValues</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªUint8Arrayç±»å‹çš„æ•°ç»„ï¼Œé•¿åº¦ä¸º16</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> randomBytes</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨getRandomValuesæ–¹æ³•å¡«å……éšæœºå€¼</span></span>
<span class="line"><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">randomBytes</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">randomBytes</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç”Ÿæˆä¸€ä¸ªéšæœºçš„æ•´æ•°" tabindex="-1"><a class="header-anchor" href="#ç”Ÿæˆä¸€ä¸ªéšæœºçš„æ•´æ•°"><span>ç”Ÿæˆä¸€ä¸ªéšæœºçš„æ•´æ•°</span></a></h4><p>å¦‚æœæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªéšæœºçš„æ•´æ•°ï¼Œå¯ä»¥åˆ©ç”¨<code>Uint32Array</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> getRandomValues</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºä¸€ä¸ªUint32Arrayç±»å‹çš„æ•°ç»„ï¼Œé•¿åº¦ä¸º1</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> array</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint32Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”Ÿæˆéšæœºå€¼</span></span>
<span class="line"><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">array</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è·å–ç”Ÿæˆçš„éšæœºæ•´æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> randomNumber</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> array</span><span style="color:#D8DEE9FF;">[</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">randomNumber</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º 1 çš„<code>Uint32Array</code>æ•°ç»„ï¼Œå¹¶ç”¨<code>getRandomValues</code>å¡«å……äº†éšæœºå€¼ã€‚ç”±äºæ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ç›´æ¥æå–è¿™ä¸ªå…ƒç´ ä½œä¸ºæˆ‘ä»¬çš„éšæœºæ•´æ•°ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨-crypto-getrandomvalues-typedarray" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨-crypto-getrandomvalues-typedarray"><span>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>crypto.getRandomValues(typedArray)</code>ï¼Ÿ</span></a></h3><p>ä½¿ç”¨<code>crypto.getRandomValues(typedArray)</code>æ¥ç”Ÿæˆéšæœºæ•°æ¯”å…¶ä»–æ–¹æ³•æ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒåŸºäºåº•å±‚æ“ä½œç³»ç»Ÿæä¾›çš„åŠ å¯†çº§åˆ«çš„éšæœºæ•°ç”Ÿæˆå™¨ã€‚è¿™æ¯” JavaScript å†…ç½®çš„ Math.random()æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§å’Œä¸å¯é¢„æµ‹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å®‰å…¨æ•æ„Ÿçš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå¦‚å¯†ç å­¦å’Œèº«ä»½éªŒè¯ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ ç†è§£<code>crypto.getRandomValues(typedArray)</code>çš„ä½œç”¨å’Œå¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚</p><h3 id="crypto-randomuuid" tabindex="-1"><a class="header-anchor" href="#crypto-randomuuid"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptorandomuuid" target="_blank" rel="noopener noreferrer">crypto.randomUUID()</a></span></a></h3><p>å½“ç„¶å¯ä»¥ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ <code>crypto.randomUUID()</code> å‡½æ•°åŠå…¶å®é™…åº”ç”¨ã€‚</p><h3 id="crypto-randomuuid-1" tabindex="-1"><a class="header-anchor" href="#crypto-randomuuid-1"><span>crypto.randomUUID()</span></a></h3><p><code>crypto.randomUUID()</code> å‡½æ•°æ˜¯ Node.js çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºç”Ÿæˆç¬¦åˆ RFC 4122 è§„èŒƒçš„ç‰ˆæœ¬ 4ï¼ˆéšæœºï¼‰UUIDï¼ˆé€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼‰ã€‚è¿™ä¸ªå‡½æ•°éå¸¸å®ç”¨ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿç”Ÿæˆå‡ ä¹å”¯ä¸€çš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½å¯ä»¥ä½œä¸ºå¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ä½¿ç”¨ã€‚</p><h4 id="å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ"><span>å¦‚ä½•å·¥ä½œï¼Ÿ</span></a></h4><p>UUID æ˜¯ç”± 32 ä¸ªåå…­è¿›åˆ¶æ•°å­—ç»„æˆçš„ï¼Œæ ¼å¼ä¸º <code>xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx</code> å…¶ä¸­ <code>x</code> æ˜¯ä»»æ„åå…­è¿›åˆ¶æ•°å­—ï¼Œè€Œ <code>y</code> æ˜¯ 8ã€9ã€A æˆ–è€… B ä¸­çš„ä¸€ä¸ªï¼Œç¡®ä¿äº†è¯¥ UUID çš„ç‰ˆæœ¬å’Œå˜ä½“ã€‚<code>crypto.randomUUID()</code> å‡½æ•°è‡ªåŠ¨å¤„ç†è¿™äº›ç»†èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ»¡è¶³ä¸Šè¿°æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><ol><li><p><strong>ç”¨æˆ·ä¼šè¯æ ‡è¯†</strong>: åœ¨ Web å¼€å‘ä¸­ï¼Œæ¯å½“æœ‰æ–°ç”¨æˆ·è®¿é—®åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä»–ä»¬åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ä¼šè¯æ ‡è¯†ï¼ˆSession IDï¼‰ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´ä¼ é€’ä¿¡æ¯æ—¶èƒ½å¤Ÿè¯†åˆ«å’ŒåŒºåˆ†ä¸åŒçš„ç”¨æˆ·ã€‚è¿™æ ·ï¼Œå³ä½¿ä¸¤ä¸ªç”¨æˆ·åœ¨ç›¸åŒæ—¶é—´è®¿é—®ç½‘ç«™ï¼Œä»–ä»¬ä¹Ÿä¼šæœ‰ä¸åŒçš„ä¼šè¯æ ‡è¯†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> randomUUID</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å½“æ–°ç”¨æˆ·è®¿é—®åº”ç”¨æ—¶</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> sessionId</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> randomUUID</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Session ID for the new user: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">sessionId</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ•°æ®åº“ä¸­çš„å”¯ä¸€è®°å½• ID</strong>: åœ¨æ„å»ºæ•°æ®åº“æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ç»™æ¯æ¡è®°å½•ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚ä½¿ç”¨ <code>crypto.randomUUID()</code> å¯ä»¥éå¸¸å®¹æ˜“åœ°ç”Ÿæˆè¿™æ ·çš„å”¯ä¸€é”®å€¼ï¼Œä»è€Œé¿å…è®°å½•ä¹‹é—´çš„å†²çªã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> randomUUID</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆ›å»ºæ–°çš„æ•°æ®åº“è®°å½•</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> recordId</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> randomUUID</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Unique ID for the new record: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">recordId</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// è¿™ä¸ªå”¯ä¸€IDå¯ä»¥ä½œä¸ºæ•°æ®åº“è®°å½•çš„ä¸»é”®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ–‡ä»¶ä¸Šä¼ </strong>: å½“ç”¨æˆ·å‘ä½ çš„åº”ç”¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªæ–‡ä»¶å…·æœ‰ç›¸åŒåç§°çš„æƒ…å†µã€‚ä¸ºäº†é¿å…è¦†ç›–æˆ–æ··æ·†ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªä¸Šä¼ çš„æ–‡ä»¶ç”Ÿæˆä¸€ä¸ª UUIDï¼Œå¹¶å°†å…¶ç”¨ä½œå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶åã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> randomUUID</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> originalFileName</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user_picture.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> uniqueFileName</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span><span style="color:#81A1C1;">${</span><span style="color:#88C0D0;">randomUUID</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">-</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">originalFileName</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Unique file name for the uploaded file: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">uniqueFileName</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// ç„¶åå¯ä»¥å®‰å…¨åœ°å°†æ–‡ä»¶ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œé¿å…åç§°å†²çª</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>crypto.randomUUID()</code> åœ¨ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦æ–¹é¢çš„å¼ºå¤§åŠŸèƒ½ï¼Œæ— è®ºæ˜¯ç”¨äºä¼šè¯ç®¡ç†ã€æ•°æ®å­˜å‚¨è¿˜æ˜¯æ–‡ä»¶å¤„ç†ç­‰åœºæ™¯ï¼Œå®ƒéƒ½æä¾›äº†ä¸€ä¸ªç®€å•ä¸”é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="class-cryptokey" tabindex="-1"><a class="header-anchor" href="#class-cryptokey"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-cryptokey" target="_blank" rel="noopener noreferrer">Class: CryptoKey</a></span></a></h2><p>Node.js v21.7.1 ä¸­çš„<code>CryptoKey</code>ç±»æ˜¯å±äº Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ª API æä¾›äº†åŠ å¯†å’Œè§£å¯†åŠŸèƒ½ï¼Œä½¿å¾—ä½ å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°æ•°æ®çš„å®‰å…¨ä¼ è¾“å’Œå­˜å‚¨ã€‚<code>CryptoKey</code>å¯¹è±¡ä»£è¡¨äº†åŠ å¯†å¯†é’¥çš„ä¿¡æ¯å’Œæ“ä½œï¼Œä½†å®ƒè‡ªèº«å¹¶ä¸åŒ…å«å¯†é’¥çš„åŸå§‹æ•°æ®ï¼Œä»¥é¿å…æ³„éœ²é£é™©ã€‚</p><h3 id="cryptokeyçš„åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#cryptokeyçš„åŸºæœ¬æ¦‚å¿µ"><span><code>CryptoKey</code>çš„åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>ä¸€ä¸ª<code>CryptoKey</code>å¯¹è±¡å°è£…äº†è®¸å¤šä¸å¯†é’¥ç›¸å…³çš„ä¿¡æ¯ï¼š</p><ul><li><strong>ç±»å‹ï¼ˆtypeï¼‰</strong>ï¼šæŒ‡å®šäº†å¯†é’¥çš„ç±»å‹ï¼Œå¸¸è§çš„æœ‰ &quot;public&quot;ã€&quot;private&quot; æˆ– &quot;secret&quot;ã€‚ <ul><li>&quot;public&quot; å’Œ &quot;private&quot; æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œç”¨äºéå¯¹ç§°åŠ å¯†ï¼Œå¦‚ RSA æˆ– ECDSA ç®—æ³•ã€‚</li><li>&quot;secret&quot; ç”¨äºå¯¹ç§°åŠ å¯†ï¼Œæ¯”å¦‚ AES ç®—æ³•ã€‚</li></ul></li><li><strong>ç”¨é€”ï¼ˆusesï¼‰</strong>ï¼šå®šä¹‰äº†è¯¥å¯†é’¥èƒ½å¤Ÿæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚åŠ å¯†ï¼ˆencryptï¼‰ã€è§£å¯†ï¼ˆdecryptï¼‰ã€ç­¾åï¼ˆsignï¼‰ã€éªŒè¯ï¼ˆverifyï¼‰ç­‰ã€‚</li><li><strong>ç®—æ³•ï¼ˆalgorithmï¼‰</strong>ï¼šå¯†é’¥é‡‡ç”¨çš„ç®—æ³•ï¼Œå¦‚ RSAã€AES ç­‰ã€‚</li><li><strong>å¯æå–æ€§ï¼ˆextractableï¼‰</strong>ï¼šæŒ‡ç¤ºè¯¥å¯†é’¥èƒ½å¦è¢«å¯¼å‡ºåˆ°åº”ç”¨ä¹‹å¤–ï¼ŒæŸäº›æƒ…å†µä¸‹ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå¯èƒ½ä¸å¸Œæœ›å¯†é’¥è¢«å¯¼å‡ºã€‚</li><li><strong>å…³è”çš„å±æ€§</strong>ï¼šå¦‚å¯†é’¥çš„é•¿åº¦ç­‰ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h3><h4 id="åœºæ™¯ä¸€-ä½¿ç”¨cryptokeyè¿›è¡ŒåŠ å¯†é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯ä¸€-ä½¿ç”¨cryptokeyè¿›è¡ŒåŠ å¯†é€šä¿¡"><span>åœºæ™¯ä¸€ï¼šä½¿ç”¨<code>CryptoKey</code>è¿›è¡ŒåŠ å¯†é€šä¿¡</span></a></h4><p>å‡è®¾ Alice å’Œ Bob æƒ³è¦é€šè¿‡äº’è”ç½‘å®‰å…¨åœ°äº¤æ¢ä¿¡æ¯ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨<code>CryptoKey</code>ç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚Alice å°†å¥¹çš„å…¬é’¥å‘é€ç»™ Bobï¼ŒBob ç”¨å®ƒæ¥åŠ å¯†ä¿¡æ¯ï¼Œå¹¶å‘é€åŠ å¯†åçš„ä¿¡æ¯ç»™ Aliceã€‚ç„¶å Alice å¯ä»¥ä½¿ç”¨å¥¹çš„ç§é’¥è§£å¯†ä¿¡æ¯ã€‚è¿™é‡Œï¼Œ<code>CryptoKey</code>å¯¹è±¡å°±ç”¨äºè¡¨ç¤º Alice å’Œ Bob çš„å…¬é’¥å’Œç§é’¥ã€‚</p><h4 id="åœºæ™¯äºŒ-æ•°æ®çš„ç­¾åå’ŒéªŒè¯" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯äºŒ-æ•°æ®çš„ç­¾åå’ŒéªŒè¯"><span>åœºæ™¯äºŒï¼šæ•°æ®çš„ç­¾åå’ŒéªŒè¯</span></a></h4><p>ä¸€ä¸ªè½¯ä»¶å¼€å‘è€…æƒ³è¦ç¡®ä¿ä»–ä»¬å‘å¸ƒçš„è½¯ä»¶æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨ç§é’¥åˆ›å»ºä¸€ä¸ªè½¯ä»¶åŒ…çš„æ•°å­—ç­¾åã€‚ç”¨æˆ·ä¸‹è½½è½¯ä»¶æ—¶ä¹Ÿä¼šæ¥æ”¶åˆ°è¿™ä¸ªç­¾åã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨å¼€å‘è€…çš„å…¬é’¥ï¼ˆé€šè¿‡<code>CryptoKey</code>è¡¨ç¤ºï¼‰ï¼Œæ¥éªŒè¯ç­¾åæ˜¯å¦æœ‰æ•ˆï¼Œä»è€Œç¡®ä¿è½¯ä»¶æ˜¯çœŸå®æœªè¢«ä¿®æ”¹è¿‡çš„ã€‚</p><h4 id="åœºæ™¯ä¸‰-å®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯ä¸‰-å®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯"><span>åœºæ™¯ä¸‰ï¼šå®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯</span></a></h4><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¿å­˜ç”¨æˆ·å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨<code>CryptoKey</code>è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯¹ç§°å¯†é’¥ï¼ˆ<code>CryptoKey</code>å¯¹è±¡ï¼‰ï¼Œç”¨å…¶æ¥åŠ å¯†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¿¡æ¯ã€‚å½“éœ€è¦è¯»å–è¿™äº›ä¿¡æ¯æ—¶ï¼Œå†ä½¿ç”¨åŒæ ·çš„å¯†é’¥è¿›è¡Œè§£å¯†ã€‚</p><h3 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h3><p><code>CryptoKey</code>ç±»åœ¨ Node.js ä¸­æ˜¯å¤„ç†å„ç§åŠ å¯†éœ€æ±‚çš„åŸºç¡€ï¼Œå®ƒæ—¢å¯ä»¥ç”¨äºä¿æŠ¤æ•°æ®çš„å®‰å…¨ä¼ è¾“ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ•°æ®çš„åŠ å¯†å­˜å‚¨æˆ–åˆ›å»ºæ•°å­—ç­¾åã€‚é€šè¿‡åˆç†ä½¿ç”¨<code>CryptoKey</code>ï¼Œå¯ä»¥å¤§å¤§æé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><h3 id="cryptokey-algorithm" tabindex="-1"><a class="header-anchor" href="#cryptokey-algorithm"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptokeyalgorithm" target="_blank" rel="noopener noreferrer">cryptoKey.algorithm</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>cryptoKey.algorithm</code>æ˜¯å…³äº Web Cryptography API ä¸­<code>CryptoKey</code>å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚å®ƒæä¾›äº†æœ‰å…³åŠ å¯†é”®çš„ç®—æ³•ä¿¡æ¯ã€‚æˆ‘ä»¬å…ˆæ¥é€šä¿—åœ°ç†è§£å‡ ä¸ªå…³é”®è¯ï¼š</p><ol><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>Web Cryptography API</strong>: è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨å’Œ Node.js æä¾›çš„ APIï¼Œç”¨äºæ‰§è¡Œå„ç§å¯†ç å­¦æ“ä½œï¼Œå¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åç­‰ã€‚</li><li><strong>CryptoKey</strong>: åœ¨ Web Cryptography API ä¸­ï¼Œä¸€ä¸ª<code>CryptoKey</code>å¯¹è±¡ä»£è¡¨åŠ å¯†å’Œè§£å¯†æ“ä½œæ‰€éœ€çš„å¯†é’¥ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£<code>cryptoKey.algorithm</code>ï¼š</p><h3 id="cryptokey-algorithm-1" tabindex="-1"><a class="header-anchor" href="#cryptokey-algorithm-1"><span><code>cryptoKey.algorithm</code></span></a></h3><ul><li><p><strong>å®šä¹‰</strong>ï¼šæ¯ä¸ª<code>CryptoKey</code>éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•å®šä¹‰äº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå¯†é’¥ã€‚<code>cryptoKey.algorithm</code>å±æ€§å°±æ˜¯ç”¨æ¥è·å–è¿™ä¸ªç®—æ³•è¯¦æƒ…çš„ã€‚å®ƒä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æè¿°äº†å¯†é’¥çš„ç®—æ³•åŠå…¶ç›¸å…³å‚æ•°ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼šçŸ¥é“å¯†é’¥çš„ç®—æ³•å¯¹äºè¿›è¡Œä»»ä½•åŠ å¯†æˆ–è§£å¯†æ“ä½œè‡³å…³é‡è¦ï¼Œå› ä¸ºä½ éœ€è¦ç¡®ä¿ä½ ä½¿ç”¨æ­£ç¡®çš„ç®—æ³•ä¸ç»™å®šçš„å¯†é’¥åŒ¹é…ã€‚å¦åˆ™ï¼Œæ“ä½œä¼šå¤±è´¥ã€‚</p></li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><ol><li><strong>ç”Ÿæˆå¯†é’¥å¹¶è·å–ç®—æ³•ä¿¡æ¯</strong>ï¼š</li></ol><p>å‡è®¾æˆ‘ä»¬æƒ³åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚æˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ° AES-GCMï¼ˆä¸€ç§åŠ å¯†ç®—æ³•ï¼‰æ¥åŠ å¯†æ•°æ®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¹¶æŸ¥çœ‹å…¶ç®—æ³•ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyAndShowAlgorithm</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆä¸€ä¸ªAES-GCMå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯ç”¨æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è·å–å¹¶å±•ç¤ºå¯†é’¥çš„ç®—æ³•ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyAndShowAlgorithm</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œ<code>key.algorithm</code>ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸ªå¯†é’¥æ˜¯ç”¨äº AES-GCM ç®—æ³•çš„ï¼Œå¯†é’¥é•¿åº¦æ˜¯ 256 ä½ã€‚</p><ol start="2"><li><strong>åŠ å¯†æ¶ˆæ¯å¹¶æ£€æŸ¥ä½¿ç”¨çš„ç®—æ³•</strong>ï¼š</li></ol><p>å‡è®¾ç°åœ¨æˆ‘ä»¬è¦ä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„å¯†é’¥æ¥åŠ å¯†ä¸€æ®µæ¶ˆæ¯ï¼Œç„¶åæˆ‘ä»¬æƒ³ç¡®è®¤ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è½¬æ¢æ¶ˆæ¯ä¸ºArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨å¯†é’¥çš„ç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedMessage</span><span style="color:#616E88;"> // éœ€è¦åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Message was encrypted using </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> algorithm</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾`key`æ˜¯æˆ‘ä»¬ä¹‹å‰ç”Ÿæˆçš„AES-GCMå¯†é’¥</span></span>
<span class="line"><span style="color:#616E88;">// encryptMessage(&quot;Hello, world!&quot;, key);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æ¶ˆæ¯è½¬æ¢æˆé€‚åˆåŠ å¯†çš„æ ¼å¼ï¼ˆ<code>ArrayBuffer</code>ï¼‰ï¼Œç„¶åä½¿ç”¨<code>subtle.encrypt</code>æ–¹æ³•åŠ å¯†æ¶ˆæ¯ã€‚é€šè¿‡æŒ‡å®šåŠ å¯†çš„é…ç½®ï¼ˆåŒ…æ‹¬ç®—æ³•åç§°å’Œåˆå§‹åŒ–å‘é‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ­£ç¡®åœ°ä½¿ç”¨å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚æ—¥å¿—è¾“å‡ºå°†ç¡®è®¤æˆ‘ä»¬ä½¿ç”¨äº†<code>AES-GCM</code>ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚</p><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ åº”è¯¥å¯¹<code>cryptoKey.algorithm</code>å±æ€§ä»¥åŠå¦‚ä½•åœ¨å®é™…ä¸­ä½¿ç”¨å®ƒæœ‰äº†æ›´å¥½çš„ç†è§£ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿè·å–å’ŒéªŒè¯ç”¨äºåŠ å¯†æˆ–è§£å¯†æ“ä½œçš„å¯†é’¥çš„ç®—æ³•ä¿¡æ¯ï¼Œç¡®ä¿åŠ å¯†æ“ä½œçš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§ã€‚</p><h3 id="cryptokey-extractable" tabindex="-1"><a class="header-anchor" href="#cryptokey-extractable"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptokeyextractable" target="_blank" rel="noopener noreferrer">cryptoKey.extractable</a></span></a></h3><p>å½“ä½ å¼€å§‹å­¦ä¹ ç¼–ç¨‹ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°ç½‘ç»œå’Œæ•°æ®å®‰å…¨çš„éƒ¨åˆ†æ—¶ï¼Œä½ ä¼šé‡åˆ°åŠ å¯†è¿™ä¸ªæ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œ<code>cryptoKey.extractable</code>æ˜¯ä¸ Web åŠ å¯† API ç›¸å…³çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºå¤„ç†å¯†ç å­¦é’¥åŒ™ï¼ˆcryptographic keysï¼‰ã€‚ç†è§£è¿™ä¸ªç‰¹æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p><h3 id="åŠ å¯†å’Œå¯†é’¥" tabindex="-1"><a class="header-anchor" href="#åŠ å¯†å’Œå¯†é’¥"><span>åŠ å¯†å’Œå¯†é’¥</span></a></h3><p><strong>åŠ å¯†</strong>æ˜¯å°†ä¿¡æ¯ä»ä¸€ç§å½¢å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ— æ³•è¯†åˆ«çš„å½¢å¼çš„è¿‡ç¨‹ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®çš„éšç§å’Œå®‰å…¨æ€§ã€‚æƒ³è¦è¯»å–åŠ å¯†åçš„ä¿¡æ¯ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª<strong>å¯†é’¥</strong>ï¼ˆkeyï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§ç®—æ³•å‚æ•°ï¼Œç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚</p><h3 id="å¯†é’¥çš„å¯æå–æ€§-extractability" tabindex="-1"><a class="header-anchor" href="#å¯†é’¥çš„å¯æå–æ€§-extractability"><span>å¯†é’¥çš„å¯æå–æ€§ï¼ˆExtractabilityï¼‰</span></a></h3><p>åœ¨è°ˆåˆ°<code>cryptoKey.extractable</code>æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šè®¨è®ºçš„æ˜¯å¯†é’¥çš„ä¸€ä¸ªå±æ€§â€”â€”æ˜¯å¦å¯ä»¥ä»ä½¿ç”¨å¯†é’¥çš„ Web åº”ç”¨ä¸­å¯¼å‡ºæˆ–â€œæå–â€å‡ºæ¥ã€‚å¦‚æœä¸€ä¸ªå¯†é’¥è¢«æ ‡è®°ä¸º&quot;extractable&quot;ï¼ˆå¯æå–çš„ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯†é’¥å°±å¯ä»¥è¢«å¯¼å‡ºåˆ°å…¶ä»–ç¯å¢ƒä¸­å»ï¼Œä¾‹å¦‚ï¼Œä»æœåŠ¡å™¨å¯¼å‡ºåˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚ç›¸åï¼Œå¦‚æœä¸€ä¸ªå¯†é’¥ä¸æ˜¯å¯æå–çš„ï¼Œé‚£ä¹ˆå®ƒåªèƒ½åœ¨åˆ›å»ºå®ƒçš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-6"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>ç”¨æˆ·èº«ä»½éªŒè¯</strong>ï¼šå‡è®¾ä½ æ­£åœ¨åˆ¶ä½œä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦ä¿è¯ç”¨æˆ·å‘é€ç»™æœåŠ¡å™¨çš„å¯†ç æ˜¯å®‰å…¨çš„ã€‚ä½ å¯ä»¥åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ç«¯ä½¿ç”¨å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œåœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä½ å¯èƒ½ä¼šè®¾ç½®ç§é’¥ä¸ºä¸å¯æå–çš„ï¼Œè¿™æ ·å³ä½¿æ”»å‡»è€…èƒ½å¤Ÿä»¥æŸç§æ–¹å¼è®¿é—®åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿæ— æ³•è½»æ˜“åœ°å°†ç§é’¥å¯¼å‡ºåˆ°å…¶ä»–åœ°æ–¹å»ã€‚</p></li><li><p><strong>æ•°å­—ç­¾å</strong>ï¼šåœ¨å‘é€ç”µå­é‚®ä»¶æˆ–æ–‡ä»¶æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›ç¡®ä¿æ¥æ”¶è€…çŸ¥é“å®ƒä»¬ç¡®å®ç”±ä½ å‘é€ï¼Œå¹¶ä¸”åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚è¿™å¯ä»¥é€šè¿‡æ•°å­—ç­¾åå®ç°ã€‚ä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ˆä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ï¼‰ã€‚ç”¨ç§é’¥å¯¹é‚®ä»¶æˆ–æ–‡ä»¶è¿›è¡Œç­¾åï¼Œå¹¶å°†å…¬é’¥è®¾ç½®ä¸ºå¯æå–çš„ï¼Œè¿™æ ·æ¥æ”¶è€…å¯ä»¥ç”¨å®ƒæ¥éªŒè¯ç­¾åçš„æœ‰æ•ˆæ€§ã€‚</p></li><li><p><strong>å®‰å…¨é€šä¿¡ï¼ˆå¦‚ HTTPSï¼‰</strong>ï¼šå½“ä½ è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼šå»ºç«‹ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ï¼Œç¡®ä¿ä¼ è¾“çš„æ•°æ®æ˜¯å®‰å…¨çš„ã€‚è¿™é€šå¸¸é€šè¿‡ SSL/TLS åè®®å®ç°ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ä¼šå‘æµè§ˆå™¨å‘é€ä¸€ä¸ªå…¬é’¥ã€‚ä¸ºäº†å¢å¼ºå®‰å…¨æ€§ï¼Œè¿™ä¸ªå…¬é’¥é€šå¸¸æ˜¯å¯æå–çš„ï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶å¯ä»¥è½»æ¾åœ°å°†å…¶å¯¼å…¥åˆ°å…¶ä»–ç³»ç»Ÿæˆ–åº”ç”¨ä¸­ã€‚</p></li></ol><h3 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h3><p><code>cryptoKey.extractable</code>æ˜¯ä¸€ä¸ªè¡¨æ˜å¯†é’¥æ˜¯å¦å¯ä»¥è¢«å¯¼å‡ºçš„å±æ€§ã€‚å®ƒçš„è®¾ç½®å–å†³äºä½ çš„å…·ä½“å®‰å…¨éœ€æ±‚ã€‚å¦‚æœå¯†é’¥éœ€è¦åœ¨ä¸åŒçš„ç¯å¢ƒä¹‹é—´å…±äº«ï¼Œé‚£ä¹ˆå°†å…¶è®¾ç½®ä¸ºå¯æå–çš„å¯èƒ½æ›´æœ‰æ„ä¹‰ã€‚ç„¶è€Œï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸ºäº†é˜²æ­¢å¯†é’¥æ³„éœ²ï¼Œä¿æŒå¯†é’¥ä¸å¯æå–æ˜¯ä¸€ä¸ªæ›´å®‰å…¨çš„é€‰æ‹©ã€‚</p><h3 id="cryptokey-type" tabindex="-1"><a class="header-anchor" href="#cryptokey-type"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptokeytype" target="_blank" rel="noopener noreferrer">cryptoKey.type</a></span></a></h3><p><code>cryptoKey.type</code> åœ¨ Node.js çš„ Web Crypto API ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å±æ€§ï¼Œç”¨äºè¡¨ç¤ºå¯†é’¥ï¼ˆ<code>CryptoKey</code>ï¼‰çš„ç±»å‹ã€‚åœ¨ç†è§£è¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹å¯†é’¥å’ŒåŠ å¯†çš„åŸºæœ¬æ¦‚å¿µã€‚</p><p>åŠ å¯†æ˜¯æ•°æ®å®‰å…¨ä¸­çš„ä¸€ä¸ªåŸºçŸ³ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†ä¿¡æ¯è½¬æ¢æˆåªæœ‰æŒæœ‰ç‰¹å®šâ€œé’¥åŒ™â€çš„äººæ‰èƒ½è§£è¯»çš„æ ¼å¼ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œâ€œå¯†é’¥â€å°±æ‰®æ¼”äº†è¿™æ ·ä¸€ä¸ªâ€œé’¥åŒ™â€çš„è§’è‰²ã€‚æ ¹æ®åŠ å¯†çš„ä¸åŒéœ€æ±‚ï¼Œå¯†é’¥å¯ä»¥æœ‰ä¸åŒçš„ç±»å‹å’Œç”¨é€”ã€‚</p><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>cryptoKey.type</code> å±æ€§ç”¨æ¥æ ‡è¯†ä¸€ä¸ªå¯†é’¥çš„ç±»å‹ï¼Œå®ƒå¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§å€¼ï¼š</p><ol><li><p><strong><code>&quot;secret&quot;</code></strong>: è¿™ç§ç±»å‹çš„å¯†é’¥æ˜¯ç”¨åœ¨å¯¹ç§°åŠ å¯†ä¸­çš„ã€‚åœ¨å¯¹ç§°åŠ å¯†ä¸­ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯†é’¥ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªä¿é™©ç®±ï¼Œæ— è®ºæ˜¯é”ä¸Šè¿˜æ˜¯æ‰“å¼€ï¼Œéƒ½ä½¿ç”¨åŒä¸€æŠŠé’¥åŒ™ï¼Œè¿™æŠŠé’¥åŒ™å°±ç›¸å½“äºæ˜¯â€œ<code>secret</code>â€ç±»å‹çš„å¯†é’¥ã€‚</p></li><li><p><strong><code>&quot;public&quot;</code></strong>: å…¬é’¥ç”¨åœ¨éå¯¹ç§°åŠ å¯†ï¼ˆä¹Ÿå«å…¬é’¥åŠ å¯†ï¼‰ä¸­çš„åŠ å¯†æ“ä½œé‡Œã€‚åœ¨éå¯¹ç§°åŠ å¯†ä¸­ï¼Œæœ‰ä¸¤æŠŠå¯†é’¥ï¼šä¸€æŠŠæ˜¯å…¬é’¥ï¼Œå¦ä¸€æŠŠæ˜¯ç§é’¥ã€‚å…¬é’¥å¯ä»¥è¢«ä»»ä½•äººè·å–å¹¶ç”¨æ¥åŠ å¯†æ•°æ®ï¼Œä½†åªæœ‰å¯¹åº”çš„ç§é’¥æŒæœ‰è€…æ‰èƒ½è§£å¯†è¿™äº›æ•°æ®ã€‚æ¯”å¦‚ï¼Œä½ æƒ³ç»™æˆ‘å¯„ä¸€å°åŠ å¯†çš„ä¿¡ï¼Œä½ å¯ä»¥ç”¨æˆ‘çš„å…¬é’¥æ¥åŠ å¯†è¿™å°ä¿¡ï¼Œè€Œåªæœ‰æˆ‘æœ‰ç›¸åº”çš„ç§é’¥èƒ½æ‰“å¼€å®ƒã€‚</p></li><li><p><strong><code>&quot;private&quot;</code></strong>: ç§é’¥ä¹Ÿæ˜¯ç”¨åœ¨éå¯¹ç§°åŠ å¯†ä¸­ï¼Œä½†å®ƒç”¨äºè§£å¯†æˆ–ç­¾åæ“ä½œã€‚ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œå½“ä½ ç”¨æˆ‘çš„å…¬é’¥åŠ å¯†äº†ä¿¡ä»¶åï¼Œæˆ‘ä¼šç”¨æˆ‘çš„ç§é’¥æ¥è§£å¯†å®ƒã€‚</p></li></ol><p><strong>å®é™…è¿ç”¨çš„ä¾‹å­</strong>ï¼š</p><ol><li><p><strong>åœ¨çº¿æ”¯ä»˜</strong>ï¼šå½“ä½ åœ¨ç½‘ä¸Šè´­ç‰©å¹¶è¿›è¡Œåœ¨çº¿æ”¯ä»˜æ—¶ï¼Œå•†å®¶çš„æœåŠ¡å™¨ä¼šæä¾›ä¸€ä¸ªå…¬é’¥ç»™ä½ çš„æµè§ˆå™¨ï¼Œä½ çš„ä»˜æ¬¾ä¿¡æ¯ä¼šç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å†ç”¨å¯¹åº”çš„ç§é’¥è§£å¯†è¿™äº›ä¿¡æ¯ã€‚è¿™æ ·å³ä¾¿æœ‰äººæˆªè·äº†åŠ å¯†çš„ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•è§£è¯»ä½ çš„æ”¯ä»˜è¯¦æƒ…ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰ç§é’¥ã€‚</p></li><li><p><strong>æ•°å­—ç­¾å</strong>ï¼šå‡è®¾ä½ éœ€è¦å‘æŸäººè¯æ˜ä¸€ä»½ç”µå­æ–‡æ¡£ç¡®å®æ˜¯ç”±ä½ å‘é€çš„ï¼Œä¸”å†…å®¹æœªè¢«ç¯¡æ”¹ã€‚ä½ å¯ä»¥ä½¿ç”¨ä½ çš„ç§é’¥å¯¹è¿™ä»½æ–‡æ¡£è¿›è¡Œæ•°å­—ç­¾åã€‚æ¥æ”¶æ–¹ç„¶åå¯ä»¥ç”¨ä½ çš„å…¬é’¥æ¥éªŒè¯è¿™ä»½ç­¾åã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œå°±è¯´æ˜è¿™ä»½æ–‡æ¡£ç¡®å®æ˜¯ä½ å‘é€çš„ï¼Œä¸”å†…å®¹æœªè¢«æ›´æ”¹ã€‚</p></li><li><p><strong>å®‰å…¨é€šä¿¡</strong>ï¼šèŠå¤©è½¯ä»¶å¦‚ WhatsApp å’Œ Signal ç­‰ä½¿ç”¨ç«¯åˆ°ç«¯åŠ å¯†æŠ€æœ¯æ¥ä¿æŠ¤ç”¨æˆ·çš„æ¶ˆæ¯ã€‚å½“ä½ å‘é€ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šç”¨æ¥æ”¶è€…çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·é™¤äº†æ¥æ”¶è€…ï¼Œæ²¡æœ‰äººèƒ½è§£å¯†å¹¶é˜…è¯»è¿™æ¡æ¶ˆæ¯ã€‚æ¥æ”¶è€…ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†æ¶ˆæ¯ã€‚</p></li></ol><p>é€šè¿‡<code>cryptoKey.type</code>å±æ€§ï¼Œå¼€å‘è€…å¯ä»¥ç¡®å®šä¸€ä¸ªå¯†é’¥çš„å…·ä½“ä½œç”¨å’Œåœºæ™¯ï¼Œè¿›è€Œæ­£ç¡®åœ°åº”ç”¨äºåŠ å¯†ã€è§£å¯†ã€ç­¾åç­‰å¤šç§å®‰å…¨ç›¸å…³çš„æ“ä½œä¸­ã€‚</p><h3 id="cryptokey-usages" tabindex="-1"><a class="header-anchor" href="#cryptokey-usages"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptokeyusages" target="_blank" rel="noopener noreferrer">cryptoKey.usages</a></span></a></h3><p>Node.js ä¸­çš„ <code>cryptoKey.usages</code> å±æ€§æ˜¯å…³äº Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒç”¨äºæŒ‡å®šä¸€ä¸ªåŠ å¯†å¯†é’¥å¯ä»¥è¢«ç”¨äºå“ªäº›æ“ä½œã€‚åœ¨è§£é‡Šè¿™ä¸ªå±æ€§ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆç®€è¦äº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="web-åŠ å¯†-api-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#web-åŠ å¯†-api-ç®€ä»‹"><span>Web åŠ å¯† API ç®€ä»‹</span></a></h3><p>Web åŠ å¯† API æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„åŠ å¯†å·¥å…·é›†ï¼Œå…è®¸å¼€å‘è€…æ‰§è¡Œå¤šç§åŠ å¯†æ“ä½œï¼Œæ¯”å¦‚ç”Ÿæˆå¯†é’¥ã€åŠ å¯†å’Œè§£å¯†æ•°æ®ã€ç­¾åéªŒè¯ç­‰ã€‚è¿™äº›åŠŸèƒ½å¯¹äºä¿æŠ¤ç½‘ç«™çš„ä¿¡æ¯å®‰å…¨è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æ•æ„Ÿä¿¡æ¯æ—¶ï¼ˆä¾‹å¦‚å¯†ç ã€æ”¯ä»˜ä¿¡æ¯ç­‰ï¼‰ã€‚</p><h3 id="å¯†é’¥ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å¯†é’¥ä½¿ç”¨åœºæ™¯"><span>å¯†é’¥ä½¿ç”¨åœºæ™¯</span></a></h3><p>åœ¨åŠ å¯†è¿‡ç¨‹ä¸­ï¼Œâ€œå¯†é’¥â€æ˜¯è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†æ“ä½œä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚æ ¹æ®å¯†é’¥çš„ä½œç”¨å’Œç®—æ³•éœ€æ±‚ï¼Œå¯†é’¥å¯ä»¥æœ‰ä¸åŒçš„ç”¨é€”ï¼š</p><ul><li><strong>åŠ å¯†</strong>ï¼šå°†æ˜æ–‡åŠ å¯†æˆå¯†æ–‡ï¼Œä»¥é˜²æœªæˆæƒäººå‘˜é˜…è¯»ã€‚</li><li><strong>è§£å¯†</strong>ï¼šå°†å¯†æ–‡è§£å¯†å›æ˜æ–‡ï¼Œæ¢å¤åŸå§‹ä¿¡æ¯ã€‚</li><li><strong>ç­¾å</strong>ï¼šç”Ÿæˆä¸€ç§æ•°å­—ç­¾åæ¥è¯æ˜ä¿¡æ¯çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</li><li><strong>éªŒè¯ç­¾å</strong>ï¼šæ£€æŸ¥æ•°å­—ç­¾åæ˜¯å¦æœ‰æ•ˆï¼Œä»¥è¯å®ä¿¡æ¯æœªè¢«ç¯¡æ”¹å¹¶ç¡®è®¤å‘é€è€…çš„èº«ä»½ã€‚</li></ul><h3 id="cryptokey-usages-å±æ€§" tabindex="-1"><a class="header-anchor" href="#cryptokey-usages-å±æ€§"><span>cryptoKey.usages å±æ€§</span></a></h3><p><code>cryptoKey.usages</code> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ—å‡ºäº†ä¸€ä¸ªå¯†é’¥å¯ä»¥è¢«ç”¨äºå“ªäº›æ“ä½œã€‚è¿™ä¸ªå±æ€§çš„å€¼å–å†³äºå¯†é’¥çš„ç±»å‹å’Œåˆ›å»ºå®ƒæ—¶æŒ‡å®šçš„å‚æ•°ã€‚å¯èƒ½çš„å€¼åŒ…æ‹¬ï¼š</p><ul><li><code>&quot;encrypt&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºåŠ å¯†æ“ä½œã€‚</li><li><code>&quot;decrypt&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºè§£å¯†æ“ä½œã€‚</li><li><code>&quot;sign&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºç”Ÿæˆæ•°å­—ç­¾åã€‚</li><li><code>&quot;verify&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºéªŒè¯æ•°å­—ç­¾åã€‚</li><li><code>&quot;deriveKey&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºæ´¾ç”Ÿå‡ºå…¶ä»–å¯†é’¥ã€‚</li><li><code>&quot;deriveBits&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºæ´¾ç”Ÿå‡ºåŸå§‹æ•°æ®å—ã€‚</li><li><code>&quot;wrapKey&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºåŒ…è£…ï¼ˆåŠ å¯†ï¼‰å¦ä¸€ä¸ªå¯†é’¥ã€‚</li><li><code>&quot;unwrapKey&quot;</code>ï¼šå¯†é’¥å¯ç”¨äºå±•å¼€ï¼ˆè§£å¯†ï¼‰å¦ä¸€ä¸ªå¯†é’¥ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†ç”¨æˆ·æ•°æ®çš„åº”ç”¨ç¨‹åºã€‚ä½ å¯èƒ½ä¼šç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œä¸“é—¨ç”¨äºåŠ å¯†ä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateEncryptionKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆä¸€ä¸ªç”¨äºåŠ å¯†çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯ä»¥å¯¼å‡ºå¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">usages</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: [&#39;encrypt&#39;, &#39;decrypt&#39;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateEncryptionKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨keyè¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>generateEncryptionKey</code> å‡½æ•°ç”Ÿæˆäº†ä¸€ä¸ªç”¨äº AES-GCM åŠ å¯†ç®—æ³•çš„å¯†é’¥ï¼Œè¯¥å¯†é’¥æ—¢å¯ä»¥ç”¨äºåŠ å¯†ä¹Ÿå¯ä»¥ç”¨äºè§£å¯†æ“ä½œã€‚é€šè¿‡æŸ¥çœ‹ <code>key.usages</code> å±æ€§è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸ªå¯†é’¥çš„ç”¨é€”ã€‚</p><p>ç†è§£ <code>cryptoKey.usages</code> å¯¹äºæ­£ç¡®å®æ–½åŠ å¯†æ“ä½œå’Œç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§éå¸¸é‡è¦ã€‚è¿™ä¸ä»…å¸®åŠ©å¼€å‘è€…æ˜ç¡®æ¯ä¸ªå¯†é’¥çš„è§’è‰²å’Œé™åˆ¶ï¼Œè¿˜æœ‰åŠ©äºé¿å…æ½œåœ¨çš„å®‰å…¨é£é™©ï¼Œæ¯”å¦‚é”™è¯¯åœ°ä½¿ç”¨å¯†é’¥è¿›è¡Œä¸å½“æ“ä½œã€‚</p><h2 id="class-cryptokeypair" tabindex="-1"><a class="header-anchor" href="#class-cryptokeypair"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-cryptokeypair" target="_blank" rel="noopener noreferrer">Class: CryptoKeyPair</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œ<code>CryptoKeyPair</code>æ˜¯å…³äº Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®ã€æ•°å­—ç­¾åã€éªŒè¯ç­¾åç­‰ã€‚è¿™ä¸ªç±»ç‰¹åˆ«åœ°ä»£è¡¨äº†ä¸€ä¸ªå¯†é’¥å¯¹ï¼Œé€šå¸¸åŒ…å«ä¸¤ä¸ªå¯†é’¥ï¼šä¸€ä¸ªå…¬é’¥ï¼ˆpublic keyï¼‰å’Œä¸€ä¸ªç§é’¥ï¼ˆprivate keyï¼‰ã€‚è¿™ä¸¤ä¸ªå¯†é’¥åœ¨åŠ å¯†é€šä¿¡ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚</p><h3 id="å…¬é’¥ä¸ç§é’¥" tabindex="-1"><a class="header-anchor" href="#å…¬é’¥ä¸ç§é’¥"><span>å…¬é’¥ä¸ç§é’¥</span></a></h3><ul><li><strong>å…¬é’¥</strong>ï¼šå¯ä»¥è¢«ä»»ä½•äººçŸ¥é“å’Œä½¿ç”¨ï¼Œç”¨æ¥åŠ å¯†ä¿¡æ¯ã€‚åªæœ‰å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¯†è¿™äº›ä¿¡æ¯ã€‚</li><li><strong>ç§é’¥</strong>ï¼šåº”è¯¥è¢«å¯†é’¥æ‹¥æœ‰è€…ä¿å¯†ï¼Œç”¨æ¥è§£å¯†é€šè¿‡å…¬é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œæˆ–è€…ç”¨åœ¨ç”Ÿæˆæ•°å­—ç­¾åçš„è¿‡ç¨‹ä¸­ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-1"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><h4 id="_1-æ•°æ®åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#_1-æ•°æ®åŠ å¯†"><span>1. æ•°æ®åŠ å¯†</span></a></h4><p>å‡è®¾ Alice æƒ³è¦å‘ Bob å‘é€ä¸€æ¡åŠ å¯†æ¶ˆæ¯ï¼Œå¥¹å¯ä»¥ä½¿ç”¨ Bob çš„å…¬é’¥æ¥åŠ å¯†è¿™æ¡æ¶ˆæ¯ã€‚å› ä¸ºåªæœ‰ Bob æŒæœ‰å¯¹åº”çš„ç§é’¥ï¼Œæ‰€ä»¥åªæœ‰ Bob èƒ½å¤Ÿè§£å¯†å¹¶é˜…è¯»è¿™æ¡æ¶ˆæ¯ã€‚</p><h4 id="_2-æ•°å­—ç­¾å" tabindex="-1"><a class="header-anchor" href="#_2-æ•°å­—ç­¾å"><span>2. æ•°å­—ç­¾å</span></a></h4><p>æ•°å­—ç­¾åæ˜¯ä¸€ç§éªŒè¯ä¿¡æ¯å®Œæ•´æ€§å’Œæ¥æºçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼ŒAlice æƒ³è¦å‘é€ä¸€ä¸ªç»è¿‡ç­¾åçš„æ–‡æ¡£ç»™ Bobï¼Œå¥¹ä¼šä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥åˆ›å»ºè¿™ä¸ªæ–‡æ¡£çš„æ•°å­—ç­¾åï¼Œå¹¶å°†è¿™ä¸ªç­¾åé™„åŠ åœ¨æ–‡æ¡£ä¸Šã€‚å½“ Bob æ”¶åˆ°æ–‡æ¡£å’Œç­¾åæ—¶ï¼Œä»–å¯ä»¥ä½¿ç”¨ Alice çš„å…¬é’¥æ¥éªŒè¯ç­¾åã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œè¯´æ˜æ–‡æ¡£ç¡®å®æ˜¯ Alice å‘é€çš„ï¼Œå¹¶ä¸”åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><h3 id="åœ¨-node-js-ä¸­å¦‚ä½•ä½¿ç”¨cryptokeypair" tabindex="-1"><a class="header-anchor" href="#åœ¨-node-js-ä¸­å¦‚ä½•ä½¿ç”¨cryptokeypair"><span>åœ¨ Node.js ä¸­å¦‚ä½•ä½¿ç”¨<code>CryptoKeyPair</code></span></a></h3><p>Node.js æä¾›äº†<code>crypto</code>æ¨¡å—æ¥æ”¯æŒå„ç§åŠ å¯†æ“ä½œï¼ŒåŒ…æ‹¬ç”Ÿæˆå¯†é’¥å¯¹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç”Ÿæˆ RSA å¯†é’¥å¯¹çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> generateKeyPair</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">rsa</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">    publicKeyEncoding</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">spki</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      format</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#88C0D0;">    privateKeyEncoding</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">pkcs8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      format</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      cipher</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">aes-256-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨aes-256-cbcç®—æ³•å¯¹ç§é’¥åŠ å¯†</span></span>
<span class="line"><span style="color:#88C0D0;">      passphrase</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">top secret</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å®šä¹‰ä¸€ä¸ªå¯†ç ç”¨äºç§é’¥çš„åŠ å¯†</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // è¿™é‡Œä½ å¾—åˆ°äº†ä¸€ä¸ªRSAå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å…¬é’¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç§é’¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† RSA ç®—æ³•æ¥ç”Ÿæˆä¸€ä¸ª 2048 ä½é•¿çš„å¯†é’¥å¯¹ã€‚ç”Ÿæˆçš„å…¬é’¥å’Œç§é’¥éƒ½æ˜¯ PEM æ ¼å¼çš„ï¼Œç§é’¥è¿˜è¢«é¢å¤–ä½¿ç”¨ AES-256-CBC ç®—æ³•è¿›è¡Œäº†åŠ å¯†ä¿æŠ¤ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åˆ©ç”¨ Node.js éå¸¸ç®€å•åœ°è¿›è¡ŒåŠ å¯†ç›¸å…³çš„å¼€å‘å·¥ä½œï¼Œæ— è®ºæ˜¯éœ€è¦ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œè¿˜æ˜¯éœ€è¦é€šè¿‡æ•°å­—ç­¾åæ¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</p><h3 id="cryptokeypair-privatekey" tabindex="-1"><a class="header-anchor" href="#cryptokeypair-privatekey"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptokeypairprivatekey" target="_blank" rel="noopener noreferrer">cryptoKeyPair.privateKey</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js æä¾›äº†å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œ<code>crypto</code> æ¨¡å—å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œç”¨äºåŠ å¯†è§£å¯†æ“ä½œï¼Œè€Œ <code>Web Crypto API</code> åˆ™æ˜¯è¿™ä¸ªæ¨¡å—ä¸­è¾ƒæ–°çš„å¢å¼ºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>CryptoKeyPair</code> å¯¹è±¡æ˜¯ <code>Web Crypto API</code> çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€å¯¹å¯†é’¥ï¼šä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚è¿™å¯¹å¯†é’¥é€šå¸¸ç”¨äºéå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå…¶ä¸­ï¼š</p><ul><li>å…¬é’¥ç”¨äºåŠ å¯†æ•°æ®æˆ–éªŒè¯ç­¾åã€‚</li><li>ç§é’¥ç”¨äºè§£å¯†æ•°æ®æˆ–åˆ›å»ºç­¾åã€‚</li></ul><h3 id="cryptokeypair-privatekey-1" tabindex="-1"><a class="header-anchor" href="#cryptokeypair-privatekey-1"><span><code>cryptoKeyPair.privateKey</code></span></a></h3><p>åœ¨ <code>Node.js v21.7.1</code> ç‰ˆæœ¬ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>Web Crypto API</code> ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹æ—¶ï¼ˆæ¯”å¦‚ä½¿ç”¨ RSA æˆ– ECC ç­‰ç®—æ³•ï¼‰ï¼Œç»“æœä¼šè¿”å›ä¸€ä¸ª <code>CryptoKeyPair</code> å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§ï¼š<code>publicKey</code> å’Œ <code>privateKey</code>ï¼Œåˆ†åˆ«ä»£è¡¨ç”Ÿæˆçš„å…¬é’¥å’Œç§é’¥ã€‚<code>cryptoKeyPair.privateKey</code> å°±æ˜¯è®¿é—®è¯¥å¯†é’¥å¯¹é‡Œé¢ç§é’¥çš„æ–¹å¼ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-ç”Ÿæˆä¸€ä¸ª-rsa-å¯†é’¥å¯¹å¹¶å¯¼å‡ºç§é’¥" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç”Ÿæˆä¸€ä¸ª-rsa-å¯†é’¥å¯¹å¹¶å¯¼å‡ºç§é’¥"><span>ç¤ºä¾‹ 1ï¼šç”Ÿæˆä¸€ä¸ª RSA å¯†é’¥å¯¹å¹¶å¯¼å‡ºç§é’¥</span></a></h4><p>å‡è®¾ä½ æƒ³åœ¨ä¸€ä¸ªå®‰å…¨é€šä¿¡ä¸­ä½¿ç”¨ RSA åŠ å¯†æŠ€æœ¯ï¼Œé¦–å…ˆéœ€è¦ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶å¯èƒ½éœ€è¦å°†ç§é’¥ä¿å­˜èµ·æ¥ï¼Œä»¥ä¾¿ç¨åç”¨äºè§£å¯†æ”¶åˆ°çš„ä¿¡æ¯æˆ–å¯¹å‘é€çš„ä¿¡æ¯ç­¾åã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPairAndExportPrivateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆ RSA-OAEP å¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ¨¡é•¿</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0x01</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x00</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x01</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å…¬é’¥æŒ‡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯æå–</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¯¼å‡ºç§é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exportKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">pkcs8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¥ä¸‹æ¥å¯ä»¥å°†å¯¼å‡ºçš„ç§é’¥ä¿å­˜åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ç­‰å®‰å…¨ä½ç½®</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPairAndExportPrivateKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤ä»£ç æ®µæ¼”ç¤ºäº†å¦‚ä½•ç”Ÿæˆ RSA-OAEP å¯†é’¥å¯¹å¹¶å¯¼å‡ºç§é’¥ã€‚ç”Ÿæˆçš„ç§é’¥å¯ä»¥ç”¨äºè§£å¯†æˆ–æ•°å­—ç­¾åã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨ç§é’¥è¿›è¡Œæ•°æ®è§£å¯†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨ç§é’¥è¿›è¡Œæ•°æ®è§£å¯†"><span>ç¤ºä¾‹ 2ï¼šä½¿ç”¨ç§é’¥è¿›è¡Œæ•°æ®è§£å¯†</span></a></h4><p>åœ¨æœ‰äº†ç§é’¥ä¹‹åï¼Œå¦‚æœæœ‰åŠ å¯†çš„æ•°æ®éœ€è¦è§£å¯†ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªç§é’¥è¿›è¡Œè§£å¯†æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å‡è®¾å·²ç»æœ‰åŠ å¯†çš„æ•°æ®(encData)å’Œç›¸åº”çš„ç§é’¥(privateKey)</span></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptDataWithPrivateKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ä¹‹å‰ç”Ÿæˆçš„ç§é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    encData</span><span style="color:#616E88;"> // è¦è§£å¯†çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // decryptedData æ˜¯ ArrayBufferï¼Œæ ¹æ®å®é™…æƒ…å†µè½¬æ¢æ ¼å¼ä½¿ç”¨</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç®€å•çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªç§é’¥æ¥è§£å¯†ä¹‹å‰åŠ å¯†çš„æ•°æ®ï¼Œè¿™åœ¨å®‰å…¨é€šä¿¡ã€æ•°æ®ä¿æŠ¤ç­‰æ–¹é¢éå¸¸é‡è¦ã€‚</p><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>cryptoKeyPair.privateKey</code> åœ¨ <code>Web Crypto API</code> ä¸­çš„ä½œç”¨åŠå…¶åœ¨å®é™…ä¸­çš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="cryptokeypair-publickey" tabindex="-1"><a class="header-anchor" href="#cryptokeypair-publickey"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#cryptokeypairpublickey" target="_blank" rel="noopener noreferrer">cryptoKeyPair.publicKey</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js çš„ä¼—å¤šç‰¹æ€§ä¸­ï¼Œ<code>crypto</code> æ¨¡å—æ˜¯ä¸€ä¸ªç”¨äºåŠ å¯†çš„å†…ç½®æ¨¡å—ï¼Œæä¾›äº†åŒ…æ‹¬åŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­‰åŠŸèƒ½ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼ˆæˆ–å…¶ä»–æ”¯æŒ Web Crypto API çš„ç‰ˆæœ¬ï¼‰ï¼Œ<code>crypto.subtle</code> æ¥å£å¼•å…¥äº†ä¸ Web æ ‡å‡†å…¼å®¹çš„åŠ å¯†åŠŸèƒ½ã€‚è¿™æ„å‘³ç€ä½ ç°åœ¨å¯ä»¥åœ¨ Node.js ä¸­ä½¿ç”¨ä¸€äº›åŸå…ˆåªèƒ½åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„åŠ å¯†æŠ€æœ¯ã€‚</p><p><code>CryptoKeyPair</code> å¯¹è±¡æ˜¯ <code>crypto.subtle</code> æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºéå¯¹ç§°åŠ å¯†ã€‚éå¯¹ç§°åŠ å¯†æ˜¯ä¸€ç§åŠ å¯†æ–¹æ³•ï¼Œå®ƒä½¿ç”¨ä¸€å¯¹å¯†é’¥â€”â€”å…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œç§é’¥ç”¨äºè§£å¯†æ•°æ®ã€‚è¿™ç§æœºåˆ¶ç¡®ä¿äº†å³ä¾¿å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œæ²¡æœ‰å¯¹åº”çš„ç§é’¥ä¹Ÿæ— æ³•è§£å¯†æ•°æ®ï¼Œä»è€Œä¿éšœäº†ä¿¡æ¯çš„å®‰å…¨æ€§ã€‚</p><h3 id="cryptokeypair-publickey-1" tabindex="-1"><a class="header-anchor" href="#cryptokeypair-publickey-1"><span><code>cryptoKeyPair.publicKey</code></span></a></h3><p>å½“ä½ ä½¿ç”¨ <code>crypto.subtle.generateKey</code> æ–¹æ³•ç”Ÿæˆä¸€ä¸ªéå¯¹ç§°å¯†é’¥å¯¹æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª <code>CryptoKeyPair</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ä¸¤ä¸ªå±æ€§ï¼š<code>publicKey</code> å’Œ <code>privateKey</code>ã€‚å¦‚åå­—æ‰€ç¤ºï¼Œ<code>publicKey</code> æ˜¯ç”¨äºåŠ å¯†çš„å…¬é’¥éƒ¨åˆ†ã€‚</p><h4 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æƒ³åœ¨ Node.js åº”ç”¨ä¸­å®ç°ä¸€ä¸ªå®‰å…¨çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼š</p><ol><li><p><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ã€‚è¿™é‡Œä½¿ç”¨ RSA ç®—æ³•ä½œä¸ºç¤ºä¾‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åŠ å¯†æ¶ˆæ¯</strong>ï¼šä½¿ç”¨ç”Ÿæˆçš„å…¬é’¥åŠ å¯†ä¸€æ¡æ¶ˆæ¯ã€‚è¿™é‡Œå‡è®¾ä½ å·²ç»è°ƒç”¨ä¸Šé¢çš„ <code>generateKeyPair</code> å‡½æ•°ï¼Œå¹¶ä¸”å¾—åˆ°äº†å¯†é’¥å¯¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedMessage</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è§£å¯†æ¶ˆæ¯</strong>ï¼šæœ€åï¼Œä½¿ç”¨ç§é’¥è§£å¯†è¿™æ¡æ¶ˆæ¯ã€‚è¿™éƒ¨åˆ†éœ€è¦ç§é’¥å’ŒåŠ å¯†åçš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedMessage</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedMessage</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆé€šè¿‡è°ƒç”¨ <code>generateKeyPair</code> å‡½æ•°ç”Ÿæˆäº†ä¸€ä¸ª RSA å¯†é’¥å¯¹ï¼Œç„¶åä½¿ç”¨ <code>publicKey</code> åŠ å¯†äº†ä¸€æ¡æ¶ˆæ¯ï¼Œæœ€åä½¿ç”¨ <code>privateKey</code> æ¥è§£å¯†æ¶ˆæ¯ã€‚è¿™ä¸ªè¿‡ç¨‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ Web Crypto API è¿›è¡ŒåŸºæœ¬çš„éå¯¹ç§°åŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><p>è®°ä½ï¼Œ<code>publicKey</code> ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œ <code>privateKey</code> ç”¨äºè§£å¯†ã€‚è¿™ç§æœºåˆ¶åœ¨å¾ˆå¤šå®‰å…¨é€šä¿¡åè®®ï¼ˆå¦‚ HTTPSã€SSHï¼‰ä¸­éƒ½æœ‰å¹¿æ³›åº”ç”¨ï¼Œç¡®ä¿æ•°æ®å¯ä»¥å®‰å…¨åœ°åœ¨äº’è”ç½‘ä¸Šä¼ è¾“ã€‚</p><h2 id="class-subtlecrypto" tabindex="-1"><a class="header-anchor" href="#class-subtlecrypto"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-subtlecrypto" target="_blank" rel="noopener noreferrer">Class: SubtleCrypto</a></span></a></h2><p>Node.js ä¸­çš„<code>SubtleCrypto</code>ç±»æ˜¯ Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸º Web åº”ç”¨ç¨‹åºæä¾›åŠ å¯†æ“ä½œçš„ APIã€‚å°½ç®¡å®ƒæœ€åˆè¢«è®¾è®¡ç”¨äºæµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œä½† Node.js ä¹Ÿå®ç°äº†æ­¤ APIï¼Œä»è€Œå…è®¸æœåŠ¡å™¨ç«¯ JavaScript ä»£ç æ‰§è¡Œå„ç§åŠ å¯†æ“ä½œã€‚</p><h3 id="å…³é”®æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#å…³é”®æ¦‚å¿µ-1"><span>å…³é”®æ¦‚å¿µ</span></a></h3><ol><li><strong>åŠ å¯†</strong>ï¼šä¿¡æ¯è½¬æ¢ï¼ˆç¼–ç ï¼‰çš„è¿‡ç¨‹ï¼Œä½¿ä¹‹å¯¹æœªæˆæƒç”¨æˆ·ä¸å¯è¯»ã€‚</li><li><strong>è§£å¯†</strong>ï¼šå°†åŠ å¯†çš„ä¿¡æ¯è¿˜åŸä¸ºåŸå§‹æ ¼å¼çš„è¿‡ç¨‹ã€‚</li><li><strong>å“ˆå¸Œ</strong>ï¼šå°†è¾“å…¥ï¼ˆæˆ–æ¶ˆæ¯ï¼‰é€šè¿‡æ•£åˆ—ç®—æ³•è½¬æ¢æˆå›ºå®šå¤§å°çš„å­—ç¬¦ä¸²ï¼ˆå³å“ˆå¸Œå€¼ï¼‰ã€‚å“ˆå¸Œè¿‡ç¨‹æ˜¯å•å‘çš„ï¼Œç†è®ºä¸Šæ— æ³•é€†è½¬ã€‚</li><li><strong>ç­¾å</strong>ï¼šéªŒè¯ä¿¡æ¯å®Œæ•´æ€§å’Œæ¥æºçš„æ–¹å¼ä¹‹ä¸€ï¼Œä½¿ç”¨ç§é’¥åˆ›å»ºï¼Œå¯ä»¥ç”¨ç›¸åº”çš„å…¬é’¥éªŒè¯ã€‚</li><li><strong>å¯†é’¥</strong>ï¼šåœ¨åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ•°å€¼ã€‚æœ‰ä¸¤ç§ç±»å‹çš„å¯†é’¥ï¼š<strong>å¯¹ç§°å¯†é’¥</strong>ï¼ˆåŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ï¼‰å’Œ<strong>éå¯¹ç§°å¯†é’¥</strong>ï¼ˆä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼Œå³å…¬é’¥å’Œç§é’¥ï¼‰ã€‚</li></ol><h3 id="ä½¿ç”¨subtlecryptoçš„åœºæ™¯å’Œä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨subtlecryptoçš„åœºæ™¯å’Œä¾‹å­"><span>ä½¿ç”¨<code>SubtleCrypto</code>çš„åœºæ™¯å’Œä¾‹å­</span></a></h3><p>ä»¥ä¸‹æ˜¯<code>SubtleCrypto</code>å¯èƒ½åº”ç”¨çš„ä¸€äº›åœºåˆåŠç®€å•ç¤ºä¾‹ï¼š</p><h4 id="_1-æ•°æ®åŠ å¯†ä¸è§£å¯†" tabindex="-1"><a class="header-anchor" href="#_1-æ•°æ®åŠ å¯†ä¸è§£å¯†"><span>1. æ•°æ®åŠ å¯†ä¸è§£å¯†</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å­˜å‚¨æ•æ„Ÿç”¨æˆ·æ•°æ®çš„åº”ç”¨ç¨‹åºï¼Œå¦‚ç”¨æˆ·çš„ä¸ªäººç¬”è®°ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>SubtleCrypto</code>æ¥åŠ å¯†è¿™äº›ç¬”è®°ï¼Œåœ¨ä¿å­˜åˆ°æ•°æ®åº“ä¹‹å‰ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§ã€‚å¦‚æœç”¨æˆ·æƒ³è¦æŸ¥çœ‹ç¬”è®°ï¼Œä½ çš„åº”ç”¨ä¼šè§£å¯†è¿™äº›æ•°æ®å¹¶å‘ˆç°ç»™ç”¨æˆ·ã€‚</p><h4 id="_2-ç”¨æˆ·å¯†ç å“ˆå¸Œå¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-ç”¨æˆ·å¯†ç å“ˆå¸Œå¤„ç†"><span>2. ç”¨æˆ·å¯†ç å“ˆå¸Œå¤„ç†</span></a></h4><p>åœ¨ç”¨æˆ·æ³¨å†Œæµç¨‹ä¸­ï¼Œä½ éœ€è¦å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç ã€‚ä½¿ç”¨<code>SubtleCrypto</code>çš„å“ˆå¸ŒåŠŸèƒ½ï¼Œä½ å¯ä»¥åœ¨å­˜å‚¨å¯†ç ä¹‹å‰å°†å…¶è½¬æ¢ä¸ºå“ˆå¸Œå€¼ã€‚ç”±äºå“ˆå¸Œæ˜¯å•å‘çš„ï¼Œå¹¶ä¸”æ¯ä¸ªå¯†ç äº§ç”Ÿç‹¬ç‰¹çš„å“ˆå¸Œå€¼ï¼Œè¿™æ ·å¯ä»¥å¢åŠ å®‰å…¨æ€§ï¼Œå³ä½¿æ•°æ®åº“è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿå¾ˆéš¾ä»å“ˆå¸Œå€¼æ¢å¤å‡ºåŸå¯†ç ã€‚</p><h4 id="_3-æ•°å­—ç­¾å" tabindex="-1"><a class="header-anchor" href="#_3-æ•°å­—ç­¾å"><span>3. æ•°å­—ç­¾å</span></a></h4><p>å½“ä½ çš„åº”ç”¨éœ€è¦éªŒè¯æ–‡ä»¶æˆ–æ¶ˆæ¯æœªè¢«ç¯¡æ”¹æ—¶ï¼Œä¾‹å¦‚å‘é€é‡è¦æ–‡ä»¶æˆ–æ¶ˆæ¯ç»™å…¶ä»–ç”¨æˆ·ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>SubtleCrypto</code>ç”Ÿæˆæ•°å­—ç­¾åã€‚å‘é€æ–¹ä½¿ç”¨ç§é’¥ç”Ÿæˆç­¾åï¼Œæ¥æ”¶æ–¹åˆ™å¯ä»¥ä½¿ç”¨å…¬é’¥éªŒè¯ç­¾åçš„æœ‰æ•ˆæ€§ã€‚è¿™ç¡®ä¿äº†æ¶ˆæ¯çš„å®Œæ•´æ€§å’Œå‘é€æ–¹çš„èº«ä»½ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -ç”Ÿæˆå“ˆå¸Œå€¼" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -ç”Ÿæˆå“ˆå¸Œå€¼"><span>ç¤ºä¾‹ä»£ç ï¼šç”Ÿæˆå“ˆå¸Œå€¼</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateHash</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hash</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ä½ å¥½, ä¸–ç•Œ!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">log</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡ºæ¶ˆæ¯çš„SHA-256å“ˆå¸Œå€¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>SubtleCrypto</code>çš„<code>digest</code>æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²çš„ SHA-256 å“ˆå¸Œå€¼ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„å“ˆå¸Œç®—æ³•ï¼Œç”¨äºç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p>Node.js ä¸­çš„<code>SubtleCrypto</code>ç±»æä¾›äº†ä¸€æ•´å¥—åŠ å¯†å·¥å…·ï¼Œå¯ç”¨äºä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€éªŒè¯æ•°æ®å®Œæ•´æ€§å’Œæ¥æºç­‰ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹å’Œè§£é‡Šï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿç†è§£å…¶åŸºæœ¬ç”¨é€”å’Œæ“ä½œæ–¹å¼ã€‚éšç€å¯¹ Node.js å’ŒåŠ å¯†æ¦‚å¿µæ›´æ·±å…¥çš„å­¦ä¹ ï¼Œä½ å°†èƒ½å¤Ÿåœ¨å®é™…é¡¹ç›®ä¸­çµæ´»è¿ç”¨è¿™äº›çŸ¥è¯†ã€‚</p><h3 id="subtle-decrypt-algorithm-key-data" tabindex="-1"><a class="header-anchor" href="#subtle-decrypt-algorithm-key-data"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtledecryptalgorithm-key-data" target="_blank" rel="noopener noreferrer">subtle.decrypt(algorithm, key, data)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>subtle.decrypt</code> æ–¹æ³•ï¼Œè¿™æ˜¯ Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•ç”¨äºè§£å¯†é€šè¿‡åŠ å¯†ç®—æ³•å’Œå¯†é’¥åŠ å¯†çš„æ•°æ®ã€‚æˆ‘ä¼šå°½é‡ç®€å•åœ°è§£é‡Šï¼Œå¹¶ç»™å‡ºä¸€äº›å®é™…çš„ä¾‹å­ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œéœ€è¦æ˜ç¡®å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><strong>Web åŠ å¯† API</strong>ï¼ˆWeb Cryptography APIï¼‰æä¾›äº†ä¸€å¥—è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€ç”Ÿæˆæ•°å­—ç­¾åå’Œæ‘˜è¦ç­‰æ“ä½œçš„ JavaScript æ¥å£ã€‚å®ƒæ—¨åœ¨ä¸º web åº”ç”¨ç¨‹åºæä¾›æ›´å®‰å…¨çš„ä¿¡æ¯äº¤æ¢æ–¹å¼ã€‚</li><li><strong><code>subtle</code></strong> æ˜¯è¿™ä¸ª API ä¸­ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥æ‰§è¡Œå„ç§å¯†ç å­¦æ“ä½œã€‚</li><li><strong>è§£å¯†ï¼ˆDecryptionï¼‰</strong> æŒ‡çš„æ˜¯å°†åŠ å¯†è¿‡çš„æ•°æ®è½¬æ¢å›åŸå§‹æ•°æ®çš„è¿‡ç¨‹ã€‚</li></ul><h3 id="subtle-decrypt-çš„ç”¨é€”å’Œå·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#subtle-decrypt-çš„ç”¨é€”å’Œå·¥ä½œåŸç†"><span>subtle.decrypt çš„ç”¨é€”å’Œå·¥ä½œåŸç†</span></a></h3><p><code>subtle.decrypt</code> æ–¹æ³•ç”¨æ¥è§£å¯†é‚£äº›å·²ç»è¢«åŠ å¯†çš„æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸‰ä¸ªå…³é”®å…ƒç´ ï¼š</p><ol><li><strong>algorithmï¼ˆç®—æ³•ï¼‰</strong>ï¼šä½ ç”¨æ¥åŠ å¯†æ•°æ®æ—¶ä½¿ç”¨çš„å…·ä½“ç®—æ³•ï¼Œè§£å¯†æ—¶éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç®—æ³•ã€‚</li><li><strong>keyï¼ˆå¯†é’¥ï¼‰</strong>ï¼šè§£å¯†æ•°æ®æ‰€éœ€çš„å¯†é’¥ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªåŠ å¯†è¿‡ç¨‹ä¸­ç”Ÿæˆæˆ–ä½¿ç”¨çš„å¯†é’¥ã€‚</li><li><strong>dataï¼ˆæ•°æ®ï¼‰</strong>ï¼šè¦è§£å¯†çš„æ•°æ®ã€‚</li></ol><h3 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­"><span>ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€æ®µæ–‡æœ¬æ•°æ®ï¼Œä½ ä¹‹å‰ç”¨ AES-GCM ç®—æ³•åŠ å¯†è¿‡ï¼Œç°åœ¨ä½ æƒ³è§£å¯†å®ƒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>subtle.decrypt</code> è¿›è¡Œè§£å¯†ï¼š</p><ol><li><p><strong>å®šä¹‰åŠ å¯†ç®—æ³•å’Œç›¸å…³çš„å‚æ•°</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ä½¿ç”¨ä¸åŠ å¯†ç›¸åŒçš„ç®—æ³•å’Œå‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  iv</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å‡è®¾è¿™æ˜¯ä½ åˆå§‹åŒ–å‘é‡(iv)ï¼Œå®é™…æ“ä½œä¸­å®ƒåº”è¯¥æ˜¯éšæœºçš„ä¸”ä¸åŠ å¯†æ—¶ç›¸åŒ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è·å–å¯†é’¥</strong>ï¼š<br> å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªç”¨äºåŠ å¯†çš„å¯†é’¥ï¼Œç°åœ¨éœ€è¦ç”¨å®ƒæ¥è§£å¯†ã€‚å®é™…åº”ç”¨ä¸­ï¼Œå¯†é’¥å¯èƒ½æ˜¯é€šè¿‡æŸç§æ–¹å¼è·å¾—çš„ï¼Œä¾‹å¦‚ä»æœåŠ¡å™¨ä¸‹è½½æˆ–ä½¿ç”¨ <code>subtle.importKey</code> æ–¹æ³•å¯¼å…¥ã€‚</p></li><li><p><strong>è°ƒç”¨ <code>subtle.decrypt</code> æ–¹æ³•è§£å¯†æ•°æ®</strong>ï¼š<br> å‡è®¾ <code>encryptedData</code> æ˜¯ä½ æƒ³è§£å¯†çš„æ•°æ®ï¼Œæ˜¯ä¸€ä¸ª <code>ArrayBuffer</code> ç±»å‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">      algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // è½¬æ¢ ArrayBuffer åˆ°å­—ç¬¦ä¸²ï¼ˆå¦‚æœåŸå§‹æ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼‰</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> decoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> originalText</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> decoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">originalText</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è§£å¯†å¤±è´¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†è§£å¯†æµç¨‹çš„å¤§è‡´æ¡†æ¶ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘å„ç§ç»†èŠ‚ï¼Œæ¯”å¦‚å¦‚ä½•å®‰å…¨åœ°å¤„ç†å’Œå­˜å‚¨å¯†é’¥ã€å¦‚ä½•ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ç­‰ã€‚</p><p>å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£ <code>subtle.decrypt</code> åœ¨ Node.js ä¸­çš„ä½¿ç”¨å’Œé‡è¦æ€§ï¼</p><h3 id="subtle-derivebits-algorithm-basekey-length" tabindex="-1"><a class="header-anchor" href="#subtle-derivebits-algorithm-basekey-length"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtlederivebitsalgorithm-basekey-length" target="_blank" rel="noopener noreferrer">subtle.deriveBits(algorithm, baseKey, length)</a></span></a></h3><h3 id="node-js-ä¸­çš„-subtle-derivebits-algorithm-basekey-length" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-subtle-derivebits-algorithm-basekey-length"><span>Node.js ä¸­çš„ <code>subtle.deriveBits(algorithm, baseKey, length)</code></span></a></h3><p>åœ¨æ·±å…¥ç†è§£ <code>subtle.deriveBits</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><h4 id="_1-ä»€ä¹ˆæ˜¯-web-crypto-api" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯-web-crypto-api"><span>1. ä»€ä¹ˆæ˜¯ Web Crypto APIï¼Ÿ</span></a></h4><p>Web Crypto API ä¸ºç½‘é¡µåº”ç”¨æä¾›äº†ä¸€å¥—ç”¨äºæ‰§è¡ŒåŸºæœ¬çš„åŠ å¯†æ“ä½œçš„æ¥å£ï¼Œå¦‚æ•£åˆ—ã€ç­¾åç”Ÿæˆä¸éªŒè¯ã€åŠ å¯†ä¸è§£å¯†ç­‰ã€‚å®ƒæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å®šä¹‰çš„ï¼Œä½† Node.js å®ç°äº†ç±»ä¼¼çš„<code>crypto</code>æ¨¡å—ï¼Œå…¶ä¸­çš„<code>subtle</code>å¯¹è±¡æä¾›äº†ç±»ä¼¼äº Web çš„åŠ å¯†åŠŸèƒ½ã€‚</p><h4 id="_2-å¯†é’¥æ´¾ç”Ÿ-key-derivation" tabindex="-1"><a class="header-anchor" href="#_2-å¯†é’¥æ´¾ç”Ÿ-key-derivation"><span>2. å¯†é’¥æ´¾ç”Ÿï¼ˆKey Derivationï¼‰</span></a></h4><p>å¯†é’¥æ´¾ç”Ÿæ„å‘³ç€ä»ä¸€ä¸ªå¯†é’¥ç”Ÿæˆå¦ä¸€ä¸ªå¯†é’¥ã€‚è¿™é‡Œçš„åŸå§‹å¯†é’¥ç§°ä¸ºâ€œåŸºç¡€å¯†é’¥â€(<code>baseKey</code>)ï¼Œè€Œè¡ç”Ÿå‡ºæ¥çš„å¯†é’¥å¯ä»¥ç”¨äºä¸åŒçš„ç›®çš„ï¼Œæ¯”å¦‚åŠ å¯†ã€‚å¯†é’¥æ´¾ç”Ÿè¿‡ç¨‹é€šå¸¸ä¾èµ–äºç‰¹å®šç®—æ³•ï¼Œå¹¶å¯èƒ½åŒ…æ‹¬é¢å¤–çš„æ•°æ®ï¼ˆå¦‚ç›å€¼ï¼‰ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚</p><h4 id="_3-subtle-derivebits-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_3-subtle-derivebits-çš„ä½œç”¨"><span>3. <code>subtle.deriveBits</code> çš„ä½œç”¨</span></a></h4><p><code>subtle.deriveBits</code> æ–¹æ³•å…è®¸æ‚¨æ ¹æ®ç»™å®šçš„ç®—æ³•ã€åŸºç¡€å¯†é’¥å’ŒæœŸæœ›é•¿åº¦æ¥æ´¾ç”Ÿä¸€æ®µå›ºå®šé•¿åº¦çš„æ¯”ç‰¹ä¸²ï¼ˆbitsï¼‰ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºç”Ÿæˆå¯†é’¥ææ–™æˆ–è€…å…¶ä»–æŸäº›åŠ å¯†ä»»åŠ¡æ‰€éœ€çš„ç‰¹å®šé•¿åº¦çš„æ•°æ®ã€‚</p><h4 id="å‚æ•°è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯¦è§£"><span>å‚æ•°è¯¦è§£ï¼š</span></a></h4><ul><li><p><code>algorithm</code>: è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å®šäº†è¦ä½¿ç”¨çš„æ´¾ç”Ÿç®—æ³•åŠå…¶å¿…è¦çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ PBKDF2 ç®—æ³•ï¼Œä½ éœ€è¦æŒ‡å®šç›å€¼(salt)ï¼Œè¿­ä»£æ¬¡æ•°(iterations)ï¼Œå“ˆå¸Œå‡½æ•°(hash)ç­‰ã€‚</p></li><li><p><code>baseKey</code>: è¿™æ˜¯æ´¾ç”Ÿè¿‡ç¨‹ä¸­ç”¨åˆ°çš„åŸå§‹å¯†é’¥ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªç¬¦åˆç‰¹å®šç®—æ³•è¦æ±‚çš„å¯†é’¥ç±»å‹ã€‚</p></li><li><p><code>length</code>: æŒ‡å®šäº†æ´¾ç”Ÿå‡ºçš„æ¯”ç‰¹ä¸²çš„é•¿åº¦ï¼Œå•ä½æ˜¯æ¯”ç‰¹ï¼ˆbitï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å¾—åˆ°ä¸€ä¸ª 256 ä½çš„å¯†é’¥ï¼Œä½ å°±åº”è¯¥å°† length è®¾ç½®ä¸º 256ã€‚</p></li></ul><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†ç”¨æˆ·æ•°æ®çš„ web åº”ç”¨ã€‚ç”¨æˆ·å¯†ç å¯ä»¥è¢«ç”¨ä½œåŸºç¡€å¯†é’¥ï¼Œä½†ç›´æ¥ä½¿ç”¨å¯†ç è¿›è¡ŒåŠ å¯†å¹¶ä¸å®‰å…¨ã€‚ç›¸åï¼Œä½ å¯ä»¥ä½¿ç”¨ç”¨æˆ·çš„å¯†ç ä½œä¸ºåŸºç¡€æ¥æ´¾ç”Ÿå‡ºä¸€ä¸ªæ›´å¤æ‚çš„åŠ å¯†å¯†é’¥ã€‚è¿™æ ·å³ä½¿å¯†ç è¾ƒå¼±ï¼Œæ´¾ç”Ÿå‡ºçš„å¯†é’¥ä¹Ÿèƒ½ä¿æŒå¾ˆé«˜çš„å®‰å…¨æ€§ã€‚</p><h5 id="ç¤ºä¾‹ä»£ç -3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -3"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> deriveEncryptionKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iterations</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> digest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> length</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // é¦–å…ˆï¼Œå°†å¯†ç è½¬æ¢ä¸ºCryptoKey</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveBits</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedBits</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveBits</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">salt</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iterations</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iterations</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> digest</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    length</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å°†æ´¾ç”Ÿçš„bitsè½¬æ¢ä¸ºç”¨äºåŠ å¯†çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    derivedBits</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#88C0D0;">deriveEncryptionKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userPassword</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">someSalt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 256</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Derived Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†ç”¨æˆ·çš„å¯†ç é€šè¿‡<code>importKey</code>è½¬æ¢æˆä¸€ä¸ª<code>CryptoKey</code>å¯¹è±¡ã€‚ç„¶åä½¿ç”¨<code>subtle.deriveBits</code>æ–¹æ³•ä»¥ PBKDF2 ç®—æ³•æ´¾ç”Ÿå‡º 256 ä½çš„å¯†é’¥ææ–™ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¿™æ®µå¯†é’¥ææ–™è½¬æ¢æˆä¸€ä¸ªå¯ä»¥ç”¨äº AES-GCM åŠ å¯†çš„<code>CryptoKey</code>å¯¹è±¡ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>subtle.deriveBits</code>æ˜¯ Node.js ä¸­ Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸ä»ä¸€ä¸ªåŸºç¡€å¯†é’¥æ´¾ç”Ÿå‡ºä¸€æ®µå¯†é’¥ææ–™ã€‚é€šè¿‡é€‰æ‹©åˆé€‚çš„ç®—æ³•å’Œå‚æ•°ï¼Œä½ å¯ä»¥å®‰å…¨åœ°ç”Ÿæˆç”¨äºåŠ å¯†ã€ç­¾åæˆ–å…¶ä»–ç›®çš„çš„å¯†é’¥ï¼Œå¢å¼ºä½ çš„åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><h3 id="subtle-derivekey-algorithm-basekey-derivedkeyalgorithm-extractable-keyusages" tabindex="-1"><a class="header-anchor" href="#subtle-derivekey-algorithm-basekey-derivedkeyalgorithm-extractable-keyusages"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtlederivekeyalgorithm-basekey-derivedkeyalgorithm-extractable-keyusages" target="_blank" rel="noopener noreferrer">subtle.deriveKey(algorithm, baseKey, derivedKeyAlgorithm, extractable, keyUsages)</a></span></a></h3><p>è§£é‡Š <code>subtle.deriveKey()</code> æ–¹æ³•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆäº†è§£å®ƒå±äºçš„ Web Cryptography APIï¼Œåœ¨ Node.js ä¸­è¢«ç§°ä¸º WebCryptoã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡ŒåŸºæœ¬åŠ å¯†æ“ä½œï¼ˆå¦‚å“ˆå¸Œã€ç­¾åã€åŠ å¯†å’Œè§£å¯†ï¼‰çš„ JavaScript APIï¼Œç‰¹åˆ«é€‚åˆåœ¨ Web ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨ Node.js ç­‰æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†-1"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><p>åœ¨æ·±å…¥ <code>subtle.deriveKey()</code> ä¹‹å‰ï¼Œæœ‰å‡ ä¸ªåŸºç¡€æ¦‚å¿µéœ€è¦æ˜ç¡®ï¼š</p><ol><li><strong>åŠ å¯†</strong>ï¼šå°†ä¿¡æ¯è½¬æ¢æˆåªæœ‰æ‹¥æœ‰ç‰¹å®šå¯†é’¥çš„äººæ‰èƒ½é˜…è¯»çš„å½¢å¼ã€‚</li><li><strong>å¯†é’¥</strong>ï¼šç”¨äºåŠ å¯†æˆ–è§£å¯†ä¿¡æ¯çš„ä¸€ä¸²å­—ç¬¦ã€‚</li><li><strong>å¯†é’¥æ´¾ç”Ÿ</strong>ï¼šæ˜¯ä»ä¸€ä¸ªå¯†é’¥ç”Ÿæˆå¦ä¸€ä¸ªå¯†é’¥çš„è¿‡ç¨‹ã€‚é€šå¸¸ç”¨äºåˆ›å»ºä¸€ä¸ªéš¾ä»¥çŒœæµ‹çš„æ–°å¯†é’¥ï¼Œå³ä¾¿åŸå§‹å¯†é’¥è¢«æ³„éœ²ï¼Œæ´¾ç”Ÿå‡ºæ¥çš„å¯†é’¥ä»ç„¶å®‰å…¨ã€‚</li></ol><h3 id="subtle-derivekey-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#subtle-derivekey-è§£é‡Š"><span>subtle.deriveKey() è§£é‡Š</span></a></h3><p><code>subtle.deriveKey()</code> æ˜¯ Web Cryptography API æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ ¹æ®ç»™å®šçš„åŸºç¡€å¯†é’¥ (<code>baseKey</code>) å’Œä¸€ä¸ªç®—æ³• (<code>algorithm</code>) æ´¾ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å¯†é’¥ (<code>derivedKey</code>)ã€‚å¾—åˆ°çš„å¯†é’¥å¯ä»¥ç”¨äºä¸åŒçš„åŠ å¯†ä»»åŠ¡ï¼Œæ¯”å¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åéªŒè¯ç­‰ã€‚</p><p>å‚æ•°è¯¦è§£ï¼š</p><ul><li><strong>algorithm</strong>: æè¿°å¦‚ä½•ä» <code>baseKey</code> æ´¾ç”Ÿæ–°å¯†é’¥çš„ç®—æ³•åŠå…¶ç›¸å…³å‚æ•°ã€‚</li><li><strong>baseKey</strong>: åŸå§‹å¯†é’¥ï¼Œç”¨ä½œæ´¾ç”Ÿå¯†é’¥çš„åŸºç¡€ã€‚</li><li><strong>derivedKeyAlgorithm</strong>: æ´¾ç”Ÿå¯†é’¥åº”å½“éµå¾ªçš„ç®—æ³•åŠå…¶å‚æ•°ï¼Œå®šä¹‰äº†æ´¾ç”Ÿå‡ºçš„å¯†é’¥å°†å¦‚ä½•è¢«ä½¿ç”¨ã€‚</li><li><strong>extractable</strong>: ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå†³å®šäº†æ´¾ç”Ÿå‡ºçš„å¯†é’¥æ˜¯å¦å¯ä»¥ä» CryptoKey å¯¹è±¡ä¸­å¯¼å‡ºã€‚</li><li><strong>keyUsages</strong>: å®šä¹‰äº†æ´¾ç”Ÿå‡ºçš„å¯†é’¥å…è®¸æ‰§è¡Œçš„æ“ä½œï¼Œå¦‚åŠ å¯†(<code>encrypt</code>)ã€è§£å¯†(<code>decrypt</code>)ã€ç­¾å(<code>sign</code>)ç­‰ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“æ•°æ®çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å¸Œæœ›ä½¿ç”¨ç”¨æˆ·çš„å¯†ç ä½œä¸ºåŸºç¡€æ¥ç”Ÿæˆä¸€ç»„ç”¨äºåŠ å¯†æ•°æ®çš„å¯†é’¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateDerivedKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†ç”¨æˆ·å¯†ç è½¬æ¢ä¸ºCryptoKeyå¯¹è±¡</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveBits</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰æ´¾ç”Ÿå¯†é’¥æ—¶ä½¿ç”¨çš„ç®—æ³•</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> deriveKeyAlg</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    salt</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">salt</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ç›æé«˜å®‰å…¨æ€§</span></span>
<span class="line"><span style="color:#88C0D0;">    iterations</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿­ä»£æ¬¡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰æ´¾ç”Ÿå‡ºçš„å¯†é’¥å°†è¦ä½¿ç”¨çš„ç®—æ³•</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedKeyAlgorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    deriveKeyAlg</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    derivedKeyAlgorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨å‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">generateDerivedKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userPassword123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">someRandomSalt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥æ´¾ç”ŸæˆåŠŸã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥æ´¾ç”Ÿå¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†ç”¨æˆ·çš„å¯†ç è½¬åŒ–ä¸ºä¸€ä¸ªå¯ä»¥ç”¨äºæ´¾ç”Ÿå¯†é’¥çš„ <code>CryptoKey</code> å¯¹è±¡ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªä½¿ç”¨ PBKDF2 ç®—æ³•è¿›è¡Œå¯†é’¥æ´¾ç”Ÿçš„ç®—æ³•å¯¹è±¡ (<code>deriveKeyAlg</code>)ï¼Œè¿™æ¶‰åŠåˆ°é€‰æ‹©ä¸€ä¸ªå“ˆå¸Œç®—æ³•ï¼ˆå¦‚ SHA-256ï¼‰ã€è¿­ä»£æ¬¡æ•°ä»¥åŠç›ï¼ˆå¢åŠ é¢å¤–çš„éšæœºæ€§ï¼Œæé«˜å®‰å…¨æ€§ï¼‰ã€‚ç„¶åæˆ‘ä»¬å®šä¹‰æ´¾ç”Ÿå¯†é’¥çš„ç±»å‹å’Œå¤§å°ï¼ˆåœ¨æ­¤ä¾‹ä¸­æ˜¯ AES-GCM ç®—æ³•çš„ 256 ä½é•¿å¯†é’¥ï¼‰ï¼Œæœ€åæˆ‘ä»¬è°ƒç”¨ <code>subtle.deriveKey()</code> æ–¹æ³•æ¥ç”Ÿæˆå¯†é’¥ï¼Œè¯¥å¯†é’¥å¯ç”¨äºåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿æ”»å‡»è€…çŸ¥é“äº†ç”¨æˆ·çš„å¯†ç ï¼Œæ²¡æœ‰ç›å€¼å’Œè¿­ä»£æ¬¡æ•°ç­‰å…·ä½“æ´¾ç”Ÿå‚æ•°ï¼Œä»–ä»¬ä¹Ÿå¾ˆéš¾è·å–åˆ°å®é™…ç”¨äºåŠ å¯†æ•°æ®çš„å¯†é’¥ã€‚</p><h3 id="subtle-digest-algorithm-data" tabindex="-1"><a class="header-anchor" href="#subtle-digest-algorithm-data"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtledigestalgorithm-data" target="_blank" rel="noopener noreferrer">subtle.digest(algorithm, data)</a></span></a></h3><p>ç†è§£ <code>subtle.digest(algorithm, data)</code> åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•äº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ol><li><p><strong>Node.js</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒè®©ä½ ç”¨ JavaScript åšåç«¯å¼€å‘ã€‚</p></li><li><p><strong>Web Cryptography API</strong>ï¼šè¿™æ˜¯ä¸€å¥—å…è®¸è¿›è¡ŒåŠ å¯†æ“ä½œçš„ Web æ ‡å‡† APIï¼Œä»¥ä¿æŠ¤ä¿¡æ¯å®‰å…¨ã€‚</p></li><li><p><strong>æ‘˜è¦ï¼ˆDigestï¼‰</strong>ï¼šä¹Ÿè¢«ç§°ä¸ºå“ˆå¸Œï¼ˆHashï¼‰ï¼Œæ˜¯ä¸€ç§å°†ä»»æ„å¤§å°çš„æ•°æ®è½¬æ¢æˆå›ºå®šé•¿åº¦å­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å•å‘çš„ï¼Œå³æ— æ³•ä»æ‘˜è¦åæ¨åŸå§‹æ•°æ®ã€‚å¸¸è§çš„åº”ç”¨åŒ…æ‹¬éªŒè¯æ–‡ä»¶å®Œæ•´æ€§å’Œå­˜å‚¨å¯†ç ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>subtle.digest</code>ï¼š</p><h3 id="ä»€ä¹ˆæ˜¯-subtle-digest-algorithm-data" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-subtle-digest-algorithm-data"><span>ä»€ä¹ˆæ˜¯ <code>subtle.digest(algorithm, data)</code>ï¼Ÿ</span></a></h3><p><code>subtle.digest</code> æ˜¯ Node.js ä¸­ Web Cryptography API çš„ä¸€éƒ¨åˆ†ã€‚å®ƒç”¨äºç”Ÿæˆæ•°æ®çš„æ‘˜è¦ï¼ˆæˆ–å“ˆå¸Œï¼‰ã€‚ä½ åªéœ€æä¾›ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li><strong>algorithm</strong>ï¼šä½ æƒ³ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Œå¦‚ SHA-256ã€‚</li><li><strong>data</strong>ï¼šä½ æƒ³è¦ç”Ÿæˆæ‘˜è¦çš„æ•°æ®ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>è®©æˆ‘ä»¬é€šè¿‡å®é™…çš„ä¾‹å­æ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨ <code>subtle.digest</code>ï¼š</p><h4 id="ç¤ºä¾‹-1-éªŒè¯æ–‡ä»¶å®Œæ•´æ€§" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-éªŒè¯æ–‡ä»¶å®Œæ•´æ€§"><span>ç¤ºä¾‹ 1ï¼šéªŒè¯æ–‡ä»¶å®Œæ•´æ€§</span></a></h4><p>å‡è®¾ä½ ä¸‹è½½äº†ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ªæ“ä½œç³»ç»Ÿé•œåƒï¼Œå¹¶ä¸”ä¸‹è½½é¡µé¢æä¾›äº†æ–‡ä»¶çš„ SHA-256 å“ˆå¸Œå€¼ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>subtle.digest</code> æ¥è®¡ç®—ä¸‹è½½æ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œç„¶åä¸ç½‘ç«™æä¾›çš„å“ˆå¸Œå€¼å¯¹æ¯”ï¼Œä»¥æ­¤éªŒè¯æ–‡ä»¶æ˜¯å¦å®Œæ•´ã€æœªç»ç¯¡æ”¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifyFileHash</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> expectedHash</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> fileBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> fileBuffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashArray</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Array</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hashBuffer</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashHex</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> hashArray</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">map</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">padStart</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> hashHex</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> expectedHash</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨æ—¶æ›¿æ¢ä¸ºå®é™…çš„æ–‡ä»¶è·¯å¾„å’ŒæœŸæœ›çš„å“ˆå¸Œå€¼</span></span>
<span class="line"><span style="color:#88C0D0;">verifyFileHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file.iso</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">expectedSha256HashValue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">isValid</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">File is </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">isValid</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">not </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">valid.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-ç”¨æˆ·å¯†ç å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç”¨æˆ·å¯†ç å­˜å‚¨"><span>ç¤ºä¾‹ 2ï¼šç”¨æˆ·å¯†ç å­˜å‚¨</span></a></h4><p>å½“ç”¨æˆ·åˆ›å»ºè´¦å·å¹¶è®¾ç½®å¯†ç æ—¶ï¼Œæœ€å¥½ä¸è¦ç›´æ¥å°†æ˜æ–‡å¯†ç å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ç›¸åï¼Œä½ åº”è¯¥å­˜å‚¨å¯†ç çš„å“ˆå¸Œå€¼ã€‚è¿™æ ·ï¼Œå³ä½¿æ•°æ®åº“è¢«æœªæˆæƒè®¿é—®ï¼Œæ”»å‡»è€…ä¹Ÿå¾ˆéš¾æ¢å¤åŸå§‹å¯†ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> hashPassword</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> passwordBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> passwordBuffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashArray</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Array</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hashBuffer</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hashHex</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> hashArray</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">map</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">padStart</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å­˜å‚¨ hashHex åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç”¨æˆ·æ³¨å†Œæˆ–æ›´æ”¹å¯†ç æ—¶è°ƒç”¨</span></span>
<span class="line"><span style="color:#88C0D0;">hashPassword</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userPassword123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1"><span>å°ç»“</span></a></h3><p><code>subtle.digest</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºç”Ÿæˆæ•°æ®çš„æ‘˜è¦ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶åœ¨ç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œå®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯æ–¹é¢çš„åº”ç”¨ã€‚å§‹ç»ˆè®°ä½é€‰æ‹©åˆé€‚çš„å“ˆå¸Œç®—æ³•ï¼Œå› ä¸ºä¸åŒçš„ç®—æ³•æœ‰ä¸åŒçš„ç‰¹æ€§å’Œå®‰å…¨çº§åˆ«ã€‚</p><h3 id="subtle-encrypt-algorithm-key-data" tabindex="-1"><a class="header-anchor" href="#subtle-encrypt-algorithm-key-data"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtleencryptalgorithm-key-data" target="_blank" rel="noopener noreferrer">subtle.encrypt(algorithm, key, data)</a></span></a></h3><p>å½“ä½ å¼€å§‹å­¦ä¹  Node.jsï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°å®‰å…¨æ€§å’ŒåŠ å¯†çš„éƒ¨åˆ†æ—¶ï¼Œ<code>subtle.encrypt()</code>æ–¹æ³•æ˜¯ä½ ä¼šé‡åˆ°çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚è¿™ä¸ªæ–¹æ³•æ¥è‡ª Web Crypto APIï¼Œåœ¨ Node.js ä¸­åŒæ ·å¯ç”¨ï¼Œä¸»è¦ç”¨äºæ‰§è¡ŒåŠ å¯†æ“ä½œã€‚æˆ‘ä¼šå°½é‡ç®€å•åœ°è§£é‡Šå®ƒæ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…ä¸­ä½¿ç”¨å®ƒã€‚</p><h3 id="åŸºæœ¬è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è§£é‡Š"><span>åŸºæœ¬è§£é‡Š</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£å‡ ä¸ªåŸºæœ¬æœ¯è¯­ï¼š</p><ul><li><strong>åŠ å¯†</strong> æ˜¯å°†æ˜æ–‡ï¼ˆä½ å¯ä»¥ç†è§£ä¸ºæ­£å¸¸é˜…è¯»çš„æ–‡æœ¬ï¼‰è½¬æ¢æˆæ— æ³•ç›´æ¥é˜…è¯»çš„æ ¼å¼ï¼ˆç§°ä¸ºå¯†æ–‡ï¼‰ï¼Œç›®çš„æ˜¯ä¿æŠ¤æ•°æ®çš„éšç§ã€‚</li><li><strong>ç®—æ³•ï¼ˆAlgorithmï¼‰</strong> æ˜¯æ‰§è¡ŒåŠ å¯†å’Œè§£å¯†çš„å…·ä½“æ–¹æ³•æˆ–ç¨‹åºæŒ‡ä»¤ã€‚æœ‰å¾ˆå¤šç§åŠ å¯†ç®—æ³•ï¼Œæ¯ç§éƒ½æœ‰å…¶ç‰¹ç‚¹ï¼Œæ¯”å¦‚ AESã€RSA ç­‰ã€‚</li><li><strong>å¯†é’¥ï¼ˆKeyï¼‰</strong> æ˜¯ä¸€ä¸²ç”¨äºåŠ å¯†å’Œè§£å¯†çš„æ•°æ®ã€‚åŠ å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å¯†é’¥ï¼Œä¹Ÿéœ€è¦åœ¨è§£å¯†æ—¶ä½¿ç”¨ï¼Œå› æ­¤å¯†é’¥çš„å®‰å…¨éå¸¸é‡è¦ã€‚</li></ul><p>å†æ¥çœ‹<code>subtle.encrypt()</code>æ–¹æ³•ï¼Œå®ƒæ˜¯ Web Crypto API æä¾›çš„ç”¨äºæ•°æ®åŠ å¯†çš„å‡½æ•°ã€‚å®ƒçš„å‚æ•°åŒ…æ‹¬ï¼š</p><ol><li><code>algorithm</code>ï¼šæŒ‡å®šä½¿ç”¨çš„åŠ å¯†ç®—æ³•åŠå…¶æ‰€éœ€çš„å‚æ•°ã€‚</li><li><code>key</code>ï¼šç”¨äºåŠ å¯†æ•°æ®çš„å¯†é’¥ã€‚</li><li><code>data</code>ï¼šä½ æƒ³åŠ å¯†çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ˜æ–‡ã€‚</li></ol><h3 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦å®‰å…¨åœ°ä¼ è¾“ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç æˆ–ä¸ªäººæ ‡è¯†ä¿¡æ¯ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>subtle.encrypt()</code>æ¥åŠ å¯†è¿™äº›ä¿¡æ¯ï¼Œç¡®ä¿å³ä¾¿æ•°æ®è¢«æˆªè·ï¼Œæ²¡æœ‰å¯¹åº”çš„å¯†é’¥ä¹Ÿæ— æ³•è§£è¯»å†…å®¹ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -4" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -4"><span>ç¤ºä¾‹ä»£ç </span></a></h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨<code>subtle.encrypt()</code>è¿›è¡ŒåŠ å¯†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¼•å…¥webcryptoæ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨AES-GCMç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦256ä½</span></span>
<span class="line"><span style="color:#88C0D0;">    iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> rawKey</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">mysecretkeythatneedstobe256bitslong</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç¤ºæ„çš„å¯†é’¥ï¼Œç”Ÿäº§ä¸­ä¼šæ›´å¤æ‚</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">rawKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¦åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°åŠ å¯†ç»“æœï¼Œå®é™…ä½¿ç”¨æ—¶å¯èƒ½éœ€è¦è½¬æ¢ä¸ºæ›´æ–¹ä¾¿ä¼ è¾“çš„æ ¼å¼</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">encryptData</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†åŠ å¯†ç®—æ³•ï¼ˆAES-GCMï¼‰åŠå…¶å¿…è¦å‚æ•°ï¼ˆå¯†é’¥é•¿åº¦å’Œåˆå§‹åŒ–å‘é‡ï¼‰ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯†é’¥ï¼Œå¹¶ä¸”ä½¿ç”¨<code>subtle.encrypt()</code>æ–¹æ³•å¯¹ä¸€æ®µæ–‡æœ¬ï¼ˆ&quot;Hello, world!&quot;ï¼‰è¿›è¡ŒåŠ å¯†ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨çš„<code>mysecretkeythatneedstobe256bitslong</code>ä¸ºç¤ºæ„æ€§å¯†é’¥ï¼Œå®é™…å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨å®‰å…¨çš„æ–¹å¼ç”Ÿæˆå’Œå­˜å‚¨å¯†é’¥ã€‚æ­¤å¤–ï¼ŒåŠ å¯†çš„ç»“æœæ˜¯ä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œé€šå¸¸éœ€è¦è½¬æ¢ä¸º Base64 æˆ–åå…­è¿›åˆ¶å­—ç¬¦ä¸²ç­‰æ ¼å¼ï¼Œä»¥ä¾¿äºå­˜å‚¨æˆ–ä¼ è¾“ã€‚</p><h3 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h3><p><code>subtle.encrypt()</code>æ˜¯ Node.js ä¸­ç”¨äºæ•°æ®åŠ å¯†çš„å¼ºå¤§å·¥å…·ã€‚é€šè¿‡é€‰æ‹©åˆé€‚çš„åŠ å¯†ç®—æ³•å’Œå®‰å…¨ç®¡ç†å¯†é’¥ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä¿æŠ¤åº”ç”¨ä¸­çš„æ•æ„Ÿä¿¡æ¯ä¸è¢«æœªæˆæƒè®¿é—®ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£å®ƒçš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•ï¼</p><h3 id="subtle-exportkey-format-key" tabindex="-1"><a class="header-anchor" href="#subtle-exportkey-format-key"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtleexportkeyformat-key" target="_blank" rel="noopener noreferrer">subtle.exportKey(format, key)</a></span></a></h3><p>Node.js ä¸­çš„<code>subtle.exportKey(format, key)</code>å‡½æ•°æ˜¯ Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ª API æä¾›äº†åŒ…æ‹¬åŠ å¯†ã€è§£å¯†ã€ç­¾åã€éªŒè¯ç­‰åœ¨å†…çš„ä¸€ç³»åˆ—åŠ å¯†æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼Œ<code>subtle.exportKey</code>ç”¨äºå°†å­˜å‚¨åœ¨ CryptoKey å¯¹è±¡ä¸­çš„å¯†é’¥å¯¼å‡ºä¸ºå¯ç”¨çš„æ ¼å¼ï¼Œè¿™æ ·å°±èƒ½è½»æ¾åœ°åœ¨ä¸åŒç³»ç»Ÿæˆ–åº”ç”¨é—´å…±äº«å¯†é’¥ã€‚</p><h3 id="å‚æ•°è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>format</code>: è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼ŒæŒ‡å®šäº†å¯†é’¥å¯¼å‡ºåçš„æ ¼å¼ã€‚å¸¸è§çš„æ ¼å¼æœ‰<code>&quot;raw&quot;</code>ã€<code>&quot;pkcs8&quot;</code>ã€<code>&quot;spki&quot;</code>å’Œ<code>&quot;jwk&quot;</code>ã€‚ <ul><li><code>&quot;raw&quot;</code>ï¼šè¡¨ç¤ºåŸç”Ÿçš„äºŒè¿›åˆ¶æ ¼å¼ã€‚</li><li><code>&quot;pkcs8&quot;</code>ï¼šé€‚ç”¨äºç§é’¥ï¼Œè¡¨ç¤ºç§é’¥ä¿¡æ¯è¯­æ³•è§„èŒƒ#8ã€‚</li><li><code>&quot;spki&quot;</code>ï¼šé€‚ç”¨äºå…¬é’¥ï¼Œè¡¨ç¤ºç®€å•å…¬é’¥åŸºç¡€è®¾æ–½ã€‚</li><li><code>&quot;jwk&quot;</code>ï¼šè¡¨ç¤º JSON Web Keyï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„ã€åŸºäº JSON çš„æ–¹å¼æ¥è¡¨ç¤ºå¯†é’¥ã€‚</li></ul></li><li><code>key</code>: è¿™æ˜¯è¦å¯¼å‡ºçš„å¯†é’¥ï¼Œæ˜¯ä¸€ä¸ª<code>CryptoKey</code>å¯¹è±¡ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-2" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-2"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><h4 id="åœºæ™¯-1-å¯†é’¥äº¤æ¢" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯-1-å¯†é’¥äº¤æ¢"><span>åœºæ™¯ 1: å¯†é’¥äº¤æ¢</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ã€‚åœ¨è¿™æ ·çš„åº”ç”¨ä¸­ï¼Œä¸¤ä¸ªç”¨æˆ·å¯èƒ½å¸Œæœ›é€šè¿‡ä¸€ä¸ªå®‰å…¨çš„é€šé“äº¤æ¢å¯†é’¥ï¼Œä»¥ä¾¿ä¹‹åçš„é€šä¿¡å¯ä»¥åŠ å¯†è¿›è¡Œã€‚ä½ å¯ä»¥ä½¿ç”¨<code>subtle.exportKey</code>å°†ç”¨æˆ·çš„å¯†é’¥å¯¼å‡ºåˆ°ä¸€ä¸ªå…±äº«çš„å®‰å…¨ä½ç½®ï¼Œç„¶åå¦ä¸€ä¸ªç”¨æˆ·å¯ä»¥å¯¼å…¥è¿™ä¸ªå¯†é’¥å¹¶ç”¨å®ƒæ¥åŠ å¯†æ¶ˆæ¯ã€‚</p><h4 id="åœºæ™¯-2-å¤‡ä»½å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯-2-å¤‡ä»½å¯†é’¥"><span>åœºæ™¯ 2: å¤‡ä»½å¯†é’¥</span></a></h4><p>åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦å¤‡ä»½ä»–ä»¬çš„åŠ å¯†å¯†é’¥ï¼Œä»¥é˜²ä¸‡ä¸€ä¸¢å¤±äº†è®¾å¤‡æˆ–æ•°æ®ã€‚é€šè¿‡ä½¿ç”¨<code>subtle.exportKey</code>ï¼Œå¯†é’¥å¯ä»¥è¢«å¯¼å‡ºå¹¶ä¿å­˜åˆ°ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¸€ä¸ªåŠ å¯†çš„äº‘å­˜å‚¨æœåŠ¡ã€‚å½“éœ€è¦æ—¶ï¼Œç”¨æˆ·å¯ä»¥é‡æ–°å¯¼å…¥è¿™ä¸ªå¯†é’¥ï¼Œæ— éœ€é‡æ–°ç”Ÿæˆã€‚</p><h4 id="åœºæ™¯-3-å…¬é’¥åˆ†äº«" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯-3-å…¬é’¥åˆ†äº«"><span>åœºæ™¯ 3: å…¬é’¥åˆ†äº«</span></a></h4><p>å½“ä½¿ç”¨éå¯¹ç§°åŠ å¯†æ—¶ï¼Œå…¬é’¥éœ€è¦è¢«åˆ†äº«ç»™ä»»ä½•å¯èƒ½éœ€è¦åŠ å¯†æ•°æ®ä»¥å‘é€ç»™å¯†é’¥æŒæœ‰è€…çš„äººã€‚é€šè¿‡ä½¿ç”¨<code>subtle.exportKey</code>ï¼Œå…¬é’¥å¯ä»¥è¢«å¯¼å‡ºä¸º<code>&quot;spki&quot;</code>æ ¼å¼ï¼Œç„¶åé€šè¿‡ emailã€API æˆ–ä»»ä½•å…¶ä»–æ–¹å¼è¢«å‘é€ç»™éœ€è¦å®ƒçš„äººã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -5" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -5"><span>ç¤ºä¾‹ä»£ç </span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”Ÿæˆå¯†é’¥çš„å‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAESSHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">      // ä¸åŒçš„ç®—æ³•å’Œç”¨é€”å¯èƒ½éœ€è¦ä¸åŒçš„å‚æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0x01</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x00</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x01</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¯¼å‡ºå…¬é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> exportedPublicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exportKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">spki</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨exportedPublicKeyåšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å‘é€ç»™å…¶ä»–ç”¨æˆ·</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œæœ¬ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ Web ç¯å¢ƒçš„ Global <code>crypto</code>å¯¹è±¡ï¼Œè€Œåœ¨ Node.js ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å¼•å…¥ç›¸åº”çš„æ¨¡å—æ¥ä½¿ç”¨è¿™äº› APIï¼Œä½†åŸºæœ¬æ€è·¯æ˜¯ç±»ä¼¼çš„ã€‚è¿™åªæ˜¯ä¸€ä¸ªå±•ç¤ºå¦‚ä½•ä½¿ç”¨<code>subtle.exportKey</code>çš„ç®€å•ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­è¿˜éœ€è¦å¤„ç†å„ç§ç»†èŠ‚ï¼Œæ¯”å¦‚é”™è¯¯å¤„ç†å’Œå®‰å…¨å­˜å‚¨/ä¼ è¾“å¯¼å‡ºçš„å¯†é’¥ã€‚</p><h3 id="subtle-generatekey-algorithm-extractable-keyusages" tabindex="-1"><a class="header-anchor" href="#subtle-generatekey-algorithm-extractable-keyusages"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtlegeneratekeyalgorithm-extractable-keyusages" target="_blank" rel="noopener noreferrer">subtle.generateKey(algorithm, extractable, keyUsages)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ <code>subtle.generateKey(algorithm, extractable, keyUsages)</code> è¿™ä¸ªåŠŸèƒ½ã€‚è¿™éƒ¨åˆ†å±äº Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ Node.js ä¸­ç”¨äºåŠ å¯†æ“ä½œçš„ä¸€ä¸ªæ¨¡å—ã€‚</p><p>é¦–å…ˆï¼Œäº†è§£å‡ ä¸ªå…³é”®è¯ï¼š</p><ol><li><strong>Web Crypto API</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª JavaScript APIï¼Œç”¨äºæ‰§è¡ŒåŸºæœ¬çš„åŠ å¯†æ“ä½œåœ¨ web åº”ç”¨ä¸­ï¼Œå¦‚æ•£åˆ—ã€ç­¾åã€åŠ å¯†å’Œè§£å¯†ç­‰ã€‚</li><li><strong>subtle</strong>ï¼šè¿™æ˜¯è°ƒç”¨ Web Crypto API ä¸­åŠ å¯†åŠŸèƒ½çš„æ¥å£å¯¹è±¡ã€‚å®ƒè¢«ç§°ä¸º &quot;subtle&quot; æ˜¯å› ä¸ºåŠ å¯†æ“ä½œé€šå¸¸å¾ˆå¾®å¦™ï¼ˆsensitiveï¼‰ï¼Œéœ€è¦è°¨æ…å¤„ç†ã€‚</li><li><strong>generateKey</strong>ï¼šé¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆå¯†é’¥çš„æ–¹æ³•ã€‚åœ¨åŠ å¯†ä¸­ï¼Œå¯†é’¥æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥å†³å®šåŠ å¯†çš„å¼ºåº¦ã€‚</li></ol><p>å‡½æ•°å‚æ•°è§£é‡Šï¼š</p><ul><li><strong>algorithm</strong>ï¼šæŒ‡å®šç”Ÿæˆå¯†é’¥æ—¶ä½¿ç”¨çš„ç®—æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ç®—æ³•åç§°åŠå…¶å¯èƒ½çš„ç›¸å…³é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦ç”Ÿæˆ RSA å¯†é’¥ï¼Œä½ éœ€è¦æŒ‡æ˜ç®—æ³•åç§°ï¼ˆå¦‚ RSA-PSS æˆ– RSA-OAEPï¼‰ä»¥åŠå¯†é’¥é•¿åº¦ã€å…¬å¼€æŒ‡æ•°ç­‰å‚æ•°ã€‚</li><li><strong>extractable</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡æ˜ç”Ÿæˆçš„å¯†é’¥æ˜¯å¦å¯ä»¥ä» CryptoKey å¯¹è±¡ä¸­æå–å‡ºæ¥ã€‚å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œå°±æ„å‘³ç€ä½ ä»¥åå¯ä»¥å°†å¯†é’¥å¯¼å‡ºåˆ°æŸç§æ ¼å¼ã€‚è¿™å¯¹äºéœ€è¦åœ¨ä¸åŒåœºæ™¯ä¸‹ä½¿ç”¨åŒä¸€å¯†é’¥çš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚</li><li><strong>keyUsages</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‡å®šäº†å¯†é’¥å¯ä»¥è¢«ç”¨äºå“ªäº›æ“ä½œã€‚é€‰é¡¹åŒ…æ‹¬ &quot;encrypt&quot;ã€&quot;decrypt&quot;ã€&quot;sign&quot;ã€&quot;verify&quot;ã€&quot;deriveKey&quot;ã€&quot;deriveBits&quot;ã€&quot;wrapKey&quot;ã€&quot;unwrapKey&quot; ç­‰ã€‚è¿™ç¡®ä¿äº†å¯†é’¥åªèƒ½ç”¨äºæŒ‡å®šçš„ç›®çš„ï¼Œå¢åŠ äº†å®‰å…¨æ€§ã€‚</li></ul><h3 id="å®è·µä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®è·µä¾‹å­"><span>å®è·µä¾‹å­ï¼š</span></a></h3><p>å‡è®¾æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨äºåŠ å¯†å’Œè§£å¯†çš„ AES-GCM å¯†é’¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span></span>
<span class="line"><span style="color:#88C0D0;">        name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„åŠ å¯†ç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">        length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥æ˜¯å¯æå–çš„</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>crypto</code> æ¨¡å—ï¼Œå¹¶ç‰¹åˆ«ä½¿ç”¨äº†å…¶ <code>webcrypto</code> å±æ€§æ¥è®¿é—® Web Crypto API åŠŸèƒ½ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>subtle.generateKey</code> æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ AES-GCM å¯†é’¥ï¼ŒæŒ‡å®šé•¿åº¦ä¸º 256 ä½ã€‚æˆ‘ä»¬è®¾ç½® <code>extractable</code> å‚æ•°ä¸º <code>true</code>ï¼Œè¿™è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥åç»­å°†è¿™ä¸ªå¯†é’¥å¯¼å‡ºä¸ºæŸç§æ ¼å¼ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ <code>keyUsages</code> å‚æ•°æŒ‡æ˜è¿™ä¸ªå¯†é’¥å°†è¢«ç”¨äºåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><p>é€šè¿‡è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª AES-GCM åŠ å¯†å¯†é’¥ï¼Œå¯ä»¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œç„¶åå†ç”¨ç›¸åŒçš„å¯†é’¥è§£å¯†ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨ä¼ è¾“æˆ–å­˜å‚¨ã€‚</p><h3 id="subtle-importkey-format-keydata-algorithm-extractable-keyusages" tabindex="-1"><a class="header-anchor" href="#subtle-importkey-format-keydata-algorithm-extractable-keyusages"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtleimportkeyformat-keydata-algorithm-extractable-keyusages" target="_blank" rel="noopener noreferrer">subtle.importKey(format, keyData, algorithm, extractable, keyUsages)</a></span></a></h3><p>Node.js çš„<code>subtle.importKey()</code>æ–¹æ³•æ˜¯ Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä½ å¯¼å…¥ä¸€ä¸ªå¯†é’¥åˆ°ä½ çš„åº”ç”¨ä¸­ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ&quot;å¯¼å…¥&quot;æ„å‘³ç€å°†ä¸€ä¸ªå­˜åœ¨äºåº”ç”¨å¤–éƒ¨çš„å¯†é’¥ä»¥æŸç§æ ¼å¼è½¬æ¢æˆ Web åŠ å¯† API å¯ä»¥æ“ä½œçš„å½¢å¼ã€‚ç†è§£è¿™ä¸ªæ¦‚å¿µå¯¹äºå¤„ç†åŠ å¯†æ“ä½œè‡³å…³é‡è¦ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è§£æè¿™ä¸ªå‡½æ•°åŠå…¶å‚æ•°ï¼Œå¹¶é€šè¿‡å®é™…ä¾‹å­åŠ æ·±ç†è§£ã€‚</p><h3 id="å‡½æ•°ç­¾å" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°ç­¾å"><span>å‡½æ•°ç­¾å</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">format</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> extractable</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyUsages</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>format</strong>: å¯¼å…¥å¯†é’¥çš„æ•°æ®æ ¼å¼ï¼Œå¦‚<code>&#39;raw&#39;</code>, <code>&#39;pkcs8&#39;</code>, <code>&#39;spki&#39;</code>, æˆ–è€… <code>&#39;jwk&#39;</code>ã€‚</li><li><strong>keyData</strong>: å¯¼å…¥å¯†é’¥çš„æ•°æ®ã€‚å…¶ç±»å‹å–å†³äº<code>format</code>ã€‚</li><li><strong>algorithm</strong>: ä½¿ç”¨è¯¥å¯†é’¥çš„ç®—æ³•ä¿¡æ¯ã€‚è¿™å‘Šè¯‰ Web åŠ å¯† API å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå¯†é’¥ã€‚</li><li><strong>extractable</strong>: ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å¯ä»¥ä» CryptoKey å¯¹è±¡ä¸­æå–å¯†é’¥ææ–™ã€‚</li><li><strong>keyUsages</strong>: ä¸€ä¸ªæ•°ç»„ï¼Œåˆ—å‡ºäº†å¯†é’¥å¯ä»¥è¢«ç”¨äºå“ªäº›æ“ä½œï¼Œå¦‚<code>[&#39;encrypt&#39;, &#39;decrypt&#39;, &#39;sign&#39;, &#39;verify&#39;]</code>ç­‰ã€‚</li></ul><h3 id="å®è·µä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®è·µä¾‹å­-1"><span>å®è·µä¾‹å­</span></a></h3><h4 id="_1-å¯¼å…¥ä¸€ä¸ªç®€å•çš„-raw-æ ¼å¼å¯†é’¥ç”¨äº-aes-gcm-åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#_1-å¯¼å…¥ä¸€ä¸ªç®€å•çš„-raw-æ ¼å¼å¯†é’¥ç”¨äº-aes-gcm-åŠ å¯†"><span>1. å¯¼å…¥ä¸€ä¸ªç®€å•çš„ RAW æ ¼å¼å¯†é’¥ç”¨äº AES-GCM åŠ å¯†</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸²äºŒè¿›åˆ¶æ•°æ®ï¼ˆé€šå¸¸é€šè¿‡ TypedArrayï¼Œä¾‹å¦‚ Uint8Arrayï¼‰ä½œä¸ºåŸå§‹å¯†é’¥ææ–™ï¼Œä½ æƒ³ä½¿ç”¨ AES-GCM ç®—æ³•è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> rawKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span></span>
<span class="line"><span style="color:#616E88;">  /* ä½ çš„å¯†é’¥æ•°æ®ï¼Œæ¯”å¦‚ */</span><span style="color:#B48EAD;"> 21</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 31</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 41</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 51</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 61</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 71</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 81</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 91</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 101</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 111</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 121</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 131</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#B48EAD;">  141</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 151</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 161</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 171</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> importedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯¼å…¥å¯†é’¥çš„æ ¼å¼</span></span>
<span class="line"><span style="color:#D8DEE9;">    rawKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#616E88;">      // ç®—æ³•çš„ç›¸å…³ä¿¡æ¯</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯ä»CryptoKeyå¯¼å‡ºå¯†é’¥ææ–™</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">importedKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œä½ å¯ä»¥ä½¿ç”¨importedKeyè¿›è¡ŒåŠ å¯†æˆ–è§£å¯†æ“ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-å¯¼å…¥-jwk-æ ¼å¼çš„-rsa-å…¬é’¥" tabindex="-1"><a class="header-anchor" href="#_2-å¯¼å…¥-jwk-æ ¼å¼çš„-rsa-å…¬é’¥"><span>2. å¯¼å…¥ JWK æ ¼å¼çš„ RSA å…¬é’¥</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªä»¥ JWKï¼ˆJSON Web Keyï¼‰æ ¼å¼å­˜åœ¨çš„ RSA å…¬é’¥ï¼Œä½ æƒ³ä½¿ç”¨å®ƒæ¥éªŒè¯ç­¾åã€‚</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">kty</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">e</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AQAB</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0vx7algoewlgjwrtyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnm1234567890qwertyuiopasdfghjklzxcvbnmrtyuiopasdfghjklzxcvbnm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">alg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RS256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">ext</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸‹æ˜¯å¦‚ä½•å¯¼å…¥è¿™ä¸ª JWK æ ¼å¼çš„å¯†é’¥å¹¶å‡†å¤‡ä½¿ç”¨å®ƒæ¥éªŒè¯ç­¾åçš„ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> jwkPublicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  kty</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  e</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AQAB</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  n</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0vx7algoewlgjwrtyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnm1234567890qwertyuiopasdfghjklzxcvbnmrtyuiopasdfghjklzxcvbnm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  alg</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RS256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  ext</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> importedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯¼å…¥å¯†é’¥çš„æ ¼å¼</span></span>
<span class="line"><span style="color:#D8DEE9;">    jwkPublicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#616E88;">      // ç®—æ³•çš„ç›¸å…³ä¿¡æ¯</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSASSA-PKCS1-v1_5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯ä»CryptoKeyå¯¼å‡ºå¯†é’¥ææ–™</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">importedKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™é‡Œä½ å¯ä»¥ä½¿ç”¨importedKeyè¿›è¡Œç­¾åéªŒè¯æ“ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>subtle.importKey()</code>å‡½æ•°æ˜¯å¦‚ä½•ä½¿å¾—å°†å„ç§æ ¼å¼çš„å¯†é’¥ææ–™å¯¼å…¥åˆ°ä½ çš„ Web åº”ç”¨ä¸­å˜å¾—å¯èƒ½ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨è¿™äº›å¯†é’¥æ‰§è¡ŒåŠ å¯†ã€è§£å¯†ã€ç­¾åæˆ–æ ¡éªŒç­‰æ“ä½œã€‚</p><h3 id="subtle-sign-algorithm-key-data" tabindex="-1"><a class="header-anchor" href="#subtle-sign-algorithm-key-data"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtlesignalgorithm-key-data" target="_blank" rel="noopener noreferrer">subtle.sign(algorithm, key, data)</a></span></a></h3><p>Node.js ä¸­çš„<code>subtle.sign(algorithm, key, data)</code>æ˜¯ Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ª API æä¾›äº†ä¸€ä¸ªç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®çš„æ¥å£ã€‚ç®€å•æ¥è¯´ï¼Œ<code>subtle.sign()</code>æ–¹æ³•å…è®¸ä½ ä½¿ç”¨æŒ‡å®šçš„ç®—æ³•å’Œå¯†é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åã€‚åœ¨å®‰å…¨é€šä¿¡å’Œæ•°æ®éªŒè¯ä¸­ï¼Œç­¾åéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥éªŒè¯ä¿¡æ¯çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</p><h3 id="å‚æ•°è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-1"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><strong>algorithm</strong>: è¿™æ˜¯ä¸€ä¸ªæ ‡è¯†åŠ å¯†ç®—æ³•çš„å¯¹è±¡æˆ–å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼ŒRSAã€ECDSA ç­‰ã€‚</li><li><strong>key</strong>: åŠ å¯†æ“ä½œæ‰€ä½¿ç”¨çš„å¯†é’¥ã€‚è¿™ä¸ªå¯†é’¥åº”è¯¥æ˜¯ä¸€ä¸ªå…ˆå‰ç”Ÿæˆæˆ–å¯¼å…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„åŠ å¯†å¯†é’¥ã€‚</li><li><strong>data</strong>: éœ€è¦ç­¾åçš„æ•°æ®ï¼Œé€šå¸¸ä»¥ ArrayBuffer æˆ–è€…æ˜¯èƒ½è½¬æ¢ä¸ºæ­¤æ ¼å¼çš„ç±»å‹æä¾›ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-7"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ç”¨æˆ·ç™»å½•çš„ç½‘ç«™ï¼Œå¹¶å¸Œæœ›ç¡®ä¿ç”¨æˆ·æ•°æ®çš„å®‰å…¨ä¼ è¾“ã€‚ä½ å†³å®šä½¿ç”¨ JWTï¼ˆJson Web Tokenï¼‰ä½œä¸ºè®¤è¯æ–¹å¼ã€‚JWT é€šå¸¸åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šå¤´éƒ¨ï¼ˆHeaderï¼‰ã€è½½è·ï¼ˆPayloadï¼‰ä»¥åŠç­¾åï¼ˆSignatureï¼‰ã€‚å…¶ä¸­ï¼Œç­¾åæ˜¯ç”¨æ¥éªŒè¯æ¶ˆæ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå®ƒæ˜¯é€šè¿‡å°†å¤´éƒ¨å’Œè½½è·ç»è¿‡ç‰¹å®šç®—æ³•å¤„ç†ï¼Œç„¶åç”¨å¯†é’¥ç­¾åå¾—åˆ°çš„ã€‚</p><p>å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªç”¨äºç­¾åçš„å¯†é’¥ï¼ˆkeyï¼‰å’Œä½ æƒ³ä½¿ç”¨çš„ç®—æ³•åç§°ï¼ˆæ¯”å¦‚ HS256ï¼‰ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ä½¿ç”¨<code>subtle.sign</code>æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªç­¾åã€‚è¿™é‡Œæ˜¯å¦‚ä½•å®ç°å®ƒçš„ä¼ªä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> createSignature</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">payload</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾ä½ çš„å¯†é’¥å’Œç®—æ³•ä¿¡æ¯éƒ½å·²å‡†å¤‡å¥½</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-secret-key</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¯¹æ•°æ®è¿›è¡Œç­¾å</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">payload</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ä½ éœ€è¦ç­¾åçš„payload</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> payload</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> userId</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 12345</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> username</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">john_doe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">createSignature</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">payload</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™æ˜¯ç”Ÿæˆçš„ç­¾å</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œä¸ºäº†ç®€åŒ–ç¤ºä¾‹ï¼Œä¸Šé¢çš„ä»£ç çœç•¥äº†é”™è¯¯å¤„ç†å’Œå¯†é’¥ç®¡ç†çš„ç»†èŠ‚ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä½ åº”è¯¥æ›´åŠ ç»†å¿ƒåœ°å¤„ç†è¿™äº›ç¯èŠ‚ã€‚</p><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>subtle.sign</code>å¦‚ä½•åœ¨å®è·µä¸­ç”¨äºç”Ÿæˆæ•°æ®çš„ç­¾åï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚åœ¨ç°å®ä¸–ç•Œçš„åº”ç”¨ä¸­ï¼Œç­¾åæœºåˆ¶å¹¿æ³›åº”ç”¨äº API è°ƒç”¨çš„å®‰å…¨éªŒè¯ã€æ–‡æ¡£éªŒè¯ã€è½¯ä»¶è®¸å¯è¯æ¿€æ´»ç­‰å¤šç§åœºæ™¯ã€‚</p><h3 id="subtle-unwrapkey-format-wrappedkey-unwrappingkey-unwrapalgo-unwrappedkeyalgo-extractable-keyusages" tabindex="-1"><a class="header-anchor" href="#subtle-unwrapkey-format-wrappedkey-unwrappingkey-unwrapalgo-unwrappedkeyalgo-extractable-keyusages"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtleunwrapkeyformat-wrappedkey-unwrappingkey-unwrapalgo-unwrappedkeyalgo-extractable-keyusages" target="_blank" rel="noopener noreferrer">subtle.unwrapKey(format, wrappedKey, unwrappingKey, unwrapAlgo, unwrappedKeyAlgo, extractable, keyUsages)</a></span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°ç†è§£è¿™ä¸ª<code>subtle.unwrapKey</code>å‡½æ•°æ˜¯åšä»€ä¹ˆçš„ï¼Œåœ¨ Node.js ä¸­ç‰¹åˆ«æ˜¯åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­å¦‚ä½•ä½¿ç”¨å®ƒï¼Œä»¥åŠå®ƒåœ¨å®é™…åº”ç”¨ä¸­å¯ä»¥æ€æ ·å¸®åŠ©æˆ‘ä»¬ã€‚</p><p><code>subtle.unwrapKey</code>å‡½æ•°å±äº Web Crypto APIï¼ˆç½‘ç»œåŠ å¯† APIï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ºäº†å®‰å…¨å¤„ç†å’Œå­˜å‚¨åŠ å¯†å¯†é’¥è€Œè®¾è®¡çš„æ ‡å‡†åŒ– APIã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†ä¸€ä¸ªä¹‹å‰ç”¨å¦ä¸€ä¸ªå¯†é’¥åŠ å¯†è¿‡çš„å¯†é’¥è§£å¯†å›åŸæ¥çš„å½¢æ€æˆ–æ ¼å¼ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½å¬èµ·æ¥å¯èƒ½æœ‰äº›å¤æ‚ï¼Œä½†å®ƒåœ¨å®‰å…¨æ€§è¦æ±‚é«˜çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚åœ¨éœ€è¦å®‰å…¨ä¼ è¾“å¯†é’¥çš„æ—¶å€™ã€‚ç°åœ¨ï¼Œæˆ‘ä¼šé€šè¿‡å‡ ä¸ªæ­¥éª¤å’Œä¾‹å­æ¥è¯¦ç»†è§£é‡Šæ¯ä¸ªå‚æ•°å’Œå®ƒçš„åº”ç”¨ï¼š</p><h3 id="å‚æ•°è§£æ" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£æ"><span>å‚æ•°è§£æ</span></a></h3><ul><li><p><strong>format</strong>ï¼šè¿™æ˜¯æŒ‡å®šè¾“å‡ºå¯†é’¥çš„æ ¼å¼ï¼Œé€šå¸¸æ˜¯<code>&#39;raw&#39;</code>ã€<code>&#39;pkcs8&#39;</code>ã€<code>&#39;spki&#39;</code>æˆ–<code>&#39;jwk&#39;</code>ä¸­çš„ä¸€ä¸ªã€‚è¿™äº›æ ¼å¼åˆ†åˆ«å¯¹åº”ä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œå¯†é’¥ç±»å‹ã€‚</p></li><li><p><strong>wrappedKey</strong>ï¼šè¿™æ˜¯è¢«åŠ å¯†è¿‡çš„å¯†é’¥ï¼Œå³ä½ æƒ³è¦è§£å¯†çš„é‚£ä¸ªå¯†é’¥ã€‚å®ƒé€šå¸¸æ˜¯ä¸€ä¸ª<code>ArrayBuffer</code>æˆ–è€…<code>TypedArray</code>ç­‰å¯ä»¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„æ ¼å¼ã€‚</p></li><li><p><strong>unwrappingKey</strong>ï¼šè¿™æ˜¯ç”¨äºè§£å¯†<code>wrappedKey</code>çš„å¯†é’¥ã€‚æ¢å¥è¯è¯´ï¼Œ<code>wrappedKey</code>æ˜¯ç”¨è¿™ä¸ªå¯†é’¥åŠ å¯†çš„ï¼Œç°åœ¨æˆ‘ä»¬ç”¨å®ƒæ¥è§£å¯†ã€‚</p></li><li><p><strong>unwrapAlgo</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å®šäº†ç”¨äºè§£å¯†<code>wrappedKey</code>çš„ç®—æ³•å’Œç›¸å…³å‚æ•°ã€‚</p></li><li><p><strong>unwrappedKeyAlgo</strong>ï¼šè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€æ—¦<code>wrappedKey</code>è¢«è§£å¯†ï¼Œå¦‚ä½•å¤„ç†å’Œä½¿ç”¨è¿™ä¸ªè§£å¯†åçš„å¯†é’¥ï¼ŒåŒ…æ‹¬å“ªç§ç®—æ³•å’Œå‚æ•°ã€‚</p></li><li><p><strong>extractable</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå†³å®šè§£å¯†åçš„å¯†é’¥æ˜¯å¦å¯ä»¥è¢«å¯¼å‡ºåˆ°åº”ç”¨ç¨‹åºä¹‹å¤–ã€‚</p></li><li><p><strong>keyUsages</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‡å®šäº†è§£å¯†åçš„å¯†é’¥å¯ä»¥è¢«ç”¨äºå“ªäº›æ“ä½œï¼Œæ¯”å¦‚<code>[&#39;encrypt&#39;, &#39;decrypt&#39;]</code>ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ åœ¨ä¸€ä¸ªéœ€è¦é«˜å®‰å…¨æ€§çš„åº”ç”¨ç¨‹åºä¸­å·¥ä½œï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿é“¶è¡Œç³»ç»Ÿã€‚ä½ éœ€è¦å°†ä¸€äº›æ•æ„Ÿä¿¡æ¯çš„å¯†é’¥ä»æœåŠ¡å™¨å®‰å…¨åœ°ä¼ è¾“åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚ç”±äºç›´æ¥ä¼ è¾“åŸå§‹å¯†é’¥é£é™©å¾ˆå¤§ï¼Œä½ å¯ä»¥å…ˆç”¨æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªç§å¯†(unwrappingKey)æ¥åŠ å¯†è¯¥å¯†é’¥(wrappedKey)ï¼Œç„¶åå®‰å…¨åœ°å°†å®ƒä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚åˆ°äº†å®¢æˆ·ç«¯åï¼Œä½ å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç§å¯†(unwrappingKey)æ¥è§£å¯†è¿™ä¸ªå¯†é’¥ï¼Œç„¶åç”¨è§£å¯†åçš„å¯†é’¥æ¥åŠ è§£å¯†æ•æ„Ÿä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// åœ¨Node.jsç¯å¢ƒä¸­ä½¿ç”¨subtle.unwrapKeyçš„æ¨¡æ‹Ÿä»£ç ç‰‡æ®µï¼š</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> unwrapKeyExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾ unwrappingKey æ˜¯é€šè¿‡æŸç§æ–¹å¼è·å¾—çš„</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> unwrappingKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#616E88;">    /* format */</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    /* keyData */</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // è¿™é‡Œæ˜¯JWKæ ¼å¼çš„å¯†é’¥æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#616E88;">    /* algorithm */</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#616E88;">    /* extractable */</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    /* keyUsages */</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">unwrapKey</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // wrappedKey æ˜¯ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„åŠ å¯†è¿‡çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> wrappedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#81A1C1;">...</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿™é‡Œæ˜¯åŠ å¯†å¯†é’¥çš„å­—èŠ‚æ•°ç»„</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ unwrapKey æ¥è§£å¯† wrappedKey</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> unwrappedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unwrapKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#616E88;">    /* format */</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    /* wrappedKey */</span><span style="color:#D8DEE9;"> wrappedKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    /* unwrappingKey */</span><span style="color:#D8DEE9;"> unwrappingKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    /* unwrapAlgo */</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#616E88;">    /* unwrappedKeyAlgo */</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#616E88;">    /* extractable */</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    /* keyUsages */</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç°åœ¨ unwrappedKey æ˜¯è§£å¯†åçš„å¯†é’¥ï¼Œå¯ä»¥ç”¨äºåŠ è§£å¯†æ“ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">unwrapKeyExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>unwrapKey</code>è¢«ç”¨æ¥è§£å¯†ä¸€ä¸ªå…ˆå‰è¢«<code>unwrappingKey</code>åŠ å¯†çš„å¯†é’¥(<code>wrappedKey</code>)ã€‚è¿™åœ¨éœ€è¦å®‰å…¨ä¼ é€’å¯†é’¥çš„åœºåˆéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å®‰å…¨ä¼ è¾“æˆ–åœ¨ä¸åŒçš„æœåŠ¡é—´å…±äº«å¯†é’¥æ—¶ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè¯¦ç»†è§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£<code>subtle.unwrapKey</code>çš„ä½œç”¨å’Œå¦‚ä½•åœ¨å®é™…ä¸­ä½¿ç”¨å®ƒï¼</p><h3 id="subtle-verify-algorithm-key-signature-data" tabindex="-1"><a class="header-anchor" href="#subtle-verify-algorithm-key-signature-data"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtleverifyalgorithm-key-signature-data" target="_blank" rel="noopener noreferrer">subtle.verify(algorithm, key, signature, data)</a></span></a></h3><p>Node.js ä¸­çš„<code>subtle.verify(algorithm, key, signature, data)</code>æ–¹æ³•æ˜¯ä¸€ä¸ªéƒ¨åˆ† Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºéªŒè¯æ•°å­—ç­¾åçš„æœ‰æ•ˆæ€§ã€‚è¿™ä¸ª API å†…ç½®äºç°ä»£çš„ç½‘ç»œå¹³å°ï¼Œå¹¶ä¸”åœ¨ Node.js ç¯å¢ƒä¸‹ä¹Ÿå¯ç”¨ã€‚å®ƒå…è®¸ä½ ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ï¼Œä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºçš„å¯é æ€§ã€‚</p><h3 id="å…³é”®æœ¯è¯­ç†è§£" tabindex="-1"><a class="header-anchor" href="#å…³é”®æœ¯è¯­ç†è§£"><span>å…³é”®æœ¯è¯­ç†è§£</span></a></h3><ul><li><strong>ç®—æ³•ï¼ˆAlgorithmï¼‰</strong>: è¿™æ˜¯æŒ‡å®šä½¿ç”¨å“ªç§åŠ å¯†æŠ€æœ¯å¯¹æ•°æ®è¿›è¡Œç­¾åå’ŒéªŒè¯çš„å‚æ•°ã€‚å¸¸è§çš„ç®—æ³•åŒ…æ‹¬ RSAã€ECDSA ç­‰ã€‚</li><li><strong>å¯†é’¥ï¼ˆKeyï¼‰</strong>: è¿™æ˜¯æ‰§è¡ŒåŠ å¯†æˆ–è§£å¯†æ“ä½œæ‰€éœ€çš„å¯†é’¥ã€‚åœ¨éªŒè¯ç­¾åçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œé€šå¸¸ä½¿ç”¨å…¬é’¥æ¥éªŒè¯ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚</li><li><strong>ç­¾åï¼ˆSignatureï¼‰</strong>: ç­¾åæ˜¯åŸå§‹æ•°æ®é€šè¿‡ç§é’¥åŠ å¯†åç”Ÿæˆçš„ä¸€æ®µå”¯ä¸€çš„å­—ç¬¦ä¸²ã€‚å®ƒç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</li><li><strong>æ•°æ®ï¼ˆDataï¼‰</strong>: åŸå§‹çš„ã€éœ€è¦éªŒè¯çš„æ•°æ®ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-3" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-3"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥æ›´æ·±å…¥åœ°ç†è§£å…¶åº”ç”¨ï¼š</p><p>å‡è®¾ Alice æƒ³è¦å‘é€ä¸€æ¡é‡è¦çš„æ¶ˆæ¯ç»™ Bobï¼Œè€Œè¿™æ¡æ¶ˆæ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢« Eve æˆªè·å’Œç¯¡æ”¹ã€‚ä¸ºäº†ç¡®ä¿æ¶ˆæ¯çš„å®‰å…¨ï¼ŒAlice å¯ä»¥å¯¹æ¶ˆæ¯è¿›è¡Œæ•°å­—ç­¾åã€‚</p><ol><li><p><strong>åˆ›å»ºç­¾å</strong>:<br> Alice ä½¿ç”¨å¥¹çš„ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚è¿™æ„å‘³ç€å¥¹ç”¨ä¸€ä¸ªç‰¹å®šçš„ç®—æ³•å¤„ç†æ¶ˆæ¯å’Œå¥¹çš„ç§é’¥æ¥ç”Ÿæˆç­¾åã€‚</p></li><li><p><strong>å‘é€æ¶ˆæ¯å’Œç­¾å</strong>:<br> Alice å°†åŸå§‹æ¶ˆæ¯å’Œç”Ÿæˆçš„ç­¾åä¸€èµ·å‘é€ç»™ Bobã€‚</p></li><li><p><strong>éªŒè¯ç­¾å</strong>:<br> å½“ Bob æ”¶åˆ°æ¶ˆæ¯å’Œç­¾åæ—¶ï¼Œä»–å¯ä»¥ä½¿ç”¨ Alice çš„å…¬é’¥ï¼ˆè¿™æ˜¯å…¬å¼€çŸ¥é“çš„ï¼‰æ¥éªŒè¯ç­¾åã€‚è¿™é‡Œå°±æ˜¯<code>subtle.verify()</code>æ–¹æ³•å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚Bob æä¾›ç®—æ³•åç§°ã€Alice çš„å…¬é’¥ã€æ¥æ”¶åˆ°çš„ç­¾åï¼Œä»¥åŠåŸå§‹æ¶ˆæ¯ä½œä¸ºå‚æ•°ç»™è¿™ä¸ªæ–¹æ³•ã€‚</p></li></ol><h3 id="ç¤ºä¾‹ä»£ç -6" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -6"><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>è™½ç„¶<code>subtle.verify</code>çš„å…·ä½“è°ƒç”¨ç»†èŠ‚å¯èƒ½å› å…·ä½“ç®—æ³•å’Œå¯†é’¥ç±»å‹è€Œå¼‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ¦‚å¿µä¸Šä½¿ç”¨å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä¼ªä»£ç ï¼Œå‡è®¾å·²æœ‰algorithm, publicKey, signature, originalMessageç­‰å˜é‡å®šä¹‰</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifySignature</span><span style="color:#ECEFF4;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">  algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  signature</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  originalMessage</span></span>
<span class="line"><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">originalMessage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isValid</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç­¾åéªŒè¯æˆåŠŸï¼Œæ•°æ®å®Œæ•´ä¸”æ¥æºå¯ä¿¡ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç­¾åéªŒè¯å¤±è´¥ï¼Œæ•°æ®å¯èƒ½å·²è¢«ç¯¡æ”¹ã€‚</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">éªŒè¯è¿‡ç¨‹ä¸­å‡ºé”™ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é‡è¦æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#é‡è¦æ³¨æ„äº‹é¡¹"><span>é‡è¦æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>ä½¿ç”¨æ•°å­—ç­¾åå’ŒéªŒè¯ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºçš„å¯é æ€§ã€‚</li><li>åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œç­¾åéªŒè¯æ—¶ï¼Œå¿…é¡»ç¡®ä¿æ­£ç¡®é€‰æ‹©ç®—æ³•å¹¶åŒ¹é…ç›¸åº”çš„å¯†é’¥ç±»å‹ã€‚</li><li>å®‰å…¨åœ°ç®¡ç†å¯†é’¥è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯ç§é’¥ä¸åº”æ³„éœ²ç»™æœªç»æˆæƒçš„äººå‘˜ã€‚</li></ul><p>é€šè¿‡ä»¥ä¸Šè§£é‡Šå’Œç¤ºä¾‹ï¼Œå¸Œæœ›ä½ å¯¹<code>subtle.verify</code>æ–¹æ³•ä»¥åŠå®ƒåœ¨æ•°æ®ä¼ è¾“å®‰å…¨ä¸­çš„é‡è¦æ€§æœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ã€‚</p><h3 id="subtle-wrapkey-format-key-wrappingkey-wrapalgo" tabindex="-1"><a class="header-anchor" href="#subtle-wrapkey-format-key-wrappingkey-wrapalgo"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#subtlewrapkeyformat-key-wrappingkey-wrapalgo" target="_blank" rel="noopener noreferrer">subtle.wrapKey(format, key, wrappingKey, wrapAlgo)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥ç†è§£ <code>subtle.wrapKey</code> æ–¹æ³•åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­çš„ç”¨æ³•å’Œåº”ç”¨åœºæ™¯ã€‚</p><p>é¦–å…ˆï¼Œ<code>subtle.wrapKey</code> æ˜¯ Node.js Web åŠ å¯† APIï¼ˆApplication Programming Interfaceï¼‰çš„ä¸€éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å…è®¸ä½ å°†ä¸€ä¸ªåŠ å¯†å¯†é’¥ &quot;åŒ…è£…&quot; èµ·æ¥ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå¯†é’¥ï¼ˆç§°ä¸ºåŒ…è£…å¯†é’¥ï¼‰å®‰å…¨åœ°åŠ å¯†æŸä¸ªå¯†é’¥ã€‚è¿™åœ¨éœ€è¦å®‰å…¨ä¼ è¾“æˆ–å­˜å‚¨å¯†é’¥çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="å‚æ•°è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-2"><span>å‚æ•°è§£é‡Šï¼š</span></a></h3><ul><li><strong>format</strong>: å®ƒæŒ‡å®šäº†è¢«åŒ…è£…å¯†é’¥çš„æ ¼å¼ã€‚å¸¸è§çš„æ ¼å¼æœ‰ <code>&quot;raw&quot;</code>ã€<code>&quot;pkcs8&quot;</code>ã€<code>&quot;spki&quot;</code> æˆ– <code>&quot;jwk&quot;</code>ã€‚æ¯ç§æ ¼å¼å¯¹åº”ä¸åŒçš„å¯†é’¥ç±»å‹å’Œä½¿ç”¨åœºæ™¯ã€‚</li><li><strong>key</strong>: è¿™æ˜¯è¦è¢«åŒ…è£…çš„å¯†é’¥å¯¹è±¡ã€‚</li><li><strong>wrappingKey</strong>: ç”¨äºåŠ å¯† <code>key</code> çš„å¯†é’¥å¯¹è±¡ã€‚</li><li><strong>wrapAlgo</strong>: æŒ‡å®šåŠ å¯†ç®—æ³•çš„å¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•ä½¿ç”¨ <code>wrappingKey</code> æ¥åŠ å¯† <code>key</code>ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-8"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“ç”¨æˆ·ç§é’¥çš„åº”ç”¨ç¨‹åºã€‚ç”¨æˆ·çš„ç§é’¥ä¸èƒ½ä»¥æ˜æ–‡å½¢å¼ä¼ è¾“æˆ–å­˜å‚¨ï¼Œä¸ºäº†ä¿è¯å®‰å…¨ï¼Œä½ å†³å®šä½¿ç”¨ <code>subtle.wrapKey</code> æ–¹æ³•ã€‚</p><h4 id="æ­¥éª¤-1-å‡†å¤‡å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-å‡†å¤‡å¯†é’¥"><span>æ­¥éª¤ 1: å‡†å¤‡å¯†é’¥</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼šä¸€ä¸ªæ˜¯ç”¨æˆ·çš„ç§é’¥ï¼ˆ<code>userPrivateKey</code>ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨äºåŠ å¯†è¯¥ç§é’¥çš„å…¬é’¥ï¼ˆ<code>publicKey</code>ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ä¼ªä»£ç ç¤ºä¾‹ - å‡è®¾è¿™äº›å¯†é’¥å·²ç»ä»¥æ­£ç¡®çš„æ–¹å¼ç”Ÿæˆå¹¶å¯ç”¨</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> userPrivateKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span><span style="color:#616E88;"> // ç”¨æˆ·ç§é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span><span style="color:#616E88;"> // ç”¨äºåŠ å¯†ç”¨æˆ·ç§é’¥çš„å…¬é’¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-ä½¿ç”¨-subtle-wrapkey-åŠ å¯†ç§é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-ä½¿ç”¨-subtle-wrapkey-åŠ å¯†ç§é’¥"><span>æ­¥éª¤ 2: ä½¿ç”¨ <code>subtle.wrapKey</code> åŠ å¯†ç§é’¥</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> wrapUserKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> wrappedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">wrapKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // format: å› ä¸ºæˆ‘ä»¬æ‰“ç®—ä»¥ JSON Web Key (JWK) æ ¼å¼åŒ…è£…å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    userPrivateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // key: è¢«åŒ…è£…çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // wrappingKey: ç”¨äºåŠ å¯†çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#616E88;">      // wrapAlgo: åŒ…è£…ç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> wrappedKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>userPrivateKey</code> æ˜¯ä»¥ <code>&quot;jwk&quot;</code> æ ¼å¼è¢«åŒ…è£…çš„ï¼Œä½¿ç”¨ <code>publicKey</code> é€šè¿‡ <code>&quot;RSA-OAEP&quot;</code> ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚æœ€ç»ˆä½ å¾—åˆ°çš„ <code>wrappedKey</code> æ˜¯ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®ï¼Œå¯ä»¥å®‰å…¨åœ°ä¼ è¾“æˆ–è€…å­˜å‚¨ï¼Œè€Œæ— éœ€æ‹…å¿ƒå¯†é’¥æœ¬èº«è¢«æ³„éœ²ã€‚</p><h4 id="æ­¥éª¤-3-è§£åŒ…-è§£å¯†å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-è§£åŒ…-è§£å¯†å¯†é’¥"><span>æ­¥éª¤ 3: è§£åŒ…/è§£å¯†å¯†é’¥</span></a></h4><p>å½“æ¥æ”¶æ–¹è·å–åˆ°è¿™ä¸ªè¢«åŒ…è£…çš„å¯†é’¥åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ç›¸å¯¹åº”çš„ç§é’¥æ¥è§£åŒ…ï¼ˆå³è§£å¯†ï¼‰ã€‚å‡è®¾æ¥æ”¶æ–¹æœ‰æ­£ç¡®çš„ç§é’¥ï¼Œä»–ä»¬å°±èƒ½ä½¿ç”¨ç±»ä¼¼ <code>subtle.unwrapKey</code> æ–¹æ³•æ¥æ¢å¤åŸå§‹çš„ç§é’¥ã€‚</p><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œä½ å°±èƒ½å®‰å…¨åœ°å¤„ç†æ•æ„Ÿçš„å¯†é’¥ä¿¡æ¯ï¼Œæ— è®ºæ˜¯åœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯ã€‚è¿™ç§æœºåˆ¶åœ¨éœ€è¦é«˜åº¦å®‰å…¨æ€§çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚åœ¨çº¿æ”¯ä»˜ç³»ç»Ÿã€åŠ å¯†é€šè®¯å¹³å°ç­‰åœºæ™¯ä¸­éå¸¸é‡è¦ã€‚</p><h2 id="algorithm-parameters" tabindex="-1"><a class="header-anchor" href="#algorithm-parameters"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#algorithm-parameters" target="_blank" rel="noopener noreferrer">Algorithm parameters</a></span></a></h2><p>äº†è§£ Node.js ä¸­çš„ Web Crypto APIï¼Œç‰¹åˆ«æ˜¯ç®—æ³•å‚æ•°éƒ¨åˆ†ï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´å¯èƒ½ä¼šæœ‰äº›å¤æ‚ï¼Œä½†æˆ‘ä¼šå°½é‡ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼æ¥è§£é‡Šã€‚</p><p>é¦–å…ˆï¼ŒNode.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Web Crypto API æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ JavaScript APIï¼Œç”¨äºæ‰§è¡ŒåŠ å¯†æ“ä½œï¼Œå¦‚å“ˆå¸Œã€ç­¾åã€åŠ å¯†ç­‰ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ã€‚åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­æåˆ°çš„â€œç®—æ³•å‚æ•°â€å°±æ˜¯è¿™ä¸ª API çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ç®—æ³•å‚æ•°ï¼ˆAlgorithm Parametersï¼‰æ˜¯æŒ‡åœ¨æ‰§è¡ŒåŠ å¯†æ“ä½œæ—¶å¿…é¡»æŒ‡å®šçš„ä¸€äº›è®¾ç½®é¡¹ã€‚æ¯ç§æ“ä½œï¼ˆå¦‚å“ˆå¸Œç”Ÿæˆã€æ•°æ®åŠ å¯†ã€ç­¾åéªŒè¯ç­‰ï¼‰éƒ½æœ‰å…¶ç‰¹å®šçš„ç®—æ³•ï¼Œè€Œæ¯ç§ç®—æ³•åˆéœ€è¦ç‰¹å®šçš„å‚æ•°æ¥æ‰§è¡Œã€‚è¿™äº›å‚æ•°å¯ä»¥åŒ…æ‹¬å¯†é’¥é•¿åº¦ã€æ•£åˆ—å‡½æ•°ç±»å‹ã€åˆå§‹åŒ–å‘é‡ç­‰ã€‚</p><h3 id="å¸¸è§çš„ç®—æ³•åŠå…¶å‚æ•°ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å¸¸è§çš„ç®—æ³•åŠå…¶å‚æ•°ä¸¾ä¾‹"><span>å¸¸è§çš„ç®—æ³•åŠå…¶å‚æ•°ä¸¾ä¾‹</span></a></h3><ol><li><p><strong>å“ˆå¸Œç”Ÿæˆï¼ˆDigestï¼‰</strong>:</p><ul><li><strong>åº”ç”¨åœºæ™¯</strong>: éªŒè¯æ–‡ä»¶æˆ–æ•°æ®çš„å®Œæ•´æ€§ï¼Œå¯†ç å­˜å‚¨ã€‚</li><li><strong>ç®—æ³•åç§°</strong>: <code>SHA-256</code></li><li><strong>å‚æ•°ç¤ºä¾‹</strong>: åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‚æ•°ä¸»è¦æ˜¯ç®—æ³•çš„åç§°ï¼Œå¦‚ <code>{ name: &#39;SHA-256&#39; }</code>ã€‚</li></ul></li><li><p><strong>æ•°æ®åŠ å¯†ï¼ˆEncryptï¼‰</strong>:</p><ul><li><strong>åº”ç”¨åœºæ™¯</strong>: å®‰å…¨åœ°ä¼ è¾“æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ä¿¡ç”¨å¡ä¿¡æ¯ã€å¯†ç ç­‰ã€‚</li><li><strong>ç®—æ³•åç§°</strong>: <code>AES-CBC</code></li><li><strong>å‚æ•°ç¤ºä¾‹</strong>: åŠ å¯†æ—¶å¯èƒ½éœ€è¦å¯†é’¥å’Œåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ã€‚å‚æ•°ç¤ºä¾‹ä¸º <code>{ name: &#39;AES-CBC&#39;, iv: someInitializationVector }</code>ï¼Œå…¶ä¸­ <code>someInitializationVector</code> æ˜¯åŠ å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åˆå§‹åŒ–å‘é‡ã€‚</li></ul></li><li><p><strong>ç­¾åç”Ÿæˆä¸éªŒè¯ï¼ˆSign &amp; Verifyï¼‰</strong>:</p><ul><li><strong>åº”ç”¨åœºæ™¯</strong>: ç¡®è®¤æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ï¼Œç¡®è®¤å‘é€è€…èº«ä»½ã€‚</li><li><strong>ç®—æ³•åç§°</strong>: <code>RSASSA-PKCS1-v1_5</code></li><li><strong>å‚æ•°ç¤ºä¾‹</strong>: ä½¿ç”¨ç§é’¥è¿›è¡Œç­¾åæ—¶ï¼Œå‚æ•°å¯èƒ½åŒ…å« <code>{ name: &#39;RSASSA-PKCS1-v1_5&#39;, hash: {name: &#39;SHA-256&#39;} }</code>ï¼Œè¿™é‡Œ <code>hash</code> æŒ‡å®šäº†ç”¨äºç­¾åçš„å“ˆå¸Œç®—æ³•ã€‚</li></ul></li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ç”¨æˆ·ç™»å½•çš„ç½‘ç«™ï¼Œå¹¶ä¸”æƒ³è¦å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç ã€‚ä½¿ç”¨ Node.js å’Œ Web Crypto APIï¼Œä½ å¯èƒ½ä¼šé€‰æ‹© SHA-256 å“ˆå¸Œç®—æ³•æ¥å¤„ç†ç”¨æˆ·å¯†ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> hashPassword</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hash</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨æ–¹æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">hashPassword</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">mySuperSecretPassword</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">hashedPassword</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hashedPassword</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™ä¸ªå“ˆå¸Œå€¼å¯ä»¥å­˜å‚¨åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° <code>hashPassword</code>ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå¯†ç ï¼Œå°†å…¶è½¬æ¢ä¸º UTF-8 ç¼–ç çš„å­—èŠ‚æ•°ç»„ï¼Œç„¶åä½¿ç”¨ SHA-256 ç®—æ³•ç”Ÿæˆå“ˆå¸Œã€‚æœ€åï¼Œå°†å“ˆå¸Œå€¼è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²å¹¶è¿”å›ã€‚è¿™ä¸ªå“ˆå¸Œå€¼å¯ä»¥å®‰å…¨åœ°å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨äºéªŒè¯ç”¨æˆ·ç™»å½•ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ ç†è§£ Node.js ä¸­ Web Crypto API çš„ç®—æ³•å‚æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h3 id="class-algorithmidentifier" tabindex="-1"><a class="header-anchor" href="#class-algorithmidentifier"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-algorithmidentifier" target="_blank" rel="noopener noreferrer">Class: AlgorithmIdentifier</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>AlgorithmIdentifier</code>æ˜¯ä¸ Web Crypto API å…³è”çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒç”¨äºæŒ‡å®šåŠ å¯†æ“ä½œä¸­ä½¿ç”¨çš„ç®—æ³•ã€‚è¿™ä¸ª API æ˜¯è®¾è®¡æ¥ä¸ºç½‘ç»œåº”ç”¨æä¾›ä¸€ç§å®‰å…¨æ€§å’Œå¯†ç å­¦çš„æ ‡å‡†æ–¹å¼ï¼Œè€Œ<code>AlgorithmIdentifier</code>åˆ™æ˜¯åœ¨è¿™ä¸ªæ¡†æ¶å†…å®šä¹‰åŠ å¯†ç®—æ³•çš„æ–¹æ³•ã€‚</p><h3 id="ç†è§£algorithmidentifier" tabindex="-1"><a class="header-anchor" href="#ç†è§£algorithmidentifier"><span>ç†è§£<code>AlgorithmIdentifier</code></span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>AlgorithmIdentifier</code>å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæŒ‡ç¤ºå™¨ï¼Œå‘Šè¯‰ Web Crypto API ä½ æƒ³è¦ä½¿ç”¨å“ªç§åŠ å¯†ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³åŠ å¯†æˆ–è€…ç­¾åæ•°æ®æ—¶ï¼Œä½ éœ€è¦æŒ‡å®šä½¿ç”¨å“ªç§ç®—æ³•ï¼Œå¦‚ AESã€RSA æˆ– ECDSA ç­‰ã€‚</p><h3 id="algorithmidentifierçš„å½¢å¼" tabindex="-1"><a class="header-anchor" href="#algorithmidentifierçš„å½¢å¼"><span><code>AlgorithmIdentifier</code>çš„å½¢å¼</span></a></h3><p>åœ¨ä½¿ç”¨ä¸Šï¼Œ<code>AlgorithmIdentifier</code>å¯ä»¥ä»¥ä¸¤ç§å½¢å¼å‡ºç°ï¼š</p><ol><li><strong>å­—ç¬¦ä¸²å½¢å¼</strong>ï¼šå®ƒæ˜¯æœ€ç®€å•çš„å½¢å¼ï¼Œåªéœ€æä¾›ç®—æ³•çš„åç§°å³å¯ï¼Œå¦‚<code>&quot;RSA-OAEP&quot;</code>ã€<code>&quot;AES-GCM&quot;</code>ç­‰ã€‚</li><li><strong>å¯¹è±¡å½¢å¼</strong>ï¼šè¿™æ˜¯æ›´ä¸ºè¯¦ç»†çš„å½¢å¼ï¼Œä¸ä»…æä¾›ç®—æ³•åç§°ï¼Œè¿˜å¯ä»¥åŒ…å«ç®—æ³•ç‰¹æœ‰çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¯¹äº AES-GCMï¼Œä½ å¯ä»¥æŒ‡å®š IVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰ã€é™„åŠ æ•°æ®ç­‰ã€‚</li></ol><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€äº›å®é™…çš„ä½¿ç”¨ä¾‹å­ã€‚</p><h4 id="ç¤ºä¾‹-1-ä½¿ç”¨algorithmidentifierè¿›è¡Œæ•°æ®åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ä½¿ç”¨algorithmidentifierè¿›è¡Œæ•°æ®åŠ å¯†"><span>ç¤ºä¾‹ 1ï¼šä½¿ç”¨<code>AlgorithmIdentifier</code>è¿›è¡Œæ•°æ®åŠ å¯†</span></a></h4><p>å‡è®¾ä½ æƒ³ä½¿ç”¨ AES-GCM ç®—æ³•æ¥åŠ å¯†ä¸€äº›æ•°æ®ã€‚ä½ é¦–å…ˆéœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨è¯¥å¯†é’¥å’Œ<code>AlgorithmIdentifier</code>æ¥åŠ å¯†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨AES-GCMç®—æ³•çš„å­—ç¬¦ä¸²å½¢å¼åˆ›å»ºAlgorithmIdentifier</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šå¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// ä½¿ç”¨å¯†é’¥çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // éšæœºç”ŸæˆIV</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// å°†æ•°æ®ç¼–ç æˆArrayBuffer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨å‡½æ•°åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#88C0D0;">encryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Encrypted data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨algorithmidentifierè¿›è¡Œæ•°æ®ç­¾å" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨algorithmidentifierè¿›è¡Œæ•°æ®ç­¾å"><span>ç¤ºä¾‹ 2ï¼šä½¿ç”¨<code>AlgorithmIdentifier</code>è¿›è¡Œæ•°æ®ç­¾å</span></a></h4><p>å‡è®¾ä½ æƒ³ä½¿ç”¨ ECDSA ç®—æ³•å¯¹æ•°æ®è¿›è¡Œç­¾åã€‚åŒæ ·åœ°ï¼Œä½ é¦–å…ˆéœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼Œç„¶åä½¿ç”¨ç§é’¥å’Œ<code>AlgorithmIdentifier</code>æ¥ç­¾åæ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»ºAlgorithmIdentifierçš„å¯¹è±¡å½¢å¼</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šæ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç­¾åæ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šå“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨å‡½æ•°ç­¾åæ•°æ®</span></span>
<span class="line"><span style="color:#88C0D0;">signData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Signature:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>AlgorithmIdentifier</code>çš„é‡è¦æ€§â€”â€”å®ƒå®šä¹‰äº†åŠ å¯†æˆ–ç­¾åæ“ä½œä¸­ä½¿ç”¨çš„å…·ä½“ç®—æ³•åŠå…¶ç›¸å…³å‚æ•°ã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£å¹¶å¼€å§‹ä½¿ç”¨ Node.js ä¸­çš„ Web Crypto APIã€‚</p><h4 id="algorithmidentifier-name" tabindex="-1"><a class="header-anchor" href="#algorithmidentifier-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#algorithmidentifiername" target="_blank" rel="noopener noreferrer">algorithmIdentifier.name</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>algorithmIdentifier.name</code>æ˜¯ Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºæŒ‡å®šåŠ å¯†æ“ä½œä½¿ç”¨çš„ç®—æ³•åç§°ã€‚è¿™ç§æœºåˆ¶æå…¶é‡è¦ï¼Œå› ä¸ºå®ƒå†³å®šäº†å¦‚ä½•åŠ å¯†æˆ–è§£å¯†æ•°æ®ï¼Œä»¥åŠå¦‚ä½•ç”Ÿæˆç­¾åæˆ–éªŒè¯å®ƒä»¬ã€‚</p><h3 id="ç†è§£-algorithmidentifier" tabindex="-1"><a class="header-anchor" href="#ç†è§£-algorithmidentifier"><span>ç†è§£ <code>algorithmIdentifier</code></span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä»€ä¹ˆæ˜¯<code>algorithmIdentifier</code>ã€‚åœ¨ Web åŠ å¯† API ä¸­ï¼Œ<code>algorithmIdentifier</code>å¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ <code>&quot;RSA-OAEP&quot;</code>ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«<code>name</code>å±æ€§å’Œå…¶ä»–å¯èƒ½éœ€è¦çš„å±æ€§ï¼ˆæ¯”å¦‚å¯†é’¥é•¿åº¦ã€å“ˆå¸Œå‡½æ•°ç­‰ï¼‰ã€‚å…³é”®ç‚¹åœ¨äºï¼Œ<code>algorithmIdentifier</code>å‘Šè¯‰åŠ å¯†å‡½æ•°å…·ä½“ä½¿ç”¨å“ªä¸ªç®—æ³•è¿›è¡Œæ“ä½œã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-name-å±æ€§å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-name-å±æ€§å¾ˆé‡è¦"><span>ä¸ºä»€ä¹ˆ <code>name</code> å±æ€§å¾ˆé‡è¦ï¼Ÿ</span></a></h3><p><code>name</code>å±æ€§æ˜¯<code>algorithmIdentifier</code>çš„æ ¸å¿ƒï¼Œå› ä¸ºå®ƒç›´æ¥æŒ‡å®šäº†åŠ å¯†ç®—æ³•çš„åç§°ã€‚ä¸åŒçš„ç®—æ³•æœ‰ç€ä¸åŒçš„ç”¨é€”ã€ä¼˜åŠ¿å’Œé™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæœ‰çš„ç®—æ³•é€‚åˆåŠ å¯†æ•°æ®ï¼Œè€Œæœ‰çš„åˆ™ç‰¹åˆ«é€‚ç”¨äºæ•°å­—ç­¾åæˆ–æ¶ˆæ¯æ‘˜è¦ï¼ˆæ•£åˆ—ï¼‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-9"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥æ›´å¥½åœ°ç†è§£è¿™ä¸€æ¦‚å¿µï¼š</p><h4 id="_1-åŠ å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_1-åŠ å¯†æ•°æ®"><span>1. åŠ å¯†æ•°æ®</span></a></h4><p>å‡è®¾ä½ æƒ³ç”¨ AES-GCM æ¨¡å¼åŠ å¯†ä¸€äº›æ•æ„Ÿæ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ çš„<code>algorithmIdentifier</code>å°†æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­<code>name</code>å±æ€§çš„å€¼è®¾ç½®ä¸º<code>&quot;AES-GCM&quot;</code>ï¼Œå› ä¸ºä½ æŒ‡å®šä½¿ç”¨ AES ç®—æ³•çš„ GCM æ¨¡å¼è¿›è¡ŒåŠ å¯†ã€‚æ­¤å¤–ï¼Œä½ å¯èƒ½è¿˜éœ€è¦æŒ‡å®šå…¶ä»–å±æ€§ï¼Œæ¯”å¦‚å¯†é’¥é•¿åº¦ï¼ˆ<code>length</code>ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">  iv</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> ...</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡ï¼Œå¯¹äºæŸäº›æ¨¡å¼å¦‚GCMæ¥è¯´éå¸¸é‡è¦</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-æ•°å­—ç­¾å-1" tabindex="-1"><a class="header-anchor" href="#_2-æ•°å­—ç­¾å-1"><span>2. æ•°å­—ç­¾å</span></a></h4><p>å¦‚æœä½ çš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªæ•°å­—ç­¾åï¼Œæ¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨<code>RSA-PSS</code>ç®—æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>algorithmIdentifier</code>å¯¹è±¡çš„<code>name</code>å±æ€§å°†è¢«è®¾ç½®ä¸º<code>&quot;RSA-PSS&quot;</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // PSSå¡«å……ä¸­ä½¿ç”¨çš„ç›çš„é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-åˆ›å»ºå“ˆå¸Œ-æ¶ˆæ¯æ‘˜è¦" tabindex="-1"><a class="header-anchor" href="#_3-åˆ›å»ºå“ˆå¸Œ-æ¶ˆæ¯æ‘˜è¦"><span>3. åˆ›å»ºå“ˆå¸Œï¼ˆæ¶ˆæ¯æ‘˜è¦ï¼‰</span></a></h4><p>åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯æ‘˜è¦ï¼ˆæˆ–ç§°å“ˆå¸Œï¼‰ï¼Œé€šå¸¸ç”¨äºç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨<code>SHA-256</code>ç®—æ³•ã€‚æ­¤æ—¶ï¼Œä½ åªéœ€å°†<code>algorithmIdentifier</code>è®¾ç½®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²<code>&quot;SHA-256&quot;</code>æˆ–è€…ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶<code>name</code>å±æ€§å€¼ä¸º<code>&quot;SHA-256&quot;</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æˆ–è€… { name: &quot;SHA-256&quot; }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>algorithmIdentifier.name</code>æ˜¯å¦‚ä½•ç¡®å®šåŠ å¯†æ“ä½œè¦ä½¿ç”¨å“ªç§ç®—æ³•çš„ã€‚ä¸åŒåœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„ç®—æ³•éå¸¸å…³é”®ï¼Œå› ä¸ºå®ƒå½±å“ç€å®‰å…¨æ€§ã€æ€§èƒ½å’Œæœ€ç»ˆç»“æœçš„æœ‰æ•ˆæ€§ã€‚åœ¨ Node.js çš„ Web åŠ å¯† API ä¸­ï¼Œæ˜ç¡®åœ°æŒ‡å®šç®—æ³•åç§°æ˜¯æ‰§è¡Œä»»ä½•åŠ å¯†æ“ä½œçš„ç¬¬ä¸€æ­¥ã€‚</p><h3 id="class-aescbcparams" tabindex="-1"><a class="header-anchor" href="#class-aescbcparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-aescbcparams" target="_blank" rel="noopener noreferrer">Class: AesCbcParams</a></span></a></h3><p>äº†è§£<code>AesCbcParams</code>ç±»ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“å®ƒå±äº Node.js ä¸­çš„ Web Crypto API çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®çš„ APIã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯å½“å¤„ç†æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚ç”¨æˆ·å¯†ç æˆ–ä¸ªäººä¿¡æ¯ï¼‰æ—¶ã€‚</p><h3 id="aes-cbc-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#aes-cbc-ç®€ä»‹"><span>AES-CBC ç®€ä»‹</span></a></h3><p>AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚&quot;å¯¹ç§°&quot;æ„å‘³ç€åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„ç§˜é’¥ã€‚CBCï¼ˆå¯†ç å—é“¾æ¥ï¼‰æ˜¯ä¸€ç§æ“ä½œæ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªæ˜æ–‡å—åœ¨åŠ å¯†ä¹‹å‰ä¼šä¸å‰ä¸€ä¸ªå¯†æ–‡å—è¿›è¡ŒæŸç§ç»„åˆã€‚è¿™å¢åŠ äº†åŠ å¯†è¿‡ç¨‹çš„å¤æ‚åº¦ï¼Œä½¿å…¶æ›´éš¾è¢«ç ´è§£ã€‚</p><h3 id="aescbcparams-ç±»" tabindex="-1"><a class="header-anchor" href="#aescbcparams-ç±»"><span>AesCbcParams ç±»</span></a></h3><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>AesCbcParams</code>æ˜¯ç”¨äºé…ç½® AES-CBC åŠ å¯†æ“ä½œçš„å‚æ•°å¯¹è±¡ã€‚å®ƒå…·ä½“å®šä¹‰äº†åŠ å¯†è¿‡ç¨‹éœ€è¦çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬:</p><ul><li><code>name</code>: å¿…é¡»æ˜¯<code>&quot;AES-CBC&quot;</code>ï¼Œè¡¨æ˜æ­£åœ¨ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ã€‚</li><li><code>iv</code>: åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ï¼Œç”¨äº AES-CBC æ¨¡å¼çš„åŠ å¯†å’Œè§£å¯†ã€‚ä¸ºäº†å®‰å…¨æ€§ï¼Œæ¯æ¬¡åŠ å¯†æ—¶åº”è¯¥ä½¿ç”¨ä¸åŒçš„ IVã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-10"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦å­˜å‚¨ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ä¿å­˜å¯†ç ï¼‰ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œç›´æ¥å­˜å‚¨åŸå§‹å¯†ç éå¸¸å±é™©ï¼Œå› æ­¤ä½ å†³å®šä½¿ç”¨ AES-CBC åŠ å¯†æ–¹å¼æ¥åŠ å¯†å¯†ç åå†å­˜å‚¨ã€‚</p><h4 id="æ­¥éª¤-1-å¯¼å…¥åº“å’Œç”Ÿæˆç§˜é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-å¯¼å…¥åº“å’Œç”Ÿæˆç§˜é’¥"><span>æ­¥éª¤ 1: å¯¼å…¥åº“å’Œç”Ÿæˆç§˜é’¥</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦å¯¼å…¥ Node.js çš„ crypto åº“ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç”¨äº AES-CBC åŠ å¯†çš„ç§˜é’¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CBC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // åŠ å¯†ç®—æ³•å’Œç§˜é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// æŒ‡å®šç§˜é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-åŠ å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-åŠ å¯†æ•°æ®"><span>æ­¥éª¤ 2: åŠ å¯†æ•°æ®</span></a></h4><p>æ¥ä¸‹æ¥ï¼Œåˆ©ç”¨ä¹‹å‰ç”Ÿæˆçš„ç§˜é’¥æ¥åŠ å¯†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ä¸ºAES-CBCæ¨¡å¼ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CBC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨generateKey()ç”Ÿæˆçš„ç§˜é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// è¦åŠ å¯†çš„æ•°æ®è½¬Buffer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿”å›åŠ å¯†æ•°æ®å’ŒIVä¾›åç»­ä½¿ç”¨</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-3-è§£å¯†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-è§£å¯†æ•°æ®"><span>æ­¥éª¤ 3: è§£å¯†æ•°æ®</span></a></h4><p>æœ€åï¼Œä½¿ç”¨ç›¸åŒçš„ç§˜é’¥å’Œ IV å¯ä»¥è§£å¯†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CBC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å°†Bufferè½¬æ¢å›åŸå§‹å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ éœ€è¦å®‰å…¨åœ°å­˜å‚¨è¿™äº›åŠ å¯†çš„æ•°æ®å’Œ IVï¼ˆä½†ä¸æ˜¯ç§˜é’¥ï¼‰ï¼Œä»¥ä¾¿æ—¥åå¯ä»¥è§£å¯†ã€‚ç§˜é’¥åº”è¯¥å®‰å…¨ä¿ç®¡ï¼Œç¡®ä¿åªæœ‰æˆæƒçš„æœåŠ¡æˆ–ä¸ªäººå¯ä»¥è®¿é—®ã€‚</p><p>é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨<code>AesCbcParams</code>æ¥å®‰å…¨åœ°ç®¡ç†æ•°æ®çš„åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ã€‚æ­£ç¡®å’Œå®‰å…¨åœ°å¤„ç†åŠ å¯†æ˜¯ä¿æŠ¤ Web åº”ç”¨å®‰å…¨çš„å…³é”®æ­¥éª¤ä¹‹ä¸€ã€‚</p><h4 id="aescbcparams-iv" tabindex="-1"><a class="header-anchor" href="#aescbcparams-iv"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aescbcparamsiv" target="_blank" rel="noopener noreferrer">aesCbcParams.iv</a></span></a></h4><p>Node.js ä¸­çš„<code>aesCbcParams.iv</code>æ˜¯ä¸ Web åŠ å¯† APIï¼ˆWebCrypto APIï¼‰ç›¸å…³çš„ä¸€ä¸ªæ¦‚å¿µã€‚ä¸ºäº†ç†è§£å®ƒï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p><strong>AES</strong>: é«˜çº§åŠ å¯†æ ‡å‡†(Advanced Encryption Standard)ï¼Œä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å¯¹ç§°åŠ å¯†æ„å‘³ç€åŠ å¯†å’Œè§£å¯†éƒ½ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ã€‚</p><p><strong>CBC</strong>: å¯†ç å—é“¾æ¥æ¨¡å¼(Cipher Block Chaining)ï¼Œä¸€ç§æ“ä½œæ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªæ˜æ–‡å—å…ˆä¸å‰ä¸€ä¸ªå¯†æ–‡å—è¿›è¡Œå¼‚æˆ–åï¼Œå†è¿›è¡ŒåŠ å¯†ã€‚é¦–ä¸ªå—åˆ™ä¸ä¸€ä¸ªåˆå§‹å‘é‡(IV)è¿›è¡Œå¼‚æˆ–ã€‚</p><p><strong>IV(åˆå§‹åŒ–å‘é‡)</strong>: ç”¨æ¥ä¿è¯å³ä½¿æ˜æ–‡ç›¸åŒï¼ŒåŠ å¯†åçš„å¯†æ–‡ä¹Ÿä¼šä¸åŒï¼Œä»è€Œå¢åŠ åŠ å¯†çš„å®‰å…¨æ€§ã€‚å®ƒå¿…é¡»æ˜¯éšæœºçš„ï¼Œå¯¹äºæ¯æ¬¡åŠ å¯†éƒ½åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œä½†å®ƒä¸éœ€è¦ä¿å¯†ã€‚åœ¨ CBC æ¨¡å¼ä¸­ï¼ŒIV çš„é•¿åº¦å¿…é¡»ç­‰äºåŠ å¯†å—çš„å¤§å°ã€‚</p><h3 id="aescbcparams-iv-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#aescbcparams-iv-è¯¦è§£"><span>aesCbcParams.iv è¯¦è§£</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„ WebCrypto API ä¸­ï¼Œå½“ä½ æƒ³åˆ©ç”¨ AES ç®—æ³•ä»¥ CBC æ¨¡å¼è¿›è¡Œæ•°æ®åŠ å¯†æ—¶ï¼Œä½ éœ€è¦ä½¿ç”¨åŒ…å«<code>iv</code>å±æ€§çš„<code>aesCbcParams</code>å¯¹è±¡ã€‚<code>aesCbcParams.iv</code>å°±æ˜¯ä¸Šè¿°æ‰€è¯´çš„åˆå§‹åŒ–å‘é‡(IV)ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬éœ€è¦åŠ å¯†ä¸€æ¡é‡è¦æ¶ˆæ¯&quot;Hello, World!&quot;ï¼Œå¹¶ä¸”æˆ‘ä»¬å†³å®šä½¿ç”¨ AES-CBC æ¨¡å¼è¿›è¡ŒåŠ å¯†ã€‚</p><ol><li><strong>ç”Ÿæˆå¯†é’¥</strong>: é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª AES å¯†é’¥ï¼Œè¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ¶‰åŠåˆ°æŒ‡å®šå¯†é’¥é•¿åº¦ç­‰å‚æ•°ã€‚</li><li><strong>é€‰æ‹© IV</strong>: ç„¶åï¼Œæˆ‘ä»¬å¿…é¡»ä¸º CBC æ¨¡å¼ç”Ÿæˆä¸€ä¸ªåˆé€‚é•¿åº¦çš„éšæœº IVã€‚åœ¨ AES ä¸­ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ 128 ä½åŠ å¯†ï¼Œåˆ™ IV ä¹Ÿåº”è¯¥æ˜¯ 16 å­—èŠ‚é•¿ã€‚</li><li><strong>è®¾ç½® aesCbcParams</strong>: æ¥ç€ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>aesCbcParams</code>å¯¹è±¡ï¼Œå¹¶è®¾ç½®å…¶<code>iv</code>å±æ€§ä¸ºæ­¥éª¤ 2 ä¸­ç”Ÿæˆçš„ IVã€‚</li><li><strong>åŠ å¯†æ¶ˆæ¯</strong>: æœ€åï¼Œä½¿ç”¨ä¸Šè¿°å¯†é’¥ã€IV åŠå…¶ä»–å¿…è¦å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯åŠ å¯†æˆå¯†æ–‡ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”ŸæˆAESå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CBC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦å¯ä»¥æ˜¯128, 192, æˆ–256</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// æŒ‡å®šå¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”ŸæˆéšæœºIV</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¯¹äºAES-CBC, IVåº”æ˜¯16å­—èŠ‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CBC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨å‰é¢ç”Ÿæˆçš„IV</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Encrypted data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç”Ÿæˆäº†ä¸€ä¸ª 256 ä½çš„ AES å¯†é’¥ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ª 16 å­—èŠ‚çš„éšæœº IVã€‚æˆ‘ä»¬æŒ‡å®šäº†åŠ å¯†ç®—æ³•ï¼ˆAES-CBCï¼‰å’ŒåŠ å¯†æ—¶ä½¿ç”¨çš„ IVï¼ˆé€šè¿‡<code>aesCbcParams.iv</code>è®¾ç½®ï¼‰ã€‚æœ€åï¼Œæˆ‘ä»¬å°†å­—ç¬¦ä¸²&quot;Hello, World!&quot;åŠ å¯†æˆäº†å¯†æ–‡ã€‚</p><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p><code>aesCbcParams.iv</code>åœ¨ Node.js çš„ WebCrypto API ä¸­æ‰®æ¼”äº†åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰çš„è§’è‰²ï¼Œå®ƒæ˜¯å®ç° AES-CBC åŠ å¯†æ¨¡å¼ä¸­é‡è¦çš„ä¸€ç¯ï¼Œç¡®ä¿äº†åŠ å¯†è¿‡ç¨‹çš„å®‰å…¨æ€§å’Œæœ‰æ•ˆæ€§ã€‚é€šè¿‡ä»¥ä¸Šæ­¥éª¤å’Œç¤ºä¾‹ä»£ç ï¼Œä½ å¯ä»¥äº†è§£åˆ°å¦‚ä½•åœ¨å®é™…ç¼–ç¨‹ä¸­åº”ç”¨å®ƒã€‚</p><h4 id="aescbcparams-name" tabindex="-1"><a class="header-anchor" href="#aescbcparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aescbcparamsname" target="_blank" rel="noopener noreferrer">aesCbcParams.name</a></span></a></h4><p>Node.js v21.7.1 ç‰ˆæœ¬ä¸­çš„<code>aesCbcParams.name</code>æ˜¯ä¸ Web Crypto API ä¸­çš„ AES-CBC ç®—æ³•ç›¸å…³çš„ä¸€ä¸ªå±æ€§ã€‚è¦ç†è§£<code>aesCbcParams.name</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†-2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†-2"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><p><strong>Node.js</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚</p><p><strong>Web Crypto API</strong> æ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡Œå„ç§åŠ å¯†æ“ä½œï¼ˆå¦‚æ•£åˆ—ã€ç­¾åã€åŠ å¯†ç­‰ï¼‰çš„æµè§ˆå™¨ APIã€‚å°½ç®¡æœ€åˆè®¾è®¡ç”¨äº Web æµè§ˆå™¨ï¼ŒNode.js ä¹Ÿå®ç°äº†è¿™ä¸ª API çš„å¾ˆå¤šéƒ¨åˆ†ï¼Œä½¿å¾—æœåŠ¡å™¨ç«¯åº”ç”¨èƒ½å¤Ÿä½¿ç”¨è¿™äº›åŠ å¯†åŠŸèƒ½ã€‚</p><p><strong>AES-CBC</strong> æ˜¯ä¸€ç§å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•ï¼Œå…¶ä¸­â€œAESâ€ä»£è¡¨é«˜çº§åŠ å¯†æ ‡å‡†ï¼Œâ€œCBCâ€ä»£è¡¨å¯†ç å—é“¾æ¨¡å¼ã€‚å¯¹ç§°åŠ å¯†æ„å‘³ç€åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚CBC æ¨¡å¼æ„å‘³ç€æ¯ä¸ªæ˜æ–‡å—åœ¨åŠ å¯†ä¹‹å‰éƒ½ä¼šä¸å‰ä¸€ä¸ªå¯†æ–‡å—è¿›è¡ŒæŸç§å½¢å¼çš„åˆå¹¶ï¼Œä»¥å¢åŠ åŠ å¯†å¼ºåº¦ã€‚</p><h3 id="aescbcparams-name-1" tabindex="-1"><a class="header-anchor" href="#aescbcparams-name-1"><span><a href="http://aesCbcParams.name" target="_blank" rel="noopener noreferrer">aesCbcParams.name</a></span></a></h3><p>åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œ AES-CBC åŠ å¯†æ—¶ï¼Œ<code>aesCbcParams</code>å¯¹è±¡è¢«ç”¨æ¥æŒ‡å®šåŠ å¯†æ“ä½œçš„å‚æ•°ã€‚å…¶ä¸­ï¼Œ<code>aesCbcParams.name</code>æ˜¯æŒ‡å®šä½¿ç”¨ AES-CBC ç®—æ³•çš„å±æ€§ã€‚æ¢å¥è¯è¯´ï¼Œå½“ä½ æƒ³è¿›è¡Œ AES-CBC åŠ å¯†æˆ–è§£å¯†æ—¶ï¼Œä½ éœ€åœ¨ç›¸å…³çš„å‚æ•°å¯¹è±¡ä¸­è®¾ç½®<code>name</code>å±æ€§ä¸º<code>&quot;AES-CBC&quot;</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚ä½ å†³å®šä½¿ç”¨ AES-CBC åŠ å¯†ç®—æ³•æ¥åŠ å¯†è¿™äº›æ•°æ®ã€‚ä»¥ä¸‹æ˜¯è¿™ç§åœºæ™¯ä¸‹çš„ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ä½ å·²æœ‰ä¸€ä¸ªå¯†é’¥ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ éœ€è¦å®‰å…¨åœ°ç”Ÿæˆå’Œå­˜å‚¨è¿™ä¸ªå¯†é’¥ï¼‰</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span><span style="color:#616E88;"> // ä½¿ç”¨crypto.subtle.generateKey()ç”Ÿæˆçš„å¯†é’¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// è¦åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">è¿™æ˜¯ä¸€äº›éå¸¸æ•æ„Ÿçš„ä¿¡æ¯</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ï¼Œå¯¹äºCBCæ¨¡å¼æ¥è¯´æ˜¯å¿…éœ€çš„</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // éšæœºç”Ÿæˆ16å­—èŠ‚çš„IV</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åŠ å¯†å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> aesCbcParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CBC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨AES-CBCåŠ å¯†ç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">  iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æä¾›åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> params</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">params</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç°åœ¨ï¼Œä½¿ç”¨aesCbcParamså’Œå¯†é’¥keyè°ƒç”¨encryptDataå‡½æ•°è¿›è¡ŒåŠ å¯†</span></span>
<span class="line"><span style="color:#88C0D0;">encryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> aesCbcParams</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">åŠ å¯†åçš„æ•°æ®:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† Node.js çš„<code>crypto</code>æ¨¡å—ï¼Œå¹¶ä¸“æ³¨äºå…¶<code>webcrypto</code>å­æ¨¡å—æ¥ä½¿ç”¨ Web Crypto API åŠŸèƒ½ã€‚æ¥ç€å®šä¹‰äº†ä¸€ä¸ªåŠ å¯†å‡½æ•°<code>encryptData</code>ï¼Œè¯¥å‡½æ•°æ¥å—è¦åŠ å¯†çš„æ•°æ®ã€å¯†é’¥ä»¥åŠåŠ å¯†å‚æ•°ï¼ˆåŒ…æ‹¬æˆ‘ä»¬è®¨è®ºçš„<code>aesCbcParams.name</code>ï¼‰ã€‚é€šè¿‡è°ƒç”¨<code>crypto.subtle.encrypt</code>æ–¹æ³•å¹¶ä¼ é€’ç›¸åº”çš„å‚æ•°ï¼Œå®ç°äº†æ•°æ®çš„åŠ å¯†è¿‡ç¨‹ã€‚</p><p>æ€»ç»“ï¼š<code>aesCbcParams.name</code>æ˜¯åœ¨ä½¿ç”¨ Node.js è¿›è¡Œ AES-CBC åŠ å¯†æ“ä½œæ—¶ï¼Œåœ¨åŠ å¯†å‚æ•°å¯¹è±¡ä¸­æŒ‡å®šä½¿ç”¨ AES-CBC ç®—æ³•çš„å±æ€§ã€‚é€šè¿‡æä¾›<code>&quot;AES-CBC&quot;</code>ä½œä¸ºæ­¤å±æ€§çš„å€¼ï¼Œå‘Šè¯‰åŠ å¯†å‡½æ•°åº”ä½¿ç”¨ AES-CBC ç®—æ³•è¿›è¡ŒåŠ å¯†æ“ä½œã€‚</p><h3 id="class-aesctrparams" tabindex="-1"><a class="header-anchor" href="#class-aesctrparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-aesctrparams" target="_blank" rel="noopener noreferrer">Class: AesCtrParams</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„<code>AesCtrParams</code>ç±»æ˜¯ä¸ Web åŠ å¯† API ç›¸å…³çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç† AES-CTR æ¨¡å¼åŠ å¯†æ—¶ã€‚è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥è¯¦ç»†åœ°äº†è§£å®ƒã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-aes-ctr-åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-aes-ctr-åŠ å¯†"><span>ä»€ä¹ˆæ˜¯ AES-CTR åŠ å¯†ï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼ŒAES ä»£è¡¨é«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆAdvanced Encryption Standardï¼‰ï¼Œæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚&quot;å¯¹ç§°&quot;æ„å‘³ç€åŠ å¯†å’Œè§£å¯†ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯†é’¥ã€‚AES å¯ä»¥åœ¨å¤šç§åŠ å¯†æ¨¡å¼ä¸‹è¿è¡Œï¼Œæ¯”å¦‚ CBCã€GCM å’Œ CTR ç­‰ã€‚</p><p>CTR ä»£è¡¨è®¡æ•°å™¨æ¨¡å¼ï¼ˆCounter Modeï¼‰ã€‚åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œè€Œä¸æ˜¯ç›´æ¥åŠ å¯†æ•°æ®æœ¬èº«ï¼ŒåŠ å¯†è¿‡ç¨‹å¯¹â€œè®¡æ•°å™¨â€è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå°†å¾—åˆ°çš„ç»“æœä¸æ•°æ®æ‰§è¡Œå¼‚æˆ–æ“ä½œæ¥åŠ å¯†æˆ–è§£å¯†æ•°æ®ã€‚æ¯æ¬¡åŠ å¯†ä¸€å—æ•°æ®æ—¶ï¼Œè®¡æ•°å™¨éƒ½ä¼šå¢åŠ ã€‚è¿™å…è®¸åŒä¸€å¯†é’¥åŠ å¯†å¤šä¸ªæ•°æ®å—è€Œä¸é™ä½å®‰å…¨æ€§ã€‚</p><h3 id="aesctrparams-ç±»" tabindex="-1"><a class="header-anchor" href="#aesctrparams-ç±»"><span>AesCtrParams ç±»</span></a></h3><p>åœ¨ Node.js çš„<code>AesCtrParams</code>ç±»ä¸­ï¼Œè¿™ä¸ªç±»å®šä¹‰äº†ä½¿ç”¨ AES-CTR åŠ å¯†æ¨¡å¼æ‰€éœ€çš„å‚æ•°ã€‚æœ€é‡è¦çš„å‚æ•°åŒ…æ‹¬ï¼š</p><ul><li><code>name</code>: è¿™é‡Œåº”è¯¥æ˜¯ <code>&quot;AES-CTR&quot;</code> å­—ç¬¦ä¸²ï¼Œæ ‡æ˜ä½¿ç”¨çš„æ˜¯ AES-CTR æ¨¡å¼ã€‚</li><li><code>counter</code>: ä¸€ä¸ªåŒ…å«åˆå§‹è®¡æ•°å™¨å€¼çš„<code>BufferSource</code>ã€‚å®ƒå¿…é¡»æ˜¯ 16 å­—èŠ‚é•¿ï¼Œå› ä¸º AES çš„å—å¤§å°æ˜¯ 128 ä½ï¼ˆ16 å­—èŠ‚ï¼‰ã€‚</li><li><code>length</code>: ç”¨äºåŠ å¯†çš„è®¡æ•°å™¨çš„ä½é•¿åº¦ï¼Œè¿™å†³å®šäº†å“ªäº›ä½åœ¨æ¯æ¬¡åŠ å¯†åä¼šå¢åŠ ã€‚é€šå¸¸è®¾ç½®ä¸º 64 æˆ– 128 ä½ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ éœ€è¦åŠ å¯†ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ä¿éšœå…¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚ä½¿ç”¨ AES-CTR åŠ å¯†æ¨¡å¼å¯ä»¥å¸®åŠ©ä½ è¾¾åˆ°è¿™ä¸ªç›®æ ‡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p><strong>ç”Ÿæˆå¯†é’¥</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªç”¨äº AES åŠ å¯†çš„å¯†é’¥ã€‚</p></li><li><p><strong>å®šä¹‰è®¡æ•°å™¨</strong>ï¼šæ ¹æ® AES-CTR è¦æ±‚ï¼Œé€‰æ‹©ä¸€ä¸ªåˆå§‹è®¡æ•°å™¨ã€‚è¿™ä¸ªè®¡æ•°å™¨åœ¨åŠ å¯†è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨å¢åŠ ã€‚</p></li><li><p><strong>åŠ å¯†æ•°æ®</strong>ï¼šä½¿ç”¨ä¸Šè¿°å¯†é’¥å’Œè®¡æ•°å™¨ï¼ŒåŠ å¯†ç”¨æˆ·ä¿¡æ¯ã€‚</p></li><li><p><strong>ä¼ è¾“æ•°æ®</strong>ï¼šåŠ å¯†åçš„æ•°æ®å¯ä»¥å®‰å…¨åœ°é€šè¿‡ç½‘ç»œä¼ è¾“ç»™æ¥æ”¶è€…ã€‚</p></li><li><p><strong>è§£å¯†æ•°æ®</strong>ï¼šæ¥æ”¶è€…ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œåˆå§‹è®¡æ•°å™¨å€¼è§£å¯†æ•°æ®ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œç¡®ä¿å¯†é’¥çš„å®‰å…¨éå¸¸é‡è¦ï¼Œå› ä¸ºæœ‰äº†å¯†é’¥ï¼Œä»»ä½•äººéƒ½èƒ½è§£å¯†æ•°æ®ã€‚</p><p>ä»£ç ç¤ºä¾‹å¯èƒ½åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptDecryptExample</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CTR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è®¾å®šåˆå§‹è®¡æ•°å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> counter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // é€šå¸¸ä»æŸç§å®‰å…¨æºè·å–æˆ–éšæœºç”Ÿæˆ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // éœ€è¦åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> dataToEncrypt</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CTR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> counter</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 64</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æ³¨æ„counterå’Œlength</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    dataToEncrypt</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è§£å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CTR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> counter</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 64</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¾“å‡º: Hello, World!</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">encryptDecryptExample</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>AesCtrParams</code>ï¼ˆé€šè¿‡æŒ‡å®š<code>counter</code>å’Œ<code>length</code>å‚æ•°ï¼‰ä»¥åŠ Node.js çš„ Web åŠ å¯† API è¿›è¡ŒåŸºæœ¬çš„åŠ å¯†å’Œè§£å¯†æ“ä½œã€‚å¸Œæœ›è¿™æœ‰åŠ©äºä½ äº†è§£<code>AesCtrParams</code>ç±»åŠå…¶åœ¨å®é™…ä¸­çš„åº”ç”¨ã€‚</p><h4 id="aesctrparams-counter" tabindex="-1"><a class="header-anchor" href="#aesctrparams-counter"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aesctrparamscounter" target="_blank" rel="noopener noreferrer">aesCtrParams.counter</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>aesCtrParams.counter</code>æ˜¯ä¸ AES-CTR åŠ å¯†ç®—æ³•ç›¸å…³çš„ä¸€ä¸ªå‚æ•°ã€‚è¦ç†è§£è¿™ä¸ªå‚æ•°çš„ä½œç”¨å’Œé‡è¦æ€§ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç•¥å¾®äº†è§£ä¸€ä¸‹ AES-CTRï¼ˆAdvanced Encryption Standard - Counter Modeï¼‰åŠ å¯†æœ¬èº«ã€‚</p><h3 id="ç®€ä»‹äº-aes-ctr-åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹äº-aes-ctr-åŠ å¯†"><span>ç®€ä»‹äº AES-CTR åŠ å¯†</span></a></h3><p>AES-CTR æ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†æ–¹å¼ï¼Œå®ƒå°†æ•°æ®åˆ†æˆå›ºå®šå¤§å°çš„å—ï¼ˆé€šå¸¸ä¸º 128 ä½ï¼‰ï¼Œç„¶åä½¿ç”¨ç›¸åŒçš„å¯†é’¥å¯¹æ¯ä¸€å—è¿›è¡ŒåŠ å¯†ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œä¸å…¶å®ƒæ¨¡å¼ï¼ˆæ¯”å¦‚ CBC æ¨¡å¼ï¼‰ç›´æ¥åŠ å¯†æ•°æ®ä¸åŒï¼ŒCTR æ¨¡å¼ä¼šç”Ÿæˆä¸€ä¸ªåºåˆ—å·ï¼ˆä¹Ÿå°±æ˜¯â€œè®¡æ•°å™¨â€ï¼‰ï¼Œå¹¶ä¸”å°†æ­¤åºåˆ—å·ä¸å¯†é’¥ä¸€èµ·åŠ å¯†ã€‚ç„¶åï¼Œå°†åŠ å¯†åçš„åºåˆ—å·ä¸æ•°æ®å—è¿›è¡Œå¼‚æˆ–æ“ä½œï¼ˆXORï¼‰ï¼Œä»¥äº§ç”ŸåŠ å¯†æ•°æ®ã€‚å› ä¸ºåºåˆ—å·æ¯æ¬¡éƒ½ä¸åŒï¼Œæ‰€ä»¥å³ä½¿ä¸¤ä¸ªå—çš„æ•°æ®å®Œå…¨ç›¸åŒï¼Œå®ƒä»¬åŠ å¯†åçš„ç»“æœä¹Ÿä¼šä¸åŒï¼Œè¿™å¢å¼ºäº†åŠ å¯†çš„å®‰å…¨æ€§ã€‚</p><h3 id="aesctrparams-counter-1" tabindex="-1"><a class="header-anchor" href="#aesctrparams-counter-1"><span><code>aesCtrParams.counter</code></span></a></h3><p>åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>aesCtrParams.counter</code>æ˜¯æŒ‡åˆå§‹åŒ– AES-CTR åŠ å¯†æ—¶å¿…é¡»æä¾›çš„ä¸€ä¸ªå‚æ•°ï¼Œå®ƒè¡¨ç¤ºåŠ å¯†æ“ä½œå¼€å§‹æ—¶çš„è®¡æ•°å™¨å€¼ã€‚è¿™ä¸ªè®¡æ•°å™¨å¯¹äºåŠ å¯†çš„æ¯ä¸ªæ•°æ®å—éƒ½ä¼šé€’å¢ï¼ˆé€šå¸¸æ˜¯è‡ªåŠ¨çš„ï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œï¼‰ï¼Œç¡®ä¿æ¯ä¸ªå—çš„åŠ å¯†éƒ½æ˜¯å”¯ä¸€çš„ã€‚</p><h3 id="å‚æ•°ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#å‚æ•°ç‰¹æ€§"><span>å‚æ•°ç‰¹æ€§</span></a></h3><ul><li><strong>é•¿åº¦ï¼š</strong> è®¡æ•°å™¨çš„é•¿åº¦é€šå¸¸æ˜¯ 128 ä½ï¼Œä¸ AES å—çš„å¤§å°ç›¸åŒã€‚</li><li><strong>å”¯ä¸€æ€§ï¼š</strong> å¯¹äºåŒä¸€ä¸ªå¯†é’¥ï¼Œè®¡æ•°å™¨çš„åˆå§‹å€¼ä¸åº”é‡å¤ä½¿ç”¨ï¼Œä»¥é˜²æ­¢åŠ å¯†å®‰å…¨æ€§è¢«ç ´åã€‚</li><li><strong>è‡ªå¢ï¼š</strong> åœ¨åŠ å¯†è¿‡ç¨‹ä¸­ï¼Œæ¯å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼Œè®¡æ•°å™¨å€¼å°±ä¼šå¢åŠ ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ï¼Œéœ€è¦ç¡®ä¿æ¶ˆæ¯çš„å®‰å…¨ä¼ è¾“ã€‚ä½ å¯ä»¥ä½¿ç”¨ AES-CTR æ¨¡å¼æ¥åŠ å¯†è¿™äº›æ¶ˆæ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š</p><ol><li><p><strong>åˆå§‹åŒ–åŠ å¯†ï¼š</strong> ä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼ˆkeyï¼‰å’Œä¸€ä¸ªåˆå§‹è®¡æ•°å™¨ï¼ˆcounterï¼‰ã€‚è®¡æ•°å™¨å¯ä»¥æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä½†è¦ç¡®ä¿å®ƒåœ¨ç›¸åŒå¯†é’¥ä¸‹çš„æ¯æ¬¡ä¼šè¯ä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚</p></li><li><p><strong>åŠ å¯†æ¶ˆæ¯ï¼š</strong> ä½¿ç”¨å¯†é’¥å’Œåˆå§‹è®¡æ•°å™¨ï¼Œå¯¹ç”¨æˆ·çš„æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚å¯¹æ¯æ¡æ¶ˆæ¯æˆ–æ¯ä¸ªæ•°æ®å—ï¼Œè®¡æ•°å™¨è‡ªåŠ¨å¢åŠ ï¼Œç¡®ä¿åŠ å¯†çš„å”¯ä¸€æ€§ã€‚</p></li><li><p><strong>ä¼ è¾“å’Œè§£å¯†ï¼š</strong> åŠ å¯†åçš„æ¶ˆæ¯å¯ä»¥é€šè¿‡ç½‘ç»œå®‰å…¨åœ°å‘é€ç»™æ¥æ”¶è€…ã€‚æ¥æ”¶ç«¯ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œåˆå§‹è®¡æ•°å™¨å€¼å¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚</p></li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä¾¿æœ‰äººæˆªè·äº†åŠ å¯†åçš„æ¶ˆæ¯ï¼Œæ²¡æœ‰æ­£ç¡®çš„å¯†é’¥å’Œè®¡æ•°å™¨åˆå§‹å€¼ï¼Œä»–ä»¬ä¹Ÿæ— æ³•è§£å¯†å‡ºåŸå§‹ä¿¡æ¯ï¼Œä»è€Œä¿éšœäº†æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h4 id="aesctrparams-length" tabindex="-1"><a class="header-anchor" href="#aesctrparams-length"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aesctrparamslength" target="_blank" rel="noopener noreferrer">aesCtrParams.length</a></span></a></h4><p>Node.js ä¸­çš„ <code>aesCtrParams.length</code> æ˜¯ä¸ Web Crypto API ç›¸å…³çš„ä¸€ä¸ªå…·ä½“å±æ€§ï¼Œå®ƒç”¨äºå®šä¹‰åœ¨ä½¿ç”¨ AES-CTRï¼ˆAdvanced Encryption Standard in Counter modeï¼‰åŠ å¯†ç®—æ³•æ—¶ï¼Œè®¡æ•°å™¨ï¼ˆcounterï¼‰æ‰€ç”¨çš„ä½é•¿åº¦ã€‚ä¸ºäº†ä½¿è¿™ä¸ªæ¦‚å¿µæ›´æ¸…æ™°æ˜“æ‡‚ï¼Œæˆ‘ä¼šå…ˆè§£é‡Šä¸€ä¸‹ç›¸å…³çš„å‡ ä¸ªæ¦‚å¿µï¼Œç„¶åé€šè¿‡å®é™…ä¾‹å­æ¥è¯´æ˜å…¶åº”ç”¨ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-2"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ol><li><p><strong>AES (Advanced Encryption Standard)</strong>: ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ ‡å‡†ï¼Œæ„å‘³ç€åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„ç§˜é’¥ã€‚</p></li><li><p><strong>CTR (Counter) æ¨¡å¼</strong>: åŠ å¯†æ¨¡å¼ä¹‹ä¸€ï¼Œå°†æ˜æ–‡åˆ†æˆå—ï¼Œå¹¶ä¸ºæ¯ä¸ªæ˜æ–‡å—ç”Ÿæˆä¸€ä¸ªæ–°çš„è®¡æ•°å™¨å€¼ï¼Œç„¶åå°†è¯¥è®¡æ•°å™¨å€¼åŠ å¯†å¹¶ä¸æ˜æ–‡å—è¿›è¡Œå¼‚æˆ–æ“ä½œä»¥äº§ç”Ÿå¯†æ–‡ã€‚ç”±äºæ¯ä¸ªå—ä½¿ç”¨ä¸åŒçš„è®¡æ•°å™¨å€¼ï¼Œå³ä¾¿æ˜¯ç›¸åŒçš„æ˜æ–‡å—ä¹Ÿä¼šç”Ÿæˆä¸åŒçš„å¯†æ–‡å—ã€‚</p></li><li><p><strong><code>aesCtrParams</code></strong>: åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œå½“ä½ é€‰æ‹©ä½¿ç”¨ AES-CTR æ¨¡å¼åŠ å¯†æ•°æ®æ—¶ï¼Œ<code>aesCtrParams</code> æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒæŒ‡å®šäº†åŠ å¯†æ“ä½œçš„ä¸€äº›å‚æ•°ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><code>name</code>: åŠ å¯†ç®—æ³•çš„åç§°ï¼Œè¿™é‡Œæ˜¯ <code>&quot;AES-CTR&quot;</code>.</li><li><code>length</code>: è®¡æ•°å™¨çš„é•¿åº¦ï¼Œå•ä½æ˜¯ä½ï¼ˆbitsï¼‰ã€‚è¿™ä¸ªå€¼å†³å®šäº†è®¡æ•°å™¨å ç”¨çš„ç©ºé—´å¤§å°ï¼Œå¸¸è§çš„å€¼æœ‰ 64 æˆ– 128 ä½ã€‚</li></ul></li></ol><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†ç”¨æˆ·ä¿¡æ¯çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å†³å®šä½¿ç”¨ AES-CTR æ¨¡å¼è¿›è¡ŒåŠ å¯†ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­æ‰§è¡Œæ­¤æ“ä½œçš„ç®€åŒ–ä¾‹ç¨‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> counter</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»º AES-CTR åŠ å¯†ç®—æ³•çš„å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> algorithmParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CTR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 128</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è®¡æ•°å™¨é•¿åº¦è®¾ç½®ä¸º 128 ä½</span></span>
<span class="line"><span style="color:#D8DEE9;">    counter</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æä¾›ä¸€ä¸ªåˆå§‹åŒ–è®¡æ•°å™¨</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨æä¾›çš„é”®å’Œç®—æ³•å‚æ•°åˆ›å»º Cipher å®ä¾‹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Cipher</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">AES-CTR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> algorithmParams</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¤ºä¾‹ï¼šä½¿ç”¨ç‰¹å®šçš„å¯†é’¥å’Œè®¡æ•°å™¨åŠ å¯†æ–‡æœ¬</span></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // AES-CTR éœ€è¦çš„å¯†é’¥é•¿åº¦å¯ä»¥æ˜¯ 16, 24 æˆ– 32 å­—èŠ‚</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> counter</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // åˆå§‹åŒ–è®¡æ•°å™¨, é•¿åº¦ä¸ç®—æ³•å‚æ•°ä¸­çš„lengthæœ‰å…³</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¾…åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> counter</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Encrypted Data: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ AES-CTR æ¨¡å¼å’ŒæŒ‡å®šçš„è®¡æ•°å™¨é•¿åº¦æ¥åŠ å¯†ä¸€æ®µæ–‡æœ¬ã€‚æ³¨æ„ï¼šå®é™…å¼€å‘ä¸­ï¼Œå¯†é’¥å’Œè®¡æ•°å™¨éœ€è¦å®‰å…¨åœ°ç”Ÿæˆå’Œå­˜å‚¨ï¼Œç¡®ä¿æ•°æ®åŠ å¯†çš„å®‰å…¨æ€§ã€‚</p><h3 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h3><p><code>aesCtrParams.length</code> åœ¨ Node.js çš„ Web Crypto API ä¸­å®šä¹‰äº†ä½¿ç”¨ AES-CTR æ¨¡å¼è¿›è¡ŒåŠ å¯†æ—¶è®¡æ•°å™¨ï¼ˆcounterï¼‰çš„ä½é•¿åº¦ã€‚åˆç†é€‰æ‹©é•¿åº¦èƒ½å¤Ÿä¿éšœåŠ å¯†è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚ä½¿ç”¨ AES-CTR æ¨¡å¼å¯ä»¥æœ‰æ•ˆåŠ å¯†æ•°æ®ï¼Œä½†åŠ¡å¿…æ³¨æ„å®‰å…¨åœ°å¤„ç†å¯†é’¥å’Œè®¡æ•°å™¨ã€‚</p><h4 id="aesctrparams-name" tabindex="-1"><a class="header-anchor" href="#aesctrparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aesctrparamsname" target="_blank" rel="noopener noreferrer">aesCtrParams.name</a></span></a></h4><p>Node.js v21.7.1 ä¸­çš„<code>aesCtrParams.name</code>æ˜¯æŒ‡åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œ AES-CTRï¼ˆAdvanced Encryption Standard in Counter modeï¼‰åŠ å¯†ç®—æ³•æ—¶ï¼Œå‚æ•°å¯¹è±¡<code>AesCtrParams</code>ä¸­å¿…é¡»æŒ‡å®šçš„ä¸€ä¸ªå±æ€§ã€‚è¿™ä¸ªå±æ€§ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å‘Šè¯‰åŠ å¯†å‡½æ•°æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯å“ªä¸€ç§åŠ å¯†ç®—æ³•ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>name</code>çš„å€¼åº”è¯¥æ˜¯<code>&quot;AES-CTR&quot;</code>ï¼Œè¡¨ç¤ºæˆ‘ä»¬å°†ä½¿ç”¨ CTR æ¨¡å¼çš„ AES åŠ å¯†ã€‚</p><h3 id="ç†è§£-aes-ctr-åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#ç†è§£-aes-ctr-åŠ å¯†"><span>ç†è§£ AES-CTR åŠ å¯†</span></a></h3><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£<code>aesCtrParams.name</code>ï¼Œè®©æˆ‘ä»¬é¦–å…ˆå¿«é€Ÿäº†è§£ä¸€ä¸‹ AES-CTR åŠ å¯†ï¼š</p><ul><li><strong>AES</strong>ï¼šé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å¯¹ç§°æ„å‘³ç€å®ƒä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</li><li><strong>CTR æ¨¡å¼</strong>ï¼šè®¡æ•°å™¨æ¨¡å¼ï¼Œæ˜¯ä¸€ç§åŠ å¯†æ¨¡å¼ï¼Œä½¿å¾— AES ç­‰å¯¹ç§°åŠ å¯†ç®—æ³•å¯ä»¥åƒæµåŠ å¯†é‚£æ ·å·¥ä½œã€‚åœ¨ CTR æ¨¡å¼ä¸‹ï¼ŒåŠ å¯†çš„è¾“å‡ºä¸ç›´æ¥ä¾èµ–äºæ˜æ–‡ï¼Œè€Œæ˜¯å°†æ˜æ–‡ä¸ä¸€ä¸ªé€’å¢çš„è®¡æ•°å™¨åŠ å¯†åçš„ç»“æœè¿›è¡Œå¼‚æˆ–æ“ä½œä»¥äº§ç”Ÿå¯†æ–‡ã€‚</li></ul><h3 id="ä¸¾ä¸ªä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¸ªä¾‹å­"><span>ä¸¾ä¸ªä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦å®‰å…¨åœ°ä¼ è¾“ç”¨æˆ·æ•°æ®ã€‚ä½ å†³å®šä½¿ç”¨ AES-CTR åŠ å¯†ç®—æ³•æ¥ä¿è¯æ•°æ®çš„æœºå¯†æ€§ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ Web Crypto API è¿›è¡ŒåŠ å¯†çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> counter</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†å­—ç¬¦ä¸²æ•°æ®è½¬æ¢ä¸ºArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> dataBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰AES-CTRçš„å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> aesCtrParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CTR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨AES-CTRåŠ å¯†ç®—æ³•</span></span>
<span class="line"><span style="color:#D8DEE9;">    counter</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡/è®¡æ•°å™¨ï¼ˆ16å­—èŠ‚ï¼‰</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 64</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è®¡æ•°å™¨çš„é•¿åº¦ï¼ˆä½ï¼‰ï¼Œå¯é€‰64æˆ–128</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨æä¾›çš„å¯†é’¥å’Œå‚æ•°åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    aesCtrParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    dataBuffer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿”å›åŠ å¯†åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¤ºä¾‹ä½¿ç”¨</span></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æœ‰ä¸€ä¸ªç”¨äºåŠ å¯†çš„å¯†é’¥ï¼ˆé€šå¸¸ä½ éœ€è¦å®‰å…¨åœ°ç”Ÿæˆå’Œå­˜å‚¨è¿™ä¸ªå¯†é’¥ï¼‰</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-CTR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> counter</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç”Ÿæˆéšæœºè®¡æ•°å™¨</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, Node.js encryption!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // éœ€è¦åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> counter</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Encrypted Data:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>aesCtrParams.name</code>å°±æ˜¯æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„éƒ¨åˆ†ï¼Œå®ƒæŒ‡ç¤º<code>encrypt</code>æ–¹æ³•ä½¿ç”¨ AES-CTR ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚æˆ‘ä»¬æä¾›äº†æ•°æ®ã€å¯†é’¥å’Œ CTR æ¨¡å¼æ‰€éœ€çš„è®¡æ•°å™¨ï¼Œä»¥å®ŒæˆåŠ å¯†è¿‡ç¨‹ã€‚è¿™åªæ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½è¿˜éœ€è¦æ¶‰åŠå¯†é’¥ç®¡ç†ã€é”™è¯¯å¤„ç†ç­‰å¤æ‚æƒ…å†µã€‚</p><h3 id="class-aesgcmparams" tabindex="-1"><a class="header-anchor" href="#class-aesgcmparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-aesgcmparams" target="_blank" rel="noopener noreferrer">Class: AesGcmParams</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>AesGcmParams</code>ç±»æ˜¯ä¸ Web åŠ å¯† API ç›¸å…³çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚è¿™ä¸ªç±»ä¸»è¦ç”¨äºæŒ‡å®šä½¿ç”¨ AES-GCM æ¨¡å¼è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†æ“ä½œæ—¶æ‰€éœ€çš„å‚æ•°ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯ AES-GCM?</strong></p><p>AES-GCM æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå®ƒå°†é«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆAESï¼‰ä¸ä¼½ç½—ç“¦/è®¡æ•°å™¨æ¨¡å¼ï¼ˆGCMï¼‰ç»“åˆèµ·æ¥ã€‚è¿™ç§ç»„åˆæä¾›äº†ä¸€ç§æ—¢å®‰å…¨åˆé«˜æ•ˆçš„æ–¹å¼æ¥åŠ å¯†æ•°æ®ï¼Œå¹¶ä¸”è¿˜æä¾›äº†æ¶ˆæ¯è®¤è¯åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥ä¿æŠ¤æ•°æ®ä¸è¢«ç¯¡æ”¹ã€‚</p><p><strong>AesGcmParams ç±»</strong></p><p>å½“ä½ æƒ³è¦ä½¿ç”¨ AES-GCM æ¨¡å¼è¿›è¡Œæ•°æ®åŠ å¯†æˆ–è§£å¯†æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª<code>AesGcmParams</code>å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†æ‰§è¡Œè¿™äº›æ“ä½œæ‰€å¿…é¡»çš„å„ç§å‚æ•°ã€‚æ ¹æ® Node.js v21.7.1 æ–‡æ¡£ï¼Œ<code>AesGcmParams</code>ç±»è‡³å°‘éœ€è¦ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><strong>name</strong>: è¿™é‡Œåº”è¯¥æ˜¯&quot;AES-GCM&quot;ï¼Œè¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ AES-GCM æ¨¡å¼ã€‚</li><li><strong>iv</strong>: åˆå§‹åŒ–å‘é‡ï¼ˆInitialization Vectorï¼‰ï¼Œç”¨äºç¡®ä¿ç›¸åŒçš„æ˜æ–‡åœ¨æ¯æ¬¡åŠ å¯†æ—¶ç”Ÿæˆä¸åŒçš„å¯†æ–‡ï¼Œä»¥å¢å¼ºå®‰å…¨æ€§ã€‚è¿™åº”è¯¥æ˜¯ä¸€ä¸ªç±»å‹ä¸º<code>Buffer</code>ã€<code>TypedArray</code>æˆ–<code>DataView</code>çš„å¯¹è±¡ã€‚</li><li><strong>additionalData</strong> (å¯é€‰): ä¸€ä¸ªç±»å‹ä¸º<code>Buffer</code>ã€<code>TypedArray</code>æˆ–<code>DataView</code>çš„å¯¹è±¡ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ•°æ®ï¼Œåœ¨åŠ å¯†è¿‡ç¨‹ä¸­ä¸ä¼šè¢«åŠ å¯†ï¼Œä½†ä¼šè¢«ç”¨äºè®¤è¯æ ‡ç­¾çš„ç”Ÿæˆï¼Œä»è€Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚</li><li><strong>tagLength</strong> (å¯é€‰): è®¤è¯æ ‡ç­¾çš„é•¿åº¦ã€‚è¿™æ˜¯ä¸€ä¸ªè¡¨ç¤ºä½æ•°çš„æ•°å­—ï¼Œå¸¸è§å€¼æœ‰ 128ã€120ã€112ã€104 å’Œ 96 ç­‰ã€‚</li></ul><p><strong>å®é™…è¿ç”¨ç¤ºä¾‹</strong></p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“æ•æ„Ÿä¿¡æ¯çš„åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥ä½¿ç”¨ AES-GCM æ¨¡å¼æ¥åŠ å¯†è¿™äº›ä¿¡æ¯ï¼Œä»¥ç¡®ä¿å³ä½¿æœ‰äººæˆªè·äº†è¿™äº›æ•°æ®ï¼Œä»–ä»¬ä¹Ÿæ— æ³•ç†è§£å…¶å†…å®¹ã€‚åŒæ—¶ï¼Œé€šè¿‡éªŒè¯è®¤è¯æ ‡ç­¾ï¼Œä½ å¯ä»¥ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node:crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨AES-GCMå‚æ•°é…ç½®è¿›è¡ŒåŠ å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    tagLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 128</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    tagLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 128</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> decodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> decodedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ `key` å’Œ `iv` å·²ç»é€šè¿‡æŸç§å®‰å…¨æ–¹å¼ç”Ÿæˆå¹¶å…±äº«äº†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°ï¼š<code>encryptData</code>å’Œ<code>decryptData</code>ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŒ…å« AES-GCM æ¨¡å¼åŠå…¶å¿…è¦å‚æ•°çš„ algorithm å¯¹è±¡ã€‚ç„¶åï¼Œä½¿ç”¨<code>subtle.encrypt</code>å’Œ<code>subtle.decrypt</code>æ–¹æ³•æ¥å¤„ç†æ•°æ®ï¼Œå…¶ä¸­<code>subtle</code>æ˜¯ Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ï¼ŒNode.js ä¹Ÿæ”¯æŒè¿™ä¸€ APIã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºä¸­ä¼ è¾“çš„æ•æ„Ÿä¿¡æ¯å¾—åˆ°æœ‰æ•ˆä¿æŠ¤ã€‚</p><h4 id="aesgcmparams-additionaldata" tabindex="-1"><a class="header-anchor" href="#aesgcmparams-additionaldata"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aesgcmparamsadditionaldata" target="_blank" rel="noopener noreferrer">aesGcmParams.additionalData</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„åŠ å¯†ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°<code>aesGcmParams.additionalData</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è°ˆè®ºä¸€ç§ç‰¹æ®Šçš„æ•°æ®åŠ å¯†æ–¹å¼ã€‚è®©æˆ‘æ¥é€æ­¥è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼Œä»¥ä¾¿ä½ èƒ½æ›´å¥½åœ°ç†è§£å®ƒã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-3"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œ<code>AES-GCM</code>æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå®ƒæä¾›äº†åŒæ—¶å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼ˆä¿è¯æ•°æ®çš„æœºå¯†æ€§ï¼‰å’Œè®¤è¯ï¼ˆä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼‰ã€‚åœ¨ä½¿ç”¨<code>AES-GCM</code>è¿›è¡Œæ•°æ®åŠ å¯†æ—¶ï¼Œæœ‰ä¸€ä¸ªå‚æ•°å«åš<code>aesGcmParams.additionalData</code>ï¼ˆæˆ–ç§°ä¸º ADï¼‰ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€äº›é¢å¤–çš„æ•°æ®ä¸è¢«åŠ å¯†ï¼Œä½†æ˜¯ä¼šè¢«ç”¨æ¥å¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h3 id="aesgcmparams-additionaldata-1" tabindex="-1"><a class="header-anchor" href="#aesgcmparams-additionaldata-1"><span><code>aesGcmParams.additionalData</code></span></a></h3><ul><li><p><strong>å®šä¹‰</strong>ï¼š<code>additionalData</code>æ˜¯ä¸€æ®µé¢å¤–çš„æ•°æ®ï¼Œå®ƒåœ¨åŠ å¯†è¿‡ç¨‹ä¸­ä¸ä¼šè¢«åŠ å¯†ï¼Œä½†æ˜¯å®ƒçš„å“ˆå¸Œå€¼ä¼šè¢«è®¡ç®—å¹¶ä¸”ä¸å¯†æ–‡ä¸€èµ·å­˜å‚¨ã€‚åœ¨è§£å¯†è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªå“ˆå¸Œå€¼ä¼šè¢«éªŒè¯ï¼Œå¦‚æœåŒ¹é…åˆ™è§£å¯†æ“ä½œç»§ç»­ï¼Œå¦åˆ™è§£å¯†å¤±è´¥ã€‚è¿™æ ·å°±å¯ä»¥ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p></li><li><p><strong>ç”¨å¤„</strong>ï¼šå®ƒç”¨äºå¢åŠ æ¶ˆæ¯çš„çœŸå®æ€§éªŒè¯ï¼Œè€Œä¸ç›´æ¥å½±å“æ¶ˆæ¯å†…å®¹çš„åŠ å¯†ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå¸®åŠ©ç¡®å®šä¼ è¾“çš„æ•°æ®åœ¨å‘é€å’Œæ¥æ”¶ç«¯ä¿æŒä¸€è‡´ï¼Œæœªè¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-11"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåœ¨çº¿æ”¯ä»˜ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¯ä»¥å‘å…¶ä»–ç”¨æˆ·è½¬è´¦ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¿è¯äº¤æ˜“ä¿¡æ¯çš„å®‰å…¨éå¸¸é‡è¦ã€‚</p><ol><li><p><strong>å»ºç«‹ä¿¡ä»»</strong>ï¼šå½“ Alice æƒ³è¦å‘ Bob å‘é€ä¸€ç¬”åŠ å¯†çš„èµ„é‡‘æ—¶ï¼Œå¥¹å¯èƒ½ä¼šä½¿ç”¨<code>AES-GCM</code>æ¨¡å¼è¿›è¡ŒåŠ å¯†ã€‚åœ¨è¿™é‡Œï¼Œ<code>additionalData</code>å¯ä»¥åŒ…å«äº¤æ˜“çš„æŸäº›è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚äº¤æ˜“ IDã€æ—¶é—´æˆ³ç­‰ï¼Œè¿™äº›ä¿¡æ¯è™½ç„¶ä¸éœ€è¦åŠ å¯†ï¼Œä½†æ˜¯å¯¹ç¡®ä¿äº¤æ˜“çš„å®Œæ•´æ€§å¾ˆé‡è¦ã€‚</p></li><li><p><strong>åŠ å¯†è¿‡ç¨‹</strong>ï¼šAlice åœ¨åŠ å¯†å¥¹çš„æ¶ˆæ¯ï¼ˆä¾‹å¦‚ï¼šâ€œç»™ Bob è½¬è´¦ 100 ç¾å…ƒâ€ï¼‰æ—¶ï¼Œå°†äº¤æ˜“ ID å’Œæ—¶é—´æˆ³ä½œä¸º<code>additionalData</code>è¾“å…¥ã€‚è¿™äº›æ•°æ®ä¸ä¼šè¢«åŠ å¯†ï¼Œä½†ä¼šå‚ä¸åˆ°åŠ å¯†éªŒè¯è¿‡ç¨‹ä¸­ã€‚</p></li><li><p><strong>éªŒè¯å’Œè§£å¯†</strong>ï¼šBob æ”¶åˆ°æ¶ˆæ¯åï¼Œä»–çš„ç³»ç»Ÿä¼šé¦–å…ˆéªŒè¯<code>additionalData</code>çš„çœŸå®æ€§ï¼ˆæ˜¯å¦è¢«ç¯¡æ”¹ï¼‰ã€‚åªæœ‰éªŒè¯é€šè¿‡ä¹‹åï¼Œä»–æ‰èƒ½æ­£ç¡®è§£å¯†å¾—åˆ°æ¶ˆæ¯å†…å®¹ã€‚å¦‚æœæœ‰äººè¯•å›¾ä¿®æ”¹äº†æ¶ˆæ¯æˆ–<code>additionalData</code>ï¼Œç³»ç»Ÿä¼šæ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼Œä»è€Œæ‹’ç»è§£å¯†ï¼Œä¿æŠ¤äº†äº¤æ˜“çš„å®‰å…¨æ€§ã€‚</p></li><li><p><strong>å®‰å…¨ä¿éšœ</strong>ï¼šå³ä½¿æ”»å‡»è€…æˆªå–äº†åŠ å¯†çš„æ¶ˆæ¯ï¼Œç”±äºä»–ä»¬æ²¡æœ‰æ­£ç¡®çš„<code>additionalData</code>ï¼Œä»–ä»¬ä¹Ÿæ— æ³•æˆåŠŸä¼ªé€ æ¶ˆæ¯ä½¿ä¹‹é€šè¿‡éªŒè¯ã€‚</p></li></ol><p>é€šè¿‡è¿™ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>aesGcmParams.additionalData</code>åœ¨å®é™…åº”ç”¨ä¸­å¦‚ä½•å¢åŠ äº†æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ä¿è¯æ•°æ®å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„åœºæ™¯ä¸‹ã€‚å®ƒæ˜¯<code>AES-GCM</code>åŠ å¯†æ¨¡å¼ä¸­ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ç§é¢å¤–çš„å®‰å…¨æªæ–½ï¼Œå¸®åŠ©é˜²æ­¢æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚</p><h4 id="aesgcmparams-iv" tabindex="-1"><a class="header-anchor" href="#aesgcmparams-iv"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aesgcmparamsiv" target="_blank" rel="noopener noreferrer">aesGcmParams.iv</a></span></a></h4><p>è¦ç†è§£<code>aesGcmParams.iv</code>ï¼Œé¦–å…ˆå¾—äº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚è¿™é‡Œé¢æ¶‰åŠåˆ°çš„æ¦‚å¿µæ˜¯åŠ å¯†ã€AES-GCMã€IVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰ã€‚æˆ‘ä¼šé€ä¸€è§£é‡Šè¿™äº›æ¦‚å¿µï¼Œå¹¶ç»™å‡ºåœ¨ Node.js ä¸­ä½¿ç”¨å®ƒä»¬çš„å®ä¾‹ã€‚</p><h3 id="åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#åŠ å¯†"><span>åŠ å¯†</span></a></h3><p>åŠ å¯†æ˜¯ä¿¡æ¯å®‰å…¨é¢†åŸŸçš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œå®ƒèƒ½å¤Ÿä¿æŠ¤æ•°æ®ä¸è¢«æœªæˆæƒè®¿é—®ã€‚ç®€å•æ¥è¯´ï¼ŒåŠ å¯†å°±æ˜¯å°†åŸå§‹æ•°æ®ï¼ˆæ˜æ–‡ï¼‰è½¬æ¢æˆä¸æ˜“è¯»çš„æ ¼å¼ï¼ˆå¯†æ–‡ï¼‰ï¼Œä»…æŒæœ‰å¯†é’¥çš„äººæ‰èƒ½å°†å…¶è§£å¯†å›åŸå§‹æ•°æ®ã€‚</p><h3 id="aes-gcm" tabindex="-1"><a class="header-anchor" href="#aes-gcm"><span>AES-GCM</span></a></h3><p>AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¯¹ç§°åŠ å¯†æ„å‘³ç€åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚GCMï¼ˆGalois/Counter Modeï¼‰æ˜¯ä¸€ç§è¿è¡Œæ¨¡å¼ï¼Œå®ƒä¸º AES æä¾›äº†åŠ å¯†å’Œæ¶ˆæ¯è®¤è¯åŠŸèƒ½ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒAES-GCM å¯ä»¥è®©ä½ åŠ å¯†æ•°æ®çš„åŒæ—¶ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><h3 id="iv-åˆå§‹åŒ–å‘é‡" tabindex="-1"><a class="header-anchor" href="#iv-åˆå§‹åŒ–å‘é‡"><span>IVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰</span></a></h3><p>IV æˆ–åˆå§‹åŒ–å‘é‡æ˜¯ AES-GCM åŠ å¯†ä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚å®ƒæ˜¯ä¸€æ®µéšæœºæ•°æ®ï¼Œç”¨äºä¸æ˜æ–‡ä¸€èµ·åŠ å¯†ï¼Œä»¥ç¡®ä¿å³ä½¿ç›¸åŒçš„æ•°æ®ï¼ˆæ˜æ–‡ï¼‰è¢«åŠ å¯†å¤šæ¬¡ï¼Œæ¯æ¬¡ç”Ÿæˆçš„å¯†æ–‡ä¹Ÿéƒ½ä¸åŒã€‚è¿™å¤§å¤§å¢å¼ºäº†åŠ å¯†æ–¹æ¡ˆçš„å®‰å…¨æ€§ã€‚IV åœ¨åŠ å¯†å’Œè§£å¯†æ—¶éƒ½å¿…é¡»ä½¿ç”¨ï¼Œä¸”åœ¨åŠ å¯†è¿‡ç¨‹ä¸­è¦ä¿è¯å…¶å”¯ä¸€æ€§ã€‚é€šå¸¸ï¼ŒIV å¹¶ä¸éœ€è¦ä¿å¯†ï¼Œä½†ä¸åº”é‡å¤ä½¿ç”¨åŒä¸€ä¸ª IV è¿›è¡Œå¤šæ¬¡åŠ å¯†ã€‚</p><h3 id="node-js-ä¸­çš„aesgcmparams-iv" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„aesgcmparams-iv"><span>Node.js ä¸­çš„<code>aesGcmParams.iv</code></span></a></h3><p>åœ¨ Node.jsï¼ˆç‰¹åˆ«æ˜¯ç‰ˆæœ¬ 21.7.1 åŠä»¥ä¸Šï¼‰çš„ Web Crypto API ä¸­ï¼Œ<code>aesGcmParams.iv</code>æŒ‡çš„æ˜¯è¿›è¡Œ AES-GCM åŠ å¯†æ“ä½œæ—¶æ‰€éœ€çš„åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ã€‚åœ¨åˆ›å»ºåŠ å¯†æˆ–è§£å¯†æ“ä½œæ—¶ï¼Œä½ éœ€è¦æŒ‡å®šä¸€ç³»åˆ—å‚æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬<code>iv</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æƒ³åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç æˆ–å‘é€åŠ å¯†æ¶ˆæ¯ï¼Œä½ å¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨ AES-GCM æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ Node.js Web Crypto API è¿›è¡ŒåŠ å¯†çš„ç¤ºä¾‹æ­¥éª¤ï¼š</p><p><strong>1. å¼•å…¥ crypto æ¨¡å—ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2. ç”Ÿæˆå¯†é’¥ï¼š</strong></p><p>å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªç”¨äº AES-GCM çš„å¯†é’¥ã€‚å¦‚æœæ²¡æœ‰ï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªã€‚</p><p><strong>3. è®¾å®š<code>aesGcmParams</code>ï¼ŒåŒ…æ‹¬<code>iv</code>ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> aesGcmParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // éšæœºç”Ÿæˆ12å­—èŠ‚çš„IV</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨<code>crypto.getRandomValues()</code>å‡½æ•°æ¥ç”Ÿæˆä¸€ä¸ªéšæœºçš„ IVã€‚æ³¨æ„ï¼Œå¯¹äº GCM æ¨¡å¼ï¼ŒIV é€šå¸¸æ˜¯ 12 å­—èŠ‚ï¼ˆ96 ä½ï¼‰é•¿ã€‚</p><p><strong>4. åŠ å¯†æ•°æ®ï¼š</strong></p><p>ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸Šè¿°å‚æ•°å’Œå¯†é’¥æ¥åŠ å¯†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    aesGcmParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">secretData</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡½æ•°å°†è¿”å›åŠ å¯†åçš„æ•°æ®ã€‚æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ è¿˜éœ€è¦å¤„ç†å¯†é’¥çš„å®‰å…¨å­˜å‚¨å’Œä¼ è¾“é—®é¢˜ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>aesGcmParams.iv</code>åœ¨ Node.js ä¸­ç”¨äºæŒ‡å®š AES-GCM åŠ å¯†æ“ä½œçš„åˆå§‹åŒ–å‘é‡ï¼Œè¿™å¯¹äºç¡®ä¿åŠ å¯†çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œä¾‹å­æœ‰åŠ©äºä½ ç†è§£è¿™ä¸€æ¦‚å¿µã€‚</p><h4 id="aesgcmparams-name" tabindex="-1"><a class="header-anchor" href="#aesgcmparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aesgcmparamsname" target="_blank" rel="noopener noreferrer">aesGcmParams.name</a></span></a></h4><p>äº†è§£ <code>aesGcmParams.name</code> åœ¨ Node.js v21.7.1 ä¸­ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“å‡ ä¸ªæ¦‚å¿µï¼šAESã€GCM å’Œ Web Crypto APIã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-1"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><strong>AES (Advanced Encryption Standard)</strong> æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ ‡å‡†ï¼Œæ„å‘³ç€åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„ç§˜é’¥ã€‚</li><li><strong>GCM (Galois/Counter Mode)</strong> æ˜¯ä¸€ç§æ“ä½œæ¨¡å¼ï¼Œç”¨äº AES ç­‰å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•ï¼Œæä¾›åŠ å¯†å’Œæ¶ˆæ¯è®¤è¯ï¼ˆä¹Ÿå°±æ˜¯åŒæ—¶ä¿è¯ä¿¡æ¯çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼‰ã€‚</li><li><strong>Web Crypto API</strong> æ˜¯ä¸€ä¸ªæ¶‰åŠåŠ å¯†åŠŸèƒ½çš„æµè§ˆå™¨ APIï¼ŒNode.js å®ç°äº†ç±»ä¼¼äºè¿™ä¸ªæµè§ˆå™¨ API çš„æ¥å£ï¼Œè®©åœ¨æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½å®ç°å®‰å…¨çš„åŠ å¯†åŠŸèƒ½ã€‚</li></ul><h3 id="aesgcmparams-name-1" tabindex="-1"><a class="header-anchor" href="#aesgcmparams-name-1"><span><a href="http://aesGcmParams.name" target="_blank" rel="noopener noreferrer">aesGcmParams.name</a></span></a></h3><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>aesGcmParams</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºé…ç½® AES-GCM åŠ å¯†æˆ–è§£å¯†æ“ä½œçš„è¯¦ç»†å‚æ•°ã€‚å…¶ä¸­ï¼Œ<code>.name</code> å±æ€§æ˜¯å¿…è¦çš„ï¼Œå¹¶ä¸”å®ƒçš„å€¼è¡¨ç¤ºåŠ å¯†ç®—æ³•çš„åç§°ï¼Œå¯¹äº AES-GCM æ¥è¯´ï¼Œè¿™ä¸ªå€¼åº”è¯¥æ˜¯ <code>&quot;AES-GCM&quot;</code>ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨</span></a></h3><p>å½“ä½ æƒ³è¦è¿›è¡Œ AES-GCM åŠ å¯†æˆ–è§£å¯†æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«ç‰¹å®šå‚æ•°çš„ <code>AesGcmParams</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è‡³å°‘åŒ…æ‹¬ï¼š</p><ul><li><code>name</code>: åŠ å¯†ç®—æ³•çš„åç§°ï¼Œå³ <code>&quot;AES-GCM&quot;</code>ã€‚</li><li>å…¶ä»–å‚æ•°å¦‚ <code>iv</code>ï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰ï¼Œå¯èƒ½è¿˜æœ‰ <code>additionalData</code>ï¼ˆé™„åŠ æ•°æ®ï¼Œç”¨äºè®¤è¯ä½†ä¸åŠ å¯†ï¼‰å’Œ <code>tagLength</code>ï¼ˆè®¤è¯æ ‡ç­¾çš„é•¿åº¦ï¼‰ç­‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-12"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ AES-GCM æ¥åŠ å¯†è¿™äº›ä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æœ‰ä¸€ä¸ªç§˜é’¥å’Œä¸€äº›æ•æ„Ÿæ•°æ®éœ€è¦åŠ å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç§˜é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> dataToEncrypt</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">éå¸¸æ•æ„Ÿçš„ä¿¡æ¯</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åˆå§‹åŒ–å‘é‡åº”è¯¥æ˜¯éšæœºçš„ï¼Œæ¯æ¬¡åŠ å¯†éƒ½å”¯ä¸€</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#616E88;">    // å¯é€‰å‚æ•°ï¼Œå¦‚ additionalData å’Œ tagLength</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#D8DEE9;">  secretKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  dataToEncrypt</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">åŠ å¯†åçš„æ•°æ®:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ç”Ÿæˆä¸€ä¸ª AES-GCM å¯†é’¥ï¼Œç„¶åä½¿ç”¨è¯¥å¯†é’¥å’Œéšæœºåˆå§‹åŒ–å‘é‡æ¥åŠ å¯†ä¸€æ®µæ•°æ®ã€‚åœ¨çœŸå®åº”ç”¨ä¸­ï¼Œä½ è¿˜éœ€è¦å¦¥å–„å¤„ç†å’Œå­˜å‚¨è¿™äº›åŠ å¯†çš„æ•°æ®å’Œç§˜é’¥ï¼Œä»¥åŠç¡®ä¿åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰çš„éšæœºæ€§å’Œå”¯ä¸€æ€§ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šä»¥åŠä¾‹å­èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£ Node.js ä¸­ <code>aesGcmParams.name</code> çš„ä½œç”¨å’Œå¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ AES-GCM åŠ å¯†æ–¹å¼ï¼</p><h4 id="aesgcmparams-taglength" tabindex="-1"><a class="header-anchor" href="#aesgcmparams-taglength"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aesgcmparamstaglength" target="_blank" rel="noopener noreferrer">aesGcmParams.tagLength</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®ºåˆ° Node.js ä¸­çš„<code>aesGcmParams.tagLength</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä½¿ç”¨ Web åŠ å¯† API è¿›è¡Œ AES-GCMï¼ˆé«˜çº§åŠ å¯†æ ‡å‡† - Galois/è®¡æ•°å™¨æ¨¡å¼ï¼‰åŠ å¯†æ—¶ï¼Œç›¸å…³å‚æ•°çš„ä¸€ä¸ªç‰¹å®šè®¾ç½®ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>tagLength</code>æŒ‡çš„æ˜¯åŠ å¯†åç”Ÿæˆçš„è®¤è¯æ ‡ç­¾ï¼ˆauthentication tagï¼‰çš„é•¿åº¦ã€‚è¿™ä¸ªæ ‡ç­¾ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“æˆ–å­˜å‚¨è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-4" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-4"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ul><li><strong>AES-GCM</strong>: ä¸€ç§åŒæ—¶æä¾›æ•°æ®åŠ å¯†å’Œå®Œæ•´æ€§éªŒè¯çš„åŠ å¯†æ–¹å¼ã€‚</li><li><strong>è®¤è¯æ ‡ç­¾ï¼ˆAuthentication Tagï¼‰</strong>: éšç€åŠ å¯†åçš„æ•°æ®ä¸€èµ·ç”Ÿæˆå’Œä¼ è¾“çš„ä¸€å°æ®µæ•°æ®ï¼Œç”¨äºæ¥æ”¶æ–¹éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</li></ul><h3 id="taglength" tabindex="-1"><a class="header-anchor" href="#taglength"><span><code>tagLength</code></span></a></h3><ul><li><code>tagLength</code>è¡¨ç¤ºè®¤è¯æ ‡ç­¾çš„ä½é•¿åº¦ï¼ˆbitï¼‰ã€‚åœ¨ AES-GCM åŠ å¯†ä¸­ï¼Œå…è®¸çš„<code>tagLength</code>å€¼é€šå¸¸ä¸º 128, 120, 112, 104, æˆ– 96 ä½ï¼Œæœ‰æ—¶å€™å¯¹äºç‰¹æ®Šåº”ç”¨ä¹Ÿå¯ä»¥æ”¯æŒ 64 æˆ– 32 ä½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ‡ç­¾è¶Šé•¿ï¼Œæä¾›çš„å®‰å…¨æ€§è¶Šå¥½ï¼Œä½†åŒæ—¶ä¼šå¢åŠ ä¸€äº›é¢å¤–çš„æ•°æ®è´Ÿè½½ã€‚</li><li>åœ¨ Node.js çš„ Web åŠ å¯† API ä¸­è®¾ç½®<code>aesGcmParams</code>å¯¹è±¡çš„<code>tagLength</code>å±æ€§ï¼Œå°±æ˜¯åœ¨å‘Šè¯‰åŠ å¯†ç®—æ³•ä½ å¸Œæœ›ç”Ÿæˆçš„è®¤è¯æ ‡ç­¾åº”è¯¥æœ‰å¤šé•¿ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ï¼Œéœ€è¦ç¡®ä¿ä¼ è¾“çš„æ¶ˆæ¯åœ¨ä¸è¢«æœªæˆæƒç”¨æˆ·è¯»å–çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><ol><li><p><strong>åŠ å¯†æ¶ˆæ¯</strong>ï¼š</p><p>åœ¨å‘é€ç«¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ AES-GCM æ¨¡å¼æ¥åŠ å¯†æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šä¸€ä¸ª<code>tagLength</code>ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹© 128 ä½çš„<code>tagLength</code>æ„å‘³ç€æ¯æ¡åŠ å¯†çš„æ¶ˆæ¯éƒ½ä¼šé™„å¸¦ä¸€ä¸ª 128 ä½é•¿çš„è®¤è¯æ ‡ç­¾ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedContent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // éšæœºåˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#88C0D0;">      tagLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 128</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è®¤è¯æ ‡ç­¾çš„ä½é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedContent</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>éªŒè¯å¹¶è§£å¯†æ¶ˆæ¯</strong>ï¼š</p><p>åœ¨æ¥æ”¶ç«¯ï¼Œä½ å°†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰æ¥è§£å¯†æ¶ˆæ¯ï¼ŒåŒæ—¶æ£€æŸ¥è®¤è¯æ ‡ç­¾ä»¥ç¡®è®¤æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedContent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">iv</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯¹åº”åŠ å¯†æ—¶ä½¿ç”¨çš„åˆå§‹åŒ–å‘é‡</span></span>
<span class="line"><span style="color:#88C0D0;">      tagLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 128</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åŒæ ·çš„è®¤è¯æ ‡ç­¾ä½é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ciphertext</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> decoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedContent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ä¸º<code>aesGcmParams</code>å¯¹è±¡æŒ‡å®š<code>tagLength</code>ï¼Œä½ èƒ½å¤Ÿä¿æŠ¤é€šè®¯å†…å®¹çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒåŠ¡å¿…ç¡®ä¿ä½¿ç”¨å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆåˆå§‹åŒ–å‘é‡ï¼Œä¸”æ¯æ¬¡åŠ å¯†æ“ä½œéƒ½ä¸è¦é‡å¤ä½¿ç”¨ç›¸åŒçš„ IVã€‚</p><h3 id="class-aeskeygenparams" tabindex="-1"><a class="header-anchor" href="#class-aeskeygenparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-aeskeygenparams" target="_blank" rel="noopener noreferrer">Class: AesKeyGenParams</a></span></a></h3><p>Node.js ä¸­çš„ <code>AesKeyGenParams</code> æ˜¯ä¸ Web Crypto API ç›¸å…³çš„ä¸€ä¸ªç±»ï¼Œä¸“é—¨ç”¨äºç”Ÿæˆ AESï¼ˆAdvanced Encryption Standardï¼‰å¯†é’¥çš„å‚æ•°ã€‚åœ¨ç½‘ç»œå®‰å…¨é¢†åŸŸï¼ŒAES æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå®ƒä»¥å…¶é«˜æ•ˆå’Œå®‰å…¨æ€§è€Œè‘—åã€‚å¯¹ç§°åŠ å¯†æ„å‘³ç€åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚</p><h3 id="aeskeygenparams-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#aeskeygenparams-ç®€ä»‹"><span>AesKeyGenParams ç®€ä»‹</span></a></h3><p>å½“ä½ æƒ³è¦ç”Ÿæˆä¸€ä¸ª AES å¯†é’¥æ—¶ï¼Œä½ éœ€è¦æä¾›ä¸€äº›å…·ä½“çš„å‚æ•°ç»™åŠ å¯†ç®—æ³•ï¼Œè¿™å°±æ˜¯ <code>AesKeyGenParams</code> ç±»çš„ç”¨é€”ã€‚è¿™ä¸ªç±»å‘Šè¯‰åŠ å¯†ç®—æ³•å¦‚ä½•ç”Ÿæˆå¯†é’¥ã€‚æœ€ä¸»è¦çš„å‚æ•°åŒ…æ‹¬ï¼š</p><ul><li><code>name</code>: è¿™ä¸ªå±æ€§æŒ‡å®šäº†å°†è¦ä½¿ç”¨çš„åŠ å¯†ç®—æ³•åç§°ï¼Œå¯¹äº AES å¯†é’¥ç”Ÿæˆï¼Œè¿™ä¸ªå€¼åº”è¯¥è®¾ç½®ä¸º <code>&quot;AES-CBC&quot;</code>, <code>&quot;AES-GCM&quot;</code> æˆ–å…¶ä»– AES å˜ä½“ã€‚</li><li><code>length</code>: è¿™ä¸ªå±æ€§å†³å®šäº†ç”Ÿæˆå¯†é’¥çš„ä½é•¿åº¦ï¼Œå¸¸è§çš„é•¿åº¦æœ‰ 128ã€192 å’Œ 256 ä½ã€‚ä¸åŒçš„é•¿åº¦æä¾›äº†ä¸åŒçº§åˆ«çš„å®‰å…¨æ€§ï¼Œå…¶ä¸­ 256 ä½æä¾›æœ€å¼ºçš„å®‰å…¨æ€§ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-13"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ç”Ÿæˆ-aes-å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#ç”Ÿæˆ-aes-å¯†é’¥"><span>ç”Ÿæˆ AES å¯†é’¥</span></a></h4><p>å‡è®¾æˆ‘ä»¬è¦åœ¨ä¸€ä¸ª Node.js åº”ç”¨ä¸­ç”Ÿæˆä¸€ä¸ª 256 ä½çš„ AES å¯†é’¥ç”¨äº <code>&quot;AES-GCM&quot;</code> æ¨¡å¼ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ° Node.js çš„ <code>crypto.webcrypto</code> APIã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateAESKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦ä¸º 256 ä½</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">      keyGenParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// ç”¨é€”ï¼šåŠ å¯†å’Œè§£å¯†</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥ç”Ÿæˆå¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateAESKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">AES Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä» <code>crypto</code> æ¨¡å—ä¸­å¯¼å…¥äº† <code>webcrypto</code> å¯¹è±¡ï¼Œå¹¶é€šè¿‡å®ƒè®¿é—®äº† <code>subtle</code> å±æ€§ã€‚<code>subtle</code> æä¾›äº†ä¸€ç³»åˆ—çš„åº•å±‚åŠ å¯†æ“ä½œï¼ŒåŒ…æ‹¬å¯†é’¥çš„ç”Ÿæˆã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>generateAESKey</code> æ¥ç”Ÿæˆå¯†é’¥ã€‚åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>subtle.generateKey</code> æ–¹æ³•ï¼Œä¼ é€’äº†æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ <code>keyGenParams</code> å‚æ•°å¯¹è±¡ï¼Œæ ‡è®°å¯†é’¥ä¸ºå¯å¯¼å‡ºï¼Œå¹¶æŒ‡å®šäº†å¯†é’¥å¯ä»¥ç”¨äºåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚æœ€ç»ˆï¼Œè¿™ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ªä»£è¡¨ AES å¯†é’¥çš„ Promise å¯¹è±¡ã€‚</p><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js åº”ç”¨ä¸­åˆ©ç”¨ <code>AesKeyGenParams</code> å’Œ Web Crypto API ç”Ÿæˆ AES å¯†é’¥ã€‚ç”Ÿæˆçš„å¯†é’¥å¯ä»¥ç”¨äºå¤šç§å®‰å…¨åœºæ™¯ï¼Œä¾‹å¦‚æ•°æ®åŠ å¯†å’Œè§£å¯†ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚</p><h4 id="aeskeygenparams-length" tabindex="-1"><a class="header-anchor" href="#aeskeygenparams-length"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aeskeygenparamslength" target="_blank" rel="noopener noreferrer">aesKeyGenParams.length</a></span></a></h4><p>Node.js ä¸­çš„<code>aesKeyGenParams.length</code>æ˜¯ç”¨äºæŒ‡å®šåœ¨ä½¿ç”¨ AES åŠ å¯†ç®—æ³•ç”Ÿæˆå¯†é’¥æ—¶å¯†é’¥çš„é•¿åº¦ã€‚AESï¼Œå…¨ç§°ä¸ºé«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆAdvanced Encryption Standardï¼‰ï¼Œæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¯¹ç§°åŠ å¯†æ„å‘³ç€åŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯†é’¥ã€‚åœ¨ Node.js çš„ Crypto æ¨¡å—ä¸­ï¼Œç‰¹åˆ«æ˜¯ Web Crypto API éƒ¨åˆ†ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°æ¥å®šä¹‰ä½ æƒ³è¦ç”Ÿæˆçš„å¯†é’¥çš„å¤§å°ã€‚</p><h3 id="aeskeygenparams-length-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#aeskeygenparams-length-çš„ä½œç”¨"><span>aesKeyGenParams.length çš„ä½œç”¨</span></a></h3><p>å½“ä½ åœ¨ Node.js ä¸­ä½¿ç”¨ Web Crypto API ç”Ÿæˆä¸€ä¸ª AES å¯†é’¥æ—¶ï¼Œä½ éœ€è¦é€šè¿‡<code>aesKeyGenParams</code>å¯¹è±¡æ¥æŒ‡æ˜ä¸€äº›ç”Ÿæˆè¿™ä¸ªå¯†é’¥æ‰€éœ€çš„å‚æ•°ã€‚å…¶ä¸­ï¼Œ<code>length</code>å±æ€§å°±æ˜¯ç”¨æ¥è®¾å®šå¯†é’¥çš„é•¿åº¦çš„ã€‚åœ¨ AES åŠ å¯†ä¸­ï¼Œé€šå¸¸æœ‰ä¸‰ç§ä¸åŒçš„å¯†é’¥é•¿åº¦å¯ä»¥é€‰æ‹©ï¼š</p><ul><li><strong>128 ä½</strong> (16 å­—èŠ‚)</li><li><strong>192 ä½</strong> (24 å­—èŠ‚)</li><li><strong>256 ä½</strong> (32 å­—èŠ‚)</li></ul><p>å¯†é’¥è¶Šé•¿ï¼Œç†è®ºä¸ŠåŠ å¯†å°±è¶Šå®‰å…¨ï¼Œä½†åŒæ—¶ä¼šæ¶ˆè€—æ›´å¤šçš„è®¡ç®—èµ„æºã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹-1"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æƒ³è¦ç”Ÿæˆä¸€ä¸ª 256 ä½çš„ AES å¯†é’¥ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å†™ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æŒ‡å®šä½¿ç”¨AESåŠ å¯†å’Œå¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿™é‡Œè®¾ç½®äº†å¯†é’¥é•¿åº¦ä¸º256ä½</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyParams</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">AES Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„<code>crypto</code>åº“çš„ Web Crypto API éƒ¨åˆ†ã€‚ç„¶åå®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°<code>generateKey</code>ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬è°ƒç”¨äº†<code>crypto.subtle.generateKey</code>æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚æˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ªé…ç½®å¯¹è±¡ç»™è¿™ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„åŠ å¯†ç®—æ³•<code>AES-GCM</code>å’Œæˆ‘ä»¬æƒ³è¦çš„å¯†é’¥é•¿åº¦<code>256</code>ä½ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå‡½æ•°å¹¶æ‰“å°å‡ºç”Ÿæˆçš„å¯†é’¥ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><p>AES åŠ å¯†åœ¨å¾ˆå¤šç°ä»£çš„ web åº”ç”¨å’Œè½¯ä»¶ä¸­éƒ½éå¸¸æ™®éï¼Œæ¯”å¦‚ï¼š</p><ol><li><strong>æ•°æ®åŠ å¯†</strong>ï¼šå¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å­˜å‚¨æ•æ„Ÿä¿¡æ¯çš„åº”ç”¨ï¼Œæ¯”å¦‚ç”¨æˆ·å¯†ç æˆ–ä¸ªäººä¿¡æ¯ï¼Œä½ å¯èƒ½ä¼šç”¨ AES æ¥åŠ å¯†è¿™äº›æ•°æ®ã€‚</li><li><strong>å®‰å…¨é€šè®¯</strong>ï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®æ—¶ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„éšç§å’Œå®Œæ•´æ€§ï¼Œå¸¸å¸¸ä¼šä½¿ç”¨ AES åŠ å¯†æ•°æ®ã€‚</li><li><strong>æ–‡ä»¶åŠ å¯†</strong>ï¼šåœ¨éœ€è¦ä¿æŠ¤æ–‡ä»¶å†…å®¹ä¸è¢«æœªæˆæƒè®¿é—®æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ AES åŠ å¯†è¿™äº›æ–‡ä»¶ã€‚</li></ol><h4 id="aeskeygenparams-name" tabindex="-1"><a class="header-anchor" href="#aeskeygenparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#aeskeygenparamsname" target="_blank" rel="noopener noreferrer">aesKeyGenParams.name</a></span></a></h4><p>è¦è§£é‡Š<code>aesKeyGenParams.name</code>åœ¨ Node.js v21.7.1 ä¸­çš„å«ä¹‰å’Œç”¨æ³•ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªé‡è¦çš„æ¦‚å¿µï¼šAESã€Web Crypto APIã€ä»¥åŠå¯†é’¥ç”Ÿæˆã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µç†è§£" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µç†è§£"><span>åŸºç¡€æ¦‚å¿µç†è§£ï¼š</span></a></h3><ol><li><p><strong>AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰</strong>ï¼š<br> AES æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚æ‰€è°“â€œå¯¹ç§°â€æ˜¯æŒ‡åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚AES å¸¸ç”¨äºå„ç§å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚åœ¨çº¿äº¤æ˜“çš„æ•°æ®åŠ å¯†ã€æ•æ„Ÿä¿¡æ¯çš„å­˜å‚¨ç­‰ã€‚</p></li><li><p><strong>Web Crypto API</strong>ï¼š<br> Web Crypto API æ˜¯ä¸€ç§æä¾›åŠ å¯†åŠŸèƒ½çš„æµè§ˆå™¨ APIï¼Œå®ƒåŒ…æ‹¬äº†ç”Ÿæˆå¯†é’¥ã€åŠ å¯†ã€è§£å¯†ç­‰å¤šç§æ“ä½œã€‚Node.js å®ç°äº†éƒ¨åˆ† Web Crypto APIï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡ŒåŠ å¯†æ“ä½œã€‚</p></li><li><p><strong>å¯†é’¥ç”Ÿæˆ</strong>ï¼š<br> åœ¨è¿›è¡ŒåŠ å¯†é€šä¿¡æˆ–æ•°æ®åŠ å¯†æ—¶ï¼Œé¦–å…ˆéœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚è¿™ä¸ªè¿‡ç¨‹å«åšå¯†é’¥ç”Ÿæˆã€‚</p></li></ol><h3 id="aeskeygenparams-nameçš„ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#aeskeygenparams-nameçš„ç”¨æ³•"><span><code>aesKeyGenParams.name</code>çš„ç”¨æ³•</span></a></h3><p>åœ¨ Node.js çš„ Web Crypto API å®ç°ä¸­ï¼Œ<code>aesKeyGenParams.name</code> æ˜¯ç”¨äºæŒ‡å®šç”Ÿæˆå¯†é’¥æ—¶æ‰€é‡‡ç”¨çš„ç®—æ³•åç§°ã€‚å¯¹äº AES åŠ å¯†ï¼Œè¿™ä¸ªå±æ€§åº”å½“è®¾ç½®ä¸º <code>&quot;AES-CBC&quot;</code>, <code>&quot;AES-CTR&quot;</code>, <code>&quot;AES-GCM&quot;</code> ç­‰ï¼Œæ ¹æ®ä½ æ‰“ç®—ä½¿ç”¨çš„åŠ å¯†æ–¹å¼å†³å®šã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-14"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„åº”ç”¨ç¨‹åºã€‚ä½ å†³å®šä½¿ç”¨ AES GCM æ¨¡å¼è¿›è¡ŒåŠ å¯†ï¼Œå› ä¸ºå®ƒä¸ä»…æä¾›äº†åŠ å¯†åŠŸèƒ½ï¼Œè¿˜åŒ…æ‹¬äº†å®Œæ•´æ€§ä¿æŠ¤ã€‚</p><h4 id="_1-ç”Ÿæˆå¯†é’¥-2" tabindex="-1"><a class="header-anchor" href="#_1-ç”Ÿæˆå¯†é’¥-2"><span>1. ç”Ÿæˆå¯†é’¥ï¼š</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Node.js æ¥ç”Ÿæˆ AES GCM å¯†é’¥çš„ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> aesKeyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨çš„ç®—æ³•åç§°</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦ï¼Œå¯ä»¥æ˜¯ 128ã€192 æˆ– 256 ä½</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">      aesKeyGenParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯ç”¨äºåŠ å¯†å’Œè§£å¯†</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥ç”ŸæˆæˆåŠŸ:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥ç”Ÿæˆå¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œé€šè¿‡è°ƒç”¨ <code>webcrypto.subtle.generateKey</code> æ–¹æ³•å¹¶ä¼ å…¥ <code>aesKeyGenParams</code>ï¼ˆå…¶ä¸­åŒ…å«äº†ç®—æ³•åç§° <code>AES-GCM</code> å’Œå¯†é’¥é•¿åº¦ï¼‰ï¼ŒæˆåŠŸç”Ÿæˆäº†ä¸€ä¸ªå¯ç”¨äºåŠ å¯†å’Œè§£å¯†çš„ AES GCM å¯†é’¥ã€‚</p><h4 id="_2-ä½¿ç”¨å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†"><span>2. ä½¿ç”¨å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼š</span></a></h4><p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªç”Ÿæˆçš„å¯†é’¥æ¥åŠ å¯†ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶åœ¨å¿…è¦æ—¶è§£å¯†ã€‚è¿™å°±æ˜¯ <code>aesKeyGenParams.name</code> åœ¨å®é™…åº”ç”¨ä¸­çš„ç®€å•ç¤ºä¾‹ã€‚</p><h3 id="æ€»ç»“-7" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-7"><span>æ€»ç»“</span></a></h3><p>æ€»çš„æ¥è¯´ï¼Œ<code>aesKeyGenParams.name</code> åœ¨ Node.js ä¸­ç”¨äºæŒ‡å®šç”Ÿæˆå¯†é’¥æ—¶ä½¿ç”¨çš„ç®—æ³•ã€‚åœ¨è¿›è¡Œç›¸å…³çš„åŠ å¯†ä»»åŠ¡æ—¶ï¼Œæ˜ç¡®ç®—æ³•åç§°æ˜¯æ„å»ºå®‰å…¨åº”ç”¨ç¨‹åºçš„é‡è¦ä¸€æ­¥ã€‚å¸Œæœ›è¿™ä¸ªä¾‹å­èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨å®é™…å¼€å‘ä¸­ä½¿ç”¨ Node.js è¿›è¡ŒåŠ å¯†æ“ä½œã€‚</p><h3 id="class-ecdhkeyderiveparams" tabindex="-1"><a class="header-anchor" href="#class-ecdhkeyderiveparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-ecdhkeyderiveparams" target="_blank" rel="noopener noreferrer">Class: EcdhKeyDeriveParams</a></span></a></h3><p>Node.js ä¸­çš„<code>EcdhKeyDeriveParams</code>æ˜¯ä¸€ä¸ªä¸ Web åŠ å¯† API ç›¸å…³çš„æ¦‚å¿µï¼Œç”¨äºæŒ‡å®šä½¿ç”¨ Elliptic Curve Diffie-Hellman (ECDH) ç®—æ³•æ´¾ç”Ÿå¯†é’¥æ—¶æ‰€éœ€çš„å‚æ•°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒä½¿ä¸¤æ–¹å¯ä»¥åœ¨ä¸å®‰å…¨çš„é€šé“ä¸Šå®‰å…¨åœ°å…±äº«å¯†é’¥ä¿¡æ¯ã€‚</p><p>ä¸ºäº†ç†è§£<code>EcdhKeyDeriveParams</code>ï¼Œæˆ‘ä»¬å…ˆè¦å¼„æ¸…æ¥šå‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><p><strong>ECDHï¼ˆElliptic Curve Diffie-Hellmanï¼‰</strong>: æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢åè®®ï¼Œå…è®¸ä¸¤ä¸ªå‚ä¸è€…åœ¨å½¼æ­¤æ²¡æœ‰äº‹å…ˆå…±äº«ç§˜å¯†çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¸å®‰å…¨çš„é€šé“å»ºç«‹å…±äº«çš„ç§˜å¯†å¯†é’¥ã€‚è¿™ç§æ–¹æ³•åŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦ã€‚</p></li><li><p><strong>å¯†é’¥æ´¾ç”Ÿï¼ˆKey Derivationï¼‰</strong>: æ˜¯ä»ä¸€ä¸ªç§˜å¯†å…±äº«å€¼ç”Ÿæˆå¯†é’¥çš„è¿‡ç¨‹ã€‚åœ¨ ECDH ä¸­ï¼Œè¿™ä¸ªå…±äº«å€¼æ˜¯é€šè¿‡åŒæ–¹å„è‡ªçš„ç§é’¥å’Œå¯¹æ–¹çš„å…¬é’¥è®¡ç®—å¾—å‡ºçš„ã€‚</p></li><li><p><strong><code>EcdhKeyDeriveParams</code>ç±»</strong>: è¿™ä¸ªç±»åœ¨ Node.js ä¸­è¡¨ç¤ºè¿›è¡Œ ECDH å¯†é’¥æ´¾ç”Ÿæ“ä½œæ‰€éœ€è¦çš„å‚æ•°ã€‚</p></li></ol><h3 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°</span></a></h3><p>å½“ä½ ä½¿ç”¨<code>EcdhKeyDeriveParams</code>æ—¶ï¼Œä¸»è¦éœ€è¦æä¾›ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><code>name</code>: æ“ä½œåç§°ï¼Œå¯¹äº ECDH å¯†é’¥æ´¾ç”Ÿï¼Œè¿™ä¸ªå€¼åº”è¯¥æ€»æ˜¯ <code>&quot;ECDH&quot;</code>ã€‚</li><li><code>public</code>: è¿™æ˜¯å¯¹æ–¹çš„å…¬é’¥ï¼Œç±»å‹ä¸º<code>CryptoKey</code>ï¼Œç”¨äºä¸ä½ çš„ç§é’¥é…åˆï¼Œç»è¿‡ ECDH åè®®è¿ç®—å¾—åˆ°å…±äº«çš„ç§˜å¯†å¯†é’¥ã€‚</li></ul><h3 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾ Alice å’Œ Bob æƒ³è¦é€šè¿‡ä¸å®‰å…¨çš„ç½‘ç»œå®‰å…¨åœ°å…±äº«ä¸€ä¸ªå¯†é’¥ï¼Œä»–ä»¬å¯ä»¥é‡‡ç”¨ ECDH å¯†é’¥äº¤æ¢åè®®ã€‚ä»¥ä¸‹æ˜¯åœ¨ Node.js ä¸­ä½¿ç”¨<code>EcdhKeyDeriveParams</code>å®ç°è¿™ä¸€è¿‡ç¨‹çš„ç®€åŒ–ç¤ºä¾‹ï¼š</p><ol><li><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong> - é¦–å…ˆï¼ŒAlice å’Œ Bob å„è‡ªç”Ÿæˆè‡ªå·±çš„ ECDH å¯†é’¥å¯¹ï¼ˆå³å…¬é’¥å’Œç§é’¥ï¼‰ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// Aliceç”ŸæˆECDHå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> aliceKeyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeyPairSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ec</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨P-256æ¤­åœ†æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// Bobç”ŸæˆECDHå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> bobKeyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeyPairSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ec</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>æ´¾ç”Ÿå¯†é’¥</strong> - Alice å’Œ Bob äº’æ¢å…¬é’¥åï¼Œå„è‡ªä½¿ç”¨å¯¹æ–¹çš„å…¬é’¥å’Œè‡ªå·±çš„ç§é’¥æ´¾ç”Ÿå‡ºå…±äº«å¯†é’¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// Aliceæ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> aliceSharedSecret</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">diffieHellman</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  privateKey</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> aliceKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  publicKey</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> bobKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// Bobæ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> bobSharedSecret</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">diffieHellman</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  privateKey</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> bobKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  publicKey</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> aliceKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>crypto.diffieHellman</code>å‡½æ•°å†…éƒ¨ä½¿ç”¨äº†<code>EcdhKeyDeriveParams</code>ï¼Œè™½ç„¶æˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>crypto.diffieHellman</code>å¹¶æ²¡æœ‰æ˜¾å¼åˆ›å»ºä¸€ä¸ª<code>EcdhKeyDeriveParams</code>å®ä¾‹ï¼Œä½†è¿™æ­£æ˜¯åœ¨å¹•åè¿›è¡Œ ECDH å¯†é’¥æ´¾ç”Ÿæ“ä½œéœ€è¦çš„å‚æ•°é…ç½®ã€‚</p><p>æ¯æ¬¡æ‰§è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œå³ä¾¿æ˜¯åœ¨ä¸å®‰å…¨çš„é€šä¿¡ç¯å¢ƒä¸­ï¼ŒAlice å’Œ Bob éƒ½èƒ½å®‰å…¨åœ°ç”Ÿæˆä¸€ä¸ªåªæœ‰ä»–ä»¬çŸ¥é“çš„å…±äº«å¯†é’¥ï¼Œè¿™ä¸ªå…±äº«å¯†é’¥å¯ä»¥ç”¨äºä¹‹åçš„é€šä¿¡åŠ å¯†ã€‚</p><p>å¸Œæœ›è¿™ä¸ªä¾‹å­å¸®åŠ©ä½ ç†è§£äº†<code>EcdhKeyDeriveParams</code>ç±»åŠå…¶åœ¨ Node.js ä¸­çš„åº”ç”¨ï¼</p><h4 id="ecdhkeyderiveparams-name" tabindex="-1"><a class="header-anchor" href="#ecdhkeyderiveparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ecdhkeyderiveparamsname" target="_blank" rel="noopener noreferrer">ecdhKeyDeriveParams.name</a></span></a></h4><p>Node.js v21.7.1 ä¸­çš„<code>ecdhKeyDeriveParams.name</code>å±æ€§æ˜¯å…³äº Web åŠ å¯† API çš„ä¸€ä¸ªå…·ä½“ç»†èŠ‚ã€‚ä¸ºäº†ç†è§£è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è§£é‡Šä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><h3 id="web-åŠ å¯†-api" tabindex="-1"><a class="header-anchor" href="#web-åŠ å¯†-api"><span>Web åŠ å¯† API</span></a></h3><p>Web åŠ å¯† API æä¾›äº†ä¸€ç»„å…è®¸å¼€å‘äººå‘˜æ‰§è¡Œå„ç§åŠ å¯†æ“ä½œï¼ˆå¦‚å“ˆå¸Œã€ç­¾åã€åŠ å¯†å’Œè§£å¯†ç­‰ï¼‰çš„ JavaScript æ¥å£ã€‚å®ƒè¢«è®¾è®¡ç”¨äº web åº”ç”¨ç¨‹åºä¸­ï¼Œä»¥å¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h3 id="ecdh-elliptic-curve-diffie-hellman" tabindex="-1"><a class="header-anchor" href="#ecdh-elliptic-curve-diffie-hellman"><span>ECDHï¼ˆElliptic Curve Diffie-Hellmanï¼‰</span></a></h3><p>ECDH æ˜¯ä¸€ç§åœ¨ä¸å®‰å…¨é€šé“ä¸Šå®‰å…¨åœ°äº¤æ¢åŠ å¯†å¯†é’¥çš„æ–¹æ³•ã€‚å®ƒä½¿ç”¨æ¤­åœ†æ›²çº¿å¯†ç å­¦æ¥ç”Ÿæˆå…±äº«çš„ç§˜å¯†ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒæ–¹éƒ½æ²¡æœ‰ç›´æ¥ä¼ è¾“ç§˜å¯†æœ¬èº«ã€‚ç®€å•æ¥è¯´ï¼Œä¸¤ä¸ªé€šä¿¡æ–¹éƒ½å¯ä»¥åˆ›é€ å‡ºä¸€ä¸ªå…±åŒçš„ç§˜å¯†ï¼Œè€Œå…¶ä»–äººå³ä½¿æˆªè·äº†ä»–ä»¬äº¤æ¢çš„ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•å¾—çŸ¥è¿™ä¸ªç§˜å¯†ã€‚</p><h3 id="ecdhkeyderiveparams-name-1" tabindex="-1"><a class="header-anchor" href="#ecdhkeyderiveparams-name-1"><span><code>ecdhKeyDeriveParams.name</code></span></a></h3><p><code>ecdhKeyDeriveParams.name</code>æ˜¯æŒ‡å®šç”¨äºå¯†é’¥æ´¾ç”Ÿæ“ä½œçš„ç®—æ³•åç§°çš„å‚æ•°ã€‚åœ¨ ECDH ä¸­ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼æ€»æ˜¯ <code>&quot;ECDH&quot;</code>ã€‚å¯†é’¥æ´¾ç”Ÿæ˜¯ä»ä¸€ä¸ªå…±äº«ç§˜å¯†ç”Ÿæˆå¯†é’¥çš„è¿‡ç¨‹ã€‚è¿™æ˜¯ä¸€ç§æ¯”è¾ƒé«˜çº§çš„æ“ä½œï¼Œé€šå¸¸ç”¨äºæ›´å¤æ‚çš„åŠ å¯†éœ€æ±‚ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ Alice å’Œ Bob æƒ³è¦é€šè¿‡ Internet å®‰å…¨åœ°äº¤æ¢ä¿¡æ¯ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨ ECDH å¯†é’¥äº¤æ¢åè®®æ¥ç”Ÿæˆä¸€ä¸ªå…±äº«ç§˜å¯†ï¼Œç„¶ååŸºäºè¿™ä¸ªå…±äº«ç§˜å¯†æ´¾ç”Ÿå‡ºåŠ å¯†å¯†é’¥ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ Web åŠ å¯† API å®ç°è¿™ä¸€ç‚¹çš„é«˜çº§æ­¥éª¤ï¼š</p><ol><li><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong>ï¼šAlice å’Œ Bob å„è‡ªç”Ÿæˆè‡ªå·±çš„å…¬ç§é’¥å¯¹ã€‚</li><li><strong>äº¤æ¢å…¬é’¥</strong>ï¼šAlice å°†å¥¹çš„å…¬é’¥å‘é€ç»™ Bobï¼ŒBob å°†ä»–çš„å…¬é’¥å‘é€ç»™ Aliceã€‚</li><li><strong>æ´¾ç”Ÿå…±äº«ç§˜å¯†</strong>ï¼šAlice ä½¿ç”¨ Bob çš„å…¬é’¥å’Œè‡ªå·±çš„ç§é’¥æ´¾ç”Ÿå‡ºå…±äº«ç§˜å¯†ï¼ŒBob ä¹Ÿåšç›¸åŒçš„æ“ä½œã€‚å› ä¸º ECDH çš„ç‰¹æ€§ï¼Œä»–ä»¬å„è‡ªè®¡ç®—å‡ºçš„å…±äº«ç§˜å¯†æ˜¯ç›¸åŒçš„ã€‚</li><li><strong>ä½¿ç”¨<code>ecdhKeyDeriveParams</code>æ´¾ç”Ÿå¯†é’¥</strong>ï¼šä¸€æ—¦æ‹¥æœ‰äº†å…±äº«ç§˜å¯†ï¼ŒAlice å’Œ Bob å¯ä»¥ä½¿ç”¨<code>ecdhKeyDeriveParams</code>ï¼ˆå…¶ä¸­<code>name</code>è®¾ç½®ä¸º<code>&quot;ECDH&quot;</code>ï¼‰ï¼ŒåŠ ä¸Šå…±äº«ç§˜å¯†ï¼Œæ¥æ´¾ç”Ÿå‡ºå®é™…ç”¨äºåŠ å¯†é€šä¿¡çš„å¯†é’¥ã€‚</li></ol><p>ä»£ç ç¤ºä¾‹ï¼ˆæ¦‚å¿µå±•ç¤ºï¼Œéå®Œæ•´ä»£ç ï¼‰:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> aliceKeyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-384</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> bobKeyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-384</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾Aliceå’ŒBobå·²ç»äº¤æ¢äº†å½¼æ­¤çš„å…¬é’¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ecdhKeyDeriveParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  public</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> bobKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // Aliceä½¿ç”¨Bobçš„å…¬é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// Aliceæ´¾ç”Ÿå…±äº«ç§˜å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> sharedSecret</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">  ecdhKeyDeriveParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  aliceKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº†ä¸€ç³»åˆ— Web åŠ å¯† API çš„å‡½æ•°æ¥ç”Ÿæˆå¯†é’¥å¯¹ã€æ´¾ç”Ÿå…±äº«ç§˜å¯†ï¼Œå¹¶æœ€ç»ˆæ´¾ç”Ÿå‡ºç”¨äºåŠ å¯†å’Œè§£å¯†çš„å¯†é’¥ã€‚æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘å®‰å…¨åœ°äº¤æ¢å…¬é’¥ã€å¤„ç†é”™è¯¯å’Œå¼‚å¸¸ã€ä»¥åŠç¡®ä¿é€šä¿¡çš„æ•´ä½“å®‰å…¨æ€§ã€‚</p><h4 id="ecdhkeyderiveparams-public" tabindex="-1"><a class="header-anchor" href="#ecdhkeyderiveparams-public"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ecdhkeyderiveparamspublic" target="_blank" rel="noopener noreferrer">ecdhKeyDeriveParams.public</a></span></a></h4><p>Node.js åœ¨å…¶ v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œæä¾›äº†è®¸å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹ Web åŠ å¯† API çš„æ”¯æŒã€‚è¿™é‡Œæˆ‘ä»¬å°†èšç„¦äº <code>ecdhKeyDeriveParams.public</code>ï¼Œè¿™æ˜¯ä¸ ECDHï¼ˆæ¤­åœ†æ›²çº¿ Diffie-Hellmanï¼‰å¯†é’¥äº¤æ¢ç›¸å…³çš„ä¸€ä¸ªå‚æ•°ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£å®ƒï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç®€å•ä»‹ç»ä¸€ä¸‹å‡ ä¸ªåŸºç¡€æ¦‚å¿µã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-2"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p><strong>ECDHï¼ˆæ¤­åœ†æ›²çº¿ Diffie-Hellmanï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ç§åœ¨ä¸¤æ–¹ä¹‹é—´å®‰å…¨å…±äº«å¯†é’¥çš„æ–¹æ³•ï¼Œè€Œæ— éœ€ç¬¬ä¸‰æ–¹å‚ä¸ã€‚å®ƒåŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼Œè¿™æ˜¯ä¸€ç§ä½¿ç”¨æ¤­åœ†æ›²çº¿æ•°å­¦æ¥æ„å»ºå¯†ç å­¦ç®—æ³•çš„æ–¹æ³•ã€‚</p><p><strong>Web Crypto API</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ APIï¼Œç”¨äºæ‰§è¡Œä½çº§åŠ å¯†æ“ä½œï¼Œå¦‚å“ˆå¸Œã€ç­¾åã€åŠ å¯†å’Œè§£å¯†ç­‰ã€‚Node.js é€šè¿‡ webcrypto æ¨¡å—æ”¯æŒåŒæ ·çš„ APIï¼Œä½¿å¾—åœ¨ Node.js ç¯å¢ƒä¸­ä¹Ÿèƒ½æ‰§è¡Œè¿™äº›åŠ å¯†æ“ä½œã€‚</p><h3 id="ecdhkeyderiveparams-public-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#ecdhkeyderiveparams-public-è§£é‡Š"><span>ecdhKeyDeriveParams.public è§£é‡Š</span></a></h3><p>åœ¨ ECDH å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­ï¼Œä¸¤æ–¹å„è‡ªç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚<code>ecdhKeyDeriveParams.public</code> æ˜¯æŒ‡åœ¨è¿›è¡Œå¯†é’¥å¯¼å‡ºæ“ä½œæ—¶ä½¿ç”¨çš„å¯¹æ–¹çš„å…¬é’¥å‚æ•°ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½¿ç”¨ ECDH ç®—æ³•ç”Ÿæˆå…±äº«å¯†é’¥æ—¶ï¼Œä½ ä¼šç”¨åˆ°ä½ çš„ç§é’¥å’Œå¯¹æ–¹çš„å…¬é’¥ï¼Œè€Œ <code>ecdhKeyDeriveParams.public</code> å°±æ˜¯ç”¨æ¥æŒ‡å®šè¿™ä¸ªå¯¹æ–¹çš„å…¬é’¥çš„ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-15"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ Alice å’Œ Bob æƒ³é€šè¿‡äº’è”ç½‘å®‰å…¨åœ°å…±äº«å¯†é’¥ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ ECDH ç®—æ³•ã€‚ä»¥ä¸‹æ˜¯ä»–ä»¬å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„æ­¥éª¤ï¼š</p><ol><li><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong>ï¼šAlice å’Œ Bob å„è‡ªç”Ÿæˆè‡ªå·±çš„å…¬é’¥å’Œç§é’¥å¯¹ã€‚</li><li><strong>äº¤æ¢å…¬é’¥</strong>ï¼šAlice å°†å¥¹çš„å…¬é’¥å‘é€ç»™ Bobï¼ŒBob å°†ä»–çš„å…¬é’¥å‘é€ç»™ Aliceã€‚</li><li><strong>ç”Ÿæˆå…±äº«å¯†é’¥</strong>ï¼šAlice ä½¿ç”¨å¥¹çš„ç§é’¥å’Œ Bob çš„å…¬é’¥ç”Ÿæˆå…±äº«å¯†é’¥ï¼ŒBob ä½¿ç”¨ä»–çš„ç§é’¥å’Œ Alice çš„å…¬é’¥ç”Ÿæˆå…±äº«å¯†é’¥ã€‚æ­¤å¤„ï¼ŒBob çš„å…¬é’¥åœ¨ Alice ç«¯ä½¿ç”¨æ—¶å°±ä½œä¸º <code>ecdhKeyDeriveParams.public</code> å‚æ•°ä¼ å…¥ï¼Œåä¹‹äº¦ç„¶ã€‚</li></ol><p>ä»£ç ç¤ºä¾‹ï¼ˆå‡å®šå…¬é’¥å·²ç»é€šè¿‡æŸç§æ–¹å¼äº’æ¢ï¼‰:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// å¼•å…¥ webcrypto æ¨¡å—</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä»¥ Alice ä¸ºä¾‹ï¼Œç”Ÿæˆå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> aliceKeyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-384</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡å®šè¿™æ˜¯ä» Bob é‚£é‡Œæ¥æ”¶åˆ°çš„å…¬é’¥ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå®‰å…¨çš„æ–¹å¼æ¥äº¤æ¢å…¬é’¥ï¼‰</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> bobsPublicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> aliceKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ³¨æ„ï¼šè¿™é‡Œä»…ä¸ºç¤ºä¾‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨ Alice çš„ç§é’¥å’Œ Bob çš„å…¬é’¥æ¥æ´¾ç”Ÿå…±äº«å¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> sharedSecret</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      public</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> bobsPublicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿™é‡Œä½¿ç”¨äº† Bob çš„å…¬é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    aliceKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ Alice çš„ç§é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // å®šä¹‰å…±äº«å¯†é’¥çš„ä½¿ç”¨ç›®çš„å’Œå±æ€§</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å…±äº«å¯†é’¥çš„å…è®¸æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">sharedSecret</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ ECDH ç®—æ³•å’Œ <code>ecdhKeyDeriveParams.public</code> æ¥ç”Ÿæˆä¸€ä¸ªå…±äº«å¯†é’¥ã€‚è¿™ç§æ–¹å¼çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºåŠ å¯†é€šä¿¡ã€å®‰å…¨æ–‡ä»¶ä¼ è¾“ç­‰ã€‚</p><h3 id="class-ecdsaparams" tabindex="-1"><a class="header-anchor" href="#class-ecdsaparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-ecdsaparams" target="_blank" rel="noopener noreferrer">Class: EcdsaParams</a></span></a></h3><p>åœ¨è§£é‡Š<code>EcdsaParams</code>ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å‡ ä¸ªå…³é”®æ¦‚å¿µã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-5" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-5"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ul><li><strong>Node.js</strong>: ä¸€ä¸ªèƒ½è®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚</li><li><strong>Web Crypto API</strong>: æµè§ˆå™¨æä¾›çš„ä¸€å¥—åŠ å¯†æŠ€æœ¯çš„æ ‡å‡†æ¥å£ï¼Œç”¨äºæ‰§è¡Œè¯¸å¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åç­‰æ“ä½œã€‚</li><li><strong>ECDSA(Elliptic Curve Digital Signature Algorithm)</strong>: ä¸€ç§ç”¨äºæ•°å­—ç­¾åçš„ç®—æ³•ï¼Œå®ƒä½¿ç”¨åŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦çš„å…¬é’¥å’Œç§é’¥å¯¹æ¥è¿›è¡Œå·¥ä½œã€‚</li></ul><h3 id="ecdsaparams-ç±»" tabindex="-1"><a class="header-anchor" href="#ecdsaparams-ç±»"><span>EcdsaParams ç±»</span></a></h3><p>åœ¨ Node.jsï¼ˆå…·ä½“åˆ°ä½ æåˆ°çš„ç‰ˆæœ¬ v21.7.1ï¼‰ä¸­ï¼Œ<code>EcdsaParams</code>æ˜¯ä¸ Web Crypto API ç›¸å…³çš„ä¸€ä¸ªç±»ï¼Œå®ƒç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œ ECDSAï¼ˆæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼‰æ“ä½œæ—¶æ‰€éœ€çš„å‚æ•°ã€‚å®ƒä¸æ˜¯ç›´æ¥ç”¨äºåˆ›å»ºå®ä¾‹ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œåœ¨æ‰§è¡Œç­¾åæˆ–éªŒè¯æ“ä½œæ—¶ä¼ ç»™ç›¸åº”çš„æ–¹æ³•ã€‚</p><p>è¿™ä¸ªç±»ä¸»è¦åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><strong>name</strong>: å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šåŠ å¯†æ“ä½œçš„åç§°ï¼Œå¯¹äº ECDSAï¼Œè¿™é‡Œåº”è¯¥æ˜¯<code>&quot;ECDSA&quot;</code>ã€‚</li><li><strong>hash</strong>: ç”¨äºæŒ‡ç¤ºåœ¨ç­¾åè¿‡ç¨‹ä¸­ä½¿ç”¨å“ªç§æ•£åˆ—å‡½æ•°çš„å±æ€§ã€‚å¸¸è§çš„æ•£åˆ—å‡½æ•°æœ‰<code>SHA-256</code>ã€<code>SHA-384</code>ç­‰ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦æ•°å­—ç­¾ååŠŸèƒ½çš„åº”ç”¨ï¼Œä¾‹å¦‚ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œå…¶ä¸­ç”¨æˆ·å¯ä»¥å‘é€ç»è¿‡ç­¾åçš„æ¶ˆæ¯ä»¥ç¡®ä¿æ¶ˆæ¯çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ã€‚</p><h4 id="æ­¥éª¤-1-ç”Ÿæˆå¯†é’¥å¯¹" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-ç”Ÿæˆå¯†é’¥å¯¹"><span>æ­¥éª¤ 1: ç”Ÿæˆå¯†é’¥å¯¹</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦ä¸ºç”¨æˆ·ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨P-256æ¤­åœ†æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-åˆ›å»ºç­¾å" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-åˆ›å»ºç­¾å"><span>æ­¥éª¤ 2: åˆ›å»ºç­¾å</span></a></h4><p>ç„¶åï¼Œä½¿ç”¨ç”¨æˆ·çš„ç§é’¥æ¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿™æ˜¯ä¸€ä¸ªè¦ç­¾åçš„æ¶ˆæ¯</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨SHA-256æ•£åˆ—å‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#D8DEE9;">  privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-3-éªŒè¯ç­¾å" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-éªŒè¯ç­¾å"><span>æ­¥éª¤ 3: éªŒè¯ç­¾å</span></a></h4><p>æœ€åï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ç”¨æˆ·çš„å…¬é’¥æ¥éªŒè¯æ¶ˆæ¯ç­¾åçš„çœŸå®æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // å†æ¬¡æŒ‡å®šä½¿ç”¨SHA-256æ•£åˆ—å‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#D8DEE9;">  publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  signature</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">isValid</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ç­¾åéªŒè¯æˆåŠŸ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ç­¾åéªŒè¯å¤±è´¥</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ å¯ä»¥ç¡®ä¿æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ï¼Œä¸”ç¡®å®ç”±æ‹¥æœ‰ç›¸åº”ç§é’¥çš„ç”¨æˆ·ç­¾åã€‚è¿™å°±æ˜¯<code>EcdsaParams</code>åœ¨å®è·µä¸­çš„ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ã€‚</p><h4 id="ecdsaparams-hash" tabindex="-1"><a class="header-anchor" href="#ecdsaparams-hash"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ecdsaparamshash" target="_blank" rel="noopener noreferrer">ecdsaParams.hash</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-node-js" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-node-js"><span>ä»€ä¹ˆæ˜¯ Node.js?</span></a></h3><p>é¦–å…ˆï¼ŒNode.js æ˜¯ä¸€ä¸ªå¼€æºå’Œè·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚Node.js ç‰¹åˆ«é€‚åˆæ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-ecdsa" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-ecdsa"><span>ä»€ä¹ˆæ˜¯ ECDSAï¼Ÿ</span></a></h3><p>ECDSA å…¨ç§°ä¸ºæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼ˆElliptic Curve Digital Signature Algorithmï¼‰ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨æ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECCï¼‰æ¥å®ç°çš„æ•°å­—ç­¾åæŠ€æœ¯ã€‚æ•°å­—ç­¾åæŠ€æœ¯å¯ä»¥è®©ä½ éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºï¼Œç¡®ä¿æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ä¸”æ¥è‡ªäºå£°ç§°çš„å‘é€è€…ã€‚</p><h3 id="node-js-v21-7-1-ä¸­çš„ecdsaparams-hash" tabindex="-1"><a class="header-anchor" href="#node-js-v21-7-1-ä¸­çš„ecdsaparams-hash"><span>Node.js v21.7.1 ä¸­çš„<code>ecdsaParams.hash</code></span></a></h3><p>åœ¨ Node.js çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>ecdsaParams.hash</code>æ˜¯æŒ‡åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œ ECDSA æ“ä½œæ—¶æ‰€æ¶‰åŠåˆ°çš„ hash ç®—æ³•å‚æ•°ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ª ECDSA ç­¾åæˆ–è€…éªŒè¯ä¸€ä¸ªç­¾åæ—¶ï¼Œä½ éœ€è¦æŒ‡å®šä¸€ä¸ª hash ç®—æ³•ã€‚</p><p>Hash ç®—æ³•æ˜¯ä¸€ç§å°†è¾“å…¥æ•°æ®è½¬æ¢æˆå›ºå®šå¤§å°è¾“å‡ºå­—ç¬¦ä¸²ï¼ˆé€šå¸¸å‘ˆç°ä¸ºåå…­è¿›åˆ¶æ•°å­—ï¼‰çš„ç®—æ³•ã€‚è¿™ä¸ªè¾“å‡ºå³æ‰€è°“çš„â€œå“ˆå¸Œå€¼â€ï¼Œå¯¹äºä»»ä½•ç»™å®šçš„è¾“å…¥æ•°æ®ï¼Œå…¶å“ˆå¸Œå€¼æ€»æ˜¯å”¯ä¸€çš„ã€‚å¸¸è§çš„å“ˆå¸Œç®—æ³•åŒ…æ‹¬ SHA-256ã€SHA-384 ç­‰ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“æ•°æ®çš„ç½‘ç»œåº”ç”¨ã€‚ä¸ºäº†ç¡®ä¿æ•°æ®çš„å®‰å…¨ï¼Œä½ å†³å®šä½¿ç”¨ ECDSA è¿›è¡Œæ•°å­—ç­¾åï¼Œè¿™æ ·æ¥æ”¶æ–¹å°±å¯ä»¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</p><h4 id="ç¤ºä¾‹-1-ç”Ÿæˆ-ecdsa-å¯†é’¥å’Œç­¾å" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç”Ÿæˆ-ecdsa-å¯†é’¥å’Œç­¾å"><span>ç¤ºä¾‹ 1ï¼šç”Ÿæˆ ECDSA å¯†é’¥å’Œç­¾å</span></a></h4><ol><li>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»º ECDSA çš„å…¬é’¥å’Œç§é’¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨P-256æ¤­åœ†æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ç§é’¥ç”Ÿæˆæ•°æ®çš„ç­¾åã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨SHA-256ä½œä¸ºhashç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // éœ€è¦ç­¾åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-éªŒè¯ç­¾å" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-éªŒè¯ç­¾å"><span>ç¤ºä¾‹ 2ï¼šéªŒè¯ç­¾å</span></a></h4><p>æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®å’Œç­¾ååï¼Œå¯ä»¥ä½¿ç”¨å‘é€æ–¹çš„å…¬é’¥æ¥éªŒè¯ç­¾åçš„æœ‰æ•ˆæ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifySignature</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // åŒæ ·éœ€è¦æŒ‡å®šhashç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å‘é€æ–¹çš„å…¬é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ”¶åˆ°çš„ç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // åŸå§‹æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Node.js çš„ Web Crypto API ç”Ÿæˆ ECDSA å¯†é’¥å¯¹ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ã€ç­¾åæ•°æ®ä»¥åŠéªŒè¯ç­¾åçš„è¿‡ç¨‹ã€‚è¿™åœ¨éœ€è¦ç¡®ä¿æ•°æ®ä¼ è¾“å®‰å…¨æ€§çš„ç½‘ç»œåº”ç”¨ä¸­éå¸¸æœ‰ç”¨ã€‚</p><h4 id="ecdsaparams-name" tabindex="-1"><a class="header-anchor" href="#ecdsaparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ecdsaparamsname" target="_blank" rel="noopener noreferrer">ecdsaParams.name</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>ecdsaParams.name</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è°ˆè®º Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªç‰¹å®šçš„å±æ€§ï¼Œ<code>ecdsaParams.name</code>ï¼Œç”¨äºæŒ‡å®šåŠ å¯†æ“ä½œä¸­ä½¿ç”¨çš„ç®—æ³•åç§°ã€‚åœ¨è¿™é‡Œï¼Œå®ƒç‰¹åˆ«å…³è”äº ECDSAï¼ˆElliptic Curve Digital Signature Algorithmï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºæ•°å­—ç­¾åçš„ç®—æ³•ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š</p><h3 id="ä»€ä¹ˆæ˜¯-ecdsa-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-ecdsa-1"><span>ä»€ä¹ˆæ˜¯ ECDSA?</span></a></h3><p>ECDSA æ˜¯ä¸€ç§åŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦çš„æ•°å­—ç­¾åç®—æ³•ã€‚å®ƒè¢«å¹¿æ³›ç”¨äºå¤šç§å®‰å…¨é€šä¿¡ä¸­ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯çš„å®Œæ•´æ€§å’Œæ¥æºçš„è®¤è¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ è®¿é—®ä¸€ä¸ª HTTPS ç½‘ç«™æ—¶ï¼Œç½‘ç«™ä¸ä½ çš„æµè§ˆå™¨ä¹‹é—´çš„é€šä¿¡å°±å¯èƒ½ä½¿ç”¨ ECDSA æ¥éªŒè¯ä¿¡æ¯çš„å®‰å…¨æ€§ã€‚</p><h3 id="ecdsaparams-name-åœ¨-node-js-ä¸­çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#ecdsaparams-name-åœ¨-node-js-ä¸­çš„ä½œç”¨"><span><code>ecdsaParams.name</code> åœ¨ Node.js ä¸­çš„ä½œç”¨</span></a></h3><p>åœ¨ Node.js çš„ Web åŠ å¯† API ä¸­ï¼Œ<code>ecdsaParams.name</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥æ˜ç¡®æŒ‡å‡ºåŠ å¯†æ“ä½œæƒ³è¦ä½¿ç”¨çš„ç®—æ³•æ˜¯ &quot;ECDSA&quot;ã€‚è¿™æ˜¯è®¾ç½®åŠ å¯†ç®—æ³•å‚æ•°æ—¶å¿…é¡»æä¾›çš„ä¿¡æ¯ä¹‹ä¸€ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦æ•°å­—ç­¾ååŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚æ¯”å¦‚ï¼Œä½ æƒ³è¦ç¡®ä¿ç”¨æˆ·å‘é€çš„æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ ECDSA ç®—æ³•ç”Ÿæˆç­¾åï¼Œå¹¶åˆ©ç”¨ <code>ecdsaParams.name</code> æ¥æŒ‡å®šä½¿ç”¨è¯¥ç®—æ³•ã€‚</p><ol><li><p><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong></p><p>é¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œè¿™å¯¹å¯†é’¥å°†ç”¨äºç­¾åå’ŒéªŒè¯è¿‡ç¨‹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿™é‡Œä½¿ç”¨ ecdsaParams.name æ¥æŒ‡å®šç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿™æ˜¯é€‰æ‹©çš„æ¤­åœ†æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç”Ÿæˆæ•°å­—ç­¾å</strong></p><p>ä½¿ç”¨ä½ çš„ç§é’¥å¯¹æ•°æ®ç”Ÿæˆæ•°å­—ç­¾åã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šå“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ç”Ÿæˆçš„ç§é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // å¾…ç­¾åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>éªŒè¯ç­¾å</strong></p><p>æœ€åï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ä½ çš„å…¬é’¥æ¥éªŒè¯ç­¾åï¼Œç¡®ä¿æ•°æ®çš„çœŸå®æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifySignature</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // å’Œç­¾åæ—¶ç›¸åŒçš„å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å…¬é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æä¾›çš„ç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // åŸå§‹æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡è¿™ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>ecdsaParams.name</code> å¦‚ä½•åœ¨ä½¿ç”¨ ECDSA ç®—æ³•è¿›è¡ŒåŠ å¯†æ“ä½œä¸­æ‰®æ¼”é‡è¦è§’è‰²ã€‚ä»ç”Ÿæˆå¯†é’¥å¯¹åˆ°ç­¾åå’ŒéªŒè¯æ•°æ®ï¼Œ<code>ecdsaParams.name</code> ç¡®ä¿äº†æ­£ç¡®çš„ç®—æ³•è¢«åº”ç”¨äºå„ä¸ªé˜¶æ®µã€‚</p><h3 id="class-eckeygenparams" tabindex="-1"><a class="header-anchor" href="#class-eckeygenparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-eckeygenparams" target="_blank" rel="noopener noreferrer">Class: EcKeyGenParams</a></span></a></h3><p>Node.js åœ¨å…¶ Web Crypto API ä¸­å¼•å…¥äº† <code>EcKeyGenParams</code> ç±»ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸æ¤­åœ†æ›²çº¿åŠ å¯†ç›¸å…³çš„åŠŸèƒ½ã€‚åœ¨è§£é‡Šè¿™ä¸ªç±»ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç†è§£ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†å’Œç›¸å…³æ¦‚å¿µã€‚</p><h3 id="æ¤­åœ†æ›²çº¿åŠ å¯†-ecc" tabindex="-1"><a class="header-anchor" href="#æ¤­åœ†æ›²çº¿åŠ å¯†-ecc"><span>æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰</span></a></h3><p>æ¤­åœ†æ›²çº¿åŠ å¯†æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†æŠ€æœ¯ï¼Œå®ƒåŸºäºæ¤­åœ†æ›²çº¿æ•°å­¦ã€‚ä¸ä¼ ç»Ÿçš„ RSA åŠ å¯†ç›¸æ¯”ï¼ŒECC å¯ä»¥ä½¿ç”¨æ›´çŸ­çš„å¯†é’¥æä¾›ç›¸åŒçº§åˆ«çš„å®‰å…¨æ€§ï¼Œè¿™æ„å‘³ç€åœ¨æ‰§è¡Œæ“ä½œæ—¶å¯ä»¥æ›´å¿«ï¼Œä¸”éœ€è¦çš„å­˜å‚¨ç©ºé—´æ›´å°‘ã€‚</p><h3 id="node-js-ä¸­çš„-eckeygenparams" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-eckeygenparams"><span>Node.js ä¸­çš„ EcKeyGenParams</span></a></h3><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>EcKeyGenParams</code> æ˜¯ç”¨äºç”Ÿæˆæ¤­åœ†æ›²çº¿å¯†é’¥å¯¹çš„å‚æ•°ç±»ã€‚å½“ä½ æƒ³åˆ©ç”¨ ECC åˆ›å»ºå¯†é’¥å¯¹æ—¶ï¼Œå°±ä¼šç”¨åˆ°å®ƒã€‚</p><p><code>EcKeyGenParams</code> éœ€è¦ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><strong>name</strong>: è¿™ä¸ªå‚æ•°å›ºå®šä¸º <code>&quot;ECDH&quot;</code> æˆ– <code>&quot;ECDSA&quot;</code>ï¼Œåˆ†åˆ«ä»£è¡¨ä¸¤ç§ç”¨é€”ï¼šECDH ç”¨äºå¯†é’¥äº¤æ¢ï¼Œè€Œ ECDSA ç”¨äºæ•°å­—ç­¾åã€‚</li><li><strong>namedCurve</strong>: æŒ‡å®šä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ã€‚å¸¸è§çš„æ›²çº¿æœ‰ <code>&quot;P-256&quot;</code>, <code>&quot;P-384&quot;</code>, å’Œ <code>&quot;P-521&quot;</code>ã€‚ä¸åŒçš„æ›²çº¿å…·æœ‰ä¸åŒçš„å®‰å…¨çº§åˆ«å’Œæ€§èƒ½ç‰¹æ€§ã€‚</li></ul><h3 id="å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹"><span>å®ä¾‹</span></a></h3><p>å‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªç”¨äºæ•°å­—ç­¾åçš„æ¤­åœ†æ›²çº¿å¯†é’¥å¯¹ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><ol><li>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ Node.js çš„ <code>crypto</code> æ¨¡å—ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ <code>subtle.generateKey</code> æ–¹æ³•ç”Ÿæˆå¯†é’¥å¯¹ï¼ŒåŒæ—¶æŒ‡å®š <code>EcKeyGenParams</code> å‚æ•°ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Public Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Private Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š</p><ul><li>æˆ‘ä»¬è°ƒç”¨ <code>webcrypto.subtle.generateKey</code> æ–¹æ³•æ¥ç”Ÿæˆå¯†é’¥å¯¹ã€‚</li><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>EcKeyGenParams</code> å¯¹è±¡ï¼Œæˆ‘ä»¬æŒ‡å®š <code>&quot;ECDSA&quot;</code> ä½œä¸ºåŠ å¯†æ–¹æ³•ï¼Œ<code>&quot;P-256&quot;</code> ä½œä¸ºæ¤­åœ†æ›²çº¿ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•° <code>true</code> è¡¨ç¤ºç”Ÿæˆçš„å¯†é’¥å¯¹å¯ä»¥å¯¼å‡ºã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ•°ç»„ <code>[&quot;sign&quot;, &quot;verify&quot;]</code> æŒ‡å®šäº†å¯†é’¥å¯¹çš„ç”¨é€”ï¼Œå³ç­¾åå’ŒéªŒè¯ã€‚</li></ul><p>è¿™æ ·ï¼Œä½ å°±æˆåŠŸç”Ÿæˆäº†ä¸€ä¸ªæ¤­åœ†æ›²çº¿å¯†é’¥å¯¹ï¼Œå¯ç”¨äº ECDSA æ•°å­—ç­¾åå’ŒéªŒè¯ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js çš„ Web Crypto API æä¾›äº†ä¸€ä¸ªéå¸¸å¼ºå¤§ä¸”çµæ´»çš„æ¥å£ï¼Œä½¿å¾—åœ¨ JS åº”ç”¨ä¸­å®ç°é«˜çº§åŠ å¯†æ“ä½œå˜å¾—ç›´æ¥ä¸”ç®€æ´ã€‚æ— è®ºæ˜¯åœ¨æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œä½ éƒ½å¯ä»¥åˆ©ç”¨è¿™äº›åŠŸèƒ½æ¥å¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h4 id="eckeygenparams-name" tabindex="-1"><a class="header-anchor" href="#eckeygenparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#eckeygenparamsname" target="_blank" rel="noopener noreferrer">ecKeyGenParams.name</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>ecKeyGenParams.name</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®º Web åŠ å¯† API ä¸­çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ä¸ç”Ÿæˆæ¤­åœ†æ›²çº¿ï¼ˆECï¼‰å¯†é’¥å¯¹ç›¸å…³çš„é…ç½®ã€‚åœ¨ç‰ˆæœ¬ 21.7.1 çš„ Node.js æ–‡æ¡£ä¸­ï¼Œ<code>ecKeyGenParams.name</code>æŒ‡çš„æ˜¯åœ¨ç”Ÿæˆæ¤­åœ†æ›²çº¿å¯†é’¥æ—¶ç”¨äºæŒ‡å®šæ¤­åœ†æ›²çº¿ç®—æ³•åç§°çš„å±æ€§ã€‚</p><h3 id="åŸºæœ¬è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è§£é‡Š-1"><span>åŸºæœ¬è§£é‡Š</span></a></h3><p>åœ¨ Web åŠ å¯† API ä¸­ï¼Œ<code>ecKeyGenParams</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºé…ç½®ç”Ÿæˆæ¤­åœ†æ›²çº¿å¯†é’¥å¯¹çš„å‚æ•°ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«å¤šä¸ªå±æ€§ï¼Œå…¶ä¸­<code>name</code>å±æ€§ç”¨æ¥æŒ‡å®šä½¿ç”¨å“ªç§æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåå­—è®¾ç½®ä¸º<code>&quot;ECDH&quot;</code>æˆ–è€…<code>&quot;ECDSA&quot;</code>ï¼Œåˆ†åˆ«ä»£è¡¨æ¤­åœ†æ›²çº¿ Diffie-Hellman ç®—æ³•å’Œæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ã€‚</p><h3 id="å®é™…è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨"><span>å®é™…è¿ç”¨</span></a></h3><h4 id="ç”Ÿæˆå¯†é’¥å¯¹" tabindex="-1"><a class="header-anchor" href="#ç”Ÿæˆå¯†é’¥å¯¹"><span>ç”Ÿæˆå¯†é’¥å¯¹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†æŠ€æœ¯æ¥ç”Ÿæˆå…¬é’¥å’Œç§é’¥ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨<code>ecKeyGenParams</code>ç”Ÿæˆæ¤­åœ†æ›²çº¿å¯†é’¥å¯¹çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> ecKeyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ECDHç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">    namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨P-256æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    ecKeyGenParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯å¯¼å‡ºæ€§</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">deriveBits</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å…è®¸çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨keyPairåšä¸€äº›äº‹æƒ…...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šçŸ¥ subtle crypto API æˆ‘ä»¬å¸Œæœ›ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯†é’¥å¯¹ã€‚æˆ‘ä»¬æŒ‡å®šäº†ä½¿ç”¨<code>&quot;ECDH&quot;</code>ç®—æ³•ï¼Œå¹¶é€‰æ‹©äº†<code>&quot;P-256&quot;</code>ä½œä¸ºæ¤­åœ†æ›²çº¿ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨<code>subtle.generateKey</code>æ–¹æ³•æ¥å®é™…ç”Ÿæˆå¯†é’¥å¯¹ã€‚</p><h4 id="å¯†é’¥äº¤æ¢" tabindex="-1"><a class="header-anchor" href="#å¯†é’¥äº¤æ¢"><span>å¯†é’¥äº¤æ¢</span></a></h4><p>æ¤­åœ†æ›²çº¿å¯†é’¥å¯¹å¹¿æ³›ç”¨äºå¯†é’¥äº¤æ¢åè®®ï¼Œä¾‹å¦‚åœ¨ä¸¤ä¸ªé€šä¿¡æ–¹ä¹‹é—´å®‰å…¨åœ°å…±äº«å¯†é’¥ã€‚ä½¿ç”¨ ECDH ç®—æ³•ï¼Œæ¯ä¸€æ–¹éƒ½å¯ä»¥ç”Ÿæˆè‡ªå·±çš„å¯†é’¥å¯¹ï¼Œå¹¶äº¤æ¢å…¬é’¥ã€‚é€šè¿‡å°†å„è‡ªçš„ç§é’¥å’Œå¯¹æ–¹çš„å…¬é’¥ç»“åˆï¼ŒåŒæ–¹éƒ½èƒ½ç‹¬ç«‹è®¡ç®—å‡ºä¸€ä¸ªç›¸åŒçš„ç§˜å¯†ï¼Œè€Œä¸éœ€è¦ç›´æ¥ä¼ é€’è¿™ä¸ªç§˜å¯†ã€‚</p><h3 id="ç»“è®º-4" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-4"><span>ç»“è®º</span></a></h3><p><code>ecKeyGenParams.name</code>åœ¨ Node.js çš„ Web åŠ å¯† API ä¸­æ‰®æ¼”ç€æŒ‡å®šåŠ å¯†ç®—æ³•ç±»å‹çš„è§’è‰²ã€‚é€šè¿‡æ­£ç¡®åœ°è®¾å®šè¿™ä¸ªå‚æ•°ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†æŠ€æœ¯æ¥æ‰§è¡Œè¯¸å¦‚å¯†é’¥ç”Ÿæˆã€æ•°æ®åŠ å¯†ã€æ•°å­—ç­¾åç­‰æ“ä½œï¼Œè¿›è€Œå®ç°å®‰å…¨çš„æ•°æ®ä¼ è¾“å’Œè®¤è¯ã€‚</p><h4 id="eckeygenparams-namedcurve" tabindex="-1"><a class="header-anchor" href="#eckeygenparams-namedcurve"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#eckeygenparamsnamedcurve" target="_blank" rel="noopener noreferrer">ecKeyGenParams.namedCurve</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>[ecKeyGenParams.namedCurve](https://nodejs.org/docs/latest/api/webcrypto.html#eckeygenparamsnamedcurve)</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®º Web åŠ å¯† APIï¼ˆä¹Ÿç§°ä¸º WebCryptoï¼‰ä¸­ä¸€ä¸ªç‰¹å®šåŠŸèƒ½çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªåŠŸèƒ½æ¶‰åŠåˆ°ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰æ¥ç”Ÿæˆå¯†é’¥å¯¹ã€‚åœ¨è§£é‡Š <code>namedCurve</code> å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼š</p><ol><li><strong>Web åŠ å¯† API (WebCrypto):</strong> ä¸€ç§æµè§ˆå™¨æä¾›çš„ JavaScript æ¥å£ï¼Œå…è®¸å¼€å‘è€…æ‰§è¡ŒåŸºæœ¬çš„åŠ å¯†æ“ä½œï¼Œæ¯”å¦‚ç”Ÿæˆå¯†é’¥ã€åŠ å¯†å’Œè§£å¯†æ•°æ®ç­‰ï¼Œè€Œä¸éœ€è¦ç¬¬ä¸‰æ–¹åº“ã€‚</li><li><strong>Node.js:</strong> æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å¾ˆå¤šæµè§ˆå™¨ç«¯çš„ APIï¼ŒåŒ…æ‹¬ WebCryptoã€‚</li><li><strong>æ¤­åœ†æ›²çº¿åŠ å¯† (ECC):</strong> ä¸€ç§å…¬é’¥åŠ å¯†æŠ€æœ¯ï¼Œç›¸è¾ƒäºå…¶ä»–ç®—æ³•ï¼Œåœ¨ä¿æŒç›¸åŒå®‰å…¨çº§åˆ«çš„å‰æä¸‹ï¼Œå®ƒå¯ä»¥ä½¿ç”¨æ›´çŸ­çš„å¯†é’¥ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</li></ol><h3 id="namedcurve-å±æ€§" tabindex="-1"><a class="header-anchor" href="#namedcurve-å±æ€§"><span>namedCurve å±æ€§</span></a></h3><p>å½“ä½ æƒ³ä½¿ç”¨ ECC æ¥ç”Ÿæˆå¯†é’¥å¯¹æ—¶ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€æ¡å…·ä½“çš„æ¤­åœ†æ›²çº¿ã€‚è¿™å°±æ˜¯ <code>namedCurve</code> å±æ€§çš„ä½œç”¨ â€”â€” å®ƒæŒ‡å®šäº†è¦ä½¿ç”¨çš„æ›²çº¿çš„åç§°ã€‚æœ‰å¤šç§æ›²çº¿å¯ä¾›é€‰æ‹©ï¼Œæ¯ç§æ›²çº¿éƒ½æœ‰è‡ªå·±çš„ç”¨é€”å’Œä¼˜ç‚¹ï¼Œä½†æœ€å¸¸è§çš„åŒ…æ‹¬ <code>P-256</code>ã€<code>P-384</code> å’Œ <code>P-521</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-13"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“ä¿¡æ¯çš„èŠå¤©åº”ç”¨ã€‚ä½ å†³å®šä½¿ç”¨ ECC ç”Ÿæˆå¯†é’¥å¯¹ï¼Œä»¥ä¾¿åŒæ–¹å¯ä»¥å®‰å…¨åœ°äº¤æ¢ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Node.js å’Œ <code>namedCurve</code> å±æ€§æ¥è¾¾æˆè¿™ä¸€ç‚¹çš„ç®€åŒ–ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ä½¿ç”¨ P-256 æ›²çº¿ç”Ÿæˆ ECC å¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span></span>
<span class="line"><span style="color:#88C0D0;">        name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šåŠ å¯†ç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">        namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨çš„æ¤­åœ†æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦æå–å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">deriveBits</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯ç”¨æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥å¯¹ç”ŸæˆæˆåŠŸ!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥å¯¹ç”Ÿæˆå¤±è´¥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>crypto</code> æ¨¡å—ä¸­çš„ <code>webcrypto</code> å¯¹è±¡ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>generateKeyPair</code> ç”¨äºç”Ÿæˆå¯†é’¥å¯¹ã€‚é€šè¿‡è°ƒç”¨ <code>subtle.generateKey</code> æ–¹æ³•å¹¶æŒ‡å®š <code>ECDH</code> ç®—æ³•å’Œ <code>P-256</code> æ›²çº¿ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª ECC å¯†é’¥å¯¹ã€‚æ­¤å¯†é’¥å¯¹å¯ç”¨äºåŠ å¯†é€šä¿¡ï¼Œå¦‚åœ¨ä¸¤ä¸ªç”¨æˆ·é—´å®‰å…¨åœ°äº¤æ¢ä¿¡æ¯ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>namedCurve</code> å±æ€§å…è®¸ä½ åœ¨ä½¿ç”¨ ECC ç”Ÿæˆå¯†é’¥å¯¹æ—¶é€‰æ‹©ç‰¹å®šçš„æ¤­åœ†æ›²çº¿ã€‚ä¸åŒçš„æ›²çº¿æ»¡è¶³ä¸åŒçš„å®‰å…¨æ€§å’Œæ•ˆç‡éœ€æ±‚ï¼Œå› æ­¤åœ¨å®é™…åº”ç”¨ä¸­é€‰æ‹©åˆé€‚çš„æ›²çº¿éå¸¸é‡è¦ã€‚</p><h3 id="class-eckeyimportparams" tabindex="-1"><a class="header-anchor" href="#class-eckeyimportparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-eckeyimportparams" target="_blank" rel="noopener noreferrer">Class: EcKeyImportParams</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>EcKeyImportParams</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®º Web åŠ å¯† API çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚åœ¨è§£é‡Šè¿™ä¸ªç±»ä¹‹å‰ï¼Œæœ‰å¿…è¦ç†è§£ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-3"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><strong>Node.js</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ JavaScript ç¯å¢ƒï¼Œå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚</li><li><strong>Web Crypto API</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªåœ¨ Web åº”ç”¨ä¸­æ‰§è¡ŒåŠ å¯†æ“ä½œçš„ APIã€‚å®ƒæä¾›äº†å¾ˆå¤šåŠ å¯†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”Ÿæˆå¯†é’¥ã€åŠ å¯†/è§£å¯†æ•°æ®ç­‰ã€‚</li><li><strong>åŠ å¯†</strong>ï¼šåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œè¿™æŒ‡çš„æ˜¯å°†ä¿¡æ¯è½¬æ¢æˆä¸€ç§åªæœ‰æ‹¥æœ‰ç‰¹å®šå¯†é’¥çš„äººæ‰èƒ½ç†è§£çš„æ ¼å¼ï¼Œä»¥ä¿æŠ¤è¿™äº›ä¿¡æ¯ä¸è¢«æœªæˆæƒçš„äººçœ‹åˆ°ã€‚</li><li><strong>ECCï¼ˆæ¤­åœ†æ›²çº¿åŠ å¯†ï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ç§ä½¿ç”¨æ¤­åœ†æ›²çº¿æ•°å­¦æ¥å®ç°çš„åŠ å¯†æŠ€æœ¯ï¼Œå¹¿æ³›åº”ç”¨äºåˆ›å»ºå®‰å…¨è¿æ¥ä¸­ã€‚</li></ol><h3 id="eckeyimportparams-è¯¦ç»†è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#eckeyimportparams-è¯¦ç»†è§£é‡Š"><span>EcKeyImportParams - è¯¦ç»†è§£é‡Š</span></a></h3><p>åœ¨ Node.js çš„<code>webcrypto</code>æ¨¡å—ä¸­ï¼Œ<code>EcKeyImportParams</code>æ˜¯ä¸€ä¸ªç”¨äºå¯¼å…¥æ¤­åœ†æ›²çº¿ï¼ˆECï¼‰å¯†é’¥çš„ç±»ã€‚å½“ä½ æƒ³é€šè¿‡ Web Crypto API å¯¼å…¥ EC å¯†é’¥æ—¶ï¼Œéœ€è¦æä¾›ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°å°±é€šè¿‡<code>EcKeyImportParams</code>ç±»çš„å®ä¾‹æ¥æŒ‡å®šã€‚</p><h4 id="å‚æ•°åŒ…æ‹¬" tabindex="-1"><a class="header-anchor" href="#å‚æ•°åŒ…æ‹¬"><span>å‚æ•°åŒ…æ‹¬ï¼š</span></a></h4><ul><li><strong>name</strong>: è¿™æ˜¯åŠ å¯†æ“ä½œçš„åç§°ï¼Œåœ¨ä½¿ç”¨ EC å¯†é’¥æ—¶ï¼Œå®ƒé€šå¸¸è¢«è®¾ç½®ä¸º<code>&quot;ECDH&quot;</code>æˆ–<code>&quot;ECDSA&quot;</code>ï¼Œåˆ†åˆ«ä»£è¡¨æ¤­åœ†æ›²çº¿ Diffie-Hellman å’Œæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ã€‚</li><li><strong>namedCurve</strong>: è¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„å‚æ•°ï¼Œå®ƒæŒ‡å®šäº†å°†è¦ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ã€‚å¸¸è§çš„å€¼æœ‰<code>&quot;P-256&quot;</code>, <code>&quot;P-384&quot;</code>, å’Œ<code>&quot;P-521&quot;</code>ã€‚è¿™äº›æ›²çº¿æœ‰ä¸åŒçš„å®‰å…¨çº§åˆ«å’Œæ€§èƒ½è¡¨ç°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-16"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡å¦‚ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨æ•°æ®ä¼ è¾“çš„ Web åº”ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿æ”¯ä»˜ç³»ç»Ÿã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦äº¤æ¢æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ä¿¡ç”¨å¡å·ç ã€‚ä¸ºäº†ä¿è¯è¿™äº›ä¿¡æ¯çš„å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ EC åŠ å¯†æŠ€æœ¯ã€‚</p><h4 id="å¯¼å…¥-ec-å¯†é’¥ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å¯¼å…¥-ec-å¯†é’¥ç¤ºä¾‹"><span>å¯¼å…¥ EC å¯†é’¥ç¤ºä¾‹ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> importKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">pem</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†PEMæ ¼å¼çš„å¯†é’¥è½¬æ¢ä¸ºé€‚ç”¨äºWebCryptoçš„æ ¼å¼...</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span><span style="color:#616E88;"> // PEMè½¬æ¢é€»è¾‘</span></span>
<span class="line"><span style="color:#616E88;">  //à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰à¸¡à¸²à¸ˆà¸²à¸ Cherrychat à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰à¹€à¸à¸·à¹ˆà¸­à¸à¸²à¸£à¸à¸²à¸“à¸´à¸Šà¸¢à¹Œ</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> ecKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &#39;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æˆ–&quot;jwk&quot;ç­‰ï¼Œå–å†³äºkeyDataçš„æ ¼å¼</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyData</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯æå–</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯è¿›è¡Œçš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> ecKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾å·²ç»æœ‰äº†ä¸€ä¸ªä»¥ PEM æ ¼å¼å­˜åœ¨çš„ EC ç§é’¥ï¼Œå¹¶å¸Œæœ›å°†å…¶å¯¼å…¥åˆ°æˆ‘ä»¬çš„ Node.js åº”ç”¨ä¸­ï¼Œä»¥ä¾¿ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„æ•°æ®ä¼ è¾“é€šé“ã€‚<code>importKey</code>å‡½æ•°æ¥å—åŸå§‹å¯†é’¥æ•°æ®ï¼ŒæŒ‡æ˜ä½¿ç”¨<code>&#39;ECDH&#39;</code>ç®—æ³•å’Œ<code>&#39;P-256&#39;</code>æ›²çº¿ï¼Œå¹¶ä¸”è®¾å®šè¯¥å¯†é’¥å¯ç”¨æ¥æ´¾ç”Ÿå‡ºå…¶ä»–å¯†é’¥ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿åœ¨ä¸€ä¸ªå¼€æ”¾çš„ç½‘ç»œä¸­ä¼ è¾“æ•°æ®ï¼Œä½¿ç”¨ EC åŠ å¯†ä¹Ÿèƒ½ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼Œå¯¹äºæ„å»ºç°ä»£å®‰å…¨çš„ Web åº”ç”¨è‡³å…³é‡è¦ã€‚</p><h4 id="eckeyimportparams-name" tabindex="-1"><a class="header-anchor" href="#eckeyimportparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#eckeyimportparamsname" target="_blank" rel="noopener noreferrer">ecKeyImportParams.name</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚å®ƒæ‹¥æœ‰ä¸€ä¸ªä¸°å¯Œçš„æ¨¡å—ç”Ÿæ€ç³»ç»Ÿï¼Œä½¿å¾—å¼€å‘å„ç§ç±»å‹çš„åº”ç”¨å˜å¾—æ›´åŠ å¿«æ·å’Œæ–¹ä¾¿ã€‚</p><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>ecKeyImportParams.name</code> æ˜¯ä¸å¯¼å…¥æ¤­åœ†æ›²çº¿ï¼ˆElliptic Curve, ECï¼‰å¯†é’¥ç›¸å…³çš„ä¸€ä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ç®—æ³•çš„åç§°ã€‚</p><h3 id="æ¤­åœ†æ›²çº¿åŠ å¯†-ecc-1" tabindex="-1"><a class="header-anchor" href="#æ¤­åœ†æ›²çº¿åŠ å¯†-ecc-1"><span>æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰</span></a></h3><p>æ¤­åœ†æ›²çº¿åŠ å¯†æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†æŠ€æœ¯ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„ RSA åŠ å¯†æ–¹å¼ï¼Œå®ƒèƒ½åœ¨è¾ƒçŸ­çš„å¯†é’¥é•¿åº¦ä¸‹æä¾›ç›¸åŒæˆ–æ›´é«˜çš„å®‰å…¨æ€§ï¼Œå› æ­¤åœ¨å¾ˆå¤šç°ä»£åŠ å¯†åœºæ™¯ä¸­è¢«å¹¿æ³›é‡‡ç”¨ã€‚</p><h3 id="eckeyimportparams" tabindex="-1"><a class="header-anchor" href="#eckeyimportparams"><span><code>ecKeyImportParams</code></span></a></h3><p>å½“ä½ æƒ³é€šè¿‡ Node.js çš„ Web Crypto API å¯¼å…¥ä¸€ä¸ªæ¤­åœ†æ›²çº¿å¯†é’¥æ—¶ï¼Œä½ éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«ç‰¹å®šå±æ€§çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æ‰€è°“çš„ <code>ecKeyImportParams</code>ã€‚å…¶ä¸­æœ€é‡è¦çš„å±æ€§ä¹‹ä¸€æ˜¯ <code>name</code>ï¼Œå®ƒå®šä¹‰äº†æ¤­åœ†æ›²çº¿ç®—æ³•çš„åç§°ï¼Œä¾‹å¦‚ <code>&quot;ECDH&quot;</code> æˆ– <code>&quot;ECDSA&quot;</code>ã€‚</p><ul><li><strong><code>&quot;ECDH&quot;</code></strong>ï¼šæ¤­åœ†æ›²çº¿ Diffie-Hellman å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œç”¨äºå®‰å…¨åœ°äº¤æ¢å¯†é’¥ä¿¡æ¯ã€‚</li><li><strong><code>&quot;ECDSA&quot;</code></strong>ï¼šæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼Œç”¨äºåˆ›å»ºæ•°æ®ç­¾åï¼Œä»¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦æ•°æ®åŠ å¯†åŠŸèƒ½çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å†³å®šä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†æŠ€æœ¯æ¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>ECDSA</code> ç®—æ³•ä¸ºå‘é€çš„æ¶ˆæ¯åˆ›å»ºæ•°å­—ç­¾åï¼Œä»¥ç¡®ä¿æ¶ˆæ¯çš„å®Œæ•´æ€§å’Œé˜²æ­¢ç¯¡æ”¹ã€‚</p><ol><li><p><strong>åˆ›å»º ECDSA ç­¾å</strong></p><ul><li>é¦–å…ˆï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª EC çš„å¯†é’¥å¯¹ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ã€‚</li><li>ä½¿ç”¨ç§é’¥æ¥ç”Ÿæˆæ¶ˆæ¯çš„ç­¾åã€‚</li></ul></li><li><p><strong>éªŒè¯ç­¾å</strong></p><ul><li>æ¥æ”¶æ–¹å¯ä»¥ä½¿ç”¨ç›¸åº”çš„å…¬é’¥æ¥éªŒè¯æ¶ˆæ¯ç­¾åçš„çœŸå®æ€§ï¼Œç¡®ä¿æ¶ˆæ¯æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</li></ul></li></ol><p>åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·æ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeys</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keys</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨çš„æ¤­åœ†æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keys</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šå“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ç§é’¥è¿›è¡Œç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9;">    message</span><span style="color:#616E88;"> // å¾…ç­¾åçš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> message</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Your message here</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> signMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ <code>subtle.generateKey</code> æ–¹æ³•ç”Ÿæˆäº†ä¸€å¯¹ ECDSA å¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼Œç„¶åä½¿ç”¨ç§é’¥å¯¹ä¸€æ¡æ¶ˆæ¯è¿›è¡Œç­¾åã€‚è¿™ä»…ä»…æ˜¯ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†æŠ€æœ¯åœ¨ Node.js ä¸­çš„ä¸€ä¸ªéå¸¸åŸºç¡€çš„åº”ç”¨åœºæ™¯ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜å¯èƒ½æ¶‰åŠåˆ°å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨å¯†é’¥ã€å¦‚ä½•äº¤æ¢å…¬é’¥ç­‰é—®é¢˜ã€‚</p><h4 id="eckeyimportparams-namedcurve" tabindex="-1"><a class="header-anchor" href="#eckeyimportparams-namedcurve"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#eckeyimportparamsnamedcurve" target="_blank" rel="noopener noreferrer">ecKeyImportParams.namedCurve</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>ecKeyImportParams.namedCurve</code> å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯åœ¨å¤„ç†åŠ å¯†æ“ä½œæ—¶ç”¨åˆ°çš„ï¼Œç‰¹åˆ«æ˜¯å½“ä½ åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼ˆECCï¼‰æ“ä½œæ—¶ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-6" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-6"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ã€‚ECCï¼ˆElliptic-Curve Cryptographyï¼‰æ˜¯ä¸€ç§åŠ å¯†æŠ€æœ¯ï¼Œå®ƒåŸºäºæ•°å­¦ä¸­çš„æ¤­åœ†æ›²çº¿ç†è®ºã€‚ä¸ RSA ç­‰ä¼ ç»ŸåŠ å¯†æŠ€æœ¯ç›¸æ¯”ï¼ŒECC å¯ä»¥ç”¨æ›´çŸ­çš„å¯†é’¥æä¾›åŒç­‰çº§åˆ«çš„å®‰å…¨æ€§ï¼Œå› æ­¤å®ƒå¸¸è¢«ç”¨äºéœ€è¦é«˜å®‰å…¨æ€§ä½†èµ„æºåˆæœ‰é™çš„ç¯å¢ƒä¸­ï¼Œå¦‚ç§»åŠ¨è®¾å¤‡ã€æ™ºèƒ½å¡ç­‰ã€‚</p><p>åœ¨ä½¿ç”¨ Web Crypto API çš„ <code>SubtleCrypto.importKey</code> æ–¹æ³•å¯¼å…¥æ¤­åœ†æ›²çº¿å¯†é’¥æ—¶ï¼Œ<code>ecKeyImportParams</code> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å‚æ•°å¯¹è±¡ã€‚å…¶ä¸­ï¼Œ<code>namedCurve</code> å±æ€§æŒ‡å®šäº†è¦ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿çš„åç§°ã€‚</p><h3 id="namedcurve-å±æ€§-1" tabindex="-1"><a class="header-anchor" href="#namedcurve-å±æ€§-1"><span><code>namedCurve</code> å±æ€§</span></a></h3><p><code>namedCurve</code> å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒæ ‡è¯†äº†ä¸€ç§ç‰¹å®šçš„æ¤­åœ†æ›²çº¿ã€‚åœ¨ ECC åŠ å¯†ä¸­ï¼Œä¸åŒçš„æ¤­åœ†æ›²çº¿æœ‰ç€ä¸åŒçš„ç‰¹ç‚¹å’Œç”¨é€”ã€‚Node.js æ”¯æŒå¤šç§æ›²çº¿ï¼Œä¾‹å¦‚ï¼š<code>P-256</code>ã€<code>P-384</code>ã€<code>P-521</code> ç­‰ã€‚é€‰æ‹©ä½•ç§æ›²çº¿å–å†³äºä½ çš„å®‰å…¨éœ€æ±‚å’Œæ€§èƒ½è€ƒè™‘ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æƒ³åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å®‰å…¨åœ°äº¤æ¢ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ECC ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œå¹¶å°†å…¬é’¥å‘é€ç»™é€šä¿¡çš„å¦ä¸€æ–¹ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ <code>ecKeyImportParams.namedCurve</code> æ¥å¯¼å…¥ä¸€ä¸ªæ¤­åœ†æ›²çº¿å…¬é’¥çš„ç®€å•ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> importECPublicKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">pem</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è¿™æ˜¯ä¸€ä¸ªä»PEMæ ¼å¼è½¬æ¢ä¸ºArrayBufferçš„å‡½æ•°ï¼Œå‡è®¾å·²å®ç°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> pemToArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">pem</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> ecKeyImportParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECDH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨P-256æ¤­åœ†æ›²çº¿</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å‡è®¾å…¬é’¥ä»¥åŸå§‹æ ¼å¼æä¾›</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyBuffer</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    ecKeyImportParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [] </span><span style="color:#616E88;">// è¯¥å…¬é’¥æœªè®¾è®¡ç”¨äºåŠ å¯†æˆ–è§£å¯†æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>importECPublicKey</code> å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ª PEM æ ¼å¼çš„å…¬é’¥å¹¶ä½¿ç”¨ <code>subtle.importKey</code> æ–¹æ³•æ¥å¯¼å…¥å®ƒã€‚åœ¨è°ƒç”¨ <code>importKey</code> æ—¶ï¼Œæˆ‘ä»¬æä¾›äº† <code>ecKeyImportParams</code> å¯¹è±¡ï¼Œå…¶ <code>namedCurve</code> å±æ€§è®¾ç½®ä¸º <code>&#39;P-256&#39;</code>ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬æ‰“ç®—ä½¿ç”¨ P-256 æ›²çº¿ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ç®¡ç†å’Œä½¿ç”¨æ¤­åœ†æ›²çº¿å¯†é’¥è¿›è¡Œå„ç§åŠ å¯†æ“ä½œã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ç»§ç»­æé—®ã€‚</p><h3 id="class-ed448params" tabindex="-1"><a class="header-anchor" href="#class-ed448params"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-ed448params" target="_blank" rel="noopener noreferrer">Class: Ed448Params</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript çš„å¹³å°ï¼Œå®ƒä½¿å¾—ä½¿ç”¨ JavaScript å¼€å‘åç«¯åº”ç”¨æˆä¸ºå¯èƒ½ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®çš„æ¨¡å—å’Œç±»ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ–‡ä»¶æ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚å…¶ä¸­ï¼ŒWeb Crypto API æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªç”¨äºæ‰§è¡Œå„ç§åŠ å¯†æ“ä½œçš„ APIï¼Œè€Œ<code>Ed448Params</code>æ˜¯è¿™ä¸ª API ä¸­çš„ä¸€ä¸ªç±»ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†ä¸ Ed448 ç›¸å…³çš„å‚æ•°ã€‚</p><h3 id="ed448-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ed448-ç®€ä»‹"><span>Ed448 ç®€ä»‹</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Ed448ã€‚Ed448 æ˜¯ä¸€ç§æ•°å­—ç­¾åç®—æ³•ï¼Œå±äºå…¬é’¥åŠ å¯†æŠ€æœ¯çš„èŒƒç•´ã€‚å®ƒç”¨äºç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒéªŒè¯èº«ä»½ï¼Œå¸¸è§äºå®‰å…¨é€šä¿¡åè®®ä¸­ã€‚Ed448 æ˜¯å¯¹ EdDSAï¼ˆEdwards-curve Digital Signature Algorithmï¼‰ç­¾åç®—æ³•çš„å®ç°ä¹‹ä¸€ï¼Œä½¿ç”¨ Edwards25519 æˆ– Edwards448 æ›²çº¿ã€‚å®ƒè¢«è®¾è®¡æ¥æä¾›é«˜çº§åˆ«çš„å®‰å…¨æ€§å¹¶èƒ½æŠµæŠ—åŒ…æ‹¬é‡å­è®¡ç®—æœºåœ¨å†…çš„æœªæ¥å¨èƒã€‚</p><h3 id="class-ed448params-1" tabindex="-1"><a class="header-anchor" href="#class-ed448params-1"><span>Class: Ed448Params</span></a></h3><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>Ed448Params</code>æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºé…ç½® Ed448 æ“ä½œçš„ç±»ã€‚å®ƒå®šä¹‰äº†è¿›è¡Œ Ed448 ç›¸å…³æ“ä½œæ—¶éœ€è¦çš„å‚æ•°ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯-4" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-4"><span>ä½¿ç”¨åœºæ™¯</span></a></h4><p>ä½¿ç”¨<code>Ed448Params</code>ä¸»è¦å‡ºç°åœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œç­¾åæˆ–éªŒè¯ç­¾åçš„åœºæ™¯ä¸­ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>å®‰å…¨é€šä¿¡</strong>ï¼šå½“ä¸¤ä¸ªç³»ç»Ÿé€šè¿‡äº’è”ç½‘é€šä¿¡æ—¶ï¼Œä¸ºäº†éªŒè¯å½¼æ­¤èº«ä»½å¹¶ç¡®ä¿ä¼ è¾“çš„æ¶ˆæ¯æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ Ed448 ç­¾åã€‚</li><li><strong>æ–‡æ¡£ç­¾å</strong>ï¼šç¡®ä¿æ–‡ä»¶æˆ–è½¯ä»¶åŒ…çš„å®Œæ•´æ€§ï¼Œé˜²æ­¢ç¯¡æ”¹ã€‚</li></ul><h4 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„ç½‘ç»œåº”ç”¨ï¼Œä½ æƒ³ä½¿ç”¨ Ed448 è¿›è¡Œæ•°å­—ç­¾åä»¥å¢å¼ºå®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨<code>Ed448Params</code>çš„ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹æµç¨‹ï¼š</p><ol><li><p><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ä¸º Ed448 ç®—æ³•ç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚è¿™ä¸ªå¯†é’¥å¯¹ç”¨äºç­¾åå’ŒéªŒè¯è¿‡ç¨‹ã€‚</p></li><li><p><strong>åˆ›å»ºç­¾åå‚æ•°</strong>ï¼šä½¿ç”¨<code>Ed448Params</code>å®šä¹‰ç­¾åæ“ä½œæ‰€éœ€çš„å‚æ•°ã€‚åœ¨ Ed448 çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦æŒ‡å®šä½¿ç”¨çš„æ•£åˆ—å‡½æ•°æˆ–å…¶ä»–ç›¸å…³é€‰é¡¹ã€‚</p></li><li><p><strong>ç­¾åæ¶ˆæ¯</strong>ï¼šä½¿ç”¨ç§é’¥å’Œ<code>Ed448Params</code>ä¸­å®šä¹‰çš„å‚æ•°å¯¹è¦å‘é€çš„æ¶ˆæ¯è¿›è¡Œç­¾åã€‚</p></li><li><p><strong>éªŒè¯ç­¾å</strong>ï¼šæ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬é’¥å’Œç›¸åŒçš„å‚æ•°è®¾ç½®æ¥éªŒè¯æ¶ˆæ¯ç­¾åçš„åˆæ³•æ€§ã€‚</p></li></ol><p>ç”±äº<code>Ed448Params</code>åœ¨å…·ä½“ä»£ç å®ç°ä¸­æ¶‰åŠåˆ°äº† Node.js çš„ Web Crypto APIï¼Œè¿™ä¸ª API çš„ä½¿ç”¨å¯èƒ½ä¼šç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ä¸€å®šçš„åŠ å¯†çŸ¥è¯†å’Œå¯¹ Node.js å¼‚æ­¥ç¼–ç¨‹çš„ç†è§£ã€‚ä½†åŸºæœ¬æ¦‚å¿µå°±æ˜¯ä½ åˆ›å»ºå‚æ•°å¯¹è±¡ï¼Œç„¶ååœ¨åŠ å¯†æ“ä½œä¸­ä½¿ç”¨å®ƒã€‚</p><p>æ³¨æ„ï¼Œæˆ‘æä¾›çš„åªæ˜¯ä¸€ä¸ªæ¦‚å¿µæ€§è¯´æ˜ï¼Œå¹¶æ²¡æœ‰æ·±å…¥åˆ°å…·ä½“çš„ä»£ç å®ç°é‡Œï¼Œå› ä¸ºè¿™å°†ä¾èµ–äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œ Node.js çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ å¯¹å¦‚ä½•åœ¨ä»£ç å±‚é¢å®ç°æ„Ÿå…´è¶£ï¼Œæˆ‘å»ºè®®æŸ¥çœ‹ Node.js çš„å®˜æ–¹æ–‡æ¡£ï¼Œå®ƒæä¾›äº†å¤§é‡çš„ç¤ºä¾‹å’Œè¯¦ç»†çš„ API æè¿°ã€‚</p><h4 id="ed448params-name" tabindex="-1"><a class="header-anchor" href="#ed448params-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ed448paramsname" target="_blank" rel="noopener noreferrer">ed448Params.name</a></span></a></h4><p>Node.js åœ¨å…¶ v21.7.1 ç‰ˆæœ¬ä¸­ï¼ŒåŒ…å«äº†å¯¹å„ç§åŠ å¯†æ“ä½œçš„æ”¯æŒï¼Œå…¶ä¸­å°±æ¶‰åŠåˆ° Web Cryptography APIã€‚è¿™ä¸ª API ä½¿å¾—åœ¨ JavaScript ç¯å¢ƒä¸­æ‰§è¡ŒåŠ å¯†å’Œå®‰å…¨æ“ä½œå˜å¾—å¯è¡Œã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦è¿›è¡Œæ•°æ®åŠ å¯†ã€èº«ä»½éªŒè¯ç­‰å®‰å…¨ç›¸å…³æ“ä½œï¼Œè€Œ Node.js æä¾›çš„ Web Cryptography API æ­£æ˜¯ä¸ºæ­¤è®¾è®¡çš„ã€‚</p><p>**<code>ed448Params.name</code>**æ˜¯è¿™ä¸ª API ä¸­çš„ä¸€ä¸ªå…·ä½“ä¾‹å­ï¼Œå®ƒå±äº EdDSAï¼ˆElliptic Curve Digital Signature Algorithmï¼‰ç­¾åç®—æ³•å®¶æ—çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºéå¯¹ç§°å¯†é’¥åŠ å¯†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œéå¯¹ç§°å¯†é’¥åŠ å¯†ä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥å¯ä»¥åˆ†äº«ç»™ä»»ä½•äººï¼Œç”¨æ¥åŠ å¯†ä¿¡æ¯ï¼›è€Œç§é’¥ä¿ç•™ç»™ä¿¡æ¯æ¥æ”¶æ–¹ï¼Œç”¨æ¥è§£å¯†ä¿¡æ¯ã€‚è¿™ç§æœºåˆ¶æå¤§åœ°å¢å¼ºäº†é€šä¿¡è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚</p><p>åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼Œ<code>ed448Params.name</code>ç‰¹æŒ‡ä½¿ç”¨ Ed448 ç®—æ³•çš„å‚æ•°è®¾ç½®ã€‚Ed448 æ˜¯ EdDSA ç®—æ³•çš„ä¸€ç§ï¼Œä¸“é—¨è®¾è®¡ç”¨æ¥æä¾›é«˜å®‰å…¨æ€§ä¸”æ•ˆç‡è¾ƒé«˜çš„æ•°å­—ç­¾ååŠŸèƒ½ã€‚åœ¨ Web Cryptography API ä¸­é€šè¿‡æŒ‡å®š<code>ed448Params.name</code>ä¸º&quot;NODE-ED448&quot;ï¼Œæ¥è¡¨æ˜ä½ æƒ³è¦ä½¿ç”¨ Ed448 ç®—æ³•ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-17"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦ç¡®ä¿æ¶ˆæ¯æˆ–æ–‡ä»¶å®Œæ•´æ€§å’Œéç¯¡æ”¹æ€§çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿æ–‡æ¡£ç­¾åæœåŠ¡æˆ–è€…ä¸€ä¸ªå®‰å…¨çš„æ¶ˆæ¯ä¼ è¾“åº”ç”¨ï¼Œä½ å¯èƒ½ä¼šè€ƒè™‘åˆ°ä½¿ç”¨æ•°å­—ç­¾åæŠ€æœ¯ã€‚</p><ol><li><p><strong>åˆ›å»ºæ•°å­—ç­¾åï¼š</strong></p><p>é¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ã€‚ç„¶åï¼Œä½¿ç”¨ç§é’¥å¯¹æ–‡æ¡£æˆ–æ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªæ•°å­—ç­¾åã€‚è¿™ä¸€æ­¥éª¤é€šå¸¸åŒ…æ‹¬å°†æ¶ˆæ¯é€šè¿‡ä¸€ä¸ªå“ˆå¸Œå‡½æ•°å¤„ç†ï¼Œç„¶åç”¨ç§é’¥åŠ å¯†å“ˆå¸Œå€¼ã€‚</p></li><li><p><strong>éªŒè¯æ•°å­—ç­¾åï¼š</strong></p><p>æ¶ˆæ¯æ¥æ”¶æ–¹æ”¶åˆ°å¸¦æœ‰æ•°å­—ç­¾åçš„æ¶ˆæ¯åï¼Œå¯ä»¥ä½¿ç”¨å‘é€æ–¹çš„å…¬é’¥æ¥éªŒè¯ç­¾åã€‚è¿™ä¸€æ­¥éª¤æ¶‰åŠåˆ°è§£å¯†æ•°å­—ç­¾åä»¥è·å–å“ˆå¸Œå€¼ï¼Œç„¶åå°†è¿™ä¸ªè§£å¯†å‡ºçš„å“ˆå¸Œå€¼ä¸æ¶ˆæ¯è‡ªèº«çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤ä¸ªå“ˆå¸Œå€¼ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå°±è¯æ˜æ¶ˆæ¯æ˜¯å®Œæ•´çš„ï¼Œä¸”æœªè¢«ç¯¡æ”¹ã€‚</p></li></ol><p>åœ¨ Node.js ä¸­ï¼Œä½¿ç”¨<code>ed448Params.name</code>ç›¸å…³çš„ä»£ç ç‰‡æ–­å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeys</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">NODE-ED448</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨Ed448ç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">      namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ed448</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šæ›²çº¿åç§°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯ä»¥å¯¼å‡ºå¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç¤ºä¾‹ï¼šç”Ÿæˆå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#88C0D0;">generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Public Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Private Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ç”Ÿæˆä¸€å¯¹å¯ä»¥ç”¨äº Ed448 ç®—æ³•çš„å¯†é’¥ï¼Œè¿™å¯¹å¯†é’¥ä¹‹åå¯ä»¥ç”¨äºåˆ›å»ºå’ŒéªŒè¯æ•°å­—ç­¾åã€‚è¿™åªæ˜¯<code>ed448Params.name</code>åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œä½†å®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ Web Cryptography API è¿›è¡Œå®‰å…¨çš„åŠ å¯†æ“ä½œã€‚</p><h4 id="ed448params-context" tabindex="-1"><a class="header-anchor" href="#ed448params-context"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#ed448paramscontext" target="_blank" rel="noopener noreferrer">ed448Params.context</a></span></a></h4><p>ç†è§£<code>ed448Params.context</code>å‰ï¼Œè®©æˆ‘ä»¬å…ˆç®€å•äº†è§£å‡ ä¸ªç›¸å…³çš„æ¦‚å¿µï¼šNode.jsã€Web Crypto APIã€å’Œ EdDSA ç®—æ³•ã€‚</p><p><strong>Node.js</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚å®ƒæ˜¯äº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/O æ¨¡å‹çš„ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚</p><p><strong>Web Crypto API</strong> æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€å¥—åŠ å¯†æ ‡å‡†ï¼Œä½¿å¾—åœ¨ç½‘é¡µåº”ç”¨ä¸­å¯ä»¥å®‰å…¨åœ°è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå¦‚ç”Ÿæˆå¯†é’¥ã€åŠ å¯†æ•°æ®ç­‰ã€‚Node.js å®ç°äº†è¿™ä¸€å¥— APIï¼Œè®©æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½ä½¿ç”¨è¿™äº›åŠ å¯†åŠŸèƒ½ã€‚</p><p><strong>EdDSAï¼ˆElliptic Curve Digital Signature Algorithmï¼‰</strong> æ˜¯ä¸€ç§å…¬é’¥ç­¾åç®—æ³•ï¼ŒåŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦ã€‚å®ƒè¢«ç”¨æ¥éªŒè¯æ¶ˆæ¯æˆ–æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚EdDSA æœ‰å¤šä¸ªå˜ä½“ï¼ŒåŒ…æ‹¬ä½¿ç”¨ä¸åŒæ¤­åœ†æ›²çº¿çš„ Ed25519 å’Œ Ed448ã€‚</p><p>é‚£ä¹ˆï¼Œ<code>ed448Params.context</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åœ¨ EdDSA ç®—æ³•ä¸­ï¼Œå°¤å…¶æ˜¯å¤„ç† Ed448 æ—¶ï¼Œæœ‰ä¸€ä¸ªå¯é€‰çš„ç‰¹æ€§å«â€œcontextâ€ã€‚è¿™ä¸ªâ€œcontextâ€æ˜¯ä¸€æ®µé¢å¤–çš„ä¿¡æ¯ï¼Œå¯ä»¥è¢«ç”¨æ¥è¿›ä¸€æ­¥ç¡®ä¿ç­¾åçš„å”¯ä¸€æ€§ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›ç‰¹å®šçš„åº”ç”¨åœºæ™¯ä¸‹ã€‚å®ƒå¯ä»¥è¢«è§†ä½œç­¾åè¿‡ç¨‹ä¸­çš„ä¸€ä¸ª&quot;ç›&quot;å€¼ï¼Œå¢å¼ºç­¾åæœºåˆ¶çš„å®‰å…¨æ€§ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå½“ä½ ä½¿ç”¨ Web Crypto API åˆ›å»º Ed448 çš„ç­¾åæˆ–éªŒè¯æ“ä½œæ—¶ï¼Œ<code>ed448Params</code>å°±æ˜¯ä½ é…ç½®è¿™äº›æ“ä½œå‚æ•°çš„å¯¹è±¡ã€‚<code>context</code>ä½œä¸º<code>ed448Params</code>çš„ä¸€ä¸ªå±æ€§ï¼Œè®©ä½ å¯ä»¥æŒ‡å®šè¿™ä¸ªé¢å¤–çš„ä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-18"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦é«˜å®‰å…¨æ€§éªŒè¯æ¶ˆæ¯æ¥æºçš„ç³»ç»Ÿï¼Œæ¯”å¦‚ä¸€ä¸ªåŠ å¯†èŠå¤©åº”ç”¨ã€‚</p><ol><li><p><strong>ç”Ÿæˆç­¾å</strong> - ç”¨æˆ· A æƒ³è¦å‘é€ä¸€ä¸ªç»è¿‡ç­¾åçš„æ¶ˆæ¯ç»™ç”¨æˆ· Bï¼Œä»¥è¯æ˜æ¶ˆæ¯ç¡®å®ç”± A å‘é€å¹¶ä¸”æœªè¢«ç¯¡æ”¹ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒA ä¼šä½¿ç”¨ä»–çš„ç§é’¥å’Œ<code>context</code>ä¿¡æ¯ï¼ˆå¦‚å¯ä»¥æ˜¯å›ºå®šå­—ç¬¦ä¸²&quot;ChatApp:v1&quot;ï¼‰æ¥å¯¹æ¶ˆæ¯åˆ›å»ºä¸€ä¸ª Ed448 ç­¾åã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// Açš„å®¢æˆ·ç«¯ä»£ç </span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> message</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, B!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span><span style="color:#616E88;"> // Açš„Ed448ç§é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> context</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ChatApp:v1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">NODE-ED448</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    context</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> context</span><span style="color:#616E88;"> // ä½¿ç”¨context</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#D8DEE9;">  privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>éªŒè¯ç­¾å</strong> - å½“ç”¨æˆ· B æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä»–ä¼šä½¿ç”¨ A çš„å…¬é’¥å’Œç›¸åŒçš„<code>context</code>æ¥éªŒè¯ç­¾åï¼Œç¡®ä¿æ¶ˆæ¯æ—¢æœªè¢«ç¯¡æ”¹ä¹Ÿç¡®å®æ˜¯ A å‘é€çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// Bçš„å®¢æˆ·ç«¯ä»£ç </span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> receivedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, B!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span><span style="color:#616E88;"> // æ¥æ”¶åˆ°çš„ç­¾å</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span><span style="color:#616E88;"> // Açš„Ed448å…¬é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> context</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ChatApp:v1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¿…é¡»åŒ¹é…å‘é€æ–¹ä½¿ç”¨çš„context</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">NODE-ED448</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    context</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> context</span><span style="color:#616E88;"> // ä½¿ç”¨ç›¸åŒçš„contextè¿›è¡ŒéªŒè¯</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#D8DEE9;">  publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  signature</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">receivedMessage</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isValid</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¶ˆæ¯éªŒè¯æˆåŠŸï¼Œæ¥è‡ªAï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ¶ˆæ¯éªŒè¯å¤±è´¥ï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡ä¸ºä¸åŒçš„åº”ç”¨åœºæ™¯æˆ–æ¶ˆæ¯ç±»å‹æŒ‡å®šä¸åŒçš„<code>context</code>ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å¯¹è¿›è¡Œå¤šæ ·åŒ–çš„éªŒè¯ï¼Œè€Œä¸å¿…æ‹…å¿ƒç­¾åä¹‹é—´çš„å†²çªï¼Œä»è€Œæé«˜æ•´ä½“çš„å®‰å…¨æ€§ã€‚</p><h3 id="class-hkdfparams" tabindex="-1"><a class="header-anchor" href="#class-hkdfparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-hkdfparams" target="_blank" rel="noopener noreferrer">Class: HkdfParams</a></span></a></h3><p>äº†è§£ Node.js ä¸­çš„<code>HkdfParams</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å®ƒåœ¨å®é™…åº”ç”¨ä¸­æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-4" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-4"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><h4 id="_1-åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#_1-åŠ å¯†"><span>1. åŠ å¯†ï¼š</span></a></h4><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒåŠ å¯†æ˜¯æŠŠæ•°æ®è½¬æ¢æˆä¸€ç§æ ¼å¼ï¼Œåªæœ‰æ‹¥æœ‰ç‰¹å®šå¯†é’¥çš„äººæ‰èƒ½è®¿é—®åŸå§‹æ•°æ®ã€‚è¿™é€šå¸¸è¢«ç”¨æ¥ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ä¸è¢«æœªæˆæƒçš„äººè®¿é—®ã€‚</p><h4 id="_2-å¯†é’¥æ´¾ç”Ÿå‡½æ•°-kdf" tabindex="-1"><a class="header-anchor" href="#_2-å¯†é’¥æ´¾ç”Ÿå‡½æ•°-kdf"><span>2. å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆKDFï¼‰:</span></a></h4><p>KDF å¯ä»¥ä»ä¸€ä¸ªç§˜å¯†å€¼ï¼ˆæ¯”å¦‚å¯†ç ï¼‰æ´¾ç”Ÿå‡ºä¸€ä¸ªæˆ–å¤šä¸ªåŠ å¯†å¯†é’¥ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å¢åŠ å¯†é’¥çš„å®‰å…¨æ€§ã€‚</p><h4 id="_3-hkdf-hmac-based-key-derivation-function" tabindex="-1"><a class="header-anchor" href="#_3-hkdf-hmac-based-key-derivation-function"><span>3. HKDF (HMAC-based Key Derivation Function):</span></a></h4><p>HKDF æ˜¯ä¸€ç§å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼Œå®ƒåŸºäºå“ˆå¸Œæ¶ˆæ¯è®¤è¯ç ï¼ˆHMACï¼‰ã€‚å®ƒé€šè¿‡ä¸€ä¸ªè¾“å…¥å¯†é’¥ææ–™ï¼ˆIKMï¼‰æ¥ç”Ÿæˆå¼ºå¯†é’¥ã€‚HKDF å¯ä»¥æ”¯æŒä»»æ„é•¿åº¦çš„å¯†é’¥ææ–™è¾“å…¥ï¼Œå¹¶ä¸”å¯ä»¥äº§ç”Ÿä»»æ„é•¿åº¦çš„è¾“å‡ºã€‚</p><h3 id="hkdfparams-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#hkdfparams-è§£é‡Š"><span><code>HkdfParams</code> è§£é‡Šï¼š</span></a></h3><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>HkdfParams</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›äº†è¿›è¡Œ HKDF æ“ä½œæ‰€éœ€çš„å‚æ•°ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•æ‰§è¡Œå¯†é’¥æ´¾ç”ŸåŠŸèƒ½ã€‚</p><h4 id="ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç»“æ„"><span>ç»“æ„:</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„ç®—æ³•åç§°</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ï¼Œæ¯”å¦‚SHA-256</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> ArrayBuffer</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯é€‰çš„ç›å€¼ï¼Œç”¨äºå¢åŠ å¯†é’¥çš„å¤æ‚åº¦å’Œå”¯ä¸€æ€§</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  info</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> ArrayBuffer</span><span style="color:#616E88;"> // å¯é€‰çš„ä¸Šä¸‹æ–‡å’Œåº”ç”¨ç‰¹å®šä¿¡æ¯ï¼Œå¯ç”¨äºç”Ÿæˆä¸åŒçš„å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14"><span>å®é™…è¿ç”¨ç¤ºä¾‹:</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®‰å…¨çš„èŠå¤©åº”ç”¨ï¼Œä½ éœ€è¦ç¡®ä¿æ¯æ¡æ¶ˆæ¯éƒ½æ˜¯åŠ å¯†çš„ï¼Œä»¥ä¿æŠ¤ç”¨æˆ·éšç§ã€‚åŒæ—¶ï¼Œä½ æƒ³è¦ä¸ºæ¯ä¸ªä¼šè¯ç”Ÿæˆå”¯ä¸€çš„åŠ å¯†å¯†é’¥ï¼Œä»¥æ­¤æ¥å¢å¼ºå®‰å…¨æ€§ã€‚è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ HKDF æ¥æ´¾ç”Ÿè¿™äº›å¯†é’¥ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -7" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -7"><span>ç¤ºä¾‹ä»£ç :</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ä½ çš„åˆå§‹å¯†é’¥ææ–™ï¼Œå¯èƒ½æ˜¯åŒæ–¹å…±äº«çš„ç§˜å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ikm</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ç›å€¼ï¼Œç”¨äºæé«˜æ´¾ç”Ÿå¯†é’¥çš„ç‹¬ç‰¹æ€§</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// åº”ç”¨ç‰¹å®šä¿¡æ¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> info</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ChatApp|SessionKey|v1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰HKDFå‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> hkdfParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  info</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> info</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> ikm</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // æ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    hkdfParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">æ´¾ç”Ÿå¯†é’¥æˆåŠŸ:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç”Ÿæˆäº†ä¸€ä¸ªéšæœºçš„åˆå§‹å¯†é’¥ææ–™å’Œä¸€ä¸ªç›å€¼ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰äº†<code>hkdfParams</code>ï¼ŒåŒ…æ‹¬æˆ‘ä»¬é€‰æ‹©çš„ HASH å‡½æ•°ï¼ˆSHA-256ï¼‰ï¼Œç›å€¼ï¼Œå’Œä¸€äº›åº”ç”¨ç‰¹å®šä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå‚æ•°æ¥æ´¾ç”Ÿä¸€ä¸ªæ–°çš„å¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥å¯ä»¥ç”¨äºåŠ å¯†èŠå¤©åº”ç”¨ä¸­çš„æ¶ˆæ¯ã€‚è¿™æ ·ï¼Œå³ä½¿æ”»å‡»è€…çŸ¥é“äº†ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼Œæ²¡æœ‰å®Œæ•´çš„æ´¾ç”Ÿè¿‡ç¨‹ä¹Ÿå¾ˆéš¾å¾—åˆ°å®é™…ä½¿ç”¨çš„å¯†é’¥ï¼Œä»è€Œä¿è¯äº†é€šä¿¡çš„å®‰å…¨ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>HkdfParams</code>åœ¨ Node.js ä¸­ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªçµæ´»è€Œå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºç®¡ç†å’Œå¢å¼ºåŠ å¯†åº”ç”¨çš„å®‰å…¨æ€§ã€‚</p><h4 id="hkdfparams-hash" tabindex="-1"><a class="header-anchor" href="#hkdfparams-hash"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hkdfparamshash" target="_blank" rel="noopener noreferrer">hkdfParams.hash</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>hkdfParams.hash</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®º Web åŠ å¯† API ä¸­çš„ä¸€ä¸ªç‰¹å®šå±æ€§ã€‚è¿™ä¸ªå±æ€§å±äº HMACï¼ˆHash-based Message Authentication Codeï¼‰å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆKey Derivation Functionï¼ŒKDFï¼‰çš„é…ç½®å‚æ•°ä¹‹ä¸€ã€‚è®©æˆ‘ç®€å•ã€é€šä¿—åœ°è§£é‡Šä¸€ä¸‹ç›¸å…³æ¦‚å¿µï¼Œç„¶åå†æ·±å…¥åˆ°<code>hkdfParams.hash</code>çš„åº”ç”¨ä¸­ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-5" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-5"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><p><strong>HMACï¼ˆæ•£åˆ—æ¶ˆæ¯è®¤è¯ç ï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ç§ç”¨äºä¿¡æ¯è®¤è¯çš„æŠ€æœ¯ï¼ŒåŸºäºå¯†ç æ•£åˆ—å‡½æ•°ï¼ˆä¾‹å¦‚ SHA-256ï¼‰ã€‚å®ƒå¯ä»¥ç¡®ä¿ä¿¡æ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p></li><li><p><strong>å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆKDFï¼‰</strong>ï¼šåœ¨å¯†ç å­¦ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä»ä¸€ä¸ªå¯†é’¥ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªå­å¯†é’¥ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯é€šè¿‡ KDF æ¥å®Œæˆçš„ï¼ŒHKDF å³ä¸ºå…¶ä¸­ä¸€ç§æ–¹æ³•ï¼Œç‰¹åˆ«é€‚ç”¨äºä»ä¸å¤ªéšæœºçš„åŸææ–™ç”Ÿæˆé«˜è´¨é‡çš„å¯†é’¥ææ–™ã€‚</p></li><li><p><strong>æ•£åˆ—å‡½æ•°</strong>ï¼šæ•£åˆ—å‡½æ•°å¯ä»¥å°†ä»»æ„é•¿åº¦çš„è¾“å…¥ï¼ˆæˆ–è€…ç§°ä¹‹ä¸ºæ¶ˆæ¯ï¼‰è½¬æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºã€‚è¾“å‡ºé€šå¸¸è¢«ç§°ä¸ºæ•£åˆ—å€¼æˆ–æ‘˜è¦ã€‚</p></li></ol><h3 id="hkdfparams-hash-1" tabindex="-1"><a class="header-anchor" href="#hkdfparams-hash-1"><span>hkdfParams.hash</span></a></h3><p>åœ¨<code>hkdfParams</code>å¯¹è±¡ä¸­ï¼Œ<code>hash</code>å±æ€§æŒ‡å®šäº†ç”¨äº HKDF æ“ä½œä¸­çš„æ•£åˆ—å‡½æ•°ã€‚è¿™ä¸ªå±æ€§çš„å€¼å†³å®šäº†å¦‚ä½•è®¡ç®—æ•£åˆ—å€¼ï¼Œè¿›è€Œå½±å“äº†æ´¾ç”Ÿå¯†é’¥çš„å®‰å…¨æ€§å’Œç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>SHA-256</code>ä½œä¸ºæ•£åˆ—å‡½æ•°ï¼Œå› ä¸ºå®ƒæä¾›äº†è‰¯å¥½çš„å®‰å…¨æ€§å’Œè¶³å¤Ÿçš„æŠ—ç¢°æ’æ€§ï¼ˆå³éš¾ä»¥æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„è¾“å…¥äº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼‰ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-15"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸”ä½ å·²ç»æœ‰äº†ä¸€ä¸ªå…±äº«çš„å¯†é’¥ï¼ˆå¯èƒ½æ˜¯é€šè¿‡æŸç§å¯†é’¥äº¤æ¢åè®®è·å¾—çš„ï¼‰ï¼Œä½†è¿™ä¸ªå¯†é’¥å¹¶ä¸å®Œç¾ï¼Œå¯èƒ½å› ä¸ºå®ƒçš„é•¿åº¦ä¸å¤Ÿï¼Œæˆ–è€…å®ƒçš„éšæœºæ€§ä¸å¤Ÿå¥½ã€‚è¿™æ—¶å€™ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ HKDF æ¥ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªâ€œæ›´å¥½â€çš„å¯†é’¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾è¿™æ˜¯ä½ çš„åŸå§‹å¯†é’¥ææ–™</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> secretKeyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯¼å…¥åŸå§‹å¯†é’¥ææ–™ï¼Œå‡†å¤‡ç”¨äºHKDF</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  secretKeyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">  false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å®šä¹‰HKDFå‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> hkdfParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨SHA-256ä½œä¸ºæ•£åˆ—å‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">  salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRandomValues</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">))</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯é€‰çš„ç›å€¼</span></span>
<span class="line"><span style="color:#88C0D0;">  info</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯é€‰çš„ä¸Šä¸‹æ–‡å’Œåº”ç”¨ç‰¹å®šä¿¡æ¯</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// æ´¾ç”Ÿæ–°å¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">  hkdfParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // ä¸ºç›®æ ‡å¯†é’¥å®šä¹‰ç®—æ³•å’Œé•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// æŒ‡å®šæ´¾ç”Ÿå¯†é’¥çš„ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†åŸå§‹çš„å¯†é’¥ææ–™ï¼Œå¹¶å¯¼å…¥å®ƒä»¥ä¾¿ç”¨äº HKDFã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†<code>hkdfParams</code>ï¼ŒåŒ…æ‹¬é€‰æ‹©<code>SHA-256</code>ä½œä¸ºæ•£åˆ—å‡½æ•°ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>deriveKey</code>æ–¹æ³•ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„å¯†é’¥ï¼Œè¿™ä¸ªæ–°çš„å¯†é’¥å¯ä»¥ç”¨äº AES-GCM ç®—æ³•è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</p><p>é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œå³ä½¿ä½ çš„åŸå§‹å¯†é’¥ä¸å¤Ÿç†æƒ³ï¼Œä½ ä¹Ÿèƒ½è·å¾—ä¸€ä¸ªæ—¢å®‰å…¨åˆé€‚åˆç‰¹å®šç”¨é€”çš„æ´¾ç”Ÿå¯†é’¥ã€‚è¿™å±•ç¤ºäº†<code>hkdfParams.hash</code>åœ¨å®é™…åº”ç”¨ä¸­çš„é‡è¦ä½œç”¨ã€‚</p><h4 id="hkdfparams-info" tabindex="-1"><a class="header-anchor" href="#hkdfparams-info"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hkdfparamsinfo" target="_blank" rel="noopener noreferrer">hkdfParams.info</a></span></a></h4><p>äº†è§£ <code>hkdfParams.info</code> å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ <code>HKDF</code> å’Œ Node.js ä¸­çš„ Web Crypto APIã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-hkdf" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-hkdf"><span>ä»€ä¹ˆæ˜¯ HKDFï¼Ÿ</span></a></h3><p><code>HKDF</code>ï¼ˆHMAC Key Derivation Functionï¼‰æ˜¯ä¸€ç§åŸºäº HMACï¼ˆHash-based Message Authentication Codeï¼‰çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°ã€‚å®ƒç”¨äºä»ä¸€ä¸ªè¾“å…¥å¯†é’¥ææ–™ï¼ˆIKMï¼‰ç”Ÿæˆå¼ºåŠ å¯†å¯†é’¥ã€‚<code>HKDF</code> å¯ä»¥è¢«ç”¨æ¥ç”Ÿæˆå¤šä¸ªå¯†é’¥ï¼Œå¹¶ä¸”å®ƒåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šæå–ï¼ˆExtractï¼‰å’Œæ‰©å±•ï¼ˆExpandï¼‰ã€‚</p><ul><li><strong>æå–é˜¶æ®µ</strong>ï¼šè¯¥é˜¶æ®µä½¿ç”¨ä¸€ä¸ªå¯†é’¥å’Œä¸€ä¸ªå¯é€‰çš„ç›å€¼ï¼ˆsaltï¼‰ï¼Œé€šè¿‡ HMAC æ¥ç”Ÿæˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„ä¸­é—´å¯†é’¥ã€‚</li><li><strong>æ‰©å±•é˜¶æ®µ</strong>ï¼šè¿™ä¸ªé˜¶æ®µæ¥æ”¶ä¸Šä¸€é˜¶æ®µäº§ç”Ÿçš„ä¸­é—´å¯†é’¥ã€ä¸€ä¸ªå¯é€‰çš„ä¿¡æ¯å­—æ®µï¼ˆinfoï¼‰å’Œè¾“å‡ºå¯†é’¥çš„é•¿åº¦ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆæ‰€éœ€é•¿åº¦çš„æœ€ç»ˆå¯†é’¥ã€‚</li></ul><h3 id="hkdfparams-info-1" tabindex="-1"><a class="header-anchor" href="#hkdfparams-info-1"><span><a href="http://hkdfParams.info" target="_blank" rel="noopener noreferrer">hkdfParams.info</a></span></a></h3><p>åœ¨ Node.js çš„ <code>webcrypto</code> æ¨¡å—ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>HKDF</code> ç®—æ³•è¿›è¡Œå¯†é’¥æ´¾ç”Ÿæ—¶ï¼Œ<code>hkdfParams</code> æ˜¯ä¼ é€’ç»™ <code>deriveKey</code> æˆ– <code>deriveBits</code> æ–¹æ³•çš„å‚æ•°å¯¹è±¡ä¹‹ä¸€ã€‚åœ¨è¿™ä¸ªå‚æ•°å¯¹è±¡ä¸­ï¼Œ<code>info</code> å­—æ®µæ˜¯éå¸¸å…³é”®çš„ä¸€éƒ¨åˆ†ã€‚</p><ul><li><strong><code>info</code></strong>: æ˜¯ä¸€ä¸ª <code>ArrayBuffer</code> æˆ– <code>TypedArray</code> æˆ– <code>DataView</code>ï¼Œç”¨äºåœ¨å¯†é’¥æ´¾ç”Ÿçš„æ‰©å±•é˜¶æ®µæä¾›é™„åŠ çš„ä¸Šä¸‹æ–‡å’Œåº”ç”¨ç‰¹å®šä¿¡æ¯ã€‚è™½ç„¶ <code>info</code> æ˜¯å¯é€‰çš„ï¼Œä½†å®ƒå…è®¸åœ¨ç”Ÿæˆå¯†é’¥æ—¶å¼•å…¥é¢å¤–çš„æ•°æ®ï¼Œä½¿å¾—åŒæ ·çš„è¾“å…¥ææ–™ï¼ˆIKM å’Œ saltï¼‰èƒ½å¤Ÿæ´¾ç”Ÿå‡ºä¸åŒçš„å¯†é’¥ï¼Œåªè¦ <code>info</code> ä¸åŒã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-19"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ï¼Œéœ€è¦ä¸ºæ¯ä¸ªå¯¹è¯åŠ å¯†æ¶ˆæ¯ã€‚ä½ å¸Œæœ›ä¸ºæ¯ä¸ªå¯¹è¯æ´¾ç”Ÿä¸€ä¸ªå”¯ä¸€çš„åŠ å¯†å¯†é’¥ï¼Œå³ä½¿æ‰€æœ‰å¯¹è¯éƒ½åŸºäºåŒä¸€ä¸ªç”¨æˆ·å¯†é’¥ä¹Ÿèƒ½åšåˆ°ã€‚è¿™é‡Œï¼Œ<code>info</code> å‚æ•°å°±å¯ä»¥æ´¾ä¸Šç”¨åœºã€‚</p><ol><li>ç”¨æˆ·çš„ä¸»å¯†é’¥ï¼ˆIKMï¼‰æ˜¯ç™»å½•æ—¶ç”Ÿæˆçš„ã€‚</li><li>å¯¹äºæ¯ä¸ªå¯¹è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯¹è¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¾‹å¦‚å¯¹è¯ IDï¼‰ä½œä¸º <code>info</code> å‚æ•°ã€‚</li><li>ä½¿ç”¨ç”¨æˆ·çš„ä¸»å¯†é’¥å’Œå¯¹è¯çš„ <code>info</code> ç”Ÿæˆç‹¬ç«‹çš„ä¼šè¯å¯†é’¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> deriveSessionKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">masterKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> conversationId</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°† conversationId è½¬æ¢ä¸º ArrayBuffer æ ¼å¼ä½œä¸º info å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> info</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">conversationId</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hkdfParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    salt</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯é€‰çš„ç›å€¼ï¼Œå…·ä½“æƒ…å†µå¯èƒ½æœ‰ä¸åŒçš„é€‰æ‹©</span></span>
<span class="line"><span style="color:#88C0D0;">    info</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> info</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡å®š masterKey å·²ç»æ˜¯ CryptoKey æ ¼å¼</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    hkdfParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    masterKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šè¾“å‡ºå¯†é’¥çš„ç®—æ³•å’Œé•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// æŒ‡å®šå¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¸åŒçš„ <code>conversationId</code> ä¼šå¯¼è‡´ç”Ÿæˆä¸åŒçš„ä¼šè¯å¯†é’¥ï¼Œå³ä½¿æ‰€æœ‰å¯¹è¯éƒ½æ˜¯åŸºäºåŒä¸€ä¸ªç”¨æˆ·çš„ä¸»å¯†é’¥æ´¾ç”Ÿçš„ã€‚è¿™ä¿è¯äº†å³ä½¿æŸä¸ªä¼šè¯çš„å¯†é’¥è¢«ç ´è§£ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•åˆ©ç”¨ç›¸åŒçš„å¯†é’¥æ¥è§£å¯†å…¶ä»–å¯¹è¯ä¸­çš„æ¶ˆæ¯ã€‚</p><h4 id="hkdfparams-name" tabindex="-1"><a class="header-anchor" href="#hkdfparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hkdfparamsname" target="_blank" rel="noopener noreferrer">hkdfParams.name</a></span></a></h4><p>Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„<code>hkdfParams.name</code>æ˜¯å…³äº Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ä¸ HKDFï¼ˆHMAC-based Key Derivation Functionï¼ŒåŸºäº HMAC çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼‰ç›¸å…³çš„å‚æ•°è®¾ç½®ã€‚ä¸ºäº†ä½¿è§£é‡Šæ›´æ˜“ç†è§£ï¼Œæˆ‘ä»¬å°†å…ˆä»‹ç»ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œç„¶åé€šè¿‡å®ä¾‹æ¥è¯¦ç»†è¯´æ˜ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-6" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-6"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><p><strong>Web åŠ å¯† API</strong>: è¿™æ˜¯ä¸€ç»„å…è®¸å¼€å‘è€…æ‰§è¡Œå„ç§åŠ å¯†æ“ä½œï¼ˆå¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åã€éªŒè¯ç­‰ï¼‰çš„ Web æ ‡å‡† APIã€‚Node.js é€šè¿‡<code>crypto</code>æ¨¡å—æä¾›äº†å¯¹æ­¤ API çš„æ”¯æŒã€‚</p></li><li><p><strong>HKDF (HMAC-based Key Derivation Function)</strong>: HKDF æ˜¯ä¸€ç§å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼Œç”¨äºä»ä¸€ä¸ªè¾“å…¥å¯†é’¥ææ–™ï¼ˆIKMï¼‰ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªå¼ºåŠ å¯†å¯†é’¥ã€‚å®ƒé¦–å…ˆä½¿ç”¨ HMACï¼ˆHash-based Message Authentication Codeï¼ŒåŸºäºå“ˆå¸Œçš„æ¶ˆæ¯è®¤è¯ç ï¼‰æ¥æ··åˆè¾“å…¥å¯†é’¥ä¸ç›å€¼ï¼ˆsaltï¼‰ï¼Œç„¶åé€šè¿‡é‡å¤åº”ç”¨ HMAC æ¥æ‰©å±•å’Œç²¾ç‚¼å¯†é’¥ææ–™è‡³æ‰€éœ€é•¿åº¦ã€‚</p></li><li><p><strong>HMAC</strong>: ä¸€ç§åˆ©ç”¨åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA-256ï¼‰å’Œä¸€ä¸ªç§˜å¯†å¯†é’¥ç»“åˆæ•°æ®æ¥ç”Ÿæˆæ¶ˆæ¯è®¤è¯ç çš„æŠ€æœ¯ï¼Œå¹¿æ³›ç”¨äºç¡®ä¿ä¿¡æ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p></li></ol><h3 id="hkdfparams-name-1" tabindex="-1"><a class="header-anchor" href="#hkdfparams-name-1"><span><a href="http://hkdfParams.name" target="_blank" rel="noopener noreferrer">hkdfParams.name</a></span></a></h3><p>åœ¨ Web åŠ å¯† API ä¸­ä½¿ç”¨ HKDF æ—¶ï¼Œ<code>hkdfParams</code>æ˜¯ä¼ é€’ç»™<code>subtleCrypto.deriveKey</code>æˆ–<code>subtleCrypto.deriveBits</code>æ–¹æ³•çš„å‚æ•°å¯¹è±¡ä¹‹ä¸€ï¼Œç”¨ä»¥æŒ‡å®šå¯†é’¥æ´¾ç”Ÿçš„å…·ä½“å‚æ•°ã€‚<code>hkdfParams.name</code>å°±æ˜¯è¿™ä¸ªå‚æ•°å¯¹è±¡é‡Œçš„ä¸€ä¸ªå±æ€§ï¼Œå…¶å€¼å¿…é¡»ä¸º <code>&quot;HKDF&quot;</code>ï¼Œä»¥æ­¤è¡¨æ˜è¦ä½¿ç”¨çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°æ˜¯ HKDFã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-20" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-20"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä¸ºæ¯ä¸ªä¼šè¯ç”Ÿæˆç‹¬ä¸€æ— äºŒçš„åŠ å¯†å¯†é’¥ï¼Œè€Œæ‰€æœ‰å‚ä¸è€…åˆå§‹ä»…å…±äº«ä¸€ä¸ªå¯†ç æˆ–å¯†é’¥ã€‚ä½ å¯ä»¥ä½¿ç”¨ HKDF æ¥ä»è¿™ä¸ªå…±äº«å¯†é’¥æ´¾ç”Ÿå‡ºç‹¬ç«‹çš„ä¼šè¯å¯†é’¥ã€‚</p><ol><li><p><strong>åˆå§‹åŒ–å…±äº«å¯†é’¥</strong>:</p><ul><li>å‡è®¾æœ‰ä¸€ä¸ªåˆå§‹å…±äº«å¯†é’¥ï¼ˆinput key material, IKMï¼‰ã€‚</li></ul></li><li><p><strong>ç¡®å®š HKDF å‚æ•°</strong>:</p><ul><li>è®¾ç½®<code>hkdfParams</code>ï¼Œå…¶ä¸­<code>name</code>å±æ€§è®¾ä¸º<code>&quot;HKDF&quot;</code>ï¼Œå¦å¤–è¿˜å¯ä»¥æŒ‡å®š hash å‡½æ•°ã€saltï¼ˆç›å€¼ï¼‰å’Œ infoï¼ˆé™„åŠ ä¿¡æ¯ï¼‰ç­‰å‚æ•°ã€‚</li></ul></li><li><p><strong>æ´¾ç”Ÿä¼šè¯å¯†é’¥</strong>:</p><ul><li>ä½¿ç”¨<code>crypto.subtle.deriveKey</code>æˆ–<code>crypto.subtle.deriveBits</code>æ–¹æ³•ï¼Œä¼ å…¥ä¸Šè¿°<code>hkdfParams</code>ï¼Œæ ¹æ®å…±äº«å¯†é’¥å’Œå…¶ä»–å‚æ•°æ´¾ç”Ÿå‡ºæ–°çš„å¯†é’¥ã€‚</li></ul></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> deriveSessionKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">sharedKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> info</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰HKDFå‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hkdfParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    info</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> info</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾sharedKeyå·²ç»æ˜¯å¯¼å…¥ç³»ç»Ÿä¸­çš„CryptoKeyæ ¼å¼</span></span>
<span class="line"><span style="color:#616E88;">  // æ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> sessionKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    hkdfParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    sharedKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å…±äº«å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // ç›®æ ‡å¯†é’¥çš„ç®—æ³•å’Œé•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> sessionKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°<code>deriveSessionKey</code>ï¼Œå®ƒæ¥å—ä¸€ä¸ªå…±äº«å¯†é’¥ã€salt å’Œ info ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä½¿ç”¨ HKDF æ´¾ç”Ÿå‡ºä¸€ä¸ªæ–°çš„ä¼šè¯å¯†é’¥ï¼Œè¯¥å¯†é’¥ç”¨äº AES-GCM åŠ å¯†ç®—æ³•ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿å¤šä¸ªä¼šè¯å¼€å§‹äºç›¸åŒçš„å…±äº«å¯†é’¥ï¼Œæ¯ä¸ªä¼šè¯ä¹Ÿèƒ½è·å¾—å…¶ç‹¬æœ‰çš„åŠ å¯†å¯†é’¥ï¼Œå¤§å¤§å¢å¼ºäº†é€šä¿¡çš„å®‰å…¨æ€§ã€‚</p><h4 id="hkdfparams-salt" tabindex="-1"><a class="header-anchor" href="#hkdfparams-salt"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hkdfparamssalt" target="_blank" rel="noopener noreferrer">hkdfParams.salt</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>hkdfParams.salt</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚<code>hkdfParams.salt</code>æ˜¯ä¸ HMAC å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆHKDFï¼‰ç›¸å…³çš„ä¸€é¡¹å‚æ•°ã€‚è¦ç†è§£è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¾—å…ˆç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯ HKDF å’Œå®ƒçš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-7" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-7"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><h4 id="hmac-å¯†é’¥æ´¾ç”Ÿå‡½æ•°-hkdf" tabindex="-1"><a class="header-anchor" href="#hmac-å¯†é’¥æ´¾ç”Ÿå‡½æ•°-hkdf"><span>HMAC å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆHKDFï¼‰</span></a></h4><p>HKDF æ˜¯ä¸€ç§åŸºäºåŠ å¯†å“ˆå¸Œå‡½æ•°çš„å¯†é’¥æ´¾ç”Ÿæ–¹æ³•ã€‚å®ƒèƒ½ä»ä¸€ä¸ªè¾“å…¥å¯†é’¥ææ–™ï¼ˆIKMï¼‰ç”Ÿæˆå¼ºåŠ å¯†å¯†é’¥ã€‚HKDF è¿‡ç¨‹é€šå¸¸åˆ†ä¸ºä¸¤æ­¥ï¼šæå–ï¼ˆExtractï¼‰å’Œæ‰©å±•ï¼ˆExpandï¼‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å…ˆé€šè¿‡<code>salt</code>å‚æ•°â€œæ ‡å‡†åŒ–â€è¾“å…¥å¯†é’¥ææ–™åˆ°ä¸€ä¸ªæ›´å®‰å…¨ã€ä¸æ˜“é¢„æµ‹çš„å½¢å¼ï¼Œç„¶åå†äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªåŠ å¯†å¯†é’¥ã€‚</p><h4 id="salt" tabindex="-1"><a class="header-anchor" href="#salt"><span>Salt</span></a></h4><p>åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>salt</code>æ˜¯ä¸€ä¸ªéæœºå¯†ä½†éšæœºçš„å€¼ï¼Œç”¨äºä½œä¸º HKDF çš„æå–é˜¶æ®µçš„ä¸€éƒ¨åˆ†ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä¿è¯å³ä½¿è¾“å…¥çš„åŸå§‹æ•°æ®æ²¡æœ‰å¾ˆå¥½çš„éšæœºæ€§ï¼Œè¾“å‡ºçš„å¯†é’¥ä¹Ÿèƒ½å…·æœ‰è‰¯å¥½çš„éšæœºæ€§å’Œå®‰å…¨æ€§ã€‚<code>salt</code>å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª&quot;è°ƒå‘³å“&quot;ï¼Œå°½ç®¡å®ƒä¸æ˜¯æœºå¯†çš„ï¼Œä½†é€šè¿‡æ”¹å˜è¾“å…¥æ•°æ®çš„æ–¹å¼ï¼Œä½¿å¾—ç›¸åŒçš„è¾“å…¥æ•°æ®æ¯æ¬¡éƒ½èƒ½äº§ç”Ÿä¸åŒçš„è¾“å‡ºå¯†é’¥ã€‚</p><h3 id="node-js-ä¸­çš„hkdfparams-salt" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„hkdfparams-salt"><span>Node.js ä¸­çš„<code>hkdfParams.salt</code></span></a></h3><p>åœ¨ Node.js v21.7.1 çš„ WebCrypto API ä¸­ï¼Œå½“ä½ ä½¿ç”¨ HKDF ç®—æ³•è¿›è¡Œå¯†é’¥æ´¾ç”Ÿæ—¶ï¼Œ<code>hkdfParams</code>å¯¹è±¡ä¸­çš„<code>salt</code>å±æ€§å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> deriveKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // æ¨¡æ‹Ÿçš„åˆå§‹å¯†é’¥ææ–™</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> ikm</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span></span>
<span class="line"><span style="color:#616E88;">    /* ä¸€äº›æ•°å­—ä»£è¡¨åŸå§‹å¯†é’¥ææ–™ */</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // salt: æˆ‘ä»¬è®¨è®ºçš„å‚æ•°ï¼Œä¸€ä¸ªBufferæˆ–TypedArrayï¼Œç”¨æ¥å¢å¼ºå¯†é’¥çš„å®‰å…¨æ€§</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç”Ÿæˆä¸€ä¸ª16å­—èŠ‚çš„éšæœºsalt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰HKDFå‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hkdfParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HKDF</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">    salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åº”ç”¨æˆ‘ä»¬å‰é¢è®¨è®ºçš„salt</span></span>
<span class="line"><span style="color:#88C0D0;">    info</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span></span>
<span class="line"><span style="color:#616E88;">      /* å¯é€‰ï¼Œé¢å¤–ä¿¡æ¯ */</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å‡è®¾æœ‰ä¸€ä¸ªbaseKeyç”¨äºå¤„ç†</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> baseKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#D8DEE9;">importKey</span></span>
<span class="line"><span style="color:#616E88;">    /* å‚æ•°ç•¥ */</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨`deriveKey`æ–¹æ³•åˆ©ç”¨hkdfParamsæ¥æ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    hkdfParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    baseKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#616E88;">      /* ç›®æ ‡å¯†é’¥çš„ç»†èŠ‚ */</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span></span>
<span class="line"><span style="color:#616E88;">      /* å¯†é’¥ç”¨é€” */</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨éšæœºç”Ÿæˆçš„<code>salt</code>æ¥å¢å¼ºæ´¾ç”Ÿçš„å¯†é’¥å®‰å…¨æ€§ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-1"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>ç”¨æˆ·å¯†ç å­˜å‚¨</strong>ï¼šå¦‚æœæ‚¨æ­£åœ¨å¼€å‘ä¸€æ¬¾åº”ç”¨ï¼Œéœ€è¦å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·çš„å¯†ç ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ HKDF ç»“åˆ<code>salt</code>æ¥åŠ å¼ºå¯†ç çš„å®‰å…¨æ€§ã€‚è¿™æ ·ï¼Œå³ä¾¿æ˜¯å¼±å¯†ç ï¼Œåœ¨ç»è¿‡ HKDF å¤„ç†åï¼Œä¹Ÿèƒ½å¾—åˆ°ä¸€ä¸ªå¼ºå¤§çš„å¯†é’¥ï¼Œç”¨äºåŠ å¯†ç­‰è¿›ä¸€æ­¥æ“ä½œã€‚</p></li><li><p><strong>åŠ å¯†é€šä¿¡</strong>ï¼šåœ¨æ„å»ºéœ€è¦å®‰å…¨é€šä¿¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨æ—¶ï¼ŒåŒæ–¹å¯ä»¥å…ˆäº¤æ¢ä¸€äº›å…¬å¼€ä¿¡æ¯ä½œä¸º IKMï¼Œç„¶åå„è‡ªä½¿ç”¨ HKDF åŠä¸€ä¸ªéšæœºçš„<code>salt</code>ç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œç¡®ä¿ä¼ è¾“çš„æ•°æ®å®‰å…¨æ€§ã€‚</p></li><li><p><strong>å¤šè®¾å¤‡åŒæ­¥</strong>ï¼šåœ¨éœ€è¦å°†æ•°æ®åŒæ­¥è‡³ç”¨æˆ·çš„å¤šä¸ªè®¾å¤‡ä¸­æ—¶ï¼Œé€šè¿‡é€‰æ‹©åˆé€‚çš„ IKM å’Œ<code>salt</code>ï¼Œå¯ä»¥ä¿è¯æ¯ä¸ªè®¾å¤‡éƒ½èƒ½ç‹¬ç«‹åœ°å¾—åˆ°ç›¸åŒçš„åŒæ­¥å¯†é’¥ï¼Œè€Œæ— éœ€ç›´æ¥äº¤æ¢å¯†é’¥æœ¬èº«ã€‚</p></li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>hkdfParams.salt</code>åœ¨ä¿æŠ¤ä¿¡æ¯å®‰å…¨ã€å¢å¼ºå¯†é’¥éšæœºæ€§ä¸­èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼Œå®ƒæ˜¯ç°ä»£åŠ å¯†åº”ç”¨ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="class-hmacimportparams" tabindex="-1"><a class="header-anchor" href="#class-hmacimportparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-hmacimportparams" target="_blank" rel="noopener noreferrer">Class: HmacImportParams</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„<code>HmacImportParams</code>æ˜¯å…³äº Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºåŠ å¯†æ“ä½œä¸­ã€‚è¦ç†è§£<code>HmacImportParams</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š<strong>HMAC</strong>ã€<strong>åŠ å¯†</strong>å’Œ<strong>Web Crypto API</strong>ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-8" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-8"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ul><li><p><strong>HMAC (Hash-based Message Authentication Code)</strong>: è¿™æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åŠ å¯†æŠ€æœ¯ï¼Œä¸»è¦ç”¨äºéªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚HMAC ç»“åˆäº†åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA-256ï¼‰å’Œä¸€ä¸ªç§˜å¯†å¯†é’¥æ¥ç”Ÿæˆå”¯ä¸€çš„è®¤è¯ç ï¼ˆæˆ–ç­¾åï¼‰ï¼Œè¿™æ ·æ¥å—æ–¹å¯ä»¥éªŒè¯æ¶ˆæ¯æ˜¯å¦è¢«ç¯¡æ”¹è¿‡ã€‚</p></li><li><p><strong>åŠ å¯†</strong>: ç®€å•æ¥è¯´ï¼ŒåŠ å¯†å°±æ˜¯å°†ä¿¡æ¯ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§ä¸æ˜“è¯»çš„æ ¼å¼ï¼Œä»¥ä¿æŠ¤ä¿¡æ¯çš„å®‰å…¨æ€§ã€‚åŠ å¯†æœ‰å¾ˆå¤šç§æ–¹å¼ï¼ŒåŒ…æ‹¬å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†å’Œå“ˆå¸Œç­‰ã€‚</p></li><li><p><strong>Web Crypto API</strong>: è¿™æ˜¯ä¸€ç§åœ¨ Web åº”ç”¨ä¸­æ‰§è¡ŒåŠ å¯†æ“ä½œçš„ JavaScript APIã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„åŠ å¯†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å“ˆå¸Œã€ç­¾åã€åŠ å¯†è§£å¯†ç­‰ã€‚</p></li></ul><h3 id="hmacimportparams-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#hmacimportparams-è¯¦è§£"><span>HmacImportParams è¯¦è§£</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>HmacImportParams</code>å…·ä½“æ˜¯æŒ‡ç”¨äºå¯¼å…¥ HMAC å¯†é’¥çš„å‚æ•°ã€‚å½“ä½ æƒ³ä½¿ç”¨ç‰¹å®šçš„å¯†é’¥æ‰§è¡Œ HMAC æ“ä½œæ—¶ï¼Œä½ å¯èƒ½éœ€è¦å°†å¯†é’¥ä»æŸå¤„ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶æˆ–æ•°æ®åº“ï¼‰å¯¼å…¥åˆ°ä½ çš„åº”ç”¨ä¸­ã€‚<code>HmacImportParams</code>å°±æ˜¯å®šä¹‰è¿™ä¸ªå¯¼å…¥è¿‡ç¨‹ä¸­éœ€è¦çš„å‚æ•°ã€‚</p><p>ä¸€ä¸ª<code>HmacImportParams</code>å¯¹è±¡é€šå¸¸åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><code>name</code>: è¿™ä¸ªå±æ€§è¡¨æ˜äº†ä½ æƒ³ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œå¯¹äº HMAC æ¥è¯´ï¼Œè¿™é‡Œåº”è¯¥è®¾ç½®ä¸º<code>&quot;HMAC&quot;</code>ã€‚</li><li><code>hash</code>: è¡¨ç¤ºç”¨äº HMAC ç”Ÿæˆçš„å“ˆå¸Œå‡½æ•°çš„åç§°ï¼Œå¦‚<code>&quot;SHA-256&quot;</code>ã€‚è¿™å†³å®šäº†ä½ çš„ HMAC ç­¾åçš„å¼ºåº¦å’Œé•¿åº¦ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œéœ€è¦ç¡®ä¿å‘é€åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ä½ å¯ä»¥é€šè¿‡ HMAC æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><ol><li><p><strong>æœåŠ¡å™¨ç”Ÿæˆå¯†é’¥å¹¶ä¿å­˜:</strong> é¦–å…ˆï¼Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œä½ ç”Ÿæˆä¸€ä¸ª HMAC å¯†é’¥ï¼Œå¹¶ä½¿ç”¨æŸä¸ªåŠ å¯†ç®—æ³•ï¼ˆå¦‚ SHA-256ï¼‰ã€‚ç„¶åï¼Œä½ å°†è¿™ä¸ªå¯†é’¥å®‰å…¨åœ°ä¿å­˜èµ·æ¥ï¼Œä»¥ä¾¿ä¹‹åéªŒè¯æ•°æ®ã€‚</p></li><li><p><strong>å¯¼å…¥å¯†é’¥:</strong> å½“ä½ éœ€è¦ä½¿ç”¨è¿™ä¸ªå¯†é’¥æ¥éªŒè¯æ•°æ®æ—¶ï¼Œä½ ä¼šä½¿ç”¨<code>HmacImportParams</code>æ¥å¯¼å…¥è¿™ä¸ªå¯†é’¥ã€‚ä¾‹å¦‚ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> importParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾æˆ‘ä»¬å·²ç»ä»æŸå¤„è·å¾—äº†å¯†é’¥rawKey</span></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¡¨æ˜å¯†é’¥æ˜¯åŸå§‹çš„ï¼Œæœªç»å¤„ç†çš„</span></span>
<span class="line"><span style="color:#D8DEE9;">    rawKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    importParams</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä¸Šé¢å®šä¹‰çš„å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯ä»¥å¯¼å‡ºå¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// ç”¨é€”ï¼šç­¾åä¸éªŒè¯</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ä½¿ç”¨å¯†é’¥è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºHMACç­¾å</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>éªŒè¯æ•°æ®:</strong> ä¸€æ—¦å¯†é’¥è¢«æˆåŠŸå¯¼å…¥ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¸ºæ•°æ®ç”Ÿæˆ HMAC ç­¾åï¼Œä¹‹åå†å°†è¿™ä¸ªç­¾åå’Œæ•°æ®ä¸€åŒå‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®åï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œç®—æ³•éªŒè¯ç­¾åï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p></li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¬¬ä¸‰æ–¹æˆªè·ï¼Œæ²¡æœ‰å¯†é’¥çš„ç¬¬ä¸‰æ–¹ä¹Ÿæ— æ³•ä¿®æ”¹æ•°æ®å¹¶ç”Ÿæˆæ­£ç¡®çš„ç­¾åï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h4 id="hmacimportparams-hash" tabindex="-1"><a class="header-anchor" href="#hmacimportparams-hash"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hmacimportparamshash" target="_blank" rel="noopener noreferrer">hmacImportParams.hash</a></span></a></h4><p>Node.js ä¸­çš„<code>hmacImportParams.hash</code>æ˜¯ä¸ Web åŠ å¯† API ç›¸å…³çš„æ¦‚å¿µä¹‹ä¸€ï¼Œç‰¹åˆ«ç”¨äºå®šä¹‰ HMACï¼ˆHash-Based Message Authentication Codeï¼ŒåŸºäºæ•£åˆ—çš„æ¶ˆæ¯é‰´åˆ«ç ï¼‰æ“ä½œæ—¶ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ã€‚ç†è§£è¿™ä¸ªå±æ€§å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å‡ ä¸ªå…³é”®æ¦‚å¿µï¼šHMACã€å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA-256ï¼‰ï¼Œä»¥åŠä¸ºä½•æˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒä»¬ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-9" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-9"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><p><strong>HMAC</strong>: ä¸€ç§å®‰å…¨æŠ€æœ¯ï¼Œç”¨äºéªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚é€šè¿‡ç»“åˆä¸€ä¸ªå¯†é’¥å’Œä¸€ä¸ªå“ˆå¸Œå‡½æ•°ç”Ÿæˆä¸€ä¸ªç‹¬ç‰¹çš„æ ¡éªŒå€¼ï¼ˆæ¶ˆæ¯é‰´åˆ«ç ï¼‰ã€‚å¦‚æœæ¶ˆæ¯æˆ–å¯†é’¥è¢«ç¯¡æ”¹ï¼Œæ ¡éªŒå€¼ä¹Ÿä¼šç›¸åº”æ”¹å˜ï¼Œä»è€ŒéªŒè¯å¤±è´¥ã€‚</p></li><li><p><strong>å“ˆå¸Œå‡½æ•°</strong>: å¦‚ SHA-256ï¼Œè¿™æ˜¯ä¸€ç§å°†è¾“å…¥ï¼ˆæˆ–â€œæ¶ˆæ¯â€ï¼‰è½¬æ¢æˆå›ºå®šé•¿åº¦å­—ç¬¦ä¸²ï¼ˆé€šå¸¸æ˜¯åå…­è¿›åˆ¶æ•°ï¼‰çš„å‡½æ•°ã€‚å®ƒæ˜¯å•å‘çš„ï¼Œæ„å‘³ç€æ— æ³•ä»è¾“å‡ºåæ¨åŸå§‹è¾“å…¥ã€‚</p></li></ol><h3 id="hmacimportparams-hash-1" tabindex="-1"><a class="header-anchor" href="#hmacimportparams-hash-1"><span><code>hmacImportParams.hash</code></span></a></h3><p>åœ¨ Node.js v21.7.1 çš„ Web åŠ å¯† API ä¸­ï¼Œå½“ä½ æƒ³è¦å¯¼å…¥æˆ–åˆ›å»º HMAC å¯†é’¥æ—¶ï¼Œéœ€è¦æŒ‡å®šä½¿ç”¨å“ªç§å“ˆå¸Œå‡½æ•°ã€‚<code>hmacImportParams.hash</code>æ­£æ˜¯è¿™æ ·ä¸€ä¸ªé…ç½®é¡¹ï¼Œå®ƒå‘Šè¯‰ API ä½¿ç”¨å“ªç§å“ˆå¸Œç®—æ³•æ¥ç”Ÿæˆæˆ–éªŒè¯ HMACã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-16"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼Œéœ€è¦ç¡®ä¿å‘é€ç»™ç”¨æˆ·çš„æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚ä½ å†³å®šä½¿ç”¨ HMAC æ¥å¢åŠ ä¸€ä¸ªå®‰å…¨å±‚ï¼š</p><ol><li><strong>ç”Ÿæˆ HMAC å¯†é’¥</strong>:<br> ä½ é¦–å…ˆéœ€è¦ç”Ÿæˆä¸€ä¸ª HMAC å¯†é’¥ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>hmacImportParams.hash</code>ç”¨äºæŒ‡å®šç”Ÿæˆ HMAC æ‰€ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ç±»å‹ï¼Œä¾‹å¦‚ï¼š&quot;SHA-256&quot;ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨SHA-256ä½œä¸ºå“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯æå–</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ä½¿ç”¨ HMAC ç­¾åæ¶ˆæ¯</strong>:<br> å½“ä½ æœ‰äº† HMAC å¯†é’¥åï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œå³è®¡ç®—æ¶ˆæ¯çš„ HMACã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// å°†æ¶ˆæ¯è½¬æ¢ä¸ºArrayBuffer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>éªŒè¯ç­¾å</strong>:<br> æ¥æ”¶æ–¹ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œå“ˆå¸Œå‡½æ•°å¯¹æ”¶åˆ°çš„æ¶ˆæ¯è®¡ç®— HMACï¼Œç„¶åæ¯”è¾ƒè®¡ç®—å‡ºçš„ HMAC å’Œå‘é€æ–¹æä¾›çš„ HMAC æ˜¯å¦ä¸€è‡´ï¼Œæ¥éªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifySignature</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encoder</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    key</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encoder</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// å°†æ¶ˆæ¯è½¬æ¢ä¸ºArrayBuffer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-8" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-8"><span>æ€»ç»“</span></a></h3><p><code>hmacImportParams.hash</code>åœ¨ Node.js çš„ Web åŠ å¯† API ä¸­æ˜¯ç”¨æ¥æŒ‡å®šåœ¨ HMAC æ“ä½œä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°çš„ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°å…¶åœ¨ç”Ÿæˆ HMAC å¯†é’¥ã€ç­¾åæ¶ˆæ¯å’ŒéªŒè¯ç­¾åä¸­çš„åº”ç”¨ï¼Œè¿™å¯¹äºç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</p><h4 id="hmacimportparams-length" tabindex="-1"><a class="header-anchor" href="#hmacimportparams-length"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hmacimportparamslength" target="_blank" rel="noopener noreferrer">hmacImportParams.length</a></span></a></h4><p>è®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>hmacImportParams.length</code>ï¼Œå®ƒæ˜¯ä¸ Web Crypto API ç›¸å…³çš„ä¸€ä¸ªç‰¹æ€§ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç™½ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><strong>HMAC</strong>ï¼šä»£è¡¨â€œå“ˆå¸Œæ¶ˆæ¯è®¤è¯ç â€(Hash-based Message Authentication Code)ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºæ¶ˆæ¯è®¤è¯çš„å®‰å…¨æŠ€æœ¯ï¼Œç»“åˆäº†åŠ å¯†å“ˆå¸Œå‡½æ•°å’Œå¯†é’¥ã€‚ç®€å•æ¥è¯´ï¼ŒHMAC å¯ä»¥ç”¨æ¥éªŒè¯ä¼ è¾“æˆ–å­˜å‚¨çš„æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</li><li><strong>Web Crypto API</strong>ï¼šæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„ JavaScript APIï¼Œæ—¨åœ¨æ‰§è¡ŒåŒ…æ‹¬åŠ å¯†ã€è§£å¯†ã€ç­¾åã€éªŒè¯ç­‰åœ¨å†…çš„å¤šç§åŠ å¯†æ“ä½œã€‚Node.js å®ç°äº†ç±»ä¼¼çš„ APIï¼Œå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œè¿™äº›æ“ä½œã€‚</li></ul><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ <code>hmacImportParams.length</code>ï¼š</p><h3 id="hmacimportparams-length-1" tabindex="-1"><a class="header-anchor" href="#hmacimportparams-length-1"><span>hmacImportParams.length</span></a></h3><p>åœ¨ä½¿ç”¨ Web Crypto API æˆ– Node.js çš„åŠ å¯†æ¨¡å—è¿›è¡Œ HMAC æ“ä½œæ—¶ï¼Œä½ å¯èƒ½ä¼šéœ€è¦å¯¼å…¥ä¸€ä¸ªå¯†é’¥ã€‚<code>hmacImportParams</code> æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä½¿ç”¨çš„å‚æ•°å¯¹è±¡ä¹‹ä¸€ï¼Œè€Œ <code>.length</code> å±æ€§æŒ‡çš„æ˜¯æœŸæœ›çš„å“ˆå¸Œé•¿åº¦ï¼Œä»¥ä½ä¸ºå•ä½ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­å¯ä»¥æ›´å¥½åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼š</p><h4 id="ç¤ºä¾‹-1-éªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-éªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§"><span>ç¤ºä¾‹ 1ï¼šéªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªåŠŸèƒ½æ˜¯æ¥æ”¶æ¥è‡ªå¦ä¸€ä¸ªç³»ç»Ÿçš„æ¶ˆæ¯ï¼Œå¹¶éªŒè¯è¿™äº›æ¶ˆæ¯æ²¡æœ‰åœ¨ä¼ è¾“é€”ä¸­è¢«ç¯¡æ”¹ã€‚ä½ å¯ä»¥ä½¿ç”¨ HMAC æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><ol><li>å‘é€æ–¹æ‹¿åˆ°æ¶ˆæ¯ï¼Œä½¿ç”¨ç‰¹å®šçš„å¯†é’¥å’Œå“ˆå¸Œç®—æ³•ï¼ˆæ¯”å¦‚ SHA-256ï¼‰ç”Ÿæˆæ¶ˆæ¯çš„ HMAC å€¼ã€‚</li><li>æ¥æ”¶æ–¹ä¹Ÿä½¿ç”¨åŒæ ·çš„å¯†é’¥å’Œå“ˆå¸Œç®—æ³•å¯¹æ¥æ”¶åˆ°çš„æ¶ˆæ¯é‡æ–°è®¡ç®— HMAC å€¼ã€‚</li><li>æ¥æ”¶æ–¹å°†ä¸¤ä¸ª HMAC å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå®ƒä»¬ä¸€è‡´ï¼Œå°±å¯ä»¥ç¡®è®¤æ¶ˆæ¯æ˜¯å®Œæ•´çš„ã€‚</li></ol><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå½“å‘é€æ–¹ç”Ÿæˆ HMAC å€¼æ—¶ï¼Œä»–ä»¬å¯èƒ½ä¼šé€šè¿‡ Node.js çš„ API è®¾ç½® <code>hmacImportParams.length</code>ï¼Œä»¥æŒ‡å®šä½¿ç”¨å“ªä¸ªå“ˆå¸Œå‡½æ•°çš„ç‰¹å®šé•¿åº¦ã€‚</p><h4 id="ç¤ºä¾‹-2-å®‰å…¨å­˜å‚¨æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å®‰å…¨å­˜å‚¨æ–‡ä»¶"><span>ç¤ºä¾‹ 2ï¼šå®‰å…¨å­˜å‚¨æ–‡ä»¶</span></a></h4><p>å½“ä½ éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰å…¨åœ°å­˜å‚¨æ–‡ä»¶ï¼Œä½†åŒæ—¶è¿˜è¦ç¡®ä¿å®ƒä»¬åœ¨å­˜å‚¨æˆ–ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹æ—¶ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ HMACã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶ï¼š</p><ol><li>ä½ è®¡ç®—æ–‡ä»¶å†…å®¹çš„ HMAC å€¼å¹¶ä¿å­˜ä¸‹æ¥ã€‚</li><li>å½“æ–‡ä»¶è¢«è¯·æ±‚æˆ–æ£€æŸ¥æ—¶ï¼Œå†æ¬¡è®¡ç®—å…¶ HMAC å€¼ã€‚</li><li>å¯¹æ¯”è¿™ä¸¤ä¸ªå€¼ï¼Œä»¥éªŒè¯æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚</li></ol><p>åœ¨è®¡ç®— HMAC å€¼æ—¶ï¼Œ<code>hmacImportParams.length</code> å…è®¸ä½ æ˜ç¡®é€‰æ‹©ç®—æ³•å¼ºåº¦ï¼Œä»¥åŒ¹é…å®‰å…¨è¦æ±‚ã€‚</p><h3 id="æ€»ç»“-9" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-9"><span>æ€»ç»“</span></a></h3><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>hmacImportParams.length</code> åœ¨ Node.js ä¸­å…è®¸ä½ åœ¨ä½¿ç”¨ HMAC è¿›è¡ŒåŠ å¯†æ“ä½œæ—¶ï¼ŒæŒ‡å®šä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°çš„è¾“å‡ºé•¿åº¦ã€‚é€šè¿‡è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œä½ å¯ä»¥æ ¹æ®å®‰å…¨éœ€æ±‚é€‰æ‹©ä¸åŒçš„ç®—æ³•å¼ºåº¦ï¼Œè¿›è€Œæé«˜åº”ç”¨çš„å®‰å…¨æ€§ã€‚</p><h4 id="hmacimportparams-name" tabindex="-1"><a class="header-anchor" href="#hmacimportparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hmacimportparamsname" target="_blank" rel="noopener noreferrer">hmacImportParams.name</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠèŠ Node.js ç‰ˆæœ¬ 21.7.1 ä¸­çš„ <code>hmacImportParams.name</code>ï¼Œè¿™æ˜¯åœ¨ä½¿ç”¨ Node.js çš„ Web Crypto API æ—¶ä¼šé‡åˆ°çš„ä¸€ä¸ªæ¦‚å¿µã€‚é¦–å…ˆï¼Œæˆ‘ä¼šåˆ†æ­¥éª¤è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼Œç„¶åç»™å‡ºä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-hmac" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-hmac"><span>ä»€ä¹ˆæ˜¯ HMACï¼Ÿ</span></a></h3><p>åœ¨æ·±å…¥ <code>hmacImportParams.name</code> ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ HMAC æ˜¯ä»€ä¹ˆã€‚HMAC æ„å‘³ç€â€œHash-based Message Authentication Codeâ€ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºè®¡ç®—å’ŒéªŒè¯æ¶ˆæ¯è®¤è¯ç çš„æŠ€æœ¯ï¼Œç»“åˆäº†åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸ä¸€ä¸ªç§˜å¯†å¯†é’¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒèƒ½ç¡®ä¿ä¿¡æ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><h3 id="web-crypto-api-1" tabindex="-1"><a class="header-anchor" href="#web-crypto-api-1"><span>Web Crypto API</span></a></h3><p>Web Crypto API æä¾›äº†ä¸€ä¸ªè¿›è¡ŒåŠ å¯†æ“ä½œçš„æ ‡å‡†æ¥å£ã€‚åœ¨ Node.js ä¸­ï¼Œè¿™å…è®¸ä½ æ‰§è¡Œåƒç”Ÿæˆå¯†é’¥ã€åŠ å¯†æ•°æ®ä»¥åŠåˆ›å»ºæ•°å­—ç­¾åç­‰å®‰å…¨æ“ä½œï¼Œè€Œæ— éœ€ç¬¬ä¸‰æ–¹åº“ã€‚</p><h3 id="hmacimportparams-name-1" tabindex="-1"><a class="header-anchor" href="#hmacimportparams-name-1"><span><code>hmacImportParams.name</code></span></a></h3><p>åœ¨ Web Crypto API ä¸­ï¼Œå½“ä½ æƒ³è¦å¯¼å…¥ï¼ˆimportï¼‰ä¸€ä¸ª HMAC å¯†é’¥æ—¶ï¼Œä½ éœ€è¦æŒ‡å®šä¸€äº›å‚æ•°ï¼Œ<code>hmacImportParams</code> å°±æ˜¯è¿™æ ·çš„ä¸€ç»„å‚æ•°ã€‚å…¶ä¸­ï¼Œ<code>.name</code> å±æ€§ç”¨äºæ˜ç¡®ä½ è¦è¿›è¡Œçš„æ“ä½œç±»å‹ï¼Œå¯¹äº HMAC æ¥è¯´ï¼Œè¿™ä¸ªå€¼åº”è¯¥æ˜¯ <code>&quot;HMAC&quot;</code>ã€‚</p><p>å…¶å®ï¼Œ<code>hmacImportParams</code> å¯¹è±¡é€šå¸¸è¿˜åŒ…å«å…¶ä»–å±æ€§æ¥å…·ä½“å®šä¹‰ HMAC æ“ä½œçš„ç»†èŠ‚ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>hash</code>: å®šä¹‰ä½¿ç”¨å“ªç§å“ˆå¸Œå‡½æ•°ï¼Œå¦‚ <code>&quot;SHA-256&quot;</code>ã€‚</li><li><code>length</code>: å¯†é’¥é•¿åº¦ï¼ˆå¯é€‰ï¼‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºå¹¶å¯¼å…¥ä¸€ä¸ª-hmac-å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºå¹¶å¯¼å…¥ä¸€ä¸ª-hmac-å¯†é’¥"><span>1. åˆ›å»ºå¹¶å¯¼å…¥ä¸€ä¸ª HMAC å¯†é’¥</span></a></h4><p>å‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ª HMAC å¯†é’¥å¹¶ä½¿ç”¨ SHA-256 ä½œä¸ºå“ˆå¸Œå‡½æ•°ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å®šä¹‰å¯¼å…¥å¯†é’¥æ—¶ä½¿ç”¨çš„å‚æ•°ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> hmacImportParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>crypto.subtle.importKey</code> æ–¹æ³•æ¥å¯¼å…¥å¯†é’¥ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦å‡ ä¸ªå‚æ•°ï¼šæ ¼å¼ï¼ˆä¾‹å¦‚ <code>&quot;raw&quot;</code>ï¼‰ã€å¯†é’¥æ•°æ®ã€<code>hmacImportParams</code> ä»¥åŠä¸¤ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºå¯†é’¥æ˜¯å¦å¯è¢«æå–å’Œå¯†é’¥çš„ä½¿ç”¨æƒé™ã€‚</p><p>æ¯”å¦‚ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keyData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#81A1C1;">...</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å‡è®¾è¿™æ˜¯ä½ çš„å¯†é’¥æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥æ ¼å¼</span></span>
<span class="line"><span style="color:#D8DEE9;">  keyData</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // åŸå§‹å¯†é’¥æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9;">  hmacImportParams</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä¸Šé¢å®šä¹‰çš„å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  false</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯æå–</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ä½¿ç”¨-hmac-å¯†é’¥éªŒè¯æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨-hmac-å¯†é’¥éªŒè¯æ•°æ®"><span>2. ä½¿ç”¨ HMAC å¯†é’¥éªŒè¯æ•°æ®</span></a></h4><p>å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ª HMAC å¯†é’¥ï¼Œç°åœ¨ä½ æƒ³è¦éªŒè¯ä¸€æ®µæ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>crypto.subtle.verify</code> æ–¹æ³•ï¼Œå‘å®ƒä¼ å…¥ç›¸åŒçš„å“ˆå¸Œå‚æ•°ã€å¯†é’¥ã€åŸå§‹æ•°æ®å’Œä½ æƒ³è¦éªŒè¯çš„ç­¾åã€‚</p><h3 id="æ€»ç»“-10" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-10"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä¸Šè¿°è§£é‡Šå’Œç¤ºä¾‹ï¼Œæˆ‘å¸Œæœ›ä½ å¯¹ <code>hmacImportParams.name</code> åœ¨ Node.js ä¸­çš„ä½œç”¨æœ‰äº†æ¸…æ™°çš„ç†è§£ã€‚å®ƒæ˜¯å‘Šè¯‰ Web Crypto API ä½ æƒ³è¦æ‰§è¡Œ HMAC æ“ä½œçš„ä¸€éƒ¨åˆ†å‚æ•°é…ç½®ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ­£ç¡®æŒ‡å®šå…¶ä»–ä¸€äº›å‚æ•°æ‰èƒ½é¡ºåˆ©å®Œæˆå¯†é’¥çš„å¯¼å…¥æˆ–å…¶ä»–ç›¸å…³æ“ä½œã€‚</p><h3 id="class-hmackeygenparams" tabindex="-1"><a class="header-anchor" href="#class-hmackeygenparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-hmackeygenparams" target="_blank" rel="noopener noreferrer">Class: HmacKeyGenParams</a></span></a></h3><p>Node.js çš„ <code>HmacKeyGenParams</code> æ˜¯åœ¨ Web Crypto API ä¸­å®šä¹‰çš„ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œç”¨äºåœ¨ç”Ÿæˆ HMAC (Hash-based Message Authentication Code) å¯†é’¥æ—¶æŒ‡å®šå…·ä½“çš„å‚æ•°ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥ä¹‹åå¯ä»¥ç”¨äº HMAC æ“ä½œï¼Œå³ä¸€ç§åˆ©ç”¨å“ˆå¸Œç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯çš„æ–¹å¼ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-7" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-7"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ul><li><strong>HMAC</strong>: å®ƒæ˜¯ä¸€ç§ç”¨äºæ¶ˆæ¯è®¤è¯çš„æŠ€æœ¯ï¼Œç»“åˆäº†å“ˆå¸Œå‡½æ•°å’Œå¯†é’¥ã€‚é€šè¿‡ç¡®ä¿æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ï¼Œå®ƒä¸ºä¿¡æ¯ä¼ è¾“æä¾›äº†å®Œæ•´æ€§å’Œé‰´æƒã€‚</li><li><strong>å“ˆå¸Œå‡½æ•°</strong>: ä¸€ç§å°†æ•°æ®è½¬æ¢ä¸ºå›ºå®šå¤§å°è¾“å‡ºï¼ˆé€šå¸¸ç§°ä¸ºå“ˆå¸Œå€¼æˆ–æ‘˜è¦ï¼‰çš„å‡½æ•°ã€‚å¯¹äºä»»ä½•ç»™å®šçš„è¾“å…¥ï¼Œå“ˆå¸Œå‡½æ•°æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼Œä½†ä»è¾“å‡ºå¾ˆéš¾åæ¨åŸå§‹æ•°æ®ã€‚</li></ul><h3 id="hmackeygenparams-å‚æ•°è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#hmackeygenparams-å‚æ•°è¯¦è§£"><span><code>HmacKeyGenParams</code> å‚æ•°è¯¦è§£</span></a></h3><p>å½“ä½ æƒ³è¦ç”Ÿæˆä¸€ä¸ª HMAC å¯†é’¥çš„æ—¶å€™ï¼Œä½ éœ€è¦æŒ‡å®šä¸€äº›å‚æ•°ï¼Œè¿™å°±æ˜¯ <code>HmacKeyGenParams</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å®ƒä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li><strong><code>name</code></strong>: è¿™é‡Œåº”è¯¥å¡« <code>&quot;HMAC&quot;</code>ï¼Œè¡¨ç¤ºä½ è¦ç”Ÿæˆçš„æ˜¯ HMAC ç±»å‹çš„å¯†é’¥ã€‚</li><li><strong><code>hash</code></strong>: æŒ‡å®šä½¿ç”¨å“ªç§å“ˆå¸Œå‡½æ•°æ¥ç”Ÿæˆæ‘˜è¦ã€‚å¸¸è§çš„é€‰é¡¹æœ‰ <code>&quot;SHA-256&quot;</code>, <code>&quot;SHA-384&quot;</code>, <code>&quot;SHA-512&quot;</code> ç­‰ã€‚ä¸åŒçš„é€‰æ‹©ä¼šå½±å“å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</li></ul><h3 id="å®é™…ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦ç¡®ä¿å‘é€ç»™ç”¨æˆ·çš„ä¿¡æ¯æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚æˆ‘ä»¬å†³å®šä½¿ç”¨ HMAC æ¥å¯¹ä¿¡æ¯è¿›è¡Œç­¾åå’ŒéªŒè¯ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ Node.js ä¸­çš„ Web Crypto API æ¥ç”Ÿæˆ HMAC å¯†é’¥çš„ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> SubtleCrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateHMACKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> keyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // ä½¿ç”¨SHA-256ä½œä¸ºå“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> SubtleCrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">      keyGenParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”ï¼šç­¾åå’ŒéªŒè¯</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HMAC Key generated successfully!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error generating HMAC Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateHMACKey</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>crypto</code> æ¨¡å—ä¸­çš„ <code>webcrypto</code> å¯¹è±¡ã€‚ç„¶åå®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>generateHMACKey</code>ï¼Œå®ƒä½¿ç”¨ <code>&quot;HMAC&quot;</code> ä½œä¸ºåç§°å’Œ <code>&quot;SHA-256&quot;</code> ä½œä¸ºå“ˆå¸Œå‡½æ•°åˆ›å»ºä¸€ä¸ª <code>HmacKeyGenParams</code> å¯¹è±¡ã€‚è¯¥å‡½æ•°è°ƒç”¨ <code>SubtleCrypto.subtle.generateKey()</code> æ–¹æ³•æ¥ç”Ÿæˆå¯†é’¥ï¼Œå¹¶è®¾ç½®å¯†é’¥å¯å¯¼å‡ºï¼Œç”¨é€”ä¸ºâ€œç­¾åâ€å’Œâ€œéªŒè¯â€ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ç”Ÿæˆçš„ HMAC å¯†é’¥ï¼Œå¯ä»¥ç”¨æ¥å¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œéšååˆèƒ½ç”¨åŒä¸€å¯†é’¥éªŒè¯è¿™ä¸ªç­¾åï¼Œä»è€Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><h4 id="hmackeygenparams-hash" tabindex="-1"><a class="header-anchor" href="#hmackeygenparams-hash"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hmackeygenparamshash" target="_blank" rel="noopener noreferrer">hmacKeyGenParams.hash</a></span></a></h4><p>äº†è§£<code>hmacKeyGenParams.hash</code>ä¹‹å‰ï¼Œå’±ä»¬å…ˆç®€å•èŠä¸€èŠå‡ ä¸ªç›¸å…³çš„æ¦‚å¿µï¼šNode.jsã€Web Crypto API ä»¥åŠ HMACã€‚</p><h3 id="_1-node-js" tabindex="-1"><a class="header-anchor" href="#_1-node-js"><span>1. Node.js</span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¯ä»¥è®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚å®ƒéå¸¸é€‚åˆå¼€å‘éœ€è¦å¤„ç†å¤§é‡ç½‘ç»œè¯·æ±‚çš„åº”ç”¨ï¼Œæ¯”å¦‚ç½‘ç«™åç«¯æœåŠ¡ã€‚</p><h3 id="_2-web-crypto-api" tabindex="-1"><a class="header-anchor" href="#_2-web-crypto-api"><span>2. Web Crypto API</span></a></h3><p>Web Crypto API æ˜¯ä¸€ä¸ªæµè§ˆå™¨å’Œ Node.js ä¸­æä¾›çš„åŠ å¯†æ ‡å‡†ï¼Œå®ƒå…è®¸ä½ åœ¨ Web åº”ç”¨ä¸­æ‰§è¡Œå„ç§åŠ å¯†æ“ä½œï¼Œä¾‹å¦‚ç”Ÿæˆå¯†é’¥ã€åŠ å¯†æ•°æ®ã€éªŒè¯æ•°æ®ç­‰ã€‚</p><h3 id="_3-hmac-hash-based-message-authentication-code" tabindex="-1"><a class="header-anchor" href="#_3-hmac-hash-based-message-authentication-code"><span>3. HMAC (Hash-based Message Authentication Code)</span></a></h3><p>HMAC æ˜¯ä¸€ç§é€šè¿‡ç‰¹å®šç®—æ³•ç»“åˆå¯†é’¥å’Œæ¶ˆæ¯æ¥ä¿è¯æ¶ˆæ¯å®Œæ•´æ€§çš„æŠ€æœ¯ã€‚å®ƒç»å¸¸ç”¨äºç½‘ç»œé€šä¿¡ä¸­éªŒè¯æ¶ˆæ¯æ˜¯å¦è¢«ç¯¡æ”¹ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹<code>hmacKeyGenParams.hash</code>è¿™ä¸ªå…·ä½“çš„å‚æ•°ï¼š</p><p>åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œ HMAC å¯†é’¥ç”Ÿæˆæ—¶ï¼Œ<code>hmacKeyGenParams</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†ç”Ÿæˆ HMAC å¯†é’¥æ‰€éœ€çš„å‚æ•°ã€‚å…¶ä¸­ä¸€ä¸ªé‡è¦çš„å±æ€§å°±æ˜¯<code>hash</code>ã€‚</p><h3 id="hmackeygenparams-hash-1" tabindex="-1"><a class="header-anchor" href="#hmackeygenparams-hash-1"><span><code>hmacKeyGenParams.hash</code></span></a></h3><ul><li><strong>ä½œç”¨</strong>ï¼šè¿™ä¸ªå±æ€§å†³å®šäº† HMAC æ“ä½œä¸­å°†è¦ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ç±»å‹ã€‚ç®€å•æ¥è¯´ï¼Œå“ˆå¸Œå‡½æ•°å°±æ˜¯æŠŠè¾“å…¥ï¼ˆæ¯”å¦‚ä¸€æ®µæ–‡æœ¬ï¼‰è½¬æ¢æˆå›ºå®šå¤§å°çš„å­—ç¬¦ä¸²ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸²çœ‹èµ·æ¥éšæœºçš„å­—ç¬¦ï¼‰ã€‚å¸¸è§çš„å“ˆå¸Œå‡½æ•°æœ‰ SHA-256ã€SHA-384 ç­‰ã€‚</li><li><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼šä¸åŒçš„å“ˆå¸Œå‡½æ•°å®‰å…¨æ€§ä¸åŒï¼Œé€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°å¯¹ä¿è¯æ•°æ®çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</li></ul><h3 id="å®é™…ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-3"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦ä¿è¯ç”¨æˆ·å‘é€åˆ°æœåŠ¡å™¨çš„ä¿¡æ¯æœªè¢«ç¯¡æ”¹ã€‚</p><ol><li><p><strong>ç”¨æˆ·æ³¨å†Œ</strong>ï¼šç”¨æˆ·åˆ›å»ºè´¦æˆ·æ—¶è®¾ç½®å¯†ç ã€‚ä½ å¯ä»¥ä½¿ç”¨ HMAC ä¸ç”¨æˆ·å¯†ç ç»“åˆç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œç„¶åå­˜å‚¨è¿™ä¸ªå¯†é’¥è€ŒéåŸå¯†ç ã€‚è¿™æ ·å³ä½¿æ•°æ®åº“è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿéš¾ä»¥å¾—åˆ°åŸå§‹å¯†ç ã€‚</p><p>ä½¿ç”¨<code>hmacKeyGenParams</code>æ—¶å¯èƒ½ä¼šè¿™æ ·å®šä¹‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> hmacKeyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // ä½¿ç”¨SHA-256ä½œä¸ºå“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">  length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ•°æ®éªŒè¯</strong>ï¼šç”¨æˆ·æ¯æ¬¡å‘æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯å…ˆä½¿ç”¨ HMAC ç”Ÿæˆæ•°æ®çš„â€œç­¾åâ€ï¼ŒæœåŠ¡å™¨æ”¶åˆ°æ•°æ®åå†æ¬¡ä½¿ç”¨ç›¸åŒå¯†é’¥ç”Ÿæˆç­¾åï¼Œå¹¶æ¯”å¯¹ä¸¤ä¸ªç­¾åæ˜¯å¦ä¸€è‡´ï¼Œä»è€ŒéªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„<code>hash</code>å±æ€§å¯¹äºä¿è¯æ•°æ®çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</p></li></ol><h3 id="ç»“è®º-5" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-5"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä»¥ä¸Šè§£é‡Šå’Œä¾‹å­ï¼Œä½ åº”è¯¥å¯¹<code>hmacKeyGenParams.hash</code>æœ‰äº†è¾ƒä¸ºæ·±å…¥çš„ç†è§£ã€‚å®ƒæ˜¯åœ¨ç”Ÿæˆ HMAC å¯†é’¥æ—¶å¿…é¡»æŒ‡å®šçš„å‚æ•°ä¹‹ä¸€ï¼Œå†³å®šäº†å“ˆå¸Œå‡½æ•°çš„ç±»å‹ï¼Œç›´æ¥å½±å“åˆ°æ•°æ®å®‰å…¨æ€§ã€‚åœ¨å®é™…åº”ç”¨ä¸­æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°éå¸¸é‡è¦ã€‚</p><h4 id="hmackeygenparams-length" tabindex="-1"><a class="header-anchor" href="#hmackeygenparams-length"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hmackeygenparamslength" target="_blank" rel="noopener noreferrer">hmacKeyGenParams.length</a></span></a></h4><p>Node.js çš„ Web Crypto API æ˜¯ä¸€ä¸ªç”¨äºåŠ å¯†çš„æ ‡å‡†æ¥å£ï¼Œå®ƒå…è®¸ä½ åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œå„ç§å¯†ç å­¦æ“ä½œï¼Œå¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­‰ã€‚åœ¨è¿™ä¸ª API ä¸­ï¼Œ<code>hmacKeyGenParams.length</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº HMACï¼ˆHash-based Message Authentication Codeï¼‰å¯†é’¥ç”Ÿæˆçš„å‚æ•°ã€‚è¿™é‡Œçš„<code>length</code>æŒ‡çš„æ˜¯ç”Ÿæˆçš„å¯†é’¥é•¿åº¦ï¼Œå•ä½ä¸ºæ¯”ç‰¹ï¼ˆbitsï¼‰ã€‚</p><h3 id="hmac-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#hmac-ç®€ä»‹"><span>HMAC ç®€ä»‹</span></a></h3><p>HMAC æ˜¯ä¸€ç§åŸºäºå“ˆå¸Œå‡½æ•°çš„æ¶ˆæ¯è®¤è¯ç ï¼Œå®ƒç»“åˆäº†ä¸€ä¸ªå¯†é’¥ä¸ä¸€ä¸ªæ¶ˆæ¯ï¼Œé€šè¿‡ç‰¹å®šçš„å“ˆå¸Œç®—æ³•ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ï¼ˆæˆ–ç§°ä¸ºç­¾åï¼‰ã€‚HMAC è¢«å¹¿æ³›ç”¨äºä¿¡æ¯å®‰å…¨é¢†åŸŸï¼Œå¦‚æ•°æ®å®Œæ•´æ€§æ£€æŸ¥å’Œèº«ä»½éªŒè¯ã€‚</p><h3 id="hmackeygenparams-length-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#hmackeygenparams-length-çš„ä½œç”¨"><span>hmacKeyGenParams.length çš„ä½œç”¨</span></a></h3><p>å½“æˆ‘ä»¬æƒ³è¦ç”Ÿæˆä¸€ä¸ª HMAC å¯†é’¥æ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€äº›å‚æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬<code>length</code>ã€‚<code>length</code>å®šä¹‰äº†å¯†é’¥çš„å¤§å°ï¼Œè¿™å¯¹äºå¯†é’¥çš„å¼ºåº¦éå¸¸å…³é”®ã€‚é€šå¸¸ï¼Œè¾ƒé•¿çš„å¯†é’¥æä¾›æ›´é«˜çš„å®‰å…¨æ€§ï¼Œä½†ä¹Ÿå¯èƒ½å½±å“ç®—æ³•çš„æ€§èƒ½ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-17"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªç”¨äº HMAC æ“ä½œçš„å¯†é’¥ï¼Œå¹¶ç¡®å®šå¯†é’¥é•¿åº¦ä¸º 256 ä½ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„å¯†é’¥å°†æœ‰è¶³å¤Ÿçš„å¼ºåº¦æ¥ä¿æŠ¤æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -8" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -8"><span>ç¤ºä¾‹ä»£ç </span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateHMACKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> keyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨SHA-256å“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">      length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦ä¸º256ä½</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyGenParams</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HMAC Key Generated:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // åœ¨è¿™é‡Œï¼Œkeyå¯ä»¥ç”¨äºåç»­çš„ç­¾åæˆ–éªŒè¯æ“ä½œ</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error generating HMAC key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateHMACKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„<code>crypto</code>æ¨¡å—ä¸­çš„<code>webcrypto</code>å¯¹è±¡ï¼Œå¹¶ä»ä¸­è·å–äº†<code>subtle</code>å¯¹è±¡ã€‚<code>subtle</code>å¯¹è±¡æä¾›äº†åŠ å¯†æ“ä½œçš„æ–¹æ³•ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>generateHMACKey</code>å‡½æ•°æ¥ç”Ÿæˆ HMAC å¯†é’¥ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>subtle.generateKey</code>æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯†é’¥ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå¯†é’¥çš„å‚æ•°ï¼ˆ<code>keyGenParams</code>ï¼‰ï¼Œä¸€ä¸ªå¸ƒå°”å€¼æŒ‡ç¤ºå¯†é’¥æ˜¯å¦å¯ä»¥å¯¼å‡ºï¼ˆåœ¨è¿™ä¸ªä¾‹å­é‡Œè®¾ç½®ä¸º<code>true</code>ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‡å®šæˆ‘ä»¬æ‰“ç®—ç”¨è¿™ä¸ªå¯†é’¥è¿›è¡Œçš„æ“ä½œï¼ˆè¿™é‡Œæ˜¯<code>&#39;sign&#39;</code>å’Œ<code>&#39;verify&#39;</code>ï¼‰ã€‚<code>keyGenParams</code>å¯¹è±¡ä¸­åŒ…æ‹¬äº†æˆ‘ä»¬å‰é¢è®¨è®ºçš„<code>length</code>å±æ€§ï¼Œä»¥åŠæˆ‘ä»¬é€‰æ‹©çš„å“ˆå¸Œå‡½æ•°<code>&#39;SHA-256&#39;</code>ã€‚</p><p>é€šè¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ Web Crypto API æ¥ç”Ÿæˆç¬¦åˆç‰¹å®šè¦æ±‚ï¼ˆå¦‚å¯†é’¥é•¿åº¦ï¼‰çš„ HMAC å¯†é’¥ã€‚</p><h4 id="hmackeygenparams-name" tabindex="-1"><a class="header-anchor" href="#hmackeygenparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#hmackeygenparamsname" target="_blank" rel="noopener noreferrer">hmacKeyGenParams.name</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆåˆ° Node.js v21.7.1 ä¸­çš„<code>hmacKeyGenParams.name</code>, æˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºåœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œå¯†ç å­¦æ“ä½œæ—¶ç‰¹åˆ«æ˜¯åœ¨ç”Ÿæˆ HMACï¼ˆHash-based Message Authentication Codeï¼ŒåŸºäºæ•£åˆ—çš„æ¶ˆæ¯è®¤è¯ç ï¼‰å¯†é’¥æ—¶çš„ä¸€ä¸ªå‚æ•°é…ç½®ã€‚</p><p>åœ¨å¯†ç å­¦ä¸­ï¼ŒHMAC ç”¨äºç¡®ä¿ä¿¡æ¯ä¼ è¾“çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚å®ƒç»“åˆäº†æ•£åˆ—å‡½æ•°ï¼ˆå¦‚ SHA-256ï¼‰å’Œä¸€ä¸ªå¯†é’¥ï¼Œä»¥äº§ç”Ÿå‡ ä¹ä¸å¯èƒ½ä¼ªé€ çš„çŸ­æ¶ˆæ¯ï¼Œè€Œä¸çŸ¥é“æ­£ç¡®çš„å¯†é’¥ã€‚</p><h3 id="hmackeygenparams-name-1" tabindex="-1"><a class="header-anchor" href="#hmackeygenparams-name-1"><span><code>hmacKeyGenParams.name</code></span></a></h3><p>è¿™ä¸ªå±æ€§å¾ˆç®€å•ï¼šå®ƒæŒ‡çš„æ˜¯ä½ æƒ³è¦ä½¿ç”¨çš„ç®—æ³•çš„åç§°ï¼Œåœ¨ç”Ÿæˆ HMAC å¯†é’¥æ—¶ï¼Œè¿™ä¸ªå€¼åº”è¯¥è®¾ç½®ä¸º<code>&quot;HMAC&quot;</code>ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ª HMAC å¯†é’¥æ¥å®‰å…¨åœ°éªŒè¯å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚ä»¥ä¸‹æ­¥éª¤å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Web Crypto API æ¥ç”Ÿæˆè¿™æ ·ä¸€ä¸ªå¯†é’¥ï¼š</p><ol><li><strong>å¼•å…¥ Crypto æ¨¡å—</strong>:</li></ol><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ Node.js çš„å†…ç½®<code>crypto</code>æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—åŒ…å«äº†å®ç°å„ç§å¯†ç å­¦æ“ä½œçš„åŠŸèƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li><strong>å®šä¹‰ HMAC å¯†é’¥ç”Ÿæˆå‚æ•°</strong>:</li></ol><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥æŒ‡å®šç”Ÿæˆ HMAC å¯†é’¥æ—¶è¦ä½¿ç”¨çš„å‚æ•°ã€‚è¿™é‡Œæœ€é‡è¦çš„éƒ¨åˆ†æ˜¯<code>name</code>å±æ€§ï¼Œå®ƒå‘Šè¯‰ API æˆ‘ä»¬æƒ³è¦ç”Ÿæˆçš„æ˜¯ HMAC å¯†é’¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HMAC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šä½¿ç”¨çš„hashå‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">  length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>ç”Ÿæˆ HMAC å¯†é’¥</strong>:</li></ol><p>ç°åœ¨ï¼Œä½¿ç”¨<code>subtle.generateKey</code>æ–¹æ³•æ¥å®é™…ç”Ÿæˆå¯†é’¥ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨<code>async/await</code>è¯­æ³•å¤„ç†è¿”å›çš„ Promiseã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateHmacKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">      keyGenParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯æå–</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯ä»¥æ‰§è¡Œçš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HMAC Key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error generating HMAC key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateHmacKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬è¯·æ±‚ Web Crypto API ç”Ÿæˆä¸€ä¸ªå¯ä»¥ç”¨äºç­¾åå’ŒéªŒè¯æ“ä½œã€åŸºäº SHA-256 å“ˆå¸Œå‡½æ•°çš„ 256 ä½ HMAC å¯†é’¥ã€‚å®Œæˆåï¼Œæ§åˆ¶å°å°†è¾“å‡ºç”Ÿæˆçš„å¯†é’¥è¯¦æƒ…ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ— è®ºä½•æ—¶éœ€è¦è¿›è¡Œæ¶ˆæ¯éªŒè¯ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯†é’¥æ¥ç­¾åæ¶ˆæ¯å¹¶åœ¨å…¶ä»–ç«¯è¿›è¡ŒéªŒè¯ï¼Œè¿™æœ‰åŠ©äºç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>hmacKeyGenParams.name</code>æ˜¯åœ¨åˆ›å»º HMAC å¯†é’¥æ—¶æŒ‡å®šæˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ç®—æ³•åç§°çš„ä¸€ç§æ–¹å¼ï¼Œç¡®ä¿æˆ‘ä»¬èƒ½å¤Ÿç”Ÿæˆé€‚å½“çš„å¯†é’¥æ¥è¿›è¡Œå®‰å…¨çš„æ¶ˆæ¯è®¤è¯ã€‚</p><h3 id="class-pbkdf2params" tabindex="-1"><a class="header-anchor" href="#class-pbkdf2params"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-pbkdf2params" target="_blank" rel="noopener noreferrer">Class: Pbkdf2Params</a></span></a></h3><p>äº†è§£ <code>Pbkdf2Params</code> ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç™½ä¸¤ä¸ªå…³é”®æ¦‚å¿µï¼š<code>PBKDF2</code> å’Œ <code>Web Crypto API</code>ã€‚</p><h3 id="pbkdf2" tabindex="-1"><a class="header-anchor" href="#pbkdf2"><span>PBKDF2</span></a></h3><p><code>PBKDF2</code>ï¼ˆPassword-Based Key Derivation Function 2ï¼‰æ˜¯ä¸€ç§åŸºäºå¯†ç çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ªä¸å¤ªå®‰å…¨çš„åˆå§‹å¯†ç è½¬æ¢ä¸ºä¸€ä¸ªæ›´å®‰å…¨çš„é•¿å¯†é’¥ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ¶‰åŠåˆ°â€œç›â€ï¼ˆä¸€æ®µéšæœºæ•°æ®ï¼‰å’Œå¤šæ¬¡é‡å¤è®¡ç®—ï¼Œç›®çš„æ˜¯å¢åŠ ç ´è§£çš„éš¾åº¦ã€‚</p><h3 id="web-crypto-api-2" tabindex="-1"><a class="header-anchor" href="#web-crypto-api-2"><span>Web Crypto API</span></a></h3><p><code>Web Crypto API</code> æä¾›äº†ä¸€å¥—åŠ å¯†æ“ä½œçš„æ ‡å‡†æ¥å£ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°åŒ…æ‹¬å“ˆå¸Œã€ç­¾åã€åŠ è§£å¯†ç­‰åœ¨å†…çš„åº•å±‚åŠ å¯†æŠ€æœ¯ã€‚</p><h3 id="class-pbkdf2params-1" tabindex="-1"><a class="header-anchor" href="#class-pbkdf2params-1"><span>Class: Pbkdf2Params</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>Pbkdf2Params</code> æ˜¯æŒ‡å®š <code>PBKDF2</code> æ“ä½œå‚æ•°çš„ç±»ï¼Œå®ƒå±äº <code>Web Crypto API</code> çš„ä¸€éƒ¨åˆ†ã€‚å½“ä½ æƒ³è¦é€šè¿‡ <code>PBKDF2</code> æ–¹æ³•ç”Ÿæˆå¯†é’¥æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ° <code>Pbkdf2Params</code>ã€‚</p><p><code>Pbkdf2Params</code> ä¸»è¦åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><code>name</code>: è¿™é‡Œåº”è¯¥å¡«å†™ <code>&quot;PBKDF2&quot;</code>ï¼Œä»¥è¡¨æ˜æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ <code>PBKDF2</code> æ–¹æ³•ã€‚</li><li><code>hash</code>: æŒ‡å®šç”¨äºæ´¾ç”Ÿå¯†é’¥çš„å“ˆå¸Œå‡½æ•°ï¼Œæ¯”å¦‚ <code>&quot;SHA-256&quot;</code>ã€‚</li><li><code>salt</code>: ç›å€¼ï¼Œç”¨äºå’Œå¯†ç ä¸€èµ·è¾“å…¥åˆ°æ´¾ç”Ÿå‡½æ•°ä¸­ï¼Œå¢å¼ºå¯†é’¥çš„å®‰å…¨æ€§ã€‚</li><li><code>iterations</code>: è¿­ä»£æ¬¡æ•°ï¼Œå³æ´¾ç”Ÿå‡½æ•°é‡å¤è®¡ç®—çš„æ¬¡æ•°ã€‚è¿­ä»£æ¬¡æ•°è¶Šé«˜ï¼Œç ´è§£éš¾åº¦è¶Šå¤§ï¼Œä½†åŒæ—¶ä¹Ÿä¼šæ¶ˆè€—æ›´å¤šè®¡ç®—èµ„æºã€‚</li><li><code>length</code>: æ´¾ç”Ÿå‡ºçš„å¯†é’¥çš„æœŸæœ›é•¿åº¦ï¼ˆä»¥ä½ä¸ºå•ä½ï¼‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-18"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å­˜å‚¨ç”¨æˆ·å¯†ç çš„ç³»ç»Ÿã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œç›´æ¥å­˜å‚¨ç”¨æˆ·çš„åŸå§‹å¯†ç éå¸¸å±é™©ï¼Œå› æ­¤ä½ å†³å®šä½¿ç”¨ <code>PBKDF2</code> æ¥åŠ å¯†å¯†ç ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>Pbkdf2Params</code> æ¥ç”Ÿæˆå¯†é’¥çš„ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> deriveKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†å¯†ç è½¬æ¢ä¸ºArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> enc</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> passwordBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> enc</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»ºç›å€¼ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…ä½¿ç”¨ä¸­åº”éšæœºç”Ÿæˆ</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some_random_salt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> saltBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> enc</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">salt</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰PBKDF2å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> pbkdf2Params</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> saltBuffer</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    iterations</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿­ä»£æ¬¡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">    length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç”Ÿæˆå¯†é’¥çš„é•¿åº¦(æ¯”ç‰¹)</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨PBKDF2æ´¾ç”Ÿå¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveBits</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    pbkdf2Params</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      passwordBuffer</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">      false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveBits</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#B48EAD;">    256</span><span style="color:#616E88;"> // éœ€è¦çš„ä½æ•°</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // è½¬æ¢å¯†é’¥ä¸ºå¯è§†åŒ–æ ¼å¼</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ç”¨æˆ·å¯†ç æ˜¯&quot;userpassword&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">userpassword</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Derived key: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†ç”¨æˆ·å¯†ç å’Œç›å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œç„¶åå®šä¹‰äº† <code>PBKDF2</code> çš„å„é¡¹å‚æ•°ï¼ŒåŒ…æ‹¬ä½¿ç”¨ &quot;SHA-256&quot; ä½œä¸ºå“ˆå¸Œå‡½æ•°ã€è®¾ç½®è¿­ä»£æ¬¡æ•°ç­‰ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>crypto.subtle.deriveBits</code> æ–¹æ³•ä»¥æ´¾ç”Ÿå‡ºå®‰å…¨çš„å¯†é’¥ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²å½¢å¼å±•ç¤ºã€‚</p><p>è¿™æ ·ï¼Œå³ä¾¿æœ‰äººè·å–åˆ°äº†å­˜å‚¨çš„å¯†é’¥ï¼Œä¹Ÿæ— æ³•ç›´æ¥å¾—çŸ¥ç”¨æˆ·çš„åŸå§‹å¯†ç ï¼Œå¤§å¤§æå‡äº†å®‰å…¨æ€§ã€‚</p><h4 id="pbkdb2params-hash" tabindex="-1"><a class="header-anchor" href="#pbkdb2params-hash"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#pbkdb2paramshash" target="_blank" rel="noopener noreferrer">pbkdb2Params.hash</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js çš„ä¸–ç•Œé‡Œï¼Œæœ‰å„ç§å†…ç½®æ¨¡å—å’Œåº“æ¥å¸®åŠ©å¼€å‘è€…å®ç°å¤æ‚çš„åŠŸèƒ½ï¼Œè€Œä¸å¿…ä»å¤´å¼€å§‹ç¼–å†™æ¯ä¸€è¡Œä»£ç ã€‚å…¶ä¸­ä¹‹ä¸€å°±æ˜¯ Web Crypto APIï¼Œè¿™æ˜¯ä¸€å¥—ç”¨äºæ‰§è¡Œå„ç§åŠ å¯†æ“ä½œçš„æ ‡å‡†æ¥å£ï¼Œæ¯”å¦‚ç”Ÿæˆå¯†é’¥ã€åŠ å¯†æ•°æ®ã€åˆ›å»ºå“ˆå¸Œç­‰ã€‚</p><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>PBKDF2</code> ï¼ˆPassword-Based Key Derivation Function 2ï¼‰æ˜¯ä¸€ç§ç‰¹åˆ«çš„ç®—æ³•ï¼Œç”¨äºä»å¯†ç ä¸­æ´¾ç”Ÿå‡ºä¸€ä¸ªæˆ–å¤šä¸ªåŠ å¯†å¯†é’¥ã€‚å®ƒä¸»è¦ç”¨äºå¢åŠ å°†å¯†ç è½¬åŒ–ä¸ºå¯†é’¥çš„éš¾åº¦ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æé«˜å®‰å…¨æ€§ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªç›ï¼ˆsaltï¼‰å’Œé‡å¤æ‰§è¡Œå“ˆå¸Œå‡½æ•°å¤šæ¬¡æ¥å®ç°çš„ã€‚</p><p>å½“æˆ‘ä»¬è°ˆè®º <code>pbkdf2Params.hash</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºæ„é€  PBKDF2 æ“ä½œæ—¶æ‰€éœ€è¦æŒ‡å®šçš„å‚æ•°ä¹‹ä¸€ã€‚<code>hash</code> å±æ€§è¡¨ç¤ºç”¨äº PBKDF2 ç®—æ³•çš„å“ˆå¸Œå‡½æ•°ç±»å‹ï¼Œè¿™å¯¹äºç¡®å®šåŠ å¯†è¿‡ç¨‹çš„å¼ºåº¦éå¸¸å…³é”®ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-3"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å­˜å‚¨ç”¨æˆ·å¯†ç çš„ç³»ç»Ÿã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½ ä¸èƒ½ç›´æ¥å­˜å‚¨ç”¨æˆ·çš„æ˜æ–‡å¯†ç ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ PBKDF2 ç®—æ³•æ¥è½¬æ¢è¿™äº›å¯†ç ã€‚</p><ol><li><p><strong>ç”¨æˆ·æ³¨å†Œï¼š</strong> å½“ç”¨æˆ·åˆ›å»ºè´¦æˆ·å¹¶è®¾ç½®å¯†ç æ—¶ï¼Œä½ çš„ç³»ç»Ÿä¼šä½¿ç”¨ PBKDF2 ç®—æ³•å°†è¯¥å¯†ç è½¬æ¢æˆä¸€ä¸ªå¯†é’¥ï¼Œç„¶åå­˜å‚¨è¿™ä¸ªå¯†é’¥ä»£æ›¿åŸå§‹å¯†ç ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ éœ€è¦æŒ‡å®šä½¿ç”¨å“ªç§å“ˆå¸Œå‡½æ•°ï¼ˆä¾‹å¦‚ SHA-256ï¼‰ï¼Œè¿™å°±æ˜¯ <code>pbkdf2Params.hash</code> å‚æ•°çš„ä½œç”¨ã€‚</p></li><li><p><strong>ç”¨æˆ·ç™»å½•ï¼š</strong> å½“ç”¨æˆ·å°è¯•ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šå†æ¬¡ä½¿ç”¨åŒæ ·çš„ç®—æ³•ã€åŒæ ·çš„å“ˆå¸Œå‡½æ•°ã€ç›¸åŒçš„ç›å€¼å’Œè¿­ä»£æ¬¡æ•°å¤„ç†ç”¨æˆ·è¾“å…¥çš„å¯†ç ï¼Œäº§ç”Ÿä¸€ä¸ªå¯†é’¥ã€‚ç„¶åï¼Œç³»ç»Ÿä¼šæ¯”è¾ƒè¿™ä¸ªæ–°ç”Ÿæˆçš„å¯†é’¥ä¸ä¹‹å‰å­˜å‚¨çš„å¯†é’¥ã€‚å¦‚æœä¸¤è€…åŒ¹é…ï¼Œé‚£ä¹ˆéªŒè¯å°±æˆåŠŸäº†ã€‚</p></li></ol><h3 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹"><span>ä»£ç ç¤ºä¾‹</span></a></h3><p>è™½ç„¶ Node.js v21.7.1 ç›´æ¥çš„æ–‡æ¡£é“¾æ¥å¯èƒ½ä¸åŒ…æ‹¬å…·ä½“çš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® Web Crypto API çš„é€šç”¨åº”ç”¨é€»è¾‘æä¾›ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¼•å…¥ webcrypto</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> hashPassword</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> pbkdf2Params</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šå“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">    salt</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">salt</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å°†ç›è½¬ä¸º Uint8Array</span></span>
<span class="line"><span style="color:#88C0D0;">    iterations</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šè¿­ä»£æ¬¡æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveBits</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedBits</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveBits</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    pbkdf2Params</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#B48EAD;">    256</span><span style="color:#616E88;"> // æ´¾ç”Ÿå‡ºä¸€ä¸ª 256 ä½ï¼ˆ32 å­—èŠ‚ï¼‰çš„å¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">derivedBits</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾çš„ä½¿ç”¨åœºæ™¯</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">userPassword123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç”¨æˆ·å¯†ç </span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">someRandomSalt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç›å€¼</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">hashPassword</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">hashedPassword</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hashedPassword</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥ Web Crypto APIï¼Œå¹¶ä½¿ç”¨ <code>subtle</code> æ¥å£ã€‚ç„¶åå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° <code>hashPassword</code> æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ PBKDF2 ç®—æ³•å’ŒæŒ‡å®šçš„å“ˆå¸Œå‡½æ•°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º SHA-256ï¼‰æ¥å¤„ç†ä¸€ä¸ªå¯†ç ã€‚</p><p>è¿™ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨æ—¶è¿˜éœ€è¦è€ƒè™‘æ›´å¤šçš„å®‰å…¨å› ç´ ï¼Œæ¯”å¦‚å¦‚ä½•å®‰å…¨åœ°å¤„ç†ç›å€¼ä»¥åŠå¦‚ä½•å®‰å…¨åœ°å­˜å‚¨è¿™äº›æ´¾ç”Ÿå‡ºæ¥çš„å¯†é’¥ç­‰ã€‚</p><h4 id="pbkdf2params-iterations" tabindex="-1"><a class="header-anchor" href="#pbkdf2params-iterations"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#pbkdf2paramsiterations" target="_blank" rel="noopener noreferrer">pbkdf2Params.iterations</a></span></a></h4><p>å½“ä½ æ³¨å†Œä¸€ä¸ªæ–°è´¦å·æ—¶ï¼Œç½‘ç«™é€šå¸¸ä¼šè¦æ±‚ä½ åˆ›å»ºä¸€ä¸ªå¯†ç ã€‚è¿™ä¸ªå¯†ç éœ€è¦è¢«å®‰å…¨åœ°å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿åœ¨ä½ ä¸‹æ¬¡ç™»å½•æ—¶å¯ä»¥éªŒè¯ä½ è¾“å…¥çš„å¯†ç æ˜¯å¦æ­£ç¡®ã€‚ä½†æ˜¯ï¼Œä»…ä»…æŠŠå¯†ç åŸæ ·å­˜å‚¨æ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºå¦‚æœæœ‰äººä¸æ€€å¥½æ„åœ°è·å¾—äº†è¿™äº›æ•°æ®ï¼Œä»–ä»¬å°±èƒ½ç›´æ¥çŸ¥é“ä½ çš„å¯†ç ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå¼€å‘è€…ä½¿ç”¨ä¸€ç§å«åšå¯†ç å“ˆå¸Œï¼ˆpassword hashingï¼‰çš„æŠ€æœ¯æ¥åŠ å¯†å¯†ç ã€‚</p><p>Node.js ä¸­çš„ <code>pbkdf2Params.iterations</code> æ˜¯ç”¨äºå¯†ç åŠ å¯†çš„ä¸€é¡¹æŠ€æœ¯ä¸­çš„ä¸€ä¸ªå‚æ•°ï¼Œå…·ä½“å±äº PBKDF2ï¼ˆPassword-Based Key Derivation Function 2ï¼‰ç®—æ³•çš„éƒ¨åˆ†ã€‚è¯¥ç®—æ³•ä¸»è¦ç”¨äºå°†ç”¨æˆ·çš„å¯†ç è½¬æ¢æˆä¸€é•¿ä¸²å›ºå®šé•¿åº¦çš„ã€å‡ ä¹ä¸å¯èƒ½åè§£çš„å­—ç¬¦ä¸²ï¼ˆå³â€œå“ˆå¸Œâ€ï¼‰ã€‚è¿™æ ·ï¼Œå³ä½¿æ•°æ®æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿå¾ˆéš¾ä»è¿™äº›å“ˆå¸Œå€¼ä¸­æ¢å¤åŸå§‹å¯†ç ã€‚</p><h3 id="iterations-å‚æ•°çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#iterations-å‚æ•°çš„ä½œç”¨"><span>iterations å‚æ•°çš„ä½œç”¨</span></a></h3><p><code>iterations</code>ï¼Œå³â€œè¿­ä»£æ¬¡æ•°â€ï¼Œæ˜¯æŒ‡åœ¨ç”Ÿæˆæœ€ç»ˆçš„å“ˆå¸Œå€¼ä¹‹å‰ï¼Œç®—æ³•å†…éƒ¨é‡å¤è¿è¡Œçš„æ¬¡æ•°ã€‚æ¯è¿›è¡Œä¸€æ¬¡è¿­ä»£ï¼Œéƒ½ä¼šå¯¹å¯†ç è¿›è¡Œä¸€æ¬¡åŠ å¯†å¤„ç†ã€‚å¢åŠ è¿­ä»£æ¬¡æ•°ä¼šä½¿å¾—ç ´è§£å¯†ç æ‰€éœ€çš„æ—¶é—´æˆå€å¢åŠ ï¼Œå› æ­¤å¯ä»¥æ›´å¥½åœ°ä¿æŠ¤å¯†ç å®‰å…¨ã€‚ä¸è¿‡ï¼Œè¿‡é«˜çš„è¿­ä»£æ¬¡æ•°ä¹Ÿä¼šä½¿å¾—æ­£å¸¸çš„å¯†ç éªŒè¯è¿‡ç¨‹å˜æ…¢ï¼Œå› æ­¤éœ€è¦åœ¨å®‰å…¨æ€§å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>æƒ³è±¡ä¸€ä¸ªç®€å•çš„ç”¨æˆ·æ³¨å†Œå’Œç™»å½•åœºæ™¯ï¼š</p><ol><li><p><strong>ç”¨æˆ·æ³¨å†Œ</strong></p><ul><li>ç”¨æˆ·åœ¨æ³¨å†Œè¡¨å•ä¸­è¾“å…¥è‡ªå·±çš„å¯†ç ã€‚</li><li>æœåŠ¡å™¨ç«¯çš„ä»£ç ä½¿ç”¨ PBKDF2 ç®—æ³•å’Œä¸€ä¸ªéšæœºç”Ÿæˆçš„ç›ï¼ˆsaltï¼‰å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>pbkdf2Params.iterations</code> å‚æ•°è¢«è®¾ç½®æˆä¸€ä¸ªè¶³å¤Ÿé«˜çš„å€¼ï¼ˆä¾‹å¦‚ 10000 æ¬¡ï¼‰ï¼Œä»¥ç¡®ä¿å¯†ç çš„å®‰å…¨ã€‚</li><li>åŠ å¯†åçš„å“ˆå¸Œå€¼å’Œä½¿ç”¨çš„ç›ä¸€èµ·å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚</li></ul></li><li><p><strong>ç”¨æˆ·ç™»å½•</strong></p><ul><li>ç”¨æˆ·è¾“å…¥é‚®ç®±å’Œå¯†ç å°è¯•ç™»å½•ã€‚</li><li>æœåŠ¡å™¨æŸ¥æ‰¾ç”¨æˆ·çš„é‚®ç®±å¯¹åº”çš„è®°å½•ï¼Œå–å‡ºå­˜å‚¨çš„å“ˆå¸Œå€¼å’Œç›ã€‚</li><li>ä½¿ç”¨ç›¸åŒçš„ PBKDF2 ç®—æ³•ã€ç›¸åŒçš„è¿­ä»£æ¬¡æ•°å’Œç›¸åŒçš„ç›å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†ã€‚</li><li>æ¯”è¾ƒè¿™æ¬¡åŠ å¯†çš„ç»“æœå’Œæ•°æ®åº“ä¸­å­˜å‚¨çš„å“ˆå¸Œå€¼ã€‚å¦‚æœä¸¤è€…ä¸€è‡´ï¼Œåˆ™éªŒè¯æˆåŠŸï¼Œå…è®¸ç”¨æˆ·ç™»å½•ï¼›å¦åˆ™ï¼Œæ‹’ç»ç™»å½•ã€‚</li></ul></li></ol><p>é€šè¿‡è°ƒæ•´ <code>pbkdf2Params.iterations</code> çš„å€¼ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦åœ¨å®‰å…¨æ€§å’Œå“åº”é€Ÿåº¦ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚è¿™æ˜¯æ„å»ºå®‰å…¨ä¸”ç”¨æˆ·å‹å¥½çš„ Web åº”ç”¨çš„å…³é”®æ­¥éª¤ä¹‹ä¸€ã€‚</p><h4 id="pbkdf2params-name" tabindex="-1"><a class="header-anchor" href="#pbkdf2params-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#pbkdf2paramsname" target="_blank" rel="noopener noreferrer">pbkdf2Params.name</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>pbkdf2Params.name</code>æ˜¯ä¸ Web åŠ å¯† API ä¸­çš„<code>PBKDF2</code>ç®—æ³•å‚æ•°ç›¸å…³çš„ä¸€ä¸ªå±æ€§ã€‚è¦ç†è§£è¿™ä¸ªå±æ€§çš„ä½œç”¨ï¼Œé¦–å…ˆéœ€è¦äº†è§£ä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-pbkdf2" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-pbkdf2"><span>ä»€ä¹ˆæ˜¯ PBKDF2ï¼Ÿ</span></a></h3><p><code>PBKDF2</code>ï¼ˆPassword-Based Key Derivation Function 2ï¼‰æ˜¯ä¸€ç§åŸºäºå¯†ç çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°ã€‚å®ƒä¸»è¦ç”¨äºä»ä¸å¤ªéšæœºçš„è¾“å…¥ï¼ˆå¦‚ç”¨æˆ·å¯†ç ï¼‰ç”ŸæˆåŠ å¯†å¯†é’¥ã€‚<code>PBKDF2</code>é€šè¿‡å°†å¯†ç å’Œç›å€¼ï¼ˆsaltï¼‰ç»“åˆå¹¶åº”ç”¨å¤šæ¬¡å“ˆå¸Œï¼Œä½¿å¾—ç»“æœå¯†é’¥æ›´åŠ å®‰å…¨ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†æš´åŠ›ç ´è§£çš„éš¾åº¦ã€‚</p><h3 id="pbkdf2params-nameçš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#pbkdf2params-nameçš„ä½œç”¨"><span><code>pbkdf2Params.name</code>çš„ä½œç”¨</span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js è¿›è¡Œå¯†ç å­¦æ“ä½œï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦æ ¹æ®å¯†ç ç”Ÿæˆå¯†é’¥æ—¶ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ° Web åŠ å¯† APIã€‚<code>pbkdf2Params</code>å°±æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨çš„é…ç½®å¯¹è±¡ï¼Œè€Œ<code>.name</code>å±æ€§åˆ™æŒ‡å®šäº†è¦ä½¿ç”¨çš„ç®—æ³•ï¼Œå¯¹äº<code>PBKDF2</code>æ¥è¯´ï¼Œè¿™ä¸ªå±æ€§çš„å€¼å°±æ˜¯<code>&quot;PBKDF2&quot;</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-19"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨å­˜å‚¨ç”¨æˆ·å¯†ç çš„åº”ç”¨ã€‚ç”±äºç›´æ¥å­˜å‚¨ç”¨æˆ·å¯†ç éå¸¸ä¸å®‰å…¨ï¼Œå› æ­¤ä½ å†³å®šä½¿ç”¨<code>PBKDF2</code>ç®—æ³•ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œå¹¶å°†è¿™ä¸ªå¯†é’¥å­˜å‚¨èµ·æ¥ä½œä¸ºå¯†ç çš„ä»£æ›¿ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„ç®€åŒ–ä»£ç ï¼š</p><ol><li><p><strong>å¯¼å…¥æ‰€éœ€æ¨¡å—</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å®šä¹‰ PBKDF2 å‚æ•°</strong>ï¼š</p><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¥å®šä¹‰<code>PBKDF2</code>çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç®—æ³•åç§°ã€ç›å€¼ã€è¿­ä»£æ¬¡æ•°ã€ç”Ÿæˆå¯†é’¥çš„é•¿åº¦ä»¥åŠå“ˆå¸Œå‡½æ•°ç±»å‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> pbkdf2Params</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨PBKDF2ç®—æ³•</span></span>
<span class="line"><span style="color:#88C0D0;">  salt</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">someSalt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›å€¼</span></span>
<span class="line"><span style="color:#88C0D0;">  iterations</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿­ä»£æ¬¡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ä½¿ç”¨å¯†ç ç”Ÿæˆå¯†é’¥</strong>ï¼š</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç”¨æˆ·çš„å¯†ç ï¼ˆç»è¿‡é€‚å½“ç¼–ç ï¼‰å’Œä¸Šé¢å®šä¹‰çš„å‚æ•°æ¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„<code>deriveKey</code>æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥ä½ éœ€è¦ä½¿ç”¨<code>async/await</code>æˆ–è€…<code>.then/.catch</code>æ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyFromPassword</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyMaterial</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">raw</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PBKDF2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#81A1C1;">    false</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">deriveKey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">deriveKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    pbkdf2Params</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    keyMaterial</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AES-GCM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> length</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 256</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // å®šä¹‰æœ€ç»ˆå¯†é’¥çš„ç®—æ³•å’Œé•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// æœ€ç»ˆå¯†é’¥çš„ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè®¾ç½®äº†<code>PBKDF2</code>çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç®—æ³•åç§°ï¼ˆé€šè¿‡<code>pbkdf2Params.name</code>æŒ‡å®šä¸º<code>&quot;PBKDF2&quot;</code>ï¼‰ã€ç›å€¼ã€è¿­ä»£æ¬¡æ•°ç­‰ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·çš„å¯†ç å’Œè¿™äº›å‚æ•°ç”Ÿæˆäº†ä¸€ä¸ªå¯†é’¥ã€‚è¿™ä¸ªè¿‡ç¨‹å¤§å¤§æé«˜äº†å¯†ç çš„å®‰å…¨æ€§ï¼Œå³ä½¿æ•°æ®åº“è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿå¾ˆéš¾ä»å­˜å‚¨çš„å¯†é’¥ä¸­æ¢å¤åŸå¯†ç ã€‚</p><p>å¸Œæœ›è¿™ä¸ªä¾‹å­èƒ½å¸®åŠ©ä½ ç†è§£<code>pbkdf2Params.name</code>åœ¨ Node.js ä¸­çš„åº”ç”¨ä»¥åŠ<code>PBKDF2</code>ç®—æ³•çš„å®é™…ç”¨é€”ã€‚</p><h4 id="pbkdf2params-salt" tabindex="-1"><a class="header-anchor" href="#pbkdf2params-salt"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#pbkdf2paramssalt" target="_blank" rel="noopener noreferrer">pbkdf2Params.salt</a></span></a></h4><p>äº†è§£ <code>pbkdf2Params.salt</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-10" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-10"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>åŠ å¯†</strong>: åœ¨ä¿¡æ¯å®‰å…¨é¢†åŸŸï¼ŒåŠ å¯†æ˜¯å°†åŸå§‹æ•°æ®ï¼ˆæ˜æ–‡ï¼‰è½¬æ¢æˆä¸æ˜“è¯»æ ¼å¼ï¼ˆå¯†æ–‡ï¼‰çš„è¿‡ç¨‹ï¼Œä»¥ä¿æŠ¤æ•°æ®çš„éšç§æ€§ã€‚</li><li><strong>å“ˆå¸Œå‡½æ•°(Hash Function)</strong>: ä¸€ç§ä»ä»»ä½•ä¸€ç§æ•°æ®ä¸­åˆ›å»ºå°çš„æ•°å­—â€œæŒ‡çº¹â€çš„æ–¹æ³•ã€‚æ— è®ºè¾“å…¥æ•°æ®çš„å¤§å°ï¼Œè¾“å‡ºçš„å“ˆå¸Œå€¼é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ã€‚</li><li><strong>ç›(Salt)</strong>: åœ¨å¯†ç å­¦ä¸­ï¼Œç›æ˜¯éšæœºæ•°æ®ï¼Œå½“ä¸å¯†ç ç»“åˆä½¿ç”¨æ—¶ï¼Œå®ƒä¼šæé«˜å­˜å‚¨å¯†ç çš„å®‰å…¨æ€§ã€‚</li></ol><h3 id="pbkdf2-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#pbkdf2-ç®€ä»‹"><span>PBKDF2 ç®€ä»‹</span></a></h3><p>PBKDF2ï¼ˆPassword-Based Key Derivation Function 2ï¼‰æ˜¯ä¸€ä¸ªåŸºäºå¯†ç çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼Œå¹¿æ³›ç”¨äºç”ŸæˆåŠ å¯†å¯†é’¥ã€‚å®ƒå°†å¯†ç ï¼Œç›å€¼(salt)ï¼Œè¿­ä»£æ¬¡æ•°(iterations)å’ŒæœŸæœ›çš„å¯†é’¥é•¿åº¦ä½œä¸ºè¾“å…¥ï¼Œäº§ç”Ÿä¸€ä¸ªå›ºå®šé•¿åº¦çš„å®‰å…¨å¯†é’¥ã€‚</p><h3 id="pbkdf2params-salt-1" tabindex="-1"><a class="header-anchor" href="#pbkdf2params-salt-1"><span>pbkdf2Params.salt</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>pbkdf2Params.salt</code> æ˜¯<code>SubtleCrypto.deriveBits()</code>æˆ–<code>SubtleCrypto.deriveKey()</code>æ–¹æ³•ä¸­ç”¨äº PBKDF2 æ“ä½œçš„å‚æ•°ä¹‹ä¸€ã€‚è¿™é‡Œçš„â€œç›â€æ˜¯ç”¨æ¥æå‡å¯†ç å¤„ç†è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§çš„ã€‚å®ƒæ˜¯ä¸€ä¸ªå¿…éœ€çš„å‚æ•°ï¼Œç”¨äºé˜²æ­¢å­—å…¸æ”»å‡»å’Œå½©è™¹è¡¨æ”»å‡»ï¼Œå¢å¼ºå¯†ç çš„ç‹¬ç‰¹æ€§ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-21" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-21"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æ‚¨æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç ã€‚ä¸ºäº†è¿™ä¸ªç›®çš„ï¼Œæ‚¨å†³å®šä½¿ç”¨ PBKDF2 ç®—æ³•ç”Ÿæˆå¯†ç çš„åŠ å¯†ç‰ˆæœ¬ã€‚</p><h4 id="æ­¥éª¤-1-å¼•å…¥å¿…è¦çš„åº“" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-å¼•å…¥å¿…è¦çš„åº“"><span>æ­¥éª¤ 1: å¼•å…¥å¿…è¦çš„åº“</span></a></h4><p>é¦–å…ˆï¼Œæ‚¨éœ€è¦å¼•å…¥ Node.js çš„<code>crypto</code>æ¨¡å—ï¼Œå®ƒåŒ…æ‹¬æ”¯æŒ PBKDF2 ç®—æ³•çš„åŠŸèƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-è®¾å®š-pbkdf2-å‚æ•°" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-è®¾å®š-pbkdf2-å‚æ•°"><span>æ­¥éª¤ 2: è®¾å®š PBKDF2 å‚æ•°</span></a></h4><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ PBKDF2 ç®—æ³•çš„å‚æ•°ï¼ŒåŒ…æ‹¬å¯†ç ã€ç›å€¼ã€è¿­ä»£æ¬¡æ•°ã€ç”Ÿæˆå¯†é’¥çš„é•¿åº¦å’Œå“ˆå¸Œå‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">userPassword</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç”¨æˆ·çš„å¯†ç </span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // ç”Ÿæˆéšæœºç›å€¼</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iterations</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 1000</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // è¿­ä»£æ¬¡æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keyLength</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 64</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> digest</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å“ˆå¸Œå‡½æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-3-ä½¿ç”¨-pbkdf2-ç”Ÿæˆå¯†é’¥" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-3-ä½¿ç”¨-pbkdf2-ç”Ÿæˆå¯†é’¥"><span>æ­¥éª¤ 3: ä½¿ç”¨ PBKDF2 ç”Ÿæˆå¯†é’¥</span></a></h4><p>ç„¶åï¼Œä½¿ç”¨ä¸Šè¿°å‚æ•°é€šè¿‡ PBKDF2 ç®—æ³•ç”Ÿæˆå¯†é’¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pbkdf2</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">  password</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  salt</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  iterations</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  keyLength</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  digest</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // æ‰“å°ç”Ÿæˆçš„å¯†é’¥</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ PBKDF2 ç®—æ³•å’Œç›å€¼æ¥å¢å¼ºå¯†ç å­˜å‚¨çš„å®‰å…¨æ€§ã€‚é€šè¿‡åœ¨ç”¨æˆ·å¯†ç ä¸Šåº”ç”¨è¶³å¤Ÿçš„å¤æ‚åº¦ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡å¢åŠ è¿­ä»£æ¬¡æ•°ï¼‰ï¼Œå³ä½¿æ”»å‡»è€…è·å¾—äº†æ•°æ®ï¼Œæ²¡æœ‰å¯¹åº”çš„ç›å€¼å’Œç›¸åŒçš„å‚æ•°è®¾ç½®ï¼Œä»–ä»¬ä¹Ÿå¾ˆéš¾æ¢å¤åŸå§‹å¯†ç ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>pbkdf2Params.salt</code> åœ¨ Node.js ä¸­æ˜¯ç”¨æ¥ç¡®ä¿åœ¨è¿›è¡Œå¯†ç åŸºç¡€çš„å¯†é’¥æ´¾ç”Ÿæ—¶ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°é˜²èŒƒå„ç§æ”»å‡»ï¼Œæé«˜æ•´ä½“çš„å®‰å…¨æ€§ã€‚</p><h3 id="class-rsahashedimportparams" tabindex="-1"><a class="header-anchor" href="#class-rsahashedimportparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-rsahashedimportparams" target="_blank" rel="noopener noreferrer">Class: RsaHashedImportParams</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„<code>RsaHashedImportParams</code>æ˜¯å…³äº Web åŠ å¯† API çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªç±»æ˜¯ç”¨æ¥æŒ‡å®šåœ¨å¯¼å…¥ RSA å“ˆå¸Œå¯†é’¥æ—¶æ‰€ä½¿ç”¨çš„å‚æ•°ã€‚è¦ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æœ¯è¯­ï¼š</p><ol><li><p><strong>RSA</strong>ï¼šè¿™æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚éå¯¹ç§°æ„å‘³ç€å®ƒä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼Œä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚å…¬é’¥å¯ä»¥å®‰å…¨åœ°åˆ†äº«ç»™ä»»ä½•äººï¼Œç”¨äºæ•°æ®çš„åŠ å¯†æˆ–éªŒè¯ç­¾åï¼›è€Œç§é’¥å¿…é¡»ä¿å¯†ï¼Œç”¨äºæ•°æ®çš„è§£å¯†æˆ–åˆ›å»ºç­¾åã€‚</p></li><li><p><strong>å“ˆå¸Œï¼ˆHashï¼‰</strong>ï¼šå“ˆå¸Œæ˜¯å°†è¾“å…¥ï¼ˆæˆ–æ¶ˆæ¯ï¼‰è½¬æ¢æˆå›ºå®šå¤§å°çš„å­—ç¬¦ä¸²ï¼ˆé€šå¸¸æ˜¯æ•°å­—æ‘˜è¦ï¼‰ã€‚å“ˆå¸Œå‡½æ•°è®¾è®¡ä¸ºå•å‘å‡½æ•°ï¼Œè¿™æ„å‘³ç€ä»å“ˆå¸Œå€¼åæ¨åŸå§‹æ•°æ®æ˜¯ä¸å¯è¡Œçš„ã€‚</p></li><li><p><strong>Web åŠ å¯† APIï¼ˆWeb Cryptography APIï¼‰</strong>ï¼šè¿™æ˜¯ Web å¹³å°æä¾›çš„ä¸€å¥—åŠ å¯†åŠŸèƒ½ï¼Œå…è®¸å¼€å‘è€…åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®çš„åŠ å¯†ã€è§£å¯†ã€ç­¾åç­‰æ“ä½œã€‚</p></li></ol><p>é‚£ä¹ˆï¼Œåœ¨ Node.js ä¸­ï¼Œ<code>RsaHashedImportParams</code>ç”¨äºå½“ä½ æƒ³é€šè¿‡ Web åŠ å¯† API å¯¼å…¥ä¸€ä¸ª RSA å¯†é’¥æ—¶ï¼ŒæŒ‡å®šä¸€äº›å¿…è¦çš„å‚æ•°ï¼Œç‰¹åˆ«æ˜¯ä¸å“ˆå¸Œç›¸å…³çš„é€‰é¡¹ã€‚å…¶å±æ€§åŒ…æ‹¬ï¼š</p><ul><li><strong><code>name</code></strong>ï¼šåŠ å¯†æ“ä½œçš„åç§°ï¼Œå¯¹äº RSAï¼Œé€šå¸¸æ˜¯<code>RSASSA-PKCS1-v1_5</code>æˆ–<code>RSA-PSS</code>ç­‰ã€‚</li><li><strong><code>hash</code></strong>ï¼šå®šä¹‰ä½¿ç”¨å“ªç§å“ˆå¸Œå‡½æ•°è¿›è¡Œæ“ä½œï¼Œå¦‚<code>SHA-256</code>ã€<code>SHA-384</code>ç­‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-22" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-22"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„ Web åº”ç”¨ç¨‹åºã€‚å®¢æˆ·ç«¯éœ€è¦éªŒè¯ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><ol><li><p><strong>ç”Ÿæˆå¯†é’¥å¯¹å¹¶å¯¼å‡ºå…¬é’¥</strong>ï¼š<br> æœåŠ¡ç«¯ä½¿ç”¨ RSA ç®—æ³•ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼Œå¹¶å°†å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç§é’¥ä¿ç•™åœ¨æœåŠ¡ç«¯ï¼Œä¸è¢«å¤–ç•ŒçŸ¥æ™“ã€‚</p></li><li><p><strong>æœåŠ¡å™¨ç«¯æ•°æ®ç­¾å</strong>ï¼š<br> æœåŠ¡ç«¯æœ‰ä¸€æ¡æ¶ˆæ¯éœ€è¦å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ä¸ºäº†ç¡®ä¿æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ï¼ŒæœåŠ¡ç«¯å°†ä½¿ç”¨ç§é’¥å¯¹è¯¥æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªæ•°å­—ç­¾åã€‚</p></li><li><p><strong>å®¢æˆ·ç«¯éªŒè¯ç­¾å</strong>ï¼š<br> å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯å’Œç­¾ååï¼Œä¼šä½¿ç”¨ä»æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„å…¬é’¥å’Œç›¸åŒçš„å“ˆå¸Œç®—æ³•æ¥éªŒè¯ç­¾åã€‚æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦ç”¨åˆ°<code>RsaHashedImportParams</code>æ¥æŒ‡å®šå…¬é’¥çš„å¯¼å…¥å‚æ•°ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„å“ˆå¸Œæ–¹æ³•ï¼Œå¦‚ SHA-256 ç­‰ã€‚</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> importPublicKey</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">pem</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> hashType</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // è§£æPEMæ ¼å¼çš„å…¬é’¥ï¼Œå»é™¤é¦–å°¾è¡Œå’Œæ¢è¡Œç¬¦ï¼Œç„¶åè½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> pemHeader</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">-----BEGIN PUBLIC KEY-----</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> pemFooter</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">-----END PUBLIC KEY-----</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> pemContents</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> pem</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">substring</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">pemHeader</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> pem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9;"> pemFooter</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length)</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">replace</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">/</span><span style="color:#81A1C1;">g</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> binaryDer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">pemContents</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨RsaHashedImportParamsæŒ‡å®šå¯¼å…¥å‚æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> importParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSASSA-PKCS1-v1_5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> hashType</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // &quot;SHA-256&quot;, &quot;SHA-384&quot; ç­‰</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // å¯¼å…¥å¯†é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">spki</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æŒ‡å®šå¯†é’¥æ ¼å¼</span></span>
<span class="line"><span style="color:#D8DEE9;">    binaryDer</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    importParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å…è®¸çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•å¯¼å…¥ä¸€ä¸ªå…¬é’¥ï¼Œå¹¶æŒ‡å®šä½¿ç”¨çš„å“ˆå¸Œç±»å‹ã€‚è¿™åœ¨å®ç°ä¸€ä¸ªå®‰å…¨éªŒè¯æœºåˆ¶æ—¶éå¸¸é‡è¦ï¼Œå¦‚æ•°å­—ç­¾åçš„éªŒè¯ï¼Œç¡®ä¿æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯ç”±å¯ä¿¡æ¥æºå‘é€ä¸”æœªè¢«ç¯¡æ”¹ã€‚</p><h4 id="rsahashedimportparams-hash" tabindex="-1"><a class="header-anchor" href="#rsahashedimportparams-hash"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsahashedimportparamshash" target="_blank" rel="noopener noreferrer">rsaHashedImportParams.hash</a></span></a></h4><p>Node.js v21.7.1 ä¸­çš„<code>rsaHashedImportParams.hash</code>æ˜¯ç”¨äº Web åŠ å¯† API ä¸­çš„ä¸€ä¸ªå‚æ•°è®¾ç½®ï¼Œå…·ä½“ç”¨é€”åœ¨äºå®šä¹‰å¯¼å…¥ RSA å“ˆå¸Œç®—æ³•å¯†é’¥æ—¶æ‰€ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ã€‚è¿™ä¸ªæ¦‚å¿µå¬èµ·æ¥å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥è§£æï¼Œå¹¶é€šè¿‡ä¾‹å­åŠ ä»¥ç†è§£ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-11" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-11"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µä¼šæœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°ç†è§£<code>rsaHashedImportParams.hash</code>ï¼š</p><ul><li><p><strong>RSA åŠ å¯†ç®—æ³•</strong>ï¼šè¿™æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¹¿æ³›ç”¨äºæ•°æ®åŠ å¯†å’Œæ•°å­—ç­¾åã€‚éå¯¹ç§°æ„å‘³ç€å®ƒä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼Œå³å…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œç§é’¥ç”¨äºè§£å¯†ã€‚</p></li><li><p><strong>å“ˆå¸Œå‡½æ•°</strong>ï¼šå“ˆå¸Œå‡½æ•°å¯ä»¥å°†è¾“å…¥ï¼ˆæˆ– &#39;æ¶ˆæ¯&#39;ï¼‰è½¬æ¢æˆå›ºå®šå¤§å°çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²é€šå¸¸çœ‹èµ·æ¥å°±åƒä¸€ä¸²éšæœºå­—ç¬¦ã€‚é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯ï¼Œå³ä¾¿åªæ”¹å˜è¾“å…¥ä¸­çš„ä¸€ä¸ªå°éƒ¨åˆ†ï¼Œè¾“å‡ºçš„å“ˆå¸Œå€¼ä¹Ÿä¼šå®Œå…¨ä¸åŒã€‚</p></li><li><p><strong>Web åŠ å¯† API</strong>ï¼šè¿™æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ä¸ª APIï¼Œå…è®¸å¼€å‘è€…åœ¨å®¢æˆ·ç«¯è¿›è¡Œå®‰å…¨çš„åŠ å¯†æ“ä½œï¼ŒåŒ…æ‹¬ç”Ÿæˆå¯†é’¥ã€åŠ å¯†ä¸è§£å¯†ä¿¡æ¯ç­‰ã€‚</p></li></ul><h3 id="rsahashedimportparams-hash-1" tabindex="-1"><a class="header-anchor" href="#rsahashedimportparams-hash-1"><span><code>rsaHashedImportParams.hash</code></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®ºåˆ°<code>rsaHashedImportParams.hash</code>ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯åœ¨è®¨è®ºåœ¨ Web åŠ å¯† API ä¸­å¯¼å…¥ RSA å¯†é’¥æ—¶å¦‚ä½•æŒ‡å®šå“ˆå¸Œç®—æ³•ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¼å…¥å¯†é’¥ä»¥éªŒè¯ç­¾åæˆ–è§£å¯†ä¸€äº›æ•°æ®ã€‚è¿™ä¸ªå‚æ•°å‘Šè¯‰ Web åŠ å¯† API åœ¨å¤„ç† RSA å¯†é’¥æ—¶åº”è¯¥ä½¿ç”¨å“ªç§å“ˆå¸Œç®—æ³•ã€‚</p><p>å“ˆå¸Œç®—æ³•çš„é€‰æ‹©å¾ˆé‡è¦ï¼Œå› ä¸ºä¸åŒçš„å“ˆå¸Œç®—æ³•æœ‰ç€ä¸åŒçš„ç‰¹æ€§ï¼Œæ¯”å¦‚å®‰å…¨æ€§å’Œè®¡ç®—é€Ÿåº¦ã€‚å¸¸è§çš„å“ˆå¸Œç®—æ³•åŒ…æ‹¬ï¼šSHA-256ã€SHA-384 å’Œ SHA-512 ç­‰ã€‚</p><h3 id="å®é™…ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-4"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web åº”ç”¨ï¼Œéœ€è¦éªŒè¯ä»æœåŠ¡å™¨æ”¶åˆ°çš„æ¶ˆæ¯ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚è¿™ä¸ªè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li>æœåŠ¡å™¨ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯åˆ›å»ºæ•°å­—ç­¾åã€‚</li><li>æ¶ˆæ¯å’Œå®ƒçš„ç­¾åè¢«å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥å’Œç›¸åº”çš„å“ˆå¸Œç®—æ³•éªŒè¯ç­¾åã€‚</li></ol><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç å¯èƒ½éœ€è¦å¯¼å…¥æœåŠ¡å™¨çš„å…¬é’¥ï¼Œå¹¶æŒ‡å®šç”¨äºéªŒè¯ç­¾åçš„å“ˆå¸Œç®—æ³•ã€‚è¿™æ—¶ï¼Œ<code>rsaHashedImportParams.hash</code>å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥æ ¼å¼ï¼Œè¿™é‡Œå‡è®¾æ˜¯JWKï¼ˆJSON Web Keyï¼‰</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#616E88;">    // è¿™é‡Œæ˜¯å…¬é’¥è¯¦ç»†ä¿¡æ¯ï¼Œå‡è®¾å·²ç»å¾—åˆ°</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„RSAç®—æ³•å˜ä½“</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // æŒ‡å®šå“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡ºå¯†é’¥</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å…¬é’¥ç”¨é€”ï¼Œè¿™é‡Œæ˜¯ç”¨äºéªŒè¯ç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>hash: {name: &quot;SHA-256&quot;}</code>å³æ˜¯æˆ‘ä»¬è®¨è®ºçš„<code>rsaHashedImportParams.hash</code>å‚æ•°ã€‚å®ƒå‘Šè¯‰ Web åŠ å¯† API ä½¿ç”¨ SHA-256 ä½œä¸ºå“ˆå¸Œç®—æ³•æ¥å¤„ç† RSA å…¬é’¥ã€‚</p><h3 id="æ€»ç»“-11" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-11"><span>æ€»ç»“</span></a></h3><p>æ€»çš„æ¥è¯´ï¼Œ<code>rsaHashedImportParams.hash</code>æ˜¯ä¸€ä¸ªåœ¨ä½¿ç”¨ Web åŠ å¯† API å¯¼å…¥ RSA å¯†é’¥æ—¶ï¼Œç”¨æ¥æŒ‡å®šå“ˆå¸Œç®—æ³•çš„å‚æ•°ã€‚é€šè¿‡é€‰æ‹©åˆé€‚çš„å“ˆå¸Œç®—æ³•ï¼Œä½ å¯ä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œåº”ç”¨çš„æ€§èƒ½ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œä¾‹å­èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><h4 id="rsahashedimportparams-name" tabindex="-1"><a class="header-anchor" href="#rsahashedimportparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsahashedimportparamsname" target="_blank" rel="noopener noreferrer">rsaHashedImportParams.name</a></span></a></h4><p>åœ¨è§£é‡Š <code>rsaHashedImportParams.name</code> å±æ€§ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹å®ƒæ‰€å±çš„èŒƒå›´ã€‚è¿™ä¸ªå±æ€§æ˜¯ Node.js ä¸­ Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç† RSA å¯†é’¥å¯¼å…¥æ“ä½œæ—¶ä½¿ç”¨çš„å‚æ•°å¯¹è±¡ä¸­ã€‚</p><h3 id="web-crypto-api-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#web-crypto-api-ç®€ä»‹"><span>Web Crypto API ç®€ä»‹</span></a></h3><p>Web Crypto API æ˜¯ä¸€ä¸ªå…è®¸å¼€å‘è€…æ‰§è¡Œå„ç§åŠ å¯†æ“ä½œï¼ˆæ¯”å¦‚ç­¾åç”Ÿæˆ/éªŒè¯ã€åŠ å¯†/è§£å¯†ç­‰ï¼‰çš„æ ‡å‡† APIï¼Œå®ƒåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ™®éå¯ç”¨ï¼Œå¹¶ä¸” Node.js ä¹Ÿæä¾›äº†ä¸€ä¸ªç±»ä¼¼çš„å®ç°ã€‚è¿™ä½¿å¾—å¤„ç†å®‰å…¨æ€§éœ€æ±‚å˜å¾—æ›´åŠ æ–¹ä¾¿ï¼Œæ— è®ºæ˜¯åœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯ã€‚</p><h3 id="rsa-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#rsa-ç®€ä»‹"><span>RSA ç®€ä»‹</span></a></h3><p>RSA æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå®ƒä¾èµ–äºä¸€å¯¹å¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥å¯ä»¥å…¬å¼€åˆ†äº«ï¼Œç”¨äºåŠ å¯†æ•°æ®æˆ–éªŒè¯ç­¾åï¼›ç§é’¥éœ€è¦ä¿å¯†ï¼Œç”¨äºè§£å¯†æˆ–ç­¾ç½²æ•°æ®ã€‚</p><h3 id="rsahashedimportparams-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#rsahashedimportparams-å¯¹è±¡"><span>rsaHashedImportParams å¯¹è±¡</span></a></h3><p>å½“ä½ æƒ³è¦é€šè¿‡ Web Crypto API åœ¨ Node.js ä¸­å¯¼å…¥ä¸€ä¸ª RSA å¯†é’¥æ—¶ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªå‚æ•°å¯¹è±¡ï¼Œè¿™å°±æ˜¯ <code>rsaHashedImportParams</code>ã€‚è¿™ä¸ªå¯¹è±¡å‘Šè¯‰ Node.js å…³äºå¯†é’¥çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¿¡æ¯å°±æ˜¯å“ˆå¸Œå‡½æ•°çš„åç§°ï¼Œè¿™å°±æ˜¯ <code>name</code> å±æ€§çš„ä½œç”¨ã€‚</p><h3 id="rsahashedimportparams-name-1" tabindex="-1"><a class="header-anchor" href="#rsahashedimportparams-name-1"><span><a href="http://rsaHashedImportParams.name" target="_blank" rel="noopener noreferrer">rsaHashedImportParams.name</a></span></a></h3><ul><li><p><strong>å«ä¹‰</strong>: <code>rsaHashedImportParams.name</code> æŒ‡å®šäº†åœ¨ä½¿ç”¨ RSA å¯†é’¥è¿›è¡Œç­¾åæˆ–éªŒè¯æ“ä½œæ—¶åº”ç”¨çš„å“ˆå¸Œå‡½æ•°çš„åç§°ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼šå“ˆå¸Œå‡½æ•°åœ¨æ•°å­—ç­¾åå’ŒæŸäº›åŠ å¯†æ“ä½œä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå› ä¸ºå®ƒä»¬èƒ½å¤Ÿå°†ä»»æ„é•¿åº¦çš„æ•°æ®â€œæ‘˜è¦â€æˆå›ºå®šé•¿åº¦çš„å€¼ã€‚é€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°æ˜¯ç¡®ä¿æ“ä½œå®‰å…¨æ€§çš„å…³é”®ä¸€æ­¥ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-23" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-23"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦éªŒè¯ç”¨æˆ·ç­¾åçš„åº”ç”¨ç¨‹åºï¼š</p><ol><li><p><strong>å¯†é’¥å¯¼å…¥</strong>ï¼šç”¨æˆ·æä¾›ä»–ä»¬çš„å…¬é’¥ï¼Œä½ éœ€è¦å°†è¿™ä¸ªå…¬é’¥å¯¼å…¥åˆ°ä½ çš„ç³»ç»Ÿä¸­ä»¥ä¾¿ä¹‹åéªŒè¯ç­¾åã€‚æ­¤æ—¶ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>rsaHashedImportParams</code> å‚æ•°å¯¹è±¡ï¼Œå¹¶æŒ‡å®šä¸€ä¸ª <code>name</code> å±æ€§æ¥å†³å®šä½¿ç”¨å“ªä¸ªå“ˆå¸Œå‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ä»ç”¨æˆ·é‚£é‡Œè·å–çš„åŸå§‹å…¬é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> rawPublicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> ...;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> importParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#616E88;"> // è¿™é‡ŒæŒ‡å®šäº†å“ˆå¸Œå‡½æ•°ä¸º SHA-256</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å¯¼å…¥å…¬é’¥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">importKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">spki</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  rawPublicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  importParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// ç”¨é€”æ˜¯éªŒè¯ç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>éªŒè¯ç­¾å</strong>ï¼šä¹‹åï¼Œå½“éœ€è¦éªŒè¯ç”¨æˆ·ç­¾åæ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¼å…¥çš„å…¬é’¥æ¥è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><p>è¿™åªæ˜¯ <code>rsaHashedImportParams.name</code> çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚ï¼Œå®ƒåœ¨åŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­¾åç­‰æ“ä½œä¸­éƒ½å¯èƒ½ä¼šè¢«ç”¨åˆ°ã€‚</p></li></ol><h3 id="ç»“è¯­" tabindex="-1"><a class="header-anchor" href="#ç»“è¯­"><span>ç»“è¯­</span></a></h3><p>é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œä½ åº”è¯¥å¯¹ <code>rsaHashedImportParams.name</code> æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚è®°ä½ï¼Œé€‰æ‹©æ­£ç¡®çš„å“ˆå¸Œå‡½æ•°å¯¹äºç¡®ä¿æ“ä½œçš„å®‰å…¨æ€§è‡³å…³é‡è¦ï¼Œè€Œè¿™ä¸ªå±æ€§æ­£æ˜¯ç”¨æ¥æŒ‡å®šè¿™ä¸€ç‚¹çš„ã€‚</p><h3 id="class-rsahashedkeygenparams" tabindex="-1"><a class="header-anchor" href="#class-rsahashedkeygenparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-rsahashedkeygenparams" target="_blank" rel="noopener noreferrer">Class: RsaHashedKeyGenParams</a></span></a></h3><p>ç†è§£ <code>RsaHashedKeyGenParams</code> ç±»åŠå…¶åœ¨ Node.js ä¸­çš„ç”¨é€”ï¼Œé¦–å…ˆéœ€è¦äº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚<code>RsaHashedKeyGenParams</code> æ˜¯ Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæŒ‡å®šç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶æ‰€ä½¿ç”¨çš„å‚æ•°ã€‚RSA æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå®ƒå¯ä»¥ç”¨äºåŠ å¯†å’Œæ•°å­—ç­¾åã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-8" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-8"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ul><li><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼šè¿™æ˜¯ä¸€ç§åŠ å¯†æ–¹æ³•ï¼Œå®ƒä½¿ç”¨ä¸€å¯¹å¯†é’¥â€”â€”å…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥å¯å…¬å¼€åˆ†äº«ï¼Œç”¨äºåŠ å¯†ä¿¡æ¯ï¼›ç§é’¥ä¿æŒç§˜å¯†ï¼Œç”¨äºè§£å¯†ã€‚</li><li><strong>RSA</strong>ï¼šä¸€ç§éå¸¸æµè¡Œçš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¹¿æ³›ç”¨äºæ•°æ®ä¼ è¾“çš„å®‰å…¨åŠ å¯†ã€‚</li><li><strong>Web Crypto API</strong>ï¼šä¸€ä¸ªæä¾›åŠ å¯†åŠŸèƒ½ï¼ˆåŒ…æ‹¬å¯†é’¥ç”Ÿæˆã€åŠ å¯†ã€è§£å¯†ç­‰ï¼‰çš„æµè§ˆå™¨ APIã€‚Node.js é€šè¿‡ <code>crypto</code> æ¨¡å—ä½¿å…¶éƒ¨åˆ†åŠŸèƒ½å¯ç”¨äºæœåŠ¡å™¨ç«¯ã€‚</li></ul><h3 id="rsahashedkeygenparams" tabindex="-1"><a class="header-anchor" href="#rsahashedkeygenparams"><span>RsaHashedKeyGenParams</span></a></h3><p>å½“ä½ æƒ³è¦åœ¨ Node.js ä¸­ä½¿ç”¨ RSA ç®—æ³•ç”Ÿæˆä¸€å¯¹å¯†é’¥æ—¶ï¼Œä½ ä¼šç”¨åˆ° <code>RsaHashedKeyGenParams</code> æ¥æŒ‡å®šç”Ÿæˆè¿™å¯¹å¯†é’¥çš„å…·ä½“å‚æ•°ã€‚è¿™ä¸ªç±»æ¥å—å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š</p><ul><li><code>name</code>: åŠ å¯†ç®—æ³•çš„åç§°ï¼Œå¯¹äº RSA æ¥è¯´ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ <code>&quot;RSA-PSS&quot;</code>ã€<code>&quot;RSASSA-PKCS1-v1_5&quot;</code> æˆ–è€… <code>&quot;RSA-OAEP&quot;</code>ã€‚</li><li><code>modulusLength</code>: æ¨¡é•¿ï¼Œè¡¨ç¤ºå¯†é’¥çš„ä½æ•°ï¼Œé€šå¸¸æ˜¯ 2048 æˆ–è€…æ›´é«˜ï¼Œä»¥ç¡®ä¿å®‰å…¨æ€§ã€‚</li><li><code>publicExponent</code>: å…¬é’¥æŒ‡æ•°ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå°æ•°å¦‚ 65537ï¼ˆç”¨ ArrayBuffer è¡¨ç¤ºï¼‰ã€‚</li><li><code>hash</code>: ç”¨äºæŒ‡å®šæ•£åˆ—å‡½æ•°çš„åç§°ï¼Œå¦‚ <code>&quot;SHA-256&quot;</code>ã€‚</li></ul><h3 id="å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨"><span>å®é™…åº”ç”¨</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†ç”¨æˆ·ä¿¡æ¯çš„åº”ç”¨ç¨‹åºï¼Œæˆ–è€…ä½ éœ€è¦ä¸ºå‘é€ç»™å¦ä¸€ä¸ªç³»ç»Ÿçš„æ•°æ®ç­¾åï¼Œä½ å°±å¯èƒ½ä¼šç”¨åˆ° RSA å¯†é’¥å¯¹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Node.js ç”Ÿæˆ RSA å¯†é’¥å¯¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span></span>
<span class="line"><span style="color:#88C0D0;">        name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">        modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯ä»¥æ˜¯ 1024ã€2048 æˆ– 4096 ç­‰</span></span>
<span class="line"><span style="color:#88C0D0;">        publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // é€šå¸¸æ˜¯ 0x10001</span></span>
<span class="line"><span style="color:#88C0D0;">        hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#81A1C1;">      true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// ä½¿ç”¨å¯†é’¥çš„ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // è¿™é‡Œçš„ keyPair å¯¹è±¡åŒ…å« publicKey å’Œ privateKeyï¼Œå¯ä»¥ç”¨äºè¿›ä¸€æ­¥çš„æ“ä½œï¼Œæ¯”å¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­¾åã€‚</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>subtle.generateKey</code> æ–¹æ³•ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œå…¶ä¸­ä½¿ç”¨äº† <code>RsaHashedKeyGenParams</code> æ¥æŒ‡å®šå¯†é’¥ç”Ÿæˆçš„å…·ä½“å‚æ•°ï¼Œä¾‹å¦‚æ¨¡é•¿ï¼ˆ<code>modulusLength</code>ï¼‰ã€å…¬é’¥æŒ‡æ•°ï¼ˆ<code>publicExponent</code>ï¼‰å’Œæ•£åˆ—å‡½æ•°ï¼ˆ<code>hash</code>ï¼‰ã€‚ç”Ÿæˆçš„å¯†é’¥ï¼ˆ<code>keyPair</code>ï¼‰åŒ…å«å…¬é’¥å’Œç§é’¥ï¼Œå¯ä»¥ç”¨äºåŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­¾åç­‰æ“ä½œã€‚</p><h3 id="æ€»ç»“-12" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-12"><span>æ€»ç»“</span></a></h3><p><code>RsaHashedKeyGenParams</code> åœ¨ Node.js ä¸­æ˜¯ç”¨æ¥æŒ‡å®šç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶æ‰€éœ€çš„ä¸€ç»„å‚æ•°ã€‚å®ƒä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåœ¨è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€ç­¾åç­‰æ“ä½œæ—¶ï¼Œæ ¹æ®å…·ä½“éœ€è¦é€‰æ‹©åˆé€‚çš„å¯†é’¥é•¿åº¦ã€æ•£åˆ—å‡½æ•°ç­‰é…ç½®ã€‚</p><h4 id="rsahashedkeygenparams-hash" tabindex="-1"><a class="header-anchor" href="#rsahashedkeygenparams-hash"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsahashedkeygenparamshash" target="_blank" rel="noopener noreferrer">rsaHashedKeyGenParams.hash</a></span></a></h4><p>ç†è§£<code>rsaHashedKeyGenParams.hash</code>çš„æ¦‚å¿µï¼Œé¦–å…ˆéœ€è¦çŸ¥é“å‡ ä¸ªå…³é”®è¯ï¼šNode.jsã€RSA ç®—æ³•ã€æ•£åˆ—ï¼ˆå“ˆå¸Œï¼‰å‡½æ•°ã€‚</p><ol><li><strong>Node.js</strong> æ˜¯ä¸€ä¸ªå¼€æºä¸”è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>RSA ç®—æ³•</strong> æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¹¿æ³›ç”¨äºæ•°æ®ä¼ è¾“åŠ å¯†ã€‚éå¯¹ç§°åŠ å¯†æ„å‘³ç€å®ƒä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥å¯å…¬å¼€åˆ†äº«ï¼Œç”¨äºåŠ å¯†ä¿¡æ¯ï¼Œè€Œç§é’¥ä¿ç•™ç»™ä¿¡æ¯æ¥æ”¶æ–¹ï¼Œç”¨äºè§£å¯†ã€‚</li><li><strong>æ•£åˆ—ï¼ˆå“ˆå¸Œï¼‰å‡½æ•°</strong> æ˜¯ä¸€ç§å°†è¾“å…¥ï¼ˆæˆ–è€…â€œæ¶ˆæ¯â€ï¼‰è½¬æ¢æˆå›ºå®šå¤§å°çš„å­—ç¬¦ä¸²ï¼ˆé€šå¸¸æ˜¯åå…­è¿›åˆ¶æ•°ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å•å‘çš„ï¼Œå³ä»æ•£åˆ—å€¼ä¸èƒ½åå‘æ¨å¯¼å‡ºåŸå§‹è¾“å…¥ã€‚</li></ol><p>åœ¨ Node.js ä¸­ï¼Œ<code>rsaHashedKeyGenParams.hash</code>æ˜¯æŒ‡åœ¨ç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°çš„æŒ‡å®šã€‚è¿™åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡Œ RSA å¯†é’¥ç”Ÿæˆæ—¶éå¸¸é‡è¦ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“ä½ æƒ³ç”Ÿæˆä¸€å¯¹ RSA å¯†é’¥ï¼ˆç”¨äºåŠ å¯†é€šä¿¡ï¼‰æ—¶ï¼Œä½ éœ€è¦å†³å®šä¸€ä¸ªå“ˆå¸Œå‡½æ•°æ¥è¾…åŠ©ä¿æŠ¤ä½ çš„å¯†é’¥å®‰å…¨ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-4"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†ç”¨æˆ·æ¶ˆæ¯çš„ç½‘ç»œåº”ç”¨ã€‚ä¸ºäº†å®‰å…¨åœ°åŠ å¯†å’Œè§£å¯†è¿™äº›æ¶ˆæ¯ï¼Œä½ å†³å®šä½¿ç”¨ RSA åŠ å¯†æŠ€æœ¯ã€‚åœ¨ç”Ÿæˆ RSA å¯†é’¥å¯¹ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰æ—¶ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æ¥ç¡®ä¿åŠ å¯†è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚è¿™å°±æ˜¯<code>rsaHashedKeyGenParams.hash</code>çš„è§’è‰²æ‰€åœ¨ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨ Node.js ä¸­ä½¿ç”¨ Web Crypto API ç”Ÿæˆä¸€ä¸ª RSA å¯†é’¥å¯¹çš„ä»£ç ç‰‡æ®µå¯èƒ½å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å®šä¹‰RSAå¯†é’¥å¯¹çš„é…ç½®ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyGenParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦ï¼Œä»¥ä½è®¡</span></span>
<span class="line"><span style="color:#88C0D0;">    publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0x01</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x00</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x01</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿™é‡Œæ˜¯rsaHashedKeyGenParams.hashçš„å®é™…åº”ç”¨</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyGenParams</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥å¯¹ç”ŸæˆæˆåŠŸï¼</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">å¯†é’¥å¯¹ç”Ÿæˆå¤±è´¥ï¼š</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>webcrypto.subtle.generateKey</code>æ–¹æ³•ç”Ÿæˆäº†ä¸€ä¸ª RSA å¯†é’¥å¯¹ã€‚åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¯¹è±¡<code>keyGenParams</code>ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­å®šä¹‰äº†æˆ‘ä»¬æœŸæœ›çš„å¯†é’¥é…ç½®ã€‚ç‰¹åˆ«æ˜¯ï¼Œ<code>hash</code>å­—æ®µè¢«è®¾ç½®ä¸º<code>&quot;SHA-256&quot;</code>ï¼Œæ„å‘³ç€åœ¨ç”Ÿæˆå¯†é’¥å¯¹è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ SHA-256 å“ˆå¸Œå‡½æ•°æ¥å¢å¼ºå¯†é’¥å®‰å…¨æ€§ã€‚</p><p>é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œä½ å°±å¯ä»¥ä¸ºä½ çš„åº”ç”¨ç”Ÿæˆä¸€ä¸ªæ—¢å®‰å…¨åˆæœ‰æ•ˆçš„å¯†é’¥å¯¹ï¼Œç”¨äº RSA åŠ å¯†ã€‚è¿™åªæ˜¯ Node.js åœ¨ Web Crypto API ä¸­å®ç°çš„ä¼—å¤šåŠŸèƒ½ä¹‹ä¸€ï¼Œå±•ç¤ºäº† Node.js å¼ºå¤§çš„åç«¯åŠ å¯†èƒ½åŠ›ã€‚</p><h4 id="rsahashedkeygenparams-moduluslength" tabindex="-1"><a class="header-anchor" href="#rsahashedkeygenparams-moduluslength"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsahashedkeygenparamsmoduluslength" target="_blank" rel="noopener noreferrer">rsaHashedKeyGenParams.modulusLength</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Web Crypto API æ˜¯ Web å¹³å°æä¾›çš„ä¸€ä¸ªç”¨äºåŠ å¯†çš„æ¥å£é›†åˆï¼Œè€Œ Node.js ä»ç‰ˆæœ¬ 15.0.0 å¼€å§‹ï¼Œå¼•å…¥äº†å®éªŒæ€§çš„ Web Crypto API æ”¯æŒã€‚</p><p>åœ¨ Web Crypto API ä¸­ï¼Œ<code>rsaHashedKeyGenParams</code> æ˜¯ç”Ÿæˆ RSA åŠ å¯†å¯†é’¥å¯¹æ—¶ä½¿ç”¨çš„å‚æ•°å¯¹è±¡ã€‚è¿™é‡Œæˆ‘ä»¬ç€é‡è®²è§£ <code>modulusLength</code> å±æ€§æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„ä½œç”¨ã€‚</p><h3 id="æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#æ¦‚å¿µ"><span>æ¦‚å¿µ</span></a></h3><h4 id="rsahashedkeygenparams-moduluslength-1" tabindex="-1"><a class="header-anchor" href="#rsahashedkeygenparams-moduluslength-1"><span>rsaHashedKeyGenParams.modulusLength</span></a></h4><ul><li><strong>å®šä¹‰</strong>ï¼š<code>modulusLength</code> æ˜¯ RSA å¯†é’¥ç”Ÿæˆå‚æ•°ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œè¡¨ç¤ºç”Ÿæˆçš„ RSA å¯†é’¥çš„æ¨¡æ•°é•¿åº¦ï¼Œå•ä½æ˜¯ä½ï¼ˆbitï¼‰ã€‚æ¨¡æ•°ï¼ˆmodulusï¼‰æ˜¯ RSA ç®—æ³•å…¬é’¥å’Œç§é’¥ä¸­å…±æœ‰çš„ä¸€ä¸ªå¤§æ•°ï¼Œå…¶é•¿åº¦ç›´æ¥å½±å“åˆ°å¯†é’¥çš„å®‰å…¨æ€§ã€‚æ›´é•¿çš„æ¨¡æ•°é€šå¸¸æ„å‘³ç€æ›´é«˜çš„å®‰å…¨æ€§ï¼Œä½†åŒæ—¶ä¹Ÿæ„å‘³ç€è®¡ç®—ä¼šæ›´å¤æ‚ã€é€Ÿåº¦å¯èƒ½æ›´æ…¢ã€‚</li><li><strong>å–å€¼</strong>ï¼šå¸¸è§çš„ <code>modulusLength</code> å€¼åŒ…æ‹¬ 2048ã€3072ã€4096 ç­‰ã€‚2023 å¹´æ¥çœ‹ï¼Œ2048 ä½å·²ç»è¢«è§†ä¸ºå®‰å…¨çš„æœ€å°é•¿åº¦ï¼Œä½†éšç€è®¡ç®—èƒ½åŠ›çš„å¢å¼ºï¼Œæ›´é•¿çš„æ¨¡æ•°ï¼ˆå¦‚ 4096 ä½ï¼‰å¯èƒ½ä¼šè¢«æ¨èä»¥è·å¾—æ›´é«˜çš„å®‰å…¨æ€§ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦éå¯¹ç§°åŠ å¯†æŠ€æœ¯æ¥ä¿æŠ¤æ•°æ®ä¼ è¾“çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„æ¶ˆæ¯åŠ å¯†ä¼ è¾“ç³»ç»Ÿã€‚</p><ol><li><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆå…¬é’¥å’Œç§é’¥çš„ä¸€å¯¹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>modulusLength</code> å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒå†³å®šäº†ä½ çš„å¯†é’¥å°†ä¼šæœ‰å¤šå¼ºçš„å®‰å…¨æ€§ã€‚ä½¿ç”¨ Node.js çš„ Web Crypto APIï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> webcrypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ 2048 ä½æ¨¡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">keyPair</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªæ¨¡æ•°é•¿åº¦ä¸º 2048 ä½çš„ RSA å¯†é’¥å¯¹ï¼Œç”¨äº OAEPï¼ˆOptimal Asymmetric Encryption Paddingï¼‰åŠ å¯†æ¨¡å¼ï¼Œå¹¶æŒ‡å®š SHA-256 ä½œä¸ºæ•£åˆ—å‡½æ•°ã€‚</p><ol start="2"><li><strong>ä½¿ç”¨å¯†é’¥åŠ è§£å¯†</strong>ï¼šç”Ÿæˆå¯†é’¥åï¼Œä½ å¯ä»¥ä½¿ç”¨å…¬é’¥æ¥åŠ å¯†ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨ç§é’¥æ¥è§£å¯†ã€‚åŠ å¯†ä¿¡æ¯ç¡®ä¿åªæœ‰æŒæœ‰ç›¸åº”ç§é’¥çš„ç”¨æˆ·æ‰èƒ½è§£è¯»ä¿¡æ¯å†…å®¹ã€‚</li></ol><p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ· A ä½¿ç”¨ç”¨æˆ· B çš„å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼Œç„¶åå‘é€ç»™ç”¨æˆ· Bï¼›ç”¨æˆ· B æ”¶åˆ°åï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†æŸ¥çœ‹ä¿¡æ¯ã€‚</p><h3 id="ç»“è®º-6" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-6"><span>ç»“è®º</span></a></h3><p><code>modulusLength</code> åœ¨ç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå®ƒç›´æ¥å½±å“åˆ°å¯†é’¥çš„å®‰å…¨æ€§å’Œè®¡ç®—æ•ˆç‡ã€‚é€‰æ‹©é€‚å½“çš„ <code>modulusLength</code>ï¼Œå¯ä»¥åœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶ï¼Œè€ƒè™‘åˆ°ç³»ç»Ÿèµ„æºçš„åˆç†åˆ©ç”¨ã€‚éšç€è®¡ç®—æœºå¤„ç†èƒ½åŠ›çš„æå‡ï¼Œå»ºè®®çš„ <code>modulusLength</code> å€¼å¯èƒ½ä¼šè¿›ä¸€æ­¥å¢åŠ ï¼Œä»¥é€‚åº”æœªæ¥å¯¹å®‰å…¨æ€§çš„æ›´é«˜è¦æ±‚ã€‚</p><h4 id="rsahashedkeygenparams-name" tabindex="-1"><a class="header-anchor" href="#rsahashedkeygenparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsahashedkeygenparamsname" target="_blank" rel="noopener noreferrer">rsaHashedKeyGenParams.name</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>rsaHashedKeyGenParams.name</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®º Web åŠ å¯† API ä¸­ä¸€ä¸ªéå¸¸ç‰¹å®šçš„éƒ¨åˆ†ï¼Œå³ä¸ RSA å“ˆå¸Œå¯†é’¥ç”Ÿæˆå‚æ•°ç›¸å…³çš„å†…å®¹ã€‚è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹å¤æ‚ï¼Œä½†æˆ‘ä¼šå°½åŠ›ç”¨ç®€å•çš„è¯­è¨€è§£é‡Šå®ƒã€‚</p><h3 id="web-åŠ å¯†-api-ç®€ä»‹-1" tabindex="-1"><a class="header-anchor" href="#web-åŠ å¯†-api-ç®€ä»‹-1"><span>Web åŠ å¯† API ç®€ä»‹</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹ Web åŠ å¯† API æ˜¯å¾ˆé‡è¦çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æµè§ˆå™¨æ¥å£ï¼Œå…è®¸å¼€å‘è€…ç›´æ¥åœ¨ Web åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œå„ç§åŠ å¯†æ“ä½œï¼Œå¦‚ç”Ÿæˆå¯†é’¥ã€åŠ å¯†å’Œç­¾åæ•°æ®ç­‰ã€‚Node.js é€šè¿‡<code>crypto</code>æ¨¡å—æä¾›äº†å¯¹æ­¤ API çš„æ”¯æŒï¼Œä½¿å¾—åœ¨ Node ç¯å¢ƒä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚</p><h3 id="rsa-åŠ å¯†ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#rsa-åŠ å¯†ç®—æ³•"><span>RSA åŠ å¯†ç®—æ³•</span></a></h3><p>å†æ¥ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ RSA åŠ å¯†ç®—æ³•ã€‚RSA æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†æŠ€æœ¯ï¼Œå±äºéå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚è¿™æ„å‘³ç€å®ƒä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œç§é’¥åˆ™ç”¨äºè§£å¯†ã€‚RSA çš„å®‰å…¨æ€§åŸºäºå¤§æ•°åˆ†è§£çš„éš¾åº¦ã€‚</p><h3 id="rsahashedkeygenparams-1" tabindex="-1"><a class="header-anchor" href="#rsahashedkeygenparams-1"><span>rsaHashedKeyGenParams</span></a></h3><p><code>rsaHashedKeyGenParams</code>æ˜¯æŒ‡åœ¨ä½¿ç”¨ Web åŠ å¯† API ç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶æ‰€éœ€çš„ä¸€ç»„å‚æ•°ã€‚å…¶ä¸­<code>.name</code>å±æ€§å°±æ˜¯æŒ‡å®šè¿™ç»„å‚æ•°å°†ç”¨äºå“ªç§å…·ä½“çš„æ“ä½œã€‚å¯¹äº RSA æ¥è¯´ï¼Œå½“æˆ‘ä»¬è®¾ç½®<code>rsaHashedKeyGenParams.name</code>ä¸º<code>&quot;RSA-PSS&quot;</code>æˆ–<code>&quot;RSASSA-PKCS1-v1_5&quot;</code>æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨é€‰æ‹©ä½¿ç”¨ RSA ç®—æ³•çš„å“ªä¸ªå˜ç§è¿›è¡Œæ“ä½œã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-20" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-20"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦æ•°å­—ç­¾ååŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚æ•°å­—ç­¾åèƒ½å¤ŸéªŒè¯æ¶ˆæ¯æˆ–æ–‡æ¡£æ˜¯ç”±ç‰¹å®šçš„å‘é€æ–¹åˆ›å»ºä¸”æœªè¢«ç¯¡æ”¹çš„ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä½¿ç”¨ RSA è¿›è¡Œç­¾åæ˜¯éå¸¸åˆé€‚çš„ã€‚</p><ol><li><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¯¹ RSA å¯†é’¥ã€‚è¿™é‡Œä½ ä¼šä½¿ç”¨åˆ°<code>rsaHashedKeyGenParams</code>ï¼ŒåŒ…æ‹¬å†³å®šç”¨äºç”Ÿæˆå¯†é’¥çš„ RSA ç®—æ³•å˜ç§ï¼ˆæ¯”å¦‚<code>&quot;RSA-PSS&quot;</code>ï¼‰å’Œå“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA-256ï¼‰ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0x01</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x00</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x01</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ç­¾åæ•°æ®</strong>ï¼šç„¶åï¼Œä½¿ç”¨ç”Ÿæˆçš„ç§é’¥æ¥ç­¾åç‰¹å®šçš„æ•°æ®ã€‚è¿™è¯æ˜äº†æ•°æ®ç¡®å®æ˜¯ç”±æŒæœ‰ç›¸åº”ç§é’¥çš„ä¸ªä½“å‘å¸ƒçš„ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // éœ€è¦ç­¾åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>éªŒè¯ç­¾å</strong>ï¼šæœ€åï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨å…¬é’¥æ¥éªŒè¯ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œè¯´æ˜æ•°æ®ç¡®å®æ¥æºäºç­¾åè€…ä¸”æœªè¢«ç¯¡æ”¹ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifySignature</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯<code>rsaHashedKeyGenParams.name</code>åœ¨ Node.js ä¸­çš„ä¸€ä¸ªå®é™…åº”ç”¨ç¤ºä¾‹ã€‚é€šè¿‡è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ˜ç¡®åœ°æŒ‡å®šåœ¨ç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶æƒ³è¦ä½¿ç”¨çš„ç®—æ³•åŠå…¶ç›¸å…³å‚æ•°ï¼Œä»¥æ»¡è¶³æˆ‘ä»¬çš„ç‰¹å®šåŠ å¯†éœ€æ±‚ã€‚</p><h4 id="rsahashedkeygenparams-publicexponent" tabindex="-1"><a class="header-anchor" href="#rsahashedkeygenparams-publicexponent"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsahashedkeygenparamspublicexponent" target="_blank" rel="noopener noreferrer">rsaHashedKeyGenParams.publicExponent</a></span></a></h4><p>åœ¨ Node.js çš„<code>webcrypto</code>æ¨¡å—ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†åŠ å¯†å’Œå®‰å…¨æ€§ç›¸å…³çš„åŠŸèƒ½æ—¶ï¼Œ<code>rsaHashedKeyGenParams.publicExponent</code>æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„æ¦‚å¿µã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£å®ƒï¼Œæˆ‘ä¼šä»å¤´å¼€å§‹è§£é‡Šï¼Œå¹¶æä¾›ä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-9" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-9"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£<code>rsaHashedKeyGenParams</code>æ˜¯å¿…è¦çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºç”Ÿæˆ RSAï¼ˆä¸€ç§åŠ å¯†ç®—æ³•ï¼‰å¯†é’¥å¯¹æ—¶çš„å‚æ•°é…ç½®ã€‚åœ¨ RSA åŠ å¯†ä½“ç³»ä¸­ï¼Œå¯†é’¥å¯¹åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œç§é’¥ç”¨äºè§£å¯†æ•°æ®ã€‚</p><p>å…¶ä¸­ï¼Œ<code>publicExponent</code>æ˜¯ç”Ÿæˆå…¬é’¥æ—¶çš„ä¸€ä¸ªé‡è¦å‚æ•°ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒä¸å¦å¤–ä¸¤ä¸ªå¤§ç´ æ•°ä¸€èµ·è¢«ç”¨æ¥ç”Ÿæˆä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚</p><h3 id="publicexponent-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#publicexponent-è§£é‡Š"><span>publicExponent è§£é‡Š</span></a></h3><p><code>publicExponent</code>æ˜¯åœ¨å…¬é’¥ä¸­ä½¿ç”¨çš„æŒ‡æ•°å€¼ã€‚åœ¨ RSA ç®—æ³•ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ•°å€¼éœ€è¦é€‰æ‹©ï¼šä¸€ä¸ªæ˜¯<code>publicExponent</code>ï¼Œå¦ä¸€ä¸ªæ˜¯æ¨¡æ•°ï¼ˆç”±ä¸¤ä¸ªå¤§ç´ æ•°ä¹˜ç§¯å¾—åˆ°ï¼‰ã€‚è¿™ä¸ªæŒ‡æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå°çš„è´¨æ•°ï¼Œæ¯”å¦‚ 3ã€65537 ç­‰ã€‚æœ€å¸¸è§çš„é€‰æ‹©æ˜¯ 65537ï¼ˆå³ 2 çš„ 16 æ¬¡æ–¹åŠ  1ï¼‰ï¼Œå› ä¸ºå®ƒæ—¢ä¸å¤ªå¤§ä¹Ÿä¸å¤ªå°ï¼Œå¯ä»¥å¹³è¡¡å®‰å…¨æ€§å’Œè®¡ç®—æ•ˆç‡ã€‚</p><p>åœ¨ Node.js çš„<code>webcrypto</code>æ¨¡å—ä¸­ï¼Œå½“ä½ æƒ³ç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶ï¼Œä½ éœ€è¦æŒ‡å®š<code>rsaHashedKeyGenParams</code>å¯¹è±¡ï¼ŒåŒ…æ‹¬<code>name</code>ï¼ˆåŠ å¯†ç®—æ³•åç§°ï¼‰ã€<code>modulusLength</code>ï¼ˆæ¨¡æ•°é•¿åº¦ï¼‰ã€<code>publicExponent</code>ï¼ˆå…¬é’¥æŒ‡æ•°ï¼‰ã€å’Œ<code>hash</code>ï¼ˆå“ˆå¸Œç®—æ³•ï¼‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-24" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-24"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†é€šä¿¡çš„ Web åº”ç”¨ã€‚ç”¨æˆ·å‘é€çš„æ¶ˆæ¯å¿…é¡»è¢«åŠ å¯†ï¼Œä»¥ç¡®ä¿åªæœ‰æ¥æ”¶è€…èƒ½å¤Ÿè¯»å–ã€‚</p><ol><li><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¯¹å¯†é’¥ã€‚è¿™é‡Œå°±ä¼šç”¨åˆ°<code>rsaHashedKeyGenParams</code>ï¼Œå¹¶ä¸”è®¾ç½®<code>publicExponent</code>ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ¨¡æ•°é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 65537ï¼Œå¸¸ç”¨çš„å…¬é’¥æŒ‡æ•°</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ä½¿ç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯</strong>ï¼šå½“ä½ æœ‰äº†å¯†é’¥å¯¹ä¹‹åï¼Œä½ å¯ä»¥ç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedMessage</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedMessage</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>ä½¿ç”¨ç§é’¥è§£å¯†ä¿¡æ¯</strong>ï¼šç›¸åº”åœ°ï¼Œæ¥æ”¶æ–¹å¯ä»¥ä½¿ç”¨ç§é’¥æ¥è§£å¯†ä¿¡æ¯ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encryptedMessage</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedMessage</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decodedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedMessage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> decodedMessage</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œä¿¡æ¯èƒ½å¤Ÿå®‰å…¨åœ°åœ¨å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´ä¼ è¾“ï¼Œå³ä½¿æœ‰äººæˆªè·äº†è¿™äº›ä¿¡æ¯ï¼Œæ²¡æœ‰ç§é’¥ä»–ä»¬ä¹Ÿæ— æ³•è§£å¯†ã€‚</p><h3 id="æ€»ç»“-13" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-13"><span>æ€»ç»“</span></a></h3><p><code>publicExponent</code>åœ¨ç”Ÿæˆ RSA å¯†é’¥å¯¹æ—¶æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œå®ƒå½±å“äº†å…¬é’¥çš„ç”Ÿæˆï¼Œå¹¶æœ€ç»ˆå½±å“åˆ°æ•´ä¸ªåŠ å¯†æµç¨‹çš„å®‰å…¨æ€§å’Œæ•ˆç‡ã€‚Node.js çš„<code>webcrypto</code>æ¨¡å—ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°åœ¨è‡ªå·±çš„åº”ç”¨ä¸­å®ç°å¼ºå¤§çš„åŠ å¯†åŠŸèƒ½ã€‚</p><h3 id="class-rsaoaepparams" tabindex="-1"><a class="header-anchor" href="#class-rsaoaepparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-rsaoaepparams" target="_blank" rel="noopener noreferrer">Class: RsaOaepParams</a></span></a></h3><p>ç†è§£<code>RsaOaepParams</code>è¿™ä¸ªç±»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“ä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚åœ¨ Node.js ä¸­ï¼Œæ¶‰åŠåˆ°åŠ å¯†å’Œè§£å¯†çš„æ“ä½œæ—¶ï¼Œå°±ä¼šç”¨åˆ° Web Cryptography APIï¼ˆç½‘ç»œåŠ å¯† APIï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡ŒåŸºæœ¬åŠ å¯†æ“ä½œï¼ˆä¾‹å¦‚ï¼šå“ˆå¸Œã€ç­¾åã€éªŒè¯ç­‰ï¼‰çš„æ ‡å‡† APIï¼Œå®ƒåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å¾ˆå¸¸è§ï¼Œå¹¶ä¸” Node.js ä¹Ÿæ”¯æŒå®ƒã€‚</p><h3 id="rsa-oaep-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#rsa-oaep-æ˜¯ä»€ä¹ˆ"><span>RSA-OAEP æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>RSA-OAEP (RSA Optimal Asymmetric Encryption Padding) æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†ç®—æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ä¸€ä¸ªå…¬é’¥å°†æ•°æ®åŠ å¯†ï¼Œç„¶ååªèƒ½ç”¨å¯¹åº”çš„ç§é’¥æ¥è§£å¯†ã€‚&quot;OAEP&quot; æ˜¯ä¸€ç§å¡«å……æ–¹æ³•ï¼Œå®ƒä½¿å¾—åŠ å¯†è¿‡ç¨‹æ›´å®‰å…¨ã€‚RSA-OAEP å¹¿æ³›ç”¨äºæ•°æ®ä¼ è¾“çš„åœºæ™¯ä¸­ï¼Œç¡®ä¿ä¿¡æ¯å®‰å…¨ã€‚</p><h3 id="rsaoaepparams-ç±»" tabindex="-1"><a class="header-anchor" href="#rsaoaepparams-ç±»"><span><code>RsaOaepParams</code> ç±»</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„ Web Cryptography API ä¸­ï¼Œ<code>RsaOaepParams</code>æ˜¯ç”¨äºé…ç½® RSA-OAEP æ“ä½œï¼ˆæ¯”å¦‚åŠ å¯†æˆ–è§£å¯†ï¼‰çš„å‚æ•°çš„ç±»ã€‚å½“ä½ éœ€è¦è¿›è¡Œ RSA-OAEP åŠ å¯†æˆ–è§£å¯†æ—¶ï¼Œä½ ä¼šéœ€è¦åˆ›å»ºä¸€ä¸ªå«æœ‰ç‰¹å®šå‚æ•°çš„<code>RsaOaepParams</code>å¯¹è±¡ã€‚</p><h3 id="ä¸»è¦å±æ€§" tabindex="-1"><a class="header-anchor" href="#ä¸»è¦å±æ€§"><span>ä¸»è¦å±æ€§</span></a></h3><ul><li><strong>name</strong>: è¿™é‡Œå®ƒå›ºå®šä¸º <code>&quot;RSA-OAEP&quot;</code>ï¼Œæ ‡ç¤ºè¿™æ˜¯ä¸€ä¸ªå…³äº RSA-OAEP æ“ä½œçš„å‚æ•°é…ç½®ã€‚</li><li><strong>hash</strong>: æŒ‡å®šç”¨äº OAEP å¡«å……çš„å“ˆå¸Œå‡½æ•°ï¼Œä¾‹å¦‚<code>&quot;SHA-256&quot;</code>ã€‚è¿™å†³å®šäº†åŠ å¯†è¿‡ç¨‹ä¸­ç”¨æ¥å¤„ç†æ•°æ®çš„å“ˆå¸Œç®—æ³•ç±»å‹ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-5" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-5"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚ç”¨æˆ·å¯†ç æˆ–ç§äººæ–‡ä»¶ï¼‰çš„åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥ä½¿ç”¨ RSA-OAEP åŠ å¯†æ–¹æ³•æ¥ç¡®ä¿è¿™äº›æ•°æ®åœ¨å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰å·²ç»è¢«åŠ å¯†ï¼Œå³ä¾¿æœ‰äººæˆªè·è¿™äº›æ•°æ®ï¼Œæ²¡æœ‰ç§é’¥ä¹Ÿæ— æ³•è§£å¯†ï¼Œä»è€Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h3 id="å®é™…ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-5"><span>å®é™…ä¾‹å­</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> rsaOaepEncrypt</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // å°†éœ€è¦åŠ å¯†çš„æ•°æ®è½¬æ¢ä¸ºArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // åˆ›å»ºRsaOaepParamså¯¹è±¡ï¼ŒæŒ‡å®šhashä¸º&#39;SHA-256&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encryptParams</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ä½¿ç”¨å…¬é’¥ã€æŒ‡å®šçš„å‚æ•°ä»¥åŠå¾…åŠ å¯†æ•°æ®è¿›è¡ŒåŠ å¯†</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptParams</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// å‡è®¾ publicKey æ˜¯ä½ é€šè¿‡æŸç§æ–¹å¼è·å–çš„RSAå…¬é’¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>rsaOaepEncrypt</code>å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ª RSA å…¬é’¥å’Œå¾…åŠ å¯†çš„æ•°æ®ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…å«<code>&quot;RSA-OAEP&quot;</code>åç§°å’Œ<code>&quot;SHA-256&quot;</code>å“ˆå¸Œå‡½æ•°çš„<code>RsaOaepParams</code>å¯¹è±¡ï¼Œæˆ‘ä»¬è°ƒç”¨<code>subtle.encrypt</code>æ–¹æ³•æ¥å®ŒæˆåŠ å¯†æ“ä½œã€‚</p><h3 id="ç»“è®º-7" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-7"><span>ç»“è®º</span></a></h3><p>é€šè¿‡äº†è§£<code>RsaOaepParams</code>ç±»å’Œå®ƒçš„åº”ç”¨ï¼Œä½ å¯ä»¥å¼€å§‹åœ¨ Node.js é¡¹ç›®ä¸­å®ç°åŸºäº RSA-OAEP çš„åŠ å¯†ä¸è§£å¯†æ“ä½œï¼Œæå‡åº”ç”¨æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><h4 id="rsaoaepparams-label" tabindex="-1"><a class="header-anchor" href="#rsaoaepparams-label"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsaoaepparamslabel" target="_blank" rel="noopener noreferrer">rsaOaepParams.label</a></span></a></h4><p>Node.js åœ¨å…¶ WebCrypto API ä¸­åŒ…å«äº†ä¸€ä¸ªåä¸º <code>rsaOaepParams.label</code> çš„å±æ€§ï¼Œå®ƒæ˜¯ç”¨äº RSA-OAEP åŠ å¯†å’Œè§£å¯†æ“ä½œçš„ã€‚ä¸ºäº†ç†è§£è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="èƒƒå£éƒ¨åˆ†-rsa-å’Œ-oaep" tabindex="-1"><a class="header-anchor" href="#èƒƒå£éƒ¨åˆ†-rsa-å’Œ-oaep"><span>èƒƒå£éƒ¨åˆ†: RSA å’Œ OAEP</span></a></h3><ul><li><p><strong>RSA åŠ å¯†</strong>ï¼šRSA æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå®ƒä½¿ç”¨ä¸€å¯¹å…¬é’¥å’Œç§é’¥æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚ä½ å¯ä»¥ç”¨å¯¹æ–¹çš„å…¬é’¥æ¥åŠ å¯†ä¿¡æ¯ï¼Œç„¶åå¯¹æ–¹å¯ä»¥ç”¨ä»–ä»¬çš„ç§é’¥æ¥è§£å¯†å®ƒï¼Œåä¹‹äº¦ç„¶ã€‚</p></li><li><p><strong>OAEPï¼ˆOptimal Asymmetric Encryption Paddingï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ç§å¡«å……æ¨¡å¼ï¼Œç”¨äºå¢å¼º RSA åŠ å¯†çš„å®‰å…¨æ€§ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå¸®åŠ©é˜²æ­¢å¯¹åŠ å¯†æ¶ˆæ¯çš„æŸäº›æ”»å‡»ï¼Œé€šè¿‡æ·»åŠ ä¸€äº›éšæœºæ€§åˆ°ä½ è¦åŠ å¯†çš„æ¶ˆæ¯ä¸­ã€‚</p></li></ul><h3 id="rsaoaepparams-label-1" tabindex="-1"><a class="header-anchor" href="#rsaoaepparams-label-1"><span>rsaOaepParams.label</span></a></h3><p>åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>rsaOaepParams.label</code> æ˜¯ä¸€ä¸ªå¯é€‰çš„å±æ€§ï¼Œç”¨äºè¿›ä¸€æ­¥å¢åŠ  RSA-OAEP åŠ å¯†è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚å®ƒå®é™…ä¸Šæ˜¯ OAEP åŠ å¯†è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå‚æ•°ï¼Œåˆè¢«ç§°ä¸º &quot;OAEP æ ‡ç­¾&quot; æˆ–è€… &quot;OAEP ç§å­&quot;ã€‚è¿™ä¸ªæ ‡ç­¾æ˜¯ä¸€ä¸ªä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆäº‹å®ä¸Šï¼Œåœ¨å®è·µä¸­æ˜¯è½¬æ¢æˆäº†å­—èŠ‚åºåˆ—ï¼‰ï¼Œåœ¨åŠ å¯†è¿‡ç¨‹ä¸­ä½œä¸ºé¢å¤–è¾“å…¥ï¼Œå¹¶ä¸”åœ¨è§£å¯†æ—¶éœ€è¦åŒ¹é…ä¸ŠåŸæ¥çš„æ ‡ç­¾ï¼Œä»¥æ­£ç¡®åœ°è§£å¯†æ¶ˆæ¯ã€‚</p><h3 id="ä¸ºä»€ä¹ˆå®ƒé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆå®ƒé‡è¦"><span>ä¸ºä»€ä¹ˆå®ƒé‡è¦ï¼Ÿ</span></a></h3><p>ä½¿ç”¨ <code>label</code> å¯ä»¥æä¾›é¢å¤–çš„å®‰å…¨æ€§ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå³ä½¿ä¸¤ä¸ªæ¶ˆæ¯å’Œä»–ä»¬çš„å…¬é’¥éƒ½ç›¸åŒï¼Œä½†æ˜¯å¦‚æœä»–ä»¬çš„ <code>label</code> ä¸åŒï¼ŒåŠ å¯†ç»“æœä¹Ÿä¼šä¸åŒã€‚è¿™å°±ä¸ºæ¯æ¬¡åŠ å¯†æ·»åŠ äº†é¢å¤–çš„å”¯ä¸€æ€§ï¼Œå¹¶ä¸”ä½¿å¾—æ”»å‡»è€…æ›´éš¾ä»¥å¯¹åŠ å¯†ç®—æ³•è¿›è¡Œé¢„æµ‹æˆ–è€…å‘èµ·æ”»å‡»ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-21" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-21"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="åŠ å¯†åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åŠ å¯†åœºæ™¯"><span>åŠ å¯†åœºæ™¯</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®‰å…¨é‚®ä»¶åº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦ç¡®ä¿åªæœ‰ç‰¹å®šçš„æ”¶ä»¶äººæ‰èƒ½é˜…è¯»å‘é€çš„æ¶ˆæ¯ã€‚ä½ å†³å®šä½¿ç”¨ RSA-OAEP æ¥åŠ å¯†é‚®ä»¶å†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> label</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedLabel</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">label</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedContent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      label</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> encodedLabel</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨label</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedMessage</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedContent</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>encryptMessage</code> å‡½æ•°æ¥å—ä¸€ä¸ªå…¬é’¥ã€è¦åŠ å¯†çš„æ¶ˆæ¯å’Œä¸€ä¸ª <code>label</code>ã€‚<code>label</code> åœ¨åŠ å¯†è¿‡ç¨‹ä¸­è¢«ä½¿ç”¨ï¼Œæä¾›é¢å¤–çš„å®‰å…¨æ€§å±‚ã€‚</p><h4 id="è§£å¯†åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#è§£å¯†åœºæ™¯"><span>è§£å¯†åœºæ™¯</span></a></h4><p>ç°åœ¨ï¼Œå‡è®¾ä½ éœ€è¦è§£å¯†ä¸Šé¢åŠ å¯†çš„é‚®ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptMessage</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedContent</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> label</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedLabel</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">label</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedContent</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      label</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> encodedLabel</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ä¸åŠ å¯†æ—¶ç›¸åŒçš„label</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedContent</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decodedMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedContent</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> decodedMessage</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è§£å¯†å‡½æ•° <code>decryptMessage</code> ä¸­ï¼Œä½ éœ€è¦ä¼ å…¥ç§é’¥ã€åŠ å¯†å†…å®¹ä»¥åŠå½“åˆç”¨äºåŠ å¯†çš„ç›¸åŒ <code>label</code>ã€‚å¦‚æœ <code>label</code> åŒ¹é…ï¼Œé‚£ä¹ˆè§£å¯†æµç¨‹ç»§ç»­ï¼Œå¦åˆ™è§£å¯†å°†å¤±è´¥ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>rsaOaepParams.label</code> åœ¨ Node.js çš„ WebCrypto API ä¸­ï¼Œæä¾›äº†ä¸€ç§æ–¹å¼æ¥å¢å¼º RSA-OAEP åŠ å¯†/è§£å¯†æ“ä½œçš„å®‰å…¨æ€§ã€‚é€šè¿‡ä½¿ç”¨ <code>label</code>ï¼Œå¼€å‘è€…å¯ä»¥ä¸ºä»–ä»¬çš„åŠ å¯†æ•°æ®å¼•å…¥é¢å¤–çš„å®‰å…¨å±‚æ¬¡ï¼Œä»è€Œæå‡æ•´ä½“çš„æ•°æ®ä¿æŠ¤æ°´å¹³ã€‚</p><h4 id="rsaoaepparams-name" tabindex="-1"><a class="header-anchor" href="#rsaoaepparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsaoaepparamsname" target="_blank" rel="noopener noreferrer">rsaOaepParams.name</a></span></a></h4><p>Node.js çš„ <code>rsaOaepParams.name</code> å±äº Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºåŠ å¯†çš„æ ‡å‡†æ¥å£ã€‚åœ¨è§£é‡Šè¿™ä¸ªå±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆéœ€è¦äº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-10" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-10"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><h4 id="rsa-oaep" tabindex="-1"><a class="header-anchor" href="#rsa-oaep"><span>RSA-OAEP</span></a></h4><p>RSA-OAEP (RSA Optimal Asymmetric Encryption Padding) æ˜¯ä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼Œå®ƒä½¿ç”¨äº†å…¬é’¥å’Œç§é’¥ã€‚ä½ å¯ä»¥æŠŠå…¬é’¥æƒ³è±¡æˆä¸€ä¸ªé”ï¼Œè€Œç§é’¥å°±æ˜¯æ‰“å¼€è¿™ä¸ªé”çš„é’¥åŒ™ã€‚ä»»ä½•äººéƒ½å¯ä»¥ç”¨å…¬é’¥ï¼ˆé”ï¼‰æ¥åŠ å¯†ä¿¡æ¯ï¼Œä½†åªæœ‰æ‹¥æœ‰å¯¹åº”ç§é’¥ï¼ˆé’¥åŒ™ï¼‰çš„äººæ‰èƒ½è§£å¯†è¿™ä¸ªä¿¡æ¯ã€‚OAEP æ˜¯ä¸€ç§å¡«å……æ–¹æ¡ˆï¼Œç”¨äºå¢åŠ åŠ å¯†æ—¶çš„å®‰å…¨æ€§ã€‚</p><h4 id="web-crypto-api-3" tabindex="-1"><a class="header-anchor" href="#web-crypto-api-3"><span>Web Crypto API</span></a></h4><p>Web Crypto API æ˜¯ä¸€å¥—åœ¨ç½‘é¡µç¯å¢ƒä¸­æ‰§è¡ŒåŠ å¯†æ“ä½œçš„ APIã€‚å®ƒæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œå®‰å…¨çš„å¯†ç å­¦æ“ä½œï¼Œæ¯”å¦‚åŠ å¯†ã€è§£å¯†ã€ç­¾åç­‰ã€‚</p><h3 id="rsaoaepparams-name-1" tabindex="-1"><a class="header-anchor" href="#rsaoaepparams-name-1"><span><a href="http://rsaOaepParams.name" target="_blank" rel="noopener noreferrer">rsaOaepParams.name</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>rsaOaepParams.name</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼ŒæŒ‡å®šäº†è¦ä½¿ç”¨çš„åŠ å¯†ç®—æ³•åç§°ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹æ˜¯ &quot;RSA-OAEP&quot;ã€‚å½“ä½ åœ¨ä½¿ç”¨ Web Crypto API è¿›è¡ŒåŠ å¯†æ“ä½œæ—¶ï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«å„ç§å‚æ•°çš„å¯¹è±¡ï¼Œ<code>rsaOaepParams</code> å°±æ˜¯è¿™æ ·ä¸€ä¸ªå¯¹è±¡ã€‚å…¶ <code>.name</code> å±æ€§å‘Šè¯‰ Node.js ä½ æ‰“ç®—ä½¿ç”¨ RSA-OAEP ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-22" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-22"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªéœ€è¦å‘é€æ•æ„Ÿæ•°æ®åˆ°æœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä½ æƒ³ä¿è¯è¿™äº›æ•°æ®çš„å®‰å…¨æ€§ã€‚ä½ å¯ä»¥ä½¿ç”¨ RSA-OAEP æ¥åŠ å¯†è¿™äº›æ•°æ®ã€‚</p><ol><li><strong>ç”Ÿæˆå¯†é’¥</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeyPair</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0x01</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x00</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x01</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">decrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>åŠ å¯†æ•°æ®</strong>ï¼šç„¶åï¼Œç”¨å…¬é’¥åŠ å¯†è¦å‘é€çš„ä¿¡æ¯ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encodedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // å°†æ•°æ®è½¬æ¢ä¸ºUint8Array</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encodedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>è§£å¯†æ•°æ®</strong>ï¼šæœ€åï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ç§é’¥æ¥è§£å¯†æ”¶åˆ°çš„æ•°æ®ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> decryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-OAEP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encryptedData</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextDecoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">decode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°è¿‡ç¨‹ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°±èƒ½å®‰å…¨åœ°å‘é€åŠ å¯†æ•°æ®åˆ°æœåŠ¡å™¨äº†ã€‚RSA-OAEP æä¾›äº†è¾ƒé«˜çš„å®‰å…¨æ€§ï¼Œç‰¹åˆ«æ˜¯ç»“åˆ OAEP å¡«å……æ–¹æ¡ˆæ—¶ï¼Œä½¿å¾—å®ƒéå¸¸é€‚åˆäºä¼ è¾“æ•æ„Ÿä¿¡æ¯ã€‚</p><h3 id="class-rsapssparams" tabindex="-1"><a class="header-anchor" href="#class-rsapssparams"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#class-rsapssparams" target="_blank" rel="noopener noreferrer">Class: RsaPssParams</a></span></a></h3><p>å½“ä½ å¼€å§‹æ·±å…¥äº†è§£ Node.js ä¸­çš„åŠ å¯†åŠŸèƒ½æ—¶ï¼Œä½ ä¼šé‡åˆ°ä¸€ä¸ªåä¸º<code>RsaPssParams</code>çš„æ¦‚å¿µã€‚è¿™æ˜¯ä¸ Web Crypto API ç›¸å…³çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚åœ¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€ä¸­ï¼Œè®©æˆ‘ä»¬æ¥æ¢ç´¢å®ƒæ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…ä¸­åº”ç”¨å®ƒã€‚</p><h3 id="rsa-pss-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#rsa-pss-æ˜¯ä»€ä¹ˆ"><span>RSA-PSS æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼ŒRSA-PSSï¼ˆProbabilistic Signature Schemeï¼‰æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†æŠ€æœ¯çš„å˜ä½“ï¼Œä¸»è¦ç”¨äºåŠ å¯†å’Œæ•°å­—ç­¾åã€‚ä¸åŒäºä¼ ç»Ÿçš„ RSA ç­¾åï¼ŒPSS æä¾›äº†æ›´é«˜æ°´å¹³çš„å®‰å…¨æ€§ï¼Œå› ä¸ºå®ƒåœ¨ç”Ÿæˆç­¾åå‰æ·»åŠ äº†ä¸€ä¸ªéšæœºå› ç´ ï¼ˆç›å€¼ï¼‰ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒç±»ä¼¼äºç»™ä½ çš„æ•°æ®æˆ–æ¶ˆæ¯æ·»åŠ ä¸€ä¸ªâ€œä¿é™©â€ï¼Œä»¥ç¡®ä¿ç­¾åçœŸæ­£ç‹¬ä¸€æ— äºŒä¸”éš¾ä»¥ä¼ªé€ ã€‚</p><h3 id="rsapssparams-ç±»" tabindex="-1"><a class="header-anchor" href="#rsapssparams-ç±»"><span><code>RsaPssParams</code> ç±»</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>RsaPssParams</code>æ˜¯ä¸€ä¸ªä¸ Web Crypto API é…åˆä½¿ç”¨çš„ç±»ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ RSA-PSS è¿›è¡Œç­¾åæˆ–éªŒè¯ç­¾åæ—¶ã€‚å®ƒå…è®¸ä½ æ˜ç¡®æŒ‡å®šæ“ä½œä¸­æ¶‰åŠçš„å‚æ•°ï¼Œæ¯”å¦‚ç›å€¼çš„é•¿åº¦ã€‚</p><h3 id="å®é™…ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-6"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªçº¿ä¸Šå¹³å°ï¼Œéœ€è¦ç¡®ä¿ç”¨æˆ·æäº¤çš„æ•°æ®æœªè¢«ç¯¡æ”¹ã€‚ä½¿ç”¨ RSA-PSS ç­¾åå¯ä»¥å¸®åŠ©ä½ å®ç°è¿™ä¸ªç›®æ ‡ã€‚</p><ol><li><p><strong>ç”Ÿæˆå¯†é’¥</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥å¯ä»¥å…¬å¼€ï¼Œè€Œç§é’¥éœ€ä¿å¯†ã€‚</p></li><li><p><strong>ç­¾åè¿‡ç¨‹</strong>ï¼šä½¿ç”¨ç§é’¥å’Œ<code>RsaPssParams</code>ï¼ˆæŒ‡å®šç›å€¼çš„é•¿åº¦ç­‰ï¼‰æ¥å¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œç­¾åã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šè€ƒè™‘ç”¨æˆ·çš„æ•°æ®å’Œä½ è®¾å®šçš„å‚æ•°ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç­¾åã€‚</p></li><li><p><strong>éªŒè¯ç­¾å</strong>ï¼šå½“ç”¨æˆ·çš„æ•°æ®è¢«é€å›ç»™ä»–ä»¬æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¬é’¥å’ŒåŒæ ·çš„<code>RsaPssParams</code>å‚æ•°æ¥éªŒè¯ç­¾åã€‚å¦‚æœæ•°æ®æˆ–ç­¾åè¢«ç¯¡æ”¹ï¼ŒéªŒè¯å°†å¤±è´¥ã€‚</p></li></ol><h3 id="ä»£ç ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹-1"><span>ä»£ç ç¤ºä¾‹</span></a></h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸åŸºç¡€çš„ç¤ºä¾‹æ¥å±•ç¤ºå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨<code>crypto.subtle</code>æ¥å£å’Œ<code>RsaPssParams</code>è¿›è¡Œç­¾åï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ç”Ÿæˆå¯†é’¥å¯¹</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0x01</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x00</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x01</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// æŒ‡å®šå¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TextEncoder</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">encode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¶ˆæ¯</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ç­¾å</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›å€¼é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨ç§é’¥è¿›è¡Œç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // è¦ç­¾åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // éªŒè¯ç­¾å</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›å€¼é•¿åº¦å¿…é¡»åŒ¹é…</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨å…¬é’¥è¿›è¡ŒéªŒè¯</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¾…éªŒè¯çš„ç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // åŸå§‹æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ç­¾åæœ‰æ•ˆï¼Ÿ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç”Ÿæˆäº†ä¸€å¯¹ RSA-PSS å¯†é’¥ï¼Œç„¶åä½¿ç”¨ç§é’¥å¯¹ä¸€æ¡æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œå¹¶ä½¿ç”¨å…¬é’¥éªŒè¯è¿™ä¸ªç­¾åã€‚æ³¨æ„ï¼Œ<code>saltLength</code>åœ¨ç­¾åå’ŒéªŒè¯è¿‡ç¨‹ä¸­å¿…é¡»ç›¸åŒã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºçš„çœŸå®æ€§ï¼Œä¸ºä½ çš„åº”ç”¨ç¨‹åºå¢åŠ ä¸€å±‚å®‰å…¨ä¿æŠ¤ã€‚</p><h4 id="rsapssparams-name" tabindex="-1"><a class="header-anchor" href="#rsapssparams-name"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsapssparamsname" target="_blank" rel="noopener noreferrer">rsaPssParams.name</a></span></a></h4><p>äº†è§£ Node.js ä¸­çš„<code>rsaPssParams.name</code>ï¼Œé¦–å…ˆå¾—ç®€å•ä»‹ç»ä¸€ä¸‹å‡ ä¸ªç›¸å…³æ¦‚å¿µï¼š<strong>Node.js</strong>ã€<strong>Web Crypto API</strong>ã€<strong>RSA-PSS</strong>ã€‚</p><ol><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©æˆ‘ä»¬å¯ä»¥ç”¨ JavaScript åšæœåŠ¡å™¨ç«¯ç¼–ç¨‹ã€‚</li><li><strong>Web Crypto API</strong>: è¿™æ˜¯ä¸€ä¸ªä¸º Web åº”ç”¨æä¾›åŠ å¯†åŠŸèƒ½çš„ APIï¼ŒåŒ…æ‹¬æ•£åˆ—ã€ç­¾åã€éªŒè¯ç­‰ï¼Œå®ƒè¿è¡Œåœ¨æµè§ˆå™¨ä¸­ã€‚è€Œ Node.js v15 åŠä»¥ä¸Šç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†éƒ¨åˆ† Web Crypto API çš„æ”¯æŒï¼Œè®©æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½ä½¿ç”¨è¿™äº›åŠ å¯†åŠŸèƒ½ã€‚</li><li><strong>RSA-PSS</strong>: æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†æŠ€æœ¯å’Œç­¾åæ–¹æ¡ˆï¼Œç”¨äºæ•°å­—ç­¾åã€‚PSS ä»£è¡¨â€œProbabilistic Signature Schemeâ€ï¼Œæä¾›æ¯”ä¼ ç»Ÿçš„ RSA-PKCS#1 v1.5 ç­¾åæ–¹æ¡ˆæ›´é«˜çš„å®‰å…¨æ€§ã€‚</li></ol><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹<code>rsaPssParams.name</code>ã€‚åœ¨ Node.jsï¼ˆç‰¹åˆ«æ˜¯ä» v15 å¼€å§‹ï¼‰ä¸­ï¼Œé€šè¿‡å¼•å…¥ Web Crypto API çš„ä¸€éƒ¨åˆ†ï¼Œä¸ºæœåŠ¡å™¨ç«¯æä¾›äº†å¼ºå¤§çš„åŠ å¯†æ“ä½œ APIã€‚å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯æ”¯æŒ RSA-PSS ç­¾åå’ŒéªŒè¯æœºåˆ¶ã€‚åœ¨ä½¿ç”¨ RSA-PSS è¿›è¡Œç­¾åæˆ–éªŒè¯æ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª<code>RsaPssParams</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æè¿°äº† RSA-PSS æ“ä½œçš„å‚æ•°ã€‚<code>rsaPssParams.name</code>å±æ€§å°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œè¡¨ç¤ºæ‰€ä½¿ç”¨çš„ç®—æ³•åç§°ï¼Œå¯¹äº RSA-PSSï¼Œè¿™ä¸ªå±æ€§çš„å€¼åº”å½“æ˜¯ <code>&quot;RSA-PSS&quot;</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-25" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-25"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ ç°åœ¨æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦æ•°æ®ç­¾åçš„åº”ç”¨ç¨‹åºï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºéªŒè¯ã€‚ä½ å†³å®šä½¿ç”¨ RSA-PSS ç®—æ³•è¿›è¡Œæ•°å­—ç­¾åã€‚ä»¥ä¸‹æ˜¯åœ¨ Node.js ç¯å¢ƒä¸­å¦‚ä½•å®ç°è¿™ä¸€è¿‡ç¨‹çš„ä»£ç ç¤ºä¾‹ï¼š</p><p><strong>ç”Ÿæˆå¯†é’¥å¯¹ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">webcrypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> generateKeys</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKey</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // å¯†é’¥é•¿åº¦</span></span>
<span class="line"><span style="color:#88C0D0;">      publicExponent</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      hash</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SHA-256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#81A1C1;">    true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ˜¯å¦å¯å¯¼å‡º</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">verify</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#616E88;">// å¯†é’¥ç”¨é€”</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> keyPair</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰§è¡Œç­¾åï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> signData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç›å€¼é•¿åº¦</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ¥è‡ªgenerateKeyså‡½æ•°çš„ç§é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // å¾…ç­¾åçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>éªŒè¯ç­¾åï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> verifySignature</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> subtle</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA-PSS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      saltLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // è¿™é‡Œçš„ç›å€¼é•¿åº¦éœ€ä¸ç­¾åæ—¶ç›¸åŒ</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#D8DEE9;">    publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // æ¥è‡ªgenerateKeyså‡½æ•°çš„å…¬é’¥</span></span>
<span class="line"><span style="color:#D8DEE9;">    signature</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // ç­¾å</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#616E88;"> // åŸå§‹æ•°æ®</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> isValid</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>rsaPssParams</code>å¯¹è±¡è¢«ç”¨åœ¨<code>sign</code>å’Œ<code>verify</code>æ–¹æ³•ä¸­æŒ‡å®šç®—æ³•ç›¸å…³çš„å‚æ•°ï¼Œä¾‹å¦‚<code>name</code>å±æ€§æŒ‡å‘ <code>&quot;RSA-PSS&quot;</code>ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ RSA PSS ç®—æ³•ã€‚æ­¤å¤–ï¼Œ<code>saltLength</code>å®šä¹‰äº†ç›å€¼çš„é•¿åº¦ï¼Œè¿™æ˜¯ RSA-PSS ç®—æ³•ç‰¹æœ‰çš„å‚æ•°ï¼Œç”¨äºå¢åŠ ç­¾åçš„å®‰å…¨æ€§ã€‚</p><p>è¿™æ ·ï¼Œé€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œä½ å°±å¯ä»¥åœ¨åº”ç”¨ä¸­å®ç°æ•°æ®çš„å®‰å…¨ç­¾åå’ŒéªŒè¯äº†ï¼Œè¿›ä¸€æ­¥ä¿è¯æ•°æ®äº¤æ¢çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚</p><h4 id="rsapssparams-saltlength" tabindex="-1"><a class="header-anchor" href="#rsapssparams-saltlength"><span><a href="https://nodejs.org/docs/latest/api/webcrypto.html#rsapssparamssaltlength" target="_blank" rel="noopener noreferrer">rsaPssParams.saltLength</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨é€»è¾‘ï¼Œè¿™å¯¹äºé‚£äº›å·²ç»ç†Ÿæ‚‰ JavaScript çš„å‰ç«¯å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ã€‚</p><p><code>rsaPssParams.saltLength</code> æ˜¯ Node.js ä¸­ä¸ Web Crypto API ç›¸å…³çš„ä¸€ä¸ªå±æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ RSA-PSS ï¼ˆRSA Probabilistic Signature Schemeï¼‰ç®—æ³•è¿›è¡ŒåŠ å¯†æˆ–ç­¾åæ—¶ã€‚è¦ç†è§£ <code>rsaPssParams.saltLength</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-12" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-12"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><h4 id="rsa-pss" tabindex="-1"><a class="header-anchor" href="#rsa-pss"><span>RSA-PSS</span></a></h4><p>RSA-PSS æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†æ–¹æ¡ˆï¼Œå¸¸ç”¨äºæ•°æ®çš„ç­¾åå’ŒéªŒè¯ã€‚ä¸ä¼ ç»Ÿçš„ RSA ç­¾åç›¸æ¯”ï¼Œå®ƒé€šè¿‡å¼•å…¥éšæœºæ€§æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ï¼Œä½¿å¾—å³ä½¿æ˜¯å…·æœ‰ç›¸åŒå†…å®¹çš„æ¶ˆæ¯ï¼Œåœ¨æ¯æ¬¡ç­¾åæ—¶ä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„ç­¾åç»“æœã€‚</p><h4 id="ç›-salt" tabindex="-1"><a class="header-anchor" href="#ç›-salt"><span>ç›ï¼ˆSaltï¼‰</span></a></h4><p>ç›åœ¨å¯†ç å­¦ä¸­é€šå¸¸æŒ‡çš„æ˜¯ä¸€æ®µéšæœºæ•°æ®ã€‚åœ¨ä½¿ç”¨ RSA-PSS ç®—æ³•è¿›è¡Œç­¾åæ—¶ï¼Œç›è¢«æ·»åŠ åˆ°åŸå§‹æ¶ˆæ¯ä¸Šï¼Œç„¶åä¸€èµ·è¿›è¡Œå“ˆå¸Œå’ŒåŠ å¯†å¤„ç†ã€‚è¿™å¢åŠ äº†ç­¾åçš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§ï¼Œå› ä¸ºå³ä½¿ä¸¤æ¡æ¶ˆæ¯ç›¸åŒï¼Œç”±äºç›çš„éšæœºæ€§ï¼Œæœ€ç»ˆç”Ÿæˆçš„ç­¾åä¹Ÿä¼šä¸åŒã€‚</p><h3 id="rsapssparams-saltlength-1" tabindex="-1"><a class="header-anchor" href="#rsapssparams-saltlength-1"><span>rsaPssParams.saltLength</span></a></h3><p>åœ¨ Node.js çš„ Web Crypto API ä¸­ï¼Œ<code>rsaPssParams</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºæŒ‡å®š RSA-PSS æ“ä½œçš„å‚æ•°ã€‚å…¶ä¸­çš„ <code>saltLength</code> å±æ€§å®šä¹‰äº†ç›çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚è¿™ä¸ªé•¿åº¦å¯¹å®‰å…¨æ€§æœ‰é‡è¦å½±å“ï¼šè¾ƒé•¿çš„ç›å¯ä»¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†åŒæ—¶ä¹Ÿå¯èƒ½å¢åŠ è®¡ç®—æˆæœ¬ã€‚</p><h3 id="å®é™…ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-7"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦æ•°å­—ç­¾ååŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œä½ æƒ³ç¡®ä¿å‘é€ç»™ç”¨æˆ·çš„æ–‡ä»¶æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ä½ å¯ä»¥ä½¿ç”¨ RSA-PSS ç®—æ³•æ¥ç”Ÿæˆæ¯ä¸ªæ–‡ä»¶çš„ç­¾åï¼Œå¹¶åœ¨ç”¨æˆ·æ¥æ”¶æ–‡ä»¶æ—¶éªŒè¯ç­¾åã€‚</p><ol><li><p><strong>ç”Ÿæˆç­¾å</strong>ï¼š</p><ul><li>å½“ä½ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„ç­¾åæ—¶ï¼Œä½ å¯ä»¥æŒ‡å®š <code>saltLength</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ é€‰æ‹©äº† 32 å­—èŠ‚çš„ç›é•¿åº¦ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡ç­¾åæ“ä½œéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª 32 å­—èŠ‚çš„ç›ï¼Œç„¶åå°†å…¶ä¸æ–‡ä»¶å†…å®¹ä¸€èµ·è¿›è¡Œå¤„ç†ã€‚</li></ul></li><li><p><strong>éªŒè¯ç­¾å</strong>ï¼š</p><ul><li>å½“å…¶ä»–äººæ”¶åˆ°ä½ çš„æ–‡ä»¶å’Œç­¾åæ—¶ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ä½ çš„å…¬é’¥å’ŒåŒæ ·çš„ç›é•¿åº¦ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ 32 å­—èŠ‚ï¼‰æ¥éªŒè¯ç­¾åã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œè¯´æ˜æ–‡ä»¶æœªè¢«ç¯¡æ”¹ã€‚</li></ul></li></ol><h3 id="æ€»ç»“-14" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-14"><span>æ€»ç»“</span></a></h3><p><code>rsaPssParams.saltLength</code> åœ¨ Node.js çš„ Web Crypto API ä¸­å®šä¹‰äº†åœ¨ä½¿ç”¨ RSA-PSS ç­¾åæˆ–åŠ å¯†æ—¶ä½¿ç”¨çš„ç›çš„é•¿åº¦ã€‚é€‰æ‹©åˆé€‚çš„ç›é•¿åº¦æ˜¯æé«˜å®‰å…¨æ€§çš„å…³é”®ä¸€æ­¥ï¼Œä½†ä¹Ÿéœ€è¦è€ƒè™‘åˆ°è®¡ç®—æˆæœ¬ã€‚é€šè¿‡å®é™…çš„ç¤ºä¾‹ï¼Œå¦‚æ•°å­—ç­¾åçš„ç”Ÿæˆå’ŒéªŒè¯ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å®ƒåœ¨å®é™…åº”ç”¨ä¸­çš„é‡è¦æ€§ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->VM (executing JavaScript)</div></a><a class="route-link auto-link next" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Web Streams API<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.be370b10.js" defer></script><script src="/assets/js/4485.e6fe7c7b.js" defer></script><script src="/assets/js/app.bf6f64e3.js" defer></script>
  </body>
</html>
