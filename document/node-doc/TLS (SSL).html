<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/TLS%20(SSL).html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="TLS (SSL)"><meta property="og:description" content="TLS (SSL) Node.js çš„ TLS (SSL) æ¨¡å—æ˜¯ç”¨äºå®ç°ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTransport Layer Securityï¼‰çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå¸®åŠ©ä½ åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šé“ï¼Œä¿éšœæ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚è¿™å¯¹äºéœ€è¦ä¿æŠ¤æ•°æ®å…å—çªƒå¬æˆ–ç¯¡æ”¹çš„åº”ç”¨æ¥è¯´æ˜¯éå¸¸å…³é”®çš„ï¼Œæ¯”å¦‚ç½‘ä¸Šé“¶è¡Œã€ç”µå­å•†åŠ¡ç½‘ç«™æˆ–ä»»ä½•å¤„ç†æ•æ„Ÿä¿¡æ¯çš„æœåŠ¡ã€‚ åœ¨è¯¦ç»†è®²è§£..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"TLS (SSL)","description":"TLS (SSL) Node.js çš„ TLS (SSL) æ¨¡å—æ˜¯ç”¨äºå®ç°ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTransport Layer Securityï¼‰çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå¸®åŠ©ä½ åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šé“ï¼Œä¿éšœæ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚è¿™å¯¹äºéœ€è¦ä¿æŠ¤æ•°æ®å…å—çªƒå¬æˆ–ç¯¡æ”¹çš„åº”ç”¨æ¥è¯´æ˜¯éå¸¸å…³é”®çš„ï¼Œæ¯”å¦‚ç½‘ä¸Šé“¶è¡Œã€ç”µå­å•†åŠ¡ç½‘ç«™æˆ–ä»»ä½•å¤„ç†æ•æ„Ÿä¿¡æ¯çš„æœåŠ¡ã€‚ åœ¨è¯¦ç»†è®²è§£..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>TLS (SSL) | hanekawa-shiki</title><meta name="description" content="TLS (SSL) Node.js çš„ TLS (SSL) æ¨¡å—æ˜¯ç”¨äºå®ç°ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTransport Layer Securityï¼‰çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå¸®åŠ©ä½ åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šé“ï¼Œä¿éšœæ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚è¿™å¯¹äºéœ€è¦ä¿æŠ¤æ•°æ®å…å—çªƒå¬æˆ–ç¯¡æ”¹çš„åº”ç”¨æ¥è¯´æ˜¯éå¸¸å…³é”®çš„ï¼Œæ¯”å¦‚ç½‘ä¸Šé“¶è¡Œã€ç”µå­å•†åŠ¡ç½‘ç«™æˆ–ä»»ä½•å¤„ç†æ•æ„Ÿä¿¡æ¯çš„æœåŠ¡ã€‚ åœ¨è¯¦ç»†è®²è§£...">
    <link rel="stylesheet" href="/assets/css/styles.2fe8dfd0.css">
    <link rel="preload" href="/assets/js/runtime~app.b30e1963.js" as="script"><link rel="preload" href="/assets/css/styles.2fe8dfd0.css" as="style"><link rel="preload" href="/assets/js/9435.209d772b.js" as="script"><link rel="preload" href="/assets/js/app.e085f460.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-CommonJS%20modules.html" aria-label="Modules: CommonJS modules"><!---->Modules: CommonJS modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-ECMAScript%20modules.html" aria-label="Modules: ECMAScript modules"><!---->Modules: ECMAScript modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-node_module%20API.html" aria-label="Modules: node:module API"><!---->Modules: node:module API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><!---->Modules: Packages<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->TLS (SSL)</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 185 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT185M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 55540 å­—</span><meta property="wordCount" content="55540"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#determining-if-crypto-support-is-unavailable">Determining if crypto support is unavailable</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ç¡®å®šåŠ å¯†æ”¯æŒæ˜¯å¦å¯ç”¨">å¦‚ä½•ç¡®å®šåŠ å¯†æ”¯æŒæ˜¯å¦å¯ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-ssl-concepts">TLS/SSL concepts</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-ssl-æ˜¯ä»€ä¹ˆ">TLS/SSL æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-tls-ssl">Node.js ä¸­çš„ TLS/SSL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#perfect-forward-secrecy">Perfect forward secrecy</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€ç†è§£">åŸºç¡€ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å®ç°">å¦‚ä½•å®ç°ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-pfs">Node.js ä¸­çš„ PFS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#alpn-and-sni">ALPN and SNI</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#alpn-application-layer-protocol-negotiation">ALPN (Application-Layer Protocol Negotiation)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sni-server-name-indication">SNI (Server Name Indication)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pre-shared-keys">Pre-shared keys</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-psk">å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ PSK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#client-initiated-renegotiation-attack-mitigation">Client-initiated renegotiation attack mitigation</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls">ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯é‡æ–°åå•†">ä»€ä¹ˆæ˜¯é‡æ–°åå•†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»">ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„å¯¹ç­–">Node.js ä¸­çš„å¯¹ç­–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨æ¡ˆä¾‹">å®é™…è¿ç”¨æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#session-resumption">Session resumption</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-æ¡æ‰‹è¿‡ç¨‹">TLS æ¡æ‰‹è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¼šè¯æ¢å¤çš„æ¦‚å¿µ">ä¼šè¯æ¢å¤çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„ä¼šè¯æ¢å¤">Node.js ä¸­çš„ä¼šè¯æ¢å¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#session-identifiers-1">Session Identifiers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#session-tickets-ç®€ä»‹">Session Tickets ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-4">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-2">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#modifying-the-default-tls-cipher-suite">Modifying the default TLS cipher suite</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æœ¯è¯­">åŸºç¡€æœ¯è¯­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¿®æ”¹é»˜è®¤-tls-å¯†ç å¥—ä»¶">ä¿®æ”¹é»˜è®¤ TLS å¯†ç å¥—ä»¶</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#x509-certificate-error-codes">X509 certificate error codes</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-tls-cryptostream">Class: tls.CryptoStream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-cryptostream">tls.CryptoStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-1">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptostream-byteswritten">cryptoStream.bytesWritten</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cryptostream-byteswritten-1">cryptoStream.bytesWritten</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-tls-securepair">Class: tls.SecurePair</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å·¥ä½œåŸç†-1">å·¥ä½œåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£æ–¹æ¡ˆ">æ›¿ä»£æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-secure">Event: &#39;secure&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-secure-äº‹ä»¶">ä»€ä¹ˆæ˜¯ &#39;secure&#39; äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ç›‘å¬-secure-äº‹ä»¶">å¦‚ä½•ç›‘å¬ &#39;secure&#39; äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨æ¡ˆä¾‹-1">å®é™…è¿ç”¨æ¡ˆä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-tls-server">Class: tls.Server</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-ssl-æ˜¯ä»€ä¹ˆ-1">TLS/SSL æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-tls-server-1">Class: tls.Server</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ">å¦‚ä½•å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-5">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connection">Event: &#39;connection&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-1">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-connection-1">Event: &#39;connection&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨å®ä¾‹">å®é™…åº”ç”¨å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-keylog">Event: &#39;keylog&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-keylog-äº‹ä»¶">ä»€ä¹ˆæ˜¯ &#39;keylog&#39; äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ç›‘å¬-keylog-äº‹ä»¶">å¦‚ä½•ç›‘å¬ &#39;keylog&#39; äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨æ¡ˆä¾‹-2">å®é™…è¿ç”¨æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-newsession">Event: &#39;newSession&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-ç®€ä»‹">TLS ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¼šè¯-session-çš„æ¦‚å¿µ">ä¼šè¯(Session)çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-newsession-äº‹ä»¶">Node.js ä¸­çš„&#39;newSession&#39;äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-6">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-ocsprequest">Event: &#39;OCSPRequest&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ocsprequest-äº‹ä»¶">OCSPRequest äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹åº”ç”¨">å®ä¾‹åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-resumesession">Event: &#39;resumeSession&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-resumesession-1">Event: &#39;resumeSession&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-secureconnection">Event: &#39;secureConnection&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-secureconnection-1">Event: &#39;secureConnection&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-tlsclienterror">Event: &#39;tlsClientError&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-æ¨¡å—ç®€ä»‹">TLS æ¨¡å—ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶-tlsclienterror">äº‹ä»¶: &#39;tlsClientError&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-addcontext-hostname-context">server.addContext(hostname, context)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹è§£é‡Š">ç¤ºä¾‹è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-address">server.address()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¿”å›å€¼">è¿”å›å€¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-close-callback">server.close([callback])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-getticketkeys">server.getTicketKeys()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-session-tickets-ç®€ä»‹">TLS Session Tickets ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-getticketkeys-æ–¹æ³•">server.getTicketKeys() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-1">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-listen">server.listen()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-listen-1">server.listen()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-setsecurecontext-options">server.setSecureContext(options)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£server-setsecurecontext-options">ç†è§£server.setSecureContext(options)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ç¤ºä¾‹">ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-1">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-setticketkeys-keys">server.setTicketKeys(keys)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-ä¼ è¾“å±‚å®‰å…¨æ€§">TLS (ä¼ è¾“å±‚å®‰å…¨æ€§)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#session-tickets-1">Session Tickets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#server-setticketkeys-keys-1">server.setTicketKeys(keys)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-3">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-tls-tlssocket">Class: tls.TLSSocket</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ-1">å¦‚ä½•å·¥ä½œï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-4">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-tls-tlssocket-socket-options">new tls.TLSSocket(socket[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-node-js">ä»€ä¹ˆæ˜¯ Node.jsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-æ˜¯ä»€ä¹ˆ">TLS æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„tls-tlssocket">Node.js ä¸­çš„tls.TLSSocket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨new-tls-tlssocket-socket-options">ä½¿ç”¨new tls.TLSSocket(socket[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-7">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-keylog-1">Event: &#39;keylog&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-å’Œ-ssl">TLS å’Œ SSL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-keylog-äº‹ä»¶-1">ä»€ä¹ˆæ˜¯ &#39;keylog&#39; äº‹ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-ocspresponse">Event: &#39;OCSPResponse&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ocspresponse-äº‹ä»¶">OCSPResponse äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-secureconnect">Event: &#39;secureConnect&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-node-js-1">ä»€ä¹ˆæ˜¯ Node.jsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-1">ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#secureconnect-äº‹ä»¶">secureConnect äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-session">Event: &#39;session&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-address">tlsSocket.address()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€è§£é‡Š">åŸºç¡€è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-8">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-authorizationerror">tlsSocket.authorizationError</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-authorizationerror-1">tlsSocket.authorizationError</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-authorized">tlsSocket.authorized</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-authorized-1">tlsSocket.authorized</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-disablerenegotiation">tlsSocket.disableRenegotiation()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-é‡åå•†">ä»€ä¹ˆæ˜¯ TLS é‡åå•†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-disablerenegotiation-1">tlsSocket.disableRenegotiation()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-enabletrace">tlsSocket.enableTrace()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-2">ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tlssocket">ä»€ä¹ˆæ˜¯ TLSSocketï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-enabletrace-æ–¹æ³•çš„ä½œç”¨">tlsSocket.enableTrace() æ–¹æ³•çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-encrypted">tlsSocket.encrypted</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-encrypted-å±æ€§">tlsSocket.encrypted å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-2">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-exportkeyingmaterial-length-label-context">tlsSocket.exportKeyingMaterial(length, label[, context])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŠŸèƒ½ä»‹ç»">åŠŸèƒ½ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-3">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-2">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getcertificate">tlsSocket.getCertificate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getcertificate-æ–¹æ³•çš„ä½œç”¨">tlsSocket.getCertificate()æ–¹æ³•çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getcipher">tlsSocket.getCipher()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•-1">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-4">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getephemeralkeyinfo">tlsSocket.getEphemeralKeyInfo()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-å’Œ-ephemeral-key">ä»€ä¹ˆæ˜¯ TLS å’Œ Ephemeral Keyï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getephemeralkeyinfo-æ–¹æ³•">tlsSocket.getEphemeralKeyInfo() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getfinished">tlsSocket.getFinished()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getfinished-1">tlsSocket.getFinished()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getpeercertificate-detailed">tlsSocket.getPeerCertificate([detailed])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getpeercertificate-detailed-1">tlsSocket.getPeerCertificate([detailed])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-ssl-è¯ä¹¦">ä»€ä¹ˆæ˜¯ TLS/SSL è¯ä¹¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#certificate-å¯¹è±¡åŒ…å«å“ªäº›ä¿¡æ¯">Certificate å¯¹è±¡åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-5">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getpeerfinished">tlsSocket.getPeerFinished()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-æ˜¯ä»€ä¹ˆ-1">TLS æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-æ¡æ‰‹">TLS æ¡æ‰‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getpeerfinished-çš„ä½œç”¨">tlsSocket.getPeerFinished() çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-6">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getpeerx509certificate">tlsSocket.getPeerX509Certificate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getpeerx509certificate-1">tlsSocket.getPeerX509Certificate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getprotocol">tlsSocket.getProtocol()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•å·¥ä½œ-2">å¦‚ä½•å·¥ä½œï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7">å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -3">ç¤ºä¾‹ä»£ç ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getsession">tlsSocket.getSession()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-ç®€ä»‹-1">TLS ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getsession-1">tlsSocket.getSession()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getsharedsigalgs">tlsSocket.getSharedSigalgs()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getsharedsigalgs-1">tlsSocket.getSharedSigalgs()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-gettlsticket">tlsSocket.getTLSTicket()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-ä¼ è¾“å±‚å®‰å…¨åè®®">TLS (ä¼ è¾“å±‚å®‰å…¨åè®®)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-session-ticket">TLS Session Ticket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-tlssocket-gettlsticket">Node.js ä¸­çš„ tlsSocket.getTLSTicket()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-getx509certificate">tlsSocket.getX509Certificate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-getx509certificate">ç†è§£ getX509Certificate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-3">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-issessionreused">tlsSocket.isSessionReused()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-æ˜¯ä»€ä¹ˆ-2">TLS æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-ä¼šè¯é‡ç”¨">ä»€ä¹ˆæ˜¯ TLS ä¼šè¯é‡ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-issessionreused-çš„ä½œç”¨">tlsSocket.isSessionReused()çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-localaddress">tlsSocket.localAddress</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-localaddress-1">tlsSocket.localAddress</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-localport">tlsSocket.localPort</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-localport-1">tlsSocket.localPort</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-remoteaddress">tlsSocket.remoteAddress</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-3">ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tlssocket-1">ä»€ä¹ˆæ˜¯ tlsSocketï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-remoteaddress-1">tlsSocket.remoteAddress</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€æ ·ä½¿ç”¨-tlssocket-remoteaddress">æ€æ ·ä½¿ç”¨ tlsSocket.remoteAddressï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-1">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-remotefamily">tlsSocket.remoteFamily</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-3">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-remoteport">tlsSocket.remotePort</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-9">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-renegotiate-options-callback">tlsSocket.renegotiate(options, callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-2">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-renegotiate-options-callback-1">tlsSocket.renegotiate(options, callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-7">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨æ³¨æ„">ä½¿ç”¨æ³¨æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tlssocket-setmaxsendfragment-size">tlsSocket.setMaxSendFragment(size)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-tls-å’Œ-tls-socket">ç†è§£ TLS å’Œ TLS Socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³äº-tlssocket-setmaxsendfragment-size">å…³äº tlsSocket.setMaxSendFragment(size)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä½¿ç”¨ç¤ºä¾‹">å®é™…ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-checkserveridentity-hostname-cert">tls.checkServerIdentity(hostname, cert)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-checkserveridentity-hostname-cert-ç®€ä»‹">tls.checkServerIdentity(hostname, cert) ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆé‡è¦-2">ä¸ºä»€ä¹ˆé‡è¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-4">å®é™…ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-connect-options-callback">tls.connect(options[, callback])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-5">å®é™…ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-connect-path-options-callback">tls.connect(path[, options][, callback])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-connect-port-host-options-callback">tls.connect(port[, host][, options][, callback])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬è¯­æ³•-1">åŸºæœ¬è¯­æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-10">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-4">å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-createsecurecontext-options">tls.createSecureContext([options])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-3">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-createsecurecontext-options-1">tls.createSecureContext([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-8">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-6">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-createsecurepair-context-isserver-requestcert-rejectunauthorized-options">tls.createSecurePair([context][, isServer][, requestCert][, rejectUnauthorized][, options])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-createsecurepair-çš„åŠŸèƒ½">tls.createSecurePair çš„åŠŸèƒ½</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è¯­">ç»“è¯­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-createserver-options-secureconnectionlistener">tls.createServer([options][, secureConnectionListener])</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•è§£é‡Š">ç®€å•è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-1">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-getciphers">tls.getCiphers()</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-getciphers-æ–¹æ³•">tls.getCiphers() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-11">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-rootcertificates">tls.rootCertificates</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€è¦ä»‹ç»-tls-å’Œè¯ä¹¦">ç®€è¦ä»‹ç» TLS å’Œè¯ä¹¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-rootcertificates-1">tls.rootCertificates</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-default-ecdh-curve">tls.DEFAULT_ECDH_CURVE</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-åè®®">TLS åè®®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdh-ç®—æ³•">ECDH ç®—æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-default-ecdh-curve-1">tls.DEFAULT_ECDH_CURVE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-12">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-default-max-version">tls.DEFAULT_MAX_VERSION</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-4">ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-default-max-version-çš„å«ä¹‰">tls.DEFAULT_MAX_VERSION çš„å«ä¹‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦è®¾ç½®-tls-default-max-version">ä¸ºä»€ä¹ˆè¦è®¾ç½® tls.DEFAULT_MAX_VERSION?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-9">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-default-min-version">tls.DEFAULT_MIN_VERSION</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®æœ€å°-tls-ç‰ˆæœ¬">ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®æœ€å° TLS ç‰ˆæœ¬ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-tls-default-min-version">å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ tls.DEFAULT_MIN_VERSIONï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-9">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tls-default-ciphers">tls.DEFAULT_CIPHERS</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-tls-5">ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-cipher-suites">ä»€ä¹ˆæ˜¯ Cipher Suitesï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„tls-default-ciphers">Node.js ä¸­çš„tls.DEFAULT_CIPHERS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-10">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-4">ç»“è®º</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="tls-ssl" tabindex="-1"><a class="header-anchor" href="#tls-ssl"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tls-ssl" target="_blank" rel="noopener noreferrer">TLS (SSL)</a></span></a></h1><p>Node.js çš„ TLS (SSL) æ¨¡å—æ˜¯ç”¨äºå®ç°ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTransport Layer Securityï¼‰çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå¸®åŠ©ä½ åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šé“ï¼Œä¿éšœæ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚è¿™å¯¹äºéœ€è¦ä¿æŠ¤æ•°æ®å…å—çªƒå¬æˆ–ç¯¡æ”¹çš„åº”ç”¨æ¥è¯´æ˜¯éå¸¸å…³é”®çš„ï¼Œæ¯”å¦‚ç½‘ä¸Šé“¶è¡Œã€ç”µå­å•†åŠ¡ç½‘ç«™æˆ–ä»»ä½•å¤„ç†æ•æ„Ÿä¿¡æ¯çš„æœåŠ¡ã€‚</p><p>åœ¨è¯¦ç»†è®²è§£å‰ï¼Œå…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>TLS (Transport Layer Security)</strong>: æ˜¯ä¸€ä¸ªåè®®ï¼Œç”¨äºåœ¨ç½‘ç»œä¸­å®ç°åŠ å¯†é€šä¿¡ã€‚</li><li><strong>SSL (Secure Sockets Layer)</strong>: TLS çš„å‰èº«ï¼Œç°åœ¨å·²ç»ä¸å†å®‰å…¨ï¼Œå› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä½¿ç”¨ TLSã€‚</li><li><strong>è¯ä¹¦ (Certificate)</strong>: ç”¨äºèº«ä»½éªŒè¯ï¼Œè¯æ˜æœåŠ¡å™¨å°±æ˜¯å®ƒå£°ç§°çš„æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</li></ol><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºä¸€ä¸ª-https-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ª-https-æœåŠ¡å™¨"><span>1. åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨</span></a></h4><p>åœ¨ Web å¼€å‘ä¸­ï¼Œåˆ›å»º HTTPS æœåŠ¡å™¨å¯èƒ½æ˜¯ TLS æ¨¡å—æœ€ç›´æ¥çš„åº”ç”¨ä¹‹ä¸€ã€‚HTTPS ç›¸è¾ƒäº HTTPï¼Œå¢åŠ äº†æ•°æ®åŠ å¯†ï¼Œæ›´å®‰å…¨ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªåŸºç¡€çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//Das Dokument stammt von Ying Chao Tea. Nicht fÃ¼r kommerzielle Zwecke verwenden.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–å¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºHTTPSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at https://localhost:8000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªç§é’¥(<code>your-key.pem</code>)å’Œä¸€ä¸ªè¯ä¹¦(<code>your-cert.pem</code>)ã€‚è¿™äº›æ˜¯é€šè¿‡ä¸€å®šçš„ç¨‹åºè·å¾—æˆ–è€…å‘è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç”³è¯·è·å¾—ã€‚</p><h4 id="_2-åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#_2-åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“"><span>2. åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“</span></a></h4><p>å¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨é€šä¿¡çš„åº”ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦åŠ å¯†è¿™äº›ä¼ è¾“çš„æ¶ˆæ¯ã€‚ä½¿ç”¨ Node.js çš„ TLS æ¨¡å—ï¼Œä½ å¯ä»¥ç¡®ä¿è¿™äº›æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«åŠ å¯†ï¼Œé¿å…æœªæˆæƒçš„è®¿é—®ã€‚</p><h4 id="_3-å®‰å…¨åœ°è¿æ¥åˆ°æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#_3-å®‰å…¨åœ°è¿æ¥åˆ°æ•°æ®åº“"><span>3. å®‰å…¨åœ°è¿æ¥åˆ°æ•°æ®åº“</span></a></h4><p>å½“ä½ çš„åº”ç”¨éœ€è¦ä¸æ•°æ®åº“é€šä¿¡æ—¶ï¼ˆç‰¹åˆ«æ˜¯å½“æ•°æ®åº“æœåŠ¡æ‰˜ç®¡åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ—¶ï¼‰ï¼Œä½¿ç”¨ TLS å¯ä»¥ä¿è¯ä½ çš„æ•°æ®åº“æŸ¥è¯¢å’Œæ›´æ–°æ“ä½œä¸ä¼šè¢«ç›‘å¬æˆ–ç¯¡æ”¹ã€‚</p><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p>Node.js çš„ TLS æ¨¡å—æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œä½¿å¾—æ•°æ®èƒ½å¤Ÿåœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸­å®‰å…¨ä¼ è¾“ã€‚æ— è®ºæ˜¯åˆ›å»º HTTPS æœåŠ¡å™¨ï¼Œè¿˜æ˜¯ç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´æˆ–ä¸æ•°æ®åº“ä¹‹é—´çš„é€šä¿¡å®‰å…¨ï¼ŒTLS éƒ½æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„ç»„ä»¶ã€‚é€šè¿‡ä½¿ç”¨ TLSï¼Œä½ å¯ä»¥ä¸ºä½ çš„ç”¨æˆ·æä¾›æ›´å®‰å…¨çš„ç½‘ç»œä½“éªŒï¼Œä¿æŠ¤ä»–ä»¬çš„æ•°æ®å…å—æ³„éœ²å’Œå…¶ä»–å®‰å…¨å¨èƒã€‚</p><h2 id="determining-if-crypto-support-is-unavailable" tabindex="-1"><a class="header-anchor" href="#determining-if-crypto-support-is-unavailable"><span><a href="https://nodejs.org/docs/latest/api/tls.html#determining-if-crypto-support-is-unavailable" target="_blank" rel="noopener noreferrer">Determining if crypto support is unavailable</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js æä¾›äº†å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œå…¶ä¸­ <code>crypto</code> æ¨¡å—ç”¨äºåŠ å¯†è§£å¯†æ•°æ®ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºæ”¿ç­–æˆ–å…¶ä»–åŸå› ï¼ŒNode.js å¯èƒ½æ˜¯åœ¨æ²¡æœ‰åŠ å¯†ï¼ˆcryptoï¼‰æ”¯æŒçš„æƒ…å†µä¸‹ç¼–è¯‘çš„ã€‚è¿™æ„å‘³ç€æ‰€æœ‰ä¾èµ–äº <code>crypto</code> æ¨¡å—çš„åŠŸèƒ½éƒ½å°†ä¸å¯ç”¨ã€‚äº†è§£ä½ çš„ Node.js ç¯å¢ƒæ˜¯å¦æ”¯æŒåŠ å¯†æ˜¯éå¸¸é‡è¦çš„ï¼Œå°¤å…¶æ˜¯åœ¨å¼€å‘éœ€è¦åŠ å¯†å¤„ç†çš„åº”ç”¨æ—¶ã€‚</p><h3 id="å¦‚ä½•ç¡®å®šåŠ å¯†æ”¯æŒæ˜¯å¦å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç¡®å®šåŠ å¯†æ”¯æŒæ˜¯å¦å¯ç”¨"><span>å¦‚ä½•ç¡®å®šåŠ å¯†æ”¯æŒæ˜¯å¦å¯ç”¨</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥æ£€æŸ¥ä½ çš„ç¯å¢ƒæ˜¯å¦æ”¯æŒ <code>crypto</code>ï¼š</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å¯¼å…¥ <code>tls</code> æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯ä»¥é€šè¿‡æ£€æŸ¥ <code>tls.getCiphers()</code> æ–¹æ³•çš„è¿”å›å€¼æ¥åˆ¤æ–­ <code>crypto</code> æ”¯æŒæ˜¯å¦å¯ç”¨ã€‚å¦‚æœç¯å¢ƒæ”¯æŒåŠ å¯†ï¼Œ<code>tls.getCiphers()</code> å°†è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯ç”¨å¯†ç å¥—ä»¶åç§°çš„æ•°ç»„ã€‚å¦‚æœä¸æ”¯æŒåŠ å¯†ï¼Œå®ƒå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cryptoSupport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> ciphers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCiphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœä¸Šè¿°ä»£ç æ‰§è¡Œæ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼Œåˆ™è¡¨ç¤ºåŠ å¯†æ”¯æŒå¯ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cryptoSupport</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœæŠ›å‡ºé”™è¯¯ï¼Œåˆ™è¡¨ç¤ºåŠ å¯†æ”¯æŒä¸å¯ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cryptoSupport</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Crypto support is available: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cryptoSupport</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><ol><li><p><strong>ç½‘ç«™æœåŠ¡å™¨</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å¤„ç†ç”¨æˆ·ä¿¡æ¯çš„ç½‘ç«™ï¼Œä½¿ç”¨ HTTPS åŠ å¯†æ˜¯å¿…é¡»çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¡®è®¤ Node.js ç¯å¢ƒæ”¯æŒ <code>crypto</code> æ˜¯ç¬¬ä¸€æ­¥ï¼Œä»¥ç¡®ä¿ä½ å¯ä»¥å®‰å…¨åœ°å¤„ç†å’Œä¼ è¾“ç”¨æˆ·æ•°æ®ã€‚</p></li><li><p><strong>æ•°å­—ç­¾ååº”ç”¨</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨æ¶‰åŠåˆ°ç”Ÿæˆå’ŒéªŒè¯æ•°å­—ç­¾åï¼ˆæ¯”å¦‚ï¼Œåœ¨åŒºå—é“¾æŠ€æœ¯ä¸­å¸¸è§ï¼‰ï¼Œé‚£ä¹ˆ <code>crypto</code> æ¨¡å—çš„æ”¯æŒåŒæ ·è‡³å…³é‡è¦ã€‚æ²¡æœ‰åŠ å¯†æ”¯æŒï¼Œè¿™ç±»åº”ç”¨æ— æ³•å®ç°å…¶æ ¸å¿ƒåŠŸèƒ½ã€‚</p></li><li><p><strong>åŠ å¯†å­˜å‚¨</strong>ï¼šå¯¹äºéœ€è¦åŠ å¯†å­˜å‚¨ç”¨æˆ·æ•°æ®çš„åº”ç”¨ï¼ˆä¾‹å¦‚ï¼Œå¯†ç ç®¡ç†å™¨ï¼‰ï¼Œæ£€æµ‹åŠ å¯†æ”¯æŒåŒæ ·æ˜¯å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚ä¸ä»…éœ€è¦åŠ å¯†æ•°æ®æ¥ä¿æŠ¤éšç§ï¼Œè¿˜éœ€è¦åœ¨è¯»å–æ•°æ®æ—¶è§£å¯†ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œäº†è§£ä½ çš„ Node.js ç¯å¢ƒæ˜¯å¦æ”¯æŒåŠ å¯†ï¼Œå¯¹äºå¼€å‘ä»»ä½•éœ€è¦æ•°æ®åŠ å¯†ã€å®‰å…¨ä¼ è¾“æˆ–èº«ä»½éªŒè¯çš„åº”ç”¨æ¥è¯´ï¼Œéƒ½æ˜¯ä¸€ä¸ªåŸºæœ¬è€Œä¸”é‡è¦çš„æ­¥éª¤ã€‚</p><h2 id="tls-ssl-concepts" tabindex="-1"><a class="header-anchor" href="#tls-ssl-concepts"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsssl-concepts" target="_blank" rel="noopener noreferrer">TLS/SSL concepts</a></span></a></h2><p>å½“ä½ åœ¨ç½‘ä¸Šæµè§ˆæ—¶ï¼Œå®‰å…¨æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ã€‚è¿™å°±æ˜¯ TLS/SSL å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ï¼Œåœ¨ Node.js ä¸­ä¹Ÿä¸ä¾‹å¤–ã€‚æˆ‘ä»¬å°†é€šè¿‡ä¸€äº›ç®€å•çš„æ¦‚å¿µå’Œå®é™…åº”ç”¨æ¥äº†è§£å®ƒä»¬ã€‚</p><h3 id="tls-ssl-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#tls-ssl-æ˜¯ä»€ä¹ˆ"><span>TLS/SSL æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>TLS (ä¼ è¾“å±‚å®‰å…¨) å’Œ SSL (å®‰å…¨å¥—æ¥å­—å±‚) æ˜¯åŠ å¯†åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šå®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚è™½ç„¶ SSL è¾ƒæ—©å‡ºç°ï¼Œä½†ç°åœ¨å·²ç»è¢«å…¶ç»§ä»»è€… TLS æ‰€å–ä»£ã€‚ç„¶è€Œï¼Œâ€œSSLâ€è¿™ä¸ªè¯ä»ç„¶å¹¿æ³›ä½¿ç”¨ã€‚</p><p>è¿™äº›åè®®ä¿æŠ¤æ•°æ®ä¼ è¾“ä¸è¢«çªƒå¬æˆ–ç¯¡æ”¹ï¼Œç¡®ä¿ä½ ä¸ç½‘ç«™ä¹‹é—´çš„é€šä¿¡æ˜¯ç§å¯†å’Œæ•´ä½“çš„ã€‚å½“ä½ çœ‹åˆ°æµè§ˆå™¨åœ°å€æ ä¸­çš„å°é”å›¾æ ‡æ—¶ï¼Œå°±è¡¨ç¤ºä½ çš„è¿æ¥æ˜¯é€šè¿‡ TLS/SSL åŠ å¯†çš„ã€‚</p><h3 id="node-js-ä¸­çš„-tls-ssl" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-tls-ssl"><span>Node.js ä¸­çš„ TLS/SSL</span></a></h3><p>Node.js ä½¿ç”¨ <code>tls</code> æ¨¡å—æä¾›äº† TLS/SSL çš„æ”¯æŒï¼Œè®©ä½ å¯ä»¥åˆ›å»ºåŠ å¯†çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œä¿éšœæ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><ol><li><p><strong>å»ºç«‹ä¸€ä¸ªåŸºæœ¬çš„ HTTPS æœåŠ¡å™¨</strong></p><p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ web æœåŠ¡å™¨ï¼Œä½ éœ€è¦ TLS/SSL è¯ä¹¦ã€‚å¯¹äºæµ‹è¯•ç›®çš„ï¼Œå¯ä»¥è‡ªå·±ç”Ÿæˆä¸€ä¸ªï¼ˆç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥ä½¿ç”¨ç”±è®¤è¯æœºæ„é¢å‘çš„è¯ä¹¦ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½ çš„ç§é’¥è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½ çš„è¯ä¹¦è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at https://localhost:8000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å¯åŠ¨äº†ä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œå½“ä½ è®¿é—® <a href="https://localhost:8000" target="_blank" rel="noopener noreferrer">https://localhost:8000</a> æ—¶ï¼Œä½ çš„æµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸€ä¸ªå®‰å…¨çš„è¿æ¥æç¤ºã€‚</p></li><li><p><strong>åˆ›å»ºä¸€ä¸ª TLS å®¢æˆ·ç«¯</strong></p><p>å‡è®¾ä½ æƒ³å®‰å…¨åœ°è¿æ¥åˆ°ä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>tls</code>æ¨¡å—åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // éœ€è¦æ ¹æ®æœåŠ¡å™¨è¦æ±‚å†³å®šæ˜¯å¦å¿½ç•¥è¯ä¹¦éªŒè¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  rejectUnauthorized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Client disconnected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ª TLS å®¢æˆ·ç«¯ï¼Œå°è¯•è¿æ¥åˆ°æœ¬åœ°ä¸»æœºçš„ 8000 ç«¯å£ï¼Œå¹¶ä¸”å°†ä»»ä½•è¾“å…¥çš„æ–‡å­—å‘é€åˆ°æœåŠ¡å™¨ã€‚å¦‚æœæˆåŠŸè¿æ¥å¹¶è®¤è¯ï¼Œä½ å°†èƒ½å¤Ÿçœ‹åˆ°ä»æœåŠ¡å™¨æ”¶åˆ°çš„å“åº”ã€‚</p></li></ol><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls</code>å’Œ<code>https</code>æ¨¡å—ä½¿å¾—åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ TLS/SSL å˜å¾—ç®€å•ã€‚æ— è®ºæ˜¯æ„å»ºå®‰å…¨çš„ Web æœåŠ¡è¿˜æ˜¯å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œéƒ½èƒ½ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚é€šè¿‡ä»¥ä¸Šç¤ºä¾‹ï¼Œå¸Œæœ›ä½ èƒ½æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨ Node.js é¡¹ç›®ä¸­å®é™…åº”ç”¨ TLS/SSL æ¦‚å¿µã€‚</p><h3 id="perfect-forward-secrecy" tabindex="-1"><a class="header-anchor" href="#perfect-forward-secrecy"><span><a href="https://nodejs.org/docs/latest/api/tls.html#perfect-forward-secrecy" target="_blank" rel="noopener noreferrer">Perfect forward secrecy</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä»€ä¹ˆæ˜¯ Perfect Forward Secrecy (PFS)ï¼Œå¹¶ä¸”çœ‹çœ‹å®ƒå¦‚ä½•åœ¨ Node.js ä¸­åº”ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ v21.7.1 ç‰ˆæœ¬ã€‚</p><h3 id="åŸºç¡€ç†è§£" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ç†è§£"><span>åŸºç¡€ç†è§£</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ‰“ç ´è¿™ä¸ªæœ¯è¯­â€œPerfect Forward Secrecyâ€ï¼š</p><ul><li><strong>Perfect</strong> ä»£è¡¨çš„æ˜¯ç†æƒ³çŠ¶æ€ï¼Œå³æœ€é«˜çº§åˆ«çš„å®‰å…¨æ€§ã€‚</li><li><strong>Forward</strong> æŒ‡çš„æ˜¯å°†æ¥çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»Šå¤©çš„åŠ å¯†é€šä¿¡ï¼Œæœªæ¥ä¹Ÿèƒ½ä¿æŒå®‰å…¨ã€‚</li><li><strong>Secrecy</strong> å°±æ˜¯ç§˜å¯†æˆ–è€…éšç§ï¼ŒæŒ‡çš„æ˜¯é€šä¿¡çš„å†…å®¹ä¿æŒåªæœ‰é€šä¿¡åŒæ–¹çŸ¥é“ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œ<strong>Perfect Forward Secrecy</strong> æ˜¯ä¸€ç§åŠ å¯†åè®®è®¾è®¡çš„å±æ€§ï¼Œç¡®ä¿å³ä½¿æœªæ¥æŸä¸€æ—¶åˆ»æœåŠ¡å™¨çš„ç§é’¥ï¼ˆé•¿æœŸå¯†é’¥ï¼‰è¢«æ³„éœ²ï¼Œä¹‹å‰çš„é€šä¿¡å†…å®¹ä¹Ÿä¸ä¼šè¢«è§£å¯†å‡ºæ¥ã€‚æ¢å¥è¯è¯´ï¼Œæ¯æ¬¡é€šä¿¡éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ã€ä¸´æ—¶çš„å¯†é’¥æ¥åŠ å¯†ä¿¡æ¯ï¼Œå³ä¾¿æ”»å‡»è€…å¾—åˆ°äº†æœåŠ¡å™¨çš„ä¸»å¯†é’¥ï¼Œä¹Ÿæ— æ³•è§£å¯†ä»¥å¾€çš„é€šä¿¡è®°å½•ã€‚</p><h3 id="å¦‚ä½•å®ç°" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å®ç°"><span>å¦‚ä½•å®ç°ï¼Ÿ</span></a></h3><p>åœ¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰ä¸­å®ç° PFS é€šå¸¸éœ€è¦ä½¿ç”¨ç‰¹å®šçš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œä¾‹å¦‚ Ephemeral Diffie-Hellmanï¼ˆDHEï¼‰æˆ– Ephemeral Elliptic Curve Diffie-Hellmanï¼ˆECDHEï¼‰ã€‚è¿™äº›ç®—æ³•å¯ä»¥ä¸ºæ¯æ¬¡è¿æ¥ç”Ÿæˆç‹¬ä¸€æ— äºŒçš„ä¸´æ—¶å¯†é’¥å¯¹ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼Œä»…ç”¨äºæœ¬æ¬¡ä¼šè¯ï¼Œå®Œåå³å¼ƒç”¨ã€‚</p><h3 id="node-js-ä¸­çš„-pfs" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-pfs"><span>Node.js ä¸­çš„ PFS</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ TLS æ¨¡å—å»ºç«‹å®‰å…¨çš„ç½‘ç»œè¿æ¥æ—¶ï¼ˆæ¯”å¦‚ https æœåŠ¡å™¨ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡é€‰æ‹©åˆé€‚çš„å¯†ç å¥—ä»¶æ¥å¯ç”¨ PFSã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨åˆ›å»º HTTPS æœåŠ¡å™¨æ—¶ä½¿ç”¨äº† ECDHE ç®—æ³•çš„å¯†ç å¥—ä»¶ï¼Œé‚£ä¹ˆä½ å°±å®ç°äº† Perfect Forward Secrecyã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨çš„è¯ä¹¦å’Œç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç¡®ä¿ä½¿ç”¨æ”¯æŒPFSçš„å¯†ç å¥—ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ECDHE-RSA-AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºHTTPSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ï¼Œå®¢æˆ·é€šè¿‡ç½‘ç«™æäº¤ä»–ä»¬çš„ä¿¡ç”¨å¡ä¿¡æ¯ã€‚ä½¿ç”¨æ”¯æŒ PFS çš„ TLS åè®®ï¼Œå³ä½¿åœ¨æœªæ¥æŸä¸ªæ—¶åˆ»ä½ çš„æœåŠ¡å™¨è¢«é»‘å®¢æ”»ç ´ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šçš„ç§é’¥è¢«æ³„éœ²ï¼Œä¹‹å‰çš„äº¤æ˜“ä¿¡æ¯ï¼ˆä¾‹å¦‚ä¿¡ç”¨å¡æ•°æ®ï¼‰ç”±äºæ¯æ¬¡é€šä¿¡éƒ½ä½¿ç”¨äº†å”¯ä¸€çš„ä¸€æ¬¡æ€§å¯†é’¥å¯¹åŠ å¯†ï¼Œå› æ­¤ä¾ç„¶æ˜¯å®‰å…¨çš„ï¼Œé»‘å®¢æ— æ³•åˆ©ç”¨æ³„éœ²çš„ä¸»å¯†é’¥è§£å¯†è¿‡å»çš„äº¤æ˜“ä¿¡æ¯ã€‚</p><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h3><p>Perfect Forward Secrecy æ˜¯ä¸€ç§é‡è¦çš„å®‰å…¨æœºåˆ¶ï¼Œå¯ä»¥å¤§å¤§å¢å¼ºé€šä¿¡çš„å®‰å…¨æ€§ã€‚é€šè¿‡åœ¨ Node.js ä¸­æ­£ç¡®é…ç½® TLS æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä¿æŠ¤ä½ çš„åº”ç”¨ä¸å—å°†æ¥å¯èƒ½å‘ç”Ÿçš„å¯†é’¥æ³„éœ²äº‹ä»¶çš„å½±å“ã€‚è¿™å¯¹äºä¿æŠ¤ç”¨æˆ·æ•°æ®ã€ç»´æŠ¤ç”¨æˆ·ä¿¡ä»»éå¸¸å…³é”®ã€‚</p><h3 id="alpn-and-sni" tabindex="-1"><a class="header-anchor" href="#alpn-and-sni"><span><a href="https://nodejs.org/docs/latest/api/tls.html#alpn-and-sni" target="_blank" rel="noopener noreferrer">ALPN and SNI</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®ºç½‘ç»œé€šä¿¡ï¼Œå°¤å…¶æ˜¯åœ¨å®‰å…¨ä¼ è¾“å±‚ï¼ˆTLSï¼‰ä¸Šæ—¶ï¼Œä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µç»å¸¸è¢«æåˆ°ï¼šALPN (Application-Layer Protocol Negotiation) å’Œ SNI (Server Name Indication)ã€‚å®ƒä»¬éƒ½æ˜¯ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­çš„å…³é”®éƒ¨åˆ†ï¼Œç”¨äºç¡®ä¿å®‰å…¨å’Œé«˜æ•ˆçš„ç½‘ç»œé€šä¿¡ã€‚è®©æˆ‘é€šè¿‡æ¯”å–»å’Œå®ä¾‹æ¥è§£é‡Šè¿™äº›æ¦‚å¿µåœ¨ Node.js ç¯å¢ƒä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œç‰¹åˆ«æ˜¯åœ¨ç‰ˆæœ¬ 21.7.1 ä¸­çš„åº”ç”¨ã€‚</p><h3 id="alpn-application-layer-protocol-negotiation" tabindex="-1"><a class="header-anchor" href="#alpn-application-layer-protocol-negotiation"><span>ALPN (Application-Layer Protocol Negotiation)</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è¿›å…¥ä¸€å®¶é¤å…å¹¶åä¸‹å‡†å¤‡ç‚¹é¤ã€‚æœåŠ¡å‘˜èµ°è¿‡æ¥ç»™ä½ ä¸€ä¸ªèœå•ï¼Œä½ ä»ä¸­é€‰æ‹©äº†ä½ æƒ³åƒçš„é£Ÿç‰©ã€‚åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼ŒALPN å…¶å®å°±åƒæ˜¯é‚£ä»½èœå•ã€‚å½“å®¢æˆ·ç«¯ï¼ˆå¦‚ä½ çš„æµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œå®ƒä»¬ä¼šé€šè¿‡ ALPN åè®®â€œäº¤æ¢èœå•â€ï¼Œå³åŒæ–¹æ”¯æŒçš„åº”ç”¨å±‚åè®®åˆ—è¡¨ï¼ˆä¾‹å¦‚ HTTP/2, HTTP/1.1, SPDY ç­‰ï¼‰ã€‚ç„¶åï¼ŒåŸºäºè¿™ä¸ªåˆ—è¡¨ï¼Œå®ƒä»¬å†³å®šä½¿ç”¨å“ªç§åè®®è¿›è¡Œé€šä¿¡ã€‚</p><p><strong>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œå¸Œæœ›åŒæ—¶æ”¯æŒ HTTP/2 å’Œ HTTP/1.1ã€‚ä½¿ç”¨ Node.js åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œä½ å¯ä»¥é…ç½®å®ƒä»¥å£°æ˜è¿™ä¸¤ç§åè®®ã€‚å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥æŸ¥çœ‹å®¢æˆ·ç«¯æ”¯æŒçš„åè®®åˆ—è¡¨ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªå…±åŒæ”¯æŒçš„åè®®è¿›è¡Œé€šä¿¡ã€‚è¿™æ ·ï¼Œä½ çš„æœåŠ¡å™¨å°±èƒ½æ›´çµæ´»åœ°ä¸ä¸åŒå®¢æˆ·ç«¯è¿›è¡Œäº’æ“ä½œï¼Œä¼˜åŒ–æ€§èƒ½å’Œå…¼å®¹æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSecureServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ALPNProtocols</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;h2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http/1.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // é€šä¿¡é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sni-server-name-indication" tabindex="-1"><a class="header-anchor" href="#sni-server-name-indication"><span>SNI (Server Name Indication)</span></a></h3><p>å†æ¬¡ä½¿ç”¨é¤é¦†çš„æ¯”å–»ï¼Œå‡è®¾æŸæ¡è¡—ä¸Šæœ‰å¾ˆå¤šå®¶ç›¸åŒè¿é”å“ç‰Œçš„é¤å…ï¼Œä½†æ¯å®¶çš„èœå•éƒ½ç¨æœ‰ä¸åŒã€‚åœ¨ä½ è¿›é—¨ä¹‹å‰ï¼Œä½ éœ€è¦å‘Šè¯‰æœåŠ¡å‘˜ä½ æƒ³å°è¯•çš„æ˜¯å“ªä¸€å®¶çš„ç‰¹è‰²èœã€‚SNI å°±èµ·åˆ°äº†è¿™æ ·çš„ä½œç”¨â€”â€”åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šå‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®ƒæ‰“ç®—è¿æ¥çš„å…·ä½“åŸŸåã€‚è¿™ä½¿å¾—æœåŠ¡å™¨ï¼ˆå¦‚æœå®ƒæ‰˜ç®¡äº†å¤šä¸ªä¸åŒçš„ç½‘ç«™ï¼‰èƒ½å¤Ÿå‘ˆç°æ­£ç¡®çš„è¯ä¹¦ï¼Œå¹¶ä¸ºè¯¥åŸŸåé…ç½®æ­£ç¡®çš„ç¯å¢ƒã€‚</p><p><strong>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</strong></p><p>å¦‚æœä½ æœ‰ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œå®ƒæ‰˜ç®¡äº†å¤šä¸ªç½‘ç«™ï¼ˆæ¯”å¦‚<code>siteA.com</code>å’Œ<code>siteB.com</code>ï¼‰ï¼Œå¹¶ä¸”ä½ å¸Œæœ›å®‰å…¨åœ°ä½¿ç”¨ HTTPS æœåŠ¡ï¼Œä½ éœ€è¦æ ¹æ®è¯·æ±‚çš„åŸŸååŠ¨æ€é€‰æ‹©ä½¿ç”¨çš„ SSL è¯ä¹¦ã€‚é€šè¿‡ SNIï¼ŒæœåŠ¡å™¨åœ¨ TLS æ¡æ‰‹é˜¶æ®µå°±èƒ½çŸ¥é“å®¢æˆ·ç«¯æƒ³è¦è®¿é—®å“ªä¸ªç½‘ç«™ï¼Œå¹¶ç›¸åº”åœ°æä¾›æ­£ç¡®çš„è¯ä¹¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  SNICallback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">domain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">domain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;siteA.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      cb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSecureContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;siteA-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">          cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;siteA-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">domain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;siteB.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      cb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSecureContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;siteB-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">          cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;siteB-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      cb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Unknown domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // é€šä¿¡é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSNI å…è®¸æœåŠ¡å™¨åœ¨åŒä¸€ IP åœ°å€ä¸Šä¸ºä¸åŒçš„åŸŸåæä¾›ä¸åŒçš„è¯ä¹¦ï¼Œä»è€Œä½¿å¤šç«™ç‚¹æ‰˜ç®¡æˆä¸ºå¯èƒ½ã€‚</p><p>æ€»ä¹‹ï¼ŒALPN å’Œ SNI åœ¨ç°ä»£ç½‘ç»œé€šä¿¡ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦é«˜æ•ˆã€å®‰å…¨é€šä¿¡çš„ Web åº”ç”¨æ¥è¯´ã€‚Node.js é€šè¿‡å†…å»ºçš„æ¨¡å—æä¾›äº†è¿™äº›åŠŸèƒ½çš„æ”¯æŒï¼Œä½¿å¾—å¼€å‘æ­¤ç±»åº”ç”¨å˜å¾—æ›´åŠ ç®€å•å’Œç›´æ¥ã€‚</p><h3 id="pre-shared-keys" tabindex="-1"><a class="header-anchor" href="#pre-shared-keys"><span><a href="https://nodejs.org/docs/latest/api/tls.html#pre-shared-keys" target="_blank" rel="noopener noreferrer">Pre-shared keys</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„â€œPre-shared keysâ€ï¼ˆPSKï¼‰æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨æ¢è®¨ä¸€ç§å®‰å…¨é€šä¿¡æ–¹æ³•ã€‚è¦ç†è§£ PSKï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¼„æ¸…æ¥š TLS åè®®çš„æ¦‚å¿µã€‚</p><p>TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨æ¥ä¿è¯äº’è”ç½‘ä¸Šçš„æ•°æ®ä¼ è¾“å®‰å…¨ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ æµè§ˆç½‘é¡µã€å‘é€ç”µå­é‚®ä»¶æˆ–è¿›è¡Œåœ¨çº¿è´­ç‰©æ—¶ï¼ŒTLS å¸®åŠ©ä¿æŠ¤ä½ çš„ä¿¡æ¯ä¸è¢«æ¶æ„ç”¨æˆ·æˆªè·å’Œç¯¡æ”¹ã€‚</p><p>PSK æ˜¯ TLS åè®®ä¸­çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå…è®¸é€šä¿¡åŒæ–¹åœ¨æ²¡æœ‰æ•°å­—è¯ä¹¦çš„æƒ…å†µä¸‹å»ºç«‹åŠ å¯†è¿æ¥ã€‚PSK å­—é¢æ„æ€æ˜¯â€œé¢„å…±äº«å¯†é’¥â€ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒæ–¹éƒ½çŸ¥é“çš„ç§˜å¯†å€¼ï¼Œç”¨äºåœ¨å¼€å§‹åŠ å¯†é€šä¿¡ä¹‹å‰éªŒè¯åŒæ–¹çš„èº«ä»½ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>ç‰©è”ç½‘è®¾å¤‡</strong>: åœ¨ç‰©è”ç½‘(IoT)è®¾å¤‡ä¸­ä½¿ç”¨ PSK ååˆ†æ™®éã€‚è€ƒè™‘åˆ°è¿™äº›è®¾å¤‡å¯èƒ½æœ‰èƒ½åŠ›æœ‰é™ï¼Œæ— æ³•æœ‰æ•ˆå¤„ç†å¤æ‚çš„æ•°å­—è¯ä¹¦ä½“ç³»ï¼ŒPSK æä¾›äº†ä¸€ç§è½»é‡çº§çš„è§£å†³æ–¹æ¡ˆã€‚è®¾å¤‡å’ŒæœåŠ¡å™¨å¯ä»¥é¢„å…ˆå…±äº«ä¸€ä¸ªå¯†é’¥ï¼Œåœ¨è®¾å¤‡å°è¯•è¿æ¥æ—¶ä½¿ç”¨è¿™ä¸ªå¯†é’¥è¿›è¡Œè®¤è¯ã€‚</p></li><li><p><strong>ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ</strong>: ä¼ä¸šå¯èƒ½æœ‰å¾ˆå¤šå†…éƒ¨åº”ç”¨éœ€è¦å®‰å…¨é€šä¿¡ï¼Œä½†åŒæ—¶å®ƒä»¬ä¸å¸Œæœ›æˆ–ä¸éœ€è¦ä½¿ç”¨å…¬å¼€çš„è¯ä¹¦ä½“ç³»ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼ŒPSK å¯ä»¥ä½œä¸ºä¸€ç§ç®€ä¾¿æ–¹æ³•ï¼Œç¡®ä¿åªæœ‰æ‹¥æœ‰é¢„å…±äº«å¯†é’¥çš„ç³»ç»Ÿä¹‹é—´å¯ä»¥ç›¸äº’é€šä¿¡ã€‚</p></li><li><p><strong>æ¸¸æˆç½‘ç»œ</strong>: åœ¨åœ¨çº¿æ¸¸æˆçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹å®‰å…¨çš„é€šä¿¡é€šé“æ—¶ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨ PSKã€‚å› ä¸ºæ¸¸æˆå¯èƒ½æ¶‰åŠå®æ—¶æ•°æ®äº¤æ¢ï¼Œæ‰€ä»¥æ•ˆç‡è‡³å…³é‡è¦ã€‚PSK å¯ä»¥åœ¨ä¿æŒè¿æ¥å®‰å…¨çš„åŒæ—¶ï¼Œå‡å°‘æ¡æ‰‹è¿‡ç¨‹çš„å¼€é”€ã€‚</p></li></ol><h3 id="å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-psk" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-psk"><span>å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ PSK</span></a></h3><p>Node.js v21.7.1 å¼•å…¥äº†å¯¹ PSK çš„æ”¯æŒï¼Œä½¿å¾—åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å®ç°åŸºäº PSK çš„ TLS è¿æ¥å˜å¾—å¯è¡Œã€‚ä»¥ä¸‹æ˜¯ç®€åŒ–çš„æ­¥éª¤ï¼š</p><ul><li><strong>æœåŠ¡å™¨ç«¯</strong>: åœ¨åˆ›å»º TLS æœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦æŒ‡å®š<code>pskCallback</code>å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†æ¥æ”¶ä¸€ä¸ªæ ‡è¯†ç¬¦å‚æ•°ï¼Œå¹¶æ ¹æ®è¿™ä¸ªæ ‡è¯†ç¬¦è¿”å›å¯¹åº”çš„é¢„å…±äº«å¯†é’¥ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  pskCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">identity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">identity</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;å®¢æˆ·ç«¯æ ‡è¯†ç¬¦&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        psk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é¢„å…±äº«å¯†é’¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        identity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨æ ‡è¯†ç¬¦&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æ— æ³•æ‰¾åˆ°åŒ¹é…çš„æ ‡è¯†ç¬¦æ—¶ï¼Œè¿”å›null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>å®¢æˆ·ç«¯</strong>: åœ¨åˆ›å»º TLS å®¢æˆ·ç«¯æ—¶ï¼Œä½ éœ€è¦æŒ‡å®š<code>psk</code>å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ç”¨äºèº«ä»½éªŒè¯çš„<code>identity</code>å’Œ<code>psk</code>ï¼ˆé¢„å…±äº«å¯†é’¥ï¼‰ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">æœåŠ¡å™¨ç«¯å£</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  psk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    identity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯æ ‡è¯†ç¬¦&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    psk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é¢„å…±äº«å¯†é’¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  checkServerIdentity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    /* ç”¨æ¥è¦†ç›–é»˜è®¤çš„æœåŠ¡å™¨èº«ä»½æ£€æŸ¥ */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå³ä½¿åœ¨æ²¡æœ‰æ•°å­—è¯ä¹¦çš„æƒ…å†µä¸‹ï¼ŒNode.js åº”ç”¨ä¹Ÿèƒ½å¤Ÿå»ºç«‹èµ·å®‰å…¨çš„é€šä¿¡é€šé“ã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºéœ€è¦ç®€å•ã€é«˜æ•ˆä¸”å®‰å…¨é€šä¿¡è§£å†³æ–¹æ¡ˆçš„åœºæ™¯ã€‚</p><h3 id="client-initiated-renegotiation-attack-mitigation" tabindex="-1"><a class="header-anchor" href="#client-initiated-renegotiation-attack-mitigation"><span><a href="https://nodejs.org/docs/latest/api/tls.html#client-initiated-renegotiation-attack-mitigation" target="_blank" rel="noopener noreferrer">Client-initiated renegotiation attack mitigation</a></span></a></h3><p>Node.js åœ¨å…¶ TLS (Transport Layer Security) æ¨¡å—ä¸­æä¾›äº†å¯¹å®‰å…¨é€šä¿¡çš„æ”¯æŒã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒå…è®¸ç½‘ç»œåº”ç”¨å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®‰å…¨é€šä¿¡ä¹Ÿå¯èƒ½é­å—å„ç§æ”»å‡»ä¹‹ä¸€ï¼Œå³å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»ï¼ˆClient-initiated renegotiation attackï¼‰ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ†è§£å¹¶è§£é‡Šå‡ ä¸ªå…³é”®ç‚¹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls"><span>ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</span></a></h3><p>TLS ä»£è¡¨ä¼ è¾“å±‚å®‰å…¨æ€§ï¼Œè¿™æ˜¯ä¸€ç§åŠ å¯†åè®®æ—¨åœ¨é€šè¿‡ç½‘ç»œå®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚æ¯å½“ä½ è®¿é—®ä¸€ä¸ªä»¥â€œhttpsâ€å¼€å§‹çš„ç½‘ç«™æ—¶ï¼Œè¯¥ç½‘ç«™ä¸ä½ çš„æµè§ˆå™¨ä¹‹é—´çš„é€šä¿¡å°±æ˜¯é€šè¿‡ TLS åŠ å¯†çš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯é‡æ–°åå•†" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯é‡æ–°åå•†"><span>ä»€ä¹ˆæ˜¯é‡æ–°åå•†ï¼Ÿ</span></a></h3><p>åœ¨ TLS è¿æ¥ä¸­ï¼Œé‡æ–°åå•†æ˜¯ä¸€ä¸ªæ­£å¸¸çš„è¿‡ç¨‹ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨å·²ç»å»ºç«‹çš„ TLS è¿æ¥ä¸Šåˆ·æ–°åŠ å¯†å‚æ•°ã€‚è¿™å¯ä»¥ç”¨äºæ›´æ–°å¯†é’¥ã€è¯·æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆå¦‚æœæœ€åˆæ²¡æœ‰è¯·æ±‚ï¼‰ï¼Œæˆ–è€…æ”¹å˜åŠ å¯†ç®—æ³•ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»"><span>ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»ï¼Ÿ</span></a></h3><p>å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»æ˜¯ä¸€ç§å®‰å…¨æ¼æ´åˆ©ç”¨æ–¹å¼ï¼Œæ”»å‡»è€…é€šè¿‡é¢‘ç¹å‘èµ·æ— æ•ˆçš„é‡æ–°åå•†è¯·æ±‚æ¥æ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œå¯¼è‡´æœåŠ¡å™¨å¤„ç†åˆæ³•è¯·æ±‚çš„èƒ½åŠ›ä¸‹é™ï¼Œç”šè‡³å¼•å‘æœåŠ¡æ‹’ç»ï¼ˆDoSï¼‰çŠ¶æ€ã€‚è¿™ç›¸å½“äºé€šè¿‡ä¸æ–­è¦æ±‚æœåŠ¡å™¨â€œé‡ç½®å’Œé‡æ–°ç¡®è®¤â€å®‰å…¨è¿æ¥æ¥è€—å°½å…¶èµ„æºã€‚</p><h3 id="node-js-ä¸­çš„å¯¹ç­–" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„å¯¹ç­–"><span>Node.js ä¸­çš„å¯¹ç­–</span></a></h3><p>åœ¨ Node.js çš„ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œé’ˆå¯¹å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»æœ‰äº†æ˜ç¡®çš„åº”å¯¹æªæ–½ã€‚Node.js é™åˆ¶äº†åœ¨å•ä¸ª TLS è¿æ¥ä¸­å®¢æˆ·ç«¯å¯ä»¥å‘èµ·é‡æ–°åå•†çš„æ¬¡æ•°ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯è¯•å›¾è¶…è¿‡è¿™ä¸ªé™åˆ¶å‘èµ·é‡æ–°åå•†ï¼ŒNode.js å°†ä¼šé˜»æ­¢è¿™äº›é¢å¤–çš„å°è¯•ï¼Œä»è€Œä¿æŠ¤æœåŠ¡å™¨ä¸å—æ­¤ç±»æ”»å‡»çš„å½±å“ã€‚</p><h3 id="å®é™…è¿ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨æ¡ˆä¾‹"><span>å®é™…è¿ç”¨æ¡ˆä¾‹</span></a></h3><ol><li><p><strong>Web æœåŠ¡å™¨</strong>ï¼šå‡è®¾ä½ è¿è¡Œä¸€ä¸ªä½¿ç”¨ Node.js çš„ HTTPS æœåŠ¡å™¨ã€‚æ­¤æ—¶ï¼Œä¸€ä¸ªæ”»å‡»è€…è¯•å›¾é€šè¿‡ä¸æ–­å‘é€é‡æ–°åå•†è¯·æ±‚æ¥å‹å®æœåŠ¡å™¨ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼ŒæœåŠ¡å™¨ä¼šè¯†åˆ«å‡ºå¼‚å¸¸å¤šçš„é‡æ–°åå•†è¯·æ±‚ï¼Œå¹¶è‡ªåŠ¨åœæ­¢æ»¡è¶³è¿™äº›è¯·æ±‚ï¼Œä¿æŒæœåŠ¡ç¨³å®šã€‚</p></li><li><p><strong>API æœåŠ¡</strong>ï¼šå¦‚æœä½ æä¾›ä¸€ä¸ªåŸºäº Node.js çš„ API æœåŠ¡ï¼Œè¯¥æœåŠ¡å¯èƒ½é¢å¯¹æ¥è‡ªäº’è”ç½‘çš„å¤§é‡è¯·æ±‚ã€‚é€šè¿‡é™åˆ¶é‡æ–°åå•†è¯·æ±‚çš„æ•°é‡ï¼ŒNode.js å¸®åŠ©ä½ çš„ API æœåŠ¡æŠµå¾¡é‚£äº›è¯•å›¾åˆ©ç”¨å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ¼æ´çš„æ”»å‡»è€…ã€‚</p></li></ol><p>æ€»ç»“æ¥è¯´ï¼ŒNode.js åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­é€šè¿‡é™åˆ¶ TLS è¿æ¥ä¸­çš„é‡æ–°åå•†æ¬¡æ•°ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªæœ‰æ•ˆçš„å·¥å…·æ¥å‡è½»å®¢æˆ·ç«¯å‘èµ·çš„é‡æ–°åå•†æ”»å‡»å¸¦æ¥çš„é£é™©ã€‚è¿™æ ·çš„æªæ–½å¯¹äºä¿éšœåŸºäº Node.js çš„ Web åº”ç”¨å’ŒæœåŠ¡çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</p><h3 id="session-resumption" tabindex="-1"><a class="header-anchor" href="#session-resumption"><span><a href="https://nodejs.org/docs/latest/api/tls.html#session-resumption" target="_blank" rel="noopener noreferrer">Session resumption</a></span></a></h3><p>Node.js ä¸­çš„ä¼šè¯æ¢å¤ï¼ˆSession resumptionï¼‰æ˜¯ä¸€ä¸ªåœ¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰ä¸­é‡è¦çš„æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§ã€‚åœ¨ç†è§£ä¼šè¯æ¢å¤ä¹‹å‰ï¼Œå…ˆéœ€è¦æ˜ç™½ TLS æ¡æ‰‹è¿‡ç¨‹ã€‚</p><h3 id="tls-æ¡æ‰‹è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#tls-æ¡æ‰‹è¿‡ç¨‹"><span>TLS æ¡æ‰‹è¿‡ç¨‹</span></a></h3><p>å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¼€å§‹ä¸€ä¸ªæ–°çš„å®‰å…¨è¿æ¥æ—¶ï¼Œå®ƒä»¬ä¼šè¿›è¡Œä¸€ç³»åˆ—çš„äº¤äº’ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º&quot;TLS æ¡æ‰‹&quot;ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹ä¼šåå•†åŠ å¯†ç®—æ³•ï¼Œäº¤æ¢å¯†é’¥ææ–™ï¼Œå¹¶éªŒè¯å½¼æ­¤çš„èº«ä»½ã€‚è¿™ä¸ªè¿‡ç¨‹è™½ç„¶å¯¹ä¿éšœé€šä¿¡çš„å®‰å…¨æ€§è‡³å…³é‡è¦ï¼Œä½†ä¹Ÿéå¸¸è€—è´¹æ—¶é—´å’Œèµ„æºã€‚</p><h3 id="ä¼šè¯æ¢å¤çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#ä¼šè¯æ¢å¤çš„æ¦‚å¿µ"><span>ä¼šè¯æ¢å¤çš„æ¦‚å¿µ</span></a></h3><p>ä¼šè¯æ¢å¤ï¼ˆSession resumptionï¼‰å°±æ˜¯ä¸€ç§é¿å…æ¯æ¬¡é€šä¿¡éƒ½è¿›è¡Œå®Œæ•´ TLS æ¡æ‰‹çš„æœºåˆ¶ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å­˜å‚¨å·²ç»å»ºç«‹çš„ä¼šè¯çš„æŸäº›å‚æ•°ï¼Œå¹¶åœ¨æœªæ¥çš„é€šä¿¡ä¸­é‡ç”¨è¿™äº›å‚æ•°æ¥å¿«é€Ÿå»ºç«‹å®‰å…¨è¿æ¥ã€‚è¿™å¤§å¤§å‡å°‘äº†å»ºç«‹å®‰å…¨è¿æ¥æ‰€éœ€çš„æ—¶é—´å’Œè®¡ç®—èµ„æºï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚</p><h3 id="node-js-ä¸­çš„ä¼šè¯æ¢å¤" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„ä¼šè¯æ¢å¤"><span>Node.js ä¸­çš„ä¼šè¯æ¢å¤</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œä¼šè¯æ¢å¤å¯ä»¥é€šè¿‡ TLS æ¨¡å—è¿›è¡Œé…ç½®å’Œä½¿ç”¨ã€‚ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼å®ç°ä¼šè¯æ¢å¤ï¼š</p><ol><li><p><strong>ä¼šè¯æ ‡è¯†ç¬¦ï¼ˆSession IDsï¼‰</strong>ï¼šåœ¨ TLS æ¡æ‰‹å®Œæˆåï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªä¼šè¯æ ‡è¯†ç¬¦ï¼ˆSession IDï¼‰ï¼Œå¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯åœ¨ä¹‹åçš„è¿æ¥å°è¯•ä¸­å¯ä»¥ä½¿ç”¨è¿™ä¸ª Session ID è¯·æ±‚æ¢å¤æ—§çš„ä¼šè¯ã€‚</p></li><li><p><strong>ä¼šè¯ç¥¨è¯ï¼ˆSession Ticketsï¼‰</strong>ï¼šè¿™æ˜¯å¦å¤–ä¸€ç§æœºåˆ¶ï¼Œç”±æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªåŠ å¯†çš„ç¥¨æ®ï¼ˆticketï¼‰ï¼ŒåŒ…å«ä¼šè¯çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ã€‚å®¢æˆ·ç«¯åœ¨åç»­çš„è¿æ¥ä¸­å¯ä»¥ç›´æ¥æäº¤è¿™ä¸ªç¥¨æ®æ¥æ¢å¤ä¼šè¯ã€‚</p></li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>ç½‘é¡µæµè§ˆ</strong>ï¼šå½“ä½ æµè§ˆä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸ç½‘ç«™çš„æœåŠ¡å™¨é—´çš„æ¯æ¬¡é€šä¿¡éƒ½éœ€è¦å»ºç«‹ TLS è¿æ¥ã€‚å¦‚æœæ¯æ¬¡åŠ è½½é¡µé¢éƒ½è¿›è¡Œå®Œæ•´çš„ TLS æ¡æ‰‹ï¼Œå°†å¤§å¤§å¢åŠ åŠ è½½æ—¶é—´ã€‚é€šè¿‡ä½¿ç”¨ä¼šè¯æ¢å¤ï¼Œæµè§ˆå™¨å¯ä»¥å¿«é€Ÿé‡æ–°è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦ã€‚</p></li><li><p><strong>ç§»åŠ¨åº”ç”¨</strong>ï¼šç§»åŠ¨è®¾å¤‡ä¸Šçš„åº”ç”¨é¢‘ç¹åœ°ä¸æœåŠ¡å™¨é€šä¿¡ï¼ˆæ¯”å¦‚ç¤¾äº¤åª’ä½“åº”ç”¨ï¼‰ã€‚ä¼šè¯æ¢å¤æœºåˆ¶å¯ä»¥å¸®åŠ©åº”ç”¨åœ¨ç½‘ç»œçŠ¶æ€ä¸ç¨³å®šæˆ–è€…åº”ç”¨ä»åå°å”¤é†’æ—¶ï¼Œå¿«é€Ÿæ¢å¤ä¹‹å‰çš„ TLS ä¼šè¯ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p></li><li><p><strong>ç‰©è”ç½‘è®¾å¤‡</strong>ï¼šè®¸å¤šç‰©è”ç½‘è®¾å¤‡èµ„æºæœ‰é™ï¼Œæ‰§è¡Œå®Œæ•´çš„ TLS æ¡æ‰‹æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚é€šè¿‡ä¼šè¯æ¢å¤ï¼Œè¿™äº›è®¾å¤‡å¯ä»¥åœ¨ä¸æœåŠ¡å™¨é€šä¿¡æ—¶èŠ‚çœå®è´µçš„è®¡ç®—èµ„æºå’Œç”µé‡ã€‚</p></li></ol><p>ä¼šè¯æ¢å¤å¯¹äºç®¡ç†æˆåƒä¸Šä¸‡çš„å¹¶å‘è¿æ¥å°¤å…¶é‡è¦ï¼Œå¦‚åœ¨å¤§å‹çš„ã€é«˜æµé‡çš„ Web åº”ç”¨å’ŒæœåŠ¡ä¸­ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å»¶è¿Ÿå’ŒæœåŠ¡å™¨è´Ÿè½½ï¼Œæé«˜æ•´ä½“æ€§èƒ½å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚</p><h4 id="session-identifiers" tabindex="-1"><a class="header-anchor" href="#session-identifiers"><span><a href="https://nodejs.org/docs/latest/api/tls.html#session-identifiers" target="_blank" rel="noopener noreferrer">Session identifiers</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js è¢«å¹¿æ³›åº”ç”¨äºæ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯å•é¡µé¢åº”ç”¨ã€API æœåŠ¡ç­‰ã€‚åœ¨ Node.js çš„ä¸–ç•Œé‡Œï¼Œæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ <code>tls</code> æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æä¾›äº†å®ç°å®‰å…¨ä¼ è¾“å±‚ï¼ˆTLSï¼‰å’Œå®‰å…¨å¥—æ¥å­—å±‚ï¼ˆSSLï¼‰åè®®çš„åŠŸèƒ½ï¼Œç”¨äºå®ç°æ•°æ®çš„åŠ å¯†ä¼ è¾“ã€‚</p><h3 id="session-identifiers-1" tabindex="-1"><a class="header-anchor" href="#session-identifiers-1"><span>Session Identifiers</span></a></h3><p>åœ¨ <code>tls</code> æ¨¡å—çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œSession Identifiersâ€æˆ–â€œä¼šè¯æ ‡è¯†ç¬¦â€ï¼Œæ˜¯ç”¨æ¥æ ‡å¿—æ¯ä¸€ä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é—´çš„å”¯ä¸€ä¼šè¯çš„ã€‚å½“æˆ‘ä»¬è°ˆè®ºåˆ°ç½‘ç»œé€šä¿¡æ—¶ï¼Œä¸€ä¸ªâ€œä¼šè¯â€å¯ä»¥ç†è§£ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹çš„ä¸€æ¬¡è¿æ¥å’Œäº¤æ¢ä¿¡æ¯çš„è¿‡ç¨‹ã€‚é€šè¿‡ä½¿ç”¨ä¼šè¯æ ‡è¯†ç¬¦ï¼ŒTLS å¯ä»¥ä¼˜åŒ–é‡è¿è¿‡ç¨‹ï¼Œä»è€Œå‡å°‘æ¡æ‰‹æ­¥éª¤ï¼ŒåŠ å¿«è¿æ¥é€Ÿåº¦ã€‚</p><h4 id="å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œåŸç†"><span>å·¥ä½œåŸç†ï¼š</span></a></h4><ol><li><p><strong>é¦–æ¬¡è¿æ¥</strong>ï¼šå½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å°è¯•ä¸æœåŠ¡å™¨å»ºç«‹ TLS è¿æ¥æ—¶ï¼Œä¼šè¿›è¡Œå®Œæ•´çš„ TLS æ¡æ‰‹è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬èº«ä»½éªŒè¯ã€å¯†é’¥äº¤æ¢ç­‰å¤šä¸ªæ­¥éª¤ï¼Œç¡®ä¿åŒæ–¹å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„è¿æ¥ã€‚</p></li><li><p><strong>ç”Ÿæˆä¼šè¯æ ‡è¯†ç¬¦</strong>ï¼šä¸€æ—¦ TLS æ¡æ‰‹æˆåŠŸï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªâ€œä¼šè¯æ ‡è¯†ç¬¦â€å¹¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªæ ‡è¯†ç¬¦æ˜¯è¿™æ¬¡ä¼šè¯çš„å”¯ä¸€æ ‡è®°ã€‚</p></li><li><p><strong>é‡ç”¨ä¼šè¯</strong>ï¼šå½“åŒä¸€ä¸ªå®¢æˆ·ç«¯å†æ¬¡å°è¯•ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œå¯ä»¥å‘é€å…ˆå‰ä¿å­˜çš„ä¼šè¯æ ‡è¯†ç¬¦ä½œä¸ºé‡è¿è¯·æ±‚çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœæœåŠ¡å™¨è¯†åˆ«å‡ºè¿™ä¸ªä¼šè¯æ ‡è¯†ç¬¦ï¼Œä¸”è®¤ä¸ºå…¶ä»ç„¶æœ‰æ•ˆï¼Œé‚£ä¹ˆå®ƒå…è®¸è·³è¿‡æŸäº›æ¡æ‰‹æ­¥éª¤ï¼Œç›´æ¥å»ºç«‹åŠ å¯†é€šä¿¡ã€‚è¿™å¤§å¤§å‡å°‘äº†é‡æ–°è¿æ¥æ‰€éœ€çš„æ—¶é—´å’Œè®¡ç®—èµ„æºã€‚</p></li></ol><h4 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><ol><li><p><strong>ç½‘é¡µæµè§ˆ</strong>ï¼šå½“ä½ æµè§ˆä¸€ä¸ªä½¿ç”¨ HTTPS åè®®çš„ç½‘ç«™æ—¶ï¼Œä½ çš„æµè§ˆå™¨ä¸ç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„æ¯æ¬¡è¿æ¥éƒ½æ˜¯é€šè¿‡ TLS åŠ å¯†çš„ã€‚ä½¿ç”¨ä¼šè¯æ ‡è¯†ç¬¦å¯ä»¥å¸®åŠ©ç¼©çŸ­åŠ è½½ç½‘é¡µçš„æ—¶é—´ï¼Œå› ä¸ºåœ¨ä½ ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™åï¼Œåç»­çš„è®¿é—®å¯ä»¥é‡ç”¨ä¹‹å‰çš„ä¼šè¯è®¾ç½®ï¼Œæ— éœ€å†æ¬¡è¿›è¡Œå®Œæ•´çš„æ¡æ‰‹ã€‚</p></li><li><p><strong>ç§»åŠ¨åº”ç”¨ API è°ƒç”¨</strong>ï¼šåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œåº”ç”¨ç¨‹åºé¢‘ç¹åœ°ä¸åç«¯æœåŠ¡å™¨é€šä¿¡ï¼ˆæ¯”å¦‚æ£€æŸ¥æ›´æ–°ã€è·å–æ•°æ®ç­‰ï¼‰ã€‚åˆ©ç”¨ä¼šè¯æ ‡è¯†ç¬¦ï¼Œç§»åŠ¨åº”ç”¨åœ¨ä¸æœåŠ¡å™¨å»ºç«‹ TLS è¿æ¥æ—¶å¯ä»¥æ›´å¿«ã€‚è¿™æ ·åšä¸ä»…æé«˜äº†ç”¨æˆ·ä½“éªŒï¼ˆé€šè¿‡å‡å°‘ç­‰å¾…æ—¶é—´ï¼‰ï¼Œä¹Ÿå‡è½»äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚</p></li><li><p><strong>ç‰©è”ç½‘ï¼ˆIoTï¼‰è®¾å¤‡</strong>ï¼šç‰©è”ç½‘è®¾å¤‡ç»å¸¸éœ€è¦ä¸äº‘æœåŠ¡å™¨å®‰å…¨é€šä¿¡æ¥å‘é€ä¼ æ„Ÿå™¨æ•°æ®æˆ–æ¥æ”¶å‘½ä»¤ã€‚ç”±äºè¿™äº›è®¾å¤‡çš„è®¡ç®—èƒ½åŠ›å¾€å¾€æœ‰é™ï¼Œä½¿ç”¨ä¼šè¯æ ‡è¯†ç¬¦é‡ç”¨ TLS ä¼šè¯å¯ä»¥æ˜¾è‘—å‡å°‘å®ƒä»¬éœ€è¦æ‰§è¡Œçš„è®¡ç®—é‡ï¼Œä»è€ŒèŠ‚çœç”µé‡å’Œæé«˜æ•ˆç‡ã€‚</p></li></ol><p>æ€»ç»“æ¥è¯´ï¼ŒSession Identifiers åœ¨ TLS åè®®ä¸­çš„åº”ç”¨æå¤§åœ°ä¼˜åŒ–äº†ç½‘ç»œé€šä¿¡è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é¢‘ç¹å»ºç«‹å®‰å…¨è¿æ¥çš„åœºæ™¯ä¸‹ã€‚è¿™ä¸ä»…æé«˜äº†é€šä¿¡çš„æ•ˆç‡ï¼Œè¿˜åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡è½»äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå¯¹äºæå‡ç”¨æˆ·ä½“éªŒå’ŒèŠ‚çº¦è®¡ç®—èµ„æºéƒ½æœ‰ç§¯æä½œç”¨ã€‚</p><h4 id="session-tickets" tabindex="-1"><a class="header-anchor" href="#session-tickets"><span><a href="https://nodejs.org/docs/latest/api/tls.html#session-tickets" target="_blank" rel="noopener noreferrer">Session tickets</a></span></a></h4><p>Node.js é€šè¿‡å…¶ <code>tls</code> æ¨¡å—æä¾›äº†åº•å±‚çš„ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰åŠŸèƒ½ã€‚è¿™æ˜¯å®ç°ç½‘ç»œé€šä¿¡åŠ å¯†çš„ä¸€ç§æ–¹å¼ï¼Œå¹¿æ³›åº”ç”¨äº web æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼ˆæ¯”å¦‚ HTTPSï¼‰ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>Session tickets</code> æ˜¯å…¶ä¸­ä¸€ä¸ªç‰¹æ€§ã€‚</p><h3 id="session-tickets-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#session-tickets-ç®€ä»‹"><span>Session Tickets ç®€ä»‹</span></a></h3><p>åœ¨ TLS è¿æ¥ä¸­ï¼ŒåŒæ–¹é¦–æ¬¡æ¡æ‰‹æ—¶éœ€è¦è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„è®¡ç®—æ¥ç”Ÿæˆå…±äº«çš„ç§˜é’¥ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—æ—¶ã€‚ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼Œå½“ä¸¤ä¸ªä¸»ä½“å®Œæˆä¸€æ¬¡ TLS æ¡æ‰‹åï¼Œå®ƒä»¬å¯ä»¥å°†æŸäº›ä¼šè¯å‚æ•°ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯ä»¥æ›´å¿«åœ°é‡æ–°å»ºç«‹è¿æ¥ã€‚è¿™å°±æ˜¯â€œä¼šè¯é‡ç”¨â€ã€‚</p><p>Session Tickets æ˜¯ TLS åè®®ä¸­å®ç°ä¼šè¯é‡ç”¨çš„ä¸€ç§æœºåˆ¶ã€‚æœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªåŠ å¯†çš„â€œç¥¨æ®â€å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªç¥¨æ®åŒ…å«äº†æ¢å¤ä¼šè¯æ‰€éœ€çš„ä¿¡æ¯ã€‚å®¢æˆ·ç«¯å°†è¿™ä¸ªç¥¨æ®å®‰å…¨åœ°å­˜å‚¨èµ·æ¥ï¼Œå¹¶åœ¨ä¹‹åçš„è¿æ¥è¯·æ±‚ä¸­å‘é€ç»™æœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨èƒ½å¤Ÿè§£å¯†å¹¶æ¥å—è¿™ä¸ªç¥¨æ®ï¼Œé‚£ä¹ˆå®ƒä»¬å°±å¯ä»¥è·³è¿‡åˆå§‹çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œç›´æ¥è¿›å…¥åŠ å¯†é€šä¿¡ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-web-åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_1-web-åº”ç”¨"><span>1. Web åº”ç”¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js æ­å»ºçš„ç”µå•†ç½‘ç«™ã€‚ç”¨æˆ·åœ¨æµè§ˆå•†å“é¡µé¢æ—¶ï¼Œä»–ä»¬çš„æµè§ˆå™¨ä¸ä½ çš„æœåŠ¡å™¨ä¹‹é—´ä¼šå»ºç«‹å¤šä¸ª TLS è¿æ¥ï¼ˆè·å–é¡µé¢å†…å®¹ã€ä¸‹è½½å›¾ç‰‡ç­‰ï¼‰ã€‚ä½¿ç”¨ Session Tickets å¯ä»¥æ˜¾è‘—å‡å°‘æ¯ä¸ªé¡µé¢åŠ è½½è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚</p><h4 id="_2-iot-è®¾å¤‡" tabindex="-1"><a class="header-anchor" href="#_2-iot-è®¾å¤‡"><span>2. IoT è®¾å¤‡</span></a></h4><p>åœ¨ç‰©è”ç½‘ï¼ˆIoTï¼‰åœºæ™¯ä¸­ï¼Œè®¾å¤‡ï¼ˆå¦‚æ™ºèƒ½å®¶å±…æ§åˆ¶å™¨ï¼‰é¢‘ç¹ä¸äº‘ç«¯æœåŠ¡å™¨é€šä¿¡æ˜¯å¾ˆå¸¸è§çš„ã€‚ç”±äº IoT è®¾å¤‡é€šå¸¸èµ„æºæœ‰é™ï¼Œé¢‘ç¹è¿›è¡Œå®Œæ•´çš„ TLS æ¡æ‰‹å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡çš„è®¡ç®—èµ„æºå’Œç”µåŠ›ã€‚é€šè¿‡ä½¿ç”¨ Session Ticketsï¼Œè®¾å¤‡å¯ä»¥æ›´æœ‰æ•ˆç‡åœ°ä¸æœåŠ¡å™¨é‡è¿ï¼ŒèŠ‚çœèµ„æºã€‚</p><h4 id="_3-ç§»åŠ¨åº”ç”¨-apis" tabindex="-1"><a class="header-anchor" href="#_3-ç§»åŠ¨åº”ç”¨-apis"><span>3. ç§»åŠ¨åº”ç”¨ APIs</span></a></h4><p>å¯¹äºç§»åŠ¨åº”ç”¨ï¼Œå°¤å…¶æ˜¯é‚£äº›ä¾èµ–äºé¢‘ç¹ç½‘ç»œè¯·æ±‚çš„åº”ç”¨ï¼ˆå¦‚ç¤¾äº¤åª’ä½“æˆ–æ–°é—»åº”ç”¨ï¼‰ï¼Œåˆ©ç”¨ Session Tickets å¯ä»¥å‡å°‘æ¯æ¬¡è¯·æ±‚çš„å»¶è¿Ÿï¼Œä½¿å¾—åº”ç”¨å“åº”æ›´åŠ è¿…é€Ÿï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚</p><h3 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h3><p>æ€»çš„æ¥è¯´ï¼ŒSession Tickets åœ¨ Node.js ä¸­æ˜¯å¤„ç† TLS è¿æ¥ä¼˜åŒ–çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€‚å®ƒé€šè¿‡å…è®¸ä¼šè¯ä¿¡æ¯çš„å®‰å…¨é‡ç”¨ï¼Œæ¥å‡å°‘æ¡æ‰‹æ—¶é—´ï¼Œæé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚æ— è®ºæ˜¯åœ¨æé«˜ Web æœåŠ¡å™¨æ€§èƒ½ï¼Œè¿˜æ˜¯åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸‹ä¼˜åŒ–è¿æ¥ï¼ŒSession Tickets éƒ½å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚</p><h2 id="modifying-the-default-tls-cipher-suite" tabindex="-1"><a class="header-anchor" href="#modifying-the-default-tls-cipher-suite"><span><a href="https://nodejs.org/docs/latest/api/tls.html#modifying-the-default-tls-cipher-suite" target="_blank" rel="noopener noreferrer">Modifying the default TLS cipher suite</a></span></a></h2><p>è¦æ·±å…¥ç†è§£ Node.js ä¸­ä¿®æ”¹é»˜è®¤ TLS å¯†ç å¥—ä»¶çš„æ¦‚å¿µï¼Œé¦–å…ˆè®©æˆ‘ä»¬ç®€å•äº†è§£ä¸€äº›åŸºæœ¬æœ¯è¯­å’ŒèƒŒæ™¯ã€‚</p><h3 id="åŸºç¡€æœ¯è¯­" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æœ¯è¯­"><span>åŸºç¡€æœ¯è¯­ï¼š</span></a></h3><ul><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>TLS (ä¼ è¾“å±‚å®‰å…¨æ€§)</strong>: ä¸€ç§åè®®ï¼Œç”¨äºåœ¨ç½‘ç»œä¸Šæä¾›åŠ å¯†é€šä¿¡å’Œæ•°æ®å®Œæ•´æ€§ä¿è¯ã€‚å®ƒæ˜¯ HTTPS çš„åŸºç¡€ã€‚</li><li><strong>Cipher Suite (å¯†ç å¥—ä»¶)</strong>: ä¸€ç»„ç®—æ³•ï¼Œç”¨äºåŠ å¯†ã€è§£å¯†ã€éªŒè¯æ¶ˆæ¯å®Œæ•´æ€§ä»¥åŠäº¤æ¢åŠ å¯†å¯†é’¥ç­‰æ“ä½œã€‚ä¸€ä¸ª TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨åˆ°å¯†ç å¥—ä»¶ã€‚</li></ul><h3 id="ä¿®æ”¹é»˜è®¤-tls-å¯†ç å¥—ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹é»˜è®¤-tls-å¯†ç å¥—ä»¶"><span>ä¿®æ”¹é»˜è®¤ TLS å¯†ç å¥—ä»¶</span></a></h3><p>åœ¨ Node.js çš„ç¯å¢ƒä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒTLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰ä½¿ç”¨ä¸€å¥—é¢„å®šä¹‰çš„å¯†ç å¥—ä»¶æ¥ä¿éšœæ•°æ®çš„å®‰å…¨ä¼ è¾“ã€‚è¿™äº›é»˜è®¤çš„å¯†ç å¥—ä»¶æ˜¯æ ¹æ®å½“å‰æœ€ä½³å®è·µé€‰å‡ºçš„ï¼Œæ—¨åœ¨æä¾›å¼ºå¤§çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®ç‰¹å®šå®‰å…¨è¦æ±‚æˆ–å…¼å®¹æ€§è€ƒè™‘æ¥ä¿®æ”¹è¿™äº›é»˜è®¤å¯†ç å¥—ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ v21.7.1 ç‰ˆæœ¬ä¸­ï¼ŒNode.js å…è®¸é€šè¿‡ API æˆ–å¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œå‚æ•°æ¥ä¿®æ”¹é»˜è®¤çš„ TLS å¯†ç å¥—ä»¶åˆ—è¡¨ã€‚</p><h4 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†é€šä¿¡çš„ Web åº”ç”¨ï¼Œå¹¶ä¸”å¯¹å®‰å…¨æ€§æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæ¯”å¦‚éœ€è¦ç¦ç”¨æŸäº›è¢«è®¤ä¸ºè¾ƒå¼±æˆ–å·²ç»è¢«ç ´è§£çš„å¯†ç å¥—ä»¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</p><ol><li><p><strong>é€šè¿‡ä»£ç ä¿®æ”¹</strong>:</p><ul><li>ä½¿ç”¨<code>tls.setDefaultCiphers()</code>å‡½æ•°æ¥è®¾ç½®ä½ å¸Œæœ›ä½¿ç”¨çš„å¯†ç å¥—ä»¶åˆ—è¡¨ã€‚ä½ å¯ä»¥ä» Node.js çš„ TLS æ–‡æ¡£ä¸­æŸ¥æ‰¾æ”¯æŒçš„å¯†ç å¥—ä»¶ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®è‡ªå®šä¹‰çš„å¯†ç å¥—ä»¶åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setDefaultCiphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ECDHE-RSA-AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªTLSæœåŠ¡å™¨ï¼Œä½¿ç”¨ä¿®æ”¹åçš„å¯†ç å¥—ä»¶é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¿®æ”¹</strong>:</p><p>å½“ä½ å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡<code>--tls-cipher-list</code>å‚æ•°æŒ‡å®šä½ çš„å¯†ç å¥—ä»¶åˆ—è¡¨ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --tls-cipher-list=&quot;ECDHE-RSA-AES128-GCM-SHA256:AES128-GCM-SHA256&quot; yourApp.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>è¿™æ ·ï¼Œä½ å°±èƒ½å¤Ÿæ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚è°ƒæ•´ TLS åŠ å¯†é€šä¿¡çš„å®‰å…¨æ€§ã€‚åœ¨é€‰æ‹©å¯†ç å¥—ä»¶æ—¶ï¼Œç¡®ä¿è€ƒè™‘åˆ°å…¼å®¹æ€§å’Œå®‰å…¨æ€§ä¹‹é—´çš„å¹³è¡¡ï¼Œå§‹ç»ˆä¼˜å…ˆé€‰æ‹©é‚£äº›è¢«æ™®éè®¤ä¸ºå®‰å…¨çš„ç®—æ³•ã€‚</p><h2 id="x509-certificate-error-codes" tabindex="-1"><a class="header-anchor" href="#x509-certificate-error-codes"><span><a href="https://nodejs.org/docs/latest/api/tls.html#x509-certificate-error-codes" target="_blank" rel="noopener noreferrer">X509 certificate error codes</a></span></a></h2><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js è¿›è¡Œç½‘ç»œé€šä¿¡æˆ–æ˜¯æ„å»ºæœåŠ¡å™¨çš„æ—¶å€™ï¼Œå®‰å…¨æ€§æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„è¯é¢˜ã€‚å…¶ä¸­ï¼ŒX509 è¯ä¹¦å°±æ‰®æ¼”äº†ä¸€ä¸ªæ ¸å¿ƒè§’è‰²ã€‚è¿™äº›è¯ä¹¦å¸®åŠ©æˆ‘ä»¬éªŒè¯é€šä¿¡å¦ä¸€æ–¹çš„èº«ä»½ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹æˆ–çªƒå¬ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨è¿™äº›è¯ä¹¦çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é”™è¯¯ã€‚Node.js v21.7.1 ä¸­çš„ X509 certificate error codes å°±æ˜¯ç”¨æ¥æ ‡è¯†è¿™äº›å¯èƒ½å‘ç”Ÿçš„é”™è¯¯çš„ã€‚</p><p>è®©æˆ‘ä»¬å…ˆç†è§£ä¸‹ä»€ä¹ˆæ˜¯ X509 è¯ä¹¦ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æ¥åŠ å¯†ç½‘ç»œé€šä¿¡ï¼Œç¡®ä¿é€šä¿¡åŒæ–¹èº«ä»½çœŸå®æ€§çš„æ•°å­—è¯ä¹¦ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ é€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸ªé“¶è¡Œç½‘ç«™ï¼Œé“¶è¡Œç”¨ X509 è¯ä¹¦è¯æ˜å®ƒå°±æ˜¯ä½ æƒ³è¦è®¿é—®çš„é‚£ä¸ªé“¶è¡Œï¼Œè€Œä¸æ˜¯æŸä¸ªä¼ªè£…æˆé“¶è¡Œçš„é’“é±¼ç½‘ç«™ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ä½¿ç”¨è¿™äº›è¯ä¹¦æ—¶å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é”™è¯¯ä»£ç åŠå…¶å«ä¹‰ï¼š</p><ol><li><p><strong>CERT_NOT_YET_VALID</strong> - è¿™æ„å‘³ç€è¯ä¹¦çš„æœ‰æ•ˆæœŸè¿˜æ²¡å¼€å§‹ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªè¯ä¹¦è®¾å®šä» 2023 å¹´ 6 æœˆ 1 æ—¥å¼€å§‹æœ‰æ•ˆï¼Œè€Œå½“å‰æ—¶é—´æ˜¯ 5 æœˆ 30 æ—¥ï¼Œè¿™æ—¶å€™å¦‚æœå°è¯•ä½¿ç”¨è¯¥è¯ä¹¦ï¼Œå°±ä¼šé‡åˆ°è¿™ä¸ªé”™è¯¯ã€‚</p></li><li><p><strong>CERT_HAS_EXPIRED</strong> - ä¸ä¸Šé¢ç›¸åï¼Œè¿™ä¸ªé”™è¯¯è¡¨æ˜è¯ä¹¦çš„æœ‰æ•ˆæœŸå·²ç»ç»“æŸã€‚å¦‚æœä¸€ä¸ªè¯ä¹¦çš„æœ‰æ•ˆæœŸåˆ° 2023 å¹´ 5 æœˆ 31 æ—¥ä¸ºæ­¢ï¼Œè€Œå½“å‰æ—¶é—´æ˜¯ 6 æœˆ 1 æ—¥ï¼Œä½¿ç”¨è¿™ä¸ªè¯ä¹¦æ—¶å°±ä¼šå‡ºç°æ­¤é”™è¯¯ã€‚</p></li><li><p><strong>DEPTH_ZERO_SELF_SIGNED_CERT</strong> - è¿™ä¸ªé”™è¯¯è¡¨ç¤ºæ‚¨é‡åˆ°äº†ä¸€ä¸ªè‡ªç­¾åçš„è¯ä¹¦ã€‚è‡ªç­¾åè¯ä¹¦æ˜¯æŒ‡ç”±æœ€ç»ˆä½¿ç”¨è€…è‡ªå·±ç­¾ç½²ï¼Œè€Œéç”±å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾ç½²çš„è¯ä¹¦ã€‚è™½ç„¶è‡ªç­¾åè¯ä¹¦å¯ä»¥æä¾›åŠ å¯†ï¼Œä½†ä¸èƒ½æä¾›èº«ä»½éªŒè¯ã€‚</p></li><li><p><strong>UNABLE_TO_VERIFY_LEAF_SIGNATURE</strong> - è¿™ä¸ªé”™è¯¯é€šå¸¸æ„å‘³ç€è¯ä¹¦é“¾ä¸­æœ‰ä¸€ä¸ªè¯ä¹¦ç¼ºå¤±ï¼Œå¯¼è‡´æ— æ³•éªŒè¯æœ«ç«¯ï¼ˆleafï¼‰è¯ä¹¦çš„ç­¾åã€‚è¯ä¹¦é“¾éœ€è¦å®Œæ•´æ— ç¼ºï¼Œä»¥ç¡®ä¿æ¯ä¸ªè¯ä¹¦éƒ½å¯ä»¥è¿½æº¯åˆ°å—ä¿¡ä»»çš„æ ¹è¯ä¹¦ã€‚</p></li><li><p><strong>SELF_SIGNED_CERT_IN_CHAIN</strong> - å½“å°è¯•å»ºç«‹ä¸€ä¸ªå®‰å…¨è¿æ¥æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨æä¾›çš„è¯ä¹¦é“¾ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªç­¾åè¯ä¹¦ï¼Œä½ å°†ä¼šé‡åˆ°è¿™ä¸ªé”™è¯¯ã€‚æ­£è§„çš„è¯ä¹¦é“¾åº”è¯¥åªåŒ…å«ç”±æƒå¨è®¤è¯æœºæ„ç­¾å‘çš„è¯ä¹¦ã€‚</p></li></ol><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</p><ul><li><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ç”¨æˆ·ç™»å½•çš„ç½‘ç«™ã€‚ä¸ºäº†ä¿æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨ï¼Œä½ å†³å®šä½¿ç”¨ HTTPS åè®®åŠ å¯†æ‰€æœ‰ä¼ è¾“çš„æ•°æ®ã€‚åœ¨é…ç½® HTTPS æ—¶ï¼Œä½ éœ€è¦è·å–å¹¶é…ç½®ä¸€ä¸ª SSL/TLS è¯ä¹¦ã€‚å¦‚æœè¿™ä¸ªè¯ä¹¦æ²¡æœ‰æ­£ç¡®é…ç½®ï¼ˆæ¯”å¦‚ä½¿ç”¨äº†ä¸€ä¸ªæœªç”Ÿæ•ˆçš„è¯ä¹¦ï¼‰ï¼Œå½“ç”¨æˆ·å°è¯•è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œä»–ä»¬çš„æµè§ˆå™¨ä¼šæ˜¾ç¤º<code>CERT_NOT_YET_VALID</code>çš„é”™è¯¯ã€‚</p></li><li><p>å¦ä¸€ä¸ªåœºæ™¯æ˜¯ï¼Œä½ ä½¿ç”¨ Node.js å¼€å‘äº†ä¸€ä¸ª API æœåŠ¡ï¼ŒæœåŠ¡äºæ‰‹æœº APPã€‚ä¸ºäº†æ•°æ®å®‰å…¨ï¼Œä½ å†³å®šä½¿ç”¨ HTTPSã€‚å¦‚æœä½¿ç”¨äº†ä¸€ä¸ªå·²ç»è¿‡æœŸçš„è¯ä¹¦ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ API æ—¶å¯èƒ½ä¼šæ”¶åˆ°<code>CERT_HAS_EXPIRED</code>çš„é”™è¯¯æç¤ºï¼Œè¿™ä¼šå¯¼è‡´ APP æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p></li></ul><p>ç†è§£å’Œå¤„ç†è¿™äº›è¯ä¹¦é”™è¯¯å¯¹äºä¿éšœåº”ç”¨çš„å®‰å…¨æ€§æä¸ºé‡è¦ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œä½ åº”è¯¥ç¡®ä¿æ‰€ä½¿ç”¨çš„è¯ä¹¦æœ‰æ•ˆã€å¯ä¿¡ï¼Œå¹¶ä¸”åŠæ—¶æ›´æ–°ï¼Œé¿å…å‡ºç°ä¸Šè¿°é”™è¯¯ï¼Œä»è€Œä¿æŠ¤ç”¨æˆ·çš„æ•°æ®å®‰å…¨åŠåº”ç”¨çš„ç¨³å®šè¿è¡Œã€‚</p><h2 id="class-tls-cryptostream" tabindex="-1"><a class="header-anchor" href="#class-tls-cryptostream"><span><a href="https://nodejs.org/docs/latest/api/tls.html#class-tlscryptostream" target="_blank" rel="noopener noreferrer">Class: tls.CryptoStream</a></span></a></h2><p>ç†è§£ Node.js ä¸­çš„ <code>tls.CryptoStream</code> ç±»ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æŒæ¡å‡ ä¸ªå…³é”®æ¦‚å¿µï¼šNode.jsã€TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰ã€æµ(Stream)ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ol><li><p><strong>Node.js</strong>: æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒèƒ½å¤Ÿå¤„ç†é«˜å¹¶å‘æƒ…å†µä¸‹çš„ç½‘ç»œè¿æ¥ï¼Œå¹¿æ³›åº”ç”¨äºæ„å»ºç½‘ç»œæœåŠ¡å’Œåº”ç”¨ã€‚</p></li><li><p><strong>TLS (ä¼ è¾“å±‚å®‰å…¨åè®®)</strong>: æ˜¯ç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§çš„æ ‡å‡†åè®®ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒTLS å°±æ˜¯ä¿è¯ç½‘ä¸Šä¼ è¾“æ•°æ®å®‰å…¨çš„ä¸€ç§æœºåˆ¶ã€‚</p></li><li><p><strong>æµ(Stream)</strong>: åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—æ•°æ®çš„é›†åˆï¼Œå¦‚æ–‡ä»¶ä¸­çš„æ•°æ®æˆ– TCP å¥—æ¥å­—ä¸­çš„æ•°æ®ã€‚Node.js ä½¿ç”¨æµæ¥å¤„ç†å¤§é‡æ•°æ®æˆ–é€æ­¥å¤„ç†è¾“å…¥å’Œè¾“å‡ºï¼Œä»¥èŠ‚çœå†…å­˜å’Œæ—¶é—´ã€‚</p></li></ol><h3 id="tls-cryptostream" tabindex="-1"><a class="header-anchor" href="#tls-cryptostream"><span><code>tls.CryptoStream</code></span></a></h3><p>åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­çš„ <code>tls.CryptoStream</code> ç±»å±äº TLS æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç›®å‰çš„å®˜æ–¹æ–‡æ¡£ä¸­æ²¡æœ‰ç›´æ¥åˆ—å‡ºè¿™ä¸ªç±»ã€‚è¿™å¯èƒ½æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªå†…éƒ¨ç±»æˆ–è€…å·²ç»è¢«å¼ƒç”¨æˆ–æ›¿æ¢äº†ã€‚å› æ­¤ï¼Œæˆ‘å°†åŸºäº Node.js ä¸­é€šç”¨çš„ TLS åŠŸèƒ½å’Œæµçš„å·¥ä½œæ–¹å¼ç»™å‡ºè§£é‡Šå’Œç¤ºä¾‹ã€‚</p><p>åœ¨ TLS è¿æ¥ä¸­ï¼Œ<code>CryptoStream</code> å¯èƒ½æ˜¯ä¸€ä¸ªå¤„ç†åŠ å¯†å’Œè§£å¯†æ•°æ®æµçš„ç±»ã€‚åœ¨å»ºç«‹èµ·ä¸€ä¸ªå®‰å…¨çš„ TLS è¿æ¥åï¼Œæ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½éœ€è¦è¢«åŠ å¯†ï¼Œåˆ°è¾¾ç›®çš„åœ°åå†è¢«è§£å¯†ï¼Œä»¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å°½ç®¡æˆ‘ä»¬æ— æ³•ç›´æ¥ä½¿ç”¨ <code>tls.CryptoStream</code>ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸¾ä¸€ä¸ª Node.js ä¸­ä½¿ç”¨ TLS åˆ›å»ºä¸€ä¸ªå®‰å…¨æœåŠ¡å™¨çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 8000 ç«¯å£ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œå®ƒä¼šæ”¶åˆ°ä¸€æ¡&quot;welcome!&quot;æ¶ˆæ¯ã€‚è¿™é‡Œç”¨åˆ°çš„<code>socket.pipe(socket)</code>æ˜¯ä¸€ä¸ªç®€å•çš„æµæ“ä½œï¼Œå®ƒæŠŠæ¥æ”¶åˆ°çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è™½ç„¶è¿™ä¸æ˜¯ç›´æ¥ä½¿ç”¨<code>tls.CryptoStream</code>ï¼Œä½†æ¶‰åŠåˆ°äº† TLS å®‰å…¨è¿æ¥çš„åˆ›å»ºå’Œç®¡ç†ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰å…·ä½“çš„<code>tls.CryptoStream</code>å¯ç”¨ä¿¡æ¯ï¼ŒNode.js ä¸­çš„ TLS æ¨¡å—å…è®¸æˆ‘ä»¬å»ºç«‹å®‰å…¨çš„ç½‘ç»œé€šä¿¡ï¼Œä¿æŠ¤æ•°æ®ä¸è¢«ç¬¬ä¸‰æ–¹çªƒå–æˆ–ç¯¡æ”¹ã€‚é€šè¿‡ç»„åˆä½¿ç”¨ TLS å’Œ Node.js ä¸­çš„æµï¼Œå¯ä»¥æœ‰æ•ˆå¤„ç†å’Œä¿æŠ¤æ•°æ®ä¼ è¾“ã€‚</p><h3 id="cryptostream-byteswritten" tabindex="-1"><a class="header-anchor" href="#cryptostream-byteswritten"><span><a href="https://nodejs.org/docs/latest/api/tls.html#cryptostreambyteswritten" target="_blank" rel="noopener noreferrer">cryptoStream.bytesWritten</a></span></a></h3><p>åœ¨è§£é‡Š Node.js v21.7.1 ä¸­çš„ <code>cryptoStream.bytesWritten</code> å±äºå“ªä¸ªæ¨¡å—ä»¥åŠå®ƒçš„ä½œç”¨å’Œä¸€äº›å®é™…åº”ç”¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><p><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„ JavaScript è¿è¡Œæ—¶ã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptï¼Œéå¸¸é€‚åˆå¼€å‘éœ€è¦ä¸æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿäº¤äº’å’Œç½‘ç»œè¯·æ±‚çš„åç«¯æœåŠ¡ã€‚</p></li><li><p><strong>Streams</strong>: åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚å¯ä»¥å°† Streams æƒ³è±¡æˆæ•°æ®æµåŠ¨çš„ç®¡é“ï¼Œä¾‹å¦‚ä»ä¸€ä¸ªåœ°æ–¹ï¼ˆå¦‚æ–‡ä»¶ï¼‰è¯»å–æ•°æ®å¹¶å°†å…¶ä¼ è¾“åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼ˆå¦‚ HTTP å“åº”ï¼‰ã€‚Streams é«˜æ•ˆç®¡ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬åˆ†å—å¤„ç†æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®é›†åˆ°å†…å­˜ä¸­ã€‚</p></li><li><p><strong>Crypto Module</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>crypto</code> æ¨¡å—æä¾›åŠ å¯†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹æ•°æ®çš„åŠ å¯†å’Œè§£å¯†ã€ä¿¡æ¯æ‘˜è¦ã€æ•°å­—ç­¾åç­‰ã€‚è¿™å¯¹äºå¤„ç†æ•æ„Ÿä¿¡æ¯æˆ–ç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</p></li></ol><h3 id="cryptostream-byteswritten-1" tabindex="-1"><a class="header-anchor" href="#cryptostream-byteswritten-1"><span><code>cryptoStream.bytesWritten</code></span></a></h3><p>ç°åœ¨æ¥è°ˆè°ˆ <code>cryptoStream.bytesWritten</code>ã€‚é¦–å…ˆï¼Œè¿™æ˜¯ <code>tls</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å•ç‹¬çš„ <code>crypto</code> æ¨¡å—ã€‚<code>tls</code> æ¨¡å—ç”¨äºå®ç° TLS å’Œ SSL ç½‘ç»œåè®®ï¼Œä¸»è¦ç”¨äºåŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚</p><ul><li><strong>å±æ€§è¯´æ˜</strong>: <code>cryptoStream.bytesWritten</code> å±æ€§è¡¨ç¤ºé€šè¿‡ <code>TLS/SSL</code> è¿æ¥å‘é€çš„å­—èŠ‚æ€»æ•°ã€‚è¿™ä¸ªè®¡æ•°åŒ…æ‹¬äº†åŠ å¯†åçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‘é€çš„åŸå§‹æ•°æ®å¤§å°å¯èƒ½ä¼šå°äºè¿™ä¸ªå€¼ï¼Œå› ä¸ºåŠ å¯†è¿‡ç¨‹å¯èƒ½ä¼šå¢åŠ æ•°æ®çš„å¤§å°ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®‰å…¨çš„ç½‘ä¸Šé“¶è¡Œåº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦ä½¿ç”¨ HTTPS (åŸºäº TLS/SSL) æ¥ä¿æŠ¤ç”¨æˆ·æ•°æ®çš„ä¼ è¾“å®‰å…¨ã€‚å½“ç”¨æˆ·è¿›è¡Œåœ¨çº¿äº¤æ˜“æ—¶ï¼Œæ¯”å¦‚è½¬è´¦ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦è¢«åŠ å¯†ï¼Œä»¥é˜²æ­¢é»‘å®¢çªƒå–æ•æ„Ÿä¿¡æ¯ã€‚</p><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå¦‚æœä½ æƒ³ç›‘æ§æˆ–è€…è®°å½•é€šè¿‡åŠ å¯†è¿æ¥å‘é€çš„æ•°æ®é‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>cryptoStream.bytesWritten</code>ã€‚è¿™æ ·åšå¯ä»¥å¸®åŠ©ä½ åˆ†æåº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸çš„æ•°æ®é‡è¢«å‘é€ï¼ˆå¯èƒ½æ˜¯ç”±äºé”™è¯¯æˆ–æ¶æ„è¡Œä¸ºé€ æˆçš„ï¼‰ï¼Œå¹¶ä¼˜åŒ–æ•°æ®ä¼ è¾“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“è¿æ¥ç»“æŸæ—¶ï¼Œæ‰“å° bytesWritten ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      `Data sent over the secure channel: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bytesWritten</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ TLS æœåŠ¡å™¨ï¼Œå®ƒæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚æœåŠ¡å™¨è¿˜ç›‘å¬æ¯ä¸ªè¿æ¥çš„ç»“æŸäº‹ä»¶ï¼Œå¹¶åœ¨è¿æ¥ç»“æŸæ—¶è¾“å‡ºé€šè¿‡è¯¥ç‰¹å®šè¿æ¥å‘é€çš„å­—èŠ‚æ€»æ•°ã€‚è¿™å°±æ˜¯ <code>cryptoStream.bytesWritten</code> å±æ€§çš„ä¸€ä¸ªå®é™…åº”ç”¨å®ä¾‹ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹å¸®ä½ ç†è§£äº† <code>cryptoStream.bytesWritten</code> çš„æ¦‚å¿µå’Œç”¨æ³•ï¼</p><h2 id="class-tls-securepair" tabindex="-1"><a class="header-anchor" href="#class-tls-securepair"><span><a href="https://nodejs.org/docs/latest/api/tls.html#class-tlssecurepair" target="_blank" rel="noopener noreferrer">Class: tls.SecurePair</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸æ‚¨åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚ç”±äº Node.js åŸºäºäº‹ä»¶é©±åŠ¨å’Œéé˜»å¡ I/O æ¨¡å‹ï¼Œå®ƒç‰¹åˆ«é€‚åˆå¤„ç†æ•°æ®å¯†é›†çš„å®æ—¶åº”ç”¨ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—å¸®åŠ©å¼€å‘è€…æ›´è½»æ¾åœ°æ„å»ºç½‘ç«™å’Œåº”ç”¨ç¨‹åºã€‚å…¶ä¸­ï¼Œ<code>tls</code> æ¨¡å—æ˜¯ä¸€ä¸ªæä¾›äº†å®‰å…¨ä¼ è¾“å±‚ï¼ˆTLSï¼‰å’Œå®‰å…¨å¥—æ¥å­—å±‚ï¼ˆSSLï¼‰åè®®çš„å®ç°ï¼Œç”¨æ¥è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚</p><p><code>tls.SecurePair</code> æ˜¯ <code>tls</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªç±»ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéšç€ Node.js çš„å‘å±•ï¼Œ<code>tls.SecurePair</code> è¢«è§†ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰çš„åŠŸèƒ½ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å¯èƒ½ä¸å†æ¨èä½¿ç”¨ã€‚è¿™ä¸ªç±»ä¸»è¦ç”¨äºåˆ›å»ºä¸€ä¸ªå®‰å…¨çš„åŒå‘æ•°æ®æµï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°åŠ å¯†ä»ä¸€ç«¯å‘é€åˆ°å¦ä¸€ç«¯çš„æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥è§£å¯†ä»å¦ä¸€ç«¯æ”¶åˆ°çš„æ•°æ®ã€‚</p><p>å°½ç®¡ <code>tls.SecurePair</code> ä¸å†æ˜¯æ¨èçš„æ–¹å¼ï¼Œç†è§£å…¶åŸç†å¯¹äºç†è§£ TLS/SSL åŠ å¯†é€šä¿¡ä»ç„¶æœ‰ä»·å€¼ã€‚ä¸‹é¢æˆ‘ä¼šç®€å•è§£é‡Šå…¶å·¥ä½œåŸç†ï¼Œå¹¶ç»™å‡ºä¸€äº›æ›¿ä»£æ–¹æ¡ˆçš„ä¾‹å­ã€‚</p><h3 id="å·¥ä½œåŸç†-1" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œåŸç†-1"><span>å·¥ä½œåŸç†</span></a></h3><ul><li><p><strong>åˆ›å»ºå®‰å…¨è¿æ¥</strong>ï¼šé€šè¿‡ <code>tls.SecurePair</code> å¯ä»¥åˆ›å»ºä¸€ä¸ªå®‰å…¨è¿æ¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸¤ä¸ªæµï¼ˆ<code>cleartextStream</code> å’Œ <code>encryptedStream</code>ï¼‰ã€‚<code>cleartextStream</code> ç”¨äºè¯»å†™æœªåŠ å¯†çš„æ•°æ®ï¼Œè€Œ <code>encryptedStream</code> ç”¨äºä¸å¯¹ç«¯äº¤æ¢åŠ å¯†æ•°æ®ã€‚å½“æ‚¨ä» <code>cleartextStream</code> å†™å…¥æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè‡ªåŠ¨åŠ å¯†å¹¶é€šè¿‡ <code>encryptedStream</code> å‘é€ï¼›å½“æ‚¨ä» <code>encryptedStream</code> æ¥æ”¶æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè‡ªåŠ¨è§£å¯†å¹¶é€šè¿‡ <code>cleartextStream</code> æä¾›ç»™åº”ç”¨ç¨‹åºã€‚</p></li><li><p><strong>å¯åŠ¨ TLS/SSL æ¡æ‰‹</strong>ï¼šå½“ <code>SecurePair</code> å¯¹è±¡è¢«åˆ›å»ºåï¼Œå®ƒå°†è‡ªåŠ¨å¼€å§‹ TLS/SSL æ¡æ‰‹è¿‡ç¨‹ã€‚æ¡æ‰‹è¿‡ç¨‹è´Ÿè´£äº¤æ¢ç§˜é’¥ã€éªŒè¯è¯ä¹¦ç­‰ï¼Œç¡®ä¿åŒæ–¹å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†è¿æ¥ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>è™½ç„¶ç›´æ¥åº”ç”¨ <code>tls.SecurePair</code> çš„åœºæ™¯è¾ƒå°‘ï¼Œæˆ‘ä»¬å¯ä»¥è°ˆä¸€è°ˆå…¶èƒŒåçš„æ¦‚å¿µâ€”â€”TLS/SSL åŠ å¯†â€”â€”åœ¨æ—¥å¸¸å¼€å‘ä¸­çš„åº”ç”¨ã€‚</p><ol><li><p><strong>HTTPS æœåŠ¡å™¨</strong>ï¼šæœ€å¸¸è§çš„ä½¿ç”¨ TLS/SSL çš„æƒ…å†µæ˜¯åœ¨åˆ›å»º HTTPS æœåŠ¡å™¨æ—¶ã€‚Node.js ä¸­çš„ <code>https</code> æ¨¡å—å¯ä»¥è®©æ‚¨è½»æ¾åœ°éƒ¨ç½²ä¸€ä¸ªæ”¯æŒ TLS/SSL åŠ å¯†çš„ web æœåŠ¡å™¨ï¼Œä¿è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å®‰å…¨ã€‚</p></li><li><p><strong>å®‰å…¨ WebSocket è¿æ¥</strong>ï¼šWebSocket é€šå¸¸ç”¨äºå®æ—¶é€šä¿¡åº”ç”¨ã€‚åœ¨ Node.js ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>ws</code> æˆ–å…¶ä»– WebSocket åº“ç»“åˆ <code>https</code> æˆ– <code>tls</code> æ¨¡å—æ¥åˆ›å»ºæ”¯æŒ TLS/SSL çš„å®‰å…¨ WebSocket æœåŠ¡ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p></li><li><p><strong>é‚®ä»¶ä¼ è¾“åŠ å¯†</strong>ï¼šå‘é€å’Œæ¥æ”¶ç”µå­é‚®ä»¶æ—¶ï¼Œä½¿ç”¨ <code>nodemailer</code> ç­‰åº“å¯ä»¥é€šè¿‡ SSL/TLS æ¥åŠ å¯†é‚®ä»¶å†…å®¹ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå–ã€‚</p></li></ol><h3 id="æ›¿ä»£æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£æ–¹æ¡ˆ"><span>æ›¿ä»£æ–¹æ¡ˆ</span></a></h3><p>ç”±äº <code>tls.SecurePair</code> è¢«è§†ä¸ºè¿‡æ—¶çš„å®è·µï¼ŒNode.js å®˜æ–¹å»ºè®®ä½¿ç”¨æ›´ç°ä»£çš„ APIï¼Œæ¯”å¦‚ <code>tls.TLSSocket</code>ï¼Œå®ƒæä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œæ›´å¹¿æ³›çš„åŠ å¯†æ”¯æŒã€‚</p><p>æ€»ä¹‹ï¼Œäº†è§£ TLS/SSL åŠ å¯†å’Œå…¶åœ¨ Node.js ä¸­çš„å®ç°å¯¹äºæ„å»ºå®‰å…¨çš„ç½‘ç»œåº”ç”¨è‡³å…³é‡è¦ã€‚å³ä½¿ <code>tls.SecurePair</code> ä¸å†æ˜¯é¦–é€‰æ–¹æ³•ï¼ŒTLS/SSL åŠ å¯†æœºåˆ¶çš„æ ¸å¿ƒæ¦‚å¿µå’Œåº”ç”¨åœºæ™¯ä¾æ—§å¹¿æ³›å­˜åœ¨äºå„ç§ç½‘ç»œé€šä¿¡ä¸­ã€‚</p><h3 id="event-secure" tabindex="-1"><a class="header-anchor" href="#event-secure"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-secure" target="_blank" rel="noopener noreferrer">Event: &#39;secure&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œå…¶ä¸­ <code>tls</code> æ¨¡å—æ˜¯ç”¨äºå®ç° TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å’Œ SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰åè®®çš„ã€‚è¿™ä¸¤ç§åè®®ä¸»è¦ç”¨äºåœ¨äº’è”ç½‘ä¸Šå®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚</p><p>åœ¨ <code>tls</code> æ¨¡å—ä¸­ï¼Œ<code>&#39;secure&#39;</code> äº‹ä»¶æ˜¯éå¸¸é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚å½“ä½¿ç”¨ TLS/SSL åè®®å»ºç«‹èµ·ä¸€ä¸ªå®‰å…¨è¿æ¥æ—¶ï¼Œ<code>&#39;secure&#39;</code> äº‹ä»¶è¢«è§¦å‘ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-secure-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-secure-äº‹ä»¶"><span>ä»€ä¹ˆæ˜¯ <code>&#39;secure&#39;</code> äº‹ä»¶ï¼Ÿ</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>&#39;secure&#39;</code> äº‹ä»¶è¡¨ç¤ºä¸€ä¸ª TLS æ¡æ‰‹è¿‡ç¨‹å·²ç»å®Œæˆï¼Œæ­¤æ—¶æ•°æ®ä¼ è¾“é€šé“å·²ç»åŠ å¯†ï¼Œå¯ä»¥å¼€å§‹å®‰å…¨åœ°äº¤æ¢æ•°æ®äº†ã€‚è¿™æ˜¯æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¸€ä¸ªå…³é”®æ­¥éª¤ã€‚</p><h3 id="å¦‚ä½•ç›‘å¬-secure-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç›‘å¬-secure-äº‹ä»¶"><span>å¦‚ä½•ç›‘å¬ <code>&#39;secure&#39;</code> äº‹ä»¶ï¼Ÿ</span></a></h3><p>åœ¨ Node.js çš„ <code>tls</code> æ¨¡å—ä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå®‰å…¨æœåŠ¡å™¨ï¼ˆTLS/SSL æœåŠ¡å™¨ï¼‰ï¼Œå¹¶ç›‘å¬ <code>&#39;secure&#39;</code> äº‹ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬å¯†é’¥å’Œè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;secure&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TLS handshake completed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>tls</code> å’Œ <code>fs</code> æ¨¡å—ï¼Œç„¶åå®šä¹‰äº†æœåŠ¡å™¨çš„é…ç½®é€‰é¡¹ï¼ˆåŒ…å«æœåŠ¡å™¨å¯†é’¥å’Œè¯ä¹¦ï¼‰ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œå¹¶åœ¨æœåŠ¡å™¨åˆ›å»ºæˆåŠŸåï¼Œç›‘å¬ <code>&#39;secure&#39;</code> äº‹ä»¶ã€‚å¦‚æœ TLS æ¡æ‰‹æˆåŠŸå®Œæˆï¼Œæ§åˆ¶å°å°†æ‰“å°â€œTLS handshake completedâ€ã€‚</p><h3 id="å®é™…è¿ç”¨æ¡ˆä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨æ¡ˆä¾‹-1"><span>å®é™…è¿ç”¨æ¡ˆä¾‹</span></a></h3><ol><li><p><strong>å®‰å…¨çš„æ•°æ®ä¼ è¾“</strong>ï¼šæ¯”å¦‚ï¼Œç”µå­å•†åŠ¡ç½‘ç«™åœ¨å¤„ç†ç”¨æˆ·çš„æ”¯ä»˜ä¿¡æ¯æ—¶ï¼Œéœ€è¦é€šè¿‡ HTTPSï¼ˆåŸºäº TLS/SSL çš„ HTTPï¼‰ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚</p></li><li><p><strong>é‚®ä»¶ä¼ è¾“åŠ å¯†</strong>ï¼šç”µå­é‚®ä»¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨ TLS æ¥åŠ å¯†é‚®ä»¶å†…å®¹ï¼Œç¡®ä¿é‚®ä»¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚</p></li><li><p><strong>å®‰å…¨çš„å³æ—¶é€šè®¯</strong>ï¼šå¾ˆå¤šå³æ—¶é€šè®¯åº”ç”¨ç¨‹åºä½¿ç”¨ TLS è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿ç”¨æˆ·æ¶ˆæ¯çš„éšç§å’Œå®‰å…¨ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>&#39;secure&#39;</code> äº‹ä»¶åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å®‰å…¨é€šä¿¡çš„åœºåˆã€‚é€šè¿‡ç›‘å¬æ­¤äº‹ä»¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç¡®ä¿åœ¨æ•°æ®äº¤æ¢ä¹‹å‰å»ºç«‹äº†ä¸€ä¸ªå®‰å…¨çš„è¿æ¥ï¼Œä»è€Œä¿æŠ¤æ•°æ®ä¸è¢«æœªæˆæƒçš„ç¬¬ä¸‰æ–¹è®¿é—®ã€‚</p><h2 id="class-tls-server" tabindex="-1"><a class="header-anchor" href="#class-tls-server"><span><a href="https://nodejs.org/docs/latest/api/tls.html#class-tlsserver" target="_blank" rel="noopener noreferrer">Class: tls.Server</a></span></a></h2><p>å½“ç„¶ï¼Œæˆ‘ä¼šå°½åŠ›è®©è§£é‡Šå°½å¯èƒ½é€šä¿—æ˜“æ‡‚ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡ŒäºæœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒèƒ½è®©ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚<code>tls.Server</code>ç±»æ˜¯ Node.js ä¸­æä¾›çš„ä¸€ä¸ªç”¨äº TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰/SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰åŠ å¯†çš„ç½‘ç»œæœåŠ¡å™¨çš„éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œ<code>tls.Server</code>å…è®¸ä½ åˆ›å»ºä¸€ä¸ªå¯ä»¥å®‰å…¨å¤„ç†æ•°æ®ä¼ è¾“çš„æœåŠ¡å™¨ã€‚</p><h3 id="tls-ssl-æ˜¯ä»€ä¹ˆ-1" tabindex="-1"><a class="header-anchor" href="#tls-ssl-æ˜¯ä»€ä¹ˆ-1"><span>TLS/SSL æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>åœ¨è¯¦ç»†è¿›å…¥<code>tls.Server</code>ä¹‹å‰ï¼Œäº†è§£ TLS å’Œ SSL æ˜¯å¾ˆé‡è¦çš„ã€‚TLS å’Œ SSL éƒ½æ˜¯åŠ å¯†åè®®ï¼Œç”¨äºä¿è¯äº’è”ç½‘ä¸Šçš„æ•°æ®ä¼ è¾“æ˜¯å®‰å…¨çš„ã€‚è¿™ä¸»è¦ç”¨äº web æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œä½†ä¹Ÿé€‚ç”¨äºä»»ä½•éœ€è¦æ•°æ®åŠ å¯†çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œç”µå­é‚®ä»¶ã€å³æ—¶é€šè®¯ç­‰ã€‚</p><h3 id="class-tls-server-1" tabindex="-1"><a class="header-anchor" href="#class-tls-server-1"><span>Class: tls.Server</span></a></h3><p><code>tls.Server</code>åŸºæœ¬ä¸Šæ˜¯ HTTP æœåŠ¡å™¨çš„åŠ å¯†ç‰ˆæœ¬ï¼Œå®ƒæ‰©å±•è‡ª<code>net.Server</code>ã€‚<code>net.Server</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªåŸºç¡€ç±»ï¼Œç”¨äºåˆ›å»º TCP æˆ– IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰æœåŠ¡å™¨ã€‚å½“ä½ ä½¿ç”¨<code>tls.createServer(options[, secureConnectionListener])</code>æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ª<code>tls.Server</code>å®ä¾‹ï¼Œè¯¥å®ä¾‹èƒ½å¤Ÿæ¥å—åŠ å¯†çš„è¿æ¥ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ"><span>å¦‚ä½•å·¥ä½œ</span></a></h3><p>å½“å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ Web æµè§ˆå™¨ï¼‰å°è¯•ä¸ä½¿ç”¨ TLS/SSL çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œå°†è¿›è¡Œä¸€ç³»åˆ—ç§°ä¸ºâ€œTLS æ¡æ‰‹â€çš„æ“ä½œã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°†äº’ç›¸éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œå¹¶åå•†åŠ å¯†ç®—æ³•å’Œå¯†é’¥ï¼Œä»¥ç¡®ä¿æ¥ä¸‹æ¥çš„é€šä¿¡æ˜¯åŠ å¯†ä¸”å®‰å…¨çš„ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="åˆ›å»º-tls-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-tls-æœåŠ¡å™¨"><span>åˆ›å»º TLS æœåŠ¡å™¨</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¿æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨çš„åœ¨çº¿æ”¯ä»˜ç³»ç»Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨å°±éå¸¸é‡è¦äº†ã€‚</p><ol><li><p><strong>ç”Ÿæˆç§é’¥å’Œè¯ä¹¦</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦ä¸ºä½ çš„æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªè¯ä¹¦ï¼ˆæˆ–ä»æƒå¨è¯ä¹¦é¢å‘æœºæ„è·å¾—ï¼‰ã€‚è¿™æ˜¯å› ä¸º TLS ä½¿ç”¨è¿™äº›æ¥åŠ å¯†é€šä¿¡å’ŒéªŒè¯æœåŠ¡å™¨çš„èº«ä»½ã€‚</p></li><li><p><strong>åˆ›å»ºæœåŠ¡å™¨</strong>ï¼šä¸€æ—¦æœ‰äº†å¿…è¦çš„å¯†é’¥å’Œè¯ä¹¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„<code>tls</code>æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„æœåŠ¡å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server listening on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ç«¯å£ 8000ã€‚æœåŠ¡å™¨ä½¿ç”¨ä»æ–‡ä»¶åŠ è½½çš„å¯†é’¥å’Œè¯ä¹¦ã€‚æ¯å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šæ‰“å°å‡ºä¸€ä¸ªæ¶ˆæ¯è¡¨æ˜è¿æ¥æ˜¯å¦è¢«æˆæƒï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚</p></li></ol><h4 id="ä½¿ç”¨-tls-è¿æ¥æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-tls-è¿æ¥æ•°æ®åº“"><span>ä½¿ç”¨ TLS è¿æ¥æ•°æ®åº“</span></a></h4><p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œåœ¨ä½ çš„åº”ç”¨ç¨‹åºéœ€è¦ä¸æ•°æ®åº“å®‰å…¨äº¤äº’æ—¶ä½¿ç”¨ TLSã€‚å¾ˆå¤šæ•°æ®åº“æ”¯æŒ TLS åŠ å¯†è¿æ¥ï¼Œé€šè¿‡é…ç½®ä½ çš„æ•°æ®åº“å®¢æˆ·ç«¯ä½¿ç”¨ TLSï¼Œä½ å¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„æ•°æ®ä¼ è¾“æ˜¯å®‰å…¨çš„ã€‚</p><hr><p>æ€»ç»“èµ·æ¥ï¼Œ<code>tls.Server</code>æ˜¯ Node.js ä¸­å¤„ç†åŠ å¯†é€šä¿¡çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œéå¸¸é€‚åˆéœ€è¦æ•°æ®ä¿å¯†å’Œå®Œæ•´æ€§çš„åº”ç”¨åœºæ™¯ã€‚æ— è®ºæ˜¯ä¿æŠ¤ç½‘ç«™ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œè¿˜æ˜¯ç¡®ä¿æ”¯ä»˜äº¤æ˜“çš„å®‰å…¨ï¼Œ<code>tls.Server</code>éƒ½æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚</p><h3 id="event-connection" tabindex="-1"><a class="header-anchor" href="#event-connection"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-connection" target="_blank" rel="noopener noreferrer">Event: &#39;connection&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>Event: &#39;connection&#39;</code>æ˜¯ä¸€ä¸ªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘çš„äº‹ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ç€é‡è®²è§£å®ƒåœ¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰æ¨¡å—çš„ä¸Šä¸‹æ–‡ä¸­çš„åº”ç”¨ã€‚TLS æ¨¡å—ä¸»è¦ç”¨äºåœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å®ç°åŠ å¯†çš„æ•°æ®ä¼ è¾“ï¼Œä»¥ä¿æŠ¤é€šä¿¡çš„éšç§å’Œæ•°æ®å®Œæ•´æ€§ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-1"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p>åœ¨æ·±å…¥è§£é‡Šä¹‹å‰ï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µï¼š</p><ul><li><strong>äº‹ä»¶é©±åŠ¨æ¶æ„</strong>ï¼šNode.js åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“æŸäº›äº‹æƒ…å‘ç”Ÿæ—¶ï¼ˆä¾‹å¦‚ï¼Œç½‘ç»œè¿æ¥å»ºç«‹ï¼‰ï¼Œç›¸åº”çš„äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œè¿›è€Œæ‰§è¡Œå…³è”çš„å¤„ç†å‡½æ•°ã€‚</li><li><strong>EventEmitter ç±»</strong>ï¼šNode.js é€šè¿‡<code>EventEmitter</code>ç±»æä¾›äº†å®ç°äº‹ä»¶å“åº”çš„èƒ½åŠ›ã€‚å„ç§å†…ç½®å¯¹è±¡éƒ½å¯ä»¥å‘å°„ï¼ˆemitï¼‰äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<code>.on()</code>æ–¹æ³•ä¸ºè¿™äº›äº‹ä»¶é™„åŠ å¤„ç†å‡½æ•°ã€‚</li><li><strong>TLS/SSL</strong>ï¼šTLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰åŠå…¶å‰èº« SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰æ˜¯ç”¨äºåŠ å¯†ç½‘ç»œé€šä¿¡çš„æ ‡å‡†æŠ€æœ¯ã€‚</li></ul><h3 id="event-connection-1" tabindex="-1"><a class="header-anchor" href="#event-connection-1"><span><code>Event: &#39;connection&#39;</code></span></a></h3><p>åœ¨ TLS æ¨¡å—ä¸­ï¼Œå½“ä¸€ä¸ªæ–°çš„è¿æ¥è¢«æˆåŠŸå»ºç«‹æ—¶ï¼Œ<code>&#39;connection&#39;</code>äº‹ä»¶ä¼šè¢«è§¦å‘ã€‚å®ƒå…è®¸å¼€å‘è€…å¯¹è¿™ä¸ªæ–°çš„è¿æ¥è¿›è¡Œé…ç½®æˆ–è€…ç®¡ç†ï¼Œæ¯”å¦‚æ£€æŸ¥è¿æ¥çš„å®‰å…¨æ€§å±æ€§ã€ç»‘å®šæ•°æ®æ¥æ”¶å¤„ç†å‡½æ•°ç­‰ã€‚</p><h3 id="å®é™…åº”ç”¨å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨å®ä¾‹"><span>å®é™…åº”ç”¨å®ä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªä½¿ç”¨ TLS åŠ å¯†çš„æœåŠ¡å™¨ï¼Œæ¥å®‰å…¨åœ°æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨<code>&#39;connection&#39;</code>äº‹ä»¶çš„ä¸€ä¸ªç®€å•ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥TLSæ¨¡å—å’Œæ–‡ä»¶ç³»ç»Ÿï¼ˆfsï¼‰æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–SSL/TLSè¯ä¹¦å’Œç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªTLSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨æ–°çš„å®¢æˆ·ç«¯è¿æ¥ä¸ŠæœåŠ¡å™¨æ—¶æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯å·²è¿æ¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®æ•°æ®æ¥æ”¶çš„å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ¥æ”¶åˆ°æ•°æ®: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;connection&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä¸€ä¸ªæ–°çš„è¿æ¥è¢«å»ºç«‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¯ä»¥æ‰§è¡Œä¸æ–°è¿æ¥ç›¸å…³çš„é¢å¤–é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®©æœåŠ¡å™¨ç›‘å¬åœ¨æŒ‡å®šç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1234</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£1234&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ TLS æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªå®‰å…¨æœåŠ¡å™¨ã€‚æœåŠ¡å™¨çš„æ¯æ¬¡æ–°è¿æ¥éƒ½ä¼šè§¦å‘ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼šä¸€ä¸ªæ˜¯åœ¨<code>createServer</code>æ–¹æ³•ä¸­ç›´æ¥å®šä¹‰çš„ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ç»‘å®šåœ¨<code>&#39;connection&#39;</code>äº‹ä»¶ä¸Šçš„ã€‚è¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°éƒ½ä¼šåœ¨æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶æ‰§è¡Œï¼Œä½†å¸¸è§çš„æ¨¡å¼æ˜¯ä½¿ç”¨<code>createServer</code>çš„å›è°ƒå¤„ç†ç‰¹å®šçš„å®¢æˆ·ç«¯é€»è¾‘ï¼ˆå¦‚æ¥æ”¶æ•°æ®ï¼‰ï¼Œè€Œä½¿ç”¨<code>&#39;connection&#39;</code>äº‹ä»¶æ‰§è¡Œä¸€äº›æ›´å¹¿æ³›çš„ä»»åŠ¡ï¼Œå¦‚æ—¥å¿—è®°å½•ã€ç»Ÿè®¡ç­‰ã€‚</p><p>é€šè¿‡ç›‘å¬å’Œå¤„ç†<code>&#39;connection&#39;</code>äº‹ä»¶ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œç®¡ç† TLS æœåŠ¡å™¨çš„è¿æ¥ï¼Œä»è€Œä¸ºç”¨æˆ·æä¾›å®‰å…¨ã€å¯é çš„æœåŠ¡ã€‚</p><h3 id="event-keylog" tabindex="-1"><a class="header-anchor" href="#event-keylog"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-keylog" target="_blank" rel="noopener noreferrer">Event: &#39;keylog&#39;</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç† TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰ç›¸å…³ä»»åŠ¡æ—¶ï¼Œæœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„äº‹ä»¶å«åš<code>&#39;keylog&#39;</code>ã€‚è¿™ä¸ªäº‹ä»¶å¯ä»¥å¸®åŠ©ä½ è·å–åˆ° TLS è¿æ¥è¿‡ç¨‹ä¸­ç”Ÿæˆçš„å…³é”®æ•°æ®ã€‚äº†è§£å¦‚ä½•ä½¿ç”¨è¿™ä¸ªäº‹ä»¶å¯¹äºè¿›è¡Œç½‘ç»œå®‰å…¨åˆ†æå’Œè°ƒè¯•éå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-keylog-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-keylog-äº‹ä»¶"><span>ä»€ä¹ˆæ˜¯ <code>&#39;keylog&#39;</code> äº‹ä»¶ï¼Ÿ</span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js æ¥å»ºç«‹ä¸€ä¸ª TLS è¿æ¥ï¼ˆæ¯”å¦‚é€šè¿‡ HTTPSï¼‰ï¼ŒTLS åè®®ä¸ºäº†ä¿è¯ä¼ è¾“çš„æ•°æ®å®‰å…¨ï¼Œä¼šåœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šé“ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿä¸€äº›å…³é”®çš„åŠ å¯†ææ–™ï¼ˆæ¯”å¦‚å¯†é’¥ï¼‰ã€‚<code>&#39;keylog&#39;</code>äº‹ä»¶å°±æ˜¯ç”¨æ¥æ•è·è¿™äº›åŠ å¯†ææ–™çš„ã€‚æ¯å½“ TLS ä¼šè¯ä¸­ç”Ÿæˆæ–°çš„å¯†é’¥ææ–™æ—¶ï¼Œå°±ä¼šè§¦å‘<code>&#39;keylog&#39;</code>äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶æ¥è·å–è¿™äº›ä¿¡æ¯ã€‚</p><h3 id="å¦‚ä½•ç›‘å¬-keylog-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç›‘å¬-keylog-äº‹ä»¶"><span>å¦‚ä½•ç›‘å¬ <code>&#39;keylog&#39;</code> äº‹ä»¶ï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ”¯æŒ TLS çš„æœåŠ¡ï¼Œæ¯”å¦‚ä¸€ä¸ª HTTPS æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚æ¥ç€ï¼Œä½ å°±å¯ä»¥é€šè¿‡ç›‘å¬<code>&#39;keylog&#39;</code>äº‹ä»¶æ¥è·å–å¯†é’¥ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜å¦‚ä½•å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é…ç½®HTTPSæœåŠ¡å™¨é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your_server_key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½ çš„ç§é’¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your_server_cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½ çš„è¯ä¹¦æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºHTTPSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;keylog&#39; äº‹ä»¶æ¥è·å–TLSå¯†é’¥ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;keylog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">tlsSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Keylog data: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº†<code>https</code>å’Œ<code>fs</code>æ¨¡å—ï¼Œç„¶åé€šè¿‡è¯»å–è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶æ¥é…ç½® HTTPS æœåŠ¡å™¨ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œå¹¶ä¸”é€šè¿‡<code>.on(&#39;keylog&#39;, callback)</code>æ¥ç›‘å¬<code>&#39;keylog&#39;</code>äº‹ä»¶ã€‚ä¸€æ—¦äº‹ä»¶è¢«è§¦å‘ï¼Œæˆ‘ä»¬å°±æ‰“å°å‡ºäº†ç›¸å…³çš„å¯†é’¥ä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨æ¡ˆä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨æ¡ˆä¾‹-2"><span>å®é™…è¿ç”¨æ¡ˆä¾‹</span></a></h3><ol><li><p><strong>ç½‘ç»œå®‰å…¨åˆ†æ</strong>ï¼šå®‰å…¨åˆ†æå¸ˆå¯ä»¥é€šè¿‡ç›‘å¬<code>&#39;keylog&#39;</code>äº‹ä»¶æ¥æ”¶é›† TLS è¿æ¥çš„å¯†é’¥ä¿¡æ¯ï¼Œè¿›è€Œè¾…åŠ©è¿›è¡Œç½‘ç»œé€šä¿¡çš„åŠ å¯†åˆ†æã€‚</p></li><li><p><strong>è°ƒè¯•å’Œæµ‹è¯•</strong>ï¼šå¼€å‘äººå‘˜å¯ä»¥åˆ©ç”¨<code>&#39;keylog&#39;</code>äº‹ä»¶è¾“å‡ºçš„ä¿¡æ¯æ¥è°ƒè¯•å’Œæµ‹è¯• HTTPS è¿æ¥é—®é¢˜ï¼Œç¡®ä¿åŠ å¯†é€šè®¯çš„æ­£ç¡®å®æ–½ã€‚</p></li><li><p><strong>æ•™è‚²å’Œç ”ç©¶</strong>ï¼šå­¦è€…å’Œå­¦ç”Ÿå¯ä»¥é€šè¿‡å®è·µç›‘å¬<code>&#39;keylog&#39;</code>äº‹ä»¶æ¥æ›´æ·±å…¥åœ°ç†è§£ TLS åè®®çš„å·¥ä½œåŸç†å’Œå¯†é’¥äº¤æ¢è¿‡ç¨‹ã€‚</p></li></ol><p>æ€»ç»“èµ·æ¥ï¼Œ<code>&#39;keylog&#39;</code>äº‹ä»¶åœ¨ Node.js ä¸­ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä»¥ä¾¿äºè°ƒè¯•ã€æµ‹è¯•å’Œåˆ†æ TLS åŠ å¯†é€šä¿¡ã€‚é€šè¿‡å®é™…åº”ç”¨ç¤ºä¾‹ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å®ƒçš„ä½¿ç”¨æ–¹å¼å’Œåœºæ™¯ã€‚</p><h3 id="event-newsession" tabindex="-1"><a class="header-anchor" href="#event-newsession"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-newsession" target="_blank" rel="noopener noreferrer">Event: &#39;newSession&#39;</a></span></a></h3><p>Node.js ä¸­çš„<code>&#39;newSession&#39;</code>äº‹ä»¶æ˜¯ä¸ TLS(ä¼ è¾“å±‚å®‰å…¨åè®®)ç›¸å…³çš„ä¸€ä¸ªæ¦‚å¿µã€‚åœ¨æ·±å…¥è§£é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªåŸºæœ¬çš„èƒŒæ™¯çŸ¥è¯†ç‚¹ã€‚</p><h3 id="tls-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#tls-ç®€ä»‹"><span>TLS ç®€ä»‹</span></a></h3><p>TLSï¼Œå³ä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºé—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±æ˜¯ç¡®ä¿ç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®ä¸ä¼šè¢«ç¬¬ä¸‰æ–¹çªƒå¬æˆ–ç¯¡æ”¹çš„ä¸€ç§æŠ€æœ¯æ‰‹æ®µã€‚</p><h3 id="ä¼šè¯-session-çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#ä¼šè¯-session-çš„æ¦‚å¿µ"><span>ä¼šè¯(Session)çš„æ¦‚å¿µ</span></a></h3><p>åœ¨ TLS ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªå®‰å…¨çš„è¿æ¥æ¶‰åŠåˆ°å¤šæ­¥æ¡æ‰‹è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å¯¹è€—æ—¶ã€‚ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼ŒTLS å¼•å…¥äº†â€œä¼šè¯â€çš„æ¦‚å¿µã€‚ä¸€æ—¦ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„ TLS ä¼šè¯è¢«å»ºç«‹ï¼Œå®ƒå¯ä»¥è¢«å­˜å‚¨å¹¶åœ¨æœªæ¥é‡æ–°ä½¿ç”¨ï¼Œä»è€Œé¿å…é‡å¤è¿›è¡Œè€—æ—¶çš„æ¡æ‰‹è¿‡ç¨‹ã€‚</p><h3 id="node-js-ä¸­çš„-newsession-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-newsession-äº‹ä»¶"><span>Node.js ä¸­çš„<code>&#39;newSession&#39;</code>äº‹ä»¶</span></a></h3><p>å½“æˆ‘ä»¬åœ¨ Node.js ä¸­ä½¿ç”¨ TLSï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼‰ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹æ–°çš„ TLS ä¼šè¯æ—¶ï¼ŒNode.js ä¼šè§¦å‘<code>&#39;newSession&#39;</code>äº‹ä»¶ã€‚å¼€å‘è€…å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä»¥æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œæ¯”å¦‚ç¼“å­˜ä¼šè¯ä¿¡æ¯ï¼Œè¿™æ ·å½“ç›¸åŒçš„å®¢æˆ·ç«¯å†æ¬¡å°è¯•è¿æ¥æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å…ˆå‰çš„ä¼šè¯ï¼ŒåŠ é€Ÿæ¡æ‰‹è¿‡ç¨‹ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-6"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="åœºæ™¯æè¿°" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯æè¿°"><span>åœºæ™¯æè¿°</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦é«˜å®‰å…¨æ€§çš„ Web åº”ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘é“¶ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿè¦æ±‚æ‰€æœ‰æ•°æ®ä¼ è¾“å¿…é¡»é€šè¿‡ HTTPS åŠ å¯†ã€‚ç”±äºè¯¥ç³»ç»Ÿæœ‰å¤§é‡çš„ç”¨æˆ·ï¼Œä¸”ç”¨æˆ·ç»å¸¸è®¿é—®ï¼Œå› æ­¤ï¼Œä¼˜åŒ– TLS æ¡æ‰‹çš„æ€§èƒ½å˜å¾—éå¸¸é‡è¦ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç "><span>ç¤ºä¾‹ä»£ç </span></a></h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨<code>&#39;newSession&#39;</code>äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–SSLè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;private-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;certificate.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºHTTPSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;newSession&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">sessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">sessionData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¯ä»¥å°†sessionIdå’ŒsessionDataä¿å­˜åˆ°æŸå¤„ï¼Œæ¯”å¦‚æ•°æ®åº“æˆ–å†…å­˜ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–°çš„TLSä¼šè¯è¢«åˆ›å»º&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç¡®ä¿å›è°ƒè¢«è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;request&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨æ­£åœ¨ç›‘å¬443ç«¯å£&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç æ¼”ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œå¹¶ç›‘å¬<code>&#39;newSession&#39;</code>äº‹ä»¶ã€‚å½“æ–°çš„ TLS ä¼šè¯è¢«åˆ›å»ºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šè®°å½•ä¸€æ¡æ—¥å¿—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šå°†ä¼šè¯ ID å’Œæ•°æ®å­˜å‚¨èµ·æ¥ï¼Œä»¥ä¾¿ä¹‹åé‡ç”¨ï¼Œè¿›è€ŒåŠ é€Ÿ TLS æ¡æ‰‹è¿‡ç¨‹ã€‚</p><p>é€šè¿‡æœ‰æ•ˆåˆ©ç”¨<code>&#39;newSession&#39;</code>äº‹ä»¶ï¼Œå¯ä»¥æ˜¾è‘—æé«˜é¢‘ç¹å»ºç«‹ TLS è¿æ¥çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p><h3 id="event-ocsprequest" tabindex="-1"><a class="header-anchor" href="#event-ocsprequest"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-ocsprequest" target="_blank" rel="noopener noreferrer">Event: &#39;OCSPRequest&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ç§æœºåˆ¶å«åšäº‹ä»¶é©±åŠ¨ï¼ˆEvent-Drivenï¼‰ï¼Œè¿™æ„å‘³ç€ Node.js å¯ä»¥ç›‘å¬å’Œè§¦å‘æŸäº›äº‹ä»¶ã€‚è¿™åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰å¼‚æ­¥ä»»åŠ¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="ocsprequest-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ocsprequest-äº‹ä»¶"><span>OCSPRequest äº‹ä»¶</span></a></h3><p>OCSPRequest æ˜¯ Node.js åœ¨å…¶ <code>tls</code> (ä¼ è¾“å±‚å®‰å…¨åè®®) æ¨¡å—ä¸­å®šä¹‰çš„ä¸€ä¸ªäº‹ä»¶ã€‚OCSP ä»£è¡¨åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOnline Certificate Status Protocolï¼‰ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºè·å– X.509 æ•°å­—è¯ä¹¦åŠé”€çŠ¶æ€çš„äº’è”ç½‘åè®®ã€‚</p><p>å½“ä½¿ç”¨ TLS/SSLï¼ˆå®‰å…¨å¥—æ¥å±‚/ä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®è¿›è¡ŒåŠ å¯†é€šä¿¡æ—¶ï¼Œç¡®ä¿æ•°å­—è¯ä¹¦çš„æœ‰æ•ˆæ€§æ˜¯éå¸¸é‡è¦çš„ã€‚è¯ä¹¦å¯èƒ½å› ä¸ºå¤šç§åŸå› è¢«æ’¤é”€ï¼Œæ¯”å¦‚ç§é’¥æ³„éœ²ã€‚OCSP å…è®¸è®¾å¤‡åœ¨ä¸éœ€è¦ä¸‹è½½å®Œæ•´çš„è¯ä¹¦åŠé”€åˆ—è¡¨ï¼ˆCRLï¼‰çš„æƒ…å†µä¸‹æŸ¥è¯¢è¯ä¹¦çš„çŠ¶æ€ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„ <code>tls</code> æ¨¡å—ä¸­ï¼Œ<code>OCSPRequest</code> äº‹ä»¶æ˜¯åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª OCSP åè®®è¯·æ±‚ä»¥éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„åŠé”€çŠ¶æ€æ—¶è§¦å‘çš„ã€‚</p><h3 id="å®ä¾‹åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åº”ç”¨"><span>å®ä¾‹åº”ç”¨</span></a></h3><h4 id="åœºæ™¯æè¿°-1" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯æè¿°-1"><span>åœºæ™¯æè¿°</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªå®‰å…¨æ•æ„Ÿçš„ç½‘ä¸Šé“¶è¡Œå¹³å°ï¼Œä½ éœ€è¦ç¡®ä¿æ‰€æœ‰é€šè¿‡å¹³å°ä¸ç”¨æˆ·ä¹‹é—´çš„é€šä¿¡éƒ½æ˜¯å®‰å…¨çš„ã€‚å…¶ä¸­ä¸€ä¸ªæ­¥éª¤å°±æ˜¯ç¡®ä¿æœåŠ¡å™¨ä½¿ç”¨çš„ SSL/TLS è¯ä¹¦æ˜¯æœ‰æ•ˆä¸”æœªè¢«æ’¤é”€çš„ã€‚</p><h4 id="å¦‚ä½•ä½¿ç”¨-ocsprequest-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-ocsprequest-äº‹ä»¶"><span>å¦‚ä½•ä½¿ç”¨ OCSPRequest äº‹ä»¶</span></a></h4><ol><li><p><strong>åˆå§‹åŒ– TLS æœåŠ¡å™¨</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ”¯æŒ TLS çš„æœåŠ¡å™¨ã€‚è¿™é€šå¸¸é€šè¿‡ä½¿ç”¨ Node.js çš„ <code>https</code> æˆ– <code>tls</code> æ¨¡å—å®Œæˆã€‚</p></li><li><p><strong>ç›‘å¬ OCSPRequest äº‹ä»¶</strong>ï¼šåœ¨æœåŠ¡å™¨è®¾ç½®ä¸­ï¼Œä½ ä¼šç›‘å¬ <code>OCSPRequest</code> äº‹ä»¶ã€‚å½“å®¢æˆ·ç«¯ï¼ˆå¦‚ç”¨æˆ·çš„æµè§ˆå™¨ï¼‰å°è¯•ä¸æœåŠ¡å™¨å»ºç«‹å®‰å…¨è¿æ¥æ—¶ï¼Œè¯¥äº‹ä»¶ä¼šè¢«è§¦å‘ã€‚</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // socket ç”¨äºä¸å®¢æˆ·ç«¯é€šä¿¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ OCSPRequest äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;OCSPRequest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">issuer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // cert - å®¢æˆ·ç«¯è¯·æ±‚éªŒè¯çš„è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // issuer - è¯ä¹¦çš„é¢å‘æœºæ„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // callback - ç”¨äºå“åº” OCSP è¯·æ±‚çš„å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä½ éœ€è¦è”ç³» OCSP å“åº”æœåŠ¡å™¨æŸ¥è¯¢è¯ä¹¦çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¼ªä»£ç ç¤ºä¾‹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // checkOCSPStatus(cert, issuer).then(status =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  //   if (status.isValid) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  //     callback(null, status.response);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  //   } else {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  //     callback(new Error(&quot;è¯ä¹¦å·²è¢«åŠé”€&quot;));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  //   }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TLS æœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£ 443&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>å¤„ç† OCSP è¯·æ±‚</strong>ï¼šåœ¨ <code>OCSPRequest</code> äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­ï¼Œä½ å°†å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ OCSP è¯·æ±‚ï¼Œå¹¶ä¸”æ ¹æ®æŸ¥è¯¢åˆ°çš„è¯ä¹¦çŠ¶æ€è¿”å›ç›¸åº”çš„ OCSP å“åº”ã€‚</li></ol><p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç ç¤ºä¾‹æ˜¯é«˜åº¦ç®€åŒ–çš„ï¼Œå®é™…åº”ç”¨ä¸­è¿˜éœ€è¦è€ƒè™‘é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•ç­‰è¯¸å¤šæ–¹é¢ã€‚æ­¤å¤–ï¼Œå¤„ç† OCSP è¯·æ±‚é€šå¸¸éœ€è¦ä¸ç¬¬ä¸‰æ–¹çš„ OCSP å“åº”æœåŠ¡å™¨äº¤äº’ï¼Œè¿™éƒ¨åˆ†é€»è¾‘ä¹Ÿéœ€è¦å®ç°ä½†åœ¨ç¤ºä¾‹ä¸­çœç•¥äº†ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>OCSPRequest</code> äº‹ä»¶å…è®¸ä½ åœ¨ Node.js åº”ç”¨ä¸­å¢å¼º TLS/SSL è¯ä¹¦çš„å®‰å…¨æ€§æ£€æŸ¥ï¼Œè¿™å¯¹äºæ„å»ºéœ€è¦é«˜å®‰å…¨æ ‡å‡†çš„åº”ç”¨ï¼ˆå¦‚é‡‘èåº”ç”¨ã€ä¸ªäººä¿¡æ¯å¤„ç†å¹³å°ç­‰ï¼‰æ¥è¯´éå¸¸é‡è¦ã€‚</p><h3 id="event-resumesession" tabindex="-1"><a class="header-anchor" href="#event-resumesession"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-resumesession" target="_blank" rel="noopener noreferrer">Event: &#39;resumeSession&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“å…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„å¹³å°ã€‚åœ¨ Node.js ç³»ç»Ÿä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œ<code>tls</code> æ¨¡å—æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒä¸»è¦ç”¨äºå®ç° TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰/ SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰åè®®çš„åŠ å¯†é€šä¿¡ã€‚è¿™å¯¹äºåˆ›å»ºå®‰å…¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºéå¸¸å…³é”®ï¼Œæ¯”å¦‚å®‰å…¨åœ°ä¼ è¾“æ•°æ®ï¼Œç¡®ä¿æ•°æ®åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹ä¸­ä¸è¢«ç¬¬ä¸‰æ–¹æˆªè·æˆ–ç¯¡æ”¹ã€‚</p><h3 id="event-resumesession-1" tabindex="-1"><a class="header-anchor" href="#event-resumesession-1"><span>Event: &#39;resumeSession&#39;</span></a></h3><p>åœ¨ <code>tls</code> æ¨¡å—ä¸­ï¼Œ<code>&#39;resumeSession&#39;</code> äº‹ä»¶æ˜¯æŒ‡å½“å®¢æˆ·ç«¯å°è¯•é€šè¿‡å‘é€ä¸€ä¸ªä¼šè¯æ ‡è¯†ç¬¦æ¥æ¢å¤ä¹‹å‰çš„ TLS ä¼šè¯æ—¶è§¦å‘çš„äº‹ä»¶ã€‚ç®€å•æ¥è¯´ï¼ŒTLS ä¼šè¯æ¢å¤æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥å‡å°‘åç»­è¿æ¥çš„æ¡æ‰‹æ—¶é—´ï¼Œæé«˜æ•ˆç‡ã€‚</p><h4 id="å·¥ä½œåŸç†-2" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œåŸç†-2"><span>å·¥ä½œåŸç†</span></a></h4><ul><li><strong>TLS æ¡æ‰‹</strong>ï¼šå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œä»–ä»¬è¿›è¡Œäº†ä¸€ä¸ªç§°ä¸ºâ€œæ¡æ‰‹â€çš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹å°†ç¡®è®¤å¯¹æ–¹çš„èº«ä»½ï¼Œå¹¶ä¸”åå•†ä¸€ç³»åˆ—ç”¨äºåŠ å¯†é€šä¿¡çš„å‚æ•°ã€‚</li><li><strong>ä¼šè¯æ ‡è¯†ç¬¦</strong>ï¼šåœ¨åˆæ¬¡æ¡æ‰‹æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªä¼šè¯æ ‡è¯†ç¬¦ï¼ˆSession IDï¼‰ï¼Œå¹¶å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ–¹éƒ½ä¼šä¿å­˜è¿™ä¸ªä¼šè¯çš„ç›¸å…³ä¿¡æ¯ï¼ˆæ¯”å¦‚åŠ å¯†å¯†é’¥ç­‰ï¼‰ã€‚</li><li><strong>ä¼šè¯æ¢å¤</strong>ï¼šå½“å®¢æˆ·ç«¯æƒ³è¦å†æ¬¡ä¸æœåŠ¡ç«¯é€šä¿¡æ—¶ï¼Œå®ƒå¯ä»¥å‘é€ä¹‹å‰ä¿å­˜çš„ä¼šè¯æ ‡è¯†ç¬¦ç»™æœåŠ¡ç«¯ï¼Œè¯·æ±‚æ¢å¤ä¹‹å‰çš„ä¼šè¯ã€‚å¦‚æœæœåŠ¡ç«¯è®¤å¯è¿™ä¸ªä¼šè¯æ ‡è¯†ç¬¦ï¼Œé‚£ä¹ˆåŒæ–¹å°±å¯ä»¥è·³è¿‡åˆå§‹æ¡æ‰‹çš„ä¸€äº›æ­¥éª¤ï¼Œç›´æ¥è¿›å…¥åŠ å¯†é€šä¿¡é˜¶æ®µï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘è¿æ¥å»ºç«‹æ—¶é—´ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><ol><li><p><strong>å®‰å…¨çš„ Web åº”ç”¨è¿æ¥</strong>ï¼š</p><ul><li>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ç”¨æˆ·ç™»å½•çš„ Web åº”ç”¨ï¼Œç”¨æˆ·é¦–æ¬¡ç™»å½•æ—¶ï¼ŒæœåŠ¡å™¨ä¸ç”¨æˆ·æµè§ˆå™¨ä¹‹é—´çš„ TLS æ¡æ‰‹è¿‡ç¨‹ä¼šæ­£å¸¸è¿›è¡Œï¼Œå®ŒæˆåŠ å¯†é€šä¿¡çš„è®¾ç½®ã€‚</li><li>ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…åˆ·æ–°é¡µé¢æˆ–é‡æ–°è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œé€šè¿‡<code>&#39;resumeSession&#39;</code>äº‹ä»¶å¤„ç†ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨å¯ä»¥å¿«é€Ÿæ¢å¤ä¹‹å‰çš„å®‰å…¨ä¼šè¯ï¼Œæ— éœ€é‡æ–°æ‰§è¡Œå®Œæ•´çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«åŠ è½½é€Ÿåº¦å¹¶æå‡ç”¨æˆ·ä½“éªŒã€‚</li></ul></li><li><p><strong>ç‰©è”ç½‘ï¼ˆIoTï¼‰è®¾å¤‡çš„å®‰å…¨è¿æ¥</strong>ï¼š</p><ul><li>åœ¨ IoT åœºæ™¯ä¸­ï¼Œè®¾å¤‡ï¼ˆå¦‚æ™ºèƒ½å®¶å±…æ§åˆ¶å™¨ï¼‰ç»å¸¸éœ€è¦ä¸æœåŠ¡å™¨è¿›è¡Œé¢‘ç¹çš„è¿æ¥ã€‚</li><li>ä½¿ç”¨ä¼šè¯æ¢å¤æœºåˆ¶ï¼Œè®¾å¤‡åœ¨ä¸æœåŠ¡å™¨å»ºç«‹åˆæ¬¡çš„å®‰å…¨è¿æ¥åï¼Œåç»­çš„è¿æ¥å°è¯•å¯ä»¥åˆ©ç”¨<code>&#39;resumeSession&#39;</code>äº‹ä»¶æ¥å¿«é€Ÿæ¢å¤åŠ å¯†ä¼šè¯ï¼Œè¿™ä¸ä»…å‡å°‘äº†è¿æ¥å»ºç«‹çš„æ—¶é—´ï¼Œä¹ŸèŠ‚çœäº†è®¾å¤‡çš„èƒ½æºæ¶ˆè€—ï¼Œå¯¹äºç”µæ± ä¾›ç”µçš„ IoT è®¾å¤‡å°¤ä¸ºé‡è¦ã€‚</li></ul></li></ol><h4 id="å¦‚ä½•ç›‘å¬-resumesession-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç›‘å¬-resumesession-äº‹ä»¶"><span>å¦‚ä½•ç›‘å¬ <code>resumeSession</code> äº‹ä»¶ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // socket å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;resumeSession&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;resumeSession&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">sessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // sessionId: å°è¯•æ¢å¤çš„ä¼šè¯ID</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // callback: ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå®Œæˆä¼šè¯æ¢å¤è¿‡ç¨‹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æŸ¥æ‰¾ä¼šè¯ä¿¡æ¯çš„é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœä¼šè¯ä¿¡æ¯å­˜åœ¨ï¼Œå¯ä»¥è°ƒç”¨callback(null, sessionData)æ¥æ¢å¤ä¼šè¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœä¼šè¯ä¸å­˜åœ¨æˆ–æ¢å¤å¤±è´¥ï¼Œå¯ä»¥è°ƒç”¨callback()ä¸å¸¦å‚æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç¤ºä¾‹ï¼šå‡è®¾æˆ‘ä»¬ç®€å•åœ°æ€»æ˜¯è°ƒç”¨callback()ï¼Œå³ä¸æ¢å¤ä¼šè¯</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ç›‘å¬<code>resumeSession</code>äº‹ä»¶ï¼Œå¼€å‘è€…å¯ä»¥æ§åˆ¶å’Œç®¡ç† TLS ä¼šè¯çš„æ¢å¤è¿‡ç¨‹ï¼Œè¿™å¯¹äºæé«˜å®‰å…¨é€šä¿¡çš„æ•ˆç‡å’Œæ€§èƒ½è‡³å…³é‡è¦ã€‚</p><h3 id="event-secureconnection" tabindex="-1"><a class="header-anchor" href="#event-secureconnection"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-secureconnection" target="_blank" rel="noopener noreferrer">Event: &#39;secureConnection&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js çš„ä¼—å¤šç‰¹æ€§ä¸­ï¼Œäº‹ä»¶å¤„ç†æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå…è®¸æˆ‘ä»¬ä»¥éé˜»å¡ï¼ˆå¼‚æ­¥ï¼‰æ–¹å¼å¤„ç†å„ç§æ“ä½œï¼Œå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚Node.js ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼Œè¿™æ„å‘³ç€æŸäº›èŠ‚ç‚¹ï¼ˆNode.js ä¸­çš„ &quot;events&quot;ï¼‰ä¼šåœ¨ç‰¹å®šçš„æ—¶æœºè§¦å‘ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ä¸€ç§å®ç°å®‰å…¨çš„ä¼ è¾“å±‚åè®®ï¼ˆSecure Transport Layer Protocol, TLS æˆ–å…¶å‰èº« SSLï¼‰çš„æ–¹å¼ã€‚TLS ç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡å®ä½“ä¹‹é—´å»ºç«‹åŠ å¯†é€šé“ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><h3 id="event-secureconnection-1" tabindex="-1"><a class="header-anchor" href="#event-secureconnection-1"><span>Event: &#39;secureConnection&#39;</span></a></h3><p>å½“ä½¿ç”¨ <code>tls</code> æ¨¡å—åˆ›å»ºå®‰å…¨çš„æœåŠ¡å™¨æ—¶ï¼Œ<code>&#39;secureConnection&#39;</code> äº‹ä»¶åœ¨æ–°çš„ TLS/SSL è¿æ¥æˆåŠŸå»ºç«‹åè§¦å‘ã€‚æ­¤äº‹ä»¶æ¯æ¬¡æœ‰æ–°è¿æ¥æ—¶éƒ½ä¼šå‘ç”Ÿï¼Œå¹¶ä¸”æ˜¯åœ¨æ¡æ‰‹è¿‡ç¨‹å®Œæˆåï¼Œä¹Ÿå°±æ˜¯è¯´å®‰å…¨åŠ å¯†å·²ç»å»ºç«‹å®Œæ¯•ä¹‹åã€‚</p><p><strong>å‚æ•°</strong></p><ul><li><code>socket</code>ï¼šæ­¤å‚æ•°æ˜¯ä¸€ä¸ª <code>TLSSocket</code> å®ä¾‹ï¼Œä»£è¡¨å»ºç«‹èµ·æ¥çš„å®‰å…¨è¿æ¥ã€‚ä½ å¯ä»¥é€šè¿‡è¿™ä¸ª <code>socket</code> å¯¹è±¡æ¥ä¸å¯¹æ–¹è¿›è¡Œæ•°æ®é€šè®¯æˆ–è·å–è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ã€‚</li></ul><p><strong>å®é™…è¿ç”¨çš„ä¾‹å­</strong></p><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦å®‰å…¨è¿æ¥çš„æœåŠ¡ï¼Œæ¯”å¦‚ä¸€ä¸ª HTTPS æœåŠ¡å™¨æˆ–è€…éœ€è¦åŠ å¯†ä¼ è¾“çš„è‡ªå®šä¹‰åè®®æœåŠ¡ã€‚</p><ol><li><strong>æ„å»º HTTPS æœåŠ¡å™¨</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ è½½è¯ä¹¦å’Œç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server.cert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secureConnection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®‰å…¨è¿æ¥å·²ç»å»ºç«‹ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½ å¯ä»¥åœ¨è¿™é‡Œåˆ©ç”¨ socket å¯¹è±¡ä¸å®¢æˆ·ç«¯é€šä¿¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ 8000 ç«¯å£ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>æ„å»ºåŸºäº TLS çš„è‡ªå®šä¹‰å®‰å…¨åè®®æœåŠ¡</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server.cert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯è¿æ¥å·²å»ºç«‹ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¯ä»¥ç›´æ¥é€šè¿‡ socket ä¸å®¢æˆ·ç«¯é€šä¿¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secureConnection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®‰å…¨è¿æ¥å·²ç»å»ºç«‹ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ 8000 ç«¯å£ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ— è®ºæ˜¯æ„å»º HTTPS æœåŠ¡å™¨è¿˜æ˜¯åŸºäº TLS çš„è‡ªå®šä¹‰å®‰å…¨åè®®æœåŠ¡ï¼Œå…³é”®ç‚¹åœ¨äºï¼š</p><ul><li>åˆ›å»ºæœåŠ¡æ—¶ä¼ å…¥åŒ…å«å¯†é’¥å’Œè¯ä¹¦çš„é€‰é¡¹ã€‚</li><li>ç›‘å¬ <code>secureConnection</code> äº‹ä»¶ä»¥ç¡®è®¤å®‰å…¨é“¾æ¥å·²å»ºç«‹ï¼Œå¹¶å¯é€šè¿‡å›è°ƒå‡½æ•°ä¸­çš„ <code>socket</code> å‚æ•°ä¸å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ã€‚</li></ul><p>è¿™æ ·ï¼Œæ¯å½“æ–°çš„å®¢æˆ·ç«¯å®‰å…¨åœ°è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨æ—¶ï¼Œä½ å°±å¯ä»¥é€šè¿‡ <code>socket</code> å¯¹è±¡æ¥å‘é€æˆ–æ¥æ”¶æ•°æ®ï¼ŒåŒæ—¶ç¡®ä¿æ‰€æœ‰ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚</p><h3 id="event-tlsclienterror" tabindex="-1"><a class="header-anchor" href="#event-tlsclienterror"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-tlsclienterror" target="_blank" rel="noopener noreferrer">Event: &#39;tlsClientError&#39;</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥å¼€å‘æœåŠ¡å™¨ç«¯çš„è½¯ä»¶ã€‚å…¶ä¸­ï¼Œå®ƒæä¾›äº†å¾ˆå¤šæ¨¡å—ï¼Œè®©å¤„ç†ç½‘ç»œé€šä¿¡ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰æˆä¸ºå¯èƒ½ã€‚ä»Šå¤©æˆ‘ä»¬èšç„¦çš„æ˜¯<code>tls</code>æ¨¡å—ã€‚</p><h3 id="tls-æ¨¡å—ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#tls-æ¨¡å—ç®€ä»‹"><span>TLS æ¨¡å—ç®€ä»‹</span></a></h3><p>TLS ä»£è¡¨ä¼ è¾“å±‚å®‰å…¨æ€§(Transport Layer Security)ï¼Œè¿™æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œæ—¨åœ¨ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨å’Œæ•°æ®å®Œæ•´æ€§ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>tls</code>æ¨¡å—æä¾›äº† TLS/SSL åè®®çš„å®ç°ï¼Œå…è®¸ä½ ä»¥åŠ å¯†å½¢å¼ä¼ é€æ•°æ®ï¼Œä¿éšœé€šä¿¡å®‰å…¨ã€‚</p><h3 id="äº‹ä»¶-tlsclienterror" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶-tlsclienterror"><span>äº‹ä»¶: &#39;tlsClientError&#39;</span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ°<code>tlsClientError</code>è¿™ä¸ªäº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨è®¨è®º TLS æ¨¡å—å†…ä¸€ä¸ªç‰¹å®šæƒ…å†µçš„å¤„ç†æ–¹å¼ã€‚åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­ï¼Œè¿™ä¸ªäº‹ä»¶è¢«å®šä¹‰ä¸ºå½“å®¢æˆ·ç«¯åœ¨ TLS æ¡æ‰‹æœŸé—´é‡åˆ°é”™è¯¯ï¼ˆä¾‹å¦‚è¯ä¹¦éªŒè¯å¤±è´¥ï¼‰æ—¶è§¦å‘ã€‚</p><p>è¿™ä¸ªäº‹ä»¶ä¼ é€’ç»™ç›‘å¬å™¨ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>error</code>ï¼šè¡¨ç¤ºå‘ç”Ÿçš„é”™è¯¯ï¼Œæ˜¯ä¸€ä¸ª<code>Error</code>å¯¹è±¡ã€‚</li><li><code>tlsSocket</code>ï¼šæŒ‡çš„æ˜¯é‡åˆ°é”™è¯¯çš„é‚£ä¸ª<code>TLSSocket</code>å®ä¾‹ã€‚</li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†é€šä¿¡çš„åº”ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘ä¸Šé“¶è¡Œç³»ç»Ÿã€‚ç”¨æˆ·ä¸é“¶è¡ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½å¿…é¡»é€šè¿‡å®‰å…¨çš„æ–¹å¼è¿›è¡Œã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ TLS æ¥åŠ å¯†è¿™äº›æ•°æ®ä¼ è¾“å˜å¾—è‡³å…³é‡è¦ã€‚</p><h4 id="è®¾ç½®æœåŠ¡å™¨ä»¥ç›‘å¬tlsclienterror" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®æœåŠ¡å™¨ä»¥ç›‘å¬tlsclienterror"><span>è®¾ç½®æœåŠ¡å™¨ä»¥ç›‘å¬<code>tlsClientError</code></span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ­£å¸¸çš„socketå¤„ç†æµç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬tlsClientErroräº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tlsClientError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å®¢æˆ·ç«¯TLSæ¡æ‰‹å‡ºé”™: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destroyed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TLSè¿æ¥é”™è¯¯ã€‚</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨å¯åŠ¨åœ¨8000ç«¯å£ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨ TLS åŠ å¯†çš„æœåŠ¡å™¨ã€‚å¦‚æœåœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é”™è¯¯ï¼ˆæ¯”å¦‚å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªæ— æ•ˆçš„è¯ä¹¦ï¼‰ï¼Œ<code>tlsClientError</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œç„¶åæˆ‘ä»¬æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶å‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯è¡¨ç¤ºè¿æ¥å‡ºé”™ã€‚</p><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h3><p>é€šè¿‡<code>tlsClientError</code>äº‹ä»¶ï¼ŒNode.js å…è®¸å¼€å‘è€…åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­æ•è·å’Œå¤„ç†å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¿™å¯¹äºè¯†åˆ«è¯ä¹¦é—®é¢˜ã€è°ƒè¯•å®‰å…¨é…ç½®æˆ–ä»…ä»…è®°å½•é”™è¯¯å°è¯•éƒ½éå¸¸æœ‰ç”¨ã€‚ç†è§£å’Œåˆç†åˆ©ç”¨è¿™ä¸ªäº‹ä»¶ï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºæ›´åŠ ç¨³å›ºã€å®‰å…¨çš„ç½‘ç»œåº”ç”¨ã€‚</p><h3 id="server-addcontext-hostname-context" tabindex="-1"><a class="header-anchor" href="#server-addcontext-hostname-context"><span><a href="https://nodejs.org/docs/latest/api/tls.html#serveraddcontexthostname-context" target="_blank" rel="noopener noreferrer">server.addContext(hostname, context)</a></span></a></h3><p>Node.js ä¸­çš„ <code>server.addContext(hostname, context)</code> æ–¹æ³•æ˜¯åœ¨ <code>tls</code> æ¨¡å—ä¸­ä½¿ç”¨çš„ï¼Œä¸»è¦ç”¨äº TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰æœåŠ¡å™¨ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ ä¸ºç‰¹å®šçš„ä¸»æœºåé…ç½®ä¸åŒçš„ SSL/TLS é€‰é¡¹ã€‚åœ¨å®è·µä¸­ï¼Œå®ƒå¯ä»¥è®©å•ä¸€çš„ TLS æœåŠ¡å™¨å¤„ç†å¤šä¸ªåŸŸåï¼ˆhostnameï¼‰ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸€ä¸ªåŸŸåæä¾›ä¸åŒçš„è¯ä¹¦ã€‚è¿™ç§æŠ€æœ¯å¸¸è¢«ç§°ä¸º SNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒSNI è®©æœåŠ¡å™¨åœ¨æ¡æ‰‹é˜¶æ®µå°±çŸ¥é“å®¢æˆ·ç«¯æƒ³è¦è¿æ¥å“ªä¸ªä¸»æœº/åŸŸåï¼Œå¹¶ä¸”æœåŠ¡å™¨å¯ä»¥åŸºäºè¿™ä¸ªä¿¡æ¯è¿”å›æ­£ç¡®çš„è¯ä¹¦ã€‚</p><h3 id="ç¤ºä¾‹è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹è§£é‡Š"><span>ç¤ºä¾‹è§£é‡Š</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸¤ä¸ªåŸŸåï¼š<code>example.com</code> å’Œ <code>another-example.com</code>ã€‚å¦‚æœä½ æƒ³è¦ä¸€ä¸ª Node.js æœåŠ¡å™¨åŒæ—¶ä¸ºè¿™ä¸¤ä¸ªåŸŸåæœåŠ¡ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªåŸŸåä½¿ç”¨ä¸åŒçš„ SSL/TLS è¯ä¹¦ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å¯¼å…¥æ‰€éœ€çš„æ¨¡å—å¹¶åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œä½†ä¸ç«‹å³ä¸ºå®ƒé…ç½®ä»»ä½•è¯ä¹¦ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ³¨æ„ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸åœ¨è¿™é‡Œè®¾ç½® key æˆ– cert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server listening on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½¿ç”¨ <code>addContext</code> æ–¹æ³•åˆ†åˆ«æ·»åŠ æ¯ä¸ªåŸŸåå’Œå…¶å¯¹åº”çš„è¯ä¹¦ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;another-example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;another-example.com-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;another-example.com-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fs.readFileSync</code> æ–¹æ³•ç”¨äºè¯»å–ç£ç›˜ä¸Šå­˜å‚¨çš„ç§é’¥å’Œè¯ä¹¦æ–‡ä»¶ã€‚é€šè¿‡ç»™ <code>addContext</code> æ–¹æ³•ä¼ é€’ä¸åŒçš„ä¸»æœºåå’ŒåŒ…å«å„è‡ªå¯†é’¥åŠè¯ä¹¦çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è®©æœåŠ¡å™¨æ ¹æ®æ­£åœ¨å°è¯•å»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸»æœºååŠ¨æ€é€‰æ‹©åˆé€‚çš„è¯ä¹¦ã€‚</p><p>è¿™æ ·é…ç½®åï¼Œå½“å®¢æˆ·ç«¯å°è¯•é€šè¿‡ SSL/TLS è¿æ¥åˆ° <code>example.com</code> æˆ– <code>another-example.com</code> æ—¶ï¼ŒNode.js æœåŠ¡å™¨ä¼šæ£€æŸ¥ SNI ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è¯·æ±‚çš„ä¸»æœºåæä¾›ç›¸åº”çš„è¯ä¹¦ã€‚è¿™ä½¿å¾—å•ä¸€çš„æœåŠ¡å™¨èƒ½å¤Ÿå®‰å…¨åœ°æœåŠ¡å¤šä¸ªåŸŸåï¼Œè€Œæ²¡æœ‰å¿…è¦ä¸ºæ¯ä¸ªåŸŸåå¯åŠ¨ç‹¬ç«‹çš„æœåŠ¡å™¨å®ä¾‹ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>server.addContext(hostname, context)</code> æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥ä¸ºåŸºäº Node.js çš„ TLS æœåŠ¡å™¨é…ç½®å¤šåŸŸåæ”¯æŒï¼Œæå¤§åœ°å¢å¼ºäº†å…¶ç”¨é€”å’Œçµæ´»æ€§ã€‚</p><h3 id="server-address" tabindex="-1"><a class="header-anchor" href="#server-address"><span><a href="https://nodejs.org/docs/latest/api/tls.html#serveraddress" target="_blank" rel="noopener noreferrer">server.address()</a></span></a></h3><p>Node.js ä¸­çš„ <code>server.address()</code> æ–¹æ³•æ˜¯ç”¨æ¥è·å–ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆ<code>server</code>ï¼‰çš„ç»‘å®šåœ°å€ä¿¡æ¯çš„ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨åœ¨åˆ›å»ºç½‘ç»œæœåŠ¡æ—¶ï¼Œæ¯”å¦‚ HTTP æœåŠ¡å™¨ã€HTTPS æœåŠ¡å™¨æˆ–è€… TCP æœåŠ¡å™¨ç­‰ã€‚å½“ä½ å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨å¹¶è®©å®ƒç›‘å¬ç‰¹å®šçš„ IP åœ°å€å’Œç«¯å£å·æ—¶ï¼Œä½¿ç”¨ <code>server.address()</code> å¯ä»¥å¸®åŠ©ä½ è·å–åˆ°è¯¥æœåŠ¡å™¨å®é™…ç›‘å¬çš„åœ°å€ä¿¡æ¯ã€‚</p><h3 id="åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><p>åœ¨ Node.js çš„ <code>http</code>, <code>https</code>, <code>net</code> ç­‰æ¨¡å—ä¸­ï¼Œåˆ›å»ºäº†æœåŠ¡å™¨å¹¶ä½¿å…¶ç›‘å¬åï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨å·²ç»å¯åŠ¨çš„æœåŠ¡å™¨å®ä¾‹çš„ <code>.address()</code> æ–¹æ³•æ¥è¿”å›æœåŠ¡å™¨æ­£åœ¨ç›‘å¬çš„åœ°å€ã€ç«¯å£å’Œåœ°å€æ—çš„å¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨å¼€å§‹ç›‘å¬ 3000 ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> addr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Server is listening at http://</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">addr</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">addr</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li>æˆ‘ä»¬å¼•å…¥äº† <code>http</code> æ¨¡å—ï¼Œå¹¶ç”¨å®ƒåˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚</li><li>è¿™ä¸ªæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶å“åº” &quot;Hello World&quot; æ–‡æœ¬ã€‚</li><li>æˆ‘ä»¬é€šè¿‡ <code>.listen</code> æ–¹æ³•è®©æœåŠ¡å™¨å¼€å§‹ç›‘å¬æœ¬åœ°æœºå™¨çš„ 3000 ç«¯å£ã€‚</li><li>åœ¨æœåŠ¡å™¨æˆåŠŸç›‘å¬æŒ‡å®šç«¯å£ä¹‹åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>server.address()</code> æ¥è·å–æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</li></ul><h3 id="è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼"><span>è¿”å›å€¼</span></a></h3><p>è°ƒç”¨ <code>server.address()</code> åï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå­—æ®µçš„å¯¹è±¡ï¼š</p><ul><li><code>address</code>: æœåŠ¡å™¨ç»‘å®šçš„ IP åœ°å€ã€‚</li><li><code>port</code>: æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·ã€‚</li><li><code>family</code>: åœ°å€å®¶æ—ï¼Œé€šå¸¸æ˜¯ <code>&#39;IPv4&#39;</code> æˆ–è€… <code>&#39;IPv6&#39;</code>ã€‚</li></ul><p>å¦‚æœæœåŠ¡å™¨è¿˜æœªå¼€å§‹ç›‘å¬ï¼Œåˆ™ä¼šè¿”å› <code>null</code>ã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ol><li><strong>åŠ¨æ€ç«¯å£åˆ†é…</strong>: åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å¸Œæœ›è®©æ“ä½œç³»ç»Ÿä¸ºä½ çš„æœåŠ¡å™¨åˆ†é…ä¸€ä¸ªéšæœºå¯ç”¨çš„ç«¯å£ï¼Œè¿™æ—¶å¯ä»¥åœ¨ <code>listen</code> æ–¹æ³•ä¸­ä¼ é€’ <code>0</code> ä½œä¸ºç«¯å£å·ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨å¼€å§‹ç›‘å¬åï¼Œç”¨ <code>server.address().port</code> è·å–å®é™…åˆ†é…çš„ç«¯å£å·ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Server is listening on port </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p><strong>æ—¥å¿—è®°å½•ä¸ç›‘æ§</strong>: åœ¨å¤§å‹åº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯å¯¹äºæ—¥å¿—è®°å½•å’Œç›‘æ§ç³»ç»Ÿçš„é…ç½®éå¸¸å…³é”®ã€‚é€šè¿‡è®°å½•æ¯ä¸ªå¯åŠ¨çš„æœåŠ¡å™¨å®ä¾‹çš„åœ°å€å’Œç«¯å£ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°è¿½è¸ªé—®é¢˜å’Œæ€§èƒ½ç“¶é¢ˆã€‚</p></li><li><p><strong>å¾®æœåŠ¡æ¶æ„</strong>: åœ¨åŸºäºå¾®æœåŠ¡çš„æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´äº’ç›¸é€šä¿¡å¾ˆå¸¸è§ã€‚å¦‚æœæœåŠ¡å¯åŠ¨æ—¶ä½¿ç”¨çš„æ˜¯åŠ¨æ€ç«¯å£ï¼Œåˆ™å…¶ä»–æœåŠ¡å¯ä»¥é€šè¿‡ä¸€äº›æœåŠ¡å‘ç°æœºåˆ¶è·å–å½“å‰æœåŠ¡çš„å‡†ç¡®åœ°å€å’Œç«¯å£ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ <code>server.address()</code> æ‰®æ¼”äº†é‡è¦è§’è‰²ã€‚</p></li></ol><p>é€šè¿‡ä¸Šè¿°è§£é‡Šå’Œä¾‹å­ï¼Œå¸Œæœ›ä½ èƒ½å¯¹ <code>server.address()</code> æ–¹æ³•åŠå…¶ç”¨é€”æœ‰äº†è¾ƒä¸ºæ¸…æ™°çš„ç†è§£ã€‚</p><h3 id="server-close-callback" tabindex="-1"><a class="header-anchor" href="#server-close-callback"><span><a href="https://nodejs.org/docs/latest/api/tls.html#serverclosecallback" target="_blank" rel="noopener noreferrer">server.close([callback])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js æä¾›äº†éå¸¸ä¸°å¯Œçš„åº“å’Œæ¨¡å—ï¼Œç”¨ä»¥å¤„ç† HTTPã€æ–‡ä»¶ç³»ç»Ÿã€æµæ•°æ®ç­‰å¤šç§ç½‘ç»œå’Œ I/Oï¼ˆè¾“å…¥/è¾“å‡ºï¼‰æ“ä½œã€‚åœ¨è¿™äº›æ¨¡å—ä¸­ï¼Œ<code>tls</code> æ¨¡å—æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒæä¾›äº†åŒ…æ‹¬ TLS/SSL åè®®åœ¨å†…çš„åŠ å¯†åŠŸèƒ½ï¼Œä½¿å¾— Node.js èƒ½å¤Ÿå¤„ç† HTTPS ç­‰åŠ å¯†é€šä¿¡ã€‚</p><p>è®©æˆ‘ä»¬èšç„¦äº <code>server.close([callback])</code> è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒå±äº <code>tls.Server</code> ç±»ï¼Œåœ¨ <code>tls</code> æ¨¡å—ä¸­ä½¿ç”¨ã€‚è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯å…³é—­æœåŠ¡å™¨ï¼Œåœæ­¢æ¥å—æ–°çš„è¿æ¥ï¼Œä½†å·²ç»å»ºç«‹çš„è¿æ¥ä¼šä¿æŒç›´åˆ°å…³é—­ã€‚<code>callback</code> æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå½“æœåŠ¡å™¨æˆåŠŸå…³é—­åä¼šè¢«è°ƒç”¨ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„-https-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„-https-æœåŠ¡å™¨"><span>åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œç”¨äºæ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚å¹¶è¿”å›ä¸€äº›ä¿¡æ¯ã€‚é¦–å…ˆï¼Œä½ éœ€è¦é€šè¿‡ <code>https</code> æ¨¡å—ï¼ˆå®ƒåº•å±‚ä½¿ç”¨äº† <code>tls</code>ï¼‰æ¥åˆ›å»ºæœåŠ¡å™¨ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æœåŠ¡å™¨ç»´æŠ¤æˆ–å‡çº§ï¼Œä½ å¯èƒ½éœ€è¦ä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨ã€‚è¿™æ—¶ï¼Œ<code>server.close([callback])</code> æ–¹æ³•å°±éå¸¸æœ‰ç”¨äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å– SSL è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ 8000 ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œä½ æƒ³è¦åœæ­¢æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server closed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 10ç§’åå…³é—­æœåŠ¡å™¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 8000 ç«¯å£ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶è¿”å›â€œHello Worldâ€ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>setTimeout</code> æ¥æ¨¡æ‹Ÿåœ¨æœåŠ¡å™¨è¿è¡Œä¸€æ®µæ—¶é—´ï¼ˆæ¯”å¦‚ 10 ç§’ï¼‰åéœ€è¦å…³é—­çš„åœºæ™¯ã€‚è°ƒç”¨ <code>server.close()</code> æ–¹æ³•æ—¶ä¼ å…¥äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒä¼šåœ¨æœåŠ¡å™¨æˆåŠŸå…³é—­åæ‰§è¡Œï¼Œæ‰“å°å‡ºâ€œServer closed.â€ã€‚</p><h4 id="åŠ¨æ€ç®¡ç†æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åŠ¨æ€ç®¡ç†æœåŠ¡å™¨"><span>åŠ¨æ€ç®¡ç†æœåŠ¡å™¨</span></a></h4><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®ç‰¹å®šæ¡ä»¶åŠ¨æ€åœ°å¯åŠ¨æˆ–å…³é—­æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½åªå¸Œæœ›åœ¨æœåŠ¡å™¨è´Ÿè½½è¾ƒä½çš„æ—¶å€™æ‰æ¥å—æ–°çš„è¿æ¥ï¼Œæˆ–è€…åœ¨ç³»ç»Ÿéœ€è¦è¿›è¡Œç´§æ€¥ç»´æŠ¤æ—¶å¿«é€Ÿå…³é—­æ‰€æœ‰æœåŠ¡ã€‚é€šè¿‡ç¼–ç¨‹æ–¹å¼åŠ¨æ€è°ƒç”¨ <code>server.close([callback])</code>ï¼Œå¯ä»¥è®©è¿™ä¸€åˆ‡å˜å¾—å¯èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªæ£€æŸ¥æœåŠ¡å™¨è´Ÿè½½çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> checkServerLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿”å›å½“å‰æœåŠ¡å™¨è´Ÿè½½æ˜¯å¦è¿‡é«˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// éšæœºæ¨¡æ‹Ÿ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®šæœŸæ£€æŸ¥æœåŠ¡å™¨è´Ÿè½½</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">checkServerLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;High load detected, closing server...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Server closed due to high load.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ¯éš” 5 ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µã€‚å¦‚æœæ£€æµ‹åˆ°è´Ÿè½½è¿‡é«˜ï¼Œæˆ‘ä»¬å°±å…³é—­æœåŠ¡å™¨æ¥é˜»æ­¢æ–°çš„è¿æ¥ï¼Œä»¥æ­¤æ¥ä¿æŠ¤æœåŠ¡å™¨ä¸è¢«è¿‡åº¦ä½¿ç”¨ã€‚ä¸€æ—¦ <code>server.close()</code> è¢«è°ƒç”¨ï¼Œä¼ å…¥çš„å›è°ƒå‡½æ•°ä¼šåœ¨æœåŠ¡å™¨å…³é—­åæ‰§è¡Œï¼Œæ­¤æ—¶å¯ä»¥è¿›è¡Œé¢å¤–çš„æ¸…ç†å·¥ä½œæˆ–æ˜¯é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚</p><h3 id="server-getticketkeys" tabindex="-1"><a class="header-anchor" href="#server-getticketkeys"><span><a href="https://nodejs.org/docs/latest/api/tls.html#servergetticketkeys" target="_blank" rel="noopener noreferrer">server.getTicketKeys()</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>server.getTicketKeys()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰ç›¸å…³çš„ä¸€ä¸ªåŠŸèƒ½ã€‚è¿™ä¸ªæ–¹æ³•å±äº Node.js ä¸­ç”¨äºå®ç° HTTPS æœåŠ¡å™¨çš„ tls æ¨¡å—ã€‚ä¸ºäº†ç†è§£<code>server.getTicketKeys()</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ TLS Session Tickets å’Œå®ƒä»¬çš„ä½œç”¨ã€‚</p><h3 id="tls-session-tickets-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#tls-session-tickets-ç®€ä»‹"><span>TLS Session Tickets ç®€ä»‹</span></a></h3><p>åœ¨ TLS ä¸­ï¼ŒSession Tickets æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é‡ç”¨å‰ä¸€ä¸ªä¼šè¯çš„å®‰å…¨å‚æ•°æ¥åŠ å¿«åç»­æ¡æ‰‹çš„é€Ÿåº¦ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„â€œç¥¨æ®â€ï¼ˆç”±æœåŠ¡å™¨æä¾›ï¼‰ï¼Œåœ¨ä¹‹åé‡æ–°è¿æ¥æœåŠ¡å™¨æ—¶è·³è¿‡æ˜‚è´µçš„ TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«è¿æ¥é€Ÿåº¦å¹¶å‡å°‘å»¶è¿Ÿã€‚</p><h3 id="server-getticketkeys-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#server-getticketkeys-æ–¹æ³•"><span><code>server.getTicketKeys()</code> æ–¹æ³•</span></a></h3><p>åœ¨ Node.js çš„ tls æ¨¡å—ä¸­ï¼Œ<code>server.getTicketKeys()</code>æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå…è®¸ä½ è·å–å½“å‰ç”¨äºåˆ›å»ºå’ŒéªŒè¯ TLS Session Tickets çš„å¯†é’¥ã€‚è¿™äº›å¯†é’¥æ˜¯ä¿è¯å®‰å…¨é€šä¿¡ä¸è¢«æœªæˆæƒè®¿é—®è€…æˆªè·çš„å…³é”®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server listening on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–å½“å‰TLS Session Ticket Keys</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> ticketKeys</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTicketKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ticketKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå¯†é’¥ä¿¡æ¯ï¼ˆBufferç±»å‹æ•°æ®ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-1"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªéœ€è¦å¤„ç†å¤§é‡å®‰å…¨è¿æ¥çš„ Web æœåŠ¡ï¼Œå¦‚åœ¨çº¿å•†åº—ã€ç¤¾äº¤ç½‘ç»œæˆ–ä»»ä½•å¤„ç†æ•æ„Ÿæ•°æ®çš„å¹³å°ã€‚é€šè¿‡ä½¿ç”¨ TLS Session Ticketsï¼Œä½ èƒ½å¤Ÿä¸ºå›è®¿ç”¨æˆ·æä¾›æ›´å¿«çš„é‡æ–°è¿æ¥æ—¶é—´ï¼Œæ”¹å–„ä»–ä»¬çš„ä½“éªŒï¼ŒåŒæ—¶ä»ç„¶ä¿æŒé«˜æ°´å¹³çš„é€šä¿¡å®‰å…¨ã€‚<code>server.getTicketKeys()</code>æ–¹æ³•å…è®¸ä½ è®¿é—®å’Œç®¡ç†è¿™äº›ç”¨äºåŠ å¯† Session Tickets çš„å¯†é’¥ï¼Œä»è€Œå¢åŠ äº†ç»´æŒå’Œç›‘æ§æœåŠ¡å™¨å®‰å…¨é…ç½®çš„çµæ´»æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœå‡ºäºå®‰å…¨è€ƒè™‘éœ€è¦å®šæœŸæ›´æ¢å¯†é’¥ï¼Œä½ å¯ä»¥é¦–å…ˆè°ƒç”¨<code>server.getTicketKeys()</code>è·å–å½“å‰å¯†é’¥ï¼Œå¯¹æ¯”æ˜¯å¦åˆ°äº†æ›´æ¢å¯†é’¥çš„æ—¶é—´ç‚¹ï¼Œç„¶åé€šè¿‡<code>server.setTicketKeys(newKeys)</code>è®¾ç½®æ–°çš„å¯†é’¥ã€‚</p><p>æ€»ç»“è€Œè¨€ï¼Œ<code>server.getTicketKeys()</code>æ–¹æ³•åœ¨ç®¡ç†å’Œç»´æŠ¤åŸºäº Node.js çš„ HTTPS æœåŠ¡æ—¶å‘æŒ¥ç€é‡è¦è§’è‰²ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠåˆ°ä¼˜åŒ– SSL/TLS æ€§èƒ½å’Œç¡®ä¿ä¼šè¯å®‰å…¨çš„åœºæ™¯ä¸‹ã€‚</p><h3 id="server-listen" tabindex="-1"><a class="header-anchor" href="#server-listen"><span><a href="https://nodejs.org/docs/latest/api/tls.html#serverlisten" target="_blank" rel="noopener noreferrer">server.listen()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæœåŠ¡å™¨ç«¯åŠç½‘ç»œåº”ç”¨çš„å¼€æºå’Œè·¨å¹³å°è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ï¼Œè¿™æ˜¯ä¸€ç§åœ¨ç½‘é¡µå‰ç«¯å¼€å‘ä¸­å¹¿æ³›ä½¿ç”¨çš„è¯­è¨€ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨åŒä¸€ç§è¯­è¨€ç¼–å†™å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä»£ç ï¼Œä»è€Œä½¿å¼€å‘è¿‡ç¨‹æ›´åŠ é«˜æ•ˆå’Œç»Ÿä¸€ã€‚</p><h3 id="server-listen-1" tabindex="-1"><a class="header-anchor" href="#server-listen-1"><span>server.listen()</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>server.listen()</code> æ–¹æ³•ä¸»è¦ç”¨äºå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ç›‘å¬æŒ‡å®šçš„ç«¯å£å’Œä¸»æœºåœ°å€ã€‚å½“ä½ ä½¿ç”¨ Node.js æ„å»ºç½‘ç»œæœåŠ¡ï¼ˆå¦‚ HTTPã€HTTPSã€TCP ç­‰ï¼‰æ—¶ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨æ­¤æ–¹æ³•æ¥å‘Šè¯‰æœåŠ¡å™¨åœ¨ä½•å¤„ç›‘å¬å…¥ç«™è¿æ¥ã€‚</p><p><code>server.listen()</code> æ–¹æ³•æœ‰å‡ ç§ä¸åŒçš„è°ƒç”¨ç­¾åï¼š</p><ol><li><p><strong>ç›‘å¬ç«¯å£å·</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">backlog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>port</code> æŒ‡å®šæœåŠ¡å™¨åº”è¯¥ç›‘å¬çš„ç«¯å£å·ï¼Œ<code>host</code> æ˜¯å¯é€‰çš„ï¼Œç”¨æ¥è®¾å®šæœåŠ¡å™¨ç›‘å¬çš„ä¸»æœºåæˆ– IP åœ°å€ã€‚<code>backlog</code> ä¹Ÿæ˜¯å¯é€‰çš„ï¼ŒæŒ‡å®šäº†ç­‰å¾…é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼Œå¯¹äºè¶…å‡ºé˜Ÿåˆ—é•¿åº¦çš„è¿æ¥å°†è¢«æ‹’ç»¼æ¥å…¥ã€‚<code>callback</code> æ˜¯åœ¨æœåŠ¡å™¨å¼€å§‹ç›‘å¬åæ‰§è¡Œçš„å‡½æ•°ã€‚</p></li><li><p><strong>ç›‘å¬ UNIX socket æ–‡ä»¶</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">backlog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ç§å½¢å¼è®©ä½ èƒ½å¤Ÿç›‘å¬ Unix å¥—æ¥å­—æ–‡ä»¶ï¼ˆåªåœ¨ UNIX ç±»å‹çš„æ“ä½œç³»ç»Ÿä¸Šæœ‰æ•ˆï¼‰ï¼Œ<code>path</code> æ˜¯ Unix å¥—æ¥å­—æ–‡ä»¶çš„è·¯å¾„ã€‚</p></li><li><p><strong>ä½¿ç”¨é€‰é¡¹å¯¹è±¡</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>options</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­å¯ä»¥åŒ…å«ç«¯å£å·ã€ä¸»æœºåã€è·¯å¾„ç­‰ä¿¡æ¯ï¼Œä»¥åŠå…¶ä»–é…ç½®ã€‚</p></li></ol><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨å¹¶ç›‘å¬-3000-ç«¯å£" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨å¹¶ç›‘å¬-3000-ç«¯å£"><span>ç¤ºä¾‹ 1: åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¹¶ç›‘å¬ 3000 ç«¯å£</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºHTTPæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒåœ¨æ”¶åˆ°è¯·æ±‚æ—¶ä¼šå“åº” &quot;Hello World&quot; æ–‡æœ¬æ¶ˆæ¯ã€‚æœåŠ¡å™¨é€šè¿‡è°ƒç”¨ <code>server.listen(3000, &#39;localhost&#39;)</code> åœ¨ localhost çš„ 3000 ç«¯å£å¼€å§‹ç›‘å¬ã€‚</p><h4 id="ç¤ºä¾‹-2-ç›‘å¬-unix-å¥—æ¥å­—æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç›‘å¬-unix-å¥—æ¥å­—æ–‡ä»¶"><span>ç¤ºä¾‹ 2: ç›‘å¬ Unix å¥—æ¥å­—æ–‡ä»¶</span></a></h4><p>å‡è®¾æˆ‘ä»¬åœ¨ UNIX ç±»å‹çš„æ“ä½œç³»ç»Ÿä¸Šå·¥ä½œï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World via Unix Socket</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ /tmp/server.sock æ˜¯æˆ‘ä»¬çš„å¥—æ¥å­—æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/tmp/server.sock&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on Unix socket at /tmp/server.sock&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•è®©æœåŠ¡å™¨ç›‘å¬ä¸€ä¸ª Unix å¥—æ¥å­—æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼åœ¨è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡(IPC)æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>server.listen()</code> æ–¹æ³•æ˜¯åœ¨ Node.js åº”ç”¨ä¸­å¯åŠ¨æœåŠ¡å™¨çš„æ ‡å‡†æ–¹å¼ã€‚é€šè¿‡æä¾›çµæ´»çš„è°ƒç”¨ç­¾åï¼Œå®ƒå…è®¸å¼€å‘è€…æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„ç›‘å¬æ–¹å¼ã€‚</p><h3 id="server-setsecurecontext-options" tabindex="-1"><a class="header-anchor" href="#server-setsecurecontext-options"><span><a href="https://nodejs.org/docs/latest/api/tls.html#serversetsecurecontextoptions" target="_blank" rel="noopener noreferrer">server.setSecureContext(options)</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>server.setSecureContext(options)</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å…¶å®æ˜¯åœ¨è®¨è®ºå¦‚ä½•å®‰å…¨åœ°ç®¡ç†å’Œæ›´æ–°æœåŠ¡å™¨çš„ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰è®¾ç½®ã€‚TLS æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨äºä¿æŠ¤ç½‘ç»œé€šä¿¡å…å—çªƒå¬å’Œç¯¡æ”¹ã€‚äº†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå¸®åŠ©ç¡®ä¿æˆ‘ä»¬é€šè¿‡ç½‘ç»œå‘é€çš„æ•°æ®ä¿æŒç§å¯†æ€§å’Œå®Œæ•´æ€§ã€‚</p><h3 id="ç†è§£server-setsecurecontext-options" tabindex="-1"><a class="header-anchor" href="#ç†è§£server-setsecurecontext-options"><span>ç†è§£<code>server.setSecureContext(options)</code></span></a></h3><ol><li><p><strong>æ¦‚å¿µ</strong>: <code>setSecureContext</code>æ˜¯ Node.js ä¸­ TLS æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåŠ¨æ€æ›´æ–°æœåŠ¡å™¨çš„åŠ å¯†è®¾ç½®ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨æœåŠ¡å™¨è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥æ›´æ”¹è¯¸å¦‚å¯†é’¥ã€è¯ä¹¦å’Œå¯†ç å¥—ä»¶ç­‰å‚æ•°ï¼Œè€Œæ— éœ€é‡å¯æœåŠ¡å™¨ã€‚</p></li><li><p><strong>å‚æ•°</strong>: <code>options</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å¤šä¸ªå±æ€§æ¥å®šä¹‰ TLS çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼š</p><ul><li><code>cert</code>: å­—ç¬¦ä¸²æˆ– Bufferï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¯ä¹¦ã€‚</li><li><code>key</code>: ç§é’¥ï¼Œç”¨äºè¯ä¹¦ã€‚</li><li><code>ca</code>: ç”¨äºéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„è®¤è¯æœºæ„è¯ä¹¦ã€‚</li><li>ç­‰ç­‰... è¿™äº›é€‰é¡¹å¸®åŠ©é…ç½®å¦‚ä½•å»ºç«‹å®‰å…¨è¿æ¥ã€‚</li></ul></li></ol><h3 id="ä½¿ç”¨åœºæ™¯ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ç¤ºä¾‹"><span>ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</span></a></h3><ol><li><p><strong>åŠ¨æ€æ›´æ–°è¯ä¹¦</strong>:</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ HTTPS æœåŠ¡å™¨ï¼Œå®ƒæä¾›åŠ å¯†çš„ç½‘é¡µå†…å®¹ã€‚è¯ä¹¦é€šå¸¸æœ‰ä¸€ä¸ªæœ‰æ•ˆæœŸé™ï¼Œè¿‡æœŸåéœ€è¦æ›´æ–°ã€‚ä½¿ç”¨<code>setSecureContext</code>å…è®¸ä½ åœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹æ›´æ–°è¯ä¹¦ï¼Œè¿™å¯¹äºç»´æŒæœåŠ¡çš„å¯ç”¨æ€§å¾ˆå…³é”®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹è¯ä¹¦åŠ è½½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¯ä¹¦éœ€è¦æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setSecureContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;new-server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;new-server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯ä¹¦å·²æ›´æ–°ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ ¹æ®ä¸åŒåŸŸåä½¿ç”¨ä¸åŒè¯ä¹¦</strong>:</p><p>å¦‚æœä½ çš„æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªåŸŸåï¼ˆå¤šç§Ÿæˆ·åº”ç”¨ï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªåŸŸåéƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„è¯ä¹¦ï¼Œ<code>setSecureContext</code>å¯ä»¥ç”¨äºæ ¹æ®è¯·æ±‚åŠ¨æ€é€‰æ‹©æ­£ç¡®çš„è¯ä¹¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„ï¼šè¿™ä¸ªç¤ºä¾‹éœ€è¦ç»“åˆSNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºï¼‰ä½¿ç”¨ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®é™…ä»£ç ä¼šæ¶‰åŠåˆ°å¤„ç†SNIå›è°ƒï¼Œå¹¶åœ¨å›è°ƒä¸­ä½¿ç”¨setSecureContextã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1"><span>å°ç»“</span></a></h3><p>é€šè¿‡<code>server.setSecureContext(options)</code>æ–¹æ³•ï¼ŒNode.js ä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥åŠ¨æ€ç®¡ç† TLS è®¾ç½®ï¼Œä»è€Œå¢åŠ äº†åº”ç”¨çš„çµæ´»æ€§å’Œå®‰å…¨æ€§ã€‚æ— è®ºæ˜¯æ›´æ–°è¯ä¹¦ä»¥é˜²æ­¢è¿‡æœŸï¼Œè¿˜æ˜¯æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚åˆ‡æ¢è¯ä¹¦ï¼Œè¿™ä¸ªæ–¹æ³•éƒ½æ˜¾ç¤ºå‡ºå…¶åœ¨ç°ä»£ Web å¼€å‘ä¸­çš„é‡è¦ä»·å€¼ã€‚</p><h3 id="server-setticketkeys-keys" tabindex="-1"><a class="header-anchor" href="#server-setticketkeys-keys"><span><a href="https://nodejs.org/docs/latest/api/tls.html#serversetticketkeyskeys" target="_blank" rel="noopener noreferrer">server.setTicketKeys(keys)</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>server.setTicketKeys(keys)</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªé‡è¦çš„æ¦‚å¿µï¼šTLS, Session Tickets, ä»¥åŠè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨ã€‚æˆ‘å°†å°è¯•ä»¥éå¸¸ç®€æ˜“çš„æ–¹å¼æ¥è®²è§£è¿™äº›ï¼Œå¹¶ç»™å‡ºä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­ã€‚</p><h3 id="tls-ä¼ è¾“å±‚å®‰å…¨æ€§" tabindex="-1"><a class="header-anchor" href="#tls-ä¼ è¾“å±‚å®‰å…¨æ€§"><span>TLS (ä¼ è¾“å±‚å®‰å…¨æ€§)</span></a></h3><p>TLSï¼ˆTransport Layer Securityï¼‰æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œè®¾è®¡ç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›å®‰å…¨é€šä¿¡ã€‚å®ƒå¹¿æ³›ç”¨äºäº’è”ç½‘ä¸Šï¼Œæ¯”å¦‚å½“ä½ è®¿é—®ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ï¼Œåå°å°±åœ¨ä½¿ç”¨ TLS æ¥ä¿æŠ¤ä½ çš„æ•°æ®å®‰å…¨ã€‚</p><h3 id="session-tickets-1" tabindex="-1"><a class="header-anchor" href="#session-tickets-1"><span>Session Tickets</span></a></h3><p>åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼šå»ºç«‹èµ·ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ï¼Œè¿™éœ€è¦ä¸€å®šçš„æ—¶é—´å’Œè®¡ç®—èµ„æºã€‚ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼ŒTLS å¼•å…¥äº† Session Tickets çš„æ¦‚å¿µã€‚å½“ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨å¯ä»¥å‘ç»™å®¢æˆ·ç«¯ä¸€ä¸ª Session Ticketï¼Œè¿™æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠ å¯†æ•°æ®åŒ…ï¼Œé‡Œé¢åŒ…å«äº†é‡æ–°å»ºç«‹è¿æ¥æ‰€éœ€çš„ä¿¡æ¯ã€‚ä¸‹æ¬¡å®¢æˆ·ç«¯å†æ¬¡è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œå®ƒå¯ä»¥å‘é€è¿™ä¸ª Session Ticket è€Œä¸æ˜¯é‡æ–°è¿›è¡Œå®Œæ•´çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘å»¶è¿Ÿå’ŒæœåŠ¡å™¨è´Ÿè½½ã€‚</p><h3 id="server-setticketkeys-keys-1" tabindex="-1"><a class="header-anchor" href="#server-setticketkeys-keys-1"><span>server.setTicketKeys(keys)</span></a></h3><p><code>server.setTicketKeys(keys)</code>æ–¹æ³•æ˜¯åœ¨ Node.js çš„ TLS æœåŠ¡å™¨ä¸­ç”¨æ¥è®¾ç½® Session Tickets åŠ å¯†çš„ç§˜é’¥ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸æœåŠ¡å™¨ç®¡ç†å‘˜æ›´æ¢ç§˜é’¥ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ç§˜é’¥ã€‚è¿™å¯¹äºå¢å¼ºå®‰å…¨æ€§å¾ˆæœ‰å¸®åŠ©ï¼Œå› ä¸ºå¦‚æœç§˜é’¥è¢«æ³„éœ²ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šè§£å¯† Session Tickets å¹¶æ¢å¤ä¼šè¯ã€‚</p><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°</span></a></h4><ul><li><code>keys</code> æ˜¯ä¸€ä¸ª Buffer ç±»å‹ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåŠ å¯† Session Tickets çš„ç§˜é’¥ã€‚</li></ul><p>è¿™é‡Œä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨<code>server.setTicketKeys(keys)</code>ï¼š</p><ol><li><p><strong>åˆ›å»º HTTPS æœåŠ¡å™¨</strong>ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª TLS/HTTPS æœåŠ¡å™¨ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°æŒ‡å®šè¯ä¹¦å’Œç§é’¥ã€‚</p></li><li><p><strong>ç”Ÿæˆç§˜é’¥å¹¶è®¾ç½®</strong>ï¼šæ¥ç€ï¼Œæˆ‘ä»¬ä¼šç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªç§˜é’¥ï¼Œç„¶åç”¨<code>server.setTicketKeys(keys)</code>æ–¹æ³•è®¾ç½®è¿™äº›ç§˜é’¥ã€‚</p></li><li><p><strong>å‘¨æœŸæ€§æ›´æ¢ç§˜é’¥</strong>ï¼šä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥å®šæœŸæ›´æ¢ç§˜é’¥ã€‚</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ è½½SSLè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-server.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-server.crt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”Ÿæˆä¸€ä¸ªéšæœºçš„ç§˜é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> ticketKeys</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">48</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®Session Ticketçš„ç§˜é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTicketKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ticketKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼Œå¹¶åŠ è½½äº† TLS è¯ä¹¦ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œç”Ÿæˆäº†ä¸€ä¸ªéšæœºçš„ 48 å­—èŠ‚ç§˜é’¥ä½œä¸º Session Ticket çš„ç§˜é’¥ï¼Œå¹¶é€šè¿‡<code>setTicketKeys</code>æ–¹æ³•è®¾ç½®äº†è¿™ä¸ªç§˜é’¥ã€‚æœ€åï¼Œæˆ‘ä»¬è®©æœåŠ¡å™¨ç›‘å¬ 443 ç«¯å£ï¼ˆHTTPS æ ‡å‡†ç«¯å£ï¼‰ã€‚</p><h3 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h3><p>ä½¿ç”¨<code>server.setTicketKeys(keys)</code>æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬æ§åˆ¶ TLS Session Ticket çš„åŠ å¯†ç§˜é’¥ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ã€‚é€šè¿‡å®šæœŸæ›´æ¢ç§˜é’¥ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å³ä½¿æ—§çš„ç§˜é’¥è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•åˆ©ç”¨å®ƒæ¥ç ´è§£ç”¨æˆ·çš„ä¼šè¯ã€‚</p><h2 id="class-tls-tlssocket" tabindex="-1"><a class="header-anchor" href="#class-tls-tlssocket"><span><a href="https://nodejs.org/docs/latest/api/tls.html#class-tlstlssocket" target="_blank" rel="noopener noreferrer">Class: tls.TLSSocket</a></span></a></h2><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>tls.TLSSocket</code>è¿™ä¸ªç±»æ—¶ï¼Œæˆ‘ä»¬å…¶å®æ˜¯åœ¨è®²è¿°ä¸å®‰å…¨ä¼ è¾“æœ‰å…³çš„å†…å®¹ã€‚TLS ä»£è¡¨ä¼ è¾“å±‚å®‰å…¨æ€§(Transport Layer Security)ï¼Œå®ƒæ˜¯ä¸€ç§åè®®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡è®¾å¤‡ä¹‹é—´æä¾›åŠ å¯†å’Œæ•°æ®å®Œæ•´æ€§ã€‚ç®€å•æ¥è¯´ï¼Œ<code>tls.TLSSocket</code>å°±æ˜¯åœ¨è¿™ä¸ªå®‰å…¨å±‚ä¸Šå·¥ä½œçš„ä¸€ä¸ªæ¥å£æˆ–è€…è¯´æ˜¯ä¸€ä¸ªç±»ï¼Œä¸“é—¨ç”¨äºå¤„ç†åŠ å¯†çš„æ•°æ®ä¼ è¾“ã€‚</p><p>è¦æ·±å…¥ç†è§£<code>tls.TLSSocket</code>ï¼Œé¦–å…ˆæœ‰å¿…è¦æŠŠå®ƒæ”¾åœ¨å¤§èƒŒæ™¯ä¸‹ï¼šäº’è”ç½‘æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§é—®é¢˜ã€‚å½“ä½ æµè§ˆç½‘é¡µã€å‘é€ç”µå­é‚®ä»¶æˆ–è€…è¿›è¡Œç½‘ä¸Šè´­ç‰©æ—¶ï¼Œä½ çš„æ•°æ®ï¼ˆå¯èƒ½åŒ…æ‹¬æ•æ„Ÿä¿¡æ¯å¦‚å¯†ç ã€ä¿¡ç”¨å¡å·ç ç­‰ï¼‰åœ¨äº’è”ç½‘ä¸Šä¼ è¾“ã€‚ä¸ºäº†ä¿æŠ¤è¿™äº›æ•°æ®ä¸è¢«é»‘å®¢æ‹¦æˆªå’Œçªƒå–ï¼Œä½¿ç”¨ TLS åŠ å¯†è¿™äº›æ•°æ®å°±æ˜¾å¾—éå¸¸é‡è¦ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ-1"><span>å¦‚ä½•å·¥ä½œï¼Ÿ</span></a></h3><p>åœ¨ Node.js åº”ç”¨ä¸­ï¼Œå¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿå®‰å…¨ä¼ è¾“æ•°æ®çš„æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼Œä½ ä¼šç”¨åˆ°<code>tls.TLSSocket</code>ç±»ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªç±»æ—¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª socket å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥è¿æ¥åˆ°æœåŠ¡å™¨æˆ–å…è®¸å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶ä¸”ç¡®ä¿åœ¨è¿™äº›è¿æ¥ä¸Šä¼ è¾“çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯ç»è¿‡åŠ å¯†çš„ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="åˆ›å»ºä¸€ä¸ª-tls-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-tls-æœåŠ¡å™¨"><span>åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æƒ³å»ºç«‹ä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª<code>tls.TLSSocket</code>çš„å®é™…åº”ç”¨åœºæ™¯ã€‚é¦–å…ˆï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª SSL/TLS è¯ä¹¦ã€‚å¯¹äºå¼€å‘ç›®çš„ï¼Œä½ å¯ä»¥è‡ªå·±ç”Ÿæˆä¸€ä¸ªï¼ˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ åº”è¯¥ä»è®¤è¯æœºæ„è·å–ï¼‰ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¥åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–ä½ çš„å¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªTLSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ç«¯å£1234ä¸Šçš„è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1234</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server listening on port 1234&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè½½å…¥<code>tls</code>æ¨¡å—å’Œ<code>fs</code>æ¨¡å—ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è¯»å– SSL/TLS è¯ä¹¦ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œå½“æœåŠ¡å™¨è¿æ¥æ—¶ï¼Œæ£€æŸ¥è¿æ¥æ˜¯å¦è¢«æˆæƒï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚</p><h4 id="åˆ›å»ºä¸€ä¸ª-tls-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-tls-å®¢æˆ·ç«¯"><span>åˆ›å»ºä¸€ä¸ª TLS å®¢æˆ·ç«¯</span></a></h4><p>ä¸æ­¤åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ª TLS å®¢æˆ·ç«¯æ¥è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœæ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œéœ€è¦æŒ‡å®šCAï¼Œå¦åˆ™å°†æ— æ³•å»ºç«‹è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1234</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server ends connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª TLS å®¢æˆ·ç«¯ï¼Œå®ƒè¿æ¥åˆ°åœ¨ç«¯å£ 1234 ä¸Šè¿è¡Œçš„æœåŠ¡å™¨ã€‚é€šè¿‡æŒ‡å®šè¯ä¹¦ï¼Œå®¢æˆ·ç«¯èƒ½å¤ŸéªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œç¡®ä¿è¿æ¥çš„å®‰å…¨æ€§ã€‚</p><h3 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h3><p><code>tls.TLSSocket</code>ç±»æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹å®‰å…¨çš„é€šä¿¡è·¯å¾„ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªç±»ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç¡®ä¿ä»–ä»¬çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹æ—¢å®‰å…¨åˆå¯é ã€‚æ— è®ºæ˜¯åœ¨æ„å»º web åº”ç”¨ã€API è¿˜æ˜¯ä»»ä½•éœ€è¦åŠ å¯†é€šä¿¡çš„åœºæ™¯ä¸­ï¼Œ<code>tls.TLSSocket</code>éƒ½æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ã€‚</p><h3 id="new-tls-tlssocket-socket-options" tabindex="-1"><a class="header-anchor" href="#new-tls-tlssocket-socket-options"><span><a href="https://nodejs.org/docs/latest/api/tls.html#new-tlstlssocketsocket-options" target="_blank" rel="noopener noreferrer">new tls.TLSSocket(socket[, options])</a></span></a></h3><p>å½“ç„¶ï¼Œè®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹è§£æ„è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-node-js" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-node-js"><span>ä»€ä¹ˆæ˜¯ Node.jsï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼ŒNode.js æ˜¯ä¸€ä¸ªå¼€æºå’Œè·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå› ä¸ºå®ƒä½¿å¾—ä½¿ç”¨åŒä¸€ç§è¯­è¨€ï¼ˆå³ JavaScriptï¼‰æ—¢å¯ä»¥ç¼–å†™å‰ç«¯ä»£ç ï¼Œä¹Ÿå¯ä»¥ç¼–å†™åç«¯ä»£ç ã€‚</p><h3 id="tls-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#tls-æ˜¯ä»€ä¹ˆ"><span>TLS æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>TLSï¼ˆTransport Layer Securityï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç›®çš„æ˜¯æä¾›ç½‘ç»œé€šè®¯åŒæ–¹ä¹‹é—´çš„éšç§å’Œæ•°æ®å®Œæ•´æ€§ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ é€šè¿‡äº’è”ç½‘å‘é€ä¿¡æ¯æ—¶ï¼ŒTLS ç¡®ä¿è¿™äº›ä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šè¢«çªƒå¬æˆ–ç¯¡æ”¹ã€‚</p><h3 id="node-js-ä¸­çš„tls-tlssocket" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„tls-tlssocket"><span>Node.js ä¸­çš„<code>tls.TLSSocket</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls.TLSSocket</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒç»§æ‰¿è‡ª<code>net.Socket</code>ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªç»è¿‡ TLS åŠ å¯†çš„ socket è¿æ¥ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨éœ€è¦å®‰å…¨æ•°æ®ä¼ è¾“çš„åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ç½‘ä¸Šé“¶è¡Œã€ç”µå­å•†åŠ¡ç½‘ç«™ä»¥åŠä»»ä½•éœ€è¦ä¿æŠ¤æ•°æ®ä¼ è¾“çš„åœºæ™¯ã€‚</p><h3 id="ä½¿ç”¨new-tls-tlssocket-socket-options" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨new-tls-tlssocket-socket-options"><span>ä½¿ç”¨<code>new tls.TLSSocket(socket[, options])</code></span></a></h3><p>å½“ä½ è°ƒç”¨<code>new tls.TLSSocket(socket[, options])</code>æ—¶ï¼ŒåŸºæœ¬ä¸Šä½ åœ¨åšçš„æ˜¯å°†ä¸€ä¸ªå­˜åœ¨çš„ socketï¼ˆæˆ–è€…è¯´æ˜¯ä¸€ä¸ªç½‘ç»œè¿æ¥ç‚¹ï¼‰è½¬æ¢ä¸ºä½¿ç”¨ TLS åè®®çš„ç‰ˆæœ¬ã€‚è¿™é‡Œçš„<code>socket</code>å‚æ•°æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç½‘ç»œ socketï¼Œè€Œ<code>options</code>å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„å¯¹è±¡ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒæ¥æŒ‡å®šä¸€äº› TLS ç‰¹å®šçš„è®¾ç½®ï¼Œæ¯”å¦‚è¯ä¹¦ä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-7"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä½ æƒ³ç¡®ä¿ç”¨æˆ·é—´çš„æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å®‰å…¨çš„ã€‚è¿™é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨<code>tls.TLSSocket</code>æ¥å®ç°è¿™ä¸€ç‚¹çš„å¤§è‡´æ­¥éª¤ï¼š</p><ol><li><strong>åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ SSL/TLS è¯ä¹¦</strong>ï¼šè¿™æ˜¯å®ç° TLS åŠ å¯†é€šä¿¡çš„å‰æã€‚</li><li><strong>æœåŠ¡å™¨ç«¯ä»£ç </strong>ï¼š <ul><li>åœ¨æœåŠ¡å™¨ä¸Šï¼Œä½ é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ TCP æœåŠ¡å™¨ï¼Œç„¶åä½¿ç”¨<code>tls.TLSSocket</code>æ–¹æ³•å°†æ¯ä¸ªè¿æ¥çš„ socket è½¬æ¢ä¸º TLS åŠ å¯†çš„ socketã€‚</li><li>ä½ éœ€è¦ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿æ¥ä½¿ç”¨æ­£ç¡®çš„è¯ä¹¦å’Œå¯†é’¥æ¥å¯åŠ¨ TLS æ¡æ‰‹è¿‡ç¨‹ã€‚</li></ul></li><li><strong>å®¢æˆ·ç«¯ä»£ç </strong>ï¼š <ul><li>å®¢æˆ·ç«¯ä¹Ÿéœ€è¦ä½¿ç”¨ TLS åŠ å¯†çš„ socket æ¥è¿æ¥åˆ°æœåŠ¡å™¨ã€‚</li><li>å½“å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œå®ƒä¹Ÿéœ€è¦éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡ã€‚</li></ul></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡ç«¯ç¤ºä¾‹ä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™åªæ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨å¯èƒ½ä¼šæ›´å¤æ‚ã€‚ä½†å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£<code>tls.TLSSocket</code>åœ¨ Node.js ä¸­çš„ä½œç”¨åŠå…¶åŸºæœ¬ç”¨æ³•ã€‚</p><h3 id="event-keylog-1" tabindex="-1"><a class="header-anchor" href="#event-keylog-1"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-keylog_1" target="_blank" rel="noopener noreferrer">Event: &#39;keylog&#39;</a></span></a></h3><p>äº†è§£ Node.js ä¸­çš„ <code>&#39;keylog&#39;</code> äº‹ä»¶ï¼Œé¦–å…ˆéœ€è¦æ˜ç™½å®ƒæ˜¯åœ¨ä½•ç§ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·ä¸€ä¸ªäº‹ä»¶ã€‚</p><h3 id="tls-å’Œ-ssl" tabindex="-1"><a class="header-anchor" href="#tls-å’Œ-ssl"><span>TLS å’Œ SSL</span></a></h3><p>TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰å’Œå®ƒçš„å‰èº« SSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰æ˜¯åŠ å¯†åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šçš„ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´æä¾›å®‰å…¨é€šä¿¡ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ï¼Œä½ çš„æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å°±æ˜¯é€šè¿‡ TLS åŠ å¯†çš„ã€‚è¿™ç§åŠ å¯†ä¿æŠ¤äº†æ•°æ®å…å—ç¬¬ä¸‰æ–¹çš„çª¥æ¢æˆ–ç¯¡æ”¹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-keylog-äº‹ä»¶-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-keylog-äº‹ä»¶-1"><span>ä»€ä¹ˆæ˜¯ &#39;keylog&#39; äº‹ä»¶ï¼Ÿ</span></a></h3><p>åœ¨ Node.js çš„ TLS æ¨¡å—ä¸­ï¼Œ<code>&#39;keylog&#39;</code> äº‹ä»¶ç”¨äºè®°å½• TLS ä¼šè¯ä¸­çš„å…³é”®ææ–™ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯¹äºç†è§£å’Œè°ƒè¯• TLS åŠ å¯†éå¸¸æœ‰ä»·å€¼ã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨å®‰å…¨æˆ–ç ”ç©¶çš„èƒŒæ™¯ä¸‹ï¼Œè¢«ç”¨æ¥åˆ†æåŠ å¯†æµé‡æˆ–éªŒè¯ TLS å®ç°çš„æ­£ç¡®æ€§ã€‚</p><p>å½“ TLS è¿æ¥è¿‡ç¨‹ä¸­ç”Ÿæˆæ–°çš„å…³é”®ææ–™ï¼ˆä¾‹å¦‚ï¼Œç”¨äºåŠ å¯†çš„å¯†é’¥ï¼‰æ—¶ï¼Œå°±ä¼šè§¦å‘ <code>&#39;keylog&#39;</code> äº‹ä»¶ã€‚äº‹ä»¶çš„å›è°ƒå‡½æ•°æ¥æ”¶åˆ°ä¸€ä¸ªåŒ…å«å¯†é’¥ææ–™çš„ç¼“å†²åŒºï¼ˆBufferï¼‰ä½œä¸ºå‚æ•°ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="è°ƒè¯•-tls-è¿æ¥" tabindex="-1"><a class="header-anchor" href="#è°ƒè¯•-tls-è¿æ¥"><span>è°ƒè¯• TLS è¿æ¥</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦é€šè¿‡ HTTPS ä¸å¤–éƒ¨æœåŠ¡è¿›è¡Œé€šä¿¡çš„åº”ç”¨ç¨‹åºã€‚å¦‚æœé‡åˆ°åŠ å¯†é—®é¢˜ï¼Œæ¯”å¦‚è¯´æ— æ³•å»ºç«‹å®‰å…¨çš„è¿æ¥ï¼Œé‚£ä¹ˆç›‘å¬<code>&#39;keylog&#39;</code>äº‹ä»¶å¯ä»¥å¸®åŠ©ä½ è·å–åº•å±‚çš„åŠ å¯†å‚æ•°ï¼Œä»è€Œæ›´å®¹æ˜“åœ°æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘keylogæ–‡ä»¶çš„å†™å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> keylogStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;keys.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ›´å¤šçš„TLSé€‰é¡¹...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;Client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&#39;keylog&#39;äº‹ä»¶å¹¶å°†å…³é”®ææ–™å†™å…¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;keylog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  keylogStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS è¿æ¥åˆ°<code>example.com</code>ï¼Œå¹¶ä¸”æ¯å½“ç”Ÿæˆæ–°çš„å¯†é’¥ææ–™æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šå°†å…¶è¿½åŠ åˆ°<code>keys.log</code>æ–‡ä»¶ä¸­ã€‚è¿™å¯¹äºç†è§£ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆéå¸¸æœ‰ç”¨ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©è¯Šæ–­è¿æ¥é—®é¢˜ã€‚</p><h4 id="å®‰å…¨ç ”ç©¶" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨ç ”ç©¶"><span>å®‰å…¨ç ”ç©¶</span></a></h4><p>åœ¨å®‰å…¨ç ”ç©¶é¢†åŸŸï¼Œ<code>&#39;keylog&#39;</code>äº‹ä»¶å¯ç”¨äºæ”¶é›†å®éªŒæ•°æ®ã€‚ç ”ç©¶äººå‘˜å¯èƒ½éœ€è¦åˆ†æä¸åŒ TLS åº“å¦‚ä½•å®ç°åŠ å¯†ï¼Œæˆ–è€…éªŒè¯æ˜¯å¦å­˜åœ¨æŸäº›ç±»å‹çš„æ¼æ´ã€‚é€šè¿‡è®°å½•å’Œåˆ†æ TLS çš„å…³é”®ææ–™ï¼Œä»–ä»¬å¯ä»¥æ·±å…¥äº†è§£ TLS åŠ å¯†æ˜¯å¦‚ä½•åœ¨å®è·µä¸­å·¥ä½œçš„ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><p>è™½ç„¶<code>&#39;keylog&#39;</code>äº‹ä»¶åœ¨è°ƒè¯•å’Œç ”ç©¶ä¸­éå¸¸æœ‰ç”¨ï¼Œä½†ä¹Ÿè¦æ„è¯†åˆ°ï¼Œè®°å½• TLS çš„å…³é”®ææ–™æ¶‰åŠåˆ°äº†æ•æ„Ÿæ•°æ®ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®°å½•è¿™äº›ä¿¡æ¯å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ï¼Œå› æ­¤åº”è¯¥è°¨æ…ä½¿ç”¨ï¼Œå¹¶ç¡®ä¿æ—¥å¿—æ–‡ä»¶å¾—åˆ°é€‚å½“çš„ä¿æŠ¤ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>&#39;keylog&#39;</code>äº‹ä»¶åœ¨ Node.js çš„ TLS æ¨¡å—ä¸­æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡è®°å½• TLS ä¼šè¯çš„å…³é”®ææ–™æ¥å¸®åŠ©å¼€å‘è€…å’Œç ”ç©¶äººå‘˜ç†è§£å’Œè°ƒè¯• TLS åŠ å¯†ã€‚åªè¦å¦¥å–„å¤„ç†è¿™äº›ä¿¡æ¯ï¼Œè¿™ä¸ªåŠŸèƒ½å°±å¯ä»¥æˆä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚</p><h3 id="event-ocspresponse" tabindex="-1"><a class="header-anchor" href="#event-ocspresponse"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-ocspresponse" target="_blank" rel="noopener noreferrer">Event: &#39;OCSPResponse&#39;</a></span></a></h3><p>è¦ç†è§£ Node.js ä¸­çš„ <code>OCSPResponse</code> äº‹ä»¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="èƒŒæ™¯çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#èƒŒæ™¯çŸ¥è¯†"><span>èƒŒæ™¯çŸ¥è¯†</span></a></h3><p><strong>TLS (ä¼ è¾“å±‚å®‰å…¨æ€§)</strong>: åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œæ•°æ®ä¼ è¾“æ—¶ï¼Œä¸ºäº†ä¿éšœæ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œé€šå¸¸ä¼šä½¿ç”¨ TLS åè®®ï¼ˆä¹‹å‰è¢«ç§°ä¸º SSLï¼‰ã€‚è¿™å°±åƒæ˜¯ç»™æ•°æ®ä¼ è¾“åŠ äº†ä¸€æŠŠé”ï¼Œåªæœ‰æ”¶å‘åŒæ–¹æ‰èƒ½æ‰“å¼€ã€‚</p><p><strong>è¯ä¹¦ (Certificate)</strong>: ä½¿ç”¨ TLS æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæä¾›ä¸€ä¸ªè¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ä½ çš„æµè§ˆå™¨ï¼‰ï¼Œä»¥è¯æ˜è‡ªå·±æ˜¯åˆæ³•çš„ã€‚è¿™ä¸ªè¯ä¹¦ç”±ç¬¬ä¸‰æ–¹æœºæ„ï¼ˆCA, è¯ä¹¦é¢å‘æœºæ„ï¼‰ç­¾å‘ã€‚</p><p><strong>OCSP (åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®)</strong>: OCSP å…è®¸è®¾å¤‡æŸ¥è¯¢ä¸€ä¸ªè¯ä¹¦æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼ˆæ¯”å¦‚æ²¡æœ‰è¢«åŠé”€ï¼‰ã€‚åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘æœåŠ¡å™¨è¯·æ±‚è¯ä¹¦çš„çŠ¶æ€ã€‚</p><h3 id="ocspresponse-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ocspresponse-äº‹ä»¶"><span><code>OCSPResponse</code> äº‹ä»¶</span></a></h3><p>åœ¨ Node.js çš„ <code>tls</code> æ¨¡å—ä¸­ï¼Œ<code>OCSPResponse</code> äº‹ä»¶ä¸å¤„ç† OCSP ç›¸å…³å“åº”æœ‰å…³ã€‚å½“æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ª OCSP å“åº”ï¼ˆä½œä¸º TLS æ¡æ‰‹çš„ä¸€éƒ¨åˆ†ï¼‰æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚ä½ å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶æ¥è·å–å’Œå¤„ç† OCSP å“åº”æ•°æ®ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦é«˜å®‰å…¨æ€§çš„é‡‘èåº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨éœ€è¦ç¡®ä¿å®ƒè¿æ¥åˆ°çš„æœåŠ¡å™¨æ˜¯å¯ä¿¡çš„ï¼Œå¹¶ä¸”å®ƒçš„è¯ä¹¦æ²¡æœ‰è¢«åŠé”€ã€‚</p><ol><li><p><strong>åˆ›å»º HTTPS æœåŠ¡å™¨</strong>:<br> é¦–å…ˆï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ªä½¿ç”¨ TLS/SSL çš„ HTTPS æœåŠ¡å™¨ã€‚è¿™ä¸ªæœåŠ¡å™¨ä¼šæœ‰ä¸€ä¸ªè¯ä¹¦ï¼Œè¯ä¹¦æ˜¾ç¤ºæœåŠ¡å™¨æ˜¯è°å¹¶ä¸”æ˜¯ç”±å¯ä¿¡çš„ CA ç­¾å‘çš„ã€‚</p></li><li><p><strong>å®ç° OCSP Stapling</strong>:<br> æ¥ç€ï¼Œä½ çš„æœåŠ¡å™¨è¿˜å¯ä»¥å®ç° OCSP staplingã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨ä¼šå®šæœŸå‘ CA æŸ¥è¯¢è‡ªå·±çš„è¯ä¹¦çŠ¶æ€ï¼Œå¹¶å°†è¿™ä¸ªä¿¡æ¯ &quot;é’‰&quot; åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯å°±ä¸éœ€è¦è‡ªå·±å»æŸ¥è¯¢è¯ä¹¦çŠ¶æ€ï¼Œå‡å°‘äº†å»¶è¿Ÿå’Œè´Ÿæ‹…ã€‚</p></li><li><p><strong>ç›‘å¬ <code>OCSPResponse</code></strong>:<br> åœ¨ä½ çš„ Node.js åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ç›‘å¬ <code>OCSPResponse</code> äº‹ä»¶ï¼š</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // socket å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;OCSPResponse&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;OCSP å“åº”:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;base64&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œä½ å¯ä»¥å¯¹ OCSP å“åº”è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ <code>OCSPResponse</code> äº‹ä»¶ã€‚æ¯å½“æœåŠ¡å™¨æ”¶åˆ° OCSP å“åº”æ—¶ï¼Œå®ƒéƒ½ä¼šæ‰“å°å‡ºå“åº”çš„å†…å®¹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½æƒ³æ›´æ·±å…¥åœ°åˆ†æè¿™ä¸ªå“åº”ï¼Œæ¯”å¦‚éªŒè¯è¯ä¹¦æ˜¯å¦è¢«åŠé”€ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>OCSPResponse</code> äº‹ä»¶åœ¨ Node.js ä¸­å…è®¸ä½ ç›´æ¥å¤„ç†å’Œå“åº” OCSP æ ¡éªŒç»“æœï¼Œè¿™å¯¹äºæ„å»ºéœ€è¦é«˜å®‰å…¨æ€§çš„ç½‘ç»œåº”ç”¨å°¤å…¶é‡è¦ã€‚</p><h3 id="event-secureconnect" tabindex="-1"><a class="header-anchor" href="#event-secureconnect"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-secureconnect" target="_blank" rel="noopener noreferrer">Event: &#39;secureConnect&#39;</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>secureConnect</code> äº‹ä»¶ï¼Œå¹¶ä¸”æˆ‘ä¼šå°½åŠ›è®©è§£é‡Šä¿æŒé€šä¿—æ˜“æ‡‚ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-node-js-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-node-js-1"><span>ä»€ä¹ˆæ˜¯ Node.jsï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ Node.jsï¼šå®ƒæ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js ç‰¹åˆ«é€‚åˆæ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå¦‚ç½‘ç«™åå°æœåŠ¡æˆ– APIã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-1"><span>ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</span></a></h3><p>TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰åè®®çš„ç›®çš„æ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›åŠ å¯†å’Œæ•°æ®å®Œæ•´æ€§ä¿æŠ¤ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªä»¥ &quot;https&quot; å¼€å¤´çš„ç½‘å€æ—¶ï¼Œä½ çš„æµè§ˆå™¨å°±æ˜¯é€šè¿‡ TLS åè®®ä¸æœåŠ¡å™¨å®‰å…¨åœ°é€šä¿¡ã€‚</p><h3 id="secureconnect-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#secureconnect-äº‹ä»¶"><span><code>secureConnect</code> äº‹ä»¶</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—ç”¨äºå®ç°åŸºäº TLS æˆ– SSL çš„åŠ å¯†é€šä¿¡ã€‚<code>secureConnect</code> äº‹ä»¶æ˜¯è¯¥æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåœ¨ TLS æ¡æ‰‹å®Œæˆä¸”å®‰å…¨è¿æ¥å·²ç»å»ºç«‹åè§¦å‘ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä»å¦ä¸€å°æœåŠ¡å™¨å®‰å…¨è·å–æ•°æ®çš„åº”ç”¨ç¨‹åºã€‚è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„ <code>tls</code> æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„å®¢æˆ·ç«¯è¿æ¥ã€‚å½“ <code>secureConnect</code> äº‹ä»¶è§¦å‘æ—¶ï¼Œè¡¨æ˜è¿æ¥å·²å®‰å…¨å»ºç«‹ï¼Œä½ å¯ä»¥å¼€å§‹å®‰å…¨åœ°å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p><h5 id="ç¤ºä¾‹ä»£ç -1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -1"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨çš„è¯ä¹¦é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¡«å†™CAè¯ä¹¦ç­‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯èƒ½è¿˜ä¼šæœ‰key, certç­‰å…¶å®ƒé€‰é¡¹ï¼Œå–å†³äºä½ çš„å®‰å…¨éœ€æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> host</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šä¸»æœºçš„å®‰å…¨è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿æ¥å·²å®‰å…¨å»ºç«‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ secureConnect äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secureConnect&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secureConnect äº‹ä»¶è¢«è§¦å‘ï¼Œæ¡æ‰‹å®Œæˆï¼Œè¿æ¥å®‰å…¨ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½ ç°åœ¨å¯ä»¥å®‰å…¨åœ°å‘é€è¯·æ±‚æˆ–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†è¿æ¥ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå®‰å…¨çš„å®¢æˆ·ç«¯è¿æ¥åˆ° <code>example.com</code>ã€‚æˆ‘ä»¬ç›‘å¬ <code>secureConnect</code> äº‹ä»¶æ¥ç¡®è®¤ä»€ä¹ˆæ—¶å€™è¿æ¥çœŸæ­£å˜å¾—å®‰å…¨ï¼Œç„¶åå¼€å§‹æˆ‘ä»¬çš„æ•°æ®äº¤æ¢ã€‚è®°å¾—å¤„ç†ä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œä»¥ç¡®ä¿ç¨‹åºçš„å¥å£®æ€§ã€‚</p><h5 id="æ³¨æ„ç‚¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„ç‚¹"><span>æ³¨æ„ç‚¹ï¼š</span></a></h5><ul><li>åœ¨ä½¿ç”¨ <code>tls.connect</code> åˆ›å»ºè¿æ¥æ—¶ï¼Œä½ éœ€è¦æä¾›æœåŠ¡å™¨è¯ä¹¦ã€å¯èƒ½çš„å®¢æˆ·ç«¯è¯ä¹¦ç­‰ä¿¡æ¯ã€‚</li><li>ç¡®ä¿åœ¨å®é™…éƒ¨ç½²ä¸­æ­£ç¡®å¤„ç†å’Œå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚è¯ä¹¦æ–‡ä»¶ã€‚</li></ul><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Node.js ä¸­çš„ <code>secureConnect</code> äº‹ä»¶åŠå…¶åº”ç”¨ã€‚</p><h3 id="event-session" tabindex="-1"><a class="header-anchor" href="#event-session"><span><a href="https://nodejs.org/docs/latest/api/tls.html#event-session" target="_blank" rel="noopener noreferrer">Event: &#39;session&#39;</a></span></a></h3><p>å½“ä½ æµè§ˆäº’è”ç½‘æ—¶ï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œäº†ä¸€ç³»åˆ—çš„æ•°æ®äº¤æ¢ã€‚è¿™ç§æ•°æ®äº¤æ¢å¾€å¾€éœ€è¦æ˜¯å®‰å…¨çš„ï¼Œå°¤å…¶æ˜¯å½“ä½ è¾“å…¥æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚å¯†ç æˆ–ä¿¡ç”¨å¡å·ç ï¼‰æ—¶ã€‚ä¸ºäº†ä¿è¯è¿™äº›æ•°æ®çš„å®‰å…¨ï¼Œé€šå¸¸ä¼šä½¿ç”¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼‰æ¥åŠ å¯†è¿™äº›æ•°æ®ã€‚Node.js ä¸­çš„<code>tls</code>æ¨¡å—å°±æä¾›äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ›å»ºåŠ å¯†çš„è¿æ¥ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>tls</code>æ¨¡å—ä¸­æœ‰ä¸€ä¸ªäº‹ä»¶å«ä½œ<code>&#39;session&#39;</code>ã€‚å½“ä½¿ç”¨ TLS å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶è¢«è§¦å‘ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨äºç¼“å­˜å’Œé‡ç”¨ TLS ä¼šè¯ä¿¡æ¯ã€‚ç†è§£ TLS ä¼šè¯å¤ç”¨çš„æ¦‚å¿µå¯¹äºä¼˜åŒ–æ€§èƒ½éå¸¸å…³é”®ã€‚ç®€å•æ¥è¯´ï¼Œæ¯æ¬¡å»ºç«‹ä¸€ä¸ªæ–°çš„ TLS è¿æ¥éƒ½éœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ¡æ‰‹æ“ä½œï¼Œè¿™äº›æ“ä½œæ¶‰åŠåˆ°å¯†é’¥çš„äº¤æ¢ï¼Œæ˜¯éå¸¸æ¶ˆè€—æ—¶é—´çš„ã€‚å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å·²ç»æˆåŠŸå»ºç«‹äº†ä¸€æ¬¡ TLS è¿æ¥ï¼Œå®ƒä»¬å¯ä»¥å°†ä¸€éƒ¨åˆ†ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼ˆç§°ä¸º&quot;ä¼šè¯ä¿¡æ¯&quot;ï¼‰ï¼Œå½“åŒä¸€ä¸ªå®¢æˆ·ç«¯å†æ¬¡å°è¯•è¿æ¥åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä»½å­˜å‚¨èµ·æ¥çš„ä¼šè¯ä¿¡æ¯ï¼Œé¿å…å†æ¬¡è¿›è¡Œå®Œæ•´çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œä»è€ŒåŠ é€Ÿè¿æ¥çš„å»ºç«‹ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸ªåœ¨çº¿è´­ç‰©ç½‘ç«™ï¼Œå®¢æˆ·åœ¨è¿™ä¸ªç½‘ç«™ä¸Šæµè§ˆå•†å“ã€æ·»åŠ åˆ°è´­ç‰©è½¦ï¼Œæœ€åç»“è´¦ã€‚è¿™æ•´ä¸ªè¿‡ç¨‹éƒ½éœ€è¦å®‰å…¨åœ°å¤„ç†å®¢æˆ·çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯åœ¨æ”¯ä»˜é˜¶æ®µè¾“å…¥ä¿¡ç”¨å¡ä¿¡æ¯æ—¶ã€‚ç½‘ç«™æœåŠ¡å™¨å’Œå®¢æˆ·çš„æµè§ˆå™¨ä¹‹é—´çš„æ¯ä¸€æ¬¡æ•°æ®äº¤æ¢ï¼Œéƒ½å¯ä»¥é€šè¿‡å¯ç”¨ TLS æ¥ä¿è¯å®‰å…¨ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -2"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><p>å‡è®¾æˆ‘ä»¬æ˜¯è¯¥ç½‘ç«™çš„å¼€å‘è€…ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œå¹¶æƒ³è¦åˆ©ç”¨<code>&#39;session&#39;</code>äº‹ä»¶æ¥ä¼˜åŒ– TLS è¿æ¥çš„æ€§èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–æœåŠ¡å™¨å¯†é’¥å’Œè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&#39;session&#39;äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;session&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">sessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">sessionData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯ä»¥å°†sessionIdå’ŒsessionDataä¿å­˜ä¸‹æ¥ï¼Œç”¨äºåç»­çš„ä¼šè¯å¤ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Session is saved for reuse.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œä»»ä½•å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œåªè¦ TLS æ¡æ‰‹å®Œæˆï¼Œ<code>&#39;session&#39;</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶æ¥è·å¾—ä¼šè¯ ID å’Œæ•°æ®ã€‚ç„¶åï¼Œåœ¨æœªæ¥ï¼Œå½“ç›¸åŒçš„å®¢æˆ·ç«¯å°è¯•é‡æ–°è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„ä¼šè¯ä¿¡æ¯æ¥åŠ é€Ÿ TLS æ¡æ‰‹è¿‡ç¨‹ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>&#39;session&#39;</code>äº‹ä»¶åœ¨ Node.js çš„<code>tls</code>æ¨¡å—ä¸­æ˜¯ç”¨äºå¤„ç† TLS ä¼šè¯å¤ç”¨çš„ï¼Œè¿™å¯¹äºæé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ï¼Œå‡å°‘å»¶è¿Ÿï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦é¢‘ç¹å»ºç«‹å®‰å…¨è¿æ¥çš„åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><h3 id="tlssocket-address" tabindex="-1"><a class="header-anchor" href="#tlssocket-address"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketaddress" target="_blank" rel="noopener noreferrer">tlsSocket.address()</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>tlsSocket.address()</code>å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºå¦‚ä½•è·å–ä¸€ä¸ªé€šè¿‡ TLS (ä¼ è¾“å±‚å®‰å…¨æ€§)åè®®å»ºç«‹è¿æ¥çš„å¥—æ¥å­—(Socket)çš„åœ°å€ä¿¡æ¯ã€‚è¿™é‡Œæ‰€è¯´çš„ TLSï¼Œæ˜¯ä¸€ç§ç”¨äºåœ¨ç½‘ç»œä¸­ä¼ è¾“æ•°æ®æ—¶ä¿è¯åŠ å¯†å’Œå®‰å…¨æ€§çš„æŠ€æœ¯ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥åˆ†æ­¥éª¤è¯¦ç»†è§£é‡Šå¹¶ä¸¾ä¾‹è¯´æ˜ã€‚</p><h3 id="åŸºç¡€è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€è§£é‡Š"><span>åŸºç¡€è§£é‡Š</span></a></h3><ol><li><p><strong>ä»€ä¹ˆæ˜¯ Socketï¼Ÿ</strong><br> Socket æ˜¯ç½‘ç»œè½¯ä»¶çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œé€šå¸¸ç”¨äºæè¿°ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆç”µè¯é€šè¯ä¸­çš„ä¸€ä¸ªç”µè¯æœºï¼Œä¸€ç«¯å‘é€æ•°æ®ï¼ˆè¯´è¯ï¼‰ï¼Œå¦ä¸€ç«¯æ¥æ”¶æ•°æ®ï¼ˆå¬ï¼‰ã€‚</p></li><li><p><strong>TLS (ä¼ è¾“å±‚å®‰å…¨æ€§)ï¼š</strong><br> TLS æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œè®¾è®¡ç”¨æ¥ä¸ºç½‘ç»œé€šä¿¡æä¾›åŠ å¯†ã€èº«ä»½éªŒè¯å’Œæ•°æ®å®Œæ•´æ€§ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±åƒç»™ç½‘ç»œé€šä¿¡åŠ äº†ä¸€ä¸ªä¿æŠ¤ç›¾ï¼Œç¡®ä¿ä¼ è¾“çš„æ•°æ®æ—¢ä¸ä¼šè¢«çªƒå¬ä¹Ÿä¸ä¼šè¢«ç¯¡æ”¹ã€‚</p></li><li><p><strong><code>tlsSocket.address()</code>å…·ä½“åšä»€ä¹ˆï¼Ÿ</strong><br> åœ¨ Node.js ä¸­ï¼Œå½“ä½ å»ºç«‹äº†ä¸€ä¸ª TLS è¿æ¥ï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼‰ï¼Œä½ å¯èƒ½ä¼šæƒ³çŸ¥é“è¿™ä¸ªè¿æ¥çš„å…·ä½“ç½‘ç»œåœ°å€ä¿¡æ¯ã€‚<code>tlsSocket.address()</code>è¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥è·å–è¿™äº›ä¿¡æ¯çš„ã€‚å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†åœ°å€(<code>address</code>)ã€å®¶æ—(<code>family</code>)ï¼ˆä¾‹å¦‚ IPv4 æˆ– IPv6ï¼‰å’Œç«¯å£å·(<code>port</code>)ã€‚</p></li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-8"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„ Web åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿é“¶è¡Œç³»ç»Ÿã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯ï¼ˆç”¨æˆ·çš„æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ¯æ¬¡é€šä¿¡éƒ½å¿…é¡»æ˜¯åŠ å¯†çš„ï¼Œä»¥ä¿æŠ¤äº¤æ˜“ä¿¡æ¯çš„å®‰å…¨ã€‚è¿™æ—¶å€™ï¼Œä½ å°±éœ€è¦ä½¿ç”¨ TLS æ¥åŠ å¯†è¿™äº›é€šä¿¡ã€‚</p><p>å½“ä¸€ä¸ªå®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼š</p><ol><li><p><strong>å»ºç«‹ TLS è¿æ¥ï¼š</strong><br> æœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ª TLS å¥—æ¥å­—æ¥å¤„ç†è¿™ä¸ªè¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°æ•°å­—è¯ä¹¦å’Œå¯†é’¥çš„äº¤æ¢ï¼Œä»¥ç¡®ä¿é€šä¿¡çš„å®‰å…¨ã€‚</p></li><li><p><strong>ä½¿ç”¨<code>tlsSocket.address()</code>ï¼š</strong><br> ä¸€æ—¦è¿æ¥å»ºç«‹ï¼ŒæœåŠ¡å™¨ç«¯å¯èƒ½éœ€è¦è·å–è¿™ä¸ªè¿æ¥çš„å…·ä½“ç½‘ç»œè¯¦æƒ…ï¼Œæ¯”å¦‚ä¸ºäº†è®°å½•æ—¥å¿—æˆ–è€…è¿›è¡Œç‰¹å®šçš„ç½‘ç»œç­–ç•¥å¤„ç†ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥è°ƒç”¨<code>tlsSocket.address()</code>æ¥è·å–è¿™äº›ä¿¡æ¯ã€‚</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è·å–è¿æ¥çš„åœ°å€ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> addressInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Connected to </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">addressInfo</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">addressInfo</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server started at port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯æˆåŠŸè¿æ¥åˆ°é€šè¿‡ TLS å»ºç«‹çš„æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨ä¼šæ‰“å°å‡ºè¿™ä¸ªè¿æ¥çš„åœ°å€å’Œç«¯å£ä¿¡æ¯ã€‚è¿™å°±æ˜¯<code>tlsSocket.address()</code>å‡½æ•°çš„ä¸€ä¸ªå®é™…åº”ç”¨åœºæ™¯ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>tlsSocket.address()</code>åœ¨ Node.js ä¸­ç”¨äºè·å–ä¸€ä¸ªé€šè¿‡ TLS è¿æ¥çš„å¥—æ¥å­—çš„ç½‘ç»œåœ°å€ä¿¡æ¯ï¼Œå¯¹äºå¼€å‘éœ€è¦åŠ å¯†é€šä¿¡çš„ç½‘ç»œåº”ç”¨æ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><h3 id="tlssocket-authorizationerror" tabindex="-1"><a class="header-anchor" href="#tlssocket-authorizationerror"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketauthorizationerror" target="_blank" rel="noopener noreferrer">tlsSocket.authorizationError</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªèƒ½è®©å¼€å‘è€…ä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„å¹³å°ã€‚åœ¨ Node.js ä¸­, <code>tls</code> æ¨¡å—æä¾›äº† Transport Layer Security (TLS) æˆ– Secure Socket Layer (SSL) çš„åŠ å¯†ä¸å®‰å…¨é€šä¿¡åŠŸèƒ½ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ æµè§ˆç½‘ç«™å¹¶çœ‹åˆ°åœ°å€æ ä¸­çš„å°é”å›¾æ ‡æ—¶ï¼Œé‚£ä¸ªç½‘ç«™å°±æ˜¯é€šè¿‡ç±»ä¼¼ TLS è¿™æ ·çš„åè®®åŠ å¯†çš„ã€‚è¿™å¯¹äºä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§éå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯å¤„ç†æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚å¯†ç æˆ–ä¸ªäººæ•°æ®ï¼‰æ—¶ã€‚</p><h3 id="tlssocket-authorizationerror-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-authorizationerror-1"><span>tlsSocket.authorizationError</span></a></h3><p>åœ¨ <code>tls</code> æ¨¡å—ä¸­ï¼Œ<code>tlsSocket.authorizationError</code> å±æ€§æ˜¯ç”¨æ¥æŒ‡ç¤º TLS æ¡æ‰‹è¿‡ç¨‹ä¸­çš„è®¤è¯é”™è¯¯çš„ã€‚å½“ä½¿ç”¨ TLS åˆ›å»ºå®‰å…¨è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼šè¿›è¡Œä¸€ç³»åˆ—çš„æ¡æ‰‹æ­¥éª¤æ¥ç¡®è®¤å½¼æ­¤çš„èº«ä»½å¹¶å»ºç«‹åŠ å¯†é€šé“ã€‚å¦‚æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼ˆæ¯”å¦‚æ— æ³•éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼‰ï¼Œå°±ä¼šäº§ç”Ÿè®¤è¯é”™è¯¯ã€‚</p><p><code>authorizationError</code> è¿™ä¸ªå±æ€§å°†åŒ…å«å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™èƒ½å¸®åŠ©å¼€å‘è€…ç†è§£ä¸ºä»€ä¹ˆè®¤è¯å¤±è´¥äº†ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¿™ä¸ªå±æ€§å°†æ˜¯ <code>null</code>ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><ol><li><p><strong>å®‰å…¨çš„æ•°æ®ä¼ è¾“</strong>ï¼šå‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªåœ¨çº¿é“¶è¡Œåº”ç”¨ï¼Œç”¨æˆ·éœ€è¦é€šè¿‡äº’è”ç½‘å‘é€ä»–ä»¬çš„æ•æ„Ÿè´¢åŠ¡ä¿¡æ¯ã€‚ä¸ºäº†ä¿æŠ¤è¿™äº›ä¿¡æ¯ä¸è¢«æˆªè·ï¼Œä½ å¯ä»¥ä½¿ç”¨ TLS åˆ›å»ºä¸€ä¸ªåŠ å¯†çš„è¿æ¥ã€‚åœ¨å»ºç«‹è¿™ä¸ªè¿æ¥è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ <code>tlsSocket.authorizationError</code> ä¸ä¸º <code>null</code>ï¼Œè¯´æ˜æœ‰æŸç§é—®é¢˜é˜»ç¢äº†å®‰å…¨è¿æ¥çš„å»ºç«‹ï¼Œä½ å¯èƒ½éœ€è¦å‘Šè¯‰ç”¨æˆ·å½“å‰æ“ä½œæ— æ³•å®‰å…¨å®Œæˆï¼Œå¹¶é‡‡å–è¿›ä¸€æ­¥çš„æªæ–½ã€‚</p></li><li><p><strong>API å®‰å…¨è°ƒç”¨</strong>ï¼šå½“ä½ çš„åº”ç”¨éœ€è¦ä¸å…¶ä»–æœåŠ¡çš„ API è¿›è¡Œå®‰å…¨é€šä¿¡æ—¶ï¼ˆæ¯”å¦‚è·å–å¤©æ°”ä¿¡æ¯æˆ–æ¨é€é€šçŸ¥ï¼‰ï¼Œä½ ä¹Ÿä¼šå€ŸåŠ© TLS æ¥ç¡®ä¿è¿™ç§é€šä¿¡çš„å®‰å…¨ã€‚å¦‚æœå‘ç° <code>tlsSocket.authorizationError</code> æœ‰å…·ä½“çš„é”™è¯¯å€¼ï¼Œæ„å‘³ç€ä½ çš„åº”ç”¨å¯èƒ½æ— æ³•å®‰å…¨åœ°ä¸è¿™äº›å¤–éƒ¨æœåŠ¡è¿›è¡Œä¿¡æ¯äº¤æ¢ï¼Œä½ éœ€è¦æ£€æŸ¥ä½ çš„è¯·æ±‚æ˜¯å¦ç¬¦åˆå®‰å…¨æ ‡å‡†æˆ–æ˜¯å¦éœ€è¦æ›´æ–°è¯ä¹¦ç­‰ä¿¡æ¯ã€‚</p></li><li><p><strong>é‚®ä»¶å‘é€æœåŠ¡</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨åŒ…å«å‘é€ç”µå­é‚®ä»¶çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚æ³¨å†Œç¡®è®¤ã€å¯†ç é‡ç½®ç­‰ï¼‰ï¼Œå¾ˆå¯èƒ½ä¼šé€šè¿‡ TLS ä¿æŠ¤çš„ SMTP æœåŠ¡å™¨å‘é€è¿™äº›é‚®ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå› ä¸ºæŸç§åŸå› å¯¼è‡´ TLS æ¡æ‰‹å¤±è´¥ï¼ˆå¦‚ <code>tlsSocket.authorizationError</code> ä¸ä¸ºç©ºï¼‰ï¼Œä½ çš„åº”ç”¨éœ€è¦èƒ½å¤Ÿå“åº”è¿™ä¸ªé”™è¯¯ï¼Œå¯èƒ½é€šè¿‡å›é€€åˆ°å¤‡é€‰é‚®ä»¶æœåŠ¡å™¨æˆ–é€šçŸ¥ç®¡ç†å‘˜è¿›è¡Œå¹²é¢„ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>tlsSocket.authorizationError</code> æ˜¯ä¸€ä¸ªé‡è¦çš„å±æ€§ï¼Œèƒ½å¸®åŠ©å¼€å‘è€…ç›‘æ§å’Œè°ƒè¯•åŸºäº TLS çš„ç½‘ç»œé€šä¿¡é—®é¢˜ï¼Œç¡®ä¿åº”ç”¨èƒ½å¤Ÿå®‰å…¨å¯é åœ°è¿è¡Œã€‚</p><h3 id="tlssocket-authorized" tabindex="-1"><a class="header-anchor" href="#tlssocket-authorized"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketauthorized" target="_blank" rel="noopener noreferrer">tlsSocket.authorized</a></span></a></h3><p>ç†è§£ <code>tlsSocket.authorized</code> å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ TLS è¿™ä¸ªæ¦‚å¿µã€‚TLS ä»£è¡¨ä¼ è¾“å±‚å®‰å…¨æ€§åè®®(Transport Layer Security)ï¼Œè¿™æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šå®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œå¦‚æœåœ°å€ä»¥â€œhttpsâ€å¼€å¤´ï¼Œé‚£ä¹ˆè¯¥ç½‘ç«™å°±æ˜¯é€šè¿‡ TLS åè®®æ¥åŠ å¯†é€šä¿¡çš„ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls</code>æ¨¡å—æä¾›äº†å®ç° TLS å’Œ SSL(Secure Sockets Layer, TLS çš„å‰èº«)åè®®çš„åŠŸèƒ½ã€‚å½“ä½¿ç”¨è¿™ä¸ªæ¨¡å—åˆ›å»ºä¸€ä¸ªå®‰å…¨è¿æ¥æ—¶ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ï¼Œæ¯ä¸ªè¿æ¥éƒ½ä¼šè¢«è¡¨ç¤ºä¸ºä¸€ä¸ª<code>TLSSocket</code>å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†å…³äºè¿™ä¸ªå®‰å…¨è¿æ¥çš„ä¿¡æ¯å’ŒçŠ¶æ€ã€‚</p><h3 id="tlssocket-authorized-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-authorized-1"><span>tlsSocket.authorized</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tlsSocket.authorized</code>æ˜¯<code>TLSSocket</code>å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆbooleanï¼‰ï¼Œç”¨æ¥æŒ‡ç¤ºå½“å‰çš„ TLS è¿æ¥æ˜¯å¦å·²ç»è¢«æˆæƒã€‚å¦‚æœå®¢æˆ·ç«¯æˆåŠŸéªŒè¯äº†æœåŠ¡å™¨çš„ SSL/TLS è¯ä¹¦ï¼ˆä¹Ÿå°±æ˜¯è¯´è¯ä¹¦æ˜¯ç”±å—ä¿¡ä»»çš„æœºæ„ç­¾å‘çš„ã€æ²¡æœ‰è¿‡æœŸã€ä¸”æ˜¯ç»™å½“å‰æ­£åœ¨è®¿é—®çš„åŸŸåç­¾å‘çš„ç­‰ï¼‰ï¼Œåˆ™<code>tlsSocket.authorized</code>å°†ä¼šæ˜¯<code>true</code>ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼ˆæ¯”å¦‚å‡ºç°äº†è‡ªç­¾åè¯ä¹¦ã€è¯ä¹¦è¿‡æœŸæˆ–è€…è¯ä¹¦çš„åŸŸåä¸å®é™…è®¿é—®çš„åŸŸåä¸ä¸€è‡´ç­‰æƒ…å†µï¼‰ï¼Œåˆ™<code>tlsSocket.authorized</code>ä¼šæ˜¯<code>false</code>ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>åˆ›å»º HTTPS æœåŠ¡å™¨</strong></p><p>å½“ä½ ä½¿ç”¨ Node.js åˆ›å»º HTTPS æœåŠ¡å™¨æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦æ£€æŸ¥æ‰€æœ‰åˆ°è¾¾æœåŠ¡å™¨çš„è¿æ¥æ˜¯å¦éƒ½æœ‰æœ‰æ•ˆçš„è¯ä¹¦ã€‚ä½¿ç”¨<code>tlsSocket.authorized</code>å¯ä»¥å¾ˆå®¹æ˜“å®ç°è¿™ä¸€ç‚¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server.crt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // req.socket æ˜¯ TLSSocket</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">401</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Unauthorized</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at https://localhost:8000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œç„¶åæ£€æŸ¥<code>req.socket.authorized</code>æ¥ç¡®å®šè¿æ¥æ˜¯å¦ç»è¿‡äº†æ­£ç¡®çš„ SSL/TLS è®¤è¯ã€‚</p></li><li><p><strong>å®¢æˆ·ç«¯è¯·æ±‚éªŒè¯</strong></p><p>å½“ä½¿ç”¨ Node.js ä½œä¸ºå®¢æˆ·ç«¯å‘ HTTPS æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦ç¡®è®¤ä½ æ‰€è¿æ¥çš„æœåŠ¡å™¨æ˜¯ä½ æœŸå¾…çš„æœåŠ¡å™¨ï¼ˆå³æœåŠ¡å™¨çš„ SSL/TLS è¯ä¹¦æ˜¯æœ‰æ•ˆçš„ï¼‰ã€‚è™½ç„¶å¤§å¤šæ•°æƒ…å†µä¸‹ Node.js ä¼šè‡ªåŠ¨å®Œæˆè¿™ä¸ªéªŒè¯å¹¶æ‹’ç»è¿æ¥æœªç»æˆæƒçš„æœåŠ¡å™¨ï¼Œä½†æœ‰æ—¶ä½ å¯èƒ½æƒ³è‡ªå·±è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;statusCode:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The server is authorized.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The server is not authorized.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª HTTPS è¯·æ±‚ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°å“åº”æ—¶ï¼Œæ£€æŸ¥<code>res.socket.authorized</code>æ¥åˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦é€šè¿‡è®¤è¯ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œ<code>tlsSocket.authorized</code>æ˜¯ Node.js ä¸­éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°è¯†åˆ«å’Œå¤„ç† TLS è¿æ¥çš„æˆæƒçŠ¶æ€ï¼Œæ— è®ºæ˜¯åœ¨åˆ›å»ºå®‰å…¨çš„æœåŠ¡å™¨ï¼Œè¿˜æ˜¯åœ¨ä½œä¸ºå®¢æˆ·ç«¯å®‰å…¨åœ°è¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨æ—¶ã€‚</p><h3 id="tlssocket-disablerenegotiation" tabindex="-1"><a class="header-anchor" href="#tlssocket-disablerenegotiation"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketdisablerenegotiation" target="_blank" rel="noopener noreferrer">tlsSocket.disableRenegotiation()</a></span></a></h3><p>å½“ç„¶ï¼Œè®©æˆ‘ä»¬å…ˆä»åŸºç¡€å¼€å§‹äº†è§£ Node.js å’Œ TLSï¼Œç„¶åå†æ·±å…¥åˆ° <code>tlsSocket.disableRenegotiation()</code> å‡½æ•°ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†"><span>åŸºç¡€çŸ¥è¯†</span></a></h3><p><strong>Node.js</strong> æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js ä½¿ç”¨äº†éé˜»å¡ã€äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼Œä½¿å…¶æˆä¸ºè½»é‡çº§å’Œé«˜æ•ˆçš„é€‰æ‹©ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥çš„åº”ç”¨ç¨‹åºï¼Œå¦‚ç½‘ç»œæœåŠ¡å™¨ã€‚</p><p><strong>TLS (ä¼ è¾“å±‚å®‰å…¨)</strong> åè®®æ—¨åœ¨ä¸ºç½‘ç»œé€šä¿¡æä¾›åŠ å¯†å’Œæ•°æ®å®Œæ•´æ€§ã€‚å®ƒçš„å‰èº«æ˜¯ SSL (å®‰å…¨å¥—æ¥å­—å±‚)ã€‚åœ¨ Web åº”ç”¨ä¸­ï¼ŒTLS å¯ä»¥ä¿æŠ¤ä¿¡æ¯åœ¨ç”¨æˆ·æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ—¶ä¸è¢«çªƒå¬å’Œç¯¡æ”¹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-é‡åå•†" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-é‡åå•†"><span>ä»€ä¹ˆæ˜¯ TLS é‡åå•†</span></a></h3><p>TLS é‡åå•†æ˜¯ TLS åè®®çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨å·²å»ºç«‹çš„ TLS è¿æ¥ä¸Šåå•†æ–°çš„å®‰å…¨å‚æ•°ã€‚è¿™å¯ä»¥åœ¨è¿æ¥æœŸé—´å‡ºäºå¤šç§åŸå› è¿›è¡Œï¼Œä¾‹å¦‚æ›´æ–°å¯†é’¥æˆ–æ›´æ”¹åŠ å¯†ç®—æ³•ã€‚</p><p>ç„¶è€Œï¼ŒTLS é‡åå•†ä¹Ÿå­˜åœ¨æ½œåœ¨é£é™©ã€‚æ”»å‡»è€…å¯èƒ½åˆ©ç”¨æœªå—é™åˆ¶çš„é‡åå•†æ¥å‘èµ·æ”»å‡»ï¼Œæ¯”å¦‚é‡åå•†æ”»å‡»ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œä»–ä»¬å¯èƒ½å°è¯•æ¶ˆè€—æœåŠ¡å™¨èµ„æºæˆ–æ‰§è¡Œä¸­é—´äººæ”»å‡»ã€‚</p><h3 id="tlssocket-disablerenegotiation-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-disablerenegotiation-1"><span>tlsSocket.disableRenegotiation()</span></a></h3><p><code>tlsSocket.disableRenegotiation()</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨äºç¦æ­¢ TLS è¿æ¥ä¸Šçš„é‡åå•†è¿‡ç¨‹ã€‚ä¸€æ—¦è°ƒç”¨æ­¤å‡½æ•°ï¼Œä»»ä½•å°è¯•é‡æ–°åå•†çš„è¯·æ±‚éƒ½å°†è¢«æ‹’ç»ï¼Œä»è€Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><p>è¿™ä¸ªå‡½æ•°ç‰¹åˆ«é€‚ç”¨äºé‚£äº›éœ€è¦å¤„ç†æ•æ„Ÿä¿¡æ¯å’Œå¸Œæœ›æœ€å¤§åŒ–ä¿æŠ¤å…¶æ•°æ®ä¼ è¾“å®‰å…¨çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡ç¦ç”¨é‡åå•†ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨é¢ä¸´çš„å®‰å…¨å¨èƒï¼Œç‰¹åˆ«æ˜¯é‚£äº›ä¸é‡åå•†ç›¸å…³çš„é£é™©ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåœ¨çº¿é“¶è¡Œç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä½¿ç”¨ Node.js åˆ›å»ºå¹¶ä½¿ç”¨ TLS æ¥ä¿æŠ¤å®¢æˆ·æ•°æ®çš„ä¼ è¾“ã€‚åœ¨è¿™æ ·çš„åœºæ™¯ä¸‹ï¼Œä¿è¯é€šä¿¡çš„å®‰å…¨æ€§æ˜¯è‡³å…³é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ <code>tlsSocket.disableRenegotiation()</code> æ¥æå‡å®‰å…¨æ€§çš„æ­¥éª¤ï¼š</p><ol><li><p><strong>åˆ›å»º TLS æœåŠ¡å™¨ï¼š</strong> é¦–å…ˆï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ªä½¿ç”¨ TLS åè®®çš„æœåŠ¡å™¨ã€‚è¿™é€šå¸¸æ¶‰åŠåŠ è½½ SSL/TLS è¯ä¹¦å¹¶é…ç½®æœåŠ¡å™¨ç›‘å¬ç«¯å£ã€‚</p></li><li><p><strong>ç¦ç”¨é‡åå•†ï¼š</strong> åœ¨æ¯ä¸ªæ–°çš„ TLS è¿æ¥å»ºç«‹åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>tlsSocket.disableRenegotiation()</code> æ¥ç¦ç”¨è¯¥è¿æ¥ä¸Šçš„é‡åå•†ã€‚è¿™ç¡®ä¿äº†å³ä½¿åœ¨è¿æ¥å»ºç«‹åï¼Œä¹Ÿä¸ä¼šå› é‡æ–°åå•†è€Œé™ä½å®‰å…¨æ€§ã€‚</p></li><li><p><strong>å¤„ç†è¯·æ±‚ï¼š</strong> æœåŠ¡å™¨éšåå¤„ç†æ¥è‡ªå®¢æˆ·çš„å®‰å…¨è¯·æ±‚ï¼ŒçŸ¥é“æ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½å—åˆ°ä¿æŠ¤ï¼Œä¸”æ²¡æœ‰é‡åå•†çš„é£é™©ã€‚</p></li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ çš„åœ¨çº¿é“¶è¡Œç³»ç»Ÿå°±èƒ½æœ‰æ•ˆåœ°é™ä½ TLS é‡åå•†å¯èƒ½å¸¦æ¥çš„å®‰å…¨å¨èƒï¼Œç¡®ä¿å®¢æˆ·æ•°æ®çš„ä¼ è¾“æ—¢å®‰å…¨åˆå¯é ã€‚</p><p>æ€»ç»“è€Œè¨€ï¼Œ<code>tlsSocket.disableRenegotiation()</code> æ˜¯ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œç”¨äºå¢å¼ºé€šè¿‡ TLS è¿›è¡Œçš„é€šä¿¡çš„å®‰å…¨æ€§ï¼Œç‰¹åˆ«é€‚ç”¨äºé«˜å®‰å…¨æ€§è¦æ±‚çš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="tlssocket-enabletrace" tabindex="-1"><a class="header-anchor" href="#tlssocket-enabletrace"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketenabletrace" target="_blank" rel="noopener noreferrer">tlsSocket.enableTrace()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“è®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ç¯å¢ƒã€‚å…¶ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†å®ç°äº† SSL å’Œ TLS åè®®çš„ç½‘ç»œå®‰å…¨ä¼ è¾“å±‚ï¼Œè¿™å¯¹äºéœ€è¦åŠ å¯†é€šä¿¡çš„åº”ç”¨æ¥è¯´éå¸¸é‡è¦ã€‚è€Œ <code>tlsSocket.enableTrace()</code> æ–¹æ³•æ˜¯åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒå±äºè¯¥æ¨¡å—ä¸­ <code>TLSSocket</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥é€æ­¥è§£é‡Šä¸€ä¸‹ <code>tlsSocket.enableTrace()</code>ï¼š</p><h3 id="ä»€ä¹ˆæ˜¯-tls-2" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-2"><span>ä»€ä¹ˆæ˜¯ <code>TLS</code>ï¼Ÿ</span></a></h3><ul><li><strong>TLS</strong>ï¼ˆTransport Layer Securityï¼‰å³ä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œæ˜¯ç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§çš„æ ‡å‡†åè®®ã€‚ç®€å•æ¥è¯´ï¼ŒTLS èƒ½å¸®åŠ©ä½ çš„æ•°æ®åœ¨ Internet ä¸Šå®‰å…¨ä¼ è¾“ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯-tlssocket" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tlssocket"><span>ä»€ä¹ˆæ˜¯ <code>TLSSocket</code>ï¼Ÿ</span></a></h3><ul><li>åœ¨ Node.js ä¸­ï¼Œ<code>TLSSocket</code> æ˜¯ä¸€ä¸ªå°è£…äº† TLS åŠ å¯†å’Œç½‘ç»œé€šä¿¡åŠŸèƒ½çš„å¯¹è±¡ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå®‰å…¨çš„â€œé€šé“â€ï¼Œé€šè¿‡å®ƒå‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«è‡ªåŠ¨åŠ å¯†ï¼Œæ¥æ”¶æ–¹åˆ™éœ€è¦ç›¸åº”çš„å¯†é’¥æ‰èƒ½è§£å¯†æŸ¥çœ‹ï¼Œç¡®ä¿äº†æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚</li></ul><h3 id="tlssocket-enabletrace-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#tlssocket-enabletrace-æ–¹æ³•çš„ä½œç”¨"><span><code>tlsSocket.enableTrace()</code> æ–¹æ³•çš„ä½œç”¨</span></a></h3><ul><li>å½“ä½ æƒ³è¦è¯Šæ–­æˆ–è°ƒè¯•ä¸ TLS ç›¸å…³çš„é—®é¢˜æ—¶ï¼Œäº†è§£æ•°æ®æ˜¯å¦‚ä½•åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åŠ å¯†ä¼ è¾“çš„ååˆ†é‡è¦ã€‚<code>tlsSocket.enableTrace()</code> è¿™ä¸ªæ–¹æ³•å…è®¸ <code>TLSSocket</code> å®ä¾‹åœ¨å†…éƒ¨å¯ç”¨è·Ÿè¸ªä¿¡æ¯ã€‚ä¸€æ—¦å¯ç”¨ï¼Œæ¯æ¬¡ TLS æ¡æ‰‹å‘ç”Ÿæˆ–è€…æœ‰ç›¸å…³çš„ç½‘ç»œæ´»åŠ¨æ—¶ï¼Œè¯¦ç»†çš„è·Ÿè¸ªä¿¡æ¯ä¼šè¢«è®°å½•ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©å¼€å‘è€…ç†è§£åº•å±‚çš„ TLS å·¥ä½œæµç¨‹ï¼Œä¾¿äºè°ƒè¯•å’Œä¼˜åŒ–ä»£ç ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªé‡‡ç”¨ HTTPS åè®®çš„ Web åº”ç”¨ã€‚HTTPS åè®®ä½¿ç”¨ TLS æ¥åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ é‡åˆ°äº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå®¢æˆ·ç«¯æ— æ³•æˆåŠŸä¸æœåŠ¡å™¨å»ºç«‹å®‰å…¨è¿æ¥ã€‚è¿™æ—¶å€™ï¼Œ<code>tlsSocket.enableTrace()</code> å°±æ´¾ä¸Šäº†ç”¨åœºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ å·²ç»æœ‰äº†ç§é’¥å’Œè¯ä¹¦æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º TLS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯ç”¨è·Ÿè¸ªæ¥è°ƒè¯•è¿æ¥é—®é¢˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enableTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ TLS æ¡æ‰‹å‡ºç°é—®é¢˜ï¼Œ<code>enableTrace()</code> å¯ä»¥å¸®åŠ©ä½ è·å–åº•å±‚çš„ TLS äº¤äº’ç»†èŠ‚ï¼Œä»è€Œæ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼ŒåŠ å¿«è°ƒè¯•è¿‡ç¨‹ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>tlsSocket.enableTrace()</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯¹äºé‚£äº›éœ€è¦æ·±å…¥äº†è§£å’Œè°ƒè¯• TLS è¿æ¥çš„å¼€å‘è€…æ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><h3 id="tlssocket-encrypted" tabindex="-1"><a class="header-anchor" href="#tlssocket-encrypted"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketencrypted" target="_blank" rel="noopener noreferrer">tlsSocket.encrypted</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScript ç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js çš„å¼ºå¤§ä¹‹ä¸€æ¥æºäºå®ƒåºå¤§çš„æ ‡å‡†åº“ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†ç”¨äºå¤„ç† TLS/SSL åŠ å¯†é€šä¿¡çš„ <code>tls</code> æ¨¡å—ã€‚åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œ<code>tls.TLSSocket</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªé€šè¿‡ TLS æˆ– SSL åŠ å¯†çš„å¥—æ¥å­—è¿æ¥ã€‚</p><h3 id="tlssocket-encrypted-å±æ€§" tabindex="-1"><a class="header-anchor" href="#tlssocket-encrypted-å±æ€§"><span>tlsSocket.encrypted å±æ€§</span></a></h3><p>å½“ä½ åœ¨ Node.js ä¸­ä½¿ç”¨ <code>tls</code> æ¨¡å—åˆ›å»ºæˆ–å¤„ç†ä¸€ä¸ª TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰è¿æ¥æ—¶ï¼Œä½ ä¼šé‡åˆ° <code>TLSSocket</code> å¯¹è±¡ã€‚<code>tlsSocket.encrypted</code> æ˜¯ <code>TLSSocket</code> å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨äºæŒ‡ç¤ºè¯¥å¥—æ¥å­—æ˜¯å¦å¯ç”¨äº†åŠ å¯†ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>tlsSocket.encrypted</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼š</p><ul><li>å¦‚æœè¯¥å€¼ä¸º <code>true</code>ï¼Œåˆ™è¡¨ç¤ºæ­¤å¥—æ¥å­—è¿æ¥æ˜¯åŠ å¯†çš„ã€‚</li><li>å¦‚æœä¸å­˜åœ¨æˆ–æœªå®šä¹‰ï¼Œåˆ™è¡¨ç¤ºè¿æ¥ä¸æ˜¯é€šè¿‡ TLS/SSL å®‰å…¨åŠ å¯†çš„ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-2"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><ol><li><strong>åˆ›å»º HTTPS æœåŠ¡å™¨</strong>: åœ¨ Node.js ä¸­åˆ›å»º HTTPS æœåŠ¡å™¨æ—¶ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½ä¼šé€šè¿‡ TLS åŠ å¯†ã€‚åœ¨å¤„ç†è¿™äº›è¿æ¥çš„å›è°ƒå‡½æ•°ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡æ£€æŸ¥ <code>socket.encrypted</code> æ¥ç¡®è®¤è¿æ¥ç¡®å®æ˜¯åŠ å¯†çš„ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ­¤æ—¶ req.connection æ˜¯ä¸€ä¸ª TLSSocket</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connection is secure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connection is not secure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>åŒºåˆ†åŠ å¯†ä¸éåŠ å¯†è¿æ¥</strong>: å¦‚æœä½ æœ‰ä¸€ä¸ªåŒæ—¶æ¥å—åŠ å¯†å’ŒéåŠ å¯†è¿æ¥çš„æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>tlsSocket.encrypted</code> æ¥åŒºåˆ†å¤„ç†é€»è¾‘ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ æœ‰ä¸€ä¸ªæœåŠ¡åŒæ—¶ç›‘å¬ TLS å’Œé TLS è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†åŠ å¯†è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†éåŠ å¯†è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>å¢å¼ºå®‰å…¨æ€§</strong>: åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½åªæƒ³å…è®¸åŠ å¯†è¿æ¥è®¿é—®æŸäº›èµ„æºæˆ–æ‰§è¡Œç‰¹å®šæ“ä½œã€‚é€šè¿‡æ£€æŸ¥ <code>tlsSocket.encrypted</code>ï¼Œä½ å¯ä»¥å¼ºåˆ¶æ‰§è¡Œè¿™ç§ç­–ç•¥ï¼Œä»è€Œå¢åŠ åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;éåŠ å¯†è¿æ¥å°è¯•è®¿é—®ï¼Œæ‹’ç»æœåŠ¡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†åŠ å¯†è¿æ¥çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼Œ<code>tlsSocket.encrypted</code> æä¾›äº†ä¸€ç§ç®€ä¾¿æ–¹å¼æ¥ç¡®è®¤ Node.js åº”ç”¨ä¸­çš„è¿æ¥æ˜¯å¦ä¸ºåŠ å¯†è¿æ¥ï¼Œè¿›è€Œå¯ä»¥åŸºäºè¿™ä¸ªä¿¡æ¯åšå‡ºç›¸åº”çš„å¤„ç†æˆ–åˆ¤æ–­ï¼Œä»¥æé«˜åº”ç”¨çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</p><h3 id="tlssocket-exportkeyingmaterial-length-label-context" tabindex="-1"><a class="header-anchor" href="#tlssocket-exportkeyingmaterial-length-label-context"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketexportkeyingmateriallength-label-context" target="_blank" rel="noopener noreferrer">tlsSocket.exportKeyingMaterial(length, label[, context])</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥ç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>tlsSocket.exportKeyingMaterial(length, label[, context])</code> è¿™ä¸ªåŠŸèƒ½ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨æ·±å…¥ä¹‹å‰ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‚¹éœ€è¦æ˜ç¡®ï¼š</p><ol><li><p><strong>TLS (Transport Layer Security)</strong>: TLS æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œæ—¨åœ¨ä¸ºç½‘ç»œé€šä¿¡æä¾›åŠ å¯†å’Œæ•°æ®å®Œæ•´æ€§ä¿è¯ã€‚å®ƒæ˜¯ç½‘ä¸Šè´­ç‰©ã€é“¶è¡Œä¸šåŠ¡ç­‰éœ€è¦ä¿å¯†çš„æ“ä½œçš„åŸºçŸ³ã€‚</p></li><li><p><strong>Keying Material</strong>: åœ¨åŠ å¯†ä¸­ï¼Œkeying material æ˜¯ç”¨äºæ„å»ºåŠ å¯†å¯†é’¥çš„åŸå§‹ææ–™ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åŠ å¯†è¿‡ç¨‹ä¸­ç”¨æ¥ç”Ÿæˆå¯†é’¥çš„æ•°æ®ã€‚</p></li><li><p><strong>TLS Socket</strong>: åœ¨ Node.js é‡Œï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªåŸºäº TLS çš„è¿æ¥ï¼ˆæ¯”å¦‚é€šè¿‡ <code>https.createServer()</code> æˆ–è€… <code>tls.connect()</code>ï¼‰ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>tls.TLSSocket</code> çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹ä»£è¡¨äº†é‚£ä¸ªåŠ å¯†çš„è¿æ¥ã€‚</p></li></ol><h3 id="åŠŸèƒ½ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½ä»‹ç»"><span>åŠŸèƒ½ä»‹ç»</span></a></h3><p><code>tlsSocket.exportKeyingMaterial(length, label[, context])</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå…è®¸ä½ ä»å½“å‰çš„ TLS è¿æ¥ä¸­å¯¼å‡ºä¸€äº›é¢å¤–çš„å¯†é’¥ææ–™ã€‚è¿™å¯ä»¥ç”¨äºå¤šç§ç›®çš„ï¼Œæ¯”å¦‚åˆ›å»ºè‡ªå®šä¹‰åŠ å¯†å¯†é’¥æˆ–å…¶ä»–å½¢å¼çš„å®‰å…¨å‡­æ®ã€‚</p><ul><li><strong>length</strong>: æŒ‡å®šä½ æƒ³è¦å¯¼å‡ºçš„å¯†é’¥ææ–™çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</li><li><strong>label</strong>: ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºå¯¹å¯¼å‡ºæ“ä½œè¿›è¡Œæ ‡è®°ã€‚è¿™æœ‰åŠ©äºç¡®ä¿å¯¼å‡ºçš„å¯†é’¥ææ–™çš„å”¯ä¸€æ€§ã€‚</li><li><strong>context</strong> (å¯é€‰): ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®ï¼ˆBufferï¼‰ï¼Œæä¾›æ›´å¤šçš„éšæœºæ€§å’Œæ•°æ®çš„ç‹¬ç‰¹æ€§ã€‚ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½éœ€è¦å®ƒï¼Œä½†åœ¨éœ€è¦ç¡®ä¿æé«˜å®‰å…¨æ€§çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-3"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨ï¼Œä¸”å¸Œæœ›å¢åŠ ä¸€å±‚é¢å¤–çš„å®‰å…¨æ€§ï¼Œä½¿å¾—æ¯æ¡æ¶ˆæ¯éƒ½æœ‰å…¶ç‹¬ç«‹çš„åŠ å¯†å¯†é’¥ï¼Œè€Œè¿™äº›å¯†é’¥æ˜¯åŸºäºç”¨æˆ·å½“å‰çš„ TLS è¿æ¥åŠ¨æ€ç”Ÿæˆçš„ã€‚è¿™æ ·ï¼Œå³ä¾¿æ˜¯æœåŠ¡å™¨ä¹Ÿæ— æ³•è§£è¯»ç”¨æˆ·ä¹‹é—´çš„ç§äººå¯¹è¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾å·²ç»æœ‰äº†åŸºäºTLSåè®®çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> serverOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„TLSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">serverOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæ­¤socketè¿æ¥å¯¼å‡ºä¸€äº›å¯†é’¥ææ–™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> exportedKeyingMaterial</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exportKeyingMaterial</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    128</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;my unique label&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯ä»¥ä½¿ç”¨è¿™äº›å¯†é’¥ææ–™æ¥ç”Ÿæˆæ–°çš„åŠ å¯†å¯†é’¥ï¼Œç”¨äºåŠ å¯†å³æ—¶æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Exported Key Material:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">exportedKeyingMaterial</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ TLS æœåŠ¡å™¨ï¼Œå½“ä¸€ä¸ª TLS å®¢æˆ·ç«¯è¿æ¥åˆ°å®ƒæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>exportKeyingMaterial</code> æ–¹æ³•å¯¼å‡ºä¸€äº›å¯†é’¥ææ–™ï¼Œé•¿åº¦ä¸º 128 å­—èŠ‚ï¼Œå¹¶ç”¨ <code>&#39;my unique label&#39;</code> ä½œä¸ºæ ‡ç­¾æ¥ä¿è¯å…¶ç‹¬ç‰¹æ€§ã€‚ä¹‹åï¼Œè¿™äº›å¯¼å‡ºçš„å¯†é’¥ææ–™å¯ä»¥ç”¨äºç”Ÿæˆæ–°çš„å¯†é’¥ï¼Œæ¯”å¦‚ç”¨äºåŠ å¯†å‘é€ç»™å®¢æˆ·ç«¯çš„æ¯æ¡æ¶ˆæ¯ï¼Œç¡®ä¿æ¶ˆæ¯å†…å®¹çš„å®‰å…¨ã€‚</p><h3 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2"><span>å°ç»“</span></a></h3><p><code>tlsSocket.exportKeyingMaterial</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå…è®¸åŸºäºç°æœ‰çš„ TLS è¿æ¥åˆ›å»ºæ›´å¤æ‚å’Œå®‰å…¨çš„åŠ å¯†æ–¹æ¡ˆã€‚å®ƒæä¾›äº†é¢å¤–çš„çµæ´»æ€§ï¼Œå¯ä»¥ç”¨äºæ„å»ºæ›´åŠ å®‰å…¨çš„ç½‘ç»œé€šä¿¡åº”ç”¨ã€‚</p><h3 id="tlssocket-getcertificate" tabindex="-1"><a class="header-anchor" href="#tlssocket-getcertificate"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetcertificate" target="_blank" rel="noopener noreferrer">tlsSocket.getCertificate()</a></span></a></h3><p>Node.js ä¸­çš„ <code>tlsSocket.getCertificate()</code> æ–¹æ³•æ˜¯ä¸ TLS (ä¼ è¾“å±‚å®‰å…¨) åè®®ç›¸å…³çš„ä¸€ä¸ªæ–¹æ³•ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ç”¨äºå®ç°å®‰å…¨çš„ç½‘ç»œé€šä¿¡çš„å·¥å…·å’ŒåŠŸèƒ½ã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸‹ï¼Œ<code>tlsSocket</code> å¯ä»¥è¢«ç†è§£ä¸ºä¸€ä¸ªé€šè¿‡ TLS/SSL åè®®åŠ å¯†çš„ç½‘ç»œè¿æ¥ã€‚</p><p>å½“ä½ ä¸ä¸€ä¸ªæœåŠ¡å™¨å»ºç«‹èµ·ä¸€ä¸ªå®‰å…¨çš„è¿æ¥æ—¶ï¼ŒTLS åè®®å¸®åŠ©ç¡®ä¿æ•°æ®çš„éšç§å’Œå®Œæ•´æ€§ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¯ä¹¦èµ·åˆ°äº†å…³é”®ä½œç”¨ã€‚è¯ä¹¦æ˜¯ç”±å¯ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘çš„ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†éªŒè¯ç½‘ç»œå®ä½“çš„èº«ä»½ï¼Œå¹¶ä¸”ä¸ºåŠ å¯†æä¾›å…¬é’¥ã€‚</p><h3 id="tlssocket-getcertificate-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#tlssocket-getcertificate-æ–¹æ³•çš„ä½œç”¨"><span><code>tlsSocket.getCertificate()</code>æ–¹æ³•çš„ä½œç”¨</span></a></h3><p><code>tlsSocket.getCertificate()</code> æ–¹æ³•å¯ä»¥ä»ä¸€ä¸ªå·²ç»å»ºç«‹çš„ TLS/SSL è¿æ¥ä¸­è·å–æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯ã€‚è¿”å›çš„è¯ä¹¦ä¿¡æ¯æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†å¦‚è¯ä¹¦é¢å‘è€…ã€æœ‰æ•ˆæœŸã€ä¸»é¢˜ç­‰è¯¸å¤šä¸è¯ä¹¦ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><ol><li><p><strong>éªŒè¯æœåŠ¡å™¨èº«ä»½</strong>ï¼šå®¢æˆ·ç«¯åº”ç”¨å¯èƒ½éœ€è¦ç¡®è®¤å®ƒæ‰€è¿æ¥çš„æœåŠ¡å™¨æ­£æ˜¯é¢„æœŸçš„æœåŠ¡å™¨ã€‚é€šè¿‡æ£€æŸ¥æœåŠ¡å™¨çš„ TLS è¯ä¹¦ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥éªŒè¯æœåŠ¡å™¨çš„çœŸå®æ€§ï¼Œç¡®ä¿ä¸æ­£ç¡®çš„æœåŠ¡å™¨é€šä¿¡ã€‚</p></li><li><p><strong>å®‰å…¨å®¡è®¡</strong>ï¼šåœ¨å®‰å…¨æ•æ„Ÿçš„åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦å®šæœŸæ£€æŸ¥ä¸ä¹‹é€šä¿¡çš„æœåŠ¡å™¨è¯ä¹¦ï¼Œä»¥ç¡®ä¿å®ƒä»¬æ˜¯ç”±å—ä¿¡ä»»çš„é¢å‘æœºæ„ç­¾å‘çš„ï¼Œå¹¶ä¸”æœªè¢«ç¯¡æ”¹æˆ–è¿‡æœŸã€‚</p></li><li><p><strong>è°ƒè¯•å’Œæ•…éšœæ’é™¤</strong>ï¼šå¼€å‘äººå‘˜åœ¨è°ƒè¯•åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯èƒ½éœ€è¦æŸ¥çœ‹å’Œåˆ†ææœåŠ¡å™¨è¯ä¹¦ä¿¡æ¯ï¼Œä»¥ç¡®ä¿ TLS/SSL é…ç½®æ­£ç¡®ï¼Œæ²¡æœ‰å­˜åœ¨çš„å®‰å…¨é£é™©ã€‚</p></li></ol><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¸ HTTPS æœåŠ¡å™¨è¿›è¡Œå®‰å…¨é€šä¿¡çš„ Node.js åº”ç”¨ç¨‹åºã€‚åœ¨ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼Œä½ å¸Œæœ›éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œä»¥ç¡®è®¤ä½ çš„åº”ç”¨ç¨‹åºæ˜¯ä¸é¢„æœŸçš„æœåŠ¡å™¨é€šä¿¡è€ŒéæŸä¸ªæ¶æ„æœåŠ¡å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»ºç«‹åˆ°æŒ‡å®šæœåŠ¡å™¨çš„TLSè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æˆåŠŸå»ºç«‹å®‰å…¨è¿æ¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è·å–å¹¶æ‰“å°æœåŠ¡å™¨è¯ä¹¦ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> certificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCertificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TLSè¿æ¥é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥<code>tls</code>æ¨¡å—ï¼Œç„¶åä½¿ç”¨<code>tls.connect</code>æ–¹æ³•å»ºç«‹åˆ°<code>example.com</code>æœåŠ¡å™¨çš„ä¸€ä¸ªå®‰å…¨è¿æ¥ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>socket.getCertificate()</code>æ–¹æ³•è·å–æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ‰“å°å‡ºæ¥ã€‚è¿™èƒ½å¤Ÿè®©æˆ‘ä»¬çœ‹åˆ°ä¸æœåŠ¡å™¨è¯ä¹¦ç›¸å…³çš„å„ç§è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚è¯ä¹¦çš„æœ‰æ•ˆæ—¥æœŸã€é¢å‘è€…ç­‰ï¼Œè¿™å¯¹äºå®‰å…¨æ€§éªŒè¯è‡³å…³é‡è¦ã€‚</p><h3 id="tlssocket-getcipher" tabindex="-1"><a class="header-anchor" href="#tlssocket-getcipher"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetcipher" target="_blank" rel="noopener noreferrer">tlsSocket.getCipher()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚å…¶ä¸­ï¼ŒTLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰æ˜¯ç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§çš„æ ‡å‡†åè®®ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>tls</code>æ¨¡å—æä¾›äº†å®ç° TLS çš„å„ç§åŠŸèƒ½ï¼ŒåŒ…æ‹¬åˆ›å»ºå®‰å…¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç­‰ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­çš„<code>tlsSocket.getCipher()</code>æ–¹æ³•æ˜¯<code>tls</code>æ¨¡å—ä¸‹çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒç”¨äºè·å–ä¸€ä¸ª TLS å¥—æ¥å­—å½“å‰æ­£åœ¨ä½¿ç”¨çš„åŠ å¯†å¥—ä»¶ä¿¡æ¯ã€‚åŠ å¯†å¥—ä»¶ï¼ˆCipher Suiteï¼‰æ˜¯ä¸€ç»„ç®—æ³•ï¼Œé€šå¸¸åŒ…æ‹¬ï¼šå¯†é’¥äº¤æ¢ç®—æ³•ã€åŠ å¯†ç®—æ³•ã€MAC ç®—æ³•ï¼ˆæ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼‰ï¼Œè¿™äº›ç®—æ³•å…±åŒç¡®ä¿äº† TLS è¿æ¥çš„å®‰å…¨æ€§ã€‚æ¯å½“ä¸¤ä¸ªè®¾å¤‡é€šè¿‡ TLS å»ºç«‹è¿æ¥æ—¶ï¼Œå®ƒä»¬ä¼šåå•†ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„åŠ å¯†å¥—ä»¶ã€‚</p><h3 id="åŸºæœ¬ç”¨æ³•-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•-1"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><p>å‡è®¾ä½ å·²ç»æœ‰ä¸€ä¸ª TLS å¥—æ¥å­—ï¼ˆä¾‹å¦‚ï¼Œä½ å¯èƒ½åœ¨ä½¿ç”¨<code>tls</code>æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªå®‰å…¨çš„æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼‰ã€‚è¦è·å–è¯¥ TLS å¥—æ¥å­—å½“å‰ä½¿ç”¨çš„åŠ å¯†å¥—ä»¶ä¿¡æ¯ï¼Œå¯ä»¥è°ƒç”¨<code>tlsSocket.getCipher()</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å…³äºåŠ å¯†å¥—ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å…¶åç§°å’Œç”¨äºå¯†é’¥äº¤æ¢ã€åŠ å¯†å’Œ MAC çš„ç®—æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥tlsæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬SSLå¯†é’¥å’Œè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªTLSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“è¿æ¥å»ºç«‹åè·å–å¹¶æ‰“å°åŠ å¯†å¥—ä»¶ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Cipher suite used:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-4"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>å®‰å…¨é€šä¿¡</strong>: åœ¨éœ€è¦å®‰å…¨é€šä¿¡çš„ä»»ä½•åº”ç”¨ä¸­ï¼Œäº†è§£å½“å‰ä½¿ç”¨çš„åŠ å¯†æŠ€æœ¯æ˜¯å¾ˆé‡è¦çš„ã€‚æ¯”å¦‚ï¼Œåœ¨æ„å»ºä¸€ä¸ªåœ¨çº¿æ”¯ä»˜å¹³å°æ—¶ï¼Œç¡®ä¿ä½¿ç”¨çš„åŠ å¯†æŠ€æœ¯ç¬¦åˆè¡Œä¸šå®‰å…¨æ ‡å‡†è‡³å…³é‡è¦ã€‚</p></li><li><p><strong>å®‰å…¨å®¡è®¡</strong>: å¯¹äºæ‰§è¡Œå®‰å…¨å®¡è®¡çš„åœºæ™¯ï¼Œäº†è§£æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡æ‰€ä½¿ç”¨çš„å…·ä½“åŠ å¯†å¥—ä»¶ç±»å‹å¯ä»¥å¸®åŠ©è¯†åˆ«æ½œåœ¨çš„å¼±ç‚¹ï¼Œä»è€Œå¯¹ç³»ç»Ÿè¿›è¡ŒåŠ å›ºã€‚</p></li><li><p><strong>å…¼å®¹æ€§æµ‹è¯•</strong>: å¼€å‘è€…å¯ä»¥ä½¿ç”¨ä¸åŒçš„ TLS é…ç½®å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨<code>tlsSocket.getCipher()</code>æ–¹æ³•æŸ¥çœ‹å“ªäº›é…ç½®æ˜¯å…è®¸çš„ï¼Œä»¥æ­¤ç¡®ä¿æœåŠ¡åœ¨å¤šæ ·åŒ–çš„å®¢æˆ·ç«¯ç¯å¢ƒä¸­æ­£å¸¸å·¥ä½œã€‚</p></li></ol><p>é€šè¿‡ç†è§£å’Œä½¿ç”¨<code>tlsSocket.getCipher()</code>æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œä¼˜åŒ–ä»–ä»¬åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><h3 id="tlssocket-getephemeralkeyinfo" tabindex="-1"><a class="header-anchor" href="#tlssocket-getephemeralkeyinfo"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetephemeralkeyinfo" target="_blank" rel="noopener noreferrer">tlsSocket.getEphemeralKeyInfo()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å…¶ä¸­æœ‰ä¸ªæ¨¡å—å« <code>tls</code>ï¼Œè¿™æ˜¯ç”¨æ¥å¤„ç†å®‰å…¨ä¼ è¾“å±‚ï¼ˆTransport Layer Securityï¼ŒTLSï¼‰çš„ï¼Œå³ç½‘ä¸Šçš„å®‰å…¨é€šä¿¡ã€‚è€Œ <code>tlsSocket.getEphemeralKeyInfo()</code> æ˜¯ <code>tls</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–ä¸´æ—¶å¯†é’¥ä¿¡æ¯ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-å’Œ-ephemeral-key" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-å’Œ-ephemeral-key"><span>ä»€ä¹ˆæ˜¯ TLS å’Œ Ephemeral Keyï¼Ÿ</span></a></h3><ul><li><strong>TLS</strong>ï¼šä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼Œç”¨ä»¥ä¿éšœç½‘ç»œé€šä¿¡è¿‡ç¨‹ä¸­çš„æ•°æ®å®‰å…¨ï¼Œé˜²æ­¢æ•°æ®è¢«çªƒå–æˆ–ç¯¡æ”¹ã€‚å½“ä½ æµè§ˆç½‘é¡µã€å‘é€ç”µå­é‚®ä»¶æˆ–ä½¿ç”¨å³æ—¶é€šè®¯åº”ç”¨æ—¶ï¼ŒTLS ä¾¿åœ¨èƒŒåå·¥ä½œï¼Œç¡®ä¿ä½ çš„é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚</li><li><strong>Ephemeral Key</strong>ï¼šè¯‘ä¸ºâ€œä¸´æ—¶å¯†é’¥â€ã€‚åœ¨åŠ å¯†é€šä¿¡ä¸­ï¼Œä¸´æ—¶å¯†é’¥æ˜¯åªè¢«ç”¨äºå½“å‰ä¼šè¯çš„çŸ­æš‚å­˜åœ¨çš„å¯†é’¥ã€‚åˆ©ç”¨ä¸´æ—¶å¯†é’¥å¯ä»¥å¢å¼ºå®‰å…¨æ€§ï¼Œå› ä¸ºå³ä½¿æ”»å‡»è€…æˆªè·äº†æ­¤æ¬¡ä¼šè¯çš„å¯†é’¥ï¼Œç”±äºå¯†é’¥ä»…é™äºæ­¤æ¬¡ä¼šè¯ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•åˆ©ç”¨æ­¤å¯†é’¥è§£å¯†å…¶ä»–ä¼šè¯çš„æ•°æ®ã€‚</li></ul><h3 id="tlssocket-getephemeralkeyinfo-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#tlssocket-getephemeralkeyinfo-æ–¹æ³•"><span><code>tlsSocket.getEphemeralKeyInfo()</code> æ–¹æ³•</span></a></h3><p><code>tlsSocket.getEphemeralKeyInfo()</code> æ˜¯åœ¨ Node.js çš„ <code>tls</code> æ¨¡å—ä¸‹ã€‚å½“ä½ åˆ›å»ºäº†ä¸€ä¸ª TLS è¿æ¥ï¼Œé€šè¿‡è¿™ä¸ªè¿æ¥è¿›è¡Œçš„é€šä¿¡å°†ä¼šè¢«åŠ å¯†ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ è·å–å½“å‰è¿æ¥æ­£åœ¨ä½¿ç”¨çš„ä¸´æ—¶å¯†é’¥çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™å¯¹äºè°ƒè¯•å’Œç¡®ä¿ TLS è¿æ¥çš„å®‰å…¨æ€§éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ï¼Œå¦‚ä¸€ä¸ªçº¿ä¸Šæ”¯ä»˜ç³»ç»Ÿã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½å¿…é¡»æ˜¯åŠ å¯†çš„ï¼Œä»¥ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚ä¿¡ç”¨å¡ä¿¡æ¯ï¼‰ä¸è¢«æ³„éœ²ã€‚</p><ol><li><strong>å»ºç«‹å®‰å…¨è¿æ¥</strong>ï¼šé¦–å…ˆï¼Œå®¢æˆ·ç«¯ï¼ˆå¦‚ç”¨æˆ·çš„æµè§ˆå™¨ï¼‰å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª TLS è¿æ¥è¯·æ±‚ã€‚</li><li><strong>ä½¿ç”¨ <code>tlsSocket.getEphemeralKeyInfo()</code></strong>ï¼šä¸€æ—¦ TLS è¿æ¥å»ºç«‹ï¼ŒæœåŠ¡å™¨ç«¯çš„ Node.js åº”ç”¨å¯ä»¥ä½¿ç”¨ <code>tlsSocket.getEphemeralKeyInfo()</code> æ–¹æ³•æ¥æ£€æŸ¥ä¸è¯¥å®¢æˆ·ç«¯è¿æ¥ä½¿ç”¨çš„ä¸´æ—¶å¯†é’¥ä¿¡æ¯ï¼Œç¡®ä¿ä½¿ç”¨äº†å¼ºåŠ å¯†ç®—æ³•å’Œåˆé€‚çš„å¯†é’¥é•¿åº¦ã€‚</li><li><strong>è¿›è¡Œé€šä¿¡</strong>ï¼šç¡®è®¤å®‰å…¨æ€§åï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°±å¯ä»¥å¼€å§‹é€šè¿‡è¿™ä¸ªåŠ å¯†çš„é€šé“å®‰å…¨åœ°äº¤æ¢æ•°æ®äº†ã€‚</li></ol><p>è¿™é‡Œçš„å…³é”®ç‚¹æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨ä¸´æ—¶å¯†é’¥ï¼Œå³ä½¿æŸä¸ªç‰¹å®šä¼šè¯çš„åŠ å¯†è¢«ç ´è§£ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•åˆ©ç”¨è¿™ä¸ªå¯†é’¥å»è§£å¯†å…¶ä»–ä¼šè¯çš„æ•°æ®ï¼Œå› ä¸ºæ¯ä¸ªä¼šè¯éƒ½ä¼šä½¿ç”¨ä¸åŒçš„ä¸´æ—¶å¯†é’¥ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šæœ‰åŠ©äºä½ æ›´å¥½ç†è§£ <code>tlsSocket.getEphemeralKeyInfo()</code> åœ¨ Node.js ä¸­çš„ä½œç”¨å’Œæ„ä¹‰ï¼</p><h3 id="tlssocket-getfinished" tabindex="-1"><a class="header-anchor" href="#tlssocket-getfinished"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetfinished" target="_blank" rel="noopener noreferrer">tlsSocket.getFinished()</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>tlsSocket.getFinished()</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚åœ¨äº†è§£è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œä½ éœ€è¦çŸ¥é“å‡ ä¸ªåŸºç¡€ç‚¹ã€‚</p><ol><li><p><strong>TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼‰</strong>ï¼šç®€å•æ¥è¯´ï¼ŒTLS æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šä¿æŠ¤æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚å½“ä½ æµè§ˆç½‘ç«™ã€å‘é€ç”µå­é‚®ä»¶æˆ–è€…è¿›è¡Œåœ¨çº¿è´­ç‰©æ—¶ï¼ŒTLS ç¡®ä¿ä½ çš„ä¿¡æ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¸è¢«çªƒå–æˆ–ç¯¡æ”¹ã€‚</p></li><li><p><strong>Node.js</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚ç”±äºå…¶éé˜»å¡ I/O å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§ï¼ŒNode.js ç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡å¹¶å‘çš„ç½‘ç»œè¯·æ±‚ã€‚</p></li><li><p><strong>TLS Socket</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ç”¨äºå®ç° TLS åŠ å¯†çš„å·¥å…·å’ŒåŠŸèƒ½ã€‚<code>TLS Socket</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç½‘ç»œå¥—æ¥å­—ï¼Œé€šè¿‡ TLS åè®®è¿›è¡Œé€šä¿¡ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨ä¼ è¾“ã€‚</p></li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>tlsSocket.getFinished()</code> æ–¹æ³•ï¼š</p><h3 id="tlssocket-getfinished-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-getfinished-1"><span>tlsSocket.getFinished()</span></a></h3><p>è¿™ä¸ªæ–¹æ³•ç”¨äºè·å–å½“å‰ TLS è¿æ¥å®Œæˆæ¡æ‰‹é˜¶æ®µåç”Ÿæˆçš„â€œå®Œæˆâ€æ¶ˆæ¯ã€‚åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢ä¸€ç³»åˆ—æ¶ˆæ¯ä»¥éªŒè¯å½¼æ­¤çš„èº«ä»½å¹¶å»ºç«‹åŠ å¯†å‚æ•°ã€‚ä¸€æ—¦æ¡æ‰‹å®Œæˆï¼ŒåŒæ–¹éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‰¹å®šçš„â€œå®Œæˆâ€æ¶ˆæ¯ï¼Œè¡¨æ˜æ¡æ‰‹é˜¶æ®µå·²ç»æˆåŠŸç»“æŸï¼ŒåŠ å¯†çš„ä¼šè¯å¯ä»¥å¼€å§‹äº†ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¿è¯æ•°æ®ä¼ è¾“å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿æ”¯ä»˜ç³»ç»Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ TLS æ¥åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®šä¹‰æœåŠ¡å™¨çš„ TLS/SSL è¯ä¹¦å’Œç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º TLS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç›‘å¬å®¢æˆ·ç«¯çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¡æ‰‹å®Œæˆåï¼Œè·å–å®Œæˆæ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> finishedMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getFinished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished message:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">finishedMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello over TLS!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬æŒ‡å®šç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨äº† <code>getFinished()</code> æ–¹æ³•æ¥è·å–å®Œæˆæ¶ˆæ¯ï¼Œä»¥ç¡®è®¤æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™å¯¹äºè°ƒè¯•å’Œç¡®ä¿è¿æ¥çš„å®‰å…¨æ€§ååˆ†æœ‰ç”¨ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>tlsSocket.getFinished()</code> æ–¹æ³•åœ¨ Node.js çš„ TLS ç½‘ç»œç¼–ç¨‹ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ç¡®ä¿é€šä¿¡å®‰å…¨æ€§çš„åœºæ™¯ä¸‹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’ŒéªŒè¯ TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œä»è€Œæ„å»ºå®‰å…¨å¯é çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><h3 id="tlssocket-getpeercertificate-detailed" tabindex="-1"><a class="header-anchor" href="#tlssocket-getpeercertificate-detailed"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetpeercertificatedetailed" target="_blank" rel="noopener noreferrer">tlsSocket.getPeerCertificate([detailed])</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®ºç½‘ç»œå®‰å…¨å’Œæ•°æ®ä¼ è¾“æ—¶ï¼ŒTLSï¼ˆTransport Layer Securityï¼‰æ‰®æ¼”äº†ä¸€ä¸ªéå¸¸å…³é”®çš„è§’è‰²ã€‚ç®€å•æ¥è¯´ï¼ŒTLS æ˜¯ä¸€ç§åè®®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹ä¹‹é—´æä¾›åŠ å¯†çš„é€šä¿¡ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>tlsSocket.getPeerCertificate([detailed])</code> æ˜¯ä¸ TLS ç›¸å…³çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè·å–åˆ°å¯¹ç«¯ï¼ˆä¹Ÿå°±æ˜¯ä¸ä¹‹é€šä¿¡çš„å¦ä¸€æ–¹ï¼‰çš„è¯ä¹¦ä¿¡æ¯ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è§£é‡Šå‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ul><li><strong>TLS (Transport Layer Security)</strong>: ä¸€ç§ä¿è¯ç½‘ç»œé€šä¿¡å®‰å…¨çš„åè®®ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„éšç§å’Œå®Œæ•´æ€§ã€‚</li><li><strong>è¯ä¹¦</strong>: åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºéªŒè¯å¯¹æ–¹çš„èº«ä»½ã€‚è¿™äº›è¯ä¹¦ç”±ç§°ä¸ºè¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„å—ä¿¡ä»»å®ä½“ç­¾åã€‚</li><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†äº†è§£ <code>tlsSocket.getPeerCertificate([detailed])</code> çš„å·¥ä½œåŸç†ä¸åº”ç”¨ã€‚</p><h3 id="tlssocket-getpeercertificate-detailed-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-getpeercertificate-detailed-1"><span>tlsSocket.getPeerCertificate([detailed])</span></a></h3><p>å½“ä½ å»ºç«‹ä¸€ä¸ª TLS è¿æ¥æ—¶ï¼ˆæ¯”å¦‚é€šè¿‡ HTTPSï¼‰ï¼Œä¸¤ç«¯ä¼šè¿›è¡Œä¸€ç³»åˆ—çš„â€œæ¡æ‰‹â€æ“ä½œï¼Œäº¤æ¢å„è‡ªçš„è¯ä¹¦ã€‚è¿™äº›è¯ä¹¦åŒ…å«äº†å…³äºæ¯ä¸€æ–¹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç»„ç»‡åç§°ã€ç½‘ç«™åœ°å€ç­‰ï¼Œä»¥åŠä¸€ä¸ªå…¬é’¥ï¼Œå¯ä»¥ç”¨æ¥åœ¨ç¨åçš„é€šä¿¡ä¸­åŠ å¯†ä¿¡æ¯ã€‚</p><p><code>tlsSocket.getPeerCertificate([detailed])</code> æ–¹æ³•å…è®¸ä½ è·å–è¿æ¥å¯¹ç«¯çš„è¯ä¹¦ä¿¡æ¯ã€‚å¦‚æœä½ æ²¡æœ‰ç‰¹åˆ«æŒ‡å®šå‚æ•° <code>detailed</code> æˆ–è€…å°†å…¶è®¾ç½®ä¸º <code>false</code>ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•è¿”å›çš„å°†æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„è¯ä¹¦ä¿¡æ¯å¯¹è±¡ã€‚å¦‚æœä½ å°† <code>detailed</code> è®¾ç½®ä¸º <code>true</code>ï¼Œåˆ™èƒ½å¤Ÿè·å–åŒ…å«æ›´å¤šè¯¦ç»†ä¿¡æ¯çš„è¯ä¹¦å¯¹è±¡ï¼Œæ¯”å¦‚ç­¾åç®—æ³•ã€æŒ‡çº¹ã€æœ‰æ•ˆæœŸç­‰ã€‚</p><h4 id="å®é™…åº”ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-5"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¸å¤–éƒ¨æœåŠ¡è¿›è¡Œå®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿æ”¯ä»˜ç³»ç»Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒéªŒè¯ä½ æ­£åœ¨ä¸ä¹‹é€šä¿¡çš„æœåŠ¡çš„çœŸå®æ€§å˜å¾—è‡³å…³é‡è¦ã€‚ä½¿ç”¨ <code>tlsSocket.getPeerCertificate(true)</code> å¯ä»¥å¸®åŠ©ä½ è·å–å¹¶éªŒè¯å¯¹æ–¹çš„è¯ä¹¦ä¿¡æ¯ï¼Œç¡®ä¿å®ƒæ˜¯ç”±ä¸€ä¸ªå¯ä¿¡çš„è¯ä¹¦é¢å‘æœºæ„ç­¾å‘çš„ï¼Œä»è€Œé˜²æ­¢è¯¸å¦‚ä¸­é—´äººæ”»å‡»ä¹‹ç±»çš„å®‰å…¨å¨èƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¡«å†™è¿æ¥é€‰é¡¹ï¼Œæ¯”å¦‚ host å’Œ port</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯å·²è¿æ¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> peerCertificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getPeerCertificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">peerCertificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œä½ å¯ä»¥è¿›ä¸€æ­¥æ£€æŸ¥è¯ä¹¦çš„ç»†èŠ‚ï¼Œæ¯”å¦‚é¢å‘æœºæ„ç­‰ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js åº”ç”¨ä¸­ä½¿ç”¨ <code>tlsSocket.getPeerCertificate()</code> è·å–å¯¹ç«¯çš„è¯ä¹¦ä¿¡æ¯ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚åœ¨å®é™…æƒ…å†µä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘æ¥éªŒè¯è¿™äº›ä¿¡æ¯ï¼Œç¡®ä¿ä½ çš„åº”ç”¨åªä¸å¯ä¿¡çš„æœåŠ¡é€šä¿¡ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œäº†è§£å’Œä½¿ç”¨ <code>tlsSocket.getPeerCertificate()</code> æ–¹æ³•å¯ä»¥åœ¨éœ€è¦ç¡®ä¿ç½‘ç»œé€šä¿¡å®‰å…¨çš„åœºæ™¯ä¸‹ï¼Œä¸ºä½ çš„åº”ç”¨å¢åŠ ä¸€å±‚é‡è¦çš„ä¿æŠ¤ã€‚</p><h4 id="certificate-object" tabindex="-1"><a class="header-anchor" href="#certificate-object"><span><a href="https://nodejs.org/docs/latest/api/tls.html#certificate-object" target="_blank" rel="noopener noreferrer">Certificate object</a></span></a></h4><p>Node.js ä¸­çš„ Certificate å¯¹è±¡æ˜¯åœ¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å’Œ SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„ï¼Œå®ƒæä¾›äº†å…³äº TLS/SSL è¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯¹äºå»ºç«‹å®‰å…¨çš„ç½‘ç»œè¿æ¥éå¸¸é‡è¦ï¼Œæ¯”å¦‚åœ¨ Web æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´åŠ å¯†æ•°æ®ä¼ è¾“ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ç®€å•çš„æ¦‚å¿µå’Œå®é™…ä¾‹å­æ¥æ·±å…¥äº†è§£å®ƒã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-ssl-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-ssl-è¯ä¹¦"><span>ä»€ä¹ˆæ˜¯ TLS/SSL è¯ä¹¦ï¼Ÿ</span></a></h3><p>TLS/SSL è¯ä¹¦æ˜¯ä¸€ç§æ•°å­—è¯ä¹¦ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡å®ä½“ä¹‹é—´æä¾›å®‰å…¨çš„èº«ä»½éªŒè¯å’ŒåŠ å¯†è¿æ¥ã€‚è¿™ç±»ä¼¼äºç»™ç½‘ç«™æä¾›ä¸€ä¸ªå®‰å…¨è®¤è¯ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½æ˜¯åŠ å¯†å’Œå®‰å…¨çš„ã€‚</p><h3 id="certificate-å¯¹è±¡åŒ…å«å“ªäº›ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#certificate-å¯¹è±¡åŒ…å«å“ªäº›ä¿¡æ¯"><span>Certificate å¯¹è±¡åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</span></a></h3><p>ä¸€ä¸ª Certificate å¯¹è±¡åŒ…å«äº†è¯ä¹¦çš„å„ç§ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>ä¸»é¢˜</strong>ï¼šè¯ä¹¦æ‰€ä»£è¡¨çš„å®ä½“æˆ–ä¸ªäººçš„åç§°ã€‚</li><li><strong>é¢å‘è€…</strong>ï¼šé¢å‘è¯ä¹¦çš„æƒå¨æœºæ„çš„åç§°ã€‚</li><li><strong>æœ‰æ•ˆæœŸ</strong>ï¼šè¯ä¹¦çš„æœ‰æ•ˆå¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸã€‚</li><li><strong>å…¬é’¥</strong>ï¼šç”¨äºåŠ å¯†ä¿¡æ¯ï¼Œä»¥ä¾¿åªæœ‰å¯¹åº”çš„ç§é’¥æŒæœ‰è€…æ‰èƒ½è§£å¯†ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-https-web-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-https-web-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1ï¼šHTTPS Web æœåŠ¡å™¨</span></a></h4><p>æœ€å¸¸è§çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ªæ”¯æŒ HTTPS çš„ Web æœåŠ¡å™¨ã€‚HTTPS æ˜¯ HTTP åè®®çš„å®‰å…¨ç‰ˆæœ¬ï¼Œå®ƒåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é“¾æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–SSLè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨ç§é’¥è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;SSLè¯ä¹¦è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨å¯åŠ¨åœ¨ https://localhost:8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Node.js çš„<code>https</code>æ¨¡å—å’Œ<code>fs</code>æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ã€‚æˆ‘ä»¬éœ€è¦æä¾›æœåŠ¡å™¨çš„ç§é’¥å’Œ SSL è¯ä¹¦è·¯å¾„ä½œä¸º<code>options</code>ï¼Œä»¥ç¡®ä¿é€šä¿¡è¿‡ç¨‹çš„å®‰å…¨ã€‚</p><h4 id="ç¤ºä¾‹-2-æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯"><span>ç¤ºä¾‹ 2ï¼šæ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯</span></a></h4><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Node.js æ¥è¿æ¥åˆ°ä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œå¹¶è·å–å…¶è¯ä¹¦ä¿¡æ¯è¿›è¡Œåˆ†ææˆ–éªŒè¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">agent</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Agent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨è¯ä¹¦ä¿¡æ¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getPeerCertificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘<code>example.com</code>çš„ HTTPS è¯·æ±‚ã€‚é€šè¿‡è®¿é—®å“åº”å¯¹è±¡çš„<code>socket.getPeerCertificate()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å–æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¿…è¦çš„æ ¡éªŒæˆ–å®¡æŸ¥ã€‚</p><h3 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h3><p>Certificate å¯¹è±¡åœ¨ Node.js ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†éœ€è¦åŠ å¯†å’Œå®‰å…¨æ€§çš„ç½‘ç»œé€šä¿¡æ—¶ã€‚é€šè¿‡ç†è§£å’Œåˆ©ç”¨è¿™äº›å¯¹è±¡ï¼Œå¼€å‘äººå‘˜å¯ä»¥åˆ›å»ºå®‰å…¨å¯é çš„åº”ç”¨ç¨‹åºï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®å…å—æ³„éœ²å’Œæ”»å‡»ã€‚</p><h3 id="tlssocket-getpeerfinished" tabindex="-1"><a class="header-anchor" href="#tlssocket-getpeerfinished"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetpeerfinished" target="_blank" rel="noopener noreferrer">tlsSocket.getPeerFinished()</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>tlsSocket.getPeerFinished()</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›èƒŒæ™¯æ¦‚å¿µã€‚</p><h3 id="tls-æ˜¯ä»€ä¹ˆ-1" tabindex="-1"><a class="header-anchor" href="#tls-æ˜¯ä»€ä¹ˆ-1"><span>TLS æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œæ—¨åœ¨ä¸ºäº’è”ç½‘é€šä¿¡æä¾›å®‰å…¨ã€‚å®ƒæ˜¯ HTTPS åè®®çš„åŸºç¡€ï¼Œç”¨äºä¿æŠ¤ç½‘ä¸Šé“¶è¡Œã€ç”µå­é‚®ä»¶å’Œå…¶ä»–æ•æ„Ÿæ•°æ®çš„äº¤æ¢ã€‚</p><h3 id="tls-æ¡æ‰‹" tabindex="-1"><a class="header-anchor" href="#tls-æ¡æ‰‹"><span>TLS æ¡æ‰‹</span></a></h3><p>åœ¨ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´é€šè¿‡ TLS å®‰å…¨åœ°ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œå®ƒä»¬å¿…é¡»å…ˆâ€œæ¡æ‰‹â€å»ºç«‹è¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å‡ ä¸ªæ­¥éª¤ï¼Œå…¶ä¸­åŒ…æ‹¬èº«ä»½éªŒè¯å’Œå¯†é’¥äº¤æ¢ï¼Œä»¥ç¡®ä¿åŒæ–¹éƒ½æ˜¯åˆæ³•çš„ï¼Œå¹¶åŒæ„ä¸€ä¸ªå…±äº«çš„å¯†é’¥è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚</p><h3 id="tlssocket-getpeerfinished-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#tlssocket-getpeerfinished-çš„ä½œç”¨"><span>tlsSocket.getPeerFinished() çš„ä½œç”¨</span></a></h3><p><code>tlsSocket.getPeerFinished()</code> æ–¹æ³•å±äº Node.js çš„ <code>tls</code> æ¨¡å—ï¼Œå®ƒç”¨äºè·å– TLS æ¡æ‰‹è¿‡ç¨‹ä¸­å¯¹ç«¯å‘é€çš„ â€œFinishedâ€ æ¶ˆæ¯çš„å‰¯æœ¬ã€‚è¿™ä¸ªâ€œFinishedâ€æ¶ˆæ¯æ˜¯ç»è¿‡åŠ å¯†çš„ï¼ŒåŒ…å«ä¹‹å‰æ¡æ‰‹æ¶ˆæ¯çš„æ ¡éªŒå’Œï¼ˆæˆ–è€…è¯´æ‘˜è¦ï¼‰ï¼Œç”¨äºéªŒè¯æ¡æ‰‹è¿‡ç¨‹çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-6"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®‰å…¨æ•æ„Ÿçš„åº”ç”¨ç¨‹åºï¼Œå¦‚åœ¨çº¿æ”¯ä»˜å¹³å°ã€‚åœ¨è¿™ç±»åº”ç”¨ä¸­ï¼Œä½¿ç”¨ TLS æ¥åŠ å¯†å®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ <code>getPeerFinished()</code> æ–¹æ³•å¯èƒ½è¢«ç”¨åˆ°çš„åœºæ™¯ï¼š</p><ol><li><p><strong>å¢å¼ºå®‰å…¨å®¡è®¡</strong>ï¼šåœ¨é«˜å®‰å…¨éœ€æ±‚çš„ç³»ç»Ÿä¸­ï¼Œä½ å¯èƒ½æƒ³è¦è®°å½•å’Œå®¡è®¡æ‰€æœ‰å®‰å…¨ç›¸å…³çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬ TLS æ¡æ‰‹çš„ç»†èŠ‚ã€‚é€šè¿‡è°ƒç”¨ <code>tlsSocket.getPeerFinished()</code>ï¼Œä½ å¯ä»¥è·å–å¹¶è®°å½•æ¡æ‰‹è¿‡ç¨‹ä¸­çš„â€œFinishedâ€æ¶ˆæ¯ï¼Œä½œä¸ºåç»­å®‰å…¨åˆ†æçš„ä¸€éƒ¨åˆ†ã€‚</p></li><li><p><strong>è‡ªå®šä¹‰å®‰å…¨é€»è¾‘</strong>ï¼šæŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å®ç°ç‰¹å®šçš„å®‰å…¨ç­–ç•¥ï¼Œè¿™å¯èƒ½æ¶‰åŠåˆ°æ£€æŸ¥æ¡æ‰‹è¿‡ç¨‹çš„å…·ä½“ç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒâ€œFinishedâ€æ¶ˆæ¯çš„å†…å®¹æ¥é¢å¤–éªŒè¯å¯¹ç«¯çš„èº«ä»½æˆ–ç¡®ä¿æ¡æ‰‹æœªè¢«ç¯¡æ”¹ã€‚</p></li><li><p><strong>è°ƒè¯•å’Œæ•…éšœæ’é™¤</strong>ï¼šåœ¨å¼€å‘æˆ–ç»´æŠ¤è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°ä¸ TLS æ¡æ‰‹ç›¸å…³çš„é—®é¢˜ï¼Œè·å–â€œFinishedâ€æ¶ˆæ¯å¯ä»¥å¸®åŠ©ä½ æ·±å…¥äº†è§£æ¡æ‰‹è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°å®šä½å’Œè§£å†³é—®é¢˜ã€‚</p></li></ol><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p>è™½ç„¶ <code>tlsSocket.getPeerFinished()</code> åœ¨æ—¥å¸¸å¼€å‘ä¸­å¯èƒ½ä¸ä¼šé¢‘ç¹ä½¿ç”¨ï¼Œä½†å®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥è®¿é—® TLS æ¡æ‰‹çš„å†…éƒ¨ç»†èŠ‚ï¼Œè¿™å¯¹äºå®‰å…¨æ•æ„Ÿçš„åº”ç”¨å¼€å‘ã€å®‰å…¨å®¡è®¡æˆ–æ˜¯è§£å†³ç‰¹å®šçš„æŠ€æœ¯é—®é¢˜æ¥è¯´æ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚</p><h3 id="tlssocket-getpeerx509certificate" tabindex="-1"><a class="header-anchor" href="#tlssocket-getpeerx509certificate"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetpeerx509certificate" target="_blank" rel="noopener noreferrer">tlsSocket.getPeerX509Certificate()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œå°±åƒä½ é€šå¸¸åœ¨æµè§ˆå™¨ä¸­åšçš„é‚£æ ·ã€‚Node.js éå¸¸é€‚åˆå¼€å‘éœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥è€Œæ— éœ€å¤šçº¿ç¨‹ç¼–ç¨‹çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ä¸€ç§å®ç°å®‰å…¨çš„å¥—æ¥å­—å±‚(TLS)å’Œå®‰å…¨å¥—æ¥å±‚(SSL)åè®®çš„æ–¹å¼ï¼Œè¿™å¯¹äºå»ºç«‹åŠ å¯†è¿æ¥è‡³å…³é‡è¦ã€‚<code>TLS</code>ï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰æ˜¯ä¸€ç§ä¿æŠ¤ç½‘ç»œé€šä¿¡å®‰å…¨çš„åè®®ï¼Œç¡®ä¿æ•°æ®åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªç½‘ç»œèŠ‚ç‚¹ä¹‹é—´ä¼ è¾“æ—¶ä¸è¢«çªƒå¬æˆ–ç¯¡æ”¹ã€‚</p><h3 id="tlssocket-getpeerx509certificate-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-getpeerx509certificate-1"><span>tlsSocket.getPeerX509Certificate()</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„ <code>tls</code> æ¨¡å—ä¸­ï¼Œ<code>tlsSocket.getPeerX509Certificate()</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå…è®¸ä½ è·å–ä¸å½“å‰ TLS/SSL è¿æ¥ç›¸å…³è”çš„å¯¹ç­‰æ–¹ï¼ˆpeer, é€šå¸¸æ˜¯æŒ‡æœåŠ¡ç«¯ï¼‰çš„ X.509 è¯ä¹¦ä¿¡æ¯ã€‚X.509 è¯ä¹¦æ˜¯ä¸€ç§ç”µå­æ–‡æ¡£ï¼Œä½¿ç”¨å…¬é’¥å¯†ç å­¦æ¥è¯æ˜å…¬é’¥æ‹¥æœ‰è€…çš„èº«ä»½ã€‚åœ¨ HTTPS å’Œå…¶ä»–åŸºäº TLS/SSL çš„åè®®ä¸­ï¼ŒX.509 è¯ä¹¦å¸®åŠ©å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œé˜²æ­¢â€œä¸­é—´äººâ€æ”»å‡»ç­‰å®‰å…¨å¨èƒã€‚</p><p><strong>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</strong></p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä¸ç¬¬ä¸‰æ–¹ API è¿›è¡Œå®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æ­£åœ¨æ„å»ºä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ï¼Œéœ€è¦å‘æ”¯ä»˜ç½‘å…³å‘é€å®¢æˆ·çš„æ”¯ä»˜ä¿¡æ¯ã€‚ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼Œä½ å†³å®šä½¿ç”¨ HTTPS åè®®ä¸æ”¯ä»˜ API é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„ <code>tls</code> æ¨¡å—ä¸­çš„ <code>tlsSocket.getPeerX509Certificate()</code> æ–¹æ³•æ¥éªŒè¯ä½ æ­£åœ¨ä¸ä¹‹é€šä¿¡çš„æœåŠ¡å™¨çš„è¯ä¹¦ã€‚è¿™ä¸ªæ­¥éª¤æ˜¯ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºåªä¼šå°†æ•°æ®å‘é€åˆ°çœŸæ­£çš„ã€å¯ä¿¡çš„æœåŠ¡å™¨çš„é‡è¦ç¯èŠ‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æŒ‡å®šè¿æ¥çš„é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æœåŠ¡å™¨çš„åŸŸåæˆ–IPåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // é€šå¸¸HTTPSè¿è¡Œäº443ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®¢æˆ·ç«¯è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºTLSè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è·å–å¯¹ç­‰æ–¹çš„X.509è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getPeerX509Certificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“ç„¶ï¼Œä½ è¿˜åº”å½“æ£€æŸ¥ç‰¹å®šçš„è¯ä¹¦å±æ€§ä»¥è¿›è¡Œè¿›ä¸€æ­¥éªŒè¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¾‹å¦‚ï¼šcert.subject.OU æˆ– cert.issuer.CN</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å…³é—­è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåˆ° <code>example.com</code> çš„å®‰å…¨è¿æ¥ï¼Œå¹¶åœ¨è¿æ¥å»ºç«‹åè·å–äº†æœåŠ¡å™¨çš„ X.509 è¯ä¹¦ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥è¯¥è¯ä¹¦çš„ç»†èŠ‚ï¼Œå¦‚ç­¾å‘æœºæ„ã€æœ‰æ•ˆæœŸã€ä¸»é¢˜ç­‰ï¼Œæ¥è¿›ä¸€æ­¥ç¡®è®¤æˆ‘ä»¬æ­£åœ¨ä¸é¢„æœŸçš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚è¿™å¯¹äºä¿æŠ¤æ•æ„Ÿæ•°æ®ä¼ è¾“éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠé‡‘èäº¤æ˜“æˆ–ä¸ªäººä¿¡æ¯çš„åœºæ™¯ä¸­ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>tlsSocket.getPeerX509Certificate()</code> æ–¹æ³•æ˜¯ Node.js åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨é€šä¿¡çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œé€šè¿‡éªŒè¯å¯¹ç­‰æ–¹çš„èº«ä»½æ¥å¢å¼ºæ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><h3 id="tlssocket-getprotocol" tabindex="-1"><a class="header-anchor" href="#tlssocket-getprotocol"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetprotocol" target="_blank" rel="noopener noreferrer">tlsSocket.getProtocol()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰ï¼Œæ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨æ¥ä¿è¯ç½‘ç»œé€šä¿¡çš„å®‰å…¨æ€§ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>tlsSocket.getProtocol()</code> æ˜¯ä¸ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰ç›¸å…³çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè·å–è¡¨ç¤ºæ­£åœ¨ä½¿ç”¨çš„ TLS åè®®ç‰ˆæœ¬çš„å­—ç¬¦ä¸²ã€‚è¿™å¯¹äºå®‰å…¨æ€§è°ƒè¯•å’Œç¡®ä¿åº”ç”¨ç¨‹åºä½¿ç”¨æœ€æ–°ã€æœ€å®‰å…¨çš„åè®®ç‰ˆæœ¬éå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ-2" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å·¥ä½œ-2"><span>å¦‚ä½•å·¥ä½œï¼š</span></a></h3><p>å‡è®¾ä½ å·²ç»åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚å½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„ TLS è¿æ¥åï¼Œä½œä¸ºè¿™ä¸ªè¿æ¥çš„ä¸€éƒ¨åˆ†ï¼ŒåŒæ–¹ä¼šåå•†å¹¶åŒæ„ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ TLS åè®®ã€‚<code>tlsSocket.getProtocol()</code> å…è®¸ä½ æ£€æŸ¥æ­¤è¿æ¥ä½¿ç”¨çš„æ­£æ˜¯å“ªä¸ªç‰ˆæœ¬ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7"><span>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</span></a></h3><ol><li><p><strong>å®‰å…¨å®¡æ ¸</strong>ï¼šå¦‚æœä½ æ­£åœ¨è¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥æˆ–è€…å®¡æ ¸ï¼Œå¹¶æƒ³ç¡®è®¤ä½ çš„æœåŠ¡åªæ¥å—ç¬¦åˆå½“å‰å®‰å…¨æ ‡å‡†çš„ TLS ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ <code>tlsSocket.getProtocol()</code> æ¥è·å–è¿æ¥ä½¿ç”¨çš„å…·ä½“ TLS ç‰ˆæœ¬ï¼Œè¿›è€ŒéªŒè¯æ˜¯å¦ç¬¦åˆå®‰å…¨æ”¿ç­–ã€‚</p></li><li><p><strong>æ—¥å¿—è®°å½•</strong>ï¼šåœ¨å¤„ç†è¯Šæ–­é—®é¢˜æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦è®°å½•å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤äº’ä½¿ç”¨çš„ TLS ç‰ˆæœ¬ã€‚é€šè¿‡ä¸ºæ¯ä¸ªè¿æ¥è°ƒç”¨ <code>tlsSocket.getProtocol()</code> å¹¶è®°å½•å…¶ç»“æœï¼Œä½ å¯ä»¥è½»æ¾è·Ÿè¸ªè¿™äº›ä¿¡æ¯ã€‚</p></li><li><p><strong>å¼ºåˆ¶ä½¿ç”¨æ›´é«˜ç‰ˆæœ¬çš„ TLS</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºæ—§ç‰ˆæœ¬çš„ TLS å­˜åœ¨å·²çŸ¥çš„å®‰å…¨æ¼æ´ï¼Œä½ å¯èƒ½æƒ³è¦ç¡®ä¿åº”ç”¨ç¨‹åºä»…é€šè¿‡æœ€æ–°ç‰ˆæœ¬çš„ TLS åè®®è¿›è¡Œé€šä¿¡ã€‚è™½ç„¶ <code>tlsSocket.getProtocol()</code> æœ¬èº«ä¸å…è®¸ä½ å¼ºåˆ¶æ‰§è¡Œè¿™ä¸€ç‚¹ï¼Œä½†å®ƒå¯ä»¥ç”¨æ¥ç¡®è®¤æˆ–æ–­å¼€ä¸ç¬¦åˆè¿™äº›æ¡ä»¶çš„è¿æ¥ã€‚</p></li></ol><h3 id="ç¤ºä¾‹ä»£ç -3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -3"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨ <code>tlsSocket.getProtocol()</code> çš„ç®€åŒ–ç¤ºä¾‹ã€‚è¿™ä¸ªç¤ºä¾‹å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ª TLS æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TLS Protocol:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ‰“å°å‡ºå®¢æˆ·ç«¯è¿æ¥æ‰€ä½¿ç”¨çš„ TLS åè®®ç‰ˆæœ¬ã€‚</p><p>è®°ä½ï¼Œå®é™…ç¼–ç å®è·µä¸­éœ€è¦æ›´å¤šçš„é”™è¯¯å¤„ç†å’Œå®‰å…¨é…ç½®ï¼Œä¾‹å¦‚æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæ€§ç­‰ã€‚è¿™é‡Œçš„ä¾‹å­ä¸»è¦æ˜¯ä¸ºäº†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>tlsSocket.getProtocol()</code> æ–¹æ³•ã€‚</p><h3 id="tlssocket-getsession" tabindex="-1"><a class="header-anchor" href="#tlssocket-getsession"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetsession" target="_blank" rel="noopener noreferrer">tlsSocket.getSession()</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>tlsSocket.getSession()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯åœ¨è®¨è®ºå¦‚ä½•åœ¨ä¸€ä¸ªå®‰å…¨çš„ä¼ è¾“å±‚ï¼ˆTLSï¼‰è¿æ¥ä¸­è·å–å½“å‰çš„ä¼šè¯ä¿¡æ¯ã€‚è¿™ä¸ªåŠŸèƒ½å¯¹äºç®¡ç†å’Œè°ƒè¯• TLS è¿æ¥ç‰¹åˆ«é‡è¦ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹è¿™å…¶ä¸­çš„æ¦‚å¿µä»¥åŠè¿™ä¸ªæ–¹æ³•æ€æ ·è¢«å®é™…è¿ç”¨ã€‚</p><h3 id="tls-ç®€ä»‹-1" tabindex="-1"><a class="header-anchor" href="#tls-ç®€ä»‹-1"><span>TLS ç®€ä»‹</span></a></h3><p>TLSï¼Œå…¨ç§°ä¸ºä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼Œå®ƒæ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œæ—¨åœ¨ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨å’Œæ•°æ®å®Œæ•´æ€§ä¿æŠ¤ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œå¦‚æœç½‘å€ä»¥&quot;https://&quot;å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä½¿ç”¨ TLS è¿›è¡ŒåŠ å¯†çš„ã€‚è¿™ä¿è¯äº†ä½ å‘é€åˆ°æœåŠ¡å™¨çš„ä¿¡æ¯ä»¥åŠä»æœåŠ¡å™¨æ”¶åˆ°çš„ä¿¡æ¯éƒ½æ— æ³•è¢«ä¸­é—´äººçªƒå¬æˆ–ç¯¡æ”¹ã€‚</p><h3 id="tlssocket-getsession-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-getsession-1"><span>tlsSocket.getSession()</span></a></h3><p>åœ¨ Node.js çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>tlsSocket.getSession()</code>æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºä»ä¸€ä¸ª TLS å¥—æ¥å­—ä¸­æ£€ç´¢å½“å‰çš„ä¼šè¯æ•°æ®ã€‚TLS å¥—æ¥å­—æ˜¯æŒ‡åœ¨ TLS åè®®ä¹‹ä¸Šå»ºç«‹çš„ä¸€ä¸ªç½‘ç»œè¿æ¥ï¼Œæä¾›äº†æ•°æ®åŠ å¯†ã€èº«ä»½è®¤è¯ç­‰å®‰å…¨ç‰¹æ€§ã€‚ä¼šè¯æ•°æ®å¯ä»¥åŒ…æ‹¬ç”¨äºè¯¥ç‰¹å®šè¿æ¥çš„å„ç§å¯†é’¥å’Œè¯ä¹¦ä¿¡æ¯ã€‚</p><p>è¿”å›å€¼ï¼šè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª<code>Buffer</code>å¯¹è±¡ï¼ŒåŒ…å«éé€æ˜çš„ä¼šè¯æ ‡è¯†ç¬¦ã€‚å¦‚æœæ²¡æœ‰ä¼šè¯æ­£åœ¨è¿›è¡Œï¼Œåˆ™å¯èƒ½è¿”å›<code>null</code>ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="_1-è°ƒè¯•-tls-è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_1-è°ƒè¯•-tls-è¿æ¥"><span>1. è°ƒè¯• TLS è¿æ¥</span></a></h4><p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªç½‘ç»œç®¡ç†å‘˜ï¼Œä½ éœ€è¦ç¡®ä¿ä½ çš„æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„ TLS è¿æ¥æ˜¯æ­£ç¡®é…ç½®ä¸”å®‰å…¨çš„ã€‚ä½¿ç”¨<code>tlsSocket.getSession()</code>æ–¹æ³•ï¼Œä½ å¯ä»¥è·å¾—å½“å‰ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚ä½¿ç”¨çš„åŠ å¯†å¥—ä»¶ã€å¯†é’¥äº¤æ¢ä¿¡æ¯ç­‰ï¼Œè¿™æœ‰åŠ©äºä½ æ£€æŸ¥å’ŒéªŒè¯è¿æ¥çš„å®‰å…¨æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;server-key.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;server-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;server connected&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;authorized&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;unauthorized&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;utf8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;server listening&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªåˆ°æœåŠ¡å™¨çš„è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> clientSocket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ...</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // è¿™é‡Œçœç•¥äº†åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—å’Œè¿æ¥æœåŠ¡å™¨çš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sessionData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> clientSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getSession</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sessionData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºsessionæ•°æ®ï¼Œç”¨äºè°ƒè¯•ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šä¸ºäº†ç®€æ´ï¼Œå¹¶æ²¡æœ‰å±•ç¤ºå®Œæ•´çš„å®¢æˆ·ç«¯ä»£ç ï¼Œè¿™æ®µä»£ç ä¸»è¦ç”¨æ¥è¯´æ˜å¦‚ä½•åœ¨æœåŠ¡ç«¯åº”ç”¨<code>getSession()</code>ã€‚</p><h4 id="_2-ä¼šè¯å¤ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-ä¼šè¯å¤ç”¨"><span>2. ä¼šè¯å¤ç”¨</span></a></h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ºäº†å‡å°‘å»ºç«‹ TLS è¿æ¥æ‰€éœ€çš„æ—¶é—´å’Œèµ„æºï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯èƒ½å¸Œæœ›å¤ç”¨ä¹‹å‰çš„ä¼šè¯å‚æ•°æ¥é‡æ–°å»ºç«‹è¿æ¥ã€‚é€šè¿‡<code>getSession()</code>è·å–çš„ä¼šè¯æ•°æ®å¯ä»¥è¢«ç”¨æ¥å®ç°ä¼šè¯å¤ç”¨ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—æé«˜åç»­è¿æ¥çš„é€Ÿåº¦ã€‚</p><p>è™½ç„¶ç›´æ¥çš„ä½¿ç”¨æ¡ˆä¾‹è¾ƒå°‘ï¼Œå› ä¸º Node.js çš„ TLS æ¨¡å—åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½è‡ªåŠ¨å¤„ç†äº†ä¼šè¯å¤ç”¨ï¼Œç†è§£å…¶èƒŒåçš„æœºåˆ¶å¯¹äºæ·±å…¥å­¦ä¹  TLS åè®®å’Œ Node.js çš„ TLS æ”¯æŒæ˜¯éå¸¸æœ‰ç›Šçš„ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>tlsSocket.getSession()</code>æä¾›äº†ä¸€ç§æ–¹å¼æ¥è®¿é—® TLS è¿æ¥çš„å†…éƒ¨çŠ¶æ€ï¼Œè¿™å¯¹äºå®‰å…¨æ€§åˆ†æã€è°ƒè¯•ä»¥åŠä¼˜åŒ– TLS è¿æ¥éå¸¸æœ‰ç”¨ã€‚</p><h3 id="tlssocket-getsharedsigalgs" tabindex="-1"><a class="header-anchor" href="#tlssocket-getsharedsigalgs"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetsharedsigalgs" target="_blank" rel="noopener noreferrer">tlsSocket.getSharedSigalgs()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ç”¨ JavaScript å†™å‡ºæœåŠ¡å™¨åº”ç”¨ç¨‹åºã€å‘½ä»¤è¡Œå·¥å…·ç­‰ã€‚</p><h3 id="tlssocket-getsharedsigalgs-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-getsharedsigalgs-1"><span>tlsSocket.getSharedSigalgs()</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>tlsSocket.getSharedSigalgs()</code> æ˜¯ <code>TLS (Transport Layer Security)</code> æ¨¡å—ä¸‹çš„ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä½œç”¨äº TLS å¥—æ¥å­—ï¼ˆä¹Ÿå°±æ˜¯åŠ å¯†çš„ç½‘ç»œé€šä¿¡è¿æ¥ï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å…è®¸ä½ è·å– TLS æ¡æ‰‹è¿‡ç¨‹ä¸­åŒæ–¹ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰å…±åŒè®¤å¯çš„ç­¾åç®—æ³•åˆ—è¡¨ã€‚</p><h4 id="ä¸ºä»€ä¹ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆé‡è¦"><span>ä¸ºä»€ä¹ˆé‡è¦?</span></a></h4><p>åœ¨ TLS æ¡æ‰‹æœŸé—´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼šåå•†å‡ºä¸€ç³»åˆ—å…±äº«çš„å‚æ•°ï¼ŒåŒ…æ‹¬åŠ å¯†ç®—æ³•å’Œç­¾åç®—æ³•ã€‚è¿™äº›ç®—æ³•ç”¨äºç¡®ä¿é€šä¿¡çš„å®‰å…¨æ€§ã€‚çŸ¥é“å“ªäº›ç­¾åç®—æ³•è¢«å…±åŒæ”¯æŒå¯¹äºè°ƒè¯•å®‰å…¨é—®é¢˜æˆ–ä¼˜åŒ–ç½‘ç»œæ€§èƒ½å¾ˆæœ‰å¸®åŠ©ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å»ºç«‹ä¸€ä¸ªéœ€è¦é«˜å®‰å…¨æ ‡å‡†çš„é“¶è¡Œç³»ç»Ÿï¼Œåœ¨ä¸å…¶ä»–é‡‘èæœºæ„è¿›è¡Œæ•°æ®äº¤æ¢æ—¶ï¼ŒåŒæ–¹çš„é€šä¿¡éœ€è¦ç»è¿‡ä¸¥æ ¼çš„åŠ å¯†ã€‚ä½¿ç”¨ <code>tlsSocket.getSharedSigalgs()</code> å¯ä»¥å¸®åŠ©ä½ äº†è§£åœ¨å®é™…çš„ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œä½ çš„ç³»ç»Ÿå’Œåˆä½œä¼™ä¼´ç³»ç»Ÿä¹‹é—´éƒ½æ”¯æŒå“ªäº›ç­¾åç®—æ³•ï¼Œä»è€Œç¡®ä¿é‡‡ç”¨æœ€å¼ºçš„å…±äº«åŠ å¯†ç®—æ³•ï¼Œæå‡æ•´ä½“é€šä¿¡çš„å®‰å…¨æ€§ã€‚</p><h4 id="å®é™…ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…ä»£ç ç¤ºä¾‹"><span>å®é™…ä»£ç ç¤ºä¾‹</span></a></h4><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è¿™é‡Œåªç»™å‡ºä½¿ç”¨ <code>tlsSocket.getSharedSigalgs()</code> éƒ¨åˆ†çš„ç²¾ç®€ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾å·²ç»æœ‰äº†SSLè¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªTLSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ‰“å°å…±äº«çš„ç­¾åç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getSharedSigalgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥æ­¤æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥æŸ¥çœ‹å…±äº«çš„ç­¾åç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getSharedSigalgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>tls</code> å’Œ <code>fs</code> æ¨¡å—ï¼Œç„¶åç”¨ <code>fs</code> æ¨¡å—è¯»å–äº†æœåŠ¡å™¨çš„ SSL è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª tls æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œå¹¶åœ¨è¿æ¥æˆåŠŸåé€šè¿‡ <code>getSharedSigalgs()</code> æ–¹æ³•æ‰“å°å‡ºå…±äº«çš„ç­¾åç®—æ³•åˆ—è¡¨ã€‚</p><p>è¯·æ³¨æ„ï¼Œä¸ºäº†æ­£å¸¸è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ éœ€è¦æœ‰æœ‰æ•ˆçš„ SSL è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚è¿™ä¸ªä¾‹å­ä¸»è¦å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>tlsSocket.getSharedSigalgs()</code> æ–¹æ³•ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¾æ®é¡¹ç›®éœ€æ±‚è¿˜å¯èƒ½æ¶‰åŠåˆ°æ›´å¤æ‚çš„é…ç½®å’Œé”™è¯¯å¤„ç†ã€‚</p><h3 id="tlssocket-gettlsticket" tabindex="-1"><a class="header-anchor" href="#tlssocket-gettlsticket"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgettlsticket" target="_blank" rel="noopener noreferrer">tlsSocket.getTLSTicket()</a></span></a></h3><p>è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°ç†è§£ <code>tlsSocket.getTLSTicket()</code> æ–¹æ³•åœ¨ Node.js v21.7.1 ä¸­çš„ä½œç”¨ï¼Œä»¥åŠå®ƒå¦‚ä½•è¿ç”¨åˆ°å®é™…åœºæ™¯ä¸­ã€‚</p><p>é¦–å…ˆï¼Œäº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µä¼šæœ‰æ‰€å¸®åŠ©ï¼š</p><h3 id="tls-ä¼ è¾“å±‚å®‰å…¨åè®®" tabindex="-1"><a class="header-anchor" href="#tls-ä¼ è¾“å±‚å®‰å…¨åè®®"><span>TLS (ä¼ è¾“å±‚å®‰å…¨åè®®)</span></a></h3><p>TLSï¼Œå³ä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œæ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§çš„æ ‡å‡†ã€‚å®ƒæ˜¯æœ€å¸¸è§çš„åŠ å¯†åè®®ä¹‹ä¸€ï¼Œå¹¿æ³›ç”¨äº Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œæ¯”å¦‚å½“ä½ è®¿é—®ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ã€‚</p><h3 id="tls-session-ticket" tabindex="-1"><a class="header-anchor" href="#tls-session-ticket"><span>TLS Session Ticket</span></a></h3><p>TLS ä¼šè¯ç¥¨æ®ï¼ˆSession Ticketï¼‰æ˜¯ä¸€ç§ä¼˜åŒ– TLS æ¡æ‰‹è¿‡ç¨‹çš„æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œå½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿›è¡Œé¦–æ¬¡ TLS æ¡æ‰‹å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªâ€œç¥¨æ®â€ã€‚å®¢æˆ·ç«¯åœ¨ä¹‹åå°è¯•é‡æ–°è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç¥¨æ®è€Œä¸éœ€è¦é‡æ–°ç»è¿‡æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘å»¶è¿Ÿå’Œæ€§èƒ½å¼€é”€ã€‚</p><h3 id="node-js-ä¸­çš„-tlssocket-gettlsticket" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-tlssocket-gettlsticket"><span>Node.js ä¸­çš„ <code>tlsSocket.getTLSTicket()</code></span></a></h3><p>åœ¨ Node.js çš„ TLS æ¨¡å—ä¸­ï¼Œ<code>tlsSocket.getTLSTicket()</code> æ–¹æ³•å…è®¸ä½ è·å–å½“å‰ TLS è¿æ¥çš„ä¼šè¯ç¥¨æ®ã€‚å¦‚æœæœåŠ¡å™¨å·²ç»å‘é€äº†ä¼šè¯ç¥¨æ®ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«è¯¥ç¥¨æ®çš„ Buffer å¯¹è±¡ï¼›å¦‚æœæ²¡æœ‰å¯ç”¨çš„ç¥¨æ®æˆ–è€…ç¥¨æ®å·²ç»è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¿”å› nullã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®ä¾‹æ¥çœ‹çœ‹å®ƒåœ¨å®è·µä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h4 id="å®é™…åœºæ™¯åº”ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åœºæ™¯åº”ç”¨ä¸¾ä¾‹"><span>å®é™…åœºæ™¯åº”ç”¨ä¸¾ä¾‹</span></a></h4><h5 id="åœºæ™¯ä¸€-æé«˜-https-æœåŠ¡çš„æ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯ä¸€-æé«˜-https-æœåŠ¡çš„æ€§èƒ½"><span>åœºæ™¯ä¸€ï¼šæé«˜ HTTPS æœåŠ¡çš„æ€§èƒ½</span></a></h5><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåŸºäº Node.js çš„ Web åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä½ æƒ³è¦ä¼˜åŒ–é‡å¤è®¿é—®ç”¨æˆ·çš„ä½“éªŒé€Ÿåº¦ã€‚ä½¿ç”¨ <code>tlsSocket.getTLSTicket()</code> å¯ä»¥å¸®åŠ©ä½ å®ç°è¿™ä¸€ç‚¹ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ä½ çš„åº”ç”¨æ—¶ï¼Œä½ çš„æœåŠ¡å™¨å¯ä»¥ç”Ÿæˆå¹¶å‘é€ä¸€ä¸ª TLS ä¼šè¯ç¥¨æ®ç»™å®¢æˆ·ç«¯ã€‚å½“ç”¨æˆ·å†æ¬¡è®¿é—®æ—¶ï¼Œåªéœ€è¦æäº¤ä¹‹å‰ä¿å­˜çš„ç¥¨æ®ï¼Œä¾¿å¯ä»¥åŠ é€Ÿ TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œä»è€Œæé«˜æ•´ä½“çš„åŠ è½½é€Ÿåº¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªå»ºç«‹TLSè¿æ¥çš„socketå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tlsTicket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tlsSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTLSTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">tlsTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å°†ç¥¨æ®å­˜å‚¨èµ·æ¥ï¼Œä¸‹æ¬¡å¯ä»¥ä½¿ç”¨å®ƒæ¥åŠ å¿«æ¡æ‰‹è¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åœºæ™¯äºŒ-å®‰å…¨åœ°ç®¡ç†ä¼šè¯çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯äºŒ-å®‰å…¨åœ°ç®¡ç†ä¼šè¯çŠ¶æ€"><span>åœºæ™¯äºŒï¼šå®‰å…¨åœ°ç®¡ç†ä¼šè¯çŠ¶æ€</span></a></h5><p>åœ¨éœ€è¦ç»´æŠ¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨çŠ¶æ€çš„åº”ç”¨ä¸­ï¼Œæ¯”å¦‚åœ¨çº¿æ”¯ä»˜ç³»ç»Ÿï¼Œ<code>tlsSocket.getTLSTicket()</code> å¯ä»¥ç”¨æ¥è¯†åˆ«å’ŒéªŒè¯å®¢æˆ·ç«¯è¿æ¥ã€‚é€šè¿‡æ¯”å¯¹ä¼šè¯ç¥¨æ®ï¼ŒæœåŠ¡å™¨å¯ä»¥ç¡®è®¤è¯·æ±‚æ˜¯å¦æ¥è‡ªé¢„æœŸçš„å®¢æˆ·ç«¯ï¼Œè¿›è€Œå¢å¼ºç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“å®¢æˆ·ç«¯å°è¯•é‡æ–°è¿æ¥æ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tlsTicket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tlsSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTLSTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">tlsTicket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> isValidTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">tlsTicket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // éªŒè¯ç¥¨æ®çš„æœ‰æ•ˆæ€§ï¼ˆè¿™éœ€è¦ä½ å®ç°isValidTicketå‡½æ•°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç¥¨æ®æœ‰æ•ˆï¼Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç¥¨æ®æ— æ•ˆï¼Œæ‹’ç»è¯·æ±‚æˆ–è¦æ±‚é‡æ–°è®¤è¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>tlsSocket.getTLSTicket()</code> åœ¨å®é™…åº”ç”¨ä¸­å¯ä»¥æä¾›æ€§èƒ½ä¼˜åŒ–å’Œå¢å¼ºå®‰å…¨æ€§çš„åŒé‡å¥½å¤„ã€‚å½“ç„¶ï¼Œåœ¨ä½¿ç”¨æ—¶è¿˜éœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘å’Œå®‰å…¨è¦æ±‚æ¥è®¾è®¡ç³»ç»Ÿã€‚</p><h3 id="tlssocket-getx509certificate" tabindex="-1"><a class="header-anchor" href="#tlssocket-getx509certificate"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketgetx509certificate" target="_blank" rel="noopener noreferrer">tlsSocket.getX509Certificate()</a></span></a></h3><p>ç†è§£ <code>tlsSocket.getX509Certificate()</code> æ–¹æ³•ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“å®ƒæ˜¯åœ¨ Node.js ä¸­çš„ç”¨é€”ã€‚è¿™ä¸ªæ–¹æ³•å±äº Node.js çš„ TLS (ä¼ è¾“å±‚å®‰å…¨åè®®) æ¨¡å—ï¼Œä¸»è¦ç”¨äºè·å– TLS è¿æ¥ä¸­å¯¹ç«¯ï¼ˆå³æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼‰çš„ X.509 è¯ä¹¦ä¿¡æ¯ã€‚X.509 è¯ä¹¦æ˜¯ä¸€ç§æ ‡å‡†ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šçš„ä¸¤ä¸ªå®ä½“ä¹‹é—´å»ºç«‹ä¿¡ä»»å…³ç³»ï¼Œå¸¸è§äº HTTPS è¿æ¥ã€‚</p><h3 id="ç†è§£-getx509certificate" tabindex="-1"><a class="header-anchor" href="#ç†è§£-getx509certificate"><span>ç†è§£ <code>getX509Certificate()</code></span></a></h3><p>å½“ä½ ä½¿ç”¨ <code>tls.Socket</code> çš„ <code>getX509Certificate()</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«äº†å¯¹ç«¯è¯ä¹¦è¯¦ç»†ä¿¡æ¯çš„å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰è¯ä¹¦æˆ–è¯ä¹¦æ— æ³•éªŒè¯ï¼Œåˆ™è¿”å› <code>null</code> æˆ– <code>undefined</code>ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒè®©ä½ èƒ½å¤Ÿç¼–ç¨‹å¼åœ°æ£€æŸ¥å’ŒéªŒè¯ä¸ä½ é€šä¿¡çš„å¯¹ç«¯è¯ä¹¦çš„è¯¦æƒ…ï¼Œæ¯”å¦‚è¯ä¹¦çš„å‘å¸ƒè€…ã€æœ‰æ•ˆæœŸã€ä¸»é¢˜ç­‰ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥å¢å¼ºä½ çš„åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>HTTPS æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯çš„å®‰å…¨äº¤æµï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„ Web åº”ç”¨ã€‚åœ¨å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨ä¹‹é—´é€šè¿‡ HTTPS å»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ <code>getX509Certificate()</code> æ–¹æ³•æ¥éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€æ˜¯å¦è¢«ä¿¡ä»»çš„é¢å‘æœºæ„ç­¾åï¼Œä»¥åŠæ˜¯å¦æœªè¢«ç¯¡æ”¹æˆ–è¿‡æœŸã€‚è¿™æ˜¯ç¡®ä¿é€šä¿¡å®‰å…¨çš„é‡è¦æ­¥éª¤ã€‚</p></li><li><p><strong>æ„å»ºå®‰å…¨çš„ IoT é€šä¿¡ç³»ç»Ÿï¼š</strong></p><p>åœ¨ç‰©è”ç½‘(IoT)è®¾å¤‡é—´çš„é€šä¿¡ä¸­ï¼Œå®‰å…¨åŒæ ·è‡³å…³é‡è¦ã€‚è®¾æƒ³ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåªå…è®¸ç‰¹å®šè®¾å¤‡ä¹‹é—´é€šä¿¡çš„ç³»ç»Ÿã€‚ä½ å¯ä»¥åˆ©ç”¨ <code>getX509Certificate()</code> æ–¹æ³•æ¥ç¡®ä¿åªæœ‰æ‹¥æœ‰æœ‰æ•ˆè¯ä¹¦çš„è®¾å¤‡æ‰èƒ½ç›¸äº’é€šä¿¡ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆé˜²æ­¢æœªæˆæƒçš„è®¾å¤‡åŠ å…¥ç½‘ç»œé€ æˆçš„æ½œåœ¨å¨èƒã€‚</p></li><li><p><strong>API å®‰å…¨è°ƒç”¨éªŒè¯ï¼š</strong></p><p>å½“ä½ çš„åº”ç”¨éœ€è¦è°ƒç”¨å¤–éƒ¨ API æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç¡®ä¿ä½ æ­£åœ¨ä¸æ­£ç¡®ä¸”å®‰å…¨çš„æœåŠ¡è¿›è¡Œäº¤äº’ã€‚é€šè¿‡ä½¿ç”¨ <code>getX509Certificate()</code> æ–¹æ³•è·å–å¹¶éªŒè¯ API æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯ï¼Œå¯ä»¥å¸®åŠ©ä½ çš„åº”ç”¨é¿å…å‘é€æ•æ„Ÿæ•°æ®åˆ°ä¸å¯ä¿¡çš„æºã€‚</p></li></ol><h3 id="å°ç»“-3" tabindex="-1"><a class="header-anchor" href="#å°ç»“-3"><span>å°ç»“</span></a></h3><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>tlsSocket.getX509Certificate()</code> æ˜¯ä¸€ä¸ªåœ¨éœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œæ— è®ºæ˜¯ Web å¼€å‘ã€API å®‰å…¨è°ƒç”¨è¿˜æ˜¯æ„å»º IoT è§£å†³æ–¹æ¡ˆã€‚å®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥ç¨‹åºåŒ–åœ°éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨ä¼ è¾“ï¼Œæ˜¯æ„å»ºå®‰å…¨åº”ç”¨ç¨‹åºçš„é‡è¦ä¸€ç¯ã€‚</p><h3 id="tlssocket-issessionreused" tabindex="-1"><a class="header-anchor" href="#tlssocket-issessionreused"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketissessionreused" target="_blank" rel="noopener noreferrer">tlsSocket.isSessionReused()</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥èŠä¸€ä¸‹ Node.js ä¸­çš„<code>tlsSocket.isSessionReused()</code>æ–¹æ³•ï¼Œå¹¶ä¸”å°½é‡ç”¨ç®€å•æ˜“æ‡‚çš„æ–¹å¼æ¥è§£é‡Šå®ƒã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£<code>tlsSocket.isSessionReused()</code>ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚</p><h3 id="tls-æ˜¯ä»€ä¹ˆ-2" tabindex="-1"><a class="header-anchor" href="#tls-æ˜¯ä»€ä¹ˆ-2"><span>TLS æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>TLS å…¨ç§°ä¸ºä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼ˆTransport Layer Securityï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œæ—¨åœ¨é€šè¿‡äº’è”ç½‘ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æä¾›å®‰å…¨æ€§ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ï¼Œè¯¥ç½‘ç«™å’Œä½ çš„æµè§ˆå™¨å°±æ˜¯é€šè¿‡ TLS æ¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-ä¼šè¯é‡ç”¨" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-ä¼šè¯é‡ç”¨"><span>ä»€ä¹ˆæ˜¯ TLS ä¼šè¯é‡ç”¨ï¼Ÿ</span></a></h3><p>åœ¨ TLS è¿æ¥å»ºç«‹è¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹éœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ¡æ‰‹æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å¤šæ­¥éª¤çš„è®¡ç®—ï¼Œæ¯”å¦‚ç”ŸæˆåŠ å¯†å‚æ•°å’ŒéªŒè¯èº«ä»½ç­‰ï¼Œè¿™ä¼šé€ æˆä¸€å®šçš„å»¶è¿Ÿå’Œé¢å¤–çš„è®¡ç®—è´Ÿæ‹…ã€‚ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼ŒTLS æ”¯æŒä¸€ç§ç§°ä¸ºâ€œä¼šè¯é‡ç”¨â€çš„æœºåˆ¶ã€‚å³ï¼Œä¸€æ—¦ä¸¤å°è®¾å¤‡æˆåŠŸå»ºç«‹äº†ä¸€æ¬¡ TLS è¿æ¥ï¼Œå®ƒä»¬å¯ä»¥ä¿å­˜è¿™æ¬¡è¿æ¥çš„ä¸€äº›å‚æ•°ï¼Œä¸‹æ¬¡å†é€šä¿¡æ—¶ç›´æ¥å¤ç”¨è¿™äº›å‚æ•°ï¼Œä»è€Œè·³è¿‡éƒ¨åˆ†æ¡æ‰‹è¿‡ç¨‹ï¼ŒåŠ å¿«è¿æ¥é€Ÿåº¦ï¼Œæé«˜æ•ˆç‡ã€‚</p><h3 id="tlssocket-issessionreused-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#tlssocket-issessionreused-çš„ä½œç”¨"><span><code>tlsSocket.isSessionReused()</code>çš„ä½œç”¨</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tlsSocket</code>å¯¹è±¡ä»£è¡¨ç€ä¸€ä¸ªåŸºäº TLS çš„ç½‘ç»œè¿æ¥ã€‚<code>tlsSocket.isSessionReused()</code>è¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥æŸ¥è¯¢å½“å‰çš„ TLS è¿æ¥æ˜¯å¦æ˜¯åˆ©ç”¨äº†ä¹‹å‰çš„æŸä¸ªè¿æ¥çš„å‚æ•°ï¼ˆå³æ˜¯å¦å‘ç”Ÿäº†ä¼šè¯é‡ç”¨ï¼‰ã€‚å¦‚æœå‘ç”Ÿäº†ä¼šè¯é‡ç”¨ï¼Œå®ƒä¼šè¿”å›<code>true</code>ï¼›å¦åˆ™è¿”å›<code>false</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåŸºäº Node.js çš„ Web åº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦é¢‘ç¹åœ°ä¸ä¸€ä¸ª HTTPS æœåŠ¡å™¨äº¤æ¢æ•°æ®ã€‚ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œä½ å¯èƒ½å¸Œæœ›åˆ©ç”¨ TLS ä¼šè¯é‡ç”¨çš„æœºåˆ¶ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ¯æ¬¡é€šä¿¡æ—¶çš„å»¶è¿Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>tlsSocket.isSessionReused()</code>æ¥æ£€æŸ¥ä½ çš„è¿æ¥æ˜¯å¦å®é™…ä¸Šæ­£åœ¨é‡ç”¨æ—§çš„ä¼šè¯å‚æ•°ã€‚æ ¹æ®è¿™ä¸ªä¿¡æ¯ï¼Œä½ å¯ä»¥å¯¹è¿æ¥ç­–ç•¥åšå‡ºç›¸åº”çš„è°ƒæ•´ï¼Œä»¥ç¡®ä¿åº”ç”¨çš„æ€§èƒ½æœ€ä¼˜åŒ–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾tlsConnectionæ˜¯ä¸€ä¸ªå·²ç»å»ºç«‹çš„TLSè¿æ¥çš„tlsSocketå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tlsConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isSessionReused</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä¼šè¯é‡ç”¨ï¼Œè¿æ¥æ›´å¿«ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœªä½¿ç”¨ä¼šè¯é‡ç”¨ï¼Œè¿æ¥å¯èƒ½ç¨æ…¢ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>tlsSocket.isSessionReused()</code>æ–¹æ³•åœ¨ Node.js ä¸­æä¾›äº†ä¸€ç§æ£€æŸ¥ TLS è¿æ¥æ˜¯å¦é‡‡ç”¨äº†ä¼šè¯é‡ç”¨çš„ç®€ä¾¿æ–¹å¼ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œä¼˜åŒ–ä»–ä»¬çš„ç½‘ç»œåº”ç”¨æ€§èƒ½ã€‚</p><h3 id="tlssocket-localaddress" tabindex="-1"><a class="header-anchor" href="#tlssocket-localaddress"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketlocaladdress" target="_blank" rel="noopener noreferrer">tlsSocket.localAddress</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å…¶ä¸­ï¼ŒTLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼‰æ˜¯ç”¨æ¥å¢åŠ ç½‘ç»œé€šè®¯çš„å®‰å…¨æ€§çš„é‡è¦æŠ€æœ¯ã€‚åœ¨ Node.js é‡Œï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ç”¨äºæ„å»ºå®‰å…¨é€šä¿¡çš„å·¥å…·ã€‚</p><h3 id="tlssocket-localaddress-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-localaddress-1"><span>tlsSocket.localAddress</span></a></h3><p><code>tlsSocket.localAddress</code> æ˜¯ <code>tls</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤º TLS è¿æ¥çš„æœ¬åœ°ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡å™¨ç«¯ï¼‰ç»‘å®šçš„ IP åœ°å€ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„æµè§ˆå™¨ï¼‰å»ºç«‹ä¸€ä¸ªå®‰å…¨è¿æ¥æ—¶ï¼Œè¿™ä¸ªå±æ€§ä¼šå‘Šè¯‰ä½ æœåŠ¡å™¨è¿™è¾¹ç”¨æ¥è¿›è¡Œè¿™æ¬¡è¿æ¥çš„ IP åœ°å€ã€‚</p><h4 id="ä¸ºä»€ä¹ˆé‡è¦-1" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆé‡è¦-1"><span>ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</span></a></h4><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒçŸ¥é“æœ¬åœ°åœ°å€å¯ä»¥å¸®åŠ©ä½ åœ¨å¤šç½‘å¡ã€å¤š IP ç¯å¢ƒä¸‹ç†è§£æµé‡æ˜¯é€šè¿‡å“ªä¸ªç½‘ç»œæ¥å£æˆ– IP åœ°å€è¿›å‡ºçš„ã€‚è¿™å¯¹äºè°ƒè¯•ã€æ—¥å¿—è®°å½•ã€è´Ÿè½½å‡è¡¡å’Œå®‰å…¨ç­–ç•¥çš„åˆ¶å®šç­‰æ–¹é¢éƒ½éå¸¸æœ‰ç”¨ã€‚</p><h4 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­</span></a></h4><p>è€ƒè™‘åˆ°ä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œæˆ‘ä»¬å°è¯•ç”¨æœ€ç®€å•çš„ç¤ºä¾‹æ¥è¯´æ˜ï¼š</p><ol><li><strong>åŸºæœ¬çš„ TLS æœåŠ¡å™¨</strong>ï¼šå‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªåŸºäº HTTPS çš„ Web åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å®‰å…¨åœ°å¤„ç†ç”¨æˆ·ä¿¡æ¯ã€‚é¦–å…ˆï¼Œä½ ä¼šä½¿ç”¨ Node.js çš„ <code>https</code> æˆ– <code>tls</code> æ¨¡å—æ¥å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ã€‚å½“è¿™ä¸ªæœåŠ¡å™¨å¯åŠ¨å¹¶ä¸”ç”¨æˆ·çš„æµè§ˆå™¨ä¸ä¹‹å»ºç«‹è¿æ¥æ—¶ï¼Œä½¿ç”¨ <code>tlsSocket.localAddress</code> å¯ä»¥è®©ä½ äº†è§£åˆ°è¿™ä¸ªè¿æ¥åœ¨æœåŠ¡å™¨ä¸Šçš„å…·ä½“ IP åœ°å€ï¼Œå°¤å…¶æ˜¯åœ¨æ‹¥æœ‰å¤šä¸ªç½‘ç»œæ¥å£æˆ– IP åœ°å€çš„æœåŠ¡å™¨ä¸Šæ›´æ˜¯å¦‚æ­¤ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Local Address: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">localAddress</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½“ TLS æœåŠ¡å™¨å¯åŠ¨å¹¶æ¥å—è¿æ¥æ—¶ï¼Œå®ƒä¼šæ‰“å°å‡ºç”¨äºè¯¥è¿æ¥çš„æœ¬åœ° IP åœ°å€ã€‚</p><ol start="2"><li><strong>è°ƒè¯•å’Œæ—¥å¿—è®°å½•</strong>ï¼šå½“ä½ çš„æœåŠ¡å™¨é‡åˆ°æ€§èƒ½é—®é¢˜æˆ–è€…å®‰å…¨é—®é¢˜æ—¶ï¼Œäº†è§£æ•°æ®æµç»è¿‡çš„ç¡®åˆ‡è·¯å¾„éå¸¸å…³é”®ã€‚é€šè¿‡åœ¨æ—¥å¿—ä¸­è®°å½• <code>tlsSocket.localAddress</code> çš„å€¼ï¼Œä½ å¯ä»¥è½»æ¾åœ°è¿½è¸ªè¿æ¥æ˜¯é€šè¿‡å“ªä¸ªæœ¬åœ°åœ°å€å»ºç«‹çš„ï¼Œä»è€Œå¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨ã€‚</li></ol><p>ä»¥ä¸Šç®€å•ä»‹ç»äº† <code>tlsSocket.localAddress</code> çš„ç”¨é€”å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚éšç€ä½ æ·±å…¥å­¦ä¹  Node.js å’Œç½‘ç»œç¼–ç¨‹ï¼Œä½ ä¼šå‘ç°æ›´å¤æ‚å’Œé«˜çº§çš„ç”¨æ³•ï¼Œä½†åŸºæœ¬æ€è·¯ç›¸åŒï¼šäº†è§£å’Œæ§åˆ¶æ•°æ®çš„æµå‘å¯¹äºæ„å»ºå¯é ã€é«˜æ•ˆã€å®‰å…¨çš„åº”ç”¨è‡³å…³é‡è¦ã€‚</p><h3 id="tlssocket-localport" tabindex="-1"><a class="header-anchor" href="#tlssocket-localport"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketlocalport" target="_blank" rel="noopener noreferrer">tlsSocket.localPort</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„<code>tlsSocket.localPort</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰è¿æ¥ç›¸å…³çš„ä¸€ä¸ªå…·ä½“å±æ€§ã€‚è¦ç†è§£è¿™ä¸ªå±æ€§ï¼Œé¦–å…ˆéœ€è¦ç®€å•äº†è§£å‡ ä¸ªæ¦‚å¿µï¼š<strong>Node.js</strong>ã€<strong>TLS</strong>ã€ä»¥åŠ<strong>Sockets</strong>ã€‚</p><ul><li><strong>Node.js</strong> æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒä½¿å¾—å¼€å‘äººå‘˜èƒ½ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚</li><li><strong>TLS (Transport Layer Security)</strong> æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›åŠ å¯†é€šä¿¡ã€‚è¿™ä¿è¯äº†æ•°æ®ä¼ è¾“çš„éšç§å’Œå®Œæ•´æ€§ã€‚</li><li><strong>Socket</strong> æ˜¯ç½‘ç»œé€šä¿¡çš„åŸºçŸ³ï¼Œå¯ä»¥è¢«è§†ä¸ºé€šä¿¡åŒæ–¹ï¼ˆæ¯”å¦‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰ä¹‹é—´çš„ä¸€æ¡é€šé“ã€‚</li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹<code>tlsSocket.localPort</code>ã€‚</p><h3 id="tlssocket-localport-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-localport-1"><span><code>tlsSocket.localPort</code></span></a></h3><p>å½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªåŸºäº TLS çš„ socket è¿æ¥æ—¶ï¼ˆå³é€šè¿‡ TLS ä¸å¦ä¸€ä¸ªè®¡ç®—æœºå®ä½“è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼‰ï¼Œ<code>tlsSocket.localPort</code>æŒ‡çš„æ˜¯æœ¬åœ°è®¡ç®—æœºä¸Šç”¨äºè¯¥ç‰¹å®šè¿æ¥çš„ç«¯å£å·ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä½ çš„è®¡ç®—æœºä¸ºäº†ç»´æŠ¤è¿™ä¸ªåŠ å¯†è¿æ¥è€Œå¼€æ”¾çš„â€œé—¨æˆ·â€çš„æ•°å­—æ ‡è¯†ã€‚</p><h4 id="ä¸ºä»€ä¹ˆç«¯å£å·å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆç«¯å£å·å¾ˆé‡è¦"><span>ä¸ºä»€ä¹ˆç«¯å£å·å¾ˆé‡è¦ï¼Ÿ</span></a></h4><p>æƒ³è±¡ä½ çš„è®¡ç®—æœºæ˜¯ä¸€åº§å¤§æ¥¼ï¼Œè€Œç½‘ç»œæœåŠ¡ï¼ˆå¦‚ HTTPS ç½‘ç«™ã€FTP æ–‡ä»¶ä¼ è¾“ç­‰ï¼‰åˆ™æ˜¯å¤§æ¥¼é‡Œçš„æˆ¿é—´ã€‚æ¯ä¸ªæˆ¿é—´éƒ½æœ‰ä¸€ä¸ªé—¨ç‰Œå·ï¼Œè€Œç«¯å£å·å°±ç±»ä¼¼äºè¿™ä¸ªé—¨ç‰Œå·ã€‚å½“ä¿¡æ¯ä»äº’è”ç½‘å‘é€åˆ°ä½ çš„è®¡ç®—æœºæ—¶ï¼Œç«¯å£å·ä¼šå‘Šè¯‰è¯¥ä¿¡æ¯åº”è¯¥å»å“ªä¸ªâ€œæˆ¿é—´â€ï¼ˆå³å“ªä¸ªæœåŠ¡ï¼‰ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-1"><span>ä½¿ç”¨åœºæ™¯</span></a></h4><p>æƒ³è±¡ä»¥ä¸‹æƒ…å½¢ï¼š</p><ol><li><p><strong>å¼€å‘ä¸€ä¸ª HTTPS æœåŠ¡å™¨</strong>ï¼šå½“ä½ åœ¨ Node.js ä¸­å¼€å‘ä¸€ä¸ª HTTPS æœåŠ¡å™¨æ—¶ï¼Œå¯èƒ½ä¼šä½¿ç”¨ TLS æ¥åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æƒ³çŸ¥é“æœåŠ¡å™¨ç›‘å¬è¯·æ±‚çš„ç«¯å£å·ï¼Œå¯ä»¥ä½¿ç”¨<code>tlsSocket.localPort</code>æ¥è·å¾—è¿™ä¸ªä¿¡æ¯ã€‚</p></li><li><p><strong>å®¢æˆ·ç«¯è¿æ¥åˆ° HTTPS æœåŠ¡</strong>ï¼šå¦‚æœä½ ä½¿ç”¨ Node.js ç¼–å†™äº†ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºé€šè¿‡ TLS è¿æ¥åˆ°ç¬¬ä¸‰æ–¹çš„ HTTPS æœåŠ¡ï¼Œé€šè¿‡<code>tlsSocket.localPort</code>ï¼Œä½ å¯ä»¥è·å–åˆ°ä½ çš„åº”ç”¨ç¨‹åºç”¨äºå»ºç«‹è¿™ä¸ªè¿æ¥çš„æœ¬åœ°ç«¯å£å·ã€‚è¿™åœ¨è°ƒè¯•æˆ–è€…æ—¥å¿—è®°å½•æ—¶éå¸¸æœ‰ç”¨ã€‚</p></li></ol><h4 id="å®é™…ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2"><span>å®é™…ä¾‹å­</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // Assuming you have these files for TLS connection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;Client connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Local port used for this connection: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">localPort</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server ended the connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS å®¢æˆ·ç«¯ï¼Œå®ƒè¿æ¥åˆ°<code>example.com</code>çš„ 443 ç«¯å£ï¼ˆHTTPS é»˜è®¤ç«¯å£ï¼‰ã€‚é€šè¿‡é…ç½®å’Œå›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬ç¡®ä¿äº†è¿æ¥çš„å®‰å…¨ï¼Œå¹¶ä¸”ä¸€æ—¦è¿æ¥æˆåŠŸï¼Œæˆ‘ä»¬å°±æ‰“å°äº†ä½¿ç”¨çš„æœ¬åœ°ç«¯å£å·ï¼ˆå³<code>socket.localPort</code>ï¼‰ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£<code>tlsSocket.localPort</code>åŠå…¶ç”¨é€”ï¼</p><h3 id="tlssocket-remoteaddress" tabindex="-1"><a class="header-anchor" href="#tlssocket-remoteaddress"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketremoteaddress" target="_blank" rel="noopener noreferrer">tlsSocket.remoteAddress</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>tlsSocket.remoteAddress</code> åœ¨ Node.js v21.7.1 ä¸­çš„ä½¿ç”¨å’Œæ„ä¹‰ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-3" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-3"><span>ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œéœ€è¦ç†è§£ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰æ˜¯ä»€ä¹ˆã€‚ç®€å•æ¥è¯´ï¼ŒTLS æ˜¯ä¸€ç§ä¿æŠ¤ç½‘ç»œé€šä¿¡å®‰å…¨çš„åè®®ï¼Œå®ƒèƒ½ç¡®ä¿æ•°æ®åœ¨ä»æºå¤´åˆ°ç›®çš„åœ°çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«çªƒå¬æˆ–ç¯¡æ”¹ã€‚å½“ä½ é€šè¿‡ HTTPS è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨ TLS åè®®ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tlssocket-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tlssocket-1"><span>ä»€ä¹ˆæ˜¯ tlsSocketï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ç”¨äºå®ç° TLS å’Œ/æˆ– SSL åŠ å¯†çš„åŠŸèƒ½ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªåŸºäº TLS çš„è¿æ¥æ—¶ï¼ˆæ¯”å¦‚ï¼Œé€šè¿‡<code>tls.connect</code>ï¼‰ï¼Œè¿”å›çš„å¯¹è±¡æ˜¯ä¸€ä¸ª <code>tls.TLSSocket</code>ã€‚è¿™ä¸ª <code>TLSSocket</code> å¯¹è±¡ä»£è¡¨é‚£ä¸ªåŠ å¯†çš„è¿æ¥ã€‚</p><h3 id="tlssocket-remoteaddress-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-remoteaddress-1"><span>tlsSocket.remoteAddress</span></a></h3><p><code>tlsSocket.remoteAddress</code> æ˜¯ <code>TLSSocket</code> å®ä¾‹çš„ä¸€ä¸ªå±æ€§ã€‚å®ƒå­˜å‚¨äº†è¿œç«¯æœåŠ¡å™¨ï¼ˆä¹Ÿå°±æ˜¯ä½ è¿æ¥åˆ°çš„æœåŠ¡å™¨ï¼‰çš„ IP åœ°å€ã€‚åœ¨è¿›è¡Œ TLS è¿æ¥æ—¶ï¼Œäº†è§£è¿œç«¯æœåŠ¡å™¨çš„ IP åœ°å€å¯¹äºæŸäº›åœºæ™¯éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€å®¡è®¡æˆ–è€…é™åˆ¶è¿æ¥ç­‰ã€‚</p><h3 id="æ€æ ·ä½¿ç”¨-tlssocket-remoteaddress" tabindex="-1"><a class="header-anchor" href="#æ€æ ·ä½¿ç”¨-tlssocket-remoteaddress"><span>æ€æ ·ä½¿ç”¨ tlsSocket.remoteAddressï¼Ÿ</span></a></h3><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªåˆ°æŸä¸ªæœåŠ¡å™¨çš„ TLS è¿æ¥ï¼Œæƒ³è¦è·å–å¹¶æ‰“å°å‡ºé‚£ä¸ªæœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ æœ‰è¿™äº›å®¢æˆ·ç«¯è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™äº›æ˜¯è¯ä¹¦çš„è·¯å¾„ï¼ˆæ ¹æ®ä½ çš„è®¾ç½®å¯èƒ½ä¸åŒï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºåˆ°æœåŠ¡å™¨çš„TLSè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿æ¥å·²å»ºç«‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“è¿æ¥å»ºç«‹åï¼Œè·å–å¹¶æ‰“å°è¿œç«¯æœåŠ¡å™¨çš„IPåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿œç«¯æœåŠ¡å™¨çš„IPåœ°å€:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remoteAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-1"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ul><li><strong>æ—¥å¿—è®°å½•</strong>ï¼šä½ å¯èƒ½æƒ³è¦è®°å½•æ¯ä¸€ä¸ªå»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä»¥ä¾¿äºè°ƒè¯•ã€ç›‘æ§æˆ–å®‰å…¨åˆ†æã€‚</li><li><strong>å®‰å…¨å®¡è®¡</strong>ï¼šé€šè¿‡è®°å½•è¿œç«¯ IPï¼Œä½ å¯ä»¥å¯¹è®¿é—®æ¨¡å¼è¿›è¡Œåˆ†æï¼Œè¯†åˆ«å¯ç–‘è¡Œä¸ºã€‚</li><li><strong>åŸºäºåœ°ç†ä½ç½®çš„æœåŠ¡</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨æä¾›ç‰¹å®šäºåœ°ç†ä½ç½®çš„å†…å®¹ï¼ŒçŸ¥é“è¯·æ±‚è€…çš„ IP åœ°å€å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­ä»–ä»¬å¯èƒ½ä½äºå“ªä¸ªå›½å®¶æˆ–åœ°åŒºã€‚</li></ul><p>æ€»ç»“èµ·æ¥ï¼Œ<code>tlsSocket.remoteAddress</code> æ˜¯ TLS è¿æ¥ä¸­ç”¨äºè·å–è¿œç«¯ IP åœ°å€çš„ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å±æ€§ï¼Œå®ƒå¯ä»¥æ”¯æŒå„ç§ç½‘ç»œå®‰å…¨å’Œç®¡ç†ä»»åŠ¡ã€‚</p><h3 id="tlssocket-remotefamily" tabindex="-1"><a class="header-anchor" href="#tlssocket-remotefamily"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketremotefamily" target="_blank" rel="noopener noreferrer">tlsSocket.remoteFamily</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tlsSocket.remoteFamily</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥è¡¨ç¤ºé€šè¿‡ TLS (ä¼ è¾“å±‚å®‰å…¨æ€§åè®®) è¿æ¥çš„è¿œç¨‹å®¢æˆ·ç«¯çš„ IP åœ°å€ç±»å‹ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å»ºç«‹äº†ä¸€ä¸ªåŠ å¯†çš„è¿æ¥åï¼Œè¿™ä¸ªå±æ€§å¸®åŠ©ä½ è¯†åˆ«è¿æ¥åˆ°ä½ æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯ IPv4 åœ°å€è¿˜æ˜¯ IPv6 åœ°å€ã€‚</p><p>IP åœ°å€æœ‰ä¸¤ç§ç‰ˆæœ¬ï¼š</p><ul><li><strong>IPv4</strong>: è¿™æ˜¯ç›®å‰æœ€å¹¿æ³›ä½¿ç”¨çš„äº’è”ç½‘åè®®ç‰ˆæœ¬ã€‚å®ƒåŸºäº 32 ä½åœ°å€ç³»ç»Ÿï¼Œä¾‹å¦‚ <code>192.168.1.1</code>ã€‚</li><li><strong>IPv6</strong>: éšç€äº’è”ç½‘è®¾å¤‡æ•°é‡çš„å¢åŠ ï¼ŒIPv4 åœ°å€é€æ¸è€—å°½ã€‚IPv6 ä½œä¸ºä¸‹ä¸€ä»£äº’è”ç½‘åè®®ï¼Œæä¾›äº†æ›´å¤šçš„åœ°å€ç©ºé—´ï¼ŒåŸºäº 128 ä½åœ°å€ç³»ç»Ÿï¼Œä¾‹å¦‚ <code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code>ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-2" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-2"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªéœ€è¦é«˜å®‰å…¨æ€§çš„åº”ç”¨ï¼Œå¦‚åœ¨çº¿é“¶è¡Œæˆ–ç”µå­å•†åŠ¡å¹³å°ï¼Œå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ç½‘é¡µæµè§ˆå™¨ï¼‰ä¼šé€šè¿‡ HTTPSï¼ˆå³ HTTP + TLS/SSLï¼‰ä¸ä½ çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº†è§£å®¢æˆ·ç«¯çš„ IP ç±»å‹å¯èƒ½å¯¹äºæ—¥å¿—è®°å½•ã€å®¡è®¡ã€æˆ–ç‰¹æ®Šçš„ç½‘ç»œé…ç½®å¾ˆé‡è¦ã€‚</p><h3 id="å®é™…ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-3"><span>å®é™…ä¾‹å­</span></a></h3><h4 id="_1-æ—¥å¿—è®°å½•" tabindex="-1"><a class="header-anchor" href="#_1-æ—¥å¿—è®°å½•"><span>1. æ—¥å¿—è®°å½•</span></a></h4><p>ä½ å¯èƒ½æƒ³è¦è¯¦ç»†è®°å½•è®¿é—®ä½ çš„æœåŠ¡çš„æ¯ä¸ªè¯·æ±‚ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯çš„ IP åœ°å€ç±»å‹ã€‚è¿™æ ·ï¼Œåœ¨åˆ†æè®¿é—®æ¨¡å¼æˆ–è°ƒæŸ¥å®‰å…¨äº‹ä»¶æ—¶ï¼Œä½ å¯ä»¥å¿«é€Ÿå¯¹ä¿¡æ¯è¿›è¡Œè¿‡æ»¤å’ŒæŸ¥æ‰¾ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å®¢æˆ·ç«¯IPç±»å‹: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remoteFamily</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨å¯åŠ¨åœ¨8000ç«¯å£&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬éƒ½ä¼šæ‰“å°å‡ºè¯¥å®¢æˆ·ç«¯ä½¿ç”¨çš„ IP åœ°å€ç±»å‹ï¼ˆIPv4 æˆ– IPv6ï¼‰ã€‚</p><h4 id="_2-ç‰¹å®šåŠŸèƒ½å¼€å…³" tabindex="-1"><a class="header-anchor" href="#_2-ç‰¹å®šåŠŸèƒ½å¼€å…³"><span>2. ç‰¹å®šåŠŸèƒ½å¼€å…³</span></a></h4><p>å¯èƒ½ä½ çš„åº”ç”¨éœ€è¦æ ¹æ®ç”¨æˆ·çš„ IP åœ°å€ç±»å‹å¯ç”¨æˆ–ç¦ç”¨æŸäº›åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œç”±äºæŸäº›åŸå› ï¼ŒæŸé¡¹åŠŸèƒ½åœ¨ IPv6 ç¯å¢ƒä¸‹è¿è¡Œä¸ç¨³å®šï¼Œä½ å¯èƒ½æš‚æ—¶åªæƒ³å¯¹ä½¿ç”¨ IPv4 åœ°å€çš„ç”¨æˆ·å¼€æ”¾è¯¥åŠŸèƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secureConnect&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remoteFamily</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;IPv4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    enableSomeFeatureForThisUser</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥è¿æ¥çš„è¿œç¨‹å®¢æˆ·ç«¯æ˜¯å¦ä½¿ç”¨ IPv4 åœ°å€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸ºè¯¥ç”¨æˆ·å¯ç”¨æŸé¡¹ç‰¹å®šåŠŸèƒ½ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>tlsSocket.remoteFamily</code> å±æ€§åœ¨ Node.js ä¸­ç”¨äºè·å– TLS è¿æ¥ä¸­è¿œç¨‹å®¢æˆ·ç«¯çš„ IP åœ°å€ç±»å‹ã€‚è¿™å¯¹äºæ¶‰åŠç½‘ç»œé€šä¿¡å’Œå®‰å…¨æ€§è¦æ±‚é«˜çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€ç±»å‹æ‰§è¡Œç‰¹å®šçš„é€»è¾‘å¤„ç†ã€‚</p><h3 id="tlssocket-remoteport" tabindex="-1"><a class="header-anchor" href="#tlssocket-remoteport"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketremoteport" target="_blank" rel="noopener noreferrer">tlsSocket.remotePort</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>tlsSocket.remotePort</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š<strong>Node.js</strong>ã€<strong>TLS</strong>ã€<strong>Socket</strong> ä»¥åŠ<strong>ç«¯å£</strong>ã€‚</p><ol><li><strong>Node.js</strong>: è¿™æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å®ƒéå¸¸é€‚åˆæ„å»ºå¿«é€Ÿçš„ã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ã€‚</li><li><strong>TLS</strong>: å…¨ç§°ä¸ºä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTransport Layer Securityï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œæ—¨åœ¨ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨å’Œæ•°æ®å®Œæ•´æ€§ä¿æŠ¤ã€‚</li><li><strong>Socket</strong>: åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œsocket æ˜¯ç½‘ç»œé€šä¿¡çš„æœ«ç«¯ç‚¹ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä¸¤å°è®¡ç®—æœºé€šè¿‡ç½‘ç»œè¿›è¡Œæ•°æ®äº¤æ¢æ—¶ï¼Œå‘èµ·è¿æ¥çš„ä¸€æ–¹å’Œæ¥æ”¶è¿æ¥çš„ä¸€æ–¹éƒ½ä¼šåˆ›å»ºä¸€ä¸ª socket æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</li><li><strong>ç«¯å£ï¼ˆPortï¼‰</strong>: ç«¯å£æ˜¯è®¡ç®—æœºç½‘ç»œä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æœåŠ¡æˆ–è¿›ç¨‹ã€‚æ¯ä¸ªä½¿ç”¨ç½‘ç»œçš„åº”ç”¨ç¨‹åºé€šå¸¸ä¼šè¢«åˆ†é…ä¸€ä¸ªç«¯å£å·ï¼Œä»¥ç¡®ä¿æ•°æ®å‡†ç¡®åœ°é€è¾¾ç›®æ ‡åº”ç”¨ã€‚</li></ol><p>ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥äº†è§£ <code>tlsSocket.remotePort</code>ï¼š</p><ul><li><strong>tlsSocket</strong>: åœ¨ä½¿ç”¨ TLS åè®®è¿›è¡Œå®‰å…¨é€šä¿¡æ—¶ï¼Œ<code>tlsSocket</code> ä»£è¡¨çš„æ˜¯ä¸€ä¸ªé€šè¿‡ TLS å°è£…çš„ Socket è¿æ¥ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªé€šè¿‡åŠ å¯†ä¿æŠ¤çš„é€šé“ï¼Œç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚</li><li><strong>remotePort</strong>: è¿™ä¸ªå±æ€§è¡¨ç¤ºä¸è¯¥ <code>tlsSocket</code> è¿æ¥çš„è¿œç«¯ï¼ˆå³å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯¹é¢çš„å®ä½“ï¼‰æ‰€ä½¿ç”¨çš„ç«¯å£å·ã€‚æ¯å½“ä¸€ä¸ªæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ª TLS åŠ å¯†çš„è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡ <code>tlsSocket.remotePort</code> æ¥çŸ¥é“å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-9"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®‰å…¨çš„ç½‘é“¶ç³»ç»Ÿï¼Œç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®ä½ çš„æœåŠ¡å™¨è¿›è¡Œé‡‘èäº¤æ˜“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š</p><ul><li>ç”¨æˆ·çš„æµè§ˆå™¨ä½œä¸ºå®¢æˆ·ç«¯ï¼Œé€šè¿‡äº’è”ç½‘å‘ä½ çš„æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª TLS åŠ å¯†çš„è¿æ¥è¯·æ±‚ã€‚</li><li>æœåŠ¡å™¨æ¥å—è¿™ä¸ªè¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª <code>tlsSocket</code> å¯¹è±¡æ¥å¤„ç†è¿™ä¸ªè¿æ¥ã€‚</li><li>æ­¤æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥è®¿é—® <code>tlsSocket.remotePort</code> å±æ€§ï¼Œæ¥è·å–ç”¨æˆ·æµè§ˆå™¨ç«¯ä½¿ç”¨çš„ç«¯å£å·ã€‚è™½ç„¶è¿™ä¸ªä¿¡æ¯å¯èƒ½åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ç”¨å¤„ä¸å¤§ï¼Œä½†åœ¨ç‰¹å®šçš„æ—¥å¿—è®°å½•ã€ç›‘è§†æˆ–å®‰å…¨åˆ†æåœºæ™¯ä¸­ï¼ŒçŸ¥é“è¿œç«¯çš„ç«¯å£å·å¯èƒ½ä¼šæœ‰åŠ©äºè¯Šæ–­é—®é¢˜æˆ–å®¡è®¡ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ æœ‰ä¸€ä¸ªåŸºäº Node.js çš„æœåŠ¡å™¨ï¼Œä½¿ç”¨ TLS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å®¢æˆ·ç«¯è¿æ¥çš„è¿œç«¯ç«¯å£æ˜¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remotePort</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®æˆ–è€…å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨è¿è¡Œåœ¨ 8443 ç«¯å£...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„ TLS æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 8443 ç«¯å£ï¼Œå¹¶æ‰“å°å‡ºä»»ä½•å®¢æˆ·ç«¯è¿æ¥çš„è¿œç«¯ç«¯å£å·ã€‚è¿™æ ·çš„ä¿¡æ¯å¯èƒ½å¯¹äºæ—¥å¿—è®°å½•æˆ–æŸäº›ç‰¹å®šçš„ç½‘ç»œç®¡ç†ä»»åŠ¡æ˜¯æœ‰ç”¨çš„ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>tlsSocket.remotePort</code> æä¾›äº†ä¸€ç§æ–¹å¼æ¥æŸ¥çœ‹é€šè¿‡ TLS åŠ å¯†è¿æ¥çš„è¿œç«¯å®ä½“æ‰€ä½¿ç”¨çš„ç«¯å£å·ï¼Œè¿™åœ¨ç†è§£ç½‘ç»œé€šä¿¡ç»†èŠ‚åŠè°ƒè¯•ç½‘ç»œåº”ç”¨æ—¶å¯èƒ½æ˜¯å¾ˆé‡è¦çš„ä¿¡æ¯ã€‚</p><h3 id="tlssocket-renegotiate-options-callback" tabindex="-1"><a class="header-anchor" href="#tlssocket-renegotiate-options-callback"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketrenegotiateoptions-callback" target="_blank" rel="noopener noreferrer">tlsSocket.renegotiate(options, callback)</a></span></a></h3><p>è¦ç†è§£<code>tlsSocket.renegotiate(options, callback)</code>è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼šTLSã€å¥—æ¥å­—ï¼ˆSocketï¼‰ã€ä»¥åŠä¸ºä½•éœ€è¦é‡æ–°åå•†ï¼ˆRenegotiationï¼‰ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-2"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><p><strong>TLS (ä¼ è¾“å±‚å®‰å…¨æ€§)</strong>: è¿™æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨äºåœ¨ç½‘ç»œä¸­çš„ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´æä¾›å®‰å…¨é€šä¿¡ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ï¼Œå°±æ˜¯ä½¿ç”¨äº† TLS æ¥åŠ å¯†ä½ ä¸ç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚</p></li><li><p><strong>å¥—æ¥å­—ï¼ˆSocketï¼‰</strong>: åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå¥—æ¥å­—æ˜¯ä¸€ä¸ªç«¯ç‚¹ï¼Œç”¨äºé€šè¿‡ç½‘ç»œä¸å…¶ä»–ç«¯ç‚¹è¿›è¡Œé€šä¿¡ã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºé€šä¿¡çš„é€šé“ã€‚</p></li><li><p><strong>é‡æ–°åå•†ï¼ˆRenegotiationï¼‰</strong>: åœ¨ TLS è¿æ¥å·²ç»å»ºç«‹ä¹‹åï¼Œå¦‚æœåŒæ–¹éœ€è¦æ”¹å˜ä¸€äº›åˆå§‹åå•†çš„å‚æ•°ï¼Œæˆ–è€…éœ€è¦æ›´æ–°åŠ å¯†å¯†é’¥ï¼Œå°±ä¼šè¿›è¡Œé‡æ–°åå•†ã€‚è¿™æ˜¯ TLS åè®®æ”¯æŒçš„ç‰¹æ€§ï¼Œå…è®¸è¿æ¥åŒæ–¹åœ¨ä¿æŒè¿æ¥æ´»è·ƒçš„æƒ…å†µä¸‹æ›´æ–°å…¶åŠ å¯†å‚æ•°ã€‚</p></li></ol><h3 id="tlssocket-renegotiate-options-callback-1" tabindex="-1"><a class="header-anchor" href="#tlssocket-renegotiate-options-callback-1"><span>tlsSocket.renegotiate(options, callback)</span></a></h3><p>Node.js ä¸­çš„<code>tlsSocket.renegotiate()</code>æ–¹æ³•å…è®¸å·²ç»å»ºç«‹çš„ TLS å¥—æ¥å­—ï¼ˆå³å·²ç»é€šè¿‡ TLS åè®®åŠ å¯†çš„è¿æ¥ï¼‰å‘èµ·ä¸€ä¸ªé‡æ–°åå•†è¿‡ç¨‹ã€‚ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥æ”¹å˜è¿æ¥çš„ TLS å‚æ•°ï¼Œæˆ–è€…æ›´æ–°åŠ å¯†ä¿¡æ¯ã€‚</p><ul><li><code>options</code>: ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«é‡æ–°åå•†è¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦è®¾ç½®çš„é€‰é¡¹ã€‚</li><li><code>callback</code>: ä¸€ä¸ªå‡½æ•°ï¼Œå½“é‡æ–°åå•†è¿‡ç¨‹å®Œæˆæˆ–å‘ç”Ÿé”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-7"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ›´æ¢åŠ å¯†å¯†é’¥</strong>:<br> æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªè¿è¡Œ 24/7 çš„åŠ å¯†é€šä¿¡æœåŠ¡ï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿èŠå¤©åº”ç”¨ã€‚ä¸ºäº†ä¿è¯é€šä¿¡çš„å®‰å…¨æ€§ï¼Œä½ å¸Œæœ›å®šæœŸæ›´æ¢åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ã€‚ä½ å¯ä»¥å®šæœŸè°ƒç”¨<code>tlsSocket.renegotiate()</code>ï¼Œä¸ä¸­æ–­ç°æœ‰è¿æ¥çš„æƒ…å†µä¸‹æ›´æ–°å¯†é’¥ã€‚</p></li><li><p><strong>å‡çº§åŠ å¯†åè®®</strong>:<br> å¦‚æœ TLS åè®®å‘å¸ƒäº†æ–°ç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¼ºçš„å®‰å…¨æ€§ï¼Œè€Œä½ çš„åº”ç”¨æ­£åœ¨è¿è¡Œæ—§ç‰ˆæœ¬ï¼Œä½ å¯èƒ½æƒ³åœ¨ä¸æ–­å¼€å®¢æˆ·ç«¯è¿æ¥çš„æƒ…å†µä¸‹å‡çº§åˆ°æ–°ç‰ˆæœ¬ã€‚é€šè¿‡<code>tlsSocket.renegotiate()</code>ï¼Œå¯ä»¥å®ç°è¿™ä¸€ç‚¹ã€‚</p></li><li><p><strong>åŠ¨æ€è¯·æ±‚å®¢æˆ·ç«¯è¯ä¹¦</strong>:<br> å¯¹äºæŸäº›ç‰¹å®šæ“ä½œï¼ŒæœåŠ¡å™¨å¯èƒ½éœ€è¦éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚å¦‚æœæœ€åˆçš„ TLS æ¡æ‰‹æ²¡æœ‰è¯·æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä½†åæ¥çš„æŸä¸ªæ—¶åˆ»éœ€è¦å®¢æˆ·ç«¯è¯ä¹¦æ¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>tlsSocket.renegotiate()</code>ï¼Œæ·»åŠ è¯·æ±‚å®¢æˆ·ç«¯è¯ä¹¦çš„éœ€æ±‚ã€‚</p></li></ol><h3 id="ä½¿ç”¨æ³¨æ„" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ³¨æ„"><span>ä½¿ç”¨æ³¨æ„</span></a></h3><p>å°½ç®¡é‡æ–°åå•†æ˜¯ TLS åè®®æ”¯æŒçš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ï¼Œä½†å®ƒä¹Ÿå¯èƒ½å¯¹ç³»ç»Ÿæ€§èƒ½äº§ç”Ÿå½±å“ï¼Œå¹¶ä¸”å¦‚æœä¸å½“ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨è¿™ä¸€åŠŸèƒ½ï¼Œå¹¶ç¡®ä¿ç¬¦åˆæœ€ä½³å®‰å…¨å®è·µã€‚</p><p>ä»¥ä¸Šå°±æ˜¯å…³äº<code>tlsSocket.renegotiate(options, callback)</code>çš„è§£é‡Šï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªåŠŸèƒ½åŠå…¶åœ¨å®é™…ä¸­çš„åº”ç”¨ã€‚</p><h3 id="tlssocket-setmaxsendfragment-size" tabindex="-1"><a class="header-anchor" href="#tlssocket-setmaxsendfragment-size"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlssocketsetmaxsendfragmentsize" target="_blank" rel="noopener noreferrer">tlsSocket.setMaxSendFragment(size)</a></span></a></h3><p>å½“æˆ‘ä»¬åœ¨è°ˆè®º Node.js ä¸­çš„ <code>tlsSocket.setMaxSendFragment(size)</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºå¦‚ä½•æ§åˆ¶é€šè¿‡ TLS (ä¼ è¾“å±‚å®‰å…¨åè®®) è¿æ¥å‘é€çš„æ•°æ®å—çš„å¤§å°ã€‚è¿™ä¸ªåŠŸèƒ½å¯¹äºä¼˜åŒ–ç½‘ç»œæ€§èƒ½å’Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡éå¸¸é‡è¦ã€‚</p><h3 id="ç†è§£-tls-å’Œ-tls-socket" tabindex="-1"><a class="header-anchor" href="#ç†è§£-tls-å’Œ-tls-socket"><span>ç†è§£ TLS å’Œ TLS Socket</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥ç®€å•äº†è§£ä¸€ä¸‹ TLSã€‚TLSï¼Œå³ä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œæ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨äºåœ¨ç½‘ç»œä¸­å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚å®ƒåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šé“ï¼Œä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªåŸºäº TLS çš„ç½‘ç»œè¿æ¥ï¼ˆç§°ä¸º TLS socketï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ¨¡å—åˆ›å»ºå®‰å…¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œä»¥ä¾¿å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚</p><h3 id="å…³äº-tlssocket-setmaxsendfragment-size" tabindex="-1"><a class="header-anchor" href="#å…³äº-tlssocket-setmaxsendfragment-size"><span>å…³äº <code>tlsSocket.setMaxSendFragment(size)</code></span></a></h3><p><code>tlsSocket.setMaxSendFragment(size)</code> æ˜¯ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•ï¼Œç”¨äºè®¾ç½®é€šè¿‡ TLS socket å‘é€çš„æ¯ä¸ªæ•°æ®å—çš„æœ€å¤§å¤§å°ã€‚è¿™ä¸ªå¤§å°ç”±å‚æ•° <code>size</code> æŒ‡å®šï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº 512 å’Œ 16384 å­—èŠ‚ï¼ˆåŒ…æ‹¬ä¸¤è€…ï¼‰ä¹‹é—´çš„æ•´æ•°ï¼Œè¿™æ˜¯å› ä¸º TLS æ ‡å‡†è§„å®šäº†åŠ å¯†æ•°æ®å—çš„å¤§å°èŒƒå›´ã€‚</p><p>è®¾ç½®è¿™ä¸ªå€¼çš„ç›®çš„ä¸»è¦æ˜¯æ§åˆ¶æ•°æ®åŒ…çš„å¤§å°ï¼Œä»è€Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½ã€‚è¾ƒå°çš„æ•°æ®å—å¯èƒ½å‡å°‘å»¶è¿Ÿï¼Œé€‚åˆå®æ—¶é€šä¿¡ï¼Œè€Œè¾ƒå¤§çš„æ•°æ®å—å¯èƒ½æé«˜ååé‡ï¼Œé€‚åˆä¼ è¾“å¤§é‡æ•°æ®ã€‚</p><h3 id="å®é™…ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…ä½¿ç”¨ç¤ºä¾‹"><span>å®é™…ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåŸºäº Node.js çš„ HTTPS æœåŠ¡ï¼Œæ­¤æœåŠ¡éœ€è¦é¢‘ç¹åœ°å‘å®¢æˆ·ç«¯å‘é€å°é‡çš„å®æ—¶æ•°æ®ã€‚ä¸ºäº†é™ä½ç½‘ç»œå»¶è¿Ÿï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©è®¾ç½®è¾ƒå°çš„ TLS å‘é€ç‰‡æ®µå¤§å°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ å·²ç»æœ‰äº†å¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½®æœ€å¤§å‘é€ç‰‡æ®µä¸º 1024 å­—èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setMaxSendFragment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ•°æ®æˆ–è€…å…¶ä»–é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¥æ”¶åˆ°çš„æ•°æ®:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¯ä»¥åœ¨è¿™é‡Œå›å¤å®¢æˆ·ç«¯ç­‰æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨è¿è¡Œåœ¨ 8000 ç«¯å£&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡è°ƒç”¨ <code>setMaxSendFragment(1024)</code> å°†å‘é€æ•°æ®å—çš„å¤§å°é™åˆ¶ä¸º 1024 å­—èŠ‚ã€‚è¿™æ ·åšæœ‰åŠ©äºå‡å°‘åœ¨å‘é€å®æ—¶æ•°æ®æ—¶çš„ç½‘ç»œå»¶è¿Ÿã€‚</p><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä½¿ç”¨ <code>tlsSocket.setMaxSendFragment(size)</code> æ–¹æ³•ï¼Œä½ å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€è¦è°ƒæ•´ TLS æ•°æ®ä¼ è¾“çš„ç»†èŠ‚ã€‚æ— è®ºæ˜¯æé«˜å®æ—¶æ€§èƒ½è¿˜æ˜¯ä¼˜åŒ–å¤§æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼Œåˆç†è®¾ç½®å‘é€ç‰‡æ®µçš„å¤§å°éƒ½æ˜¯æå‡ç½‘ç»œé€šä¿¡è´¨é‡çš„æœ‰æ•ˆæ‰‹æ®µã€‚</p><h2 id="tls-checkserveridentity-hostname-cert" tabindex="-1"><a class="header-anchor" href="#tls-checkserveridentity-hostname-cert"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlscheckserveridentityhostname-cert" target="_blank" rel="noopener noreferrer">tls.checkServerIdentity(hostname, cert)</a></span></a></h2><p>å½“æˆ‘ä»¬åœ¨ Node.js ä¸­ä½¿ç”¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰æˆ– SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰æ—¶ï¼Œæ¯”å¦‚è®¿é—®ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™ï¼Œå°±ä¼šæ¶‰åŠåˆ°è¯ä¹¦çš„éªŒè¯ã€‚è¯ä¹¦æ˜¯äº’è”ç½‘å®‰å…¨é€šä¿¡çš„åŸºçŸ³ï¼Œå®ƒç¡®è®¤äº†ä½ æ­£åœ¨ä¸çœŸæ­£çš„æœåŠ¡å™¨é€šä¿¡ï¼Œè€Œä¸æ˜¯æŸä¸ªå†’å……è€…ã€‚è¿™å°±æ˜¯<code>tls.checkServerIdentity(hostname, cert)</code>å‡½æ•°å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><h3 id="tls-checkserveridentity-hostname-cert-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#tls-checkserveridentity-hostname-cert-ç®€ä»‹"><span><code>tls.checkServerIdentity(hostname, cert)</code> ç®€ä»‹</span></a></h3><p>è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä»»åŠ¡æ˜¯éªŒè¯ç»™å®šçš„ä¸»æœºåæ˜¯å¦å’Œè¯ä¹¦ä¸­çš„ä¿¡æ¯åŒ¹é…ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ å°è¯•é€šè¿‡ HTTPS è¿æ¥åˆ°ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œè¯¥ç½‘ç«™ä¼šå‘é€å…¶ SSL/TLS è¯ä¹¦ç»™ä½ çš„æµè§ˆå™¨æˆ–å®¢æˆ·ç«¯ã€‚è¿™ä¸ªè¯ä¹¦åŒ…å«äº†å¾ˆå¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯ä¹¦è¢«é¢å‘ç»™çš„ä¸»æœºåï¼ˆæˆ–åŸŸåï¼‰ã€‚<code>tls.checkServerIdentity()</code>å‡½æ•°å°±æ˜¯ç”¨æ¥æ£€æŸ¥è¿™ä¸ªä¸»æœºåæ˜¯å¦å’Œä½ å°è¯•è¿æ¥çš„ç›®æ ‡åŒ¹é…ã€‚</p><ul><li><strong>hostname</strong>ï¼šè¿™ä¸ªå‚æ•°æ˜¯ä½ æƒ³è¦è¿æ¥åˆ°çš„æœåŠ¡å™¨çš„åç§°ã€‚</li><li><strong>cert</strong>ï¼šè¿™ä¸ªå‚æ•°æ˜¯æœåŠ¡å™¨æä¾›çš„è¯ä¹¦å¯¹è±¡ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆé‡è¦-2" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆé‡è¦-2"><span>ä¸ºä»€ä¹ˆé‡è¦</span></a></h3><p>å¦‚æœå­˜åœ¨ä¸åŒ¹é…ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå®‰å…¨é£é™©ï¼Œæ„å‘³ç€æœ‰äººå¯èƒ½è¯•å›¾è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œä¼ªé€ æœåŠ¡å™¨çš„èº«ä»½ã€‚å› æ­¤ï¼ŒéªŒè¯è¯ä¹¦çš„åˆæ³•æ€§å¯¹äºä¿éšœæ•°æ®çš„å®‰å…¨ä¼ è¾“è‡³å…³é‡è¦ã€‚</p><h3 id="å®é™…ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-4"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªéœ€è¦ä»ç¬¬ä¸‰æ–¹ API è·å–æ•°æ®çš„ Node.js åº”ç”¨ç¨‹åºã€‚è¿™ä¸ª API é€šè¿‡ HTTPS æä¾›æœåŠ¡ï¼Œä½äº<code>https://api.example.com</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hostname</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;api.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ•°æ®å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®secureConnectäº‹ä»¶çš„ç›‘å¬å™¨ä»¥è·å–è¯ä¹¦ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secureConnect&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getPeerCertificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ£€æŸ¥è¯ä¹¦ä¸»æœºåæ˜¯å¦æœ‰æ•ˆ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">checkServerIdentity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯ä¹¦æœ‰æ•ˆï¼Œä¸»æœºååŒ¹é…ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯ä¹¦æ— æ•ˆï¼š&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTPS è¯·æ±‚åˆ°<code>https://api.example.com/data</code>ã€‚æˆ‘ä»¬é€šè¿‡ç›‘å¬<code>secureConnect</code>äº‹ä»¶æ¥è·å–æœåŠ¡å™¨çš„è¯ä¹¦ä¿¡æ¯ï¼Œå¹¶ä¸”ä½¿ç”¨<code>tls.checkServerIdentity()</code>å‡½æ•°æ¥éªŒè¯è¯ä¹¦ä¸­çš„ä¸»æœºåæ˜¯å¦å’Œæˆ‘ä»¬å°è¯•è¿æ¥çš„ä¸»æœºå<code>api.example.com</code>åŒ¹é…ã€‚</p><p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ§åˆ¶å°å°†è¾“å‡ºâ€œè¯ä¹¦æœ‰æ•ˆï¼Œä¸»æœºååŒ¹é…ï¼â€ï¼›å¦‚æœä¸åŒ¹é…ï¼Œå°†æ•è·åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶æ‰“å°å‡ºâ€œè¯ä¹¦æ— æ•ˆâ€åŠå…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ ·ä½ å°±çŸ¥é“é€šä¿¡å¯èƒ½ä¸å®‰å…¨ï¼Œå¯ä»¥é‡‡å–ç›¸åº”çš„æªæ–½ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯<code>tls.checkServerIdentity(hostname, cert)</code>å‡½æ•°çš„ä¸€ä¸ªå®é™…è¿ç”¨ç¤ºä¾‹ã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å®ƒçš„ç”¨é€”å’Œé‡è¦æ€§ã€‚</p><h2 id="tls-connect-options-callback" tabindex="-1"><a class="header-anchor" href="#tls-connect-options-callback"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsconnectoptions-callback" target="_blank" rel="noopener noreferrer">tls.connect(options[, callback])</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æµè§ˆå™¨ä¸­ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥åˆ›å»ºç½‘ç«™åç«¯ã€API æˆ–è€…ä»»ä½•æœåŠ¡å™¨ç«¯çš„è½¯ä»¶ã€‚è€Œ<code>tls.connect(options[, callback])</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå»ºç«‹ä¸€ä¸ªå®‰å…¨çš„è¿æ¥ï¼Œå³ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰æˆ– SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰è¿æ¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå¸®åŠ©ä½ çš„åº”ç”¨å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚</p><h3 id="å‚æ•°è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>options</code>ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«è¿æ¥çš„è¯¦ç»†ä¿¡æ¯å’Œé…ç½®ã€‚</li><li><code>callback</code>ï¼šä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œè¿æ¥å»ºç«‹åä¼šè¢«è°ƒç”¨ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-3" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-3"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦å®‰å…¨åœ°ä»å¦ä¸€å°æœåŠ¡å™¨ä¸Šè·å–æ•æ„Ÿæ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯æˆ–æ”¯ä»˜ä¿¡æ¯ã€‚ä¸ºäº†ä¿è¯æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>tls.connect</code>æ¥å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ã€‚</p><h3 id="å®é™…ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-5"><span>å®é™…ä¾‹å­</span></a></h3><h4 id="è¿æ¥åˆ°ä¸€ä¸ª-tls-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#è¿æ¥åˆ°ä¸€ä¸ª-tls-æœåŠ¡å™¨"><span>è¿æ¥åˆ°ä¸€ä¸ª TLS æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ è¦è¿æ¥åˆ°ä¸€ä¸ªæä¾›å¤©æ°”ä¿¡æ¯çš„æœåŠ¡ï¼Œå¹¶ä¸”è¯¥æœåŠ¡è¦æ±‚ä½¿ç”¨ TLS è¿æ¥ä»¥ç¡®ä¿æ•°æ®ä¼ è¾“å®‰å…¨ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨<code>tls.connect</code>å®ç°çš„ç¤ºä¾‹ä»£ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// TLS/SSLè¿æ¥é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;weather.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨çš„åŸŸå</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®‰å…¨ç«¯å£ï¼ŒHTTPSé»˜è®¤ä¸º443</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯ç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ca-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)], </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// CAè¯ä¹¦ï¼Œç”¨äºéªŒè¯æœåŠ¡å™¨è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»ºç«‹TLSè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;å®¢æˆ·ç«¯å·²è¿æ¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æˆæƒæˆåŠŸ&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æˆæƒå¤±è´¥ï¼š&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorizationError</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GET /data HTTP/1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\r\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Host: weather.example.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\r\n\r\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œå…³é—­è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯è¿æ¥ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>æˆ‘ä»¬é¦–å…ˆåŠ è½½<code>tls</code>æ¨¡å—æ¥ä½¿ç”¨ TLS åè®®çš„ç›¸å…³åŠŸèƒ½ã€‚</li><li>ä½¿ç”¨<code>fs</code>æ¨¡å—è¯»å–å¿…è¦çš„å¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶ã€‚è¿™äº›é€šå¸¸æ˜¯ç”± CAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ç­¾å‘çš„ï¼Œç”¨äºè®¤è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„èº«ä»½ã€‚</li><li>è°ƒç”¨<code>tls.connect</code>å¹¶ä¼ å…¥<code>options</code>å¯¹è±¡å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å½“è¿æ¥å»ºç«‹æ—¶ï¼Œå›è°ƒå‡½æ•°è¢«è§¦å‘ã€‚</li><li>åœ¨å›è°ƒå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬é€šè¿‡æ£€æŸ¥<code>socket.authorized</code>æ¥ç¡®è®¤æ˜¯å¦æˆæƒæˆåŠŸã€‚</li><li>ä½¿ç”¨<code>socket.write</code>å‘é€è¯·æ±‚ä¿¡æ¯ç»™æœåŠ¡ç«¯ï¼›å½“æœåŠ¡ç«¯è¿”å›ä¿¡æ¯æ—¶ï¼Œ<code>data</code>äº‹ä»¶è¢«è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†è¿™äº›æ•°æ®ã€‚</li><li>æœ€åï¼Œç›‘å¬<code>end</code>å’Œ<code>error</code>äº‹ä»¶æ¥å¤„ç†è¿æ¥ç»“æŸæˆ–é”™è¯¯æƒ…å†µã€‚</li></ol><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œä½ å°±èƒ½å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„ TLS è¿æ¥ï¼Œå®‰å…¨åœ°ä¸æœåŠ¡ç«¯é€šä¿¡ã€‚</p><h2 id="tls-connect-path-options-callback" tabindex="-1"><a class="header-anchor" href="#tls-connect-path-options-callback"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsconnectpath-options-callback" target="_blank" rel="noopener noreferrer">tls.connect(path[, options][, callback])</a></span></a></h2><p>Node.js çš„ <code>tls.connect</code> æ–¹æ³•æ˜¯ç”¨æ¥å»ºç«‹ä¸€ä¸ªåˆ° TLS (ä¼ è¾“å±‚å®‰å…¨) æœåŠ¡å™¨çš„è¿æ¥ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ æƒ³åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­æ·»åŠ åŠ å¯†çš„æ•°æ®ä¼ è¾“ï¼Œæ¯”å¦‚å¤„ç†æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ä¿¡ç”¨å¡ä¿¡æ¯ã€ç™»å½•å‡­è¯ç­‰ï¼‰æ—¶ï¼Œä½ ä¼šå¸Œæœ›ä½¿ç”¨ TLS æ¥ä¿éšœè¿™äº›æ•°æ®çš„å®‰å…¨ã€‚<code>tls.connect</code> å°±æ˜¯ç”¨äºè¿™æ ·çš„åœºæ™¯ï¼Œå®ƒå¸®åŠ©ä½ åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„é€šé“æ¥ä¼ è¾“æ•°æ®ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>tls.connect</code> æ–¹æ³•å¯ä»¥é€šè¿‡ä¸åŒçš„å‚æ•°è¢«è°ƒç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ¦‚è¿°ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒçš„ä¾‹å­ï¼š</p><h3 id="åŸºæœ¬è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è¯­æ³•"><span>åŸºæœ¬è¯­æ³•</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”¨äºIPCè¿æ¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>options</strong>: ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€äº›é…ç½®é€‰é¡¹ï¼Œä¾‹å¦‚ä½ è¦è¿æ¥çš„æœåŠ¡å™¨çš„ç«¯å£å·ã€ä¸»æœºåã€æ‰€éœ€çš„ TLS è¯ä¹¦ç­‰ã€‚</li><li><strong>callback</strong>: è¿æ¥æˆåŠŸåå°†è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚</li></ul><p>è¿™é‡Œä¸»è¦ä»‹ç»ç¬¬ä¸‰ç§å½¢å¼ï¼š<code>tls.connect(path[, options][, callback])</code>ï¼Œé€‚ç”¨äºå»ºç«‹ IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰è¿æ¥ï¼Œå…¶ä¸­çš„<code>path</code>æ˜¯æŒ‡ UNIX å¥—æ¥å­—ï¼ˆsocketï¼‰çš„è·¯å¾„æˆ– Windows å‘½åç®¡é“çš„è·¯å¾„ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-è¿æ¥-tls-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¿æ¥-tls-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1ï¼šè¿æ¥ TLS æœåŠ¡å™¨</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿è¡Œåœ¨ç«¯å£ 1234 ä¸Šçš„ TLS æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æƒ³å®‰å…¨åœ°è¿æ¥åˆ°å®ƒå¹¶å‘é€&quot;hello&quot;æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æä¾›å¿…è¦çš„å®‰å…¨è¯ä¹¦ã€‚è¿™äº›é€šå¸¸ç”±æœåŠ¡å™¨æä¾›ç»™ä½ ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¿¡ä»»çš„CAè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯çš„ç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯çš„è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> host</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1234</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connected to server!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ”¶åˆ°æ•°æ®åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connection closed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†<code>tls</code>å’Œ<code>fs</code>(æ–‡ä»¶ç³»ç»Ÿ)æ¨¡å—ã€‚ç„¶åï¼Œå®šä¹‰äº†è¿æ¥æ‰€éœ€çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬ CA è¯ä¹¦ã€å®¢æˆ·ç«¯çš„ç§é’¥å’Œè¯ä¹¦ã€‚æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡<code>tls.connect</code>æ–¹æ³•å»ºç«‹åˆ°ç‰¹å®šä¸»æœºå’Œç«¯å£çš„è¿æ¥ï¼Œå¹¶åœ¨è¿æ¥å»ºç«‹åå‘é€&quot;hello&quot;æ¶ˆæ¯ã€‚æœ€åï¼Œæˆ‘ä»¬ç›‘å¬äº†<code>data</code>äº‹ä»¶æ¥æ¥æ”¶æœåŠ¡å™¨çš„å“åº”ï¼Œå¹¶åœ¨å®Œæˆäº¤æµåå…³é—­è¿æ¥ã€‚</p><p>é€šè¿‡ä½¿ç”¨ TLSï¼Œæ‰€æœ‰ç»è¿‡è¿™ä¸ªè¿æ¥çš„æ•°æ®éƒ½æ˜¯åŠ å¯†çš„ï¼Œä»è€Œä¿éšœäº†æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><h2 id="tls-connect-port-host-options-callback" tabindex="-1"><a class="header-anchor" href="#tls-connect-port-host-options-callback"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsconnectport-host-options-callback" target="_blank" rel="noopener noreferrer">tls.connect(port[, host][, options][, callback])</a></span></a></h2><p>Node.js çš„ <code>tls.connect()</code> æ–¹æ³•æ˜¯ç”¨äºå»ºç«‹ä¸€ä¸ªåˆ° TLS (ä¼ è¾“å±‚å®‰å…¨æ€§åè®®) æœåŠ¡å™¨çš„è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºéœ€è¦åŠ å¯†ä¼ è¾“æ•°æ®çš„åœºåˆï¼Œæ¯”å¦‚ï¼šå®‰å…¨åœ°ä¼ è¾“æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚ç™»å½•å‡­è¯ã€æ”¯ä»˜ä¿¡æ¯ç­‰ï¼‰ï¼Œæˆ–å½“ä½ æƒ³ç¡®ä¿æ•°æ®åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ—¶ä¸è¢«ç¬¬ä¸‰æ–¹çªƒå¬æˆ–ç¯¡æ”¹ã€‚ç°åœ¨ï¼Œæˆ‘ä¼šåˆ†è§£è¿™ä¸ªå‡½æ•°çš„å„ä¸ªéƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šä¸€äº›å®é™…çš„è¿ç”¨å®ä¾‹ã€‚</p><h3 id="åŸºæœ¬è¯­æ³•-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è¯­æ³•-1"><span>åŸºæœ¬è¯­æ³•</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">][, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>port</code> ï¼ˆå¿…éœ€ï¼‰: æŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·ã€‚</li><li><code>host</code> ï¼ˆå¯é€‰ï¼‰: è¿æ¥çš„æœåŠ¡å™¨çš„ä¸»æœºåï¼Œé»˜è®¤ä¸º <code>&#39;localhost&#39;</code>ã€‚</li><li><code>options</code> ï¼ˆå¯é€‰ï¼‰: åŒ…å«å„ç§ TLS é…ç½®çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä½ å¯ä»¥æŒ‡å®šæ‰€ä½¿ç”¨çš„å¯†é’¥ã€è¯ä¹¦ã€åŠ å¯†å¥—ä»¶ç­‰ã€‚</li><li><code>callback</code> ï¼ˆå¯é€‰ï¼‰: ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-10"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-è¿æ¥åˆ°-tls-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¿æ¥åˆ°-tls-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1: è¿æ¥åˆ° TLS æœåŠ¡å™¨</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿è¡Œåœ¨ç«¯å£ 8443 ä¸Šçš„ TLS æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æƒ³ä»å®¢æˆ·ç«¯å®‰å…¨åœ°è¿æ¥åˆ°å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯çš„è®¤è¯é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ˜¯å¦æ‹’ç»æœªæˆæƒçš„æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  rejectUnauthorized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä»¥ä¸‹æ˜¯TLS/SSLè¯ä¹¦ç›¸å…³çš„æ–‡ä»¶è·¯å¾„ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// CAè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/client-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯ç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/client-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯è¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿æ¥æˆåŠŸå»ºç«‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯ä»¥å¼€å§‹å®‰å…¨é€šä¿¡äº†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®æ¥æ”¶å®Œæ¯•åå…³é—­è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é¦–å…ˆå¯¼å…¥ <code>tls</code> å’Œ <code>fs</code> (ç”¨äºè¯»å–æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¯ä¹¦å’Œå¯†é’¥) æ¨¡å—ã€‚ç„¶åï¼Œå®šä¹‰ä¸€ä¸ª <code>options</code> å¯¹è±¡ï¼ŒåŒ…å«äº†è¿æ¥çš„å®‰å…¨æ€§ç›¸å…³çš„è®¾ç½®ï¼Œå¦‚æ˜¯å¦æ¥å—æœªç»æˆæƒçš„è¯ä¹¦ï¼ˆé€šå¸¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥è®¾ç½®ä¸º <code>true</code>ï¼Œæ‹’ç»æœªæˆæƒçš„æœåŠ¡å™¨ï¼‰ï¼Œä»¥åŠæŒ‡å‘ CA è¯ä¹¦ã€å®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥çš„è·¯å¾„ã€‚</p><p>é€šè¿‡è°ƒç”¨ <code>tls.connect()</code> å¹¶ä¼ å…¥ç«¯å£å·ã€ä¸»æœºåå’Œé€‰é¡¹ï¼Œå»ºç«‹åˆ°æœåŠ¡å™¨çš„è¿æ¥ã€‚è¿æ¥æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°ç¡®è®¤å¹¶å¼€å§‹å®‰å…¨é€šä¿¡ã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨å›è°ƒå¤„ç†è¿æ¥äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨å›è°ƒå¤„ç†è¿æ¥äº‹ä»¶"><span>ç¤ºä¾‹ 2: ä½¿ç”¨å›è°ƒå¤„ç†è¿æ¥äº‹ä»¶</span></a></h4><p>é™¤äº†ç›´æ¥å†™æ•°æ®ä¹‹å¤–ï¼Œä½ è¿˜å¯èƒ½æƒ³è¦å¤„ç†è¿æ¥çš„å…¶ä»–æ–¹é¢ï¼Œä¾‹å¦‚é”™è¯¯å¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¿æ¥å‡ºé”™: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä¼šåœ¨å‘ç”Ÿä»»ä½•é”™è¯¯æ—¶è§¦å‘ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°äº†è§£è¿æ¥çŠ¶æ€å¹¶è¿›è¡Œç›¸åº”çš„é”™è¯¯å¤„ç†ã€‚</p><h3 id="å°ç»“-4" tabindex="-1"><a class="header-anchor" href="#å°ç»“-4"><span>å°ç»“</span></a></h3><p><code>tls.connect()</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªå¼ºå¤§çš„å‡½æ•°ï¼Œå…è®¸å¼€å‘è€…åˆ›å»ºåŠ å¯†çš„å®¢æˆ·ç«¯è¿æ¥åˆ° TLS æœåŠ¡å™¨ï¼Œéå¸¸é€‚åˆéœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡é€‰é¡¹å‚æ•°ï¼Œä½ å¯ä»¥ç²¾ç»†æ§åˆ¶åŠ å¯†è¿‡ç¨‹ï¼Œå¹¶ä¸”é€šè¿‡äº‹ä»¶ç›‘å¬å™¨æ¥å¤„ç†è¿æ¥çš„å„ç§çŠ¶æ€ã€‚</p><h2 id="tls-createsecurecontext-options" tabindex="-1"><a class="header-anchor" href="#tls-createsecurecontext-options"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlscreatesecurecontextoptions" target="_blank" rel="noopener noreferrer">tls.createSecureContext([options])</a></span></a></h2><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥ç†è§£ <code>tls.createSecureContext([options])</code> åœ¨ Node.js ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒçš„å®é™…åº”ç”¨åœºæ™¯ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-3"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µä¼šéå¸¸æœ‰å¸®åŠ©ï¼š</p><ul><li><strong>TLS</strong>ï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰: å®ƒæ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç›®çš„æ˜¯åœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›å®‰å…¨çš„é€šä¿¡ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªä»¥ &quot;https://&quot; å¼€å¤´çš„ç½‘ç«™æ—¶ï¼Œè¯¥ç½‘ç«™å’Œä½ çš„æµè§ˆå™¨å°±æ˜¯é€šè¿‡ TLS åè®®æ¥ä¿æŠ¤ä½ ä»¬ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚</li><li><strong>SSL</strong>ï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰: å®ƒæ˜¯ TLS çš„å‰èº«ï¼Œä½†ç°åœ¨è¿™ä¸ªæœ¯è¯­é€šå¸¸ä¸ TLS äº’æ¢ä½¿ç”¨ã€‚</li><li><strong>Node.js</strong>: æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚</li></ul><h3 id="tls-createsecurecontext-options-1" tabindex="-1"><a class="header-anchor" href="#tls-createsecurecontext-options-1"><span>tls.createSecureContext([options])</span></a></h3><p><code>tls.createSecureContext([options])</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªâ€œå®‰å…¨ä¸Šä¸‹æ–‡â€ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å«æœ‰æ‰€æœ‰å¿…è¦çš„å®‰å…¨å‚æ•°ã€å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨ä»¥å»ºç«‹å®‰å…¨çš„ TLS æˆ– SSL è¿æ¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå°±åƒä¸€ä¸ªé…ç½®åŒ…ï¼Œä»»ä½•æ—¶å€™ä½ éœ€è¦å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªé…ç½®ã€‚</p><h4 id="å‚æ•°-options" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-options"><span>å‚æ•° options</span></a></h4><ul><li><code>key</code>: ç§é’¥çš„å­—ç¬¦ä¸²æˆ–è€…ç¼“å†²åŒºï¼Œç”¨äºæ”¯æŒ SSL/TLS åŠ å¯†ã€‚</li><li><code>cert</code>: è¯ä¹¦é“¾ï¼Œç”¨æ¥è¯æ˜æœåŠ¡å™¨çš„èº«ä»½ã€‚</li><li>å…¶ä»–é€‰é¡¹åŒ…æ‹¬æŒ‡å®šåŠ å¯†å¥—ä»¶çš„åå¥½ã€æ˜¯å¦è¯·æ±‚å®¢æˆ·ç«¯è¯ä¹¦ç­‰ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-8"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬çœ‹ä¸€äº›å…·ä½“çš„ä¾‹å­æ¥ç†è§£å…¶åº”ç”¨ã€‚</p><h4 id="_1-åˆ›å»º-https-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»º-https-æœåŠ¡å™¨"><span>1. åˆ›å»º HTTPS æœåŠ¡å™¨</span></a></h4><p>å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œå‘è®¿é—®è€…å±•ç¤ºâ€œHello, World!â€ä¿¡æ¯ï¼Œä½ ä¼šéœ€è¦ä½¿ç”¨åˆ° <code>tls.createSecureContext</code> æ¥ç¡®ä¿é€šä¿¡çš„å®‰å…¨æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é¦–å…ˆï¼Œè¯»å–ä½ çš„æœåŠ¡å™¨ç§é’¥å’Œè¯ä¹¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> privateKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/privateKey.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> certificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/certificate.crt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨tls.createSecureContextåˆ›å»ºä¸€ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> secureContext</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSecureContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">privateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç„¶åï¼Œä½¿ç”¨è¿™ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡åˆ›å»ºHTTPSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">secureContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on https://localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ éœ€è¦æœ‰æœ‰æ•ˆçš„æœåŠ¡å™¨ç§é’¥ (<code>privateKey.pem</code>) å’Œè¯ä¹¦ (<code>certificate.crt</code>)ã€‚è¿™ä¸¤è€…éƒ½æ˜¯é€šè¿‡ TLS/SSL è®¤è¯è¿‡ç¨‹è·å–çš„ï¼Œç”¨æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½å¹¶åŠ å¯†æ•°æ®ã€‚</p><h4 id="_2-è‡ªå®šä¹‰åŠ å¯†è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_2-è‡ªå®šä¹‰åŠ å¯†è¿æ¥"><span>2. è‡ªå®šä¹‰åŠ å¯†è¿æ¥</span></a></h4><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªéœ€è¦å®‰å…¨æ•°æ®ä¼ è¾“çš„å³æ—¶é€šè®¯æœåŠ¡ï¼Œ<code>tls.createSecureContext</code> å°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚é€šè¿‡ä¸ºæ¯ä¸ªè¿æ¥æˆ–æ¯ç±»è¿æ¥è‡ªå®šä¹‰å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä½ å¯ä»¥çµæ´»åœ°æ§åˆ¶åŠ å¯†ç»†èŠ‚ï¼Œæ¯”å¦‚é€‰æ‹©ç‰¹å®šçš„åŠ å¯†å¥—ä»¶æˆ–è°ƒæ•´æ€§èƒ½ä¸å®‰å…¨æ€§çš„å¹³è¡¡ã€‚</p><h3 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h3><p><code>tls.createSecureContext</code> æ˜¯ Node.js ä¸­å¤„ç†å®‰å…¨é€šä¿¡éå¸¸é‡è¦çš„å·¥å…·ã€‚é€šè¿‡ä¸ºä½ çš„åº”ç”¨æˆ–æœåŠ¡åˆ›å»ºåˆé€‚çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä½ å¯ä»¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œæ— è®ºæ˜¯åœ¨æ„å»º web åº”ç”¨ã€API è¿˜æ˜¯å…¶ä»–éœ€è¦åŠ å¯†é€šä¿¡çš„ç³»ç»Ÿä¸­ã€‚</p><h2 id="tls-createsecurepair-context-isserver-requestcert-rejectunauthorized-options" tabindex="-1"><a class="header-anchor" href="#tls-createsecurepair-context-isserver-requestcert-rejectunauthorized-options"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlscreatesecurepaircontext-isserver-requestcert-rejectunauthorized-options" target="_blank" rel="noopener noreferrer">tls.createSecurePair([context][, isServer][, requestCert][, rejectUnauthorized][, options])</a></span></a></h2><p>ç†è§£ <code>tls.createSecurePair</code> å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µã€‚TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§çš„åè®®ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªå®ç° TLSï¼ˆåŠ SSLï¼Œå…¶å‰èº«ï¼‰çš„æ–¹å¼ã€‚</p><p><code>tls.createSecurePair</code> æ˜¯ Node.js ä¸­<code>tls</code>æ¨¡å—çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å·²è¢«æ ‡è®°ä¸º<strong>å¼ƒç”¨</strong>ï¼ˆdeprecatedï¼‰ï¼Œæ„å‘³ç€å®ƒå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œä¸”ä¸æ¨èä½¿ç”¨ã€‚ç„¶è€Œï¼Œå®ƒçš„å·¥ä½œåŸç†å’Œç”¨ä¾‹ä»ç„¶æœ‰æ•™è‚²æ„ä¹‰ã€‚</p><h3 id="tls-createsecurepair-çš„åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#tls-createsecurepair-çš„åŠŸèƒ½"><span><code>tls.createSecurePair</code> çš„åŠŸèƒ½</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>tls.createSecurePair</code> æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªâ€œå®‰å…¨å¯¹â€ï¼ˆsecure pairï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå°è£…äº†åŠ å¯†å’Œè§£å¯†æ“ä½œçš„å¯¹è±¡ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©ä½ æ‰‹åŠ¨æ§åˆ¶ TLS åŠ å¯†å±‚çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>context</code> (å¯é€‰): ä¸€ä¸ª TLS çš„ä¸Šä¸‹æ–‡å®ä¾‹ï¼ŒåŒ…å«ç‰¹å®šçš„åŠ å¯†è®¾ç½®ã€‚</li><li><code>isServer</code> (å¯é€‰): ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªè¿æ¥æ˜¯ä½œä¸ºæœåŠ¡å™¨ï¼ˆtrueï¼‰è¿˜æ˜¯å®¢æˆ·ç«¯ï¼ˆfalseï¼‰ã€‚</li><li><code>requestCert</code> (å¯é€‰): å½“è®¾ç½®ä¸ºçœŸæ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¯·æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œç”¨äºåŒå‘è®¤è¯ã€‚</li><li><code>rejectUnauthorized</code> (å¯é€‰): å½“è®¾ç½®ä¸ºçœŸæ—¶ï¼Œå¦‚æœæœªæä¾›è¯ä¹¦æˆ–è¯ä¹¦æ— æ•ˆï¼Œåˆ™æ‹’ç»è¿æ¥ã€‚</li><li><code>options</code> (å¯é€‰): ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å…¶ä»–é…ç½®é€‰é¡¹ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>ç”±äº<code>createSecurePair</code>æ˜¯è¾ƒæ—§çš„ API å¹¶ä¸”å·²è¢«å¼ƒç”¨ï¼Œä»¥ä¸‹ç¤ºä¾‹ä¸»è¦ç”¨äºè¯´æ˜å®ƒæ˜¯å¦‚ä½•ç”¨äºåˆ›å»ºåŸºäº TLS çš„å®‰å…¨é€šä¿¡çš„ã€‚</p><h4 id="åˆ›å»ºä¸€ä¸ª-tls-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ª-tls-æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡"><span>åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨éœ€è¦å®‰å…¨åœ°ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚</p><p>æœåŠ¡ç«¯ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server listening on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œå®¢æˆ·ç«¯ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> conn</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">conn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connection authorized by a Certificate Authority.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connection not authorized: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> conn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorizationError</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  conn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">conn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  conn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç°ä»£ Node.js åº”ç”¨ä¸­ï¼Œå¦‚æœéœ€è¦å»ºç«‹ TLS è¿æ¥ï¼Œæ›´æ¨èä½¿ç”¨<code>tls.createServer</code> å’Œ<code>tls.connect</code>ç­‰æ–¹æ³•ç›´æ¥åˆ›å»ºå’Œç®¡ç† TLS æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿æ¥ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†æ›´ç®€æ´ã€æ›´é«˜çº§çš„ APIã€‚</p><h3 id="ç»“è¯­" tabindex="-1"><a class="header-anchor" href="#ç»“è¯­"><span>ç»“è¯­</span></a></h3><p>å°½ç®¡<code>tls.createSecurePair</code>æä¾›äº†åº•å±‚ TLS é€šä¿¡çš„èƒ½åŠ›ï¼Œä½†ç”±äºå®ƒçš„å¼ƒç”¨çŠ¶æ€ï¼Œå»ºè®®åœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨ Node.js æ¨èçš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¾‹å¦‚ç›´æ¥åˆ©ç”¨<code>tls.createServer</code>å’Œ<code>tls.TLSSocket</code>ç­‰ã€‚è¿™æ ·ä¸ä»…å¯ä»¥äº«å—åˆ°æ›´å¥½çš„æ€§èƒ½ï¼Œè¿˜èƒ½ç¡®ä¿ä»£ç çš„é•¿æœŸå…¼å®¹æ€§å’Œå®‰å…¨æ€§ã€‚</p><h2 id="tls-createserver-options-secureconnectionlistener" tabindex="-1"><a class="header-anchor" href="#tls-createserver-options-secureconnectionlistener"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlscreateserveroptions-secureconnectionlistener" target="_blank" rel="noopener noreferrer">tls.createServer([options][, secureConnectionListener])</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚<code>tls.createServer</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå±äº <code>tls</code> (Transport Layer Security) æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†å®ç°åŠ å¯†å’Œå®‰å…¨ç½‘ç»œè¿æ¥çš„èƒ½åŠ›ã€‚</p><h3 id="ç®€å•è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#ç®€å•è§£é‡Š"><span>ç®€å•è§£é‡Š</span></a></h3><p>åœ¨è°ˆè®º <code>tls.createServer</code> ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><p><strong>TLS (Transport Layer Security)</strong>: TLS æ˜¯ä¸€ä¸ªåè®®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§ã€‚å®ƒé€šå¸¸ç”¨äº web æµè§ˆå™¨å’Œ web æœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œæ¯”å¦‚å½“ä½ åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä¸€ä¸ª https ç½‘ç«™æ—¶ã€‚</p></li><li><p><strong>Server</strong>: åœ¨ç½‘ç»œæœ¯è¯­ä¸­ï¼ŒæœåŠ¡å™¨æ˜¯ä¸€å°ä¸ºå…¶ä»–è®¡ç®—æœºï¼ˆå®¢æˆ·ç«¯ï¼‰æä¾›æ•°æ®æˆ–æœåŠ¡çš„è®¡ç®—æœºã€‚</p></li></ul><p>é‚£ä¹ˆï¼Œ<code>tls.createServer</code> å…è®¸ä½ åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªä½¿ç”¨ TLS æˆ– SSL (Secure Sockets Layerï¼ŒTLS çš„å‰èº«) åè®®çš„æœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯ä»¥å®‰å…¨å¤„ç†æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·å‡­è¯ã€æ”¯ä»˜ä¿¡æ¯ç­‰ï¼‰çš„æœåŠ¡å™¨ã€‚</p><h3 id="å‚æ•°è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-1"><span>å‚æ•°è§£é‡Š</span></a></h3><p><code>tls.createServer</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><p><code>options</code> (å¯é€‰): è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ä¸åŒçš„é€‰é¡¹æ¥é…ç½®ä½ çš„æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>key</code>: ç§é’¥ï¼Œç”¨äºåŠ å¯†/è§£å¯†ä¼ è¾“çš„æ•°æ®ã€‚</li><li><code>cert</code>: å…¬é’¥è¯ä¹¦ï¼Œç”¨äºéªŒè¯æœåŠ¡å™¨èº«ä»½ã€‚</li><li>å…¶ä»–é«˜çº§é€‰é¡¹ï¼Œå¦‚ <code>ca</code>ï¼ˆç”¨äºæŒ‡å®šè¯ä¹¦é¢å‘æœºæ„ï¼‰ç­‰ã€‚</li></ul></li><li><p><code>secureConnectionListener</code> (å¯é€‰): å½“å»ºç«‹ä¸€ä¸ªæ–°çš„å®‰å…¨è¿æ¥æ—¶ï¼Œè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨ã€‚å®ƒæ˜¯ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p></li></ol><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ web æœåŠ¡ï¼Œç”¨äºå¤„ç†ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>tls.createServer</code> æ¥è¾¾æˆè¿™ä¸ªç›®æ ‡ï¼š</p><ol><li><p>é¦–å…ˆï¼Œä½ éœ€è¦ç”Ÿæˆ SSL/TLS çš„å¯†é’¥å’Œè¯ä¹¦ã€‚åœ¨ç°å®åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä»æƒå¨çš„è¯ä¹¦é¢å‘æœºæ„è·å–è¯ä¹¦ï¼Œä½†å¯¹äºæµ‹è¯•ç›®çš„ï¼Œä½ å¯ä»¥è‡ªå·±ç”Ÿæˆå®ƒä»¬ã€‚</p></li><li><p>åˆ›å»º <code>server.js</code> æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ª TLS æœåŠ¡å™¨ï¼š</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¯»å–ä½ çš„ç§é’¥å’Œè¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/private.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/certificate.crt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;secure connection established&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end your communication securely</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server running on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>è¿è¡Œä½ çš„ Node.js æœåŠ¡å™¨ (<code>node server.js</code>)ï¼Œç„¶åä½ å¯ä»¥ä½¿ç”¨æ”¯æŒ TLS/SSL çš„å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨æˆ–ä¸“ç”¨å®¢æˆ·ç«¯å·¥å…·ï¼‰è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„ 8000 ç«¯å£ã€‚ç”±äºä½ æ­£åœ¨ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šè­¦å‘Šè¯´è¿æ¥ä¸æ˜¯å®Œå…¨å®‰å…¨çš„ã€‚è¿™åœ¨å¼€å‘å’Œæµ‹è¯•æ—¶å¾ˆå¸¸è§ã€‚</li></ol><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œä½ å·²ç»è®¾ç½®äº†ä¸€ä¸ªç®€å•çš„ TLS æœåŠ¡å™¨ï¼Œå¯ä»¥å®‰å…¨åœ°æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥å’Œæ•°æ®ã€‚è¿™å¯¹äºæ„å»ºéœ€è¦åŠ å¯†é€šä¿¡çš„ä»»ä½•ç½‘ç»œåº”ç”¨éƒ½æ˜¯éå¸¸é‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°ç”¨æˆ·æ•°æ®å’Œéšç§æ—¶ã€‚</p><h2 id="tls-getciphers" tabindex="-1"><a class="header-anchor" href="#tls-getciphers"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsgetciphers" target="_blank" rel="noopener noreferrer">tls.getCiphers()</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒä½¿å¾—ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js çš„ä¼—å¤šæ¨¡å—ä¸­ï¼Œ<code>tls</code> æ¨¡å—æä¾›äº†ç”¨äºå®ç° TLS (ä¼ è¾“å±‚å®‰å…¨åè®®) å’Œ SSL (å®‰å…¨å¥—æ¥å±‚) çš„åŠ å¯†åŠŸèƒ½ï¼Œè¿™å¯¹äºå»ºç«‹å®‰å…¨çš„æ•°æ®ä¼ è¾“è‡³å…³é‡è¦ã€‚</p><h3 id="tls-getciphers-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#tls-getciphers-æ–¹æ³•"><span><code>tls.getCiphers()</code> æ–¹æ³•</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>tls.getCiphers()</code> æ˜¯ <code>tls</code> æ¨¡å—ä¸‹çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒç”¨äºè·å– OpenSSL æ”¯æŒçš„æ‰€æœ‰å¯†ç å¥—ä»¶çš„åˆ—è¡¨ã€‚å¯†ç å¥—ä»¶æ˜¯ä¸€ç»„ç®—æ³•ï¼Œç”¨äºä¿æŠ¤ç½‘ç»œè¿æ¥ä¸­çš„æ•°æ®äº¤æ¢ï¼ŒåŒ…æ‹¬ç”¨äºå¯†é’¥äº¤æ¢ã€æ•°æ®åŠ å¯†å’Œæ¶ˆæ¯è®¤è¯çš„ç®—æ³•ã€‚</p><p><strong>è¯¥æ–¹æ³•çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> ciphers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCiphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°æ‰€æœ‰æ”¯æŒçš„å¯†ç å¥—ä»¶</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>tls</code> æ¨¡å—ã€‚ç„¶åä½¿ç”¨ <code>tls.getCiphers()</code> æ–¹æ³•è·å–æ‰€æœ‰æ”¯æŒçš„å¯†ç å¥—ä»¶ï¼Œå¹¶å°†å®ƒä»¬æ‰“å°å‡ºæ¥ã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯æ ¹æ® OpenSSL çš„ç‰ˆæœ¬åŠ¨æ€ç”Ÿæˆçš„ï¼Œå¯èƒ½ä¼šéšç€ç¯å¢ƒçš„ä¸åŒè€Œæœ‰æ‰€å·®å¼‚ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-11"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>è™½ç„¶åœ¨æ—¥å¸¸çš„ Node.js å¼€å‘ä¸­ï¼Œä½ å¯èƒ½ä¸éœ€è¦ç›´æ¥ä¸ä½çº§çš„å¯†ç å¥—ä»¶æ‰“äº¤é“ï¼Œä½†äº†è§£å¯ç”¨çš„å¯†ç å¥—ä»¶å¯¹äºç¡®ä¿åº”ç”¨çš„å®‰å…¨é€šä¿¡æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„å®é™…åº”ç”¨åœºæ™¯ï¼š</p><h4 id="_1-å®‰å…¨é…ç½®-https-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-å®‰å…¨é…ç½®-https-æœåŠ¡å™¨"><span>1. å®‰å…¨é…ç½® HTTPS æœåŠ¡å™¨</span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js æ„å»ºä¸€ä¸ªéœ€è¦å®‰å…¨é€šä¿¡çš„ç½‘ç«™æˆ– API æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›é…ç½® TLS/SSL æ¥åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº†è§£å¹¶é€‰æ‹©åˆé€‚çš„å¯†ç å¥—ä»¶æ˜¯å¾ˆé‡è¦çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ECDHE-RSA-AES128-GCM-SHA256:!RC4:HIGH:!MD5:!aNULL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é…ç½®ç‰¹å®šçš„å¯†ç å¥—ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡ <code>options</code> å¯¹è±¡é…ç½®äº† TLS å‚æ•°ï¼Œå…¶ä¸­ <code>ciphers</code> å­—æ®µå…è®¸æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªä¼˜å…ˆä½¿ç”¨çš„å¯†ç å¥—ä»¶åˆ—è¡¨ã€‚</p><h4 id="_2-å®¡è®¡å’Œå®‰å…¨åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-å®¡è®¡å’Œå®‰å…¨åˆ†æ"><span>2. å®¡è®¡å’Œå®‰å…¨åˆ†æ</span></a></h4><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªå®‰å…¨ä¸“å®¶æˆ–è€…è´Ÿè´£ç»´æŠ¤ä¸€ä¸ªå¤§å‹é¡¹ç›®çš„ IT ä¸“å®¶ï¼ŒçŸ¥é“å¦‚ä½•æ£€ç´¢å¹¶åˆ†ææ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ è¿›è¡Œå®‰å…¨å®¡è®¡ï¼Œç¡®ä¿ä¸ä½¿ç”¨å·²ç»è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„å¯†ç å¥—ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç¼–å†™è„šæœ¬æ£€æŸ¥ä½ çš„åº”ç”¨æ˜¯å¦ä»…ä½¿ç”¨äº†å¼ºå¯†ç å¥—ä»¶:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–æ”¯æŒçš„å¯†ç å¥—ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> ciphers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCiphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æƒ³ç¡®è®¤åªä½¿ç”¨äº†è¿™äº›è¢«è®¤ä¸ºæ˜¯è¾ƒå¼ºçš„å¯†ç å¥—ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> strongCiphers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes128-gcm-sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes256-gcm-sha384&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ”¯æŒçš„å¯†ç å¥—ä»¶éƒ½æ˜¯æˆ‘ä»¬è®¤ä¸ºå¼ºå¤§çš„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> allStrong</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">every</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> strongCiphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Is the application only using strong ciphers? </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">allStrong</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯å¯¹ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ <code>tls.getCiphers()</code> æ–¹æ³•çš„è§£æå’Œä¸€äº›å®é™…åº”ç”¨çš„ç¤ºä¾‹ã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨ Node.js åº”ç”¨ä¸­å¤„ç† TLS/SSL ç›¸å…³çš„å®‰å…¨æ€§é—®é¢˜ã€‚</p><h2 id="tls-rootcertificates" tabindex="-1"><a class="header-anchor" href="#tls-rootcertificates"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsrootcertificates" target="_blank" rel="noopener noreferrer">tls.rootCertificates</a></span></a></h2><p>äº†è§£ <code>tls.rootCertificates</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ TLS å’Œè¯ä¹¦çš„æ¦‚å¿µã€‚</p><h3 id="ç®€è¦ä»‹ç»-tls-å’Œè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#ç®€è¦ä»‹ç»-tls-å’Œè¯ä¹¦"><span>ç®€è¦ä»‹ç» TLS å’Œè¯ä¹¦</span></a></h3><p><strong>TLS (Transport Layer Security)</strong> æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šå®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚å®ƒæ˜¯ SSL (Secure Sockets Layer) çš„åç»§è€…ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œå¹¶åœ¨æµè§ˆå™¨çš„åœ°å€æ çœ‹åˆ°ä¸€ä¸ªå°é”å›¾æ ‡æ—¶ï¼Œé‚£æ„å‘³ç€ä½ çš„è¿æ¥æ˜¯é€šè¿‡ TLS åŠ å¯†çš„ï¼Œç¡®ä¿äº†æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><p><strong>è¯ä¹¦</strong> åœ¨ TLS åŠ å¯†é€šä¿¡ä¸­æ‰®æ¼”äº†é‡è¦çš„è§’è‰²ã€‚ç®€å•æ¥è¯´ï¼Œè¯ä¹¦æ˜¯ç”±å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼ˆç§°ä¸ºè¯ä¹¦é¢å‘æœºæ„ï¼ŒCAï¼‰é¢å‘çš„æ•°å­—æ–‡ä»¶ï¼Œç”¨äºéªŒè¯æœåŠ¡å™¨ï¼ˆæˆ–ç½‘ç«™ï¼‰çš„èº«ä»½ã€‚è¿™å°±åƒæ˜¯ç½‘ç«™çš„èº«ä»½è¯ï¼Œè¯æ˜è¯¥ç½‘ç«™æ˜¯çœŸå®ã€å¯ä¿¡çš„ã€‚</p><h3 id="tls-rootcertificates-1" tabindex="-1"><a class="header-anchor" href="#tls-rootcertificates-1"><span><code>tls.rootCertificates</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls.rootCertificates</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼ŒåŒ…å«äº†é¢„è£…åœ¨ Node.js ä¸­çš„æ ¹è¯ä¹¦åˆ—è¡¨ã€‚æ ¹è¯ä¹¦æ˜¯ä½äºè®¤è¯é“¾é¡¶ç«¯çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„è¯ä¹¦ã€‚å½“ TLS/SSL è¿æ¥å»ºç«‹æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæä¾›å…¶èº«ä»½è¯ä¹¦ä»¥åŠä¸€ç³»åˆ—ä¸­é—´è¯ä¹¦ï¼Œæœ€ç»ˆè¿™ä¸ªé“¾æ¡éœ€è¦è¢«è¿½æº¯åˆ°ä¸€ä¸ªæ ¹è¯ä¹¦ã€‚å¦‚æœå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Node.js åº”ç”¨ï¼‰ä¿¡ä»»è¿™ä¸ªæ ¹è¯ä¹¦ï¼Œé‚£ä¹ˆæ•´ä¸ªè¯ä¹¦é“¾å°±è¢«è§†ä¸ºå¯ä¿¡çš„ï¼Œä»è€Œå»ºç«‹ä¸€ä¸ªå®‰å…¨çš„è¿æ¥ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œ<code>tls.rootCertificates</code> å°±æ˜¯ Node.js å†…ç½®çš„ã€è¢«å¹¿æ³›ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„åˆ—è¡¨ã€‚Node.js ä½¿ç”¨è¿™äº›è¯ä¹¦æ¥éªŒè¯ä¸ä¹‹å»ºç«‹ TLS/SSL è¿æ¥çš„æœåŠ¡å™¨è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>HTTPS è¯·æ±‚ï¼š</strong> å‡è®¾ä½ åœ¨ Node.js åº”ç”¨ä¸­ä½¿ç”¨ <code>https</code> æ¨¡å—å‘æŸä¸ª API å‘é€è¯·æ±‚ã€‚Node.js ä¼šä½¿ç”¨ <code>tls.rootCertificates</code> ä¸­çš„è¯ä¹¦æ¥éªŒè¯ API æœåŠ¡å™¨çš„è¯ä¹¦ã€‚å¦‚æœæœåŠ¡å™¨çš„è¯ä¹¦å¯ä»¥é€šè¿‡å†…ç½®æ ¹è¯ä¹¦é“¾éªŒè¯ï¼Œåˆ™è¯´æ˜è¿æ¥æ˜¯å®‰å…¨çš„ï¼Œäºæ˜¯ä½ çš„åº”ç”¨å°±å¯ä»¥æ”¾å¿ƒåœ°ä¸è¯¥æœåŠ¡å™¨äº¤æ¢æ•æ„Ÿä¿¡æ¯ã€‚</p></li><li><p><strong>è‡ªå®šä¹‰å’Œç®¡ç†ä¿¡ä»»é“¾ï¼š</strong> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦å¯¹é»˜è®¤çš„è¯ä¹¦ä¿¡ä»»é“¾è¿›è¡Œä¿®æ”¹æˆ–æ·»åŠ æ–°çš„ä¿¡ä»»è¯ä¹¦ã€‚è™½ç„¶ <code>tls.rootCertificates</code> æœ¬èº«åªæ˜¯ä¸€ä¸ªåªè¯»çš„å±æ€§ï¼Œä½†äº†è§£å®ƒæœ‰åŠ©äºä½ ç†è§£ Node.js å¦‚ä½•å¤„ç† TLS/SSL è¿æ¥çš„è¯ä¹¦éªŒè¯ã€‚é€šè¿‡ä½¿ç”¨å…¶ä»– <code>tls</code> æ¨¡å—çš„ APIï¼Œæ¯”å¦‚ <code>tls.createSecureContext</code>ï¼Œä½ å¯ä»¥æ·»åŠ é¢å¤–çš„è¯ä¹¦æˆ–è€…æ›¿æ¢é»˜è®¤çš„ä¿¡ä»»æœºåˆ¶ã€‚</p></li></ol><p>æ€»ç»“èµ·æ¥ï¼Œ<code>tls.rootCertificates</code> å±æ€§åœ¨ Node.js ä¸­ä»£è¡¨äº†å†…ç½®çš„ã€ç”¨äºéªŒè¯ TLS/SSL è¿æ¥è¯ä¹¦çš„æ ¹è¯ä¹¦åˆ—è¡¨ã€‚è¿™å¯¹äºç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§è‡³å…³é‡è¦ï¼Œä¹Ÿä½¿å¾—å¼€å‘è€…èƒ½æ›´å¥½åœ°ç†è§£å’Œæ§åˆ¶åº”ç”¨çš„å®‰å…¨é€šä¿¡æœºåˆ¶ã€‚</p><h2 id="tls-default-ecdh-curve" tabindex="-1"><a class="header-anchor" href="#tls-default-ecdh-curve"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsdefault_ecdh_curve" target="_blank" rel="noopener noreferrer">tls.DEFAULT_ECDH_CURVE</a></span></a></h2><p>Node.js ä¸­çš„<code>tls.DEFAULT_ECDH_CURVE</code>æ˜¯ä¸€ä¸ªä¸å®‰å…¨ä¼ è¾“å±‚ï¼ˆTLSï¼‰ç›¸å…³çš„æœ¯è¯­ã€‚è¦ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªå…³é”®ç‚¹ï¼šTLS åè®®ã€ECDH ç®—æ³•ä»¥åŠå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><h3 id="tls-åè®®" tabindex="-1"><a class="header-anchor" href="#tls-åè®®"><span>TLS åè®®</span></a></h3><p>TLSï¼ˆTransport Layer Securityï¼‰åè®®æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œæ—¨åœ¨ä¸ºäº’è”ç½‘é€šä¿¡æä¾›å®‰å…¨å’Œæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ è®¿é—®ä¸€ä¸ªä»¥â€œhttpsâ€å¼€å¤´çš„ç½‘ç«™æ—¶ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨ TLS åè®®ã€‚è¿™ä¸ªåè®®å¸®åŠ©ä¿æŠ¤ä½ çš„ä¿¡æ¯ï¼Œé˜²æ­¢è¢«æœªç»æˆæƒçš„äººçªƒå–ã€‚</p><h3 id="ecdh-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#ecdh-ç®—æ³•"><span>ECDH ç®—æ³•</span></a></h3><p>ECDHï¼ˆElliptic Curve Diffie-Hellmanï¼‰æ˜¯ä¸€ç§åŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦çš„å¯†é’¥äº¤æ¢åè®®ã€‚å®ƒå…è®¸åŒæ–¹åœ¨ä¸€ä¸ªä¸å®‰å…¨çš„é€šé“ä¸Šå»ºç«‹å…±äº«ç§˜å¯†ï¼Œè€Œæ— éœ€äº‹å…ˆå…±äº«ç§˜å¯†å¯†é’¥ã€‚ç®€å•æ¥è¯´ï¼Œå³ä½¿æœ‰äººç›‘å¬äº†ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡ï¼Œä»–ä»¬ä¹Ÿæ— æ³•å¾—çŸ¥è¿™ä¸¤å°è®¡ç®—æœºå…±åŒç”Ÿæˆçš„å¯†é’¥ã€‚</p><h3 id="tls-default-ecdh-curve-1" tabindex="-1"><a class="header-anchor" href="#tls-default-ecdh-curve-1"><span><code>tls.DEFAULT_ECDH_CURVE</code></span></a></h3><p>åœ¨ Node.js çš„ TLS æ¨¡å—ä¸­ï¼Œ<code>DEFAULT_ECDH_CURVE</code>å±æ€§æŒ‡å®šäº†å½“ä½¿ç”¨ ECDH ç®—æ³•è¿›è¡Œå¯†é’¥äº¤æ¢æ—¶ï¼Œé»˜è®¤ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªè®¾ç½®å†³å®šäº†ç”¨äºåŠ å¯†é€šä¿¡çš„æ•°å­¦æ›²çº¿çš„ç±»å‹ã€‚ä¸åŒçš„æ›²çº¿æœ‰ä¸åŒçš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</p><p>ä» Node.js v21.7.1 ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœæ‚¨æ£€æŸ¥ Node.js æ–‡æ¡£ï¼Œæ‚¨ä¼šå‘ç°é»˜è®¤æ›²çº¿å¯èƒ½å·²ç»é¢„è®¾æˆ–å¯ä»¥é€šè¿‡ä»£ç è¿›è¡Œé…ç½®ã€‚é€‰æ‹©åˆé€‚çš„æ›²çº¿å¯¹äºä¿è¯åŠ å¯†å¼ºåº¦å’Œåº”ç”¨æ€§èƒ½éƒ½éå¸¸é‡è¦ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-12"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œä½ æƒ³ç¡®ä¿ä½¿ç”¨å¼ºå¤§çš„åŠ å¯†ç®—æ³•å’Œé…ç½®ã€‚Node.js å…è®¸ä½ é€šè¿‡ TLS æ¨¡å—è½»æ¾åšåˆ°è¿™ä¸€ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨é€‰é¡¹ï¼ŒåŒ…æ‹¬SSLè¯ä¹¦è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æŒ‡å®šECDHæ›²çº¿</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ecdhCurve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;prime256v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ›²çº¿åç§°ï¼Œä½†å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºHTTPSæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®š<code>ecdhCurve</code>å±æ€§æ¥æ§åˆ¶ ECDH ç®—æ³•ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ã€‚è™½ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œæ˜¾å¼è®¾ç½®äº†æ›²çº¿ï¼Œä½†å¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨ Node.js ä¸­çš„<code>tls.DEFAULT_ECDH_CURVE</code>ä½œä¸ºé»˜è®¤å€¼ã€‚</p><p>è¿™å°±æ˜¯<code>tls.DEFAULT_ECDH_CURVE</code>åœ¨ Node.js ä¸­çš„ä½œç”¨åŠå…¶é‡è¦æ€§ã€‚å®ƒå¸®åŠ©å¼€å‘è€…ç¡®ä¿ä»–ä»¬çš„åº”ç”¨ç¨‹åºä½¿ç”¨çš„åŠ å¯†æŠ€æœ¯æ˜¯æœ€æ–°ä¸”æœ€å®‰å…¨çš„ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†è‡ªå®šä¹‰åŠ å¯†é…ç½®çš„çµæ´»æ€§ã€‚</p><h2 id="tls-default-max-version" tabindex="-1"><a class="header-anchor" href="#tls-default-max-version"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsdefault_max_version" target="_blank" rel="noopener noreferrer">tls.DEFAULT_MAX_VERSION</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œè€Œ <code>tls.DEFAULT_MAX_VERSION</code> æ˜¯ Node.js ä¸­ä¸å®‰å…¨ä¼ è¾“å±‚ï¼ˆTLSï¼‰ç›¸å…³çš„ä¸€ä¸ªç‰¹æ€§ã€‚äº†è§£è¿™ä¸€ç‚¹å¯¹ç¼–ç¨‹æ–°æ‰‹æ¥è¯´å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå…³ç³»åˆ°å¦‚ä½•é€šè¿‡ç½‘ç»œå®‰å…¨åœ°å‘é€ä¿¡æ¯ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-4" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-4"><span>ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</span></a></h3><p>TLSï¼Œå…¨ç§°ä¸ºä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œæ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šå®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªä»¥â€œhttps://â€å¼€å¤´çš„ç½‘ç«™æ—¶ï¼Œä½ çš„æµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å°±æ˜¯é€šè¿‡ TLS è¿›è¡ŒåŠ å¯†çš„ã€‚TLS ä¿è¯äº†ä½ çš„æ•°æ®ï¼ˆå¦‚å¯†ç ã€ä¿¡ç”¨å¡ä¿¡æ¯ç­‰ï¼‰åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šè¢«çªƒå–æˆ–ç¯¡æ”¹ã€‚</p><h3 id="tls-default-max-version-çš„å«ä¹‰" tabindex="-1"><a class="header-anchor" href="#tls-default-max-version-çš„å«ä¹‰"><span>tls.DEFAULT_MAX_VERSION çš„å«ä¹‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls.DEFAULT_MAX_VERSION</code> è®¾ç½®äº†å½“ä½¿ç”¨ TLS åè®®è¿›è¡ŒåŠ å¯†é€šä¿¡æ—¶ï¼Œé»˜è®¤å…è®¸ä½¿ç”¨çš„æœ€é«˜ç‰ˆæœ¬çš„ TLSã€‚TLS éšç€æ—¶é—´çš„æ¨ç§»æœ‰äº†å¤šä¸ªç‰ˆæœ¬ï¼ˆå¦‚ TLS 1.0, 1.1, 1.2, 1.3 ç­‰ï¼‰ï¼Œæ–°ç‰ˆæœ¬ä¿®å¤äº†æ—§ç‰ˆæœ¬çš„å®‰å…¨æ¼æ´å¹¶å¼•å…¥äº†æ–°çš„åŠŸèƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦è®¾ç½®-tls-default-max-version" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦è®¾ç½®-tls-default-max-version"><span>ä¸ºä»€ä¹ˆè¦è®¾ç½® tls.DEFAULT_MAX_VERSION?</span></a></h3><ul><li><strong>å®‰å…¨æ€§</strong>ï¼šé™åˆ¶ TLS çš„æœ€é«˜å¯ç”¨ç‰ˆæœ¬å¯ä»¥é˜²æ­¢ä½¿ç”¨å·²çŸ¥å­˜åœ¨å®‰å…¨é—®é¢˜çš„æ—§ç‰ˆæœ¬ã€‚</li><li><strong>å…¼å®¹æ€§</strong>ï¼šæœ‰äº›è€æ—§çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡å¯èƒ½ä¸æ”¯æŒæœ€æ–°ç‰ˆæœ¬çš„ TLSï¼Œè®¾ç½®ä¸€ä¸ªåˆé€‚çš„æœ€é«˜ç‰ˆæœ¬å¯ä»¥ç¡®ä¿ä¸è¿™äº›ç³»ç»Ÿçš„å…¼å®¹ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-9"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä¸å¦ä¸€ä¸ªæœåŠ¡å™¨å®‰å…¨åœ°äº¤æ¢æ•°æ®ã€‚</p><ol><li><p><strong>å®‰å…¨çš„ API è°ƒç”¨</strong>ï¼šä½ çš„åº”ç”¨å¯èƒ½éœ€è¦ä»ç¬¬ä¸‰æ–¹æœåŠ¡è·å–æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚æ”¯ä»˜å¤„ç†æœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šå¸Œæœ›ä½¿ç”¨æœ€å®‰å…¨çš„ TLS ç‰ˆæœ¬æ¥ä¿æŠ¤æ•°æ®ã€‚é€šè¿‡è®¾ç½® <code>tls.DEFAULT_MAX_VERSION</code>ï¼Œä½ å¯ä»¥ç¡®ä¿åº”ç”¨æ€»æ˜¯ä½¿ç”¨å½“å‰è®¤ä¸ºæœ€å®‰å…¨çš„ TLS ç‰ˆæœ¬æ¥è¿›è¡Œé€šä¿¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®å…è®¸çš„æœ€é«˜TLSç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DEFAULT_MAX_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;TLSv1.3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ•°æ®æ¥æ”¶å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å†…éƒ¨ç³»ç»Ÿé—´çš„æ•°æ®åŒæ­¥</strong>ï¼šå‡å¦‚ä½ çš„å…¬å¸å†…éƒ¨æœ‰å¤šä¸ªç³»ç»Ÿéœ€è¦ç›¸äº’é€šä¿¡ï¼Œå¹¶ä¸”äº¤æ¢åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ•°æ®ï¼Œä½¿ç”¨ TLS åŠ å¯†æ˜¯éå¸¸å¿…è¦çš„ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦ç¡®ä¿æ‰€æœ‰å†…éƒ¨ç³»ç»Ÿéƒ½ä½¿ç”¨ç›¸åŒçš„ TLS ç‰ˆæœ¬ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–å®‰å…¨æ€§å®¡æ ¸å’Œéµå®ˆå…¬å¸çš„å®‰å…¨æ”¿ç­–ã€‚</p></li></ol><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p>ç†è§£å¹¶åˆç†é…ç½® <code>tls.DEFAULT_MAX_VERSION</code> å¯¹äºå¼€å‘å®‰å…¨çš„ Node.js åº”ç”¨è‡³å…³é‡è¦ã€‚é€šè¿‡è¿™æ ·åšï¼Œä½ å¯ä»¥ç¡®ä¿åº”ç”¨åœ¨ä¸å…¶ä»–ç³»ç»Ÿäº¤æ¢æ•°æ®æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨æœ€å…ˆè¿›çš„åŠ å¯†æŠ€æœ¯ï¼Œä»è€Œä¿æŠ¤å¥½ç”¨æˆ·æ•°æ®å’Œç³»ç»Ÿå®‰å…¨ã€‚</p><h2 id="tls-default-min-version" tabindex="-1"><a class="header-anchor" href="#tls-default-min-version"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsdefault_min_version" target="_blank" rel="noopener noreferrer">tls.DEFAULT_MIN_VERSION</a></span></a></h2><p>Node.js ä¸­çš„ <code>tls.DEFAULT_MIN_VERSION</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæŒ‡å®šåœ¨ä½¿ç”¨ TLS (Transport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨åè®®) è¿›è¡Œå®‰å…¨é€šä¿¡æ—¶ï¼Œé»˜è®¤æ¥å—çš„æœ€ä½ç‰ˆæœ¬ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå®šä¹‰äº†å½“ä½ çš„åº”ç”¨ç¨‹åºé€šè¿‡ HTTPS æˆ–å…¶ä»–åŸºäº TLS çš„åè®®å»ºç«‹è¿æ¥æ—¶ï¼Œæœ€ä½å¯ä»¥æ¥å—å“ªä¸ªç‰ˆæœ¬çš„ TLS åè®®ã€‚è¿™å¯¹äºä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§éå¸¸é‡è¦ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®æœ€å°-tls-ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®æœ€å°-tls-ç‰ˆæœ¬"><span>ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®æœ€å° TLS ç‰ˆæœ¬ï¼Ÿ</span></a></h3><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¾ƒæ—§çš„ TLS ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ TLS 1.0 å’Œ 1.1ï¼‰è¢«å‘ç°å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå› æ­¤ä¸å†è¢«è§†ä¸ºå®‰å…¨ã€‚ä¸ºäº†ä¿æŠ¤ç”¨æˆ·æ•°æ®å…é­çªƒå¬æˆ–ç¯¡æ”¹ï¼Œæ›´é«˜ç‰ˆæœ¬çš„ TLS å¼•å…¥äº†æ–°çš„åŠ å¯†æŠ€æœ¯å’Œå®‰å…¨æªæ–½ã€‚å› æ­¤ï¼Œè®¾ç½®ä¸€ä¸ªâ€œæœ€å° TLS ç‰ˆæœ¬â€çš„è¦æ±‚æœ‰åŠ©äºç¡®ä¿åªæœ‰é‚£äº›é‡‡ç”¨äº†è¶³å¤Ÿå¼ºå®‰å…¨æªæ–½çš„é€šä¿¡æ‰ä¼šè¢«æ¥å—ã€‚</p><h3 id="å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-tls-default-min-version" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åœ¨-node-js-ä¸­ä½¿ç”¨-tls-default-min-version"><span>å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>tls.DEFAULT_MIN_VERSION</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ <code>tls.DEFAULT_MIN_VERSION</code> çš„å€¼æ¥å…¨å±€è®¾å®šä½ çš„åº”ç”¨æ¥å—çš„æœ€ä½ TLS ç‰ˆæœ¬ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js è®¾å®šäº†ä¸€ä¸ªæ¨èçš„æœ€å°ç‰ˆæœ¬ï¼Œä½†ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æŸ¥çœ‹é»˜è®¤çš„æœ€å°TLSç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DEFAULT_MIN_VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ›´æ”¹é»˜è®¤çš„æœ€å°TLSç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DEFAULT_MIN_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;TLSv1.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-9"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºå®‰å…¨çš„-web-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºå®‰å…¨çš„-web-æœåŠ¡å™¨"><span>1. åˆ›å»ºå®‰å…¨çš„ Web æœåŠ¡å™¨</span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨æ—¶ï¼Œå¯èƒ½ä¼šä½¿ç”¨åˆ° <code>https</code> æ¨¡å—ã€‚é€šè¿‡é…ç½® <code>tls.DEFAULT_MIN_VERSION</code>ï¼Œä½ å¯ä»¥ç¡®ä¿æ‰€æœ‰é€šè¿‡è¯¥æœåŠ¡å™¨è¿›è¡Œçš„é€šä¿¡éƒ½è‡³å°‘ä½¿ç”¨äº† TLSv1.2ï¼ˆå‡è®¾ä½ å°†å…¶è®¾ç½®ä¸º<code>TLSv1.2</code>ï¼‰ï¼Œä»è€Œæä¾›æ›´å¼ºçš„å®‰å…¨æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DEFAULT_MIN_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;TLSv1.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å¯åŠ¨äº†ä¸€ä¸ªç›‘å¬åœ¨ 8000 ç«¯å£çš„å®‰å…¨ Web æœåŠ¡å™¨ï¼Œä¸”åªæ¥å— TLSv1.2 ä»¥ä¸Šç‰ˆæœ¬çš„åŠ å¯†é€šä¿¡ã€‚</p><h4 id="_2-å®‰å…¨çš„å®¢æˆ·ç«¯è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-å®‰å…¨çš„å®¢æˆ·ç«¯è¯·æ±‚"><span>2. å®‰å…¨çš„å®¢æˆ·ç«¯è¯·æ±‚</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªéœ€è¦å‘å¤–éƒ¨æœåŠ¡å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œè®¾ç½® <code>tls.DEFAULT_MIN_VERSION</code> å¯ä»¥ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºä¸æœåŠ¡ç«¯çš„å®‰å…¨é€šä¿¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DEFAULT_MIN_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;TLSv1.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;çŠ¶æ€ç :&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° &quot;<a href="http://example.com" target="_blank" rel="noopener noreferrer">example.com</a>&quot;ï¼Œå¹¶ä¸”ç¡®ä¿ä½¿ç”¨çš„æ˜¯è‡³å°‘ä¸º TLSv1.2 ç‰ˆæœ¬çš„å®‰å…¨é€šä¿¡æ ‡å‡†ã€‚</p><p>é€šè¿‡é€‚å½“åœ°è®¾ç½® <code>tls.DEFAULT_MIN_VERSION</code>ï¼Œæ— è®ºæ˜¯ä½œä¸ºæœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œéƒ½æœ‰åŠ©äºå¢å¼º Node.js åº”ç”¨çš„å®‰å…¨æ€§ã€‚</p><h2 id="tls-default-ciphers" tabindex="-1"><a class="header-anchor" href="#tls-default-ciphers"><span><a href="https://nodejs.org/docs/latest/api/tls.html#tlsdefault_ciphers" target="_blank" rel="noopener noreferrer">tls.DEFAULT_CIPHERS</a></span></a></h2><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-tls-5" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tls-5"><span>ä»€ä¹ˆæ˜¯ TLSï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä» TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰å¼€å§‹ã€‚ç®€å•æ¥è¯´ï¼ŒTLS æ˜¯ä¸€ç§åè®®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›åŠ å¯†ä¼ è¾“ï¼Œç¡®ä¿ä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œå¦‚æœç½‘å€ä»¥â€œhttpsâ€å¼€å¤´ï¼Œé‚£ä¹ˆè¿™ä¸ªç½‘ç«™å°±æ˜¯ä½¿ç”¨ TLS æˆ–å…¶å‰èº« SSL æ¥åŠ å¯†æ•°æ®çš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-cipher-suites" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-cipher-suites"><span>ä»€ä¹ˆæ˜¯ Cipher Suitesï¼Ÿ</span></a></h3><p>Cipher Suite æ˜¯ä¸€ç³»åˆ—åŠ å¯†ç®—æ³•ï¼Œç”¨äºåœ¨ TLS è¿æ¥ä¸­ä¿æŠ¤æ•°æ®ã€‚å®ƒç”±å››éƒ¨åˆ†ç»„æˆï¼š</p><ol><li><strong>å¯†é’¥äº¤æ¢ç®—æ³•</strong>ï¼šå¦‚ RSAã€DH ç­‰ï¼Œç”¨äºå®‰å…¨åœ°äº¤æ¢å¯†é’¥ã€‚</li><li><strong>è®¤è¯ç®—æ³•</strong>ï¼šç”¨äºæœåŠ¡å™¨å’Œæœ‰æ—¶å®¢æˆ·ç«¯çš„èº«ä»½éªŒè¯ã€‚</li><li><strong>æ•°æ®åŠ å¯†ç®—æ³•</strong>ï¼šå¦‚ AESã€Chacha20 ç­‰ï¼Œç”¨äºåŠ å¯†ä¼ è¾“çš„æ•°æ®ã€‚</li><li><strong>æ¶ˆæ¯è®¤è¯ç ç®—æ³•</strong>ï¼šç”¨äºæ¶ˆæ¯å®Œæ•´æ€§æ£€æŸ¥å’Œè®¤è¯ã€‚</li></ol><p>æ¯ä¸ª Cipher Suite æä¾›äº†ä¸åŒçš„å®‰å…¨ç‰¹æ€§ï¼Œå› æ­¤é€‰æ‹©å“ªäº› Cipher Suite å¯¹äºä¿éšœé€šä¿¡çš„å®‰å…¨éå¸¸å…³é”®ã€‚</p><h3 id="node-js-ä¸­çš„tls-default-ciphers" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„tls-default-ciphers"><span>Node.js ä¸­çš„<code>tls.DEFAULT_CIPHERS</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls.DEFAULT_CIPHERS</code>æ˜¯æŒ‡é»˜è®¤æƒ…å†µä¸‹ TLS æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ‰€æ”¯æŒçš„ Cipher Suites åˆ—è¡¨ã€‚Node.js å›¢é˜Ÿæ ¹æ®å½“å‰çš„æœ€ä½³å®è·µä¸ºè¿™ä¸ªåˆ—è¡¨é€‰æ‹©äº†ä¸€å¥— Cipher Suitesï¼Œä»¥ç¡®ä¿è‰¯å¥½çš„å®‰å…¨æ€§å’Œå…¼å®¹æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ Node.js çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤ Cipher Suites å¯èƒ½åŒ…æ‹¬åƒ<code>ECDHE-RSA-AES128-GCM-SHA256</code>è¿™æ ·çš„é¡¹ã€‚è¿™é‡Œé¢ï¼Œâ€œECDHE-RSAâ€è¡¨ç¤ºå¯†é’¥äº¤æ¢å’Œè®¤è¯ç®—æ³•ï¼Œ&quot;AES128-GCM&quot;è¡¨ç¤ºä½¿ç”¨ 128 ä½å¯†é’¥çš„ AES ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œ&quot;SHA256&quot;è¡¨ç¤ºä½¿ç”¨ SHA-256 ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-10"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>åˆ›å»º HTTPS æœåŠ¡å™¨</strong>ï¼šå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Web åº”ç”¨ï¼Œå¹¶ä¸”æƒ³è¦ç¡®ä¿æ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½æ˜¯åŠ å¯†çš„ã€‚ä½¿ç”¨ Node.jsï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œå¹¶åˆ©ç”¨ TLS æ¥åŠ å¯†é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>tls.DEFAULT_CIPHERS</code>ä¸­å®šä¹‰çš„ Cipher Suites ä¼šè¢«ç”¨æ¥ä¸å®¢æˆ·ç«¯åå•†åŠ å¯†å‚æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;private-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;certificate.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è‡ªå®šä¹‰ Cipher Suites</strong>ï¼šå¦‚æœå‡ºäºæŸç§åŸå› ï¼ˆæ¯”å¦‚ç¬¦åˆç‰¹å®šçš„å®‰å…¨æ ‡å‡†ï¼‰ï¼Œä½ éœ€è¦ä½¿ç”¨é™¤äº†é»˜è®¤ä¹‹å¤–çš„ Cipher Suitesï¼ŒNode.js å…è®¸ä½ è‡ªå®šä¹‰è¿™ä¸ªåˆ—è¡¨ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æ ¹æ®éœ€è¦å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„ Cipher Suitesï¼Œä»¥æ»¡è¶³ä½ çš„å®‰å…¨éœ€æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;private-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;certificate.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ECDHE-RSA-AES128-GCM-SHA256:AES128-SHA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="ç»“è®º-4" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-4"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ç†è§£ TLS å’Œ Cipher Suitesï¼Œä½ å¯ä»¥æ›´å¥½åœ°æŒæ¡ Node.js ä¸­<code>tls.DEFAULT_CIPHERS</code>çš„ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•æ ¹æ®ä½ çš„å®‰å…¨éœ€æ±‚æ¥è°ƒæ•´å®ƒä»¬ã€‚è¿™å¯¹äºå¼€å‘å®‰å…¨çš„ç½‘ç»œåº”ç”¨å’ŒæœåŠ¡æ˜¯è‡³å…³é‡è¦çš„ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Timers.html" aria-label="Timers"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Timers</div></a><a class="route-link auto-link next" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Trace events<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.b30e1963.js" defer></script><script src="/assets/js/9435.209d772b.js" defer></script><script src="/assets/js/app.e085f460.js" defer></script>
  </body>
</html>
