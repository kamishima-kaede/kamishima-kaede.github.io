<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Deprecated%20APIs.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Deprecated APIs"><meta property="og:description" content="Deprecated APIs å½“æˆ‘ä»¬åœ¨è°ˆè®ºè½¯ä»¶ä¸­çš„"å¼ƒç”¨ï¼ˆDeprecatedï¼‰APIs"æ—¶ï¼Œæ„å‘³ç€å¼€å‘è€…ä»¬å†³å®šä¸å†æ¨èä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤å®ƒä»¬ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¿™äº› APIs å­˜åœ¨ç¼ºé™·ã€å®‰å…¨é—®é¢˜ï¼Œæˆ–è€…æœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚ Node.js ä½œä¸ºä¸€ä¸ªæ´»è·ƒè¿›åŒ–çš„å¹³å°ï¼Œç»å¸¸ä¼šæ›´æ–°å…¶ APIã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œå¼ƒ..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Deprecated APIs","description":"Deprecated APIs å½“æˆ‘ä»¬åœ¨è°ˆè®ºè½¯ä»¶ä¸­çš„\"å¼ƒç”¨ï¼ˆDeprecatedï¼‰APIs\"æ—¶ï¼Œæ„å‘³ç€å¼€å‘è€…ä»¬å†³å®šä¸å†æ¨èä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤å®ƒä»¬ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¿™äº› APIs å­˜åœ¨ç¼ºé™·ã€å®‰å…¨é—®é¢˜ï¼Œæˆ–è€…æœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚ Node.js ä½œä¸ºä¸€ä¸ªæ´»è·ƒè¿›åŒ–çš„å¹³å°ï¼Œç»å¸¸ä¼šæ›´æ–°å…¶ APIã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œå¼ƒ..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Deprecated APIs | hanekawa-shiki</title><meta name="description" content="Deprecated APIs å½“æˆ‘ä»¬åœ¨è°ˆè®ºè½¯ä»¶ä¸­çš„"å¼ƒç”¨ï¼ˆDeprecatedï¼‰APIs"æ—¶ï¼Œæ„å‘³ç€å¼€å‘è€…ä»¬å†³å®šä¸å†æ¨èä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤å®ƒä»¬ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¿™äº› APIs å­˜åœ¨ç¼ºé™·ã€å®‰å…¨é—®é¢˜ï¼Œæˆ–è€…æœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚ Node.js ä½œä¸ºä¸€ä¸ªæ´»è·ƒè¿›åŒ–çš„å¹³å°ï¼Œç»å¸¸ä¼šæ›´æ–°å…¶ APIã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œå¼ƒ...">
    <link rel="stylesheet" href="/assets/css/styles.2fe8dfd0.css">
    <link rel="preload" href="/assets/js/runtime~app.e98858ae.js" as="script"><link rel="preload" href="/assets/css/styles.2fe8dfd0.css" as="style"><link rel="preload" href="/assets/js/9435.209d772b.js" as="script"><link rel="preload" href="/assets/js/app.604dc302.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-CommonJS%20modules.html" aria-label="Modules: CommonJS modules"><!---->Modules: CommonJS modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-ECMAScript%20modules.html" aria-label="Modules: ECMAScript modules"><!---->Modules: ECMAScript modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-node_module%20API.html" aria-label="Modules: node:module API"><!---->Modules: node:module API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><!---->Modules: Packages<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Deprecated APIs</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 363 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT363M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 109003 å­—</span><meta property="wordCount" content="109003"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#revoking-deprecations">Revoking deprecations</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#list-of-deprecated-apis">List of deprecated APIs</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0001-http-outgoingmessage-prototype-flush">DEP0001: http.OutgoingMessage.prototype.flush</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¸ªä¾‹å­">ä¸¾ä¸ªä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0002-require-linklist">DEP0002: require(&#39;_linklist&#39;)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0003-writablestate-buffer">DEP0003: _writableState.buffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0004-cryptostream-prototype-readystate">DEP0004: CryptoStream.prototype.readyState</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0005-buffer-constructor">DEP0005: Buffer() constructor</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0006-child-process-options-customfds">DEP0006: child_process options.customFds</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0007-replace-cluster-worker-suicide-with-worker-exitedafterdisconnect">DEP0007: Replace cluster worker.suicide with worker.exitedAfterDisconnect</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0008-require-node-constants">DEP0008: require(&#39;node:constants&#39;)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0009-crypto-pbkdf2-without-digest">DEP0009: crypto.pbkdf2 without digest</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0010-crypto-createcredentials">DEP0010: crypto.createCredentials</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0011-crypto-credentials">DEP0011: crypto.Credentials</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0012-domain-dispose">DEP0012: Domain.dispose</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0013-fs-asynchronous-function-without-callback">DEP0013: fs asynchronous function without callback</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0014-fs-read-legacy-string-interface">DEP0014: fs.read legacy String interface</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0014-fs-read-legacy-string-interface-1">DEP0014: fs.read legacy String interface</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0015-fs-readsync-legacy-string-interface">DEP0015: fs.readSync legacy String interface</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0016-global-root">DEP0016: GLOBAL/root</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0017-intl-v8breakiterator">DEP0017: Intl.v8BreakIterator</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0018-unhandled-promise-rejections">DEP0018: Unhandled promise rejections</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0019-require-resolved-outside-directory">DEP0019: require(&#39;.&#39;) resolved outside directory</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0020-server-connections">DEP0020: Server.connections</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0021-server-listenfd">DEP0021: Server.listenFD</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0022-os-tmpdir">DEP0022: os.tmpDir()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0023-os-getnetworkinterfaces">DEP0023: os.getNetworkInterfaces()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0024-replserver-prototype-converttocontext">DEP0024: REPLServer.prototype.convertToContext()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0025-require-node-sys">DEP0025: require(&#39;node:sys&#39;)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0026-util-print">DEP0026: util.print()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0027-util-puts">DEP0027: util.puts()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0028-util-debug">DEP0028: util.debug()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0029-util-error">DEP0029: util.error()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0030-slowbuffer">DEP0030: SlowBuffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0031-ecdh-setpublickey">DEP0031: ecdh.setPublicKey()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#elliptic-curve-diffie-hellman-ecdh">Elliptic Curve Diffie-Hellman (ECDH)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecdh-setpublickey">ecdh.setPublicKey()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¸ªä¾‹å­-1">ä¸¾ä¸ªä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0032-node-domain-module">DEP0032: node:domain module</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0033-eventemitter-listenercount">DEP0033: EventEmitter.listenerCount()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-eventemitter-listenercount">ä»€ä¹ˆæ˜¯ EventEmitter.listenerCount()ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¢«åºŸå¼ƒä»¥åŠæ›¿ä»£æ–¹æ¡ˆ">ä¸ºä»€ä¹ˆè¢«åºŸå¼ƒä»¥åŠæ›¿ä»£æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0034-fs-exists-path-callback">DEP0034: fs.exists(path, callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0035-fs-lchmod-path-mode-callback">DEP0035: fs.lchmod(path, mode, callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0036-fs-lchmodsync-path-mode">DEP0036: fs.lchmodSync(path, mode)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0037-fs-lchown-path-uid-gid-callback">DEP0037: fs.lchown(path, uid, gid, callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0038-fs-lchownsync-path-uid-gid">DEP0038: fs.lchownSync(path, uid, gid)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0039-require-extensions">DEP0039: require.extensions</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0040-node-punycode-module">DEP0040: node:punycode module</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0041-node-repl-history-file-environment-variable">DEP0041: NODE_REPL_HISTORY_FILE environment variable</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0042-tls-cryptostream">DEP0042: tls.CryptoStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0043-tls-securepair">DEP0043: tls.SecurePair</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0044-util-isarray">DEP0044: util.isArray()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0045-util-isboolean">DEP0045: util.isBoolean()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0046-util-isbuffer">DEP0046: util.isBuffer()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0047-util-isdate">DEP0047: util.isDate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0048-util-iserror">DEP0048: util.isError()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0049-util-isfunction">DEP0049: util.isFunction()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0050-util-isnull">DEP0050: util.isNull()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0051-util-isnullorundefined">DEP0051: util.isNullOrUndefined()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0052-util-isnumber">DEP0052: util.isNumber()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-util-isnumber-è¢«å¼ƒç”¨">ä¸ºä»€ä¹ˆ util.isNumber() è¢«å¼ƒç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£-util-isnumber">æ›¿ä»£ util.isNumber()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0053-util-isobject">DEP0053: util.isObject()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆå¼ƒç”¨-util-isobject">ä¸ºä»€ä¹ˆå¼ƒç”¨ util.isObject()ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£æ–¹æ¡ˆ">æ›¿ä»£æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0054-util-isprimitive">DEP0054: util.isPrimitive()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0055-util-isregexp">DEP0055: util.isRegExp()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0056-util-isstring">DEP0056: util.isString()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0057-util-issymbol">DEP0057: util.isSymbol()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0058-util-isundefined">DEP0058: util.isUndefined()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0059-util-log">DEP0059: util.log()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯util-log">ä»€ä¹ˆæ˜¯util.log()?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£æ–¹æ¡ˆ-1">æ›¿ä»£æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0060-util-extend">DEP0060: util._extend()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0061-fs-syncwritestream">DEP0061: fs.SyncWriteStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0062-node-debug">DEP0062: node --debug</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Šnode-debug-å’Œ-node-debug-brk">è§£é‡Šnode --debug å’Œ node --debug-brk</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¢«å¼ƒç”¨">ä¸ºä»€ä¹ˆè¢«å¼ƒç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•æ›¿ä»£">å¦‚ä½•æ›¿ä»£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹">å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0063-serverresponse-prototype-writeheader">DEP0063: ServerResponse.prototype.writeHeader()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0064-tls-createsecurepair">DEP0064: tls.createSecurePair()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-createsecurepair">tls.createSecurePair()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åºŸå¼ƒ-deprecation">åºŸå¼ƒï¼ˆDeprecationï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£æ–¹æ¡ˆ-2">æ›¿ä»£æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0065-repl-repl-mode-magic-and-node-repl-mode-magic">DEP0065: repl.REPL_MODE_MAGIC and NODE_REPL_MODE=magic</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0066-outgoingmessage-prototype-headers-outgoingmessage-prototype-headernames">DEP0066: OutgoingMessage.prototype._headers, OutgoingMessage.prototype._headerNames</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0067-outgoingmessage-prototype-renderheaders">DEP0067: OutgoingMessage.prototype._renderHeaders</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0068-node-debug">DEP0068: node debug</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0069-vm-runindebugcontext-string">DEP0069: vm.runInDebugContext(string)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0070-async-hooks-currentid">DEP0070: async_hooks.currentId()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0071-async-hooks-triggerid">DEP0071: async_hooks.triggerId()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0072-async-hooks-asyncresource-triggerid">DEP0072: async_hooks.AsyncResource.triggerId()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0073-several-internal-properties-of-net-server">DEP0073: Several internal properties of net.Server</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0074-replserver-bufferedcommand">DEP0074: REPLServer.bufferedCommand</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0075-replserver-parsereplkeyword">DEP0075: REPLServer.parseREPLKeyword()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0076-tls-parsecertstring">DEP0076: tls.parseCertString()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-tls-parsecertstring-è¢«åºŸå¼ƒäº†">ä¸ºä»€ä¹ˆ tls.parseCertString() è¢«åºŸå¼ƒäº†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£æ–¹æ¡ˆ-3">æ›¿ä»£æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0077-module-debug">DEP0077: Module._debug()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0078-replserver-turnoffeditormode">DEP0078: REPLServer.turnOffEditorMode()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0079-custom-inspection-function-on-objects-via-inspect">DEP0079: Custom inspection function on objects via .inspect()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0080-path-makelong">DEP0080: path._makeLong()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0081-fs-truncate-using-a-file-descriptor">DEP0081: fs.truncate() using a file descriptor</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0082-replserver-prototype-memory">DEP0082: REPLServer.prototype.memory()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0083-disabling-ecdh-by-setting-ecdhcurve-to-false">DEP0083: Disabling ECDH by setting ecdhCurve to false</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0084-requiring-bundled-internal-dependencies">DEP0084: requiring bundled internal dependencies</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0085-asynchooks-sensitive-api">DEP0085: AsyncHooks sensitive API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0086-remove-runinasyncidscope">DEP0086: Remove runInAsyncIdScope</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0090-invalid-gcm-authentication-tag-lengths">DEP0090: Invalid GCM authentication tag lengths</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0091-crypto-default-encoding">DEP0091: crypto.DEFAULT_ENCODING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0092-top-level-this-bound-to-module-exports">DEP0092: Top-level this bound to module.exports</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0093-crypto-fips-is-deprecated-and-replaced">DEP0093: crypto.fips is deprecated and replaced</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0094-using-assert-fail-with-more-than-one-argument">DEP0094: Using assert.fail() with more than one argument</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0095-timers-enroll">DEP0095: timers.enroll()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#timers-enroll">timers.enroll()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­">ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0096-timers-unenroll">DEP0096: timers.unenroll()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0097-makecallback-with-domain-property">DEP0097: MakeCallback with domain property</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0098-asynchooks-embedder-asyncresource-emitbefore-and-asyncresource-emitafter-apis">DEP0098: AsyncHooks embedder AsyncResource.emitBefore and AsyncResource.emitAfter APIs</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0099-async-context-unaware-node-makecallback-c-apis">DEP0099: Async context-unaware node::MakeCallback C++ APIs</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0100-process-assert">DEP0100: process.assert()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ—§æ–¹å¼-ä½¿ç”¨-process-assert">æ—§æ–¹å¼ï¼šä½¿ç”¨ process.assert()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ–°æ–¹å¼-ä½¿ç”¨-assert-æ¨¡å—">æ–°æ–¹å¼ï¼šä½¿ç”¨ assert æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0101-with-lttng">DEP0101: --with-lttng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0102-using-noassert-in-buffer-read-write-operations">DEP0102: Using noAssert in Buffer#(read|write) operations</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0103-process-binding-util-is-typechecks">DEP0103: process.binding(&#39;util&#39;).is[...] typechecks</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0104-process-env-string-coercion">DEP0104: process.env string coercion</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0105-decipher-finaltol">DEP0105: decipher.finaltol</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0106-crypto-createcipher-and-crypto-createdecipher">DEP0106: crypto.createCipher and crypto.createDecipher</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0107-tls-convertnpnprotocols">DEP0107: tls.convertNPNProtocols()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-npn">ä»€ä¹ˆæ˜¯ NPN?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆåºŸå¼ƒ-tls-convertnpnprotocols">ä¸ºä»€ä¹ˆåºŸå¼ƒ tls.convertNPNProtocols()ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¸­åº”è¯¥åšä»€ä¹ˆ">å®é™…è¿ç”¨ä¸­åº”è¯¥åšä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0108-zlib-bytesread">DEP0108: zlib.bytesRead</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0109-http-https-and-tls-support-for-invalid-urls">DEP0109: http, https, and tls support for invalid URLs</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-http-get-è¯·æ±‚">ä¾‹å­ 1ï¼šHTTP GET è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-åˆ›å»º-https-æœåŠ¡å™¨">ä¾‹å­ 2ï¼šåˆ›å»º HTTPS æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åæœå’Œæœ€ä½³å®è·µ">åæœå’Œæœ€ä½³å®è·µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0110-vm-script-cached-data">DEP0110: vm.Script cached data</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-dep0110-ä¹‹å‰çš„ä¾‹å­">åœ¨ DEP0110 ä¹‹å‰çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨-dep0110-ä¹‹åçš„æ”¹å˜">åœ¨ DEP0110 ä¹‹åçš„æ”¹å˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0111-process-binding">DEP0111: process.binding()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¦å¼ƒç”¨process-binding">ä¸ºä»€ä¹ˆè¦å¼ƒç”¨process.binding()?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0112-dgram-private-apis">DEP0112: dgram private APIs</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0113-cipher-setauthtag-decipher-getauthtag">DEP0113: Cipher.setAuthTag(), Decipher.getAuthTag()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0114-crypto-tobuf">DEP0114: crypto._toBuf()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0115-crypto-prng-crypto-pseudorandombytes-crypto-rng">DEP0115: crypto.prng(), crypto.pseudoRandomBytes(), crypto.rng()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åºŸå¼ƒçš„æ–¹æ³•ç¤ºä¾‹">åºŸå¼ƒçš„æ–¹æ³•ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¨èçš„æ–¹æ³•ç¤ºä¾‹">æ¨èçš„æ–¹æ³•ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0116-legacy-url-api">DEP0116: Legacy URL API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹å¯¹æ¯”">å®ä¾‹å¯¹æ¯”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0117-native-crypto-handles">DEP0117: Native crypto handles</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0118-dns-lookup-support-for-a-falsy-host-name">DEP0118: dns.lookup() support for a falsy host name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-å¼ƒç”¨ä¹‹å‰çš„è¡Œä¸º">ç¤ºä¾‹ 1 - å¼ƒç”¨ä¹‹å‰çš„è¡Œä¸º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-æ›´æ–°åçš„è¡Œä¸º">ç¤ºä¾‹ 2 - æ›´æ–°åçš„è¡Œä¸º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•æ­£ç¡®ä½¿ç”¨-dns-lookup">å¦‚ä½•æ­£ç¡®ä½¿ç”¨ dns.lookup()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0119-process-binding-uv-errname-private-api">DEP0119: process.binding(&#39;uv&#39;).errname() private API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0120-windows-performance-counter-support">DEP0120: Windows Performance Counter support</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0121-net-setsimultaneousaccepts">DEP0121: net._setSimultaneousAccepts()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0122-tls-server-prototype-setoptions">DEP0122: tls Server.prototype.setOptions()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0123-setting-the-tls-servername-to-an-ip-address">DEP0123: setting the TLS ServerName to an IP address</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-å’Œ-servername">TLS å’Œ ServerName</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ip-åœ°å€ä¸å†è¢«æ”¯æŒä½œä¸º-servername">IP åœ°å€ä¸å†è¢«æ”¯æŒä½œä¸º ServerName</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0124-using-replserver-rli">DEP0124: using REPLServer.rli</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0124-å¼ƒç”¨è¯´æ˜">DEP0124 å¼ƒç”¨è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•åº”å¯¹å¼ƒç”¨">å¦‚ä½•åº”å¯¹å¼ƒç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0125-require-node-stream-wrap">DEP0125: require(&#39;node:_stream_wrap&#39;)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0126-timers-active">DEP0126: timers.active()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0127-timers-unrefactive">DEP0127: timers._unrefActive()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0128-modules-with-an-invalid-main-entry-and-an-index-js-file">DEP0128: modules with an invalid main entry and an index.js file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-æœ‰æ•ˆçš„-main-å…¥å£">ä¾‹å­ 1ï¼šæœ‰æ•ˆçš„ main å…¥å£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-æ— æ•ˆçš„-main-å…¥å£-å­˜åœ¨-index-js">ä¾‹å­ 2ï¼šæ— æ•ˆçš„ main å…¥å£ï¼Œå­˜åœ¨ index.js</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-3-æœªæ¥çš„è¡Œä¸º">ä¾‹å­ 3ï¼šæœªæ¥çš„è¡Œä¸º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0129-childprocess-channel">DEP0129: ChildProcess._channel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0130-module-createrequirefrompath">DEP0130: Module.createRequireFromPath()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0131-legacy-http-parser">DEP0131: Legacy HTTP parser</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0132-worker-terminate-with-callback">DEP0132: worker.terminate() with callback</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0133-http-connection">DEP0133: http connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0134-process-tickcallback">DEP0134: process._tickCallback</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0135-writestream-open-and-readstream-open-are-internal">DEP0135: WriteStream.open() and ReadStream.open() are internal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0136-http-finished">DEP0136: http finished</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0137-closing-fs-filehandle-on-garbage-collection">DEP0137: Closing fs.FileHandle on garbage collection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0138-process-mainmodule">DEP0138: process.mainModule</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿æ¢æ–¹æ¡ˆ">æ›¿æ¢æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0139-process-umask-with-no-arguments">DEP0139: process.umask() with no arguments</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#umask-ç®€ä»‹">Umask ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-umask-åœ¨-node-js-ä¸­">process.umask() åœ¨ Node.js ä¸­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0139-å¼ƒç”¨æ— å‚æ•°çš„-process-umask">DEP0139: å¼ƒç”¨æ— å‚æ•°çš„ process.umask()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1">å®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0140-use-request-destroy-instead-of-request-abort">DEP0140: Use request.destroy() instead of request.abort()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0141-repl-inputstream-and-repl-outputstream">DEP0141: repl.inputStream and repl.outputStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0142-repl-builtinlibs">DEP0142: repl._builtinLibs</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0143-transform-transformstate">DEP0143: Transform._transformState</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0144-module-parent">DEP0144: module.parent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-module-parent">ä»€ä¹ˆæ˜¯ module.parentï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸¾ä¸ªä¾‹å­-2">ä¸¾ä¸ªä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-v21-7-1-ä¸­çš„-dep0144">Node.js v21.7.1 ä¸­çš„ DEP0144</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£-module-parent-çš„æ–¹æ³•">æ›¿ä»£ module.parent çš„æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0145-socket-buffersize">DEP0145: socket.bufferSize</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0146-new-crypto-certificate">DEP0146: new crypto.Certificate()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0147-fs-rmdir-path-recursive-true">DEP0147: fs.rmdir(path, { recursive: true })</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0148-folder-mappings-in-exports-trailing">DEP0148: Folder mappings in &quot;exports&quot; (trailing &quot;/&quot;)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0149-http-incomingmessage-connection">DEP0149: http.IncomingMessage#connection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0150-changing-the-value-of-process-config">DEP0150: Changing the value of process.config</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0151-main-index-lookup-and-extension-searching">DEP0151: Main index lookup and extension searching</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0152-extension-performanceentry-properties">DEP0152: Extension PerformanceEntry properties</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0153-dns-lookup-and-dnspromises-lookup-options-type-coercion">DEP0153: dns.lookup and dnsPromises.lookup options type coercion</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ—§çš„è¡Œä¸º-åœ¨-node-js-v21-7-1-ä¹‹å‰-ç°åœ¨ä¸æ¨è">æ—§çš„è¡Œä¸ºï¼ˆåœ¨ Node.js v21.7.1 ä¹‹å‰ï¼Œç°åœ¨ä¸æ¨èï¼‰:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ–°çš„æ¨èè¡Œä¸º-node-js-v21-7-1-åŠä»¥å">æ–°çš„æ¨èè¡Œä¸ºï¼ˆNode.js v21.7.1 åŠä»¥åï¼‰:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0154-rsa-pss-generate-key-pair-options">DEP0154: RSA-PSS generate key pair options</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0155-trailing-slashes-in-pattern-specifier-resolutions">DEP0155: Trailing slashes in pattern specifier resolutions</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-require-ä½¿ç”¨å°¾éšæ–œæ ">ä¾‹å­ 1: require ä½¿ç”¨å°¾éšæ–œæ </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-import-ä½¿ç”¨å°¾éšæ–œæ ">ä¾‹å­ 2: import ä½¿ç”¨å°¾éšæ–œæ </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0156-aborted-property-and-abort-aborted-event-in-http">DEP0156: .aborted property and &#39;abort&#39;, &#39;aborted&#39; event in http</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0157-thenable-support-in-streams">DEP0157: Thenable support in streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0157-thenable-æ”¯æŒåœ¨æµä¸­çš„å¼ƒç”¨">DEP0157: Thenable æ”¯æŒåœ¨æµä¸­çš„å¼ƒç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0158-buffer-slice-start-end">DEP0158: buffer.slice(start, end)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0159-err-invalid-callback">DEP0159: ERR_INVALID_CALLBACK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0160-process-on-multipleresolves-handler">DEP0160: process.on(&#39;multipleResolves&#39;, handler)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0161-process-getactiverequests-and-process-getactivehandles">DEP0161: process._getActiveRequests() and process._getActiveHandles()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0162-fs-write-fs-writefilesync-coercion-to-string">DEP0162: fs.write(), fs.writeFileSync() coercion to string</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0163-channel-subscribe-onmessage-channel-unsubscribe-onmessage">DEP0163: channel.subscribe(onMessage), channel.unsubscribe(onMessage)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0164-process-exit-code-process-exitcode-coercion-to-integer">DEP0164: process.exit(code), process.exitCode coercion to integer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0165-trace-atomics-wait">DEP0165: --trace-atomics-wait</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0166-double-slashes-in-imports-and-exports-targets">DEP0166: Double slashes in imports and exports targets</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0167-weak-diffiehellmangroup-instances-modp1-modp2-modp5">DEP0167: Weak DiffieHellmanGroup instances (modp1, modp2, modp5)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#èƒŒæ™¯-diffie-hellman-å¯†é’¥äº¤æ¢">èƒŒæ™¯ï¼šDiffie-Hellman å¯†é’¥äº¤æ¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#weak-diffiehellmangroup-instances">Weak DiffieHellmanGroup instances</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-dep0167">Node.js ä¸­çš„ DEP0167</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0168-unhandled-exception-in-node-api-callbacks">DEP0168: Unhandled exception in Node-API callbacks</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0169-insecure-url-parse">DEP0169: Insecure url.parse()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0170-invalid-port-when-using-url-parse">DEP0170: Invalid port when using url.parse()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0171-setters-for-http-incomingmessage-headers-and-trailers">DEP0171: Setters for http.IncomingMessage headers and trailers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0172-the-asyncresource-property-of-asyncresource-bound-functions">DEP0172: The asyncResource property of AsyncResource bound functions</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¼‚æ­¥ç¼–ç¨‹å’Œå¼‚æ­¥é’©å­">å¼‚æ­¥ç¼–ç¨‹å’Œå¼‚æ­¥é’©å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#asyncresource-ç±»">AsyncResource ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0172-è­¦å‘Š">DEP0172 è­¦å‘Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0173-the-assert-calltracker-class">DEP0173: the assert.CallTracker class</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-calltracker-çš„ä¾‹å­">ä½¿ç”¨ CallTracker çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£æ–¹æ¡ˆ-4">æ›¿ä»£æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0174-calling-promisify-on-a-function-that-returns-a-promise">DEP0174: calling promisify on a function that returns a Promise</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0175-util-tousvstring">DEP0175: util.toUSVString</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0176-fs-f-ok-fs-r-ok-fs-w-ok-fs-x-ok">DEP0176: fs.F_OK, fs.R_OK, fs.W_OK, fs.X_OK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0177-util-types-iswebassemblycompiledmodule">DEP0177: util.types.isWebAssemblyCompiledModule</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-util-types-iswebassemblycompiledmodule">ä»€ä¹ˆæ˜¯ util.types.isWebAssemblyCompiledModule?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¼ƒç”¨åŸå› ">å¼ƒç”¨åŸå› </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•åº”å¯¹å¼ƒç”¨-1">å¦‚ä½•åº”å¯¹å¼ƒç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0178-dirent-path">DEP0178: dirent.path</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-dirent-path">ä»€ä¹ˆæ˜¯ dirent.path</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆ-dirent-path-è¢«åºŸå¼ƒäº†">ä¸ºä»€ä¹ˆ dirent.path è¢«åºŸå¼ƒäº†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›¿ä»£æ–¹æ³•">æ›¿ä»£æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dep0179-hash-constructor">DEP0179: Hash constructor</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="deprecated-apis" tabindex="-1"><a class="header-anchor" href="#deprecated-apis"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#deprecated-apis" target="_blank" rel="noopener noreferrer">Deprecated APIs</a></span></a></h1><p>å½“æˆ‘ä»¬åœ¨è°ˆè®ºè½¯ä»¶ä¸­çš„&quot;å¼ƒç”¨ï¼ˆDeprecatedï¼‰APIs&quot;æ—¶ï¼Œæ„å‘³ç€å¼€å‘è€…ä»¬å†³å®šä¸å†æ¨èä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤å®ƒä»¬ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¿™äº› APIs å­˜åœ¨ç¼ºé™·ã€å®‰å…¨é—®é¢˜ï¼Œæˆ–è€…æœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>Node.js ä½œä¸ºä¸€ä¸ªæ´»è·ƒè¿›åŒ–çš„å¹³å°ï¼Œç»å¸¸ä¼šæ›´æ–°å…¶ APIã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œå¼ƒç”¨çš„ APIs è¢«æ ‡è®°å‡ºæ¥ï¼Œä»¥ä¾¿å¼€å‘è€…çŸ¥é“å“ªäº›åŠŸèƒ½å°†æ¥å¯èƒ½ä¸å†å¯ç”¨ï¼Œå¹¶ä¸”å¯ä»¥å¼€å§‹è°ƒæ•´ä»–ä»¬çš„ä»£ç æ¥ä½¿ç”¨æ¨èçš„æ›¿ä»£é€‰é¡¹ã€‚</p><p>è¯¦ç»†è§£é‡Šä¸€ä¸‹å¼ƒç”¨çš„è¿‡ç¨‹å’ŒåŸå› ï¼š</p><ol><li><p><strong>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨ APIï¼Ÿ</strong></p><ul><li><strong>å®‰å…¨æ€§ï¼š</strong> å¦‚æœ API å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œæ¯”å¦‚å®¹æ˜“å¯¼è‡´ç¨‹åºé­å—æ”»å‡»ã€‚</li><li><strong>æ€§èƒ½ï¼š</strong> å¦‚æœ API çš„æ€§èƒ½ä¸ä½³ï¼Œå¯èƒ½ä¼šæœ‰æ›´é«˜æ•ˆçš„æ–¹æ³•å¯ä»¥æ›¿ä»£ã€‚</li><li><strong>ç®€åŒ–ï¼š</strong> ä¸ºäº†å‡å°‘ Node.js æ ¸å¿ƒåº“çš„å¤æ‚æ€§ï¼Œå»æ‰é‚£äº›å¾ˆå°‘ä½¿ç”¨çš„ APIsã€‚</li><li><strong>æ ‡å‡†åŒ–ï¼š</strong> æœ‰æ—¶å€™ï¼Œéœ€è¦å¼ƒç”¨æ—§ APIs ä»¥ç¬¦åˆæ–°çš„æ ‡å‡†æˆ–æœ€ä½³å®è·µã€‚</li></ul></li><li><p><strong>å¼ƒç”¨çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p><ul><li><strong>æ–‡æ¡£æ ‡è®°ï¼š</strong> é¦–å…ˆï¼Œåœ¨ API çš„å®˜æ–¹æ–‡æ¡£ä¸­ä¼šæ ‡æ˜è¯¥ API å·²è¢«å¼ƒç”¨ã€‚</li><li><strong>è¿è¡Œæ—¶è­¦å‘Šï¼š</strong> å½“ä½¿ç”¨å¼ƒç”¨çš„ API æ—¶ï¼ŒNode.js å¯èƒ½ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Šä¿¡æ¯ã€‚</li><li><strong>ç§»é™¤ï¼š</strong> ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œè¯¥ API å¯èƒ½ä¼šåœ¨æ–°ç‰ˆæœ¬çš„ Node.js ä¸­è¢«å®Œå…¨ç§»é™¤ã€‚</li></ul></li><li><p><strong>å®é™…ä¾‹å­</strong><br> å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•°<code>foo()</code>å·²ç»è¢«å¼ƒç”¨äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºæœ‰äº†ä¸€ä¸ªæ–°çš„ã€æ›´å¥½çš„å‡½æ•°<code>bar()</code>æ¥æ›¿ä»£å®ƒã€‚è¿™é‡Œæ˜¯åœ¨ Node.js ä¸­å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ä¸ªè™šæ„ä¾‹å­ï¼š</p><ul><li><p><strong>è€çš„æ–¹å¼ï¼ˆå·²å¼ƒç”¨ï¼‰</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å¯èƒ½ä¼šåœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸ªè­¦å‘Šï¼Œæ¯”å¦‚ï¼š&quot;Warning: foo() is deprecated and will be removed in future versions of Node.js. Use bar() instead.&quot;</p></li><li><p><strong>æ–°çš„æ¨èæ–¹å¼</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> bar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½¿ç”¨<code>bar()</code>å‡½æ•°å°±ä¸ä¼šæœ‰ä»»ä½•è­¦å‘Šï¼Œå› ä¸ºè¿™æ˜¯ç°åœ¨æ¨èçš„æ–¹å¼ã€‚</p></li></ul></li></ol><p>è¯·æ³¨æ„ï¼Œå¼ƒç”¨å¹¶ä¸æ„å‘³ç€åŠŸèƒ½ç«‹å³æ¶ˆå¤±ï¼Œä½†æ˜¯ä½œä¸ºå¼€å‘è€…ï¼Œä½ åº”è¯¥å°½å¿«å¼€å§‹è¿ç§»åˆ°æ¨èçš„ APIï¼Œä»¥ç¡®ä¿å½“ä½ çš„ Node.js ç¯å¢ƒæ›´æ–°åˆ°æ›´é«˜ç‰ˆæœ¬æ—¶ï¼Œä½ çš„ä»£ç ä»ç„¶èƒ½æ­£å¸¸å·¥ä½œã€‚</p><p>å¯¹äº Node.js v21.7.1 ç‰¹å®šçš„å¼ƒç”¨ API åˆ—è¡¨ï¼Œä½ éœ€è¦æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£æ‰€æä¾›çš„æœ€æ–°ä¿¡æ¯ï¼Œå› ä¸ºå…·ä½“çš„å¼ƒç”¨ APIs ä¼šæ ¹æ®æ¯ä¸ªç‰ˆæœ¬è€Œå˜åŒ–ã€‚é€šå¸¸ï¼Œè¿™äº›ä¿¡æ¯ä¼šåŒ…å«å¼ƒç”¨çš„ API åç§°ã€å¼ƒç”¨çš„ç†ç”±ï¼Œä»¥åŠæ¨èçš„æ›¿æ¢ API æˆ–æ›¿æ¢åšæ³•ã€‚</p><h2 id="revoking-deprecations" tabindex="-1"><a class="header-anchor" href="#revoking-deprecations"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#revoking-deprecations" target="_blank" rel="noopener noreferrer">Revoking deprecations</a></span></a></h2><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ&quot;å¼ƒç”¨ï¼ˆDeprecationï¼‰&quot;æ˜¯æŒ‡å¼€å‘è€…å†³å®šåœæ­¢æ”¯æŒæŸä¸ªåŠŸèƒ½æˆ–ç‰¹æ€§çš„è¿‡ç¨‹ï¼Œé€šå¸¸å› ä¸ºå­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ã€‚åœ¨ Node.js ä¸­ï¼Œå¼ƒç”¨åŒæ ·æ˜¯å¸¸è§çš„åšæ³•ï¼Œå®ƒæé†’ç”¨æˆ·æŸäº› API æˆ–åŠŸèƒ½å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤æˆ–æ”¹å˜ï¼Œä»è€Œç»™ç”¨æˆ·è¶³å¤Ÿçš„æ—¶é—´è¿›è¡Œä»£ç å‡çº§æˆ–é‡æ„ã€‚</p><p>&quot;æ’¤é”€å¼ƒç”¨ï¼ˆRevoking deprecationsï¼‰&quot;åˆ™æ˜¯ç›¸å¯¹è¾ƒå°‘å‡ºç°çš„æƒ…å†µï¼Œè¿™æ„å‘³ç€ä¹‹å‰æ ‡è®°ä¸ºå¼ƒç”¨çš„åŠŸèƒ½æˆ– API è¢«é‡æ–°è®¤ä¸ºæ˜¯å¯ç”¨çš„ï¼Œä¸å†å»ºè®®ç”¨æˆ·è¿ç§»åˆ°å…¶ä»–æ›¿ä»£å“ã€‚è¿™å¯èƒ½æ˜¯ç”±äºç¤¾åŒºåé¦ˆã€å®é™…éœ€æ±‚ï¼Œæˆ–æ˜¯å¼€å‘å›¢é˜Ÿé‡è¯„å…¶å†³ç­–åå¾—å‡ºçš„ç»“è®ºã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­å…³äºæ’¤é”€å¼ƒç”¨çš„å†…å®¹ï¼Œä¸»è¦æ˜¯æŒ‡ Node.js é¡¹ç›®ç»´æŠ¤å›¢é˜Ÿå¯ä»¥å†³å®šä¹‹å‰å†³å®šåºŸå¼ƒçš„ API æˆ–åŠŸèƒ½ç›´æ¥æ¢å¤ä¸ºéåºŸå¼ƒçŠ¶æ€ï¼Œå¹¶ä¸”åœ¨åç»­ç‰ˆæœ¬ä¸­ç»§ç»­æä¾›æ”¯æŒã€‚è¿™é€šå¸¸ä¼šåœ¨ Node.js çš„æ–‡æ¡£ä¸­æ˜¾è‘—æ ‡è¯†å‡ºæ¥ï¼Œä»¥ç¡®ä¿å¼€å‘è€…çŸ¥æ™“è¿™ä¸€å˜æ›´ã€‚</p><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå¯èƒ½æ¶‰åŠåˆ°â€œæ’¤é”€å¼ƒç”¨â€æ“ä½œçš„å®è·µä¾‹å­ï¼š</p><ol><li><p><strong>å†…ç½®æ¨¡å—æ–¹æ³•</strong>: å‡è®¾ Node.js åœ¨æŸä¸ªç‰ˆæœ¬ä¸­æ ‡è®°äº†å†…ç½®<code>fs</code>æ¨¡å—çš„<code>fs.exists()</code>æ–¹æ³•ä¸ºä¸æ¨èä½¿ç”¨ï¼ˆdeprecatedï¼‰ï¼Œå¹¶æ¨èä½¿ç”¨<code>fs.stat()</code>æˆ–<code>fs.access()</code>ä½œä¸ºæ›¿ä»£ã€‚ç„¶è€Œï¼Œåœ¨æ”¶é›†åˆ°å¤§é‡ç”¨æˆ·åé¦ˆåï¼Œç»´æŠ¤å›¢é˜Ÿå¯èƒ½å‘ç°<code>fs.exists()</code>åœ¨æŸäº›åœºæ™¯ä¸‹æ›´ç®€å•æ˜“ç”¨ã€‚å› æ­¤ï¼Œåœ¨ v21.7.1 ä¸­ï¼Œä»–ä»¬å¯èƒ½ä¼šå†³å®šæ’¤é”€è¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå…è®¸<code>fs.exists()</code>ç»§ç»­è¢«ä½¿ç”¨ã€‚</p></li><li><p><strong>API è¡Œä¸º</strong>: æœ‰äº›æ—¶å€™ï¼ŒNode.js å¯èƒ½ä¼šè®¡åˆ’æ›´æ”¹ API çš„æŸç§è¡Œä¸ºï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå¼ƒç”¨å‘¨æœŸæ¥è­¦å‘Šç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª API å‡½æ•°åœ¨æœªæ¥è®¡åˆ’æ”¹å˜å…¶è¿”å›å€¼ç±»å‹ï¼ŒNode.js å›¢é˜Ÿå¯èƒ½ä¼šå…ˆæ ‡è®°è¿™ä¸ªè®¡åˆ’ä½œä¸º deprecatedã€‚ä½†æ˜¯ï¼Œå¦‚æœåæ¥å‘ç°è¿™ä¸ªæ”¹å˜ä¼šå¯¼è‡´å¹¿æ³›çš„ç ´åæ€§é—®é¢˜ï¼Œç»´æŠ¤äººå‘˜å¯èƒ½ä¼šé€‰æ‹©æ’¤é”€è¿™ä¸ªå¼ƒç”¨è®¡åˆ’ï¼Œå¹¶ä¿æŒ API çš„ç°æœ‰è¡Œä¸ºã€‚</p></li><li><p><strong>å…¨å±€å˜é‡</strong>: Node.js å¯èƒ½ä¼šå¼ƒç”¨æŸäº›å…¨å±€å˜é‡ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¸æœªæ¥æ–°å¼•å…¥çš„åŠŸèƒ½äº§ç”Ÿå†²çªæˆ–æ··æ·†ã€‚å¦‚æœåç»­æ‰¾åˆ°äº†æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ¥é¿å…è¿™äº›é—®é¢˜ï¼Œé‚£ä¹ˆåŸæœ¬å¼ƒç”¨çš„å…¨å±€å˜é‡å¯èƒ½ä¼šè¢«æ’¤é”€å¼ƒç”¨ã€‚</p></li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€å˜åŒ–çš„è¿‡ç¨‹ã€‚å³ä½¿æŸä¸ªåŠŸèƒ½åœ¨ v21.7.1 ä¸­è¢«æ’¤é”€å¼ƒç”¨ï¼Œä¹Ÿä¸ä»£è¡¨å®ƒåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ°¸ä¹…å®‰å…¨ã€‚å¼€å‘è€…åº”å½“å¯†åˆ‡å…³æ³¨ Node.js çš„æ›´æ–°æ—¥å¿—å’Œç›¸å…³æ–‡æ¡£ä»¥é€‚åº”å¯èƒ½çš„å˜åŒ–ã€‚</p><h2 id="list-of-deprecated-apis" tabindex="-1"><a class="header-anchor" href="#list-of-deprecated-apis"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#list-of-deprecated-apis" target="_blank" rel="noopener noreferrer">List of deprecated APIs</a></span></a></h2><p>å¥½çš„ï¼Œé¦–å…ˆéœ€è¦ç†è§£ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„&quot;deprecated API&quot;ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œâ€œdeprecatedâ€æ„å‘³ç€æŸä¸ªç‰¹æ€§æˆ–è€…æ¥å£åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”æœ€ç»ˆå¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºå­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…åŸæœ‰çš„å®ç°ä¸å†å®‰å…¨æˆ–æœ‰æ•ˆã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚åœ¨æ¯ä¸ªç‰ˆæœ¬ä¸­ï¼ŒNode.js å¼€å‘å›¢é˜Ÿå¯èƒ½ä¼šæ ‡è®°æŸäº› API ä¸ºå¼ƒç”¨ï¼ˆdeprecatedï¼‰ï¼Œä»¥å‘ŠçŸ¥å¼€å‘è€…ä»¬åº”è¯¥é€æ¸æ”¾å¼ƒä½¿ç”¨è¿™äº› APIï¼Œå¹¶åœ¨æ–°é¡¹ç›®ä¸­é‡‡ç”¨æ¨èçš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­çš„å·²å¼ƒç”¨ API åˆ—è¡¨åŒ…å«äº†æ‰€æœ‰è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„åŠŸèƒ½å’Œæ¨¡å—ã€‚ä¸‹é¢æˆ‘ä¼šä»¥ä¸€äº›å‡æƒ³çš„ä¾‹å­æ¥è§£é‡Šä¸€äº›å¯èƒ½å‡ºç°åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œçš„ APIï¼š</p><ol><li><p><code>util.puts()</code></p><ul><li>æè¿°ï¼š<code>util.puts()</code> ç”¨äºæ‰“å°ä¿¡æ¯åˆ°æ§åˆ¶å°ï¼Œç±»ä¼¼äº <code>console.log()</code>ã€‚</li><li>å¼ƒç”¨åŸå› ï¼šè¿™ä¸ªå‡½æ•°ä¸ <code>console.log()</code> åŠŸèƒ½é‡å¤ï¼Œè€Œä¸” <code>console.log()</code> ç”¨æ³•æ›´å¹¿æ³›ï¼Œæ‰€ä»¥ <code>util.puts()</code> è¢«å¼ƒç”¨ã€‚</li><li>æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ <code>console.log()</code> æ¥ä»£æ›¿ <code>util.puts()</code> è¿›è¡Œæ—¥å¿—è¾“å‡ºã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿‡æ—¶çš„æ–¹å¼:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">puts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸æ¨èä½¿ç”¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„æ–¹å¼:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>fs.existsSync()</code></p><ul><li>æè¿°ï¼š<code>fs.existsSync()</code> ç”¨æ¥åŒæ­¥æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªæ–‡ä»¶ã€‚</li><li>å¼ƒç”¨åŸå› ï¼šåŒæ­¥æ“ä½œä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚Node.js æ¨èä½¿ç”¨å¼‚æ­¥çš„ APIã€‚</li><li>æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ <code>fs.stat()</code> æˆ– <code>fs.access()</code> é…åˆå¼‚æ­¥æ¨¡å¼æˆ– Promise æ¥æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿‡æ—¶çš„æ–¹å¼:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">existsSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸æ¨èä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ–‡ä»¶å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„æ–¹å¼:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">access</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">constants</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">F_OK</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ–‡ä»¶å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>domain</code> æ¨¡å—</p><ul><li>æè¿°ï¼š<code>domain</code> æ¨¡å—æ˜¯ç”¨äºç®€åŒ–å¼‚æ­¥ä»£ç é”™è¯¯å¤„ç†çš„ã€‚</li><li>å¼ƒç”¨åŸå› ï¼šç”±äºå…¶ä¸ç¨³å®šçš„è®¾è®¡ï¼ŒåŠ ä¸Šæ–°çš„å¼‚æ­¥ç®¡ç†ç‰¹æ€§ï¼ˆå¦‚ <code>async/await</code>ï¼‰çš„å¼•å…¥ï¼ŒNode.js è®¤ä¸º <code>domain</code> æ¨¡å—ä¸å†æ˜¯æœ€ä½³é€‰æ‹©ã€‚</li><li>æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ç°ä»£çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œæ¯”å¦‚ <code>async/await</code> å’Œ <code>Promise</code> ç»“æ„æ¥ç®¡ç†å¼‚æ­¥æ“ä½œã€‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿‡æ—¶çš„æ–¹å¼:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> d</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•è·åˆ°é”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¼‚æ­¥æ“ä½œ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„æ–¹å¼:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> asyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¼‚æ­¥æ“ä½œ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> someAsyncFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•è·åˆ°é”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">asyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¯·æ³¨æ„ï¼Œè¿™äº›ç¤ºä¾‹å¯èƒ½å¹¶ä¸ç›´æ¥å¯¹åº”äº Node.js v21.7.1 ç‰ˆæœ¬çš„å®é™…å¼ƒç”¨æƒ…å†µï¼Œå› ä¸ºæˆ‘æ²¡æœ‰æä¾›å…·ä½“çš„å¼ƒç”¨åˆ—è¡¨ã€‚ä½†æ˜¯ï¼ŒåŸºæœ¬æ¦‚å¿µå’Œæ›¿ä»£æ–¹æ³•ä»ç„¶é€‚ç”¨ã€‚å¼ƒç”¨çš„ API å’Œæ›¿ä»£æ–¹æ¡ˆéƒ½å¯ä»¥åœ¨ Node.js å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°å…·ä½“çš„æè¿°å’Œå»ºè®®ã€‚å½“ä½ é‡åˆ°å…·ä½“çš„å¼ƒç”¨ API æ—¶ï¼Œåº”è¯¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œä»¥è·å–æœ€å‡†ç¡®å’Œæœ€æ–°çš„ä¿¡æ¯ã€‚</p><h3 id="dep0001-http-outgoingmessage-prototype-flush" tabindex="-1"><a class="header-anchor" href="#dep0001-http-outgoingmessage-prototype-flush"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0001" target="_blank" rel="noopener noreferrer">DEP0001: http.OutgoingMessage.prototype.flush</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¦‚å¿µå«åšâ€œå¼ƒç”¨â€ï¼ˆDeprecationï¼‰ã€‚å½“ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½æˆ–è€… API ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æ—¶ï¼Œå®ƒå°±è¢«æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€ã€‚</p><p><code>http.OutgoingMessage.prototype.flush</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå…·ä½“ä¾‹å­ã€‚è¿™ä¸ªæ–¹æ³•æ›¾ç»æ˜¯<code>http</code>æ¨¡å—æä¾›çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒç”¨äºåˆ·æ–°ä¸€ä¸ªæ­£åœ¨å†™å…¥çš„æ¶ˆæ¯ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ æ­£åœ¨å‘é€ä¸€ä¸ª HTTP å“åº”ï¼Œè€Œä¸”æƒ³è¦ç¡®ä¿å·²ç»å†™å…¥çš„æ‰€æœ‰æ•°æ®éƒ½è¢«ç«‹åˆ»å‘é€ç»™å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥è°ƒç”¨<code>flush</code>æ–¹æ³•ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>flush</code>è¿™ä¸ªæ–¹æ³•è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDEP0001ï¼‰ã€‚è¿™æ„å‘³ç€å¼€å‘è€…ä¸å†æ¨èä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œå®ƒå¯èƒ½ä¼šå®Œå…¨è¢«ç§»é™¤ã€‚</p><h3 id="ä¸¾ä¸ªä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¸ªä¾‹å­"><span>ä¸¾ä¸ªä¾‹å­ï¼š</span></a></h3><h4 id="åœ¨å¼ƒç”¨ä¹‹å‰çš„ä»£ç " tabindex="-1"><a class="header-anchor" href="#åœ¨å¼ƒç”¨ä¹‹å‰çš„ä»£ç "><span>åœ¨å¼ƒç”¨ä¹‹å‰çš„ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">flush</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ä¸ªæ–¹æ³•ç°åœ¨è¢«å¼ƒç”¨äº†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æ­¤æœåŠ¡å™¨æ—¶ï¼Œå®ƒä¼šå‘ç”¨æˆ·å‘é€&quot;Hello, world!&quot;å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å‘é€å®Œæ¯•ååˆ·æ–°è¾“å‡ºæµã€‚</p><h4 id="å¼ƒç”¨ä¹‹åçš„æ­£ç¡®åšæ³•" tabindex="-1"><a class="header-anchor" href="#å¼ƒç”¨ä¹‹åçš„æ­£ç¡®åšæ³•"><span>å¼ƒç”¨ä¹‹åçš„æ­£ç¡®åšæ³•ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ flush()ï¼Œå› ä¸º end() ä¼šè‡ªåŠ¨å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œä½ ä¸åº”è¯¥å†ä½¿ç”¨<code>flush</code>æ–¹æ³•äº†ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿä¸éœ€è¦æ‰‹åŠ¨åˆ·æ–°ï¼Œå› ä¸º Node.js ä¼šåœ¨é€‚å½“çš„æ—¶å€™è‡ªåŠ¨å®Œæˆè¿™ä¸ªå·¥ä½œã€‚å½“ä½ è°ƒç”¨<code>res.end()</code>ç»“æŸå“åº”æ—¶ï¼Œå¦‚æœè¿˜æœ‰ä»»ä½•ç¼“å­˜åœ¨å†…å­˜é‡Œçš„æ•°æ®ï¼ŒNode.js ä¼šè‡ªåŠ¨å°†å…¶å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</p><p>è®°ä½ï¼Œå½“ä½ çœ‹åˆ° Node.js æ–‡æ¡£æˆ–å…¶ä»–èµ„æºä¸­æåˆ°æŸä¸ª API è¢«å¼ƒç”¨æ—¶ï¼Œæœ€å¥½æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ä»¥äº†è§£åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…æ€æ ·æ›´æ–°ä½ çš„ä»£ç ä»¥æ¶ˆé™¤å¯¹å¼ƒç”¨ API çš„ä¾èµ–ã€‚</p><h3 id="dep0002-require-linklist" tabindex="-1"><a class="header-anchor" href="#dep0002-require-linklist"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0002" target="_blank" rel="noopener noreferrer">DEP0002: require(&#39;_linklist&#39;)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯è½¯ä»¶ã€‚åœ¨ Node.js çš„å‘å±•è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›åŠŸèƒ½ä¼šè¢«åºŸå¼ƒï¼ˆä¹Ÿå°±æ˜¯ä¸å†æ¨èä½¿ç”¨ï¼‰ï¼Œé€šå¸¸å› ä¸ºå®ƒä»¬æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆæˆ–è€…è®¾è®¡ä¸Šå­˜åœ¨ç¼ºé™·ã€‚</p><p><code>DEP0002: require(&#39;_linklist&#39;)</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªå…·ä½“çš„åºŸå¼ƒè­¦å‘Šã€‚è¿™ä¸ªè­¦å‘Šå‘Šè¯‰æˆ‘ä»¬ <code>_linklist</code> æ¨¡å—ä¸åº”è¯¥è¢«ç›´æ¥åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†ã€‚</p><p><code>_linklist</code> æ˜¯ Node.js å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºå®ç°é“¾è¡¨ç»“æ„ã€‚é“¾è¡¨æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼šèŠ‚ç‚¹å€¼å’ŒæŒ‡å‘åˆ—è¡¨ä¸­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚é“¾è¡¨ç‰¹åˆ«é€‚åˆäºé‚£äº›éœ€è¦é¢‘ç¹æ’å…¥å’Œåˆ é™¤æ“ä½œçš„åœºæ™¯ã€‚</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>_linklist</code> æ›¾ç»è¢«æš´éœ²ç»™å¼€å‘è€…ä½¿ç”¨ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå…¬å…±çš„ APIï¼Œè€Œæ˜¯å†…éƒ¨æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒNode.js å›¢é˜Ÿå†³å®šä¸å†å¯¹å¤–æä¾›è¿™ä¸ªæ¨¡å—ï¼Œå› ä¸ºï¼š</p><ol><li>å®ƒæ˜¯å†…éƒ¨å®ç°ç»†èŠ‚ã€‚</li><li>æœ‰æ›´å¥½ä¸”ç¨³å®šçš„æ›¿ä»£æ–¹æ³•ï¼Œæ¯”å¦‚ä½¿ç”¨ JavaScript çš„æ•°ç»„æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ï¼Œæˆ–æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åº“ã€‚</li><li>ç›´æ¥ä½¿ç”¨å†…éƒ¨æ¨¡å—å¯èƒ½å¯¼è‡´ä¸ Node.js æ›´æ–°ä¸å…¼å®¹çš„é—®é¢˜ã€‚</li></ol><p>å½“ä½ çœ‹åˆ° <code>DEP0002</code> è¿™ä¸ªè­¦å‘Šæ—¶ï¼Œæ„å‘³ç€ä½ çš„ä»£ç ä¸­å¦‚æœè¿˜åœ¨ä½¿ç”¨ <code>require(&#39;_linklist&#39;)</code> æ¥å¼•å…¥è¿™ä¸ªæ¨¡å—ï¼Œå°†æ¥å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºå¯èƒ½æŸæ¬¡æ›´æ–°å <code>_linklist</code> å°±è¢«å½»åº•ç§»é™¤äº†ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p><p>å‡è®¾åœ¨è¾ƒè€çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨ <code>_linklist</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> L</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;_linklist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> L</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LinkedList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">L</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;first&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">L</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;second&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// éå†é“¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">L</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº <code>_linklist</code> å·²ç»è¢«åºŸå¼ƒï¼Œç°åœ¨ä½ åº”è¯¥é¿å…è¿™æ ·çš„ä»£ç ï¼Œè€Œæ˜¯ä½¿ç”¨å…¶ä»–çš„æ–¹å¼ï¼Œæ¯”å¦‚ç®€å•åœ°ä½¿ç”¨æ•°ç»„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;first&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;second&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// éå†æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ï¼Œå¦‚æœä½ ç¡®å®éœ€è¦é“¾è¡¨çš„æ€§èƒ½å’Œç‰¹æ€§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚ <code>yallist</code>ã€‚</p><p>å®‰è£… <code>yallist</code>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yallist</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>yallist</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Yallist</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;yallist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Yallist</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;first&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;second&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// éå†é“¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å°±æ˜¯å…³äº <code>DEP0002: require(&#39;_linklist&#39;)</code> çš„è§£é‡Šå’Œå¦‚ä½•å¤„ç†å®ƒçš„å»ºè®®ã€‚è®°ä½ï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œè€æ—§çš„æ–¹æ³•æ€»ä¼šè¢«æ–°çš„ã€æ›´å¥½çš„æ–¹æ³•æ‰€å–ä»£ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œé‡è¦çš„æ˜¯è·Ÿä¸Šè¿™äº›å˜åŒ–ï¼Œå¹¶å­¦ä¹ å¦‚ä½•è¿ç”¨æ–°çš„å·¥å…·å’Œåº“æ¥æ”¹å–„ä½ çš„ä»£ç ã€‚</p><h3 id="dep0003-writablestate-buffer" tabindex="-1"><a class="header-anchor" href="#dep0003-writablestate-buffer"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0003" target="_blank" rel="noopener noreferrer">DEP0003: _writableState.buffer</a></span></a></h3><p>å¥½çš„ï¼ŒNode.js æ˜¯ä¸€ä¸ªå¼€æºä¸”è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¦‚å¿µå«åšâ€œåºŸå¼ƒâ€ï¼Œä¹Ÿå°±æ˜¯è¯´æŸäº›åŠŸèƒ½æˆ–è€… API å¯èƒ½å› ä¸ºç§ç§åŸå› ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚</p><p>DEP0003 æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå…·ä½“çš„åºŸå¼ƒè­¦å‘Šç¼–å·ã€‚å½“æˆ‘ä»¬è°ˆè®º<code>_writableState.buffer</code>æ—¶ï¼Œæˆ‘ä»¬æ­£åœ¨è°ˆè®ºæµï¼ˆStreamsï¼‰æ¨¡å—ä¸­ Writable æµçš„å†…éƒ¨çŠ¶æ€å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚Writable æµæ˜¯ä¸€ç§ç”¨äºå†™å…¥æ•°æ®çš„æŠ½è±¡æ¥å£ï¼Œæ¯”å¦‚å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€å‘ç½‘ç»œå‘é€æ•°æ®ç­‰ã€‚</p><p>åœ¨è¿‡å»çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œ<code>_writableState</code>æ˜¯ Writable æµçš„å†…éƒ¨çŠ¶æ€ç®¡ç†å¯¹è±¡ï¼Œè€Œ<code>_writableState.buffer</code>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰å¾…å†™å…¥çš„æ•°æ®å—ã€‚ç„¶è€Œï¼Œè¿™ä¸ªå±æ€§æ˜¯ç§æœ‰çš„ï¼Œæ„å‘³ç€å®ƒæœ¬ä¸åº”è¯¥è¢«å¼€å‘è€…ç›´æ¥è®¿é—®å’Œä½¿ç”¨ã€‚</p><p>ä» v21.7.1 å¼€å§‹ï¼Œ<code>_writableState.buffer</code>å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒäº†ï¼ˆå³ DEP0003ï¼‰ã€‚è¿™æ„å‘³ç€ä½ ä¸åº”è¯¥åœ¨ä½ çš„ä»£ç ä¸­ç›´æ¥è®¿é—®è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºå®ƒæœ‰å¯èƒ½åœ¨æœªæ¥ç‰ˆæœ¬ä¸­è¢«ä¿®æ”¹æˆ–å®Œå…¨åˆ é™¤ï¼Œè¿™ä¼šå¯¼è‡´ä½ çš„ä»£ç å‡ºç°é—®é¢˜ã€‚</p><p><strong>å®é™…è¿ç”¨çš„ä¾‹å­</strong></p><p>å‡è®¾ä½ ä»¥å‰åœ¨å¤„ç†ä¸€ä¸ªæµçš„æ—¶å€™ï¼Œæƒ³è¦æ£€æŸ¥å½“å‰ç¼“å†²åŒºé‡Œè¿˜æœ‰å¤šå°‘æ•°æ®æ²¡è¢«å†™å…¥ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getSomeWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">_writableState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œç”±äº<code>_writableState.buffer</code>æ˜¯ç§æœ‰çš„å¹¶ä¸”å·²è¢«åºŸå¼ƒï¼Œä½ åº”è¯¥é¿å…è¿™æ ·åšã€‚å–è€Œä»£ä¹‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¬å…± API ä¾‹å¦‚<code>stream.writableLength</code>æ¥è·å–å½“å‰ç¼“å†²åŒºçš„å¤§å°ï¼Œè¿™æ˜¯å®˜æ–¹æ¨èçš„æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getSomeWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableLength</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç¼–å†™æ–°ä»£ç æ—¶ï¼Œè¯·å§‹ç»ˆå…³æ³¨ Node.js çš„æ–‡æ¡£å’Œæ›´æ–°æ—¥å¿—ä»¥ç¡®ä¿ä½ ä½¿ç”¨çš„ API æ˜¯æœ€æ–°ä¸”ä¸è¢«åºŸå¼ƒçš„ã€‚å¦‚æœä½ åœ¨ç»´æŠ¤æ—§ä»£ç ï¼Œä¹Ÿè¯·é€æ¸è¿ç§»å’Œæ›´æ–°é‚£äº›è¢«åºŸå¼ƒçš„ APIï¼Œä»¥é˜²æœªæ¥ç‰ˆæœ¬å‡çº§æ—¶å‡ºç°ä¸å…¼å®¹çš„é—®é¢˜ã€‚</p><h3 id="dep0004-cryptostream-prototype-readystate" tabindex="-1"><a class="header-anchor" href="#dep0004-cryptostream-prototype-readystate"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0004" target="_blank" rel="noopener noreferrer">DEP0004: CryptoStream.prototype.readyState</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>DEP0004</code>æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šç¼–ç ã€‚&quot;å¼ƒç”¨&quot;æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–è€… API ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚è¿™æ ·åšé€šå¸¸æ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…åŸæ¥çš„è®¾è®¡å­˜åœ¨é—®é¢˜ã€‚è€Œ<code>DEP0004</code>å¯¹åº”çš„æ˜¯å…³äº<code>CryptoStream.prototype.readyState</code>å±æ€§çš„å¼ƒç”¨ã€‚</p><p><code>CryptoStream</code>æ˜¯ Node.js æ—©æœŸç‰ˆæœ¬ä¸­æä¾›åŠ å¯†å’Œè§£å¯†æ•°æ®æµåŠŸèƒ½çš„ç±»ã€‚å®ƒç»§æ‰¿è‡ª Node.js çš„ Stream æ¥å£ï¼Œä½¿å¾—å¯ä»¥ä½¿ç”¨æµå¼å¤„ç†åŠ å¯†å’Œè§£å¯†æ“ä½œã€‚<code>readyState</code>å±æ€§ç”¨äºè¡¨ç¤ºè¿™ä¸ªæµçš„çŠ¶æ€ï¼ˆæ¯”å¦‚ï¼Œæ˜¯å¦è¿˜åœ¨å¤„ç†æ•°æ®ï¼Œæˆ–è€…æ˜¯å¦å·²ç»ç»“æŸäº†æ•°æ®çš„å¤„ç†ï¼‰ã€‚</p><p>ä½†æ˜¯ï¼Œéšç€ Node.js API çš„å‘å±•ï¼Œ<code>CryptoStream</code>å’Œå…¶<code>readyState</code>å±æ€§çš„è®¾è®¡è¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„ï¼Œå¹¶ä¸”ä¸ç¬¦åˆç°ä»£ Node.js æµ API çš„è®¾è®¡ç†å¿µã€‚å› æ­¤ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œä½ ä¼šçœ‹åˆ°è¿™ä¸ªå±æ€§è¢«æ ‡è®°ä¸ºå¼ƒç”¨ã€‚</p><p>ä¸ºäº†ç»™ä½ æ›´å®é™…çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªç›¸å…³çš„ä¾‹å­ï¼š</p><p><strong>æ—§ç‰ˆ Node.js ä½¿ç”¨ CryptoStream ç¤ºä¾‹ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> secret</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;your-secret-key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes192&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">secret</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Encrypted text: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some clear text data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŠ å¯†å™¨<code>cipher</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>CryptoStream</code>çš„å®ä¾‹ã€‚æˆ‘ä»¬ç›‘å¬<code>readable</code>äº‹ä»¶æ¥è¯»å–åŠ å¯†åçš„æ•°æ®ï¼Œå¹¶åœ¨<code>end</code>äº‹ä»¶è§¦å‘æ—¶è¾“å‡ºæœ€ç»ˆçš„åŠ å¯†æ–‡æœ¬ã€‚</p><p><strong>æ–°ç‰ˆ Node.js å»ºè®®ä½¿ç”¨çš„æ–¹å¼ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> secret</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;your-secret-key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes192&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">secret</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> input</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;some clear text data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Encrypted text: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°ç‰ˆçš„ Node.js ä¸­ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†æµå¼åŠ å¯†ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨<code>update</code>æ–¹æ³•æ¥å¤„ç†æ•°æ®ï¼Œå¹¶é€šè¿‡<code>final</code>æ–¹æ³•å®ŒæˆåŠ å¯†è¿‡ç¨‹ï¼Œè·å–åŠ å¯†åçš„æ•°æ®ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>CryptoStream.prototype.readyState</code>çš„å¼ƒç”¨æ„å‘³ç€ä½ ä¸åº”è¯¥å†ä¾èµ–å®ƒæ¥æ£€æŸ¥åŠ å¯†æµçš„çŠ¶æ€ï¼Œè€Œåº”è¯¥é‡‡ç”¨æ›´æ–°çš„ã€æ›´ç®€æ´çš„ API æ¥å¤„ç†åŠ å¯†ä»»åŠ¡ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªåŒ…å«è¿™ä¸ªå±æ€§çš„è€ç‰ˆæœ¬ Node.js åº”ç”¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦è€ƒè™‘æ›´æ–°ä½ çš„ä»£ç ä»¥é¿å…åœ¨æœªæ¥ Node.js çš„ç‰ˆæœ¬ä¸­é‡åˆ°ä¸å…¼å®¹çš„æƒ…å†µã€‚</p><h3 id="dep0005-buffer-constructor" tabindex="-1"><a class="header-anchor" href="#dep0005-buffer-constructor"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0005" target="_blank" rel="noopener noreferrer">DEP0005: Buffer() constructor</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥èŠä¸€ä¸‹ Node.js ä¸­çš„ DEP0005: Buffer() constructorã€‚</p><p>åœ¨ Node.js ä¸­ï¼ŒBuffer ç±»ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>new Buffer()</code> æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Buffer å®ä¾‹ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼å­˜åœ¨æ½œåœ¨çš„å®‰å…¨é—®é¢˜å’Œæ•ˆç‡é—®é¢˜ï¼Œå› ä¸ºå®ƒå…è®¸åˆ†é…æœªåˆå§‹åŒ–çš„å†…å­˜ç©ºé—´ã€‚å¦‚æœç¨‹åºå‘˜ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚æ‰€ä»¥ï¼Œåœ¨ Node.js çš„åç»­ç‰ˆæœ¬ä¸­ï¼Œ<code>new Buffer()</code> çš„ä½¿ç”¨è¢«è®¤ä¸ºæ˜¯åºŸå¼ƒçš„ï¼ˆdeprecatedï¼‰ï¼Œå¹¶æœ€ç»ˆåœ¨ Node.js v6.0.0 ä¸­å®Œå…¨åºŸé™¤ã€‚</p><p>DEP0005 å°±æ˜¯å…³äºè¿™ä¸ªè¿‡æ—¶çš„æ„é€ å‡½æ•°çš„è­¦å‘Šã€‚Node.js æ¨èä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–°çš„ã€æ›´å®‰å…¨çš„æ–¹æ³•æ¥åˆ›å»º Buffer å¯¹è±¡ï¼š</p><ol><li><code>Buffer.from(array)</code> - ä»ä¸€ä¸ªå­—èŠ‚æ•°ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ Bufferã€‚</li><li><code>Buffer.from(arrayBuffer[, byteOffset[, length]])</code> - ä»ä¸€ä¸ª ArrayBuffer åˆ›å»ºä¸€ä¸ªæ–°çš„ Bufferã€‚</li><li><code>Buffer.from(buffer)</code> - å¤åˆ¶ä¼ å…¥çš„ Buffer å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„ Bufferã€‚</li><li><code>Buffer.from(string[, encoding])</code> - ä»ä¸€ä¸ªå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªæ–°çš„ Bufferï¼Œå¯ä»¥æŒ‡å®šç¼–ç ï¼ˆå¦‚ &#39;utf8&#39;, &#39;base64&#39;ï¼‰ã€‚</li><li><code>Buffer.alloc(size[, fill[, encoding]])</code> - åˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„å·²åˆå§‹åŒ–çš„ Bufferã€‚å¯é€‰åœ°ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¡«å……çš„å€¼å’Œç¼–ç ã€‚</li><li><code>Buffer.allocUnsafe(size)</code> - åˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„æœªåˆå§‹åŒ–çš„ Bufferï¼ˆè¿™ç§æ–¹æ³•æ¯” <code>Buffer.alloc</code> å¿«ï¼Œä½†ç”±äºåŒºåŸŸæœªåˆå§‹åŒ–ï¼Œå¯èƒ½åŒ…å«æ—§æ•°æ®ï¼Œå› æ­¤éœ€è¦é€šè¿‡æ‰‹åŠ¨æ¸…ç†ï¼‰ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥çœ‹çœ‹è¿™äº›æ–°æ–¹æ³•æ˜¯æ€æ ·å·¥ä½œçš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ Buffer.from æ–¹æ³•æ ¹æ®å­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ª Buffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufFromString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bufFromString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: `&lt;`Buffer 48 65 6c 6c 6f 2c 20 57 6f 72 6c 64 21&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ Buffer.alloc åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º10çš„åˆå§‹åŒ–çš„ Bufferï¼Œé»˜è®¤å¡«å……ä¸º0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufAllocated</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bufAllocated</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: `&lt;`Buffer 00 00 00 00 00 00 00 00 00 00&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ Buffer.allocUnsafe åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º10çš„æœªåˆå§‹åŒ–çš„ Bufferï¼ˆå¯èƒ½åŒ…å«æ—§æ•°æ®ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufAllocatedUnsafe</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">allocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bufAllocatedUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: `&lt;`Buffer ï¼ˆéšæœºæ•°æ®ï¼‰&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ Buffer.alloc å¹¶æŒ‡å®šå¡«å……å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufAllocFill</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bufAllocFill</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: `&lt;`Buffer 61 61 61 61 61 61 61 61 61 61&gt;ï¼ˆ&#39;a&#39; åœ¨ ASCII ç ä¸­è¡¨ç¤ºä¸º 61ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js ç‰ˆæœ¬ 21.7.1 æˆ–ä»»ä½•å…¶ä»–æ”¯æŒè¿™äº› API çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåº”è¯¥é¿å…ä½¿ç”¨ <code>new Buffer()</code>ï¼Œè€Œæ˜¯è¦ä½¿ç”¨ä¸Šè¿°çš„æ–°æ–¹æ³•æ¥åˆ›å»ºå’Œæ“ä½œ Buffer å¯¹è±¡ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç æ›´å®‰å…¨ã€æ›´é«˜æ•ˆã€‚</p><h3 id="dep0006-child-process-options-customfds" tabindex="-1"><a class="header-anchor" href="#dep0006-child-process-options-customfds"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0006" target="_blank" rel="noopener noreferrer">DEP0006: child_process options.customFds</a></span></a></h3><p><code>DEP0006</code> æ˜¯ Node.js é¡¹ç›®ä¸­ç”¨äºæ ‡è¯†ç‰¹å®šåŠŸèƒ½å¼ƒç”¨çš„ä¸€ä¸ªå”¯ä¸€ç¼–å·ã€‚åœ¨ Node.js çš„æœ¯è¯­ä¸­ï¼Œ&quot;å¼ƒç”¨&quot;ï¼ˆDeprecationï¼‰æ„å‘³ç€è¯¥åŠŸèƒ½è¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„ï¼Œå¹¶ä¸”å°†æ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šåˆ é™¤æˆ–æ›´æ”¹å®ƒï¼Œæ‰€ä»¥ä¸é¼“åŠ±ç»§ç»­ä½¿ç”¨ã€‚</p><p>å…·ä½“åˆ° <code>DEP0006</code> è¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨ <code>child_process</code> æ¨¡å—çš„é€‰é¡¹ä¸­ä½¿ç”¨ <code>customFds</code> å±æ€§å·²ç»ä¸å†è¢«æ”¯æŒäº†ã€‚è¿™æ˜¯å› ä¸ºåœ¨è¿‡å»ï¼Œ<code>customFds</code> é€‰é¡¹è¢«ç”¨äºæ§åˆ¶å­è¿›ç¨‹ä¸­çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½†åæ¥è¢«æ–°çš„ã€æ›´å¼ºå¤§çš„é€‰é¡¹å¦‚ <code>stdio</code> æ‰€å–ä»£ã€‚</p><p>æˆ‘ä¼šå…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åè°ˆè°ˆ <code>child_process</code> æ¨¡å—ï¼Œæ¥ç€è§£é‡Š <code>customFds</code> çš„ä½œç”¨åŠå…¶è¢«å¼ƒç”¨çš„åŸå› ï¼Œæœ€åé€šè¿‡ä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨ç°åœ¨æ¨èçš„æ–¹æ³•ã€‚</p><p><strong>æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorsï¼‰:</strong><br> åœ¨ UNIX å’Œç±» UNIX ç³»ç»Ÿä¸­ï¼ˆåŒ…æ‹¬ Linux å’Œ macOSï¼‰ï¼Œæ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªéå¸¸ä½çº§åˆ«çš„æ¦‚å¿µï¼Œç”¨äºè®¿é—®æ–‡ä»¶å’Œå…¶ä»–èµ„æºï¼ˆå¦‚ç½‘ç»œè¿æ¥ï¼‰ã€‚æ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶éƒ½ç”±ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºï¼Œè¿™ä¸ªæ•´æ•°å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œ<code>0</code> é€šå¸¸è¡¨ç¤ºæ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ï¼Œ<code>1</code> è¡¨ç¤ºæ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰ï¼Œ<code>2</code> è¡¨ç¤ºæ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆstderrï¼‰ã€‚</p><p><strong>child_process æ¨¡å—:</strong><br> Node.js çš„ <code>child_process</code> æ¨¡å—å…è®¸ä½ æ‰§è¡Œå…¶ä»–ç¨‹åºæˆ–å‘½ä»¤ï¼Œåˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†å¤šç§æ–¹å¼æ¥åˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚ <code>exec</code>, <code>execFile</code>, <code>spawn</code>, <code>fork</code> ç­‰ã€‚</p><p><strong>customFds çš„åŸå§‹ä½œç”¨:</strong><br> åœ¨è€æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>customFds</code> é€‰é¡¹è¢«ç”¨äºæŒ‡å®šå“ªäº›æ–‡ä»¶æè¿°ç¬¦åº”è¯¥è¢«ä¼ é€’ç»™å­è¿›ç¨‹ã€‚è¿™æ ·ä½ å¯ä»¥é‡å®šå‘å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºç­‰ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ <code>customFds</code> è¢«å¼ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™å‡ºè¿™æ ·çš„ä»£ç æ¥æ”¹å˜å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> spawn</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;child_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ &#39;some_command&#39; æ˜¯æƒ³è¦è¿è¡Œçš„å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some_command&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, [], {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  customFds</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨çˆ¶è¿›ç¨‹çš„ stdin, stdout, stderr</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸ºä»€ä¹ˆå¼ƒç”¨ customFds:</strong><br> éšç€æ—¶é—´çš„å‘å±•ï¼ŒNode.js å¼•å…¥äº†ä¸€ä¸ªæ›´ä¸ºå¼ºå¤§å’Œçµæ´»çš„ <code>stdio</code> é€‰é¡¹ï¼Œå®ƒæä¾›äº†å¯¹å­è¿›ç¨‹ä¸­çš„æµï¼ˆstreamsï¼‰æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚<code>stdio</code> é€‰é¡¹å¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ <code>&#39;pipe&#39;</code>, <code>&#39;ipc&#39;</code>, <code>&#39;ignore&#39;</code> æˆ–è€… <code>Stream</code> å¯¹è±¡ã€æ–‡ä»¶æè¿°ç¬¦ç­‰ã€‚å› æ­¤ï¼Œ<code>customFds</code> å› ä¸ºåŠŸèƒ½å—é™å¹¶ä¸”è¢« <code>stdio</code> æ›¿æ¢è€Œè¢«å¼ƒç”¨ã€‚</p><p><strong>æ­£ç¡®çš„åšæ³• â€” ä½¿ç”¨ stdio:</strong><br> ç°åœ¨å¦‚æœæˆ‘ä»¬æƒ³è¦æ§åˆ¶å­è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <code>stdio</code> é€‰é¡¹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>stdio</code> é€‰é¡¹æ¥é‡å®šå‘å­è¿›ç¨‹çš„è¾“å‡ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;child_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå­è¿›ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some_command&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  stdio</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;inherit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å­è¿›ç¨‹çš„ stdin ç›´æ¥ä½¿ç”¨çˆ¶è¿›ç¨‹çš„ stdin</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;inherit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å­è¿›ç¨‹çš„ stdout ç›´æ¥ä½¿ç”¨çˆ¶è¿›ç¨‹çš„ stdout</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;inherit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å­è¿›ç¨‹çš„ stderr ç›´æ¥ä½¿ç”¨çˆ¶è¿›ç¨‹çš„ stderr</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">child</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å­è¿›ç¨‹é€€å‡ºï¼Œé€€å‡ºç  </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ&#39;inherit&#39; é€‰é¡¹æ„å‘³ç€å­è¿›ç¨‹å°†ä¼šä½¿ç”¨çˆ¶è¿›ç¨‹ç›¸åº”çš„æ ‡å‡†æµã€‚è¿™æ ·ï¼Œå½“å­è¿›ç¨‹æ‰“å°ä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯æ—¶ï¼Œè¿™äº›ä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨çˆ¶è¿›ç¨‹çš„æ§åˆ¶å°ä¸Šã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>DEP0006</code> æ˜¯ Node.js å‘Šè¯‰æˆ‘ä»¬ä¸åº”å†ä½¿ç”¨ <code>customFds</code>ï¼Œè€Œåº”è¯¥ä½¿ç”¨ <code>stdio</code> é€‰é¡¹æ¥æ§åˆ¶å­è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™ä½¿å¾—æˆ‘ä»¬åœ¨ç®¡ç†å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæ–¹é¢æœ‰äº†æ›´å¥½çš„æ–¹æ³•å’Œæ›´é«˜çš„çµæ´»æ€§ã€‚</p><h3 id="dep0007-replace-cluster-worker-suicide-with-worker-exitedafterdisconnect" tabindex="-1"><a class="header-anchor" href="#dep0007-replace-cluster-worker-suicide-with-worker-exitedafterdisconnect"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0007" target="_blank" rel="noopener noreferrer">DEP0007: Replace cluster worker.suicide with worker.exitedAfterDisconnect</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆè®©æˆ‘ä»¬ç†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>cluster</code> æ¨¡å—å’Œè¿™ä¸ªå¼ƒç”¨ï¼ˆdeprecationï¼‰é€šçŸ¥æ˜¯ä»€ä¹ˆã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>cluster</code> æ¨¡å—å…è®¸ä½ è½»æ¾åˆ›å»ºå­è¿›ç¨‹ï¼ˆç§°ä¸ºå·¥ä½œè¿›ç¨‹æˆ– workersï¼‰ï¼Œè¿™äº›å­è¿›ç¨‹å¯ä»¥åŒæ—¶è¿è¡Œåœ¨å¤šæ ¸ CPU ä¸Šã€‚è¿™å¯¹äºæé«˜æ€§èƒ½å’Œå¤„ç†æ›´å¤šçš„å¹¶å‘è¯·æ±‚éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js æ˜¯å•çº¿ç¨‹çš„ã€‚</p><p>å½“ä½ ä½¿ç”¨ <code>cluster</code> æ¨¡å—æ—¶ï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ªä¸»è¿›ç¨‹ï¼ˆmaster processï¼‰ï¼Œå®ƒè´Ÿè´£åˆå§‹åŒ–ç³»ç»Ÿèµ„æºï¼ˆå¦‚ç½‘ç»œæ¥å£ï¼‰ï¼Œç„¶åå®ƒå¯ä»¥æ ¹æ®éœ€è¦ç”Ÿæˆå¤šä¸ªå·¥ä½œè¿›ç¨‹ã€‚è¿™äº›å·¥ä½œè¿›ç¨‹å®é™…ä¸Šæ˜¯ Node.js è¿›ç¨‹çš„å‰¯æœ¬ï¼Œå¯ä»¥å¤„ç†å®é™…çš„å·¥ä½œè´Ÿè½½ï¼Œæ¯”å¦‚å“åº”ç½‘ç»œè¯·æ±‚ã€‚</p><p>ç°åœ¨ï¼ŒèŠåˆ°äº† DEP0007 è¿™ä¸ªå¼ƒç”¨ä¿¡æ¯ã€‚åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå±æ€§å«åš <code>suicide</code>ã€‚è¿™ä¸ª <code>suicide</code> å±æ€§ç”¨æ¥æŒ‡ç¤ºå·¥ä½œè¿›ç¨‹æ˜¯å¦æ˜¯è‡ªæ„¿é€€å‡ºçš„ï¼ˆå³ä»£ç ä¸­æ˜¾å¼åœ°è®©å®ƒé€€å‡ºï¼‰ã€‚è¿™ä¸ªå‘½åè¢«è®¤ä¸ºæ˜¯ä¸æ•æ„Ÿçš„ï¼Œè€Œä¸”åœ¨åŠŸèƒ½ä¸Šä¹Ÿæœ‰ç‚¹æ··æ·†ï¼Œæ‰€ä»¥ Node.js å›¢é˜Ÿå†³å®šç”¨ <code>worker.exitedAfterDisconnect</code> æ¥æ›¿ä»£ <code>worker.suicide</code>ã€‚</p><p><code>worker.exitedAfterDisconnect</code> è¿™ä¸ªæ–°å±æ€§æ›´åŠ æ¸…æ™°åœ°è¡¨è¾¾äº†å…¶æ„å›¾ï¼šå¦‚æœå·¥ä½œè¿›ç¨‹åœ¨ä¸ä¸»è¿›ç¨‹æ–­å¼€è¿æ¥åé€€å‡ºï¼Œåˆ™æ­¤å±æ€§å°†è¢«è®¾ç½®ä¸º <code>true</code>ã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä½ å¯èƒ½æƒ³çŸ¥é“å·¥ä½œè¿›ç¨‹æ˜¯ç”±äºæŸç§é¢„æœŸçš„æ“ä½œï¼ˆå¦‚é‡å¯ç­–ç•¥ï¼‰è€Œç»“æŸï¼Œè¿˜æ˜¯å› ä¸ºå‡ºç°äº†é”™è¯¯æˆ–å¼‚å¸¸ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cluster</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cluster&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">isMaster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸»è¿›ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">exitedAfterDisconnect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å·¥ä½œè¿›ç¨‹æ˜¯é¢„æœŸæ–­å¼€è¿æ¥åé€€å‡ºçš„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å·¥ä½œè¿›ç¨‹éé¢„æœŸåœ°é€€å‡ºäº†&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ–­å¼€è¿æ¥å¹¶è®©å·¥ä½œè¿›ç¨‹é€€å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">disconnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å·¥ä½œè¿›ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼š</p><ol><li>åˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦æ˜¯ä¸»è¿›ç¨‹ (<code>cluster.isMaster</code>)ã€‚</li><li>ä¸»è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå·¥ä½œè¿›ç¨‹ (<code>cluster.fork()</code>)ã€‚</li><li>ç›‘å¬å·¥ä½œè¿›ç¨‹çš„ <code>exit</code> äº‹ä»¶ã€‚</li><li>å½“å·¥ä½œè¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ£€æŸ¥ <code>exitedAfterDisconnect</code> å±æ€§ï¼Œå¦‚æœä¸º <code>true</code>ï¼Œè¯´æ˜æ˜¯æˆ‘ä»¬ä¸»åŠ¨è°ƒç”¨ <code>disconnect</code> æ–¹æ³•å¯¼è‡´çš„é€€å‡ºï¼›å¦åˆ™ï¼Œå·¥ä½œè¿›ç¨‹å¯èƒ½å› ä¸ºé”™è¯¯æˆ–å…¶ä»–åŸå› éé¢„æœŸåœ°é€€å‡ºäº†ã€‚</li><li>å·¥ä½œè¿›ç¨‹ä¼šæ‰§è¡Œä¸åŒçš„ä»£ç è·¯å¾„ï¼Œå®é™…å¤„ç†ä»»åŠ¡ã€‚</li></ol><p>é€šè¿‡ä½¿ç”¨ <code>exitedAfterDisconnect</code> å±æ€§ï¼Œæˆ‘ä»¬çš„ä»£ç å˜å¾—æ›´æ¸…æ™°ã€å¯è¯»ï¼Œå¹¶ä¸”æ›´å…·æè¿°æ€§ï¼ŒåŒæ—¶é¿å…äº†ä½¿ç”¨ä¸æ•æ„Ÿçš„æœ¯è¯­ã€‚</p><h3 id="dep0008-require-node-constants" tabindex="-1"><a class="header-anchor" href="#dep0008-require-node-constants"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0008" target="_blank" rel="noopener noreferrer">DEP0008: require(&#39;node:constants&#39;)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­æœ‰å¾ˆå¤šå†…ç½®çš„æ¨¡å—ï¼Œä½ å¯ä»¥é€šè¿‡ <code>require</code> å‡½æ•°æ¥å¼•å…¥è¿™äº›æ¨¡å—ã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>require(&#39;constants&#39;)</code> æ¥è·å–ä¸€äº›åœ¨ Node.js ä¸­é¢„å®šä¹‰çš„å¸¸é‡ï¼Œä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„é”™è¯¯ç ç­‰ã€‚ä½†æ˜¯ï¼Œåœ¨æœ€æ–°çš„ Node.js ç‰ˆæœ¬ä¸­ï¼ˆä½ æåˆ°çš„ v21.7.1ï¼‰ï¼Œä½¿ç”¨ <code>require(&#39;node:constants&#39;)</code> æˆ–è€… <code>require(&#39;constants&#39;)</code> çš„æ–¹å¼å·²ç»è¢«å¼ƒç”¨äº†ã€‚</p><p><strong>DEP0008</strong> æ˜¯ Node.js å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šç¼–å·ã€‚è¿™æ„å‘³ç€è¿™ç§ç”¨æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ çš„ä»£ç ä¸­è¿˜åœ¨ä½¿ç”¨ <code>require(&#39;node:constants&#39;)</code> æˆ–è€… <code>require(&#39;constants&#39;)</code> æ¥è·å–å¸¸é‡ï¼Œè¿™æ®µä»£ç åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬çš„ Node.js ä¸­å¯èƒ½å°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚</p><p>å–è€Œä»£ä¹‹ï¼Œç°åœ¨åº”è¯¥ä½¿ç”¨æ›´å…·ä½“çš„æ¨¡å—æ¥è·å–å¸¸é‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ éœ€è¦æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„å¸¸é‡ï¼ˆå¦‚æ‰“å¼€æ–‡ä»¶æ—¶çš„æ ‡å¿—ï¼‰ï¼Œä½ åº”è¯¥ä½¿ç”¨ <code>fs.constants</code>ã€‚è¿™é‡Œæœ‰ä¸€äº›å®é™…çš„ä¾‹å­ï¼š</p><p><strong>è¿‡æ—¶çš„ç”¨æ³•ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> constants</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;constants&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">constants</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">FS_CONSTANTS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç°ä»£çš„ç”¨æ³•ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">constants</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„å¸¸é‡</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¸¸é‡ï¼Œä¾‹å¦‚åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">constants</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">O_RDONLY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœå‡ºé”™ï¼Œ`err`å°†æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦åˆ™ï¼Œ`fd`æ˜¯æ–‡ä»¶æè¿°ç¬¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå¦‚æœä½ éœ€è¦ç‰¹å®šæ¨¡å—çš„å¸¸é‡ï¼Œä½ ä¹Ÿåº”è¯¥ç›´æ¥ä»ç›¸åº”çš„æ¨¡å—ä¸­è·å–å®ƒä»¬ã€‚</p><p>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨ <code>require(&#39;node:constants&#39;)</code>ï¼Ÿç®€å•æ¥è¯´ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®© Node.js æ ¸å¿ƒåº“æ›´åŠ æ¨¡å—åŒ–ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿæ˜ç¡®çŸ¥é“è¿™äº›å¸¸é‡æ¥è‡ªå“ªä¸ªæ¨¡å—ã€‚è¿™æ ·ï¼Œä»£ç çš„å¯ç»´æŠ¤æ€§æ›´é«˜ï¼Œæ˜“è¯»æ€§ä¹Ÿæ›´å¥½ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœä½ åœ¨å­¦ä¹ æˆ–è€…ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ Node.jsï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥é¿å…ä½¿ç”¨ <code>require(&#39;node:constants&#39;)</code>ï¼Œå¹¶ä¸”æ”¹ä¸ºä»å…·ä½“æ¨¡å—ä¸­è·å–æ‰€éœ€çš„å¸¸é‡ã€‚è¿™æ ·å¯ä»¥ä¿è¯ä½ çš„ä»£ç å…¼å®¹æœªæ¥ç‰ˆæœ¬çš„ Node.jsã€‚</p><h3 id="dep0009-crypto-pbkdf2-without-digest" tabindex="-1"><a class="header-anchor" href="#dep0009-crypto-pbkdf2-without-digest"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0009" target="_blank" rel="noopener noreferrer">DEP0009: crypto.pbkdf2 without digest</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚Node.js æä¾›äº†å¾ˆå¤šå†…å»ºçš„æ¨¡å—ï¼Œä¾‹å¦‚ <code>crypto</code> æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æä¾›äº†åŠ å¯†åŠŸèƒ½ï¼Œç”¨æ¥ä¿æŠ¤æ•°æ®å®‰å…¨ã€‚</p><p>åœ¨ Node.js çš„æ—§ç‰ˆæœ¬ä¸­ï¼Œ<code>crypto.pbkdf2</code> å‡½æ•°è¢«ç”¨æ¥è¿›è¡Œå¯†ç åŸºç¡€å¯†é’¥æ´¾ç”Ÿå‡½æ•°æ“ä½œã€‚è¿™æ˜¯ä¸€ç§å®‰å…¨çš„æ–¹æ³•ï¼Œç”¨äºå°†å¯†ç è½¬åŒ–æˆå›ºå®šé•¿åº¦çš„å¯†é’¥ã€‚å½“ä½ è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œä½ å¯ä»¥ä¸æŒ‡å®šä¸€ä¸ªå‚æ•°å«åš <code>digest</code>ï¼Œå®ƒå†³å®šäº†å¦‚ä½•å¯¹å¯†ç è¿›è¡Œæ•£åˆ—å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ—§å¼è°ƒç”¨ï¼Œä¸æ¨èï¼Œå› ä¸ºæ²¡æœ‰æŒ‡å®š digest å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pbkdf2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">salt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iterations</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">keylen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">derivedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">derivedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æœæ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œå¦‚æœä½ ä¸æä¾› <code>digest</code> å‚æ•°ï¼Œè¿™ä¼šè§¦å‘ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼ˆä¹Ÿå°±æ˜¯ DEP0009ï¼‰ã€‚åŸå› æ˜¯å®‰å…¨æ–¹é¢çš„è€ƒè™‘ã€‚å¦‚æœä¸æ˜ç¡®æŒ‡å®š <code>digest</code>ï¼Œç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„æ•£åˆ—ç®—æ³•å¯èƒ½ä¸å¤Ÿå®‰å…¨æˆ–è€…æœªæ¥å¯èƒ½ä¼šå˜å¾—ä¸å®‰å…¨ã€‚ä¸ºäº†ç¡®ä¿ä½ çš„ä»£ç æ˜¯å®‰å…¨çš„ï¼Œæœ€å¥½æ˜¾å¼åœ°æŒ‡å®šä¸€ä¸ª <code>digest</code>ï¼Œæ¯”å¦‚ <code>sha256</code> æˆ– <code>sha512</code>ã€‚</p><p>æ­£ç¡®çš„è°ƒç”¨æ–¹å¼åº”è¯¥åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„è°ƒç”¨æ–¹å¼ï¼ŒæŒ‡å®šäº† digest å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pbkdf2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  salt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  iterations</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  keylen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">derivedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">derivedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æœæ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…åº”ç”¨ä¾‹å­ï¼š</p><p>æƒ³è±¡ä¸€ä¸‹ä½ åœ¨åˆ›å»ºä¸€ä¸ªç½‘ç«™ï¼Œç”¨æˆ·éœ€è¦æ³¨å†Œå¹¶è®¾ç½®å¯†ç ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸èƒ½ç›´æ¥ä¿å­˜ç”¨æˆ·çš„æ˜æ–‡å¯†ç ã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>crypto.pbkdf2</code> å‡½æ•°æ¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œç„¶åæŠŠè¿™ä¸ªå¯†é’¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚å¦‚æœæœ‰äººè¦ç™»å½•ï¼Œä½ å¯ä»¥å†æ¬¡ä½¿ç”¨ç›¸åŒçš„å‡½æ•°å’Œå‚æ•°ï¼ˆåŒ…æ‹¬ <code>digest</code>ï¼‰æ¥éªŒè¯è¾“å…¥çš„å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”¨æˆ·å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> userPassword</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;mySecretPassword&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºç›å€¼ï¼Œç”¨äºå¢å¼ºå®‰å…¨æ€§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> salt</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿›è¡Œå¯†é’¥æ´¾ç”Ÿ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pbkdf2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userPassword</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">salt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha512&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">derivedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å°†å¾—åˆ°çš„å¯†é’¥ä¿å­˜åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hashedPassword</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> derivedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hashedPassword</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨æ•°æ®åº“ä¸­ä¿å­˜ hashedPassword å’Œ salt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“ç”¨æˆ·å°è¯•ç™»å½•æ—¶ï¼Œä½¿ç”¨æ•°æ®åº“ä¸­å­˜å‚¨çš„ salt å’Œç›¸åŒçš„å‚æ•°é‡æ–°è®¡ç®—å¯†é’¥ï¼Œçœ‹çœ‹æ˜¯å¦åŒ¹é…</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç†è§£ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œæ˜ç¡®æŒ‡å®š <code>digest</code> å‚æ•°æ˜¯ä¸€ç§æ›´å®‰å…¨çš„åšæ³•ï¼Œå¹¶ä¸”é¿å…äº†å› ä¸ºå°†æ¥çš„æ›´æ–°å¯¼è‡´çš„æ½œåœ¨é—®é¢˜ã€‚</p><h3 id="dep0010-crypto-createcredentials" tabindex="-1"><a class="header-anchor" href="#dep0010-crypto-createcredentials"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0010" target="_blank" rel="noopener noreferrer">DEP0010: crypto.createCredentials</a></span></a></h3><h3 id="dep0011-crypto-credentials" tabindex="-1"><a class="header-anchor" href="#dep0011-crypto-credentials"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0011" target="_blank" rel="noopener noreferrer">DEP0011: crypto.Credentials</a></span></a></h3><p>Node.js ä¸­çš„ &quot;DEP0011: crypto.Credentials&quot; æ˜¯æŒ‡åœ¨ Node.js çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œ<code>crypto.Credentials</code> è¿™ä¸ªåŠŸèƒ½è¢«æ ‡è®°ä¸º&quot;åºŸå¼ƒ&quot;ï¼ˆdeprecatedï¼‰ã€‚å½“ä¸€ä¸ªåŠŸèƒ½æˆ– API è¢«æ ‡è®°ä¸ºåºŸå¼ƒæ—¶ï¼Œæ„å‘³ç€å¼€å‘è€…ä»¬ä¸åº”è¯¥å†ä½¿ç”¨å®ƒï¼Œå› ä¸ºåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–æ”¹å˜ï¼Œè€Œä¸å†ä¿è¯å‘åå…¼å®¹ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œâ€œåºŸå¼ƒâ€å¹¶ä¸æ„å‘³ç€è¿™ä¸ªåŠŸèƒ½ç«‹åˆ»å°±ä¸èƒ½ç”¨äº†ï¼Œè€Œæ˜¯ç»™äºˆå¼€å‘è€…æå‰è­¦å‘Šï¼Œè®©ä»–ä»¬æœ‰æ—¶é—´å»æ›´æ–°å’Œæ›¿æ¢ç°æœ‰ä»£ç ã€‚</p><p>åœ¨ <code>crypto.Credentials</code> çš„æ¡ˆä¾‹ä¸­ï¼Œå®ƒæ˜¯ Node.js æ—©æœŸç‰ˆæœ¬æä¾›çš„ä¸€ä¸ªç”¨äºåˆ›å»º TLS/SSLï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®/å®‰å…¨å¥—æ¥å­—å±‚ï¼‰å¯†é’¥å’Œè¯ä¹¦çš„æ„é€ å‡½æ•°ã€‚ä½†æ˜¯ï¼Œéšç€ Node.js çš„è¿›åŒ–ï¼Œæ–°çš„ API å’Œæ–¹æ³•è¢«å¼•å…¥æ¥æ›¿ä»£æ—§çš„åšæ³•ã€‚</p><p><strong>å®é™…è¿ç”¨çš„ä¾‹å­</strong>ï¼š</p><p>å‡è®¾ä½ æ­£å¼€å‘ä¸€ä¸ªéœ€è¦ä½¿ç”¨ HTTPS çš„ Web åº”ç”¨ç¨‹åºï¼Œä½ å°†éœ€è¦ä½¿ç”¨ TLS/SSL è¯ä¹¦æ¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>crypto.Credentials</code> æ¥åˆ›å»ºè¿™äº›è¯ä¹¦ç›¸å…³çš„å‡­æ®ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ç‰ˆåŠä»¥åï¼Œä½ ä¸åº”è¯¥å†ä½¿ç”¨ <code>crypto.Credentials</code>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ›´ç°ä»£çš„æ–¹æ³•ï¼Œå¦‚ä½¿ç”¨ <code>tls.createSecureContext</code> æ–¹æ³•æ¥åˆ›å»ºå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå†é…åˆ <code>https.createServer</code> æ¥å¯åŠ¨æœåŠ¡å™¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–å¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> privateKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/private-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> certificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/certificate.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå®‰å…¨ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> secureContext</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSecureContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">privateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">secureContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 443 æ˜¯é»˜è®¤çš„ HTTPS ç«¯å£</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç°ä»£çš„ Node.js API æ¥ä»£æ›¿å·²åºŸå¼ƒçš„ <code>crypto.Credentials</code> åŠŸèƒ½ã€‚é€šè¿‡è¯»å–å¯†é’¥å’Œè¯ä¹¦ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå¹¶æœ€ç»ˆåˆ›å»ºä¸€ä¸ªç›‘å¬ HTTPS è¯·æ±‚çš„æœåŠ¡å™¨ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>DEP0011: crypto.Credentials</code> æ˜¯ä¸€ä¸ªä½ åœ¨ç¼–å†™ Node.js ä»£ç æ—¶åº”è¯¥é¿å…ä½¿ç”¨çš„åºŸå¼ƒåŠŸèƒ½ã€‚ç›¸åï¼Œä½ åº”è¯¥ä½¿ç”¨æ–°çš„æ–¹æ³•æ¥ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ç¨³å®šè¿è¡Œã€‚</p><h3 id="dep0012-domain-dispose" tabindex="-1"><a class="header-anchor" href="#dep0012-domain-dispose"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0012" target="_blank" rel="noopener noreferrer">DEP0012: Domain.dispose</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js çš„å‘å±•è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº› API ä¼šè¢«å¼ƒç”¨ï¼ˆdeprecatedï¼‰ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬å¯èƒ½å­˜åœ¨è®¾è®¡é—®é¢˜ã€æ€§èƒ½é—®é¢˜æˆ–è€…è¢«æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆå–ä»£ã€‚</p><p><code>DEP0012</code> æ˜¯ Node.js å®˜æ–¹æŒ‡å®šçš„ä¸€ä¸ªç‰¹å®šå¼ƒç”¨è­¦å‘Šçš„ç¼–å·ã€‚è¿™ä¸ªç¼–å·å¯¹åº”äº <code>Domain.dispose</code> æ–¹æ³•çš„å¼ƒç”¨ã€‚</p><p>Domains æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œæœ€åˆè¢«è®¾è®¡æ¥å¤„ç†å¹¶ç®€åŒ–å¤šä¸ªå¼‚æ­¥ I/O æ“ä½œä¸­å¼‚å¸¸çš„ä¼ æ’­å’Œå¤„ç†ã€‚ä½¿ç”¨ domainsï¼Œä½ å¯ä»¥å°†ç›¸å…³çš„ I/O æ“ä½œåˆ†ç»„åˆ°ä¸€ä¸ªåŸŸä¸­ï¼Œå¹¶ä¸”å½“è¯¥åŸŸå†…çš„ä»»ä½•æ“ä½œæŠ›å‡ºé”™è¯¯æ—¶ç»Ÿä¸€å¤„ç†è¿™äº›é”™è¯¯ã€‚</p><p>ç„¶è€Œï¼Œ<code>Domain.dispose</code> æ–¹æ³•å·²ç»åœ¨ Node.js v21.7.1 ä¸­è¢«åºŸå¼ƒäº†ã€‚è¿™æ„å‘³ç€è¿™ä¸ªæ–¹æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šä» Node.js API ä¸­ç§»é™¤ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>Domain.dispose</code> æ–¹æ³•çš„ä½œç”¨æ˜¯æ‰‹åŠ¨æ¸…ç†ã€å…³é—­æˆ– Dispose ä¸€ä¸ª domain å¯¹è±¡å’Œå®ƒæ‰€åŒ…å«çš„èµ„æºã€‚ä½†æ˜¯ï¼Œè¿™ç§æœºåˆ¶è¢«è¯æ˜æ˜¯ä¸å¯é çš„ï¼Œå¹¶ä¸”å¯¼è‡´å†…å­˜æ³„æ¼ç­‰é—®é¢˜ï¼Œå› æ­¤ Node.js å›¢é˜Ÿå†³å®šå¼ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¸å†æ¨èä½¿ç”¨ Domain.dispose çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> d</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ•è·åˆ°é”™è¯¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯åŠ¨ä¸€ä¸ªå¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯çš„å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æŸäº›é”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿‡å»å¯èƒ½ä¼šè¿™ä¹ˆåšï¼Œç°åœ¨ä¸å†æ¨è</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dispose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ domain <code>d</code>ï¼Œå¹¶åœ¨è¿™ä¸ª domain ä¸­è¿è¡Œäº†ä¸€ä¸ªå¼‚æ­¥çš„ setTimeout å‡½æ•°ï¼Œå¦‚æœå‡½æ•°ä¸­å‘ç”Ÿé”™è¯¯ï¼Œå®ƒåº”è¯¥è¢« domain çš„ error äº‹ä»¶æ‰€æ•è·ã€‚åœ¨è¿‡å»ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè°ƒç”¨ <code>d.dispose()</code> æ¥å°è¯•æ¸…ç† domainï¼Œä½†ç°åœ¨è¿™ç§åšæ³•å·²ç»ä¸å†æ¨èï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´é—®é¢˜ã€‚</p><p>æ›¿ä»£æ–¹æ¡ˆï¼š<br> Node.js å»ºè®®å¼€å‘è€…é¿å…ä½¿ç”¨ domainsï¼Œæ”¹ä¸ºä½¿ç”¨ç°ä»£çš„ JavaScript é”™è¯¯å¤„ç†æ–¹å¼ï¼Œä¾‹å¦‚ <code>try...catch</code> è¯­å¥æˆ–è€… Promise é“¾å¼è°ƒç”¨ä¸­çš„ <code>.catch()</code> æ–¹æ³•æ¥å¤„ç†é”™è¯¯ã€‚å¯¹äºé«˜çº§çš„å¼‚æ­¥é”™è¯¯å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ async/await è¯­æ³•ï¼Œå¹¶å€ŸåŠ© try...catch ç»“æ„æ¥æ•è· await è°ƒç”¨ä¸­æŠ›å‡ºçš„ä»»ä½•é”™è¯¯ã€‚</p><p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·é‡å†™ä¸Šé¢çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> riskyOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æŸäº›é”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> riskyOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ•è·åˆ°é”™è¯¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Promise æ¥å°è£…å¯èƒ½ä¼šå‡ºé”™çš„æ“ä½œï¼Œå¹¶ä½¿ç”¨ async/await é…åˆ try...catch æ¥å¤„ç†å¼‚å¸¸ã€‚è¿™æ˜¯ç›®å‰æ¨èçš„é”™è¯¯å¤„ç†æ–¹å¼ã€‚</p><h3 id="dep0013-fs-asynchronous-function-without-callback" tabindex="-1"><a class="header-anchor" href="#dep0013-fs-asynchronous-function-without-callback"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0013" target="_blank" rel="noopener noreferrer">DEP0013: fs asynchronous function without callback</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚åœ¨ Node.js ä¸­ï¼Œ<code>fs</code>æ¨¡å—æä¾›äº†æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„åŠŸèƒ½ï¼Œä¾‹å¦‚è¯»å–æ–‡ä»¶ã€å†™å…¥æ–‡ä»¶ç­‰ã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>fs</code>æ¨¡å—çš„å¼‚æ­¥å‡½æ•°å…è®¸ä½ ä¸ä¼ å…¥å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ã€‚å›è°ƒå‡½æ•°æ˜¯åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåä¼šè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå®ƒé€šå¸¸æœ‰ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”™è¯¯å¯¹è±¡ï¼ˆå¦‚æœæ“ä½œå¤±è´¥äº†ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ“ä½œç»“æœã€‚</p><p>ä½†æ˜¯ï¼Œè‡ªä» Node.js v7.0.0 èµ·å¼•å…¥çš„ DEP0013 å¼ƒç”¨è­¦å‘Šä¹‹åï¼Œå¦‚æœä½ ä½¿ç”¨<code>fs</code>æ¨¡å—çš„å¼‚æ­¥å‡½æ•°è€Œæ²¡æœ‰æä¾›å›è°ƒå‡½æ•°ï¼ŒNode.js å°†ä¼šè¾“å‡ºè­¦å‘Šä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p><p>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨æ— å›è°ƒå‡½æ•°çš„è°ƒç”¨å‘¢ï¼Ÿå› ä¸ºè¿™æ˜¯ä¸€ç§ä¸å¥½çš„å®è·µã€‚å½“ä½ æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œä½†ä¸å¤„ç†å…¶ç»“æœæ—¶ï¼Œå¦‚æœæ“ä½œå¤±è´¥äº†ï¼Œä½ å°†æ— æ³•çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯ã€‚è€Œä¸”è¿™æ ·çš„ä»£ç å¯èƒ½å¯¼è‡´ä¸€äº›éš¾ä»¥è¿½è¸ªçš„ bugã€‚</p><p>è®©æˆ‘ä»¬çœ‹å‡ ä¸ªä¾‹å­æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µï¼š</p><p><strong>æ—§æ–¹å¼ï¼ˆä¸æä¾›å›è°ƒå‡½æ•°ï¼‰:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸æä¾›å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ç§åšæ³•åœ¨Node.js v7.0.0ä¹‹å‰æ˜¯å¯ä»¥çš„ï¼Œä½†ç°åœ¨ä¼šè§¦å‘DEP0013è­¦å‘Š</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°è¯•å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å¤„ç†è¯»å–æ“ä½œçš„ç»“æœã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…æœ‰å…¶ä»–é”™è¯¯å‘ç”Ÿï¼Œæˆ‘ä»¬å°†å¾—ä¸åˆ°ä»»ä½•é”™è¯¯ä¿¡æ¯ã€‚</p><p><strong>æ–°æ–¹å¼ï¼ˆæä¾›å›è°ƒå‡½æ•°ï¼‰:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å¤„ç†ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¦‚æœæœ‰é”™è¯¯å‘ç”Ÿï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–æ–‡ä»¶å‡ºé”™:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å†…å®¹:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¿®æ”¹åçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å¤„ç†è¯»å–æ“ä½œçš„ç»“æœã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œæˆ‘ä»¬å°†å¾—åˆ°æ–‡ä»¶çš„å†…å®¹å¹¶å°†å…¶æ‰“å°å‡ºæ¥ï¼›å¦‚æœæ“ä½œå¤±è´¥ï¼Œæˆ‘ä»¬å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚è¿™æ ·å°±å¯ä»¥åŠæ—¶åœ°å‘ç°å’Œå¤„ç†é—®é¢˜ï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ å¥å£®ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼ŒDEP0013 æ˜¯ Node.js å¯¹äº<code>fs</code>æ¨¡å—å¼‚æ­¥å‡½æ•°è°ƒç”¨æ–¹å¼çš„ä¸€ä¸ªæ”¹è¿›ï¼Œå®ƒè¦æ±‚å¿…é¡»æä¾›å›è°ƒå‡½æ•°ä»¥ç¡®ä¿é”™è¯¯å¤„ç†çš„æ­£ç¡®æ€§å’Œä»£ç çš„å¥å£®æ€§ã€‚</p><h3 id="dep0014-fs-read-legacy-string-interface" tabindex="-1"><a class="header-anchor" href="#dep0014-fs-read-legacy-string-interface"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0014" target="_blank" rel="noopener noreferrer">DEP0014: fs.read legacy String interface</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šè¿™ä¸ª Node.js çš„åºŸå¼ƒè­¦å‘Šï¼šDEP0014ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚ä½ å¯ä»¥ä½¿ç”¨ Node.js æ¥å¼€å‘æœåŠ¡å™¨ç«¯çš„åº”ç”¨ç¨‹åºã€‚</li><li><strong>fs æ¨¡å—</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œ<code>fs</code>æ˜¯â€œæ–‡ä»¶ç³»ç»Ÿâ€çš„ç¼©å†™ï¼Œè¡¨ç¤ºä¸€ä¸ªå†…ç½®çš„æ¨¡å—ï¼Œæä¾›äº†å¾ˆå¤šæ–¹æ³•ç”¨äºæ“ä½œæ–‡ä»¶ç³»ç»Ÿã€‚</li><li><strong>fs.read()æ–¹æ³•</strong>ï¼šè¿™æ˜¯<code>fs</code>æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥ä»æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ä¸­è¯»å–æ•°æ®ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è°ˆè°ˆ DEP0014ã€‚</p><h3 id="dep0014-fs-read-legacy-string-interface-1" tabindex="-1"><a class="header-anchor" href="#dep0014-fs-read-legacy-string-interface-1"><span>DEP0014: <code>fs.read</code> legacy String interface</span></a></h3><p>è¿™ä¸ªè­¦å‘Šè¯´çš„æ˜¯ï¼Œåœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>fs.read</code>æ–¹æ³•å…è®¸ç”¨æˆ·æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¹‹ä¸€æ¥æ¥æ”¶æ–‡ä»¶å†…å®¹ã€‚ä½†æ˜¯ï¼Œè¿™ç§åšæ³•å·²ç»ä¸è¢«æ¨èå¹¶ä¸”å·²ç»æ ‡è®°ä¸ºå·²åºŸå¼ƒï¼ˆdeprecatedï¼‰ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”ä¸ Buffer å¯¹è±¡çš„å·¥ä½œæ–¹å¼ä¸ä¸€è‡´ã€‚</p><p>å®é™…ä¸Šï¼Œå½“ Node.js æ›´åŠ æˆç†Ÿï¼Œå¼€å‘è€…ä»¬å€¾å‘äºä½¿ç”¨ Bufferï¼ˆç¼“å†²åŒºï¼‰æ¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®æµï¼Œè€Œä¸æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œå› ä¸º Buffer æä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œçµæ´»æ€§ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥å¯¹æ¯”ä¸€ä¸‹æ—§å¼çš„ String æ¥å£å’Œæ–°çš„ Buffer æ¥å£ã€‚</p><p><strong>æ—§å¼ String æ¥å£ï¼ˆç°åœ¨å·²åºŸå¼ƒï¼‰ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> filePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/path/to/your/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">bytesRead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œstræ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†è¯»å–çš„æ–‡ä»¶å†…å®¹ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–°çš„ Buffer æ¥å£ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨allocè€Œä¸æ˜¯new Buffer()ï¼Œå› ä¸ºåè€…å·²ç»åºŸå¼ƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> filePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/path/to/your/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">bytesRead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åªå¤„ç†å®é™…è¯»å–çš„å­—èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">slice</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bytesRead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„æ¥å£ä¸­ï¼Œæˆ‘ä»¬å®Œå…¨ä¾èµ– Buffer å¯¹è±¡æ¥å¤„ç†æ•°æ®ï¼Œç„¶åæ ¹æ®å®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼ˆbytesReadï¼‰æ¥ç¡®å®šæœ‰æ•ˆçš„æ•°æ®èŒƒå›´ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±é¿å…äº†ä½¿ç”¨åºŸå¼ƒçš„ String æ¥å£ï¼Œå¹¶æé«˜äº†ä»£ç çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒDEP0014 æ˜¯ Node.js å¼€å‘å›¢é˜Ÿä¸ºäº†æå‡ä»£ç è´¨é‡å’Œæ€§èƒ½è€Œåšå‡ºçš„æ”¹å˜ã€‚å®ƒé¼“åŠ±å¼€å‘è€…ä½¿ç”¨æ›´ç°ä»£ã€æ›´é«˜æ•ˆçš„æ–¹æ³•æ¥å¤„ç†æ–‡ä»¶ I/O æ“ä½œã€‚åœ¨ç¼–å†™ Node.js ä»£ç æ—¶ï¼Œéµå¾ªæœ€æ–°çš„å®è·µå’Œ API ä½¿ç”¨æŒ‡å—ï¼Œå¯ä»¥ä¿è¯ä½ çš„ä»£ç æ›´åŠ ç¨³å®šå’Œå‰ç»ã€‚</p><h3 id="dep0015-fs-readsync-legacy-string-interface" tabindex="-1"><a class="header-anchor" href="#dep0015-fs-readsync-legacy-string-interface"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0015" target="_blank" rel="noopener noreferrer">DEP0015: fs.readSync legacy String interface</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæ¥è§£é‡Šä¸€ä¸‹è¿™æ®µè¯ä¸­çš„å…³é”®è¯ï¼š</p><ul><li><strong>Node.js v21.7.1</strong>ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„ Node.jsï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä¸»è¦ç”¨äºåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>fs.readSync</strong>ï¼šè¿™æ˜¯ Node.js ä¸­çš„<code>fs</code>ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåŒæ­¥åœ°è¯»å–æ–‡ä»¶ã€‚è¿™æ„å‘³ç€ç¨‹åºä¼šåœ¨è¯»å–æ–‡ä»¶æ“ä½œå®Œæˆä¹‹å‰åœæ­¢æ‰§è¡Œåç»­ä»£ç ã€‚</li><li><strong>legacy String interface</strong>ï¼š&quot;legacy&quot;é€šå¸¸æŒ‡çš„æ˜¯å·²ç»è¿‡æ—¶æˆ–è€…ä¸å†æ¨èä½¿ç”¨çš„ä¸œè¥¿ã€‚åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œ&quot;interface&quot;æ˜¯æŒ‡è½¯ä»¶ç»„ä»¶å¦‚ä½•ç›¸äº’é€šä¿¡çš„å®šä¹‰ã€‚è¿™é‡Œçš„â€œString interfaceâ€æŒ‡çš„å°±æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼ä¸ fs.readSync æ–¹æ³•è¿›è¡Œäº¤äº’ã€‚</li><li><strong>DEP0015</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç”¨äºæ ‡è®° Node.js ä¸­è¢«å¼ƒç”¨(deprecated)çš„ç‰¹æ€§ã€‚å½“ Node.js å†³å®šæŸä¸ªåŠŸèƒ½ä¸å†æ¨èä½¿ç”¨å¹¶ä¸”æœªæ¥å¯èƒ½ä¼šè¢«ç§»é™¤æ—¶ï¼Œä¼šåˆ†é…ä¸€ä¸ªç±»ä¼¼çš„ç¼–å·ã€‚</li></ul><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è§£é‡Šè¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼š</p><p>åœ¨ Node.js è¾ƒæ—©çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>fs.readSync</code>æ–¹æ³•å…è®¸å¼€å‘è€…ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°æ¥ç›´æ¥å¤„ç†æ–‡ä»¶è¯»å–ã€‚è¿™ä¸ªæ¥å£ï¼ˆå³ String interfaceï¼‰æœ€åˆæ˜¯ä¸ºäº†æ–¹ä¾¿è€Œè®¾è®¡çš„ï¼Œå› æ­¤åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶å¯ä»¥ç›´æ¥æä¾›ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä½œä¸ºå­—ç¬¦ä¸²ã€‚</p><p>ç„¶è€Œï¼Œéšç€ Node.js çš„å‘å±•ï¼Œæ›´åŠ å¼ºå¤§å’Œçµæ´»çš„ Buffer å’Œ Stream å¯¹è±¡è¢«å¼•å…¥ï¼Œå®ƒä»¬æä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œæ§åˆ¶ã€‚å› æ­¤ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥çš„æ–¹å¼è¢«è®¤ä¸ºæ˜¯â€œé—ç•™â€çš„ï¼Œå¹¶ä¸”æœ‰è¢«æ›¿ä»£çš„é£é™©ã€‚</p><p>æ‰€ä»¥ï¼Œè­¦å‘Š<code>DEP0015: fs.readSync legacy String interface</code>çš„å®é™…å«ä¹‰æ˜¯ï¼ŒNode.js å®˜æ–¹ä¸å†æ¨èä½¿ç”¨<code>fs.readSync</code>æ–¹æ³•çš„å­—ç¬¦ä¸²æ¥å£ï¼Œå¹¶ä¸”å°†æ¥å¯èƒ½ä¼šä» Node.js ä¸­å®Œå…¨ç§»é™¤è¿™ç§ç”¨æ³•ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ç¤ºä¾‹æ¥çœ‹çœ‹è¿™ä¸ªå˜åŒ–ï¼š</p><p><strong>è€å¼çš„è¢«å¼ƒç”¨çš„ç”¨æ³•</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/myfile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç å°è¯•ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºè·¯å¾„æ¥è¯»å–æ–‡ä»¶ï¼Œè¿™æ˜¯è¢«å¼ƒç”¨çš„ç”¨æ³•ã€‚</p><p><strong>æ¨èçš„ç°ä»£ç”¨æ³•</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/myfile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å¼€æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶æè¿°ç¬¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªBufferæ¥å­˜å‚¨è¯»å–çš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bytesRead</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†Bufferè½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bytesRead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸è¦å¿˜è®°å…³é—­æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">closeSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ›´æ–°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰“å¼€æ–‡ä»¶ï¼Œç„¶åç”¨ä¸€ä¸ª Buffer å¯¹è±¡æ¥è¯»å–æ•°æ®ï¼Œæœ€åæŠŠè¿™ä¸ª Buffer è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚è¿™æ ·åšæ›´åŠ çµæ´»ï¼Œä¹Ÿæ›´æ¨èï¼Œå› ä¸ºå®ƒå…è®¸æ›´å¥½åœ°æ§åˆ¶å†…å­˜æ¶ˆè€—å’Œæ–‡ä»¶è¯»å–çš„ç»†èŠ‚ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨ Node.js v21.7.1 æˆ–è€…å…¶å®ƒæ–°ç‰ˆ Node.jsï¼Œå¹¶ä¸”çœ‹åˆ°äº†å…³äº<code>DEP0015</code>çš„è­¦å‘Šï¼Œé‚£ä¹ˆä½ åº”è¯¥è€ƒè™‘æ›´æ–°ä½ çš„ä»£ç ï¼Œä¸å†ä½¿ç”¨å­—ç¬¦ä¸²æ¥å£æ¥è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œè€Œæ˜¯ä½¿ç”¨ Buffer å’Œæ–‡ä»¶æè¿°ç¬¦æ¥æ›´åŠ å®‰å…¨å’Œé«˜æ•ˆåœ°å¤„ç†æ–‡ä»¶è¯»å–ã€‚</p><h3 id="dep0016-global-root" tabindex="-1"><a class="header-anchor" href="#dep0016-global-root"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0016" target="_blank" rel="noopener noreferrer">DEP0016: GLOBAL/root</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>DEP0016</code> æ˜¯ä¸€ä¸ªç‰¹å®šçš„<strong>å¼ƒç”¨è­¦å‘Šæ ‡è¯†ç¬¦</strong>ã€‚è¿™ä¸ªæ ‡è¯†ç¬¦å‘ŠçŸ¥å¼€å‘è€… <code>GLOBAL</code> å’Œ <code>root</code> è¿™ä¸¤ä¸ªå…¨å±€å˜é‡å·²ç»è¢«å¼ƒç”¨äº†ï¼Œå¹¶ä¸”åœ¨æœªæ¥å¯èƒ½ä¼šä» Node.js ä¸­å®Œå…¨ç§»é™¤ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯â€œå¼ƒç”¨â€ï¼ˆDeprecationï¼‰ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–è€…å®è·µä¸å†æ¨èä½¿ç”¨æ—¶ï¼Œå®ƒå°±ä¼šè¢«æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€è™½ç„¶è¯¥åŠŸèƒ½ç°åœ¨è¿˜å¯ç”¨ï¼Œä½†å®ƒå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œå› æ­¤å¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>å…·ä½“åˆ° <code>DEP0016</code> è¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼š</p><ul><li><code>GLOBAL</code>ï¼šåœ¨æ—©æœŸçš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œ<code>GLOBAL</code> ç”¨æ¥ä½œä¸ºå…¨å±€å¯¹è±¡çš„å¼•ç”¨ï¼Œç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„ <code>window</code> å¯¹è±¡ã€‚ä½ å¯ä»¥é€šè¿‡ <code>GLOBAL</code> è®¿é—®å’Œè®¾ç½®å…¨å±€èŒƒå›´å†…çš„å˜é‡ã€‚</li><li><code>root</code>ï¼šä¸ <code>GLOBAL</code> ç±»ä¼¼ï¼Œ<code>root</code> ä¹Ÿæ˜¯å…¨å±€å¯¹è±¡çš„å¦ä¸€ä¸ªåˆ«åã€‚</li></ul><p>ç„¶è€Œï¼Œä½¿ç”¨è¿™äº›åˆ«åæ˜¯ä¸æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„ä¸æ¸…æ™°å’Œæ½œåœ¨çš„å‘½åå†²çªã€‚Node.js å®˜æ–¹æ¨èä½¿ç”¨ <code>global</code> è¿™ä¸ªæ ‡å‡†çš„å…¨å±€å˜é‡åæ¥å–ä»£ <code>GLOBAL</code> å’Œ <code>root</code>ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­ï¼š</p><p>å¼ƒç”¨å‰çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">GLOBAL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  baseUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­è®¿é—®è¿™ä¸ªå…¨å±€å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">GLOBAL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">baseUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šhttp://example.com/api</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹åéµå¾ªæœ€æ–°æ ‡å‡†çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  baseUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­è®¿é—®è¿™ä¸ªå…¨å±€å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">baseUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šhttp://example.com/api</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>global</code> æ¥å®šä¹‰å’Œè®¿é—®å…¨å±€å˜é‡ã€‚è¿™æ ·çš„åšæ³•æ›´åŠ è§„èŒƒï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†åœ¨æœªæ¥ç‰ˆæœ¬çš„ Node.js ä¸­å¯èƒ½å‡ºç°çš„å…¼å®¹æ€§é—®é¢˜ã€‚å¦‚æœä½ æ­£åœ¨ç¼–å†™æ–°ä»£ç æˆ–è€…ç»´æŠ¤æ—§ä»£ç ï¼Œç¡®ä¿é¿å…ä½¿ç”¨ <code>GLOBAL</code> å’Œ <code>root</code>ï¼Œå¹¶ä¸”æ”¹ç”¨ <code>global</code>ã€‚è¿™ä¼šä½¿ä½ çš„ä»£ç æ›´ä¸ºå¥å£®å’Œæœªæ¥è¯æ˜ï¼ˆfuture-proofï¼‰ã€‚</p><h3 id="dep0017-intl-v8breakiterator" tabindex="-1"><a class="header-anchor" href="#dep0017-intl-v8breakiterator"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0017" target="_blank" rel="noopener noreferrer">DEP0017: Intl.v8BreakIterator</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘å°†å°½å¯èƒ½é€šä¿—æ˜“æ‡‚åœ°ä¸ºæ‚¨è§£é‡Š Node.js ä¸­çš„ DEP0017 å¼ƒç”¨è­¦å‘Šã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯å¼ƒç”¨ï¼ˆDeprecationï¼‰ï¼šåœ¨è½¯ä»¶é¢†åŸŸï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–è€…æ¥å£ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”æœªæ¥å¯èƒ½ä¼šè¢«ç§»é™¤æ—¶ï¼Œæˆ‘ä»¬ç§°å®ƒè¢«â€œå¼ƒç”¨â€ã€‚å¼€å‘äººå‘˜åº”è¯¥é¿å…ä½¿ç”¨è¿™äº›è¢«å¼ƒç”¨çš„åŠŸèƒ½ï¼Œå¹¶é€æ¸è¿ç§»åˆ°æ–°çš„ã€æ¨èçš„æ–¹æ³•ä¸Šã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äºä½ é—®åˆ°çš„å…·ä½“é—®é¢˜ï¼šDEP0017 æŒ‡çš„æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šï¼Œå®ƒå’Œ <code>Intl.v8BreakIterator</code> è¿™ä¸ª JavaScript çš„å›½é™…åŒ– API æœ‰å…³ã€‚<code>Intl</code> æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œæä¾›äº†å¾ˆå¤šå¯¹ç¨‹åºè¿›è¡Œæœ¬åœ°åŒ–ï¼ˆå³æ ¹æ®ç”¨æˆ·è¯­è¨€å’Œåœ°åŒºåå¥½æ ¼å¼åŒ–æ•°æ®ï¼‰çš„èƒ½åŠ›ã€‚</p><p><code>v8BreakIterator</code> æ˜¯ <code>Intl</code> å¯¹è±¡ä¸‹çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ˜¯ V8 JavaScript å¼•æ“æä¾›çš„ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ã€‚V8 æ˜¯ Node.js åº•å±‚ä½¿ç”¨çš„ JavaScript å¼•æ“ï¼Œå®ƒè´Ÿè´£è§£æå’Œæ‰§è¡Œ JavaScript ä»£ç ã€‚<code>v8BreakIterator</code> è¢«ç”¨äºè¯†åˆ«æ–‡æœ¬ä¸­çš„è¾¹ç•Œï¼Œæ¯”å¦‚å¥å­ã€å•è¯ç­‰ã€‚</p><p>ä½†æ˜¯ï¼Œå‡ºäºå¤šç§åŸå› ï¼ˆæ¯”å¦‚ï¼šç»´æŠ¤éš¾åº¦ã€æ ‡å‡†åŒ–å›°éš¾ã€æ€§èƒ½é—®é¢˜ï¼‰ï¼ŒNode.js å›¢é˜Ÿå†³å®šå¼ƒç”¨ <code>Intl.v8BreakIterator</code> è¿™ä¸ª APIã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„ä»£ç ä¸­ä½¿ç”¨äº† <code>Intl.v8BreakIterator</code> ï¼Œåˆ™éœ€è¦å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><ol><li>å¦‚æœä½ ä»¥å‰ç”¨ <code>Intl.v8BreakIterator</code> æ¥æ‰¾å‡ºæ–‡æœ¬ä¸­çš„å•è¯è¾¹ç•Œï¼Œä»£ç å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> iterator</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Intl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">v8BreakIterator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;en-US&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;word&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">iterator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">adoptText</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> boundaries</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> boundary</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ((</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">boundary</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> iterator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;done&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  boundaries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">boundary</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">boundaries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ä¼šæ‰“å°å‡ºå•è¯çš„èµ·å§‹ä½ç½®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ä½†æ˜¯ç°åœ¨ï¼Œç”±äº <code>Intl.v8BreakIterator</code> å·²ç»è¢«å¼ƒç”¨ï¼Œä½ éœ€è¦ç”¨å…¶ä»–æ–¹å¼å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚Node.js å’Œç°ä»£ JavaScript æä¾›äº†å…¶ä»–çš„å›½é™…åŒ– APIï¼Œæ¯”å¦‚ <code>Intl.Segmenter</code>ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥æ›¿æ¢ <code>Intl.v8BreakIterator</code>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> segmenter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Intl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Segmenter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;en-US&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">granularity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;word&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> segments</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> segmenter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">segment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> boundaries</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> segment</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> segments</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  boundaries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">segment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">boundaries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŒæ ·ä¼šæ‰“å°å‡ºå•è¯çš„èµ·å§‹ä½ç½®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä» <code>Intl.v8BreakIterator</code> è¿ç§»åˆ°äº† <code>Intl.Segmenter</code>ï¼Œåè€…æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–å¹¶å¹¿æ³›æ”¯æŒçš„ APIï¼Œè€Œä¸”å®ƒæ˜¯æœªæ¥çš„å‘å±•æ–¹å‘ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>DEP0017: Intl.v8BreakIterator</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œæç¤ºå¼€å‘è€…ä¸è¦å†ä½¿ç”¨è¿™ä¸ªè¿‡æ—¶çš„ APIï¼Œå¹¶è¿ç§»åˆ°å…¶ä»–æ›´ç¨³å®šå’Œæ ‡å‡†åŒ–çš„å›½é™…åŒ– APIï¼Œæ¯”å¦‚ <code>Intl.Segmenter</code>ã€‚å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œäº†è§£å¼ƒç”¨æœºåˆ¶å’Œå¦‚ä½•å“åº”è¿™äº›å˜åŒ–æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒæœ‰åŠ©äºç¼–å†™æ›´æŒä¹…ã€å¯ç»´æŠ¤å’Œå…¼å®¹çš„ä»£ç ã€‚</p><h3 id="dep0018-unhandled-promise-rejections" tabindex="-1"><a class="header-anchor" href="#dep0018-unhandled-promise-rejections"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0018" target="_blank" rel="noopener noreferrer">DEP0018: Unhandled promise rejections</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä¸€ä¸ª <code>Promise</code> æ˜¯ä¸€ç§ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„å¯¹è±¡ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª <code>Promise</code>ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š<code>resolve</code> å’Œ <code>reject</code>ã€‚è¿™äº›å‚æ•°ä¹Ÿæ˜¯å‡½æ•°ï¼Œå½“å¼‚æ­¥æ“ä½œæˆåŠŸå®Œæˆæ—¶ï¼Œä½ è°ƒç”¨ <code>resolve</code> å‡½æ•°ï¼›è€Œå½“æ“ä½œå¤±è´¥æˆ–é‡åˆ°é”™è¯¯æ—¶ï¼Œä½ è°ƒç”¨ <code>reject</code> å‡½æ•°ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª <code>Promise</code> å¹¶ä¸”å®ƒè¢«æ‹’ç»äº†ï¼ˆå³è°ƒç”¨äº† <code>reject</code>ï¼‰ï¼Œä½†æ˜¯ä½ æ²¡æœ‰ç›¸åº”åœ°å»å¤„ç†è¿™ä¸ªæ‹’ç»ï¼ˆé€šå¸¸é€šè¿‡ <code>.catch()</code> æ–¹æ³•æˆ–è€…åœ¨ä¸€ä¸ª <code>async</code> å‡½æ•°ä¸­ä½¿ç”¨ <code>try/catch</code> ç»“æ„ï¼‰ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸€ä¸ªæœªå¤„ç†çš„ Promise æ‹’ç»ï¼ˆUnhandled promise rejectionï¼‰ã€‚</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¦‚æœå‡ºç°äº†æœªå¤„ç†çš„æ‹’ç»ï¼ŒNode é»˜è®¤ä¼šå‘å‡ºè­¦å‘Šï¼Œä½†ç¨‹åºä»ç„¶ä¼šç»§ç»­è¿è¡Œã€‚ç„¶è€Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›éš¾ä»¥è¿½è¸ªçš„é—®é¢˜ï¼Œå› ä¸ºä½ çš„ç¨‹åºåœ¨æŸäº›æ–¹é¢å·²ç»ä¸æŒ‰é¢„æœŸå·¥ä½œäº†ï¼Œä½†å®ƒä¾ç„¶ä¿æŒç€è¿è¡ŒçŠ¶æ€ï¼Œè¿™å¯èƒ½ä¼šéšè—é”™è¯¯æˆ–å¸¦æ¥å…¶ä»–çš„å‰¯ä½œç”¨ã€‚</p><p>å› æ­¤ï¼Œåœ¨ Node.js 15 ç‰ˆæœ¬å¼€å§‹ï¼Œæœªå¤„ç†çš„ Promise æ‹’ç»é»˜è®¤ä¼šå¯¼è‡´ Node.js è¿›ç¨‹é€€å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´åŠ ä¸¥æ ¼çš„å¤„ç†æ–¹å¼ã€‚è¿™æ„å‘³ç€å¦‚æœä½ çš„ä»£ç é‡Œæœ‰ä¸€ä¸ªæœªå¤„ç†çš„ Promise æ‹’ç»ï¼Œå¹¶ä¸”ä½ æ²¡æœ‰æ˜ç¡®åœ°é€šè¿‡ <code>process.on(&#39;unhandledRejection&#39;, handler)</code> å¤„ç†å®ƒï¼Œé‚£ä¹ˆ Node.js ä¼šå°†å…¶è§†ä½œä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”ä¼šå°†è¿›ç¨‹ä»¥éé›¶çŠ¶æ€ç é€€å‡ºï¼Œå³ç±»ä¼¼äºé‡åˆ°æœªæ•è·å¼‚å¸¸æ—¶çš„è¡Œä¸ºã€‚</p><p>DEP0018 å°±æ˜¯å…³äºè¿™ä¸ªè¡Œä¸ºçš„å¼ƒç”¨è­¦å‘Šã€‚è¿™æ„å‘³ç€æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä¿ç•™æœªå¤„ç†çš„ Promise æ‹’ç»ä¸ä¼šæœ‰ä»»ä½•é»˜è®¤çš„åå¤‡è¡Œä¸ºï¼ˆå¦‚æ‰“å°è­¦å‘Šï¼‰ï¼Œè€Œæ˜¯ç›´æ¥å¯¼è‡´è¿›ç¨‹é€€å‡ºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doSomethingAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€è®¿é—®æ•°æ®åº“ç­‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Success!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆåŠŸçš„æƒ…å†µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Failure!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤±è´¥çš„æƒ…å†µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doSomethingAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœæˆåŠŸï¼Œæ‰“å°ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å¤„ç† .catch æˆ– try/catch çš„æƒ…å†µã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœ Promise è¢«æ‹’ç»ï¼ŒNode.js å°†æ‰“å°ä¸€ä¸ªè­¦å‘Šå¹¶ä¸”æœ€ç»ˆé€€å‡ºè¿›ç¨‹ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦æ­£ç¡®å¤„ç†æœªå¤„ç†çš„æ‹’ç»ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·æ·»åŠ  <code>.catch()</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doSomethingAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœæˆåŠŸï¼Œæ‰“å°ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœå¤±è´¥ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…åœ¨ <code>async/await</code> çš„ç¯å¢ƒä¸­ä½¿ç”¨ <code>try/catch</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doSomethingAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">handleAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡‡ç”¨ä¸Šè¿°ä»»ä¸€ç§æ–¹æ³•ï¼Œä½ éƒ½èƒ½å¤Ÿå¦¥å–„å¤„ç† Promise çš„æ‹’ç»æƒ…å†µï¼Œä»è€Œé¿å…å› ä¸ºæœªå¤„ç†çš„ Promise æ‹’ç»è€Œå¯¼è‡´çš„ Node.js è¿›ç¨‹é€€å‡ºã€‚</p><h3 id="dep0019-require-resolved-outside-directory" tabindex="-1"><a class="header-anchor" href="#dep0019-require-resolved-outside-directory"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0019" target="_blank" rel="noopener noreferrer">DEP0019: require(&#39;.&#39;) resolved outside directory</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Š Node.js ä¸­çš„ DEP0019 å¼ƒç”¨è­¦å‘Šã€‚è¿™ä¸ªè­¦å‘Šæ˜¯å…³äº Node.js æ¨¡å—è§£ææœºåˆ¶ä¸­çš„ä¸€ç§ç‰¹å®šç”¨æ³•ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæ¨¡å—ç³»ç»Ÿå…è®¸ä½ å¯¼å…¥ï¼ˆrequireï¼‰å…¶ä»–æ–‡ä»¶æˆ–æ¨¡å—ä»¥ä¾¿é‡ç”¨ä»£ç ã€‚å½“ä½ ä½¿ç”¨ <code>require()</code> å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªæ–‡ä»¶è·¯å¾„æ¥æŒ‡å®šæƒ³è¦åŠ è½½çš„æ¨¡å—ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ ä¼šæä¾›ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ <code>./module</code>ï¼‰æˆ–ç»å¯¹è·¯å¾„ï¼ˆå¦‚ <code>/path/to/module</code>ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ¨¡å—åï¼ˆå¦‚ <code>express</code>ï¼‰ã€‚</p><p>åœ¨æŸäº›æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªéæ ‡å‡†çš„ç‰¹æ€§ï¼Œå¦‚æœä½ åœ¨ <code>require()</code> å‡½æ•°ä¸­åªå†™äº†ä¸€ä¸ªç‚¹ï¼ˆ<code>.</code>ï¼‰ï¼ŒNode.js ä¼šå°è¯•åœ¨çˆ¶ç›®å½•ä¸­å¯»æ‰¾ <code>package.json</code> æˆ–è€… <code>index.js</code> æ–‡ä»¶ã€‚è¿™ç§è¡Œä¸ºæ˜¯ä¸å¤Ÿæ˜ç¡®çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¼•èµ·æ··æ·†æˆ–é”™è¯¯ï¼Œå› ä¸ºå®ƒä½¿å¾—æ¨¡å—çš„ä½ç½®å’Œé¡¹ç›®ç»“æ„ç´§å¯†è€¦åˆã€‚</p><p>DEP0019 è­¦å‘Šå°±æ˜¯è¯´ï¼Œè¿™ç§é€šè¿‡ <code>require(&#39;.&#39;)</code> è§£æåˆ°å½“å‰ç›®å½•å¤–éƒ¨çš„åšæ³•ç°åœ¨è¢«å¼ƒç”¨äº†ã€‚æ„æ€æ˜¯ï¼Œåœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨ <code>require(&#39;.&#39;)</code> è¿™æ ·çš„ä»£ç å¯èƒ½ä¼šåœæ­¢å·¥ä½œæˆ–è€…æŠ›å‡ºé”™è¯¯ã€‚</p><p>å®é™…ä¸Šï¼Œä½ åº”è¯¥ç›´æ¥æŒ‡å®šä½ æƒ³è¦å¯¼å…¥çš„å…·ä½“æ–‡ä»¶æˆ–ç›®å½•ï¼Œè€Œä¸æ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ªç‚¹ï¼ˆ<code>.</code>ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š</p><p><strong>é”™è¯¯çš„ç”¨æ³•ï¼ˆå¯èƒ½è§¦å‘ DEP0019 è­¦å‘Šï¼‰ï¼š</strong></p><p>å‡è®¾ä½ çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/project</span></span>
<span class="line"><span>    /lib</span></span>
<span class="line"><span>        module.js</span></span>
<span class="line"><span>    index.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ åœ¨ <code>/project/lib/module.js</code> ä¸­å†™ä¸‹ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ç§åšæ³•æ˜¯ä¸æ¨èçš„ï¼Œå¯èƒ½åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ä¸å†æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> main</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„ <code>require(&#39;.&#39;)</code> å¯èƒ½ä¼šè§£æåˆ° <code>/project/index.js</code>ï¼Œè¿™æ˜¯ Node.js ä¹‹å‰çš„éæ ‡å‡†è¡Œä¸ºã€‚</p><p><strong>æ­£ç¡®çš„ç”¨æ³•ï¼š</strong></p><p>ä½ åº”è¯¥æ˜ç¡®æŒ‡å®šä½ æƒ³è¦å¯¼å…¥çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦ä» <code>/project/lib/module.js</code> å¯¼å…¥ <code>/project/index.js</code>ï¼Œä½ åº”è¯¥å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜ç¡®æŒ‡å®šè¦å¯¼å…¥çš„æ¨¡å—çš„ç›¸å¯¹è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> main</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;../index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼ŒDEP0019 æ˜¯ Node.js çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œæé†’å¼€å‘è€…ä¸è¦ä½¿ç”¨ <code>require(&#39;.&#39;)</code> æ¥è§£æåˆ°å½“å‰ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ã€‚ä½ åº”è¯¥å§‹ç»ˆä½¿ç”¨æ¸…æ™°çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„æ¥å¯¼å…¥æ¨¡å—ï¼Œè¿™æ ·å¯ä»¥ä¿æŒä»£ç çš„æ¸…æ™°æ€§å’Œæœªæ¥çš„å…¼å®¹æ€§ã€‚</p><h3 id="dep0020-server-connections" tabindex="-1"><a class="header-anchor" href="#dep0020-server-connections"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0020" target="_blank" rel="noopener noreferrer">DEP0020: Server.connections</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘å¸®ä½ äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ DEP0020 è¿™ä¸ªå¼ƒç”¨è­¦å‘Šã€‚</p><p>DEP0020 æ˜¯ä¸€ä¸ªç‰¹å®šç¼–å·çš„è­¦å‘Šï¼Œå®ƒå‘ŠçŸ¥å¼€å‘è€… <code>Server.connections</code> å±æ€§å·²ç»è¢«åºŸå¼ƒã€‚åœ¨ Node.js çš„æ—©äº›ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå±æ€§ä¼šè¢«ç”¨æ¥è·å–å½“å‰æœåŠ¡å™¨ä¸Šç°æœ‰çš„è¿æ¥æ•°ã€‚ç„¶è€Œï¼Œéšç€ Node.js çš„å‘å±•ï¼Œè¿™ä¸ªå±æ€§ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨å‘¢ï¼Ÿå› ä¸º <code>Server.connections</code> å¹¶ä¸æ˜¯æ‰€æœ‰æœåŠ¡å™¨ç±»å‹éƒ½æ”¯æŒçš„å±æ€§ï¼ˆä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ HTTP/2 æ—¶ï¼Œè¯¥å±æ€§å°±ä¸é€‚ç”¨ï¼‰ï¼Œè€Œä¸”å®ƒä¹Ÿä¸èƒ½å®Œå…¨å‡†ç¡®åœ°è¡¨ç¤ºæœåŠ¡å™¨çš„çŠ¶æ€ã€‚å¯¹äºéœ€è¦è·Ÿè¸ªæœåŠ¡å™¨è¿æ¥æ•°çš„ç”¨æˆ·æ¥è¯´ï¼ŒNode.js æä¾›äº†æ›´æ ‡å‡†ã€é€šç”¨å’Œæ¨èçš„æ–¹å¼ï¼Œå³ä½¿ç”¨ <code>server.getConnections(callback)</code> æ–¹æ³•ã€‚</p><p>ä¸‹é¢æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸¤ç§æ–¹å¼çš„åŒºåˆ«ï¼š</p><p><strong>ä»¥å‰ä½¿ç”¨ <code>Server.connections</code> çš„æ–¹æ³•ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸æ¨èçš„æ–¹å¼ï¼šç›´æ¥è·å– Server.connections æ¥æŸ¥çœ‹å½“å‰çš„è¿æ¥æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Current number of connections:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">connections</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡ <code>server.connections</code> è·å–äº†å½“å‰æœåŠ¡çš„è¿æ¥æ•°ã€‚ä½†è¿™æ˜¯ä¸æ¨èçš„åšæ³•ï¼Œå› ä¸ºè¿™ä¸ªå±æ€§å·²ç»è¢«åºŸå¼ƒã€‚</p><p><strong>æ¨èä½¿ç”¨ <code>server.getConnections(callback)</code> çš„æ–¹æ³•ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„æ–¹å¼ï¼šé€šè¿‡ server.getConnections è·å–å½“å‰çš„è¿æ¥æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getConnections</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Current number of connections:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¿®æ”¹åçš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>server.getConnections(callback)</code> æ–¹æ³•æ¥å¼‚æ­¥è·å–æœåŠ¡å™¨çš„è¿æ¥æ•°ã€‚å½“å›è°ƒå‡½æ•° <code>callback</code> è¢«æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šæ”¶åˆ°ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å¯èƒ½å‡ºç°çš„é”™è¯¯ <code>err</code>ï¼Œå¦ä¸€ä¸ªæ˜¯è¿æ¥æ•° <code>count</code>ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´å®‰å…¨ã€æ›´å…¼å®¹åœ°äº†è§£æœåŠ¡å™¨çš„è¿æ¥æƒ…å†µã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå½“ä½ çœ‹åˆ° DEP0020 è­¦å‘Šæ—¶ï¼Œåº”å½“é¿å…ä½¿ç”¨ <code>Server.connections</code> å±æ€§ï¼Œè½¬è€Œä½¿ç”¨ <code>server.getConnections(callback)</code> æ–¹æ³•æ¥è·å–æœåŠ¡å™¨çš„è¿æ¥æ•°ã€‚è¿™æ ·å¯ä»¥ä¿è¯ä»£ç çš„ç¨³å®šæ€§å¹¶ä¸”ä¸ Node.js çš„æœªæ¥ç‰ˆæœ¬ä¿æŒå…¼å®¹ã€‚</p><h3 id="dep0021-server-listenfd" tabindex="-1"><a class="header-anchor" href="#dep0021-server-listenfd"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0021" target="_blank" rel="noopener noreferrer">DEP0021: Server.listenFD</a></span></a></h3><p>é¦–å…ˆï¼Œä¸ºäº†ç†è§£ <code>DEP0021</code> è¿™ä¸ªè­¦å‘Šï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Node.js ä¸­çš„â€œå¼ƒç”¨â€(deprecation)æ¦‚å¿µã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–è€… API å› ä¸ºå„ç§åŸå› ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”è®¡åˆ’åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤æ—¶ï¼Œå°±è¢«æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€ã€‚Node.js é€šè¿‡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ä»£ç ï¼ˆå¦‚ï¼šDEP0021ï¼‰æ¥æ ‡è¯†è¿™äº›å¼ƒç”¨çš„åŠŸèƒ½ã€‚</p><p>åœ¨ä½ æåˆ°çš„ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œâ€œDEP0021â€æ˜¯æŒ‡ <code>Server.listenFD()</code> æ–¹æ³•çš„å¼ƒç”¨ã€‚è€Œ <code>Server.listenFD</code> æ˜¯ Node.js æ—©æœŸä¸ºæœåŠ¡å™¨åˆ›å»ºç›‘å¬ç«¯å£çš„æ–¹å¼ä¹‹ä¸€ï¼Œå®ƒå…è®¸ Node.js ç›´æ¥é€šè¿‡æ–‡ä»¶æè¿°ç¬¦(File Descriptorï¼ŒFD)æ¥ç›‘å¬ç½‘ç»œæˆ–è€… UNIX å¥—æ¥å­—ã€‚</p><p>æ–‡ä»¶æè¿°ç¬¦åœ¨ Unix å’Œç±» Unix ç³»ç»Ÿä¸­æ˜¯ä¸€ä¸ªéå¸¸åº•å±‚çš„æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿåˆ†é…çš„ç´¢å¼•ï¼Œç”¨äºè®¿é—®æ–‡ä»¶æˆ–è€… I/O èµ„æºï¼Œæ¯”å¦‚æ‰“å¼€çš„æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ã€‚ä½†è¿™ä¸ªæ–¹æ³•å¹¶ä¸ç›´è§‚ï¼Œä¹Ÿä¸æ˜¯è·¨å¹³å°çš„ï¼Œå¹¶ä¸”å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œç›´æ¥ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦åˆ›å»ºæœåŠ¡å™¨ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ã€‚</p><p>é€šå¸¸ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹ä½¿ç”¨ <code>listen()</code> æ–¹æ³•å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://127.0.0.1:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ˜¯ä¼ é€’äº†ä¸€ä¸ªç«¯å£å·ï¼ˆ3000ï¼‰ï¼Œä»¥åŠä¸€ä¸ª IP åœ°å€ï¼ˆ&#39;127.0.0.1&#39;ï¼‰æ¥å‘Šè¯‰æœåŠ¡å™¨åº”è¯¥ç›‘å¬å“ªä¸ªåœ°å€å’Œç«¯å£ã€‚å¬ç¨‹åºå‘˜å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£å’Œå®ç°ã€‚</p><p>ç”±äº <code>Server.listenFD</code> æ–¹æ³•ä¸å¤Ÿå¸¸ç”¨ï¼Œéš¾ä»¥ç†è§£å’Œç»´æŠ¤ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜ï¼ŒNode.js å¼€å‘å›¢é˜Ÿå†³å®šå¼ƒç”¨æ­¤æ–¹æ³•ã€‚è¿™æ„å‘³ç€æ–°çš„ Node.js ä»£ç åº”è¯¥é¿å…ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šè¢«å½»åº•ç§»é™¤ã€‚å¦‚æœä½ æ­£åœ¨ç»´æŠ¤è€æ—§çš„ä»£ç åº“ï¼Œä½ å¯èƒ½éœ€è¦æ›¿æ¢æ‰è¿™ä¸ªæ–¹æ³•ï¼Œä»¥é¿å…å°†æ¥å‡çº§ Node.js ç‰ˆæœ¬æ—¶å‡ºç°é—®é¢˜ã€‚</p><p>æœ€ç»ˆï¼Œä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œä½ ä¸å¤ªå¯èƒ½éœ€è¦ä½¿ç”¨åƒ <code>listenFD</code> è¿™æ ·çš„ä½çº§åˆ«æ–¹æ³•ã€‚åšæŒä½¿ç”¨æ ‡å‡†çš„ <code>listen()</code> æ–¹æ³•åˆ›å»ºæœåŠ¡å™¨å°±è¶³å¤Ÿäº†ï¼Œå¹¶ä¸”è¿™æ ·åšä½ çš„ä»£ç ä¼šæ›´æ¸…æ™°ã€æ›´å®¹æ˜“ç»´æŠ¤ã€‚</p><h3 id="dep0022-os-tmpdir" tabindex="-1"><a class="header-anchor" href="#dep0022-os-tmpdir"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0022" target="_blank" rel="noopener noreferrer">DEP0022: os.tmpDir()</a></span></a></h3><p>å¥½çš„ï¼ŒDEP0022 æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå®˜æ–¹å¼ƒç”¨è­¦å‘Šã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ&quot;å¼ƒç”¨&quot;ï¼ˆDeprecationï¼‰æ˜¯æŒ‡æŸä¸ªåŠŸèƒ½æˆ–è€…å®è·µä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤çš„è¿‡ç¨‹ã€‚</p><p>å…·ä½“åˆ° DEP0022ï¼Œè¿™ä¸ªè­¦å‘Šæ˜¯å…³äº <code>os.tmpDir()</code> è¿™ä¸ªæ–¹æ³•çš„å¼ƒç”¨ã€‚<code>os.tmpDir()</code> æ˜¯ Node.js ä¸­ <code>os</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–æ“ä½œç³»ç»Ÿçš„é»˜è®¤ä¸´æ—¶æ–‡ä»¶ç›®å½•ã€‚ç„¶è€Œï¼Œåœ¨ Node.js çš„åç»­ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å·²ç»è¢«æ–°çš„æ–¹æ³• <code>os.tmpdir()</code>ï¼ˆæ³¨æ„å°å†™çš„ &#39;d&#39;ï¼‰æ‰€å–ä»£ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šæœ‰å¼ƒç”¨å‘¢ï¼Ÿéšç€è½¯ä»¶çš„å‘å±•ï¼Œæœ‰äº›æ—§çš„æ–¹æ³•å¯èƒ½ä¸å†é€‚åˆç°ä»£çš„ç¼–ç¨‹å®è·µï¼Œæˆ–è€…å› ä¸ºå‘½åä¸ä¸€è‡´ã€æ€§èƒ½é—®é¢˜ç­‰åŸå› éœ€è¦è¢«æ›´æ–°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒNode.js å›¢é˜Ÿå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ–¹æ³• <code>os.tmpdir()</code> æ¥æ›¿æ¢æ—§çš„ <code>os.tmpDir()</code>ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ•´æ´å’Œä¸€è‡´æ€§ã€‚</p><p>ä¸‹é¢ç»™ä½ ä¸€ä¸ªä¾‹å­ï¼š</p><p>åœ¨ Node.js v21.7.1 ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç æ¥è·å–ä¸´æ—¶ç›®å½•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> tempDirectory</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tmpDir</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">tempDirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ä» Node.js v21.7.1 å¼€å§‹ï¼Œåº”è¯¥ä½¿ç”¨æ–°çš„ <code>os.tmpdir()</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> tempDirectory</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tmpdir</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨äº†å°å†™çš„ &#39;d&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">tempDirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®é™…è¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°ä¸´æ—¶ç›®å½•æ¥å­˜å‚¨é‚£äº›ä¸éœ€è¦æ°¸ä¹…ä¿å­˜çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š</p><ol><li>ç¼“å­˜æ–‡ä»¶ï¼šç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ç”Ÿæˆä¸€äº›åªåœ¨å½“å‰ä¼šè¯ä¸­éœ€è¦çš„æ•°æ®ã€‚</li><li>ä¸‹è½½çš„ä¸´æ—¶æ–‡ä»¶ï¼šå½“ä½ ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯èƒ½å…ˆå°†å…¶ä¿å­˜åœ¨ä¸´æ—¶ç›®å½•ï¼Œä¸‹è½½å®Œæˆåå†ç§»åˆ°æœ€ç»ˆç›®å½•ã€‚</li><li>ä¸´æ—¶é…ç½®ï¼šå¦‚æœä½ çš„åº”ç”¨éœ€è¦åˆ›å»ºä¸€äº›åŠ¨æ€ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é¦–å…ˆæ”¾åœ¨ä¸´æ—¶ç›®å½•ä¸­ã€‚</li></ol><p>é‡è¦çš„æ˜¯ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦ç•™æ„è¿™äº›å˜åŒ–ï¼Œä»¥ä¾¿åŠæ—¶æ›´æ–°æˆ‘ä»¬çš„ä»£ç åº“ï¼Œå‡å°‘å› è¿‡æ—¶çš„æ–¹æ³•å¯¼è‡´çš„æ½œåœ¨é—®é¢˜ã€‚åŒæ—¶ï¼Œå½“ Node.js å®£å¸ƒæŸä¸ªæ–¹æ³•å¼ƒç”¨æ—¶ï¼Œå®ƒé€šå¸¸ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒå‘åå…¼å®¹ï¼Œç»™å¼€å‘è€…è¶³å¤Ÿçš„æ—¶é—´å»åšå‡ºè°ƒæ•´ã€‚åœ¨ä½ å­¦ä¹ å’Œä½¿ç”¨ Node.js çš„è¿‡ç¨‹ä¸­ï¼Œå®šæœŸæ£€æŸ¥æ–‡æ¡£å’Œæ›´æ–°æ—¥å¿—å¯ä»¥å¸®åŠ©ä½ é¿å…ä½¿ç”¨å¼ƒç”¨çš„ç‰¹æ€§ã€‚</p><h3 id="dep0023-os-getnetworkinterfaces" tabindex="-1"><a class="header-anchor" href="#dep0023-os-getnetworkinterfaces"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0023" target="_blank" rel="noopener noreferrer">DEP0023: os.getNetworkInterfaces()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>os.getNetworkInterfaces()</code> æ˜¯ä¸€ä¸ªä» <code>os</code> æ¨¡å—æä¾›çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ç”¨äºè·å–ä¸»æœºä¸Šæ‰€æœ‰ç½‘ç»œæ¥å£çš„ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œåœ¨ Node.js çš„ v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆdeprecatedï¼‰ï¼Œæ„æ€æ˜¯å®ƒä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å¼€å‘è€…ä»¬ä¸é¼“åŠ±ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>å¼ƒç”¨ <code>os.getNetworkInterfaces()</code> çš„åŸå› æ˜¯å› ä¸ºå®ƒä¸å†è¢«è®¤ä¸ºæ˜¯ç»´æŠ¤ä¸»æœºç½‘ç»œæ¥å£æœ€å®‰å…¨æˆ–æœ€æœ‰æ•ˆçš„æ–¹å¼ï¼Œè€Œä¸”å¯èƒ½ä¼šæš´éœ²æ•æ„Ÿçš„ç³»ç»Ÿä¿¡æ¯ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>os.getNetworkInterfaces()</code> å‡½æ•°ï¼Œåœ¨å®ƒè¢«æ ‡è®°ä¸ºå¼ƒç”¨å‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–ä¸»æœºä¸Šæ‰€æœ‰ç½‘ç»œæ¥å£çš„ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> networkInterfaces</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getNetworkInterfaces</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">networkInterfaces</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ å°†çœ‹åˆ°ä¸€äº›å…³äºä½ è®¾å¤‡ä¸Šå„ä¸ªç½‘ç»œæ¥å£çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚ IP åœ°å€ã€å­ç½‘æ©ç ã€MAC åœ°å€ç­‰ã€‚</p><p>ç°åœ¨ï¼Œæ—¢ç„¶ <code>os.getNetworkInterfaces()</code> è¢«å¼ƒç”¨äº†ï¼ŒNode.js å®˜æ–¹æ¨èä½¿ç”¨æ–°çš„å‡½æ•° <code>os.networkInterfaces()</code> æ¥ä»£æ›¿å®ƒã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨æ–°çš„å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ–°çš„å‡½æ•°æ¥æ›¿ä»£å·²å¼ƒç”¨çš„ getNetworkInterfaces</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> networkInterfaces</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">networkInterfaces</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">networkInterfaces</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µæ–°çš„ä»£ç åšäº†åŒæ ·çš„äº‹æƒ…ï¼šåˆ—å‡ºäº†æ‰€æœ‰çš„ç½‘ç»œæ¥å£å’Œå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†æ˜¯ä½¿ç”¨äº†æ›´æ–°çš„ã€æ¨èçš„ APIã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå½“ä½ çœ‹åˆ° Node.js æ–‡æ¡£ä¸­æåˆ°æŸä¸ª API è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ï¼Œä½ åº”è¯¥å¼€å§‹è€ƒè™‘åœæ­¢ä½¿ç”¨å®ƒï¼Œå¹¶å¯»æ‰¾æ›¿ä»£çš„æ–¹æ³•ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç ä¼šéšç€ Node.js çš„å‘å±•è€ŒæŒç»­å…¼å®¹å’Œå®‰å…¨ã€‚</p><h3 id="dep0024-replserver-prototype-converttocontext" tabindex="-1"><a class="header-anchor" href="#dep0024-replserver-prototype-converttocontext"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0024" target="_blank" rel="noopener noreferrer">DEP0024: REPLServer.prototype.convertToContext()</a></span></a></h3><p>å¥½çš„ï¼Œåœ¨ Node.js ä¸­ï¼Œ&quot;DEPRECATED&quot;ï¼ˆå¼ƒç”¨ï¼‰çš„æ„æ€æ˜¯ï¼ŒæŸä¸ªåŠŸèƒ½æˆ–è€… API åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–è€…æ›¿æ¢ï¼Œå› æ­¤å»ºè®®ä½ ä¸è¦å†ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æˆ–è€…å¼€å§‹å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œæåˆ°äº†<code>REPLServer.prototype.convertToContext()</code>è¿™ä¸ªå‡½æ•°å·²ç»è¢«å¼ƒç”¨äº†ï¼Œè¿™å±äºä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚<code>REPLServer</code>æ˜¯ Node.js ä¸­ç”¨äºåˆ›å»ºä¸€ä¸ªäº¤äº’å¼æ‰§è¡Œç¯å¢ƒï¼ˆREPLï¼Œå³ Read-Eval-Print Loopï¼Œè¯»å–-æ±‚å€¼-è¾“å‡º å¾ªç¯ï¼‰çš„ç±»ï¼Œé€šå¸¸ç”¨äºè°ƒè¯•å’Œè¿è¡Œä»£ç ç‰‡æ®µã€‚</p><p><code>REPLServer.prototype.convertToContext()</code>è¿™ä¸ªå‡½æ•°ä¹‹å‰å¯èƒ½è¢«ä¸€äº›å¼€å‘è€…ç”¨æ¥åœ¨ REPL ä¼šè¯ä¸­åŠ¨æ€åœ°ä¿®æ”¹æˆ–è®¿é—®å˜é‡ä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯ç°åœ¨å®ƒè¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥é¿å…ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå®ƒå¯èƒ½ä¼šè¢«å½»åº•ç§»é™¤ã€‚</p><p>ä½œä¸ºç®€å•çš„ä¾‹å­ï¼šå‡è®¾åœ¨æ—©æœŸçš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šå†™è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> replServer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&gt; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æƒ³åœ¨REPLç¯å¢ƒä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">replServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">convertToContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç é€šè¿‡è°ƒç”¨<code>convertToContext</code>æ–¹æ³•ï¼ŒæŠŠä¸€ä¸ªåä¸º<code>foo</code>çš„å…¨å±€å˜é‡å¼•å…¥åˆ° REPL ç¯å¢ƒä¸­ï¼Œå¹¶èµ‹å€¼ä¸º<code>42</code>ã€‚ä½†æ˜¯ï¼Œè‡ªä»è¿™ä¸ª API è¢«å¼ƒç”¨åï¼Œå°±ä¸åº”è¯¥å†è¿™æ ·åšäº†ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœä½ éœ€è¦åœ¨ REPL ç¯å¢ƒä¸­æ·»åŠ å˜é‡æˆ–ä¿®æ”¹ä¸Šä¸‹æ–‡ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå®é™…ä¸Šï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ REPL ä¸­å£°æ˜å˜é‡ï¼Œå®ƒä»¬è‡ªç„¶å°±ä¼šæˆä¸º REPL çš„ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> replServer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&gt; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨REPLä¼šè¯ä¸­ç›´æ¥è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// &gt; let foo = 42</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ ·å°±å¯ä»¥åœ¨REPLç¯å¢ƒä¸­ä½¿ç”¨å˜é‡fooäº†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨<code>convertToContext()</code>æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ REPL ä¸­å£°æ˜å˜é‡ã€‚è¿™æ ·åšæ—¢å®‰å…¨åˆæ¨èï¼Œå› ä¸ºå®ƒç¬¦åˆ Node.js æœªæ¥ç‰ˆæœ¬çš„å…¼å®¹æ€§è¦æ±‚ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œå°±æ˜¯é¿å…ä½¿ç”¨å·²ç»è¢«æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€çš„ APIï¼Œä»¥é˜²åœ¨æœªæ¥çš„ Node.js æ›´æ–°ä¸­ä½ çš„ä»£ç å‡ºç°é—®é¢˜ã€‚å¯¹äº REPL ç¯å¢ƒçš„ä½¿ç”¨ï¼Œç›´æ¥åœ¨ REPL ä¸­æ“ä½œå’Œå£°æ˜å˜é‡æ˜¯æ›´åŠ æ¨èå’Œå®‰å…¨çš„æ–¹å¼ã€‚</p><h3 id="dep0025-require-node-sys" tabindex="-1"><a class="header-anchor" href="#dep0025-require-node-sys"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0025" target="_blank" rel="noopener noreferrer">DEP0025: require(&#39;node:sys&#39;)</a></span></a></h3><p>Node.js ä¸­çš„ DEP0025 æŒ‡çš„æ˜¯ä¸€ä¸ªå®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šï¼Œå…·ä½“æ¥è¯´æ˜¯å…³äº <code>require(&#39;node:sys&#39;)</code> çš„ä½¿ç”¨ã€‚æ‰€è°“â€œå¼ƒç”¨â€ï¼ˆDeprecatedï¼‰å°±æ˜¯å¼€å‘è€…ä¸æ¨èä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå®Œå…¨ç§»é™¤å®ƒã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>sys</code> æ¨¡å—å…¶å®æ˜¯ <code>util</code> æ¨¡å—çš„æ—©æœŸåˆ«åï¼Œè¿™æ„å‘³ç€ä»–ä»¬ä¸¤ä¸ªæä¾›äº†ç›¸åŒçš„åŠŸèƒ½ã€‚éšç€ Node.js çš„å‘å±•ï¼Œå¼€å‘å›¢é˜Ÿå†³å®šåªä¿ç•™ <code>util</code> æ¨¡å—ï¼Œå¹¶è®¡åˆ’é€æ¸æ·˜æ±° <code>sys</code> æ¨¡å—ã€‚</p><p>è¿™é‡Œæåˆ°çš„ <code>require(&#39;node:sys&#39;)</code> å°±æ˜¯æŒ‡åœ¨ä»£ç ä¸­é€šè¿‡ require å‡½æ•°å¼•å…¥ <code>sys</code> æ¨¡å—ã€‚ç”±äº <code>sys</code> æ¨¡å—å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œä½ åº”è¯¥é¿å…åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”æŠŠç°æœ‰ä»£ç ä¸­çš„ <code>sys</code> æ¨¡å—æ›¿æ¢ä¸º <code>util</code> æ¨¡å—ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>ä»¥å‰ä½ å¯èƒ½ä¼šå†™æˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sys</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sys&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">puts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ˜¯è€çš„å†™æ³•</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†è¿™æ ·çš„å†™æ³•ç°åœ¨ä¸å†æ¨èä½¿ç”¨ã€‚ä½ åº”è¯¥æ”¹ç”¨ <code>util</code> æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">puts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„å†™æ³•</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ï¼Œå¦‚æœä½ éœ€è¦è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œç°åœ¨é€šå¸¸ç›´æ¥ä½¿ç”¨ <code>console.log</code> æˆ–å…¶ä»– <code>console</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨æœ€å¸¸è§çš„å†™æ³•</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0025 æ˜¯ Node.js å®˜æ–¹çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ä¸åº”è¯¥å†ä½¿ç”¨ <code>require(&#39;node:sys&#39;)</code> æ¥å¼•å…¥ <code>sys</code> æ¨¡å—ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨ <code>util</code> æ¨¡å—æˆ–è€…ç›´æ¥ä½¿ç”¨ <code>console</code> å¯¹è±¡è¿›è¡Œç›¸å…³å·¥ä½œã€‚è¿™æ˜¯å› ä¸º <code>sys</code> æ¨¡å—åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œä¸ºäº†ç¡®ä¿ä½ çš„ä»£ç çš„å…¼å®¹æ€§å’Œé•¿è¿œç»´æŠ¤ï¼Œä½ åº”è¯¥åŠæ—¶æ›´æ–°ä»£ç ï¼Œå»æ‰å¯¹ <code>sys</code> æ¨¡å—çš„ä¾èµ–ã€‚</p><h3 id="dep0026-util-print" tabindex="-1"><a class="header-anchor" href="#dep0026-util-print"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0026" target="_blank" rel="noopener noreferrer">DEP0026: util.print()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€èŠ Node.js ä¸­çš„ DEP0026, å³ <code>util.print()</code> æ–¹æ³•çš„å¼ƒç”¨ã€‚</p><p>åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œâ€œå¼ƒç”¨â€ï¼ˆDeprecationï¼‰æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚å½“ä¸€ä¸ªåŠŸèƒ½æˆ–æ–¹æ³•è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ï¼Œæ„å‘³ç€è¿™ä¸ªåŠŸèƒ½è™½ç„¶åœ¨å½“å‰ç‰ˆæœ¬çš„è½¯ä»¶ä¸­ä»ç„¶å­˜åœ¨å¹¶å¯ä»¥ä½¿ç”¨ï¼Œä½†å®ƒå·²ç»ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å½»åº•ç§»é™¤ã€‚é€šå¸¸ï¼Œå¼€å‘è€…è¢«é¼“åŠ±å°½å¿«è¿ç§»åˆ°æ›¿ä»£æ–¹æ¡ˆã€‚</p><p><code>util.print()</code> æ˜¯ Node.js çš„ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒç”¨äºå°†å­—ç¬¦ä¸²è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµï¼ˆstdoutï¼‰ï¼Œå°±åƒåœ¨ç»ˆç«¯ä¸­æ‰“å°æ–‡æœ¬é‚£æ ·ã€‚ä¸è¿‡ï¼Œåœ¨ Node.js çš„åç»­ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•è¢«å¼ƒç”¨äº†ï¼ŒåŸå› æ˜¯æœ‰æ›´æ ‡å‡†å’Œæ›´çµæ´»çš„æ–¹æ³•å¯ä»¥å®Œæˆç›¸åŒçš„ä»»åŠ¡ï¼Œä¾‹å¦‚ <code>console.log()</code> å’Œ <code>process.stdout.write()</code>ã€‚</p><p>ç°åœ¨ï¼Œæ¥çœ‹çœ‹ä¸€äº›ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•æ›¿ä»£å¼ƒç”¨çš„ <code>util.print()</code> æ–¹æ³•ã€‚</p><p>å‡è®¾ä½ ä»¥å‰ç”¨ <code>util.print()</code> æ¥è¾“å‡ºæ–‡æœ¬ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™è¡Œä»£ç ä½¿ç”¨äº† util.print() æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸æ¨èä½¿ç”¨çš„ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ä½ åº”è¯¥ä½¿ç”¨ <code>console.log()</code> æˆ–è€… <code>process.stdout.write()</code> æ¥å–è€Œä»£ä¹‹ã€‚è¿™é‡Œæ˜¯ä¸¤ç§æ›¿ä»£æ–¹å¼çš„ä¾‹å­ï¼š</p><p>ä½¿ç”¨ <code>console.log()</code> è¾“å‡ºæ–‡æœ¬ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ console.log() è€Œä¸æ˜¯ util.print()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>process.stdout.write()</code> è¾“å‡ºæ–‡æœ¬ï¼ˆæ³¨æ„ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ process.stdout.write() è€Œä¸æ˜¯ util.print()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸ä¼šè‡ªåŠ¨åœ¨æœ«å°¾æ·»åŠ æ¢è¡Œç¬¦ \n</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>console.log()</code> å‡½æ•°æ˜¯æœ€å¸¸è§çš„æ›¿ä»£æ–¹æ³•ï¼Œå› ä¸ºå®ƒç®€å•æ˜“ç”¨ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨åœ¨è¾“å‡ºçš„æœ«å°¾æ·»åŠ æ¢è¡Œç¬¦ <code>\n</code>ï¼Œæ‰€ä»¥è¾“å‡ºå†…å®¹åä¼šè‡ªåŠ¨å¼€å§‹æ–°çš„ä¸€è¡Œã€‚å¦ä¸€æ–¹é¢ï¼Œ<code>process.stdout.write()</code> ç»™äº†ä½ æ›´å¤šçš„æ§åˆ¶èƒ½åŠ›ï¼Œå…è®¸ä½ è¾“å‡ºæ²¡æœ‰é™„åŠ æ¢è¡Œçš„å­—ç¬¦ä¸²ï¼Œè¿™åœ¨æŸäº›éœ€è¦ç²¾ç»†æ§åˆ¶è¾“å‡ºæ ¼å¼çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œç”±äº <code>util.print()</code> åœ¨ Node.js ä¸­è¢«å¼ƒç”¨äº†ï¼Œä½ åº”è¯¥æ”¹ç”¨ <code>console.log()</code> æˆ– <code>process.stdout.write()</code> æ¥è¾“å‡ºæ–‡æœ¬å†…å®¹åˆ°ç»ˆç«¯ã€‚è¿™æ ·çš„å˜åŒ–æœ‰åŠ©äºä½¿ä½ çš„ä»£ç é€‚åº”ç°ä»£ Node.js çš„å®è·µå’Œæœªæ¥çš„å˜åŒ–ã€‚</p><h3 id="dep0027-util-puts" tabindex="-1"><a class="header-anchor" href="#dep0027-util-puts"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0027" target="_blank" rel="noopener noreferrer">DEP0027: util.puts()</a></span></a></h3><p>Node.js ä¸­çš„ <code>util.puts()</code> å‡½æ•°æ˜¯ä¸€ä¸ªç”¨äºè¾“å‡ºå­—ç¬¦ä¸²åˆ°ç»ˆç«¯ï¼ˆstdoutï¼‰çš„ä¾¿æ·å‡½æ•°ã€‚åœ¨ Node.js çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ï¼Œå…·ä½“æ¥è¯´ï¼Œåœ¨ v0.12 ç‰ˆæœ¬å°±è¢«åºŸå¼ƒäº†ã€‚åºŸå¼ƒæ„å‘³ç€å®ƒä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æœªæ¥çš„ Node.js ç‰ˆæœ¬å¯èƒ½ä¼šå®Œå…¨ç§»é™¤å®ƒï¼Œå› æ­¤å»ºè®®ä¸è¦å†ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><p>å½“ä½ çœ‹åˆ° <a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0027" target="_blank" rel="noopener noreferrer">DEP0027: util.puts()</a> è¿™æ ·çš„æ–‡æ¡£æ—¶ï¼Œå®ƒå‘Šè¯‰ä½  <code>util.puts()</code> å·²ç»è¢«åŒ…å«åœ¨ Node.js çš„åºŸå¼ƒ API åˆ—è¡¨ä¸­ï¼Œå…¶ä¸­ &quot;DEP0027&quot; æ˜¯è¿™ä¸ªç‰¹å®šåºŸå¼ƒåŠŸèƒ½çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p><p>é€šä¿—åœ°è¯´ï¼Œå¦‚æœä½ åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>util.puts()</code> æ¥æ‰“å°ä¿¡æ¯ï¼Œé‚£ä¹ˆåº”è¯¥è€ƒè™‘æ›¿æ¢å®ƒï¼Œå› ä¸ºå°†æ¥å®ƒå¯èƒ½ä¸å†å¯ç”¨ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>util.puts()</code> çš„ä¾‹å­ï¼Œä»¥åŠå¦‚ä½•æ›¿æ¢å®ƒï¼š</p><p>æ—§çš„ä½¿ç”¨ <code>util.puts()</code> çš„æ–¹å¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°å­—ç¬¦ä¸²åˆ°ç»ˆç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">puts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨å»ºè®®çš„æ›¿æ¢æ–¹å¼ï¼Œä½¿ç”¨ <code>console.log()</code> æ¥ä»£æ›¿ <code>util.puts()</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›´æ¥ä½¿ç”¨ console.log() æ‰“å°å­—ç¬¦ä¸²åˆ°ç»ˆç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>console.log()</code> æ˜¯æ›´åŠ ç°ä»£å’Œå¸¸è§çš„æ–¹å¼æ¥è¾“å‡ºæ–‡æœ¬åˆ°æ§åˆ¶å°ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸ä¼šè¢«åºŸå¼ƒçš„æ ‡å‡†éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå¯¹äºæ–°çš„ Node.js é¡¹ç›®æˆ–è€…æ­£åœ¨ç»´æŠ¤çš„è€é¡¹ç›®ï¼Œéƒ½æ¨èä½¿ç”¨ <code>console.log()</code> è€Œä¸æ˜¯ <code>util.puts()</code>ã€‚</p><p>ç†è§£ Node.js çš„åºŸå¼ƒè­¦å‘Šéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©ä½ é¿å…åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å³å°†æ¶ˆå¤±çš„ç‰¹æ€§ï¼Œä»è€Œç¡®ä¿ä»£ç çš„é•¿æœŸå¥åº·å’Œç»´æŠ¤æ€§ã€‚</p><h3 id="dep0028-util-debug" tabindex="-1"><a class="header-anchor" href="#dep0028-util-debug"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0028" target="_blank" rel="noopener noreferrer">DEP0028: util.debug()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;å¼ƒç”¨&quot;ï¼ˆDeprecationï¼‰æŒ‡çš„æ˜¯æŸä¸ªåŠŸèƒ½æˆ–è€… API ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚Node.js æœ‰ä¸€ä¸ªä¸“é—¨çš„å¼ƒç”¨è­¦å‘Šç³»ç»Ÿï¼Œç”¨äºé€šçŸ¥å¼€å‘è€…å“ªäº›åŠŸèƒ½å³å°†è¿‡æ—¶ã€‚</p><p><code>util.debug()</code> æ˜¯ Node.js çš„ä¸€ä¸ªæ—©æœŸå‡½æ•°ï¼Œç”¨äºè¾“å‡ºè°ƒè¯•ä¿¡æ¯åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆstderrï¼‰ã€‚å®ƒå·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œè¿™æ„å‘³ç€ä½ ä¸åº”è¯¥åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨å®ƒï¼Œè€Œåº”è¯¥é‡‡ç”¨å…¶ä»–çš„æ–¹å¼æ¥è¿›è¡Œè°ƒè¯•ã€‚</p><p>å¼ƒç”¨ <code>util.debug()</code> çš„å…·ä½“ä¿¡æ¯å¯ä»¥é€šè¿‡ DEP0028 æ ‡è¯†ç¬¦åœ¨ Node.js çš„æ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚DEP0028 è®°å½•äº† <code>util.debug()</code> å¼ƒç”¨çš„è¯¦æƒ…ï¼ŒåŒ…æ‹¬å¼ƒç”¨çš„ç‰ˆæœ¬å’Œæ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ éœ€è¦åœ¨ Node.js ä¸­æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><ol><li><strong>console.log()</strong>: æ‰“å°æ™®é€šæ—¥å¿—ä¿¡æ¯ã€‚</li><li><strong>console.error()</strong>: æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œè¾“å‡ºåˆ° stderrã€‚</li><li><strong>console.debug()</strong>: æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œä¸ console.log() ç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ NODE_DEBUG ç¯å¢ƒå˜é‡è¿›è¡Œè¿‡æ»¤ã€‚</li><li><strong>debug æ¨¡å—</strong>: ä¸€ä¸ªå°å‹çš„ Node.js è°ƒè¯•åŠ©æ‰‹ï¼Œå¯ä»¥æŒ‰ç…§æ¨¡å—åŒºåˆ†è°ƒè¯•è¾“å‡ºã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆçš„ä¾‹å­ï¼š</p><p><strong>ä½¿ç”¨ console.log() æ‰“å°æ¶ˆæ¯ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æ—¥å¿—ä¿¡æ¯ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨ console.error() æ‰“å°é”™è¯¯ä¿¡æ¯ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œä¼šè¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨ console.debug() è¿›è¡Œè°ƒè¯•ï¼ˆå‡è®¾å¯åŠ¨æ—¶è®¾ç½®äº† NODE_DEBUG=exampleï¼‰ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ¡ä¿¡æ¯åªæœ‰åœ¨è®¾ç½®äº†ç¯å¢ƒå˜é‡ NODE_DEBUG=example æ—¶æ‰ä¼šæ˜¾ç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªè°ƒè¯•ä¿¡æ¯ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨ debug æ¨¡å—è¿›è¡Œæ›´ç»†ç²’åº¦çš„è°ƒè¯•æ§åˆ¶ï¼š</strong><br> é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£… debug æ¨¡å—ï¼Œé€šè¿‡è¿è¡Œï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> debug</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶ååœ¨ä»£ç ä¸­è¿™æ ·ä½¿ç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> debug</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;debug&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  debug</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¥æ”¶åˆ°è¯·æ±‚: %o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  debug</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ç«¯å£3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>debug(&#39;æ¥æ”¶åˆ°è¯·æ±‚: %o&#39;, req);</code> åªä¼šåœ¨è®¾ç½®äº† DEBUG ç¯å¢ƒå˜é‡ä¸”å…¶å€¼åŒ…å«äº† &#39;http&#39; æ—¶æ‰ä¼šæ‰“å°ä¿¡æ¯ã€‚è¿™æ ·åšå…è®¸ä½ æ§åˆ¶å“ªäº›è°ƒè¯•ä¿¡æ¯è¦è¾“å‡ºï¼Œè€Œæ— éœ€ä¿®æ”¹ä»£ç æœ¬èº«ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>util.debug()</code> å·²ç»ä¸å†å»ºè®®ä½¿ç”¨äº†ï¼Œä½ åº”è¯¥ä½¿ç”¨å…¶ä»–çš„æ—¥å¿—å’Œè°ƒè¯•æ–¹æ³•ï¼Œå¦‚ä¸Šè¿°æ‰€ç¤ºã€‚è¿™äº›æ–¹æ³•ä¸ä»…æ›´åŠ ç°ä»£åŒ–ï¼Œè€Œä¸”æä¾›äº†æ›´å¥½çš„çµæ´»æ€§å’Œæ§åˆ¶èƒ½åŠ›ã€‚</p><h3 id="dep0029-util-error" tabindex="-1"><a class="header-anchor" href="#dep0029-util-error"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0029" target="_blank" rel="noopener noreferrer">DEP0029: util.error()</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„â€œåºŸå¼ƒï¼ˆDeprecationï¼‰â€ã€‚</p><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œâ€œåºŸå¼ƒâ€æŒ‡çš„æ˜¯ä¸€ç§æ ‡è®°æŸä¸ªåŠŸèƒ½æˆ–è€… API å³å°†ä¸å†æ”¯æŒä½¿ç”¨çš„è¿‡ç¨‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…åº”è¯¥å¼€å§‹è€ƒè™‘åœæ­¢ä½¿ç”¨è¿™äº›è¢«åºŸå¼ƒçš„ç‰¹æ€§ï¼Œå¹¶ä¸”å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ°ä½ é—®çš„é—®é¢˜ â€”â€” DEP0029: util.error() åœ¨ Node.js v21.7.1 ä¸­çš„åºŸå¼ƒã€‚</p><p>åœ¨ Node.js ä¸­æœ‰ä¸€ä¸ªæ¨¡å—å«<code>util</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«äº†å¾ˆå¤šå®ç”¨å°å·¥å…·å‡½æ•°çš„æ ¸å¿ƒæ¨¡å—ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªå‡½æ•°å«åš<code>util.error()</code>ï¼Œæ ¹æ®ä½ ç»™å‡ºçš„é“¾æ¥å’Œç‰ˆæœ¬å·ï¼ŒNode.js å®˜æ–¹å·²ç»å†³å®šåºŸå¼ƒ<code>util.error()</code>è¿™ä¸ªå‡½æ•°ã€‚</p><p>è¿™æ„å‘³ç€ä½ ä¸åº”å†ä½¿ç”¨<code>util.error()</code>å‡½æ•°æ¥ç¼–å†™æ–°ä»£ç ï¼Œå› ä¸ºåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å®ƒå¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ï¼Œå¹¶ä¸”ä¸å†æä¾›ä»»ä½•åŠŸèƒ½ã€‚è€Œå¯¹äºæ—§çš„ä»£ç ï¼Œå¦‚æœä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£å°±åº”è¯¥é€æ­¥å°†å…¶æ›¿æ¢ä¸ºå…¶ä»–æ–¹æ³•ã€‚</p><p><code>util.error()</code>å‡½æ•°ä¸»è¦è¢«ç”¨æ¥å‘æ ‡å‡†é”™è¯¯è¾“å‡ºå†…å®¹ï¼Œä¹Ÿå°±æ˜¯åœ¨å‘½ä»¤è¡Œä¸­æ‰“å‡ºé”™è¯¯ä¿¡æ¯ã€‚åœ¨åºŸå¼ƒä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·ç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ä¸ªæ–¹æ³•ç”¨äºå‘æ ‡å‡†é”™è¯¯æ‰“å°æ¶ˆæ¯ï¼Œå¹¶æ·»åŠ æ¢è¡Œç¬¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ä¿¡æ¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ç°åœ¨ï¼Œä½ åº”è¯¥ä½¿ç”¨<code>console.error()</code>æ¥ä»£æ›¿<code>util.error()</code>ï¼Œå› ä¸º<code>console.error()</code>æ˜¯æ ‡å‡†çš„ã€æ¨èçš„æ–¹å¼æ¥è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ console.error æ¥ä»£æ›¿ util.error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ä¿¡æ¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</p><ol><li><p><strong>è®°å½•é”™è¯¯æ—¥å¿—</strong>ï¼šåœ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºä¸­ï¼Œå½“æ•æ‰åˆ°ä¸€ä¸ªé”™è¯¯æ—¶ï¼Œä½ å¯èƒ½æƒ³æŠŠé”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•è·é”™è¯¯å¹¶æ‰“å°å‡ºæ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸€äº›å¯èƒ½å‡ºé”™çš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è°ƒè¯•ä¿¡æ¯</strong>ï¼šåœ¨å¼€å‘é˜¶æ®µï¼Œä½ å¯èƒ½ä¼šæ‰“å°ä¸€äº›è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°å¸®åŠ©ä½ æ’æŸ¥é—®é¢˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºä¸€äº›è°ƒè¯•ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è°ƒè¯•ä¿¡æ¯ï¼Œæ£€æŸ¥å˜é‡å€¼:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¾“å‡ºé”™è¯¯å †æ ˆä¿¡æ¯</strong>ï¼šæœ‰æ—¶å€™ä¸ºäº†ä¾¿äºè°ƒè¯•ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“é”™è¯¯å‘ç”Ÿçš„å…·ä½“ä½ç½®ï¼Œè¿™æ—¶å¯ä»¥è¾“å‡ºé”™è¯¯çš„å †æ ˆä¿¡æ¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºé”™è¯¯åŠå…¶å †æ ˆä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸€äº›å¯èƒ½å‡ºé”™çš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é”™è¯¯è¯¦ç»†å †æ ˆä¿¡æ¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>æ€»ç»“èµ·æ¥ï¼Œ<code>util.error()</code>çš„åºŸå¼ƒæé†’å¼€å‘è€…åº”è¯¥ä½¿ç”¨<code>console.error()</code>ä½œä¸ºè¾“å‡ºé”™è¯¯ä¿¡æ¯çš„æ ‡å‡†åšæ³•ï¼Œä»¥ç¡®ä¿ä»£ç çš„å…¼å®¹æ€§å’Œæœªæ¥çš„ç»´æŠ¤æ€§ã€‚</p><h3 id="dep0030-slowbuffer" tabindex="-1"><a class="header-anchor" href="#dep0030-slowbuffer"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0030" target="_blank" rel="noopener noreferrer">DEP0030: SlowBuffer</a></span></a></h3><p><code>DEP0030</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šä»£ç ï¼Œå®ƒæåˆ°äº† <code>SlowBuffer</code> çš„ä½¿ç”¨å·²ç»è¢«åºŸå¼ƒã€‚åœ¨è§£é‡Šè¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>Buffer</code>ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>Buffer</code> ç±»æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®æµçš„å…¨å±€å¯ç”¨ç±»ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®çš„æ•°ç»„ã€‚å½“ä½ è¦å¤„ç†æ–‡ä»¶ã€ç½‘ç»œæ“ä½œæˆ–ä»»ä½•æ¶‰åŠåˆ°å­—èŠ‚æµçš„åœºæ™¯æ—¶ï¼Œä½ ä¼šä½¿ç”¨åˆ° <code>Buffer</code>ã€‚</p><p>æ—©æœŸçš„ Node.js ç‰ˆæœ¬ä¸­å¼•å…¥äº† <code>SlowBuffer</code> è¿™ä¸ªç±»ï¼Œæ­£å¦‚å…¶åï¼Œå®ƒæ¯”ç°åœ¨æ ‡å‡†çš„ <code>Buffer</code> æ›´æ…¢ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨ Node.js çš„å†…éƒ¨ç¼“å­˜æœºåˆ¶ã€‚ç”±äºæ€§èƒ½ä½ä¸‹å’Œæ›´å¥½çš„æ›¿ä»£æ–¹æ³•çš„å‡ºç°ï¼ˆå³ <code>Buffer.alloc()</code>, <code>Buffer.allocUnsafe()</code>, å’Œ <code>Buffer.from()</code> æ–¹æ³•ï¼‰ï¼Œ<code>SlowBuffer</code> è¢«åºŸå¼ƒäº†ã€‚</p><p>ç°åœ¨åœ¨ Node.js ä¸­åˆ›å»º Buffer çš„æ¨èæ–¹æ³•æ˜¯ï¼š</p><ol><li><code>Buffer.from(array)</code>: ä»ä¸€ä¸ªå…«ä½å­—èŠ‚çš„æ•°ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ Bufferã€‚</li><li><code>Buffer.alloc(size)</code>: åˆ›å»ºä¸€ä¸ªé¢„å¡«å……äº†é›¶çš„æŒ‡å®šå¤§å°çš„ Bufferã€‚</li><li><code>Buffer.allocUnsafe(size)</code>: åˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„ Bufferï¼Œä½†æ˜¯å®ƒå¯èƒ½åŒ…å«æ—§æ•°æ®ï¼Œå› æ­¤å®ƒéœ€è¦é€šè¿‡ <code>fill()</code> æˆ–å…¶ä»–æ–¹å¼æ‰‹åŠ¨åˆå§‹åŒ–ã€‚</li></ol><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåŒ…å« ASCII å­—ç¬¦ &#39;hello&#39; çš„ Buffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufFrom</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bufFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// `&lt;`Buffer 68 65 6c 6c 6f&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 10ï¼Œä¸”ç”¨é›¶å¡«å……çš„ Buffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufAlloc</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bufAlloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// `&lt;`Buffer 00 00 00 00 00 00 00 00 00 00&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 10 çš„ Bufferï¼Œå†…å®¹æœªçŸ¥ï¼Œå¯èƒ½éå¸¸å¿«ï¼Œä½†éœ€è¦æ‰‹åŠ¨æ¸…ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bufAllocUnsafe</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">allocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">bufAllocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fill</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°† Buffer å¡«å……ä¸º 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bufAllocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// `&lt;`Buffer 00 00 00 00 00 00 00 00 00 00&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› æ­¤ï¼Œå¦‚æœä½ åœ¨æ—§ä»£ç ä¸­çœ‹åˆ° <code>new SlowBuffer(size)</code> çš„ä½¿ç”¨ï¼Œåº”è¯¥å°†å®ƒæ›¿æ¢ä¸º <code>Buffer.alloc(size)</code> æˆ–è€…æ ¹æ®æƒ…å†µé€‰æ‹© <code>Buffer.allocUnsafe(size)</code> å¹¶æ‰‹åŠ¨åˆå§‹åŒ–ã€‚</p><p>è‡ªä» <code>DEP0030</code> å‡ºç°ä¹‹åï¼Œå°è¯•ä½¿ç”¨ <code>SlowBuffer</code> å°†ä¼šå¯¼è‡´ Node.js æŠ›å‡ºå¼ƒç”¨è­¦å‘Šï¼Œæ‰€ä»¥å»ºè®®ä½ å§‹ç»ˆä½¿ç”¨æ–°çš„ <code>Buffer</code> æ„é€ æ–¹æ³•æ¥ä¿æŒä»£ç çš„æœ€ä½³æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚</p><h3 id="dep0031-ecdh-setpublickey" tabindex="-1"><a class="header-anchor" href="#dep0031-ecdh-setpublickey"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0031" target="_blank" rel="noopener noreferrer">DEP0031: ecdh.setPublicKey()</a></span></a></h3><p>å¥½çš„ï¼Œå½“ä½ å¼€å§‹å­¦ä¹  Node.js æˆ–è€…ä»»ä½•ç¼–ç¨‹è¯­è¨€æ—¶ï¼Œä¼šå‘ç°æœ‰æ—¶å€™ä¸€äº›åŠŸèƒ½æˆ–è€…æ–¹æ³•ä¼šè¢«â€œå¼ƒç”¨â€ï¼ˆDeprecatedï¼‰ã€‚è¿™é€šå¸¸æ„å‘³ç€è¯¥åŠŸèƒ½å³å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–è€…æ˜¯å·²ç»æœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä½¿ç”¨è¢«å¼ƒç”¨çš„åŠŸèƒ½å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©æˆ–è€…ä¸å…¼å®¹çš„é—®é¢˜ï¼Œæ‰€ä»¥äº†è§£å®ƒä»¬å¾ˆé‡è¦ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>DEP0031</code>æŒ‡çš„å°±æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šã€‚å…·ä½“åœ°è¯´ï¼Œ<code>ecdh.setPublicKey()</code>è¿™ä¸ªæ–¹æ³•è¢«æ ‡è®°ä¸ºå¼ƒç”¨äº†ã€‚<code>ecdh</code>æ˜¯ Node.js ä¸­ç”¨äºæ¤­åœ†æ›²çº¿åŠ å¯†çš„æ¨¡å—ï¼Œè€Œ<code>setPublicKey</code>æ–¹æ³•æœ¬è´¨ä¸Šæ˜¯å…è®¸ä½ æ‰‹åŠ¨è®¾ç½®ä¸€ä¸ª ECDHï¼ˆElliptic Curve Diffie-Hellmanï¼‰å¯¹è±¡çš„å…¬é’¥ã€‚</p><p>ç°åœ¨æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p><h3 id="elliptic-curve-diffie-hellman-ecdh" tabindex="-1"><a class="header-anchor" href="#elliptic-curve-diffie-hellman-ecdh"><span>Elliptic Curve Diffie-Hellman (ECDH)</span></a></h3><p>ECDH æ˜¯ä¸€ç§åœ¨ä¸¤ä¸ªå‚ä¸æ–¹ä¹‹é—´å®‰å…¨åœ°å…±äº«å¯†é’¥çš„æ–¹æ³•ã€‚è¿™ç§æ–¹å¼æ˜¯å»ºç«‹åœ¨æ¤­åœ†æ›²çº¿å¯†ç å­¦åŸºç¡€ä¸Šï¼Œåœ¨è¿‘ç°ä»£å¯†ç å­¦ä¸­éå¸¸æµè¡Œï¼Œå› ä¸ºå®ƒæä¾›äº†ç›¸è¾ƒäºä¼ ç»Ÿæ–¹æ³•æ›´é«˜çº§åˆ«çš„å®‰å…¨æ€§ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨è¾ƒçŸ­çš„å¯†é’¥é•¿åº¦ã€‚</p><p>å½“ä¸¤ä¸ªç”¨æˆ·æƒ³è¦é€šè¿‡ä¸€ä¸ªä¸å®‰å…¨çš„æ¸ é“ï¼ˆå¦‚äº’è”ç½‘ï¼‰äº¤æ¢ç§˜å¯†ä¿¡æ¯æ—¶ï¼Œä»–ä»¬ä¼šåˆ†åˆ«ç”Ÿæˆè‡ªå·±çš„ç§é’¥å’Œå…¬é’¥ã€‚ç§é’¥æ˜¯ä¿å¯†çš„ï¼Œè€Œå…¬é’¥æ˜¯å¯ä»¥å…¬å¼€çš„ã€‚é€šè¿‡ ECDH ç®—æ³•çš„ç‰¹æ€§ï¼Œä¸¤ä¸ªç”¨æˆ·å¯ä»¥å„è‡ªä½¿ç”¨å¯¹æ–¹çš„å…¬é’¥å’Œè‡ªå·±çš„ç§é’¥æ¥ç”Ÿæˆä¸€ä¸ªå…±åŒçš„ç§˜å¯†ï¼Œè¿™ä¸ªç§˜å¯†å¯ä»¥ç”¨ä½œåç»­é€šä¿¡çš„å¯†é’¥ã€‚</p><h3 id="ecdh-setpublickey" tabindex="-1"><a class="header-anchor" href="#ecdh-setpublickey"><span>ecdh.setPublicKey()</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>crypto</code>æ¨¡å—æä¾›äº† ECDH ç›¸å…³çš„åŠŸèƒ½ã€‚<code>ecdh.setPublicKey()</code>å°±æ˜¯å…¶ä¸­ä¸€ä¸ªç”¨äºè®¾ç½® ECDH å®ä¾‹å…¬é’¥çš„æ–¹æ³•ã€‚ä½†åœ¨æ–°ç‰ˆ Node.js ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•è¢«å¼ƒç”¨äº†ã€‚</p><p>è¿™é‡Œæœ‰å‡ ä¸ªåŸå› ï¼š</p><ol><li><strong>å®‰å…¨æ€§</strong>ï¼šæ‰‹åŠ¨è®¾ç½®å…¬é’¥å¯èƒ½å¯¼è‡´å¯†é’¥ä¸åŒ¹é…ï¼Œå¢åŠ äº†å®‰å…¨é£é™©ã€‚</li><li><strong>æ˜“ç”¨æ€§</strong>ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å¹¶ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®å…¬é’¥ï¼›Node.js å¯ä»¥ä¸ºä½ å¤„ç†è¿™äº›äº‹æƒ…ã€‚</li><li><strong>ä¿æŒæ¸…æ™°å’Œç®€æ´çš„ API</strong>ï¼šéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå»æ‰ä¸å¸¸ç”¨æˆ–è€…å¯èƒ½å¯¼è‡´é”™è¯¯çš„æ–¹æ³•å¯ä»¥å¸®åŠ©ä¿æŒ Node.js API çš„æ¸…æ™°å’Œç®€æ´ã€‚</li></ol><h3 id="ä¸¾ä¸ªä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¸ªä¾‹å­-1"><span>ä¸¾ä¸ªä¾‹å­</span></a></h3><p>å‡è®¾ Alice å’Œ Bob æƒ³è¦é€šè¿‡äº’è”ç½‘å®‰å…¨åœ°å…±äº«æ•°æ®ã€‚åœ¨æ²¡æœ‰<code>ecdh.setPublicKey()</code>æ–¹æ³•ä¹‹å‰ï¼Œä»–ä»¬ä¼šè¿™æ ·åšï¼š</p><ol><li>Alice å’Œ Bob åˆ†åˆ«ç”Ÿæˆè‡ªå·±çš„ ECDH å¯†é’¥å¯¹ï¼ˆç§é’¥å’Œå…¬é’¥ï¼‰ã€‚</li><li>Alice å°†å¥¹çš„å…¬é’¥å‘é€ç»™ Bobï¼ŒBob ä¹ŸåŒæ ·å°†ä»–çš„å…¬é’¥å‘é€ç»™ Aliceã€‚</li><li>Alice ä½¿ç”¨ Bob çš„å…¬é’¥å’Œè‡ªå·±çš„ç§é’¥ç”Ÿæˆå…±äº«ç§˜å¯†ï¼ŒBob ä¹Ÿç”¨ Alice çš„å…¬é’¥å’Œè‡ªå·±çš„ç§é’¥åšåŒæ ·çš„æ“ä½œã€‚</li></ol><p>ç”±äºå¯†é’¥çš„ç”Ÿæˆå’Œäº¤æ¢æ˜¯é€šè¿‡ Node.js çš„å†…éƒ¨æœºåˆ¶å®Œæˆçš„ï¼Œä»–ä»¬ä¸éœ€è¦ï¼ˆä¹Ÿä¸åº”è¯¥ï¼‰æ‰‹åŠ¨è°ƒç”¨<code>ecdh.setPublicKey()</code>è®¾ç½®å…¬é’¥ã€‚è¿™æ ·åšæ—¢å®‰å…¨åˆç®€å•ã€‚</p><p>æ€»ç»“ï¼Œ<code>DEP0031: ecdh.setPublicKey()</code>çš„å¼ƒç”¨æ„å‘³ç€ä½ ä¸å†èƒ½å¤Ÿï¼ˆä¹Ÿä¸åº”è¯¥ï¼‰æ‰‹åŠ¨è®¾ç½® ECDH å¯¹è±¡çš„å…¬é’¥ã€‚Node.js æä¾›äº†è¶³å¤Ÿçš„å·¥å…·æ¥å®‰å…¨æœ‰æ•ˆåœ°å¤„ç†å¯†é’¥ç”Ÿæˆå’Œäº¤æ¢è¿‡ç¨‹ï¼Œå¹¶ä¸”å‘å¼€å‘è€…æ¨èä½¿ç”¨æ›´å®‰å…¨ã€ç®€å•çš„æ–¹æ³•æ¥å®ç° ECDH å¯†é’¥äº¤æ¢ã€‚</p><h3 id="dep0032-node-domain-module" tabindex="-1"><a class="header-anchor" href="#dep0032-node-domain-module"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0032" target="_blank" rel="noopener noreferrer">DEP0032: node:domain module</a></span></a></h3><p>Node.js ä¸­çš„ &quot;domain&quot; æ¨¡å—æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ—©æœŸçš„å°è¯•ï¼Œç”¨äºå¤„ç†å’Œè·Ÿè¸ªå¼‚æ­¥æ“ä½œä¸­å‘ç”Ÿçš„é”™è¯¯ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ä½ å°†å¤šä¸ªä¸åŒçš„æ“ä½œæ†ç»‘åˆ°ä¸€ä¸ªç§°ä½œâ€œåŸŸâ€çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·å½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ“ä½œå‡ºç°é”™è¯¯æ—¶ï¼Œéƒ½å¯ä»¥åœ¨è¿™ä¸ªåŸŸä¸­è¢«æ•è·å’Œå¤„ç†ï¼Œè€Œä¸æ˜¯å¯¼è‡´æ•´ä¸ªç¨‹åºå´©æºƒã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0032" target="_blank" rel="noopener noreferrer">DEP0032</a> è¡¨æ˜ <code>node:domain</code> æ¨¡å—å·²è¢«åºŸå¼ƒï¼Œè¿™æ„å‘³ç€ Node.js å›¢é˜Ÿè®¡åˆ’åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤è¿™ä¸ªæ¨¡å—ï¼Œå¹¶ä¸”ä¸å»ºè®®å¼€å‘è€…åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚</p><p><strong>åŸå› ï¼š</strong></p><ul><li>å·¥ä½œä¸å®Œç¾ï¼šDomain æ¨¡å—å¹¶ä¸èƒ½ä¿è¯å®Œå…¨æ•è·æ‰€æœ‰å¼‚æ­¥é”™è¯¯ã€‚</li><li>æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼šéšç€ Promisesã€async/await çš„æ™®åŠï¼Œä»¥åŠæ–°çš„é”™è¯¯å¤„ç†ç‰¹æ€§ï¼ˆå¦‚ global exception handlersï¼‰çš„å¼•å…¥ï¼Œç¤¾åŒºå’Œ Node.js æ ¸å¿ƒå›¢é˜Ÿéƒ½è½¬å‘ä½¿ç”¨è¿™äº›æ–°å·¥å…·å’Œæ¨¡å¼æ¥å¤„ç†é”™è¯¯ã€‚</li><li>ç»´æŠ¤æˆæœ¬ï¼šDomain æ¨¡å—çš„å­˜åœ¨ç»™ Node.js æ ¸å¿ƒåº“å’Œå…¶ä»– npm æ¨¡å—çš„ç»´æŠ¤å¸¦æ¥é¢å¤–è´Ÿæ‹…ã€‚</li></ul><p><strong>å®é™…ä¾‹å­è¯´æ˜ï¼š</strong></p><ol><li><strong>ä½¿ç”¨ Domain æ•è·é”™è¯¯ï¼ˆä¸æ¨èï¼‰ï¼š</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> d</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•è·åˆ°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œæ•…æ„é€ æˆä¸€ä¸ªé”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœ‰é—®é¢˜çš„å¼‚æ­¥æ“ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>domain.create()</code> åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åŸŸï¼Œç„¶åé€šè¿‡ç›‘å¬ <code>error</code> äº‹ä»¶æ¥æ•è·åœ¨è¯¥åŸŸä¸­å‘ç”Ÿçš„ä»»ä½•é”™è¯¯ã€‚å½“å¼‚æ­¥æ“ä½œï¼ˆè¿™é‡Œæ˜¯ <code>setTimeout</code>ï¼‰ä¸­å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå®ƒä¼šè¢«åŸŸæ•è·ï¼Œè€Œä¸ä¼šä½¿å¾—æ•´ä¸ªç¨‹åºå´©æºƒã€‚</p><ol start="2"><li><strong>ä½¿ç”¨ Promise å’Œ async/await å¤„ç†é”™è¯¯ï¼ˆæ¨èï¼‰ï¼š</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> problematicAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾è¿™æ˜¯ä¸€ä¸ªä¼šå‘ç”Ÿé”™è¯¯çš„å¼‚æ­¥å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœ‰é—®é¢˜çš„å¼‚æ­¥æ“ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> problematicAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•è·åˆ°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">handleAsyncOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ Domainï¼Œè€Œæ˜¯åˆ©ç”¨äº† <code>Promise</code> å’Œ <code>async/await</code> æ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚å¦‚æœ <code>problematicAsyncOperation</code> å‡½æ•°å¤±è´¥äº†ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª rejected çš„ promiseã€‚æˆ‘ä»¬åœ¨ <code>handleAsyncOperation</code> å‡½æ•°ä¸­ä½¿ç”¨ <code>try...catch</code> è¯­å¥æ¥æ•è·è¿™ä¸ªé”™è¯¯ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚è¿™æ˜¯ä¸€ç§æ›´åŠ ç°ä»£å’Œå¹¿æ³›æ¨èçš„é”™è¯¯å¤„ç†æ–¹å¼ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œè™½ç„¶ Domain æ¨¡å—åœ¨è¿‡å»æä¾›äº†ä¸€ä¸ªé”™è¯¯å¤„ç†çš„æ–¹æ¡ˆï¼Œä½†éšç€ JavaScript è¯­è¨€å’Œ Node.js å¹³å°çš„è¿›åŒ–ï¼Œå·²ç»æœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ³•æ¥å¤„ç†å¼‚æ­¥é”™è¯¯ã€‚Node.js å›¢é˜Ÿå› æ­¤å†³å®šåºŸå¼ƒ Domain æ¨¡å—ï¼Œå¹¶å»ºè®®å¼€å‘è€…ä½¿ç”¨å…¶ä»–çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p><h3 id="dep0033-eventemitter-listenercount" tabindex="-1"><a class="header-anchor" href="#dep0033-eventemitter-listenercount"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0033" target="_blank" rel="noopener noreferrer">DEP0033: EventEmitter.listenerCount()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆ Node.js ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„åºŸå¼ƒåŠŸèƒ½ï¼š<code>EventEmitter.listenerCount()</code>ï¼Œè¿™æ˜¯æ ¹æ®ä½ æä¾›çš„ç‰ˆæœ¬å· Node.js v21.7.1 ä¸­æ ‡è®°ä¸ºåºŸå¼ƒçš„ï¼ˆå³ DEP0033ï¼‰ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-eventemitter-listenercount" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-eventemitter-listenercount"><span>ä»€ä¹ˆæ˜¯ EventEmitter.listenerCount()ï¼Ÿ</span></a></h3><p>åœ¨æ·±å…¥ä»‹ç»å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹åŸºæœ¬æ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œ<code>EventEmitter</code> æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¨¡å—ï¼Œç”¨äºå¤„ç†äº‹ä»¶ã€‚å¯ä»¥ç†è§£ä¸ºå®ƒæ˜¯ä¸€ä¸ªäº‹ä»¶è°ƒåº¦ä¸­å¿ƒï¼Œå½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒè´Ÿè´£é€šçŸ¥é‚£äº›å¯¹è¯¥äº‹ä»¶æ„Ÿå…´è¶£çš„åœ°æ–¹ï¼ˆä¹Ÿå°±æ˜¯ç›‘å¬è€…æˆ–ç§°ä½œâ€œç›‘å¬å‡½æ•°â€ï¼‰ã€‚</p><p><code>EventEmitter.listenerCount()</code> è¿™ä¸ªæ–¹æ³•ç”¨äºè·å–æŸä¸ªäº‹ä»¶ä¸ŠæŒ‚è½½çš„ç›‘å¬å™¨æ•°é‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> emitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> listener1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Listener 1 is executing.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> listener2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Listener 2 is executing.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸ºäº‹ä»¶ `connection` æ·»åŠ ä¸¤ä¸ªç›‘å¬å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listener1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listener2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–å¹¶è¾“å‡ºäº‹ä»¶ `connection` ä¸ŠæŒ‚è½½çš„ç›‘å¬å™¨æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> listenerCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listenerCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listenerCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>EventEmitter</code> å®ä¾‹ï¼Œç„¶åæ·»åŠ äº†ä¸¤ä¸ªé’ˆå¯¹ <code>connection</code> äº‹ä»¶çš„ç›‘å¬å™¨ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>EventEmitter.listenerCount()</code> æ–¹æ³•æ¥è·å– <code>connection</code> äº‹ä»¶ä¸Šç›‘å¬å™¨çš„æ•°é‡ï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¢«åºŸå¼ƒä»¥åŠæ›¿ä»£æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¢«åºŸå¼ƒä»¥åŠæ›¿ä»£æ–¹æ¡ˆ"><span>ä¸ºä»€ä¹ˆè¢«åºŸå¼ƒä»¥åŠæ›¿ä»£æ–¹æ¡ˆ</span></a></h3><p>Node.js å¼€å‘å›¢é˜Ÿå†³å®šåºŸå¼ƒ <code>EventEmitter.listenerCount()</code>ï¼Œå› ä¸ºå­˜åœ¨æ›´ç°ä»£ã€ç®€æ´çš„æ–¹å¼æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚è€Œä¸”ï¼Œè¿™æ ·åšå¯ä»¥å‡å°‘ API å†—ä½™ï¼Œä½¿å¾—æ•´ä¸ª <code>EventEmitter</code> æ¨¡å—æ›´åŠ ç®€åŒ–å’Œæ˜“äºç»´æŠ¤ã€‚</p><p>æ›¿ä»£æ–¹æ¡ˆæ˜¯ç›´æ¥ä½¿ç”¨ <code>emitter.listenerCount(eventName)</code> å®ä¾‹æ–¹æ³•ï¼Œè€Œä¸æ˜¯é™æ€æ–¹æ³• <code>EventEmitter.listenerCount(emitter, eventName)</code>ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨æ–°çš„æ›¿ä»£æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> emitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Listener 1 is executing.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Listener 2 is executing.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ–°çš„æ–¹å¼è·å–äº‹ä»¶ `connection` ä¸ŠæŒ‚è½½çš„ç›‘å¬å™¨æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> listenerCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> emitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listenerCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listenerCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ›¿ä»£çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>emitter</code> å®ä¾‹ä¸Šçš„ <code>listenerCount</code> æ–¹æ³•æ¥è·å–åŒæ ·çš„ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼æ›´åŠ é¢å‘å¯¹è±¡ï¼Œå¹¶ä¸”è·Ÿå…¶ä»– <code>EventEmitter</code> çš„å®ä¾‹æ–¹æ³•ä¿æŒäº†ä¸€è‡´æ€§ã€‚</p><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p>å¦‚æœä½ çš„ä»£ç ä¸­æ­£åœ¨ä½¿ç”¨è€å¼çš„ <code>EventEmitter.listenerCount()</code> é™æ€æ–¹æ³•ï¼Œè¯·å°½å¿«è¿ç§»åˆ°ä½¿ç”¨ <code>emitter.listenerCount(eventName)</code> å®ä¾‹æ–¹æ³•ä»¥é¿å…æœªæ¥çš„å…¼å®¹æ€§é—®é¢˜ã€‚è™½ç„¶ç›®å‰åœ¨ Node.js v21.7.1 ä¸­è¿˜èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯éšç€ Node.js çš„ç‰ˆæœ¬æ›´æ–°ï¼Œæœ€ç»ˆè¿™ä¸ªæ–¹æ³•ä¼šè¢«å®Œå…¨ç§»é™¤ï¼Œæ‰€ä»¥åŠæ—¶æ›´æ–°ä½ çš„ä»£ç æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p><h3 id="dep0034-fs-exists-path-callback" tabindex="-1"><a class="header-anchor" href="#dep0034-fs-exists-path-callback"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0034" target="_blank" rel="noopener noreferrer">DEP0034: fs.exists(path, callback)</a></span></a></h3><p>Node.js ä¸­çš„<code>fs.exists(path, callback)</code>å‡½æ•°ç”¨æ¥æ£€æŸ¥ç»™å®šè·¯å¾„çš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼ˆ<code>path</code>ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯å›è°ƒå‡½æ•°ï¼ˆ<code>callback</code>ï¼‰ã€‚å½“è¿™ä¸ªæ“ä½œå®Œæˆæ—¶ï¼Œå°†ä¼šè°ƒç”¨å›è°ƒå‡½æ•°å¹¶ä¼ å…¥ä¸€ä¸ªå¸ƒå°”å€¼å‚æ•°ï¼ŒæŒ‡ç¤ºè·¯å¾„æ˜¯å¦å­˜åœ¨ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œä½ ä¼šçœ‹åˆ°<code>fs.exists</code>è¢«æ ‡è®°ä¸ºå·²å¼ƒç”¨ï¼ˆdeprecatedï¼‰ï¼Œå³<code>DEP0034</code>ã€‚è¿™æ„å‘³ç€å¼€å‘è€…ä¸åº”è¯¥å†ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œå¹¶ä¸”å®ƒæœ‰ä¸€äº›è®¾è®¡é—®é¢˜ã€‚å…¶ä¸­ä¸€ä¸ªä¸»è¦çš„é—®é¢˜æ˜¯ï¼Œç”±äºæ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€å¯ä»¥åœ¨ä»»ä½•æ—¶é—´æ”¹å˜ï¼Œå³ä½¿<code>fs.exists</code>è¿”å›äº†<code>true</code>è¡¨ç¤ºæ–‡ä»¶å­˜åœ¨ï¼Œå½“ä½ è¯•å›¾è®¿é—®è¯¥æ–‡ä»¶æ—¶ï¼Œå®ƒä»ç„¶å¯èƒ½ä¸å­˜åœ¨ã€‚è¿™ä¼šå¯¼è‡´æ‰€è°“çš„â€œç«æ€æ¡ä»¶â€ã€‚</p><p>ç°åœ¨æ¥ä¸¾å‡ ä¸ªä¾‹å­è¯´æ˜å¦‚ä½•æ›¿ä»£<code>fs.exists</code>:</p><p>å‡è®¾æˆ‘ä»¬éœ€è¦æ£€æŸ¥ä¸€ä¸ªåä¸º<code>&quot;example.txt&quot;</code>çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š</p><p><strong>ä½¿ç”¨<code>fs.exists</code>çš„æ—§æ–¹å¼ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exists</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">exists</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">exists</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æ–‡ä»¶å­˜åœ¨ï¼&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¨èçš„æ–°æ–¹å¼ï¼šä½¿ç”¨<code>fs.stat</code>æˆ–<code>fs.access</code></strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨fs.statæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">stats</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ENOENT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‘ç”Ÿé”™è¯¯ï¼š&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å­˜åœ¨ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ–è€…ä½¿ç”¨fs.accessæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">access</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">constants</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">F_OK</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æ–‡ä»¶å­˜åœ¨ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ç§æ–°æ–¹æ³•ä¸­ï¼š</p><ul><li><code>fs.stat</code>å¯ä»¥ç»™ä½ æä¾›å…³äºæ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚å¤§å°ã€åˆ›å»ºæ—¶é—´ç­‰ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå…¶é”™è¯¯ä»£ç æ˜¯<code>ENOENT</code>ã€‚</li><li><code>fs.access</code>åˆ™æ›´ç®€æ´åœ°æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯è®¿é—®ã€‚<code>fs.constants.F_OK</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¸¸é‡ï¼Œç”¨æ¥æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ–‡ä»¶ä¸å¯è®¿é—®ï¼ˆä¾‹å¦‚ä¸å­˜åœ¨ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</li></ul><p>é€‰æ‹©<code>fs.stat</code>è¿˜æ˜¯<code>fs.access</code>å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ã€‚å¦‚æœä½ åªéœ€è¦çŸ¥é“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œé‚£ä¹ˆ<code>fs.access</code>è¶³å¤Ÿäº†ï¼›å¦‚æœä½ éœ€è¦å…³äºæ–‡ä»¶çš„é¢å¤–ä¿¡æ¯ï¼Œé‚£ä¹ˆ<code>fs.stat</code>ä¼šæ›´åˆé€‚ã€‚</p><h3 id="dep0035-fs-lchmod-path-mode-callback" tabindex="-1"><a class="header-anchor" href="#dep0035-fs-lchmod-path-mode-callback"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0035" target="_blank" rel="noopener noreferrer">DEP0035: fs.lchmod(path, mode, callback)</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆè®©æˆ‘ä»¬æ¾„æ¸…ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æœ‰ä¸åŒçš„æƒé™ï¼Œæ¯”å¦‚è¯»ï¼ˆreadï¼‰ã€å†™ï¼ˆwriteï¼‰å’Œæ‰§è¡Œï¼ˆexecuteï¼‰ã€‚è¿™äº›æƒé™å¯ä»¥æŒ‡å®šå“ªäº›ç”¨æˆ·å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œä½•ç§æ“ä½œã€‚åœ¨ç±» Unix ç³»ç»Ÿï¼ˆæ¯”å¦‚ Linux å’Œ MacOSï¼‰ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ”¹å˜ä¸€ä¸ªé“¾æ¥æ–‡ä»¶çš„æƒé™ï¼Œè¿™ç§æ“ä½œå«åšâ€œä¿®æ”¹ç¬¦å·é“¾æ¥çš„æ¨¡å¼â€ï¼ˆlchmodï¼‰ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ª JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚Node.js æœ‰ä¸€ä¸ªç§°ä¸º<code>fs</code>ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰çš„æ¨¡å—ï¼Œå…¶ä¸­åŒ…å«äº†å¾ˆå¤šç”¨äºæ–‡ä»¶æ“ä½œçš„å‡½æ•°ã€‚è¿™ä¸ªæ¨¡å—å°±åƒä¸€ä¸ªæ¡¥æ¢ï¼Œè®©ä½ çš„ JavaScript ä»£ç å¯ä»¥ä¸è®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿäº¤äº’ã€‚</p><p>ç°åœ¨ï¼Œå…³äºä½ æåˆ°çš„<a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0035" target="_blank" rel="noopener noreferrer">DEP0035: fs.lchmod(path, mode, callback)</a>ï¼š</p><ul><li><strong>DEP0035</strong> æ˜¯ Node.js å®˜æ–¹åˆ†é…ç»™ç‰¹å®šå¼ƒç”¨åŠŸèƒ½çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&quot;å¼ƒç”¨&quot;æ„å‘³ç€è¯¥åŠŸèƒ½ä¸å»ºè®®ä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</li><li><strong>fs.lchmod</strong> æ˜¯<code>fs</code>æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¼‚æ­¥åœ°æ”¹å˜é“¾æ¥æ–‡ä»¶çš„æƒé™ã€‚</li><li><strong>path</strong> æ˜¯ä½ æƒ³è¦ä¿®æ”¹æƒé™çš„é“¾æ¥æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><strong>mode</strong> æ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šæ–‡ä»¶åº”è¯¥æœ‰çš„æƒé™ã€‚</li><li><strong>callback</strong> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“<code>fs.lchmod</code>å®Œæˆæˆ–è€…å‘ç”Ÿé”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚</li></ul><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>fs.lchmod</code>è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ŒåŸå› æ˜¯è¿™ä¸ªåŠŸèƒ½åœ¨ Windows å¹³å°ä¸Šä¸å¯ç”¨ï¼Œå¹¶ä¸”åœ¨ç±» Unix ç³»ç»Ÿä¸Šä½¿ç”¨å¾—éå¸¸å°‘ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¿®æ”¹ç¬¦å·é“¾æ¥æœ¬èº«çš„æƒé™å¹¶æ²¡æœ‰å¤ªå¤šå®é™…ç”¨é€”ï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬å…³å¿ƒçš„æ˜¯é“¾æ¥æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶çš„æƒé™ï¼Œè€Œä¸æ˜¯é“¾æ¥æœ¬èº«ã€‚</p><p>ç”±äº<code>fs.lchmod</code>å·²ç»å¼ƒç”¨ï¼Œæ‰€ä»¥åœ¨æœªæ¥ç¼–å†™ Node.js ç¨‹åºæ—¶ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨å®ƒã€‚å¦‚æœä½ éœ€è¦ä¿®æ”¹æ–‡ä»¶çš„æƒé™ï¼Œä½ åº”è¯¥ä½¿ç”¨<code>fs.chmod</code>æˆ–è€…å…¶ Promise ç‰ˆæœ¬<code>fs.promises.chmod</code>ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨<code>fs.chmod</code>æ¥ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º&#39;test.txt&#39;çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦ä¿®æ”¹å®ƒçš„æƒé™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> filePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;test.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> newMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0o777</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ˜¯ä¸€ä¸ªå…«è¿›åˆ¶æ•°ï¼Œè¡¨ç¤ºæ–°çš„æƒé™æ˜¯å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¿®æ”¹æ–‡ä»¶æƒé™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">newMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å‘ç”Ÿé”™è¯¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶æƒé™ä¿®æ”¹æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>0o777</code>ä»£è¡¨è®¾ç½®æ–‡ä»¶çš„æƒé™ä¸ºå¯è¯»ï¼ˆ4ï¼‰ã€å¯å†™ï¼ˆ2ï¼‰å’Œå¯æ‰§è¡Œï¼ˆ1ï¼‰å¯¹æ‰€æœ‰ç”¨æˆ·ï¼ˆowner, group, and othersï¼‰ã€‚æ³¨æ„ï¼šå®é™…æƒ…å†µä¸‹ï¼Œèµ‹äºˆæ‰€æœ‰ç”¨æˆ·å®Œå…¨æƒé™å¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ï¼Œå› æ­¤åœ¨è®¾ç½®æ–‡ä»¶æƒé™æ—¶åº”è¯¥è°¨æ…ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>fs.lchmod</code>åœ¨ Node.js ä¸­è¢«å¼ƒç”¨äº†ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒçš„ç”¨ä¾‹éå¸¸å°‘ï¼Œè€Œä¸”ä¸è·¨å¹³å°ã€‚ä½ åº”è¯¥ä½¿ç”¨<code>fs.chmod</code>æˆ–<code>fs.promises.chmod</code>ç­‰å…¶ä»–æ–¹æ³•æ¥ä¿®æ”¹æ–‡ä»¶æƒé™ã€‚</p><h3 id="dep0036-fs-lchmodsync-path-mode" tabindex="-1"><a class="header-anchor" href="#dep0036-fs-lchmodsync-path-mode"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0036" target="_blank" rel="noopener noreferrer">DEP0036: fs.lchmodSync(path, mode)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„åº”ç”¨ã€‚Node.js ä½¿ç”¨äº†å¼‚æ­¥éé˜»å¡çš„ I/Oï¼Œè¿™æ„å‘³ç€å®ƒåœ¨å¤„ç†æ–‡ä»¶ã€ç½‘ç»œæ“ä½œç­‰æ—¶éå¸¸é«˜æ•ˆã€‚</p><p>åœ¨ Node.js çš„å„ä¸ªç‰ˆæœ¬ä¸­ï¼Œæœ‰æ—¶ä¼šå¯¹æŸäº›åŠŸèƒ½è¿›è¡Œå¼ƒç”¨ï¼ˆdeprecationï¼‰ã€‚è¿™æ„å‘³ç€å¼€å‘è€…è¢«é¼“åŠ±åœæ­¢ä½¿ç”¨æŸä¸ªç‰¹å®šçš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–è€…æ›¿æ¢ã€‚å¼ƒç”¨é€šå¸¸æ˜¯ç”±äºå®‰å…¨é—®é¢˜ã€æ€§èƒ½é—®é¢˜ï¼Œæˆ–è€…æ›´å¥½çš„å®ç°æ–¹æ³•çš„å‡ºç°è€Œå¼•èµ·çš„ã€‚</p><p>ä½ æåˆ°çš„ <code>DEP0036: fs.lchmodSync(path, mode)</code> å°±æ˜¯ Node.js ä¸­ä¸€ä¸ªè¢«å¼ƒç”¨çš„åŠŸèƒ½ã€‚<code>fs</code> æ¨¡å—æ˜¯ Node.js å†…ç½®çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—ç”¨äºä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’çš„æ–¹æ³•ã€‚<code>fs.lchmodSync</code> æ–¹æ³•ç”¨äºåŒæ­¥åœ°æ›´æ”¹ä¸€ä¸ªé“¾æ¥æ–‡ä»¶çš„æƒé™æ¨¡å¼ã€‚</p><p>æƒé™æ¨¡å¼ï¼ˆmodeï¼‰æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒæŒ‡å®šäº†æ–‡ä»¶æ‰€æœ‰è€…ã€æ‰€å±ç»„å’Œå…¶ä»–ç”¨æˆ·çš„è¯»å–ã€å†™å…¥å’Œæ‰§è¡Œæƒé™ã€‚</p><p>è¿™é‡Œçš„ <code>lchmodSync</code> ä¸ <code>chmodSync</code> ç›¸ä¼¼ï¼Œä½†å®ƒä¸“é—¨ç”¨æ¥æ›´æ”¹ç¬¦å·é“¾æ¥æœ¬èº«çš„æƒé™ï¼Œè€Œä¸æ˜¯é“¾æ¥æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶çš„æƒé™ã€‚ç¬¦å·é“¾æ¥å¯ä»¥æƒ³è±¡æˆ Windows ä¸­çš„å¿«æ·æ–¹å¼æˆ–è€…ç±»ä¼¼çš„åˆ«åï¼Œå®ƒä»¬æ˜¯æŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„å¼•ç”¨ã€‚</p><p>ç„¶è€Œï¼Œ<code>fs.lchmodSync</code> è¿™ä¸ªæ–¹æ³•åœ¨å¤§å¤šæ•°å¹³å°ä¸Šå…¶å®å¹¶ä¸æ”¯æŒä¿®æ”¹ç¬¦å·é“¾æ¥çš„æƒé™ï¼Œå› ä¸ºå¤§å¤šæ•°æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬ UNIX å’Œ Linuxï¼‰ä¸å…è®¸å•ç‹¬æ›´æ”¹ç¬¦å·é“¾æ¥æœ¬èº«çš„æƒé™ã€‚ç”±äºè¿™ä¸ªåŸå› ä»¥åŠå¾ˆå°‘è¢«ä½¿ç”¨ï¼ŒNode.js å›¢é˜Ÿå†³å®šå°†è¿™ä¸ªæ–¹æ³•æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆdeprecatedï¼‰ã€‚</p><p>å…·ä½“åˆ° <code>DEP0036</code> è¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ å°è¯•ä½¿ç”¨ <code>fs.lchmodSync</code> æ–¹æ³•ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªè­¦å‘Šï¼Œæç¤ºè¿™ä¸ªæ–¹æ³•åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>å®é™…ä¸Šï¼Œå¤§å¤šæ•°å¼€å‘è€…å¯èƒ½ä»æœªä½¿ç”¨è¿‡ <code>lchmodSync</code>ï¼Œå› ä¸ºç›´æ¥ä¿®æ”¹æ–‡ä»¶/ç›®å½•æƒé™ï¼ˆä½¿ç”¨ <code>chmod</code> æˆ– <code>chmodSync</code>ï¼‰å°±è¶³å¤Ÿäº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¿®æ”¹æ–‡ä»¶æƒé™çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®æ–‡ä»¶æƒé™ä¸º 644 (User: read/write, Group: read, Others: read)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">chmodSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0o644</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File permissions changed successfully&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error changing file permissions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ éœ€è¦å¤„ç†æ–‡ä»¶æƒé™æ—¶ï¼Œåº”è¯¥ä½¿ç”¨ <code>chmod</code> æˆ– <code>chmodSync</code> æ–¹æ³•æ¥ä¿®æ”¹éç¬¦å·é“¾æ¥æ–‡ä»¶çš„æƒé™ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç›¸å…³çš„æ–‡ä»¶ç³»ç»Ÿæ–¹æ³•æ¥å¤„ç†ç¬¦å·é“¾æ¥ã€‚</p><h3 id="dep0037-fs-lchown-path-uid-gid-callback" tabindex="-1"><a class="header-anchor" href="#dep0037-fs-lchown-path-uid-gid-callback"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0037" target="_blank" rel="noopener noreferrer">DEP0037: fs.lchown(path, uid, gid, callback)</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>fs.lchown</code> å‡½æ•°æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼ˆfilesystemï¼‰æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ›´æ”¹ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ˆsymlinkï¼‰æŒ‡å‘çš„æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ã€‚ç„¶è€Œï¼Œåœ¨ä½ æåˆ°çš„ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>fs.lchown</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œè¿™æ„å‘³ç€å®ƒä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><strong>ç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰</strong>: ç±»ä¼¼äºå¿«æ·æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚</li><li><strong>æ‰€æœ‰è€…ï¼ˆOwnerï¼‰</strong>: æ–‡ä»¶æˆ–ç›®å½•çš„æ‹¥æœ‰è€…ï¼Œé€šå¸¸åœ¨ Unix-like ç³»ç»Ÿä¸­ä»¥ç”¨æˆ· IDï¼ˆUIDï¼‰è¡¨ç¤ºã€‚</li><li><strong>ç»„ï¼ˆGroupï¼‰</strong>: æ–‡ä»¶æˆ–ç›®å½•æ‰€å±çš„ç¾¤ç»„ï¼ŒåŒæ ·ä»¥ç»„ IDï¼ˆGIDï¼‰è¡¨ç¤ºã€‚</li><li><strong>åºŸå¼ƒï¼ˆDeprecationï¼‰</strong>: æŒ‡çš„æ˜¯æŸä¸ªåŠŸèƒ½æˆ– API ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨å°†æ¥çš„æ›´æ–°ä¸­åˆ é™¤çš„è¿‡ç¨‹ã€‚</li></ul><p>åœ¨ Node.js ä¸­æ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€…çš„æ­£ç»Ÿæ–¹æ³•æ˜¯ä½¿ç”¨ <code>fs.chown</code> æˆ–å…¶å¼‚æ­¥ç‰ˆæœ¬ <code>fs.chownSync</code>ï¼Œä½†å¦‚æœä½ éœ€è¦æ”¹å˜çš„æ˜¯ç¬¦å·é“¾æ¥æœ¬èº«çš„æ‰€æœ‰æƒè€Œä¸æ˜¯å®ƒæ‰€æŒ‡å‘çš„ç›®æ ‡ï¼Œé‚£ä¹ˆåœ¨ Node.js æ—§ç‰ˆæœ¬ä¸­ä½ ä¼šä½¿ç”¨ <code>fs.lchown</code>ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæŒ‡å‘ <code>/tmp/myfile.txt</code> çš„ç¬¦å·é“¾æ¥ <code>/tmp/mysymlink</code>ï¼Œå¹¶ä¸”ä½ æƒ³æ›´æ”¹è¿™ä¸ªç¬¦å·é“¾æ¥çš„æ‰€æœ‰è€…ï¼Œä½ å¯ä»¥åœ¨ Node.js åºŸå¼ƒ <code>fs.lchown</code> å‰ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ è¦è®¾ç½®çš„ UID æ˜¯ 1000ï¼ŒGID æ˜¯ 100</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> uid</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gid</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lchown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/tmp/mysymlink&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">uid</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">gid</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ— æ³•æ›´æ”¹ç¬¦å·é“¾æ¥çš„æ‰€æœ‰è€…&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆåŠŸæ›´æ”¹ç¬¦å·é“¾æ¥çš„æ‰€æœ‰è€…&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶è€Œï¼Œå› ä¸º <code>fs.lchown</code> å·²ç»è¢«åºŸå¼ƒï¼Œç°åœ¨æ¨èçš„åšæ³•æ˜¯é€šè¿‡å…¶ä»–æ–¹å¼å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç›´æ¥æ“ä½œç³»ç»Ÿå‘½ä»¤æˆ–è€…æŸ¥æ‰¾æ–°çš„åº“å‡½æ•°æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚åœ¨åºŸå¼ƒ API çš„åŒæ—¶ï¼ŒNode.js ç¤¾åŒºå¾€å¾€ä¼šæä¾›æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…æ˜¯æ›´æ–°æ–‡æ¡£æ¥å¸®åŠ©å¼€å‘è€…è¿ç§»åˆ°æ–°çš„æ–¹æ³•ã€‚</p><p>æ€»ä¹‹ï¼ŒDEP0037 è¯´æ˜ <code>fs.lchown</code> ä¸å†æ˜¯ä¿®æ”¹ç¬¦å·é“¾æ¥æ‰€æœ‰æƒçš„æ¨èæ–¹æ³•ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œåº”è¯¥è€ƒè™‘æ›¿æ¢å®ƒä»¥ç¡®ä¿ä½ çš„ä»£ç å…¼å®¹å°†æ¥çš„ Node.js ç‰ˆæœ¬ã€‚</p><h3 id="dep0038-fs-lchownsync-path-uid-gid" tabindex="-1"><a class="header-anchor" href="#dep0038-fs-lchownsync-path-uid-gid"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0038" target="_blank" rel="noopener noreferrer">DEP0038: fs.lchownSync(path, uid, gid)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­è¿™ä¸€ç‰¹å®šçš„åºŸå¼ƒè­¦å‘Š <code>DEP0038</code>ã€‚</p><p>é¦–å…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„åºŸå¼ƒï¼ˆDeprecationï¼‰åŠŸèƒ½ï¼šè¿™æ„å‘³ç€æŸä¸ªåŠŸèƒ½ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå®Œå…¨ç§»é™¤ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºå­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…è¯¥åŠŸèƒ½ä¸å†ç¬¦åˆç°ä»£å¼€å‘çš„æœ€ä½³å®è·µã€‚</p><p>åœ¨ Node.js çš„æ–‡æ¡£ä¸­ï¼Œ<code>fs.lchownSync(path, uid, gid)</code> æ˜¯ <code>fs</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªæ–¹æ³•ã€‚<code>fs</code> æ¨¡å—æ˜¯ Node.js çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼Œå®ƒåŒ…å«äº†å¾ˆå¤šç”¨äºæ–‡ä»¶æ“ä½œçš„æ–¹æ³•ã€‚<code>lchownSync</code> è¿™ä¸ªå‡½æ•°ç”¨äºåŒæ­¥åœ°æ”¹å˜ä¸€ä¸ªé“¾æ¥æ–‡ä»¶çš„æ‰€æœ‰è€…ã€‚</p><p><code>path</code> å‚æ•°æ˜¯ä½ æƒ³è¦ä¿®æ”¹çš„é“¾æ¥æ–‡ä»¶çš„è·¯å¾„ã€‚<br><code>uid</code> æ˜¯ç”¨æˆ·æ ‡è¯†å·ï¼ŒæŒ‡å®šæ–°çš„æ–‡ä»¶æ‹¥æœ‰è€…ã€‚<br><code>gid</code> æ˜¯ç»„æ ‡è¯†å·ï¼ŒæŒ‡å®šæ–°çš„æ–‡ä»¶æ‰€å±ç»„ã€‚</p><p>å‡½æ•°åä¸­çš„ &#39;l&#39; è¡¨ç¤ºè¿™æ˜¯å¯¹ç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰çš„æ“ä½œï¼Œè€Œä¸æ˜¯å®ƒæ‰€æŒ‡å‘çš„å®é™…æ–‡ä»¶ã€‚&#39;Sync&#39; è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œï¼Œå³ä»£ç ä¼šåœç•™åœ¨è¿™é‡Œç›´åˆ°æ“ä½œå®Œæˆã€‚</p><p>ä½†åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆDEP0038ï¼‰ï¼Œè¿™è¡¨ç¤ºä½ ä¸åº”è¯¥å†ä½¿ç”¨å®ƒï¼ŒåŒæ—¶ä¹Ÿéœ€è¦å‡†å¤‡è¿ç§»åˆ°å…¶ä»–æ–¹æ³•ã€‚</p><p>é‚£ä¹ˆå®é™…ä¸Šï¼Œå¦‚æœä½ è¦æ”¹å˜æ–‡ä»¶æˆ–é“¾æ¥çš„æ‰€æœ‰è€…ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ–¹æ³•å‘¢ï¼ŸNode.js æ¨èä½¿ç”¨ <code>fs.chown()</code> æˆ– <code>fs.chownSync()</code> æ¥æ”¹å˜å®é™…æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œå¯¹äºé“¾æ¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>fs.lchown()</code> æˆ–å…¶åŒæ­¥ç‰ˆæœ¬ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>fs.chownSync()</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶ example.txtï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒçš„æ‰€æœ‰è€…æ”¹å˜ä¸º UID: 1000 å’Œ GID: 1000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">chownSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ‰€æœ‰è€…å·²æ›´æ”¹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ›´æ”¹æ‰€æœ‰è€…æ—¶å‡ºé”™:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºé“¾æ¥æ–‡ä»¶ï¼Œä½ ç°åœ¨åº”è¯¥é¿å…ä½¿ç”¨ <code>fs.lchownSync()</code>ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>fs.lchown()</code> æˆ–è€…åœ¨æ›´æ–° Node.js ç‰ˆæœ¬æ—¶æŸ¥çœ‹ç›¸å…³çš„å˜æ›´ä»¥ç¡®å®šæ­£ç¡®çš„æ›¿ä»£æ–¹æ³•ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>DEP0038</code> è¡¨æ˜ <code>fs.lchownSync()</code> ä¸å†æ˜¯ä¸€ä¸ªæ¨èä½¿ç”¨çš„æ–¹æ³•ï¼Œè€Œä½ åº”è¯¥å¯»æ‰¾å…¶ä»–æ–¹å¼æ¥ä¿®æ”¹æ–‡ä»¶æˆ–é“¾æ¥çš„æ‰€æœ‰è€…ä¿¡æ¯ã€‚</p><h3 id="dep0039-require-extensions" tabindex="-1"><a class="header-anchor" href="#dep0039-require-extensions"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0039" target="_blank" rel="noopener noreferrer">DEP0039: require.extensions</a></span></a></h3><p>Node.js ä¸­çš„ <code>require.extensions</code> æ˜¯ä¸€ä¸ªå†å²é—ç•™åŠŸèƒ½ï¼Œå®ƒæ›¾ç»å…è®¸å¼€å‘è€…é€šè¿‡ä¿®æ”¹ <code>require.extensions</code> å¯¹è±¡æ¥å‘Šè¯‰ Node.js å¦‚ä½•å¤„ç†ç‰¹å®šæ‰©å±•åçš„æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªåŠŸèƒ½å·²ç»è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨å’Œä¸å»ºè®®ä½¿ç”¨çš„ï¼Œæ‰€ä»¥åœ¨ Node.js çš„æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œå®ƒè¢«æ ‡è®°ä¸º deprecatedï¼ˆä¸æ¨èä½¿ç”¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ DEP0039ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾ä½ å¸Œæœ›è¦æ±‚ Node.js åœ¨åŠ è½½ <code>.txt</code> æ–‡ä»¶æ—¶å°†å…¶å†…å®¹è½¬åŒ–ä¸ºå¤§å†™å½¢å¼ï¼Œä½ å¯èƒ½ä¼šæ›¾ç»è¿™æ ·å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ç§æ–¹æ³•ç°åœ¨å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">extensions</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> content</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">  module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ç‰‡æ®µåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ loaderï¼Œå½“ä½ é€šè¿‡ <code>require</code> å¯¼å…¥ <code>.txt</code> æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šè¯»å–æ–‡ä»¶å†…å®¹å¹¶å°†å…¶è½¬æ¢æˆå¤§å†™å­—æ¯åè¿”å›ã€‚</p><p>ç„¶è€Œï¼Œä½¿ç”¨ <code>require.extensions</code> æ¥å®ç°è¿™ä¸€ç‚¹ä¸å†è¢«è®¤ä¸ºæ˜¯å¥½çš„å®è·µã€‚è¿™ç§æ–¹å¼ç ´åäº†æ¨¡å—ç³»ç»Ÿçš„å°è£…æ€§ï¼Œå¹¶å¯èƒ½å¯¼è‡´å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚éš¾ä»¥è°ƒè¯•å’Œä¸å¯é¢„è§çš„è¡Œä¸ºã€‚åŒæ—¶ï¼Œå› ä¸ºå®ƒå½±å“åˆ°å…¨å±€çŠ¶æ€ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¼šå½±å“åˆ°å…¶ä»–å¯èƒ½ä¾èµ–é»˜è®¤è¡Œä¸ºçš„æ¨¡å—æˆ–åŒ…ã€‚</p><p>ä»é•¿è¿œæ¥çœ‹ï¼Œæ›¿ä»£æ–¹æ¡ˆé€šå¸¸æ˜¯ä½¿ç”¨æ›´ç°ä»£ã€å®‰å…¨çš„æœºåˆ¶æ¥å¤„ç†é JavaScript æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><ol><li><p><strong>ä½¿ç”¨æ„å»ºå·¥å…·</strong>ï¼šåƒ Webpack æˆ– Browserify è¿™æ ·çš„æ„å»ºå·¥å…·å¯ä»¥è®¾ç½®åŠ è½½å™¨(loader)ï¼Œä½¿å¾—åœ¨æ„å»ºè¿‡ç¨‹ä¸­å¯ä»¥è‡ªå®šä¹‰å¦‚ä½•å¤„ç†ç‰¹å®šç±»å‹çš„æ–‡ä»¶ã€‚</p></li><li><p><strong>è‡ªå®šä¹‰å¯¼å…¥</strong>ï¼šä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„å¯¼å…¥å‡½æ•°æ¥å¤„ç†ç‰¹å®šçš„æ–‡ä»¶ç±»å‹ï¼Œè€Œä¸æ˜¯æ”¹å˜å…¨å±€çš„ <code>require</code> å‡½æ•°è¡Œä¸ºã€‚</p></li><li><p><strong>ECMAScript Modules (ESM)</strong>ï¼šåœ¨æ”¯æŒ ECMAScript æ¨¡å—çš„ç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰åŠ è½½å™¨ï¼Œæˆ–è€…åˆ©ç”¨ <code>import</code> è¡¨è¾¾å¼åŠ¨æ€å¯¼å…¥æ¨¡å—ã€‚</p></li></ol><p>å› æ­¤ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js v21.7.1 æˆ–ä»»ä½•ä¸€ä¸ªæ ‡è®°äº† <code>require.extensions</code> ä¸º deprecated çš„ç‰ˆæœ¬ï¼Œä½ åº”è¯¥å¯»æ‰¾æ›¿ä»£çš„æ–¹æ³•æ¥å¤„ç†æ–‡ä»¶å¯¼å…¥å’Œæ¨¡å—åŠ è½½ã€‚</p><h3 id="dep0040-node-punycode-module" tabindex="-1"><a class="header-anchor" href="#dep0040-node-punycode-module"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0040" target="_blank" rel="noopener noreferrer">DEP0040: node:punycode module</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¯ä»¥è®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¾ˆå¤šå†…ç½®æ¨¡å—æ¥å®Œæˆå„ç§ä»»åŠ¡ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯<code>punycode</code>æ¨¡å—ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…å¤„ç†å›½é™…åŸŸåï¼ˆInternationalized Domain Names, IDNsï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬é‡Œï¼Œ<code>node:punycode</code>æ¨¡å—è¢«æ ‡è®°ä¸ºåºŸå¼ƒäº†ã€‚</p><p>æ‰€è°“â€œåºŸå¼ƒâ€ï¼ˆDeprecationï¼‰ï¼ŒæŒ‡çš„æ˜¯å½“ä¸€ä¸ªåŠŸèƒ½æˆ–æ¨¡å—ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚Node.js å®˜æ–¹æ–‡æ¡£ä¸­çš„ DEP0040 æŒ‡å‡º<code>punycode</code>æ¨¡å—å·²ç»è¢«åºŸå¼ƒã€‚åŸå› æ˜¯ç°ä»£çš„ç½‘ç»œæµè§ˆå™¨å’Œå¤§å¤šæ•° JavaScript ç¯å¢ƒå·²ç»æ”¯æŒäº†<code>punycode</code>çš„åŠŸèƒ½ï¼Œè¿™ä½¿å¾— Node.js ä¸­çš„<code>punycode</code>æ¨¡å—å˜å¾—å¤šä½™ã€‚</p><p>Punycode æ˜¯ä¸€ç§ç¼–ç æ–¹å¼ï¼Œç”¨äºå°†åŒ…å«é ASCII å­—ç¬¦çš„å›½é™…åŒ–åŸŸåè½¬æ¢æˆå…¨ ASCII å­—ç¬¦é›†å½¢å¼ï¼Œä»¥ä¾¿äº DNS ç³»ç»Ÿå¤„ç†ã€‚ä¾‹å¦‚ï¼Œ&quot;<a href="http://xn--mnchen-3ya.de" target="_blank" rel="noopener noreferrer">mÃ¼nchen.de</a>&quot;ï¼ˆæ…•å°¼é»‘çš„å¾·æ–‡å†™æ³•ï¼‰é€šè¿‡ Punycode è½¬æ¢åä¼šå˜æˆ&quot;<a href="http://xn--mnchen-3ya.de" target="_blank" rel="noopener noreferrer">mÃ¼nchen.de</a>&quot;ã€‚</p><p>åœ¨ Node.js ä¸­ä½¿ç”¨<code>punycode</code>æ¨¡å—çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨Node.jsä¸­å¯¼å…¥punycodeæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> punycode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;punycode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†Unicodeå­—ç¬¦ä¸²è½¬æ¢ä¸ºPunycode</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> unicodeDomain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;mÃ¼nchen.de&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> asciiDomain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> punycode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toASCII</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">unicodeDomain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asciiDomain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: &quot;xn--mnchen-3ya.de&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†Punycodeè½¬å›Unicode</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> backToUnicode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> punycode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUnicode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asciiDomain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">backToUnicode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: &quot;mÃ¼nchen.de&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº<code>punycode</code>ç°åœ¨å·²ç»è¢«åºŸå¼ƒï¼Œå¦‚æœä½ éœ€è¦åœ¨ Node.js ä¸­è¿›è¡Œç±»ä¼¼çš„æ“ä½œï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–åº“ï¼Œæ¯”å¦‚<code>url</code>æ¨¡å—ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ç°ä»£ JavaScript æä¾›çš„<code>URL</code>å¯¹è±¡æ¥å¤„ç† IDNsã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨URLå¯¹è±¡å¤„ç†å›½é™…åŒ–åŸŸå</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://mÃ¼nchen.de&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è‡ªåŠ¨å¤„ç†Punycodeï¼Œè¾“å‡º: &quot;xn--mnchen-3ya.de&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå³ä½¿ Node.js ä¸­çš„<code>punycode</code>æ¨¡å—è¢«å®Œå…¨ç§»é™¤ï¼Œä½ ä»ç„¶æœ‰æ–¹æ³•æ¥å¤„ç†å›½é™…åŒ–çš„åŸŸåã€‚è®°å¾—åœ¨ç¼–å†™æ–°ä»£ç æ—¶é¿å…ä½¿ç”¨å·²åºŸå¼ƒçš„æ¨¡å—ï¼Œä»¥å…åœ¨æœªæ¥ Node.js çš„æŸä¸ªç‰ˆæœ¬æ›´æ–°ä¹‹åé‡åˆ°é—®é¢˜ã€‚</p><h3 id="dep0041-node-repl-history-file-environment-variable" tabindex="-1"><a class="header-anchor" href="#dep0041-node-repl-history-file-environment-variable"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0041" target="_blank" rel="noopener noreferrer">DEP0041: NODE_REPL_HISTORY_FILE environment variable</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼ŒREPL ä»£è¡¨â€œRead-Eval-Print Loopâ€ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ã€äº¤äº’å¼çš„ç¼–ç¨‹ç¯å¢ƒã€‚åœ¨ REPL ç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥è¾“å…¥ JavaScript ä»£ç ï¼Œç„¶åç«‹å³çœ‹åˆ°ä»£ç æ‰§è¡Œçš„ç»“æœã€‚</p><p>å½“ä½ ä½¿ç”¨ Node.js çš„ REPL æ—¶ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œä¹‹å‰è¾“å…¥è¿‡çš„å‘½ä»¤å¯ä»¥é€šè¿‡ä¸Šä¸‹ç®­å¤´é”®æ¥å›è°ƒã€‚REPL å†å²è®°å½•åŠŸèƒ½é»˜è®¤ä¼šå°†ä½ è¾“å…¥è¿‡çš„å‘½ä»¤ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°ä¹‹å‰å°è¯•è¿‡çš„ä»£ç ã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå†å²è®°å½•æ–‡ä»¶çš„ä½ç½®æ˜¯å¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ªåä¸º<code>NODE_REPL_HISTORY_FILE</code>çš„ç¯å¢ƒå˜é‡æ¥æŒ‡å®šçš„ã€‚å¦‚æœä½ è®¾ç½®äº†è¿™ä¸ªç¯å¢ƒå˜é‡ï¼ŒNode.js çš„ REPL å°±ä¼šæŠŠå†å²è®°å½•ä¿å­˜åœ¨ä½ æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚</p><p>ä½†æ˜¯åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>NODE_REPL_HISTORY_FILE</code> è¿™ä¸ªç¯å¢ƒå˜é‡å·²ç»è¢«å¼ƒç”¨ï¼ˆDEP0041ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ï¼Œä¸å†æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æ¥æŒ‡å®šå†å²è®°å½•æ–‡ä»¶çš„ä½ç½®äº†ã€‚</p><p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼ŒNode.js æä¾›äº†å…¶å®ƒé…ç½®é€‰é¡¹å’Œæ–¹å¼æ¥ç®¡ç† REPL çš„å†å²è®°å½•ã€‚ä¾‹å¦‚ï¼Œç°åœ¨ REPL å†å²è®°å½•é»˜è®¤ä¼šè¢«å­˜å‚¨åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ä¸€ä¸ªåä¸º<code>.node_repl_history</code>çš„éšè—æ–‡ä»¶ä¸­ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p>åœ¨æ—§ç‰ˆæœ¬ Node.js ä¸­ï¼Œå¦‚æœä½ æƒ³ä¿å­˜ REPL çš„å†å²åˆ°ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶ï¼Œæ¯”å¦‚<code>/my/custom/history.txt</code>ï¼Œä½ å¯èƒ½ä¼šåœ¨å¯åŠ¨ REPL ä¹‹å‰ï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿™æ ·è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_REPL_HISTORY_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">my</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">custom</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">history</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå½“ä½ åœ¨ REPL ä¸­è¾“å…¥å‘½ä»¤åï¼Œè¿™äº›å‘½ä»¤ä¼šè¢«ä¿å­˜åˆ°<code>/my/custom/history.txt</code>æ–‡ä»¶ä¸­ã€‚</p></li><li><p>ä½†æ˜¯ä» Node.js v21.7.1 å¼€å§‹ï¼Œè¿™ç§æ–¹å¼ä¸å†æ¨èä½¿ç”¨ï¼Œå› ä¸º<code>NODE_REPL_HISTORY_FILE</code>ç¯å¢ƒå˜é‡å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ã€‚æ‰€ä»¥ä½ åº”è¯¥ä¾èµ–äºé»˜è®¤çš„å­˜å‚¨æœºåˆ¶ï¼Œæˆ–è€…æŸ¥é˜…å½“å‰æ–‡æ¡£æ¥æ‰¾åˆ°æ–°çš„æ–¹æ³•æ¥è‡ªå®šä¹‰ REPL å†å²è®°å½•çš„è¡Œä¸ºã€‚</p></li><li><p>å¦‚æœä½ å‡çº§äº† Node.js å¹¶å‘ç°ä½ ä¹‹å‰è®¾ç½®çš„<code>NODE_REPL_HISTORY_FILE</code>ç¯å¢ƒå˜é‡ä¸å†èµ·ä½œç”¨ï¼Œä½ éœ€è¦é€‚åº”æ–°çš„å†å²è®°å½•æ–‡ä»¶ä½ç½®ï¼Œæˆ–è€…æŸ¥é˜… Node.js çš„æ–‡æ¡£æ¥äº†è§£å¦‚ä½•ä½¿ç”¨æ–°çš„é…ç½®æ–¹æ³•ã€‚</p></li></ol><p>æ‰€ä»¥ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œä¸å¿…æ‹…å¿ƒ<code>NODE_REPL_HISTORY_FILE</code>ç¯å¢ƒå˜é‡çš„å¼ƒç”¨ã€‚åªè¦çŸ¥é“ Node.js ä¼šè‡ªåŠ¨ä¿å­˜ä½ çš„ REPL ä¼šè¯å†å²ï¼Œé€šå¸¸ä½ ä¸éœ€è¦å»æ‰‹åŠ¨é…ç½®å®ƒï¼Œé™¤éæœ‰ç‰¹åˆ«çš„éœ€æ±‚å»æ”¹å˜é»˜è®¤è¡Œä¸ºã€‚å¦‚æœç¡®å®éœ€è¦è‡ªå®šä¹‰å†å²è®°å½•åŠŸèƒ½ï¼Œæœ€å¥½æŸ¥é˜…æœ€æ–°çš„ Node.js æ–‡æ¡£æ¥è·å–å½“å‰æ¨èçš„åšæ³•ã€‚</p><h3 id="dep0042-tls-cryptostream" tabindex="-1"><a class="header-anchor" href="#dep0042-tls-cryptostream"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0042" target="_blank" rel="noopener noreferrer">DEP0042: tls.CryptoStream</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå…è®¸å¼€å‘è€…ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚åœ¨ Node.js ä¸­ï¼Œ<code>tls.CryptoStream</code> æ˜¯ä¸€ä¸ªä¸å®‰å…¨ä¼ è¾“å±‚ï¼ˆTLSï¼‰ç›¸å…³çš„åŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><p><strong>TLS (Transport Layer Security)</strong>: è¿™æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç”¨æ¥ä¸ºç½‘ç»œé€šä¿¡æä¾›åŠ å¯†å’Œæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚é€šå¸¸å½“ä½ è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œå¦‚æœåœ°å€ä»¥ <code>https://</code> å¼€å¤´ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿æ¥å°±æ˜¯ä½¿ç”¨äº† TLS çš„åŠ å¯†é€šä¿¡ã€‚</p></li><li><p><strong>Deprecation (å¼ƒç”¨)</strong>: åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–è€…ç»„ä»¶ä¸å†å»ºè®®ä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå¼ƒç”¨â€ã€‚å¼ƒç”¨é€šå¸¸æ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œæˆ–è€…åŸæœ‰çš„åŠŸèƒ½å­˜åœ¨å®‰å…¨é—®é¢˜ç­‰åŸå› ã€‚</p></li><li><p><strong>CryptoStream</strong>: åœ¨æ—©æœŸçš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œ<code>CryptoStream</code> ç±»æ˜¯ç”¨äºåˆ›å»ºåŠ å¯†çš„æµå¯¹è±¡çš„ä¸€ä¸ªæ¥å£ã€‚å®ƒå…è®¸å¼€å‘è€…å°†æ•°æ®é€šè¿‡ä¸€ä¸ªåŠ å¯†çš„é€šé“è¿›è¡Œä¼ è¾“ã€‚</p></li></ol><p>ç°åœ¨ï¼Œä½ æåˆ°çš„ <code>DEP0042: tls.CryptoStream</code> æ˜¯æŒ‡åœ¨ Node.js çš„æ–‡æ¡£ä¸­æ ‡è®°çš„ä¸€é¡¹å¼ƒç”¨è­¦å‘Šã€‚è¿™æ„å‘³ç€ <code>tls.CryptoStream</code> ç±»å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</p><p>å®é™…åº”ç”¨ä¾‹å­ï¼š</p><p>å‡è®¾åœ¨è¿‡å»ï¼Œä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦å®‰å…¨åœ°å‘é€ä¸€äº›æ•æ„Ÿä¿¡æ¯ç»™å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚ä½ å¯èƒ½ä¼šä½¿ç”¨ <code>tls.CryptoStream</code> æ¥åˆ›å»ºä¸€ä¸ªåŠ å¯†é€šé“ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;private-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;public-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">cleartextStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encryptedStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CryptoStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cleartextStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨encryptedStreamæ¥è¯»å–æˆ–å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  encryptedStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, this is a secure message!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª TLS æœåŠ¡å™¨å¹¶ä½¿ç”¨äº† <code>tls.CryptoStream</code> æ¥å¤„ç†åŠ å¯†çš„æ•°æ®æµã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼ç°åœ¨å·²ç»ä¸å†æ¨èä½¿ç”¨ã€‚</p><p>æ›¿ä»£æ–¹æ¡ˆï¼š</p><p>Node.js ç¤¾åŒºåŠå…¶ç»´æŠ¤è€…é¼“åŠ±å¼€å‘è€…ä½¿ç”¨æ›´æ–°ã€æ›´å®‰å…¨çš„æ–¹æ³•æ¥å¤„ç† TLS åŠ å¯†ï¼Œä¾‹å¦‚ç›´æ¥ä½¿ç”¨ <code>tls.TLSSocket</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œå¯ä»¥æ›´å¥½åœ°ç®¡ç†åŠ å¯†çš„å¥—æ¥å­—ï¼ˆsocketsï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;private-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;public-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯ä»¥ç›´æ¥ä½¿ç”¨ socket å¯¹è±¡è¯»å–æˆ–å†™å…¥åŠ å¯†çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, this is a secure message!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»»ä½•è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯éƒ½å°†æ”¶åˆ°ä¸€æ¡åŠ å¯†çš„æ¶ˆæ¯ã€‚æ³¨æ„è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ <code>CryptoStream</code>â€”â€”æˆ‘ä»¬ç›´æ¥æ“ä½œ <code>socket</code> å¯¹è±¡ï¼Œè¿™æ­£æ˜¯ <code>tls.TLSSocket</code> æä¾›çš„åŠŸèƒ½ã€‚</p><p>ç»“è®ºæ˜¯ï¼Œå¦‚æœä½ æ­£åœ¨å­¦ä¹  Node.jsï¼Œå¹¶æƒ³è¦æ¶‰åŠåˆ° TLS åŠ å¯†ä¼ è¾“æ–¹é¢çš„å†…å®¹ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨ <code>tls.CryptoStream</code>ï¼Œè€Œåº”è¯¥ä½¿ç”¨ç°ä»£åŒ–çš„ APIï¼Œå¦‚ <code>tls.TLSSocket</code>ã€‚è¿™æ ·èƒ½ç¡®ä¿ä½ çš„åº”ç”¨æ›´å®‰å…¨ã€ç¬¦åˆå½“å‰æœ€ä½³å®è·µã€‚</p><h3 id="dep0043-tls-securepair" tabindex="-1"><a class="header-anchor" href="#dep0043-tls-securepair"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0043" target="_blank" rel="noopener noreferrer">DEP0043: tls.SecurePair</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œç”¨äºæ„å»ºå„ç§ç±»å‹çš„åç«¯æœåŠ¡å’Œåº”ç”¨ç¨‹åºã€‚åœ¨æˆ‘ä»¬è®¨è®ºçš„è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œDEP0043â€æ˜¯ä¸€ä¸ªåºŸå¼ƒè­¦å‘Šï¼Œæ„æ€æ˜¯è¯´ï¼Œåœ¨ Node.js çš„æŸä¸ªç‰ˆæœ¬ä¸­æœ‰äº›åŠŸèƒ½å°†ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</p><p><code>tls.SecurePair</code>æ˜¯ Node.js ä¸­<code>tls</code>æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚<code>tls</code>æ¨¡å—æä¾›äº†å®ç° TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å’Œ SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚åè®®ï¼‰åŠ å¯†çš„åŠŸèƒ½ï¼Œè¿™ä¸¤ç§åè®®éƒ½æ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨ä¿éšœçš„æ ‡å‡†æŠ€æœ¯ã€‚</p><p>å…·ä½“åˆ°<code>tls.SecurePair</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªè¾ƒæ—©çš„ APIï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªå®‰å…¨çš„å¥—æ¥å­—å¯¹ï¼ˆå³åŒ…å«ä¸€ä¸ªåŠ å¯†å’Œä¸€ä¸ªè§£å¯†æµçš„å¯¹è±¡ï¼‰ï¼Œå®ƒä¸»è¦ç”¨äº TLS åŠ å¯†çš„æ•°æ®ä¼ è¾“ã€‚ä½†æ˜¯ï¼Œä» Node.js 0.11 ç‰ˆæœ¬å¼€å§‹ï¼Œ<code>tls.SecurePair</code>å°±è¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„ï¼Œå› ä¸ºæœ‰æ›´ç°ä»£ã€æ›´å®‰å…¨ã€æ›´å®¹æ˜“ä½¿ç”¨çš„æ›¿ä»£æ–¹æ³•å‡ºç°äº†ï¼Œæ¯”å¦‚<code>tls.TLSSocket</code>ã€‚</p><p>æ‰€ä»¥ï¼Œ<code>DEP0043: tls.SecurePair</code> è¿™ä¸ªåºŸå¼ƒè­¦å‘Šæ˜¯æŒ‡ Node.js æ˜ç¡®è¡¨æ˜<code>tls.SecurePair</code>è¿™ä¸ª API ä¸åº”è¯¥å†è¢«ä½¿ç”¨ï¼Œå¹¶ä¸”å°†æ¥æŸä¸ªç‰ˆæœ¬å¯èƒ½ä¼šå®Œå…¨ç§»é™¤å®ƒã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£ä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µï¼š</p><ol><li>åœ¨æ—§ç‰ˆ Node.js ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Deprecated way to create a secure pair</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> securePair</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSecurePair</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCredentials</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// securePair.cleartext would be the stream you interact with for reading and writing data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ç°ä»£çš„ Node.js ä»£ç ä¸­ï¼Œä½¿ç”¨<code>tls.TLSSocket</code>ä»£æ›¿äº†ä¸Šé¢çš„åšæ³•ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Modern way to create a TLS socket</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;server connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;authorized&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;unauthorized&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç°ä»£ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>tls.createServer()</code>æ–¹æ³•æ¥å»ºç«‹ä¸€ä¸ªå¯ä»¥æ¥å—å®‰å…¨è¿æ¥çš„æœåŠ¡å™¨ï¼Œä»£æ›¿äº†ä½¿ç”¨<code>tls.SecurePair</code>çš„è€æ—§æ–¹æ³•ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œå®ƒä»¬å°†é€šè¿‡ TLS è¿›è¡Œé€šä¿¡ï¼Œæ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½ä¼šè¢«åŠ å¯†ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>DEP0043: tls.SecurePair</code>æ˜¯ Node.js æ ¸å¿ƒå›¢é˜Ÿå‘å‡ºçš„ä¸€ä¸ªä¿¡æ¯ï¼Œå‘Šè¯‰å¼€å‘è€…è¿™ä¸ªåŠŸèƒ½ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”æœªæ¥å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚å› æ­¤ï¼Œå¦‚æœä½ åœ¨ç¼–å†™æ–°çš„ Node.js åº”ç”¨ç¨‹åºï¼Œåº”å½“ä½¿ç”¨æ¨èçš„åŠ å¯†æ–¹å¼ï¼Œæ¯”å¦‚<code>tls.TLSSocket</code>ï¼Œè€Œä¸æ˜¯<code>tls.SecurePair</code>ã€‚</p><h3 id="dep0044-util-isarray" tabindex="-1"><a class="header-anchor" href="#dep0044-util-isarray"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0044" target="_blank" rel="noopener noreferrer">DEP0044: util.isArray()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>util.isArray()</code>æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ›¾ç»ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªç»™å®šçš„å‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æ‰€è°“â€œåˆ¤æ–­â€ï¼Œå°±æ˜¯çœ‹è¿™ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ä¸æ˜¯æ•°ç»„ã€‚æ¯”æ–¹è¯´ï¼Œä½ æœ‰ä¸€äº›ä¸œè¥¿ï¼ˆæ¯”å¦‚æ•°å­—ã€å­—ç¬¦ä¸²ã€å¯¹è±¡ç­‰ï¼‰ï¼Œä½ æƒ³çŸ¥é“è¿™ä¸ªä¸œè¥¿æ˜¯ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½ å°±å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥æ£€æŸ¥ã€‚</p><p>ä½†æ˜¯ï¼Œä» Node.js v21.7.1 å¼€å§‹ï¼Œ<code>util.isArray()</code>è¿™ä¸ªæ–¹æ³•è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå·²ç»ä¸å†æ¨èä½¿ç”¨äº†ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚è¿™æ ·åšçš„åŸå› é€šå¸¸æ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹å¼ï¼Œæˆ–è€…æ˜¯ç»´æŠ¤è¿™ä¸ªåŠŸèƒ½çš„æˆæœ¬å˜å¾—ä¸å†åˆç†ã€‚</p><p>å¯¹äº<code>util.isArray()</code>æ¥è¯´ï¼Œè‡ªä» ECMAScript 5ï¼ˆJavaScript çš„ä¸€ä¸ªç‰ˆæœ¬ï¼‰å¼•å…¥äº†<code>Array.isArray()</code>æ–¹æ³•ä»¥åï¼ŒNode.js ç¤¾åŒºå°±è¶Šæ¥è¶Šå€¾å‘äºç›´æ¥ç”¨è¿™ä¸ªå†…å»ºçš„ JavaScript æ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œå› ä¸ºå®ƒæ›´æ ‡å‡†åŒ–ï¼Œè€Œä¸”æ•ˆç‡æ›´é«˜ã€‚å› æ­¤ï¼ŒNode.js å¼€å‘å›¢é˜Ÿå†³å®šå°†<code>util.isArray()</code>æ ‡è®°ä¸ºè¿‡æ—¶çš„ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œä½ åº”è¯¥ä½¿ç”¨<code>Array.isArray()</code>æ–¹æ³•ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­æ¥çœ‹çœ‹è¿™ä¸¤ç§æ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>å‡è®¾æ—©æœŸçš„ Node.js ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myArray æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myArray ä¸æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myNumber æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myNumber ä¸æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä¼šè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>myArray æ˜¯ä¸€ä¸ªæ•°ç»„</span></span>
<span class="line"><span>myNumber ä¸æ˜¯ä¸€ä¸ªæ•°ç»„</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œç”±äº<code>util.isArray()</code>å·²ç»è¢«åºŸå¼ƒï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨<code>Array.isArray()</code>æ¥ä»£æ›¿å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myArray æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myArray ä¸æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myNumber æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myNumber ä¸æ˜¯ä¸€ä¸ªæ•°ç»„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µæ–°çš„ä»£ç åŒæ ·ä¼šè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>myArray æ˜¯ä¸€ä¸ªæ•°ç»„</span></span>
<span class="line"><span>myNumber ä¸æ˜¯ä¸€ä¸ªæ•°ç»„</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“èµ·æ¥ï¼Œç”±äº<code>util.isArray()</code>å·²ç»è¢«åºŸå¼ƒï¼Œå½“ä½ éœ€è¦æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºæ•°ç»„æ—¶ï¼Œä½ åº”è¯¥é‡‡ç”¨<code>Array.isArray()</code>è¿™ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯æ¨èçš„åšæ³•ï¼Œå¹¶ä¸”å®ƒå°†ä¸æœªæ¥çš„ Node.js ç‰ˆæœ¬å…¼å®¹ã€‚</p><h3 id="dep0045-util-isboolean" tabindex="-1"><a class="header-anchor" href="#dep0045-util-isboolean"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0045" target="_blank" rel="noopener noreferrer">DEP0045: util.isBoolean()</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„ <code>util.isBoolean()</code> è¿™ä¸ªæ–¹æ³•ã€‚<code>util</code> æ˜¯ Node.js çš„ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å®ç”¨çš„å°å·¥å…·ï¼Œè¿™äº›å·¥å…·åšäº†å¾ˆå¤šæœ‰ç”¨çš„äº‹æƒ…ï¼Œæ¯”å¦‚æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€æ£€æŸ¥å˜é‡ç±»å‹ç­‰ã€‚</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node ä¸­ï¼Œ<code>util</code> æ¨¡å—ä¸­åŒ…å«äº†ä¸€ä¸ªå«åš <code>isBoolean()</code> çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨éå¸¸ç®€å•ï¼šå®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆ<code>true</code> æˆ–è€… <code>false</code>ï¼‰ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªå‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆå³ <code>true</code> æˆ– <code>false</code>ï¼‰ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isBoolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isBoolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isBoolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isBoolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>isBoolean()</code> å‡½æ•°æ¥æ£€æŸ¥ä¸€äº›å€¼æ˜¯å¦ä¸ºå¸ƒå°”å€¼ã€‚å‰ä¸¤æ¬¡è°ƒç”¨æ£€æŸ¥äº† <code>true</code> å’Œ <code>false</code>ï¼Œå¹¶ä¸”æ­£ç¡®åœ°è¿”å›äº† <code>true</code>ã€‚è€Œåä¸¤æ¬¡æ£€æŸ¥äº†æ•°å­— <code>0</code> å’Œ <code>null</code> å€¼ï¼Œå¹¶ä¸”æ­£ç¡®åœ°è¿”å›äº† <code>false</code>ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯å¸ƒå°”å€¼ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>util.isBoolean()</code> è¢«æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€çš„ï¼ˆDeprecationï¼‰çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ–¹æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚åœ¨ Node.js æ–‡æ¡£ä¸­å…³äºå¼ƒç”¨çš„è¯´æ˜é‡Œï¼Œæ¯ä¸ªå¼ƒç”¨çš„ API éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç ï¼Œå¯¹äº <code>util.isBoolean()</code> è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒçš„å¼ƒç”¨æ ‡è¯†ç æ˜¯ <code>DEP0045</code>ã€‚</p><p>ç°åœ¨ï¼Œä¸ºä»€ä¹ˆ Node.js è¦å¼ƒç”¨ <code>util.isBoolean()</code> å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸º JavaScript è¯­è¨€æœ¬èº«å·²ç»æä¾›äº†ä¸€äº›æ›´ç®€å•ã€ç›´æ¥çš„æ–¹å¼æ¥åšåŒæ ·çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>typeof</code> æ“ä½œç¬¦æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯å¸ƒå°”å€¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;boolean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;boolean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;boolean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;boolean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ–°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ <code>util.isBoolean()</code>ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº† <code>typeof</code> è¿ç®—ç¬¦ã€‚è¿™ç§æ–¹å¼ä¸ä»…ç®€å•ï¼Œè€Œä¸”æ˜¯åŸç”Ÿæ”¯æŒçš„ï¼Œä¸ä¾èµ–äº Node.js çš„ <code>util</code> æ¨¡å—ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨æˆ–æ‰“ç®—ä½¿ç”¨ <code>util.isBoolean()</code>ï¼Œä½ åº”è¯¥æ”¹ç”¨å…¶ä»–æ–¹å¼ï¼Œæ¯”å¦‚ <code>typeof</code> æ“ä½œç¬¦ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç æ›´åŠ ç¨³å®šå’Œæœªæ¥å…¼å®¹ã€‚</p><h3 id="dep0046-util-isbuffer" tabindex="-1"><a class="header-anchor" href="#dep0046-util-isbuffer"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0046" target="_blank" rel="noopener noreferrer">DEP0046: util.isBuffer()</a></span></a></h3><p><code>util.isBuffer()</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js ä¸­ç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ <code>Buffer</code> çš„æ–¹æ³•ã€‚ä¸€ä¸ª <code>Buffer</code> åœ¨ Node.js ä¸­æ˜¯ç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®æµçš„ã€‚</p><p>ä¸è¿‡ï¼Œå½“ä½ çœ‹åˆ° <code>[DEP0046: util.isBuffer()]</code> è¿™æ ·ä¸€ä¸ªæ ‡è®°ï¼Œè¿™æ„å‘³ç€ <code>util.isBuffer()</code> æ–¹æ³•å·²ç»è¢«å¼ƒç”¨ï¼ˆDeprecateï¼‰ï¼Œå³ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚Node.js çš„å¼€å‘è€…å›¢é˜Ÿé¼“åŠ±å¼€å‘è€…ä»¬è¿ç§»åˆ°æ–°çš„ã€æ›´å¥½çš„å®è·µä¸Šå»ã€‚</p><p>ä¸ºäº†æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ <code>Buffer</code>ï¼Œæˆ‘ä»¬ç°åœ¨åº”è¯¥ä½¿ç”¨ <code>Buffer.isBuffer()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>util.isBuffer()</code>ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ <code>Buffer.isBuffer()</code> æ˜¯æ›´æ¨èçš„æ–¹å¼ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šç»™ä½ å±•ç¤ºä¸¤ä¸ªä¾‹å­ï¼Œé¦–å…ˆæ˜¯æ—§æ–¹æ³•ï¼ˆç°åœ¨ä¸æ¨èä½¿ç”¨çš„ï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ—§çš„æ–¹æ³•ï¼Œä¸æ¨èä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªBufferå¯¹è±¡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™ä¸æ˜¯ä¸€ä¸ªBufferå¯¹è±¡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨æ–°çš„ã€æ¨èçš„æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–°çš„æ–¹æ³•ï¼Œæ¨èä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªBufferå¯¹è±¡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™ä¸æ˜¯ä¸€ä¸ªBufferå¯¹è±¡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª <code>Buffer</code> å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨ <code>Buffer.from()</code> å¹¶ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸² &#39;Node.js&#39; æ¥åˆ›å»ºã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨ <code>Buffer.isBuffer()</code> æ–¹æ³•æ¥æ£€æŸ¥è¿™ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ <code>Buffer</code> ç±»å‹ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°±æ‰“å°å‡ºç›¸åº”çš„æ¶ˆæ¯ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœä½ åœ¨ç¼–ç æ—¶é‡åˆ°äº† <code>util.isBuffer()</code>ï¼Œè¯·è®°å¾—æ›¿æ¢æˆ <code>Buffer.isBuffer()</code>ï¼Œä»¥ç¡®ä¿ä»£ç çš„å…¼å®¹æ€§å’Œæœªæ¥çš„ç¨³å®šæ€§ã€‚</p><h3 id="dep0047-util-isdate" tabindex="-1"><a class="header-anchor" href="#dep0047-util-isdate"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0047" target="_blank" rel="noopener noreferrer">DEP0047: util.isDate()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…ç½®çš„æ¨¡å—å’Œæ–¹æ³•å¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´é«˜æ•ˆåœ°ç¼–å†™ç¨‹åºã€‚</p><p>å½“ä½ çœ‹åˆ° <code>DEP0047: util.isDate()</code> è¿™æ ·çš„ä¿¡æ¯æ—¶ï¼Œè¿™è¡¨æ˜ Node.js çš„å¼€å‘è€…å†³å®šå¼ƒç”¨ï¼ˆå³ä¸å†æ¨èä½¿ç”¨ï¼‰<code>util.isDate()</code> æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå®Œå…¨ç§»é™¤å®ƒã€‚&quot;DEP0047&quot; æ˜¯æ­¤å¼ƒç”¨é¡¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ <code>util.isDate()</code> æ˜¯ä»€ä¹ˆï¼š</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>util</code> æ¨¡å—æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œæä¾›äº†å¾ˆå¤šå®ç”¨å·¥å…·å‡½æ•°ã€‚åœ¨ <code>util</code> æ¨¡å—ä¸­ï¼Œ<code>isDate()</code> å‡½æ•°è¢«ç”¨äºæ£€æŸ¥ç»™å®šçš„å‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ª Date å¯¹è±¡ã€‚å¦‚æœæ˜¯ Date å¯¹è±¡ï¼Œå®ƒä¼šè¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</p><p>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨ <code>util.isDate()</code> å‘¢ï¼Ÿå› ä¸º JavaScript å·²ç»æœ‰äº†æ›´ç®€å•çš„æ–¹å¼æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ Date ç±»å‹ï¼Œè€Œä¸”è¿™ç§æ–¹å¼æ›´åŠ æ ‡å‡†å’Œå¯è¯»ã€‚æ‰€ä»¥ï¼ŒNode.js å¼€å‘å›¢é˜Ÿè®¤ä¸ºæ²¡æœ‰å¿…è¦ç»§ç»­æ”¯æŒ <code>util.isDate()</code>ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥ç†è§£è¿™ä¸€ç‚¹ï¼š</p><p><strong>è¿‡å»ä½¿ç”¨ <code>util.isDate()</code>:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> date</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isDate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrue</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> notDate</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;2021-01-01&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isDate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">notDate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šfalse</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç°åœ¨çš„æ›¿ä»£æ–¹æ³•:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> date</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">date</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrue</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> notDate</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;2021-01-01&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">notDate</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šfalse</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„ä»£ç ä¸­ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨å·²è¢«å¼ƒç”¨çš„ <code>util.isDate()</code> æ–¹æ³•ï¼Œè€Œåº”è¯¥ä½¿ç”¨ <code>instanceof</code> æ“ä½œç¬¦æ¥ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ Date å®ä¾‹ã€‚è¿™ç§æ–¹å¼æ›´åŠ ç›´è§‚ï¼Œä¹Ÿæ˜¯ JavaScript æä¾›çš„åŸç”Ÿæ–¹æ³•ã€‚</p><p>è®°ä½ï¼Œè·Ÿè¿›å¹¶ä½¿ç”¨æœ€æ–°çš„ã€æ¨èçš„åšæ³•æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œæ›´å°‘çš„å®‰å…¨é£é™©ï¼Œå¹¶ä¸”å¾—åˆ°æ›´å¹¿æ³›çš„æ”¯æŒã€‚</p><h3 id="dep0048-util-iserror" tabindex="-1"><a class="header-anchor" href="#dep0048-util-iserror"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0048" target="_blank" rel="noopener noreferrer">DEP0048: util.isError()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚éšç€ Node.js ç‰ˆæœ¬çš„æ›´æ–°ï¼Œæœ‰äº›åŠŸèƒ½ä¼šè¢«åºŸå¼ƒï¼ˆdeprecateï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«å®Œå…¨ç§»é™¤ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºè¿™äº›åŠŸèƒ½å¯èƒ½å­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œæˆ–è€…å› ä¸ºå®ƒä»¬çš„è®¾è®¡ä¸ç¬¦åˆå½“å‰çš„æœ€ä½³å®è·µã€‚</p><p><code>util.isError()</code>æ˜¯<code>util</code>æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ£€æµ‹ä¼ å…¥çš„å‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼ˆError objectï¼‰ã€‚ä½†è‡ªä» Node.js v6.0.0 å¼€å§‹ï¼Œ<code>util.isError()</code>å°±å·²ç»è¢«å¼ƒç”¨äº†ï¼Œå¹¶ä¸”åœ¨æ–‡æ¡£ä¸­è¢«æ ‡è®°ä¸º DEP0048ã€‚</p><p>â€œå¼ƒç”¨â€ï¼ˆDeprecationï¼‰æ˜¯å‘Šè¯‰ç”¨æˆ·æŸä¸ªåŠŸèƒ½å°†ä¸å†è¢«æ”¯æŒï¼Œå¹¶åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½è¢«ç§»é™¤çš„ä¸€ç§è­¦å‘Šã€‚é€šå¸¸ï¼Œå¼ƒç”¨çš„åŠŸèƒ½åœ¨ä¸€æ®µæ—¶é—´å†…ä»ç„¶å¯ç”¨ï¼Œä»¥ä¾¿ç»™ç”¨æˆ·è¿‡æ¸¡åˆ°æ–°æ–¹æ³•çš„æ—¶é—´ã€‚</p><p>é‚£ä¹ˆï¼Œç°åœ¨å¦‚æœä½ éœ€è¦æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯é”™è¯¯å¯¹è±¡ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿåœ¨ JavaScript ä¸­ï¼Œæ‰€æœ‰çš„é”™è¯¯å¯¹è±¡éƒ½æ˜¯åŸºäº<code>Error</code>æ„é€ å‡½æ•°æˆ–å…¶å­ç±»ï¼ˆä¾‹å¦‚<code>SyntaxError</code>, <code>TypeError</code>ç­‰ï¼‰åˆ›å»ºçš„ã€‚å› æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>instanceof</code>æ“ä½œç¬¦æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯ç‰¹å®šç±»å‹çš„å®ä¾‹ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="æ—§æ–¹æ³•-ä½¿ç”¨util-iserror" tabindex="-1"><a class="header-anchor" href="#æ—§æ–¹æ³•-ä½¿ç”¨util-iserror"><span>æ—§æ–¹æ³•ï¼šä½¿ç”¨<code>util.isError()</code></span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> error</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‡ºé”™äº†ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isError</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrue</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œ<code>util.isError(error)</code>ä¼šè¿”å›<code>true</code>ï¼Œå› ä¸º<code>error</code>æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚ä½†ç”±äº<code>util.isError()</code>è¢«å¼ƒç”¨ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å†ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><h4 id="æ–°æ–¹æ³•-ä½¿ç”¨instanceof" tabindex="-1"><a class="header-anchor" href="#æ–°æ–¹æ³•-ä½¿ç”¨instanceof"><span>æ–°æ–¹æ³•ï¼šä½¿ç”¨<code>instanceof</code></span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> error</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‡ºé”™äº†ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> error</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrue</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨<code>error instanceof Error</code>æ¥æ£€æŸ¥<code>error</code>æ˜¯å¦æ˜¯<code>Error</code>ç±»å‹çš„å®ä¾‹ã€‚è¿™å°†åŒæ ·è¿”å›<code>true</code>ï¼Œè¡¨ç¤º<code>error</code>ç¡®å®æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js å¹¶ä¸”éœ€è¦æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯é”™è¯¯å¯¹è±¡ï¼Œè¯·é¿å…ä½¿ç”¨<code>util.isError()</code>ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨<code>instanceof</code>æ“ä½œç¬¦ï¼Œå°±åƒåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­æ‰€ç¤ºã€‚è¿™æ ·ä½ çš„ä»£ç ä¼šæ›´åŠ ç¬¦åˆå½“å‰çš„ Node.js æœ€ä½³å®è·µï¼Œä¹Ÿä¼šæ›´åŠ ç¨³å›ºå½“é¢å¯¹æœªæ¥ Node.js ç‰ˆæœ¬çš„æ›´æ–°ã€‚</p><h3 id="dep0049-util-isfunction" tabindex="-1"><a class="header-anchor" href="#dep0049-util-isfunction"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0049" target="_blank" rel="noopener noreferrer">DEP0049: util.isFunction()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>util.isFunction()</code> æ˜¯ä¸€ä¸ªç”¨æ¥æ£€æŸ¥æŸä¸ªå€¼æ˜¯å¦ä¸ºå‡½æ•°çš„å·¥å…·å‡½æ•°ã€‚ä½†åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€ï¼ˆdeprecatedï¼‰ï¼Œæ„å‘³ç€å®ƒä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ Node.js ä¸æ–­è¿›åŒ–ã€æ”¹å–„ API å¹¶å»é™¤ä¸å¿…è¦æˆ–æœ‰é—®é¢˜åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ç‰ˆæœ¬ v21.7.1 ä¸­æåˆ°çš„ <code>DEP0049: util.isFunction()</code> å¼ƒç”¨è­¦å‘Šå°±æ˜¯è¯´ï¼Œå¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨ <code>util.isFunction()</code> è¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨å…¶ä»–æ–¹å¼æ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºå‡½æ•°ã€‚</p><p>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨ <code>util.isFunction()</code> å‘¢ï¼Ÿä¸€ä¸ªåŸå› å¯èƒ½æ˜¯ JavaScript æœ¬èº«å·²ç»æœ‰äº†ç®€å•ç›´æ¥çš„æ–¹å¼æ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºå‡½æ•°ï¼Œå³ä½¿ç”¨ <code>typeof</code> æ“ä½œç¬¦ã€‚å› æ­¤ï¼Œ<code>util.isFunction()</code> å¯èƒ½è¢«è§†ä¸ºå¤šä½™çš„ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•åœ¨å¼ƒç”¨ <code>util.isFunction()</code> ä¹‹å‰å’Œä¹‹åæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºå‡½æ•°çš„ä¾‹å­ï¼š</p><p><strong>å¼ƒç”¨ä¹‹å‰çš„ä½¿ç”¨ <code>util.isFunction()</code> æ–¹æ³•ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> myFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡½æ•°ä½“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ util.isFunction() æ¥åˆ¤æ–­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFunction æ˜¯ä¸€ä¸ªå‡½æ•°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFunction ä¸æ˜¯ä¸€ä¸ªå‡½æ•°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¼ƒç”¨ä¹‹åä½¿ç”¨ <code>typeof</code> æ“ä½œç¬¦ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> myFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡½æ•°ä½“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ typeof æ¥åˆ¤æ–­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myFunction</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFunction æ˜¯ä¸€ä¸ªå‡½æ•°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFunction ä¸æ˜¯ä¸€ä¸ªå‡½æ•°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œä½¿ç”¨ <code>typeof</code> æ“ä½œç¬¦æ˜¯éå¸¸ç›´æ¥çš„ã€‚å½“ä½ éœ€è¦æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºå‡½æ•°æ—¶ï¼Œä»…éœ€æ¯”è¾ƒè¯¥å€¼çš„ç±»å‹æ˜¯å¦ç­‰äº <code>&#39;function&#39;</code> å­—ç¬¦ä¸²å³å¯ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨ç°æœ‰çš„ä»£ç ä¸­çœ‹åˆ°äº† <code>util.isFunction()</code> çš„ä½¿ç”¨ï¼Œä½ åº”è¯¥è€ƒè™‘æ›¿æ¢å®ƒä¸º <code>typeof</code> æ“ä½œç¬¦çš„ä½¿ç”¨ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç æ›´åŠ å¥å£®å’Œæœªæ¥å…¼å®¹ã€‚</p><h3 id="dep0050-util-isnull" tabindex="-1"><a class="header-anchor" href="#dep0050-util-isnull"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0050" target="_blank" rel="noopener noreferrer">DEP0050: util.isNull()</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Node.jsã€‚Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œä»è€Œå¼€å‘å‡ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ã€‚</p><p>åœ¨ Node.js ä¸­æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œ<code>util</code> å°±æ˜¯å…¶ä¸­ä¸€ä¸ªå†…ç½®çš„å·¥å…·æ¨¡å—ï¼Œæä¾›äº†è®¸å¤šå®ç”¨çš„å°å·¥å…·ã€‚ç„¶è€Œï¼Œå¹¶ä¸æ˜¯è¿™ä¸ªæ¨¡å—é‡Œçš„æ‰€æœ‰åŠŸèƒ½éƒ½ä¼šæ°¸è¿œå­˜åœ¨ã€‚éšç€æŠ€æœ¯çš„è¿›æ­¥å’Œè¯­è¨€ç‰¹æ€§çš„æ›´æ–°ï¼Œä¸€äº›åŠŸèƒ½å¯èƒ½ä¼šå˜å¾—ä¸å†æ¨èä½¿ç”¨ï¼ˆè¢«åºŸå¼ƒï¼‰ï¼Œç”šè‡³åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚å½“ Node.js å›¢é˜Ÿå†³å®šä¸€ä¸ªåŠŸèƒ½ä¸å†é€‚åˆä½¿ç”¨æ—¶ï¼Œå®ƒä»¬ä¼šå‘å¸ƒä¸€ä¸ªâ€œåºŸå¼ƒè­¦å‘Šâ€(Deprecation warning)ã€‚</p><p><code>DEP0050</code> æ˜¯ä¸€ä¸ªè¿™æ ·çš„åºŸå¼ƒè­¦å‘Šï¼Œå®ƒæŒ‡å‡º <code>util.isNull()</code> å‡½æ•°å·²ç»è¢«åºŸå¼ƒäº†ã€‚</p><p><code>util.isNull()</code> æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­ç»™å®šçš„å€¼æ˜¯å¦ä¸º <code>null</code>ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isNull</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isNull</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡½æ•°å¾ˆç›´è§‚ï¼šå¦‚æœä½ ä¼ å…¥ <code>null</code>ï¼Œå®ƒè¿”å› <code>true</code>ï¼›å¦åˆ™è¿”å› <code>false</code>ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®æ˜¯éå¸¸ç®€å•çš„ï¼Œä½ å¯ä»¥é€šè¿‡ç›´æ¥ä½¿ç”¨ <code>===</code> æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸º <code>null</code>ï¼Œè€Œä¸éœ€è¦è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Node.js å›¢é˜Ÿå†³å®šåºŸå¼ƒå®ƒï¼Œå› ä¸ºå®ƒçš„åŠŸèƒ½å¯ä»¥é€šè¿‡åŸç”Ÿçš„ JavaScript è¯­æ³•å®ç°ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼æ›´åŠ ç®€æ´ç›´è§‚ï¼Œä¸ä¾èµ–äº <code>util</code> æ¨¡å—ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨åŸç”Ÿçš„æ¯”è¾ƒæ“ä½œç¬¦æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚</p><p>å®é™…è¿ç”¨ä¸­ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶çš„å¤„ç†å‡½æ•°ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“æŸä¸ªé‡è¦çš„é…ç½®é¡¹æ˜¯å¦æ²¡æœ‰è®¾ç½®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">databaseConnection</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Database connection configuration is missing!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ... å¤„ç†å…¶ä»–é…ç½® ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  databaseConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œä½†å¦‚æœä¸å°å¿ƒæ˜¯ nullï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ <code>===</code> æ¥æ£€æŸ¥é…ç½®é¡¹æ˜¯å¦ä¸º <code>null</code>ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ <code>util.isNull()</code>ï¼Œå› ä¸ºå®ƒå·²ç»è¢«åºŸå¼ƒå¹¶ä¸”ä¸æ¨èä½¿ç”¨äº†ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>DEP0050</code> è¡¨æ˜äº† <code>util.isNull()</code> ä¸å†æ¨èä½¿ç”¨ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨åŸç”Ÿçš„ JavaScript è¯­æ³•æ¥è¿›è¡Œç›¸åŒçš„æ£€æŸ¥ã€‚è¿™æœ‰åŠ©äºä¿æŒä»£ç çš„ç®€æ´æ€§å¹¶å‡å°‘å¯¹è¿‡æ—¶æˆ–å°†è¦åºŸå¼ƒçš„åŠŸèƒ½çš„ä¾èµ–ã€‚</p><h3 id="dep0051-util-isnullorundefined" tabindex="-1"><a class="header-anchor" href="#dep0051-util-isnullorundefined"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0051" target="_blank" rel="noopener noreferrer">DEP0051: util.isNullOrUndefined()</a></span></a></h3><p><code>util.isNullOrUndefined()</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªæ—§æ–¹æ³•ï¼Œç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯ <code>null</code> æˆ–è€… <code>undefined</code>ã€‚åœ¨è¿‡å»å¯èƒ½æœ‰äº›å¼€å‘è€…ä¼šä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç®€åŒ–å¯¹ <code>null</code> å’Œ <code>undefined</code> çš„æ£€æŸ¥ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js çš„æ–°ç‰ˆæœ¬ä¸­ï¼Œå®˜æ–¹ä¸å†æ¨èä½¿ç”¨ <code>util.isNullOrUndefined()</code> è¿™ä¸ªæ–¹æ³•äº†ï¼Œå› æ­¤å®ƒè¢«æ ‡è®°ä¸º Deprecatedï¼ˆå¼ƒç”¨ï¼‰ã€‚è¿™æ„å‘³ç€è¯¥æ–¹æ³•å·²ç»ä¸å»ºè®®ä½¿ç”¨ï¼Œå¹¶ä¸”æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ—©æœŸä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨ <code>util.isNullOrUndefined()</code> æ¥æ£€æŸ¥å˜é‡ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isNullOrUndefined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å˜é‡æ˜¯ null æˆ–è€… undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å˜é‡æœ‰å€¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ç°åœ¨ï¼Œä½ åº”è¯¥ç”¨å…¶ä»–æ–¹å¼æ¥è¿›è¡Œè¿™æ ·çš„æ£€æŸ¥ã€‚æœ€ç®€å•çš„æ›¿ä»£æ–¹æ³•å°±æ˜¯ç›´æ¥ä½¿ç”¨ <code>== null</code> æ£€æŸ¥ï¼Œå› ä¸º <code>== null</code> å®é™…ä¸Šå¯ä»¥åŒæ—¶æ£€æŸ¥ <code>null</code> å’Œ <code>undefined</code>ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å˜é‡æ˜¯ null æˆ–è€… undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å˜é‡æœ‰å€¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æƒ³è¦åˆ†åˆ«æ£€æŸ¥ <code>null</code> å’Œ <code>undefined</code>ï¼Œåˆ™å¯ä»¥ç”¨ä¸¥æ ¼ç­‰äºæ“ä½œç¬¦ <code>===</code>ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å˜é‡æ˜¯ undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å˜é‡æ˜¯ null&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å˜é‡æœ‰å€¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼Œå› ä¸º <code>util.isNullOrUndefined()</code> è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥é¿å…åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”é€æ¸æŠŠæ—§ä»£ç ä¸­çš„è¿™ä¸ªæ–¹æ³•æ›¿æ¢æ‰ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„ä»£ç å…¼å®¹å°†æ¥çš„ Node.js ç‰ˆæœ¬ã€‚</p><h3 id="dep0052-util-isnumber" tabindex="-1"><a class="header-anchor" href="#dep0052-util-isnumber"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0052" target="_blank" rel="noopener noreferrer">DEP0052: util.isNumber()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªè¢«ç§°ä¸º <code>util.isNumber()</code> çš„åŠŸèƒ½ã€‚è¿™ä¸ªå‡½æ•°æ›¾ç»æ˜¯ <code>util</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè¢«ç”¨æ¥æ£€æŸ¥ç»™å®šçš„å€¼æ˜¯å¦æ˜¯æ•°å­—ç±»å‹ã€‚ä½†æ˜¯ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>util.isNumber()</code> è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDeprecationï¼‰ï¼Œæ„å‘³ç€è¿™ä¸ªå‡½æ•°ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚è¿™ç±»å¼ƒç”¨çš„åŠŸèƒ½é€šå¸¸æ˜¯å› ä¸ºæœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œæˆ–è€…å› ä¸ºåŸæ¥çš„å®ç°æ–¹å¼ä¸å†é€‚å½“ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-util-isnumber-è¢«å¼ƒç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-util-isnumber-è¢«å¼ƒç”¨"><span>ä¸ºä»€ä¹ˆ <code>util.isNumber()</code> è¢«å¼ƒç”¨ï¼Ÿ</span></a></h3><p>éšç€ JavaScript å‘å±•å’Œ ES6ï¼ˆECMAScript 2015ï¼‰çš„å¼•å…¥ï¼Œè¯­è¨€å†…ç½®äº†æ›´å¤šçš„å·¥å…·æ¥å¸®åŠ©å¼€å‘è€…å®Œæˆä»»åŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬ç±»å‹æ£€æµ‹ã€‚ES6 å¸¦æ¥äº† <code>typeof</code> è¿ç®—ç¬¦å’Œ <code>Number.isFinite()</code>ã€<code>Number.isInteger()</code> ç­‰å‡½æ•°ï¼Œè¿™äº›éƒ½æ˜¯è¿›è¡Œæ•°å­—æ£€æµ‹çš„æ ‡å‡†æ–¹æ³•ã€‚ç”±äºè¿™äº›åŸç”Ÿæ–¹æ³•æ—¢æ–¹ä¾¿åˆå¯é ï¼ŒNode.js å†³å®šå¼ƒç”¨ <code>util.isNumber()</code>ã€‚</p><h3 id="æ›¿ä»£-util-isnumber" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£-util-isnumber"><span>æ›¿ä»£ <code>util.isNumber()</code></span></a></h3><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ <code>util.isNumber()</code> æ¥æ£€æŸ¥å€¼æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ JavaScript æä¾›çš„å…¶ä»–å·¥å…·æ›¿æ¢ã€‚æ ¹æ®ä½ æƒ³è¦æ£€æŸ¥çš„ç‰¹å®šæ¡ä»¶ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥å˜é‡æ˜¯å¦ä¸ºæ•°å­—ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 42</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Value is a number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºæ•´æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isInteger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Value is an integer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºæœ‰é™æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isFinite</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Value is a finite number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p><strong>ç¤ºä¾‹ 1ï¼šéªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦ä¸ºæ•°å­—</strong></p><p>å‡è®¾ä½ åœ¨ç¼–å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»ç”¨æˆ·é‚£é‡Œæ¥æ”¶å¹´é¾„ä¿¡æ¯ã€‚ä½ æƒ³ç¡®ä¿ä»–ä»¬è¾“å…¥çš„æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­—ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> validateAge</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isFinite</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // Input æ˜¯ä¸€ä¸ªæœ‰é™æ•°ï¼Œç»§ç»­å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Valid age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // Input ä¸æ˜¯æ•°å­—ï¼Œæç¤ºç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Invalid age, please enter a number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">validateAge</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š&quot;Valid age&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">validateAge</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š&quot;Invalid age, please enter a number&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç¤ºä¾‹ 2ï¼šè®¡ç®—æ•°ç»„ä¸­æ•°å­—çš„æ€»å’Œ</strong></p><p>ä½ å¯èƒ½åœ¨å¤„ç†ä¸€ä¸ªæ•°ç»„ï¼Œåªæƒ³è®¡ç®—å…¶ä¸­çš„æ•°å­—ç±»å‹å…ƒç´ çš„æ€»å’Œã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> items</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sumNumbers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> items</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">reduce</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">acc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> acc</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> acc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sumNumbers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š10 (1+2+3+4)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç æ®µä¸­ï¼Œ<code>reduce</code> æ–¹æ³•éå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶ä½¿ç”¨ <code>typeof</code> æ¥æ£€æŸ¥å®ƒæ˜¯å¦ä¸ºæ•°å­—ã€‚å¦‚æœæ˜¯æ•°å­—ï¼Œå°±æŠŠå®ƒåŠ åˆ°ç´¯ç§¯å™¨ <code>acc</code> ä¸Šã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œè™½ç„¶ <code>util.isNumber()</code> åœ¨ Node.js v21.7.1 ä¸­å·²ç»è¢«å¼ƒç”¨ï¼Œä½†æˆ‘ä»¬æœ‰æ›´å¥½çš„åŸç”Ÿ JavaScript æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œè¿™äº›æ–¹æ³•é€šå¸¸æ›´ç®€æ´ã€æ›´ç›´è§‚ï¼Œå¹¶ä¸”ä¸ JavaScript çš„å…¶å®ƒç‰¹æ€§å’Œæœªæ¥ç‰ˆæœ¬æ›´å…¼å®¹ã€‚</p><h3 id="dep0053-util-isobject" tabindex="-1"><a class="header-anchor" href="#dep0053-util-isobject"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0053" target="_blank" rel="noopener noreferrer">DEP0053: util.isObject()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;å¼ƒç”¨ï¼ˆDeprecationï¼‰&quot;ä¸€è¯æ˜¯æŒ‡æŸä¸ªåŠŸèƒ½ï¼ˆå‡½æ•°ã€æ–¹æ³•ç­‰ï¼‰ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¿™ä¸ªåŠŸèƒ½å·²ç»æœ‰äº†æ›´å¥½çš„æ›¿ä»£é€‰æ‹©ï¼Œæˆ–è€…å®ƒçš„è®¾è®¡å­˜åœ¨é—®é¢˜ã€‚</p><p><code>util.isObject()</code>æ˜¯ Node.js ä¸­ä¸€ä¸ªå†å²ä¸Šå­˜åœ¨çš„å·¥å…·å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ç»™å®šçš„å‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯ç°åœ¨å®ƒè¢«å¼ƒç”¨äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒNode.js å®˜æ–¹ä¸å»ºè®®å¼€å‘è€…ç»§ç»­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯æ¨èä½¿ç”¨å…¶ä»–æ–¹å¼æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆå¼ƒç”¨-util-isobject" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆå¼ƒç”¨-util-isobject"><span>ä¸ºä»€ä¹ˆå¼ƒç”¨ util.isObject()ï¼Ÿ</span></a></h3><p><code>util.isObject()</code>è¿™ä¸ªå‡½æ•°å®é™…ä¸Šå¹¶ä¸å¯é ï¼Œå› ä¸ºå®ƒå¯¹äºåˆ¤æ–­æŸäº›å€¼æ˜¯å¦ä¸ºå¯¹è±¡å¯èƒ½ä¼šç»™å‡ºæ„æ–™ä¹‹å¤–çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œnull åœ¨ JavaScript ä¸­è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå¯¹è±¡å¼•ç”¨ï¼Œä½†æ˜¯è®¸å¤šå¼€å‘è€…ä¸å¸Œæœ›æŠŠ null å½“ä½œä¸€ä¸ªå¯¹è±¡å¤„ç†ã€‚</p><p>å› æ­¤ï¼ŒNode.js å†³å®šå¼ƒç”¨<code>util.isObject()</code>ï¼Œæ¨èå¼€å‘è€…ä½¿ç”¨æ›´åŠ æ˜ç¡®å’Œå¯é çš„æ–¹æ³•æ¥æ£€æµ‹å¯¹è±¡ã€‚</p><h3 id="æ›¿ä»£æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£æ–¹æ¡ˆ"><span>æ›¿ä»£æ–¹æ¡ˆ</span></a></h3><p>ä½œä¸ºæ›¿ä»£ï¼Œä½ å¯ä»¥ä½¿ç”¨åŸç”Ÿçš„ JavaScript èƒ½åŠ›æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºå¯¹è±¡ã€‚ä¸€ä¸ªç®€å•çš„åˆ¤æ–­ä¾‹å­æ˜¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;object&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // `value` æ˜¯ä¸€ä¸ªé `null` çš„å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç é¦–å…ˆæ£€æŸ¥<code>value</code>æ˜¯å¦ä¸º&#39;object&#39;ç±»å‹ï¼Œç„¶åç¡®ä¿å®ƒä¸æ˜¯<code>null</code>ã€‚è¿™æ ·å¯ä»¥æ›´å‡†ç¡®åœ°ç¡®å®š<code>value</code>æ˜¯ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„å¯¹è±¡ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œä½ éœ€è¦æ£€æŸ¥ä¼ å…¥çš„å‚æ•°<code>data</code>æ˜¯å¦æ˜¯ä¸€ä¸ªå¯ä»¥æ“ä½œçš„å¯¹è±¡ã€‚ä½¿ç”¨å¼ƒç”¨çš„<code>util.isObject()</code>çš„è€ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°ä»£ç ä¸­ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨<code>util.isObject()</code>ï¼Œè€Œæ”¹ç”¨åŸç”Ÿçš„ JavaScript æ£€æŸ¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;object&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ éœ€è¦å¤„ç†å¤šç§ç±»å‹ï¼Œè¿˜å¯ä»¥æ‰©å±•è¿™ä¸ªé€»è¾‘ï¼Œæ¯”å¦‚åŒæ—¶åˆ¤æ–­<code>data</code>æ˜¯å¦ä¸ºæ•°ç»„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;object&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ç¡®ä¿ä½ çš„ä»£ç ä¸ä¾èµ–äº Node.js ä¸­è¢«å¼ƒç”¨çš„<code>util.isObject()</code>å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿä½¿ä½ çš„ç±»å‹æ£€æŸ¥æ›´åŠ ç²¾ç¡®å’Œå¯é ã€‚</p><h3 id="dep0054-util-isprimitive" tabindex="-1"><a class="header-anchor" href="#dep0054-util-isprimitive"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0054" target="_blank" rel="noopener noreferrer">DEP0054: util.isPrimitive()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>util.isPrimitive()</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨äºæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯åŸå§‹ç±»å‹çš„å€¼ã€‚æ‰€è°“â€œåŸå§‹ç±»å‹â€çš„å€¼ï¼Œé€šå¸¸æŒ‡çš„æ˜¯é‚£äº›ä¸æ˜¯å¯¹è±¡ä¹Ÿæ²¡æœ‰æ–¹æ³•çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ï¼šæ•°å­—ï¼ˆNumberï¼‰ã€å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€<code>null</code>ã€<code>undefined</code> ä»¥åŠ<code>Symbol</code>ï¼ˆES6 æ–°å¢çš„ç±»å‹ï¼‰ã€‚</p><p>ä½†æ˜¯ï¼Œä» Node.js v4.0.0 ç‰ˆæœ¬å¼€å§‹ï¼Œ<code>util.isPrimitive()</code> å‡½æ•°å·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆå³å®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼‰ã€‚è¿™æ„å‘³ç€ä¸åº”è¯¥å†ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå› ä¸ºéšç€ Node.js çš„æ›´æ–°ï¼Œå®ƒæœ€ç»ˆä¼šè¢«ç§»é™¤å¹¶å¯èƒ½å¯¼è‡´ä»£ç æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p><p>åœ¨ Node.js æ¡†æ¶ä¸­æ ‡è®°ä¸€ä¸ªåŠŸèƒ½æˆ–æ–¹æ³•ä¸º&quot;deprecated&quot;ï¼ˆå¼ƒç”¨ï¼‰ï¼Œæ˜¯å‘Šè¯‰å¼€å‘è€…è¯¥åŠŸèƒ½å°†ä¸è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”æœªæ¥å¯èƒ½ä¼šä» Node.js API ä¸­ç§»é™¤ã€‚è¿™æ ·åšé€šå¸¸æ˜¯å› ä¸ºå·²ç»æœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹å¼ï¼Œæˆ–è€…è¯¥åŠŸèƒ½å·²ç»ä¸å†é€‚åˆç°ä»£çš„å¼€å‘éœ€æ±‚äº†ã€‚</p><p>æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š</p><ol><li>å‡è®¾ä½ æƒ³æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯åŸå§‹ç±»å‹çš„å€¼ï¼Œä½ å¯èƒ½ä¼šå†™è¿™æ ·çš„ä»£ç ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isPrimitive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myValue is a primitive value.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>å¦‚æœä½ æƒ³æ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯åŸå§‹ç±»å‹ï¼Œä½ å¯èƒ½ä¼šè¿™ä¹ˆåšï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isPrimitive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myString is a primitive value.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>å†æ¯”å¦‚ï¼Œä½ æƒ³ç¡®è®¤ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸æ˜¯åŸå§‹å€¼ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isPrimitive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myObject is not a primitive value, it is an object.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº <code>util.isPrimitive()</code> è¢«å¼ƒç”¨ï¼Œä½ åº”è¯¥ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥è¿›è¡Œç›¸åŒçš„æ£€æµ‹ã€‚åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ typeof è¿ç®—ç¬¦æ¥æ£€æŸ¥å€¼çš„ç±»å‹ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ typeof æ¥æ›¿ä»£ util.isPrimitive() çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;object&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myValue is a primitive value.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myString is a primitive value.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;object&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myObject is a primitive value.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myObject is not a primitive value, it is an object.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¯¹æ¯” <code>typeof</code> çš„ç»“æœå’Œ &#39;object&#39; æˆ– &#39;function&#39;ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šä¸€ä¸ªå€¼æ˜¯å¦æ˜¯åŸå§‹å€¼ã€‚æ³¨æ„ï¼Œåœ¨ JavaScript ä¸­ï¼Œ<code>null</code> è™½ç„¶è¢« <code>typeof</code> åˆ¤æ–­ä¸º &#39;object&#39;ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæ‰€ä»¥è¦é¢å¤–æ£€æŸ¥ <code>myObject !== null</code>ã€‚</p><h3 id="dep0055-util-isregexp" tabindex="-1"><a class="header-anchor" href="#dep0055-util-isregexp"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0055" target="_blank" rel="noopener noreferrer">DEP0055: util.isRegExp()</a></span></a></h3><p><code>util.isRegExp()</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegExpï¼‰çš„å®ä¾‹ã€‚ä½†åœ¨ Node.js çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸ºâ€œåºŸå¼ƒâ€çš„ï¼ˆDEP0055ï¼‰ï¼Œæ„å‘³ç€å¼€å‘è€…ä¸åº”è¯¥å†ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</p><p>å½“æˆ‘ä»¬è¯´ä¸€ä¸ª API æˆ–è€…å‡½æ•°è¢«â€œåºŸå¼ƒâ€æ—¶ï¼Œé€šå¸¸æ˜¯å› ä¸ºå®ƒå·²ç»è¢«æ›¿ä»£äº†æ›´å¥½æˆ–è€…æ›´ç°ä»£çš„æ–¹æ³•ï¼Œæˆ–è€…å› ä¸ºå®ƒæœ‰æ½œåœ¨çš„é—®é¢˜ï¼Œä½¿å¾—ç»´æŠ¤å®ƒå˜å¾—å›°éš¾ã€‚</p><p>å¯¹äº <code>util.isRegExp()</code> æ¥è¯´ï¼ŒNode.js å¼€å‘å›¢é˜Ÿè®¤ä¸ºä¸éœ€è¦ä¸“é—¨çš„å‡½æ•°æ¥æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œå› ä¸ºè¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ JavaScript è‡ªå¸¦çš„ <code>instanceof</code> è¿ç®—ç¬¦æ¥å®Œæˆã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨ <code>util.isRegExp()</code> çš„æ—§ä»£ç ä¸­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> regex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E06C75;"> /abc/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isRegExp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">regex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º trueï¼Œå› ä¸º regex æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> notRegex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;not a regex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isRegExp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">notRegex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º falseï¼Œå› ä¸º notRegex ä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­çš„ <code>util.isRegExp()</code> åº”è¯¥è¢«æ›¿æ¢ä¸ºä½¿ç”¨ <code>instanceof RegExp</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> regex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E06C75;"> /abc/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">regex</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> RegExp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º trueï¼Œå› ä¸º regex æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> notRegex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;not a regex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">notRegex</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> RegExp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º falseï¼Œå› ä¸º notRegex ä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨ <code>instanceof RegExp</code> æ›¿ä»£ <code>util.isRegExp()</code> æ˜¯ä¸€ä¸ªç®€å•è€Œç›´æ¥çš„æ–¹å¼ï¼Œå®ƒä¸ä¾èµ–äº Node.js çš„ç‰¹å®šæ¨¡å—ï¼Œå¹¶ä¸”æ›´åŠ éµå¾ªé€šç”¨çš„ JavaScript å®è·µã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨çœ‹åˆ°ä¸€äº›æ—§çš„ Node.js ä»£ç æˆ–è€…å­¦ä¹ èµ„æ–™ä¸­æåˆ°äº† <code>util.isRegExp()</code>ï¼Œè¯·è®°ä½æ›¿æ¢æˆ <code>instanceof RegExp</code> ä½œä¸ºæ£€æµ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼ã€‚è¿™æ ·åšæ—¢ä¿è¯äº†ä»£ç çš„æœªæ¥å…¼å®¹æ€§ï¼Œä¹Ÿæ›´åŠ ç¬¦åˆç°ä»£ JavaScript å¼€å‘çš„æ ‡å‡†ã€‚</p><h3 id="dep0056-util-isstring" tabindex="-1"><a class="header-anchor" href="#dep0056-util-isstring"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0056" target="_blank" rel="noopener noreferrer">DEP0056: util.isString()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;deprecated&quot;è¿™ä¸ªè¯æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–è€… API ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚å½“ä½ çœ‹åˆ°<code>DEP0056: util.isString()</code>è¿™æ ·çš„ä¿¡æ¯æ—¶ï¼Œå®ƒå‘Šè¯‰ä½ <code>util.isString()</code>è¿™ä¸ªå‡½æ•°å·²ç»è¢«å¼ƒç”¨äº†ã€‚</p><p><code>util.isString()</code>æ˜¯ Node.js ä¸­<code>util</code>æ¨¡å—æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨äºæ£€æŸ¥ç»™å®šçš„å‚æ•°æ˜¯å¦æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚ä½†æ˜¯ï¼Œéšç€ JavaScript è¯­è¨€æœ¬èº«å’Œå¼€å‘ç¤¾åŒºçš„å‘å±•ï¼Œè¿™ç§ç±»å‹æ£€æŸ¥çš„æ–¹å¼é€æ¸è¢«è®¤ä¸ºæ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ JavaScript çš„<code>typeof</code>æ“ä½œç¬¦æ¥æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯å­—ç¬¦ä¸²ã€‚</p><p>è®©æˆ‘ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚å‡è®¾ä½ ä»¥å‰ä½¿ç”¨<code>util.isString()</code>æ¥åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myVar</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myVar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myVar is a string.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myVar is not a string.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æ—¢ç„¶<code>util.isString()</code>è¢«å¼ƒç”¨äº†ï¼Œä½ åº”è¯¥æ”¹ç”¨<code>typeof</code>æ“ä½œç¬¦ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myVar</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myVar</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myVar is a string.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myVar is not a string.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ä½ çš„ä»£ç æ›´åŠ ç®€æ´ï¼Œå¹¶ä¸”ä½ ä¸å†ä¾èµ–äº Node.js æ ¸å¿ƒæ¨¡å—é‡Œå¯èƒ½å°†æ¥ä¼šè¢«åˆ é™¤çš„å‡½æ•°ã€‚è¿™ç§åŸç”Ÿçš„ JavaScript æ–¹æ³•ä¹Ÿæœ‰åˆ©äºä½ çš„ä»£ç å¯ç»´æŠ¤æ€§å’Œåœ¨å…¶ä»–ç¯å¢ƒï¼ˆæ¯”å¦‚æµè§ˆå™¨ç«¯ JavaScriptï¼‰ä¸­çš„å…¼å®¹æ€§ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œå°±æ˜¯<code>util.isString()</code>åœ¨ Node.js v21.7.1 è¢«æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨äº†ï¼Œä½ åº”è¯¥ç”¨<code>typeof</code>æ“ä½œç¬¦æ¥æ›¿ä»£å®ƒè¿›è¡Œå­—ç¬¦ä¸²ç±»å‹çš„åˆ¤æ–­ã€‚</p><h3 id="dep0057-util-issymbol" tabindex="-1"><a class="header-anchor" href="#dep0057-util-issymbol"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0057" target="_blank" rel="noopener noreferrer">DEP0057: util.isSymbol()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;DEP0057&quot; æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šä»£ç ã€‚è¿™ä¸ªä»£ç å¯¹åº”äº <code>util.isSymbol()</code> å‡½æ•°çš„å¼ƒç”¨ã€‚</p><p><code>util.isSymbol()</code> å‡½æ•°æ˜¯ Node.js çš„ <code>util</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œç”¨æ¥æ£€æŸ¥ç»™å®šçš„å€¼æ˜¯å¦ä¸º Symbol ç±»å‹ã€‚Symbol æ˜¯ JavaScript çš„ä¸€ç§åŸå§‹æ•°æ®ç±»å‹ï¼Œç”¨äºåˆ›å»ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚åœ¨æ–°çš„ ECMAScript 2015 (ES6) è§„èŒƒæ¨å‡ºä¹‹åï¼Œå®ƒæˆä¸ºäº† JavaScript çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ç„¶è€Œï¼Œéšç€ JavaScript è‡ªèº«è¯­è¨€èƒ½åŠ›çš„å¢å¼ºï¼Œè®¸å¤šåŸå…ˆç”± Node.js æä¾›çš„è¾…åŠ©æ–¹æ³•ä¸å†å¿…è¦ã€‚å› ä¸ºç°åœ¨ JavaScript è‡ªå·±æä¾›äº†æ›´å¥½çš„æ›¿ä»£å“ï¼Œæ‰€ä»¥ Node.js å¼€å§‹é€æ­¥å¼ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p><p>åœ¨ <code>util.isSymbol()</code> è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDEP0057ï¼‰ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my symbol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 42</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isSymbol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isSymbol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šfalse</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯è‡ªä» <code>util.isSymbol()</code> è¢«å¼ƒç”¨åï¼ŒNode.js å®˜æ–¹æ–‡æ¡£å»ºè®®æˆ‘ä»¬ä½¿ç”¨åŸç”Ÿçš„ JavaScript æ–¹æ³•æ¥è¿›è¡Œç›¸åŒçš„æ£€æŸ¥ï¼Œå³ä½¿ç”¨ <code>typeof</code> æ“ä½œç¬¦ã€‚ä½¿ç”¨ <code>typeof</code> çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my symbol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 42</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;symbol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;symbol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šfalse</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬æƒ³è¦æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯ Symbol ç±»å‹æ—¶ï¼Œç›´æ¥ä½¿ç”¨ <code>typeof</code> æ“ä½œç¬¦å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœç»“æœæ˜¯ <code>&#39;symbol&#39;</code> é‚£ä¹ˆä¼ å…¥çš„å€¼å°±æ˜¯ä¸€ä¸ª Symbolã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>DEP0057: util.isSymbol()</code> æ˜¯ Node.js ä¸­å…³äº <code>util.isSymbol()</code> æ–¹æ³•çš„å¼ƒç”¨è­¦å‘Šã€‚å½“ä½ åœ¨ Node.js v21.7.1 æˆ–è€…å…¶ä»–ç‰ˆæœ¬ä¸­çœ‹åˆ°è¿™ä¸ªè­¦å‘Šæ—¶ï¼Œæ„å‘³ç€ä½ åº”è¯¥é¿å…ä½¿ç”¨ <code>util.isSymbol()</code> æ–¹æ³•ï¼Œå¹¶æ”¹ç”¨ <code>typeof</code> æ“ä½œç¬¦æ¥æ£€æŸ¥ Symbol ç±»å‹ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿ä½ çš„ä»£ç æ›´åŠ ç¬¦åˆç°ä»£ JavaScript çš„æ ‡å‡†ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ä»ç„¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p><h3 id="dep0058-util-isundefined" tabindex="-1"><a class="header-anchor" href="#dep0058-util-isundefined"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0058" target="_blank" rel="noopener noreferrer">DEP0058: util.isUndefined()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€èŠ Node.js ä¸­çš„ DEP0058ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ Node.js ä¸­<code>util</code>æ¨¡å—ç›¸å…³çš„å¼ƒç”¨è­¦å‘Šã€‚é¦–å…ˆè§£é‡Šä¸€ä¸‹â€œå¼ƒç”¨â€ï¼ˆdeprecationï¼‰çš„æ¦‚å¿µï¼šåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–æ–¹æ³•ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œæˆ‘ä»¬å°±è¯´å®ƒè¢«â€œå¼ƒç”¨â€ã€‚</p><p><code>util.isUndefined()</code>æ˜¯ Node.js ä¸­<code>util</code>æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯<code>undefined</code>ã€‚ä½†æ˜¯è‡ªä» Node.js v4.0.0 ä»¥æ¥ï¼Œè¿™ä¸ªæ–¹æ³•å°±è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œæ„å‘³ç€å®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œè€Œä¸”ä¸æ¨èç»§ç»­ä½¿ç”¨ã€‚</p><p>å› ä¸º JavaScript æœ‰æ›´ç®€å•ç›´æ¥çš„æ–¹å¼æ¥æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯<code>undefined</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦ç‰¹åˆ«çš„å‡½æ•°æ¥åšè¿™ä»¶äº‹æƒ…äº†ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­æ¥è¯´æ˜å¦‚ä½•æ›¿ä»£<code>util.isUndefined()</code>:</p><ol><li>ä½¿ç”¨<code>typeof</code>æ“ä½œç¬¦:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ—§çš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isUndefined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value æ˜¯ undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–°çš„ã€æ¨èçš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value æ˜¯ undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ç›´æ¥æ¯”è¾ƒå˜é‡ä¸<code>undefined</code>:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ—§çš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isUndefined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value æ˜¯ undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–°çš„ã€æ¨èçš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value æ˜¯ undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥æ›¿æ¢æ‰<code>util.isUndefined()</code>æ˜¯éå¸¸å®¹æ˜“çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨ç¼–å†™ Node.js ä»£ç æ—¶é‡åˆ°<code>util.isUndefined()</code>ï¼Œåº”è¯¥ä½¿ç”¨<code>typeof</code>æ“ä½œç¬¦æˆ–è€…ç›´æ¥ä¸<code>undefined</code>è¿›è¡Œæ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨å·²ç»å¼ƒç”¨çš„<code>util.isUndefined()</code>æ–¹æ³•ã€‚è¿™æ ·åšèƒ½ä¿è¯ä½ çš„ä»£ç å…¼å®¹æ€§æ›´å¥½ï¼Œå¹¶ä¸”éšç€ Node.js çš„æ›´æ–°ä¸ä¼šé‡åˆ°çªç„¶ä¸èƒ½ç”¨çš„é—®é¢˜ã€‚</p><h3 id="dep0059-util-log" tabindex="-1"><a class="header-anchor" href="#dep0059-util-log"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0059" target="_blank" rel="noopener noreferrer">DEP0059: util.log()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;deprecation&quot;ï¼ˆå¼ƒç”¨ï¼‰æ˜¯æŒ‡æŸä¸ªåŠŸèƒ½ã€æ–¹æ³•æˆ–å±æ€§ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤çš„è¿‡ç¨‹ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ä¸€ä¸ªåŠŸèƒ½è¢«è®¤ä¸ºæœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…å®ƒçš„è®¾è®¡ä¸å½“å‰çš„æœ€ä½³å®è·µä¸å†ä¸€è‡´æ—¶ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>util.log()</code>æ–¹æ³•è¢«æ ‡è®°ä¸ºå·²å¼ƒç”¨ï¼ˆDEP0059ï¼‰ï¼Œæ„å‘³ç€å¼€å‘è€…ä»¬ä¸åº”è¯¥å†ç»§ç»­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè€Œåº”è¯¥å¯»æ‰¾å…¶ä»–çš„æ—¥å¿—è®°å½•æ–¹å¼ã€‚<code>util.log()</code>æ–¹æ³•æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°çš„åŠŸèƒ½ï¼Œå®ƒä¼šé™„å¸¦ä¸€ä¸ªæ—¶é—´æˆ³ã€‚</p><p>ä¸‹é¢è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯<code>util.log()</code>ä»¥åŠå¼ƒç”¨åä½ å¯ä»¥é‡‡å–çš„æ›¿ä»£æ–¹æ¡ˆï¼š</p><h3 id="ä»€ä¹ˆæ˜¯util-log" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯util-log"><span>ä»€ä¹ˆæ˜¯<code>util.log()</code>?</span></a></h3><p><code>util.log()</code>æ˜¯ Node.js æ—©æœŸæä¾›çš„ä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†å¸®åŠ©å¼€å‘è€…å¿«é€Ÿè¿›è¡Œæ—¥å¿—è®°å½•ã€‚å½“ä½ è°ƒç”¨<code>util.log(message)</code>æ—¶ï¼Œå®ƒä¼šè¾“å‡ºæ ¼å¼åŒ–çš„æ—¶é—´æˆ³å’Œä½ æä¾›çš„æ¶ˆæ¯ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªæ—¥å¿—æ¶ˆæ¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œä¸Šè¿°ä»£ç å°†ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹è¾“å‡ºï¼ˆæ—¶é—´æˆ³ä¼šæ ¹æ®å®é™…è¿è¡Œæ—¶é—´å˜åŒ–ï¼‰ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>21 Feb 12:00:00 - è¿™æ˜¯ä¸€ä¸ªæ—¥å¿—æ¶ˆæ¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="æ›¿ä»£æ–¹æ¡ˆ-1" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£æ–¹æ¡ˆ-1"><span>æ›¿ä»£æ–¹æ¡ˆ</span></a></h3><p>éšç€<code>util.log()</code>è¢«å¼ƒç”¨ï¼Œä½ åº”è¯¥å¼€å§‹ä½¿ç”¨å…¶ä»–çš„æ—¥å¿—è®°å½•æ–¹æ³•ã€‚å¯¹äº Node.js æ¥è¯´ï¼Œæœ‰å‡ ç§å¯é€‰çš„æ—¥å¿—è®°å½•æ–¹æ³•ï¼š</p><ol><li><p><strong>Console APIï¼š</strong><br> Node.js å†…ç½®çš„<code>console</code>æ¨¡å—å¯ä»¥ç”¨æ¥æ›¿ä»£<code>util.log()</code>ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>console.log()</code>æ¥æ‰“å°æ™®é€šæ—¥å¿—ï¼Œ<code>console.error()</code>æ¥æ‰“å°é”™è¯¯æ—¥å¿—ã€‚å¦‚æœä½ æƒ³é™„åŠ æ—¶é—´æˆ³ï¼Œä½ å¯ä»¥è‡ªå·±ç”Ÿæˆå¹¶æ·»åŠ ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªæ—¥å¿—æ¶ˆæ¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>ç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼š</strong><br> æœ‰è®¸å¤šä¼˜ç§€çš„ç¬¬ä¸‰æ–¹æ—¥å¿—åº“å¯ä»¥æä¾›æ¯”<code>util.log()</code>æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ—¥å¿—çº§åˆ«ã€æ—¥å¿—æ ¼å¼è‡ªå®šä¹‰ã€è¾“å‡ºåˆ°ä¸åŒçš„åœ°æ–¹ç­‰ã€‚æµè¡Œçš„æ—¥å¿—åº“æœ‰<code>winston</code>ã€<code>bunyan</code>å’Œ<code>pino</code>ã€‚</p><p>ä¸‹é¢æ˜¯ä½¿ç”¨<code>winston</code>çš„ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> winston</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;winston&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logger</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> winston</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createLogger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  level</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">winston</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  transports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> winston</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">transports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> winston</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">transports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">File</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;combined.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">logger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªæ—¥å¿—æ¶ˆæ¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥å®ç°æ›´åŠ çµæ´»å’Œå¼ºå¤§çš„æ—¥å¿—ç®¡ç†ç³»ç»Ÿã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>util.log()</code>æ–¹æ³•è¢«å¼ƒç”¨çš„æ„æ€å°±æ˜¯ Node.js å¼€å‘å›¢é˜Ÿè®¤ä¸ºè¿™ä¸ªæ–¹æ³•ä¸å†é€‚åˆç°ä»£çš„ Node.js ç¼–ç¨‹ï¼Œé¼“åŠ±å¼€å‘è€…ä»¬è½¬å‘æ›´å…ˆè¿›çš„æ—¥å¿—è®°å½•æ‰‹æ®µã€‚å› æ­¤ï¼Œåœ¨æ–°çš„é¡¹ç›®ä¸­ï¼Œæˆ–è€…åœ¨ç»´æŠ¤æ—§é¡¹ç›®æ—¶ï¼Œéƒ½åº”è¯¥é¿å…ä½¿ç”¨<code>util.log()</code>ï¼Œå¹¶é‡‡ç”¨å…¶ä»–æ–¹æ³•æ¥è¿›è¡Œæ—¥å¿—è®°å½•ã€‚</p><h3 id="dep0060-util-extend" tabindex="-1"><a class="header-anchor" href="#dep0060-util-extend"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0060" target="_blank" rel="noopener noreferrer">DEP0060: util._extend()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ç»™ä½ è¯¦ç»†è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ DEP0060 æŠ¥åºŸè­¦å‘Šï¼Œä»¥åŠå®ƒæ„å‘³ç€ä»€ä¹ˆã€‚</p><p>é¦–å…ˆï¼Œ<code>util._extend()</code> æ˜¯ä¸€ä¸ª Node.js å†…éƒ¨ä½¿ç”¨çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨å¾ˆæ—©ä»¥å‰è¢«æ·»åŠ åˆ° <code>util</code> æ¨¡å—ä¸­ä½œä¸ºä¸€ä¸ªå®ç”¨å·¥å…·å‡½æ•°ã€‚å®ƒä¸»è¦ç”¨äºå°†ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œç±»ä¼¼äº JavaScript ç°ä»£æ ‡å‡†ä¸­çš„ Object.assign æ–¹æ³•ã€‚</p><p>ç„¶è€Œï¼Œéšç€ JavaScript è¯­è¨€çš„å‘å±•å’Œ ECMAScript 2015ï¼ˆä¹Ÿç§°ä¸º ES6ï¼‰çš„æ¨å‡ºï¼Œæ–°çš„è¯­æ³•å’ŒåŠŸèƒ½å¾—åˆ°äº†å¢åŠ ã€‚å…¶ä¸­ï¼ŒObject.assign() å‡½æ•°è¢«å¼•å…¥ä¸ºå®˜æ–¹çš„æ–¹æ³•æ¥åšåŒæ ·çš„äº‹æƒ…ã€‚å› æ­¤ï¼ŒNode.js å¼€å‘å›¢é˜Ÿå†³å®šå¼ƒç”¨ <code>util._extend()</code>ï¼Œå› ä¸ºå®ƒä¸æ–°çš„æ ‡å‡†æ–¹æ³•é‡å¤ï¼Œå¹¶ä¸”ä¸å†æ˜¯å¿…è¦çš„ã€‚</p><p>DEP0060 å°±æ˜¯å…³äºè¿™ç§å¼ƒç”¨çš„ä¸€ä¸ªè­¦å‘Šã€‚å½“ä½ çœ‹åˆ°è¿™ä¸ªè­¦å‘Šæ—¶ï¼Œå®ƒæ„å‘³ç€ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªä¸å†å»ºè®®ä½¿ç”¨çš„è€æ—§æ–¹æ³•ï¼Œè€Œä¸”å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­å®ƒå¯èƒ½ä¼šå®Œå…¨ç§»é™¤ã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>util._extend()</code> å’Œç°ä»£æ–¹æ³• <code>Object.assign()</code> çš„å¯¹æ¯”ç¤ºä¾‹ï¼š</p><p><strong>æ—§æ–¹æ³•ä½¿ç”¨ <code>util._extend()</code>ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ util._extend() æ¥åˆå¹¶å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> combined</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">_extend</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">combined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: { a: 1, b: 2 }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç°ä»£æ–¹æ³•ä½¿ç”¨ <code>Object.assign()</code>ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ Object.assign() æ¥åˆå¹¶å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> combined</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">assign</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">combined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: { a: 1, b: 2 }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ç”šè‡³å¯ä»¥ä½¿ç”¨æ›´ç°ä»£çš„æ‰©å±•è¿ç®—ç¬¦ï¼ˆspread operatorï¼‰æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦æ¥åˆå¹¶å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> combined</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">combined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: { a: 1, b: 2 }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½œä¸ºç¼–ç¨‹æ–°æ‰‹ï¼Œä½ åº”è¯¥æ€»æ˜¯å°½é‡é¿å…ä½¿ç”¨å·²è¢«å¼ƒç”¨çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯å½“æœ‰ç°ä»£ã€æ ‡å‡†åŒ–çš„æ›¿ä»£æ–¹æ³•å­˜åœ¨æ—¶ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨é—ç•™ä»£ç ä¸­é‡åˆ° <code>util._extend()</code>ï¼Œä½ åº”è¯¥è€ƒè™‘å°†å®ƒæ›¿æ¢ä¸º <code>Object.assign()</code> æˆ–æ‰©å±•è¿ç®—ç¬¦ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç æ›´åŠ æ¸…æ™°ã€ç°ä»£å’Œæœªæ¥è¯æ˜ã€‚</p><h3 id="dep0061-fs-syncwritestream" tabindex="-1"><a class="header-anchor" href="#dep0061-fs-syncwritestream"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0061" target="_blank" rel="noopener noreferrer">DEP0061: fs.SyncWriteStream</a></span></a></h3><p>å¥½çš„ï¼ŒDEP0061 æ˜¯æŒ‡åœ¨ Node.js ä¸­å…³äº<code>fs.SyncWriteStream</code>è¿™ä¸ª API çš„å¼ƒç”¨è­¦å‘Šã€‚æ‰€è°“&quot;å¼ƒç”¨&quot;ï¼ˆDeprecationï¼‰ï¼Œæ˜¯æŒ‡å¼€å‘è€…ä¸å†æ¨èä½¿ç”¨æŸä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸”é€šå¸¸ä¼šåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤å®ƒã€‚Node.js å›¢é˜Ÿä¼šå¼ƒç”¨ä¸€äº› API æ˜¯å› ä¸ºéšç€æŠ€æœ¯çš„è¿›æ­¥ï¼Œå¯èƒ½å‘ç°äº†æ›´å¥½çš„æ–¹æ³•æ¥å®ŒæˆåŒæ ·çš„ä»»åŠ¡ï¼Œæˆ–è€…åŸæœ‰çš„è®¾è®¡å­˜åœ¨é—®é¢˜ã€‚</p><p><code>fs</code>æ¨¡å—æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œæä¾›äº†æ–‡ä»¶æ“ä½œçš„ APIã€‚<code>fs.SyncWriteStream</code>æ˜¯å…¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒæ›¾ç»ç”¨äºåŒæ­¥å†™å…¥æ•°æ®åˆ°æ–‡ä»¶æµä¸­ã€‚&quot;åŒæ­¥&quot;æ„å‘³ç€å½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼ŒNode.js ä¼šæš‚åœå…¶ä»–ä»£ç çš„æ‰§è¡Œï¼Œç›´åˆ°è¿™ä¸ªå†™å…¥æ“ä½œå®Œæˆã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v0.12 ç‰ˆæœ¬ä¸­ï¼Œ<code>fs.SyncWriteStream</code>å°±è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„ APIã€‚åˆ°äº† Node.js v21.7.1 è¿™ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªå¼ƒç”¨è­¦å‘Šä»ç„¶æœ‰æ•ˆï¼Œæ„å‘³ç€ä½ ä¸åº”è¯¥åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨<code>fs.SyncWriteStream</code>ï¼Œè€Œåº”è¯¥ä½¿ç”¨å…¶ä»–çš„æ–¹æ³•æ¥è¿›è¡Œæ–‡ä»¶å†™å…¥ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ éœ€è¦å‘ä¸€ä¸ªæ–‡ä»¶ä¸­å†™å…¥ä¸€äº›æ•°æ®ã€‚å¦‚æœä½ ä½¿ç”¨<code>fs.SyncWriteStream</code>ï¼Œä»£ç å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">SyncWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç å°†æ•°æ®â€œHello, World!â€åŒæ­¥å†™å…¥åˆ°<code>myFile.txt</code>æ–‡ä»¶ä¸­ã€‚ä½†ç”±äº<code>fs.SyncWriteStream</code>æ˜¯å¼ƒç”¨çš„ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨å…¶ä»–æ–¹æ³•æ›¿ä»£å®ƒã€‚</p><p>æ­£ç¡®çš„ã€æ¨èçš„æ–¹æ³•æ˜¯ä½¿ç”¨<code>fs.createWriteStream</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶çš„å¼‚æ­¥ APIï¼Œæˆ–è€…ä½¿ç”¨<code>fs.writeFileSync</code>è¿›è¡ŒåŒæ­¥å†™å…¥ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ›¿ä»£æ–¹æ¡ˆçš„ç¤ºä¾‹ï¼š</p><p>ä½¿ç”¨<code>fs.createWriteStream</code>ï¼ˆå¼‚æ­¥ï¼‰:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä¼šä»¥å¼‚æ­¥çš„æ–¹å¼å†™å…¥æ•°æ®ï¼Œä¸ä¼šé˜»å¡ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚</p><p>æˆ–è€…ä½¿ç”¨<code>fs.writeFileSync</code>ï¼ˆåŒæ­¥ï¼‰:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™è¡Œä»£ç åŒæ­¥åœ°å°†å­—ç¬¦ä¸²å†™å…¥<code>myFile.txt</code>æ–‡ä»¶ä¸­ï¼Œè¿™æ„å‘³ç€åœ¨å†™å…¥å®Œæˆä¹‹å‰ï¼ŒNode.js ä¸ä¼šæ‰§è¡Œåé¢çš„ä»£ç ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>DEP0061</code>æ˜¯ä¸€ä¸ªæ—§ API çš„å¼ƒç”¨è­¦å‘Šï¼Œå‘Šè¯‰æˆ‘ä»¬ä¸è¦ä½¿ç”¨<code>fs.SyncWriteStream</code>ã€‚ä½œä¸ºæ›¿ä»£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>fs.createWriteStream</code>è¿›è¡Œå¼‚æ­¥æ–‡ä»¶å†™å…¥ï¼Œæˆ–è€…<code>fs.writeFileSync</code>è¿›è¡ŒåŒæ­¥æ–‡ä»¶å†™å…¥ã€‚åœ¨ç¼–å†™ Node.js ç¨‹åºæ—¶ï¼Œéµå¾ªæœ€æ–°çš„ API å’Œæœ€ä½³å®è·µæ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥ç¡®ä¿ä»£ç çš„æ€§èƒ½å’Œæœªæ¥çš„å…¼å®¹æ€§ã€‚</p><h3 id="dep0062-node-debug" tabindex="-1"><a class="header-anchor" href="#dep0062-node-debug"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0062" target="_blank" rel="noopener noreferrer">DEP0062: node --debug</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå¼€æºå’Œè·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è€Œåœ¨ Node.js çš„å†å²ä¸­ï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œä¸€äº›åŠŸèƒ½æˆ–è€…æ¥å£å¯èƒ½ä¼šè¢«æ ‡è®°ä¸º&quot;å¼ƒç”¨&quot;ï¼ˆDeprecationï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸å†æ¨èä½¿ç”¨å¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p><code>DEP0062</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå…·ä½“çš„å¼ƒç”¨è­¦å‘Šï¼Œå®ƒæŒ‡çš„æ˜¯<code>node --debug</code> å’Œ <code>node --debug-brk</code>å¯åŠ¨å‚æ•°çš„å¼ƒç”¨ã€‚</p><h3 id="è§£é‡Šnode-debug-å’Œ-node-debug-brk" tabindex="-1"><a class="header-anchor" href="#è§£é‡Šnode-debug-å’Œ-node-debug-brk"><span>è§£é‡Š<code>node --debug</code> å’Œ <code>node --debug-brk</code></span></a></h3><ul><li><p><code>node --debug</code>: åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå‘½ä»¤ç”¨äºå¯åŠ¨ Node.js åº”ç”¨ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªè°ƒè¯•å™¨ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º 5858ï¼‰ï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥é™„åŠ ä¸€ä¸ªè°ƒè¯•å™¨ï¼ˆä¾‹å¦‚ï¼šNode Inspectorï¼‰æ¥è°ƒè¯•ä»£ç ã€‚</p></li><li><p><code>node --debug-brk</code>: è¿™ä¸ªå‘½ä»¤ä¸<code>node --debug</code>ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒåœ¨æ‰§è¡Œè„šæœ¬ä¹‹å‰å°±ä¼šåœ¨ç¬¬ä¸€è¡Œä»£ç å‰æš‚åœï¼Œç»™å¼€å‘è€…æœºä¼šå»è®¾ç½®æ–­ç‚¹ç„¶åæ‰‹åŠ¨ç»§ç»­æ‰§è¡Œã€‚</p></li></ul><h3 id="ä¸ºä»€ä¹ˆè¢«å¼ƒç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¢«å¼ƒç”¨"><span>ä¸ºä»€ä¹ˆè¢«å¼ƒç”¨</span></a></h3><p>éšç€æ—¶é—´çš„å‘å±•ï¼Œæ–°çš„è°ƒè¯•åè®®ï¼ˆå¦‚ Inspector åè®®ï¼‰å’Œå·¥å…·ï¼ˆå¦‚ Chrome DevToolsï¼‰è¢«å¼•å…¥åˆ°äº† Node.js ä¸­ï¼Œæä¾›äº†æ›´å¼ºå¤§ã€æ›´ç¨³å®šä¸”æ›´å®‰å…¨çš„è°ƒè¯•ä½“éªŒã€‚å› æ­¤ï¼ŒåŸæœ‰çš„ä½¿ç”¨<code>--debug</code>å’Œ<code>--debug-brk</code>çš„è°ƒè¯•æ–¹æ³•è¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„ï¼Œå¹¶ä¸”åœ¨ Node.js v7 å¼€å§‹æç¤ºå¼ƒç”¨ã€‚</p><h3 id="å¦‚ä½•æ›¿ä»£" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æ›¿ä»£"><span>å¦‚ä½•æ›¿ä»£</span></a></h3><p>ä½ å¯ä»¥ä½¿ç”¨<code>--inspect</code>å’Œ<code>--inspect-brk</code>æ¥æ›¿æ¢å¼ƒç”¨çš„å‘½ä»¤ï¼š</p><ul><li><p><code>node --inspect</code>: å¯åŠ¨ Node.js åº”ç”¨å¹¶æ‰“å¼€ Inspector è°ƒè¯•å™¨ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º 9229ï¼‰ï¼Œå…è®¸ç°ä»£è°ƒè¯•å·¥å…·è¿æ¥åˆ°è¯¥è¿›ç¨‹ã€‚</p></li><li><p><code>node --inspect-brk</code>: ä¸<code>node --inspect</code>ç›¸ä¼¼ï¼Œä½†å®ƒä¼šåœ¨è„šæœ¬çš„ç¬¬ä¸€è¡Œä»£ç ä¹‹å‰æš‚åœæ‰§è¡Œï¼Œè¿™æ ·ä½ å¯ä»¥å…ˆè®¾ç½®æ–­ç‚¹ã€‚</p></li></ul><h3 id="å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹"><span>å®ä¾‹</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º<code>script.js</code>çš„ Node.js è„šæœ¬ï¼Œå¹¶ä¸”ä½ æƒ³è¦è°ƒè¯•å®ƒï¼š</p><ul><li><p>ä½¿ç”¨æ—§çš„è°ƒè¯•æ–¹æ³•ï¼ˆå·²å¼ƒç”¨ï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --debug</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        # ä¸æ¨èï¼Œå› ä¸ºå®ƒå·²ç»è¢«å¼ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --debug-brk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # ä¸æ¨èï¼Œå› ä¸ºå®ƒå·²ç»è¢«å¼ƒç”¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä½¿ç”¨æ–°çš„è°ƒè¯•æ–¹æ³•ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">       # å¼€å§‹è°ƒè¯•ï¼Œå¹¶å…è®¸è°ƒè¯•å·¥å…·è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect-brk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   # å¼€å§‹è°ƒè¯•ï¼Œä½†åœ¨ç¬¬ä¸€è¡Œä»£ç ä¹‹å‰æš‚åœæ‰§è¡Œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>é€šè¿‡æ–°çš„æ–¹æ³•ï¼Œä½ å¯ä»¥æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè¾“å…¥<code>chrome://inspect</code>ï¼Œç„¶åæ‰¾åˆ°ä½ çš„ Node.js è¿›ç¨‹å¹¶å¼€å§‹è°ƒè¯•ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>DEP0062</code>æ˜¯å¯¹è€æ—§è°ƒè¯•æ¥å£çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå®ƒé¼“åŠ±å¼€å‘è€…ä½¿ç”¨æ–°çš„åŸºäº Inspector çš„è°ƒè¯•æ¥å£ï¼Œä»¥è·å¾—æ›´å¥½çš„è°ƒè¯•ä½“éªŒã€‚</p><h3 id="dep0063-serverresponse-prototype-writeheader" tabindex="-1"><a class="header-anchor" href="#dep0063-serverresponse-prototype-writeheader"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0063" target="_blank" rel="noopener noreferrer">DEP0063: ServerResponse.prototype.writeHeader()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥å†™æœåŠ¡ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åˆ›å»º web æœåŠ¡å™¨ï¼Œè¿™å°±ä¼šç”¨åˆ° <code>http</code> æ¨¡å—ã€‚è€Œå½“ä½ æƒ³è¦å‘å®¢æˆ·ç«¯å‘é€å“åº”å¤´ä¿¡æ¯æ—¶ï¼Œä½ ä¼šç”¨åˆ°è¯¥æ¨¡å—æä¾›çš„ <code>ServerResponse</code> å¯¹è±¡ã€‚</p><p>åœ¨ Node.js çš„å†å²ç‰ˆæœ¬ä¸­ï¼Œ<code>ServerResponse</code> å¯¹è±¡æœ‰ä¸€ä¸ªæ–¹æ³•å«åš <code>writeHeader()</code>ï¼Œè¿™ä¸ªæ–¹æ³•è¢«ç”¨æ¥å†™å…¥ HTTP å“åº”å¤´ã€‚ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­ï¼Œ<code>DEP0063</code> è¡¨ç¤º <code>ServerResponse.prototype.writeHeader()</code> æ–¹æ³•å·²ç»è¢«åºŸå¼ƒäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦åºŸå¼ƒ <code>writeHeader()</code> å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸ºç°åœ¨æœ‰ä¸€ä¸ªæ›´æ ‡å‡†ã€æ›´å¸¸ç”¨çš„æ–¹æ³• <code>writeHead()</code> å¯ä»¥å®ŒæˆåŒæ ·çš„å·¥ä½œï¼Œè€Œä¸” <code>writeHead()</code> çš„åå­—å’Œå…¶åŠŸèƒ½æ›´åŠ åŒ¹é…ï¼Œå³â€œå†™å¤´éƒ¨â€ï¼ˆwrite headï¼‰ï¼Œä½¿å¾— API æ›´æ¸…æ™°å’Œæ˜“äºç†è§£ã€‚</p><p><strong>å®é™…è¿ç”¨ä¾‹å­ï¼š</strong></p><p>å‡è®¾æ—§ç‰ˆä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>res.writeHeader(200, {&#39;Content-Type&#39;: &#39;text/plain&#39;});</code> è¿™è¡Œä»£ç ç”¨äºè®¾ç½®å“åº”çš„çŠ¶æ€ç ä¸º 200ï¼Œè¡¨ç¤ºæˆåŠŸï¼Œå¹¶å‘Šè¯‰å®¢æˆ·ç«¯è¿”å›çš„å†…å®¹ç±»å‹æ˜¯çº¯æ–‡æœ¬ã€‚</p><p>ä½†ç”±äº <code>writeHeader()</code> å·²ç»è¢«åºŸå¼ƒï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <code>writeHead()</code> æ–¹æ³•æ¥æ›¿ä»£ã€‚ä¿®æ”¹åçš„ä»£ç åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„æˆ‘ä»¬æŠŠ <code>res.writeHeader(200, {&#39;Content-Type&#39;: &#39;text/plain&#39;});</code> æ”¹æˆäº† <code>res.writeHead(200, {&#39;Content-Type&#39;: &#39;text/plain&#39;});</code>ã€‚è¿™æ ·çš„æ”¹åŠ¨ä¿æŒäº†åŸæœ‰çš„åŠŸèƒ½ä¸å˜ï¼ŒåŒæ—¶éµå¾ªäº† Node.js çš„æœ€æ–°å®è·µã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>DEP0063</code> æ˜¯å‘Šè¯‰æˆ‘ä»¬ <code>ServerResponse.prototype.writeHeader()</code> æ–¹æ³•å·²ç»è¢«åºŸå¼ƒï¼Œæœªæ¥çš„ç¼–ç¨‹å®è·µä¸­æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <code>writeHead()</code> æ–¹æ³•æ¥è®¾ç½® HTTP å“åº”å¤´ã€‚è¿™ä¸ªæ”¹å˜æœ‰åŠ©äºä½¿ Node.js çš„ API æ›´åŠ ä¸€è‡´å’Œå®¹æ˜“ç†è§£ã€‚</p><h3 id="dep0064-tls-createsecurepair" tabindex="-1"><a class="header-anchor" href="#dep0064-tls-createsecurepair"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0064" target="_blank" rel="noopener noreferrer">DEP0064: tls.createSecurePair()</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>tls.createSecurePair()</code> æ–¹æ³•æ˜¯ä»€ä¹ˆã€‚</p><h3 id="tls-createsecurepair" tabindex="-1"><a class="header-anchor" href="#tls-createsecurepair"><span>tls.createSecurePair()</span></a></h3><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>tls.createSecurePair()</code> æ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»º TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰çš„åº•å±‚è¿æ¥çš„æ–¹æ³•ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå¼€å‘è€…èƒ½å¤Ÿå»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šé“ï¼Œä½¿å¾—æ•°æ®åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ—¶ï¼Œå¯ä»¥ä¿è¯å®‰å…¨æ€§ï¼Œé˜²æ­¢è¢«ç¬¬ä¸‰æ–¹æˆªè·æˆ–ç¯¡æ”¹ã€‚</p><p>æ­¤æ–¹æ³•ä¸»è¦è¢«ç”¨äºåˆ›å»ºä¸€ä¸ªç§°ä¸º &quot;secure pair&quot; çš„å¯¹è±¡ï¼ŒåŒ…å«ä¸€ä¸ªåŠ å¯†æµï¼ˆç”¨äºå‘é€åŠ å¯†æ•°æ®ï¼‰å’Œä¸€ä¸ªè§£å¯†æµï¼ˆç”¨äºæ¥æ”¶åŠ å¯†æ•°æ®ï¼‰ï¼Œä»è€Œå®ç°äº†ä¸€ä¸ªå¯è¯»å†™çš„åŠ å¯†æ•°æ®é€šé“ã€‚</p><h3 id="åºŸå¼ƒ-deprecation" tabindex="-1"><a class="header-anchor" href="#åºŸå¼ƒ-deprecation"><span>åºŸå¼ƒï¼ˆDeprecationï¼‰</span></a></h3><p>åœ¨ Node.js çš„æ›´æ–°ç‰ˆæœ¬ä¸­ï¼Œ<code>tls.createSecurePair()</code> è¢«æ ‡è®°ä¸º Deprecatedï¼ˆå³åºŸå¼ƒï¼‰ã€‚è¿™æ„å‘³ç€è¿™ä¸ªæ–¹æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚åºŸå¼ƒå¸¸å¸¸å‘ç”Ÿåœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºéšç€æ—¶é—´çš„æ¨ç§»å’ŒæŠ€æœ¯è¿›æ­¥ï¼Œä¸€äº›æ—§çš„æ–¹æ³•å¯èƒ½ä¸å†é€‚åº”å½“å‰çš„æœ€ä½³å®è·µæˆ–å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ã€‚</p><h3 id="æ›¿ä»£æ–¹æ¡ˆ-2" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£æ–¹æ¡ˆ-2"><span>æ›¿ä»£æ–¹æ¡ˆ</span></a></h3><p>æ›¿ä»£ <code>tls.createSecurePair()</code> çš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨ <code>tls.TLSSocket</code> ç±»ã€‚<code>TLSSocket</code> æä¾›äº†æ›´ç°ä»£ã€æ›´çµæ´»ä»¥åŠæ€§èƒ½æ›´é«˜çš„æ–¹å¼æ¥å¤„ç† TLS åŠ å¯†è¿æ¥ã€‚è¯¥ç±»åŸºæœ¬ä¸Šç»™äºˆä½ ä¸€ä¸ªå¯ä»¥ç›´æ¥è¯»å†™çš„å¥—æ¥å­—ï¼ˆsocketï¼‰ï¼Œå®ƒè‡ªåŠ¨å¤„ç†åŠ å¯†ä¸è§£å¯†è¿‡ç¨‹ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ åœ¨ç¼–å†™ä¸€ä¸ªéœ€è¦å®‰å…¨ä¼ è¾“ä¿¡æ¯çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡ã€‚</p><h4 id="ä½¿ç”¨-tls-createsecurepair-çš„ä¾‹å­-å·²åºŸå¼ƒ-ä¸æ¨è" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-tls-createsecurepair-çš„ä¾‹å­-å·²åºŸå¼ƒ-ä¸æ¨è"><span>ä½¿ç”¨ <code>tls.createSecurePair()</code> çš„ä¾‹å­ï¼ˆå·²åºŸå¼ƒï¼Œä¸æ¨èï¼‰ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">cleartextStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> securePair</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSecurePair</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç°åœ¨å¯ä»¥é€šè¿‡ securePair.cleartext å’Œ securePair.encrypted è¿›è¡Œé€šä¿¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1337</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½¿ç”¨-tls-tlssocket-çš„ç°ä»£æ›¿ä»£ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-tls-tlssocket-çš„ç°ä»£æ›¿ä»£ä¾‹å­"><span>ä½¿ç”¨ <code>tls.TLSSocket</code> çš„ç°ä»£æ›¿ä»£ä¾‹å­ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">tlsSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // tlsSocket æ˜¯ä¸€ä¸ªå·²ç»åŠ å¯†çš„ TLSSocket å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå¥—æ¥å­—å¯¹è±¡è¿›è¡Œæ•°æ®è¯»å–å’Œå†™å…¥</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  tlsSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Received: %s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    tlsSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello Client!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1337</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç°ä»£åŒ–çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨ TLS çš„æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ç›‘å¬ç«¯å£ 1337 ä¸Šçš„è¿æ¥ã€‚å½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œå®ƒé€šè¿‡å›è°ƒå‡½æ•°æä¾›äº†ä¸€ä¸ª <code>tlsSocket</code> å¯¹è±¡ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ¥å‘é€å’Œæ¥æ”¶åŠ å¯†æ•°æ®ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œç”±äº <code>tls.createSecurePair()</code> å·²ç»è¢« Node.js å®˜æ–¹åºŸå¼ƒï¼Œä½œä¸ºæ–°æ‰‹ä½ åº”è¯¥å­¦ä¹ å¹¶ä½¿ç”¨æ–°çš„ API å’Œæ ‡å‡†ï¼Œä¾‹å¦‚ <code>tls.TLSSocket</code>ï¼Œæ¥ç¡®ä¿ä½ çš„ä»£ç æ›´åŠ å®‰å…¨ã€é«˜æ•ˆä¸”æœªæ¥å…¼å®¹ã€‚</p><h3 id="dep0065-repl-repl-mode-magic-and-node-repl-mode-magic" tabindex="-1"><a class="header-anchor" href="#dep0065-repl-repl-mode-magic-and-node-repl-mode-magic"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0065" target="_blank" rel="noopener noreferrer">DEP0065: repl.REPL_MODE_MAGIC and NODE_REPL_MODE=magic</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js è‡ªå¸¦äº†ä¸€ä¸ªäº¤äº’å¼è§£é‡Šå™¨ï¼Œä¹Ÿå°±æ˜¯ REPLï¼ˆRead-Eval-Print Loopï¼‰ï¼Œå®ƒå¯ä»¥è®©ä½ æ–¹ä¾¿åœ°åœ¨å‘½ä»¤è¡Œä¸­æµ‹è¯• JavaScript ä»£ç ç‰‡æ®µã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒREPL æ”¯æŒäº†ä¸€ç§åä¸º â€œmagicâ€ çš„æ¨¡å¼ï¼Œé€šè¿‡è®¾ç½® <code>NODE_REPL_MODE=magic</code> ç¯å¢ƒå˜é‡æˆ–è€…ä½¿ç”¨ <code>repl.REPL_MODE_MAGIC</code> æ¥å¯ç”¨ã€‚è¿™ä¸ª â€œmagicâ€ æ¨¡å¼æ˜¯ä¸€ç§å®éªŒæ€§åŠŸèƒ½ï¼Œå®ƒæä¾›äº†ä¸€äº›ç‰¹æ®Šçš„è¯­æ³•è§£æï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥çœç•¥æ‰ä¸€äº›é€šå¸¸å¿…é¡»è¦å†™çš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨ â€œmagicâ€ æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½ä¸éœ€è¦è¾“å…¥ <code>function</code> å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚</p><p>ä½†åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>repl.REPL_MODE_MAGIC</code> å’Œ <code>NODE_REPL_MODE=magic</code> è¢«æ ‡è®°ä¸ºå·²å¼ƒç”¨ï¼ˆDEP0065ï¼‰ã€‚è¿™æ„å‘³ç€è¿™ä¸¤ç§ç”¨æ³•å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><p>å‡è®¾åœ¨ &quot;magic&quot; æ¨¡å¼ä¹‹å‰ï¼Œå¦‚æœä½ æƒ³å®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°å¹¶ç«‹å³è°ƒç”¨å®ƒï¼Œä½ å¯èƒ½éœ€è¦åœ¨ Node.js REPL ä¸­è¿™æ ·å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() { </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">undefined</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Hello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">World</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œåœ¨ â€œmagicâ€ æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½èƒ½å¤Ÿä½¿ç”¨ä¸€ç§ç®€åŒ–çš„è¯­æ³•æ¥å®ŒæˆåŒæ ·çš„äº‹æƒ…ï¼Œä¸è¿‡è¯·æ³¨æ„è¿™ä¸ªæ¨¡å¼å·²ç»ä¸è¢«æ¨èä½¿ç”¨ã€‚</p><p>ç°åœ¨è¿™ä¸ª â€œmagicâ€ æ¨¡å¼è¢«å¼ƒç”¨äº†ï¼Œæ‰€ä»¥ä½ åº”è¯¥ç»§ç»­ä½¿ç”¨æ ‡å‡†çš„ JavaScript è¯­æ³•è¿›è¡Œç¼–ç¨‹ï¼Œå°±åƒç¬¬ä¸€ä¸ªä¾‹å­é‚£æ ·ã€‚</p><p>å¦‚æœä½ è¯•å›¾åœ¨ Node.js v21.7.1 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­ä½¿ç”¨è¿™ä¸ªå·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨çš„ç‰¹æ€§ï¼ŒNode.js å¯èƒ½ä¼šç»™ä½ æ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªç‰¹æ€§å·²ç»ä¸å†å»ºè®®ä½¿ç”¨ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>NODE_REPL_MODE=magic</code> å’Œ <code>repl.REPL_MODE_MAGIC</code> å·²ç»è¢«åºŸå¼ƒäº†ã€‚ä½œä¸ºç¼–ç¨‹æ–°æ‰‹ï¼Œä½ åº”è¯¥ä¸“æ³¨äºå­¦ä¹ å’Œä½¿ç”¨ç¨³å®šå’Œæ¨èçš„ JavaScript ç‰¹æ€§å’Œ Node.js APIã€‚è¿™æ ·ï¼Œéšç€ä½ æŠ€æœ¯çš„æˆç†Ÿï¼Œä½ çš„ä»£ç å°†æ›´åŠ å¥å£®ï¼Œä¸”ä¸å°†æ¥çš„ Node.js ç‰ˆæœ¬å…¼å®¹ã€‚</p><h3 id="dep0066-outgoingmessage-prototype-headers-outgoingmessage-prototype-headernames" tabindex="-1"><a class="header-anchor" href="#dep0066-outgoingmessage-prototype-headers-outgoingmessage-prototype-headernames"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0066" target="_blank" rel="noopener noreferrer">DEP0066: OutgoingMessage.prototype._headers, OutgoingMessage.prototype._headerNames</a></span></a></h3><p>åœ¨è§£é‡Š Node.js ä¸­çš„ DEP0066 ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒã€‚å®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œå…¶ä¸­ä¸€ä¸ªå¸¸è§ç”¨é€”å°±æ˜¯åˆ›å»ºç½‘ç»œ applicationsã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—æä¾›äº†åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡çš„èƒ½åŠ›ã€‚</p><p>å½“ä½ ä½¿ç”¨ Node.js çš„ <code>http</code> æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ª web server æ—¶ï¼Œä½ ä¼šå¤„ç†åˆ° <code>IncomingMessage</code> å¯¹è±¡ï¼ˆä»£è¡¨æ¥æ”¶åˆ°çš„è¯·æ±‚ï¼‰å’Œ <code>OutgoingMessage</code> å¯¹è±¡ï¼ˆä»£è¡¨å³å°†å‘é€çš„å“åº”ï¼‰ã€‚åœ¨ HTTP é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡åŒ…å«äº†ç›¸åº”çš„å¤´éƒ¨ä¿¡æ¯ï¼ˆheadersï¼‰ï¼Œè¿™æ˜¯ HTTP åè®®ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæºå¸¦äº†å…³äºè¯·æ±‚æˆ–å“åº”çš„å…ƒæ•°æ®ï¼ˆæ¯”å¦‚å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ç­‰ï¼‰ã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>OutgoingMessage</code> å¯¹è±¡æœ‰ <code>_headers</code> å’Œ <code>_headerNames</code> è¿™ä¸¤ä¸ªå±æ€§ï¼Œå®ƒä»¬è¢«ç”¨äºå­˜å‚¨å³å°†å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”å¤´éƒ¨ä¿¡æ¯ã€‚å‰ç¼€ <code>_</code> è¡¨ç¤ºè¿™äº›å±æ€§æ˜¯â€œç§æœ‰â€çš„ï¼Œç†è®ºä¸Šä¸åº”è¯¥è¢«å¤–éƒ¨ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹ï¼Œä½†æ˜¯å®é™…ä¸Šå¼€å‘è€…å¯ä»¥å¹¶ä¸”ä¹Ÿç¡®å®åšè¿‡è¿™æ ·çš„æ“ä½œã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼ŒDEP0066 è­¦å‘Šå¼€å‘è€…ï¼š<code>_headers</code> å’Œ <code>_headerNames</code> è¿™ä¸¤ä¸ªå±æ€§å·²è¢«å¼ƒç”¨ï¼ˆdeprecatedï¼‰ã€‚è¿™æ„å‘³ç€å®ƒä»¬åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œè€Œä¸”ä¸é¼“åŠ±å¼€å‘è€…åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><p><strong>å…·ä½“æ¥è¯´ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªä¾‹å­ï¼š</strong></p><ol><li><p><strong>ä»¥å‰çš„ä½¿ç”¨æ–¹å¼ï¼ˆç°åœ¨ä¸æ¨èï¼‰ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸æ¨è: ç›´æ¥æ“ä½œ _headers å’Œ _headerNames</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">_headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">_headerNames</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ¨èçš„ç°ä»£ç”¨æ³•ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨è: ä½¿ç”¨å®˜æ–¹æä¾›çš„æ–¹æ³•è®¾ç½®å“åº”å¤´éƒ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ£€æŸ¥å’Œè¯»å–å¤´éƒ¨ä¿¡æ¯ï¼ˆè€Œä¸æ˜¯ä¿®æ”¹ï¼‰ï¼š</strong><br> å¦‚æœä½ æƒ³è¦è¯»å–å·²ç»è®¾ç½®çš„å¤´éƒ¨ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å®ƒä»¬ï¼Œå¯ä»¥ä½¿ç”¨ <code>getHeader()</code> å’Œ <code>getHeaders()</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è·å–å•ä¸ªå¤´éƒ¨å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> contentType</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">contentType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º &#39;text/html&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è·å–å…¨éƒ¨å¤´éƒ¨ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º { &#39;content-type&#39;: &#39;text/html&#39; }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œæœ€é‡è¦çš„æ˜¯éµå¾ªå®˜æ–¹æ–‡æ¡£å’Œæ¨èçš„æœ€ä½³å®è·µï¼Œä½¿ç”¨æä¾›çš„ API æ–¹æ³•æ¥æ“ä½œ HTTP å¤´éƒ¨ï¼Œä¾‹å¦‚ä½¿ç”¨ <code>setHeader()</code>ã€<code>getHeader()</code> å’Œ <code>getHeaders()</code> æ¥æ›¿ä»£ç›´æ¥æ“ä½œ <code>_headers</code> å’Œ <code>_headerNames</code>ã€‚è¿™æ ·å¯ä»¥ä¿è¯ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œä¸ Node.js æœªæ¥ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚</p><h3 id="dep0067-outgoingmessage-prototype-renderheaders" tabindex="-1"><a class="header-anchor" href="#dep0067-outgoingmessage-prototype-renderheaders"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0067" target="_blank" rel="noopener noreferrer">DEP0067: OutgoingMessage.prototype._renderHeaders</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒDEP0067 æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šçš„æ ‡è¯†ç¬¦ã€‚è¿™ä¸ªå…·ä½“çš„å¼ƒç”¨æ˜¯å…³äº <code>OutgoingMessage.prototype._renderHeaders</code> æ–¹æ³•çš„ã€‚</p><p>é¦–å…ˆï¼Œè§£é‡Šä¸€ä¸‹â€œå¼ƒç”¨ï¼ˆDeprecationï¼‰â€çš„æ¦‚å¿µï¼šåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–æ–¹æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å°†æ¥å¯èƒ½ä¼šä»åº“æˆ–æ¡†æ¶ä¸­ç§»é™¤æ—¶ï¼Œå¼€å‘äººå‘˜å°±ä¼šå°†å…¶æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€ã€‚é€šå¸¸ï¼Œå¼€å‘è€…ä¼šæä¾›æ–°çš„ã€æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè€Œç”¨æˆ·è¢«é¼“åŠ±è¿ç§»åˆ°è¿™äº›æ–°æ–¹æ¡ˆä¸Šå»ã€‚</p><p>åœ¨ Node.js çš„ HTTP æ¨¡å—ä¸­ï¼Œ<code>OutgoingMessage</code> å¯¹è±¡æ˜¯å¯¹æ­£åœ¨å‘é€åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯çš„æŠ½è±¡ï¼Œå®ƒå¯ä»¥æ˜¯æœåŠ¡å™¨å“åº”æˆ–å®¢æˆ·ç«¯è¯·æ±‚ã€‚è¿™ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šå†…éƒ¨æ–¹æ³•ï¼Œå…¶ä¸­ <code>_renderHeaders()</code> å°±æ˜¯ä¸€ä¸ªã€‚æ³¨æ„ï¼Œåœ¨ Node.js ä¸­ï¼Œä»¥ <code>_</code> å¼€å¤´çš„å‡½æ•°æˆ–å±æ€§æ˜¯ç§æœ‰çš„ï¼Œæ„å‘³ç€å®ƒä»¬ä»…ç”¨äºå†…éƒ¨ç›®çš„ï¼Œä¸åº”è¯¥åœ¨ä½ çš„åº”ç”¨ç¨‹åºä»£ç ä¸­ç›´æ¥è°ƒç”¨ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ <code>OutgoingMessage.prototype._renderHeaders</code> çš„ä½œç”¨ï¼š</p><ul><li><code>_renderHeaders()</code> æ–¹æ³•çš„èŒè´£æ˜¯ç¼–è¯‘å’Œè¿”å›ä¸€ç»„è¦å‘é€çš„ HTTP å¤´éƒ¨ä¿¡æ¯ã€‚</li><li>è¿™ä¸ªæ–¹æ³•ä¸»è¦åœ¨ Node.js çš„å†…éƒ¨å®ç°ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚å½“ HTTP æœåŠ¡å™¨å‡†å¤‡å“åº”æ—¶ï¼Œå®ƒéœ€è¦å°†å“åº”å¤´éƒ¨æ¸²æŸ“æˆæ–‡æœ¬æ ¼å¼ï¼Œè¿›è€Œé€šè¿‡ç½‘ç»œå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>DEP0067 å¼ƒç”¨æ„å‘³ç€ä½ ä¸åº”è¯¥å†åœ¨ä½ çš„ä»£ç ä¸­ç›´æ¥è°ƒç”¨ <code>_renderHeaders()</code> æ–¹æ³•ï¼Œå› ä¸ºæœªæ¥çš„ Node.js ç‰ˆæœ¬å¯èƒ½ä¼šåˆ é™¤è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœä½ ç¡®å®åœ¨ä½ çš„ä»£ç ä¸­ç›´æ¥ä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½ åº”è¯¥å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>å®é™…åº”ç”¨ä¸­ï¼Œå¤§å¤šæ•°å¼€å‘è€…å¯èƒ½æ°¸è¿œä¸éœ€è¦ç›´æ¥è°ƒç”¨ <code>_renderHeaders()</code>ï¼Œå› ä¸º Node.js æä¾›äº†æ›´é«˜çº§åˆ«çš„ API æ¥è®¾ç½® HTTP å“åº”å¤´ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥è®¾ç½®å’Œå‘é€ä¸€ä¸ª HTTP å“åº”ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½®å“åº”å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;X-Powered-By&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘é€å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on http://localhost:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨ <code>_renderHeaders()</code> æ–¹æ³•ï¼›ç›¸åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>res.setHeader()</code> æ–¹æ³•æ¥è®¾ç½®å“åº”å¤´éƒ¨ï¼Œç„¶åä½¿ç”¨ <code>res.end()</code> æ¥å‘é€å“åº”å’Œå…³é—­è¿æ¥ã€‚Node.js åœ¨å†…éƒ¨ä¼šå¤„ç†å¤´éƒ¨çš„æ¸²æŸ“å·¥ä½œã€‚</p><p>æ€»ç»“æ¥è¯´ï¼ŒDEP0067 æ˜¯ Node.js å¯¹ <code>_renderHeaders()</code> æ–¹æ³•çš„ä¸€æ¬¡å¼ƒç”¨è­¦å‘Šï¼Œæé†’å¼€å‘è€…ä¸è¦åœ¨ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸ªç§æœ‰æ–¹æ³•ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œä½ åº”è¯¥ä¾èµ–å…¬å…± API æ¥å¤„ç† HTTP å¤´éƒ¨ï¼Œå¦‚ <code>setHeader()</code>, <code>getHeader()</code>, <code>removeHeader()</code>, å’Œå…¶ä»–ç›¸å…³çš„æ–¹æ³•ã€‚è¿™æ ·ï¼Œä½ çš„ä»£ç å°†æ›´å¥å£®ï¼Œæ›´æœ‰å…¼å®¹æ€§ï¼Œä¹Ÿæ›´æ˜“äºç»´æŠ¤ã€‚</p><h3 id="dep0068-node-debug" tabindex="-1"><a class="header-anchor" href="#dep0068-node-debug"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0068" target="_blank" rel="noopener noreferrer">DEP0068: node debug</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆ Node.js ä¸­çš„ <code>node debug</code>ã€‚</p><p>é¦–å…ˆï¼Œ<code>node debug</code> æ˜¯ä¸€ä¸ªå†…ç½®çš„è°ƒè¯•å™¨ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥è°ƒè¯• Node.js åº”ç”¨ç¨‹åºã€‚è¿™ä¸ªè°ƒè¯•å™¨åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­å¯ä»¥ä½¿ç”¨ï¼Œé€šè¿‡è¾“å…¥ <code>node debug </code>&lt;<code>script.js&gt;</code> æ¥å¯åŠ¨ä¸€ä¸ªè¦è°ƒè¯•çš„è„šæœ¬ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨ Node.js çš„åç»­ç‰ˆæœ¬ä¸­ï¼Œ<code>node debug</code> è¢«æ ‡è®°ä¸º<strong>å¼ƒç”¨</strong>ï¼ˆdeprecatedï¼‰ã€‚æ„å‘³ç€å¼€å‘å›¢é˜Ÿæ‰“ç®—åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ç§»é™¤è¿™ä¸ªç‰¹æ€§ï¼Œå¹¶ä¸”å»ºè®®å¼€å‘è€…ä¸è¦å†ä½¿ç”¨å®ƒã€‚å–è€Œä»£ä¹‹çš„æ˜¯æ–°çš„å·¥å…·æˆ–æ–¹æ³•ã€‚</p><p><code>DEP0068</code> æ˜¯ä¸€ä¸ªæ­£å¼çš„å¼ƒç”¨ç¼–ç ï¼Œè¿™ä¸ªç¼–ç å°±æ˜¯é’ˆå¯¹ <code>node debug</code> è¿™ä¸ªç‰¹æ€§çš„ã€‚å½“ä½ çœ‹åˆ° <code>DEP0068</code> è¿™ä¸ªä»£ç æ—¶ï¼Œå®ƒæŒ‡å‘çš„å°±æ˜¯ <code>node debug</code> è°ƒè¯•å™¨çš„å¼ƒç”¨çŠ¶æ€ã€‚</p><p>Node.js æ¨èä½¿ç”¨ Chrome DevTools æˆ–å…¶ä»–æ›´ç°ä»£ã€åŠŸèƒ½æ›´å®Œæ•´çš„è°ƒè¯•å·¥å…·æ¥è¿›è¡Œè°ƒè¯•ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ›¿ä»£ <code>node debug</code> çš„æ–¹æ³•ï¼š</p><ol><li><p><strong>ä½¿ç”¨ <code>--inspect</code> æ ‡å¿—æ¥å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ï¼š</strong><br> å½“ä½ å¯åŠ¨ä½ çš„ Node.js åº”ç”¨æ—¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  <code>--inspect</code> æ ‡å¿—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªå«åš <code>app.js</code> çš„æ–‡ä»¶ï¼Œä½ æƒ³è¦è°ƒè¯•å®ƒï¼Œä½ å¯ä»¥è¿è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ä¼šå¯åŠ¨ä¸€ä¸ªè°ƒè¯•å™¨ç›‘å¬æœåŠ¡å™¨ï¼Œä½ å¯ä»¥é€šè¿‡ Chrome æµè§ˆå™¨è®¿é—® <code>chrome://inspect</code> æ¥é™„åŠ åˆ°æ­£åœ¨è¿è¡Œçš„ Node.js è¿›ç¨‹ä¸Šã€‚</p></li><li><p><strong>ä½¿ç”¨ Visual Studio Code (VS Code) çš„å†…ç½®è°ƒè¯•å™¨ï¼š</strong><br> å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ VS Code ç¼–å†™ä½ çš„ Node.js ä»£ç ï¼Œä½ å¯ä»¥åˆ©ç”¨å®ƒçš„å†…ç½®è°ƒè¯•åŠŸèƒ½ã€‚åªéœ€ç®€å•åœ°è®¾ç½®ä¸€ä¸ª <code>.vscode/launch.json</code> æ–‡ä»¶ï¼Œå¹¶é…ç½®ä¸€äº›è°ƒè¯•å‚æ•°ï¼Œç„¶åä½ å¯ä»¥åœ¨ IDE å†…éƒ¨å¯åŠ¨å’Œè°ƒè¯•ä½ çš„åº”ç”¨ç¨‹åºã€‚</p></li></ol><p><strong>å®ä¾‹</strong>ï¼š<br> å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ï¼Œåä¸º <code>example.js</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// example.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Hello, </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">!`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æƒ³ç”¨ <code>node debug</code> è°ƒè¯•è¿™æ®µä»£ç ï¼Œä½ å¯èƒ½ä¼šè¿è¡Œ <code>node debug example.js</code>ã€‚ä½†ç”±äº <code>node debug</code> å·²ç»å¼ƒç”¨ï¼Œä½ ç°åœ¨åº”è¯¥ä½¿ç”¨ <code>--inspect</code> æˆ–è€… VS Code çš„è°ƒè¯•åŠŸèƒ½ã€‚</p><p>ä½¿ç”¨ <code>--inspect</code> çš„è¯ï¼Œä½ ä¼šè¿è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶ååœ¨ Chrome æµè§ˆå™¨ä¸­æ‰“å¼€ <code>chrome://inspect</code>ï¼Œæ‰¾åˆ°ä½ çš„ Node.js è¿›ç¨‹ï¼Œå¹¶ç‚¹å‡» &quot;inspect&quot; æ¥æ‰“å¼€ DevTools è°ƒè¯•ç•Œé¢ã€‚</p><p>å¦‚æœä½ åœ¨ VS Code ä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° <code>.vscode/launch.json</code> æ–‡ä»¶ï¼Œä»¥åŒ…æ‹¬ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è°ƒè¯•é…ç½®ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;0.2.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;configurations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;request&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;launch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Launch Program&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;skipFiles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;`&lt;`node_internals&gt;/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;program&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;${workspaceFolder}/example.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹åï¼Œä½ å¯ä»¥ç‚¹å‡» VS Code çš„ä¾§è¾¹æ ä¸­çš„è°ƒè¯•å›¾æ ‡ï¼Œé€‰æ‹©åˆšæ‰åˆ›å»ºçš„ &quot;Launch Program&quot; é…ç½®ï¼Œç„¶åç‚¹å‡»ç»¿è‰²çš„ç®­å¤´æˆ–æŒ‰ F5 å¼€å§‹è°ƒè¯•ã€‚</p><h3 id="dep0069-vm-runindebugcontext-string" tabindex="-1"><a class="header-anchor" href="#dep0069-vm-runindebugcontext-string"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0069" target="_blank" rel="noopener noreferrer">DEP0069: vm.runInDebugContext(string)</a></span></a></h3><p><code>vm.runInDebugContext(string)</code>æ˜¯ Node.js çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ æ‰§è¡Œä»£ç åœ¨ä¸€ä¸ªç‰¹æ®Šçš„è°ƒè¯•ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™ä¸ªè°ƒè¯•ä¸Šä¸‹æ–‡æä¾›äº†è®¿é—® V8 å¼•æ“å†…éƒ¨åŠŸèƒ½çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ç”¨äºè°ƒè¯•å’Œæ€§èƒ½åˆ†æçš„å·¥å…·ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>vm.runInDebugContext(string)</code> è¢«æ ‡è®°ä¸º <strong>DEP0069</strong>ï¼Œè¡¨ç¤ºå®ƒå·²ç»è¢«å¼ƒç”¨ï¼ˆdeprecateï¼‰ã€‚æ„æ€æ˜¯è¿™ä¸ªåŠŸèƒ½ä¸åº”è¯¥å†è¢«ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚å¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨è¢«å¼ƒç”¨çš„ç‰¹æ€§ï¼Œå› ä¸ºä»–ä»¬å¾ˆå¯èƒ½ä¼šé€ æˆä»£ç åœ¨å°†æ¥æŸä¸ªæ—¶é—´ç‚¹ä¸Šæ— æ³•å·¥ä½œã€‚</p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯â€œå¼ƒç”¨â€å‘¢ï¼Ÿåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œâ€œå¼ƒç”¨â€æ˜¯æŒ‡ä¸€ç§å®è·µï¼Œå…¶ä¸­å¼€å‘è€…é€æ¸æ·˜æ±°æ—§çš„ç‰¹æ€§è€Œä¸æ˜¯ç›´æ¥ä»ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­çªç„¶ç§»é™¤å®ƒä»¬ã€‚è¿™ç»™äºˆäº†å¼€å‘è€…è¶³å¤Ÿçš„æ—¶é—´æ¥æ›´æ–°å’Œè¿ç§»ä»–ä»¬çš„ä»£ç ä»¥ä½¿ç”¨æ–°çš„æˆ–æ¨èçš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æœ‰ä¸€æ®µä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;vm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è°ƒè¯•ä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œäº†å­—ç¬¦ä¸²ä»£ç ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> vm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">runInDebugContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;var a = 1; console.log(a);&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„è¿™æ®µä»£ç ç°åœ¨è¢«è®¤ä¸ºæ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼Œå¦‚æœä½ å°è¯•è¿è¡Œå®ƒï¼ŒNode.js å¯èƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šï¼Œå‘Šè¯‰ä½ è¿™ä¸ªæ–¹æ³•å·²ç»è¢«å¼ƒç”¨äº†ã€‚</p><p>è¦å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›¿ä»£çš„æ–¹æ³•æ¥å®ç°ä½ éœ€è¦çš„åŠŸèƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒNode.js å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºä¼šæä¾›ä¸€äº›æ¨èçš„æ›¿ä»£æ–¹æ¡ˆã€‚å¯¹äº <code>vm.runInDebugContext(string)</code> çš„ç‰¹å®šæƒ…å†µï¼Œä½ å¯èƒ½éœ€è¦æŸ¥çœ‹æœ€æ–°çš„ Node.js æ–‡æ¡£ä»¥æ‰¾åˆ°å…¶ä»–è°ƒè¯•å·¥å…·æˆ–è€… APIï¼Œæ¯”å¦‚ä½¿ç”¨ inspector æ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªä¸ V8 æ£€æŸ¥å™¨äº¤äº’çš„æ–¹å¼ï¼Œä»¥è¿›è¡Œæ›´ç°ä»£çš„è°ƒè¯•ã€‚</p><p>æ€»ä¹‹ï¼Œè‹¥ä½ çœ‹åˆ°ä»£ç ä¸­ä½¿ç”¨äº† <code>vm.runInDebugContext(string)</code>ï¼Œåˆ™åº”å½“æ„è¯†åˆ°è¿™ä¸ªæ–¹æ³•å·²ç»ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å¯»æ‰¾æ›¿ä»£çš„æ–¹æ³•æ¥ç»´æŠ¤ä»£ç çš„ç¨³å®šæ€§å’Œæœªæ¥çš„å…¼å®¹æ€§ã€‚</p><h3 id="dep0070-async-hooks-currentid" tabindex="-1"><a class="header-anchor" href="#dep0070-async-hooks-currentid"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0070" target="_blank" rel="noopener noreferrer">DEP0070: async_hooks.currentId()</a></span></a></h3><p><code>DEP0070</code>æ˜¯ Node.js é¡¹ç›®ç”¨æ¥æ ‡è®°æŸä¸ªåŠŸèƒ½å¼ƒç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒæŒ‡çš„æ˜¯<code>async_hooks.currentId()</code>æ–¹æ³•çš„å¼ƒç”¨ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹<code>async_hooks</code>æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—å…è®¸å¼€å‘è€…è¿½è¸ª Node.js åº”ç”¨ä¸­å¼‚æ­¥æ“ä½œçš„ç”Ÿå‘½å‘¨æœŸã€‚å¼‚æ­¥æ“ä½œå¯ä»¥æ˜¯å®šæ—¶å™¨ã€Promiseã€å¼‚æ­¥ I/O ç­‰ã€‚æ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œéƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDï¼Œåˆ©ç”¨è¿™äº› IDï¼Œæˆ‘ä»¬å¯ä»¥ç›‘æ§å®ƒä»¬çš„åˆ›å»ºã€é”€æ¯ä»¥åŠè§¦å‘å›è°ƒçš„è¿‡ç¨‹ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¹‹å‰ï¼Œ<code>async_hooks.currentId()</code>æ˜¯ç”¨æ¥è·å–å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„å¼‚æ­¥èµ„æºçš„ IDã€‚ç„¶è€Œï¼Œéšç€æ–°ç‰ˆæœ¬çš„å‘å¸ƒï¼Œæ­¤æ–¹æ³•å·²è¢«åºŸå¼ƒï¼Œå¹¶æ¨èä½¿ç”¨<code>async_hooks.executionAsyncId()</code>æ¥ä»£æ›¿ã€‚</p><p>è¿™ç§å˜åŒ–ä¸»è¦æ˜¯å› ä¸º<code>currentId</code>çš„å‘½åå¯èƒ½ä¼šå¯¼è‡´è¯¯è§£ï¼Œå› ä¸ºå®ƒå¹¶ä¸æ€»æ˜¯è¿”å›å½“å‰å¼‚æ­¥äº‹ä»¶çš„ IDï¼Œç‰¹åˆ«æ˜¯åœ¨å›è°ƒä¹‹é—´çš„åŒæ­¥ä»£ç æ‰§è¡ŒæœŸé—´ã€‚æ–°çš„<code>executionAsyncId()</code>æä¾›äº†æ›´æ¸…æ™°å’Œå‡†ç¡®çš„æ–¹å¼æ¥è·å–å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„ IDã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä¼šç»™ä½ ä¸¾ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨<code>async_hooks</code>æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;async_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª AsyncHook å®ä¾‹ã€‚ä¼ å…¥çš„å¯¹è±¡åŒ…å«ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">triggerAsyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      `å¼‚æ­¥èµ„æºè¢«åˆ›å»º: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, ç±»å‹: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, è§¦å‘è€…ID: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">triggerAsyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  before</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å³å°†æ‰§è¡Œå¼‚æ­¥å›è°ƒ: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  after</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å®Œæˆå¼‚æ­¥å›è°ƒå: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å¼‚æ­¥èµ„æºè¢«é”€æ¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¿€æ´»æˆ‘ä»¬çš„ AsyncHook</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œçš„å›è°ƒä¼šè¢« async_hooks è·Ÿè¸ª</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®šæ—¶å™¨å›è°ƒæ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„ID: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">async_hooks</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">executionAsyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¨åç¦ç”¨ AsyncHook</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  hook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">disable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>async_hooks.createHook()</code>åˆ›å»ºäº†ä¸€ä¸ª<code>AsyncHook</code>å®ä¾‹ï¼Œå¹¶å®šä¹‰äº†å››ä¸ªç”Ÿå‘½å‘¨æœŸçš„å›è°ƒï¼šinitã€beforeã€after å’Œ destroyã€‚é€šè¿‡æ‰“å°æ—¥å¿—ï¼Œä½ å¯ä»¥çœ‹åˆ°å„ä¸ªå¼‚æ­¥èµ„æºçš„åˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ï¼Œä»¥åŠåœ¨å¼‚æ­¥å›è°ƒæ‰§è¡Œå‰åçš„æƒ…å†µã€‚</p><p>å½“æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨æ—¶ï¼Œå®šæ—¶å™¨çš„å›è°ƒä¼šè¢«<code>async_hooks</code>æ‰€è·Ÿè¸ªã€‚åœ¨å›è°ƒå†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>async_hooks.executionAsyncId()</code>æ¥è·å–å½“å‰æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ IDï¼Œä»è€Œæ›´å¥½åœ°ç†è§£å¼‚æ­¥æ“ä½œæ˜¯å¦‚ä½•åœ¨ Node.js ä¸­è¢«æ‰§è¡Œå’Œç®¡ç†çš„ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡<code>hook.disable()</code>å…³é—­äº†æˆ‘ä»¬çš„<code>AsyncHook</code>ï¼Œä»¥é¿å…å¯¹ç°å­˜çš„å¼‚æ­¥æ“ä½œäº§ç”Ÿå½±å“ã€‚</p><h3 id="dep0071-async-hooks-triggerid" tabindex="-1"><a class="header-anchor" href="#dep0071-async-hooks-triggerid"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0071" target="_blank" rel="noopener noreferrer">DEP0071: async_hooks.triggerId()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>async_hooks</code> æ˜¯ä¸€ä¸ªç”¨äºè¿½è¸ªå¼‚æ­¥èµ„æºï¼ˆå¦‚å®šæ—¶å™¨ã€Promiseã€å›è°ƒç­‰ï¼‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„æ¨¡å—ã€‚æ¯ä¸ªå¼‚æ­¥äº‹ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ <code>asyncId</code>ï¼Œå¹¶ä¸”å½“ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶è§¦å‘äº†å¦ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œè¿™ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´å°±å­˜åœ¨ä¸€ä¸ªâ€œè§¦å‘å…³ç³»â€ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>async_hooks.triggerId()</code> è¿™ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸ºã€Œå¼ƒç”¨ã€ï¼ˆDeprecatedï¼‰ï¼Œæ„å‘³ç€æœªæ¥çš„ç‰ˆæœ¬ä¸­è¯¥æ–¹æ³•å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–æ›´æ”¹ï¼Œå› æ­¤ä¸å»ºè®®ç»§ç»­ä½¿ç”¨å®ƒæ¥æ’°å†™æ–°ä»£ç ã€‚</p><p><code>async_hooks.triggerId()</code> æ˜¯ä¸€ä¸ªè¿”å›å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡è§¦å‘çš„å¼‚æ­¥èµ„æºçš„ ID çš„å‡½æ•°ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªè¡¨ç¤ºåˆ›å»ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„å›è°ƒ/äº‹ä»¶çš„é‚£ä¸ªå¼‚æ­¥èµ„æºçš„ IDã€‚è¿™å¯¹äºç†è§£å’Œè·Ÿè¸ªå¼‚æ­¥æ“ä½œæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ äº†è§£å½“å‰æ‰§è¡Œçš„ä¸Šä¸‹æ–‡æ˜¯ç”±ä»€ä¹ˆè§¦å‘çš„ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>async_hooks.triggerId()</code> åœ¨ Node.js çš„æ—§ç‰ˆæœ¬ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜å…¶åº”ç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥ async_hooks æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;async_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥é’©å­å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">triggerAsyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      `ä¸€ä¸ªæ–°çš„å¼‚æ­¥äº‹ä»¶è¢«åˆå§‹åŒ–ï¼Œç±»å‹ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, ID: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, è§¦å‘ID: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">triggerAsyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¿€æ´»è¿™ä¸ªé’©å­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾è¿™é‡Œæ˜¯å¼‚æ­¥ä»£ç ä¸­çš„æŸä¸€ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> currentTriggerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">triggerId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å½“å‰å¼‚æ­¥äº‹ä»¶çš„è§¦å‘IDæ˜¯ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">currentTriggerId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>async_hooks</code> æ¨¡å—å¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é’©å­å®ä¾‹ã€‚åœ¨é’©å­çš„ <code>init</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ‰“å°å‡ºäº†æ–°åˆå§‹åŒ–çš„å¼‚æ­¥èµ„æºä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒçš„ç±»å‹ã€ID å’Œè§¦å‘å®ƒçš„èµ„æº IDï¼ˆ<code>triggerAsyncId</code>ï¼‰ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ <code>setTimeout</code> è®¾ç½®äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­æˆ‘ä»¬å°è¯•è·å–å½“å‰å¼‚æ­¥äº‹ä»¶çš„è§¦å‘ IDã€‚</p><p>ç„¶è€Œï¼Œç”±äº <code>async_hooks.triggerId()</code> è¢«å¼ƒç”¨äº†ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„æœ€æ–°ç‰ˆæœ¬å¼€å‘æ–°é¡¹ç›®ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚å–è€Œä»£ä¹‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥è¿½è¸ªå¼‚æ­¥èµ„æºä¹‹é—´çš„å…³ç³»ï¼Œä¾‹å¦‚ä½¿ç”¨ <code>executionAsyncId</code> å‡½æ•°æ¥è·å–å½“å‰æ‰§è¡Œçš„å¼‚æ­¥èµ„æº IDï¼Œæˆ–è€…é€šè¿‡ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€æ˜ å°„æ¥è¿½è¸ªå¼‚æ­¥èµ„æºã€‚</p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å¼ƒç”¨é€šå¸¸æ„å‘³ç€æŸé¡¹åŠŸèƒ½å°†è¢«ç§»é™¤ï¼Œä½†å…·ä½“çš„æ—¶é—´è¡¨å’Œæ›¿ä»£æ–¹æ¡ˆé€šå¸¸ä¼šåœ¨ Node.js çš„åç»­ç‰ˆæœ¬çš„æ›´æ–°æ—¥å¿—ä¸­æä¾›ï¼Œå› æ­¤å¦‚æœä½ ç›®å‰ä¾èµ– <code>async_hooks.triggerId()</code>ï¼Œè¯·å¯†åˆ‡å…³æ³¨ Node.js å®˜æ–¹çš„æ›´æ–°é€šçŸ¥ã€‚</p><h3 id="dep0072-async-hooks-asyncresource-triggerid" tabindex="-1"><a class="header-anchor" href="#dep0072-async-hooks-asyncresource-triggerid"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0072" target="_blank" rel="noopener noreferrer">DEP0072: async_hooks.AsyncResource.triggerId()</a></span></a></h3><p>å½“ç„¶ï¼Œæˆ‘å¾ˆä¹æ„å¸®åŠ©ä½ ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚è¦è§£é‡Š Node.js ä¸­çš„<code>async_hooks.AsyncResource.triggerId()</code>ä»¥åŠå®ƒçš„å¼ƒç”¨ï¼ˆDEP0072ï¼‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„<code>async_hooks</code>æ¨¡å—å’Œå¼‚æ­¥èµ„æºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œè®¸å¤šæ“ä½œéƒ½æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€æ•°æ®åº“æ“ä½œæˆ–è€…å‘é€ HTTP è¯·æ±‚ã€‚ä¸ºäº†è¿½è¸ªè¿™äº›å¼‚æ­¥æ“ä½œçš„ä¸Šä¸‹æ–‡ï¼ŒNode.js æä¾›äº†ä¸€ä¸ªå†…ç½®æ¨¡å—å«åš<code>async_hooks</code>ã€‚è¿™ä¸ªæ¨¡å—å¯ä»¥è®©æˆ‘ä»¬è§‚å¯Ÿåˆ°å¼‚æ­¥èµ„æºï¼ˆå¦‚ Promisesã€Timers ç­‰ï¼‰çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚</p><p>æ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œéƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå³<code>asyncId</code>ã€‚è€Œ<code>triggerId</code>æ˜¯åœ¨åˆ›å»ºæ–°çš„å¼‚æ­¥èµ„æºæ—¶ï¼Œè¡¨ç¤ºè§¦å‘è¯¥èµ„æºçš„é‚£ä¸ªå¼‚æ­¥äº‹ä»¶çš„<code>asyncId</code>ã€‚ç®€å•æ¥è¯´ï¼Œ<code>triggerId</code>å°±æ˜¯çˆ¶å¼‚æ­¥èµ„æºçš„ IDã€‚</p><p><code>AsyncResource</code>æ˜¯<code>async_hooks</code>æ¨¡å—æä¾›çš„ä¸€ä¸ªç±»ï¼Œè¢«ç”¨æ¥åˆ›é€ ä¸€ä¸ªæ–°çš„å¼‚æ­¥èµ„æºï¼Œå¹¶ä¸”å¯ä»¥æ‰‹åŠ¨åˆ†é…å¼‚æ­¥æ“ä½œçš„è§¦å‘ IDã€‚<code>triggerId()</code>æ–¹æ³•æ˜¯<code>AsyncResource</code>ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒè¿”å›åˆ›å»ºå½“å‰å¼‚æ­¥èµ„æºæ—¶çš„<code>triggerId</code>ã€‚</p><p>ä½†åœ¨ Node.js çš„æ›´æ–°ç‰ˆæœ¬ï¼ˆå¦‚ v21.7.1ï¼‰ä¸­ï¼Œ<code>triggerId()</code>æ–¹æ³•å·²ç»è¢«å¼ƒç”¨ã€‚æ‰€è°“å¼ƒç”¨ï¼ŒæŒ‡çš„æ˜¯è¿™ä¸ªåŠŸèƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œå¹¶ä¸æ¨èä½¿ç”¨ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆæˆ–è€…è¿™ä¸ªåŠŸèƒ½å­˜åœ¨é—®é¢˜ã€‚</p><p>å®é™…åº”ç”¨çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œç”¨æˆ·çš„æ¯ä¸ªè¯·æ±‚å¯èƒ½æ¶‰åŠè®¸å¤šå¼‚æ­¥æ“ä½œã€‚ä¸ºäº†è¿½è¸ªæŸä¸ªè¯·æ±‚ç›¸å…³çš„æ‰€æœ‰å¼‚æ­¥äº‹ä»¶ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨<code>async_hooks</code>æ¨¡å—æ¥è®°å½•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;async_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘æ§å¼‚æ­¥æ“ä½œçš„ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">triggerAsyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¯å½“åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥æ“ä½œæ—¶è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> message</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Async operation started: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> (ID: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, Trigger: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">triggerAsyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¯å½“å¼‚æ­¥æ“ä½œç»“æŸæ—¶è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> message</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Async operation ended: ID </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯åŠ¨ç›‘æ§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> resource</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AsyncResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;EXAMPLE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæ¯å½“å¯åŠ¨æˆ–é”€æ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šå†™å…¥æ¶ˆæ¯åˆ°æ§åˆ¶å°ã€‚å¦‚æœä½ å°è¯•ä½¿ç”¨<code>resource.triggerId()</code>æ–¹æ³•æ¥è·å–è§¦å‘è¯¥èµ„æºçš„ IDï¼Œåœ¨ Node.js v21.7.1 ä¸­å°†ä¼šå¾—åˆ°å¼ƒç”¨è­¦å‘Šã€‚è¿™æ˜¯å› ä¸º Node.js å¼€å‘å›¢é˜Ÿå†³å®šä¸å†æ”¯æŒè¿™ç§æ–¹å¼è·å–<code>triggerId</code>ã€‚</p><p>å¦‚éœ€å¤„ç†å¼‚æ­¥èµ„æºçš„<code>triggerId</code>ï¼Œå»ºè®®ä½¿ç”¨å…¶ä»–æä¾›çš„ API æˆ–æ–¹æ³•æ¥è·Ÿè¸ªå¼‚æ­¥æ“ä½œçš„å…³ç³»ï¼Œè€Œä¸æ˜¯ä¾èµ–äº<code>triggerId()</code>æ–¹æ³•ã€‚å…·ä½“æ›¿ä»£æ–¹æ¡ˆå¯èƒ½ä¼šéšç€ Node.js ç‰ˆæœ¬çš„æ›´æ–°è€Œå˜åŒ–ï¼Œå› æ­¤æœ€å¥½æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£è·å–æœ€æ–°çš„æœ€ä½³å®è·µã€‚</p><h3 id="dep0073-several-internal-properties-of-net-server" tabindex="-1"><a class="header-anchor" href="#dep0073-several-internal-properties-of-net-server"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0073" target="_blank" rel="noopener noreferrer">DEP0073: Several internal properties of net.Server</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šè¿™ä¸ª Node.js ä¸­çš„æ¦‚å¿µã€‚</p><p>é¦–å…ˆï¼Œ&quot;DEP0073&quot;æ˜¯ä¸€ä¸ªç‰¹å®šç¼–å·çš„å¼ƒç”¨è­¦å‘Šã€‚æ‰€è°“â€œå¼ƒç”¨â€ï¼ˆDeprecationï¼‰ï¼Œå°±æ˜¯æŒ‡åœ¨è½¯ä»¶ä¸­æŸä¸ªåŠŸèƒ½æˆ–è€…å±æ€§å³å°†ä¸å†è¢«æ”¯æŒå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œä½†åœ¨å½“å‰ç‰ˆæœ¬ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚Node.js é€šè¿‡è¿™ç§æ–¹å¼ç»™å¼€å‘è€…ä¸€ä¸ªé¢„è­¦ï¼Œè®©ä»–ä»¬æœ‰æ—¶é—´å»æ›´æ–°å’Œä¿®æ”¹è‡ªå·±çš„ä»£ç ã€‚</p><p>å…·ä½“åˆ°&quot;DEP0073&quot;ï¼Œè¿™ä¸ªè­¦å‘Šæ˜¯å…³äº <code>net.Server</code> ç±»ä¸­å‡ ä¸ªå†…éƒ¨å±æ€§çš„å¼ƒç”¨ã€‚<code>net.Server</code> æ˜¯ Node.js ä¸­ç”¨äºåˆ›å»ºç½‘ç»œæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ TCP æˆ– IPC æœåŠ¡å™¨ï¼‰çš„ä¸€ä¸ªç±»ã€‚</p><p>åœ¨è¿™ä¸ªè­¦å‘Šä¸­ï¼Œä¸‹é¢è¿™äº› <code>net.Server</code> çš„å†…éƒ¨å±æ€§è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼š</p><ul><li><code>_connections</code></li><li><code>connections</code></li></ul><p>åœ¨è¿‡å»ï¼Œä¸€äº›å¼€å‘è€…å¯èƒ½ç›´æ¥ä½¿ç”¨è¿™äº›å±æ€§æ¥è·å–æœåŠ¡å™¨å½“å‰çš„è¿æ¥æ•°ã€‚ä½†æ˜¯ï¼Œå®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰æŠŠå®ƒä»¬ä½œä¸ºå…¬å…± API çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ç†è®ºä¸Šå®ƒä»¬æœ¬ä¸åº”å½“è¢«ç›´æ¥ä½¿ç”¨ã€‚</p><p>çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬åœ¨ä»¥å‰çš„ Node.js ç‰ˆæœ¬ä¸­å†™äº†ä¸€ä¸ªç®€å•çš„ TCP æœåŠ¡å™¨ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³æ‰“å°å‡ºå½“å‰çš„è¿æ¥æ•°ï¼Œä»£ç å¯èƒ½ä¼šåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;net&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å®¢æˆ·ç«¯è¿æ¥çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨å·²ç»å¼ƒç”¨çš„å†…éƒ¨å±æ€§æ¥è·å–è¿æ¥æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Current connections:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">_connections</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œ<code>server._connections</code> å°±æ˜¯é‚£ä¸ªå·²ç»è¢«å¼ƒç”¨çš„å†…éƒ¨å±æ€§ã€‚å°½ç®¡å®ƒå¯èƒ½åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­è¿˜èƒ½æ­£å¸¸å·¥ä½œï¼Œä½†åœ¨æ–°ç‰ˆä¸­å¯èƒ½ä¼šå¼•èµ·é—®é¢˜æˆ–è€…æœ€ç»ˆä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§é—®é¢˜ï¼ŒNode.js å®˜æ–¹å»ºè®®ä½¿ç”¨æ›¿ä»£çš„æ–¹æ³•æ¥è·å–è¿™ç±»ä¿¡æ¯ã€‚å¯¹äº <code>net.Server</code> çš„è¿æ¥æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>server.getConnections(callback)</code> æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå¯ä»¥å®‰å…¨åœ°è·å–å½“å‰çš„è¿æ¥æ•°ã€‚</p><p>ä¿®æ”¹åçš„ä¾‹å­å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;net&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å®¢æˆ·ç«¯è¿æ¥çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ¨èçš„æ–¹æ³•æ¥è·å–è¿æ¥æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getConnections</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error getting connections:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Current connections:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>getConnections</code> æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯é”™è¯¯å¯¹è±¡ï¼ˆå¦‚æœæ“ä½œæˆåŠŸåˆ™ä¸º nullï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯è¿æ¥æ•°ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ&quot;DEP0073&quot; æ˜¯ä¸€ä¸ªæé†’ä½ ä¸è¦ä½¿ç”¨ <code>net.Server</code> å†…éƒ¨å±æ€§çš„å¼ƒç”¨è­¦å‘Šï¼Œè€Œåº”è¯¥ä½¿ç”¨å®˜æ–¹æ¨èçš„æ–¹æ³•ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„ä»£ç åœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­æ›´åŠ ç¨³å®šå’Œå…¼å®¹ã€‚</p><h3 id="dep0074-replserver-bufferedcommand" tabindex="-1"><a class="header-anchor" href="#dep0074-replserver-bufferedcommand"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0074" target="_blank" rel="noopener noreferrer">DEP0074: REPLServer.bufferedCommand</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„è¿™ä¸ªåºŸå¼ƒåŠŸèƒ½ï¼š<code>REPLServer.bufferedCommand</code>ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯ REPL å’Œ <code>REPLServer</code>ã€‚REPL æ˜¯ Read-Eval-Print Loop çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ç§ç®€å•çš„ç¼–ç¨‹ç¯å¢ƒï¼Œå…è®¸ç”¨æˆ·è¾“å…¥ä»£ç ï¼Œå¹¶ç«‹å³æ‰§è¡Œä»£ç ï¼Œç„¶åæ˜¾ç¤ºç»“æœã€‚Node.js æä¾›äº†ä¸€ä¸ªå†…ç½®çš„ REPL ç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>node</code> è€Œæ²¡æœ‰ä»»ä½•æ–‡ä»¶å‚æ•°æ¥è®¿é—®ã€‚</p><p>å½“ä½ è¿›å…¥ Node.js çš„ REPL ç¯å¢ƒæ—¶ï¼Œä½ å®é™…ä¸Šæ­£åœ¨å’Œ <code>REPLServer</code> å®ä¾‹äº¤äº’ã€‚è¿™ä¸ª <code>REPLServer</code> å¯¹è±¡ç®¡ç†ç€ REPL ç¯å¢ƒçš„çŠ¶æ€å’Œè¡Œä¸ºï¼Œä¾‹å¦‚å¤„ç†ä½ è¾“å…¥çš„ä»£ç ã€ä¿æŒå†å²è®°å½•ç­‰ã€‚</p><p>åœ¨æŸäº›ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>REPLServer</code> å¯¹è±¡æœ‰ä¸€ä¸ªå±æ€§å«åš <code>bufferedCommand</code>ã€‚è¿™ä¸ªå±æ€§ç”¨äºä¿å­˜ä½ åœ¨ REPL ä¸­è¾“å…¥ä½†å°šæœªæ‰§è¡Œçš„ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è¾“å…¥äº†ä»£ç ä½†è¿˜æ²¡æœ‰æŒ‰ä¸‹å›è½¦é”®ï¼ˆæˆ–è€…ä»£ç å› ä¸ºåŒ…å«å¤šè¡Œè€Œä¸å®Œæ•´ï¼‰ï¼Œè¿™éƒ¨åˆ†ä»£ç ä¼šè¢«æš‚æ—¶å­˜å‚¨åœ¨ <code>bufferedCommand</code> å±æ€§ä¸­ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>REPLServer.bufferedCommand</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆDEP0074ï¼‰ã€‚è¿™æ„å‘³ç€ Node.js çš„å¼€å‘å›¢é˜Ÿè®¡åˆ’åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤è¿™ä¸ªç‰¹æ€§ï¼Œå¹¶ä¸”ä¸å»ºè®®å¼€å‘è€…å†ä½¿ç”¨å®ƒã€‚é€šå¸¸åºŸå¼ƒçš„åŸå› å¯èƒ½æ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œæˆ–è€…è¿™ä¸ªç‰¹æ€§ä¸å†é€‚åˆä¿ç•™åœ¨ Node.js ä¸­ã€‚</p><p>å…·ä½“åˆ°ä½ æåˆ°çš„ <code>REPLServer.bufferedCommand</code> çš„åºŸå¼ƒï¼Œè¿™å¯èƒ½æ˜¯å› ä¸º Node.js æä¾›äº†æ–°çš„æ–¹å¼æ¥å¤„ç† REPL ä¸­æœªå®Œæˆçš„ä»£ç è¾“å…¥ï¼Œæˆ–è€…æ˜¯å› ä¸ºç›´æ¥æ“ä½œ <code>bufferedCommand</code> å±æ€§å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›éš¾ä»¥é¢„æ–™çš„å‰¯ä½œç”¨ï¼Œæ‰€ä»¥ Node.js å›¢é˜Ÿå¯èƒ½å†³å®šåœæ­¢æ”¯æŒç›´æ¥ä½¿ç”¨è¿™ä¸ªå±æ€§ã€‚</p><p>å®é™…åº”ç”¨çš„ä¾‹å­ï¼š</p><p>åœ¨åºŸå¼ƒä¹‹å‰ï¼Œå¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ‰©å±• Node.js REPL ç¯å¢ƒçš„ç¨‹åºï¼Œä½ å¯èƒ½ä¼šç›´æ¥æ£€æŸ¥æˆ–ä¿®æ”¹ <code>bufferedCommand</code> æ¥å®ç°æŸäº›åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå¯èƒ½çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">replServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">bufferedCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æŸä¸ªå…³é”®å­—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç”¨æˆ·æ­£å‡†å¤‡è¾“å…¥ä¸â€œæŸä¸ªå…³é”®å­—â€ç›¸å…³çš„å‘½ä»¤&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†ç”¨æˆ·æ˜¯å¦è¾“å…¥äº†åŒ…å«â€œæŸä¸ªå…³é”®å­—â€çš„å‘½ä»¤ï¼Œè¿™ç§æ£€æµ‹å¯ä»¥åœ¨ç”¨æˆ·å®Œæˆè¾“å…¥ä¹‹å‰åšå‡ºååº”ã€‚</p><p>ç„¶è€Œï¼Œç°åœ¨ç”±äº <code>bufferedCommand</code> è¢«åºŸå¼ƒï¼Œä½ åº”è¯¥å¯»æ‰¾å…¶ä»–æ–¹å¼æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå¯èƒ½æ¶‰åŠåˆ°ç›‘å¬ REPL çš„äº‹ä»¶æˆ–ä½¿ç”¨ REPL çš„å…¶ä»–ç°æœ‰ APIã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š<code>REPLServer.bufferedCommand</code> æ˜¯ Node.js REPL ç¯å¢ƒä¸­ç”¨äºä¸´æ—¶å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å±æ€§ï¼Œä½†åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å·²è¢«åºŸå¼ƒï¼Œæ„å‘³ç€åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¿™ä¸ªå±æ€§å°†è¢«ç§»é™¤ï¼Œå¹¶ä¸”ä¸åº”è¯¥åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚</p><h3 id="dep0075-replserver-parsereplkeyword" tabindex="-1"><a class="header-anchor" href="#dep0075-replserver-parsereplkeyword"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0075" target="_blank" rel="noopener noreferrer">DEP0075: REPLServer.parseREPLKeyword()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>REPLServer.parseREPLKeyword()</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒç”¨äºè§£æåœ¨ Node.js REPLï¼ˆRead-Eval-Print Loopï¼‰ç¯å¢ƒä¸­è¾“å…¥çš„ç‰¹æ®Šå…³é”®å­—å‘½ä»¤ã€‚REPL ç¯å¢ƒæ˜¯ä¸€ä¸ªäº¤äº’å¼çš„ç¼–ç¨‹ç¯å¢ƒï¼Œå…è®¸å¼€å‘è€…è¾“å…¥ä»£ç ï¼Œå¹¶ç«‹å³çœ‹åˆ°ä»£ç æ‰§è¡Œçš„ç»“æœã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>REPLServer.parseREPLKeyword()</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚å½“ä¸€ä¸ªåŠŸèƒ½è¢«åºŸå¼ƒæ—¶ï¼Œå®ƒé€šå¸¸æ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…è¯¥åŠŸèƒ½ä¸å†ç¬¦åˆå½“å‰çš„æœ€ä½³å®è·µã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒDEP0075 æ˜¯ Node.js å®˜æ–¹åˆ†é…çš„ä¸€ä¸ªåºŸå¼ƒè­¦å‘Šä»£ç ï¼Œå®ƒå”¯ä¸€åœ°æ ‡è¯†äº† <code>REPLServer.parseREPLKeyword()</code> æ–¹æ³•çš„åºŸå¼ƒçŠ¶æ€ã€‚Node.js ä½¿ç”¨ DEPXXXX æ ¼å¼çš„ä»£ç æ¥è¿½è¸ªå’Œæ–‡æ¡£åŒ–åºŸå¼ƒçš„ API å’ŒåŠŸèƒ½ï¼Œä»¥ä¾¿å¼€å‘è€…å¯ä»¥äº†è§£å“ªäº›åŠŸèƒ½å³å°†å˜åŒ–ï¼Œä»è€Œåšå‡ºç›¸åº”çš„è°ƒæ•´ã€‚</p><p><strong>ä¾‹å­è¯´æ˜ï¼š</strong></p><p>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ REPL æœåŠ¡å™¨ï¼Œå¹¶æƒ³è¦å¤„ç†ç‰¹å®šçš„å…³é”®å­—å‘½ä»¤ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>REPLServer.parseREPLKeyword()</code> æ¥è¾…åŠ©å®ç°è¿™ä¸€åŠŸèƒ½ã€‚å‡è®¾ä½ æƒ³è¦å¤„ç†ä¸€ä¸ªåä¸º <code>.sayhello</code> çš„å‘½ä»¤ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šè¿™æ ·å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ REPL æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> replServer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&gt; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ·»åŠ å¯¹ .sayhello å‘½ä»¤çš„è§£ææ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">replServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parseREPLKeyword</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sayhello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨æˆ·è¾“å…¥ <code>.sayhello</code> åï¼ŒREPL æœåŠ¡å™¨å°†è¾“å‡º &quot;Hello, world!&quot;ã€‚</p><p>ç„¶è€Œï¼Œç”±äº <code>REPLServer.parseREPLKeyword()</code> å·²è¢«åºŸå¼ƒï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js v21.7.1 æˆ–æ›´æ–°çš„ç‰ˆæœ¬ï¼Œä½ åº”è¯¥å¯»æ‰¾å…¶ä»–æ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä½ å¯èƒ½éœ€è¦ç›´æ¥ç›‘å¬ç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶è‡ªè¡Œè§£ææ˜¯å¦å­˜åœ¨ç‰¹æ®Šå…³é”®å­—ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ REPL æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> replServer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&gt; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  eval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">cmd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cmd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">trim</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;.sayhello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å¤„ç†å…¶ä»–å‘½ä»¤...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ–°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ <code>eval</code> å‡½æ•°ä¸­æ£€æŸ¥è¾“å…¥å‘½ä»¤ <code>cmd</code>ï¼Œå¦‚æœå‘ç°ç”¨æˆ·è¾“å…¥äº† <code>.sayhello</code>ï¼Œåˆ™è¾“å‡º &quot;Hello, world!&quot;ã€‚å¯¹äºéç‰¹æ®Šå…³é”®å­—çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ‰§è¡Œå…¶ä»–çš„ä»£ç å¤„ç†é€»è¾‘ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>REPLServer.parseREPLKeyword()</code> åœ¨ Node.js v21.7.1 ä¸­æ ‡è®°ä¸ºåºŸå¼ƒæ„å‘³ç€ä½ åº”è¯¥é¿å…ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å¯»æ±‚æ›¿ä»£æ–¹æ¡ˆæ¥å¤„ç† REPL ä¸­çš„ç‰¹æ®Šå‘½ä»¤ã€‚</p><h3 id="dep0076-tls-parsecertstring" tabindex="-1"><a class="header-anchor" href="#dep0076-tls-parsecertstring"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0076" target="_blank" rel="noopener noreferrer">DEP0076: tls.parseCertString()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒè®©å¼€å‘è€…å¯ä»¥ç”¨ JavaScript ç¼–å†™æœåŠ¡ç«¯ä»£ç ï¼Œå®ç°åç«¯çš„åŠŸèƒ½ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>tls.parseCertString()</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå±äº <code>tls</code> (Transport Layer Security) æ¨¡å—ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è§£æä¸€ä¸ªè¯ä¹¦å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª JavaScript å¯¹è±¡ã€‚è¯ä¹¦å­—ç¬¦ä¸²é€šå¸¸æ˜¯ä¸€ä¸²ç¼–ç äº†è¯ä¹¦è¯¦ç»†ä¿¡æ¯çš„æ–‡æœ¬ï¼Œé‡‡ç”¨ç‰¹å®šæ ¼å¼ï¼ˆæ¯”å¦‚ PEMï¼‰è¿›è¡Œç¼–ç ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨ Node.js çš„æ–°ç‰ˆæœ¬ä¸­ï¼Œ<code>tls.parseCertString()</code> è¢«æ ‡è®°ä¸º<strong>å·²åºŸå¼ƒ</strong>ï¼ˆdeprecatedï¼‰ï¼Œæ„å‘³ç€è¿™ä¸ªå‡½æ•°ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚å½“ä½ ä½¿ç”¨ä¸€ä¸ªå·²åºŸå¼ƒçš„åŠŸèƒ½æ—¶ï¼ŒNode.js å¯èƒ½ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºå¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-tls-parsecertstring-è¢«åºŸå¼ƒäº†" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-tls-parsecertstring-è¢«åºŸå¼ƒäº†"><span>ä¸ºä»€ä¹ˆ <code>tls.parseCertString()</code> è¢«åºŸå¼ƒäº†ï¼Ÿ</span></a></h3><p>å®ƒè¢«åºŸå¼ƒçš„åŸå› å¯èƒ½åŒ…æ‹¬ï¼š</p><ul><li>å­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ³•æ¥æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ã€‚</li><li>å®ƒå¯èƒ½æ— æ³•å¾ˆå¥½åœ°é€‚åº”æœªæ¥çš„è¦æ±‚æˆ–è®¡åˆ’ä¸­çš„æ–°ç‰¹æ€§ã€‚</li><li>å®ƒå¯èƒ½åœ¨ä½¿ç”¨ä¸Šæœ‰å®‰å…¨é£é™©æˆ–è€…å…¶ä»–é—®é¢˜ã€‚</li></ul><h3 id="æ›¿ä»£æ–¹æ¡ˆ-3" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£æ–¹æ¡ˆ-3"><span>æ›¿ä»£æ–¹æ¡ˆ</span></a></h3><p>ä½œä¸ºæ›¿ä»£ï¼Œå¼€å‘è€…åº”è¯¥ä½¿ç”¨å…¶ä»–åº“æ¥è§£æè¯ä¹¦ï¼Œä¾‹å¦‚ä½¿ç”¨ <code>forge</code>ã€<code>asn1.js</code> ç­‰ç¬¬ä¸‰æ–¹åº“ï¼Œæˆ–è€…ä½¿ç”¨ Node.js å†…ç½®çš„å…¶ä»–å‡½æ•°å’Œæ¨¡å—æ¥å¤„ç†è¯ä¹¦ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬éœ€è¦è§£æä¸€ä¸ª SSL/TLS è¯ä¹¦çš„å†…å®¹ï¼Œä»¥å‰ä½ å¯èƒ½ä¼šè¿™ä¹ˆåšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> certStr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;C=US, ST=California, L=Mountain View, O=Google LLC, CN=www.google.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> certObj</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parseCertString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certStr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certObj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ç”±äº <code>tls.parseCertString()</code> å·²ç»è¢«åºŸå¼ƒäº†ï¼Œè¿™æ®µä»£ç å°†æ¥å¯èƒ½å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><p>å¦‚æœæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ <code>node-forge</code> æ¥è§£æè¯ä¹¦å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä»£ç å¯èƒ½ä¼šå˜æˆè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> forge</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-forge&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ pem æ˜¯ä¸€ä¸ªä»æ–‡ä»¶ä¸­è¯»å–çš„è¯ä¹¦çš„ PEM æ ¼å¼å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> pem</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `-----BEGIN CERTIFICATE-----</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">...</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">-----END CERTIFICATE-----`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°† PEM æ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º forge çš„è¯ä¹¦å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> forge</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">pki</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">certificateFromPem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç„¶åå¯ä»¥ä» cert å¯¹è±¡ä¸­æå–å„ç§ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸»é¢˜æˆ–é¢å‘è€…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">subject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">attributes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">issuer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">attributes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥ <code>node-forge</code> åº“ï¼Œç„¶åè¯»å–ä¸€ä¸ª PEM æ ¼å¼çš„è¯ä¹¦å­—ç¬¦ä¸²å¹¶é€šè¿‡ <code>forge.pki.certificateFromPem()</code> å‡½æ•°å°†å…¶è§£æä¸ºä¸€ä¸ªè¯ä¹¦å¯¹è±¡ï¼Œæœ€åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„å±æ€§ï¼Œè¯¸å¦‚è¯ä¹¦çš„ä¸»é¢˜ï¼ˆSubjectï¼‰å’Œé¢å‘è€…ï¼ˆIssuerï¼‰ç­‰ä¿¡æ¯ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œéšç€ Node.js çš„å‘å±•ï¼ŒæŸäº› API å¯èƒ½ä¼šè¢«å‘ç°ä¸é€‚åˆç»§ç»­ä½¿ç”¨ï¼Œå¹¶å› æ­¤è¢«åºŸå¼ƒã€‚é¢å¯¹è¿™ç§æƒ…å†µï¼Œå¼€å‘è€…éœ€è¦å¯»æ‰¾å¹¶è¿ç§»åˆ°æ–°çš„ã€å»ºè®®çš„æ–¹æ³•æ¥ä¿æŒä»£ç çš„å¥å£®æ€§å’Œå®‰å…¨æ€§ã€‚</p><h3 id="dep0077-module-debug" tabindex="-1"><a class="header-anchor" href="#dep0077-module-debug"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0077" target="_blank" rel="noopener noreferrer">DEP0077: Module._debug()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;deprecation&quot;ï¼ˆå¼ƒç”¨ï¼‰æ˜¯ä¸€ä¸ªè­¦å‘Šï¼Œæ„å‘³ç€æŸä¸ªç‰¹å®šçš„åŠŸèƒ½æˆ–è€…ä»£ç å°†æ¥å¯èƒ½ä¼šè¢«ç§»é™¤æ‰ï¼Œä½†æ˜¯ç›®å‰ä»ç„¶å¯ç”¨ã€‚å½“ä½ çœ‹åˆ° <code>[DEP0077]</code> è¿™æ ·çš„ä¿¡æ¯æ—¶ï¼Œå®ƒå…¶å®æ˜¯åœ¨å‘Šè¯‰å¼€å‘è€…ï¼šè¿™éƒ¨åˆ†ä»£ç æœªæ¥å¯èƒ½ä¸å†æ”¯æŒï¼Œè¯·å°½é‡é¿å…ä½¿ç”¨æˆ–ä¾èµ–è¿™ä¸€åŠŸèƒ½ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>Module._debug()</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œä¹‹æ‰€ä»¥å«åšç§æœ‰æ–¹æ³•ï¼Œæ˜¯å› ä¸ºå®ƒæœ¬æ„å¹¶ä¸æ˜¯ç»™æ™®é€šç”¨æˆ·ç›´æ¥è°ƒç”¨çš„ã€‚è¿™ä¸ªå‡½æ•°æœ€åˆæ˜¯ä½œä¸º Node.js å†…éƒ¨è°ƒè¯•åŠŸèƒ½ä½¿ç”¨çš„ã€‚åœ¨è¿‡å»ï¼Œå¦‚æœå¼€å‘è€…éœ€è¦åœ¨æ¨¡å—åŠ è½½æ—¶è¾“å‡ºä¸€äº›è°ƒè¯•ä¿¡æ¯ï¼Œå¯èƒ½ä¼šä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ç°åœ¨ <code>DEP0077: Module._debug()</code> è¡¨æ˜è¿™ä¸ªå‡½æ•°å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå°†åœ¨ Node.js çš„å°†æ¥ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–è€…æ”¹å˜ï¼Œä¸å»ºè®®å¼€å‘è€…ç»§ç»­ä½¿ç”¨å®ƒã€‚</p><p>è¦äº†è§£ Node.js ä¸­å¼ƒç”¨å‡½æ•°çš„å¤„ç†æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ã€‚</p><p>å‡è®¾åœ¨æ—§çš„ Node.js ä»£ç ä¸­ï¼Œä½ å¯èƒ½ä¼šæ‰¾åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç ç‰‡æ®µï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> module</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">_debug</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is a debug message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä½¿ç”¨äº† <code>_debug()</code> æ–¹æ³•æ¥è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚â€œ_â€ åœ¨å‡½æ•°åå‰é€šå¸¸è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¸åº”è¯¥è¢«å¤–éƒ¨ç›´æ¥è°ƒç”¨çš„ç§æœ‰æ–¹æ³•ã€‚</p><p>ä½†æ˜¯ç”±äºè¿™ä¸ªæ–¹æ³•å·²ç»è¢«å¼ƒç”¨ï¼Œå¦‚æœä½ æƒ³åœ¨æ–°çš„ä»£ç ä¸­è¿›è¡Œç±»ä¼¼çš„è°ƒè¯•æ“ä½œï¼Œåº”è¯¥ä½¿ç”¨å…¶ä»–çš„æ›¿ä»£æ–¹æ³•ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨ <code>console.log()</code>ã€<code>console.debug()</code> æˆ–è€… Node.js çš„ <code>util.debuglog()</code> æ–¹æ³•æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><p>ä¸¾ä¸ªæ›¿æ¢åçš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> debuglog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">debuglog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“ NODE_DEBUG ç¯å¢ƒå˜é‡ä¸­åŒ…å« &#39;foo&#39; æ—¶ï¼Œä¸‹é¢çš„æ¶ˆæ¯æ‰ä¼šæ‰“å°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">debuglog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is a debug message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>util.debuglog()</code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªè°ƒè¯•å‡½æ•°ï¼Œå¹¶ä¸”åªæœ‰å½“ <code>NODE_DEBUG</code> ç¯å¢ƒå˜é‡ä¸­åŒ…å«äº† &#39;foo&#39; æ—¶ï¼Œ<code>debuglog</code> æ‰“å°çš„ä¿¡æ¯æ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚è¿™æä¾›äº†æ›´çµæ´»å’Œæ›´å®˜æ–¹çš„è°ƒè¯•æ”¯æŒã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>[DEP0077] Module._debug()</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå·²ç»è¢«å¼ƒç”¨çš„å†…éƒ¨è°ƒè¯•æ–¹æ³•ï¼Œæ„å‘³ç€å¼€å‘è€…åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­åº”å½“é¿å…ä½¿ç”¨å®ƒï¼Œå¹¶è½¬è€Œä½¿ç”¨å…¶ä»–æ­£å¼æ”¯æŒçš„è°ƒè¯•æ–¹æ³•ã€‚</p><h3 id="dep0078-replserver-turnoffeditormode" tabindex="-1"><a class="header-anchor" href="#dep0078-replserver-turnoffeditormode"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0078" target="_blank" rel="noopener noreferrer">DEP0078: REPLServer.turnOffEditorMode()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬èŠä¸€èŠ Node.js ä¸­çš„ REPLServer å’Œå®ƒçš„<code>turnOffEditorMode()</code>æ–¹æ³•ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•åœ¨ Node.js ç‰ˆæœ¬ 21.7.1 ä¸­è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDEP0078ï¼‰ã€‚</p><p>é¦–å…ˆï¼ŒREPL æ˜¯â€œRead-Eval-Print Loopâ€çš„ç¼©å†™ï¼Œè¡¨ç¤ºä¸€ä¸ªç®€å•çš„äº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»£ç ï¼Œå¹¶ç«‹å³çœ‹åˆ°è¿è¡Œç»“æœã€‚Node.js è‡ªå¸¦äº†ä¸€ä¸ª REPL ç¯å¢ƒï¼Œä½ åªéœ€åœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>node</code>å¹¶å›è½¦ï¼Œå°±èƒ½è¿›å…¥ Node.js çš„ REPL æ¨¡å¼ã€‚</p><p>åœ¨ REPL ç¯å¢ƒä¸­ï¼Œæœ‰ä¸€ä¸ªâ€œç¼–è¾‘æ¨¡å¼â€ï¼Œå®ƒå…è®¸ä½ åƒä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸€æ ·ç¼–è¾‘å¤šè¡Œä»£ç ã€‚åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¼€å¯è¿™ç§æ¨¡å¼å¹¶ä¸æ˜¯é»˜è®¤çš„ï¼Œå¦‚æœä½ æƒ³è¦å¼€å¯æˆ–å…³é—­è¿™ç§â€œç¼–è¾‘æ¨¡å¼â€ï¼Œå¯èƒ½ä¼šç”¨åˆ° REPLServer å®ä¾‹çš„<code>turnOffEditorMode()</code>æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰åºŸå¼ƒ<code>turnOffEditorMode()</code>ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> replServer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">replServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">turnOffEditorMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…³é—­ç¼–è¾‘æ¨¡å¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ç‰‡æ®µåˆ›å»ºäº†ä¸€ä¸ª REPL æœåŠ¡å™¨å®ä¾‹ï¼Œç„¶åé€šè¿‡è°ƒç”¨<code>turnOffEditorMode()</code>æ¥å…³é—­ç¼–è¾‘æ¨¡å¼ã€‚</p><p>ç„¶è€Œï¼Œåœ¨æ–°ç‰ˆçš„ Node.js ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ã€‚è¿™æ„å‘³ç€ Node.js çš„å¼€å‘å›¢é˜Ÿè®¤ä¸ºè¯¥æ–¹æ³•å·²ç»ä¸å†å¿…è¦æˆ–è€…å­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå»ºè®®å¼€å‘è€…ä¸è¦å†ä½¿ç”¨å®ƒï¼Œå› ä¸ºåœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å®ƒå¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>ä½œä¸ºæ›¿ä»£ï¼Œä½ æ— éœ€æ‰‹åŠ¨å¼€å¯æˆ–å…³é—­ç¼–è¾‘æ¨¡å¼ã€‚Node.js çš„ REPL ç¯å¢ƒåœ¨æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¼šæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œä½ å¯ä»¥ç›´æ¥è¾“å…¥å¤šè¡Œä»£ç ï¼Œå¹¶ä¸”ä½¿ç”¨é”®ç›˜ä¸Šä¸‹é”®æ¥æµè§ˆå†å²å‘½ä»¤æˆ–è€…ä¿®æ”¹å½“å‰å‘½ä»¤ã€‚</p><p>å¦‚æœä½ æ­£åœ¨å­¦ä¹  Node.jsï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ é€šå¸¸ä¸éœ€è¦æ‹…å¿ƒ<code>turnOffEditorMode()</code>æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨ REPL å¹¶äº«å—å…¶é»˜è®¤æä¾›çš„åŠŸèƒ½å³å¯ã€‚å¦‚æœä½ åœ¨æŸ¥çœ‹ä¸€äº›è¾ƒè€çš„ä»£ç æˆ–æ•™ç¨‹ï¼Œçœ‹åˆ°äº†è¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨ï¼ŒçŸ¥é“å®ƒç°åœ¨è¢«åºŸå¼ƒå¹¶ä¸”ä¸å†æ¨èä½¿ç”¨ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä¸éœ€è¦å¯¹å…¶è¿›è¡Œæ›¿æ¢æˆ–å¯»æ‰¾å…¶ä»–è§£å†³æ–¹æ¡ˆï¼ŒREPL çš„ä½¿ç”¨å˜å¾—æ›´åŠ ç®€æ´ç›´æ¥äº†ã€‚</p><h3 id="dep0079-custom-inspection-function-on-objects-via-inspect" tabindex="-1"><a class="header-anchor" href="#dep0079-custom-inspection-function-on-objects-via-inspect"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0079" target="_blank" rel="noopener noreferrer">DEP0079: Custom inspection function on objects via .inspect()</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šå°½é‡é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œâ€œDEP0079â€æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šä»£ç ï¼Œå®ƒæ ‡å¿—ç€<code>util.inspect.custom</code>åŠŸèƒ½æ›¿ä»£äº†å¯¹è±¡è‡ªå®šä¹‰æ£€æŸ¥å‡½æ•°<code>.inspect()</code>çš„ä½¿ç”¨ã€‚è®©æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯å¼ƒç”¨ï¼ˆDeprecationï¼‰ï¼Ÿ<br> åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–è€… API ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å°†æ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šç§»é™¤æ­¤åŠŸèƒ½æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œå¼ƒç”¨â€ã€‚å¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨è¢«å¼ƒç”¨çš„åŠŸèƒ½ï¼Œå¹¶è¿ç§»åˆ°æ¨èçš„æ–°æ–¹æ³•ã€‚</p><p>é‚£ä¹ˆï¼Œ<code>util.inspect()</code>æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ<br> Node.js ä¸­çš„<code>util.inspect()</code>å‡½æ•°ç”¨äºå°†ä»»ä½• JavaScript å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œä½¿å¾—å¯¹è±¡æ–¹ä¾¿é˜…è¯»å’Œè°ƒè¯•ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦åœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ºä¸€ä¸ªå¯¹è±¡çš„å†…å®¹ï¼Œ<code>util.inspect()</code>å°±å¯ä»¥å¸®åŠ©ä½ ä»¥ä¸€ç§æ›´æ˜“äºç†è§£çš„æ–¹å¼å±•ç¤ºå¯¹è±¡ç»“æ„ã€‚</p><p>æ—§çš„<code>.inspect()</code>æ–¹æ³•ï¼š<br> åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æƒ³è¦è‡ªå®šä¹‰æŸä¸ªå¯¹è±¡çš„<code>util.inspect()</code>è¾“å‡ºï¼Œä½ å¯èƒ½ä¼šåœ¨è¿™ä¸ªå¯¹è±¡ä¸Šç›´æ¥æ·»åŠ ä¸€ä¸ª<code>.inspect()</code>æ–¹æ³•ã€‚çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  purpose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JavaScript runtime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  inspect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Name: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, Purpose: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">purpose</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">inspect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡<code>myObject</code>å¹¶ç»™å®ƒå®šä¹‰äº†ä¸€ä¸ª<code>.inspect()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ã€‚å½“æˆ‘ä»¬ç”¨<code>util.inspect(myObject)</code>æ‰“å°è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œå®ƒå°†ä½¿ç”¨æˆ‘ä»¬æä¾›çš„<code>.inspect()</code>æ–¹æ³•çš„è¿”å›å€¼ã€‚</p><p>å¼ƒç”¨çš„åŸå› ï¼š<br> ç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰<code>.inspect()</code>æ–¹æ³•æœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š</p><ol><li>å¯èƒ½ä¸å¯¹è±¡æœ¬èº«çš„å…¶ä»–å±æ€§æˆ–è¡Œä¸ºå†²çªã€‚</li><li>å¦‚æœ Node.js æ›´æ”¹äº†å†…ç½®çš„<code>util.inspect()</code>çš„è¡Œä¸ºï¼Œå®ƒå¯èƒ½ä¼šç ´åä½ çš„ä»£ç ã€‚</li></ol><p>æ–°çš„<code>util.inspect.custom</code>ï¼š<br> ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒNode.js å¼•å…¥äº†<code>Symbol</code>ç±»å‹çš„<code>util.inspect.custom</code>ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„ç¬¦å·ï¼Œå¯ä»¥ç”¨ä½œæ–¹æ³•åç§°ï¼Œä»¥ä¾¿è‡ªå®šä¹‰<code>util.inspect()</code>çš„è¾“å‡ºï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰<code>.inspect()</code>æ–¹æ³•ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨<code>util.inspect.custom</code>çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  purpose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JavaScript runtime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">inspect</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">.custom</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">depth</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Name: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, Purpose: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">purpose</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">inspect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ–°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>[util.inspect.custom]</code>æ¥å®šä¹‰è‡ªå®šä¹‰çš„æ£€æŸ¥æ–¹æ³•ã€‚æ³¨æ„åˆ°æˆ‘ä»¬å°†æ–¹æ³•åæ¢æˆäº†<code>util.inspect.custom</code>ï¼Œè¿™æ ·åšæ›´åŠ å®‰å…¨ï¼Œä¸ä¼šè·Ÿå¯¹è±¡çš„å…¶ä»–å±æ€§æˆ–æ–¹æ³•å†²çªï¼Œå¹¶ä¸”å¯¹æœªæ¥çš„<code>util.inspect()</code>è¡Œä¸ºå˜åŒ–ä¹Ÿæœ‰æ›´å¥½çš„å…¼å®¹æ€§ã€‚</p><p>æ€»ç»“ï¼š<br> ç®€å•æ¥è¯´ï¼ŒNode.js v21.7.1 ä¸­çš„ DEP0079 æ˜¯å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸åº”è¯¥å†ç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰<code>.inspect()</code>æ–¹æ³•æ¥è‡ªå®šä¹‰<code>util.inspect()</code>çš„è¾“å‡ºäº†ã€‚ç›¸åï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨<code>util.inspect.custom</code>ç¬¦å·æ¥å®ç°ç›¸åŒçš„ç›®çš„ã€‚è¿™æ ·åšä½¿å¾—ä»£ç æ›´åŠ å¹²å‡€ï¼Œå¹¶ä¸”é¿å…äº†æœªæ¥æ½œåœ¨çš„å†²çªå’Œé—®é¢˜ã€‚</p><h3 id="dep0080-path-makelong" tabindex="-1"><a class="header-anchor" href="#dep0080-path-makelong"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0080" target="_blank" rel="noopener noreferrer">DEP0080: path._makeLong()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;DEP0080&quot;æ˜¯æŒ‡ä¸€é¡¹åºŸå¼ƒè­¦å‘Šï¼Œå®ƒå…³è”ç€<code>path._makeLong()</code>è¿™ä¸ª API çš„ä½¿ç”¨ã€‚æ‰€è°“çš„â€œåºŸå¼ƒâ€(deprecation)ï¼Œå°±æ„å‘³ç€è¿™ä¸ªåŠŸèƒ½æˆ–è€…æ–¹æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p><code>path._makeLong()</code>è¿™ä¸ªå‡½æ•°æ˜¯ Node.js å†…éƒ¨ä½¿ç”¨çš„ï¼Œå®ƒçš„ç›®çš„æ˜¯ä¸ºäº†æŠŠä¸€ä¸ªæ™®é€šçš„æ–‡ä»¶è·¯å¾„è½¬æ¢ä¸ºä¸€ä¸ªâ€œé•¿è·¯å¾„â€ã€‚åœ¨ Windows æ“ä½œç³»ç»Ÿä¸­ï¼Œé•¿è·¯å¾„æ˜¯æŒ‡è¶…å‡ºå¸¸è§„é•¿åº¦é™åˆ¶ï¼ˆé€šå¸¸æ˜¯ 260 ä¸ªå­—ç¬¦ï¼‰çš„è·¯å¾„ã€‚é€šè¿‡ä½¿ç”¨ç‰¹å®šçš„å‰ç¼€ï¼ˆæ¯”å¦‚<code>\\?\</code>ï¼‰ï¼ŒWindows å¯ä»¥å¤„ç†è¿™äº›é•¿è·¯å¾„ã€‚</p><p>ç„¶è€Œï¼Œå¯¹äº Node.js å¼€å‘è€…æ¥è¯´ï¼Œè¿™ä¸ªå‡½æ•°ä»ä¸åº”è¯¥ç›´æ¥è¢«ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå†…éƒ¨çš„ã€æœªå…¬å¼€æ–‡æ¡£çš„ APIã€‚Node.js çš„å¼€å‘å›¢é˜Ÿå†³å®šåºŸå¼ƒå®ƒï¼Œè¿™æ„å‘³ç€ä»–ä»¬å¸Œæœ›å¼€å‘è€…ä¸è¦åœ¨ä»–ä»¬çš„ä»£ç ä¸­ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨å…¶ä»–çš„å…¬å¼€å’Œæ”¯æŒçš„ APIã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¦‚æœæœ‰äººé”™è¯¯åœ°ä½¿ç”¨äº†<code>path._makeLong()</code>è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ–°ç‰ˆæœ¬ä¸­å·²ç»åºŸå¼ƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> longPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">_makeLong</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;C:</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">some</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>_makeLong</code>å‡½æ•°è¢«ç”¨äºå°†ç»™å®šçš„è·¯å¾„è½¬åŒ–æˆé•¿è·¯å¾„æ ¼å¼ã€‚ä½†ç°åœ¨ï¼Œç”±äº<code>_makeLong</code>è¢«åºŸå¼ƒï¼Œé‚£ä¹ˆå¼€å‘è€…éœ€è¦å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œå¼€å‘è€…åº”è¯¥ç”¨å…¬å…± API æ¥å¤„ç†è·¯å¾„ç›¸å…³çš„é—®é¢˜ï¼ŒNode.js çš„<code>path</code>æ¨¡å—æä¾›äº†å¾ˆå¤šè¿™æ ·çš„æ–¹æ³•ï¼Œæ¯”å¦‚<code>path.resolve()</code>ã€<code>path.join()</code>ç­‰ï¼Œç”¨æ¥å®‰å…¨åœ°å¤„ç†å’Œè½¬æ¢æ–‡ä»¶è·¯å¾„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œä½¿ç”¨å…¬å¼€çš„APIå¤„ç†è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> normalizedPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;C:</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">some</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>path.resolve</code>ä¼šå°†ç»™å®šçš„è·¯å¾„å‚æ•°è§£ææˆç»å¯¹è·¯å¾„ï¼Œè¿™é€šå¸¸ä¹Ÿèƒ½æ»¡è¶³å¤§å¤šæ•°åœºæ™¯ä¸‹å¯¹è·¯å¾„å¤„ç†çš„éœ€æ±‚ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>DEP0080: path._makeLong()</code>æ˜¯ä¸€ä¸ªåºŸå¼ƒçš„è­¦å‘Šï¼Œå‘Šè¯‰å¼€å‘è€…ä¸åº”å†ä½¿ç”¨è¿™ä¸ªå†…éƒ¨å‡½æ•°ã€‚åœ¨ 21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ çœ‹åˆ°è¿™ä¸ªè­¦å‘Šï¼Œè¯´æ˜ä½ çš„ä»£ç æˆ–è€…ä¾èµ–çš„æŸä¸ª npm åŒ…é‡Œä½¿ç”¨äº†è¿™ä¸ªä¸æ¨èçš„æ–¹æ³•ï¼Œä½ åº”è¯¥æ›´æ–°é‚£éƒ¨åˆ†ä»£ç ï¼Œé¿å…åœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚</p><h3 id="dep0081-fs-truncate-using-a-file-descriptor" tabindex="-1"><a class="header-anchor" href="#dep0081-fs-truncate-using-a-file-descriptor"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0081" target="_blank" rel="noopener noreferrer">DEP0081: fs.truncate() using a file descriptor</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>fs</code>æ¨¡å—æ˜¯ç”¨æ¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œå®ƒæä¾›äº†è®¸å¤šæ–¹æ³•ä»¥ç¼–ç¨‹æ–¹å¼è¯»å†™æ–‡ä»¶ã€åˆ›å»ºç›®å½•ç­‰ã€‚åœ¨<code>fs</code>æ¨¡å—ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º<code>truncate()</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºç¼©çŸ­æˆ–æ‰©å±•ä¸€ä¸ªæ–‡ä»¶çš„é•¿åº¦ï¼Œå¦‚æœæ–‡ä»¶é•¿åº¦è¢«ç¼©çŸ­ï¼Œè¶…å‡ºæ–°é•¿åº¦çš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼›å¦‚æœæ–‡ä»¶è¢«æ‰©å±•ï¼Œåˆ™æ–°å¢çš„éƒ¨åˆ†ä¼šè¢«å¡«å……ä¸º null å­—èŠ‚ï¼ˆå³<code>\0</code>ï¼‰ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>fs.truncate()</code>æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ–è€…ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä½œä¸ºå…¶å‚æ•°ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªæ•°å€¼æ ‡è¯†ï¼Œä»£è¡¨äº†ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œå®ƒæ˜¯é€šè¿‡<code>fs.open()</code>ç­‰æ–¹æ³•è·å¾—çš„ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸º<code>fs.truncate()</code>æ–¹æ³•çš„å‚æ•°è¢«æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼ˆå³&quot;deprecated&quot;ï¼‰ã€‚è¿™æ„å‘³ç€æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šåˆ é™¤è¿™ç§ç”¨æ³•ï¼Œé¼“åŠ±å¼€å‘è€…æ”¹ç”¨æ–°çš„æ–¹æ³•ã€‚</p><p><strong>ä¸¾ä¾‹è¯´æ˜ï¼š</strong></p><p>åœ¨è¿‡å»ï¼Œä½ å¯èƒ½ä¼šå†™å¦‚ä¸‹ä»£ç æ¥æˆªæ–­æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è·å–æ–‡ä»¶æè¿°ç¬¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r+&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥æˆªæ–­æ–‡ä»¶åˆ°å‰10ä¸ªå­—èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">truncate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶æˆªæ–­æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†ç”±äºæ–°çš„ç‰ˆæœ¬ä¸­è¿™ç§ç”¨æ³•è¢«å¼ƒç”¨ï¼Œä½ åº”è¯¥ä½¿ç”¨æ–‡ä»¶è·¯å¾„æ¥è°ƒç”¨<code>fs.truncate()</code>ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ–‡ä»¶è·¯å¾„ç›´æ¥æˆªæ–­æ–‡ä»¶åˆ°å‰10ä¸ªå­—èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">truncate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶æˆªæ–­æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ–‡ä»¶è·¯å¾„ä»£æ›¿æ–‡ä»¶æè¿°ç¬¦æ¥æˆªæ–­æ–‡ä»¶ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä»£ç æ›´ç®€æ´ï¼Œä¹Ÿæ›´å®¹æ˜“ç†è§£ã€‚è€Œä¸”ï¼Œç”±äºæ–‡ä»¶æè¿°ç¬¦æ˜¯åº•å±‚èµ„æºï¼Œç®¡ç†èµ·æ¥ç›¸å¯¹å¤æ‚ï¼Œä½¿ç”¨è·¯å¾„å¯ä»¥å‡å°‘é”™è¯¯å’Œå†…å­˜æ³„æ¼çš„é£é™©ã€‚</p><p>æ€»ä¹‹ï¼Œå»ºè®®ä½ åœ¨ç°æœ‰å’Œæœªæ¥çš„é¡¹ç›®ä¸­éµå¾ª Node.js çš„æœ€æ–°å®è·µï¼Œé€æ¸æ”¾å¼ƒä½¿ç”¨å·²ç»å¼ƒç”¨çš„åŠŸèƒ½ã€‚è¿™æ ·åšä¸ä»…èƒ½ç¡®ä¿ä½ çš„ä»£ç åº“æ›´æ–°ï¼Œè¿˜èƒ½é¿å…å°†æ¥è½¯ä»¶å‡çº§æ—¶å‡ºç°é—®é¢˜ã€‚</p><h3 id="dep0082-replserver-prototype-memory" tabindex="-1"><a class="header-anchor" href="#dep0082-replserver-prototype-memory"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0082" target="_blank" rel="noopener noreferrer">DEP0082: REPLServer.prototype.memory()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒéå¸¸é€‚åˆæ„å»ºå¿«é€Ÿçš„ã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œéšç€ç‰ˆæœ¬çš„æ›´æ–°ï¼Œæœ‰äº›åŠŸèƒ½ä¼šè¢«å¼ƒç”¨ï¼ˆDeprecationï¼‰ã€‚å¼ƒç”¨æ„å‘³ç€è¿™ä¸ªåŠŸèƒ½å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–æ›¿æ¢ï¼Œå› æ­¤å»ºè®®å¼€å‘è€…åœæ­¢ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¹¶è¿ç§»åˆ°æ–°çš„æ–¹æ³•æˆ–æ¨¡å—ä¸Šã€‚</p><p><code>DEP0082</code>æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šçš„ç¼–å·ï¼Œå®ƒå¯¹åº”äº<code>REPLServer.prototype.memory()</code>æ–¹æ³•ã€‚REPL ä»£è¡¨â€œRead-Eval-Print Loopâ€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„äº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒã€‚å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ<code>node</code>ä¸å¸¦ä»»ä½•å‚æ•°æ—¶ï¼Œå°±ä¼šè¿›å…¥åˆ° REPL ç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥è¾“å…¥ JavaScript ä»£ç å¹¶ç«‹å³å¾—åˆ°æ‰§è¡Œç»“æœã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>REPLServer.prototype.memory()</code>æ˜¯ <code>REPLServer</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨åŸæœ¬æ˜¯ç”¨æ¥æ˜¾ç¤ºæœ€è¿‘è¾“å…¥çš„å‘½ä»¤å†å²è®°å½•çš„ã€‚å®ƒå…è®¸å¼€å‘è€…æŸ¥çœ‹å¹¶é‡æ–°æ‰§è¡Œä¹‹å‰åœ¨ REPL ä¼šè¯ä¸­å°è¯•è¿‡çš„ä»£ç ç‰‡æ®µã€‚ç„¶è€Œï¼Œç”±äºæŸäº›åŸå› æ¯”å¦‚æ€§èƒ½é—®é¢˜ã€å®‰å…¨æ€§è€ƒè™‘ã€æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆç­‰ï¼ŒNode.js å›¢é˜Ÿå†³å®šå¼ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„ Node.js REPL ä¸­ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨<code>memory()</code>å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯åŠ¨REPL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> node</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">help</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„ç‰¹æ®Šå‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">undefined</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">undefined</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">memory</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // è°ƒç”¨å·²å¼ƒç”¨çš„æ–¹æ³•æ˜¾ç¤ºå‘½ä»¤å†å²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;var a = 1;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;var b = 2;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ è¯•å›¾ä½¿ç”¨<code>.memory</code>å‘½ä»¤ï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œé€šçŸ¥ä½ è¿™ä¸ªæŒ‡ä»¤å·²ç»ä¸å†æ”¯æŒï¼Œå¹¶ä¸”å°†æ¥çš„ç‰ˆæœ¬ä¸­ä¼šè¢«ç§»é™¤ã€‚</p><p>è¦å¤„ç†è¿™ç§å¼ƒç”¨ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œä½ åº”è¯¥æ‰¾å‡º Node.js çš„æ–‡æ¡£æˆ–è€…å˜æ›´æ—¥å¿—ä¸­æ¨èçš„æ–°æ–¹æ³•æˆ–è€…å·¥å…·æ¥å–ä»£<code>REPLServer.prototype.memory()</code>ã€‚åœ¨ REPL ä¸­ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ å¯ä»¥é€šè¿‡å‘ä¸Šçš„ç®­å¤´é”®ï¼ˆâ†‘ï¼‰æ¥æµè§ˆä¹‹å‰è¾“å…¥çš„å‘½ä»¤ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„æ–¹æ³•æ¥å›é¡¾å’Œé‡å¤æ‰§è¡Œä¹‹å‰çš„å‘½ä»¤ã€‚è€Œå¯¹äºæ›´é«˜çº§çš„å‘½ä»¤å†å²ç®¡ç†ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æˆ–è€…ç­‰å¾… Node.js æä¾›æ–°çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><p>æ€»ä¹‹ï¼Œäº†è§£å¼ƒç”¨ä¿¡æ¯æ˜¯ç»´æŠ¤ç°ä»£è½¯ä»¶é¡¹ç›®çš„é‡è¦éƒ¨åˆ†ã€‚å½“ä½ çœ‹åˆ°ç±»ä¼¼<code>DEP0082</code>è¿™æ ·çš„è­¦å‘Šæ—¶ï¼Œä½ åº”è¯¥åŠæ—¶å…³æ³¨ç›¸å…³å˜æ›´ï¼Œå¹¶æ ¹æ®å¼€å‘ç¤¾åŒºå’Œæ–‡æ¡£æä¾›çš„æŒ‡å¯¼æ¥è°ƒæ•´ä½ çš„ä»£ç ã€‚</p><h3 id="dep0083-disabling-ecdh-by-setting-ecdhcurve-to-false" tabindex="-1"><a class="header-anchor" href="#dep0083-disabling-ecdh-by-setting-ecdhcurve-to-false"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0083" target="_blank" rel="noopener noreferrer">DEP0083: Disabling ECDH by setting ecdhCurve to false</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><strong>Node.js</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚</li><li>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œç‰¹åˆ«æ˜¯ HTTPSï¼ˆåŠ å¯†çš„ HTTPï¼‰ï¼Œéœ€è¦ç”¨åˆ°ä¸€ç§å«ä½œ<strong>ECDHï¼ˆElliptic Curve Diffie-Hellmanï¼‰</strong> çš„ç®—æ³•æ¥å®‰å…¨åœ°åœ¨ä¸¤ç«¯ï¼ˆæ¯”å¦‚ä½ çš„æµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ï¼‰ä¹‹é—´äº¤æ¢å¯†é’¥ä¿¡æ¯ã€‚</li><li><strong>ecdhCurve</strong> æ˜¯ Node.js ä¸­ç”¨äºæŒ‡å®šä½¿ç”¨å“ªç§æ¤­åœ†æ›²çº¿ç®—æ³•çš„ä¸€ä¸ªå‚æ•°ã€‚</li></ol><p>ç°åœ¨ï¼Œå½“ä½ çœ‹åˆ° <strong>DEP0083</strong> è¿™ç§å½¢å¼çš„æ ‡è®°ï¼Œè¿™è¡¨æ˜è¿™æ˜¯ Node.js å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€ä¸ªâ€œå¼ƒç”¨â€ï¼ˆDeprecationï¼‰è­¦å‘Šã€‚ç®€å•æ¥è¯´ï¼Œ&quot;å¼ƒç”¨&quot;æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ– API ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œè€Œä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œæˆ–è€…åŸæœ‰æ–¹å¼å­˜åœ¨å®‰å…¨é—®é¢˜ç­‰åŸå› ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ <strong>DEP0083</strong> æŒ‡å‡ºçš„å°±æ˜¯ï¼šé€šè¿‡å°† <code>ecdhCurve</code> è®¾ç½®ä¸º <code>false</code> æ¥ç¦ç”¨ ECDH çš„åšæ³•å·²ç»è¢«å¼ƒç”¨ã€‚</p><p>å®é™…åº”ç”¨çš„ä¾‹å­ï¼š</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¦‚æœä½ æƒ³è¦åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ ä¸æƒ³ä½¿ç”¨ä»»ä½• ECDH ç®—æ³•ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å†™ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç§é’¥æ–‡ä»¶è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯ä¹¦æ–‡ä»¶è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ecdhCurve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œè¯•å›¾ç¦ç”¨ ECDH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè®¾ç½® <code>ecdhCurve</code> ä¸º <code>false</code> å°±æ˜¯å°è¯•ç¦ç”¨ ECDH ç®—æ³•çš„åšæ³•ã€‚ä½†åœ¨æ–°ç‰ˆ Node.js ä¸­ï¼Œè¿™ç§åšæ³•è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œå› æ­¤è¢«å®˜æ–¹æ ‡è®°ä¸ºå¼ƒç”¨ã€‚</p><p>åœ¨æ–°çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ éœ€è¦é…ç½® ECDH ç›¸å…³çš„é€‰é¡¹ï¼Œå®˜æ–¹å»ºè®®ç›´æ¥æŒ‡å®šä½ å¸Œæœ›ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿åç§°ï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç§é’¥æ–‡ä»¶è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯ä¹¦æ–‡ä»¶è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ecdhCurve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;prime256v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„åšæ³•ï¼šæŒ‡å®šä¸€ä¸ªå…·ä½“çš„æ›²çº¿åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>prime256v1</code> æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ï¼Œæä¾›äº†è‰¯å¥½çš„å®‰å…¨æ€§å’Œæ€§èƒ½å¹³è¡¡ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>DEP0083</strong> è¿™ä¸ªå¼ƒç”¨è­¦å‘Šå‘Šè¯‰æˆ‘ä»¬ï¼Œä¸åº”è¯¥é€šè¿‡è®¾ç½® <code>ecdhCurve</code> ä¸º <code>false</code> æ¥ç¦ç”¨ ECDH ç®—æ³•ã€‚ç›¸åï¼Œåº”è¯¥æŒ‡å®šä¸€ä¸ªå…·ä½“çš„æ¤­åœ†æ›²çº¿åç§°ä»¥ç¡®ä¿å®‰å…¨ä¸”é«˜æ•ˆçš„å¯†é’¥äº¤æ¢è¿‡ç¨‹ã€‚</p><h3 id="dep0084-requiring-bundled-internal-dependencies" tabindex="-1"><a class="header-anchor" href="#dep0084-requiring-bundled-internal-dependencies"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0084" target="_blank" rel="noopener noreferrer">DEP0084: requiring bundled internal dependencies</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ DEP0084 è¿™ä¸ªå¼ƒç”¨ï¼ˆdeprecationï¼‰è­¦å‘Šã€‚é¦–å…ˆæˆ‘ä»¬å…ˆç†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>ï¼šä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>Deprecationï¼ˆå¼ƒç”¨ï¼‰</strong>ï¼šæŒ‡çš„æ˜¯æŸäº›åŠŸèƒ½ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚é€šå¸¸è¿™æ ·åšæ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆæˆ–è€…åŸæ¥çš„è®¾è®¡è¢«è®¤ä¸ºæ˜¯é”™è¯¯çš„ã€‚</li><li><strong>Bundled internal dependenciesï¼ˆæ‰“åŒ…å†…éƒ¨ä¾èµ–ï¼‰</strong>ï¼šNode.js å†…éƒ¨æœ‰å¾ˆå¤šæ¨¡å—å’ŒåŠŸèƒ½ï¼Œè¿™äº›æ¨¡å—è¢«ç§°ä½œâ€œå†…éƒ¨ä¾èµ–â€ã€‚å®ƒä»¬é€šå¸¸åªèƒ½åœ¨ Node.js çš„å†…éƒ¨ä½¿ç”¨ï¼Œè€Œä¸å¯¹å¤–æš´éœ²ç»™æ™®é€šçš„ç”¨æˆ·ä»£ç ã€‚</li></ol><p>å…·ä½“åˆ° DEP0084 è¿™ä¸ªè­¦å‘Šï¼Œå®ƒçš„å…¨åæ˜¯ï¼šâ€œrequiring bundled internal dependenciesâ€ï¼Œæ„æ€æ˜¯åœ¨ä½ çš„ä»£ç ä¸­ç›´æ¥<code>require()</code>ï¼ˆå³å¯¼å…¥ï¼‰ä¸€ä¸ª Node.js å†…éƒ¨æ¨¡å—æ˜¯è¢«å¼ƒç”¨çš„è¡Œä¸ºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰äº›æ¨¡å—æ˜¯ä¸“é—¨ä¸º Node.js çš„å†…éƒ¨ä½¿ç”¨å‡†å¤‡çš„ï¼Œæ¯”å¦‚è¯¸å¦‚<code>http</code>, <code>fs</code>ç­‰æ¨¡å—èƒŒåçš„ä¸€äº›åº•å±‚å·¥å…·ã€‚è¿™äº›å†…éƒ¨æ¨¡å—å¹¶ä¸åœ¨ Node.js çš„å…¬å¼€ API ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™åº”ç”¨ç¨‹åºæ—¶å¹¶ä¸ä¼šç›´æ¥ç”¨åˆ°å®ƒä»¬ã€‚</p><p>ç„¶è€Œï¼Œä¸€äº›å¼€å‘è€…ä¸ºäº†å®ç°ç‰¹å®šçš„åŠŸèƒ½ï¼Œå¯èƒ½ä¼šå°è¯•é€šè¿‡ç‰¹æ®Šè·¯å¾„å¯¼å…¥è¿™äº›å†…éƒ¨æ¨¡å—ï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ &#39;_http_agent&#39; æ˜¯ Node.js å†…éƒ¨çš„ä¸€ä¸ªæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> internalHttpAgent</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;internal/_http_agent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§åšæ³•æ˜¯ä¸è¢« Node.js å®˜æ–¹æ”¯æŒçš„ï¼Œå› ä¸ºå®ƒç ´åäº†æ¨¡å—çš„å°è£…æ€§ï¼Œä¸”å½“ Node.js æ›´æ–°æ—¶ï¼Œè¿™äº›å†…éƒ¨æ¨¡å—çš„ API å¯èƒ½ä¼šå˜åŠ¨ï¼Œä»è€Œé€ æˆä»£ç å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>é‚£ä¹ˆåœ¨ v21.7.1 ç‰ˆæœ¬ä¸­ï¼ŒNode.js æ˜ç¡®è¡¨ç¤ºå¼ƒç”¨è¿™ç§åšæ³•ï¼Œå¦‚æœä½ å°è¯•è¿™ä¹ˆåšï¼ŒNode.js å°†ä¼šæ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºä½ è¿™ä¹ˆåšæ˜¯ä¸å®‰å…¨çš„ï¼Œæœªæ¥å¯èƒ½ä¼šå®Œå…¨ä¸æ”¯æŒã€‚</p><p><strong>å®é™…ä¾‹å­</strong></p><ol><li><p><strong>æ­£ç¡®çš„åšæ³•</strong>ï¼šä½¿ç”¨ Node.js æä¾›çš„å…¬å…±æ¨¡å—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ http å…¬å…±æ¨¡å—</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>é”™è¯¯çš„åšæ³•</strong>ï¼ˆDEP0084 è­¦å‘Šçš„è§¦å‘ç‚¹ï¼‰ï¼šå°è¯•å¯¼å…¥ä¸€ä¸ª Node.js çš„å†…éƒ¨æ¨¡å—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> internalHttpAgent</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;internal/_http_agent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é”™è¯¯ï¼ä¸åº”è¯¥è¿™ä¹ˆåš</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>ä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œä½ é€šå¸¸ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå› ä¸ºä½ åº”è¯¥æ€»æ˜¯ä½¿ç”¨ Node.js å®˜æ–¹æ–‡æ¡£ä¸­æè¿°çš„æ¨¡å—å’Œæ–¹æ³•ã€‚å¦‚æœä½ çœ‹åˆ°ç±»ä¼¼çš„è­¦å‘Šå‡ºç°åœ¨ä½ çš„ä»£ç ä¸­ï¼Œæœ€å¥½æ˜¯å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„å®˜æ–¹ API æ¥æ›¿ä»£ä½ å½“å‰è¯•å›¾ä½¿ç”¨çš„å†…éƒ¨æ¨¡å—ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå¯¹ä½ æœ‰å¸®åŠ©ï¼</p><h3 id="dep0085-asynchooks-sensitive-api" tabindex="-1"><a class="header-anchor" href="#dep0085-asynchooks-sensitive-api"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0085" target="_blank" rel="noopener noreferrer">DEP0085: AsyncHooks sensitive API</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠèŠ Node.js ä¸­çš„ DEP0085 å¼ƒç”¨è­¦å‘Šï¼Œå®ƒæ˜¯å…³äº AsyncHooks æ•æ„Ÿ API çš„ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä¼šè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ AsyncHooksã€‚åœ¨ Node.js ä¸­ï¼Œå¼‚æ­¥æ“ä½œå¾ˆå¸¸è§ã€‚ä½ å¯èƒ½å·²ç»çŸ¥é“äº†åƒ setTimeoutã€setInterval è¿™æ ·çš„åŸºç¡€å¼‚æ­¥å‡½æ•°ï¼Œæˆ–è€…æ›´å¤æ‚çš„å¦‚ file system operationsã€database queries ç­‰ç­‰ã€‚AsyncHooks æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œå…è®¸å¼€å‘è€…é’©ï¼ˆhookï¼‰è¿›è¿™äº›å¼‚æ­¥äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™å°±æ„å‘³ç€ä½ å¯ä»¥åœ¨å¼‚æ­¥èµ„æºè¢«åˆ›å»ºã€é”€æ¯ä»¥åŠæœ‰å›è°ƒå‡½æ•°è¢«è§¦å‘æ—¶è·å¾—é€šçŸ¥ã€‚è¿™å¯¹äºç†è§£ä»£ç ä¸­çš„å¼‚æ­¥æ“ä½œæµç¨‹ã€æ„å»ºç›‘æ§å·¥å…·æˆ–è€…è¿½è¸ªæ€§èƒ½é—®é¢˜éå¸¸æœ‰ç”¨ã€‚</p><p>ç„¶è€Œï¼Œè¿™ä¸ª API è¢«è®¤ä¸ºæ˜¯ &quot;æ•æ„Ÿ&quot; çš„ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–è€…éš¾ä»¥è°ƒè¯•çš„é”™è¯¯ã€‚è¿™ä¹Ÿæ˜¯ Node.js å¼€å‘å›¢é˜Ÿå†³å®šå¼ƒç”¨æŸäº› AsyncHooks API åŠŸèƒ½çš„åŸå› ä¹‹ä¸€ã€‚</p><p>DEP0085 æŒ‡çš„æ˜¯åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œåœ¨ <code>async_hooks</code> æ¨¡å—ä¸­ä½¿ç”¨ <code>emitBefore</code> å’Œ <code>emitAfter</code> æ–¹æ³•å°†ä¸å†å—æ”¯æŒã€‚è¿™äº›æ–¹æ³•æœ¬æ¥è¢«ç”¨æ¥æ‰‹åŠ¨è§¦å‘å¼‚æ­¥äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä½†ç”±äºå®ƒä»¬çš„ä½¿ç”¨éœ€è¦éå¸¸è°¨æ…å’Œç²¾ç¡®ï¼Œé”™è¯¯åœ°ä½¿ç”¨å®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´æ··ä¹±å’Œæ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚</p><p>æ¢è¨€ä¹‹ï¼ŒNode.js è®¤ä¸ºå¤§å¤šæ•°åœºæ™¯ä¸‹å¼€å‘è€…ä¸åº”è¯¥ç›´æ¥æ“ä½œè¿™äº›åº•å±‚çš„é’©å­è°ƒç”¨ï¼Œè€Œæ˜¯åº”è¯¥ä¾èµ–äºæ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é”™è¯¯å’Œé£é™©ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p>æ€§èƒ½ç›‘æ§å·¥å…·ï¼šå‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªæ€§èƒ½ç›‘æ§å·¥å…·ï¼Œä½ å¸Œæœ›è·Ÿè¸ªæ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„è€—æ—¶ã€‚ä½ å¯èƒ½ä¼šç”¨åˆ° AsyncHooks æ¥è®°å½•æ¯ä¸ªå¼‚æ­¥èµ„æºåˆ›å»ºå’Œè§£æçš„æ—¶é—´ç‚¹ï¼Œä»è€Œè®¡ç®—å‡ºæ‰§è¡Œæ—¶é—´ã€‚</p></li><li><p>è¯·æ±‚è¿½è¸ªï¼šåœ¨æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯èƒ½æƒ³è¦è¿½è¸ªä¸€ä¸ªè¯·æ±‚é€šè¿‡å„ç§å¼‚æ­¥æ“ä½œçš„è·¯å¾„ã€‚é€šè¿‡ AsyncHooksï¼Œä½ å¯ä»¥ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¹¶åœ¨æ•´ä¸ªè¯·æ±‚çš„å¼‚æ­¥æ“ä½œä¸­ä¼ é€’è¿™ä¸ªæ ‡è¯†ç¬¦ï¼Œè¿™æ ·ä¾¿äºåç»­åˆ†ææ—¥å¿—æ—¶ç†è§£è¯·æ±‚æµç¨‹ã€‚</p></li></ol><p>ç”±äº DEP0085 çš„å­˜åœ¨ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„å·¥å…·åº”é¿å…ä½¿ç”¨å·²å¼ƒç”¨çš„ <code>emitBefore</code> å’Œ <code>emitAfter</code> æ–¹æ³•ï¼Œè€Œæ˜¯é€‰æ‹©å…¶ä»–æ–¹å¼æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€å˜åŒ–ï¼Œå»ºè®®æŸ¥çœ‹ Node.js å®˜æ–¹æ–‡æ¡£ä¸­å…³äº AsyncHooks çš„éƒ¨åˆ†ï¼ŒåŒæ—¶ç•™æ„ä»»ä½•æ›´æ–°ï¼Œå› ä¸º Node.js æœªæ¥ç‰ˆæœ¬å¯èƒ½ä¼šå¼•å…¥æ–°çš„æ–¹å¼æ¥æ›¿ä»£è¿™äº›å¼ƒç”¨çš„æ–¹æ³•ã€‚è®°ä½ï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ AsyncHooksï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´é«˜çº§çš„æŠ½è±¡åº“æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„è·Ÿè¸ªã€‚</p><h3 id="dep0086-remove-runinasyncidscope" tabindex="-1"><a class="header-anchor" href="#dep0086-remove-runinasyncidscope"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0086" target="_blank" rel="noopener noreferrer">DEP0086: Remove runInAsyncIdScope</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæ¯ä¸ªå¼‚æ­¥æ“ä½œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œç§°ä¸º &quot;asyncId&quot;ã€‚è¿™æ˜¯ Node.js å†…éƒ¨ç”¨æ¥è¿½è¸ªå¼‚æ­¥èµ„æºï¼ˆå¦‚å®šæ—¶å™¨ã€Promisesã€æœåŠ¡å™¨è¯·æ±‚ç­‰ï¼‰çš„æ–¹å¼ã€‚æ¯å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥äº‹ä»¶æ—¶ï¼ŒNode.js å°†åˆ†é…ä¸€ä¸ªæ–°çš„ <code>asyncId</code>ã€‚</p><p>ç°åœ¨ï¼Œå…³äºä½ é—®åˆ°çš„ DEP0086ï¼Œæˆ‘ä»¬éœ€è¦è°ˆè°ˆ <code>async_hooks</code> æ¨¡å—ï¼Œå®ƒæ˜¯ Node.js æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œå¯ä»¥è®©å¼€å‘è€…ç›‘æ§å¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>async_hooks</code> æ¨¡å—æš´éœ²äº†ä¸€ä¸ªæ–¹æ³•å«åš <code>runInAsyncIdScope(asyncId, callback)</code>ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª <code>asyncId</code> å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆ<code>callback</code>ï¼‰ã€‚ç„¶å Node.js ä¼šæ‰§è¡Œä½ æä¾›çš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”åœ¨æ‰§è¡ŒæœŸé—´ï¼Œä»»ä½•æ–°åˆ›å»ºçš„å¼‚æ­¥èµ„æºéƒ½ä¼šè®¤ä¸ºæ˜¯åœ¨æŒ‡å®šçš„ <code>asyncId</code> ä¸‹åˆ›å»ºçš„ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªåŠŸèƒ½å…è®¸ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†å¼‚æ­¥èµ„æºçš„ä¸Šä¸‹æ–‡ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ª <code>runInAsyncIdScope</code> æ–¹æ³•å·²ç»è¢«åºŸå¼ƒäº†ï¼ˆæ„æ€å°±æ˜¯å®ƒå°†è¢«ç§»é™¤ï¼Œä¸å†æ¨èä½¿ç”¨ï¼‰ã€‚åºŸå¼ƒçš„åŸå› å¯èƒ½åŒ…æ‹¬è¿™ä¸ªæ–¹æ³•å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œæˆ–è€…å®ƒå¼•å…¥äº†å¤æ‚æ€§ï¼Œä¹Ÿæœ‰å¯èƒ½å› ä¸ºå­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ä¸¾ä¸€ä¸ªå…·ä½“ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ¯å½“æ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œä½ å¸Œæœ›ä¿æŒè·Ÿè¸ªæ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚åœ¨æ—§çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>runInAsyncIdScope</code> æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;async_hooks&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> asyncId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">executionAsyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">runInAsyncIdScope</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ‰§è¡ŒæŸäº›å¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;SELECT * FROM table&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // è¿™é‡Œçš„å¼‚æ­¥æ“ä½œä¼šè¢«è§†ä¸ºåœ¨handleRequeståˆ›å»ºçš„asyncIdä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Databas</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">### [</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">DEP0089</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;node:assert&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)](</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//nodejs.org/docs/latest/api/deprecations.html#DEP0089)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">åœ¨</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Node</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">js</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ä¸­</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ï¼Œ</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`require(&#39;node:assert&#39;)`</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¸€ä¸ªæ–°çš„è§„èŒƒ</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ï¼Œ</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">å®ƒä½¿å¾—</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Node</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">js</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> æ ¸å¿ƒæ¨¡å—çš„å¯¼å…¥çœ‹èµ·æ¥æ›´åŠ æ˜ç¡®</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ã€‚</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">å½“ä½ åœ¨</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Node</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">js</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ä»£ç ä¸­éœ€è¦ä½¿ç”¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `assert`</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> æ¨¡å—æ—¶</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ï¼Œ</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ä¼ ç»Ÿä¸Šæˆ‘ä»¬ä¼šè¿™æ ·å†™</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">```javascript</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">const assert = require(&#39;assert&#39;);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶è€Œï¼Œåœ¨ Node.js çš„æ›´æ–°ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„è¯­æ³•ï¼Œå³å¸¦æœ‰ &#39;node:&#39; å‰ç¼€çš„å¯¼å…¥æ–¹å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‰ç¼€ &#39;node:&#39; è¡¨æ˜ä½ æ­£åœ¨æ˜¾å¼åœ°ä» Node.js çš„å†…ç½®æ¨¡å—ä¸­å¯¼å…¥ <code>assert</code>ï¼Œè€Œä¸æ˜¯ä»å¤–éƒ¨ä¾èµ–æˆ–è€…æŸä¸ªæœ¬åœ°æ–‡ä»¶ä¸­å¯¼å…¥ã€‚è¿™æœ‰åŠ©äºåŒºåˆ† Node.js å†…ç½®æ¨¡å—å’Œå…¶ä»–æ¨¡å—ï¼Œå¯ä»¥è®©ä»£ç é˜…è¯»èµ·æ¥æ›´æ¸…æ™°ã€‚</p><p>é‚£ä¹ˆï¼ŒDEP0089 æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼ŸDEP0089 æ˜¯ Node.js å®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šç¼–å·ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œå¦‚æœä½ å°è¯•ä½¿ç”¨ä¸å¸¦ &#39;node:&#39; å‰ç¼€çš„æ–¹å¼æ¥å¯¼å…¥æ ¸å¿ƒæ¨¡å—ï¼ˆä¾‹å¦‚ç›´æ¥ç”¨ <code>require(&#39;assert&#39;)</code>ï¼‰ï¼ŒNode.js å¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤è¿™ç§æ—§çš„å¯¼å…¥æ–¹å¼ï¼Œå¹¶ä¸”åœ¨å½“å‰ç‰ˆæœ¬ä¸­ç»™å‡ºå¼ƒç”¨è­¦å‘Šã€‚</p><p>è¿™æ˜¯ä¸ºäº†é¼“åŠ±å¼€å‘è€…éµå¾ªæ–°çš„å¯¼å…¥è§„èŒƒï¼Œä»¥ç¡®ä¿ä»£ç çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚è™½ç„¶æ—§çš„æ–¹å¼ç›®å‰ä»ç„¶å¯ç”¨ï¼Œä½†æœªæ¥å¯èƒ½ä¼šè¢«åºŸå¼ƒï¼Œå› æ­¤å»ºè®®å¼€å‘è€…å°½å¿«é€‚åº”æ–°çš„å¯¼å…¥è¯­æ³•ã€‚</p><p>å®é™…è¿ç”¨ä¸¾ä¾‹ï¼š</p><ol><li>æ–­è¨€æµ‹è¯•ï¼š<br> åœ¨ç¼–å†™æµ‹è¯•ä»£ç æ—¶ï¼Œä½ ç»å¸¸éœ€è¦ç¡®è®¤ä»£ç çš„è¡Œä¸ºç¬¦åˆé¢„æœŸã€‚Node.js çš„ <code>assert</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—çš„æ–­è¨€æµ‹è¯•åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æµ‹è¯• add å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">strictEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;2 åŠ  3 åº”è¯¥ç­‰äº 5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ‰€æœ‰æ–­è¨€éƒ½é€šè¿‡ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>assert.strictEqual</code> æ–¹æ³•æ¥æ£€æŸ¥ <code>add</code> å‡½æ•°çš„è¿”å›å€¼æ˜¯å¦ä¸é¢„æœŸçš„ç»“æœç›¸åŒ¹é…ã€‚</p><ol start="2"><li>ç¡®ä¿å˜é‡ç±»å‹ï¼š<br> å‡è®¾ä½ æƒ³ç¡®ä¿ä¸€ä¸ªå‡½æ•°åªæ¥å—æ•°å­—ç±»å‹çš„å‚æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>assert</code> çš„ç±»å‹æ£€æŸ¥åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> square</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‚æ•°å¿…é¡»æ˜¯æ•°å­—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">square</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£å¸¸æ‰§è¡Œ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  square</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;not a number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºå‚æ•°ä¸æ˜¯æ•°å­—ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ <code>square</code> å‡½æ•°çš„å‚æ•°ä¸æ˜¯æ•°å­—ç±»å‹ï¼Œ<code>assert</code> ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥æ•è·è¿™ä¸ªé”™è¯¯å¹¶æ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><p>æ€»ä¹‹ï¼Œä½¿ç”¨ <code>require(&#39;node:assert&#39;)</code> è€Œé <code>require(&#39;assert&#39;)</code> æ˜¯ Node.js ç¤¾åŒºæ¨èçš„æœ€æ–°å®è·µã€‚è¿™ä¸ä»…æœ‰åŠ©äºä»£ç çš„æ¸…æ™°åº¦ï¼Œè¿˜å¯ä»¥ä¿è¯ä½ çš„ä»£ç ä¸ Node.js çš„æœªæ¥ç‰ˆæœ¬å…¼å®¹ã€‚</p><h3 id="dep0090-invalid-gcm-authentication-tag-lengths" tabindex="-1"><a class="header-anchor" href="#dep0090-invalid-gcm-authentication-tag-lengths"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0090" target="_blank" rel="noopener noreferrer">DEP0090: Invalid GCM authentication tag lengths</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒåŠ å¯†æ¨¡å—ï¼ˆ<code>crypto</code>ï¼‰æä¾›äº†ä¸€ç³»åˆ—ç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®çš„åŠŸèƒ½ã€‚å½“ä½ ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¦‚ AES æ—¶ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹© GCMï¼ˆGalois/Counter Modeï¼‰ä½œä¸ºåŠ å¯†æ¨¡å¼ã€‚GCM æ¨¡å¼ä¸ä»…æä¾›åŠ å¯†ï¼Œè¿˜æä¾›äº†æ¶ˆæ¯è®¤è¯ï¼Œå³å¯ä»¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</p><p>åœ¨ GCM æ¨¡å¼ä¸‹ï¼Œé™¤äº†å¯†æ–‡å¤–ï¼Œè¿˜äº§ç”Ÿä¸€ä¸ªå«åšè®¤è¯æ ‡ç­¾ï¼ˆauthentication tagï¼‰çš„è¾“å‡ºï¼Œç”¨äºéªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚è¿™ä¸ªæ ‡ç­¾æœ‰ä¸€ä¸ªç‰¹å®šçš„é•¿åº¦è¦æ±‚ï¼Œè€Œè¿™ä¸ªé•¿åº¦ä¸ç¼–ç çš„å®‰å…¨æ€§ç›¸å…³ã€‚</p><p>DEP0090 æ˜¯ä¸€ä¸ªè­¦å‘Šï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬åœ¨ Node.js ä¸­ä½¿ç”¨<code>crypto</code>æ¨¡å—è¿›è¡Œ GCM åŠ å¯†æ—¶ï¼Œå…è®¸çš„è®¤è¯æ ‡ç­¾é•¿åº¦å·²ç»å˜æ›´äº†ã€‚ä¹‹å‰ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œä½ å¯èƒ½å¯ä»¥ä½¿ç”¨ä»»æ„é•¿åº¦çš„è®¤è¯æ ‡ç­¾ï¼Œä½†ä» Node.js v21.7.1 å¼€å§‹ï¼Œåªæœ‰ä»¥ä¸‹é•¿åº¦çš„è®¤è¯æ ‡ç­¾æ˜¯æœ‰æ•ˆçš„ï¼š128ã€120ã€112ã€104ã€96ã€‚å¦‚æœä½ å°è¯•ä½¿ç”¨ä¸åˆè§„çš„æ ‡ç­¾é•¿åº¦ï¼Œæ¯”å¦‚ 32 ä½æˆ– 64 ä½ï¼Œé‚£ä¹ˆä½ çš„ä»£ç å°†ä¸å†èµ·ä½œç”¨ï¼Œå¹¶ä¸”ä½ ä¼šæ”¶åˆ° DEP0090 çš„åºŸå¼ƒè­¦å‘Šã€‚</p><p>è¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p><ol><li><p><strong>æ­£ç¡®çš„è®¤è¯æ ‡ç­¾é•¿åº¦</strong>ï¼š<br> å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ GCM æ¨¡å¼å¯¹ä¸€äº›æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”æƒ³è¦ç”Ÿæˆä¸€ä¸ªå®‰å…¨çš„è®¤è¯æ ‡ç­¾ã€‚åœ¨ Node.js v21.7.1 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œä½ åº”è¯¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> algorithm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;aes-256-gcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> password</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯†ç åº”è¯¥æ˜¯éšæœºçš„å¹¶ä¸”è¶³å¤Ÿå®‰å…¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> salt</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”Ÿæˆç›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">scryptSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">salt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨scryptç®—æ³•ç”Ÿæˆå¯†é’¥</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> iv</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–å‘é‡åº”è¯¥æ˜¯éšæœºçš„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some clear text data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getAuthTag</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–æ­£ç¡®é•¿åº¦çš„è®¤è¯æ ‡ç­¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Encrypted: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Tag: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tag</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>getAuthTag()</code>æ–¹æ³•è¿”å›äº†ä¸€ä¸ªé»˜è®¤é•¿åº¦ä¸º 16 å­—èŠ‚ï¼ˆ128 ä½ï¼‰çš„è®¤è¯æ ‡ç­¾ï¼Œè¿™æ˜¯åˆæ³•çš„ã€‚</p></li><li><p><strong>é”™è¯¯çš„è®¤è¯æ ‡ç­¾é•¿åº¦ï¼ˆåœ¨æ–°ç‰ˆæœ¬ä¸­ï¼‰</strong>ï¼š<br> å¦‚æœä½ åœ¨è€ç‰ˆæœ¬çš„ Node.js ä»£ç é‡Œè®¾ç½®äº†ä¸€ä¸ªéæ ‡å‡†çš„è®¤è¯æ ‡ç­¾é•¿åº¦ï¼Œæ¯”å¦‚ 64 ä½ï¼Œé‚£ä¹ˆåœ¨ v21.7.1 ä¹‹åçš„ç‰ˆæœ¬ä¸­å°±ä¼šé‡åˆ°é—®é¢˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯è€ä»£ç ï¼Œç°åœ¨ä¸å†è¢«æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ...çœç•¥äº†å…¶ä»–åˆå§‹åŒ–ä»£ç ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setAuthTagLength</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†å¯¼è‡´DEP0090è­¦å‘Š</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ...çœç•¥äº†åŠ å¯†è¿‡ç¨‹...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>æ€»ç»“æ¥è¯´ï¼ŒDEP0090 å°±æ˜¯ä¸€ä¸ªå…³äº GCM è®¤è¯æ ‡ç­¾é•¿åº¦çš„è§„èŒƒæ›´æ–°ï¼Œå®ƒè¦æ±‚å¼€å‘è€…ä½¿ç”¨åˆæ³•çš„æ ‡ç­¾é•¿åº¦ä»¥ç¡®ä¿åŠ å¯†çš„å®‰å…¨æ€§ã€‚å¦‚æœä½ çš„ä»£ç ä¸­æœ‰ä½¿ç”¨åˆ°ä¸åˆæ³•é•¿åº¦çš„ GCM è®¤è¯æ ‡ç­¾ï¼Œä½ éœ€è¦æ›´æ–°å®ƒä»¬ä»¥é€‚é…æ–°çš„è§„èŒƒã€‚</p><h3 id="dep0091-crypto-default-encoding" tabindex="-1"><a class="header-anchor" href="#dep0091-crypto-default-encoding"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0091" target="_blank" rel="noopener noreferrer">DEP0091: crypto.DEFAULT_ENCODING</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>DEP0091</code>ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨è°ˆè®ºä¸€ä¸ªå®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œâ€œå¼ƒç”¨â€æ˜¯æŒ‡æŸä¸ªç‰¹æ€§æˆ–è€…å®è·µä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤çš„è¿‡ç¨‹ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œæˆ–è€…åŸæ¥çš„æ–¹æ³•å­˜åœ¨é—®é¢˜ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>DEP0091</code> å¼ƒç”¨äº† <code>crypto.DEFAULT_ENCODING</code> è¿™ä¸ªå±æ€§ã€‚<code>crypto</code> æ˜¯ Node.js å†…ç½®çš„æ¨¡å—ï¼Œç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>crypto.DEFAULT_ENCODING</code> å±æ€§ç”¨äºè®¾ç½®é»˜è®¤çš„ç¼–ç ç±»å‹ï¼Œæ¯”å¦‚åœ¨åŠ å¯†åå°†æ•°æ®è½¬æ¢æˆ&#39;hex&#39;ã€&#39;base64&#39;ç­‰æ ¼å¼ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨è¿‡å»ï¼Œå¦‚æœä½ æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¾“å‡ºçš„ç¼–ç æ–¹å¼ï¼ŒNode.js å°±ä¼šä½¿ç”¨ <code>crypto.DEFAULT_ENCODING</code> ä½œä¸ºé»˜è®¤å€¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­è®¾å®šé»˜è®¤ç¼–ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DEFAULT_ENCODING</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å…¥ä¸€äº›æ•°æ®è¿›è¡ŒåŠ å¯†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä½ å¥½, ä¸–ç•Œ!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°ç»“æœï¼Œé»˜è®¤ä½¿ç”¨hexç¼–ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼še7...ï¼ˆåå…­è¿›åˆ¶æ ¼å¼ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†è‡ªä» <code>DEP0091</code> è¢«å¼•å…¥åï¼Œè¿™ç§åšæ³•è¢«è§†ä¸ºè¿‡æ—¶ã€‚ç°åœ¨ï¼Œä½ åº”è¯¥ç›´æ¥åœ¨è°ƒç”¨ <code>.digest()</code> æ–¹æ³•æ—¶æŒ‡å®šç¼–ç æ–¹å¼ï¼Œè€Œä¸æ˜¯ä¾èµ–å…¨å±€çš„é»˜è®¤ç¼–ç è®¾ç½®ã€‚æ­£ç¡®çš„åšæ³•å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å…¥ä¸€äº›æ•°æ®è¿›è¡ŒåŠ å¯†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä½ å¥½, ä¸–ç•Œ!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//æ¥æºï¼šdoc.cherrychat.org è¯·å‹¿å•†ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜ç¡®æŒ‡å®šç¼–ç æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£ç¡®çš„åšæ³•ï¼Œè¾“å‡ºï¼še7...ï¼ˆåå…­è¿›åˆ¶æ ¼å¼ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“èµ·æ¥ï¼Œ<code>DEP0091</code> å‘Šè¯‰æˆ‘ä»¬ä¸å†ä½¿ç”¨ <code>crypto.DEFAULT_ENCODING</code> å…¨å±€è®¾ç½®é»˜è®¤ç¼–ç ï¼Œè€Œæ˜¯å»ºè®®ä½ åœ¨æ¯æ¬¡éœ€è¦ç¼–ç è¾“å‡ºæ—¶éƒ½æ˜ç¡®æŒ‡å®šç¼–ç ç±»å‹ã€‚è¿™æ ·å¯ä»¥é¿å…æ½œåœ¨çš„æ··æ·†å’Œé”™è¯¯ï¼Œæå‡ä»£ç çš„æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="dep0092-top-level-this-bound-to-module-exports" tabindex="-1"><a class="header-anchor" href="#dep0092-top-level-this-bound-to-module-exports"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0092" target="_blank" rel="noopener noreferrer">DEP0092: Top-level this bound to module.exports</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæ¥è§£é‡Šä¸€ä¸‹ Node.js å’Œè¿™ä¸ªç‰¹å®šçš„ DEP0092 è¿™ä¸ªå¼ƒç”¨è­¦å‘Šã€‚</p><p><strong>Node.js ç®€ä»‹</strong></p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼ŒJavaScript é€šå¸¸ç”¨äºæ·»åŠ äº¤äº’æ€§ï¼Œå¦‚å“åº”ç”¨æˆ·ç‚¹å‡»ç­‰ã€‚è€Œä½¿ç”¨ Node.jsï¼Œå¼€å‘è€…å¯ä»¥å»ºé€ æœåŠ¡å™¨ã€è®¿é—®æ•°æ®åº“ç­‰åç«¯ä»»åŠ¡ã€‚</p><p><strong>å…¨å±€å¯¹è±¡å’Œ this</strong></p><p>åœ¨ JavaScript ä¸­ï¼Œå…¨å±€å¯¹è±¡æ˜¯æœ€é¡¶å±‚çš„å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­è¿™ä¸ªå¯¹è±¡æ˜¯ <code>window</code>ï¼Œåœ¨ Node.js ä¸­åˆ™æ˜¯ <code>global</code>ã€‚æ— è®ºåœ¨å“ªé‡Œï¼Œä½ éƒ½å¯ä»¥è®¿é—®åˆ°å…¨å±€å¯¹è±¡çš„å±æ€§ã€‚</p><p>æ­¤å¤–ï¼ŒJavaScript ä¸­çš„ <code>this</code> å…³é”®å­—æ˜¯ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œå®ƒæŒ‡å‘å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„â€œæ‰€æœ‰è€…â€ã€‚åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚</p><p>ä½†æ˜¯ï¼Œå½“ä½ åœ¨ Node.js çš„æ¨¡å—ç³»ç»Ÿä¸­å·¥ä½œæ—¶ï¼Œæƒ…å†µæœ‰ç‚¹ä¸åŒã€‚æ¯ä¸ªæ¨¡å—å…¶å®éƒ½åŒ…è£¹åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œæ‰€ä»¥æ¨¡å—å†…éƒ¨æœ€é¡¶å±‚çš„ <code>this</code> ä¸æ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡ <code>global</code>ï¼Œè€Œæ˜¯æŒ‡å‘ <code>module.exports</code>ã€‚<code>module.exports</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒNode.js ä¸­ç”¨æ¥å¯¼å‡ºæ¨¡å—ä»¥ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚</p><p><strong>DEP0092 è­¦å‘Š</strong></p><p>ç°åœ¨è®²è§£ DEP0092 è¿™ä¸ªå¼ƒç”¨è­¦å‘Šã€‚è¿™æ˜¯ Node.js å›¢é˜Ÿç»™å‡ºçš„è­¦å‘Šç¼–å·ï¼Œè¡¨ç¤º Node.js å¼€å§‹å¼ƒç”¨æˆ–è®¡åˆ’å¼ƒç”¨æŸä¸ªåŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼ŒDEP0092 è­¦å‘ŠæŒ‡çš„æ˜¯åœ¨æ¨¡å—çš„é¡¶å±‚ä»£ç ä¸­ï¼Œ<code>this</code> å…³é”®å­—è¢«ç»‘å®šåˆ° <code>module.exports</code> è¿™ä¸€è¡Œä¸ºè¢«åºŸé™¤äº†ã€‚ç®€å•æ¥è¯´ï¼Œä»¥å‰åœ¨æ¨¡å—çš„æœ€é¡¶å±‚ï¼Œä½ å¯ä»¥é€šè¿‡ <code>this</code> æ·»åŠ æˆ–ä¿®æ”¹æ¨¡å—å¯¼å‡ºçš„å†…å®¹ï¼Œæœªæ¥è¿™å°†ä¸å†æ”¯æŒã€‚</p><p><strong>å®é™…ä¾‹å­</strong></p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º <code>math.js</code> çš„ç®€å• Node.js æ¨¡å—ï¼Œæˆ‘ä»¬æ‰“ç®—é€šè¿‡ <code>this</code> å‘å¤–ç•Œæš´éœ²ä¸€ä¸ªæ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// math.js (æ—§çš„æ–¹å¼ï¼Œå°†ä¼šä¸å†æ¨è)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ï¼Œå°† <code>add</code> å‡½æ•°æ·»åŠ åˆ°äº† <code>module.exports</code> å¯¹è±¡ä¸Šã€‚å› ä¸ºåœ¨è€ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œæ¨¡å—é¡¶å±‚çš„ <code>this</code> è¢«ç»‘å®šåˆ° <code>module.exports</code>ã€‚å¼€å‘è€…å¯ä»¥åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­è¿™æ ·ä½¿ç”¨ <code>math.js</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> math</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./math&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯æ ¹æ® DEP0092 çš„è­¦å‘Šï¼Œè¿™ç§ç”¨æ³•å°†è¢«åºŸå¼ƒã€‚æœªæ¥ï¼Œå¦‚æœä½ æƒ³è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œä½ åº”è¯¥æ˜ç¡®åœ°èµ‹å€¼ç»™ <code>exports</code> æˆ– <code>module.exports</code>ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// math.js (æ›´æ–°çš„ï¼Œæ¨èçš„æ–¹å¼)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç æ˜ç¡®åœ°æŠŠ <code>add</code> æ–¹æ³•æ·»åŠ åˆ°äº† <code>module.exports</code> ä¸Šï¼Œé¿å…ä½¿ç”¨ <code>this</code> å¹¶ä¸”æ›´åŠ æ¸…æ™°æ˜ç¡®ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0092 è­¦å‘Šæé†’å¼€å‘è€…ä»¬ï¼Œç›´æ¥åˆ©ç”¨é¡¶å±‚çš„ <code>this</code> ç»‘å®šå¯¼å‡ºçš„æ–¹å¼å³å°†è¢« Node.js å¼ƒç”¨ï¼Œè€Œåº”å½“é‡‡ç”¨æ˜ç¡®çš„ <code>exports</code> æˆ– <code>module.exports</code> æ¥å¯¼å‡ºæ¨¡å—å†…å®¹ã€‚è¿™ä¸ªæ”¹å˜æ—¨åœ¨ä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ï¼Œå¹¶æ¶ˆé™¤å¯èƒ½çš„æ··æ·†ã€‚</p><h3 id="dep0093-crypto-fips-is-deprecated-and-replaced" tabindex="-1"><a class="header-anchor" href="#dep0093-crypto-fips-is-deprecated-and-replaced"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0093" target="_blank" rel="noopener noreferrer">DEP0093: crypto.fips is deprecated and replaced</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>[DEP0093]</code> è¿™ä¸ªå¼ƒç”¨è­¦å‘Šã€‚</p><p>é¦–å…ˆï¼Œä¸ºäº†ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ææ¸…æ¥šå‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><p><strong>Node.js</strong>: è¿™æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„ JavaScript è¿è¡Œç¯å¢ƒã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</p></li><li><p><strong>crypto æ¨¡å—</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>crypto</code> æä¾›äº†åŒ…æ‹¬åŠ å¯†æŠ€æœ¯åœ¨å†…çš„å®‰å…¨ç›¸å…³çš„åŠŸèƒ½ã€‚</p></li><li><p><strong>FIPS</strong>: å…¨ç§°æ˜¯ Federal Information Processing Standardï¼ˆè”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡†ï¼‰ï¼Œè¿™æ˜¯ç¾å›½æ”¿åºœè®¡ç®—æœºç³»ç»Ÿå¸¸ç”¨çš„ä¸€å¥—æ ‡å‡†ï¼Œå…¶ä¸­åŒ…å«äº†è‹¥å¹²åŠ å¯†ç®—æ³•çš„è§„å®šï¼Œç”¨ä»¥ä¿éšœæ•°æ®å®‰å…¨ã€‚</p></li><li><p><strong>å¼ƒç”¨ (Deprecation)</strong>: åœ¨è½¯ä»¶é¢†åŸŸï¼Œå¦‚æœä¸€ä¸ªåŠŸèƒ½æˆ–è€…æ¥å£ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œæˆ‘ä»¬é€šå¸¸è¯´å®ƒè¢« â€œå¼ƒç”¨â€ (deprecated)ã€‚</p></li></ol><p>ç°åœ¨ï¼Œå…·ä½“åˆ°ä½ é—®çš„é—®é¢˜ï¼Œ<code>[DEP0093]</code> æ˜¯ Node.js å®˜æ–¹å‘å¸ƒçš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œè¡¨ç¤º <code>crypto.fips</code> å±æ€§å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨å¹¶ç”±å…¶ä»–æ–¹å¼æ›¿ä»£ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>crypto.fips</code> å¯ä»¥ç”¨æ¥æ£€æŸ¥æˆ–è®¾ç½® FIPS æ¨¡å¼çš„çŠ¶æ€ã€‚å¦‚æœä½ å¯ç”¨äº† FIPS æ¨¡å¼ï¼Œåˆ™ Node.js ä¼šåªä½¿ç”¨é‚£äº›ç¬¦åˆ FIPS æ ‡å‡†çš„åŠ å¯†ç®—æ³•è¿›è¡Œæ“ä½œï¼Œè¿™å¯¹äºéœ€è¦ç¬¦åˆæŸäº›å®‰å…¨è¦æ±‚çš„åº”ç”¨ç¨‹åºæ¥è¯´éå¸¸é‡è¦ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œç›´æ¥é€šè¿‡ <code>crypto.fips</code> å±æ€§æ¥è·å–æˆ–è®¾ç½® FIPS æ¨¡å¼å·²ç»ä¸å†æ¨èä½¿ç”¨ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä½ åº”è¯¥ä½¿ç”¨æ›´æ˜ç¡®çš„æ–¹æ³•è°ƒç”¨æ¥å®ç°åŒæ ·çš„ç›®çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p><strong>æ—§çš„æ–¹å¼ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯ç”¨ FIPS æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fips</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨æ‰€æœ‰çš„åŠ å¯†æ“ä½œéƒ½ä¼šéµå¾ª FIPS æ ‡å‡†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼ç°åœ¨è¢«å¼ƒç”¨äº†ã€‚Node.js å»ºè®®å¼€å‘è€…é‡‡ç”¨æ–°çš„æ–¹å¼æ¥å¯ç”¨ FIPSã€‚</p><p><strong>æ–°çš„æ–¹å¼ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">setFips</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯ç”¨ FIPS æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setFips</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¼ é€’ 1 æ¥å¯ç”¨ FIPS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœè¦æ£€æŸ¥ FIPS æ˜¯å¦å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ getFips() å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">getFips</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getFips</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;FIPS mode is enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;FIPS mode is not enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨è¿™ç§æ–¹å¼æ—¶ï¼ŒFIPS ç›¸å…³çš„æ“ä½œå°†ä¼šéµå¾ªæ ‡å‡†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ä¸Šè¿°æ–°æ–¹æ³•ï¼Œä»£ç æ›´ä¸ºæ¸…æ™°ï¼Œå‡½æ•°çš„æ„å›¾å’Œç»“æœä¹Ÿæ›´åŠ æ˜ç¡®ã€‚å½“è¿ç§»åˆ°æ–°ç‰ˆæœ¬çš„ Node.js æˆ–è€…ç¼–å†™æ–°çš„ä»£ç æ—¶ï¼Œæ¨èä½¿ç”¨æ–°æ–¹å¼æ¥æ“ä½œ FIPS æ¨¡å¼ã€‚è¿™æœ‰åŠ©äºä½¿ä»£ç æœªæ¥å…¼å®¹ï¼Œå¹¶ä¸”å‡å°‘å›  API å¼ƒç”¨å¸¦æ¥çš„é£é™©ã€‚</p><h3 id="dep0094-using-assert-fail-with-more-than-one-argument" tabindex="-1"><a class="header-anchor" href="#dep0094-using-assert-fail-with-more-than-one-argument"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0094" target="_blank" rel="noopener noreferrer">DEP0094: Using assert.fail() with more than one argument</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>assert</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—çš„æ–­è¨€æµ‹è¯•ï¼Œç”¨äºç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ã€‚ç®€å•æ¥è¯´ï¼Œæ–­è¨€æ˜¯åœ¨ä½ çš„ä»£ç ä¸­è®¾ç½®ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼Œä½ å‘Šè¯‰ç¨‹åºï¼šâ€œæˆ‘é¢„æœŸè¿™é‡Œçš„å€¼åº”è¯¥æ˜¯è¿™æ ·çš„â€ï¼Œå¦‚æœå®é™…å€¼ä¸ç¬¦åˆä½ çš„é¢„æœŸï¼Œç¨‹åºå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼ˆAssertionErrorï¼‰ï¼Œé€šçŸ¥ä½ æœ‰äº›ä¸œè¥¿æ²¡æœ‰æŒ‰ç…§è®¡åˆ’è¿è¡Œã€‚</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>assert.fail()</code> æ˜¯ <code>assert</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥è§¦å‘ä¸€ä¸ªæ–­è¨€å¤±è´¥ã€‚ä½ å¯ä»¥ä¼ é€’ä¸€äº›å‚æ•°ç»™ <code>assert.fail()</code> æ¥è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯ã€‚</p><p>æ¯”å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåº”è¯¥è¿”å› true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> myFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œæ•…æ„å†™é”™äº†ï¼Œä¸ºäº†å¼•å‘æ–­è¨€å¤±è´¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">myFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myFunction should return true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–­è¨€ myFunction çš„ç»“æœä¸º true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœä¸ä¸º trueï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶è€Œï¼Œ<code>assert.fail()</code> æœ€åˆå¯ä»¥æ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œç”¨æ¥æ„å»ºé”™è¯¯ä¿¡æ¯ã€‚è¿™åœ¨ Node.js v9.9.0 è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰çš„åŠŸèƒ½ã€‚ç›®å‰ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œä½¿ç”¨ <code>assert.fail()</code> å¹¶ä¼ é€’å¤šä¸ªå‚æ•°å·²ç»ä¸å†è¢«æ”¯æŒã€‚</p><p>åºŸå¼ƒ <code>assert.fail()</code> æ¥æ”¶å¤šä¸ªå‚æ•°çš„åŸå› æ˜¯ï¼Œè¿™ç§ç”¨æ³•å®¹æ˜“ä½¿å¾—é”™è¯¯ä¿¡æ¯å’Œæ ˆè¿½è¸ªéš¾ä»¥ç†è§£ï¼Œå¹¶ä¸”ä¸å…¶ä»–æ–­è¨€æ–¹æ³•ä¸ä¸€è‡´ã€‚</p><p>ç°åœ¨ï¼Œä½ åº”è¯¥ä½¿ç”¨å•ä¸ªå‚æ•°è°ƒç”¨ <code>assert.fail()</code> æ–¹æ³•ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä½ æƒ³è¦å±•ç¤ºçš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Custom error message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º Custom error message</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ç°åœ¨æ¨èçš„æ–¹å¼æ¥è§¦å‘ä¸€ä¸ªå¸¦æœ‰è‡ªå®šä¹‰æ¶ˆæ¯çš„æ–­è¨€å¤±è´¥ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ¸…æ™°æ˜äº†åœ°å°†é”™è¯¯ä¿¡æ¯ä¼ é€’ç»™ <code>assert.fail()</code>ï¼Œå¹¶é¿å…äº†ä¼ é€’å¤šä¸ªå‚æ•°å¯èƒ½å¯¼è‡´çš„æ··ä¹±ã€‚å¦‚æœä½ éœ€è¦æ›´å¤æ‚çš„é”™è¯¯å¤„ç†ï¼Œä½ å¯èƒ½ä¼šè€ƒè™‘åˆ›å»ºä¸€ä¸ª <code>Error</code> å¯¹è±¡ï¼Œå¹¶ä¼ é€’ç»™ <code>assert.fail()</code>ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨å…¶ä»–æ›´é€‚ç”¨çš„ <code>assert</code> æ–¹æ³•æ¥è¿›è¡Œæ–­è¨€ã€‚</p><h3 id="dep0095-timers-enroll" tabindex="-1"><a class="header-anchor" href="#dep0095-timers-enroll"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0095" target="_blank" rel="noopener noreferrer">DEP0095: timers.enroll()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>deprecate</code> æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–è€…æ–¹æ³•å·²ç»è¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„ï¼Œä¸æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚å½“ä½ çœ‹åˆ° <code>[DEP0095: timers.enroll()]</code> è¿™æ ·çš„ä¿¡æ¯æ—¶ï¼Œå°±æ„å‘³ç€ <code>timers.enroll()</code> æ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚</p><p>è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™äº›æœ¯è¯­å’Œæ¦‚å¿µã€‚</p><h3 id="timers-enroll" tabindex="-1"><a class="header-anchor" href="#timers-enroll"><span>timers.enroll()</span></a></h3><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>timers</code> æ¨¡å—æä¾›äº†ä¸€äº›å·¥å…·å‡½æ•°ç”¨äºè°ƒåº¦å‡½æ•°æ‰§è¡Œã€‚å…¶ä¸­ï¼Œ<code>timers.enroll()</code> å‡½æ•°å…è®¸ä½ ç»™ä»»ä½•å¯¹è±¡å®‰æ’ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä½¿å¾—å¯ä»¥åœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹è§¦å‘è¯¥å¯¹è±¡çš„æ´»åŠ¨ã€‚ç„¶è€Œï¼Œè¿™ä¸ªå‡½æ•°å¹¶ä¸å¸¸ç”¨ï¼Œå¹¶ä¸”æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹å¼ï¼ˆä¾‹å¦‚ï¼šsetTimeout å’Œ setIntervalï¼‰ï¼Œæ‰€ä»¥ Node.js å›¢é˜Ÿå†³å®šå°†å…¶æ ‡è®°ä¸ºåºŸå¼ƒã€‚</p><h3 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­"><span>ä¾‹å­</span></a></h3><p><strong>åºŸå¼ƒå‰çš„ä½¿ç”¨æ–¹å¼ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> timers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;timers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ timers.enroll ç»™ myObject å®ä¾‹è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‚æ•°åˆ†åˆ«æ˜¯ï¼šå¯¹è±¡ï¼Œå»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">timers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enroll</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœéœ€è¦æ¿€æ´»è¿™ä¸ªå®šæ—¶å™¨ï¼Œä½ è¿˜éœ€è¦è°ƒç”¨ timers.active æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">timers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">active</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¹‹åï¼Œåœ¨ 1000 æ¯«ç§’åï¼Œä½ å¯ä»¥é€šè¿‡ _onTimeout æ–¹æ³•ï¼ˆå¦‚æœå®šä¹‰äº†çš„è¯ï¼‰æ‰§è¡Œä¸€äº›æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">_onTimeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Timers enroll timed out.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œä½¿ç”¨ unenroll æ³¨é”€å®šæ—¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">timers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unenroll</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚ä¸Šé¢ä»£ç æ˜¾ç¤ºçš„é‚£æ ·ï¼Œ<code>timers.enroll()</code> å’Œç›¸å…³çš„æ¨¡å¼æ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸”å®¹æ˜“å¼•èµ·æ··ä¹±ï¼Œå› æ­¤ Node.js ç¤¾åŒºå»ºè®®ä½¿ç”¨æ›´ç®€å•ç›´æ¥çš„ APIã€‚</p><p><strong>ç°ä»£çš„æ›¿ä»£æ–¹æ³•ï¼š</strong></p><p>ä¸€ä¸ªæ›´ç°ä»£ã€ç®€å•ã€å¹¿æ³›ä½¿ç”¨çš„æ–¹æ³•æ˜¯ <code>setTimeout</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾å®šä¸€ä¸ªå»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This will be logged after 1000 milliseconds.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œå¦‚æœæƒ³è¦æ¸…é™¤å®šæ—¶å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>clearTimeout()</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®å®šæ—¶å™¨å¹¶è·å¾—ä¸€ä¸ªå®šæ—¶å™¨çš„å¼•ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> timerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This will not be logged if clearTimeout is called.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å–æ¶ˆå®šæ—¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timerId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº <code>setTimeout</code> å’Œ <code>clearTimeout</code> æä¾›äº†ä¸€ä¸ªæ›´ç®€æ´æ˜äº†çš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„å»¶è¿Ÿå’Œå–æ¶ˆï¼Œå› æ­¤å®ƒä»¬æˆä¸ºäº† Node.js ä¸­å¤„ç†å®šæ—¶ä»»åŠ¡çš„é¦–é€‰æ–¹æ³•ï¼Œå¹¶ä¸” <code>timers.enroll()</code> å’Œå…¶ä»–ç›¸å…³çš„è€æ—§æ–¹æ³•é€æ¸ä¸è¢«æ¨èä½¿ç”¨ï¼Œç›´è‡³è¢«å®˜æ–¹åºŸå¼ƒã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒNode.js v21.7.1 ä¸­ <code>timers.enroll()</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œæ„å‘³ç€ä½ åº”è¯¥é¿å…ä½¿ç”¨å®ƒï¼Œå¹¶è½¬å‘ä½¿ç”¨ <code>setTimeout</code> æˆ–è€… <code>setInterval</code> ç­‰ç°ä»£åŒ–çš„å®šæ—¶å™¨ APIã€‚è¿™æ˜¯ Node.js ä¿æŒ API æ•´æ´å’Œç»´æŠ¤æ€§çš„ä¸€éƒ¨åˆ†åŠªåŠ›ã€‚</p><h3 id="dep0096-timers-unenroll" tabindex="-1"><a class="header-anchor" href="#dep0096-timers-unenroll"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0096" target="_blank" rel="noopener noreferrer">DEP0096: timers.unenroll()</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„<code>timers.unenroll()</code>æ–¹æ³•ä»¥åŠå®ƒä¸ºä»€ä¹ˆè¢«å¼ƒç”¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå®šæ—¶å™¨æ˜¯ä¸€ç§å…è®¸ä½ åœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œä»£ç çš„æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³åœ¨ 5 ç§’åæ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…æ¯ 3 ç§’é‡å¤æ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚ä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼ŒNode.js æä¾›äº†åƒ<code>setTimeout()</code>å’Œ<code>setInterval()</code>è¿™æ ·çš„å®šæ—¶å™¨å‡½æ•°ã€‚</p><p>ç„¶è€Œï¼Œé™¤äº†è¿™äº›å¸¸ç”¨çš„å®šæ—¶å™¨å‡½æ•°ï¼ŒNode.js æ—©æœŸç‰ˆæœ¬è¿˜å¼•å…¥äº†ä¸€äº›å…¶ä»–çš„å®šæ—¶å™¨ç›¸å…³çš„ APIï¼Œå…¶ä¸­å°±åŒ…æ‹¬<code>unenroll()</code>å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å–æ¶ˆä¹‹å‰é€šè¿‡<code>enroll()</code>å‡½æ•°è®¾ç½®çš„å®šæ—¶å™¨æ´»åŠ¨ã€‚ä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¼€å‘è€…ç¤¾åŒºå‘ç°è¿™äº›é¢å¤–çš„ API å¹¶ä¸å¸¸è¢«ä½¿ç”¨ï¼Œå¹¶ä¸”å®ƒä»¬çš„å­˜åœ¨å¯èƒ½ä¼šè®©æ–°å­¦ä¹  Node.js çš„äººæ„Ÿåˆ°æ··æ·†ã€‚</p><p>å› æ­¤ï¼Œåœ¨ Node.js çš„æ›´æ–°ç‰ˆæœ¬ä¸­ï¼Œä¸ºäº†ç®€åŒ– API å¹¶é¼“åŠ±å¼€å‘è€…ä½¿ç”¨æ›´é€šç”¨ã€æ›´æ ‡å‡†çš„æ–¹å¼æ¥å¤„ç†å®šæ—¶å™¨ï¼Œ<code>timers.unenroll()</code>æ–¹æ³•è¢«æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€ï¼ˆdeprecatedï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå°½ç®¡ä½ åœ¨å½“å‰ç‰ˆæœ¬çš„ Node.js ä¸­è¿˜å¯ä»¥ä½¿ç”¨<code>timers.unenroll()</code>ï¼Œä½†æ˜¯å®ƒå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«å®Œå…¨ç§»é™¤ï¼Œè€Œä¸”å®˜æ–¹ä¸å»ºè®®ç»§ç»­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªå˜åŒ–ï¼š</p><p>å‡è®¾åœ¨è¿‡å»ï¼Œä½ æœ‰ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œä½ å¸Œæœ›è·Ÿè¸ªè¿æ¥æŒç»­çš„æ—¶é—´ï¼Œå¹¶åœ¨ä¸€å®šæ¡ä»¶ä¸‹æ¸…ç†è¿™äº›è¿æ¥ã€‚ä½ å¯èƒ½ä¼šä½¿ç”¨<code>enroll()</code>å’Œ<code>unenroll()</code>å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;net&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">60000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®60ç§’çš„è¶…æ—¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨æ—§ç‰ˆNode.jsä¸­ï¼Œä½ å¯ä»¥ç”¨enroll()æ¥å¼€å§‹è®¡æ—¶...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  timers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enroll</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">60000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;timeout&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ...åœ¨è¿™é‡Œä½ å¯èƒ½ä¼šç”¨unenroll()æ¥å–æ¶ˆè®¡æ—¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    timers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unenroll</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œç”±äº<code>unenroll()</code>å·²ç»è¢«å¼ƒç”¨ï¼Œæˆ‘ä»¬åº”è¯¥æ€æ ·å†™è¿™æ®µä»£ç å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ä½¿ç”¨å†…ç½®çš„<code>setTimeout()</code>å’Œ<code>clearTimeout()</code>å‡½æ•°å³å¯ã€‚åŒæ ·çš„åŠŸèƒ½å¯ä»¥è¿™æ ·å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;net&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">60000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®60ç§’çš„è¶…æ—¶</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;timeout&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“è¶…æ—¶å‘ç”Ÿæ—¶å…³é—­socket</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨<code>unenroll()</code>ï¼Œå› ä¸º<code>socket.setTimeout()</code>æ–¹æ³•å·²ç»æä¾›äº†å¿…è¦çš„åŠŸèƒ½ï¼šå®ƒè®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œå½“è¶…æ—¶å‘ç”Ÿæ—¶è§¦å‘<code>timeout</code>äº‹ä»¶ï¼Œå¹¶åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æˆ‘ä»¬ç»“æŸäº† socket è¿æ¥ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœä½ åœ¨æ–°ç‰ˆæœ¬çš„ Node.js ä¸­çœ‹åˆ°å…³äº<code>timers.unenroll()</code>çš„å¼ƒç”¨è­¦å‘Šï¼Œä½ åº”è¯¥å¯»æ‰¾æ›¿ä»£çš„æ–¹æ³•æ¥ç®¡ç†ä½ çš„å®šæ—¶å™¨ï¼Œæ¯”å¦‚ä½¿ç”¨<code>setTimeout()</code>å’Œ<code>clearTimeout()</code>ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„ä»£ç ä¸ Node.js çš„æœªæ¥ç‰ˆæœ¬å…¼å®¹ï¼Œå¹¶éµå¾ªæœ€ä½³å®è·µã€‚</p><h3 id="dep0097-makecallback-with-domain-property" tabindex="-1"><a class="header-anchor" href="#dep0097-makecallback-with-domain-property"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0097" target="_blank" rel="noopener noreferrer">DEP0097: MakeCallback with domain property</a></span></a></h3><p>Node.js ä¸­çš„ &quot;DEP0097&quot; æ˜¯ä¸€ä¸ªå®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šï¼Œä»£è¡¨æŸä¸ªç‰¹å®šåŠŸèƒ½åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å°†ä¸å†æ”¯æŒæˆ–å°†ä¼šè¢«ç§»é™¤ã€‚è¿™ä¸ªç¼–å·å¯¹åº”äº Node.js æ–‡æ¡£ä¸­åˆ—å‡ºçš„ç‰¹å®šåºŸå¼ƒé¡¹ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çœ‹åˆ° &quot;DEPXXXX&quot; è¿™æ ·çš„æ ‡è®°æ—¶ï¼Œå®ƒå°±æ˜¯æé†’å¼€å‘è€…æ³¨æ„ï¼Œç›¸å…³çš„åŠŸèƒ½åœ¨å°†æ¥å¯èƒ½ä¼šæ”¹å˜æˆ–æ¶ˆå¤±ï¼Œå› æ­¤è¦é¿å…ä½¿ç”¨ï¼Œæˆ–è€…å‡†å¤‡è¿ç§»åˆ°æ–°çš„æ–¹æ³•ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œâ€œMakeCallback with domain propertyâ€æŒ‡çš„æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ–¹å¼ä¸ Node.js çš„<code>domain</code>æ¨¡å—æœ‰å…³ã€‚<code>domain</code>æ¨¡å—æ˜¯ä¸€ä¸ªè¾ƒè€çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç”¨äºæ•è·å’Œç®¡ç†å¼‚æ­¥æ“ä½œä¸­æŠ›å‡ºçš„é”™è¯¯ã€‚ç„¶è€Œï¼Œç”±äºå„ç§åŸå› ï¼ˆæ¯”å¦‚æ€§èƒ½é—®é¢˜ï¼Œéš¾ä»¥æ­£ç¡®ä½¿ç”¨ç­‰ï¼‰ï¼Œ<code>domain</code>æ¨¡å—ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å°†é€æ¸è¢«æ·˜æ±°ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>MakeCallback</code>æ˜¯ Node.js çš„å†…éƒ¨å‡½æ•°ï¼Œé€šå¸¸ç”¨äºå°†å¼‚æ­¥äº‹ä»¶çš„ç»“æœä¼ é€’ç»™ç”¨æˆ·æä¾›çš„å›è°ƒå‡½æ•°ã€‚åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œ<code>MakeCallback</code>æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª<code>domain</code>å±æ€§ï¼Œè¿™å…è®¸å›è°ƒå‡½æ•°ä¸ç‰¹å®šçš„<code>domain</code>ç›¸å…³è”ï¼Œä»è€Œå¯ä»¥æ•è·å¹¶å¤„ç†å›è°ƒä¸­æŠ›å‡ºçš„é”™è¯¯ã€‚</p><p>å¼ƒç”¨â€œMakeCallback with domain propertyâ€æ„å‘³ç€ï¼Œåœ¨ç¼–å†™å¼‚æ­¥ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å†ä¾èµ–<code>domain</code>æ¨¡å—æ¥å¤„ç†é”™è¯¯ã€‚å–è€Œä»£ä¹‹çš„ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ç°ä»£çš„ JavaScript ç‰¹æ€§ï¼Œå¦‚<code>Promises</code>ã€<code>async/await</code>ï¼Œä»¥åŠ<code>try/catch</code>å—æ¥å¤„ç†å¼‚æ­¥æ“ä½œä¸­çš„é”™è¯¯ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ¶‰åŠ<code>domain</code>æ¨¡å—çš„ä¾‹å­ï¼Œä»¥åŠå¦‚ä½•ç”¨ç°ä»£çš„æ–¹æ³•é‡å†™å®ƒï¼š</p><p><strong>æ—§æ–¹æ³•ï¼šä½¿ç”¨<code>domain</code>æ¨¡å—</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> d</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> domain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•è·åˆ°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¢«domainæ‰€æ•è·çš„å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼‚æ­¥é”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–°æ–¹æ³•ï¼šä½¿ç”¨<code>Promise</code>å’Œ<code>catch</code>æ¥å¤„ç†é”™è¯¯</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">  Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼‚æ­¥é”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•è·åˆ°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>Promise</code>æ¥è¡¨ç¤ºå¼‚æ­¥æ“ä½œï¼Œå¹¶é€šè¿‡<code>.catch()</code>æ–¹æ³•æ¥æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼Œè¿™æ˜¯ä¸€ç§æ›´ç°ä»£ä¸”è¢«å¹¿æ³›æ¨èçš„é”™è¯¯å¤„ç†ç­–ç•¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…é¡¹ç›®ä¸­å¼‚æ­¥æ“ä½œå¯èƒ½ä¼šæ›´å¤æ‚ï¼Œå¯èƒ½æ¶‰åŠåˆ°å¼‚æ­¥å‡½æ•°è°ƒç”¨ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼Œä½†æ ¸å¿ƒæ€æƒ³æ˜¯ç›¸åŒçš„ï¼šåˆ©ç”¨<code>Promise</code>å’Œé”™è¯¯å¤„ç†æœºåˆ¶æ¥æ§åˆ¶æµç¨‹å’Œæ•è·å¼‚å¸¸ã€‚</p><h3 id="dep0098-asynchooks-embedder-asyncresource-emitbefore-and-asyncresource-emitafter-apis" tabindex="-1"><a class="header-anchor" href="#dep0098-asynchooks-embedder-asyncresource-emitbefore-and-asyncresource-emitafter-apis"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0098" target="_blank" rel="noopener noreferrer">DEP0098: AsyncHooks embedder AsyncResource.emitBefore and AsyncResource.emitAfter APIs</a></span></a></h3><p>å½“æˆ‘ä»¬è®¨è®º Node.js ä¸­çš„ DEP0098 è¿™ä¸ªåºŸå¼ƒè­¦å‘Šæ—¶ï¼Œæˆ‘ä»¬æ­£åœ¨è°ˆè®º Node.js å¼‚æ­¥é’©å­ï¼ˆasync_hooksï¼‰æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåœ¨ v21.7.1 çš„ç‰ˆæœ¬ä¸­å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>async_hooks</code>æ¨¡å—æä¾›äº†ä¸€ç§æœºåˆ¶æ¥è¿½è¸ª Node.js åº”ç”¨ä¸­å¼‚æ­¥æ“ä½œçš„ç”Ÿå‘½å‘¨æœŸã€‚æ¯”å¦‚ï¼Œå½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ã€å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚æˆ–è€…è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨æ—¶ï¼Œæ¯ä¸€ä¸ªè¿™æ ·çš„æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œ<code>async_hooks</code>å…è®¸ä½ ç›‘å¬åˆ°è¿™äº›å¼‚æ­¥äº‹ä»¶çš„å¼€å§‹å’Œç»“æŸã€‚</p><p>åœ¨<code>async_hooks</code>æ¨¡å—ä¸­ï¼Œ<code>AsyncResource</code>æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒè¢«ç”¨äºåˆ›å»ºä»£è¡¨å¼‚æ­¥æ“ä½œçš„èµ„æºã€‚è¿™äº›èµ„æºå¯ä»¥æ‰‹åŠ¨è§¦å‘å¼‚æ­¥äº‹ä»¶çš„å›è°ƒï¼Œä¾‹å¦‚<code>init</code>ã€<code>before</code>ã€<code>after</code>ã€<code>destroy</code>ç­‰ã€‚è¿™å¯¹äºåº“çš„ä½œè€…å°¤å…¶æœ‰ç”¨ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨<code>AsyncResource</code>æ¥ä¿è¯è‡ªå®šä¹‰çš„å¼‚æ­¥èµ„æºæ­£ç¡®åœ°é›†æˆè¿› Node.js çš„å¼‚æ­¥æ“ä½œè·Ÿè¸ªç³»ç»Ÿä¸­ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ DEP0098 ä¸­ï¼Œ<code>AsyncResource.emitBefore</code>å’Œ<code>AsyncResource.emitAfter</code>è¿™ä¸¤ä¸ª API è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚è¿™æ„å‘³ç€è¿™äº›æ–¹æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>ä¸ºä»€ä¹ˆè¦åºŸå¼ƒå®ƒä»¬ï¼Ÿ</p><p>è¿™äº› API çš„åºŸå¼ƒé€šå¸¸æ˜¯å› ä¸ºå®ƒä»¬å¯èƒ½ä¸å®‰å…¨ï¼Œæˆ–è€…å­˜åœ¨æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ã€‚<code>emitBefore</code>å’Œ<code>emitAfter</code>å¯ä»¥è¢«ç”¨æ¥æ‰‹åŠ¨è§¦å‘<code>before</code>å’Œ<code>after</code>å›è°ƒï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒä»¬å¯èƒ½å¯¼è‡´å¼‚æ­¥ä¸Šä¸‹æ–‡çš„çŠ¶æ€ä¸ä¸€è‡´ï¼Œä»è€Œå¼•èµ·éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚å› æ­¤ï¼ŒNode.js å›¢é˜Ÿå»ºè®®ä½¿ç”¨å…¶ä»–æœºåˆ¶æ¥å¤„ç†å¼‚æ­¥äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>é‚£ä¹ˆæ›¿ä»£æ–¹æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ›¿ä»£æ–¹æ¡ˆé€šå¸¸æ¶‰åŠä½¿ç”¨<code>AsyncResource</code>å¯¹è±¡çš„<code>runInAsyncScope</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨è¯¥å‡½æ•°æ‰§è¡Œå‰åè‡ªåŠ¨è§¦å‘<code>before</code>å’Œ<code>after</code>å›è°ƒï¼Œç¡®ä¿ä¸Šä¸‹æ–‡çš„æ­£ç¡®ç®¡ç†ã€‚è¿™æ ·å°±ä¸éœ€è¦æ˜¾å¼è°ƒç”¨<code>emitBefore</code>å’Œ<code>emitAfter</code>æ–¹æ³•ï¼Œå¹¶ä¸”é™ä½äº†å‡ºç°é”™è¯¯çš„é£é™©ã€‚</p><p>å®ä¾‹ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„å¼‚æ­¥èµ„æºï¼Œè¿™ä¸ªèµ„æºåœ¨æŸä¸ªæ—¶é—´ç‚¹å®Œæˆå·¥ä½œå¹¶è°ƒç”¨å›è°ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AsyncResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;async_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä½ çš„è‡ªå®šä¹‰å¼‚æ­¥èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyAsyncResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> AsyncResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“èµ„æºå‡†å¤‡å¥½æ—¶è°ƒç”¨è¯¥æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  doWork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä¹‹å‰å¯èƒ½ä½ ä¼šåƒè¿™æ ·æ˜¾å¼è§¦å‘beforeå’Œafterå›è°ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // this.emitBefore();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // process.nextTick(() =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //   callback();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //   this.emitAfter();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ç°åœ¨ä½ åº”è¯¥è¿™æ ·åšï¼š</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">runInAsyncScope</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ä½ çš„è‡ªå®šä¹‰å¼‚æ­¥èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> resource</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyAsyncResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">resource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">doWork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼‚æ­¥å·¥ä½œå®Œæˆï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>doWork</code>æ–¹æ³•åŸæœ¬å¯èƒ½ä¼šé€šè¿‡ç›´æ¥è°ƒç”¨<code>emitBefore</code>å’Œ<code>emitAfter</code>æ¥æ˜¾å¼ç®¡ç†å¼‚æ­¥å›è°ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚ä½†ç°åœ¨é€šè¿‡ä½¿ç”¨<code>runInAsyncScope</code>ï¼Œæˆ‘ä»¬æ¶ˆé™¤äº†æ‰‹åŠ¨è§¦å‘å®ƒä»¬çš„éœ€è¦ï¼Œå¹¶ä¸”ä½¿å¾—å¼‚æ­¥ä¸Šä¸‹æ–‡çš„ç®¡ç†è‡ªåŠ¨åŒ–å’Œæ›´åŠ å®‰å…¨ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼ŒåºŸå¼ƒçš„ API <code>emitBefore</code>å’Œ<code>emitAfter</code>è¢«è®¤ä¸ºæ˜¯å­˜åœ¨é£é™©çš„ï¼Œå¹¶ä¸”<code>runInAsyncScope</code>æ˜¯æ¨èçš„æ›´ç¨³å¦¥çš„æ›¿ä»£æ–¹æ³•ã€‚å¼€å‘äººå‘˜åº”å½“é¿å…åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨è¢«åºŸå¼ƒçš„ APIï¼Œå¹¶ä¸”è®¡åˆ’å°†ç°æœ‰ä»£ç è¿ç§»åˆ°æ¨èçš„æ–¹æ³•ä¸Šã€‚</p><h3 id="dep0099-async-context-unaware-node-makecallback-c-apis" tabindex="-1"><a class="header-anchor" href="#dep0099-async-context-unaware-node-makecallback-c-apis"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0099" target="_blank" rel="noopener noreferrer">DEP0099: Async context-unaware node::MakeCallback C++ APIs</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰æ—¶éœ€è¦ä½¿ç”¨ C++ æ‰©å±•æ¥æé«˜æ€§èƒ½æˆ–å®ç°ä¸€äº› JavaScript æœ¬èº«æ— æ³•ç›´æ¥å®Œæˆçš„åŠŸèƒ½ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ç§æœºåˆ¶å«ä½œ &quot;async hooks&quot;ï¼Œå…è®¸å¼€å‘è€…è·Ÿè¸ªèµ„æºï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰ï¼‰çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæ¯”å¦‚ä½•æ—¶åˆ›å»ºã€ä½•æ—¶å›è°ƒå‡½æ•°è¢«è°ƒç”¨ä»¥åŠä½•æ—¶é”€æ¯ã€‚è¿™å¯¹äºç†è§£å’Œç›‘è§†ç¨‹åºçš„å¼‚æ­¥è¡Œä¸ºéå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒè¯•å’Œæ€§èƒ½åˆ†ææ–¹é¢ã€‚</p><p>è°ˆåˆ° DEP0099ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç™½å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><p><strong>å¼‚æ­¥ç¼–ç¨‹</strong>: åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€å‘é€ç½‘ç»œè¯·æ±‚ç­‰ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨è¿™äº›æ“ä½œå®Œæˆçš„æ—¶å€™å¾—åˆ°é€šçŸ¥ï¼Œè€Œä¸æ˜¯åœä¸‹æ¥ç­‰å¾…å®ƒä»¬å®Œæˆã€‚è¿™æ ·åšå¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ï¼Œå› ä¸ºå®ƒå¯ä»¥åŒä¸€æ—¶é—´å¤„ç†æ›´å¤šäº‹æƒ…ã€‚</p></li><li><p><strong>Context-Aware å’Œ Context-Unaware</strong>: å½“æˆ‘ä»¬è¯´ä¸€ä¸ªå‡½æ•°æˆ– API æ˜¯ &quot;context-aware&quot; çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æŒ‡å®ƒèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å¼‚æ­¥æ“ä½œçš„ä¸Šä¸‹æ–‡ã€‚åœ¨ Node.js ä¸­ï¼Œè¿™é€šå¸¸å’Œæ‰§è¡Œå¼‚æ­¥æ“ä½œæ—¶ä¿æŒè·Ÿè¸ªçŠ¶æ€ç›¸å…³ã€‚è€Œ &quot;context-unaware&quot; åˆ™æ„å‘³ç€è¯¥å‡½æ•°æˆ– API æ²¡æœ‰é€‚å½“åœ°è€ƒè™‘æˆ–ç»´æŠ¤è¿™ä¸ªä¸Šä¸‹æ–‡ã€‚</p></li></ol><p>DEP0099 æ­£å¼çš„è­¦å‘Šå†…å®¹å‘Šè¯‰æˆ‘ä»¬ï¼ŒNode.js è®¡åˆ’åœæ­¢ä½¿ç”¨æŸäº›ä¸æ”¯æŒå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†çš„ C++ APIï¼Œè¿™ç±» API è¢«ç§°ä½œ &quot;Async context-unaware node::MakeCallback C++ APIs&quot;ã€‚è¿™äº› C++ API ç›®å‰åœ¨åˆ›å»ºå¼‚æ­¥å›è°ƒå‡½æ•°æ—¶ï¼Œä¸èƒ½ä¿è¯æ­£ç¡®å¤„ç†å¼‚æ­¥ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œè‹¥ä½ ä½¿ç”¨äº†è¿™ç±»æ—§çš„ C++ API æ¥ç¼–å†™æ‰©å±•ï¼Œå¯èƒ½ä¼šé¢ä¸´å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ul><li><p>å‡è®¾ä½ åœ¨ Node.js ä¸­ç¼–å†™ä¸€ä¸ªåŸç”Ÿæ‰©å±•ï¼Œè¯¥æ‰©å±•ä¸ç³»ç»Ÿåº•å±‚ç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚ä½ å¯èƒ½ä¼šåœ¨ C++ å±‚é¢ä½¿ç”¨ <code>node::MakeCallback</code> å‡½æ•°æ¥è°ƒç”¨ JavaScript ä¸­ä¼ ç»™ä½ çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœè¿™ä¸ª C++ API æ˜¯ context-unaware çš„ï¼Œé‚£ä¹ˆå½“ä½ çš„ C++ ä»£ç åœ¨ä¸åŒçš„å¼‚æ­¥æ“ä½œä¹‹é—´åˆ‡æ¢æ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±å½“å‰çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è¿™å°†å¯¼è‡´å¼‚æ­¥é’©å­æ— æ³•æ­£ç¡®è¿½è¸ªäº‹ä»¶ï¼Œè¿›è€Œå¼•èµ·é”™è¯¯æˆ–è€…è°ƒè¯•éš¾åº¦å¢åŠ ã€‚</p></li><li><p>å¦‚æœä½ åœ¨ä½¿ç”¨æŸä¸ªä¾èµ–äºæ­¤ç±» C++ API çš„ npm åŒ…ï¼Œå¹¶ä¸”è¿™ä¸ªåŒ…æ²¡æœ‰æ›´æ–°ä»¥éµå¾ªæ–°çš„è§„åˆ™ï¼Œé‚£ä¹ˆåœ¨æœªæ¥ Node.js ç‰ˆæœ¬å‡çº§åï¼Œè¿™ä¸ªåŒ…å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p></li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å¯¹äº Node.js å¼€å‘è€…æ¥è¯´ï¼Œåº”å½“å¯»æ‰¾å¹¶è¿ç§»åˆ°æ”¯æŒå¼‚æ­¥ä¸Šä¸‹æ–‡çš„æ›´æ–°ç‰ˆ APIï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</li><li>å¯¹äºåº“ä½œè€…æˆ–è€…é‚£äº›éœ€è¦ç¼–å†™åŸç”Ÿæ‰©å±•çš„å¼€å‘è€…ï¼Œä»–ä»¬éœ€è¦æ›´æ–°è‡ªå·±çš„ä»£ç ï¼Œç¡®ä¿ä½¿ç”¨çš„æ˜¯æœ€æ–°çš„ã€æ”¯æŒå¼‚æ­¥ä¸Šä¸‹æ–‡çš„ APIï¼Œä»è€Œä½¿å¾—ä»–ä»¬çš„ä»£ç åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ç»§ç»­æ­£å¸¸å·¥ä½œã€‚</li></ul><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0099 æ˜¯ä¸€ä¸ªå…³äºå³å°†è¢«å¼ƒç”¨çš„ Node.js C++ API çš„è­¦å‘Šã€‚è¿™äº› API åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶ï¼Œä¸èƒ½ä¿æŒæ­£ç¡®çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæœªæ¥å°†ä¸å†è¢«æ”¯æŒã€‚å¼€å‘è€…éœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œä»¥å…åœ¨å°†æ¥é‡åˆ°å…¼å®¹æ€§é—®é¢˜ã€‚</p><h3 id="dep0100-process-assert" tabindex="-1"><a class="header-anchor" href="#dep0100-process-assert"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0100" target="_blank" rel="noopener noreferrer">DEP0100: process.assert()</a></span></a></h3><p><code>process.assert()</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå†…ç½®æ–¹æ³•ï¼Œä½†åœ¨ Node.js ç‰ˆæœ¬ v21.7.1 ä¸­ï¼Œå®ƒè¢«æ ‡è®°ä¸º <strong>å¼ƒç”¨ (Deprecated)</strong>ã€‚<strong>å¼ƒç”¨</strong> æ„å‘³ç€è¿™ä¸ªåŠŸèƒ½ä»ç„¶å­˜åœ¨äº Node.js ä¸­ï¼Œä½†æ˜¯å¼€å‘è€…ä»¬ä¸æ¨èä½¿ç”¨å®ƒï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>process.assert()</code> æ–¹æ³•åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å¸¸è¢«ç”¨ä½œä¸€ä¸ªç®€å•çš„æ–­è¨€æµ‹è¯•ï¼Œå…¶ä¸­ä½ å¯ä»¥æ£€æŸ¥æŸä¸ªè¡¨è¾¾å¼æ˜¯å¦ä¸ºçœŸã€‚å¦‚æœè¡¨è¾¾å¼ç»“æœä¸ºå‡ï¼ˆfalseï¼‰ï¼ŒNode.js å°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥è¯´æ˜ <code>process.assert()</code> å¦‚ä½•å·¥ä½œåŠå…¶æ›¿ä»£æ–¹æ¡ˆã€‚</p><h3 id="æ—§æ–¹å¼-ä½¿ç”¨-process-assert" tabindex="-1"><a class="header-anchor" href="#æ—§æ–¹å¼-ä½¿ç”¨-process-assert"><span>æ—§æ–¹å¼ï¼šä½¿ç”¨ <code>process.assert()</code></span></a></h3><p>åœ¨è¿‡å»ï¼Œå¦‚æœä½ æƒ³è¦ç¡®ä¿æŸä¸ªæ¡ä»¶ä¸ºçœŸï¼Œå¯èƒ½ä¼šè¿™ä¹ˆå†™ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æœ‰ä¸€ä¸ªå˜é‡åº”è¯¥æ€»æ˜¯ä¸ºæ­£æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> positiveNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ process.assert() æ¥æ£€æŸ¥è¿™ä¸ªå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">positiveNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The number must be positive&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä¸­ï¼Œ<code>process.assert()</code> ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬éœ€è¦ç¡®è®¤ä¸ºçœŸçš„è¡¨è¾¾å¼ (<code>positiveNumber &gt; 0</code>)ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå³å¦‚æœè¡¨è¾¾å¼ä¸ä¸ºçœŸæ—¶ï¼Œä¼šæ˜¾ç¤ºçš„é”™è¯¯æ¶ˆæ¯ (&#39;The number must be positive&#39;)ã€‚</p><p>å¦‚æœ <code>positiveNumber</code> ç¡®å®å¤§äº 0ï¼Œé‚£ä¹ˆç¨‹åºä¼šç»§ç»­è¿è¡Œã€‚å¦‚æœä¸æ˜¯ï¼ˆæ¯”å¦‚å®ƒæ˜¯ -1ï¼‰ï¼ŒNode.js å°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå¹¶è¾“å‡º &#39;The number must be positive&#39;ã€‚</p><h3 id="æ–°æ–¹å¼-ä½¿ç”¨-assert-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#æ–°æ–¹å¼-ä½¿ç”¨-assert-æ¨¡å—"><span>æ–°æ–¹å¼ï¼šä½¿ç”¨ <code>assert</code> æ¨¡å—</span></a></h3><p>ç”±äº <code>process.assert()</code> å·²ç»è¢«å¼ƒç”¨ï¼Œç°åœ¨æ¨èä½¿ç”¨ Node.js æ ¸å¿ƒæ¨¡å— <code>assert</code> çš„åŠŸèƒ½æ¥è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚<code>assert</code> æ¨¡å—æä¾›äº†æ›´å¤šçš„æ–­è¨€æµ‹è¯•æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ›´åŠ å¼ºå¤§å’Œçµæ´»ã€‚</p><p>ä¸‹é¢æ˜¯ä½¿ç”¨ Node.js <code>assert</code> æ¨¡å—çš„åŒæ ·çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æœ‰ä¸€ä¸ªå˜é‡åº”è¯¥æ€»æ˜¯ä¸ºæ­£æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> positiveNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ assert æ¨¡å—æ¥æ£€æŸ¥è¿™ä¸ªå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">positiveNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The number must be positive&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ <code>require(&#39;assert&#39;)</code> å¼•å…¥äº† <code>assert</code> æ¨¡å—ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨ <code>assert</code> å‡½æ•°æ¥æ‰§è¡Œæ–­è¨€ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸ <code>process.assert()</code> ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯ä¸“é—¨è®¾è®¡ç”¨äºæ–­è¨€çš„ï¼Œå¹¶ä¸”ä¸ä¼šè¢«å¼ƒç”¨ã€‚</p><p>å¦‚æœæœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ç§»é™¤äº† <code>process.assert()</code>ï¼Œé‚£ä¹ˆä¸Šé¢çš„è€æ–¹å¼å°†æ— æ³•å·¥ä½œï¼Œè€Œæ–°æ–¹å¼ï¼ˆä½¿ç”¨ <code>assert</code> æ¨¡å—ï¼‰åˆ™ä¼šç»§ç»­æœ‰æ•ˆã€‚</p><p>å› æ­¤ï¼Œå¯¹äºç¼–å†™æ–°ä»£ç æˆ–è€…ç»´æŠ¤æ—§ä»£ç ï¼Œå½“ä½ çœ‹åˆ° <code>process.assert()</code> æ—¶ï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨ <code>assert</code> æ¨¡å—çš„ç›¸å…³åŠŸèƒ½æ¥æ›¿æ¢å®ƒï¼Œä»¥ä¿è¯ä»£ç çš„é•¿æœŸå…¼å®¹æ€§åŠç¨³å®šæ€§ã€‚</p><h3 id="dep0101-with-lttng" tabindex="-1"><a class="header-anchor" href="#dep0101-with-lttng"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0101" target="_blank" rel="noopener noreferrer">DEP0101: --with-lttng</a></span></a></h3><p>å½“ç„¶å¯ä»¥ã€‚åœ¨ Node.js ä¸­ï¼Œ&quot;DEP0101&quot; æ˜¯ä¸€ä¸ªç‰¹å®šçš„è­¦å‘Šä»£ç ï¼Œç”¨æ¥è¡¨ç¤º <code>--with-lttng</code> è¿™ä¸ªå¯åŠ¨é€‰é¡¹å·²è¢«å¼ƒç”¨ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†æ­¥éª¤è§£é‡Šè¿™äº›æœ¯è¯­å’Œæ¦‚å¿µã€‚</p><p><strong>Node.js</strong>:<br> è¿™æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒæ˜¯å¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„ï¼Œå¹¶ä¸”éå¸¸é€‚åˆæ„å»ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p><strong>DEP0101</strong>:<br> DEP æ˜¯ Deprecationï¼ˆå¼ƒç”¨ï¼‰çš„ç¼©å†™ã€‚åœ¨è½¯ä»¶ä¸­ï¼Œå½“ä¸€ä¸ªåŠŸèƒ½æˆ–è€…é€‰é¡¹ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å°†æ¥å¯èƒ½ä¼šè¢«ç§»é™¤æ—¶ï¼Œæˆ‘ä»¬è¯´å®ƒè¢«â€œå¼ƒç”¨â€äº†ã€‚æ¯ä¸ªå¼ƒç”¨çš„åŠŸèƒ½éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ä»£ç ï¼Œæ–¹ä¾¿å¼€å‘è€…è¯†åˆ«ã€‚åœ¨è¿™é‡Œï¼ŒDEP0101 å°±æ˜¯ <code>--with-lttng</code> è¿™ä¸ªé€‰é¡¹è¢«å¼ƒç”¨çš„ä»£ç ã€‚</p><p><strong>--with-lttng</strong>:<br> LTTng (Linux Trace Toolkit Next Generation) æ˜¯ä¸€ç§å¼€æºçš„è½¯ä»¶ï¼Œä¸»è¦ç”¨äºç›‘æ§ Linux ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œé€šè¿‡è®°å½•å’Œåˆ†æå„ç§äº‹ä»¶æ¥å¸®åŠ©è°ƒè¯•å’Œæ€§èƒ½è°ƒä¼˜ã€‚<code>--with-lttng</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªç¼–è¯‘é€‰é¡¹ï¼Œå…è®¸ Node.js åœ¨æ„å»ºæ—¶æ”¯æŒ LTTngï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥å¯¹ Node.js åº”ç”¨è¿›è¡Œè¯¦ç»†çš„æ€§èƒ½è¿½è¸ªå’Œåˆ†æã€‚</p><p>ç„¶è€Œï¼Œä» Node.js v21.7.1 å¼€å§‹ï¼Œ<code>--with-lttng</code> é€‰é¡¹è¢«æ ‡è®°ä¸ºå¼ƒç”¨ã€‚è¿™æ„å‘³ç€ä½ å°†æ¥å¯èƒ½æ— æ³•åœ¨ Node.js ä¸­ä½¿ç”¨ LTTng æ¥è¿›è¡Œæ€§èƒ½è¿½è¸ªã€‚è¿™æ ·çš„å˜åŒ–é€šå¸¸å‡ºç°æ˜¯å› ä¸ºæœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œæˆ–è€…è¯¥åŠŸèƒ½çš„ä½¿ç”¨å¹¶ä¸å¹¿æ³›ï¼Œç»´æŠ¤æˆæœ¬è¾ƒé«˜ã€‚</p><p><strong>å®é™…ä¾‹å­</strong>:</p><ul><li><p><strong>åœ¨å¼ƒç”¨ä¹‹å‰</strong>ï¼š<br> å‡è®¾ä½ æ˜¯ä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜æˆ–è€…å¼€å‘è€…ï¼Œæƒ³è¦åˆ†æä½ çš„ Node.js åº”ç”¨ä¸ºä½•è¿è¡Œç¼“æ…¢ã€‚ä½ å¯èƒ½ä¼šåœ¨ç¼–è¯‘ Node.js æ—¶ä½¿ç”¨ <code>--with-lttng</code> é€‰é¡¹ï¼Œä»¥ä¾¿é›†æˆ LTTngã€‚ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨ LTTng å·¥å…·æ¥æ”¶é›†å…³äºä½ çš„åº”ç”¨å¦‚ä½•æ‰§è¡Œçš„è¯¦å°½æ•°æ®ï¼Œå¹¶ä½¿ç”¨è¿™äº›æ•°æ®æ¥æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆã€‚</p></li><li><p><strong>åœ¨å¼ƒç”¨ä¹‹å</strong>ï¼š<br> è™½ç„¶ <code>--with-lttng</code> è¢«å¼ƒç”¨äº†ï¼Œä½†æ˜¯ä½ ä»ç„¶æœ‰å…¶ä»–çš„é€‰æ‹©æ¥ç›‘æ§ä½ çš„ Node.js åº”ç”¨çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js å†…ç½®çš„ <code>perf_hooks</code> æ¨¡å—ï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹å·¥å…·æ¯”å¦‚ <code>clinic.js</code>ï¼Œ<code>0x</code> æˆ–è€… <code>nodetime</code>ã€‚è¿™äº›å·¥å…·ä¹Ÿæä¾›äº†å¼ºå¤§çš„æ€§èƒ½åˆ†æåŠŸèƒ½ï¼Œè€Œä¸”å¯èƒ½æ›´åŠ ç®€å•ç›´è§‚ã€‚</p></li></ul><p>æ€»ç»“èµ·æ¥ï¼ŒDEP0101 è¡¨æ˜ Node.js ä¸å†æ¨èåœ¨æ„å»ºæ—¶å¯ç”¨ LTTng æ”¯æŒï¼Œè€Œæ˜¯å¼•å¯¼ä½ å»ä½¿ç”¨å…¶ä»–æ€§èƒ½ç›‘æµ‹å·¥å…·å’Œæ–¹æ³•ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨æˆ–è®¡åˆ’ä½¿ç”¨ LTTng æ¥åˆ†æ Node.js åº”ç”¨çš„æ€§èƒ½ï¼Œä½ å¯èƒ½éœ€è¦å¼€å§‹æ¢ç´¢å…¶ä»–çš„æ›¿ä»£æ–¹æ¡ˆäº†ã€‚</p><h3 id="dep0102-using-noassert-in-buffer-read-write-operations" tabindex="-1"><a class="header-anchor" href="#dep0102-using-noassert-in-buffer-read-write-operations"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0102" target="_blank" rel="noopener noreferrer">DEP0102: Using noAssert in Buffer#(read|write) operations</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„å¹³å°ï¼Œå®ƒè®©ä½ å¯ä»¥ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚Node.js æä¾›äº†å¾ˆå¤šå†…ç½®çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¸®åŠ©å¼€å‘è€…å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç½‘ç»œé€šä¿¡ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­æœ‰ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¨¡å—å«åš<code>Buffer</code>ã€‚<code>Buffer</code>æ¨¡å—æä¾›äº†ä¸€ç§å­˜å‚¨åŸå§‹äºŒè¿›åˆ¶æ•°æ®çš„æ–¹å¼ï¼Œç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸“é—¨ä¸ºå¤„ç†äºŒè¿›åˆ¶æ•°æ®è®¾è®¡çš„ã€‚åœ¨ç½‘ç»œé€šä¿¡æˆ–è€…æ–‡ä»¶æ“ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œæ‰€ä»¥<code>Buffer</code>åœ¨ Node.js ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå½“ä½ ä¸‹è½½ä¸€å¼ å›¾ç‰‡æˆ–æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¿™äº›æ•°æ®åœ¨ç½‘ç»œä¸Šä¼ è¾“å’Œè¢«ç¨‹åºè¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯ä»¥äºŒè¿›åˆ¶æ•°æ®æµçš„å½¢å¼å­˜åœ¨çš„ã€‚Node.js çš„<code>Buffer</code>å°±å¯ä»¥ç”¨æ¥å¤„ç†è¿™ç±»æ•°æ®ã€‚</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>Buffer</code>ç±»çš„æŸäº›æ–¹æ³•ï¼ˆå¦‚<code>readInt32LE</code>ã€<code>writeUInt16BE</code>ç­‰ï¼‰æ¥å—ä¸€ä¸ªåä¸º<code>noAssert</code>çš„å‚æ•°ã€‚å¦‚æœæŠŠ<code>noAssert</code>è®¾ä¸º<code>true</code>ï¼ŒNode.js å°±ä¸ä¼šæ£€æŸ¥ä¼ å…¥çš„å€¼æ˜¯å¦è¶…å‡ºèŒƒå›´æˆ–æ˜¯å¦æ­£ç¡®ï¼Œè¿™æ ·å¯ä»¥ç•¥å¾®æé«˜æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸å°å¿ƒä¼ å…¥äº†é”™è¯¯çš„å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„è¡Œä¸ºï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•çš„é”™è¯¯æç¤ºã€‚</p><p>ä» Node.js v21.7.1 å¼€å§‹ï¼Œä½¿ç”¨<code>noAssert</code>å‚æ•°çš„åšæ³•å·²ç»è¢«åºŸå¼ƒï¼ˆDEP0102ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œç°åœ¨ Node.js çš„å¼€å‘å›¢é˜Ÿä¸æ¨èä½¿ç”¨<code>noAssert</code>ï¼Œå¹¶ä¸”è®¡åˆ’åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤å®ƒã€‚åºŸå¼ƒçš„åŸå› ä¸»è¦æ˜¯å› ä¸ºè¿™å¯èƒ½å¯¼è‡´éšè”½çš„ bugï¼Œå¹¶ä¸”éšç€ V8 å¼•æ“çš„ä¼˜åŒ–ï¼Œ<code>noAssert</code>å¸¦æ¥çš„æ€§èƒ½æå‡ä¹Ÿè¶Šæ¥è¶Šå°ã€‚</p><p>é‚£ä¹ˆå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p><ol><li>å½“ä½ ä½¿ç”¨<code>Buffer</code>ç›¸å…³çš„æ–¹æ³•å»è¯»å†™æ•°æ®æ—¶ï¼Œä¸éœ€è¦å†è€ƒè™‘ä½¿ç”¨<code>noAssert</code>å‚æ•°ã€‚äº‹å®ä¸Šï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨å®ƒï¼Œå³ä½¿ä¸€äº›æ—§çš„æ•™ç¨‹æˆ–ä»£ç ç¤ºä¾‹ä¸­å¯èƒ½è¿˜ä¼šçœ‹åˆ°å®ƒçš„èº«å½±ã€‚</li><li>å¦‚æœä½ æ­£åœ¨å­¦ä¹ åˆ«äººçš„ä»£ç ï¼Œå¹¶ä¸”çœ‹åˆ°äº†<code>noAssert</code>è¿™ä¸ªå‚æ•°ï¼Œä½ éœ€è¦çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä¸æ¨èä½¿ç”¨çš„ç‰¹æ€§ï¼Œå¹¶ä¸”åœ¨æœªæ¥å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</li><li>å§‹ç»ˆå°½é‡ä¿æŒä½ çš„ Node.js ç‰ˆæœ¬æ›´æ–°ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯æœ€æ–°çš„ç‰¹æ€§å’Œå®‰å…¨ä¿®å¤ã€‚</li></ol><p>ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ Node.js v21.7.1 ä¹‹å‰ä½ å¯èƒ½ä¼šå†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buf</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">allocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåŒ…å«4ä¸ªå­—èŠ‚çš„buffer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeUInt32LE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x12345678</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨noAssertå‚æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†åœ¨ v21.7.1 æˆ–ä¹‹åçš„ç‰ˆæœ¬ï¼Œä½ åº”è¯¥è¿™æ ·å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buf</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">allocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeUInt32LE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x12345678</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸ä½¿ç”¨noAssertå‚æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æ­£åœ¨å†™æ–°ä»£ç ï¼Œå°±ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ª<code>noAssert</code>å‚æ•°ã€‚è€Œå¦‚æœä½ åœ¨é˜…è¯»æˆ–ç»´æŠ¤æ—§ä»£ç ï¼Œåˆ™éœ€è¦æ„è¯†åˆ°è¿™ä¸ªå‚æ•°çš„å­˜åœ¨ï¼Œå¹¶è€ƒè™‘å°†å…¶ç§»é™¤ã€‚</p><h3 id="dep0103-process-binding-util-is-typechecks" tabindex="-1"><a class="header-anchor" href="#dep0103-process-binding-util-is-typechecks"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0103" target="_blank" rel="noopener noreferrer">DEP0103: process.binding(&#39;util&#39;).is[...] typechecks</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰è®¸å¤šå†…ç½®æ¨¡å—å’Œ API å¯ä¾›ä½¿ç”¨ï¼Œä½†å…¶ä¸­ä¸€äº›åŠŸèƒ½å¯èƒ½ä¼šè¢«è®¤ä¸ºè¿‡æ—¶æˆ–ä¸å»ºè®®ä½¿ç”¨ï¼Œè¿™äº›å°±è¢«ç§°ä½œâ€œå¼ƒç”¨â€(deprecations)ã€‚</p><p><code>DEP0103</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šã€‚å½“ä½ çœ‹åˆ°ç±»ä¼¼<code>[DEP0103]</code>è¿™æ ·çš„æ ‡è®°ï¼Œå®ƒå‘Šè¯‰ä½ æŸä¸ªåŠŸèƒ½å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>å…·ä½“åˆ°<code>DEP0103</code>ï¼Œè¿™ä¸ªå¼ƒç”¨ä¸<code>process.binding()</code>å‡½æ•°æœ‰å…³ã€‚<code>process.binding()</code>æ˜¯ Node.js çš„ä¸€ä¸ªä½çº§ APIï¼Œç”¨äºåŠ è½½å†…éƒ¨æ„å»ºçš„ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯é‚£äº› C++ç¼–å†™çš„æ¨¡å—ï¼Œå®ƒä»¬æä¾›äº† Node.js æ ¸å¿ƒåŠŸèƒ½ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å…¬å¼€çš„ APIï¼Œå¹¶ä¸” Node.js å›¢é˜Ÿä¸é¼“åŠ±æ™®é€šç”¨æˆ·ç›´æ¥ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒè®©åº”ç”¨ç¨‹åºç›´æ¥ä¾èµ– Node.js çš„å†…éƒ¨ç»“æ„ï¼Œè¿™å¯èƒ½å¯¼è‡´æœªæ¥ç‰ˆæœ¬çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p><p><code>util.is[...]</code> typechecks æŒ‡çš„æ˜¯ä¸€ç³»åˆ—ç”¨æ¥æ£€æŸ¥å˜é‡ç±»å‹çš„å‡½æ•°ï¼Œä¾‹å¦‚ <code>util.isString(value)</code>ï¼Œç”¨æ¥æ£€æŸ¥<code>value</code>æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚è¿™äº›å‡½æ•°åŸæœ¬é€šè¿‡<code>process.binding(&#39;util&#39;)</code>æ¥è®¿é—®ã€‚</p><p>ç°åœ¨ï¼Œç”±äº DEP0103 çš„å¼ƒç”¨ï¼Œè¿™æ„å‘³ç€ä½¿ç”¨<code>process.binding(&#39;util&#39;)</code>æ¥è¿›è¡Œç±»å‹æ£€æŸ¥çš„æ–¹æ³•ä¸å†å»ºè®®ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥å¯èƒ½ä¼šå®Œå…¨æ¶ˆå¤±ã€‚</p><p>å®é™…åº”ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p><strong>è¿‡å»çš„åšæ³•</strong>ï¼ˆå·²å¼ƒç”¨ï¼‰:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">binding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someVar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someVar is a string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾æ£€æŸ¥<code>someVar</code>æ˜¯å¦æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œä½¿ç”¨äº†ä¸æ¨èä½¿ç”¨çš„<code>process.binding(&#39;util&#39;).isString</code>ã€‚</p></li><li><p><strong>æ¨èçš„åšæ³•</strong>ï¼š<br> ä½ åº”è¯¥ä½¿ç”¨æ ‡å‡† JavaScript æ–¹æ³•å’Œ Node.js æä¾›çš„å…¶ä»– API æ¥æ›¿ä»£ä»¥ä¸Šå¼ƒç”¨çš„æ–¹æ³•ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ç”¨ç°ä»£çš„æ–¹å¼åšç±»å‹æ£€æŸ¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> someVar</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someVar is a string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…å¦‚æœéœ€è¦æ›´å¤æ‚çš„æ£€æŸ¥å¯ä»¥ä½¿ç”¨ Node.js å†…ç½®çš„<code>util</code>æ¨¡å—ä¸­çš„<code>types</code>å¯¹è±¡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isStringObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someVar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someVar is a string object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä½¿ç”¨<code>require(&#39;util&#39;)</code>æ¥åŠ è½½ Node.js çš„<code>util</code>æ¨¡å—ï¼Œç„¶åä½¿ç”¨å…¶<code>types</code>å±æ€§è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>DEP0103</code>æé†’æˆ‘ä»¬ä¸è¦ä½¿ç”¨<code>process.binding(&#39;util&#39;).is[...]</code>è¿™æ ·çš„è€æ—§æ–¹æ³•è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œè€Œåº”è¯¥é‡‡ç”¨æ–°çš„ã€ç¨³å®šçš„ API å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚è¿™æœ‰åŠ©äºç¡®ä¿ä½ çš„ Node.js åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€‚åº”æœªæ¥çš„ç‰ˆæœ¬å˜åŠ¨ï¼ŒåŒæ—¶ç»´æŒè‰¯å¥½çš„å…¼å®¹æ€§ã€‚</p><h3 id="dep0104-process-env-string-coercion" tabindex="-1"><a class="header-anchor" href="#dep0104-process-env-string-coercion"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0104" target="_blank" rel="noopener noreferrer">DEP0104: process.env string coercion</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€èŠ Node.js ä¸­çš„è¿™ä¸ªæ¦‚å¿µï¼š<code>DEP0104: process.env string coercion</code>ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>process.env</code> æ˜¯ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰ç¯å¢ƒå˜é‡çš„å¯¹è±¡ã€‚ç¯å¢ƒå˜é‡æ˜¯åœ¨ä½ çš„æ“ä½œç³»ç»Ÿä¸­è®¾ç½®çš„é”®å€¼å¯¹ï¼Œå®ƒä»¬é€šå¸¸ç”¨æ¥é…ç½®ç¨‹åºè¿è¡Œæ—¶çš„æŸäº›è¡Œä¸ºã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€æ—¥å¿—çº§åˆ«æˆ–è€…æ˜¯åŠŸèƒ½å¼€å…³ç­‰ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå½“ä½ å°è¯•ä» <code>process.env</code> ä¸­è¯»å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼æ—¶ï¼Œå³ä½¿è¯¥ç¯å¢ƒå˜é‡å¹¶ä¸å­˜åœ¨ï¼ŒNode.js ä¹Ÿä¼šè‡ªåŠ¨å°†å®ƒè§£é‡Šï¼ˆcoerceï¼‰ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸² (<code>&#39;&#39;</code>)ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æœ‰ä¸€æ®µä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">MY_VARIABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾æƒ³ MY_VARIABLE å¹¶æœªåœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¦‚æœ <code>MY_VARIABLE</code> æ²¡æœ‰è¢«è®¾ç½®ï¼Œä¸Šé¢è¿™è¡Œä»£ç ä¼šæ‰“å°å‡ºç©ºå­—ç¬¦ä¸² (<code>&#39;&#39;</code>). è¿™ç§è¡Œä¸ºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ··ä¹±ï¼Œå› ä¸ºä½ å¯èƒ½æœŸå¾…çš„æ˜¯ä¸€ä¸ª <code>undefined</code>ï¼ˆè¡¨ç¤ºè¿™ä¸ªå˜é‡æ ¹æœ¬å°±æ²¡æœ‰è¢«è®¾ç½®ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚</p><p>è‡ªä» Node.js å¼€å§‹å¼ƒç”¨è¿™ä¸ªç‰¹æ€§ï¼ˆå³ DEP0104ï¼‰ï¼Œå®ƒé¼“åŠ±å¼€å‘è€…æ›´æ˜ç¡®åœ°å¤„ç†æœªè®¾ç½®çš„ç¯å¢ƒå˜é‡ã€‚ç°åœ¨ï¼Œå¦‚æœä½ å°è¯•è¯»å–ä¸€ä¸ªæœªå®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼Œ<code>process.env</code> å°†ä¼šè¿”å› <code>undefined</code>ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨è½¬æ¢æˆç©ºå­—ç¬¦ä¸²ã€‚</p><p>æ¥çœ‹çœ‹æ–°çš„è¡Œä¸ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">MY_VARIABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// MY_VARIABLE å¹¶æœªåœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºç»“æœï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// undefined</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ”¹å˜è¦æ±‚å¼€å‘è€…å¿…é¡»æ˜¾å¼åœ°å¤„ç†è¿™ç§æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨ç¯å¢ƒå˜é‡æœªè®¾ç½®çš„æƒ…å†µä¸‹ç»™å®ƒä¸€ä¸ªé»˜è®¤å€¼ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">MY_VARIABLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;default-value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœ <code>MY_VARIABLE</code> æ²¡æœ‰åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼Œé‚£ä¹ˆ <code>myVariable</code> çš„å€¼å°†ä¼šæ˜¯ <code>&#39;default-value&#39;</code>ã€‚</p><p>è¿™ä¸ªå¼ƒç”¨ï¼ˆdeprecationï¼‰æ˜¯ Node.js åŠªåŠ›æé«˜ä»£ç è´¨é‡å’Œæ¸…æ™°åº¦çš„ä¸€ä¸ªä¾‹å­ã€‚å®ƒè¿«ä½¿å¼€å‘è€…æ›´åŠ æ³¨æ„ä»–ä»¬çš„ä»£ç å¦‚ä½•å¤„ç†ç¯å¢ƒå˜é‡ï¼Œä»è€Œé¿å…æ½œåœ¨çš„é”™è¯¯å’Œæ··æ·†ã€‚è®°ä½ï¼Œåœ¨æ–°ç‰ˆæœ¬çš„ Node.js ä¸­å†™ä»£ç æ—¶ï¼Œå§‹ç»ˆè¦æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åå†ä½¿ç”¨å®ƒä»¬ã€‚</p><h3 id="dep0105-decipher-finaltol" tabindex="-1"><a class="header-anchor" href="#dep0105-decipher-finaltol"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0105" target="_blank" rel="noopener noreferrer">DEP0105: decipher.finaltol</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠèŠ Node.js ä¸­çš„ <code>[DEP0105: decipher.finaltol]</code> è¿™ä¸ªæ¦‚å¿µã€‚</p><p>é¦–å…ˆï¼Œå½“æˆ‘ä»¬çœ‹åˆ° &quot;DEP&quot; å¼€å¤´çš„æ ‡è¯†æ—¶ï¼Œå®ƒé€šå¸¸è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼ˆDeprecation Warningï¼‰ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ&quot;å¼ƒç”¨&quot; æŒ‡çš„æ˜¯æŸäº›ç‰¹æ€§æˆ–åŠŸèƒ½å°†ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚æ‰€ä»¥ï¼Œ<code>DEP0105</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå…·ä½“çš„å¼ƒç”¨æ ‡è¯†ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ†è§£è¿™ä¸ªç‰¹å®šçš„å¼ƒç”¨ï¼š<code>decipher.finaltol</code>ã€‚</p><p>Node.js ä¸­çš„ <code>decipher</code> æ˜¯ä¸€ä¸ªç”¨äºè§£å¯†æ•°æ®çš„æ¨¡å—ã€‚å½“ä½ åŠ å¯†æ•°æ®æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯¹åº”çš„ <code>decipher</code> æ¥è§£å¯†ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šä¸€æ˜¯é€šè¿‡ <code>update</code> æ–¹æ³•å¤„ç†å¤§éƒ¨åˆ†æ•°æ®ï¼ŒäºŒæ˜¯é€šè¿‡ <code>final</code> æ–¹æ³•å¤„ç†å‰©ä½™çš„æ•°æ®å¹¶ç»“æŸè§£å¯†è¿‡ç¨‹ã€‚</p><p><code>finaltol</code> ä¹‹å‰æ˜¯ <code>decipher</code> çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨è·Ÿ <code>final</code> ç±»ä¼¼ï¼Œä½†å®ƒèƒ½å¤Ÿå®¹å¿å¹¶ä¿®æ­£å› ä¸ºå¡«å……é”™è¯¯å¯¼è‡´çš„è§£å¯†å¤±è´¥ã€‚åœ¨ä¸€äº›è¾¹ç•Œæƒ…å†µä¸‹ï¼Œå½“åŠ å¯†æ•°æ®çš„å¡«å……æœ‰è¯¯æ—¶ï¼Œ<code>finaltol</code> å¯ä»¥å°è¯•å»çº æ­£è¿™äº›é”™è¯¯ï¼Œè€Œä¸æ˜¯ç®€å•åœ°æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>é‚£ä¹ˆ <code>DEP0105</code> å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬ï¼Œ<code>decipher.finaltol</code> æ–¹æ³•å·²ç»è¢«å¼ƒç”¨äº†ï¼Œæ„å‘³ç€æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ä¼šç§»é™¤è¿™ä¸ªåŠŸèƒ½ï¼Œä¸”ä¸å»ºè®®å†ä½¿ç”¨å®ƒã€‚</p><p><strong>å®é™…è¿ç”¨ä¾‹å­ï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦å¯¹ä¸€äº›æ•æ„Ÿæ•°æ®è¿›è¡Œå®‰å…¨ä¼ è¾“ã€‚åœ¨å‘é€ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šå¯¹è¿™äº›æ•°æ®è¿›è¡ŒåŠ å¯†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> secret</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;å¯†é’¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> algorithm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;aes-192-cbc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">secret</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;éœ€è¦åŠ å¯†çš„æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ encrypted å˜é‡ä¸­å­˜å‚¨çš„å°±æ˜¯åŠ å¯†åçš„æ•°æ®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ¥æ”¶ç«¯ï¼Œä¸ºäº†è·å–åŸå§‹æ•°æ®ï¼Œä½ éœ€è¦å¯¹è¿™æ®µåŠ å¯†çš„æ•°æ®è¿›è¡Œè§£å¯†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createDecipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">secret</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§£å¯†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è§£å¯†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œç°åœ¨ decrypted å˜é‡ä¸­å­˜å‚¨çš„å°±æ˜¯åŸå§‹æ•°æ®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœåŠ å¯†æ•°æ®çš„å¡«å……æ˜¯é”™è¯¯çš„ï¼Œ<code>decipher.final</code> ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚è€Œåœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œä½ å¯èƒ½æ›¾ç»ä½¿ç”¨ <code>decipher.finaltol</code> æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œä½†ç”±äº <code>DEP0105</code> çš„å­˜åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸å†æ˜¯ä¸€ä¸ªæ¨èåšæ³•ã€‚</p><p>ç»“è®ºï¼šå½“ä½ çœ‹åˆ°ç±»ä¼¼ <code>DEP0105</code> è¿™æ ·çš„å¼ƒç”¨è­¦å‘Šæ—¶ï¼Œä½ åº”è¯¥æŸ¥æ‰¾æ›¿ä»£çš„æ–¹æ³•æˆ–æ›´æ–°ä½ çš„ä»£ç ä»¥é¿å…å°†æ¥å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ åº”è¯¥åšæŒä½¿ç”¨ <code>decipher.final</code> å¹¶ç¡®ä¿åŠ å¯†æ•°æ®çš„æ­£ç¡®æ€§ï¼Œè€Œä¸æ˜¯ä¾èµ– <code>finaltol</code>ã€‚</p><h3 id="dep0106-crypto-createcipher-and-crypto-createdecipher" tabindex="-1"><a class="header-anchor" href="#dep0106-crypto-createcipher-and-crypto-createdecipher"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0106" target="_blank" rel="noopener noreferrer">DEP0106: crypto.createCipher and crypto.createDecipher</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥ä¸ºä½ è¯¦ç»†è§£é‡Šä¸€ä¸‹ Node.js ä¸­å…³äº DEP0106 çš„å†…å®¹ã€‚</p><p>DEP0106 æ˜¯ Node.js é‡Œä¸€ä¸ªå…³äºåºŸå¼ƒï¼ˆdeprecationï¼‰åŠŸèƒ½çš„æ ‡è¯†ã€‚è¿™æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–è€… API ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚å…·ä½“åˆ° DEP0106ï¼Œå®ƒæŒ‡çš„æ˜¯ <code>crypto.createCipher</code> å’Œ <code>crypto.createDecipher</code> è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬æ›¾ç»æ˜¯ Node.js çš„åŠ å¯†åº“ä¸­ç”¨æ¥åˆ›å»ºåŠ å¯†å’Œè§£å¯†å¯¹è±¡çš„æ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œ<code>crypto</code> æ¨¡å—æ˜¯ Node.js å†…ç½®çš„æ¨¡å—ï¼Œæä¾›äº†åŒ…æ‹¬ä½†ä¸é™äºæ•£åˆ—ã€HMACã€åŠ å¯†ã€è§£å¯†ã€ç­¾åå’ŒéªŒè¯ç­‰å¤šç§åŠ å¯†èƒ½åŠ›ã€‚</p><p>æ—©æœŸç‰ˆæœ¬çš„ Node.js ä½¿ç”¨ <code>crypto.createCipher</code> å’Œ <code>crypto.createDecipher</code> æ¥è¿›è¡Œæ•°æ®çš„åŠ å¯†å’Œè§£å¯†ã€‚ç„¶è€Œï¼Œè¿™ä¸¤ä¸ªå‡½æ•°æœ‰ä¸€äº›å®‰å…¨ä¸Šçš„è€ƒè™‘ï¼Œå¹¶ä¸æ”¯æŒå®Œæ•´çš„åˆå§‹åŒ–å‘é‡ (IV)ï¼Œè¿™ä¼šå¸¦æ¥ä¸€å®šçš„å®‰å…¨é£é™©ã€‚å› æ­¤ï¼Œåœ¨ Node.js çš„åç»­ç‰ˆæœ¬ä¸­ï¼Œæ›´æ¨èä½¿ç”¨ <code>crypto.createCipheriv</code> å’Œ <code>crypto.createDecipheriv</code>ã€‚å®ƒä»¬å…è®¸ç”¨æˆ·æŒ‡å®šä¸€ä¸ªåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ï¼Œç”¨äº AES è¿™æ ·çš„å—å¯†ç ç®—æ³•ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æé«˜åŠ å¯†è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨æ–°çš„å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯†é’¥å’ŒIVé€šå¸¸ç”±ä¸€ä¸ªå¯†ç æ´¾ç”Ÿå‡½æ•°ç”Ÿæˆï¼Œè¿™é‡Œä¸ºäº†ç¤ºä¾‹ç›´æ¥å®šä¹‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;secret_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯†é’¥ï¼ˆç¡®ä¿æ˜¯32å­—èŠ‚ï¼Œå¯¹äºAES-256ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> iv</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;initial_vector&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–å‘é‡ï¼ˆç¡®ä¿æ˜¯16å­—èŠ‚ï¼Œå¯¹äºAESï¼‰</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ å¯†çš„ä¾‹å­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> encrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes-256-cbc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§£å¯†çš„ä¾‹å­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> decrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createDecipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes-256-cbc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> decrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> mySecretMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;This is a secret message!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encryptedMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> encrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">mySecretMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decryptedMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> decrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encryptedMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Encrypted: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encryptedMessage</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Decrypted: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">decryptedMessage</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>crypto.createCipheriv</code> å’Œ <code>crypto.createDecipheriv</code> å‡½æ•°ä»¥åŠ AES-256 CBC æ¨¡å¼è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚æ³¨æ„ï¼Œä¸ºäº†ä½¿ä»£ç æ­£å¸¸å·¥ä½œï¼Œå¯†é’¥å’Œ IV éœ€è¦æœ‰æ­£ç¡®çš„é•¿åº¦ï¼Œè¿™å–å†³äºä½ çš„åŠ å¯†ç®—æ³•å’Œæ¨¡å¼ã€‚</p><p>æœ€åï¼Œç”±äº <code>crypto.createCipher</code> å’Œ <code>crypto.createDecipher</code> å·²è¢«åºŸå¼ƒï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨ä½¿ç”¨è€ç‰ˆæœ¬çš„ Node.js API è¿›è¡Œå¼€å‘æ—¶ï¼Œåº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶è¿ç§»åˆ°è¾ƒæ–°çš„ã€å®‰å…¨çš„ APIã€‚è€Œå½“ä½ çœ‹åˆ° DEP0106 è¿™æ ·çš„è­¦å‘Šæ—¶ï¼Œå°±çŸ¥é“ç›¸åº”çš„åŠŸèƒ½æˆ– API å¹¶ä¸å®‰å…¨æˆ–å·²ç»ä¸æ˜¯æœ€ä½³å®è·µï¼Œåº”å½“æŸ¥æ‰¾æ›´æ–°çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><h3 id="dep0107-tls-convertnpnprotocols" tabindex="-1"><a class="header-anchor" href="#dep0107-tls-convertnpnprotocols"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0107" target="_blank" rel="noopener noreferrer">DEP0107: tls.convertNPNProtocols()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸æ–­æœ‰æ–°çš„åŠŸèƒ½è¢«æ·»åŠ ï¼Œæ—§çš„å‡½æ•°æˆ–ç‰¹æ€§å¯èƒ½ä¼šè¢«å¼ƒç”¨ï¼ˆå³â€œåºŸå¼ƒâ€ï¼‰ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½å·²ç»è¢«æ›´å¥½çš„å®ç°æ›¿ä»£ã€ä¸å†å®‰å…¨æˆ–è€…ä¸ç¬¦åˆç°ä»£çš„ç¼–ç¨‹æ ‡å‡†ã€‚</p><p>DEP0107 æ˜¯ Node.js å®˜æ–¹åˆ†é…ç»™æŸä¸ªå…·ä½“åºŸå¼ƒåŠŸèƒ½çš„ç¼–å·ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ <code>tls.convertNPNProtocols()</code> å‡½æ•°ã€‚<code>tls</code> æ¨¡å—æ˜¯ Node.js æä¾›çš„ç”¨äºå¤„ç† TLS/SSL åè®®çš„æ¨¡å—ï¼ŒTLS/SSL æ˜¯ä¸€ç§åè®®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›å®‰å…¨çš„é€šä¿¡ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-npn" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-npn"><span>ä»€ä¹ˆæ˜¯ NPN?</span></a></h3><p>NPN ä»£è¡¨ Next Protocol Negotiationï¼Œå®ƒæ˜¯ä¸€ä¸ª TLS æ‰©å±•ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¼€å§‹åŠ å¯†é€šä¿¡ä¹‹å‰åå•†ç½‘ç»œåè®®ï¼ˆå¦‚ HTTP/1.1 æˆ–è€… HTTP/2ï¼‰ã€‚ç„¶è€Œï¼ŒNPN å·²ç»è¢«æ›´ç°ä»£çš„ ALPN (Application-Layer Protocol Negotiation) æ‰€å–ä»£ã€‚</p><h3 id="ä¸ºä»€ä¹ˆåºŸå¼ƒ-tls-convertnpnprotocols" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆåºŸå¼ƒ-tls-convertnpnprotocols"><span>ä¸ºä»€ä¹ˆåºŸå¼ƒ <code>tls.convertNPNProtocols()</code>ï¼Ÿ</span></a></h3><p><code>tls.convertNPNProtocols()</code> å‡½æ•°çš„ç›®çš„æ˜¯å°†å­—ç¬¦ä¸²æ•°ç»„è½¬æ¢æˆé€‚åˆç”¨äº NPN åè®®åå•†çš„æ ¼å¼ã€‚ç”±äº NPN åœ¨ç°ä»£ç½‘ç»œä¸­å·²ç»è¢« ALPN æ›¿ä»£ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿå°±å˜å¾—ä¸å†éœ€è¦äº†ã€‚ä½¿ç”¨è¢«åºŸå¼ƒçš„å‡½æ•°å¯èƒ½ä¼šå¯¼è‡´ä»£ç åœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­å‡ºç°å…¼å®¹æ€§é—®é¢˜ï¼Œå› ä¸ºåºŸå¼ƒé€šå¸¸æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆä¼šä» Node.js ä¸­å®Œå…¨ç§»é™¤è¿™äº›åŠŸèƒ½ã€‚</p><h3 id="å®é™…è¿ç”¨ä¸­åº”è¯¥åšä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¸­åº”è¯¥åšä»€ä¹ˆ"><span>å®é™…è¿ç”¨ä¸­åº”è¯¥åšä»€ä¹ˆï¼Ÿ</span></a></h3><p>ä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œå¦‚æœä½ æ­£åœ¨ç¼–å†™éœ€è¦å¤„ç† TLS/SSL çš„ Node.js ç¨‹åºï¼Œé‚£ä¹ˆä½ åº”å½“é¿å…ä½¿ç”¨ä»»ä½•å·²ç»è¢«åºŸå¼ƒçš„å‡½æ•°ã€‚å¯¹äº NPN ç›¸å…³çš„éœ€æ±‚ï¼Œä½ åº”è¯¥ä½¿ç”¨ ALPN ç›¸å…³çš„æ›¿ä»£æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨æ—¶ï¼Œä½ å¯ä»¥åœ¨é€‰é¡¹ä¸­æŒ‡å®š <code>ALPNProtocols</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–è¯ä¹¦å’Œç§é’¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æŒ‡å®šæ”¯æŒçš„ ALPN åè®®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ALPNProtocols</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http/1.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;h2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// h2 è¡¨ç¤º HTTP/2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†è¯·æ±‚...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨åˆ›å»º HTTPS æœåŠ¡å™¨æ—¶è®¾ç½® <code>ALPNProtocols</code> é€‰é¡¹ï¼Œä»¥ç¡®å®šæœåŠ¡å™¨æ”¯æŒå“ªäº›åº”ç”¨å±‚åè®®ã€‚è¿™æ ·ï¼Œå½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿›è¡Œ TLS æ¡æ‰‹æ—¶ï¼Œå®ƒä»¬ä¹‹é—´å°±å¯ä»¥åå•†å‡ºä¸€ä¸ªå…±åŒæ”¯æŒçš„åè®®è¿›è¡Œé€šä¿¡ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œä½ ä½œä¸ºä¸€ä¸ªæ–°æ‰‹ï¼Œä¸éœ€è¦å…³å¿ƒå·²ç»åºŸå¼ƒçš„ <code>tls.convertNPNProtocols()</code> å‡½æ•°ã€‚ä½ åªéœ€è¦ç¡®ä¿ä½¿ç”¨å½“å‰æ¨èçš„å®è·µå»åˆ›å»ºå®‰å…¨çš„ç½‘ç»œè¿æ¥ï¼Œå¹¶ä¸”å®šæœŸæ›´æ–°ä½ çš„çŸ¥è¯†åº“ï¼Œä»¥ä¾¿äº†è§£ Node.js çš„æœ€æ–°å˜åŒ–ã€‚</p><h3 id="dep0108-zlib-bytesread" tabindex="-1"><a class="header-anchor" href="#dep0108-zlib-bytesread"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0108" target="_blank" rel="noopener noreferrer">DEP0108: zlib.bytesRead</a></span></a></h3><p><code>DEP0108</code>æ˜¯ä¸€ä¸ªä¸“é—¨çš„æ ‡è¯†ç¬¦ï¼Œç”¨æ¥åœ¨ Node.js ä¸­è¡¨ç¤ºç‰¹å®šåŠŸèƒ½æˆ–å±æ€§å·²ç»è¢«åºŸå¼ƒï¼ˆå³å¼€å‘è€…è®¡åˆ’åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤æ­¤åŠŸèƒ½ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>zlib.bytesRead</code>æŒ‡çš„æ˜¯åœ¨<code>zlib</code>æ¨¡å—ä¸­ä¸€ä¸ªåä¸º<code>bytesRead</code>çš„å±æ€§ã€‚</p><p><code>zlib</code>æ¨¡å—æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªç”¨äºæ•°æ®å‹ç¼©å’Œè§£å‹ç¼©çš„æ¨¡å—ã€‚åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>zlib</code>å¯¹è±¡æä¾›äº†ä¸€ä¸ª<code>bytesRead</code>å±æ€§ï¼Œå®ƒè¡¨ç¤ºé€šè¿‡<code>zlib</code>æµå·²ç»è¯»å–å’Œè§£å‹çš„å­—èŠ‚æ€»æ•°ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>zlib.bytesRead</code>å±æ€§è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå³å®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œä¸å†å»ºè®®å¼€å‘è€…ä½¿ç”¨è¿™ä¸ªå±æ€§ã€‚è¿™ç§æ›´æ”¹é€šå¸¸æ˜¯å› ä¸ºæœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ã€ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ–è€…ä¸ºäº†ç®€åŒ–æ¨¡å—çš„ç»´æŠ¤ã€‚</p><p>ä¸ºäº†ç»™ä½ ä¸€äº›å®é™…çš„ä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œä¸¾ä¸¤ä¸ªä¾‹å­è¯´æ˜<code>zlib</code>æ¨¡å—å¦‚ä½•è¢«ä½¿ç”¨ï¼š</p><ol><li>æ–‡ä»¶å‹ç¼©ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼ˆæ¯”å¦‚è¦å‹ç¼©çš„æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªGzipå¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®å‹ç¼©æˆ.gzæ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼ˆè¾“å‡ºçš„å‹ç¼©æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç®¡é“é“¾ï¼šè¯»å–-&gt;å‹ç¼©-&gt;å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å‹ç¼©å®Œæˆã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>æ–‡ä»¶è§£å‹ç¼©ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼ˆæ¯”å¦‚è¦è§£å‹çš„.gzæ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªGunzipå¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®è§£å‹ç¼©</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gunzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGunzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼ˆè¾“å‡ºçš„è§£å‹æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç®¡é“é“¾ï¼šè¯»å–-&gt;è§£å‹-&gt;å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">gunzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶è§£å‹å®Œæˆã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼ŒåŸæœ¬åœ¨æŸäº›æƒ…å†µä¸‹ä½ å¯èƒ½ä¼šæŸ¥çœ‹<code>gzip.bytesRead</code>æˆ–<code>gunzip.bytesRead</code>æ¥å¾—çŸ¥å¤„ç†è¿‡ç¨‹ä¸­å·²ç»è¯»å–çš„å­—èŠ‚æ•°ã€‚ä½†æ˜¯ç”±äºè¿™ä¸ªå±æ€§å·²ç»è¢«åºŸå¼ƒäº†ï¼Œç°åœ¨ä½ åº”è¯¥å¯»æ‰¾å…¶ä»–æ–¹å¼æ¥ç›‘æ§æ•°æ®æµçš„è¿›åº¦ï¼Œä¾‹å¦‚ç›‘å¬æ•°æ®äº‹ä»¶æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ç­‰ã€‚</p><p>å¦‚æœä½ åœ¨ä½¿ç”¨<code>zlib</code>ç›¸å…³åŠŸèƒ½æ—¶çœ‹åˆ°è­¦å‘Šè¯´<code>zlib.bytesRead</code>å·²åºŸå¼ƒï¼Œä½ åº”è¯¥æ£€æŸ¥ä½ çš„ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰ä½¿ç”¨åˆ°è¿™ä¸ªå±æ€§ï¼Œå¹¶è€ƒè™‘åœ¨æœªæ¥çš„æ›´æ–°ä¸­å»é™¤å¯¹å®ƒçš„ä¾èµ–ï¼Œä»¥é¿å…æ½œåœ¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p><h3 id="dep0109-http-https-and-tls-support-for-invalid-urls" tabindex="-1"><a class="header-anchor" href="#dep0109-http-https-and-tls-support-for-invalid-urls"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0109" target="_blank" rel="noopener noreferrer">DEP0109: http, https, and tls support for invalid URLs</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆ Node.js ä¸­çš„ DEP0109 å¼ƒç”¨è­¦å‘Šï¼Œå¹¶ç†è§£å®ƒçš„å«ä¹‰å’Œå¯¹ä½ ç¼–ç¨‹å®è·µçš„å½±å“ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­çš„ DEP0109 è­¦å‘Šæ˜¯å…³äº <code>http</code>ã€<code>https</code> å’Œ <code>tls</code> æ¨¡å—çš„ä¸€é¡¹æ›´æ”¹ã€‚è¿™äº›æ¨¡å—åˆ†åˆ«ç”¨äºå¤„ç† HTTPã€HTTPS å’Œ TLSï¼ˆå®‰å…¨ä¼ è¾“å±‚ï¼‰ç½‘ç»œé€šä¿¡ã€‚å¼ƒç”¨ï¼ˆDeprecationï¼‰æ˜¯ä¸€ä¸ªè­¦å‘Šï¼Œæ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–è€…è¡Œä¸ºä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>DEP0109 æŒ‡å‡ºï¼ŒNode.js ä¸å†å…è®¸è¿™äº›æ¨¡å—æ”¯æŒæ— æ•ˆçš„ URLã€‚åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå³ä½¿ä½ æä¾›äº†ä¸€ä¸ªæ ¼å¼ä¸æ­£ç¡®çš„ URLï¼ŒNode.js çš„è¿™äº›æ¨¡å—ä¹Ÿå¯èƒ½è¯•å›¾å»å¤„ç†å®ƒã€‚ä½†è¿™é€šå¸¸ä¼šå¯¼è‡´é”™è¯¯æˆ–è€…æ„å¤–çš„è¡Œä¸ºï¼Œå› ä¸ºæ— æ•ˆçš„ URL å¹¶ä¸èƒ½ç¡®ä¿èƒ½å¤Ÿæ­£ç¡®åœ°è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚</p><h3 id="ä¾‹å­-1-http-get-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-http-get-è¯·æ±‚"><span>ä¾‹å­ 1ï¼šHTTP GET è¯·æ±‚</span></a></h3><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ è¯•å›¾ä½¿ç”¨ <code>http</code> æ¨¡å—å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ°ä¸€ä¸ªæ— æ•ˆçš„ URLï¼Œä»£ç å¯èƒ½çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™é‡Œçš„ URL æ˜¯æ— æ•ˆçš„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;htp://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‡ºç°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒURL (<code>&#39;htp://example.com&#39;</code>) æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†é”™è¯¯çš„åè®® (<code>&#39;htp&#39;</code> è€Œä¸æ˜¯ <code>&#39;http&#39;</code>)ã€‚åœ¨ä»¥å‰çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œè¿™æ®µä»£ç å¯èƒ½åªæ˜¯åœ¨è¿è¡Œæ—¶æ‰“å°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯é˜»æ­¢ä½ ä½¿ç”¨è¿™ä¸ªæ— æ•ˆçš„ URLã€‚</p><h3 id="ä¾‹å­-2-åˆ›å»º-https-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-åˆ›å»º-https-æœåŠ¡å™¨"><span>ä¾‹å­ 2ï¼šåˆ›å»º HTTPS æœåŠ¡å™¨</span></a></h3><p>è€ƒè™‘ä»¥ä¸‹ä½¿ç”¨ <code>https</code> æ¨¡å—åˆ›å»º HTTPS æœåŠ¡å™¨çš„ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°½ç®¡è¿™ä¸ªä¾‹å­æ²¡æœ‰ç›´æ¥ä½¿ç”¨ URLï¼Œä½†å¦‚æœä½ åœ¨åˆ›å»ºå®¢æˆ·ç«¯è¯·æ±‚ä¸è¯¥æœåŠ¡å™¨äº¤äº’æ—¶ä½¿ç”¨äº†æ— æ•ˆçš„ URLï¼Œå°±ä¼šè§¦å‘ DEP0109 çš„è­¦å‘Šã€‚</p><h3 id="åæœå’Œæœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#åæœå’Œæœ€ä½³å®è·µ"><span>åæœå’Œæœ€ä½³å®è·µ</span></a></h3><p>ç”±äº DEP0109 çš„å®æ–½ï¼Œç°åœ¨å½“ä½ å°è¯•ç”¨è¿™äº›æ¨¡å—ä½¿ç”¨æ ¼å¼ä¸æ­£ç¡®æˆ–æ— æ•ˆçš„ URL æ—¶ï¼ŒNode.js å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ç¡®ä¿æä¾›ç»™è¿™äº›æ¨¡å—çš„ URL æ˜¯æœ‰æ•ˆçš„ï¼Œå¦åˆ™ä½ çš„ç¨‹åºå°†æ— æ³•è¿è¡Œã€‚</p><p>éµå¾ªæœ€ä½³å®è·µï¼Œä½ åº”è¯¥å§‹ç»ˆéªŒè¯å’Œæ¸…ç†ä½ çš„è¾“å…¥ï¼Œè¿™åŒ…æ‹¬ä½¿ç”¨ Node.js å†…ç½®çš„ <code>new URL()</code> æ„é€ å‡½æ•°æ¥è§£æå’ŒéªŒè¯ URL æ˜¯å¦æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">URL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myURL</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœ URL æœ‰æ•ˆï¼Œæ¥ä¸‹æ¥å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨å®ƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ— æ•ˆçš„ URL:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“èµ·æ¥ï¼ŒDEP0109 æ˜¯å…³äºå¢å¼ºç½‘ç»œå®‰å…¨å’Œå¥å£®æ€§çš„ä¸€ä¸ªé‡è¦æ›´æ–°ï¼Œé€šè¿‡ç¡®ä¿æ‰€æœ‰ç½‘ç»œè¯·æ±‚éƒ½ä½¿ç”¨æœ‰æ•ˆçš„ URLï¼Œä½ çš„ Node.js åº”ç”¨å°†å˜å¾—æ›´åŠ ç¨³å®šå’Œå®‰å…¨ã€‚</p><h3 id="dep0110-vm-script-cached-data" tabindex="-1"><a class="header-anchor" href="#dep0110-vm-script-cached-data"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0110" target="_blank" rel="noopener noreferrer">DEP0110: vm.Script cached data</a></span></a></h3><p><code>vm.Script</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒå…è®¸ä½ ç¼–è¯‘å’Œæ‰§è¡Œ JavaScript ä»£ç ã€‚åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>vm.Script</code>æä¾›äº†ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸ä½ ä¸ºç¼–è¯‘åçš„è„šæœ¬ç”Ÿæˆå’Œä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚è¿™æ„å‘³ç€å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„<code>vm.Script</code>å®ä¾‹å¹¶ç¼–è¯‘åŒæ ·çš„ä»£ç æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¹‹å‰ç”Ÿæˆçš„ç¼“å­˜æ•°æ®æ¥åŠ å¿«ç¼–è¯‘è¿‡ç¨‹ï¼Œå› ä¸ºä¸éœ€è¦å†æ¬¡ä»å¤´å¼€å§‹ç¼–è¯‘ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½ï¼ˆç¼“å­˜æ•°æ®ï¼‰è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆDEP0110ï¼‰ã€‚åºŸå¼ƒè¿™ä¸ªåŠŸèƒ½çš„åŸå› å¯èƒ½åŒ…æ‹¬ç»´æŠ¤æˆæœ¬ã€å®‰å…¨é—®é¢˜ã€æˆ–è€…æ˜¯è¯¥åŠŸèƒ½ä¸å†ç¬¦åˆ Node.js é¡¹ç›®çš„æœªæ¥æ–¹å‘ç­‰ã€‚</p><p>ä¸‹é¢ä¸¾ä¸¤ä¸ªä¾‹å­æ¥è¯´æ˜<code>vm.Script</code>çš„ç”¨æ³•ä»¥åŠå¦‚ä½•ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼š</p><h3 id="åœ¨-dep0110-ä¹‹å‰çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#åœ¨-dep0110-ä¹‹å‰çš„ä¾‹å­"><span>åœ¨ DEP0110 ä¹‹å‰çš„ä¾‹å­</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;vm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ `vm.Script` å®ä¾‹ï¼Œå®ƒå°†ç¼–è¯‘ä»£ç  &#39;x + 1&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> vm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;x + 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¼–è¯‘è„šæœ¬ï¼Œå¹¶åˆ›å»ºç¼“å­˜æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cacheData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> script</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCachedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¨åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¼“å­˜æ•°æ®æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ `vm.Script` å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> newScript</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> vm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;x + 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cachedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cacheData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ²™ç®±ç¯å¢ƒçš„ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sandbox</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ²™ç®±ä¸Šä¸‹æ–‡ä¸­è¿è¡Œè„šæœ¬</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> newScript</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sandbox</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š6</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¹¶ç¼–è¯‘äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬<code>&#39;x + 1&#39;</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬ç”Ÿæˆäº†è¿™ä¸ªè„šæœ¬çš„ç¼“å­˜æ•°æ®ï¼Œå¹¶ç”¨è¿™ä¸ªç¼“å­˜æ•°æ®æ¥åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„<code>vm.Script</code>å®ä¾‹ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå®šä¹‰äº†å˜é‡<code>x</code>å€¼çš„æ²™ç®±ç¯å¢ƒä¸­æ‰§è¡Œäº†è¿™ä¸ªè„šæœ¬ï¼Œå¹¶æ‰“å°å‡ºç»“æœã€‚</p><h3 id="åœ¨-dep0110-ä¹‹åçš„æ”¹å˜" tabindex="-1"><a class="header-anchor" href="#åœ¨-dep0110-ä¹‹åçš„æ”¹å˜"><span>åœ¨ DEP0110 ä¹‹åçš„æ”¹å˜</span></a></h3><p>ç”±äº<code>createCachedData</code>æ–¹æ³•è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œè¿™æ„å‘³ç€åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ åº”è¯¥é¿å…ä¾èµ–è¿™ä¸ªåŠŸèƒ½ã€‚å°½ç®¡åœ¨ v21.7.1 ä¸­ä½ è¿˜å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¿™ä¸ªåŠŸèƒ½å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚å› æ­¤ï¼Œå»ºè®®çš„åšæ³•æ˜¯ä¸è¦ä½¿ç”¨<code>createCachedData</code>å’Œæ„é€ å‡½æ•°ä¸­çš„<code>cachedData</code>é€‰é¡¹ã€‚</p><p>å¦‚æœä½ éœ€è¦ä¼˜åŒ–æ€§èƒ½ï¼Œåº”å½“å¯»æ‰¾å…¶ä»–æ›¿ä»£æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é¢„ç¼–è¯‘è„šæœ¬å¹¶ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æœºåˆ¶æ¥ç¼“å­˜å’Œé‡ç”¨ç»è¿‡ç¼–è¯‘çš„è„šæœ¬ã€‚é‡è¦çš„æ˜¯éšç€ Node.js çš„å‘å±•ï¼Œå¼€å‘è€…éœ€è¦é€‚åº” API çš„å˜åŒ–å¹¶é‡‡ç”¨æ¨èçš„æœ€ä½³å®è·µã€‚</p><h3 id="dep0111-process-binding" tabindex="-1"><a class="header-anchor" href="#dep0111-process-binding"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0111" target="_blank" rel="noopener noreferrer">DEP0111: process.binding()</a></span></a></h3><p><code>process.binding()</code>æ˜¯ Node.js çš„ä¸€ä¸ªå†…éƒ¨ APIï¼Œç”¨äºåœ¨ Node.js çš„åº•å±‚ C++å±‚é¢ä¸ JavaScript å±‚é¢ä¹‹é—´å»ºç«‹è”ç³»ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡<code>process.binding()</code>è·å¾—å„ç§å†…ç½®æ¨¡å—çš„å¼•ç”¨ã€‚ä¸è¿‡ï¼Œç”±äºè¿™ä¸ª API æ˜¯å†…éƒ¨ä½¿ç”¨çš„ï¼Œå¹¶ä¸”å¹¶ä¸ç¨³å®šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒå¹¶ä¸å¯¹æ™®é€šç”¨æˆ·å¼€æ”¾ã€‚</p><p>åœ¨ Node.js å†å²çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ å°è¯•è°ƒç”¨<code>process.binding()</code>æ¥è·å–æŸä¸ªå†…ç½®æ¨¡å—çš„ç»‘å®šï¼Œé‚£ä¹ˆå®é™…ä¸Šä½ æ˜¯åœ¨ç›´æ¥è®¿é—® Node.js å†…éƒ¨çš„åŸç”Ÿç»„ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ¯”å¦‚å®‰å…¨æ€§ã€ç¨³å®šæ€§ä»¥åŠå…¼å®¹æ€§é—®é¢˜ã€‚å› æ­¤ï¼ŒNode.js å›¢é˜Ÿå†³å®šé€æ­¥å¼ƒç”¨è¿™ä¸ª APIï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬è®¡åˆ’åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤å®ƒã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>DEP0111</code>æ ‡è®°äº†<code>process.binding()</code>è¢«å¼ƒç”¨ï¼Œæ„å‘³ç€è¿™ä¸ªæ–¹æ³•å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚å¦‚æœä½ çš„ä»£ç ä¸­è¿˜åœ¨ä½¿ç”¨<code>process.binding()</code>ï¼Œé‚£ä¹ˆéœ€è¦æ‰¾åˆ°æ›¿ä»£æ–¹æ¡ˆã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦å¼ƒç”¨process-binding" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦å¼ƒç”¨process-binding"><span>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨<code>process.binding()</code>?</span></a></h3><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå¼ƒç”¨<code>process.binding()</code>çš„ç†ç”±ï¼š</p><ul><li><strong>å®‰å…¨æ€§</strong>ï¼šç§æœ‰ API å¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„å®‰å…¨å®¡æŸ¥ï¼Œä½¿ç”¨è¿™äº› API å¯èƒ½å¯¼è‡´æš´éœ²å‡ºå®‰å…¨æ¼æ´ã€‚</li><li><strong>ç¨³å®šæ€§</strong>ï¼šå†…éƒ¨ API å¯èƒ½ä¼šéšæ—¶æ›´æ”¹ï¼Œè¿™æ ·åšæœ‰å¯èƒ½ç ´åä¾èµ–äºè¿™äº› API çš„åº”ç”¨ç¨‹åºã€‚</li><li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šå…¬å¼€ç¨³å®šçš„ API æœ‰åŠ©äºä¿æŒ Node.js æ ¸å¿ƒåº“çš„å¯ç»´æŠ¤æ€§ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å› ä¸º<code>process.binding()</code>æ˜¯ä¸€ä¸ªå†…éƒ¨ APIï¼Œæ™®é€šçš„ Node.js åº”ç”¨å¾ˆå°‘ç›´æ¥ä½¿ç”¨å®ƒã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸åªåœ¨ Node.js çš„æ ¸å¿ƒæ¨¡å—æˆ–è€…ä¸€äº›æ·±åº¦ä¾èµ– Node.js å†…éƒ¨æœºåˆ¶çš„æ‰©å±•æ¨¡å—ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒNode.js çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼ˆfsï¼‰åœ¨åº•å±‚å¯èƒ½ä¼šä½¿ç”¨<code>process.binding(&#39;fs&#39;)</code>æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„åŸç”Ÿæ“ä½œã€‚</p><p>ä½†å¯¹äºç¼–ç¨‹æ–°æ‰‹å’Œå¤§å¤šæ•° Node.js å¼€å‘è€…æ¥è¯´ï¼Œä½ ä¸éœ€è¦ï¼ˆä¹Ÿä¸åº”è¯¥ï¼‰ä½¿ç”¨<code>process.binding()</code>ã€‚ç›¸åï¼Œä½ åº”è¯¥å§‹ç»ˆä½¿ç”¨ç¨³å®šçš„ã€æ–‡æ¡£åŒ–çš„ API æ¥æ„å»ºä½ çš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œä½ åº”è¯¥ä½¿ç”¨<code>fs</code>æ¨¡å—æä¾›çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯è¯•å›¾é€šè¿‡<code>process.binding()</code>è®¿é—®åŸç”Ÿç»‘å®šã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸æ¨èçš„æ–¹å¼ - ä½¿ç”¨ process.binding()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fsBinding</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">binding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileDescriptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fsBinding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„æ–¹å¼ - ä½¿ç”¨ç¨³å®šçš„ fs æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼Œä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œä½ é€šå¸¸ä¸éœ€è¦äº†è§£<code>process.binding()</code>ï¼Œå®ƒçš„å¼ƒç”¨ä¹Ÿä¸ä¼šå½±å“åˆ°ä½ æ—¥å¸¸ä½¿ç”¨ Node.js çš„æ–¹å¼ã€‚åªéœ€è®°ä½å§‹ç»ˆä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä¸­æä¾›çš„ç¨³å®š API æ¥æ„å»ºä½ çš„åº”ç”¨å³å¯ã€‚</p><h3 id="dep0112-dgram-private-apis" tabindex="-1"><a class="header-anchor" href="#dep0112-dgram-private-apis"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0112" target="_blank" rel="noopener noreferrer">DEP0112: dgram private APIs</a></span></a></h3><p>Node.js ä¸­çš„<code>dgram</code>æ¨¡å—æ˜¯ç”¨æ¥å¤„ç† UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰é€šä¿¡çš„ã€‚UDP æ˜¯ä¸€ä¸ªæ— è¿æ¥çš„ã€ç®€å•çš„ç½‘ç»œåè®®ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºå‘é€æ¶ˆæ¯ï¼Œä¹Ÿç§°ä¸ºæ•°æ®æŠ¥ï¼Œåˆ°å…¶ä»–ä¸»æœºä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å‡å°‘äº†å¼€é”€ï¼Œæé«˜äº†ä¼ è¾“é€Ÿåº¦ï¼Œä½†ç¼ºç‚¹æ˜¯å®ƒä¸èƒ½ä¿è¯æ•°æ®åŒ…ä¸€å®šä¼šè¢«é€è¾¾ï¼Œä¹Ÿæ²¡æœ‰é¡ºåºå’Œé‡å¤æ•°æ®çš„æ£€æµ‹ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œæœ‰ä¸€ä¸ªå¼ƒç”¨è­¦å‘Š<code>DEP0112</code>ï¼Œè¿™ä¸ªè­¦å‘Šè¯´æ˜äº†<code>dgram</code>æ¨¡å—ä¸­æŸäº›â€œç§æœ‰â€API å°†ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚ç§æœ‰ API é€šå¸¸æ˜¯æŒ‡é‚£äº›å¹¶éè®¾è®¡ç»™å¤–éƒ¨ä½¿ç”¨çš„åŠŸèƒ½ï¼Œå®ƒä»¬å¯èƒ½å› ä¸ºå†…éƒ¨çš„æ”¹åŠ¨è€Œéšæ—¶å˜åŒ–ï¼Œå¯¼è‡´ä¾èµ–å®ƒä»¬çš„ä»£ç å‡ºç°é—®é¢˜ã€‚</p><p>å…·ä½“åˆ°å¼ƒç”¨çš„<code>dgram</code>çš„ç§æœ‰ APIï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹<code>DEP0112</code>çš„è¯¦æƒ…ï¼š</p><ul><li><code>_sendQueueSize</code>: è¿™æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒä¹‹å‰å¯ç”¨äºè·å–æœªå‘é€æ¶ˆæ¯çš„é˜Ÿåˆ—å¤§å°ã€‚</li><li><code>_healthCheck</code>: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¹‹å‰å¯ä»¥ç”¨æ¥æ£€æŸ¥<code>dgram</code>å¥—æ¥å­—çš„å¥åº·çŠ¶æ€ã€‚</li><li><code>_stopReceiving</code>: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¹‹å‰å¯ä»¥ç”¨æ¥åœæ­¢æ¥æ”¶æ–°çš„ UDP æ¶ˆæ¯ã€‚</li></ul><p>è¿™äº›éƒ½æ˜¯åœ¨<code>dgram.Socket</code>å¯¹è±¡ä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†å®ƒä»¬ä¸æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­è®°å½•çš„å…¬å…± APIï¼Œæ‰€ä»¥ Node.js å›¢é˜Ÿå†³å®šåœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ç§»é™¤å®ƒä»¬ã€‚</p><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</p><p>åœ¨ Node.js ä¸­ä½¿ç”¨<code>dgram</code>æ¨¡å—é€šå¸¸ç”¨æ¥åˆ›å»ºç½‘ç»œæœåŠ¡ï¼Œæ¯”å¦‚ DNS æœåŠ¡å™¨æŸ¥è¯¢ã€æ—¥å¿—æœåŠ¡ã€æˆ–è€…æ˜¯åœ¨çº¿æ¸¸æˆä¸­çš„ç®€å•çŠ¶æ€åŒæ­¥ç­‰ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ UDP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ä¾‹å­ã€‚</p><p>æœåŠ¡å™¨ï¼ˆserver.jsï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dgram</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dgram&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> dgram</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;udp4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æœåŠ¡å™¨å¼‚å¸¸ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stack</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">rinfo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æœåŠ¡å™¨æ”¶åˆ°æ¥è‡ª </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rinfo</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rinfo</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> çš„æ¶ˆæ¯ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;listening&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> address</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æœåŠ¡å™¨ç›‘å¬ </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">41234</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœåŠ¡å™¨å°†ç›‘å¬ä»»ä½•æ¥è‡ªç«¯å£ 41234 çš„ UDP æ•°æ®åŒ…</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯ï¼ˆclient.jsï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dgram</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dgram&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> message</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯çš„æ¶ˆæ¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> dgram</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;udp4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">41234</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¶ˆæ¯å·²å‘é€&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ°ä»»ä½•å³å°†å¼ƒç”¨çš„ç§æœ‰ APIï¼Œå› æ­¤è¿™æ®µä»£ç åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚</p><p>è¦æ³¨æ„ï¼Œå¦‚æœä½ æ›¾ç»ä¾èµ–è¿‡è¿™äº›ç§æœ‰ APIï¼Œä½ éœ€è¦æ›´æ–°ä½ çš„ä»£ç ï¼Œé¿å…åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å‡ºç°é—®é¢˜ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹äºå¼ƒç”¨çš„åŠŸèƒ½ï¼ŒNode.js å®˜æ–¹æ–‡æ¡£ä¼šæä¾›æ›¿ä»£æ–¹æ¡ˆæˆ–å‡çº§è·¯å¾„ã€‚</p><h3 id="dep0113-cipher-setauthtag-decipher-getauthtag" tabindex="-1"><a class="header-anchor" href="#dep0113-cipher-setauthtag-decipher-getauthtag"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0113" target="_blank" rel="noopener noreferrer">DEP0113: Cipher.setAuthTag(), Decipher.getAuthTag()</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯åŠ å¯†ã€è®¤è¯æ ‡ç­¾ï¼ˆAuth Tagï¼‰ã€ä»¥åŠä¸ºä»€ä¹ˆ Node.js ä¸­è¦åºŸå¼ƒ<code>Cipher.setAuthTag()</code>å’Œ<code>Decipher.getAuthTag()</code>è¿™äº›å‡½æ•°ã€‚</p><p>åœ¨åŠ å¯†é€šä¿¡ä¸­ï¼Œ&quot;è®¤è¯æ ‡ç­¾&quot;ï¼ˆAuthentication Tagï¼‰æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚å®ƒç”¨äºéªŒè¯ä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ç‰¹åˆ«æ˜¯åœ¨å¯¹ç§°åŠ å¯†çš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚ä½¿ç”¨ AES-GCMï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†-ä¼½ç½—ç“¦/è®¡æ•°å™¨æ¨¡å¼ï¼‰æ—¶ï¼ŒåŠ å¯†åçš„æ•°æ®ä¼šé™„åŠ ä¸€ä¸ªè®¤è¯æ ‡ç­¾ã€‚æ¥æ”¶æ–¹åœ¨è§£å¯†æ•°æ®æ—¶ä¼šåˆ©ç”¨è¿™ä¸ªè®¤è¯æ ‡ç­¾æ¥ç¡®è®¤æ•°æ®çš„å®Œæ•´æ€§ä¸çœŸå®æ€§ã€‚</p><p>åœ¨ Node.js ä¸­ï¼š</p><ul><li><code>Cipher.setAuthTag()</code> æ–¹æ³•åŸæœ¬æ˜¯ç”¨æ¥è®¾ç½®è§£å¯†æ•°æ®æ—¶æ‰€éœ€çš„è®¤è¯æ ‡ç­¾çš„ã€‚</li><li><code>Decipher.getAuthTag()</code> æ–¹æ³•åˆ™ç”¨äºåœ¨åŠ å¯†è¿‡ç¨‹å®Œæˆåè·å–è¿™ä¸ªè®¤è¯æ ‡ç­¾ã€‚</li></ul><p>ä½†æ˜¯åœ¨ Node.js çš„ v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ã€‚è¿™æ„å‘³ç€åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œå®ƒä»¬å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ï¼Œå› ä¸ºæœ‰äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ³•æˆ–è€…ç”±äºå®‰å…¨é—®é¢˜ã€‚Node.js å›¢é˜Ÿå»ºè®®å¼€å‘è€…ä¸å†ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ–°çš„ä»£ç ä¸­é‡‡ç”¨å…¶ä»–æ–¹å¼å¤„ç†è®¤è¯æ ‡ç­¾ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦åºŸå¼ƒå‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯å› ä¸ºå®ƒä»¬çš„ä½¿ç”¨æ–¹å¼å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜â€”â€”å¦‚æœå¼€å‘è€…ä¸æ­£ç¡®åœ°è®¾ç½®æˆ–è·å–è®¤è¯æ ‡ç­¾ï¼Œå¯èƒ½ä¼šä½¿åŠ å¯†ç³»ç»Ÿå®¹æ˜“é­å—æ”»å‡»ã€‚æ­¤å¤–ï¼Œæ–°ç‰ˆæœ¬çš„ Node.js æä¾›äº†æ›´æ–°çš„ APIï¼Œå¯ä»¥è‡ªåŠ¨å¤„ç†è®¤è¯æ ‡ç­¾ï¼Œä½¿å¾—å¼€å‘è€…æ— éœ€ç›´æ¥è°ƒç”¨<code>setAuthTag</code>æˆ–<code>getAuthTag</code>ã€‚</p><p>ç°åœ¨æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š<br> å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js ç¼–å†™ä¸€ä¸ªéœ€è¦åŠ å¯†å’Œè§£å¯†æ•°æ®çš„åº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js v21.7.1 ä¹‹å‰çš„ä»£ç ç¤ºä¾‹å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ å¯†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createCipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes-256-gcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> authTag</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getAuthTag</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§£å¯†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createDecipheriv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aes-256-gcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setAuthTag</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">authTag</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">decrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> decipher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œå¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨<code>setAuthTag</code>å’Œ<code>getAuthTag</code>ï¼Œå¹¶ä½¿ç”¨è‡ªåŠ¨å¤„ç†è®¤è¯çš„æ–¹æ³•æ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æµçš„å½¢å¼æ¥ç®¡ç†åŠ è§£å¯†è¿‡ç¨‹ï¼Œè€Œ Node.js ä¼šåœ¨å†…éƒ¨å¤„ç†è®¤è¯æ ‡ç­¾ï¼Œä»è€Œå‡å°‘äº†é”™è¯¯æ“ä½œçš„é£é™©ã€‚</p><p>é‡è¦çš„æ˜¯ï¼Œä½œä¸ºä¸€ä¸ªæ–°æ‰‹ï¼Œåœ¨å­¦ä¹ ç¼–ç¨‹å’Œä½¿ç”¨ Node.js çš„è¿‡ç¨‹ä¸­ï¼Œå§‹ç»ˆè¦æ³¨æ„éšç€ç‰ˆæœ¬æ›´æ–°ï¼Œæ—§æœ‰çš„åšæ³•å¯èƒ½ä¼šå˜å¾—è¿‡æ—¶å¹¶è¢«æ–°çš„ã€æ›´å®‰å…¨çš„æ–¹æ³•æ‰€å–ä»£ã€‚è¦æ—¶åˆ»å…³æ³¨æ–‡æ¡£å’Œç¤¾åŒºçš„æœ€æ–°åŠ¨æ€ï¼Œç¡®ä¿ä½ çš„ä»£ç ç¬¦åˆæœ€æ–°çš„å®‰å…¨æ ‡å‡†ã€‚</p><h3 id="dep0114-crypto-tobuf" tabindex="-1"><a class="header-anchor" href="#dep0114-crypto-tobuf"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0114" target="_blank" rel="noopener noreferrer">DEP0114: crypto._toBuf()</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–è€… API è¢«æ ‡è®°ä¸º&quot;deprecated&quot;ï¼ˆå³å¼ƒç”¨ï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œè€Œä¸”å»ºè®®å¼€å‘è€…åœæ­¢ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œå¹¶è¿ç§»åˆ°æ–°çš„æˆ–è€…æ›¿ä»£çš„æ–¹æ³•ä¸Šã€‚</p><p>åœ¨ä½ æåˆ°çš„ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>crypto._toBuf()</code>è¿™ä¸ªå‡½æ•°å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDEP0114ï¼‰ã€‚åŸå› æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œç†è®ºä¸Šä¸åº”è¯¥è¢«å¤–éƒ¨ç›´æ¥è°ƒç”¨ã€‚Node.js çš„<code>crypto</code>æ¨¡å—æä¾›äº†åŠ å¯†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å„ç§åŠ å¯†ç®—æ³•ã€å“ˆå¸Œã€è¯ä¹¦å¤„ç†ç­‰ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨<code>crypto</code>æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å…¬å¼€çš„ã€ç¨³å®šçš„ APIï¼Œæ¯”å¦‚<code>crypto.createHash()</code>æ¥åˆ›å»ºä¸€ä¸ªå“ˆå¸Œå¯¹è±¡ï¼Œ<code>crypto.createCipheriv()</code>æ¥åˆ›å»ºä¸€ä¸ªåŠ å¯†å¯¹è±¡ç­‰ã€‚</p><p>ç”±äº<code>crypto._toBuf()</code>æ˜¯ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œæ‰€ä»¥ç»å¤§å¤šæ•°å¼€å‘è€…å¯èƒ½ä»æœªç›´æ¥ä½¿ç”¨è¿‡å®ƒã€‚ä½†å¦‚æœæœ‰äººåœ¨è‡ªå·±çš„ä»£ç ä¸­ç›´æ¥ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆä»–ä»¬ç°åœ¨éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚</p><p>å‡è®¾<code>crypto._toBuf()</code>çš„åŠŸèƒ½æ˜¯å°†ç»™å®šçš„æ•°æ®è½¬æ¢æˆä¸€ä¸ª Buffer å¯¹è±¡ï¼Œå¦‚æœä½ ä¹‹å‰åœ¨ä»£ç ä¸­ç”¨è¿™æ ·çš„æ–¹å¼è¿›è¡Œè½¬æ¢ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> mySecretData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;secret data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">_toBuf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">mySecretData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æ—¢ç„¶è¿™ä¸ªæ–¹æ³•è¢«åºŸå¼ƒäº†ï¼Œä½ å¯ä»¥ä½¿ç”¨å®˜æ–¹æ¨èçš„æ–¹å¼æ¥æ›¿ä»£ï¼Œä¾‹å¦‚ä½¿ç”¨<code>Buffer.from()</code>æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> mySecretData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;secret data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">mySecretData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•å°†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå¯èƒ½æ˜¯å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯ï¼‰è½¬æ¢æˆä¸€ä¸ª Buffer å¯¹è±¡ã€‚Buffer å¯¹è±¡åœ¨ Node.js ä¸­æ˜¯ç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„ä¸€ä¸ªç±»ã€‚</p><p>å¦‚æœä½ åœ¨é˜…è¯»æ–‡æ¡£æˆ–è€…åˆ«çš„ä»£ç æ—¶ï¼Œçœ‹åˆ°äº†<code>crypto._toBuf()</code>ï¼Œé‚£ä¹ˆç°åœ¨ä½ çŸ¥é“äº†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªåº”è¯¥è¢«ä½¿ç”¨çš„ APIï¼Œå¹¶ä¸”ä½ åº”è¯¥æŸ¥æ‰¾æ–‡æ¡£æ¥æ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•æ¥æ“ä½œ Bufferã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œéµå¾ª Node.js å®˜æ–¹æ–‡æ¡£å’Œ API çš„æŒ‡å¯¼æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„ä»£ç åœ¨æœªæ¥èƒ½å¤Ÿå…¼å®¹æ–°ç‰ˆæœ¬çš„ Node.jsï¼Œå¹¶é¿å…æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚</p><h3 id="dep0115-crypto-prng-crypto-pseudorandombytes-crypto-rng" tabindex="-1"><a class="header-anchor" href="#dep0115-crypto-prng-crypto-pseudorandombytes-crypto-rng"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0115" target="_blank" rel="noopener noreferrer">DEP0115: crypto.prng(), crypto.pseudoRandomBytes(), crypto.rng()</a></span></a></h3><p>ç†è§£ DEP0115ï¼Œæˆ‘ä»¬å¾—å…ˆçŸ¥é“å®ƒæŒ‡çš„æ˜¯ä»€ä¹ˆã€‚åœ¨ Node.js ä¸­ï¼Œâ€œDEPâ€æ˜¯â€œDeprecationâ€çš„ç¼©å†™ï¼Œæ„å‘³ç€æŸä¸ªç‰¹æ€§æˆ– API å·²ç»è¢«åºŸå¼ƒï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ˜¯ä¸ºäº†é¼“åŠ±å¼€å‘è€…ä½¿ç”¨æ›´å®‰å…¨æˆ–æ›´é«˜æ•ˆçš„æ›¿ä»£æ–¹æ³•ã€‚</p><p>å…·ä½“åˆ° DEP0115ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>crypto.prng()</code>, <code>crypto.pseudoRandomBytes()</code> å’Œ <code>crypto.rng()</code> è¿™å‡ ä¸ªéšæœºæ•°ç”Ÿæˆå‡½æ•°è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ï¼Œå»ºè®®ä¸è¦å†ä½¿ç”¨å®ƒä»¬ã€‚</p><p>é‚£ä¹ˆè¿™å‡ ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨æ¥ç”Ÿæˆä¸€ä¸²éšæœºæ•°æ®çš„ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œéšæœºæ•°ç”Ÿæˆæ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ç”Ÿæˆå”¯ä¸€çš„ä¼šè¯ IDã€‚</li><li>åˆ›å»ºåŠ å¯†å¯†é’¥å’Œåˆå§‹åŒ–å‘é‡ã€‚</li><li>åœ¨æ¸¸æˆå¼€å‘ä¸­ç”Ÿæˆéšæœºäº‹ä»¶ã€‚</li></ul><p>æ—¢ç„¶å®ƒä»¬è¢«åºŸå¼ƒäº†ï¼Œå°±æ„å‘³ç€å¿…é¡»å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚Node.js æ¨èä½¿ç”¨<code>crypto.randomBytes()</code>æ¥ç”Ÿæˆéšæœºæ•°æ®ï¼Œå› ä¸ºå®ƒæ›´å®‰å…¨ï¼ˆæä¾›çš„æ˜¯åŠ å¯†çº§åˆ«çš„éšæœºæ•°ï¼‰å¹¶ä¸”å¾—åˆ°æ›´å¥½çš„æ”¯æŒã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…ä¾‹å­æ¥è¯´æ˜è¿™äº›å‡½æ•°çš„æ›¿ä»£ç”¨æ³•ã€‚</p><h3 id="åºŸå¼ƒçš„æ–¹æ³•ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#åºŸå¼ƒçš„æ–¹æ³•ç¤ºä¾‹"><span>åºŸå¼ƒçš„æ–¹æ³•ç¤ºä¾‹ï¼š</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åºŸå¼ƒçš„æ–¹æ³•ï¼Œä¸åº”è¯¥å†ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pseudoRandomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;éšæœºæ•°æ®:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº†<code>crypto.pseudoRandomBytes()</code>æ¥ç”Ÿæˆä¸€ä¸ªéšæœºçš„ 256 å­—èŠ‚çš„æ•°æ®ï¼Œå°½ç®¡è¿™æ®µä»£ç å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªå‡½æ•°å·²ç»è¢«åºŸå¼ƒï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="æ¨èçš„æ–¹æ³•ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#æ¨èçš„æ–¹æ³•ç¤ºä¾‹"><span>æ¨èçš„æ–¹æ³•ç¤ºä¾‹ï¼š</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èçš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®‰å…¨çš„éšæœºæ•°æ®:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>crypto.randomBytes()</code>å‡½æ•°æ¥äº§ç”Ÿ 256 å­—èŠ‚é•¿åº¦çš„éšæœºæ•°æ®ã€‚å®ƒæ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œå½“ä½ çœ‹åˆ° Node.js çš„ API æ–‡æ¡£ä¸­æåˆ°æŸé¡¹åŠŸèƒ½è¢«åºŸå¼ƒæ—¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¿¡å·ï¼Œæç¤ºä½ éœ€è¦å¼€å§‹å¯»æ‰¾æ›´æ–°ã€æ›´å®‰å…¨çš„æ›¿ä»£é€‰é¡¹æ¥æ›¿æ¢è€æ—§çš„ä»£ç ã€‚å¯¹äºéšæœºæ•°ç”Ÿæˆï¼Œç›®å‰æœ€ä½³çš„é€‰æ‹©æ˜¯<code>crypto.randomBytes()</code>ã€‚</p><h3 id="dep0116-legacy-url-api" tabindex="-1"><a class="header-anchor" href="#dep0116-legacy-url-api"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0116" target="_blank" rel="noopener noreferrer">DEP0116: Legacy URL API</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ**URLsï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰**æ˜¯ç½‘ç»œä¸Šè¡¨ç¤ºèµ„æºä½ç½®çš„ä¸€ç§æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œ<code>https://www.google.com/search?q=node.js</code> å°±æ˜¯ä¸€ä¸ª URLï¼ŒæŒ‡å‘ Google æœç´¢é¡µé¢å¹¶æœç´¢ <code>node.js</code>ã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¤„ç† URLs çš„ API æ˜¯åŸºäºæµè§ˆå™¨ä¸­çš„ <code>URL</code> å¯¹è±¡çš„æ—§æœ‰å®ç°ï¼Œè¿™äº› API åŒ…æ‹¬ <code>url.parse()</code>, <code>url.format()</code> ç­‰å‡½æ•°ã€‚è¿™äº›å‡½æ•°è¢«å½’ç±»ä¸º <strong>Legacy URL API</strong>ï¼ˆä¼ ç»Ÿ URL APIï¼‰ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™äº› API å·²ç»ä¸å†ç¬¦åˆå½“ä¸‹çš„æœ€ä½³å®è·µå’Œæ ‡å‡†ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ€§ã€æ€§èƒ½æˆ–è€…å…¶ä»–é—®é¢˜ã€‚</p><p>å› æ­¤ï¼Œåœ¨ Node.js ä¸­å¼•å…¥äº†æ–°çš„ URL APIï¼Œç§°ä¸º <code>WHATWG URL API</code>ï¼Œè¿™æ˜¯æ ¹æ® Web æ ‡å‡†ç»„ç»‡ WHATWG çš„è§„èŒƒå®ç°çš„ã€‚æ–°çš„ API æä¾›äº†ä¸€ä¸ªå…¨å±€çš„ <code>URL</code> ç±»ï¼Œå¯ä»¥ç”¨æ¥æ›´å®‰å…¨å’Œæ›´é«˜æ•ˆåœ°å¤„ç† URLsã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>DEP0116</code> æŒ‡çš„æ˜¯å¯¹è€æ—§çš„ Legacy URL API çš„å¼ƒç”¨ï¼ˆDeprecationï¼‰è­¦å‘Šã€‚è¿™æ„å‘³ç€ Node.js å¼€å‘å›¢é˜Ÿè®¡åˆ’åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å½»åº•ç§»é™¤è¿™äº›è€æ—§çš„åŠŸèƒ½ã€‚å¼€å‘è€…ä»¬è¢«é¼“åŠ±å°½å¿«è¿ç§»åˆ°æ–°çš„ <code>WHATWG URL API</code>ã€‚</p><h3 id="å®ä¾‹å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹å¯¹æ¯”"><span>å®ä¾‹å¯¹æ¯”</span></a></h3><p>å‡è®¾æˆ‘ä»¬è¦è§£æä»¥ä¸‹ URL: <code>https://example.com:8000/path/name?query=string#hash</code></p><h4 id="ä½¿ç”¨-legacy-url-api" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-legacy-url-api"><span>ä½¿ç”¨ Legacy URL API</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> parsedUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;https://example.com:8000/path/name?query=string#hash&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">parsedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: example.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">parsedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: 8000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">parsedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: /path/name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">parsedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">search</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: ?query=string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">parsedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: #hash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½¿ç”¨-whatwg-url-api" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-whatwg-url-api"><span>ä½¿ç”¨ WHATWG URL API</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myURL</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com:8000/path/name?query=string#hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: example.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: 8000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: /path/name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">search</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: ?query=string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myURL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: #hash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„ API ä¸­ï¼Œä½ ç›´æ¥åˆ›å»ºä¸€ä¸ª <code>URL</code> å¯¹è±¡æ¥å¤„ç† URLï¼Œè€Œä¸æ˜¯è°ƒç”¨ <code>url.parse()</code> æ–¹æ³•ã€‚æ–°çš„ API æ›´åŠ ç¬¦åˆæµè§ˆå™¨æ ‡å‡†ï¼Œè€Œä¸”æä¾›äº†æ›´æ¸…æ™°å’Œç®€æ´çš„æ–¹å¼æ¥æ“ä½œå’Œæ„å»º URLsã€‚</p><p>å¦‚æœä½ æ­£åœ¨ç¼–å†™æ–°çš„ä»£ç ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨æ–°çš„ <code>URL</code> ç±»ï¼Œä»¥ä¿è¯ä»£ç çš„å…¼å®¹æ€§å’Œæœªæ¥çš„ç»´æŠ¤æ€§ã€‚å¦‚æœä½ åœ¨ç»´æŠ¤æ—§ä»£ç ï¼Œé€æ­¥æ›¿æ¢æ‰ä½¿ç”¨æ—§ API çš„éƒ¨åˆ†ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="dep0117-native-crypto-handles" tabindex="-1"><a class="header-anchor" href="#dep0117-native-crypto-handles"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0117" target="_blank" rel="noopener noreferrer">DEP0117: Native crypto handles</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>DEP0117</code> æ˜¯ä¸€ä¸ªå®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šç¼–å·ï¼Œä»£è¡¨æŸä¸ªåŠŸèƒ½å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–æ”¹å˜ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œâ€œNative crypto handlesâ€æŒ‡çš„æ˜¯ Node.js çš„åŠ å¯†æ¨¡å—ä¸­ä¸€äº›åŸºäº C++ çš„åº•å±‚å¯¹è±¡ï¼ˆhandlesï¼‰ï¼Œè¿™äº›å¯¹è±¡è¢«ç”¨æ¥ç›´æ¥ä¸ Node.js çš„å†…ç½®åŠ å¯†åº“äº¤äº’ã€‚</p><p>æˆªè‡³ Node.js v21.7.1ï¼Œå¼€å‘å›¢é˜Ÿè®¡åˆ’å¼ƒç”¨è¿™äº›ç›´æ¥æš´éœ²ç»™ JavaScript å±‚çš„åŸç”ŸåŠ å¯†å¥æŸ„ï¼ˆhandlesï¼‰ï¼Œå› ä¸ºè¿™ç§ç›´æ¥è®¿é—®å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ã€å†…å­˜æ³„æ¼æˆ–å…¶å®ƒæ½œåœ¨çš„é—®é¢˜ã€‚</p><p>ä¸‹é¢é€šä¿—è§£é‡Šä¸‹ä»€ä¹ˆæ˜¯â€œNative crypto handlesâ€å’Œä¸ºä»€ä¹ˆå®ƒä»¬è¦è¢«å¼ƒç”¨ï¼Œå¹¶ä¸¾å‡ ä¸ªç¤ºä¾‹è¯´æ˜ï¼š</p><p><strong>ä»€ä¹ˆæ˜¯ Native crypto handlesï¼š</strong><br> åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>crypto</code> æ¨¡å—è¿›è¡ŒåŠ å¯†æ“ä½œæ—¶ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªå“ˆå¸Œï¼ˆå¦‚ SHA-256ï¼‰ã€ä¸€ä¸ªå¯†ç å­¦ä¸Šçš„ç­¾åï¼Œæˆ–è€…åŠ è§£å¯†æ•°æ®æ—¶ï¼ŒNode.js å†…éƒ¨ä¼šåˆ›å»ºä¸€äº›å¯¹è±¡å»å¤„ç†è¿™äº›æ“ä½œã€‚è¿™äº›å¯¹è±¡æ˜¯åŸºäº Node.js åŠ å¯†åº“ï¼ˆå¦‚ OpenSSLï¼‰çš„ C++ å¯¹è±¡ï¼Œå®ƒä»¬åœ¨ JavaScript å±‚è¢«ç§°ä¸º &quot;handles&quot;ï¼ˆå¥æŸ„ï¼‰ã€‚ç›´åˆ° Node.js ç‰ˆæœ¬ 21.7.1ï¼Œè¿™äº›å¥æŸ„è¢«å…è®¸ç›´æ¥æš´éœ²ç»™ JavaScriptï¼Œä»¥ä¾¿å¼€å‘è€…è¿›è¡Œæ›´åº•å±‚çš„æ“ä½œã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦å¼ƒç”¨ï¼š</strong><br> ç›´æ¥æ“ä½œè¿™äº›åŸç”Ÿå¥æŸ„éœ€è¦éå¸¸å°å¿ƒåœ°ç®¡ç†èµ„æºï¼Œå¦åˆ™å¾ˆå®¹æ˜“å‡ºé”™ã€‚è¿™åŒ…æ‹¬åœ¨æ­£ç¡®çš„æ—¶é—´é‡Šæ”¾å¥æŸ„ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰ä»¥åŠç¡®ä¿ä¸ä¼šè¯¯ç”¨å®ƒä»¬ï¼ˆé˜²æ­¢å®‰å…¨é—®é¢˜ï¼‰ã€‚å¤§å¤šæ•° Node.js å¼€å‘è€…å¹¶ä¸éœ€è¦è¿™æ ·æ·±å…¥åº•å±‚ï¼Œå¯ä»¥é€šè¿‡æ›´é«˜çº§åˆ«çš„ <code>crypto</code> API å®Œæˆå·¥ä½œã€‚å› æ­¤ï¼ŒNode.js å›¢é˜Ÿå†³å®šå¼ƒç”¨è¿™äº›å¥æŸ„ï¼Œé¼“åŠ±å¼€å‘è€…ä½¿ç”¨æ›´å®‰å…¨ã€æ›´ç®€å•çš„ APIã€‚</p><p><strong>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</strong></p><p>å‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ª SHA-256 çš„å“ˆå¸Œå€¼æ¥å¯¹ä¸€æ®µæ–‡æœ¬è¿›è¡Œæ‘˜è¦ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some data to hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> digest</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å°å‡ºæ–‡æœ¬çš„SHA-256å“ˆå¸Œå€¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>createHash</code> å‡½æ•°å†…éƒ¨å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ªåŸç”Ÿå¥æŸ„ï¼Œä½†ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥æ¥è§¦åˆ°è¿™ä¸ªå¥æŸ„ã€‚ç›¸åï¼Œæˆ‘ä»¬é€šè¿‡ <code>hash</code> å¯¹è±¡æä¾›çš„æ–¹æ³•æ¥æ›´æ–°å’Œæœ€ç»ˆè·å–å“ˆå¸Œå€¼ã€‚</p><p>å¼ƒç”¨åï¼ŒNode.js èƒŒåçš„å®ç°å¯èƒ½ä¼šæ”¹å˜ï¼Œä½†è¿™ä¸ªé«˜çº§åˆ«çš„ API åº”è¯¥ä¿æŒç¨³å®šã€‚å¦‚æœæœ‰ä»£ç ç›´æ¥ä½¿ç”¨äº†è¿™äº›åŸç”Ÿå¥æŸ„ï¼Œåˆ™éœ€è¦æ›´æ–°ä»£ç ä»¥ä½¿ç”¨å…¶ä»–æ¨èçš„æ–¹æ³•ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0117 çš„å¼ƒç”¨æ„å‘³ç€ Node.js å¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨åŸç”ŸåŠ å¯†å¥æŸ„çš„ä½çº§æ“ä½œï¼Œè½¬è€Œä½¿ç”¨é«˜çº§åˆ«çš„ <code>crypto</code> API æ¥å®ŒæˆåŠ å¯†ä»»åŠ¡ï¼Œè¿™æ ·æ—¢å®‰å…¨åˆç®€å•ã€‚</p><h3 id="dep0118-dns-lookup-support-for-a-falsy-host-name" tabindex="-1"><a class="header-anchor" href="#dep0118-dns-lookup-support-for-a-falsy-host-name"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0118" target="_blank" rel="noopener noreferrer">DEP0118: dns.lookup() support for a falsy host name</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­ <code>dns.lookup()</code> å‡½æ•°ä»¥åŠè¿™ä¸ªç‰¹å®šç‰ˆæœ¬ä¸­æåˆ°çš„å¼ƒç”¨ï¼ˆDEP0118ï¼‰ã€‚</p><p>é¦–å…ˆï¼Œ<code>dns.lookup()</code> æ˜¯ Node.js ä¸­ç”¨æ¥è§£æåŸŸåï¼ˆä¾‹å¦‚ <code>www.google.com</code>ï¼‰åˆ°å…¶ç›¸åº”çš„ IP åœ°å€ï¼ˆä¾‹å¦‚ <code>142.250.64.78</code>ï¼‰çš„å‡½æ•°ã€‚è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªç½‘å€ç„¶åæŒ‰ä¸‹å›è½¦ï¼Œè®¡ç®—æœºéœ€è¦çŸ¥é“å®é™…çš„æœåŠ¡å™¨åœ°å€æ‰èƒ½åŠ è½½ç½‘ç«™ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå½“ä½ è°ƒç”¨ <code>dns.lookup()</code> å‡½æ•°æ—¶ï¼Œå¦‚æœä½ ä¼ é€’äº†ä¸€ä¸ªå‡å€¼ï¼ˆfalsy valueï¼‰ä½œä¸ºä¸»æœºåâ€”â€”æ¯”å¦‚ <code>null</code>ã€<code>undefined</code> æˆ–ç©ºå­—ç¬¦ä¸² <code>&#39;&#39;</code> â€”â€”Node.js ä¼šå°†å®ƒå¤„ç†ä¸ºæŸ¥è¯¢æœ¬åœ°ä¸»æœºçš„ IP åœ°å€ã€‚æ‰€è°“çš„â€œå‡å€¼â€æ˜¯æŒ‡åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­ä¼šè¢«è¯„ä¼°ä¸º <code>false</code> çš„å€¼ã€‚</p><p>ç°åœ¨ï¼Œåœ¨è¿™ä¸ªæ›´æ–°ä¸­ï¼Œå¯¹äº <code>dns.lookup()</code> å‡½æ•°ï¼Œå¦‚æœä½ å°è¯•ä¼ å…¥ä¸€ä¸ªå‡å€¼ä½œä¸ºä¸»æœºåï¼ŒNode.js å°†ä¸å†æ¥å—è¿™ç§ç”¨æ³•å¹¶ä¸”æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚è¿™ä¸ªæ”¹å˜çš„ç›®çš„æ˜¯è®©è¡Œä¸ºæ›´åŠ æ˜ç¡®å’Œå¯é ï¼Œå› ä¸ºä¼ é€’ä¸€ä¸ªå‡å€¼é€šå¸¸æ„å‘³ç€ç¨‹åºä¸­å­˜åœ¨ bug æˆ–è€…ä½¿ç”¨ä¸å½“ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼š</p><h3 id="ç¤ºä¾‹-1-å¼ƒç”¨ä¹‹å‰çš„è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å¼ƒç”¨ä¹‹å‰çš„è¡Œä¸º"><span>ç¤ºä¾‹ 1 - å¼ƒç”¨ä¹‹å‰çš„è¡Œä¸º</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dns</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™é‡Œç”±äºæŸç§åŸå›  hostname è¢«è®¾ç½®ä¸º undefinedã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dns</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lookup</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  else</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;IP åœ°å€:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å¯èƒ½ä¼šæ‰“å°æœ¬åœ°ä¸»æœºçš„ IP åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œè¿™æ®µä»£ç ä¸ä¼šå¯¼è‡´é”™è¯¯ï¼Œå³ä½¿ <code>hostname</code> æ˜¯ <code>undefined</code>ï¼Œ å®ƒä¼šè¿”å›æœ¬åœ°æœºå™¨çš„ IP åœ°å€ã€‚</p><h3 id="ç¤ºä¾‹-2-æ›´æ–°åçš„è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ›´æ–°åçš„è¡Œä¸º"><span>ç¤ºä¾‹ 2 - æ›´æ–°åçš„è¡Œä¸º</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dns</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™é‡Œç”±äºæŸç§åŸå›  hostname è¢«è®¾ç½®ä¸º undefinedã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dns</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lookup</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ä¼šæ‰“å°ä¸€ä¸ªé”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  else</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;IP åœ°å€:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°ç‰ˆæœ¬çš„ Node.js ä¸­ï¼ŒåŒæ ·çš„ä»£ç ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸º <code>hostname</code> æ˜¯ <code>undefined</code>ï¼Œè¿™è¡¨æ˜ä½ ä¸åº”è¯¥ä¼ é€’ä¸€ä¸ªå‡å€¼ç»™ <code>dns.lookup()</code>ã€‚</p><h3 id="å¦‚ä½•æ­£ç¡®ä½¿ç”¨-dns-lookup" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æ­£ç¡®ä½¿ç”¨-dns-lookup"><span>å¦‚ä½•æ­£ç¡®ä½¿ç”¨ <code>dns.lookup()</code></span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dns</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¼ é€’ä¸€ä¸ªæœ‰æ•ˆçš„ä¸»æœºåã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hostname</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;www.google.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dns</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lookup</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  else</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;IP åœ°å€:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†ä¼šæ‰“å° Google çš„ IP åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ªæœ‰æ•ˆçš„åŸŸå <code>&#39;www.google.com&#39;</code> ç»™ <code>dns.lookup()</code> å‡½æ•°ï¼Œå®ƒæ­£ç¡®è¿”å›äº† Google çš„ IP åœ°å€ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼ŒDEP0118 æé†’å¼€å‘è€…æ³¨æ„ï¼Œä¸åº”è¯¥å†å‘ <code>dns.lookup()</code> ä¼ é€’ falsy ä¸»æœºåå€¼ï¼Œå¦åˆ™å‡½æ•°ä¼šæŠ›å‡ºé”™è¯¯ã€‚è¿™ä¸ªæ”¹åŠ¨æœ‰åŠ©äºé¿å…æ½œåœ¨çš„æ··ä¹±ï¼Œå¹¶è¦æ±‚å¼€å‘è€…æ˜ç¡®ä»–ä»¬æƒ³è¦æŸ¥è¯¢çš„ä¸»æœºåã€‚</p><h3 id="dep0119-process-binding-uv-errname-private-api" tabindex="-1"><a class="header-anchor" href="#dep0119-process-binding-uv-errname-private-api"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0119" target="_blank" rel="noopener noreferrer">DEP0119: process.binding(&#39;uv&#39;).errname() private API</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>process.binding()</code> æ˜¯ä¸€ä¸ªä¸æ¨èä½¿ç”¨çš„å†…éƒ¨ APIï¼Œå®ƒç”¨äºè®¿é—® Node.js çš„å†…éƒ¨ C++ æ¨¡å—ã€‚è¿™ä¸ª API ä¸»è¦æ˜¯ä¾› Node.js æ ¸å¿ƒå¼€å‘è€…ä½¿ç”¨ï¼Œè€Œä¸æ˜¯æ™®é€šçš„ JavaScript å¼€å‘è€…ã€‚</p><p><code>process.binding(&#39;uv&#39;)</code> ä¼šè¿”å› libuv çš„ç»‘å®šï¼Œlibuv æ˜¯ Node.js åº•å±‚ä½¿ç”¨çš„ä¸€ä¸ªè·¨å¹³å°çš„å¼‚æ­¥ I/O åº“ã€‚é€šè¿‡è¿™ä¸ªç»‘å®šï¼Œå¯ä»¥ç›´æ¥è®¿é—® libuv æä¾›çš„å„ç§åŠŸèƒ½å’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p><p><code>errname()</code> å‡½æ•°æ˜¯ç”¨æ¥å°† libuv ä¸­çš„é”™è¯¯ä»£ç è½¬æ¢ä¸ºå¯è¯»çš„é”™è¯¯åçš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ª libuv çš„é”™è¯¯ä»£ç  <code>UV_EAGAIN</code>ï¼Œä½¿ç”¨ <code>errname()</code> å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ›´å…·å¯è¯»æ€§çš„é”™è¯¯åï¼Œæ¯”å¦‚ <code>&quot;EAGAIN&quot;</code>ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>DEP0119</code> æ˜¯ä¸€ä¸ªè­¦å‘Šï¼Œè¡¨ç¤º <code>process.binding(&#39;uv&#39;).errname()</code> è¿™ä¸ªç‰¹å®šçš„ç§æœ‰ API è¢«å¼ƒç”¨äº†ã€‚å¼ƒç”¨æ„å‘³ç€æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­è¿™ä¸ª API å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œå› æ­¤ï¼Œä¸åº”è¯¥å†ä½¿ç”¨å®ƒã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºç›´æ¥è®¿é—®å†…éƒ¨çš„ API å¯èƒ½ä¼šå¯¼è‡´ä»£ç ä¸æœªæ¥ç‰ˆæœ¬çš„ Node.js ä¸å…¼å®¹ã€‚</p><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</p><p>ç”±äº <code>errname()</code> å‡½æ•°æ˜¯ä¸€ä¸ªç§æœ‰ API å¹¶ä¸”å·²è¢«å¼ƒç”¨ï¼Œä½œä¸ºæ™®é€šçš„ Node.js å¼€å‘è€…ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚ç›¸åï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨å…¬å…±çš„ã€ç¨³å®šçš„ API æ¥å¤„ç†é”™è¯¯ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­å¤„ç†æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„é”™è¯¯ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°è¯•è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;éå­˜åœ¨çš„æ–‡ä»¶.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨è¿™é‡Œå¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // err.code ä¸­åŒ…å«äº†é”™è¯¯ç ï¼Œæ¯”å¦‚ &#39;ENOENT&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ENOENT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é”™è¯¯åŸå› : æ–‡ä»¶æ‰¾ä¸åˆ°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¾“å‡ºæ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°è¯•è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼ˆå¦‚æ–‡ä»¶æ‰¾ä¸åˆ°ï¼‰ï¼ŒNode.js ä¼šå›è°ƒå‡½æ•°ä¼ é€’ä¸€ä¸ª <code>Error</code> å¯¹è±¡ç»™ <code>err</code> å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥ <code>err.message</code> å’Œ <code>err.code</code> æ¥è·å–é”™è¯¯ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯ç»™ç”¨æˆ·æä¾›æœ‰ç”¨çš„åé¦ˆã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºå¤§å¤šæ•°ç¼–ç¨‹æ–°æ‰‹è€Œè¨€ï¼Œæ— éœ€æ‹…å¿ƒ <code>process.binding(&#39;uv&#39;).errname()</code> è¿™æ ·çš„åº•å±‚ APIï¼Œå› ä¸º Node.js æä¾›äº†ç¨³å®šä¸”æ˜“äºç†è§£çš„æ–¹å¼æ¥å¤„ç†é”™è¯¯å’Œå¼‚å¸¸ã€‚ä¸“æ³¨äºå­¦ä¹ è¿™äº›æ ‡å‡†çš„æ–¹æ³•ï¼Œå°†ä½¿ä½ èƒ½å¤Ÿç¼–å†™æ›´åŠ å¥å£®å’Œå…¼å®¹æœªæ¥ç‰ˆæœ¬çš„ Node.js ä»£ç ã€‚</p><h3 id="dep0120-windows-performance-counter-support" tabindex="-1"><a class="header-anchor" href="#dep0120-windows-performance-counter-support"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0120" target="_blank" rel="noopener noreferrer">DEP0120: Windows Performance Counter support</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰æ—¶ä¼šæœ‰åŠŸèƒ½çš„å¼ƒç”¨ï¼ˆDeprecationï¼‰ï¼Œè¿™æ„å‘³ç€è¿™äº›åŠŸèƒ½å³å°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–è€…æ›¿æ¢ï¼Œå› æ­¤ä¸å»ºè®®å¼€å‘è€…ç»§ç»­ä½¿ç”¨å®ƒä»¬ã€‚</p><p>åœ¨ Node.js çš„æŸä¸ªç‰ˆæœ¬æ›´æ–°ä¸­ï¼Œå¯èƒ½ä¼šåŒ…å«ä¸€é¡¹å«åš &quot;DEP0120: Windows Performance Counter support&quot; çš„å¼ƒç”¨è­¦å‘Šã€‚è¿™ä¸ªå¼ƒç”¨è­¦å‘Šæ˜¯é’ˆå¯¹ Windows ç³»ç»Ÿä¸Š Node.js çš„ä¸€ä¸ªç‰¹å®šåŠŸèƒ½â€”â€”Windows æ€§èƒ½è®¡æ•°å™¨æ”¯æŒã€‚</p><p>Windows æ€§èƒ½è®¡æ•°å™¨æ˜¯ Windows ç³»ç»Ÿç”¨æ¥ç›‘æ§å’Œè®°å½•ç³»ç»Ÿæ€§èƒ½æ•°æ®çš„å·¥å…·ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜å ç”¨ã€ç£ç›˜ I/Oã€ç½‘ç»œæ´»åŠ¨ç­‰ã€‚åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¯èƒ½æä¾›äº†é›†æˆè¿™ç§æ€§èƒ½è®¡æ•°å™¨çš„æ¥å£ï¼Œä½¿å¾—ä½ å¯ä»¥åœ¨è¿è¡Œ Node.js åº”ç”¨æ—¶ï¼Œé€šè¿‡ Windows çš„æ€§èƒ½ç›‘è§†å™¨æ¥æŸ¥çœ‹ä½ çš„ Node.js åº”ç”¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä»¥å‰çš„ Node.js ç‰ˆæœ¬ä¸Šè¿è¡Œä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ å¯èƒ½å¯ä»¥æ‰“å¼€ Windows æ€§èƒ½ç›‘è§†å™¨ï¼Œæ·»åŠ ä¸€äº›å…³äº Node.js çš„è®¡æ•°å™¨ï¼Œç„¶åå®æ—¶åœ°è§‚å¯Ÿå½“æœ‰å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨çš„ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä½•å˜åŒ–ã€‚</p><p>ç„¶è€Œï¼Œéšç€ Node.js v21.7.1 çš„å‘å¸ƒï¼Œ&quot;DEP0120: Windows Performance Counter support&quot; è¡¨ç¤ºè¿™ç§é›†æˆ Windows æ€§èƒ½è®¡æ•°å™¨çš„æ”¯æŒå·²ç»è¢«å®˜æ–¹æ ‡è®°ä¸ºã€å¼ƒç”¨ã€‘ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¿™é¡¹åŠŸèƒ½å¯èƒ½ä¸è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…ç»´æŠ¤è¿™é¡¹åŠŸèƒ½çš„æˆæœ¬æ¯”å…¶å¸¦æ¥çš„å¥½å¤„è¦é«˜ã€‚</p><p>è¿™æ„å‘³ç€åœ¨æœªæ¥ Node.js çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™é¡¹åŠŸèƒ½å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ï¼Œæ‰€ä»¥å¦‚æœä½ æ­£åœ¨ä¾èµ–è¿™ä¸ªç‰¹æ€§æ¥ç›‘æ§ä½ çš„ Node.js åº”ç”¨ï¼Œä½ éœ€è¦å¼€å§‹è€ƒè™‘å¯»æ‰¾æ›¿æ¢æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¶ä»–çš„ç›‘æ§å·¥å…·ï¼Œæ¯”å¦‚ New Relic, Datadog æˆ–è€… Prometheus ç­‰ï¼Œè¿™äº›éƒ½æ˜¯æµè¡Œçš„åº”ç”¨æ€§èƒ½ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬å¯ä»¥æä¾›ç±»ä¼¼ç”šè‡³æ›´ä¸°å¯Œçš„æ€§èƒ½ç›‘æµ‹æ•°æ®ï¼Œå¹¶ä¸”å®ƒä»¬é€šå¸¸ä¸ Node.js å’Œå„ç§æ“ä½œç³»ç»Ÿå…¼å®¹ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œâ€œDEP0120: Windows Performance Counter supportâ€å°±æ˜¯å‘Šè¯‰ä½ ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼ŒWindows æ€§èƒ½è®¡æ•°å™¨çš„æ”¯æŒå·²ç»æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œæœªæ¥å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œå› æ­¤ä½ éœ€è¦å¼€å§‹è§„åˆ’ä½¿ç”¨å…¶ä»–ç›‘æ§å·¥å…·æ¥å–ä»£å®ƒã€‚</p><h3 id="dep0121-net-setsimultaneousaccepts" tabindex="-1"><a class="header-anchor" href="#dep0121-net-setsimultaneousaccepts"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0121" target="_blank" rel="noopener noreferrer">DEP0121: net._setSimultaneousAccepts()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ DEP0121 è¿™ä¸ªåºŸå¼ƒè­¦å‘Šã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…éƒ¨æ¨¡å—å«åš <code>net</code>ï¼Œå®ƒä¸»è¦ç”¨äºç½‘ç»œæ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œè¿™ä¸ª <code>net</code> æ¨¡å—æä¾›äº†ä¸€ä¸ª <code>_setSimultaneousAccepts</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥ä¼˜åŒ–æœåŠ¡å™¨æ€§èƒ½çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨ Windows ç³»ç»Ÿä¸Šã€‚</p><p>å½“ä½ è¿è¡Œä¸€ä¸ªåŸºäº TCP çš„æœåŠ¡å™¨æ—¶ï¼ˆæ¯”å¦‚ä½¿ç”¨ HTTP åè®®ï¼‰ï¼ŒæœåŠ¡å™¨éœ€è¦æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚åœ¨ Windows ç³»ç»Ÿä¸Šï¼ŒLibuvï¼ˆè¿™æ˜¯ Node.js ç”¨æ¥å¤„ç†å¼‚æ­¥äº‹ä»¶çš„åº“ï¼‰ä¼šé»˜è®¤å¼€å¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå«åšâ€œå¤šé‡æ¥å—â€ï¼ˆsimultaneous acceptsï¼‰ï¼Œè¿™ä¸ªåŠŸèƒ½å…è®¸ç³»ç»ŸåŒæ—¶æ¥å—å¤šä¸ªè¿æ¥ï¼Œè€Œä¸æ˜¯ä¾æ¬¡ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å¤„ç†ï¼Œè¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ã€‚</p><p>ä½†æ˜¯ï¼Œ<code>_setSimultaneousAccepts</code> æ˜¯ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œå¹¶ä¸æ˜¯ç»™æ™®é€šç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„ã€‚å®ƒå‰é¢çš„ä¸‹åˆ’çº¿ <code>_</code> å°±æš—ç¤ºäº†è¿™æ˜¯ä¸€ä¸ªç§æœ‰çš„ã€éå…¬å¼€çš„ APIã€‚è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯ Node.js å†…éƒ¨ä½¿ç”¨ï¼Œæˆ–è€…æ˜¯ä¸€äº›æ‰©å±•æ ¸å¿ƒåŠŸèƒ½çš„æ¨¡å—ä½¿ç”¨çš„ã€‚</p><p>åœ¨ Node.js ç‰ˆæœ¬ v21.7.1 ä¸­ï¼Œè¿™ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆDEP0121ï¼‰ï¼Œæ„å‘³ç€å®ƒå°†åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­è¢«ç§»é™¤æ‰ã€‚åŸå› å¯èƒ½æ˜¯å› ä¸º Node.js çš„å¼€å‘è€…ä»¬è§‰å¾—è¿™ä¸ªå‡½æ•°ä¸åº”è¯¥ç”±ç”¨æˆ·ç›´æ¥è°ƒç”¨ï¼Œæˆ–è€…ä»–ä»¬å·²ç»æ‰¾åˆ°äº†æ›´å¥½çš„æ–¹æ³•æ¥è‡ªåŠ¨å¤„ç†è¿™ç§ä¼˜åŒ–ã€‚</p><p>ç°åœ¨ï¼Œä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œå®é™…ä¸Šä½ ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªåºŸå¼ƒçš„å‡½æ•°ã€‚å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¼€å‘ web åº”ç”¨æˆ–è€…å…¶ä»–ç½‘ç»œåº”ç”¨æ—¶ï¼Œä¼šä½¿ç”¨æ›´é«˜å±‚çš„ APIï¼Œæ¯”å¦‚ <code>http.createServer()</code> æ¥åˆ›å»º HTTP æœåŠ¡å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTP æœåŠ¡å™¨å¹¶è®¾ç½®è¯·æ±‚å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®©æœåŠ¡å™¨ç›‘å¬ 8080 ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://127.0.0.1:8080/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨ä»»ä½• <code>net</code> æ¨¡å—çš„ä½å±‚ APIï¼ŒåŒ…æ‹¬ <code>_setSimultaneousAccepts</code> å‡½æ•°ã€‚Node.js ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†èƒŒåçš„ç½‘ç»œä¼˜åŒ–ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>net._setSimultaneousAccepts()</code> æ˜¯ä¸€ä¸ªåºŸå¼ƒçš„å†…éƒ¨å‡½æ•°ï¼Œç”¨äºä¼˜åŒ–æœåŠ¡å™¨æ€§èƒ½ï¼Œä½†å¯¹äºå¤§å¤šæ•° Node.js å¼€å‘è€…æ¥è¯´ï¼Œå®ƒæ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦å…³å¿ƒå®ƒã€‚åªè¦ä½ ä½¿ç”¨æ ‡å‡†çš„ Node.js é«˜çº§ APIï¼Œæ¯”å¦‚ <code>http.createServer()</code>ï¼Œå°±å¯ä»¥å¼€å‘ç½‘ç»œåº”ç”¨äº†ã€‚</p><h3 id="dep0122-tls-server-prototype-setoptions" tabindex="-1"><a class="header-anchor" href="#dep0122-tls-server-prototype-setoptions"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0122" target="_blank" rel="noopener noreferrer">DEP0122: tls Server.prototype.setOptions()</a></span></a></h3><p>Node.js ä¸­çš„ DEP0122 æ˜¯ä¸€ä¸ªå…³äºå¼ƒç”¨ï¼ˆå³å°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­åˆ é™¤æˆ–åœæ­¢æ”¯æŒï¼‰ç‰¹å®š API çš„æ ‡è¯†ã€‚è¿™é‡Œï¼Œ<code>tls.Server.prototype.setOptions()</code>æ–¹æ³•æ˜¯è¢«å¼ƒç”¨çš„é‚£ä¸ª APIã€‚</p><p><code>tls</code>æ¨¡å—æ˜¯ Node.js çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒæä¾›äº† Transport Layer Securityï¼ˆTLSï¼‰å’Œ Secure Socket Layerï¼ˆSSLï¼‰åè®®çš„å®ç°ï¼Œè¿™äº›åè®®ä¸»è¦ç”¨äºåœ¨ç½‘ç»œé€šä¿¡ä¸­æä¾›åŠ å¯†åŠŸèƒ½å’Œå®‰å…¨èº«ä»½éªŒè¯ã€‚</p><p><code>tls.Server</code>æ˜¯ä¸€ä¸ªç±»ï¼Œç”¨äºåˆ›å»º TLS/SSL æœåŠ¡å™¨ã€‚è€Œ<code>setOptions()</code>æ–¹æ³•æ˜¯è¯¥æœåŠ¡å™¨å¯¹è±¡ä¸Šçš„ä¸€ä¸ªæ—§æ–¹æ³•ï¼Œå®ƒå…è®¸ä½ åŠ¨æ€åœ°è®¾ç½®ä¸€äº›é€‰é¡¹ï¼Œå¦‚è¯ä¹¦ä¿¡æ¯ç­‰ã€‚</p><p>å¼ƒç”¨<code>tls.Server.prototype.setOptions()</code>æ„å‘³ç€ Node.js å¼€å‘å›¢é˜Ÿè®¤ä¸ºè¿™ä¸ªæ–¹æ³•ä¸å†æ˜¯æœ€ä½³å®è·µï¼Œå¯èƒ½æœ‰æ›´å¥½çš„æ–¹æ³•æ¥è®¾ç½®é€‰é¡¹ï¼Œæˆ–è€…åŸæœ‰æ–¹å¼å­˜åœ¨æŸäº›é—®é¢˜ï¼Œæ¯”å¦‚å¯èƒ½å¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ã€å®‰å…¨æ€§ä¸é«˜ç­‰ã€‚</p><p>ä» v21.7.1 å¼€å§‹ï¼Œå¦‚æœä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†<code>setOptions()</code>æ–¹æ³•ï¼Œè™½ç„¶ç›®å‰å®ƒä»ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æœªæ¥ç‰ˆæœ¬çš„ Node.js ä¸­å°±å¯èƒ½ä¸å†æ”¯æŒã€‚ä½ éœ€è¦æ›´æ–°ä½ çš„ä»£ç ä»¥é¿å…ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­è¯´æ˜å¦‚ä½•æ›¿ä»£è¿™ä¸ªæ–¹æ³•ï¼š</p><p>å‡è®¾ä½ åœ¨æ—§ç‰ˆ Node.js ä»£ç ä¸­æœ‰ä»¥ä¸‹ä½¿ç”¨<code>setOptions()</code>çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®æœåŠ¡å™¨é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé€šè¿‡<code>setOptions()</code>æ–¹æ³•åŠ¨æ€è®¾ç½®äº†æœåŠ¡å™¨çš„å¯†ç å¥—ä»¶ã€‚ç”±äºè¿™ç§åšæ³•è¢«å¼ƒç”¨ï¼Œä½ åº”è¯¥æ”¹ä¸ºåœ¨åˆ›å»ºæœåŠ¡å™¨æ—¶å°±ä¼ é€’æ‰€æœ‰å¿…è¦çš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›´æ¥åœ¨é€‰é¡¹ä¸­è®¾ç½®å¯†ç å¥—ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºæœåŠ¡å™¨æ—¶ä¼ å…¥æ‰€æœ‰é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±åœ¨<code>options</code>å¯¹è±¡é‡Œè®¾ç½®äº†<code>ciphers</code>å±æ€§ï¼Œè¿™æ ·åˆ›å»º TLS æœåŠ¡å™¨æ—¶å°±ä¸éœ€è¦å†è°ƒç”¨<code>setOptions()</code>æ–¹æ³•ã€‚è¿™ä½¿å¾—ä»£ç æ›´æ¸…æ™°ï¼Œä¹Ÿæ›´ç¬¦åˆæœªæ¥ Node.js ç‰ˆæœ¬çš„æ¨èåšæ³•ã€‚</p><h3 id="dep0123-setting-the-tls-servername-to-an-ip-address" tabindex="-1"><a class="header-anchor" href="#dep0123-setting-the-tls-servername-to-an-ip-address"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0123" target="_blank" rel="noopener noreferrer">DEP0123: setting the TLS ServerName to an IP address</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="tls-å’Œ-servername" tabindex="-1"><a class="header-anchor" href="#tls-å’Œ-servername"><span>TLS å’Œ ServerName</span></a></h3><p>TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰åè®®æ˜¯ç”¨æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹åŠ å¯†è¿æ¥çš„ä¸€ç§åè®®ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªå«åš Server Name Indicationï¼ˆSNIï¼‰çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯åœ¨æ¡æ‰‹æ—¶å‘Šè¯‰æœåŠ¡å™¨å®ƒæƒ³è¦è¿æ¥åˆ°çš„ä¸»æœºåï¼ˆæ¯”å¦‚è¯´æ˜¯ &quot;<a href="http://www.example.com" target="_blank" rel="noopener noreferrer">www.example.com</a>&quot;ï¼‰ã€‚è¿™å¯¹äºæœåŠ¡å™¨æ¥è¯´å¾ˆé‡è¦ï¼Œç‰¹åˆ«æ˜¯å½“æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªåŸŸåï¼ˆæ‰€è°“çš„è™šæ‹Ÿä¸»æœºï¼‰æ—¶ï¼Œå®ƒéœ€è¦çŸ¥é“å®¢æˆ·ç«¯è¯·æ±‚çš„æ˜¯å“ªä¸ªåŸŸåï¼Œä»¥ä¾¿æä¾›æ­£ç¡®çš„å®‰å…¨è¯ä¹¦ã€‚</p><h3 id="ip-åœ°å€ä¸å†è¢«æ”¯æŒä½œä¸º-servername" tabindex="-1"><a class="header-anchor" href="#ip-åœ°å€ä¸å†è¢«æ”¯æŒä½œä¸º-servername"><span>IP åœ°å€ä¸å†è¢«æ”¯æŒä½œä¸º ServerName</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ TLS æ¨¡å—åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„æœåŠ¡å™¨æ—¶ï¼Œä½ é€šå¸¸ä¼šè®¾ç½®ä¸€äº›é€‰é¡¹ï¼ŒåŒ…æ‹¬<code>servername</code>ã€‚åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ª<code>servername</code>è®¾ç½®æˆä¸€ä¸ª IP åœ°å€ï¼Œä½†æ˜¯è¿™å…¶å®æ˜¯ä¸ç¬¦åˆæ ‡å‡†çš„ï¼Œå› ä¸º SNI çš„è®¾è®¡å°±æ˜¯ç”¨æ¥æŒ‡å®šåŸŸåçš„ï¼Œè€Œä¸æ˜¯ IP åœ°å€ã€‚</p><p>ä» Node.js v21.7.1 å¼€å§‹ï¼Œå¦‚æœä½ å°è¯•å°†<code>servername</code>è®¾ç½®ä¸ºä¸€ä¸ª IP åœ°å€ï¼ŒNode.js ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼ˆDEP0123ï¼‰ã€‚è¿™æ„å‘³ç€åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§åšæ³•å¯èƒ½ä¼šå®Œå…¨ä¸è¢«æ”¯æŒã€‚è¿™ä¸ªæ”¹å˜çš„ç›®çš„æ˜¯æ¨åŠ¨å¼€å‘è€…éµå¾ªæ­£ç¡®çš„ TLS æ ‡å‡†ï¼Œå¹¶ç¡®ä¿è½¯ä»¶çš„è¡Œä¸ºä¸å…¶ä»–ç¯å¢ƒå’Œåº“ä¿æŒä¸€è‡´ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js çš„åº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ã€‚åœ¨æ—§ç‰ˆæœ¬çš„åšæ³•ä¸­ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å†™ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  servername</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;192.168.1.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ æ›¾ç»è®¾ç½®äº†IPåœ°å€ä½œä¸ºServerName</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†åœ¨ Node.js v21.7.1 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œä½ ä¼šæ”¶åˆ°ä¸€ä¸ªå…³äº DEP0123 çš„åºŸå¼ƒè­¦å‘Šã€‚æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯å»æ‰<code>servername</code>å±æ€§æˆ–è€…ç¡®ä¿å®ƒæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„åŸŸåï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸å†è®¾ç½®servernameä¸ºIPåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…¶ä»–ä»£ç ä¸å˜...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œè¿™æ¬¡çš„åºŸå¼ƒé€šçŸ¥æ˜¯è®©å¼€å‘è€…æ³¨æ„åˆ°ä¸åº”è¯¥å†ä½¿ç”¨ IP åœ°å€ä½œä¸º TLS è¿æ¥çš„<code>servername</code>ã€‚è¿™æ˜¯ä¸ºäº†æ›´å¥½åœ°éµå¾ªå®‰å…¨åè®®çš„æ ‡å‡†ä»¥åŠä¸ºäº†å°†æ¥çš„å…¼å®¹æ€§ã€‚å¦‚æœä½ çš„ä»£ç ä¸­æœ‰è¿™æ ·çš„ç”¨æ³•ï¼Œä½ åº”è¯¥å°½å¿«æ›´æ–°å®ƒï¼Œä»¥é¿å…å°†æ¥çš„é—®é¢˜ã€‚</p><h3 id="dep0124-using-replserver-rli" tabindex="-1"><a class="header-anchor" href="#dep0124-using-replserver-rli"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0124" target="_blank" rel="noopener noreferrer">DEP0124: using REPLServer.rli</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript å¼€å‘æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºã€‚åœ¨ Node.js çš„ä¸åŒç‰ˆæœ¬ä¸­ï¼Œä¼šæœ‰äº›åŠŸèƒ½å˜æ›´ï¼ŒåŒ…æ‹¬æ·»åŠ æ–°ç‰¹æ€§ã€æ”¹è¿›æ—§ç‰¹æ€§æˆ–è€…å¼ƒç”¨ä¸€äº›å·²ç»è¢«è®¤ä¸ºä¸å†ç†æƒ³çš„ç‰¹æ€§ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œâ€œå¼ƒç”¨â€(Deprecation)é€šå¸¸æ„å‘³ç€æŸä¸ªç‰¹æ€§å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–æ”¹å˜ï¼Œå¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨è¯¥ç‰¹æ€§ï¼Œå¹¶ä¸”é€æ­¥è¿ç§»åˆ°æ›¿ä»£æ–¹æ¡ˆã€‚</p><h3 id="dep0124-å¼ƒç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#dep0124-å¼ƒç”¨è¯´æ˜"><span>DEP0124 å¼ƒç”¨è¯´æ˜</span></a></h3><p><code>DEP0124</code> æŒ‡çš„æ˜¯ Node.js å†³å®šå¼ƒç”¨ <code>REPLServer.rli</code> å±æ€§çš„ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šã€‚<code>REPLServer</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªèƒ½å¤Ÿè®©ç”¨æˆ·äº¤äº’å¼åœ°æ‰§è¡Œ JavaScript ä»£ç çš„ç•Œé¢ã€‚ç®€å•æ¥è¯´ï¼Œè¿™å°±åƒæ˜¯æµè§ˆå™¨ä¸­çš„æ§åˆ¶å°ï¼Œä½ å¯ä»¥è¾“å…¥ä»£ç ï¼Œå¹¶ç«‹å³çœ‹åˆ°ç»“æœã€‚</p><p>åœ¨æ—©æœŸçš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œ<code>REPLServer</code> å®ä¾‹æœ‰ä¸€ä¸ªåä¸º <code>rli</code> çš„å±æ€§ï¼Œå®ƒå®é™…ä¸Šæ˜¯å¯¹å†…éƒ¨ readline æ¥å£ï¼ˆä¸€ä¸ªç”¨äºå¤„ç†è¯»å–ç”¨æˆ·è¾“å…¥çš„æ¥å£ï¼‰çš„å¼•ç”¨ã€‚ä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒNode.js å›¢é˜Ÿå‘ç°ç›´æ¥æš´éœ²è¿™ä¸ªå†…éƒ¨æ¥å£ç»™å¤–éƒ¨ä½¿ç”¨å¹¶ä¸ç†æƒ³ã€‚</p><p>å› æ­¤ï¼Œåœ¨ v21.7.1 ç‰ˆæœ¬ä¸­ï¼ŒNode.js æ ‡è®°äº† <code>REPLServer.rli</code> ä¸ºå¼ƒç”¨çŠ¶æ€ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…ä»¬ä¸åº”è¯¥å†ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥è¾¾åˆ°ç±»ä¼¼çš„ç›®çš„ã€‚å³ä½¿åœ¨å½“å‰ç‰ˆæœ¬ä¸­ <code>REPLServer.rli</code> ä»ç„¶å¯ç”¨ï¼Œä½†åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬æ›´æ–°ä¸­ï¼Œå®ƒå¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><h3 id="å¦‚ä½•åº”å¯¹å¼ƒç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åº”å¯¹å¼ƒç”¨"><span>å¦‚ä½•åº”å¯¹å¼ƒç”¨</span></a></h3><p>å¦‚æœæ‚¨çš„ä»£ç ä¸­ä½¿ç”¨äº† <code>REPLServer.rli</code> ï¼Œæ‚¨éœ€è¦ä¿®æ”¹æ‚¨çš„ä»£ç ä»¥ç¡®ä¿å…¶ä¸æœªæ¥ç‰ˆæœ¬çš„ Node.js å…¼å®¹ã€‚å…·ä½“çš„æ›¿æ¢æ–¹æ³•é€šå¸¸ä¼šåœ¨å®˜æ–¹æ–‡æ¡£æˆ–è€…å¼ƒç”¨è­¦å‘Šä¸­æä¾›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¹‹å‰æ˜¯é€šè¿‡ <code>replServer.rli</code> æ¥ç›‘å¬ <code>line</code> äº‹ä»¶ï¼Œä½ å¯ä»¥æ”¹ç”¨ <code>replServer</code> ç›´æ¥ç›‘å¬è¿™ä¸ªäº‹ä»¶ã€‚</p><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ åœ¨ä½¿ç”¨ REPLServer åˆ›å»ºäº†ä¸€ä¸ªäº¤äº’å¼å‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸”ä½ è®¢é˜…äº†ç”¨æˆ·è¾“å…¥äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> replServer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&gt; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼ƒç”¨çš„ä½¿ç”¨æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">replServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rli</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†éµå¾ªæ–°çš„çº¦å®šå¹¶é¿å…ä½¿ç”¨å¼ƒç”¨çš„å±æ€§ï¼Œä½ åº”è¯¥ç›´æ¥åœ¨ <code>replServer</code> ä¸Šè®¾ç½®äº‹ä»¶ç›‘å¬å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> replServer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&gt; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ›´æ–°åçš„ä½¿ç”¨æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">replServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»è€Œè¨€ä¹‹ï¼ŒDEP0124 æ˜¯ Node.js åœ¨å…¶ç‰ˆæœ¬æ›´æ–°ä¸­é€šçŸ¥ç”¨æˆ· <code>REPLServer.rli</code> å·²ç»è¢«å¼ƒç”¨çš„ä¸€ç§æ–¹å¼ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨åº”å½“å…³æ³¨è¿™æ ·çš„å¼ƒç”¨è­¦å‘Šï¼Œå¹¶æ›´æ–°æ‚¨çš„ä»£ç ä»¥ç¡®ä¿å®ƒèƒ½å¤Ÿåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­æ­£å¸¸å·¥ä½œã€‚</p><h3 id="dep0125-require-node-stream-wrap" tabindex="-1"><a class="header-anchor" href="#dep0125-require-node-stream-wrap"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0125" target="_blank" rel="noopener noreferrer">DEP0125: require(&#39;node:_stream_wrap&#39;)</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;DEP0125&quot; æ˜¯ä¸€ä¸ªå®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šä»£ç ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>require(&#39;node:_stream_wrap&#39;)</code> è¡¨ç¤ºè¿™ä¸ªç‰¹å®šæ¨¡å—æˆ–è€…åŠŸèƒ½å·²ç»è¢« Node.js å®˜æ–¹æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼ˆå³â€œå¼ƒç”¨â€ï¼‰ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>è¦ç†è§£è¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œæˆ‘ä»¬å…ˆå¾—äº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>: ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå¯ä»¥è®©ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>æ¨¡å—</strong>: åœ¨ Node.js ä¸­ï¼Œæ¨¡å—æ˜¯ä¸€ç§åŒ…å«å‡½æ•°å’Œå¯¹è±¡çš„æ–‡ä»¶ï¼Œå¯ä»¥è¢«å…¶ä»– Node.js ç¨‹åºå¼•å…¥å’Œä½¿ç”¨ã€‚</li><li><strong>æµï¼ˆStreamsï¼‰</strong>: åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æŠ½è±¡æ¥å£ã€‚æ¯”å¦‚ï¼Œå½“ä½ è¦ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–è€…å†™æ•°æ®åˆ°æ–‡ä»¶æ—¶ï¼Œä½ ä¼šç”¨åˆ°æµã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…·ä½“è°ˆè°ˆ <code>require(&#39;node:_stream_wrap&#39;)</code>ã€‚è¿™ä¸ªè°ƒç”¨æœ¬è´¨ä¸Šæ˜¯åœ¨ Node.js ç¨‹åºä¸­è¯·æ±‚æŸä¸ªè¢«ç§°ä½œ <code>_stream_wrap</code> çš„å†…éƒ¨æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æ˜¯ Node.js å†…éƒ¨ç”¨æ¥å¸®åŠ©å¼€å‘è€…æ›´æ–¹ä¾¿åœ°å¤„ç†åº•å±‚æµæ“ä½œçš„å·¥å…·ã€‚ä½†æ˜¯ä½ éœ€è¦çŸ¥é“ï¼Œä»¥ä¸‹åˆ’çº¿ (<code>_</code>) å¼€å¤´çš„æ¨¡å—åœ¨ Node.js ä¸­é€šå¸¸æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªç§æœ‰æˆ–å†…éƒ¨æ¨¡å—ï¼Œè€Œä¸”å¯èƒ½ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦åœ¨ä½ çš„ç”Ÿäº§ä»£ç ä¸­ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p><p>å¼ƒç”¨é€šçŸ¥ &quot;DEP0125&quot; å‘Šè¯‰å¼€å‘è€…ï¼Œ<code>_stream_wrap</code> æ¨¡å—å°†ä¸å†å—åˆ°æ”¯æŒï¼Œå¹¶ä¸”æé†’ä»–ä»¬åº”è¯¥å¯»æ‰¾æ›¿ä»£çš„æ–¹å¼æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚è¿™æ˜¯ Node.js ç»´æŠ¤è€…ç®¡ç† API å˜åŒ–çš„ä¸€ç§æ–¹å¼ï¼Œç¡®ä¿ Node.js çš„æ ¸å¿ƒåº“èƒ½å¤Ÿç¨³å®šå’Œå®‰å…¨åœ°æ¼”è¿›ã€‚</p><p>å®é™…è¿ç”¨ä¾‹å­ï¼š<br> å‡è®¾è¿‡å»ä½ æœ‰ä¸€ä¸ªä½¿ç”¨ <code>_stream_wrap</code> çš„ Node.js åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä½¿ç”¨è¿™ä¸ªæ¨¡å—æ¥åˆ›å»ºè‡ªå®šä¹‰çš„æµå¤„ç†åŠŸèƒ½ã€‚ç”±äºè¿™ä¸ªæ¨¡å—è¢«å¼ƒç”¨äº†ï¼Œå¦‚æœä½ ç»§ç»­ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆå½“ä½ å‡çº§åˆ°æœªæ¥çš„ Node.js ç‰ˆæœ¬æ—¶ï¼Œä½ çš„ä»£ç å¯èƒ½å°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚</p><p>æ›¿ä»£æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨å®˜æ–¹çš„ <code>stream</code> æ¨¡å—ï¼Œè¿™æ˜¯ Node.js æä¾›çš„ç”¨äºå¤„ç†æµçš„å…¬å…±æ¨¡å—ã€‚</li><li>å¦‚æœä½ éœ€è¦çš„åŠŸèƒ½åœ¨ <code>stream</code> æ¨¡å—ä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦æŸ¥é˜… Node.js çš„æ›´æ–°æ–‡æ¡£ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ–°çš„å®˜æ–¹æ¨èæ–¹æ³•æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</li><li>å¦‚æœå¼ƒç”¨æ¶‰åŠåˆ°çš„åŠŸèƒ½å¾ˆå…³é”®ï¼Œä¹Ÿå¯ä»¥æš‚æ—¶é¿å…å‡çº§åˆ°æ›´é«˜çš„ Node.js ç‰ˆæœ¬ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚</li></ul><p>æ€»ä¹‹ï¼Œé¢å¯¹å¼ƒç”¨é€šçŸ¥ï¼Œæœ€é‡è¦çš„æ˜¯è¦æ³¨æ„è¿½è¸ª Node.js çš„æ›´æ–°æ—¥å¿—å’Œæ–‡æ¡£ï¼Œä»¥ä¾¿åŠæ—¶è¿›è¡Œä»£ç æ›´æ–°ã€‚</p><h3 id="dep0126-timers-active" tabindex="-1"><a class="header-anchor" href="#dep0126-timers-active"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0126" target="_blank" rel="noopener noreferrer">DEP0126: timers.active()</a></span></a></h3><p>å½“ä½ çœ‹åˆ°<code>DEP0126: timers.active()</code>è¿™æ ·çš„ä¿¡æ¯ï¼Œå®ƒæ¶‰åŠåˆ° Node.js ä¸­çš„ä¸€ä¸ªç‰¹å®šåŠŸèƒ½è¢«å¼ƒç”¨çš„é€šçŸ¥ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œâ€œå¼ƒç”¨â€è¿™ä¸ªè¯æ„å‘³ç€æŸé¡¹åŠŸèƒ½è™½ç„¶åœ¨å½“å‰ç‰ˆæœ¬ä¸­è¿˜å­˜åœ¨ï¼Œä½†æ˜¯ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>timers.active()</code>è¿™ä¸ªå‡½æ•°å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨çš„ï¼ˆå³ DEP0126ï¼‰ã€‚è¿™ä¸ªå‡½æ•°ä¹‹å‰æ˜¯ç”¨æ¥é‡æ–°æ¿€æ´»å·²æœ‰çš„å®šæ—¶å™¨çš„ï¼Œä½†ç°åœ¨å¯èƒ½å› ä¸ºå„ç§åŸå› ï¼Œå¦‚æ›´å¥½çš„æ›¿ä»£æ–¹æ³•ã€æ€§èƒ½é—®é¢˜æˆ–è€…ç»´æŠ¤éš¾åº¦ï¼Œå†³å®šä¸å†æ”¯æŒå®ƒã€‚</p><p>è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹å®šæ—¶å™¨æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”ç»™å‡ºä¸€äº›å®é™…çš„ä¾‹å­ï¼š</p><p>å®šæ—¶å™¨åœ¨ç¼–ç¨‹ä¸­é€šå¸¸ç”¨äºæ‰§è¡Œå»¶è¿Ÿæ“ä½œï¼Œæ¯”å¦‚è¯´ä½ æƒ³è¦åœ¨å‡ ç§’é’Ÿåæ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œæˆ–è€…æ¯éš”ä¸€æ®µæ—¶é—´é‡å¤æ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼Œä½ å°±ä¼šç”¨åˆ°å®šæ—¶å™¨ã€‚åœ¨ JavaScript å’Œ Node.js ä¸­ï¼Œä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰äº†<code>setTimeout</code>, <code>setInterval</code>å’Œ<code>clearTimeout</code>ç­‰å‡½æ•°ã€‚</p><ol><li><p><code>setTimeout</code>: å½“ä½ æƒ³è¦åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°ä¹‹åè¿è¡Œä»£ç ï¼Œä½ ä¼šä½¿ç”¨<code>setTimeout</code>å‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ¡æ¶ˆæ¯å°†åœ¨3ç§’åæ˜¾ç¤ºã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>setInterval</code>: å½“ä½ æƒ³æ¯éš”ä¸€æ®µæ—¶é—´é‡å¤æ‰§è¡Œä»£ç æ—¶ï¼Œä½ ä¼šä½¿ç”¨<code>setInterval</code>å‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ¡æ¶ˆæ¯ä¼šæ¯5ç§’æ‰“å°ä¸€æ¬¡ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¿‡å»ï¼Œå¦‚æœä½ æƒ³è¦æ£€æŸ¥æˆ–è€…&quot;æ¿€æ´»&quot;ä¸€ä¸ªå®šæ—¶å™¨å¯¹è±¡ï¼Œå¯èƒ½ä¼šå°è¯•ä½¿ç”¨<code>timers.active(timer)</code>ã€‚ä½†æ˜¯ç°åœ¨ Node.js å›¢é˜Ÿå†³å®šå°†è¿™ä¸ªå‡½æ•°å¼ƒç”¨ï¼Œæ‰€ä»¥ä½ åº”è¯¥é¿å…åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨å®ƒï¼Œè€Œä¸”è¦å‡†å¤‡å¥½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ›¿æ¢æ‰ä»»ä½•ç°æœ‰çš„<code>timers.active()</code>è°ƒç”¨ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå¼ƒç”¨æ˜¯ä¸€ä¸ªé€æ­¥æ·˜æ±°æ—§åŠŸèƒ½çš„è¿‡ç¨‹ï¼Œåœ¨ä½ å­¦ä¹ å’Œç¼–å†™ä»£ç æ—¶ï¼Œè¦æ—¶åˆ»å…³æ³¨ Node.js çš„æœ€æ–°æ–‡æ¡£ï¼Œç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯æ¨èçš„æ–¹æ³•å’Œ APIã€‚å¯¹äºå®šæ—¶å™¨çš„æ“ä½œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ä½¿ç”¨<code>setTimeout</code>, <code>setInterval</code>å’Œ<code>clearTimeout</code>ç­‰ç°æœ‰çš„ API å³å¯æ»¡è¶³éœ€æ±‚ã€‚å¦‚æœä½ éœ€è¦æ›´é«˜çº§çš„å®šæ—¶å™¨ç®¡ç†ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å¯»æ‰¾å…¶ä»–çš„åº“æˆ–è€…æ ¹æ®æœ€æ–°çš„ Node.js API æ¥æ›´æ–°ä½ çš„ä»£ç ã€‚</p><h3 id="dep0127-timers-unrefactive" tabindex="-1"><a class="header-anchor" href="#dep0127-timers-unrefactive"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0127" target="_blank" rel="noopener noreferrer">DEP0127: timers._unrefActive()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªæœåŠ¡ç«¯çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡å«<code>timers</code>ï¼Œè¿™ä¸ªå¯¹è±¡æä¾›äº†ä¸€ç³»åˆ—ç”¨æ¥å¤„ç†æ—¶é—´çš„å‡½æ•°ï¼Œä¾‹å¦‚è®¾ç½®å®šæ—¶å™¨ï¼ˆsetTimeout, setIntervalï¼‰å’Œæ¸…é™¤å®šæ—¶å™¨ï¼ˆclearTimeout, clearIntervalï¼‰ç­‰ã€‚</p><p>åœ¨ Node.js çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéšç€ç‰ˆæœ¬æ›´æ–°ï¼Œæœ‰ä¸€äº›æ—§çš„ API æˆ–è€…åŠŸèƒ½ä¼šè¢«å¼ƒç”¨ï¼ˆDeprecationï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ä¼šè¢«ç§»é™¤ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†é¼“åŠ±å¼€å‘è€…ä½¿ç”¨æ›´ç°ä»£ã€å®‰å…¨ã€é«˜æ•ˆçš„æ–¹æ³•ã€‚</p><p><code>DEP0127</code>æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šä»£ç ï¼Œå…¶ä¸­<code>timers._unrefActive(timer)</code>æ˜¯è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼š</p><ol><li><code>timers._unrefActive(timer)</code>æ˜¯ä¸€ä¸ªå†…éƒ¨çš„å®šæ—¶å™¨æ¿€æ´»å‡½æ•°ï¼Œå®ƒä¸æ˜¯å…¬å¼€ç»™æ™®é€šç”¨æˆ·ä½¿ç”¨çš„ APIï¼Œè€Œæ˜¯ Node.js å†…éƒ¨ä½¿ç”¨çš„ã€‚</li><li><code>_unrefActive</code>è¿™ä¸ªå‡½æ•°æœ¬è´¨ä¸Šæ˜¯ç”¨æ¥ç®¡ç†å®šæ—¶å™¨çš„å¼•ç”¨è®¡æ•°ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨åï¼ŒNode.js ä¼šä¿æŒè¿›ç¨‹æ´»è·ƒç›´åˆ°è¿™ä¸ªå®šæ—¶å™¨è§¦å‘ã€‚å¦‚æœä½ ä¸éœ€è¦ä¿æŒè¿›ç¨‹æ´»è·ƒï¼Œå¯ä»¥è°ƒç”¨<code>unref()</code>æ–¹æ³•ã€‚è€Œ<code>_unrefActive</code>åˆ™æ˜¯å†…éƒ¨æ‰§è¡Œè¿™ç§æ“ä½œçš„å‡½æ•°ã€‚</li><li>å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç§æœ‰çš„ã€æœªæ–‡æ¡£åŒ–çš„ APIï¼Œå¹¶ä¸” Node.js å¸Œæœ›å¼€å‘è€…ä½¿ç”¨æ­£å¼å…¬å¼€çš„ APIï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸ºå¼ƒç”¨ã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨å®šæ—¶å™¨å‡½æ•°è€Œä¸ä½¿ç”¨è¢«åºŸå¼ƒçš„<code>_unrefActive</code>ã€‚</p><p>å‡è®¾ä½ æƒ³è¦åœ¨ 5 ç§’åæ‰§è¡Œä¸€æ®µä»£ç ï¼Œä½†ä¸å¸Œæœ›è¿™ä¸ªå®šæ—¶å™¨é˜»æ­¢ç¨‹åºé€€å‡ºï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> timer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ®µä»£ç å°†åœ¨5ç§’åæ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨unref()æ–¹æ³•ï¼Œå…è®¸ç¨‹åºåœ¨å®šæ—¶å™¨ä¹‹å‰é€€å‡ºï¼ˆå¦‚æœæ²¡æœ‰å…¶ä»–å·¥ä½œå¾…åšï¼‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">timer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unref</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶ä½¿ç”¨äº†<code>unref()</code>æ–¹æ³•ã€‚è¿™è¡¨æ˜å¦‚æœè¿™ä¸ªå®šæ—¶å™¨æ˜¯æœ€åä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„äº‹ä»¶ï¼ŒNode.js ä¸éœ€è¦ä¸ºäº†è¿™ä¸ªå®šæ—¶å™¨è€Œä¿æŒè¿›ç¨‹æ´»è·ƒã€‚è¿™æ˜¯ä¸€ç§æ¯”ä½¿ç”¨<code>_unrefActive</code>æ›´å®˜æ–¹ã€æ›´æ¨èçš„æ–¹å¼æ¥å¤„ç†å®šæ—¶å™¨ä¸è¿›ç¨‹æ´»è·ƒçŠ¶æ€ä¹‹é—´çš„å…³ç³»ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œä½ åªéœ€è¦çŸ¥é“ Node.js æä¾›äº†ä¸€å¥—å®šæ—¶å™¨ API æ¥æ‰§è¡Œå»¶æ—¶æ“ä½œï¼Œå¹¶ä¸”åº”è¯¥ä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä¸­æè¿°çš„æ–¹æ³•ï¼ˆå¦‚<code>setTimeout</code>, <code>setInterval</code>, <code>unref</code>ç­‰ï¼‰æ¥ç¼–å†™ä½ çš„ç¨‹åºã€‚åŒæ—¶ï¼Œé¿å…ä½¿ç”¨å·²è¢«åºŸå¼ƒçš„å†…éƒ¨ APIï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬æ›´æ–°ä¸­è¢«ç§»é™¤ã€‚</p><h3 id="dep0128-modules-with-an-invalid-main-entry-and-an-index-js-file" tabindex="-1"><a class="header-anchor" href="#dep0128-modules-with-an-invalid-main-entry-and-an-index-js-file"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0128" target="_blank" rel="noopener noreferrer">DEP0128: modules with an invalid main entry and an index.js file</a></span></a></h3><p>å¥½çš„ï¼ŒNode.js ä¸­çš„ DEP0128 æ˜¯ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œä»£è¡¨äº†è¢«å¼ƒç”¨çš„(deprecated)ç‰¹æ€§ã€‚åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>require()</code> å‡½æ•°å»åŠ è½½ä¸€ä¸ªæ¨¡å—æ—¶ï¼ŒNode.js ä¼šå¯»æ‰¾æ¨¡å—åŒ…ä¸­çš„ <code>main</code> å…¥å£æ–‡ä»¶ã€‚è¿™ä¸ªå…¥å£æ–‡ä»¶é€šå¸¸åœ¨æ¨¡å—çš„ <code>package.json</code> æ–‡ä»¶ä¸­å®šä¹‰ã€‚</p><p>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœ <code>package.json</code> ä¸­å£°æ˜çš„ <code>main</code> å…¥å£æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…æœ‰é”™è¯¯ï¼Œä½†åŒä¸€ç›®å½•ä¸‹å­˜åœ¨ <code>index.js</code> æ–‡ä»¶ï¼ŒNode.js ä¼šé»˜è®¸é”™è¯¯ï¼Œå¹¶è‡ªåŠ¨é€€å›ä½¿ç”¨ <code>index.js</code> ä½œä¸ºæ¨¡å—çš„å…¥å£ã€‚è¿™æ ·åšå…è®¸ä¸€äº›é…ç½®é”™è¯¯çš„æ¨¡å—æ— æ„ä¸­ä»ç„¶å¯ä»¥å·¥ä½œã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§è¡Œä¸ºå·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDEP0128ï¼‰ã€‚è¿™æ„å‘³ç€åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœ <code>package.json</code> çš„ <code>main</code> æŒ‡å‘ä¸€ä¸ªæ— æ•ˆçš„æ–‡ä»¶ï¼ŒNode.js å°†ä¸ä¼šå†è‡ªåŠ¨é€€å›åˆ° <code>index.js</code>ï¼Œè€Œæ˜¯ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><p>ç°åœ¨æˆ‘ä¼šä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªå˜åŒ–ã€‚</p><h3 id="ä¾‹å­-1-æœ‰æ•ˆçš„-main-å…¥å£" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æœ‰æ•ˆçš„-main-å…¥å£"><span>ä¾‹å­ 1ï¼šæœ‰æ•ˆçš„ <code>main</code> å…¥å£</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæ¨¡å—å« <code>my-module</code>ï¼Œå®ƒæœ‰ä»¥ä¸‹ç»“æ„ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>my-module/</span></span>
<span class="line"><span>  package.json</span></span>
<span class="line"><span>  main.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶ä¸” <code>package.json</code> æ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;main.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ ä½¿ç”¨ <code>require(&#39;my-module&#39;)</code>ï¼ŒNode.js ä¼šæ­£ç¡®åœ°åŠ è½½ <code>main.js</code> æ–‡ä»¶å› ä¸º <code>package.json</code> ä¸­çš„ <code>main</code> å­—æ®µæŒ‡å‘ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶ã€‚</p><h3 id="ä¾‹å­-2-æ— æ•ˆçš„-main-å…¥å£-å­˜åœ¨-index-js" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ— æ•ˆçš„-main-å…¥å£-å­˜åœ¨-index-js"><span>ä¾‹å­ 2ï¼šæ— æ•ˆçš„ <code>main</code> å…¥å£ï¼Œå­˜åœ¨ <code>index.js</code></span></a></h3><p>è¿˜æ˜¯ä¸Šé¢çš„ <code>my-module</code>ï¼Œä½†è¿™æ¬¡ <code>package.json</code> é…ç½®æœ‰è¯¯ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;nonexistent.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾åœ¨ <code>my-module/</code> ç›®å½•ä¸‹å­˜åœ¨ <code>index.js</code> æ–‡ä»¶ã€‚åœ¨ Node.js v21.7.1 ä¹‹å‰ï¼Œå°½ç®¡ <code>nonexistent.js</code> ä¸å­˜åœ¨ï¼Œä½†è¿è¡Œ <code>require(&#39;my-module&#39;)</code> æ—¶ Node.js ä¼šé€€å›ä½¿ç”¨ <code>index.js</code>ã€‚</p><h3 id="ä¾‹å­-3-æœªæ¥çš„è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-æœªæ¥çš„è¡Œä¸º"><span>ä¾‹å­ 3ï¼šæœªæ¥çš„è¡Œä¸º</span></a></h3><p>æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œä½†ç°åœ¨ä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„ä¸€ä¸ªæœªæ¥ç‰ˆæœ¬ï¼ˆåœ¨ DEP0128 è¢«å®Œå…¨å®æ–½ä¹‹åï¼‰ã€‚æ­¤æ—¶å½“ä½ å°è¯• <code>require(&#39;my-module&#39;)</code>ï¼ŒNode.js å°†ä¸ä¼šå†å¯»æ‰¾ <code>index.js</code>ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸º <code>main</code> æŒ‡å®šçš„ <code>nonexistent.js</code> ä¸å­˜åœ¨ã€‚</p><p>è¿™é¡¹æ”¹å˜çš„ç›®çš„æ˜¯ä¿ƒä½¿æ¨¡å—ä½œè€…æ›´ç²¾ç¡®åœ°é…ç½®ä»–ä»¬çš„ <code>package.json</code> æ–‡ä»¶ï¼Œå¹¶é˜²æ­¢æ½œåœ¨çš„åŠ è½½é”™è¯¯ã€‚é‚£äº›ä¾èµ–äºâ€œé€€å›åˆ° <code>index.js</code>â€è¡Œä¸ºçš„ä»£ç éœ€è¦æ›´æ–°ï¼Œä»¥é¿å…åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å‡ºç°é—®é¢˜ã€‚</p><h3 id="dep0129-childprocess-channel" tabindex="-1"><a class="header-anchor" href="#dep0129-childprocess-channel"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0129" target="_blank" rel="noopener noreferrer">DEP0129: ChildProcess._channel</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™æŸäº›åŠŸèƒ½æˆ–è€…æ¥å£å› ä¸ºè®¾è®¡ç¼ºé™·ã€å®‰å…¨é—®é¢˜ã€æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆå‡ºç°ç­‰åŸå› ä¼šè¢«å¼ƒç”¨ï¼ˆdeprecateï¼‰ã€‚å½“è¿™æ ·çš„æƒ…å†µå‘ç”Ÿï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šï¼Œé€šå¸¸å¸¦æœ‰ä¸€ä¸ªç¼–å·ï¼Œä¾‹å¦‚ DEP0129ã€‚</p><p><code>DEP0129: ChildProcess._channel</code> è¿™ä¸ªè­¦å‘Šæ„å‘³ç€ Node.js ä¸­ <code>ChildProcess</code> å¯¹è±¡çš„ <code>_channel</code> å±æ€§å°†ä¸å†å»ºè®®ä½¿ç”¨ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œå¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªåç§°å‰é¢æœ‰ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ï¼Œé‚£é€šå¸¸æ˜¯ä¸€ä¸ªçº¦å®šä¿—æˆçš„æ ‡å¿—ï¼Œè¡¨ç¤ºè¿™ä¸ªå±æ€§æˆ–æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸æ˜¯å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä»…ä¾›å†…éƒ¨ä½¿ç”¨ã€‚å› æ­¤ï¼Œå…¶ä»–å¼€å‘è€…åº”è¯¥é¿å…ç›´æ¥ä½¿ç”¨è¿™äº›ç§æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ”¹å˜æˆ–åˆ é™¤ï¼Œæ²¡æœ‰ç¨³å®šæ€§å’Œå‘åå…¼å®¹æ€§çš„ä¿è¯ã€‚</p><p>å…·ä½“åˆ° <code>ChildProcess._channel</code>ï¼Œåœ¨ Node.js ä¸­ï¼Œ<code>ChildProcess</code> å®ä¾‹æ˜¯é€šè¿‡ <code>child_process</code> æ¨¡å—åˆ›å»ºçš„ï¼Œç”¨æ¥ç®¡ç†å’Œæ§åˆ¶å­è¿›ç¨‹ã€‚å­è¿›ç¨‹å¯ä»¥æ‰§è¡Œ Node.js è„šæœ¬ã€ç³»ç»Ÿå‘½ä»¤æˆ–ä»»ä½•å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ã€‚å®ƒçš„ <code>_channel</code> å±æ€§æ˜¯ä¸€ä¸ªç§æœ‰çš„ä½çº§åˆ«é€šä¿¡é€šé“ï¼Œç”¨äºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚</p><p>å®ä¾‹ï¼šå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œå¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå¦ä¸€ä¸ªè„šæœ¬æˆ–å‘½ä»¤ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;child_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ &#39;echo&#39; å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;echo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬å­è¿›ç¨‹çš„è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">child</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å­è¿›ç¨‹è¾“å‡º: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“å­è¿›ç¨‹ç»“æŸæ—¶è¾“å‡ºä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">child</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å­è¿›ç¨‹é€€å‡ºç : </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹å¹¶ä¸ä¹‹é€šä¿¡ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ <code>_channel</code> å±æ€§ã€‚åœ¨æ—§ç‰ˆ Node.js ä¸­ï¼Œä¸€äº›å¼€å‘è€…å¯èƒ½ä¼šç›´æ¥æ“ä½œ <code>_channel</code> æ¥å®ç°æŸäº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œä½†è¿™æ˜¯ä¸æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒä¸å±äºç¨³å®šçš„å…¬å…± APIã€‚</p><p>éšç€ Node.js ç‰ˆæœ¬çš„æ›´æ–°ï¼Œä»¥åŠæ–°çš„å¼ƒç”¨è­¦å‘Šçš„å‡ºç°ï¼Œå»ºè®®å¼€å‘è€…éµå¾ªå®˜æ–¹æ–‡æ¡£çš„æŒ‡å¯¼ï¼Œä½¿ç”¨å®˜æ–¹æ¨èçš„å…¬å¼€å’Œç¨³å®šçš„ API æ¥å£ã€‚å¦‚æœä½ éœ€è¦è¿›è¡Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œåº”è¯¥ä½¿ç”¨å¦‚ <code>child.send()</code> å’Œ <code>process.on(&#39;message&#39;)</code> è¿™æ ·çš„å…¬å¼€æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå†…éƒ¨çš„ <code>_channel</code> å±æ€§ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼ŒDEP0129 æ˜¯ä¸€ä¸ªæé†’å¼€å‘è€…ä¸è¦ä½¿ç”¨ <code>ChildProcess</code> çš„å†…éƒ¨é€šé“ <code>_channel</code> çš„è­¦å‘Šã€‚ä½œä¸ºå¼€å‘è€…ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨ä»»ä½•å·²ç»è¢«å¼ƒç”¨çš„ç‰¹æ€§ï¼Œå¹¶ä¸”å…³æ³¨ Node.js æ›´æ–°ï¼ŒæŸ¥é˜…æ–‡æ¡£äº†è§£æ¨èçš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><h3 id="dep0130-module-createrequirefrompath" tabindex="-1"><a class="header-anchor" href="#dep0130-module-createrequirefrompath"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0130" target="_blank" rel="noopener noreferrer">DEP0130: Module.createRequireFromPath()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ DEP0130 å¼ƒç”¨è­¦å‘Šï¼Œä»¥åŠå®ƒçš„å«ä¹‰å’Œæ›¿ä»£æ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œ<code>DEP0130</code>æ˜¯ä¸€ä¸ªç¼–å·ï¼Œå®ƒä»£è¡¨äº† Node.js ä¸­ç‰¹å®šçš„å¼ƒç”¨åŠŸèƒ½ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œâ€œå¼ƒç”¨â€æ„å‘³ç€è¯¥åŠŸèƒ½å·²ç»ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰ä»–ä»¬éœ€è¦åœæ­¢ä½¿ç”¨æ—§åŠŸèƒ½ï¼Œå¹¶ä¸”å¼€å§‹é‡‡ç”¨æ–°çš„ã€æ¨èä½¿ç”¨çš„æ–¹æ³•ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>Module.createRequireFromPath()</code>å‡½æ•°æ˜¯ä¸€ä¸ª Node.js APIï¼Œå®ƒç”¨äºæ ¹æ®æŒ‡å®šè·¯å¾„åˆ›å»ºä¸€ä¸ª <code>require</code> å‡½æ•°ã€‚<code>require</code> å‡½æ•°æ˜¯ Node.js ä¸­ç”¨äºå¯¼å…¥æ¨¡å—ï¼ˆå³ä»£ç åº“æˆ–æ–‡ä»¶ï¼‰çš„æœºåˆ¶ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š<code>app.js</code> å’Œ <code>utils.js</code>ã€‚å¦‚æœ<code>app.js</code>æƒ³è¦ä½¿ç”¨<code>utils.js</code>æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œå®ƒå°±ä¼šä½¿ç”¨<code>require</code>å‡½æ•°åƒè¿™æ ·å¯¼å…¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> utils</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./utils&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶è€Œï¼Œåœ¨ Node.js çš„æ—§ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æƒ³è¦åŠ¨æ€åœ°åŸºäºæŸä¸ªç‰¹å®šçš„è·¯å¾„åˆ›å»º<code>require</code>å‡½æ•°ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨<code>Module.createRequireFromPath()</code>ã€‚æ¯”å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createRequireFromPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myRequire</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createRequireFromPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/my/libs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myLibrary</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> myRequire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-library&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œç”±äº<code>DEP0130</code>çš„å¼ƒç”¨ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨ <code>createRequireFromPath()</code> æ–¹æ³•ã€‚ç›¸åï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ <code>createRequire()</code> æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨æ–°çš„ <code>createRequire()</code> æ–¹æ³•çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createRequire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myRequire</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createRequire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/my/libs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myLibrary</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> myRequire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-library&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»<code>module</code>å†…ç½®æ¨¡å—å¯¼å…¥äº†<code>createRequire</code>å‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>createRequire</code>å¹¶ä¼ å…¥ä¸€ä¸ªç›®å½•è·¯å¾„æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„<code>require</code>å‡½æ•°ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ–°åˆ›å»ºçš„<code>require</code>å‡½æ•°æ¥å¯¼å…¥ä½äºé‚£ä¸ªè·¯å¾„ä¸‹çš„æ¨¡å—ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šè¿›è¡Œè¿™æ ·çš„æ”¹å˜ï¼Ÿéšç€è½¯ä»¶çš„å‘å±•ï¼Œä¸€äº› API å¯èƒ½å› ä¸ºå¤šç§åŸå› ï¼ˆæ¯”å¦‚æ€§èƒ½é—®é¢˜ã€å®‰å…¨é—®é¢˜ã€æ›´å¥½çš„ API è®¾è®¡ç­‰ï¼‰è¢«è®¤ä¸ºä¸å†é€‚åˆç°ä»£çš„å¼€å‘éœ€æ±‚ã€‚å› æ­¤ï¼ŒNode.js å›¢é˜Ÿå†³å®šå¼ƒç”¨<code>createRequireFromPath()</code>ï¼Œå¹¶å¼•å…¥<code>createRequire()</code>ä½œä¸ºæ›¿ä»£ï¼Œè¿™é€šå¸¸ä¼šæä¾›æ›´å¥½çš„åŠŸèƒ½å’Œæ›´æ¸…æ™°çš„è¯­ä¹‰ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š<code>DEP0130</code>ä»£è¡¨<code>Module.createRequireFromPath()</code>æ–¹æ³•çš„å¼ƒç”¨ã€‚ä½ ç°åœ¨åº”è¯¥ä½¿ç”¨<code>createRequire()</code>æ–¹æ³•æ¥åˆ›å»ºåŸºäºè·¯å¾„çš„<code>require</code>å‡½æ•°ï¼Œä»¥ä¿è¯ä»£ç çš„å…¼å®¹æ€§ï¼Œå¹¶å‡†å¤‡å¥½æœªæ¥ Node.js çš„æ›´æ–°ã€‚</p><h3 id="dep0131-legacy-http-parser" tabindex="-1"><a class="header-anchor" href="#dep0131-legacy-http-parser"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0131" target="_blank" rel="noopener noreferrer">DEP0131: Legacy HTTP parser</a></span></a></h3><p>å½“ç„¶å¯ä»¥ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä»€ä¹ˆæ˜¯ HTTP è§£æå™¨ã€‚åœ¨ Node.js ä¸­ï¼ŒHTTP è§£æå™¨è´Ÿè´£å¤„ç†ç½‘ç»œè¯·æ±‚å’Œå“åº”çš„æ•°æ®ã€‚å½“ä½ çš„ Node.js åº”ç”¨ç¨‹åºä¸æµè§ˆå™¨æˆ–å…¶ä»–æœåŠ¡é€šä¿¡æ—¶ï¼Œå®ƒéœ€è¦è§£æå‘é€è¿‡æ¥çš„ HTTP æ¶ˆæ¯ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå­˜åœ¨ä¸¤ç§ç±»å‹çš„ HTTP è§£æå™¨ï¼š</p><ol><li>æ–°çš„åŸºäº<code>llhttp</code>åº“çš„ HTTP è§£æå™¨ã€‚</li><li>æ—§çš„åŸºäº<code>http_parser</code>çš„ HTTP è§£æå™¨ã€‚</li></ol><p>&quot;Legacy&quot;ï¼ˆé—ç•™ï¼‰ä¸€è¯è¡¨ç¤ºå®ƒæ˜¯æ—§ç‰ˆçš„ã€å·²ç»è¢«æ–°æŠ€æœ¯æ‰€å–ä»£çš„ã€‚éšç€æ—¶é—´çš„æ¨ç§»å’Œè½¯ä»¶å¼€å‘çš„è¿›æ­¥ï¼Œæ—§æŠ€æœ¯å¯èƒ½ä¸å†æ˜¯æœ€æœ‰æ•ˆã€æœ€å®‰å…¨çš„é€‰æ‹©ï¼Œå› æ­¤å¼€å‘è€…ä¼šé€æ¸å¼ƒç”¨å®ƒä»¬ã€‚</p><p>è€Œ DEP0131 æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šï¼Œå‘Šè¯‰ç”¨æˆ· Node.js ä¸­æ—§çš„<code>http_parser</code> HTTP è§£æå™¨å·²è¢«åºŸå¼ƒï¼Œå¹¶å°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚è¿™æ„å‘³ç€å¦‚æœä½ çš„ä»£ç ä¾èµ–äºä½¿ç”¨è¿™ä¸ªé—ç•™çš„è§£æå™¨ï¼Œé‚£ä¹ˆä½ éœ€è¦æ›´æ–°ä½ çš„ä»£ç ä»¥ä½¿ç”¨æ–°çš„<code>llhttp</code>è§£æå™¨ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨ Node.js ç¼–å†™å¹¶ä¸”å¯èƒ½ä¾èµ–äºæ—§çš„ HTTP è§£æå™¨ï¼Œç±»ä¼¼è¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™æ®µä»£ç ä¾ç„¶èƒ½å¤Ÿå·¥ä½œï¼Œå› ä¸ºé—ç•™çš„ HTTP è§£æå™¨å°šæœªè¢«ç§»é™¤ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œé—ç•™çš„è§£æå™¨è¢«å®Œå…¨ç§»é™¤äº†ï¼Œè¿™æ®µä»£ç å¯èƒ½å°±æ— æ³•å·¥ä½œäº†ï¼Œé™¤éä½ æ˜ç¡®æŒ‡å®šä½¿ç”¨<code>llhttp</code>è§£æå™¨ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºæ™®é€šç”¨æˆ·æ¥è¯´ï¼Œé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ HTTP è§£æå™¨ï¼Œå› ä¸º Node.js é»˜è®¤ä¼šä½¿ç”¨æ–°çš„<code>llhttp</code>è§£æå™¨ã€‚ç„¶è€Œï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¾èµ–äºç‰¹å®šçš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥è¿™äº›åº“æ˜¯å¦è¿˜åœ¨ä½¿ç”¨æ—§çš„ HTTP è§£æå™¨ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒDEP0131 æ˜¯ä¸€ä¸ªæé†’ï¼šå‘Šè¯‰å¼€å‘è€…åº”è¯¥å¼€å§‹è¿ç§»åˆ°æ–°çš„ HTTP è§£æå™¨ï¼Œå¦‚æœä»–ä»¬æ­£åœ¨ä½¿ç”¨æ—§çš„è§£æå™¨ï¼Œä»¥é¿å…åœ¨å°†æ¥å‡çº§ Node.js åå‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚</p><h3 id="dep0132-worker-terminate-with-callback" tabindex="-1"><a class="header-anchor" href="#dep0132-worker-terminate-with-callback"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0132" target="_blank" rel="noopener noreferrer">DEP0132: worker.terminate() with callback</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>worker.terminate()</code>æ˜¯ä¸€ä¸ªç”¨æ¥ç»ˆæ­¢ Worker çº¿ç¨‹çš„æ–¹æ³•ã€‚ä¸€ä¸ª Worker çº¿ç¨‹é€šå¸¸è¢«ç”¨æ¥æ‰§è¡Œè€—æ—¶çš„è®¡ç®—ä»»åŠ¡æˆ–è€…å¤„ç†å¹¶å‘æ“ä½œï¼Œè¿™æ ·å¯ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯ä½ çš„ Node.js ä¸»ç¨‹åºï¼‰ã€‚</p><p>åœ¨ Node.js ç‰ˆæœ¬ 21.7.1 ä¹‹å‰ï¼Œ<code>worker.terminate()</code>æ–¹æ³•å…è®¸å¼€å‘è€…ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°åœ¨ Worker çº¿ç¨‹è¢«ç»ˆæ­¢åä¼šè¢«è°ƒç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„Workerçº¿ç¨‹æ¥æ‰§è¡Œä¸€äº›ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./some-worker-code.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸€æ®µæ—¶é—´åæˆ‘ä»¬æƒ³è¦åœæ­¢è¿™ä¸ªWorkerçº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">terminate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">exitCode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Workerç»ˆæ­¢æ—¶å‡ºç°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;WorkeræˆåŠŸç»ˆæ­¢ï¼Œé€€å‡ºç :&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">exitCode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ç§ä½¿ç”¨å¸¦æœ‰å›è°ƒå‡½æ•°çš„<code>worker.terminate()</code>çš„æ–¹å¼å·²ç»è¢«å£°æ˜ä¸ºä¸æ¨èä½¿ç”¨ï¼ˆDeprecatedï¼‰ï¼Œè¿™æ„å‘³ç€åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚åŸå› æ˜¯è¿™ç§åšæ³•å¹¶ä¸ç¬¦åˆç°ä»£çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œå°¤å…¶æ˜¯åœ¨ Node.js ä¸­æ™®éé‡‡ç”¨çš„ Promises å’Œ async/await è¯­æ³•ã€‚</p><p>ç°åœ¨æ¨èçš„åšæ³•æ˜¯ç›´æ¥ä½¿ç”¨è¿”å› Promise å¯¹è±¡çš„<code>worker.terminate()</code>ï¼Œç„¶åé€šè¿‡é“¾å¼è°ƒç”¨<code>.then()</code>å’Œ<code>.catch()</code>æ¥å¤„ç†æˆåŠŸæˆ–é”™è¯¯æƒ…å†µã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ async/await è¯­æ³•ï¼Œåˆ™å¯ä»¥æ›´åŠ ç®€æ´ã€‚ä¸‹é¢æ˜¯åŒæ ·æ“ä½œçš„ç°ä»£å†™æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„Workerçº¿ç¨‹æ¥æ‰§è¡Œä¸€äº›ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./some-worker-code.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨async/awaitè¯­æ³•ç»ˆæ­¢Workerçº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> terminateWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ç­‰å¾…Workerç»ˆæ­¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> exitCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">terminate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;WorkeræˆåŠŸç»ˆæ­¢ï¼Œé€€å‡ºç :&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">exitCode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Workerç»ˆæ­¢æ—¶å‡ºç°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è°ƒç”¨ä¸Šé¢å®šä¹‰çš„asyncå‡½æ•°æ¥ç»ˆæ­¢Worker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">terminateWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Node.js ä¸­æ­£ç¡®åœ°ç»ˆæ­¢ Worker çº¿ç¨‹ï¼Œå¹¶å¤„ç†ç»ˆæ­¢è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚é€šè¿‡ä½¿ç”¨ Promises å’Œ async/awaitï¼Œä½ å¯ä»¥ç¼–å†™æ›´åŠ æ¸…æ™°å’Œç°ä»£åŒ–çš„å¼‚æ­¥ä»£ç ã€‚</p><h3 id="dep0133-http-connection" tabindex="-1"><a class="header-anchor" href="#dep0133-http-connection"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0133" target="_blank" rel="noopener noreferrer">DEP0133: http connection</a></span></a></h3><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ&quot;å¼ƒç”¨&quot;ï¼ˆDeprecationï¼‰æ˜¯ä¸€ä¸ªå¸¸è§çš„æ¦‚å¿µã€‚å½“æŸä¸ªåŠŸèƒ½æˆ–è€… API è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ï¼Œæ„å‘³ç€å®ƒä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¼€å‘è€…å»ºè®®ä¸è¦å†ä½¿ç”¨å®ƒäº†ï¼Œå°†æ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šç§»é™¤è¿™é¡¹åŠŸèƒ½ã€‚</p><p>åœ¨ Node.js çš„èƒŒæ™¯ä¸‹ï¼Œ<code>DEP0133: http connection</code>æ˜¯ä¸€ä¸ªå…·ä½“çš„å¼ƒç”¨è­¦å‘Šã€‚è¿™ä¸ªè­¦å‘Šå‡ºç°åœ¨ Node.js çš„æ–‡æ¡£ä¸­ï¼Œæç¤ºå¼€å‘è€…æŸä¸ªå…³äº HTTP æ¨¡å—çš„ç‰¹å®šç”¨æ³•å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ Node.js ä¸­çš„<code>http</code>æ¨¡å—æ˜¯ä»€ä¹ˆã€‚Node.js çš„<code>http</code>æ¨¡å—å…è®¸ä½ åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œè¿™æ˜¯æ„å»ºç½‘ç»œåº”ç”¨ç¨‹åºçš„åŸºç¡€ã€‚</p><p><code>DEP0133</code>å…·ä½“æŒ‡çš„æ˜¯åœ¨ HTTP æœåŠ¡å™¨å“åº”ä¸­ç›´æ¥ä½¿ç”¨<code>connection</code>å±æ€§çš„åšæ³•ã€‚åœ¨ HTTP åè®®ä¸­ï¼Œâ€œConnectionâ€é€šå¸¸æ˜¯ä¸€ä¸ªæ§åˆ¶é€‰é¡¹ï¼Œç”¨äºå†³å®šå½“å‰çš„ä¼ è¾“è¿æ¥åœ¨è¯·æ±‚å®Œæˆåæ˜¯å¦å…³é—­æˆ–ä¿æŒæ‰“å¼€ã€‚ä¹‹å‰åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç›´æ¥æ“ä½œå“åº”å¯¹è±¡(<code>response</code>)ä¸Šçš„<code>connection</code>å±æ€§æ¥æ§åˆ¶è¿™ä¸ªè¡Œä¸ºã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œç›´æ¥ä½¿ç”¨<code>response.connection</code>æˆ–<code>request.connection</code>è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œå› ä¸ºè¿™ç§æ–¹å¼å¹¶ä¸æ˜¯æœ€ä½³å®è·µï¼Œè€Œä¸”å¯èƒ½ä¼šå¯¼è‡´ä¸€äº› bug å’Œå®‰å…¨é—®é¢˜ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æ—§ä»£ç ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„ç”¨æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ—§çš„æ–¹å¼ï¼Œä¸æ¨èä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿›è¡Œä¸€äº›å…³äºè¿æ¥çš„æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ åº”è¯¥é¿å…ç›´æ¥è®¿é—®<code>connection</code>å±æ€§ï¼Œè€Œæ˜¯ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼Œå¦‚é€šè¿‡<code>res.setHeader()</code>è®¾ç½®å“åº”å¤´æ¥æ§åˆ¶è¿æ¥è¡Œä¸ºï¼Œæˆ–è€…ä½¿ç”¨æ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œæ¯”å¦‚ Express æ¡†æ¶ï¼Œæ¥ç®¡ç† HTTP è¿æ¥ã€‚</p><p>å¦‚æœä½ æƒ³æ˜¾å¼æ§åˆ¶ HTTP å“åº”çš„è¿æ¥è¡Œä¸ºï¼Œå¯ä»¥è®¾ç½®<code>Connection</code>å¤´éƒ¨ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨èçš„æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;keep-alive&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å…¶ä»–å“åº”é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>setHeader</code>æ–¹æ³•æ˜¾å¼åœ°å‘Šè¯‰å®¢æˆ·ç«¯æœŸæœ›ä¿æŒè¿æ¥æ´»è·ƒã€‚è¿™æ ·çš„ä»£ç æ›´æ¸…æ™°ï¼Œéµå¾ªäº† HTTP åè®®å®šä¹‰ï¼ŒåŒæ—¶å…¼å®¹æœªæ¥çš„ Node.js ç‰ˆæœ¬ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>DEP0133</code>æ˜¯ä¸€ä¸ªæé†’ï¼Œå‘Šè¯‰å¼€å‘è€…ä¸è¦ç›´æ¥ä½¿ç”¨ HTTP å“åº”æˆ–è¯·æ±‚å¯¹è±¡ä¸Šçš„<code>connection</code>å±æ€§ï¼Œè€Œåº”è¯¥é‡‡ç”¨æ›´æ ‡å‡†ã€å®‰å…¨çš„æ–¹å¼æ¥å¤„ç† HTTP è¿æ¥ç›¸å…³çš„éœ€æ±‚ã€‚</p><h3 id="dep0134-process-tickcallback" tabindex="-1"><a class="header-anchor" href="#dep0134-process-tickcallback"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0134" target="_blank" rel="noopener noreferrer">DEP0134: process._tickCallback</a></span></a></h3><p>å¥½çš„ï¼ŒNode.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“è¿è¡Œçš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚<code>process._tickCallback</code>æ˜¯ Node.js å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸»è¦å…³è”äº Node.js çš„äº‹ä»¶å¾ªç¯ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå®ƒè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œæ¯”å¦‚å®šæ—¶å™¨ã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚å½“è¿™äº›å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œç›¸å…³çš„å›è°ƒå‡½æ•°éœ€è¦è¢«è°ƒç”¨ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯é€šè¿‡â€œticksâ€æ¥å®ç°çš„ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯ä¸€è½®äº‹ä»¶å¾ªç¯çš„è¿­ä»£ã€‚</p><p>ç„¶è€Œï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ä¼šç›´æ¥ä¸ <code>process._tickCallback</code> æ‰“äº¤é“ï¼Œå› ä¸ºå®ƒæ˜¯ Node.js çš„å†…éƒ¨æœºåˆ¶ã€‚äº‹å®ä¸Šï¼Œ<code>process._tickCallback</code> åœ¨æ–‡æ¡£ä¸­ä»æœªæ­£å¼å…¬å¼€è¿‡ï¼Œä¹Ÿä¸æ¨èç›´æ¥ä½¿ç”¨ã€‚</p><p>ä» v21.7.1 å¼€å§‹ï¼Œ<code>process._tickCallback</code> è¢«æ ‡è®°ä¸º DEP0134ï¼Œæ„å‘³ç€è¿™ä¸ª API å·²ç»å¼ƒç”¨ï¼Œå°†æ¥å¯èƒ½ä¼šä» Node.js ä¸­å®Œå…¨ç§»é™¤ã€‚å¦‚æœä½ çœ‹åˆ°äº† Node.js ä»£ç æˆ–è€…æŸäº›åº“é‡Œä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç åº”è¯¥æ›´æ–°ä»¥é¿å…ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¯¼è‡´å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>è®©æˆ‘ä»¬æ¥ä¸¾å‡ ä¸ªç¤ºä¾‹æ¥è¯´æ˜ Node.js ä¸­å¸¸è§çš„å¼‚æ­¥åœºæ™¯ï¼š</p><ol><li><strong>è¯»å–æ–‡ä»¶</strong>ï¼š<br> ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>fs</code> æ¨¡å—å¼‚æ­¥è¯»å–æ–‡ä»¶çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¸ä¼šç”¨åˆ° <code>process._tickCallback</code>ï¼Œä½†åœ¨ Node.js çš„åº•å±‚ï¼Œå®ƒå¯èƒ½ä¼šå‚ä¸å¤„ç†å¼‚æ­¥æ“ä½œåçš„å›è°ƒæ‰§è¡Œã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼š<br> ä½¿ç”¨ <code>http</code> æ¨¡å—åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå½“æœ‰è¯·æ±‚åˆ°è¾¾æ—¶å¼‚æ­¥å¤„ç†ï¼Œå¹¶å“åº”å®¢æˆ·ç«¯ã€‚åŒæ ·ï¼Œåœ¨åº•å±‚ï¼Œ<code>process._tickCallback</code> å¯èƒ½å‚ä¸äº†å¤„ç†å¼‚æ­¥äº‹ä»¶ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>è®¾ç½®å®šæ—¶å™¨</strong>ï¼š<br> å®šæ—¶å™¨è®¾ç½®å¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚ä½¿ç”¨ <code>setTimeout</code> æ¥å»¶è¿Ÿæ‰§è¡Œå‡½æ•°ã€‚åœ¨å®šæ—¶å™¨çš„å›è°ƒæ‰§è¡Œæ—¶ï¼Œ<code>process._tickCallback</code> å¯èƒ½åœ¨åº•å±‚å‘æŒ¥ä½œç”¨ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This will run after 1 second!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“èµ·æ¥ï¼Œå³ä¾¿ <code>process._tickCallback</code> è¢«åº•å±‚ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„å›è°ƒï¼Œæ™®é€šå¼€å‘è€…ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥ç›´æ¥ä½¿ç”¨å®ƒã€‚éšç€å®ƒçš„å¼ƒç”¨ï¼Œæˆ‘ä»¬æ›´åº”è¯¥å…³æ³¨å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºçš„æœ€ä½³å®è·µæ¥ç¼–å†™æˆ‘ä»¬çš„ä»£ç ã€‚</p><h3 id="dep0135-writestream-open-and-readstream-open-are-internal" tabindex="-1"><a class="header-anchor" href="#dep0135-writestream-open-and-readstream-open-are-internal"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0135" target="_blank" rel="noopener noreferrer">DEP0135: WriteStream.open() and ReadStream.open() are internal</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>WriteStream</code>å’Œ<code>ReadStream</code>æ˜¯ç”¨äºæ–‡ä»¶å†™å…¥å’Œè¯»å–çš„ä¸¤ä¸ªé‡è¦ç±»ã€‚å®ƒä»¬åˆ†åˆ«å…è®¸ä½ æŠŠæ•°æ®å†™å…¥åˆ°æ–‡ä»¶å’Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸¤ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªæ–¹æ³•å«åš<code>.open()</code>ã€‚</p><p>é€šå¸¸ï¼Œåœ¨ä½¿ç”¨<code>WriteStream</code>æˆ–è€…<code>ReadStream</code>æ—¶ï¼Œä½ ä¸éœ€è¦ç›´æ¥è°ƒç”¨<code>.open()</code>æ–¹æ³•ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„æµå¯¹è±¡å¹¶æŒ‡å®šäº†æ–‡ä»¶è·¯å¾„æ—¶ï¼ŒNode.js ä¼šè‡ªåŠ¨åœ°ä¸ºä½ è°ƒç”¨<code>.open()</code>æ–¹æ³•æ¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡è¿›è¡Œåç»­çš„è¯»å†™æ“ä½œã€‚æ¢è¨€ä¹‹ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è¢«è®¾è®¡ä¸ºå†…éƒ¨ä½¿ç”¨çš„ï¼Œè€Œä¸æ˜¯ä¾›å¼€å‘è€…ç›´æ¥è°ƒç”¨çš„ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨æ—©æœŸçš„ç‰ˆæœ¬ä¸­ï¼Œç”±äº<code>.open()</code>æ–¹æ³•æ˜¯å…¬å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¢«å¤–éƒ¨ä»£ç è°ƒç”¨ï¼‰ï¼Œä¸€äº›å¼€å‘è€…å¯èƒ½ç›´æ¥è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå®˜æ–¹æ ‡è®°äº†<code>DEP0135</code>ä½œä¸ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œè¿™æ„å‘³ç€<code>WriteStream.open()</code>å’Œ<code>ReadStream.open()</code>æ–¹æ³•ä¸å†æ¨èå¼€å‘è€…ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ä»¥å‰ä½ å¯èƒ½å†™è¿‡è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªç”¨äºå†™å…¥çš„æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›´æ¥è°ƒç”¨openæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†å®é™…ä¸Šï¼Œä½ ä¸éœ€è¦æ˜¾å¼è°ƒç”¨<code>open()</code>ï¼Œå› ä¸ºå½“ä½ ç”¨<code>createWriteStream</code>åˆ›å»ºæµæ—¶ï¼ŒNode.js å·²ç»å¸®ä½ ç®¡ç†äº†æ–‡ä»¶çš„æ‰“å¼€ã€‚æ‰€ä»¥æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªç”¨äºå†™å…¥çš„æµï¼ŒNode.jsä¼šè‡ªåŠ¨å¤„ç†æ–‡ä»¶çš„æ‰“å¼€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒç†å¯¹äº<code>ReadStream</code>ä¹Ÿæ˜¯ä¸€æ ·ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>DEP0135</code>è¿™ä¸ªå¼ƒç”¨è­¦å‘Šè¡¨æ˜ä½ åœ¨ç¼–ç¨‹æ—¶ä¸åº”è¯¥ç›´æ¥è°ƒç”¨<code>WriteStream.open()</code>å’Œ<code>ReadStream.open()</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯åº”è¯¥è®© Node.js è‡ªå·±å»å¤„ç†ä¸æ–‡ä»¶ç›¸å…³çš„æ‰“å¼€å’Œå‡†å¤‡å·¥ä½œã€‚è¿™æ ·èƒ½ä¿è¯ä»£ç æ›´åŠ ç®€æ´ï¼Œå¹¶ä¸”é¿å…å°†æ¥çš„ä¸å…¼å®¹é—®é¢˜ã€‚</p><h3 id="dep0136-http-finished" tabindex="-1"><a class="header-anchor" href="#dep0136-http-finished"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0136" target="_blank" rel="noopener noreferrer">DEP0136: http finished</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€èŠ Node.js ä¸­çš„ DEP0136 è¿™ä¸ªåºŸå¼ƒè­¦å‘Šã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œæ‰€è°“â€œåºŸå¼ƒâ€ï¼ˆDeprecationï¼‰æ˜¯æŒ‡æŸä¸ªåŠŸèƒ½æˆ–è€…å®è·µå°†ä¸å†è¢«æ”¯æŒï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å½»åº•ç§»é™¤ã€‚å½“å¼€å‘è€…é‡åˆ°åºŸå¼ƒè­¦å‘Šæ—¶ï¼Œä»–ä»¬éœ€è¦æ³¨æ„ä»£ç ä¸­çš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶å‡†å¤‡ç›¸åº”åœ°æ›´æ–°ä»£ç ï¼Œä»¥å…åœ¨æœªæ¥æŸä¸ªæ—¶å€™ä»£ç çªç„¶ä¸å·¥ä½œäº†ã€‚</p><p>é‚£ä¹ˆï¼ŒDEP0136 å…·ä½“æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå®ƒæ¶‰åŠçš„æ˜¯ Node.js ä¸­ <code>http</code> æ¨¡å—çš„ä¸€ä¸ªç‰¹å®šäº‹ä»¶â€”â€”<code>&#39;finished&#39;</code>ã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼ŒHTTP å“åº”å¯¹è±¡ï¼ˆ<code>http.ServerResponse</code> ç±»çš„å®ä¾‹ï¼‰ä¸Šçš„ <code>&#39;finished&#39;</code> äº‹ä»¶è¢«æ ‡è®°ä¸º Deprecatedï¼ˆå³ä¸æ¨èä½¿ç”¨ï¼‰ã€‚è¿™ä¸ªäº‹ä»¶æ›¾ç»ç”¨äºè¡¨ç¤ºæœåŠ¡å™¨å®Œæˆå‘é€å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯çš„æ—¶åˆ»ã€‚</p><p>è®©æˆ‘ä¸¾ä¸ªç®€åŒ–çš„ä¾‹å­æ¥è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Response has been sent.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–°çš„åšæ³•ï¼šä½¿ç”¨å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿‡å»çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸‹é¢çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finished&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Response has finished sending to the client.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†ç°åœ¨ï¼Œå¦‚æœä½ å°è¯•è¿™ä¹ˆåšï¼ŒNode.js ä¼šå‘Šè¯‰ä½  <code>&#39;finished&#39;</code> äº‹ä»¶å·²ç»è¢«åºŸå¼ƒäº†ï¼Œå› æ­¤ä½ åº”è¯¥å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„å˜æ›´ï¼ŸNode.js çš„å¼€å‘è€…å¯èƒ½æœ‰å¤šç§ç†ç”±è¿›è¡Œæ­¤ç±»å˜æ›´ã€‚å¯èƒ½æ˜¯å› ä¸ºåŸæ¥çš„ API è®¾è®¡å­˜åœ¨é—®é¢˜ï¼Œæˆ–è€…æ–°çš„ API æä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€å®‰å…¨æ€§æˆ–æ˜“ç”¨æ€§ç­‰ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ç»“æŸæ—¶çš„å›è°ƒå‡½æ•°è€Œä¸æ˜¯ç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œå¯ä»¥ä½¿æµç¨‹æ›´æ¸…æ™°å’Œæ›´æ˜“äºç®¡ç†ã€‚</p><p>å¦‚æœä½ çš„ä»£ç ä¸­åŒ…å«äº†å¯¹ <code>&#39;finished&#39;</code> äº‹ä»¶çš„ç›‘å¬ï¼Œä½ ç°åœ¨åº”è¯¥è€ƒè™‘æ›´æ–°å®ƒã€‚é€šå¸¸ï¼Œæœ€ä½³çš„åšæ³•æ˜¯æŸ¥é˜… Node.js çš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£å®˜æ–¹æ¨èçš„æ›¿ä»£æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›¿ä»£æ–¹æ³•å°±æ˜¯ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚åœ¨ <code>res.end()</code> æ–¹æ³•ä¸­æä¾›ä¸€ä¸ªå›è°ƒï¼Œè¿™ä¸ªå›è°ƒä¼šåœ¨å“åº”å®Œå…¨å‘é€ä¹‹åè¢«è°ƒç”¨ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼šDEP0136 æ˜¯ Node.js ä¸­å…³äº HTTP å“åº”çš„ <code>&#39;finished&#39;</code> äº‹ä»¶çš„åºŸå¼ƒè­¦å‘Šã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬åº”å½“é¿å…ä½¿ç”¨å·²åºŸå¼ƒçš„åŠŸèƒ½ï¼Œå¹¶æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æŒ‡å¼•è¿›è¡Œä»£ç æ›´æ–°ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„åº”ç”¨èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸Šã€‚</p><h3 id="dep0137-closing-fs-filehandle-on-garbage-collection" tabindex="-1"><a class="header-anchor" href="#dep0137-closing-fs-filehandle-on-garbage-collection"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0137" target="_blank" rel="noopener noreferrer">DEP0137: Closing fs.FileHandle on garbage collection</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥å°½é‡ç®€å•åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>fs</code>æ¨¡å—æ˜¯ç”¨æ¥å¤„ç†æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„ï¼Œæ¯”å¦‚è¯»å†™æ–‡ä»¶ã€‚è€Œ<code>FileHandle</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»£è¡¨äº†å¯¹æŸä¸ªç‰¹å®šæ–‡ä»¶çš„å¼•ç”¨ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒæ¥è¿›è¡Œæ–‡ä»¶çš„å„ç§æ“ä½œã€‚</p><p>ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å´å¿˜è®°äº†å…³é—­å®ƒï¼ŒNode.js ä¼šåœ¨è¿™ä¸ª<code>FileHandle</code>å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨å¸®ä½ å…³é—­æ–‡ä»¶ã€‚åƒåœ¾å›æ”¶ï¼ˆGarbage Collection, GCï¼‰æ˜¯æŒ‡å½“ä¸€äº›å¯¹è±¡ä¸å†è¢«éœ€è¦æ—¶ï¼ŒNode.js çš„å†…å­˜ç®¡ç†æœºåˆ¶ä¼šè‡ªåŠ¨æ¸…ç†å®ƒä»¬ä»¥é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ä¸ªè¡Œä¸ºå·²ç»è¢«åºŸå¼ƒäº†ï¼Œæ„æ€å°±æ˜¯è¯´å®ƒç°åœ¨è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸æ¨èçš„åšæ³•ï¼Œå¹¶ä¸”åœ¨ä»Šåçš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚æ‰€è°“çš„ DEP0137 å°±æ˜¯è¿™ä¸ªæ”¹å˜çš„å®˜æ–¹ç¼–å·ã€‚è¿™ä¸ªå†³å®šæ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šä¾èµ–åƒåœ¾å›æ”¶æ¥å…³é—­æ–‡ä»¶å¹¶ä¸æ˜¯ä¸€ç§å¯é çš„åŠæ³•ï¼Œå› ä¸ºä½ æ— æ³•ç¡®åˆ‡çŸ¥é“åƒåœ¾å›æ”¶ä¼šåœ¨ä½•æ—¶è¿è¡Œï¼Œè¿™å¯èƒ½å¯¼è‡´æ–‡ä»¶èµ„æºæ²¡æœ‰è¢«åŠæ—¶é‡Šæ”¾ï¼Œä»è€Œé€ æˆèµ„æºæ³„éœ²æˆ–è€…å…¶ä»–é—®é¢˜ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯æ—§ä»£ç å¯èƒ½çš„å†™æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promises</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ... è¿™é‡Œæ˜¯æ“ä½œæ–‡ä»¶çš„ä»£ç  ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ³¨æ„è¿™é‡Œæ²¡æœ‰å…³é—­æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨è¿™ä»½ä»£ç ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å…³é—­æ–‡ä»¶ï¼Œæ‰€ä»¥åŸæœ¬æ˜¯ä¾èµ–åƒåœ¾å›æ”¶å™¨æ¥å…³é—­çš„ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½†æ ¹æ®DEP0137ï¼Œè¿™æ ·çš„åšæ³•å°†ä¸å†è¢«æ”¯æŒã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œç°åœ¨ï¼Œæ¨èçš„åšæ³•æ˜¯æ‰‹åŠ¨å…³é—­æ–‡ä»¶ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promises</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> fileHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    fileHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ... è¿™é‡Œæ˜¯æ“ä½œæ–‡ä»¶çš„ä»£ç  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fileHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜ç¡®åœ°å…³é—­æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨try...finallyè¯­å¥ç¡®ä¿å³ä½¿å‡ºç°é”™è¯¯ï¼Œæ–‡ä»¶ä¹Ÿèƒ½å¤Ÿè¢«æ­£ç¡®åœ°å…³é—­ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°çš„ä»£ç é£æ ¼é‡Œï¼Œä½ è¦è´Ÿè´£æ¯æ¬¡éƒ½æ˜ç¡®åœ°å…³é—­ä½ æ‰“å¼€çš„æ–‡ä»¶ã€‚è¿™æ ·åšæœ‰åˆ©äºæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯é æ€§ã€‚è™½ç„¶è¿™æ„å‘³ç€ä½ éœ€è¦å†™æ›´å¤šçš„ä»£ç å»ç®¡ç†æ–‡ä»¶çš„æ‰“å¼€å’Œå…³é—­ï¼Œä½†è¿™å…¶å®æ˜¯ä¸€ç§æ›´å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œèƒ½å¤Ÿé˜²æ­¢æ½œåœ¨çš„èµ„æºæ³„éœ²é—®é¢˜ã€‚</p><h3 id="dep0138-process-mainmodule" tabindex="-1"><a class="header-anchor" href="#dep0138-process-mainmodule"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0138" target="_blank" rel="noopener noreferrer">DEP0138: process.mainModule</a></span></a></h3><p><code>process.mainModule</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªå†å²å±æ€§ï¼Œå®ƒç”¨äºè·å–å½“å‰åº”ç”¨ç¨‹åºçš„å…¥å£æ¨¡å—ã€‚æ‰€è°“â€œå…¥å£æ¨¡å—â€å°±æ˜¯ Node.js åº”ç”¨ç¨‹åºå¼€å§‹æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ä½ åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>node</code> å‘½ä»¤è¿è¡Œçš„é‚£ä¸ª JavaScript æ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåä¸º <code>app.js</code> çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ <code>node app.js</code> æ¥å¯åŠ¨ä½ çš„ Node.js ç¨‹åºï¼Œé‚£ä¹ˆ <code>app.js</code> å°±æ˜¯ä¸»æ¨¡å—ï¼Œ<code>process.mainModule</code> ä¼šæä¾›ä¸€ä¸ªæ¨¡å—å¯¹è±¡ï¼Œä»£è¡¨è¿™ä¸ª <code>app.js</code>ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>process.mainModule</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆå³ DEP0138ï¼‰ï¼Œè¿™æ„å‘³ç€æœªæ¥çš„ Node.js ç‰ˆæœ¬å¯èƒ½ä¼šå®Œå…¨ç§»é™¤è¿™ä¸ªå±æ€§ã€‚Node.js å›¢é˜Ÿå»ºè®®å¼€å‘è€…ä¸è¦å†ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¹¶è½¬è€Œä½¿ç”¨å…¶ä»–çš„æ–¹å¼æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><h3 id="æ›¿æ¢æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#æ›¿æ¢æ–¹æ¡ˆ"><span>æ›¿æ¢æ–¹æ¡ˆ</span></a></h3><p>ä½œä¸ºæ›¿æ¢ï¼Œå¯ä»¥ä½¿ç”¨ <code>require.main</code> æ¥ç¡®å®šå…¥å£æ¨¡å—ã€‚<code>require.main</code> æŒ‡å‘çš„æ˜¯ Node.js è¿›ç¨‹å¯åŠ¨æ—¶åŠ è½½çš„ç¬¬ä¸€ä¸ªæ¨¡å—ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>require.main</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ app.js æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">main</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;app.js æ˜¯å…¥å£æ¨¡å—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;app.js è¢«å…¶ä»–æ¨¡å—å¯¼å…¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ é€šè¿‡ <code>node app.js</code> è¿è¡Œä»¥ä¸Šä»£ç æ—¶ï¼Œç»“æœå°†ä¼šæ˜¯ &quot;app.js æ˜¯å…¥å£æ¨¡å—&quot;ï¼Œå› ä¸º <code>app.js</code> æ˜¯é€šè¿‡ Node.js å‘½ä»¤ç›´æ¥è¿è¡Œçš„æ¨¡å—ã€‚</p><p>å¦‚æœä½ æœ‰å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚ <code>other.js</code>ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå¯¼å…¥äº† <code>app.js</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ other.js æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶é€šè¿‡æ‰§è¡Œ <code>node other.js</code> è¿è¡Œ <code>other.js</code>ï¼Œé‚£ä¹ˆ <code>app.js</code> æ‰“å°çš„ç»“æœå°†æ˜¯ &quot;app.js è¢«å…¶ä»–æ¨¡å—å¯¼å…¥&quot;ï¼Œå› ä¸ºæ­¤æ—¶ <code>app.js</code> å¹¶ä¸æ˜¯å…¥å£æ¨¡å—ã€‚</p><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p>æ€»ä¹‹ï¼Œ<code>process.mainModule</code> è¢«åºŸå¼ƒæ˜¯å› ä¸º Node.js æƒ³è¦ç®€åŒ–å’Œç»Ÿä¸€å…¶æ¨¡å—ç³»ç»Ÿï¼Œè®©å…¶æ›´åŠ å¯é å’Œå®¹æ˜“ç»´æŠ¤ã€‚æˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨è¢«åºŸå¼ƒçš„ç‰¹æ€§ï¼Œå¹¶è·Ÿéšå®˜æ–¹æ¨èé‡‡ç”¨æ–°çš„æ–¹æ³•æ¥é€‚é…æˆ‘ä»¬çš„ä»£ç ã€‚</p><h3 id="dep0139-process-umask-with-no-arguments" tabindex="-1"><a class="header-anchor" href="#dep0139-process-umask-with-no-arguments"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0139" target="_blank" rel="noopener noreferrer">DEP0139: process.umask() with no arguments</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥å¸®ä½ äº†è§£è¿™ä¸ª Node.js ä¸­çš„æ¦‚å¿µã€‚é¦–å…ˆï¼Œ<code>process.umask()</code>æ˜¯ä¸€ä¸ª Node.js ä¸­ç”¨æ¥æ“ä½œç³»ç»Ÿ umaskï¼ˆç”¨æˆ·æ–‡ä»¶åˆ›å»ºæ¨¡å¼æ©ç ï¼‰çš„å‡½æ•°ã€‚åœ¨è§£é‡Š DEP0139 ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="umask-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#umask-ç®€ä»‹"><span>Umask ç®€ä»‹</span></a></h3><p>åœ¨ Unix å’Œç±» Unix ç³»ç»Ÿä¸­ï¼Œæ¯å½“ä¸€ä¸ªç¨‹åºåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æˆ–ç›®å½•æ—¶ï¼Œç³»ç»Ÿä¼šèµ‹äºˆå®ƒä¸€å®šçš„é»˜è®¤æƒé™ã€‚è¿™äº›æƒé™å†³å®šäº†å“ªäº›ç”¨æˆ·å¯ä»¥è¯»å–ã€å†™å…¥æˆ–æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½æƒ³è¦é™åˆ¶è¿™äº›é»˜è®¤æƒé™ï¼Œé˜²æ­¢å…¶ä»–ç”¨æˆ·å¯¹ä½ çš„æ–‡ä»¶æœ‰å¤ªå¤šçš„è®¿é—®æƒã€‚è¿™å°±æ˜¯ umask è¿›å…¥çš„åœ°æ–¹ã€‚</p><p>Umask æ˜¯ä¸€ä¸ªæƒé™æ©ç ï¼Œå®ƒå®é™…ä¸Šè®¾ç½®äº†æ–°åˆ›å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™ã€‚Umask å€¼å®è´¨ä¸Šä»æ»¡æƒé™ï¼ˆé€šå¸¸æ˜¯ 777 å¯¹äºæ–‡ä»¶å¤¹å’Œ 666 å¯¹äºæ–‡ä»¶ï¼‰ä¸­å‡å»äº†ç›¸åº”çš„å€¼ï¼Œä»¥å¾—åˆ°æ–°æ–‡ä»¶çš„æƒé™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ umask è®¾ç½®ä¸º 022ï¼Œé‚£ä¹ˆæ–°åˆ›å»ºçš„æ–‡ä»¶å°†æœ‰æƒé™ 644ï¼ˆ666-022ï¼‰ï¼Œè€Œç›®å½•å°†æœ‰æƒé™ 755ï¼ˆ777-022ï¼‰ã€‚è¿™æ„å‘³ç€å…¶ä»–ç”¨æˆ·æ²¡æœ‰å†™æƒé™ã€‚</p><h3 id="process-umask-åœ¨-node-js-ä¸­" tabindex="-1"><a class="header-anchor" href="#process-umask-åœ¨-node-js-ä¸­"><span>process.umask() åœ¨ Node.js ä¸­</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>process.umask()</code>å‡½æ•°è¢«ç”¨æ¥æŸ¥è¯¢æˆ–è®¾ç½® Node.js è¿›ç¨‹çš„ umaskã€‚å¦‚æœè°ƒç”¨<code>process.umask()</code>æ—¶æ²¡æœ‰å‚æ•°ï¼Œå®ƒä¼šè¿”å›å½“å‰çš„ umask å€¼ã€‚å¦‚æœä½ ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œå®ƒå°†æ”¹å˜ umaskï¼Œå¹¶è¿”å›æ—§çš„ umask å€¼ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> oldUmask</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">umask</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0022</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®umaskä¸º022</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Old umask was: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">oldUmask</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜¾ç¤ºæ—§çš„umask</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dep0139-å¼ƒç”¨æ— å‚æ•°çš„-process-umask" tabindex="-1"><a class="header-anchor" href="#dep0139-å¼ƒç”¨æ— å‚æ•°çš„-process-umask"><span>DEP0139: å¼ƒç”¨æ— å‚æ•°çš„ process.umask()</span></a></h3><p>åœ¨ Node.js çš„ 21.7.1 ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨<code>process.umask()</code>å‡½æ•°è€Œä¸æä¾›ä»»ä½•å‚æ•°å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDEP0139ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå¼€å‘è€…ä»¬ä¸èƒ½å†è°ƒç”¨<code>process.umask()</code>æ¥è·å–å½“å‰çš„ umask å€¼ï¼Œå› ä¸ºè¿™ä¸ªç”¨æ³•å¯èƒ½ä¼šåœ¨å°†æ¥è¢«å®Œå…¨ç§»é™¤ã€‚</p><p>åŸå› æ˜¯å› ä¸ºè¿™ç§ç”¨æ³•å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜å’Œç«äº‰æ¡ä»¶ï¼Œå°¤å…¶æ˜¯åœ¨å¼‚æ­¥ç¼–ç¨‹ç¯å¢ƒä¸‹ã€‚ç«äº‰æ¡ä»¶å¯èƒ½å‘ç”Ÿåœ¨å¤šä¸ªéƒ¨åˆ†çš„ä»£ç è¯•å›¾åŒæ—¶è¯»å–å’Œä¿®æ”¹ umask æ—¶ã€‚</p><h3 id="å®ä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1"><span>å®ä¾‹</span></a></h3><h4 id="åœ¨-dep0139-ä¹‹å‰çš„ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#åœ¨-dep0139-ä¹‹å‰çš„ç”¨æ³•"><span>åœ¨ DEP0139 ä¹‹å‰çš„ç”¨æ³•ï¼š</span></a></h4><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–å½“å‰umaskå€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> currentUmask</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">umask</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Current umask is: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">currentUmask</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¿®æ­£åçš„ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#ä¿®æ­£åçš„ç”¨æ³•"><span>ä¿®æ­£åçš„ç”¨æ³•ï¼š</span></a></h4><p>ç°åœ¨ä½ åº”è¯¥é¿å…è¿™æ ·åšï¼Œè€Œæ˜¯æ˜¾å¼åœ°å¤„ç†ä½ çš„æ–‡ä»¶æƒé™ï¼Œæˆ–è€…å¦‚æœä½ ç¡®å®éœ€è¦è·å–å½“å‰çš„ umaskï¼Œå¯ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶å­˜å‚¨å®ƒçš„å€¼ï¼Œç„¶ååœ¨åº”ç”¨çš„å…¶ä½™éƒ¨åˆ†é‡å¤ä½¿ç”¨å®ƒã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åº”ç”¨å¯åŠ¨æ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> INITIAL_UMASK</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">umask</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å­˜å‚¨åˆå§‹umask</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨åº”ç”¨çš„å…¶ä»–éƒ¨åˆ†ï¼Œä½¿ç”¨INITIAL_UMASKä»£æ›¿ç›´æ¥è°ƒç”¨process.umask()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Initial umask is: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">INITIAL_UMASK</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js å¹¶ä¸”åœ¨ä½ çš„ä»£ç ä¸­ç”¨åˆ°äº†<code>process.umask()</code>ï¼Œæœ€å¥½çš„åšæ³•æ˜¯ä¸è¦ä¾èµ–äºæ— å‚æ•°è°ƒç”¨æ¥è·å–å½“å‰çš„ umask å€¼ï¼Œè€Œæ˜¯åœ¨åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§è¯»å–å¹¶å­˜å‚¨å®ƒï¼Œæˆ–è€…å½»åº•é¿å…ç›´æ¥æ“ä½œ umaskï¼Œè½¬è€Œä½¿ç”¨æ–‡ä»¶æƒé™ç›¸å…³çš„æ¨¡å—å’Œæ–¹æ³•ã€‚</p><h3 id="dep0140-use-request-destroy-instead-of-request-abort" tabindex="-1"><a class="header-anchor" href="#dep0140-use-request-destroy-instead-of-request-abort"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0140" target="_blank" rel="noopener noreferrer">DEP0140: Use request.destroy() instead of request.abort()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€ä¸‹ Node.js ä¸­å…³äº DEP0140 è¿™ä¸ªå¼ƒç”¨è­¦å‘Šã€‚åœ¨è§£é‡Šè¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚</p><p><strong>Node.js æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå¯ä»¥è®©ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚Node.js è¢«è®¾è®¡ä¸ºè½»é‡ã€é«˜æ•ˆï¼Œå¹¶ä¸”ç‰¹åˆ«é€‚åˆå¤„ç†æ•°æ®å¯†é›†å‹çš„å®æ—¶åº”ç”¨ç¨‹åºã€‚</p><p><strong>HTTP è¯·æ±‚å’Œå“åº”ï¼š</strong></p><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ è¦ä¸å¤–éƒ¨èµ„æºï¼ˆæ¯”å¦‚ APIï¼‰è¿›è¡Œé€šä¿¡æ—¶ï¼Œä½ ä¼šä½¿ç”¨åˆ° HTTP æ¨¡å—æ¥å‘é€è¯·æ±‚ï¼ˆrequestï¼‰å’Œæ¥æ”¶å“åº”ï¼ˆresponseï¼‰ã€‚å‘é€è¯·æ±‚æ—¶ï¼Œæœ‰å¤šç§æ–¹å¼å¯ä»¥ä¸­æ–­è¿™ä¸ªè¯·æ±‚ï¼Œå¦‚æœä½ å‘ç°ä¸å†éœ€è¦è¿™ä¸ªè¯·æ±‚çš„ç»“æœäº†æˆ–è€…å› ä¸ºé”™è¯¯éœ€è¦ç»ˆæ­¢å®ƒã€‚</p><p><strong>DEP0140 è­¦å‘Šæ˜¯ä»€ä¹ˆï¼š</strong></p><p>DEP0140 æ˜¯ Node.js é¡¹ç›®åœ¨å…¶æ–‡æ¡£ä¸­å‘å¸ƒçš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šç¼–å·ã€‚è¿™ä¸ªè­¦å‘Šçš„æ„æ€æ˜¯è¯´ï¼Œ<code>request.abort()</code> æ–¹æ³•ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚Node.js å¼€å‘å›¢é˜Ÿå»ºè®®ä½¿ç”¨ <code>request.destroy()</code> æ–¹æ³•æ¥ä»£æ›¿ <code>request.abort()</code>ã€‚</p><p><strong>request.abort() vs request.destroy():</strong></p><ol><li><p><code>request.abort()</code> - åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œå½“ä½ æƒ³è¦ä¸­æ–­ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„ HTTP è¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½ä¼šè°ƒç”¨ <code>request.abort()</code> æ–¹æ³•ã€‚è¿™ä¼šç«‹å³ç»ˆæ­¢è¯·æ±‚ï¼Œå¹¶å…³é—­ä¸è¿™ä¸ªè¯·æ±‚ç›¸å…³è”çš„ä»»ä½•åº•å±‚èµ„æºã€‚</p></li><li><p><code>request.destroy()</code> - ç°åœ¨å»ºè®®ä½¿ç”¨çš„æ–¹æ³•æ˜¯ <code>request.destroy()</code>ã€‚è¿™ä¸ªæ–¹æ³•åŒæ ·å¯ä»¥ç”¨æ¥ä¸­æ–­è¯·æ±‚ï¼Œå¹¶ä¸”æ›´åŠ ä¼˜é›…åœ°å¤„ç†èµ„æºæ¸…ç†å·¥ä½œã€‚å®ƒå…è®¸ä½ å¯é€‰åœ°ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œä»¥æŒ‡ç¤ºè¯·æ±‚è¢«é”€æ¯çš„åŸå› ã€‚</p></li></ol><p><strong>ä¾‹å­ï¼š</strong></p><p>å‡è®¾ä½ è¦ä»æŸä¸ª API è·å–æ•°æ®ï¼Œä½†åœ¨æ•°æ®è¿”å›ä¹‹å‰ç”¨æˆ·å–æ¶ˆäº†æ“ä½œï¼Œä½ å¯èƒ½éœ€è¦ä¸­æ–­è¿™ä¸ª HTTP è¯·æ±‚ã€‚</p><p>ä½¿ç”¨ <code>request.abort()</code> çš„æ—§æ–¹å¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/api/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å“åº”...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>request.destroy()</code> çš„æ–°æ–¹å¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/api/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å“åº”...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å–æ¶ˆè¯·æ±‚ï¼Œå¯ä»¥é€‰æ‹©ä¼ é€’ä¸€ä¸ªé”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request was cancelled by the user.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œå½“ä½ è°ƒç”¨ <code>request.destroy()</code> æ–¹æ³•æ—¶ï¼Œå¦‚æœä¼ é€’äº†é”™è¯¯å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä½œä¸º <code>&#39;error&#39;</code> äº‹ä»¶ä¼ é€’ç»™ç›‘å¬å™¨ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹å¤„ç†è¿™ä¸ªé”™è¯¯ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0140 è­¦å‘Šæ˜¯ Node.js å›¢é˜Ÿå‘Šè¯‰å¼€å‘äººå‘˜ï¼Œåº”è¯¥åœæ­¢ä½¿ç”¨ <code>request.abort()</code> æ¥ä¸­æ–­ HTTP è¯·æ±‚ï¼Œå¹¶å¼€å§‹ä½¿ç”¨ <code>request.destroy()</code> æ–¹æ³•æ¥å–ä»£å®ƒï¼Œè¿™æ ·åšèƒ½å¤Ÿæ›´å®‰å…¨å’Œæœ‰æ•ˆåœ°æ¸…ç†èµ„æºã€‚</p><h3 id="dep0141-repl-inputstream-and-repl-outputstream" tabindex="-1"><a class="header-anchor" href="#dep0141-repl-inputstream-and-repl-outputstream"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0141" target="_blank" rel="noopener noreferrer">DEP0141: repl.inputStream and repl.outputStream</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„è¿™ä¸ªåºŸå¼ƒç‰¹æ€§ï¼šDEP0141ã€‚</p><p>åœ¨æ—©æœŸçš„ Node.js ç‰ˆæœ¬ä¸­ï¼ŒREPLï¼ˆRead-Eval-Print Loopï¼‰æ¨¡å—æä¾›äº† <code>.inputStream</code> å’Œ <code>.outputStream</code> å±æ€§ï¼Œå…è®¸å¼€å‘è€…æŒ‡å®š REPL è¯»å–è¾“å…¥å’Œå†™å‡ºè¾“å‡ºçš„æµã€‚ç®€å•æ¥è¯´ï¼Œæµï¼ˆstreamï¼‰æ˜¯ä¸€ç§åœ¨ç¨‹åºä¸­å¤„ç†è¾“å…¥è¾“å‡ºçš„æ–¹å¼ï¼Œå®ƒå¯ä»¥è®©ä½ ä¸€è¾¹è¯»å–æ•°æ®ï¼Œä¸€è¾¹æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œä¸å¿…ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½è¯»å–å®Œæ¯•ã€‚</p><p>ä½†ä» Node.js v14 å¼€å§‹ï¼Œ<code>.inputStream</code> å’Œ <code>.outputStream</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä¹Ÿå°±æ˜¯è¯´å¼€å‘è€…ä¸åº”è¯¥å†ä½¿ç”¨è¿™ä¸¤ä¸ªå±æ€§ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ç›´æ¥åœ¨åˆ›å»º REPL å®ä¾‹æ—¶é€šè¿‡ <code>input</code> å’Œ <code>output</code> é€‰é¡¹æ¥æŒ‡å®šè¾“å…¥è¾“å‡ºæµã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ REPL ç¯å¢ƒï¼Œå¹¶ä¸”æƒ³æŒ‡å®šè¾“å…¥è¾“å‡ºï¼Œä½ åº”è¯¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»çš„æµå’Œä¸€ä¸ªå¯å†™çš„æµï¼Œç”¨äº REPL çš„è¾“å…¥å’Œè¾“å‡ºã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œä»¥æ–‡ä»¶æµä¸ºä¾‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ process.stdin å’Œ process.stdoutã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> inputStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-input-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> outputStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-output-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª REPL å®ä¾‹å¹¶æŒ‡å®šè¾“å…¥è¾“å‡ºã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myRepl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">inputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  output</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">outputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ï¼ŒREPL ä¼šä» &#39;my-input-file.txt&#39; è¯»å–å‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥ &#39;my-output-file.txt&#39;ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>repl</code> å’Œ <code>fs</code> æ¨¡å—ã€‚ç„¶ååˆ›å»ºäº†ä¸¤ä¸ªæµï¼š<code>inputStream</code> æ˜¯ä¸€ä¸ªå¯è¯»æµï¼Œä»ä¸€ä¸ªåä¸º <code>&#39;my-input-file.txt&#39;</code> çš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼›<code>outputStream</code> æ˜¯ä¸€ä¸ªå¯å†™æµï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ° <code>&#39;my-output-file.txt&#39;</code> æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>repl.start()</code> å¹¶ä¼ å…¥è¿™ä¸¤ä¸ªæµä½œä¸ºå‚æ•°æ¥å¯åŠ¨ REPLï¼Œè¿™æ · REPL å°±ä¼šä½¿ç”¨è¿™äº›æŒ‡å®šçš„æµè¿›è¡Œè¾“å…¥è¾“å‡ºã€‚</p><p>å®é™…ä¸Šï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½åªæ˜¯åœ¨ç»ˆç«¯ä¸­è¿è¡Œ Node.js çš„ REPLï¼Œé‚£ä¹ˆé»˜è®¤çš„ <code>process.stdin</code> ä½œä¸ºè¾“å…¥æµå’Œ <code>process.stdout</code> ä½œä¸ºè¾“å‡ºæµå°±è¶³å¤Ÿäº†ã€‚ä»¥ä¸Šè¿°ä»£ç ä¸ºä¾‹ï¼Œå¦‚æœä½ æƒ³è¦ä¸€ä¸ªå¸¸è§„çš„ç»ˆç«¯ REPL ç¯å¢ƒï¼Œä½ é€šå¸¸ä¼šè¿™æ ·å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> repl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;repl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨é»˜è®¤çš„ç»ˆç«¯è¾“å…¥å’Œè¾“å‡ºåˆ›å»º REPLã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼Œ<code>DEP0141</code> å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨ Node.js v21.7.1ï¼ˆæˆ–ä»»ä½•æ”¯æŒæ–°çš„ REPL API çš„ç‰ˆæœ¬ï¼‰ä¸­ï¼Œä¸åº”å†ä½¿ç”¨ <code>repl.inputStream</code> å’Œ <code>repl.outputStream</code>ï¼Œè€Œåº”ä½¿ç”¨æ–°çš„æ–¹å¼æ¥æŒ‡å®š REPL çš„è¾“å…¥è¾“å‡ºæµã€‚è¿™æ ·ï¼Œä»£ç ä¸ä»…æ›´æ¸…æ™°ï¼Œè€Œä¸”èƒ½é¿å…åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å‡ºç°æ½œåœ¨çš„é—®é¢˜ï¼Œå› ä¸ºæ—§çš„å±æ€§æœ€ç»ˆå¯èƒ½ä¼šè¢«å½»åº•ç§»é™¤ã€‚</p><h3 id="dep0142-repl-builtinlibs" tabindex="-1"><a class="header-anchor" href="#dep0142-repl-builtinlibs"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0142" target="_blank" rel="noopener noreferrer">DEP0142: repl._builtinLibs</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ä½ æåˆ°çš„ Node.js ä¸­çš„è¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>repl._builtinLibs</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¡¨ç¤ºæ‰€æœ‰å†…ç½®çš„æ ¸å¿ƒæ¨¡å—çš„åç§°ã€‚è¿™äº›æ ¸å¿ƒæ¨¡å—æ˜¯ Node.js å‘è¡Œç‰ˆçš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚ <code>fs</code> ç”¨äºæ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œ<code>http</code> ç”¨äºç½‘ç»œè¯·æ±‚ç­‰ã€‚<code>repl</code> æ˜¯ &quot;Read-Eval-Print Loop&quot; çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ä¸ªäº¤äº’å¼çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œå…è®¸å¼€å‘è€…è¾“å…¥ JavaScript ä»£ç ç‰‡æ®µå¹¶ç«‹å³æ‰§è¡Œçœ‹åˆ°ç»“æœï¼Œä¸»è¦ç”¨äºè°ƒè¯•å’Œå®éªŒã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ åœ¨ Node.js çš„ REPL ç¯å¢ƒä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">repl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">_builtinLibs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ ä¼šçœ‹åˆ°è¾“å‡ºç±»ä¼¼äºï¼š</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[</span></span>
<span class="line"><span>  &#39;assert&#39;, &#39;buffer&#39;, &#39;child_process&#39;, &#39;cluster&#39;,</span></span>
<span class="line"><span>  &#39;crypto&#39;, &#39;dgram&#39;, &#39;dns&#39;, &#39;domain&#39;, &#39;events&#39;,</span></span>
<span class="line"><span>  &#39;fs&#39;, &#39;http&#39;, &#39;https&#39;, &#39;net&#39;, &#39;os&#39;, &#39;path&#39;,</span></span>
<span class="line"><span>  &#39;punycode&#39;, &#39;querystring&#39;, &#39;readline&#39;, &#39;stream&#39;,</span></span>
<span class="line"><span>  &#39;string_decoder&#39;, &#39;tls&#39;, &#39;tty&#39;, &#39;url&#39;, &#39;util&#39;,</span></span>
<span class="line"><span>  &#39;v8&#39;, &#39;vm&#39;, &#39;zlib&#39;</span></span>
<span class="line"><span>]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™è¡¨æ˜äº†æ‰€æœ‰å†…ç½®çš„æ ¸å¿ƒæ¨¡å—åˆ—è¡¨ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå±æ€§è¢«æ ‡è®°ä¸ºå·²å¼ƒç”¨ï¼ˆDeprecatedï¼‰ï¼Œå…·ä½“æ¥è¯´åœ¨ DEP0142 ä¸­å°±æ˜¯è¿™æ ·ã€‚è¿™æ„å‘³ç€å°†æ¥çš„ Node.js ç‰ˆæœ¬å¯èƒ½ä¼šç§»é™¤è¿™ä¸ªå±æ€§ï¼Œå¼€å‘è€…ä¸åº”è¯¥å†ä¾èµ–å®ƒã€‚å½“ä¸€ä¸ªç‰¹æ€§æˆ–è€… API è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ï¼Œé€šå¸¸æ˜¯å› ä¸º Node.js å¼€å‘å›¢é˜Ÿæ‰“ç®—å¼•å…¥ä¸€ä¸ªæ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–è€…æ˜¯å› ä¸ºåŸæœ‰çš„æ–¹å¼å­˜åœ¨é—®é¢˜æˆ–ä¸å†ç¬¦åˆç°ä»£å¼€å‘çš„éœ€æ±‚ã€‚</p><p>ä»¥ <code>repl._builtinLibs</code> ä¸ºä¾‹ï¼Œæ¨èçš„åšæ³•æ˜¯ä½¿ç”¨ <code>require(&#39;module&#39;).builtinModules</code> æ¥ä»£æ›¿ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> builtinModules</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">builtinModules</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">builtinModules</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„ <code>require(&#39;module&#39;)</code> æ˜¯åŠ è½½ Node.js çš„ module æ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸æ¨¡å—ç³»ç»Ÿç›¸å…³çš„å„ç§åŠŸèƒ½ã€‚<code>builtinModules</code> å±æ€§ä¼šç»™å‡ºä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰å†…å»ºæ¨¡å—çš„åç§°ï¼Œå’Œ <code>repl._builtinLibs</code> æä¾›çš„ä¿¡æ¯ç±»ä¼¼ï¼Œä½†æ˜¯è¿™æ˜¯å®˜æ–¹æ¨èçš„æ–¹å¼ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>repl._builtinLibs</code> è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ„å‘³ç€å®ƒå°†æ¥å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œè€Œä½ åº”è¯¥ä½¿ç”¨å®˜æ–¹æ¨èçš„æ›¿ä»£æ–¹æ³•æ¥è·å–ç›¸åŒçš„ä¿¡æ¯ã€‚è¿™æ ·ï¼Œä½ çš„åº”ç”¨æˆ–ä»£ç å°±èƒ½å…¼å®¹æœªæ¥çš„ Node.js æ›´æ–°ï¼Œé¿å…å‡ºç°å› ä¸ºä¾èµ–å·²å¼ƒç”¨ç‰¹æ€§è€Œå¯¼è‡´çš„é—®é¢˜ã€‚</p><h3 id="dep0143-transform-transformstate" tabindex="-1"><a class="header-anchor" href="#dep0143-transform-transformstate"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0143" target="_blank" rel="noopener noreferrer">DEP0143: Transform._transformState</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ DEP0143 è¿™ä¸ªåºŸå¼ƒè­¦å‘Šã€‚</p><p>é¦–å…ˆï¼ŒDEP0143 æ˜¯ Node.js å®˜æ–¹å‘å¸ƒçš„ä¸€ä¸ªåºŸå¼ƒï¼ˆdeprecationï¼‰æ ‡è¯†ï¼Œè¿™æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–è€… API åœ¨æœªæ¥å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚åœ¨ç¼–ç¨‹é¢†åŸŸï¼Œå½“æŸé¡¹æŠ€æœ¯æˆ–è€…ä»£ç ä¸å†å»ºè®®ä½¿ç”¨ï¼Œå¹¶ä¸”å°†æ¥å¯èƒ½ä¼šè¢«å®Œå…¨æ›¿æ¢æ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¯´å®ƒæ˜¯â€œdeprecatedâ€çš„ã€‚</p><p>Node.js ä¸­ <code>Transform</code> ç±»æ˜¯ stream æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå¤„ç†æ•°æ®æµï¼ˆstreamï¼‰ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºè¯»å–æˆ–å†™å…¥è¿ç»­æ•°æ®çš„æ¥å£ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚<code>Transform</code> ç±»æ˜¯åŒå·¥æµï¼ˆDuplex streamsï¼‰çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œä¸”è¾“å…¥å’Œè¾“å‡ºä¹‹é—´æœ‰ä¸€å®šçš„å…³è”ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½è¯»å–ä¸€äº›æ–‡æœ¬æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œè½¬æ¢ï¼ˆæ¯”å¦‚å°†å°å†™å­—æ¯è½¬ä¸ºå¤§å†™ï¼‰ï¼Œç„¶åè¾“å‡ºè½¬æ¢åçš„æ•°æ®ã€‚</p><p><code>_transformState</code> æ˜¯ <code>Transform</code> ç±»å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒç”¨äºè·Ÿè¸ªæµçš„çŠ¶æ€ï¼Œæ¯”å¦‚æ˜¯å¦æ­£åœ¨å¤„ç†æ•°æ®ï¼Œæ˜¯å¦å®Œæˆäº†æ•°æ®çš„è½¬æ¢ç­‰ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå±æ€§æ˜¯ç§æœ‰çš„ï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼Œä»¥ <code>_</code> å¼€å¤´çš„å±æ€§æˆ–æ–¹æ³•åœ¨ JavaScript ä¸­é€šå¸¸è¡¨ç¤ºå®ƒä»¬æ˜¯ç§æœ‰çš„ï¼Œä¸åº”è¯¥åœ¨ç±»çš„å¤–éƒ¨ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹ã€‚</p><p>æ‰€ä»¥ï¼ŒDEP0143 å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸åº”è¯¥åœ¨è‡ªå·±çš„ä»£ç ä¸­ç›´æ¥è®¿é—®æˆ–ä¾èµ– <code>_transformState</code> å±æ€§ï¼Œå› ä¸ºå®ƒæ˜¯ Transform ç±»çš„å†…éƒ¨å®ç°ç»†èŠ‚ã€‚åœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœå¼€å‘è€…ç»§ç»­ç›´æ¥ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œä»–ä»¬çš„ä»£ç å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªå±æ€§å¯èƒ½ä¼šè¢«æ”¹å˜æˆ–ç§»é™¤ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªè½¬æ¢æµï¼Œç”¨æ¥æŠŠæµä¸­çš„å°å†™å­—æ¯è½¬æ¢æˆå¤§å†™å­—æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> UpperCaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†ä¼ å…¥çš„æ•°æ®å—ï¼ˆchunkï¼‰è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨è¿™ä¸ªè½¬æ¢æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> upperCaseTranform</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> UpperCaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">upperCaseTranform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>UpperCaseTransform</code> çš„è½¬æ¢æµç±»ã€‚è¿™ä¸ªç±»ç»§æ‰¿è‡ª Node.js æ ¸å¿ƒæ¨¡å— <code>stream</code> æä¾›çš„ <code>Transform</code> åŸºç±»ï¼Œå¹¶é‡å†™äº†å…¶ä¸­çš„ <code>_transform</code> æ–¹æ³•ã€‚<code>_transform</code> æ–¹æ³•æ˜¯ç”¨æ¥å®šä¹‰å¦‚ä½•å¤„ç†æ•°æ®çš„ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæ•°æ®å—ï¼ˆchunkï¼‰ã€ç¼–ç æ–¹å¼ï¼ˆencodingï¼‰å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬æŠŠæ•°æ®å—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶åè°ƒç”¨ <code>toUpperCase()</code> æ–¹æ³•å°†å…¶è½¬æ¢æˆå¤§å†™ï¼Œæœ€åé€šè¿‡ <code>callback</code> å‡½æ•°å°†è½¬æ¢åçš„æ•°æ®ä¼ é€’å‡ºå»ã€‚</p><p>æ³¨æ„ï¼Œä¸Šè¿°ä¾‹å­å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ <code>_transformState</code> ã€‚å¦‚æœä½ çš„ä»£ç ä¸­åŒ…å«ç±»ä¼¼ <code>this._transformState</code> çš„è®¿é—®ï¼Œé‚£å°±æ„å‘³ç€ä½ åœ¨ç›´æ¥æ“ä½œ Transform å†…éƒ¨çŠ¶æ€ï¼Œè¿™æ˜¯ Node.js ä¸æ¨èçš„åšæ³•ã€‚</p><p>ç»¼ä¸Šï¼ŒDEP0143 è¿™ä¸ªåºŸå¼ƒè­¦å‘Šçš„æ ¸å¿ƒä¿¡æ¯æ˜¯ï¼šå¼€å‘è€…ä¸åº”è¯¥åœ¨ <code>Transform</code> ç±»çš„å¤–éƒ¨ç›´æ¥è®¿é—®æˆ–ä¾èµ– <code>_transformState</code> è¿™ä¸ªç§æœ‰å±æ€§ï¼Œè€Œåº”è¯¥é€šè¿‡å®˜æ–¹æä¾›çš„ API å’Œæ–¹æ³•æ¥å®ç°åŠŸèƒ½ã€‚è¿™æ ·å¯ä»¥ä¿è¯ä»£ç çš„å…¼å®¹æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="dep0144-module-parent" tabindex="-1"><a class="header-anchor" href="#dep0144-module-parent"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0144" target="_blank" rel="noopener noreferrer">DEP0144: module.parent</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆè®©æˆ‘ä¸ºä½ ç®€å•è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ <code>module.parent</code> æ˜¯ä»€ä¹ˆï¼Œç„¶åæˆ‘ä»¬ä¼šè°ˆåˆ°åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­è¿™ä¸ªç‰¹æ€§è¢«å¼ƒç”¨ï¼ˆDeprecationï¼‰çš„å«ä¹‰ï¼Œä»¥åŠå®ƒå¯¹äºç¼–ç¨‹å®è·µçš„å½±å“ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-module-parent" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-module-parent"><span>ä»€ä¹ˆæ˜¯ <code>module.parent</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä¸€ä¸ªæ–‡ä»¶å°±å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæ¨¡å—ï¼ˆmoduleï¼‰ï¼Œè¿™æ„å‘³ç€æ¯ä¸ª JavaScript æ–‡ä»¶å¯ä»¥å¯¼å‡ºï¼ˆexportï¼‰ä¸€äº›åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥å¼•å…¥ï¼ˆrequireï¼‰å…¶ä»–æ–‡ä»¶æ¨¡å—ã€‚å½“ä½ åœ¨ä¸€ä¸ªæ¨¡å— A ä¸­ä½¿ç”¨ <code>require()</code> å‡½æ•°å»åŠ è½½å¦ä¸€ä¸ªæ¨¡å— B æ—¶ï¼Œæ¨¡å— B å¯ä»¥é€šè¿‡ <code>module.parent</code> è¿™ä¸ªç‰¹æ®Šçš„å±æ€§æ¥è·å–å¯¹æ¨¡å— A çš„å¼•ç”¨ã€‚æ¢è¨€ä¹‹ï¼Œ<code>module.parent</code> æŒ‡å‘äº†ç¬¬ä¸€ä¸ªè°ƒç”¨å½“å‰æ¨¡å—çš„æ¨¡å—ã€‚</p><h3 id="ä¸¾ä¸ªä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¸ªä¾‹å­-2"><span>ä¸¾ä¸ªä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š<code>a.js</code> å’Œ <code>b.js</code>ã€‚</p><p><strong>a.js:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥æ¨¡å— B</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>b.js:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">parent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†è¾“å‡ºå¯¹æ¨¡å— A çš„å¼•ç”¨ä¿¡æ¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ä½ è¿è¡Œ <code>a.js</code> æ–‡ä»¶ï¼ˆä¾‹å¦‚é€šè¿‡ <code>node a.js</code> å‘½ä»¤ï¼‰æ—¶ï¼Œå®ƒä¼šåŠ è½½ <code>b.js</code>ã€‚æ­¤æ—¶ï¼Œåœ¨ <code>b.js</code> ä¸­çš„ <code>module.parent</code> å°†æŒ‡å‘ <code>a.js</code>ã€‚</p><h3 id="node-js-v21-7-1-ä¸­çš„-dep0144" tabindex="-1"><a class="header-anchor" href="#node-js-v21-7-1-ä¸­çš„-dep0144"><span>Node.js v21.7.1 ä¸­çš„ DEP0144</span></a></h3><p>ç°åœ¨ï¼ŒNode.js v21.7.1 ç‰ˆæœ¬ä¸­æåˆ°çš„ DEP0144ï¼Œæ„å‘³ç€ <code>module.parent</code> è¿™ä¸ªå±æ€§å·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆdeprecatedï¼‰ã€‚å¼ƒç”¨é€šå¸¸è¡¨ç¤ºå¼€å‘è€…ä¸åº”è¯¥åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œè€Œä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå®ƒå¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ï¼Œå› æ­¤ä½¿ç”¨å®ƒçš„ç°å­˜ä»£ç å¯èƒ½éœ€è¦æ›´æ–°ä»¥é¿å…æ½œåœ¨é—®é¢˜ã€‚</p><p>Node.js å›¢é˜Ÿå¼ƒç”¨ <code>module.parent</code> ä¸»è¦æ˜¯å› ä¸ºå®ƒçš„ä½¿ç”¨å¯èƒ½ä¼šå¼•èµ·æ··ä¹±ï¼Œå°¤å…¶æ˜¯åœ¨æ¨¡å—è¢«å¤šæ¬¡åŠ è½½æˆ–ä»ä¸åŒçš„åœ°æ–¹åŠ è½½æ—¶ï¼Œ<code>module.parent</code> çš„å€¼ä¼šå˜å¾—ä¸å¯é¢„æµ‹ã€‚æ­¤å¤–ï¼Œå®ƒä¹Ÿä¸æ˜¯æ¨¡å—åŒ–ç¼–ç¨‹æœ€ä½³å®è·µçš„ä½“ç°ã€‚</p><h3 id="æ›¿ä»£-module-parent-çš„æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£-module-parent-çš„æ–¹æ³•"><span>æ›¿ä»£ <code>module.parent</code> çš„æ–¹æ³•</span></a></h3><p>å¦‚æœä½ ä»¥å‰ä¾èµ– <code>module.parent</code> æ¥è·å–æŸäº›ä¿¡æ¯æˆ–å®ç°æŸäº›åŠŸèƒ½ï¼Œç°åœ¨åº”è¯¥å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚ä¸€ç§æ–¹å¼æ˜¯æ˜ç¡®åœ°é€šè¿‡å‚æ•°æˆ–é…ç½®å¯¹è±¡å°†æ‰€éœ€çš„ä¿¡æ¯ä¼ é€’ç»™æ¨¡å—ã€‚è¿™æ ·åšæ›´åŠ æ¸…æ™°ï¼Œå¹¶ä¸”ä¸ä¾èµ–äº Node.js æ¨¡å—ç³»ç»Ÿçš„å†…éƒ¨çŠ¶æ€ã€‚</p><p><strong>æ”¹è¿›åçš„ b.js ç¤ºä¾‹ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¿®æ”¹æ¨¡å— B ä»¥æ¥æ”¶å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">setupData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">setupData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ä¼ å…¥çš„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ–è€…ï¼Œå¦‚æœä½ æƒ³å¯¼å‡ºä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯å‡½æ•°ï¼š</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">setupData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">setupData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> setupData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¿®æ”¹åçš„ a.jsï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥æ¨¡å— B å¹¶ä¼ å…¥å¿…è¦çš„ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./b.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Some information from module A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœ bModule æ˜¯ä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">bModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Some information from module A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœ bModule å¯¼å‡ºäº†ä¸€ä¸ªå«æœ‰ init æ–¹æ³•çš„å¯¹è±¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»çš„æ¥è¯´ï¼Œå¼ƒç”¨ <code>module.parent</code> æ˜¯ä¸ºäº†é¼“åŠ±æ›´æ¸…æ™°ã€å¯é¢„æµ‹çš„ä»£ç ç¼–å†™æ–¹å¼ï¼Œè™½ç„¶çŸ­æœŸå†…å¯èƒ½éœ€è¦å¯¹ç°æœ‰ä»£ç è¿›è¡Œè°ƒæ•´ï¼Œä½†é•¿è¿œæ¥çœ‹ï¼Œè¿™å°†æœ‰åŠ©äºæé«˜ Node.js åº”ç”¨ç¨‹åºçš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="dep0145-socket-buffersize" tabindex="-1"><a class="header-anchor" href="#dep0145-socket-buffersize"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0145" target="_blank" rel="noopener noreferrer">DEP0145: socket.bufferSize</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>socket.bufferSize</code>æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒç”¨æ¥æŸ¥çœ‹æˆ–è®¾ç½®å¥—æ¥å­—ï¼ˆç½‘ç»œè¿æ¥ï¼‰çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªç¼“å†²åŒºæ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥ä¸´æ—¶å­˜æ”¾è¾“å…¥è¾“å‡ºæ•°æ®çš„å†…å­˜åŒºåŸŸã€‚ä½†æ˜¯ï¼Œä» Node.js v21.7.1 å¼€å§‹ï¼Œè¿™ä¸ªå±æ€§è¢«æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¼€å‘è€…ä»¬åº”è¯¥é¿å…åœ¨æœªæ¥çš„ä»£ç ä¸­ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒDEP0145 æ˜¯ Node.js å®˜æ–¹å‘å¸ƒçš„ä¸€ç§è­¦å‘Šï¼Œå³ Deprecationï¼ˆå¼ƒç”¨ï¼‰è­¦å‘Šï¼Œæ¯ä¸ªè­¦å‘Šéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œæœ¬ä¾‹ä¸­æ˜¯ 0145ã€‚è¿™æ„å‘³ç€<code>socket.bufferSize</code>å±æ€§å·²ç»ä¸å†æ˜¯ Node.js çš„æ¨èåŠŸèƒ½ï¼Œå¹¶ä¸”ä½ åº”è¯¥æŸ¥æ‰¾å…¶ä»–æ–¹å¼æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šå¼ƒç”¨æŸä¸ªç‰¹æ€§ï¼Ÿé€šå¸¸æƒ…å†µä¸‹ï¼Œå¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªç‰¹æ€§ä¸å¤Ÿé«˜æ•ˆã€å­˜åœ¨å®‰å…¨éšæ‚£ã€æˆ–æ˜¯å’Œæ–°çš„ API è®¾è®¡ä¸å…¼å®¹ç­‰åŸå› ã€‚åœ¨<code>socket.bufferSize</code>çš„æ¡ˆä¾‹ä¸­ï¼Œå¯èƒ½æ˜¯å› ä¸ºç›´æ¥æ“ä½œåº•å±‚çš„ç¼“å†²åŒºå¤§å°å¹¶ä¸æ˜¯ç‰¹åˆ«çš„å®‰å…¨ï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿé€šå¸¸ä¼šæ¯”è¾ƒå¥½åœ°ç®¡ç†è¿™äº›ç¼“å†²åŒºã€‚</p><p>ä½†æ—¢ç„¶ä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œè®©æˆ‘ä»¬ç”¨æ›´ç®€å•çš„è¯­è¨€æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¥—æ¥å­—å°±åƒæ˜¯ä½ å®¶é‡Œçš„æ°´é¾™å¤´ï¼Œè€Œç¼“å†²åŒºå°±åƒæ˜¯è¿æ¥æ°´é¾™å¤´å’Œä½ æ¯å­ä¹‹é—´çš„ç®¡å­ã€‚å¦‚æœç®¡å­å¾ˆå°ï¼Œé‚£ä¹ˆæ°´æµå¾—æ…¢ï¼Œä½ å¾—ç­‰å¾…æ›´é•¿æ—¶é—´æ‰èƒ½å–æ°´ã€‚å¦‚æœç®¡å­å¾ˆå¤§ï¼Œæ°´å°±èƒ½æµå¾—æ›´å¿«ï¼Œä½ å¯ä»¥æ›´å¿«åœ°å–åˆ°æ°´ã€‚<code>socket.bufferSize</code>å°±åƒæ˜¯ç”¨æ¥æµ‹é‡æˆ–è°ƒæ•´è¿™ä¸ªç®¡å­å®½åº¦çš„å·¥å…·ã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œå¦‚æœä½ æƒ³è¦å‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šå…ˆè¿›å…¥åˆ°è¿™ä¸ªâ€œç®¡å­â€ï¼Œä¹Ÿå°±æ˜¯ç¼“å†²åŒºã€‚åœ¨ Node.js ä¸­ï¼Œä½ æ›¾ç»å¯ä»¥é€šè¿‡<code>socket.bufferSize</code>æ¥æŸ¥çœ‹æˆ–è®¾ç½®ç¼“å†²åŒºçš„å¤§å°ã€‚</p><p>ä¸è¿‡ï¼Œç°åœ¨æ—¢ç„¶<code>socket.bufferSize</code>è¢«å¼ƒç”¨äº†ï¼Œä½ éœ€è¦é¿å…ä½¿ç”¨å®ƒï¼Œå¹¶å¯»æ‰¾å…¶ä»–æ–¹æ³•æ¥ä¼˜åŒ–ä½ çš„ç½‘ç»œé€šä¿¡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å»è°ƒæ•´ç¼“å†²åŒºçš„å¤§å°ï¼Œå› ä¸º Node.js å’Œæ“ä½œç³»ç»Ÿä¼šå¸®ä½ ç®¡ç†è¿™äº›ç»†èŠ‚ã€‚</p><p><strong>å®é™…è¿ç”¨ä¾‹å­ï¼š</strong></p><ol><li><p><strong>æ–‡ä»¶ä¼ è¾“ç¨‹åº</strong>ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªé€šè¿‡ç½‘ç»œå‘é€å¤§æ–‡ä»¶çš„ç¨‹åºã€‚åŸæ¥ä½ å¯èƒ½ä¼šä½¿ç”¨<code>socket.bufferSize</code>æ¥ç¡®ä¿åœ¨å‘é€æ•°æ®æ—¶ï¼Œç¼“å†²åŒºæ˜¯é€‚å½“çš„å¤§å°ï¼Œä»¥æé«˜æ•ˆç‡ã€‚</p></li><li><p><strong>è§†é¢‘æµæœåŠ¡</strong>ï¼šå¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªè§†é¢‘æµåº”ç”¨ï¼Œä½ å¯èƒ½éœ€è¦ç¡®ä¿æ•°æ®å¯ä»¥å¿«é€Ÿåœ°ä»æœåŠ¡å™¨å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œä»¥å‡å°‘ç¼“å†²æ—¶é—´ã€‚åœ¨æ—§çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šå°è¯•é€šè¿‡è°ƒæ•´<code>socket.bufferSize</code>æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</p></li></ol><p>ç°åœ¨ä½ çŸ¥é“äº†<code>socket.bufferSize</code>çš„å¼ƒç”¨çŠ¶æ€ï¼Œæ‰€ä»¥ä½ åº”è¯¥å¯»æ‰¾å…¶ä»–çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä½¿ç”¨æµæ§åˆ¶æœºåˆ¶ã€è°ƒæ•´ TCP çª—å£å¤§å°æˆ–è€…ä¾èµ– Node.js çš„é»˜è®¤è¡Œä¸ºæ¥ä¼˜åŒ–æ•°æ®ä¼ è¾“ã€‚</p><h3 id="dep0146-new-crypto-certificate" tabindex="-1"><a class="header-anchor" href="#dep0146-new-crypto-certificate"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0146" target="_blank" rel="noopener noreferrer">DEP0146: new crypto.Certificate()</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡ç«¯çš„å¹³å°ã€‚å®ƒè‡ªå¸¦äº†å¾ˆå¤šæ ¸å¿ƒæ¨¡å—ï¼Œå…¶ä¸­åŒ…æ‹¬ <code>crypto</code> æ¨¡å—ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›åŠ å¯†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€ç”Ÿæˆæ•£åˆ—ç­‰ã€‚</p><p>åœ¨ Node.js çš„ç‰ˆæœ¬æ›´æ–°ä¸­ï¼Œæœ‰æ—¶ä¸€äº›åŠŸèƒ½ä¼šè¢«åºŸå¼ƒï¼ˆä¹Ÿå°±æ˜¯è¢«æ ‡è®°ä¸º &quot;deprecated&quot;ï¼‰ï¼Œè¿™è¡¨ç¤ºè¯¥åŠŸèƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–è€…æ›¿æ¢ï¼Œå¹¶ä¸”ä¸å»ºè®®å¼€å‘è€…ç»§ç»­ä½¿ç”¨ã€‚</p><p>é’ˆå¯¹ä½ æåˆ°çš„ <code>DEP0146: new crypto.Certificate()</code>ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒæ„å‘³ç€åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œç›´æ¥ä½¿ç”¨ <code>new crypto.Certificate()</code> è¿™ç§æ–¹å¼æ¥åˆ›å»ºè¯ä¹¦å¯¹è±¡çš„åšæ³•è¢«æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨äº†ã€‚</p><p>å…·ä½“æ¥è®²ï¼Œ<code>crypto.Certificate</code> æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒæä¾›äº†ä¸€äº›æ–¹æ³•æ¥å¤„ç† X.509 è¯ä¹¦ã€‚X.509 è¯ä¹¦é€šå¸¸ç”¨äºäº’è”ç½‘ä¸Šçš„å®‰å…¨é€šä¿¡ï¼Œæ¯”å¦‚ HTTPS åè®®ã€‚åœ¨è¿‡å»ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ Node.js æ¥å¤„ç†è¯ä¹¦ç›¸å…³çš„æ“ä½œï¼Œæ¯”å¦‚éªŒè¯è¯ä¹¦é“¾ã€è·å–è¯ä¹¦ä¿¡æ¯ï¼Œä½ å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ª <code>crypto.Certificate</code> å®ä¾‹ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ <code>DEP0146</code> è¢«å£°æ˜ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šè¿™ä¹ˆåšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Certificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå¯ä»¥ä½¿ç”¨ <code>cert</code> å¯¹è±¡æ¥è°ƒç”¨å„ç§æ–¹æ³•ï¼Œæ¯”å¦‚è·å–è¯ä¹¦çš„å…¬é’¥ã€‚</p><p>ä½†ä» Node.js v21.7.1 å¼€å§‹ï¼Œè¿™ç§åˆ›å»º <code>crypto.Certificate</code> å®ä¾‹çš„æ–¹æ³•è¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„ï¼Œè€Œ Node.js å»ºè®®ä½ ä½¿ç”¨é™æ€æ–¹æ³•ï¼Œå³ç›´æ¥è°ƒç”¨ <code>crypto.Certificate</code> ç±»ä¸Šçš„é™æ€æ–¹æ³•ï¼Œè€Œä¸æ˜¯å…ˆåˆ›å»ºå®ä¾‹ã€‚è¿™æ ·åšçš„å¥½å¤„åŒ…æ‹¬å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡å®ä¾‹åŒ–ï¼Œä»¥åŠæ›´æ¸…æ™°åœ°è¡¨æ˜è¿™äº›æ–¹æ³•ä¸ä¾èµ–äºç‰¹å®šçš„å®ä¾‹çŠ¶æ€ã€‚</p><p>å› æ­¤ï¼Œç°åœ¨æ¨èçš„æ–¹å¼æ˜¯ç›´æ¥è°ƒç”¨ <code>crypto.Certificate</code> ç±»ä¸Šæä¾›çš„é™æ€æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æœ‰ä¸€ä¸ª PEM æ ¼å¼çš„è¯ä¹¦å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> pem</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½ çš„è¯ä¹¦å†…å®¹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–è¯ä¹¦çš„å…¬é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> publicKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Certificate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exportPublicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ¨èçš„ä½¿ç”¨æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰åˆ›å»º <code>Certificate</code> çš„æ–°å®ä¾‹ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ <code>exportPublicKey</code> è¿™ä¸ªé™æ€æ–¹æ³•æ¥å¤„ç†è¯ä¹¦å¹¶å¯¼å‡ºå…¬é’¥ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>DEP0146</code> æé†’å¼€å‘è€…ï¼Œä»–ä»¬åº”è¯¥é¿å…ä½¿ç”¨ <code>new crypto.Certificate()</code> æ–¹å¼æ¥åˆ›å»ºè¯ä¹¦å®ä¾‹ï¼Œå¹¶ä¸”è½¬å‘ä½¿ç”¨ç±»ä¸Šçš„é™æ€æ–¹æ³•æ¥å®Œæˆéœ€è¦çš„æ“ä½œã€‚è¿™æ˜¯ Node.js å¼€å‘å›¢é˜Ÿä¸ºäº†æ”¹è¿› API è®¾è®¡å’Œæ€§èƒ½æ‰€åšçš„å†³å®šã€‚ä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œå½“ä½ é‡åˆ°æ­¤ç±»åºŸå¼ƒè­¦å‘Šæ—¶ï¼Œæœ€å¥½æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ä»¥è·å¾—æœ€æ–°å’Œæ¨èçš„åšæ³•ã€‚</p><h3 id="dep0147-fs-rmdir-path-recursive-true" tabindex="-1"><a class="header-anchor" href="#dep0147-fs-rmdir-path-recursive-true"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0147" target="_blank" rel="noopener noreferrer">DEP0147: fs.rmdir(path, { recursive: true })</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå†…å»ºæ¨¡å—æä¾›ä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ <code>fs</code> æ¨¡å—ï¼Œå®ƒæä¾›äº†å¾ˆå¤šç”¨æ¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ã€‚</p><p><code>DEP0147</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js å®˜æ–¹æ–‡æ¡£ä¸­çš„å¼ƒç”¨è­¦å‘Šç¼–å·ã€‚è¿™ä¸ªè­¦å‘Šæ˜¯å…³äº <code>fs.rmdir</code> æ–¹æ³•çš„ä¸€ä¸ªç‰¹å®šç”¨æ³•çš„å¼ƒç”¨é€šçŸ¥ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæŒ‡çš„æ˜¯å½“ä½ åœ¨è°ƒç”¨ <code>fs.rmdir</code> æ–¹æ³•æ—¶ä¼ å…¥ <code>{ recursive: true }</code> é€‰é¡¹çš„ç”¨æ³•å·²ç»è¢«å¼ƒç”¨ã€‚</p><p>å…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼ƒç”¨ï¼ˆDeprecationï¼‰ï¼šåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æŸä¸ªåŠŸèƒ½æˆ–è€…æ¥å£ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå¼ƒç”¨â€ã€‚å¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨è¢«å¼ƒç”¨çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¼€å§‹ä½¿ç”¨æ–°çš„æ›¿ä»£æ–¹æ³•ã€‚</p><p>é‚£ä¹ˆï¼Œ<code>fs.rmdir(path, { recursive: true })</code> åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ<code>fs.rmdir</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ é™¤ç›®å½•ã€‚è€Œ <code>{ recursive: true }</code> æ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œå¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œåˆ™è¡¨ç¤ºé€’å½’åˆ é™¤ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸ä»…ä¼šåˆ é™¤ç›®æ ‡ç›®å½•ï¼Œè¿˜ä¼šåˆ é™¤ç›®å½•å†…çš„æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¦‚æœä½ æƒ³åˆ é™¤ä¸€ä¸ªåŒ…å«æ–‡ä»¶çš„ç›®å½•ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rmdir</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/directory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">recursive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Directory and all its contents have been deleted!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ç°åœ¨ï¼Œå› ä¸º <code>{ recursive: true }</code> é€‰é¡¹åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å¯èƒ½ä¸å†æ”¯æŒï¼Œæ‰€ä»¥ Node.js æ¨èä½¿ç”¨æ–°çš„ <code>fs.rm</code> å‡½æ•°æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨æ–°çš„ <code>fs.rm</code> æ–¹æ³•æ¥é€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„è¿™é‡Œæ˜¯ `fs.rm` è€Œä¸æ˜¯ `fs.rmdir`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/directory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">recursive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">force</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Directory and all its contents have been deleted!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ–°çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>fs.rm</code> å‡½æ•°ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ <code>{ recursive: true, force: true }</code>ã€‚<code>recursive: true</code> è®©æˆ‘ä»¬å¯ä»¥é€’å½’åœ°åˆ é™¤æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ï¼›<code>force: true</code> è¡¨ç¤ºå³ä½¿ç›®å½•ä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js v21.7.1 æˆ–æ›´æ–°çš„ç‰ˆæœ¬è¿›è¡Œç¼–ç¨‹ï¼Œå¹¶ä¸”éœ€è¦åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ï¼Œè¯·ä½¿ç”¨ <code>fs.rm</code> æ–¹æ³•ï¼Œå¹¶å¸¦ä¸Š <code>{ recursive: true, force: true }</code> é€‰é¡¹ï¼Œè€Œä¸æ˜¯è€æ—§çš„ <code>fs.rmdir</code> æ–¹æ³•ã€‚è¿™æ ·ä½ çš„ä»£ç æ‰èƒ½å…¼å®¹æœªæ¥çš„ Node.js ç‰ˆæœ¬ã€‚</p><h3 id="dep0148-folder-mappings-in-exports-trailing" tabindex="-1"><a class="header-anchor" href="#dep0148-folder-mappings-in-exports-trailing"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0148" target="_blank" rel="noopener noreferrer">DEP0148: Folder mappings in &quot;exports&quot; (trailing &quot;/&quot;)</a></span></a></h3><p>Node.js ä¸­çš„ <code>exports</code> å­—æ®µæ˜¯ <code>package.json</code> æ–‡ä»¶ä¸­ç”¨æ¥æŒ‡å®šæ¨¡å—å¯ä»¥å¯¼å‡ºå“ªäº›å†…å®¹çš„åœ°æ–¹ã€‚è¿™ä¸ªåŠŸèƒ½è®©åŒ…çš„ä½œè€…å¯ä»¥ç²¾ç¡®åœ°æ§åˆ¶æ¨¡å—å†…éƒ¨å“ªäº›æ–‡ä»¶å¯¹å¤–å¯è§ï¼Œä»¥åŠå¦‚ä½•è¢«å¤–ç•Œè®¿é—®ã€‚ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œå…¶ä¸­çš„ä¸€ä¸ªç‰¹æ€§â€”â€”å°¾éƒ¨æ–œæ ï¼ˆä¹Ÿå°±æ˜¯æ–‡ä»¶å¤¹æ˜ å°„ï¼‰å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒ (DEP0148)ã€‚</p><p>åœ¨è¿™ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ åœ¨ <code>exports</code> å­—æ®µä¸­ä½¿ç”¨å°¾éƒ¨æ–œæ ï¼Œå®ƒä¼šè¡¨ç¤ºæ•´ä¸ªç›®å½•éƒ½æ˜¯å¯ä»¥å¯¼å‡ºçš„ã€‚ä¾‹å¦‚ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-package&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;./features/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./src/features/&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„é…ç½®æ„å‘³ç€ï¼Œå¦‚æœå…¶ä»–ä»£ç è¯•å›¾ä»ä½ çš„åŒ…ä¸­å¯¼å…¥ <code>features</code> ç›®å½•ä¸‹çš„ä»»ä½•æ¨¡å—ï¼Œå®ƒä»¬å°†ä¼šè¢«é‡å®šå‘åˆ°å®é™…æ–‡ä»¶ä½ç½®åœ¨ <code>src/features/</code> ç›®å½•ä¸‹ã€‚å› æ­¤ï¼Œå¯¼å…¥ <code>your-package/features/example</code> å°†ä¼šå¯¼å…¥ <code>src/features/example.js</code> æ–‡ä»¶ã€‚</p><p>ä½†æ˜¯ï¼Œç”±äºä¸€äº›åŸå› ï¼Œæ¯”å¦‚å¯èƒ½å¼•èµ·å®‰å…¨é—®é¢˜ã€ä½¿å¾—åŒ…ç»“æ„éš¾ä»¥ç†è§£ç­‰ï¼ŒNode.js å›¢é˜Ÿå†³å®šå°†è¿™ä¸ªå°¾éƒ¨æ–œæ çš„è¡Œä¸ºæ ‡è®°ä¸ºåºŸå¼ƒï¼Œå³ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå®Œå…¨ç§»é™¤è¿™ä¸ªç‰¹æ€§ã€‚</p><p>å®é™…è¿ç”¨ç¤ºä¾‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“é€šå¸¸çš„åšæ³•ï¼š</p><ol><li>å¦‚æœä½ æƒ³è¦å¯¼å‡ºä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ <code>exports</code> ä¸­æŒ‡æ˜ï¼š</li></ol><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;./feature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./src/feature.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå¤–éƒ¨ä»£ç é€šè¿‡ <code>import feature from &#39;your-package/feature&#39;</code> å°±å¯ä»¥å¯¼å…¥ <code>src/feature.js</code>ã€‚</p><ol start="2"><li>å¦‚æœä½ æƒ³è¦ä¿æŒæŸç§çµæ´»æ€§ï¼Œå…è®¸å¯¼å…¥ç‰¹å®šå­ç›®å½•ä¸‹çš„å¤šä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆä½ å¯ä»¥åƒè¿™æ ·è®¾ç½®æ— å°¾æ–œæ çš„æ˜ å°„ï¼š</li></ol><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;./features/*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./src/features/*.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„ <code>*</code> æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œæ„å‘³ç€ <code>import featureA from &#39;your-package/features/featureA&#39;</code> å°†ä¼šæŸ¥æ‰¾ <code>src/features/featureA.js</code> æ–‡ä»¶ã€‚</p><p>ç°åœ¨ï¼Œç”±äºå°¾éƒ¨æ–œæ çš„ç”¨æ³•å·²ç»è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼ˆé€šé…ç¬¦æ˜ å°„ï¼‰ï¼Œä»¥é¿å…æ—¥åå‡çº§ Node.js æ—¶å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœä½ æ­£åœ¨ç»´æŠ¤æˆ–åˆ›å»ºæ–°çš„ Node.js åŒ…ï¼Œå¹¶ä¸”æƒ³è¦æŒ‡å®š package exportsï¼Œè¯·é¿å…ä½¿ç”¨å°¾éƒ¨æ–œæ çš„å½¢å¼ï¼Œå¹¶é€æ¸è¿ç§»åˆ°æ— å°¾æ–œæ çš„æ˜ å°„é£æ ¼ã€‚</p><h3 id="dep0149-http-incomingmessage-connection" tabindex="-1"><a class="header-anchor" href="#dep0149-http-incomingmessage-connection"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0149" target="_blank" rel="noopener noreferrer">DEP0149: http.IncomingMessage#connection</a></span></a></h3><p>Node.js ä¸­æœ‰ä¸€ä¸ªæ¨¡å—å« httpï¼Œå®ƒç”¨äºåˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚åœ¨ HTTP æœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªå¯¹è±¡å«åš<code>http.IncomingMessage</code>ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨ç€ä¸€ä¸ªè¿›æ¥çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ä¸€ä¸ªè¯·æ±‚ã€‚</p><p>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>http.IncomingMessage</code>å¯¹è±¡ä¸Šæœ‰ä¸€ä¸ªå±æ€§å«<code>connection</code>ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§æ¥è·å–å…³äºå½“å‰è¿æ¥çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ä½ æƒ³çŸ¥é“å®¢æˆ·ç«¯çš„ IP åœ°å€ç­‰ä¿¡æ¯ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js 21.7.1 ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨<code>http.IncomingMessage#connection</code>å±æ€§è¢«æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼ˆdeprecatedï¼‰ï¼Œå³å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚å®˜æ–¹æ–‡æ¡£ä¸­çš„ DEP0149 æ­£æ˜¯è¿™ä¸€å˜åŒ–çš„è¯´æ˜ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œè¯•å›¾é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ä¸€ä¸ªè¯·æ±‚çš„è¿æ¥ä¿¡æ¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> connection</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remoteAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯çš„IPåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆåœ¨æœ€æ–°çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§åšæ³•æ˜¯ä¸è¢«æ¨èçš„ï¼Œå› ä¸ºæœªæ¥å¯èƒ½æ— æ³•å·¥ä½œã€‚</p><p>å–è€Œä»£ä¹‹ï¼Œåº”è¯¥ä½¿ç”¨<code>socket</code>å±æ€§ï¼Œæˆ–è€…æ›´å…·ä½“çš„å±æ€§å¦‚<code>req.socket.remoteAddress</code>æ¥è·å–åŒæ ·çš„ä¿¡æ¯ã€‚ä¿®æ”¹åçš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remoteAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®¢æˆ·ç«¯çš„IPåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„<code>req.socket</code>æŒ‡å‘ä¸è¯·æ±‚å…³è”çš„ç½‘ç»œå¥—æ¥å­—ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒè·å¾—å®¢æˆ·ç«¯çš„ IP åœ°å€ã€ç«¯å£å·ä»¥åŠå…¶ä»–ä¸ç½‘ç»œè¿æ¥ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨æˆ–è€…å‡†å¤‡å­¦ä¹  Node.js æ¥å¤„ç† HTTP è¯·æ±‚ï¼Œåº”å½“é¿å…ä½¿ç”¨<code>req.connection</code>ï¼Œè€Œæ˜¯é‡‡ç”¨<code>req.socket</code>æˆ–è€…å…¶ä»–å®˜æ–¹æ¨èçš„æ–¹å¼æ¥è·å–è¿æ¥ä¿¡æ¯ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿ä½ çš„ä»£ç å…¼å®¹æœªæ¥ç‰ˆæœ¬çš„ Node.jsã€‚</p><h3 id="dep0150-changing-the-value-of-process-config" tabindex="-1"><a class="header-anchor" href="#dep0150-changing-the-value-of-process-config"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0150" target="_blank" rel="noopener noreferrer">DEP0150: Changing the value of process.config</a></span></a></h3><p>å¥½çš„ï¼ŒNode.js ä¸­çš„ DEP0150 æ˜¯ä¸€ä¸ªå®˜æ–¹çš„å¼ƒç”¨è­¦å‘Šï¼Œè¿™ä¸ªè­¦å‘Šå…³è”åˆ°äº† <code>process.config</code> å±æ€§çš„ä¸€ä¸ªå˜åŒ–ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>process</code> æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ¨¡å—ä¸­è®¿é—®å®ƒè€Œæ— éœ€å¯¼å…¥ã€‚å®ƒæä¾›äº†å…³äºå½“å‰ Node.js è¿›ç¨‹çš„ä¿¡æ¯å’Œæ§åˆ¶èƒ½åŠ›ã€‚<code>process.config</code> å¯¹è±¡åŒ…å«äº† Node.js ç¼–è¯‘æ—¶çš„é…ç½®é€‰é¡¹ï¼Œè¿™äº›ä¿¡æ¯å¤§å¤šæ˜¯æŠ€æœ¯æ€§çš„ï¼ŒåŒ…æ‹¬ V8 å¼•æ“çš„é…ç½®ã€æ˜¯å¦å¯ç”¨æŸäº›ç‰¹æ€§ç­‰ã€‚</p><p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¼€å‘è€…å¯ä»¥æ›´æ”¹ <code>process.config</code> å¯¹è±¡ä¸­çš„å€¼ã€‚ä½†æ˜¯ï¼Œä»ä¸€ä¸ªç‚¹å¼€å§‹ï¼ŒNode.js å›¢é˜Ÿè®¤å®šè¿™ç§åšæ³•å¯èƒ½ä¼šå¼•èµ·æ··ä¹±ï¼Œå› ä¸ºä¸€æ—¦ä¿®æ”¹ï¼Œå¯èƒ½ä¼šç ´å Node.js çš„å†…éƒ¨å‡è®¾ï¼Œå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚æ‰€ä»¥ï¼Œä»–ä»¬å†³å®šå¼ƒç”¨æ›´æ”¹è¿™ä¸ªå¯¹è±¡çš„å€¼çš„èƒ½åŠ›ã€‚</p><p>DEP0150 è­¦å‘Šå°±æ˜¯è¯´ï¼Œè‡ª Node.js ç‰ˆæœ¬ 21.7.1 å¼€å§‹ï¼Œå¦‚æœä½ å°è¯•æ›´æ”¹ <code>process.config</code> å¯¹è±¡ä¸­çš„ä»»ä½•å€¼ï¼ŒNode.js å°†ä¼šæŠ›å‡ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šã€‚è¿™æ„å‘³ç€è¿™ç§è¡Œä¸ºè™½ç„¶è¿˜èƒ½å·¥ä½œï¼Œä½†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½è¢«å®Œå…¨ç§»é™¤ï¼Œå¹¶ä¸”ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰è§¦å‘ DEP0150 è­¦å‘Šçš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·æŸ¥çœ‹ <code>process.config</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ å°è¯•ä¿®æ”¹å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†ä¼šè§¦å‘ DEP0150 è­¦å‘Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someProperty</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;newValue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…è¿ç”¨ä¸­ï¼Œå¤§å¤šæ•°æ™®é€šç”¨æˆ·å¹¶ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥ä¿®æ”¹ <code>process.config</code> å¯¹è±¡ã€‚å®ƒé€šå¸¸åªåœ¨ Node.js æ ¸å¿ƒå¼€å‘è€…æˆ–æ‰©å±• Node.js å†…æ ¸åŠŸèƒ½çš„é«˜çº§å¼€å‘è€…ä¹‹é—´æœ‰ç”¨ã€‚å¯¹äºç»å¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œä½ åªéœ€è¦è¯»å– <code>process.config</code> æ¥è·å–ä¿¡æ¯å³å¯ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0150 å¼ƒç”¨è­¦å‘Šæ˜¯ Node.js å…³äºä¸å†å…è®¸ä¿®æ”¹ <code>process.config</code> çš„ä¸€ç§é¢„å…ˆé€šçŸ¥ã€‚è¿™æ˜¯ä¸€ä¸ªé¢„é˜²æªæ–½ï¼Œç›®çš„æ˜¯ä¿æŒ Node.js ç¨³å®šæ€§ï¼Œå¹¶é¿å…å¼€å‘è€…å¼•å…¥å¯èƒ½çš„é—®é¢˜ã€‚</p><h3 id="dep0151-main-index-lookup-and-extension-searching" tabindex="-1"><a class="header-anchor" href="#dep0151-main-index-lookup-and-extension-searching"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0151" target="_blank" rel="noopener noreferrer">DEP0151: Main index lookup and extension searching</a></span></a></h3><p><code>DEP0151</code>æ˜¯ Node.js å®˜æ–¹çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šä»£ç ï¼Œå®ƒä»£è¡¨äº†åœ¨æ—§ç‰ˆæœ¬ä¸­æŸä¸ªç‰¹å®šåŠŸèƒ½æˆ–ä¹ æƒ¯ç”¨æ³•å·²ç»ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚è¿™é‡Œæˆ‘ä»¬èšç„¦äº <code>Main index lookup and extension searching</code>ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ å°è¯•å¯¼å…¥ï¼ˆ<code>require</code>ï¼‰ä¸€ä¸ªæ¨¡å—ä½†æ²¡æœ‰æŒ‡å®šæ–‡ä»¶æ‰©å±•åæ—¶ï¼ŒNode.js ä¼šæŒ‰ç…§ä¸€å®šçš„é¡ºåºå»æŸ¥æ‰¾èƒ½å¤ŸåŒ¹é…çš„æ–‡ä»¶ã€‚è¿‡å»çš„è¡Œä¸ºæ˜¯ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚å«åš <code>my-module</code>ï¼Œè€Œè¿™ä¸ªç›®å½•ä¸‹æ²¡æœ‰ <code>index.js</code> æ–‡ä»¶ï¼ŒNode.js å°±ä¼šæ¥ç€æŸ¥æ‰¾å…¶ä»–çš„æ‰©å±•åï¼Œå¦‚ <code>index.json</code> æˆ– <code>index.node</code>ã€‚</p><p>ç„¶è€Œï¼Œè¿™ç§è‡ªåŠ¨æœç´¢å¤šç§æ‰©å±•åçš„è¡Œä¸ºåœ¨ Node.js v21.7.1 ä¸­è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆdeprecatedï¼‰ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´ä¸€äº›æ„å¤–çš„è¡Œä¸ºå’Œæ€§èƒ½é—®é¢˜ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåç§°ä¸º <code>my-module</code> çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>my-module/</span></span>
<span class="line"><span>|- index.js</span></span>
<span class="line"><span>|- index.json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ çš„ Node.js åº”ç”¨ç¨‹åºåŒ…å«ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./my-module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿‡å»ï¼ŒNode.js ä¼šé¦–å…ˆæŸ¥æ‰¾ <code>./my-module/index.js</code>ã€‚å¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒä¼šç»§ç»­æŸ¥æ‰¾ <code>./my-module/index.json</code>ï¼Œå†æ¥ç€æŸ¥æ‰¾ <code>./my-module/index.node</code> ç­‰ç­‰ã€‚è¿™ä¸ªè¡Œä¸ºåœ¨ä¸€äº›æƒ…å†µä¸‹å¯èƒ½å¼•èµ·æ··æ·†ï¼Œå› ä¸ºå¼€å‘è€…å¯èƒ½æœŸæœ›å¯¼å…¥ <code>index.js</code>ï¼Œä½†å¦‚æœå®ƒè¢«æ„å¤–åˆ é™¤ï¼ŒNode.js å¯èƒ½ä¼šæ— æç¤ºåœ°åŠ è½½ <code>index.json</code>ã€‚</p><p>ä» Node.js v21.7.1 å¼€å§‹ï¼Œæ­¤è¡Œä¸ºè¢«è®¤ä¸ºæ˜¯ä¸æ¨èçš„ï¼Œæœªæ¥å¯èƒ½å®Œå…¨ç§»é™¤è¿™ç§æ‰©å±•åæœç´¢çš„æœºåˆ¶ã€‚ä¸ºäº†é¿å…ä¾èµ–è¿™ç§è¡Œä¸ºï¼Œä½ åº”è¯¥åœ¨å¯¼å…¥æ¨¡å—æ—¶æ˜¾å¼åœ°æŒ‡å®šæ–‡ä»¶æ‰©å±•åï¼Œä¾‹å¦‚ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./my-module/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜ç¡®æŒ‡å®š .js æ‰©å±•å</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…ï¼Œå¦‚æœä½ æƒ³è¦å¯¼å…¥ JSON æ–‡ä»¶ï¼Œä½ åº”è¯¥å†™ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./my-module/index.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜ç¡®æŒ‡å®š .json æ‰©å±•å</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ€»çš„æ¥è¯´ï¼Œ<code>DEP0151</code> å¼ƒç”¨è­¦å‘Šæ˜¯æé†’ Node.js å¼€å‘è€…ä»¬åº”è¯¥æ›´æ˜ç¡®åœ°æŒ‡å‡ºæƒ³è¦å¯¼å…¥çš„æ–‡ä»¶ç±»å‹ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå¹¶ä¸”æé«˜åº”ç”¨ç¨‹åºçš„å¯é¢„æµ‹æ€§å’Œæ€§èƒ½ã€‚</p><h3 id="dep0152-extension-performanceentry-properties" tabindex="-1"><a class="header-anchor" href="#dep0152-extension-performanceentry-properties"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0152" target="_blank" rel="noopener noreferrer">DEP0152: Extension PerformanceEntry properties</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„è¿™ä¸ªå¼ƒç”¨è­¦å‘Š DEP0152ã€‚</p><p>é¦–å…ˆï¼Œ&quot;DEP0152&quot; æ˜¯ Node.js é’ˆå¯¹æŸä¸ªç‰¹å®šåŠŸèƒ½æˆ–å±æ€§ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶è®¡åˆ’åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤çš„æ ‡è¯†ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ&quot;Extension PerformanceEntry properties&quot; è¯´çš„æ˜¯æ€§èƒ½æ¡ç›®ï¼ˆPerformanceEntryï¼‰å¯¹è±¡çš„ä¸€äº›æ‰©å±•å±æ€§å³å°†è¢«å¼ƒç”¨ã€‚</p><p>Node.js çš„ PerformanceEntry å¯¹è±¡æ˜¯ä¸€ä¸ªä»£è¡¨æ—¶é—´æ€§èƒ½åº¦é‡çš„é€šç”¨å¯¹è±¡ï¼Œå®ƒé™„å¸¦äº†ä¸€äº›åŸºæœ¬å±æ€§ï¼Œæ¯”å¦‚ <code>name</code>ï¼ˆæ¡ç›®çš„åå­—ï¼‰ã€<code>entryType</code>ï¼ˆæ¡ç›®ç±»å‹ï¼‰ã€<code>startTime</code>ï¼ˆå¼€å§‹æ—¶é—´ï¼‰å’Œ <code>duration</code>ï¼ˆæŒç»­æ—¶é—´ï¼‰ã€‚è¿™äº›å±æ€§ç”¨äºå­˜å‚¨å’Œæ£€ç´¢æ€§èƒ½ç›¸å…³çš„æ•°æ®ï¼Œä»¥ä¾¿äºå¼€å‘è€…äº†è§£ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å„ä¸ªéƒ¨åˆ†çš„è€—æ—¶æƒ…å†µã€‚</p><p>ç„¶è€Œï¼Œé™¤äº†è¿™äº›æ ‡å‡†å±æ€§ä¹‹å¤–ï¼ŒNode.js è¿˜æ›¾ç»æ·»åŠ äº†ä¸€äº›éæ ‡å‡†çš„æ‰©å±•å±æ€§åˆ° PerformanceEntry å¯¹è±¡ä¸Šï¼Œæ¯”å¦‚ <code>nodeStart</code>ã€<code>v8Start</code>ã€<code>bootstrapComplete</code> ç­‰ç­‰ã€‚è¿™äº›å±æ€§ä¸»è¦ç”¨äºæä¾›ç‰¹å®šäº Node.js å†…éƒ¨å¯åŠ¨é˜¶æ®µçš„æ€§èƒ½ä¿¡æ¯ï¼Œå¯¹äºç†è§£å’Œä¼˜åŒ– Node.js ç¨‹åºçš„å¼•å¯¼æ—¶é—´å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>ä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å’Œæ ‡å‡†çš„å‘å±•ï¼ŒNode.js ç¤¾åŒºå†³å®šé€æ¸åºŸå¼ƒï¼ˆdeprecateï¼‰è¿™äº›éæ ‡å‡†çš„æ‰©å±•å±æ€§ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½ä¸æœªæ¥æ€§èƒ½ç›‘æ§çš„æ–°æ ‡å‡†ä¸å…¼å®¹ï¼Œä¹Ÿæ›´å€¾å‘äºæ”¯æŒè·¨ä¸åŒç¯å¢ƒçš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜äº†è¿™äº›æ‰©å±•å±æ€§åœ¨ Node.js ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">performance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;perf_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ€§èƒ½è§‚å¯Ÿè€…ï¼Œæ¥è§‚å¯Ÿå’Œæ‰“å°æ‰€æœ‰çš„æ€§èƒ½åº¦é‡äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> observer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PerformanceObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getEntries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Name: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, Type: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryType</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ‰“å°æ‰©å±•å±æ€§ï¼Œè¿™äº›åœ¨æœªæ¥ç‰ˆæœ¬çš„ Node.js ä¸­å°†ä¼šè¢«åºŸå¼ƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Node Start: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nodeStart</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`V8 Start: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">v8Start</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Bootstrap Complete: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bootstrapComplete</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">observer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entryTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ... å…¶ä»–ä»£ç ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½åº¦é‡äº‹ä»¶ ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šçš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ Node.js çš„ <code>perf_hooks</code> æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªæ€§èƒ½è§‚å¯Ÿè€…æ¥ç›‘è§†&#39;node&#39;ç±»å‹çš„æ€§èƒ½æ¡ç›®ã€‚å½“æ€§èƒ½äº‹ä»¶è¢«è®°å½•æ—¶ï¼Œæˆ‘ä»¬å°è¯•æ‰“å°å‡ºæ¯ä¸ªæ¡ç›®çš„åç§°ã€ç±»å‹ï¼Œä»¥åŠé‚£äº›ç‰¹å®šäº Node.js çš„æ‰©å±•å±æ€§ã€‚ç”±äºè¿™äº›æ‰©å±•å±æ€§å³å°†è¢«å¼ƒç”¨ï¼Œæ‰€ä»¥åœ¨ç¼–å†™æ–°çš„æ€§èƒ½åˆ†æä»£ç æ—¶ï¼Œä½ åº”è¯¥é¿å…ä¾èµ–ä»–ä»¬ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0152 è­¦å‘Šä½  Node.js ä¸­çš„ä¸€äº›ä¸“ç”¨äºå†…éƒ¨æ€§èƒ½åº¦é‡çš„æ‰©å±•å±æ€§å³å°†ä¸å†ä½¿ç”¨ã€‚å¦‚æœä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†è¿™äº›å±æ€§ï¼Œä½ åº”è¯¥è€ƒè™‘æ›´æ–°ä½ çš„ä»£ç ï¼Œç§»é™¤è¿™äº›å³å°†å¼ƒç”¨çš„å±æ€§ï¼Œä»¥ç¡®ä¿ä»£ç çš„æœªæ¥å…¼å®¹æ€§ã€‚</p><h3 id="dep0153-dns-lookup-and-dnspromises-lookup-options-type-coercion" tabindex="-1"><a class="header-anchor" href="#dep0153-dns-lookup-and-dnspromises-lookup-options-type-coercion"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0153" target="_blank" rel="noopener noreferrer">DEP0153: dns.lookup and dnsPromises.lookup options type coercion</a></span></a></h3><p>å½“ç„¶ï¼ŒNode.js ä¸­çš„ <code>dns.lookup</code> å’Œ <code>dnsPromises.lookup</code> æ˜¯ç”¨äºè§£æåŸŸåçš„å‡½æ•°ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œè§£æåŸŸåå°±æ˜¯å°†åƒ <code>www.google.com</code> è¿™æ ·çš„äººç±»å¯è¯»ç½‘å€è½¬æ¢æˆæœºå™¨å¯ä»¥ç†è§£å¹¶ä¸”å¯ä»¥é€šè¿‡äº’è”ç½‘å¯»å€çš„æ•°å­— IP åœ°å€ï¼ˆä¾‹å¦‚ <code>172.217.14.196</code>ï¼‰ã€‚</p><p>åœ¨ Node.js çš„ä»¥å¾€ç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥åœ¨è°ƒç”¨ <code>dns.lookup</code> æˆ–è€…å®ƒçš„ Promise ç‰ˆæœ¬ <code>dnsPromises.lookup</code> æ—¶ä¼ é€’ä¸€äº›é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹ä¼šå‘Šè¯‰å‡½æ•°å¦‚ä½•æ‰§è¡ŒåŸŸåè§£æã€‚å…¶ä¸­ä¸€ä¸ªé€‰é¡¹æ˜¯ <code>family</code>ï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ æƒ³è¦è¿”å›çš„ IP åœ°å€ç‰ˆæœ¬ï¼šIPv4 æˆ–è€… IPv6ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå¦‚æœä½ ä¼ é€’äº†ä¸€ä¸ªç±»å‹ä¸æ­£ç¡®çš„å€¼ç»™ <code>family</code> é€‰é¡¹ï¼Œæ¯”å¦‚ä¼ å…¥äº†ä¸€ä¸ªå­—ç¬¦ä¸² <code>&#39;4&#39;</code> è€Œä¸æ˜¯æ•°å­— <code>4</code>ï¼ŒNode.js ä¼šå¸®ä½ æŠŠå®ƒè½¬æ¢æˆæ­£ç¡®çš„æ•°å­—ç±»å‹ã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸º &quot;ç±»å‹å¼ºåˆ¶&quot;ã€‚</p><p>ä½†æ˜¯åœ¨ Node.js v21.7.1 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼ŒDEP0153 è¿™ä¸ªåºŸå¼ƒè­¦å‘Šæ„å‘³ç€è¿™ç§ç±»å‹å¼ºåˆ¶çš„è¡Œä¸ºä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«å½»åº•ç§»é™¤ã€‚æ‰€ä»¥ä½ éœ€è¦ç¡®ä¿ä½ ä¼ é€’ç»™ <code>family</code> çš„å€¼æ˜¯æ­£ç¡®çš„ç±»å‹ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›å…·ä½“çš„ä¾‹å­ï¼š</p><h3 id="æ—§çš„è¡Œä¸º-åœ¨-node-js-v21-7-1-ä¹‹å‰-ç°åœ¨ä¸æ¨è" tabindex="-1"><a class="header-anchor" href="#æ—§çš„è¡Œä¸º-åœ¨-node-js-v21-7-1-ä¹‹å‰-ç°åœ¨ä¸æ¨è"><span>æ—§çš„è¡Œä¸ºï¼ˆåœ¨ Node.js v21.7.1 ä¹‹å‰ï¼Œç°åœ¨ä¸æ¨èï¼‰:</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dns</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬é”™è¯¯åœ°ä¼ é€’äº†ä¸€ä¸ªå­—ç¬¦ä¸² &#39;4&#39; æ¥æŒ‡å®š IPv4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dns</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lookup</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;google.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;åœ°å€:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;åœ°å€æ—:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º 4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå³ä½¿æˆ‘ä»¬é”™è¯¯åœ°ä¼ é€’äº† <code>&#39;4&#39;</code> ä½œä¸ºå­—ç¬¦ä¸²ï¼ŒNode.js ä¹Ÿä¼šå°†å…¶å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­— <code>4</code>ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p><h3 id="æ–°çš„æ¨èè¡Œä¸º-node-js-v21-7-1-åŠä»¥å" tabindex="-1"><a class="header-anchor" href="#æ–°çš„æ¨èè¡Œä¸º-node-js-v21-7-1-åŠä»¥å"><span>æ–°çš„æ¨èè¡Œä¸ºï¼ˆNode.js v21.7.1 åŠä»¥åï¼‰:</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dns</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¡®ä¿ä¼ é€’æ­£ç¡®çš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯æ•°å­— 4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dns</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lookup</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;google.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;åœ°å€:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;åœ°å€æ—:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">family</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º 4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æ­£ç¡®åœ°ä¼ é€’äº†æ•°å­— <code>4</code> ç»™ <code>family</code> é€‰é¡¹ï¼Œè¿™æ˜¯è¢«æ¨èçš„åšæ³•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†ä¾èµ–äºå·²ç»ä¸æ¨èä½¿ç”¨çš„ç±»å‹å¼ºåˆ¶ç‰¹æ€§ã€‚</p><p>ç®€å•æ¥è¯´ï¼ŒDEP0153 è¿™ä¸ªåºŸå¼ƒè­¦å‘Šæé†’æˆ‘ä»¬ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>dns.lookup</code> æˆ– <code>dnsPromises.lookup</code> å‡½æ•°æ—¶ï¼Œåº”è¯¥ä¼ é€’æ­£ç¡®ç±»å‹çš„å‚æ•°ï¼Œé¿å…æ½œåœ¨çš„é—®é¢˜å’Œæœªæ¥ç‰ˆæœ¬ä¸­å¯èƒ½å‡ºç°çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p><h3 id="dep0154-rsa-pss-generate-key-pair-options" tabindex="-1"><a class="header-anchor" href="#dep0154-rsa-pss-generate-key-pair-options"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0154" target="_blank" rel="noopener noreferrer">DEP0154: RSA-PSS generate key pair options</a></span></a></h3><p>Node.js ä¸­çš„åºŸå¼ƒï¼ˆDeprecationï¼‰æ˜¯æŒ‡å®˜æ–¹å†³å®šé€æ­¥æ·˜æ±°æŸä¸ªåŠŸèƒ½æˆ–è€… API çš„è¿‡ç¨‹ã€‚å½“æŸä¸ªåŠŸèƒ½è¢«æ ‡è®°ä¸º &quot;deprecated&quot; æ—¶ï¼Œæ„å‘³ç€å®ƒä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šç§»é™¤è¯¥åŠŸèƒ½ï¼Œå› æ­¤å»ºè®®å¼€å‘è€…å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼ŒDEP0154 æ˜¯ä¸€ä¸ªé’ˆå¯¹ RSA-PSS å¯†é’¥å¯¹ç”Ÿæˆé€‰é¡¹çš„åºŸå¼ƒè­¦å‘Šã€‚RSA-PSS æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå¸¸ç”¨äºæ•°å­—ç­¾åã€‚Node.js æä¾›äº†å†…ç½®æ¨¡å— <code>crypto</code> æ¥å¤„ç†åŠ å¯†è§£å¯†ä»»åŠ¡ï¼ŒåŒ…æ‹¬ç”Ÿæˆå¯†é’¥å¯¹ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œè¿™æ¬¡åºŸå¼ƒæ˜¯å…³äº <code>crypto.generateKeyPair</code> å’Œ <code>crypto.generateKeyPairSync</code> è¿™ä¸¤ä¸ªå‡½æ•°åœ¨åˆ›å»º RSA-PSS å¯†é’¥å¯¹æ—¶çš„è¡Œä¸ºã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå½“ä½ æƒ³è¦ç”Ÿæˆä¸€ä¸ª RSA-PSS å¯†é’¥å¯¹ï¼Œä½ å¯èƒ½ä¼šè°ƒç”¨è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">generateKeyPair</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateKeyPair</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;rsa-pss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    modulusLength</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2048</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ•°é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    publicExponent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x10101</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…¬å…±æŒ‡æ•°ï¼Œé€šå¸¸ä¸º 65537</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ SHA-256 å“ˆå¸Œç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">publicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">privateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¯†é’¥å¯¹ç”Ÿæˆå¤±è´¥:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å…¬é’¥:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">publicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pkcs1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç§é’¥:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">privateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pkcs1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ® DEP0154 çš„è¯´æ˜ï¼Œåœ¨æ–°ç‰ˆ Node.js ä¸­ï¼Œè¿™æ®µä»£ç å°†ä¸å†æœ‰æ•ˆï¼Œå› ä¸ºå…¶ä¸­æœ‰äº›é€‰é¡¹å°†ä¸å†æ”¯æŒã€‚å¦‚æœä½ è¿è¡Œæ—§ä»£ç ï¼ŒNode.js å¯èƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šï¼Œæç¤ºä½ æŸäº›é€‰é¡¹å·²ç»åºŸå¼ƒã€‚</p><p>è€Œæ­£ç¡®çš„æ–¹å¼æ˜¯å‚è€ƒæœ€æ–°çš„æ–‡æ¡£ï¼Œä½¿ç”¨æ›´æ–°çš„ API å’Œé€‰é¡¹æ¥ç”Ÿæˆå¯†é’¥å¯¹ã€‚åºŸå¼ƒçš„é€‰é¡¹å¯èƒ½æ¶‰åŠåˆ°å¯†é’¥ç®—æ³•çš„å…·ä½“å‚æ•°ï¼Œå¦‚ hash algorithmï¼Œsalt length ç­‰ï¼Œè€Œåœ¨æ–°çš„ API ä¸­ï¼Œä½ éœ€è¦æŒ‰ç…§æ–°çš„æŒ‡å—æ¥é…ç½®è¿™äº›å‚æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ ç°åœ¨æƒ³è¦ä½¿ç”¨æœ€æ–°çš„ API åˆ›å»ºä¸€ä¸ª RSA-PSS å¯†é’¥å¯¹ï¼ˆå…·ä½“ä»£ç å–å†³äºæœ€æ–°çš„ Node.js æ–‡æ¡£å’Œæ›´æ–°ï¼‰ï¼Œä½ éœ€è¦æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å¹¶æŒ‰ç…§æŒ‡å¼•è¿›è¡Œæ“ä½œã€‚é€šå¸¸ï¼Œè¿™æ¶‰åŠåˆ°é˜…è¯»æœ€æ–°çš„ <code>crypto</code> æ¨¡å—æ–‡æ¡£ä»¥åŠè¿ç§»åˆ°æ–°çš„æ–¹æ³•æˆ–å‚æ•°ã€‚</p><p>è¿™ä¸ªæ›´æ”¹è¡¨æ˜ Node.js å®˜æ–¹å¸Œæœ›å¼€å‘è€…éµå¾ªæœ€ä½³å®è·µï¼Œå¹¶ä½¿ç”¨æœ€å®‰å…¨å’Œæœ€ç°ä»£çš„æ–¹æ³•æ¥ç”Ÿæˆå’Œä½¿ç”¨å¯†é’¥å¯¹ã€‚å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œæœ€é‡è¦çš„æ˜¯å§‹ç»ˆå…³æ³¨å®˜æ–¹æ–‡æ¡£çš„æ›´æ–°ï¼Œå¹¶åœ¨æ–°é¡¹ç›®ä¸­é‡‡ç”¨æ¨èçš„æ–¹æ³•ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ä¸€ä¸ªåº“æˆ–æ¡†æ¶ï¼Œé‚£ä¹ˆä¹Ÿç¡®ä¿å®ƒä»¬æ˜¯æœ€æ–°çš„ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½å·²ç»å¯¹è¿™äº›å˜åŒ–åšäº†é€‚é…ã€‚</p><h3 id="dep0155-trailing-slashes-in-pattern-specifier-resolutions" tabindex="-1"><a class="header-anchor" href="#dep0155-trailing-slashes-in-pattern-specifier-resolutions"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0155" target="_blank" rel="noopener noreferrer">DEP0155: Trailing slashes in pattern specifier resolutions</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šå°½é‡é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>DEP0155</code> æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šçš„ä»£ç ã€‚&quot;å¼ƒç”¨&quot;æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–è€…ç‰¹æ€§å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚å¯¹äº<code>DEP0155</code>ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨æ¨¡å—å¯¼å…¥è·¯å¾„ä¸­ä½¿ç”¨å°¾éšæ–œæ ï¼ˆå³è·¯å¾„æœ«å°¾çš„æ–œçº¿ <code>/</code>ï¼‰è¿™ä¸€åšæ³•ä¸å†è¢«æ¨èã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>import</code> æˆ– <code>require</code> å‡½æ•°æ¥åŠ è½½ï¼ˆå¯¼å…¥ï¼‰å…¶ä»–çš„ JavaScript æ–‡ä»¶æˆ–æ¨¡å—ã€‚ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ åœ¨æ¨¡å—çš„è·¯å¾„åé¢åŠ ä¸Šäº†å°¾éšæ–œæ ï¼ŒNode.js ä¼šå°è¯•å°†å…¶ä½œä¸ºä¸€ä¸ªç›®å½•æ¥å¤„ç†ã€‚ä½†ä» v21.7.1 å¼€å§‹ï¼Œè¿™ç§åšæ³•å°†è¢«å¼ƒç”¨ï¼Œæ„å‘³ç€ä½ åº”è¯¥é¿å…åœ¨æ¨¡å—è·¯å¾„ä¸­ä½¿ç”¨å°¾éšæ–œæ ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼š</p><h3 id="ä¾‹å­-1-require-ä½¿ç”¨å°¾éšæ–œæ " tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-require-ä½¿ç”¨å°¾éšæ–œæ "><span>ä¾‹å­ 1: <code>require</code> ä½¿ç”¨å°¾éšæ–œæ </span></a></h3><p>åœ¨å¼ƒç”¨ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å†™ä»£ç æ¥å¯¼å…¥ä¸€ä¸ªåä¸º <code>example-module</code> çš„æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example-module/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ³¨æ„åˆ°è·¯å¾„ &#39;example-module/&#39; ç»“å°¾å¤„çš„ <code>/</code>ã€‚æ ¹æ® DEP0155 å¼ƒç”¨é€šçŸ¥ï¼Œåº”è¯¥ç§»é™¤è¿™ä¸ªå°¾éšæ–œæ ï¼Œæ”¹ä¸ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example-module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="ä¾‹å­-2-import-ä½¿ç”¨å°¾éšæ–œæ " tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-import-ä½¿ç”¨å°¾éšæ–œæ "><span>ä¾‹å­ 2: <code>import</code> ä½¿ç”¨å°¾éšæ–œæ </span></a></h3><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ ES6 çš„ <code>import</code> è¯­æ³•æ¥å¯¼å…¥æ¨¡å—ï¼Œä¹Ÿéœ€è¦é¿å…å°¾éšæ–œæ ï¼š</p><p>å¼ƒç”¨ä¹‹å‰ï¼Œä½ å¯èƒ½å†™æˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;example-module/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æŒ‰ç…§æ–°çš„è§„èŒƒï¼Œåº”è¯¥å†™æˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;example-module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p>å°¾éšæ–œæ åœ¨è·¯å¾„è§£æä¸­çš„ä½œç”¨æ˜¯æ ‡è¯†ä¸€ä¸ªç›®å½•ã€‚åœ¨ Node.js æ–°ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§ç”¨æ³•ä¸å†æ”¯æŒï¼Œå› ä¸ºå®ƒå¯èƒ½å¼•èµ·æ··æ·†ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šè®©äººè¯¯ä»¥ä¸º &#39;example-module/&#39; æŒ‡å‘ä¸€ä¸ªç›®å½•è€Œä¸æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚é€šè¿‡å»æ‰å°¾éšæ–œæ ï¼Œå¯ä»¥ä½¿æ¨¡å—çš„å¼•ç”¨æ›´æ˜ç¡®ã€æ›´ä¸€è‡´ã€‚è¿™ä¹Ÿæœ‰åŠ©äºæå‡ä»£ç çš„è·¨å¹³å°å…¼å®¹æ€§ï¼Œå› ä¸ºä¸åŒæ“ä½œç³»ç»Ÿå¤„ç†å°¾éšæ–œæ çš„æ–¹å¼å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p><p>å› æ­¤ï¼Œå½“ä½ åœ¨ç¼–å†™ Node.js ä»£ç æ—¶ï¼Œåº”è¯¥æ£€æŸ¥æ‰€æœ‰æ¨¡å—å¯¼å…¥è¯­å¥ï¼Œç¡®è®¤æ²¡æœ‰ä½¿ç”¨å°¾éšæ–œæ ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿ä½ çš„ä»£ç ä¸æœªæ¥çš„ Node.js ç‰ˆæœ¬å…¼å®¹ï¼Œå¹¶é˜²æ­¢å‡ºç°ç”±äºè·¯å¾„é”™è¯¯å¯¼è‡´çš„é—®é¢˜ã€‚</p><h3 id="dep0156-aborted-property-and-abort-aborted-event-in-http" tabindex="-1"><a class="header-anchor" href="#dep0156-aborted-property-and-abort-aborted-event-in-http"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0156" target="_blank" rel="noopener noreferrer">DEP0156: .aborted property and &#39;abort&#39;, &#39;aborted&#39; event in http</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js v21.7.1 ä¸­å…³äº DEP0156: <code>.aborted</code> å±æ€§å’Œ <code>http</code> æ¨¡å—ä¸­çš„ <code>&#39;abort&#39;</code>, <code>&#39;aborted&#39;</code> äº‹ä»¶çš„å¼ƒç”¨ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨ Node.js çš„ <code>http</code> æ¨¡å—æ˜¯ç”¨æ¥åˆ›å»º HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ã€‚è€Œå½“ä½ å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æˆ–å“åº”æ—¶ï¼Œè¿™äº›æ“ä½œå¯èƒ½ä¼šè¢«ä¸­æ–­æˆ–è€…å–æ¶ˆï¼Œä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨ç­‰å¾…æœåŠ¡å™¨å“åº”æ—¶å…³é—­äº†è¿æ¥ï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¼šè¢«ä¸­æ­¢ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œ<code>http.IncomingMessage</code> ç±»ï¼ˆå®ƒä»£è¡¨ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚æˆ–å“åº”ï¼‰æœ‰ä¸€ä¸ª<code>.aborted</code>å±æ€§ä»¥åŠå¯ä»¥ç›‘å¬çš„<code>&#39;abort&#39;</code>å’Œ<code>&#39;aborted&#39;</code>äº‹ä»¶ã€‚å½“è¯·æ±‚/å“åº”è¢«ä¸­æ­¢æ—¶ï¼Œ<code>.aborted</code>å±æ€§ä¼šå˜æˆ <code>true</code>ï¼ŒåŒæ—¶ä¼šè§¦å‘<code>&#39;abort&#39;</code>æˆ–<code>&#39;aborted&#39;</code>äº‹ä»¶ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼ŒNode.js æ ¸å¿ƒå›¢é˜Ÿå†³å®šå¼ƒç”¨ <code>.aborted</code> å±æ€§å’Œç›¸å…³äº‹ä»¶ï¼Œå› ä¸ºå®ƒä»¬å¼•å…¥äº†æ›´ç°ä»£çš„æ–¹æ³•ï¼ˆå¦‚ä½¿ç”¨ <code>AbortSignal</code> å’Œ <code>AbortController</code>ï¼‰æ¥å¤„ç†è¿™ç±»æƒ…å†µã€‚å¼ƒç”¨æ„å‘³ç€è¿™äº›åŠŸèƒ½ä»ç„¶å­˜åœ¨äºå½“å‰ç‰ˆæœ¬ä¸­ï¼Œä½†å°†æ¥å¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œå¹¶ä¸”ä¸å»ºè®®åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å®é™…ä¾‹å­æ¥è¯´æ˜è¿™äº›æ¦‚å¿µï¼š</p><p><strong>æ—§æ–¹æ³• - ä½¿ç”¨å·²å¼ƒç”¨çš„<code>.aborted</code>å±æ€§å’Œäº‹ä»¶ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Got response: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™ä¸ªäº‹ä»¶å¯èƒ½ä¸ä¼šå†è§¦å‘äº†ï¼Œå› ä¸ºå®ƒå·²ç»è¢«å¼ƒç”¨ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;aborted&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The response was aborted!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ¤æ–­è¯·æ±‚æ˜¯å¦è¢«ä¸­æ­¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">aborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The request was aborted!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–°æ–¹æ³• - ä½¿ç”¨<code>AbortController</code>:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-abort-controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Got response: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœæƒ³è¦ä¸­æ­¢è¯·æ±‚ï¼Œå¯ä»¥è°ƒç”¨ controller.abort()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†å–æ¶ˆè¯·æ±‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;abort&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request has been aborted!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„æ–°æ–¹æ³•ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª <code>AbortController</code> å®ä¾‹æ¥åˆ›å»ºä¸€ä¸ªå¯ç”¨äºå¤šä¸ªè¯·æ±‚çš„ <code>signal</code> å¯¹è±¡ã€‚å½“æˆ‘ä»¬æƒ³ä¸­æ­¢è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>controller.abort()</code> æ–¹æ³•ã€‚è¿™ä¼šè§¦å‘ç»‘å®šåˆ° <code>signal</code> å¯¹è±¡çš„ <code>&#39;abort&#39;</code> äº‹ä»¶ï¼Œå…è®¸æˆ‘ä»¬å“åº”è¯·æ±‚çš„å–æ¶ˆã€‚</p><p>æ€»ç»“æ¥è¯´ï¼ŒNode.js ä¸­å…³äº HTTP è¯·æ±‚å’Œå“åº”çš„ä¸­æ­¢æœºåˆ¶å·²é€æ¸ä»è¿‡å»çš„ <code>.aborted</code> å±æ€§å’Œç›¸å…³äº‹ä»¶è¿ç§»åˆ°åŸºäº <code>AbortController</code> å’Œ <code>AbortSignal</code> çš„ç°ä»£ APIã€‚è¿™ç§å˜åŒ–ä¸»è¦æ˜¯ä¸ºäº†ä¸æµè§ˆå™¨ä¸­çš„ API ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶æä¾›æ›´å¼ºå¤§å’Œçµæ´»çš„æ–¹å¼æ¥å¤„ç†å¯ä¸­æ­¢çš„æ“ä½œã€‚</p><h3 id="dep0157-thenable-support-in-streams" tabindex="-1"><a class="header-anchor" href="#dep0157-thenable-support-in-streams"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0157" target="_blank" rel="noopener noreferrer">DEP0157: Thenable support in streams</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™å¤§é‡æ•°æ®çš„ä¸€ç§æœºåˆ¶ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ æƒ³ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®æˆ–è€…å†™å…¥æ•°æ®ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨åˆ°æµã€‚</p><p>è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æµç›¸å…³çš„å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>å¯è¯»æµï¼ˆReadable Streamï¼‰</strong>ï¼šè¿™ç§æµæ˜¯ç”¨æ¥è¯»å–æ•°æ®çš„ï¼Œä¾‹å¦‚è¯»å–æ–‡ä»¶å†…å®¹ã€‚</li><li><strong>å¯å†™æµï¼ˆWritable Streamï¼‰</strong>ï¼šè¿™ç§æµæ˜¯ç”¨æ¥å†™å…¥æ•°æ®çš„ï¼Œæ¯”å¦‚å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</li><li><strong>è½¬æ¢æµï¼ˆTransform Streamï¼‰</strong>ï¼šå¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œé€šå¸¸ç”¨äºæ•°æ®è½¬æ¢ã€‚</li><li><strong>ç®¡é“æµï¼ˆPipeline Streamï¼‰</strong>ï¼šå¯ä»¥å°†å¤šä¸ªæµè¿æ¥åœ¨ä¸€èµ·ï¼Œæ•°æ®ä¾æ¬¡é€šè¿‡è¿™äº›æµã€‚</li></ol><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œæµä¸»è¦åŸºäºå›è°ƒå‡½æ•°å’Œäº‹ä»¶æ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚ä½†æ˜¯éšç€ Promise å’Œ async/await çš„å‡ºç°ï¼Œè¿™äº›æ–°çš„ç‰¹æ€§ä½¿å¾—å¤„ç†å¼‚æ­¥æ›´åŠ ç®€æ´å’Œæ˜“äºç†è§£ã€‚</p><h3 id="dep0157-thenable-æ”¯æŒåœ¨æµä¸­çš„å¼ƒç”¨" tabindex="-1"><a class="header-anchor" href="#dep0157-thenable-æ”¯æŒåœ¨æµä¸­çš„å¼ƒç”¨"><span>DEP0157: Thenable æ”¯æŒåœ¨æµä¸­çš„å¼ƒç”¨</span></a></h3><p>åœ¨å¼•å…¥ <code>DEP0157</code> å¼ƒç”¨è­¦å‘Šä¹‹å‰ï¼ŒNode.js ä¸­çš„æµæ¨¡å—æ”¯æŒæ‰€è°“çš„ &quot;thenable&quot; å¯¹è±¡ã€‚&quot;Thenable&quot; å¯¹è±¡æ˜¯ä»»ä½•å«æœ‰ <code>.then()</code> æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åƒ Promise é‚£æ ·å·¥ä½œï¼Œå³å¯ä»¥è¢« <code>await</code> å…³é”®å­—ç­‰å¾…ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªè¿”å› thenable å¯¹è±¡çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥é“¾æ¥ä¸€ä¸ª <code>.then()</code> æ–¹æ³•ã€‚åœ¨è€ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œä½ å¯ä»¥åœ¨æµä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸ª thenable å¯¹è±¡ï¼Œæµä¼šè‡ªåŠ¨åœ°ç­‰å¾…è¿™ä¸ª thenable è§£å†³ (resolve) åå†ç»§ç»­å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ˜¯ä¸€ä¸ªthenableå¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ª.thenæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> thenable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨è€ç‰ˆæœ¬çš„Node.jsä¸­ï¼Œä½ å¯ä»¥å°†thenableå¯¹è±¡ç›´æ¥å†™å…¥æµä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å° &#39;some data&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">thenable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶è€Œï¼ŒNode.js v21.7.1 å¼•å…¥çš„ DEP0157 è­¦å‘Šæ„å‘³ç€è¿™ç§è¡Œä¸ºå°†ä¼šè¢«å¼ƒç”¨ã€‚åŸå› æ˜¯è¿™ç§æ··åˆä½¿ç”¨ Promise å’Œé Promise çš„æ–¹å¼ä¼šå¯¼è‡´ä¸€äº›æ··ä¹±å’Œå¤æ‚çš„æƒ…å†µï¼Œå°¤å…¶æ˜¯åœ¨é”™è¯¯å¤„ç†æ–¹é¢ã€‚</p><p>åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ å°è¯•å°† thenable å¯¹è±¡ä½œä¸ºæ•°æ®å†™å…¥æµä¸­ï¼ŒNode.js å°†ä¸ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æµä¸ä¼šç­‰å¾… thenable è§£å†³åå†ç»§ç»­ã€‚ä½ éœ€è¦æ˜¾å¼åœ°è§£å†³ thenable ç„¶åå°†ç»“æœå†™å…¥æµï¼Œæˆ–è€…å®Œå…¨ä½¿ç”¨ Promise å’Œ async/awaitã€‚</p><p>å› æ­¤ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js å¼€å‘å¹¶ä¸”åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†ç±»ä¼¼çš„æ¨¡å¼ï¼Œä½ åº”è¯¥æ›´æ–°ä½ çš„ä»£ç ï¼Œä»¥é¿å…ä»¥åå‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªä½¿ç”¨ Promise æ­£ç¡®ä½¿ç”¨æµçš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªPromise</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰“å° &#39;some data&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç­‰å¾…Promiseè§£å†³ï¼Œå¹¶å°†ç»“æœå†™å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>DEP0157</code> è­¦å‘Šæ˜¯å…³äºåœ¨ Node.js æµä¸­æ”¯æŒ thenable å¯¹è±¡çš„å¼ƒç”¨ã€‚è¿™æ„å‘³ç€ä½ åº”è¯¥é¿å…å°† thenable å¯¹è±¡ç›´æ¥å†™å…¥æµä¸­ï¼Œå¹¶æ”¹ä¸ºä½¿ç”¨æ ‡å‡†çš„ Promise æ¥å£æ¥ç®¡ç†ä½ çš„å¼‚æ­¥æ•°æ®æµã€‚</p><h3 id="dep0158-buffer-slice-start-end" tabindex="-1"><a class="header-anchor" href="#dep0158-buffer-slice-start-end"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0158" target="_blank" rel="noopener noreferrer">DEP0158: buffer.slice(start, end)</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ <code>DEP0158</code> ä»£å·è¡¨ç¤ºçš„å†…å®¹ã€‚</p><p>é¦–å…ˆï¼Œ<code>DEP0158</code> æ˜¯ Node.js å®˜æ–¹æ–‡æ¡£ä¸­ç”¨äºæ ‡è®°æŸä¸ªç‰¹æ€§æˆ–è€…å‡½æ•°ä½œä¸º &quot;ä¸æ¨èä½¿ç”¨&quot;ï¼ˆdeprecatedï¼‰çš„ä¸€ä¸ªç¼–å·ã€‚è¿™ç§æ ‡è®°é€šå¸¸æ„å‘³ç€è¯¥åŠŸèƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–è€…ä¿®æ”¹ï¼Œå› æ­¤å»ºè®®å¼€å‘è€…é¿å…ä½¿ç”¨å®ƒï¼Œå¹¶å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ç°åœ¨å…·ä½“æ¥è¯´ï¼Œ<code>DEP0158</code> æ˜¯å…³äº <code>Buffer</code> å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³• <code>slice(start, end)</code> çš„åºŸå¼ƒè­¦å‘Šã€‚<code>Buffer</code> åœ¨ Node.js ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å…¨å±€å¯¹è±¡ï¼Œç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®æµï¼Œæ¯”å¦‚è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>slice()</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> slicedBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">slice</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">slicedBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º &#39;Hello&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸² &quot;Hello World&quot; çš„ <code>Buffer</code> å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ <code>slice()</code> æ–¹æ³•æ¥ã€Œåˆ‡å‡ºã€å‰äº”ä¸ªå­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯ &quot;Hello&quot;ï¼‰ã€‚ç»“æœæ˜¯ä¸€ä¸ªæ–°çš„ <code>Buffer</code> å¯¹è±¡ï¼Œå…¶ä¸­åªåŒ…å«äº†é€‰å®šçš„éƒ¨åˆ†ã€‚</p><p>ä½†æ˜¯ï¼Œè‡ªä»è¿™ä¸ªæ–¹æ³•è¢«æ ‡è®°ä¸º <code>DEP0158</code>ï¼Œæ„å‘³ç€å®ƒè¢«è®¤ä¸ºæ˜¯æœ‰é—®é¢˜çš„ï¼Œå¯èƒ½æ˜¯ç”±äºæ€§èƒ½è€ƒé‡ã€å®‰å…¨åŸå› æˆ–è€…å…¶ä»–çš„è®¾è®¡ç¼ºé™·ã€‚å½“ä½ çœ‹åˆ°è¿™æ ·çš„åºŸå¼ƒè­¦å‘Šæ—¶ï¼Œä½ åº”è¯¥å»æŸ¥çœ‹ Node.js çš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£èƒŒåçš„åŸå› ä»¥åŠæ¨èçš„æ›¿ä»£æ–¹æ³•ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœ <code>buffer.slice(start, end)</code> è¿™ç§ç‰¹å®šæ–¹å¼è¢«ä½¿ç”¨ï¼Œå¯èƒ½ä¼šåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºä½ è¿™ä¸ª API å·²ç»ä¸å†æ¨èä½¿ç”¨ã€‚æ­¤æ—¶ä½ åº”è¯¥æŸ¥æ‰¾ç°ä»£çš„ã€æ›´åˆé€‚çš„æ–¹æ³•æ¥æ›¿æ¢æ‰ä½ ä¹‹å‰çš„ä»£ç ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ éœ€è¦æˆªå– <code>Buffer</code> ä¸­çš„ä¸€æ®µæ•°æ®ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–çš„ <code>Buffer</code> ç›¸å…³çš„æ–¹æ³•ï¼Œæ¯”å¦‚ <code>subarray()</code> æˆ–è€…åˆ©ç”¨ <code>Buffer</code> çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Buffer</code> å®ä¾‹ï¼Œè¿™å–å†³äº Node.js å½“å‰æ¨èçš„æœ€ä½³å®è·µã€‚</p><p><strong>æ³¨æ„ï¼š</strong> ç”±äº Node.js çš„ API ç»å¸¸æ›´æ–°ï¼Œå…·ä½“çš„åºŸå¼ƒä¿¡æ¯å’Œæ›¿ä»£æ–¹æ¡ˆï¼Œè¯·åŠ¡å¿…å‚ç…§æœ€æ–°çš„å®˜æ–¹æ–‡æ¡£æˆ–è€…ç›¸å…³çš„æ›´æ–°è¯´æ˜ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>DEP0158</code> æ˜¯ä¸€ä¸ªæé†’ä½ ä¸è¦ä½¿ç”¨ <code>Buffer.slice(start, end)</code> æ–¹æ³•çš„è­¦å‘Šï¼Œè€Œåº”è¯¥å¯»æ‰¾å’Œé‡‡çº³æ–°çš„ã€æ¨èçš„æ–¹å¼æ¥å¤„ç† <code>Buffer</code>ã€‚è¿™æ˜¯ Node.js ä¸æ–­å‘å±•å’Œæ”¹è¿›çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ç¼–ç¨‹ä¸­äº†è§£å’Œå“åº”è¿™äº›å˜åŒ–æ˜¯å¾ˆé‡è¦çš„ã€‚</p><h3 id="dep0159-err-invalid-callback" tabindex="-1"><a class="header-anchor" href="#dep0159-err-invalid-callback"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0159" target="_blank" rel="noopener noreferrer">DEP0159: ERR_INVALID_CALLBACK</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘å¸®ä½ äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>[DEP0159: ERR_INVALID_CALLBACK]</code> è¿™ä¸ªè­¦å‘Šä¿¡æ¯ã€‚</p><p>åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œå¼€å‘è€…ä¼šåœ¨ API æ–‡æ¡£ä¸­çœ‹åˆ°å¸¦æœ‰ &quot;DEP&quot; å‰ç¼€çš„ä»£ç ï¼Œè¿™æ˜¯æŒ‡ä¸€ä¸ªâ€œå¼ƒç”¨è­¦å‘Šâ€ï¼ˆDeprecation Warningï¼‰ã€‚è¿™æ„å‘³ç€æŸä¸ªåŠŸèƒ½æˆ–åšæ³•å·²ç»ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™æ ·çš„æœºåˆ¶ä½¿å¾—å¼€å‘è€…æœ‰æ—¶é—´å»æ›´æ–°å’Œä¿®æ”¹ä»–ä»¬çš„ä»£ç ï¼Œä»¥é€‚åº”æ–°çš„æ¨èåšæ³•ã€‚</p><p>ç‰¹åˆ«åœ°ï¼Œ<code>[DEP0159: ERR_INVALID_CALLBACK]</code> æ˜¯ä¸€ä¸ªè­¦å‘Šæ ‡è¯†ï¼Œè¡¨ç¤ºå½“ Node.js æœŸæœ›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰æ”¶åˆ°æˆ–è€…æ”¶åˆ°çš„ä¸æ˜¯å‡½æ•°æ—¶ï¼Œå°±ä¼šæŠ›å‡º <code>ERR_INVALID_CALLBACK</code> é”™è¯¯ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå›è°ƒé€šå¸¸ç”¨äºå¼‚æ­¥æ“ä½œâ€”â€”ä¾‹å¦‚è¯»å–æ–‡ä»¶ã€å‘èµ·ç½‘ç»œè¯·æ±‚ç­‰ã€‚å½“è¿™äº›å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œå›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œä»¥å¤„ç†ç»“æœæˆ–é”™è¯¯ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£ç¡®çš„ç”¨æ³•ï¼šæä¾›äº†ä¸€ä¸ªå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;There was an error reading the file!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File content:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é”™è¯¯çš„ç”¨æ³•ï¼šæ²¡æœ‰æä¾›å›è°ƒå‡½æ•°æˆ–æä¾›çš„ä¸æ˜¯å‡½æ•°ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç¬¬ä¸€ç§ç”¨æ³•æ˜¯æ­£ç¡®çš„ã€‚æˆ‘ä»¬ä½¿ç”¨äº† <code>fs.readFile</code> æ–¹æ³•æ¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¸”ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªæ­£ç¡®çš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªé”™è¯¯å¯¹è±¡ <code>err</code> å’Œæ–‡ä»¶å†…å®¹ <code>data</code>ã€‚</p><p>å¦‚æœæ“ä½œæˆåŠŸå®Œæˆï¼Œ<code>err</code> å°†æ˜¯ <code>null</code> ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†æ–‡ä»¶å†…å®¹ <code>data</code> ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œ<code>err</code> å°†åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†é”™è¯¯æƒ…å†µã€‚</p><p>ç¬¬äºŒç§ç”¨æ³•æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º <code>fs.readFile</code> æ–¹æ³•æœŸæœ›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å´ä¼ é€’äº†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒNode.js å°†ä¼šæŠ›å‡º <code>ERR_INVALID_CALLBACK</code> é”™è¯¯ï¼Œå¹¶ä¸”ä¼´éšç€ <code>[DEP0159]</code> è­¦å‘Šï¼Œè¯´æ˜è¿™æ ·çš„ç”¨æ³•æ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”å¯èƒ½åœ¨å°†æ¥ç§»é™¤æ”¯æŒã€‚</p><p>æ€»ä¹‹ï¼Œå½“ä½ çœ‹åˆ° <code>[DEP0159: ERR_INVALID_CALLBACK]</code> è¿™ä¸ªè­¦å‘Šæ—¶ï¼Œä½ éœ€è¦æ£€æŸ¥ä½ çš„ä»£ç ï¼Œç¡®ä¿åœ¨éœ€è¦å›è°ƒå‡½æ•°çš„åœ°æ–¹æä¾›äº†ä¸€ä¸ªæœ‰æ•ˆçš„å‡½æ•°ã€‚è¿™æ ·çš„åšæ³•å¯ä»¥é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼Œå¹¶ç¡®ä¿ä»£ç çš„ç¨³å®šæ€§ã€‚</p><h3 id="dep0160-process-on-multipleresolves-handler" tabindex="-1"><a class="header-anchor" href="#dep0160-process-on-multipleresolves-handler"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0160" target="_blank" rel="noopener noreferrer">DEP0160: process.on(&#39;multipleResolves&#39;, handler)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€èŠ Node.js ä¸­çš„ <code>process.on(&#39;multipleResolves&#39;, handler)</code> è¿™ä¸ªåŠŸèƒ½ï¼Œä»¥åŠå®ƒåœ¨ v21.7.1 ä¸­ä¸ºä½•è¢«æ ‡è®°ä¸ºå¼ƒç”¨ (<code>DEP0160</code>)ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£ <code>multipleResolves</code> äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Node.js ä¸­çš„ Promise æ˜¯ä»€ä¹ˆã€‚Promise æ˜¯ JavaScript ä¸­ç”¨äºå¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚ç®€å•è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»£è¡¨äº†å¼‚æ­¥æ“ä½œæˆåŠŸæˆ–å¤±è´¥ç»“æœçš„å¯¹è±¡ã€‚</p><p>é€šå¸¸ï¼Œä¸€ä¸ª Promise åªä¼šè§£å†³ï¼ˆresolveï¼‰æˆ–æ‹’ç»ï¼ˆrejectï¼‰ä¸€æ¬¡ï¼Œè¿™è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œå®Œæˆäº†å®ƒçš„å·¥ä½œã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ç”±äºä»£ç ä¸­çš„é”™è¯¯ï¼Œä¸€ä¸ª Promise å¯èƒ½ä¼šå°è¯•å»å¤šæ¬¡è§£å†³æˆ–æ‹’ç»ï¼Œæˆ–è€…å³è§£å†³åˆæ‹’ç»ã€‚è¿™å½“ç„¶æ˜¯ä¸æ­£å¸¸çš„è¡Œä¸ºï¼Œå› ä¸º Promise çš„è®¾è®¡å°±æ˜¯åªæœ‰ä¸€ä¸ªæœ€ç»ˆçŠ¶æ€ã€‚</p><p>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒNode.js å…è®¸å¼€å‘è€…é€šè¿‡ç›‘å¬ <code>multipleResolves</code> äº‹ä»¶æ¥è¿½è¸ªè¿™ç§å¼‚å¸¸æƒ…å†µã€‚ä½ å¯ä»¥æ³¨å†Œä¸€ä¸ªå¤„ç†å™¨æ¥ç›‘å¬ Promise æ˜¯å¦æœ‰å¤šæ¬¡è§£å†³æˆ–æ‹’ç»ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;multipleResolves&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reason</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reason</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸€ä¸ª Promise å¤šæ¬¡è§£å†³æˆ–æ‹’ç»ï¼ŒNode.js å°±ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ä¸Šé¢çš„å›è°ƒå‡½æ•°ã€‚è¿™é‡Œçš„å‚æ•° <code>type</code> è¡¨ç¤ºäº‹ä»¶ç±»å‹ï¼ˆæ˜¯å¤šæ¬¡è§£å†³è¿˜æ˜¯æ‹’ç»ï¼‰ï¼Œ<code>promise</code> æ˜¯ç›¸å…³çš„ Promise å¯¹è±¡ï¼Œ<code>reason</code> åˆ™æ˜¯è§£å†³æˆ–æ‹’ç»çš„å€¼æˆ–åŸå› ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>multipleResolves</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆDEP0160ï¼‰ã€‚è¿™æ„å‘³ç€ Node.js è®¤ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸å†æ˜¯æœ€ä½³å®è·µï¼Œå¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨å®ƒã€‚å°†æ¥çš„ Node.js ç‰ˆæœ¬å¯èƒ½ä¼šå®Œå…¨ç§»é™¤æ­¤åŠŸèƒ½ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ <code>multipleResolves</code> ä¼šè¢«å¼ƒç”¨å‘¢ï¼Ÿåœ¨ Node.js å’Œ JavaScript ç¤¾åŒºä¸­ï¼Œé€šå¸¸è®¤ä¸ºæ­£ç¡®çš„é”™è¯¯å¤„ç†ä¸ä»£ç è´¨é‡ç®¡ç†åº”è¯¥ç¡®ä¿ Promise ä¸ä¼šå¤šæ¬¡è§£å†³æˆ–æ‹’ç»ã€‚å¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œå®ƒé€šå¸¸æŒ‡å‘ä»£ç ä¸­è¾ƒæ·±å±‚æ¬¡çš„é—®é¢˜ã€‚å› æ­¤ï¼Œè€Œä¸æ˜¯æä¾›ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶æ¥å¤„ç†è¿™ç§æ„å¤–æƒ…å†µï¼Œå¼€å‘è€…ä»¬è¢«é¼“åŠ±å»ä¿®å¤å¯¼è‡´å¤šé‡è§£å†³çš„æ ¹æœ¬åŸå› ï¼Œä¾‹å¦‚ä»£ç é€»è¾‘é”™è¯¯æˆ–é”™è¯¯ä½¿ç”¨ Promiseã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>process.on(&#39;multipleResolves&#39;, handler)</code> åœ¨ Node.js ä¸­ç”¨äºæ•è·å¹¶å¤„ç†ä¸€ä¸ª Promise è¢«å¤šæ¬¡è§£å†³æˆ–æ‹’ç»çš„æƒ…å†µã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªäº‹ä»¶è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå› ä¸ºç¤¾åŒºè®¤ä¸ºå¼€å‘è€…åº”è¯¥é›†ä¸­ç²¾åŠ›ä¿®å¤å¯¼è‡´è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ ¹æœ¬é—®é¢˜ï¼Œè€Œä¸æ˜¯ä¾èµ–äºè¿™æ ·çš„äº‹ä»¶æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p><h3 id="dep0161-process-getactiverequests-and-process-getactivehandles" tabindex="-1"><a class="header-anchor" href="#dep0161-process-getactiverequests-and-process-getactivehandles"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0161" target="_blank" rel="noopener noreferrer">DEP0161: process._getActiveRequests() and process._getActiveHandles()</a></span></a></h3><p>å¥½çš„ï¼Œé¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„ <code>process._getActiveRequests()</code> å’Œ <code>process._getActiveHandles()</code> æ–¹æ³•ã€‚</p><p>åœ¨ Node.js ä¹‹ä¸­ï¼Œ<code>process</code> æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæä¾›äº†å½“å‰è¿è¡Œçš„ Node.js è¿›ç¨‹çš„ä¿¡æ¯ä¸æ§åˆ¶ã€‚è€Œ <code>process._getActiveRequests()</code> å’Œ <code>process._getActiveHandles()</code> æ˜¯ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬ç”¨äºè°ƒè¯•ç›®çš„ï¼Œå…è®¸å¼€å‘è€…å¾—åˆ°å…³äºå½“å‰è¿›ç¨‹çš„æ´»è·ƒè¯·æ±‚ï¼ˆå¦‚ HTTP è¯·æ±‚ï¼‰å’Œæ´»è·ƒå¥æŸ„ï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ã€å®šæ—¶å™¨ã€å¥—æ¥å­—ç­‰ï¼‰çš„ä¿¡æ¯ã€‚</p><ul><li><p><code>process._getActiveRequests()</code>: è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº†å½“å‰äº‹ä»¶å¾ªç¯ä¸­æœªå®Œæˆçš„ I/O è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å‘é€äº†ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå¹¶ä¸”æœåŠ¡å™¨è¿˜æ²¡æœ‰å“åº”ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚ä¼šå‡ºç°åœ¨ <code>_getActiveRequests</code> è¿”å›çš„æ•°ç»„ä¸­ã€‚</p></li><li><p><code>process._getActiveHandles()</code>: è¿™ä¸ªå‡½æ•°ä¹Ÿè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯å®ƒåŒ…å«çš„æ˜¯å½“å‰äº‹ä»¶å¾ªç¯ä¸­æ´»è·ƒçš„å¥æŸ„ã€‚å¥æŸ„å¯ä»¥æ˜¯å„ç§ç±»å‹ï¼Œæ¯”å¦‚å®šæ—¶å™¨ã€TCP/UDP å¥—æ¥å­—ã€æ–‡ä»¶æµç­‰ç­‰ã€‚ä»»ä½•éœ€è¦ Node.js ä¿æŒäº‹ä»¶å¾ªç¯è¿è½¬ç›´åˆ°å®Œæˆç‰¹å®šä»»åŠ¡çš„å¯¹è±¡éƒ½ä¼šè¢«è§†ä½œä¸€ä¸ªæ´»è·ƒçš„å¥æŸ„ã€‚</p></li></ul><p>ç„¶è€Œï¼Œ<code>DEP0161</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‡è¯†ï¼Œå«åš&quot;å¼ƒç”¨è­¦å‘Š&quot;ã€‚å½“ä½ çœ‹åˆ°è¿™ä¸ªæ ‡è¯†æ—¶ï¼Œæ„å‘³ç€è¿™äº› API æˆ–åŠŸèƒ½å°†æ¥å¯èƒ½ä¼šä» Node.js ä¸­ç§»é™¤ã€‚åœ¨ v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>process._getActiveRequests()</code> å’Œ <code>process._getActiveHandles()</code> è¢«æ ‡è®°ä¸º Deprecatedï¼ˆå¼ƒç”¨ï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä»ç„¶å­˜åœ¨å¹¶ä¸”å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šåˆ é™¤ï¼Œå› æ­¤ä¸å»ºè®®åœ¨æ–°çš„ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ æƒ³äº†è§£å½“å‰æœ‰å¤šå°‘å®šæ—¶å™¨æ­£åœ¨ç­‰å¾…æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> timeout1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  /* ... */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> timeout2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  /* ... */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">_getActiveHandles</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå¯èƒ½åŒ…å«äº†ä¸Šé¢åˆ›å»ºçš„å®šæ—¶å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¸…é™¤å®šæ—¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timeout1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clearTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timeout2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆæˆ–è€…ä½ å‘èµ·äº†ä¸€ä¸ª HTTP è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†å“åº”æ•°æ®...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å“åº”æ•°æ®æ¥æ”¶å®Œæ¯•...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ—¶ä½ å¯ä»¥æŸ¥çœ‹ _getActiveRequests æ¥ç¡®è®¤è¯¥è¯·æ±‚æ˜¯å¦ä»å¤„äºæ¿€æ´»çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">_getActiveRequests</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå°†åŒ…å«ä¸Šé¢å‘èµ·çš„ HTTP è¯·æ±‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¤„ç†ç”Ÿäº§çº§çš„ä»£ç æ—¶ï¼Œä½ åº”å½“é¿å…ä½¿ç”¨å¸¦æœ‰ä¸‹åˆ’çº¿å‰ç¼€çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬è¢«è®¤ä¸ºæ˜¯ Node.js å†…éƒ¨ä½¿ç”¨çš„ç§æœ‰ APIã€‚å–è€Œä»£ä¹‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¬å…± API æˆ–è€…å…¶ä»–å·¥å…·æ¥è¿›è¡Œæ€§èƒ½ç›‘æµ‹å’Œè°ƒè¯•ã€‚ä¾‹å¦‚ï¼ŒNode.js æä¾›äº† <code>async_hooks</code> æ¨¡å—ï¼Œå¯ä»¥è¿½è¸ªå¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒæä¾›äº†ç±»ä¼¼åŠŸèƒ½ä½†æ˜¯æ˜¯æ­£å¼æ”¯æŒçš„ APIã€‚</p><h3 id="dep0162-fs-write-fs-writefilesync-coercion-to-string" tabindex="-1"><a class="header-anchor" href="#dep0162-fs-write-fs-writefilesync-coercion-to-string"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0162" target="_blank" rel="noopener noreferrer">DEP0162: fs.write(), fs.writeFileSync() coercion to string</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>fs</code> æ¨¡å—æ˜¯ç”¨æ¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæ¯”å¦‚è¯»å†™æ–‡ä»¶ã€‚åœ¨è¿‡å»çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>fs.write()</code> æˆ– <code>fs.writeFileSync()</code> å‡½æ•°æ¥å†™æ•°æ®åˆ°æ–‡ä»¶æ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šæ¥å—ä¸åŒç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€Bufferï¼ˆä¸€ç§ç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„å¯¹è±¡ï¼‰ç­‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥å­—ç¬¦ä¸²æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥ Buffer æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ ä¸å°å¿ƒä¼ å…¥äº†ä¸€ä¸ªéå­—ç¬¦ä¸²æˆ–é Buffer çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°å­—æˆ–è€…ä¸€ä¸ªå¯¹è±¡ï¼ŒNode.js ä¼šå°è¯•å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç„¶åå†™å…¥æ–‡ä»¶ã€‚è¿™ç§éšå¼è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ„æƒ³ä¸åˆ°çš„åæœå’Œ bugï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½èƒ½å¤Ÿæœ‰æ„ä¹‰åœ°è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ è¯¯ä¼ äº†ä¸€ä¸ªæ•°å­—ï¼Œä¼šå‘ç”Ÿéšå¼è½¬æ¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// &#39;123&#39; ä¼šè¢«å†™å…¥æ–‡ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœä¼ å…¥äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä¼šè¢«è½¬æ¢æˆ &#39;[object Object]&#39; å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–‡ä»¶å†…å®¹ä¼šå˜æˆ &quot;[object Object]&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œè¿™ä¸ªè¡Œä¸ºå·²ç»è¢«è®¤ä¸ºæ˜¯ä¸å¥½çš„å®è·µï¼Œå¹¶ä¸”å·²ç»è¢«åºŸå¼ƒï¼ˆdeprecatedï¼‰ï¼Œè¿™å°±æ˜¯ DEP0162ã€‚åºŸå¼ƒæ„å‘³ç€åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¿™ç§è¡Œä¸ºå¯èƒ½ä¼šè¢«ç§»é™¤ï¼Œè€Œç°åœ¨åˆ™ä¼šç»™å‡ºè­¦å‘Šã€‚æ‰€ä»¥ï¼Œå½“ä½ çœ‹åˆ° DEP0162 è¿™ä¸ªæ ‡è¯†æ—¶ï¼Œå®ƒæ˜¯åœ¨æé†’ä½ è¯´ï¼šä½¿ç”¨ <code>fs.write()</code> å’Œ <code>fs.writeFileSync()</code> æ—¶åº”è¯¥æ˜¾å¼åœ°ä¼ å…¥å­—ç¬¦ä¸²æˆ– Buffer ç±»å‹çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¾èµ– Node.js çš„éšå¼ç±»å‹è½¬æ¢ã€‚</p><p>å› æ­¤ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ç¡®ä¿ä½ è‡ªå·±è½¬æ¢ä»»ä½•éå­—ç¬¦ä¸²å’Œé Buffer æ•°æ®åˆ°æ­£ç¡®çš„æ ¼å¼ï¼Œç„¶åå†å†™å…¥æ–‡ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ˜¾å¼è½¬æ¢å†™å…¥æ•°å­—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨æ˜¾å¼åœ°æŠŠæ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ JSON.stringify æ˜¾å¼è½¬æ¢å¯¹è±¡åˆ°å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> })); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–‡ä»¶å†…å®¹ä¸º &#39;{&quot;hello&quot;:&quot;world&quot;}&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œä½ å°±èƒ½é¿å…æ½œåœ¨çš„é”™è¯¯ï¼Œå¹¶ä¸”ä½¿ä½ çš„ä»£ç å¯¹æœªæ¥ç‰ˆæœ¬çš„ Node.js æ›´åŠ å¥å£®ã€‚</p><h3 id="dep0163-channel-subscribe-onmessage-channel-unsubscribe-onmessage" tabindex="-1"><a class="header-anchor" href="#dep0163-channel-subscribe-onmessage-channel-unsubscribe-onmessage"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0163" target="_blank" rel="noopener noreferrer">DEP0163: channel.subscribe(onMessage), channel.unsubscribe(onMessage)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥ä¸ºä½ è§£é‡Š Node.js ä¸­è¿™ä¸ªåºŸå¼ƒï¼ˆDeprecationï¼‰è­¦å‘Š DEP0163ã€‚</p><p>åœ¨ Node.js é‡Œï¼Œ&quot;Deprecation&quot;ï¼ˆåºŸå¼ƒï¼‰æ˜¯æŒ‡æŸä¸ªåŠŸèƒ½æˆ–è€… API ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚DEP0163 æ¶‰åŠçš„æ˜¯ <code>channel.subscribe()</code> å’Œ <code>channel.unsubscribe()</code> è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><p>é¦–å…ˆéœ€è¦çŸ¥é“çš„æ˜¯ï¼Œ<code>channel</code> é€šå¸¸æŒ‡çš„æ˜¯ <code>EventEmitter</code> ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªç±»æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªç”¨äºå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒæ¨¡å—ã€‚åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šæ¨¡å—å’Œå¯¹è±¡éƒ½ç»§æ‰¿è‡ª EventEmitterï¼Œå…è®¸å®ƒä»¬å‘å‡ºï¼ˆemitï¼‰å’Œç›‘å¬ï¼ˆlisten toï¼‰äº‹ä»¶ã€‚è¿™å°±åƒæ˜¯ä¸€ä¸ªå¹¿æ’­ç³»ç»Ÿï¼Œå…¶ä¸­ <code>emit</code> æ˜¯å¹¿æ’­ä¿¡å·ï¼Œè€Œ <code>subscribe</code> åˆ™æ˜¯è®¾ç½®æ¥æ”¶å™¨æ¥æ”¶å¬ç‰¹å®šçš„é¢‘é“æˆ–ä¿¡å·ã€‚</p><p>åœ¨æ—§çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æƒ³è¦ç›‘å¬ä¸€ä¸ªç‰¹å®šçš„æ¶ˆæ¯é¢‘é“ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>channel.subscribe(onMessage)</code> æ–¹æ³•æ¥æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå³ <code>onMessage</code>ï¼‰ï¼Œå½“æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚ç›¸åº”åœ°ï¼Œå¦‚æœä½ æƒ³åœæ­¢ç›‘å¬ï¼Œä½ ä¼šä½¿ç”¨ <code>channel.unsubscribe(onMessage)</code> æ¥ç§»é™¤ä¹‹å‰æ³¨å†Œçš„é‚£ä¸ªå›è°ƒå‡½æ•°ã€‚</p><p>ç„¶è€Œï¼Œä» Node.js v21.7.1 å¼€å§‹ï¼Œè¿™ç§åšæ³•å·²ç»è¢«åºŸå¼ƒäº†ã€‚åºŸå¼ƒçš„åŸå› å¯èƒ½åŒ…æ‹¬è¯¥ API è®¾è®¡ä¸Šçš„é—®é¢˜ã€æ›´æ–°æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆæˆ–è€…å…¶ä»–ä¸€äº›æ€§èƒ½å’Œå®‰å…¨è€ƒè™‘ã€‚</p><p>å–è€Œä»£ä¹‹ï¼Œä½ ç°åœ¨åº”è¯¥ä½¿ç”¨ <code>EventEmitter</code> ä¸Šçš„ <code>on</code> å’Œ <code>off</code> æ–¹æ³•æ¥è¿›è¡Œäº‹ä»¶ç›‘å¬å’Œåœæ­¢ç›‘å¬ã€‚ä¸‹é¢é€šè¿‡ä¸¤ä¸ªç®€å•çš„ä¾‹å­æ¥å±•ç¤ºè¿™ä¸¤ç§åšæ³•çš„åŒºåˆ«ã€‚</p><p><strong>æ—§æ–¹å¼ï¼šä½¿ç”¨ <code>subscribe</code> å’Œ <code>unsubscribe</code></strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> channel</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received message: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¢é˜…æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ”¶åˆ°æ¶ˆæ¯ï¼Œè°ƒç”¨ onMessage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å–æ¶ˆè®¢é˜…æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unsubscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–°æ–¹å¼ï¼šä½¿ç”¨ <code>on</code> å’Œ <code>off</code></strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> EventEmitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> channel</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received message: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€æ¶ˆæ¯ï¼Œè§¦å‘ onMessage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœæ­¢ç›‘å¬æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>on</code> æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œç„¶åä½¿ç”¨ <code>emit</code> æ¥å‘å°„äº‹ä»¶ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦åˆ é™¤ä¸€ä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ <code>off</code> æ–¹æ³•ã€‚è¿™æ˜¯ç›®å‰æ¨èçš„æ–¹å¼ï¼Œå› ä¸ºå®ƒæ›´æ ‡å‡†åŒ–ï¼Œä¹Ÿæ›´ç¬¦åˆå¤§å¤šæ•°å¼€å‘è€…å¯¹äºäº‹ä»¶ç›‘å¬å’Œç§»é™¤çš„ç›´è§‚ç†è§£ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼ŒDEP0163 è¡¨æ˜ <code>subscribe</code> å’Œ <code>unsubscribe</code> æ–¹æ³•å·²ç»ä¸å†æ¨èä½¿ç”¨ï¼Œè€Œä½ åº”è¯¥ä½¿ç”¨ <code>on</code> å’Œ <code>off</code> æ–¹æ³•æ¥å¤„ç† Node.js ä¸­çš„äº‹ä»¶ç›‘å¬å’Œç§»é™¤ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„ä»£ç æ›´åŠ æ¸…æ™°ã€å¯ç»´æŠ¤ï¼Œå¹¶ä¸”ä¸æœªæ¥çš„ Node.js ç‰ˆæœ¬å…¼å®¹ã€‚</p><h3 id="dep0164-process-exit-code-process-exitcode-coercion-to-integer" tabindex="-1"><a class="header-anchor" href="#dep0164-process-exit-code-process-exitcode-coercion-to-integer"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0164" target="_blank" rel="noopener noreferrer">DEP0164: process.exit(code), process.exitCode coercion to integer</a></span></a></h3><p>Node.js ä¸­çš„<code>process.exit(code)</code>æ–¹æ³•é€šå¸¸ç”¨äºç«‹å³ç»“æŸ Node.js ç¨‹åºè¿è¡Œï¼Œå¹¶å°†é€€å‡ºç <code>code</code>è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚è¿™ä¸ªé€€å‡ºç å¯ä»¥ç”±å…¶ä»–ç¨‹åºç”¨æ¥äº†è§£ä½ çš„ Node.js ç¨‹åºæ˜¯å¦æˆåŠŸæ‰§è¡Œæˆ–è€…é‡åˆ°äº†é”™è¯¯ã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ ä¼ é€’ç»™<code>process.exit()</code>ä¸€ä¸ªéæ•´æ•°å€¼ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å¯¹è±¡ï¼ŒNode.js ä¼šå°è¯•å°†å…¶è½¬æ¢ï¼ˆcoerceï¼‰æˆä¸€ä¸ªæ•´æ•°ã€‚è¿™ç§è¡Œä¸ºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œå› ä¸ºéæ•´æ•°å€¼è½¬æ¢ä¸ºæ•´æ•°çš„è¿‡ç¨‹å¹¶ä¸æ€»æ˜¯æ¸…æ™°æ˜ç¡®çš„ã€‚</p><p>è‡ª Node.js v21.7.1 èµ·ï¼Œè¿™ç§éšå¼çš„ç±»å‹è½¬æ¢å°±è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ã€‚å®˜æ–¹æ–‡æ¡£ä¸­çš„ DEP0164 æŒ‡çš„æ˜¯è¿™ä¸ªå˜åŒ–ã€‚ç®€å•åœ°è¯´ï¼ŒNode.js å›¢é˜Ÿé¼“åŠ±å¼€å‘äººå‘˜æ˜¾å¼åœ°åªä½¿ç”¨æ•´æ•°ä½œä¸ºé€€å‡ºç ï¼Œè€Œä¸æ˜¯ä¾èµ– Node.js æ¥åšè¿™ç§ç±»å‹è½¬æ¢ã€‚</p><p><strong>å®é™…ä¾‹å­ï¼š</strong></p><p>æ—§ç‰ˆæœ¬çš„ Node.js è¡Œä¸ºç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æœ‰ä¸€ä¸ªNode.jsç¨‹åºï¼Œæˆ‘ä»¬è¦é€€å‡ºå¹¶è¿”å›ä¸€ä¸ªçŠ¶æ€ç </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è€Œéæ•´æ•°ä½œä¸ºé€€å‡ºç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Node.jsä¼šå°†å­—ç¬¦ä¸²&#39;æˆåŠŸ&#39;éšå¼è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¯èƒ½ä¼šè½¬æ¢ä¸º0æˆ–è€…NaNï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å–å†³äºNode.jsçš„å†…éƒ¨è½¬æ¢é€»è¾‘ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ··æ·†ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨å·²ç»æ˜¯ä¸æ¨èçš„è¡Œä¸ºï¼Œå› ä¸º<code>&#39;æˆåŠŸ&#39;</code>ä¸æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æœä½ æŠŠå®ƒä¼ é€’ç»™<code>process.exit</code>ï¼Œé‚£ä¹ˆ Node.js ä¸ä¼šå†è¯•å›¾å°†å…¶è½¬ä¸ºæ•´æ•°ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºé”™è¯¯æˆ–è­¦å‘Šè¡¨ç¤ºä½ åº”è¯¥åªä½¿ç”¨æ•´æ•°ä½œä¸ºé€€å‡ºç ã€‚</p><p>æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åº”å½“ä½¿ç”¨æ•´æ•°ä½œä¸ºé€€å‡ºç </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 0 é€šå¸¸è¡¨ç¤ºæˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ–è€…ï¼Œå¦‚æœç¨‹åºé‡åˆ°é”™è¯¯ï¼Œå¯ä»¥ç”¨é0çš„æ•´æ•°è¡¨ç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ–°ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œæ¨èçš„åšæ³•æ˜¯å§‹ç»ˆç¡®ä¿é€€å‡ºç æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœä½ éœ€è¦é€€å‡ºç¨‹åºå¹¶è¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼Œè¯·ç¡®ä¿ä½ ä¼ é€’çš„æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä»¥é¿å…ä»»ä½•æ½œåœ¨çš„é—®é¢˜æˆ–è€…æ··æ·†ã€‚</p><h3 id="dep0165-trace-atomics-wait" tabindex="-1"><a class="header-anchor" href="#dep0165-trace-atomics-wait"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0165" target="_blank" rel="noopener noreferrer">DEP0165: --trace-atomics-wait</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œä»è€Œæ„å»ºå¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚åœ¨ Node.js çš„ä¸åŒç‰ˆæœ¬ä¸­ï¼Œæœ‰æ—¶æŸäº›åŠŸèƒ½ä¼šè¢«æ ‡è®°ä¸ºè¿‡æ—¶ï¼ˆDeprecatedï¼‰ï¼Œè¿™æ„å‘³ç€è¿™äº›åŠŸèƒ½å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–æ”¹å˜ï¼Œå› æ­¤é¼“åŠ±å¼€å‘è€…ä¸è¦å†ä½¿ç”¨å®ƒä»¬ã€‚</p><p>å…³äºä½ æåˆ°çš„ <code>DEP0165: --trace-atomics-wait</code>ï¼Œè¿™æ˜¯ Node.js ä¸­ä¸€ä¸ªç‰¹å®šçš„åºŸå¼ƒè­¦å‘Šã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><p><strong>Atomics</strong>: è¿™æ˜¯ä¸€ç»„æä¾›åŸå­æ“ä½œçš„ JavaScript çš„å†…å»ºæ–¹æ³•ï¼Œå®ƒä»¬ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¯ä»¥å®‰å…¨åœ°è¯»å†™å…±äº«çš„å†…å­˜æ•°æ®ã€‚è¿™äº›æ“ä½œå¯ä»¥ä¿è¯å³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªæ“ä½œéƒ½æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä»è€Œé˜²æ­¢æ•°æ®ç«æ€æ¡ä»¶ã€‚</p></li><li><p><strong>trace</strong>: åœ¨ Node.js ä¸­ï¼Œ<code>--trace-atomics-wait</code> æ˜¯ä¸€ä¸ªå¯åŠ¨å‚æ•°ï¼Œç”¨äºè¿½è¸ªå’Œè®°å½•å½“çº¿ç¨‹ç”±äº Atomics æ“ä½œè€Œç­‰å¾…æ—¶çš„ä¿¡æ¯ã€‚è¿™å¯¹äºè°ƒè¯•å’Œåˆ†æå¹¶å‘ä»£ç å¾ˆæœ‰å¸®åŠ©ã€‚</p></li><li><p><strong>DEP0165</strong>: è¿™æ˜¯ä¸€ä¸ªç‰¹å®šçš„åºŸå¼ƒä»£ç ã€‚æ¯å½“ Node.js æ ¸å¿ƒå›¢é˜Ÿå†³å®šæŸä¸ªåŠŸèƒ½ä¸å†æ¨èä½¿ç”¨æ—¶ï¼Œä»–ä»¬ä¼šç»™è¿™ä¸ªåŠŸèƒ½ä¸€ä¸ªå”¯ä¸€çš„åºŸå¼ƒä»£ç ï¼Œå¹¶æä¾›ç›¸å…³ä¿¡æ¯ã€‚</p></li></ol><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>--trace-atomics-wait</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œè¿™æ„å‘³ç€ä½ ä¸åº”è¯¥å†ä¾èµ–è¿™ä¸ªå¯åŠ¨é€‰é¡¹æ¥è¿›è¡Œä½ çš„ Atomics ç›¸å…³ä»£ç çš„æ€§èƒ½è¿½è¸ªå’Œè°ƒè¯•ã€‚æœªæ¥çš„ Node.js ç‰ˆæœ¬å¯èƒ½ä¼šåˆ é™¤è¿™ä¸ªé€‰é¡¹ã€‚</p><p>å®é™…ä½¿ç”¨ä¸­ï¼Œå¦‚æœä½ æ­£åœ¨ç¼–å†™æ¶‰åŠ <code>SharedArrayBuffer</code> å’Œ <code>Atomics</code> çš„å¹¶å‘ä»£ç ï¼Œå¹¶å¸Œæœ›è¿½è¸ªçº¿ç¨‹ç­‰å¾…çš„æƒ…å†µï¼Œä½ å¯èƒ½æ›¾ä½¿ç”¨è¿‡å¦‚ä¸‹å‘½ä»¤æ¥å¯åŠ¨ä½ çš„ Node.js ç¨‹åºï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-atomics-wait</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæ—¢ç„¶ <code>--trace-atomics-wait</code> è¢«åºŸå¼ƒäº†ï¼Œä½ å°±éœ€è¦æ‰¾å…¶ä»–æ–¹å¼æ¥è°ƒè¯•ä½ çš„å¹¶å‘é—®é¢˜ï¼Œæ¯”å¦‚ä½¿ç”¨æ›´é«˜çº§çš„è°ƒè¯•å·¥å…·ã€æ—¥å¿—è¾“å‡ºæˆ–æ˜¯ Node.js æä¾›çš„å…¶ä»–æ€§èƒ½è¿½è¸ªå·¥å…·ã€‚</p><p>ç»“è®ºï¼šå¦‚æœä½ åœ¨ Node.js v21.7.1 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­çœ‹åˆ° <code>DEP0165</code> è­¦å‘Šï¼Œæ„å‘³ç€ä½ åº”è¯¥é¿å…ä½¿ç”¨ <code>--trace-atomics-wait</code> å¯åŠ¨å‚æ•°ï¼Œå¹¶å¯»æ‰¾å…¶ä»–æ–¹æ³•æ¥è¿›è¡Œä½ çš„æ€§èƒ½è¿½è¸ªå’Œè°ƒè¯•å·¥ä½œã€‚</p><h3 id="dep0166-double-slashes-in-imports-and-exports-targets" tabindex="-1"><a class="header-anchor" href="#dep0166-double-slashes-in-imports-and-exports-targets"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0166" target="_blank" rel="noopener noreferrer">DEP0166: Double slashes in imports and exports targets</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>DEP0166</code> æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šä»£ç ï¼Œå®ƒè¡¨ç¤ºåœ¨å¯¼å…¥ï¼ˆimportï¼‰å’Œå¯¼å‡ºï¼ˆexportï¼‰è¯­å¥çš„ç›®æ ‡è·¯å¾„ä¸­ä½¿ç”¨åŒæ–œæ ï¼ˆdouble slashesï¼‰è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸æ¨èä½¿ç”¨çš„åšæ³•ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚</p><p>è®©æˆ‘å…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯â€œå¯¼å…¥â€å’Œâ€œå¯¼å‡ºâ€ï¼š</p><ul><li><strong>å¯¼å…¥ (import)</strong>ï¼šè¿™æ˜¯å½“ä½ åœ¨ JavaScript æ–‡ä»¶ä¸­æƒ³è¦ä½¿ç”¨å…¶ä»–æ–‡ä»¶æä¾›çš„åŠŸèƒ½æˆ–æ•°æ®æ—¶æ‰€åšçš„æ“ä½œã€‚é€šè¿‡å¯¼å…¥ï¼Œä½ å¯ä»¥å°†å¤–éƒ¨æ¨¡å—ï¼ˆå¦ä¸€ä¸ªæ–‡ä»¶æˆ–åŒ…ï¼‰ä¸­çš„å‡½æ•°ã€å¯¹è±¡æˆ–åŸå§‹æ•°æ®ç±»å‹å¼•å…¥åˆ°å½“å‰æ–‡ä»¶ä¸­ã€‚</li><li><strong>å¯¼å‡º (export)</strong>ï¼šç›¸å¯¹åœ°ï¼Œå½“ä½ åˆ›é€ äº†ä¸€äº›æœ‰ç”¨çš„ä»£ç ï¼Œæ¯”å¦‚å‡½æ•°æˆ–å¯¹è±¡ï¼Œå¹¶ä¸”ä½ æƒ³è¦åˆ†äº«ç»™å…¶ä»–æ–‡ä»¶ä½¿ç”¨æ—¶ï¼Œä½ ä¼šä½¿ç”¨å¯¼å‡ºã€‚è¿™æ ·ï¼Œå…¶ä»–æ–‡ä»¶å°±å¯ä»¥å¯¼å…¥ä½ æ‰€å¯¼å‡ºçš„å†…å®¹ã€‚</li></ul><p>åœ¨ Node.js ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ <code>require</code> è¯­å¥æ¥å¯¼å…¥ CommonJS æ¨¡å—ï¼Œæˆ–è€…ä½¿ç”¨ ES6 æ¨¡å—è¯­æ³• <code>import/export</code>ã€‚</p><p>ç°åœ¨ï¼Œå…³äº DEP0166 å¼ƒç”¨è­¦å‘Šï¼Œè¿™æ˜¯ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥è¯´æ˜é—®é¢˜ï¼š</p><p>é”™è¯¯çš„åšæ³•ç¤ºä¾‹ï¼ˆåŒ…å«åŒæ–œæ ï¼‰:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º &#39;math.js&#39; çš„æ–‡ä»¶ï¼Œå®ƒå¯¼å‡ºäº†ä¸€äº›æ•°å­¦è¿ç®—åŠŸèƒ½</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¦‚æœä½ å°è¯•ç”¨é”™è¯¯çš„æ–¹å¼å¯¼å…¥ &#39;math.js&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;./module//math.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„è¿™é‡Œçš„ &#39;//&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ–è€…åœ¨ &#39;package.json&#39; ä¸­å®šä¹‰ä¸€ä¸ªæ˜ å°„ï¼Œä¹Ÿä½¿ç”¨äº†ä¸æ­£ç¡®çš„åŒæ–œæ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;imports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;#math&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./module//math.js&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ³¨æ„è¿™é‡Œçš„ &#39;//&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¯¼å…¥è·¯å¾„ <code>&#39;./module//math.js&#39;</code> åŒ…å«äº†ä¸å¿…è¦çš„åŒæ–œæ ã€‚è¿™å¯èƒ½ä¼šåœ¨æŸäº›ç³»ç»Ÿä¸Šå¯¼è‡´é—®é¢˜ï¼Œå¹¶ä¸”æ˜¯ä¸è§„èŒƒçš„è·¯å¾„å†™æ³•ã€‚Node.js é€šè¿‡å‘å‡º DEP0166 è­¦å‘Šï¼Œé¼“åŠ±å¼€å‘è€…é¿å…è¿™ç§åšæ³•ã€‚</p><p>æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ç§»é™¤å¤šä½™çš„æ–œæ ï¼Œåªä½¿ç”¨å•ä¸ªæ–œæ æ¥åˆ†éš”æ–‡ä»¶è·¯å¾„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£ç¡®çš„å¯¼å…¥æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;./module/math.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ ·ï¼Œåœ¨ <code>package.json</code> ä¸­å®šä¹‰æ˜ å°„æ—¶ï¼Œä¹Ÿåº”ç¡®ä¿è·¯å¾„æ ¼å¼æ­£ç¡®ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;imports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;#math&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./module/math.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ ç»§ç»­ä½¿ç”¨å¸¦æœ‰åŒæ–œæ çš„è·¯å¾„ï¼Œé‚£ä¹ˆåœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œä½ çš„ä»£ç å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸º Node.js å¯èƒ½ä¼šå®Œå…¨ä¸æ”¯æŒè¿™ç§æ ¼å¼çš„è·¯å¾„ã€‚å› æ­¤ï¼Œæœ€å¥½ç°åœ¨å°±çº æ­£è¿™ä¸ªé—®é¢˜ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç çš„å¯æŒç»­æ€§ã€‚</p><h3 id="dep0167-weak-diffiehellmangroup-instances-modp1-modp2-modp5" tabindex="-1"><a class="header-anchor" href="#dep0167-weak-diffiehellmangroup-instances-modp1-modp2-modp5"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0167" target="_blank" rel="noopener noreferrer">DEP0167: Weak DiffieHellmanGroup instances (modp1, modp2, modp5)</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šç›´æ¥è·³åˆ°ä½ æƒ³äº†è§£çš„å†…å®¹ã€‚åœ¨è§£é‡Š Node.js v21.7.1 ä¸­çš„ DEP0167 ä¹‹å‰ï¼Œæˆ‘éœ€è¦å…ˆç»™ä½ ä»‹ç»ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚</p><h3 id="èƒŒæ™¯-diffie-hellman-å¯†é’¥äº¤æ¢" tabindex="-1"><a class="header-anchor" href="#èƒŒæ™¯-diffie-hellman-å¯†é’¥äº¤æ¢"><span>èƒŒæ™¯ï¼šDiffie-Hellman å¯†é’¥äº¤æ¢</span></a></h3><p>Diffie-Hellmanï¼ˆDHï¼‰æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå…è®¸ä¸¤ä¸ªé€šä¿¡æ–¹åœ¨ä¸€ä¸ªä¸å®‰å…¨çš„é€šé“ä¸Šåˆ›å»ºä¸€ä¸ªå…±äº«çš„ç§˜å¯†å¯†é’¥ã€‚è¿™ä¸ªå…±äº«çš„å¯†é’¥å¯ä»¥ç”¨äºåŠ å¯†åç»­çš„é€šä¿¡ã€‚Diffie-Hellman ç®—æ³•çš„ä¸€ä¸ªå…³é”®ç‰¹ç‚¹æ˜¯ï¼Œå³ä½¿æ”»å‡»è€…èƒ½å¤Ÿç›‘å¬äº¤æ¢è¿‡ç¨‹ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œä»–ä»¬ä¹Ÿæ— æ³•æ¨å¯¼å‡ºåŒæ–¹åå•†çš„ç§å¯†å¯†é’¥ã€‚</p><h3 id="weak-diffiehellmangroup-instances" tabindex="-1"><a class="header-anchor" href="#weak-diffiehellmangroup-instances"><span>Weak DiffieHellmanGroup instances</span></a></h3><p>åœ¨å®ç° DH å¯†é’¥äº¤æ¢æ—¶ï¼Œä¼šä½¿ç”¨ä¸€ä¸ªç§°ä¸ºâ€œDiffie-Hellman ç¾¤ç»„â€çš„æ•°å­¦ç»“æ„ã€‚æœ‰ä¸€äº›ç‰¹å®šçš„ç¾¤ç»„å‚æ•°æ˜¯é¢„å…ˆå®šä¹‰çš„ï¼Œå®ƒä»¬è¢«ç§°ä¸ºâ€œæ¨¡æ•°ç¾¤â€æˆ–â€œmodp ç¾¤â€ã€‚å…¶ä¸­ï¼Œmodp1ã€modp2 å’Œ modp5 æ˜¯è€æ—§çš„ç¾¤ç»„ï¼Œä»¥è¾ƒå°çš„ç´ æ•°ä½œä¸ºæ¨¡æ•°ï¼Œå› æ­¤ï¼Œå®ƒä»¬æ¯”æ›´å¤§çš„ç¾¤ç»„æä¾›è¾ƒä½çš„å®‰å…¨æ€§ã€‚</p><p>éšç€è®¡ç®—æœºå¤„ç†èƒ½åŠ›çš„æé«˜å’Œå¯†ç å­¦åˆ†ææ–¹æ³•çš„è¿›æ­¥ï¼Œè¿™äº›è¾ƒå¼±çš„ç¾¤ç»„å˜å¾—å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œä¾‹å¦‚é€šè¿‡â€œLogjamâ€æ”»å‡»ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿç ´è§£è¿™äº›ç¾¤ç»„çš„å¯†é’¥äº¤æ¢è¿‡ç¨‹ã€‚</p><h3 id="node-js-ä¸­çš„-dep0167" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-dep0167"><span>Node.js ä¸­çš„ DEP0167</span></a></h3><p>åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>crypto</code>æ¨¡å—æ¥æ‰§è¡ŒåŸºäº Diffie-Hellman ç®—æ³•çš„æ“ä½œã€‚Node.js çš„<code>crypto</code>æ¨¡å—å…è®¸å¼€å‘è€…æŒ‡å®šæ‰€ä½¿ç”¨çš„ Diffie-Hellman ç¾¤ç»„ã€‚é‰´äº modp1ã€modp2 å’Œ modp5 ç¾¤ç»„å·²ç»ä¸å†å®‰å…¨ï¼ŒNode.js å›¢é˜Ÿå†³å®šå°†è¿™äº›ç¾¤ç»„æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€ã€‚</p><p>DEP0167 å°±æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œæ„æ€æ˜¯åœ¨ Node.js ä¸­åˆ›å»º DH å®ä¾‹æ—¶ä½¿ç”¨ modp1ã€modp2 å’Œ modp5 ç¾¤ç»„å·²ç»ä¸è¢«æ¨èï¼Œè€Œä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå®Œå…¨åˆ é™¤å¯¹å®ƒä»¬çš„æ”¯æŒã€‚å¦‚æœä½ åœ¨ä»£ç ä¸­è¿˜åœ¨ä½¿ç”¨è¿™äº›ç¾¤ç»„ï¼Œä½ åº”è¯¥æ›´æ–°ä½ çš„ä»£ç ï¼Œæ”¹ç”¨æ›´å®‰å…¨çš„ç¾¤ç»„ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªè¦æ±‚ä½¿ç”¨ Diffie-Hellman å¯†é’¥äº¤æ¢çš„åº”ç”¨ç¨‹åºï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Node.js ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨<code>crypto</code>æ¨¡å—åˆ›å»º DH å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªDiffie-Hellmanå®ä¾‹ï¼Œä½¿ç”¨ä¸€ä¸ªä¸å®‰å…¨çš„ç¾¤ç»„modp1ï¼ˆè¿™æ˜¯ä¸æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dh</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createDiffieHellman</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;modp1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”Ÿæˆç§˜å¯†å¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dh</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è·å–å…¬é’¥ï¼Œå¯ä»¥å®‰å…¨åœ°å‘é€åˆ°å¦ä¸€æ–¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> publicKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> dh</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getPublicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>&#39;modp1&#39;</code>å°±æ˜¯ä¸€ä¸ªå¼±çš„ç¾¤ç»„å®ä¾‹ï¼Œç°åœ¨åº”è¯¥é¿å…ä½¿ç”¨ã€‚æ›´æ–°ä½ çš„ä»£ç ï¼Œé€‰æ‹©ä¸€ä¸ªæ›´å¼ºçš„ç¾¤ç»„ï¼Œåƒæ˜¯ 2048 ä½çš„<code>&#39;modp14&#39;</code>ï¼Œå¯ä»¥åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªDiffie-Hellmanå®ä¾‹ï¼Œä½¿ç”¨ä¸€ä¸ªå®‰å…¨çš„ç¾¤ç»„modp14</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dh</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createDiffieHellman</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2048</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;modp14&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨èä½¿ç”¨æ›´å®‰å…¨çš„é€‰é¡¹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…¶ä½™ä»£ç å’Œç”Ÿæˆå¯†é’¥çš„æ­¥éª¤ç›¸åŒ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®é™…éƒ¨ç½²æ—¶ï¼Œä½ åº”è¯¥æ€»æ˜¯é€‰æ‹©å½“å‰è®¤ä¸ºå®‰å…¨çš„ç¾¤ç»„ï¼Œå¹¶ä¸”éšç€æ—¶é—´æ¨ç§»ä¿æŒå…³æ³¨æœ€æ–°çš„å¯†ç å­¦å»ºè®®ï¼Œç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºä¿æŒå®‰å…¨ã€‚</p><h3 id="dep0168-unhandled-exception-in-node-api-callbacks" tabindex="-1"><a class="header-anchor" href="#dep0168-unhandled-exception-in-node-api-callbacks"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0168" target="_blank" rel="noopener noreferrer">DEP0168: Unhandled exception in Node-API callbacks</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šå°½é‡ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€æ¥è§£é‡Šè¿™ä¸ª Node.js ä¸­çš„æ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªå«åš Node-APIï¼ˆä»¥å‰ç§°ä¸º N-APIï¼‰çš„åŠŸèƒ½ã€‚Node-API æ˜¯ä¸€ç»„ C è¯­è¨€å‡½æ•°ï¼Œè®©ä½ å¯ä»¥ç¼–å†™ä¸€äº›æ‰©å±•ï¼Œä½¿å¾— Node.js å¯ä»¥è°ƒç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„ä»£ç ï¼Œæ¯”å¦‚ C/C++ã€‚è¿™å¯¹äºæ€§èƒ½è¦æ±‚é«˜çš„æ“ä½œéå¸¸æœ‰ç”¨ï¼Œå› ä¸º C/C++é€šå¸¸è¿è¡Œå¾—æ›´å¿«ã€‚</p><p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œå½“ä½ åœ¨ä½¿ç”¨ Node-API æ¥ç¼–å†™æ‰©å±•çš„æ—¶å€™ï¼Œå¦‚æœæœ‰é”™è¯¯å‘ç”Ÿï¼Œä½ éœ€è¦æ­£ç¡®åœ°å¤„ç†å®ƒä»¬ã€‚åœ¨ Node-API ä¸­ï¼Œä½ çš„ C/C++ä»£ç ä¼šè¢«åŒ…è£…æˆå›è°ƒå‡½æ•°ï¼Œç„¶åè¢« Node.js è°ƒç”¨ã€‚å¦‚æœåœ¨è¿™äº›å›è°ƒå‡½æ•°ä¸­å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œè€Œä½ æ²¡æœ‰åœ¨ JavaScript ä¸­æ•è·å¹¶å¤„ç†è¿™ä¸ªé”™è¯¯ï¼Œå°±ä¼šæœ‰é—®é¢˜ã€‚è¿™ç§æƒ…å†µç§°ä¸º&quot;æœªå¤„ç†çš„å¼‚å¸¸&quot;ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœä½ æ²¡æœ‰å¤„ç†è¿™äº›é”™è¯¯ï¼ŒNode.js å¯èƒ½ä¸ä¼šæé†’ä½ ï¼Œç¨‹åºå¯èƒ½ä¼šå¥‡æ€ªåœ°å¤±è´¥æˆ–è€…å´©æºƒã€‚ä¸ºäº†æ”¹è¿›è¿™ä¸ªé—®é¢˜ï¼ŒNode.js å¼•å…¥äº† DEP0168 è­¦å‘Šï¼Œä¹Ÿå°±æ˜¯ç°åœ¨æˆ‘ä»¬è®¨è®ºçš„è¿™ä¸ªç‰¹æ€§ã€‚ä» v21.7.1 ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœä½ çš„ Node-API å›è°ƒå‡½æ•°ä¸­å‡ºç°äº†æœªå¤„ç†çš„å¼‚å¸¸ï¼ŒNode.js ä¼šç»™ä½ ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼ˆdeprecation warningï¼‰ã€‚è¿™æ„å‘³ç€åœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œè¿™ç§æœªå¤„ç†çš„å¼‚å¸¸å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºç›´æ¥å´©æºƒã€‚</p><p>ä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾ä½ ä½¿ç”¨ C++ç¼–å†™äº†ä¸€ä¸ª Node-API æ‰©å±•ï¼Œè¿™ä¸ªæ‰©å±•çš„ä½œç”¨æ˜¯è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œã€‚ä½†åœ¨ä½ çš„ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¼ å…¥çš„ä¸æ˜¯æ•°å­—ï¼Œç¨‹åºå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" data-title="cpp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>// å‡è®¾è¿™æ˜¯ä¸€æ®µC++çš„Node-APIæ‰©å±•ä»£ç </span></span>
<span class="line"><span>napi_value Add(napi_env env, napi_callback_info info) {</span></span>
<span class="line"><span>  // ... å…¶ä»–ä»£ç  ...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // å¦‚æœè¿™é‡Œå‡ºç°é”™è¯¯ï¼ˆä¾‹å¦‚ä¼ å…¥çš„ä¸æ˜¯æ•°å­—ï¼‰ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span>  if (å‘ç”Ÿé”™è¯¯) {</span></span>
<span class="line"><span>    napi_throw_error(env, nullptr, &quot;è¾“å…¥çš„ä¸æ˜¯æ•°å­—ï¼&quot;);</span></span>
<span class="line"><span>    return nullptr;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // ... è®¡ç®—å’Œçš„é€»è¾‘ ...</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœ JavaScript è°ƒç”¨è¿™ä¸ª<code>Add</code>å‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥äº†éæ•°å­—ç±»å‹çš„å‚æ•°ï¼Œé‚£ä¹ˆå¯èƒ½æ²¡æœ‰ä»»ä½•æç¤ºå‘Šè¯‰ä½ å‡ºé”™äº†ã€‚ä½†æ˜¯åœ¨ v21.7.1 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ åœ¨ JavaScript ä¸­æ²¡æœ‰æ•è·å¹¶å¤„ç†è¿™ä¸ªé”™è¯¯ï¼ŒNode.js ä¼šè¾“å‡ºä¸€ä¸ª DEP0168 çš„å¼ƒç”¨è­¦å‘Šã€‚</p><p>JavaScript ç«¯çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myAddon</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./build/Release/addon&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ è½½æˆ‘ä»¬çš„C++æ‰©å±•</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> myAddon</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™ä¸æ˜¯æ•°å­—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™ä¹Ÿä¸æ˜¯æ•°å­—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•…æ„ä¼ å…¥é”™è¯¯ç±»å‹çš„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‡ºç°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨è¿™é‡Œæ•è·å¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®å¤æ–¹æ³•å¾ˆç®€å•ï¼šåªéœ€è¦ç¡®ä¿ä½ åœ¨ JavaScript ä»£ç ä¸­æ€»æ˜¯ä½¿ç”¨ try-catch æ¥æ•è·å¯èƒ½çš„é”™è¯¯ï¼Œæˆ–è€…é€šè¿‡ Promise çš„<code>.catch()</code>æ–¹æ³•å¤„ç†é”™è¯¯ã€‚è¿™æ ·ï¼Œæ— è®ºåœ¨å“ªä¸ªç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œåº”ç”¨ç¨‹åºéƒ½èƒ½æ­£å¸¸ã€ç¨³å®šåœ°è¿è¡Œã€‚</p><h3 id="dep0169-insecure-url-parse" tabindex="-1"><a class="header-anchor" href="#dep0169-insecure-url-parse"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0169" target="_blank" rel="noopener noreferrer">DEP0169: Insecure url.parse()</a></span></a></h3><p>DEP0169 æ˜¯ Node.js é¡¹ç›®ä¸­çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šç¼–å·ï¼Œè¡¨ç¤º<code>url.parse()</code>è¿™ä¸ªæ–¹æ³•åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å°†ä¸å†è¢«æ”¯æŒï¼Œå¹¶ä¸”å®ƒè¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ã€‚åœ¨ Node.js ä¸­ï¼Œå¼ƒç”¨ï¼ˆDeprecationï¼‰æ˜¯æŒ‡æŸä¸ªåŠŸèƒ½æˆ–è€… API å°†åœ¨æœªæ¥æŸä¸ªç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–æ›¿æ¢ï¼Œé€šå¸¸æ˜¯å› ä¸ºæœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆæˆ–è€…åŸæœ‰å®ç°å­˜åœ¨å®‰å…¨é—®é¢˜ã€‚</p><p><code>url.parse()</code>æ˜¯ç”¨äºè§£æ URL å­—ç¬¦ä¸²çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ª URL å­—ç¬¦ä¸²åˆ†è§£æˆå¤šä¸ªéƒ¨åˆ†ï¼ŒåŒ…æ‹¬åè®®ã€ä¸»æœºåã€ç«¯å£å·ã€è·¯å¾„ç­‰ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;http://www.example.com:8080/path?query=123#hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> parsedUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">parsedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºå¤§æ¦‚ä¼šæ˜¯è¿™æ ·çš„ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;protocol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;slashes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;host&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;www.example.com:8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;port&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;hostname&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;www.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;#hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;search&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;?query=123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;query&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;query=123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;pathname&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path?query=123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;href&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://www.example.com:8080/path?query=123#hash&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶è€Œï¼Œéšç€ç½‘é¡µå’Œç½‘ç»œæœåŠ¡å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¯¹ URL è§£æçš„è¦æ±‚ä¹Ÿå˜å¾—æ›´é«˜ï¼Œæ—§çš„<code>url.parse()</code>æ–¹æ³•å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†æŸäº›æƒ…å†µï¼Œæˆ–è€…åœ¨ç‰¹å®šæƒ…å¢ƒä¸‹å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ï¼Œæ¯”å¦‚å½“è§£æç‰¹åˆ¶çš„æ¶æ„ URL æ—¶å¯èƒ½ä¼šå‡ºç°ä¸å¯é¢„æ–™çš„è¡Œä¸ºã€‚</p><p>å› æ­¤ï¼Œåœ¨ Node.js çš„è¾ƒæ–°ç‰ˆæœ¬ä¸­ï¼Œæ¨èä½¿ç”¨æ›´å®‰å…¨å’Œç°ä»£çš„<code>new URL()</code>æ„é€ å‡½æ•°æ¥ä»£æ›¿<code>url.parse()</code>æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨<code>new URL()</code>æ„é€ å‡½æ•°çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://www.example.com:8080/path?query=123#hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨<code>new URL()</code>æ„é€ å‡½æ•°è§£æçš„è¾“å‡ºä¹Ÿä¼šåŒ…å« URL çš„ä¸åŒéƒ¨åˆ†ï¼Œä½†å®ƒéµå¾ª WHATWG URL æ ‡å‡†ï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿæ›´å¥½åœ°ä¸æµè§ˆå™¨ä¸­çš„ URL API ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”å¤„ç†å„ç§è¾¹ç¼˜æƒ…å†µå’Œå®‰å…¨é—®é¢˜ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼ŒDEP0169 è¡¨ç¤º<code>url.parse()</code>æ–¹æ³•å³å°†è¢«å¼ƒç”¨å¹¶ä¸”å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œæ–°çš„ä»£ç åº”è¯¥é¿å…ä½¿ç”¨<code>url.parse()</code>ï¼Œè½¬è€Œä½¿ç”¨<code>new URL()</code>æ„é€ å‡½æ•°ã€‚</p><h3 id="dep0170-invalid-port-when-using-url-parse" tabindex="-1"><a class="header-anchor" href="#dep0170-invalid-port-when-using-url-parse"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0170" target="_blank" rel="noopener noreferrer">DEP0170: Invalid port when using url.parse()</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šè¿™ä¸ª Node.js çš„åºŸå¼ƒè­¦å‘Š DEP0170ã€‚</p><p>é¦–å…ˆè¦ç†è§£åœ¨ Node.js ä¸­ï¼Œ<code>url.parse()</code> æ˜¯ä¸€ä¸ªç”¨äºè§£æ URL å­—ç¬¦ä¸²çš„å‡½æ•°ã€‚å®ƒå¯ä»¥å°†ä¸€ä¸ª URL å­—ç¬¦ä¸²åˆ†è§£ä¸ºå‡ ä¸ªç»„ä»¶ï¼Œæ¯”å¦‚åè®®ã€ä¸»æœºåã€ç«¯å£ã€è·¯å¾„ç­‰ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>url.parse()</code> æ¥è§£æä¸€ä¸ªåŒ…å«æ— æ•ˆç«¯å£çš„ URL æ—¶ï¼ˆä¾‹å¦‚ç«¯å£ä¸æ˜¯æ•°å­—æˆ–è€…èŒƒå›´ä¸æ­£ç¡®ï¼‰ï¼Œè¯¥å‡½æ•°ä¼šå°è¯•å»è§£æè¿™ä¸ªç«¯å£ï¼Œä½†å¯èƒ½ä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯è§£æå‡ºä¸æ­£ç¡®çš„ç»“æœã€‚</p><p>ç„¶è€Œï¼Œä» Node.js v21.7.1 å¼€å§‹ï¼Œå¦‚æœä½ å°è¯•ä½¿ç”¨ <code>url.parse()</code> è§£æä¸€ä¸ªåŒ…å«æ— æ•ˆç«¯å£çš„ URLï¼Œå°±ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯ï¼ˆDeprecationWarning: Invalid URL: Invalid port numberï¼‰ï¼Œå› ä¸º Node.js è®¤ä¸ºè¿™ç§è¡Œä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œéœ€è¦é¿å…ã€‚</p><p>ä¸‹é¢æˆ‘ç»™ä½ ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰éæ³•ç«¯å£å€¼çš„ URL å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> urlString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;http://example.com:abcd/path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨ url.parse() æ¥è§£æè¿™ä¸ª URL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> parsedUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">urlString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">parsedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœæœ‰é”™è¯¯å‘ç”Ÿï¼Œæ¯”å¦‚ç«¯å£å·æ— æ•ˆï¼Œå°±ä¼šæ•æ‰åˆ°è¿™é‡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error parsing URL:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Node.js v21.7.1 ä¹‹å‰ï¼Œå³ä½¿ç«¯å£ <code>&#39;abcd&#39;</code> ä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—ï¼Œä¸Šé¢çš„ä»£ç å¯èƒ½ä¹Ÿä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä½†æ˜¯è§£æå‡ºçš„ç«¯å£å­—æ®µå¯èƒ½æ˜¯ <code>null</code> æˆ–ä¸€äº›ä¸å‡†ç¡®çš„å€¼ã€‚</p><p>ä» v21.7.1 ç‰ˆæœ¬å¼€å§‹ï¼Œä¸Šè¿°ä»£ç å°†ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸º <code>&#39;abcd&#39;</code> ä¸æ˜¯æœ‰æ•ˆçš„ç«¯å£å·ã€‚è¿™æ—¶ä½ å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”æŒ‰ç…§é”™è¯¯ä¿¡æ¯æ¥å¤„ç†é—®é¢˜ã€‚</p><p>æ­£ç¡®çš„ç«¯å£å·åº”è¯¥æ˜¯ä¸€ä¸ªä»‹äº 0 åˆ° 65535 ä¹‹é—´çš„æ•´æ•°å€¼ã€‚å¦‚æœä½ æƒ³é¿å…è¿™ä¸ªé”™è¯¯ï¼Œä½ éœ€è¦ç¡®ä¿ä½ æä¾›ç»™ <code>url.parse()</code> çš„ URL å­—ç¬¦ä¸²ä¸­çš„ç«¯å£å·æ˜¯åˆæ³•çš„ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> urlString</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;http://example.com:8080/path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 8080 æ˜¯åˆæ³•çš„ç«¯å£å·</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šåœ¨æœåŠ¡å™¨é…ç½®ã€å¾®æœåŠ¡æ¶æ„ã€API è°ƒç”¨ç­‰åœºæ™¯ä¸­è§£æ URL å¹¶å·¥ä½œä¸ç«¯å£å·ã€‚è¿™æ—¶ï¼Œä½¿ç”¨æ­£ç¡®çš„ç«¯å£å·è‡³å…³é‡è¦ï¼Œä»¥ç¡®ä¿ç½‘ç»œé€šä¿¡èƒ½å¤Ÿæ­£å¸¸è¿›è¡Œã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p><h3 id="dep0171-setters-for-http-incomingmessage-headers-and-trailers" tabindex="-1"><a class="header-anchor" href="#dep0171-setters-for-http-incomingmessage-headers-and-trailers"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0171" target="_blank" rel="noopener noreferrer">DEP0171: Setters for http.IncomingMessage headers and trailers</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€ä¸‹ Node.js ä¸­å…³äº DEP0171 å¼ƒç”¨è­¦å‘Šçš„å†…å®¹ã€‚</p><p>é¦–å…ˆï¼Œ&quot;DEP0171&quot; æ˜¯ Node.js ä¸­ä¸€ä¸ªç‰¹å®šçš„å¼ƒç”¨è­¦å‘Šä»£ç ã€‚æ¯ä¸ªå¼ƒç”¨è­¦å‘Šéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ä»£ç ï¼Œè¿™æ ·å¼€å‘è€…å°±å¯ä»¥å¿«é€Ÿåœ°æŸ¥åˆ°å…³äºè¿™ä¸ªå¼ƒç”¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>http.IncomingMessage</code> çš„ settersï¼ˆä¹Ÿå°±æ˜¯è®¾ç½®å‡½æ•°ï¼‰å¯¹äº headers å’Œ trailers è¢«å¼ƒç”¨äº†ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http.IncomingMessage</code> å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå³å°†åˆ°æ¥çš„æ¶ˆæ¯ï¼Œé€šå¸¸æ˜¯å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„ Node.js é‡Œï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½®è¯·æ±‚å¤´éƒ¨çš„æŸä¸ªå­—æ®µï¼Œä¾‹å¦‚ `cookie`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cookie&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;name=value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å…¶ä»–ä¸šåŠ¡é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬å°è¯•é€šè¿‡ç›´æ¥èµ‹å€¼æ¥ä¿®æ”¹è¯·æ±‚å¯¹è±¡ (<code>req</code>) çš„ <code>headers</code> å±æ€§ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸€ç§ä¸å®‰å…¨ä¸”ä¸æ¨èçš„åšæ³•ï¼Œå› ä¸º <code>headers</code> åº”è¯¥è¢«è§†ä¸ºåªè¯»çš„ï¼Œå¹¶ä¸”åº”è¯¥å®Œå…¨ç”±å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯æ§åˆ¶ã€‚</p><p>åœ¨æ–°ç‰ˆæœ¬çš„ Node.js é‡Œï¼Œå°è¯•è¿™æ ·åšä¼šå¯¼è‡´ç¨‹åºæŠ›å‡ºå¼‚å¸¸ã€‚æ­£ç¡®çš„åšæ³•æ˜¯å¤„ç†è¿™äº› headersï¼Œè€Œä¸æ˜¯è¯•å›¾ç›´æ¥ä¿®æ”¹å®ƒä»¬ã€‚å¦‚æœä½ éœ€è¦åŸºäºè¯·æ±‚å¤´éƒ¨åšå‡ºæŸäº›å“åº”ï¼Œä½ åº”è¯¥åªæ˜¯è¯»å–å®ƒä»¬ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¯»å–è¯·æ±‚å¤´éƒ¨çš„ cookie å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> cookieHeader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cookie&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åŸºäº cookie åšä¸€äº›å·¥ä½œï¼Œæ¯”å¦‚éªŒè¯æˆ–è§£æ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cookieHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ...å¤„ç† cookie ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å…¶ä»–ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚è¿”å›å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¿®æ­£åçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸å†è¯•å›¾è®¾ç½® <code>req.headers</code> ä¸­çš„å€¼ï¼Œè€Œæ˜¯åªè¯»å–å¹¶ä½¿ç”¨è¿™äº›å€¼ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼šDEP0171 æ˜¯å…³äº <code>http.IncomingMessage</code> çš„ headers å’Œ trailers çš„ setter è¢«å¼ƒç”¨çš„è­¦å‘Šã€‚åœ¨ Node.js çš„æ–°ç‰ˆæœ¬ä¸­ï¼Œä½ ä¸åº”è¯¥å°è¯•ä¿®æ”¹è¿™äº›å±æ€§ï¼Œè€Œåº”è¯¥å°†å®ƒä»¬å½“ä½œåªè¯»ï¼Œå¹¶ä¸”æ ¹æ®è¿™äº›å±æ€§æ¥æ‰§è¡Œä½ çš„ä¸šåŠ¡é€»è¾‘ã€‚å¦‚æœä½ ä¹‹å‰çš„ä»£ç ä¸­æœ‰è¿™æ ·çš„æ“ä½œï¼Œè¯·ç¡®ä¿ç§»é™¤æˆ–æ›¿æ¢è¿™éƒ¨åˆ†ä»£ç ï¼Œä»¥å…åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­é‡åˆ°é—®é¢˜ã€‚</p><h3 id="dep0172-the-asyncresource-property-of-asyncresource-bound-functions" tabindex="-1"><a class="header-anchor" href="#dep0172-the-asyncresource-property-of-asyncresource-bound-functions"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0172" target="_blank" rel="noopener noreferrer">DEP0172: The asyncResource property of AsyncResource bound functions</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js v21.7.1 ä¸­å‡ºç°çš„ DEP0172 å¼ƒç”¨è­¦å‘Šï¼Œè¿™æ¶‰åŠåˆ° <code>AsyncResource</code> ç±»ä¸­ <code>asyncResource</code> å±æ€§çš„ä½¿ç”¨ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å‡ ä¸ªæ¦‚å¿µï¼šNode.js çš„å¼‚æ­¥ç¼–ç¨‹ã€å¼‚æ­¥é’©å­ï¼ˆasync_hooks æ¨¡å—ï¼‰ï¼Œä»¥åŠ <code>AsyncResource</code> è¿™ä¸ªç±»ã€‚</p><h3 id="å¼‚æ­¥ç¼–ç¨‹å’Œå¼‚æ­¥é’©å­" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç¼–ç¨‹å’Œå¼‚æ­¥é’©å­"><span>å¼‚æ­¥ç¼–ç¨‹å’Œå¼‚æ­¥é’©å­</span></a></h3><p>Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„éé˜»å¡ I/O æ¨¡å‹è®¾è®¡ï¼Œè¿™æ„å‘³ç€ Node.js é‡Œå¾ˆå¤šæ“ä½œéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚æ¯”å¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼Œè¿™äº›æ“ä½œä¼šåœ¨åå°å¤„ç†ï¼Œä¸ä¼šé˜»å¡ç¨‹åºçš„è¿è¡Œã€‚å½“è¿™äº›å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œä¼šè§¦å‘å›è°ƒå‡½æ•°æ¥ç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£å’Œè¿½è¸ªè¿™äº›å¼‚æ­¥æ“ä½œï¼ŒNode.js æä¾›äº†ä¸€ä¸ªæ¨¡å—å«åš <code>async_hooks</code>ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬ç›‘æ§å¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å®ƒä»¬çš„åˆ›å»ºã€é”€æ¯ç­‰ã€‚</p><h3 id="asyncresource-ç±»" tabindex="-1"><a class="header-anchor" href="#asyncresource-ç±»"><span>AsyncResource ç±»</span></a></h3><p><code>AsyncResource</code> æ˜¯ <code>async_hooks</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªä»£è¡¨å¼‚æ­¥æ“ä½œçš„èµ„æºï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªèµ„æºçš„ä¸Šä¸‹æ–‡ä¸­æ‰‹åŠ¨ç®¡ç†å›è°ƒå‡½æ•°çš„æ‰§è¡Œã€‚è¿™å¯¹äºåº“å’Œæ¡†æ¶çš„ä½œè€…ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½éœ€è¦ç¡®ä¿å›è°ƒå‡½æ•°æ­£ç¡®åœ°å…³è”åˆ°ç›¸åº”çš„å¼‚æ­¥èµ„æºä¸Šã€‚</p><h3 id="dep0172-è­¦å‘Š" tabindex="-1"><a class="header-anchor" href="#dep0172-è­¦å‘Š"><span>DEP0172 è­¦å‘Š</span></a></h3><p>DEP0172 è¿™ä¸ªè­¦å‘Šæ˜¯è¯´ï¼Œåœ¨ Node.js çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œ<code>AsyncResource</code> ç±»çš„å®ä¾‹ä¸Šæœ‰ä¸€ä¸ªå±æ€§å« <code>asyncResource</code>ï¼Œè¿™ä¸ªå±æ€§å·²è¢«å¼ƒç”¨ã€‚è¿™ä¸ªå±æ€§æœ¬è´¨ä¸Šæ˜¯æŒ‡å‘ <code>AsyncResource</code> å®ä¾‹è‡ªèº«çš„å¼•ç”¨ï¼Œç”±äºå­˜åœ¨æ··æ·†å’Œä¸å¿…è¦æ€§ï¼ŒNode.js å›¢é˜Ÿå†³å®šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤å®ƒã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>æƒ³è±¡æœ‰ä¸€ä¸ªæ—¥å¿—è®°å½•å™¨çš„åº“ï¼Œå®ƒéœ€è¦ä¿ç•™æ¯ä¸ªå¼‚æ­¥æ“ä½œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ—¥å¿—è®°å½•å™¨å¯ä»¥ä½¿ç”¨ <code>AsyncResource</code> æ¥ç¡®ä¿æ—¥å¿—æ¶ˆæ¯ä¸å…¶ç›¸åº”çš„å¼‚æ­¥æ“ä½œç›¸å…³è”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;async_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">AsyncResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Logger&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emitBefore</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å®é™…çš„æ—¥å¿—é€»è¾‘ï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸Šå¼‚æ­¥æ“ä½œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emitAfter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ Logger</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logger</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Logger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  logger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œåçš„æ—¥å¿—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>Logger</code> ç±»ï¼Œå®ƒç»§æ‰¿è‡ª <code>AsyncResource</code>ã€‚åˆ©ç”¨ <code>emitBefore()</code> å’Œ <code>emitAfter()</code> æ–¹æ³•ï¼Œ<code>log</code> å‡½æ•°è¢«æ”¾ç½®åœ¨æ­£ç¡®çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·å°±èƒ½ä¿æŒæ—¥å¿—ä¸å¼‚æ­¥æ“ä½œçš„å…³è”ã€‚</p><p>æ³¨æ„ï¼Œå®é™…ä¸Šåœ¨ Node.js v21.7.1 ä¸­ï¼Œä½ ä¸åº”è¯¥å†ä½¿ç”¨ <code>asyncResource.asyncResource</code> è¿™æ ·çš„ä»£ç ï¼Œå› ä¸ºè¿™å·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼ŒDEP0172 è­¦å‘Šæ˜¯å…³äº <code>AsyncResource</code> ç±»ä¸­ä¸å†å»ºè®®ä½¿ç”¨çš„ <code>asyncResource</code> è‡ªå¼•ç”¨å±æ€§çš„ã€‚å¼€å‘è€…åœ¨ç»´æŠ¤å¼‚æ­¥èµ„æºå’Œæ‰§è¡Œå›è°ƒæ—¶åº”è¯¥é¿å…ä¾èµ–è¿™ä¸ªå±æ€§ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ <code>AsyncResource</code> å®ä¾‹æœ¬èº«ã€‚</p><h3 id="dep0173-the-assert-calltracker-class" tabindex="-1"><a class="header-anchor" href="#dep0173-the-assert-calltracker-class"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0173" target="_blank" rel="noopener noreferrer">DEP0173: the assert.CallTracker class</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­å…³äº <code>assert.CallTracker</code> ç±»è¿™ä¸ªå¼ƒç”¨è­¦å‘Šï¼ˆDEP0173ï¼‰ã€‚</p><p>é¦–å…ˆï¼Œ<code>assert</code> æ˜¯ Node.js æ ‡å‡†åº“ä¸­ä¸€ä¸ªç”¨äºè¿›è¡Œæ–­è¨€æµ‹è¯•çš„æ¨¡å—ã€‚æ–­è¨€æµ‹è¯•æ˜¯ä¸€ç§æ£€æŸ¥ä»£ç æ˜¯å¦æŒ‰ç…§é¢„æœŸå·¥ä½œçš„æ–¹å¼ï¼Œåœ¨ç¼–å†™æµ‹è¯•æ—¶å¸¸å¸¸ä½¿ç”¨ã€‚</p><p>åœ¨ä¹‹å‰çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œ<code>assert</code> æ¨¡å—å¼•å…¥äº†ä¸€ä¸ªå«åš <code>CallTracker</code> çš„ç±»ï¼Œå®ƒç”¨äºè·Ÿè¸ªå‡½æ•°è°ƒç”¨çš„æ¬¡æ•°ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ <code>CallTracker</code> æ¥ç¡®ä¿æŸä¸ªå‡½æ•°åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­è¢«è°ƒç”¨äº†æ­£ç¡®çš„æ¬¡æ•°ã€‚å¦‚æœå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ä¸ç¬¦åˆé¢„æœŸï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><p>ç„¶è€Œï¼Œä» Node.js v21.7.1 å¼€å§‹ï¼Œ<code>CallTracker</code> è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ˆDEP0173ï¼‰ï¼Œè¿™æ„å‘³ç€åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ <code>CallTracker</code> å¯èƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚Node.js å›¢é˜Ÿå¯èƒ½è§‰å¾—å­˜åœ¨æ›´å¥½çš„åŠæ³•æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œæˆ–è€…ç»´æŠ¤è¿™ä¸ªç±»çš„æˆæœ¬æ¯”å®ƒçš„å¥½å¤„è¦å¤§ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>CallTracker</code> çš„ä¾‹å­ä»¥åŠç›¸åº”çš„æ›¿ä»£æ–¹æ¡ˆï¼š</p><h3 id="ä½¿ç”¨-calltracker-çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-calltracker-çš„ä¾‹å­"><span>ä½¿ç”¨ <code>CallTracker</code> çš„ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>printMessage</code> å‡½æ•°ï¼Œæˆ‘ä»¬æƒ³è¦è¿½è¸ªè¿™ä¸ªå‡½æ•°åœ¨æµ‹è¯•ä¸­è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸€ä¸ªç®€å•çš„æ‰“å°æ¶ˆæ¯å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> printMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º CallTracker å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> tracker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CallTracker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¦æ±‚ printMessage å‡½æ•°æ­£å¥½è¢«è°ƒç”¨ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> callsPrintMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> tracker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">calls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">printMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿è¡Œå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">callsPrintMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// éªŒè¯ printMessage æ˜¯å¦è¢«è°ƒç”¨äº†æ­£å¥½ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  tracker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">verify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœæ²¡æœ‰è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè¿™é‡Œä¼šæŠ›å‡ºé”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ›¿ä»£æ–¹æ¡ˆ-4" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£æ–¹æ¡ˆ-4"><span>æ›¿ä»£æ–¹æ¡ˆ</span></a></h3><p>ç”±äº <code>CallTracker</code> å·²ç»å¼ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–æµ‹è¯•æ¡†æ¶æä¾›çš„æ¨¡æ‹Ÿå’Œé—´è°åŠŸèƒ½æ¥è¿½è¸ªå‡½æ•°è°ƒç”¨ã€‚æ¯”å¦‚ä½¿ç”¨æµè¡Œçš„ <code>Jest</code> æµ‹è¯•æ¡†æ¶ï¼Œæˆ–è€…ä½¿ç”¨ <code>sinon</code> è¿™æ ·çš„åº“æ¥æ›¿ä»£ <code>CallTracker</code> çš„åŠŸèƒ½ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>sinon</code> åº“æ¥è¿½è¸ªå‡½æ•°è°ƒç”¨çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sinon</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sinon&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸€ä¸ªç®€å•çš„æ‰“å°æ¶ˆæ¯å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> printMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ sinon æ¥ç›‘è§† printMessage å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> spyPrintMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> sinon</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">spy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">printMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿è¡Œå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">spyPrintMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿›è¡Œæ–­è¨€ï¼šéªŒè¯å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">strictEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">spyPrintMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥æ£€æŸ¥è°ƒç”¨æ—¶çš„å‚æ•°ç­‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯å¯¹ <code>assert.CallTracker</code> ç±»å¼ƒç”¨è­¦å‘Šçš„è§£é‡Šï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å…¶ä»–å·¥å…·æ›¿ä»£å®ƒæ¥è¿½è¸ªå‡½æ•°è°ƒç”¨ã€‚å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œç†è§£æµ‹è¯•ä»£ç å’Œç¡®ä¿ä»£ç è´¨é‡æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä½ åœ¨å­¦ä¹ ä¸­é‡åˆ°ä»»ä½•æµ‹è¯•ç›¸å…³çš„é—®é¢˜ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢å…³äºæµ‹è¯•çš„å†…å®¹å’Œä¸åŒçš„æµ‹è¯•å·¥å…·ã€‚</p><h3 id="dep0174-calling-promisify-on-a-function-that-returns-a-promise" tabindex="-1"><a class="header-anchor" href="#dep0174-calling-promisify-on-a-function-that-returns-a-promise"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0174" target="_blank" rel="noopener noreferrer">DEP0174: calling promisify on a function that returns a Promise</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µã€‚Node.js ä¸­æœ‰ä¸€ä¸ªæ¨¡å—å«åš <code>util</code>ï¼Œå®ƒæä¾›äº†å¾ˆå¤šå®ç”¨å·¥å…·ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ä¸€ä¸ªåä¸º <code>promisify</code> çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥å°†éµå¾ª Node.js å›è°ƒé£æ ¼çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„é‚£ç§ï¼‰è½¬æ¢æˆè¿”å› Promise çš„å‡½æ•°ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»€ä¹ˆæ˜¯ Node.js å›è°ƒé£æ ¼çš„å‡½æ•°ã€‚é€šå¸¸ï¼Œåœ¨ Node.js ä¸­ï¼Œå¼‚æ­¥å‡½æ•°ä¼šæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œå½“å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°è¢«è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¼ ç»Ÿçš„å›è°ƒæ–¹å¼è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/my/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä½¿ç”¨æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼ŒPromise æä¾›äº†ä¸€ç§æ›´ä¼˜é›…çš„å¤„ç†å¼‚æ­¥æ“ä½œçš„æ–¹æ³•ã€‚é€šè¿‡å°†å¼‚æ­¥å‡½æ•°è½¬ä¸ºè¿”å› Promise å¯¹è±¡çš„å‡½æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>.then()</code> å’Œ <code>.catch()</code> æ–¹æ³•æ¥å¤„ç†æˆåŠŸçš„ç»“æœå’Œå¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚<code>util.promisify</code> æ­£æ˜¯ç”¨äºå®Œæˆè¿™ç§è½¬æ¢çš„å·¥å…·ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ å°è¯•å¯¹å·²ç»è¿”å› Promise çš„å‡½æ•°ä½¿ç”¨ <code>util.promisify</code>ï¼ŒNode.js v21.7.1 å°†ä¼šç»™å‡ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼ˆDEP0174ï¼‰ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºè¿”å› Promise çš„å‡½æ•°ï¼Œä¸éœ€è¦ä½¿ç”¨ <code>promisify</code>ï¼Œå®ƒä»¬å·²ç»å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>.then()</code> å’Œ <code>.catch()</code> äº†ã€‚ä¸¾ä¸ªé”™è¯¯ç¤ºèŒƒä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promises</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é”™è¯¯ï¼šè¿™é‡Œæ²¡æœ‰å¿…è¦ä½¿ç”¨ promisifyï¼Œå› ä¸º fs.readFile å·²ç»è¿”å›äº†ä¸€ä¸ª Promise</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readFilePromise</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">promisify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFilePromise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/my/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£ç¡®çš„æ–¹å¼ç›´æ¥ä½¿ç”¨ fs æ¨¡å—ä¸­çš„ promises APIï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promises</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›´æ¥ä½¿ç”¨è¿”å› Promise çš„ readFile å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/my/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€è€Œè¨€ä¹‹ï¼ŒDEP0174 è­¦å‘Šçš„æ„æ€æ˜¯ï¼Œå½“ä½ å°è¯•ä½¿ç”¨ <code>util.promisify</code> åœ¨ä¸€ä¸ªæœ¬èº«å°±è¿”å› Promise çš„å‡½æ•°ä¸Šæ—¶ï¼Œè¿™æ˜¯å¤šä½™çš„ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å¯èƒ½ä¸å†æ”¯æŒè¿™ç§ç”¨æ³•ã€‚è¿™ä¸ªè­¦å‘Šé¼“åŠ±å¼€å‘è€…æŒ‰ç…§æ­£ç¡®çš„æ–¹å¼ä½¿ç”¨ Promiseã€‚</p><h3 id="dep0175-util-tousvstring" tabindex="-1"><a class="header-anchor" href="#dep0175-util-tousvstring"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0175" target="_blank" rel="noopener noreferrer">DEP0175: util.toUSVString</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ&quot;DEP0175: util.toUSVString&quot;æ˜¯ä¸€ä¸ªåºŸå¼ƒè­¦å‘Šã€‚è¿™ä¸ªè­¦å‘Šæ„å‘³ç€<code>util.toUSVString</code>æ–¹æ³•å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™æ˜¯å› ä¸ºæœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆæˆ–è€…è¯¥åŠŸèƒ½ä¸å†ç¬¦åˆç°ä»£çš„ç¼–ç¨‹å®è·µã€‚</p><p><code>util.toUSVString</code>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†ç»™å®šçš„è¾“å…¥å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªâ€œUnicode Scalar Valuesâ€ï¼ˆUnicode æ ‡é‡å€¼åºåˆ—ï¼‰æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚è¿™é€šå¸¸ç”¨äºç¡®ä¿å­—ç¬¦ä¸²ç¬¦åˆç‰¹å®šçš„ Web æ ‡å‡†ï¼Œæ¯”å¦‚ URLsã€HTML æ–‡æ¡£ç­‰ã€‚</p><p>Unicode Scalar Values æ˜¯æŒ‡é‚£äº›ä» U+0000 åˆ° U+D7FF å’Œä» U+E000 åˆ° U+10FFFF çš„å­—ç¬¦ã€‚å®ƒä»¬ä¸åŒ…æ‹¬ Unicode æ›¿ä»£å¯¹ï¼ˆsurrogate pairsï¼‰ï¼Œè¿™äº›æ˜¯ä¸€å¯¹ 16 ä½çš„ä»£ç å•å…ƒï¼Œç”¨æ¥è¡¨ç¤º U+10000 åˆ° U+10FFFF ä¹‹é—´çš„å­—ç¬¦ã€‚</p><p>ç„¶è€Œï¼Œä» Node.js çš„æ–‡æ¡£çœ‹æ¥ï¼Œè¿™ä¸ª<code>util.toUSVString</code>å‡½æ•°å·²ç»è¢«è®¤ä¸ºæ˜¯å¤šä½™çš„ï¼Œå› ä¸º JavaScript çš„<code>String</code>åŸç”Ÿå°±æ”¯æŒ Unicodeï¼Œå¹¶ä¸”æä¾›äº†å„ç§æ–¹æ³•æ¥å¤„ç†å­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªä¸“é—¨çš„å‡½æ•°æ¥è½¬æ¢å­—ç¬¦ä¸²ä¸º USV æ ¼å¼ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“çš„ä¾‹å­è¯´æ˜ä½ å¯èƒ½æ›¾ç»åœ¨å“ªäº›åœºæ™¯ä¸‹ä¼šç”¨åˆ°<code>util.toUSVString</code>ï¼š</p><ol><li><p>å½“ä½ å¤„ç†æ¥è‡ªç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬ï¼Œå¹¶ä¸”æ‰“ç®—å°†è¿™ä¸ªæ–‡æœ¬ç”¨ä½œ URL çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦æ¸…æ´è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç¡®ä¿å®ƒä¸åŒ…å«ä»»ä½•éæ³•æˆ–ç‰¹æ®Šçš„å­—ç¬¦ã€‚</p></li><li><p>åœ¨æœåŠ¡å™¨ç«¯å¤„ç†æ–‡ä»¶è·¯å¾„æˆ–è€…ç½‘ç»œè¯·æ±‚æ ‡å¤´æ—¶ï¼Œä½ å¯èƒ½ä¹Ÿå¸Œæœ›ç¡®ä¿è¿™äº›å­—ç¬¦ä¸²æ²¡æœ‰åŒ…å«æ— æ•ˆçš„ Unicode å­—ç¬¦ã€‚</p></li></ol><p>ä¸ºäº†æ›¿ä»£<code>util.toUSVString</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡† JavaScript å­—ç¬¦ä¸²æ“ä½œï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>encodeURIComponent()</code>ï¼šå½“ä½ å¤„ç† URL å¹¶åŒ…å«ç”±ç”¨æˆ·æä¾›çš„æ•°æ®æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥ç¡®ä¿æ‰€æœ‰å­—ç¬¦éƒ½è¢«æ­£ç¡®åœ°ç¼–ç ã€‚</li><li><code>String.prototype.normalize()</code>ï¼šè¿™ä¸ªå‡½æ•°å¯ä»¥è®©ä½ å°†å­—ç¬¦ä¸²è½¬æ¢åˆ°ä¸€ä¸ªè§„èŒƒå½¢å¼ï¼Œæ¯”å¦‚å°†å­—ç¬¦å’Œå®ƒçš„å˜éŸ³æ ‡è®°åˆå¹¶æˆ–åˆ†å¼€ã€‚</li></ul><p>å¦‚æœä½ ä»¥åé‡åˆ° Node.js ä»£ç ä¸­ä½¿ç”¨äº†<code>util.toUSVString</code>ï¼Œè¯·è€ƒè™‘å°†å…¶æ›¿æ¢ä¸ºä¸Šé¢æåˆ°çš„åŸç”Ÿ JavaScript æ–¹æ³•ã€‚</p><h3 id="dep0176-fs-f-ok-fs-r-ok-fs-w-ok-fs-x-ok" tabindex="-1"><a class="header-anchor" href="#dep0176-fs-f-ok-fs-r-ok-fs-w-ok-fs-x-ok"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0176" target="_blank" rel="noopener noreferrer">DEP0176: fs.F_OK, fs.R_OK, fs.W_OK, fs.X_OK</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>fs</code> æ¨¡å—æ˜¯ä¸€ä¸ªæä¾›æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„å†…ç½®æ¨¡å—ã€‚å½“ä½ æƒ³æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™æ—¶ï¼Œ<code>fs</code> æ¨¡å—æä¾›äº†å‡ ä¸ªç‰¹æ®Šçš„å¸¸é‡æ¥å¸®åŠ©ä½ ï¼š<code>fs.F_OK</code>, <code>fs.R_OK</code>, <code>fs.W_OK</code>, å’Œ <code>fs.X_OK</code>ã€‚è¿™äº›å¸¸é‡ç”¨äºç¡®å®šå½“å‰è¿›ç¨‹æ˜¯å¦æœ‰æƒé™å»æ£€æŸ¥æ–‡ä»¶çš„å­˜åœ¨æ€§ï¼ˆF_OKï¼‰ã€è¯»å–æƒé™ï¼ˆR_OKï¼‰ã€å†™å…¥æƒé™ï¼ˆW_OKï¼‰æˆ–æ‰§è¡Œæƒé™ï¼ˆX_OKï¼‰ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ Node.js çš„æ–°ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ çœ‹åˆ° DEP0176 è¿™ä¸ªè­¦å‘Šï¼Œé‚£å°±æ„å‘³ç€è¿™äº›å¸¸é‡å·²ç»è¢«åºŸå¼ƒã€‚&quot;åºŸå¼ƒ&quot; æ„å‘³ç€å®ƒä»¬ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«å®Œå…¨ç§»é™¤ã€‚Node.js å»ºè®®å¼€å‘è€…ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥æ›¿ä»£è¿™äº›åºŸå¼ƒçš„å¸¸é‡ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹è¿™äº›å¸¸é‡åŠå…¶åºŸå¼ƒæƒ…å†µçš„è§£é‡Šï¼š</p><ul><li><code>fs.F_OK</code>: æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ä»»ä½•æ‹’ç»è®¿é—®è¯¥æ–‡ä»¶çš„é”™è¯¯éƒ½ä¼šå¯¼è‡´æµ‹è¯•ç»“æœä¸ºæ— æ³•è®¿é—®ã€‚</li><li><code>fs.R_OK</code>: æµ‹è¯•æ–‡ä»¶æ˜¯å¦å¯è¯»ã€‚</li><li><code>fs.W_OK</code>: æµ‹è¯•æ–‡ä»¶æ˜¯å¦å¯å†™ã€‚</li><li><code>fs.X_OK</code>: æµ‹è¯•æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œã€‚</li></ul><p>è¿™äº›å¸¸é‡é€šå¸¸ä¸ <code>fs.access()</code> æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ£€æŸ¥å¯¹æ–‡ä»¶çš„æ“ä½œæƒé™ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">access</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">F_OK</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å­˜åœ¨&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯è¯»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">access</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">R_OK</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶ä¸å¯è¯»&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å¯è¯»&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯å†™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">access</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">W_OK</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶ä¸å¯å†™&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å¯å†™&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæ—¢ç„¶è¿™äº›å¸¸é‡è¢«åºŸå¼ƒäº†ï¼Œä½ åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ¥æ›¿ä»£å®ƒä»¬å‘¢ï¼Ÿä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æ•°å­—ä»£æ›¿è¿™äº›å¸¸é‡ï¼Œå› ä¸ºå®ƒä»¬æœ¬è´¨ä¸Šåªæ˜¯ä»£è¡¨äº†ä¸€äº›æ•°å€¼ï¼š</p><ul><li><code>fs.F_OK</code> æ›¿æ¢ä¸º <code>0</code></li><li><code>fs.R_OK</code> æ›¿æ¢ä¸º <code>4</code></li><li><code>fs.W_OK</code> æ›¿æ¢ä¸º <code>2</code></li><li><code>fs.X_OK</code> æ›¿æ¢ä¸º <code>1</code></li></ul><p>æ‰€ä»¥ï¼Œå¦‚æœä½ è¦æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å¯å†™ï¼Œä½ ä¹‹å‰å¯èƒ½å†™çš„æ˜¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">access</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">W_OK</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ä½ åº”è¯¥å†™æˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">access</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·åšçš„åŸå› æ˜¯ä¸ºäº†æœªæ¥çš„å…¼å®¹æ€§å’Œé¿å…ä½¿ç”¨è¢«åºŸå¼ƒçš„ APIã€‚è™½ç„¶è¿™äº›å¸¸é‡ç›®å‰è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½†ä¸ºäº†ç¡®ä¿ä½ çš„ä»£ç èƒ½å¤Ÿé€‚åº”å°†æ¥çš„ Node.js æ›´æ–°ï¼Œæœ€å¥½å°½å¿«é‡‡ç”¨æ¨èçš„æ›¿ä»£æ–¹å¼ç¼–å†™ä»£ç ã€‚</p><h3 id="dep0177-util-types-iswebassemblycompiledmodule" tabindex="-1"><a class="header-anchor" href="#dep0177-util-types-iswebassemblycompiledmodule"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0177" target="_blank" rel="noopener noreferrer">DEP0177: util.types.isWebAssemblyCompiledModule</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯è½¯ä»¶ã€‚åœ¨ Node.js çš„ä¸åŒç‰ˆæœ¬ä¸­ï¼Œä¼šæœ‰æ–°åŠŸèƒ½çš„åŠ å…¥å’Œæ—§åŠŸèƒ½çš„å¼ƒç”¨ï¼ˆDeprecationï¼‰ã€‚å½“æŸä¸ªåŠŸèƒ½è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ï¼Œæ„å‘³ç€è¿™ä¸ªåŠŸèƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–æ”¹å˜ï¼Œå› æ­¤å»ºè®®å¼€å‘è€…åœæ­¢ä½¿ç”¨å¹¶è¿ç§»åˆ°å…¶ä»–æ›¿ä»£çš„å®ç°æ–¹æ³•ã€‚</p><p><code>DEP0177</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šç¼–å·ã€‚è¿™ä¸ªç‰¹å®šçš„è­¦å‘Šæ˜¯å…³äº <code>util.types.isWebAssemblyCompiledModule</code> å‡½æ•°çš„å¼ƒç”¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-util-types-iswebassemblycompiledmodule" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-util-types-iswebassemblycompiledmodule"><span>ä»€ä¹ˆæ˜¯ util.types.isWebAssemblyCompiledModule?</span></a></h3><p><code>util.types.isWebAssemblyCompiledModule</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨æ¥æ£€æµ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ WebAssembly æ¨¡å—çš„å·²ç¼–è¯‘å®ä¾‹ã€‚WebAssemblyï¼ˆç®€ç§° Wasmï¼‰æ˜¯ä¸€ç§ä¸ºå †æ ˆæœºè®¾è®¡çš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ï¼Œå®ƒå…è®¸åœ¨ç½‘ç»œä¸Šä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½æ‰§è¡Œä»£ç ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘é¡µä¸­ã€‚</p><h3 id="å¼ƒç”¨åŸå› " tabindex="-1"><a class="header-anchor" href="#å¼ƒç”¨åŸå› "><span>å¼ƒç”¨åŸå› </span></a></h3><p><code>util.types.isWebAssemblyCompiledModule</code> è¢«å¼ƒç”¨çš„åŸå› å¯èƒ½æ˜¯å› ä¸ºæœ‰æ›´å¥½çš„æ–¹å¼æ¥å¤„ç†ä¸ WebAssembly ç›¸å…³çš„æ“ä½œï¼Œæˆ–è€…æ˜¯å› ä¸ºè¯¥å‡½æ•°çš„ä½¿ç”¨å¹¶ä¸å¹¿æ³›ï¼Œå¯¼è‡´ Node.js å›¢é˜Ÿå†³å®šåœæ­¢å¯¹å…¶æ”¯æŒå’Œç»´æŠ¤ã€‚</p><h3 id="å¦‚ä½•åº”å¯¹å¼ƒç”¨-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åº”å¯¹å¼ƒç”¨-1"><span>å¦‚ä½•åº”å¯¹å¼ƒç”¨</span></a></h3><p>å¦‚æœä½ çš„ä»£ç ä¸­ä½¿ç”¨äº† <code>util.types.isWebAssemblyCompiledModule</code>ï¼Œé‚£ä¹ˆä½ éœ€è¦æ‰¾åˆ°æ›¿ä»£æ–¹æ¡ˆã€‚å…·ä½“çš„æ›¿ä»£æ–¹æ¡ˆå–å†³äºä½ ä¸ºä½•éœ€è¦åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ WebAssembly æ¨¡å—çš„å·²ç¼–è¯‘å®ä¾‹ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä»¥ä¸‹åœºæ™¯ï¼šä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºéœ€è¦åŠ è½½ä¸€ä¸ª WebAssembly æ¨¡å—ï¼Œå¹¶éœ€è¦ç¡®å®šè¿™ä¸ªæ¨¡å—æ˜¯å¦å·²ç»è¢«ç¼–è¯‘ã€‚åœ¨ Node.js v21.7.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šå†™å¦‚ä¸‹ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º &#39;module.wasm&#39; çš„ WebAssembly æ¨¡å—æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;module.wasm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WebAssembly</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">wasmBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">compiledModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isWebAssemblyCompiledModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">compiledModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // è¿™é‡Œå¤„ç†å·²ç»ç¼–è¯‘çš„æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯¥æ¨¡å—æ˜¯æœ‰æ•ˆçš„ WebAssembly å·²ç¼–è¯‘æ¨¡å—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¼–è¯‘æ¨¡å—æ—¶å‡ºé”™&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº <code>util.types.isWebAssemblyCompiledModule</code> è¢«å¼ƒç”¨ï¼Œä¸Šé¢çš„ä»£ç éœ€è¦è°ƒæ•´ã€‚åœ¨ Node.js ä¸­å¤„ç† WebAssembly çš„é€šç”¨æ–¹å¼æ˜¯ç›´æ¥è°ƒç”¨ <code>WebAssembly.compile</code> æˆ– <code>WebAssembly.instantiate</code> æ–¹æ³•ï¼Œå¹¶æ•è·ä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯å…ˆæ£€æŸ¥æ¨¡å—æ˜¯å¦å·²ç¼–è¯‘ã€‚</p><p>å› æ­¤ï¼Œä½ å¯ä»¥é‡æ„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŒæ ·ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º &#39;module.wasm&#39; çš„ WebAssembly æ¨¡å—æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;module.wasm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WebAssembly</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">wasmBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">compiledModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æˆ‘ä»¬çŸ¥é“ &#39;compiledModule&#39; å·²ç»æˆåŠŸç¼–è¯‘ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯¥æ¨¡å—å·²æˆåŠŸç¼–è¯‘&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨è¿™é‡Œå¤„ç†ç¼–è¯‘åçš„æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†ç¼–è¯‘å¤±è´¥çš„æƒ…å†µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¼–è¯‘æ¨¡å—æ—¶å‡ºé”™&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ°å¼ƒç”¨çš„ <code>util.types.isWebAssemblyCompiledModule</code> å‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡ç›´æ¥å°è¯•ç¼–è¯‘æ¨¡å—å¹¶å¤„ç†ç»“æœæ¥ç¡®ä¿æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ WebAssembly æ¨¡å—ã€‚è¿™æ ·çš„å¤„ç†æ–¹å¼æ›´ä¸ºç›´æ¥å’Œå¯é ã€‚</p><p>æ€»ä¹‹ï¼Œå¼ƒç”¨æ˜¯è½¯ä»¶å¼€å‘ä¸­å¸¸è§çš„è¿‡ç¨‹ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨æ‰€ç”¨å¹³å°çš„æœ€æ–°åŠ¨æ€ï¼Œå¹¶åŠæ—¶æ›´æ–°æˆ‘ä»¬çš„ä»£ç ä»¥é€‚åº”è¿™äº›å˜åŒ–ã€‚</p><h3 id="dep0178-dirent-path" tabindex="-1"><a class="header-anchor" href="#dep0178-dirent-path"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0178" target="_blank" rel="noopener noreferrer">DEP0178: dirent.path</a></span></a></h3><p>å¾ˆå¥½ï¼Œæ—¢ç„¶ä½ å¯¹ Node.js v21.7.1 ä¸­çš„ <code>[DEP0178: dirent.path]</code> æ„Ÿå…´è¶£ï¼Œæˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-dirent-path" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-dirent-path"><span>ä»€ä¹ˆæ˜¯ <code>dirent.path</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä¸€ä¸ª <code>Dirent</code> å¯¹è±¡ä»£è¡¨äº†æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç›®å½•é¡¹ï¼ˆå¯ä»¥æ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥ç­‰ï¼‰ã€‚è¿™ä¸ªå¯¹è±¡æä¾›äº†å…³äºç›®å½•é¡¹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å®ƒçš„åå­—ã€å®ƒæ˜¯å¦æ˜¯æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ç­‰ã€‚</p><p><code>dirent.path</code> æ˜¯ <code>Dirent</code> å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†ç›®å½•é¡¹çš„å®Œæ•´è·¯å¾„ã€‚è¿™æ„å‘³ç€å¦‚æœä½ æ­£åœ¨è¯»å–æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª <code>Dirent</code> å¯¹è±¡éƒ½ä¼šåŒ…å«å®ƒè‡ªå·±çš„å®Œæ•´è·¯å¾„ä¿¡æ¯ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ-dirent-path-è¢«åºŸå¼ƒäº†" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-dirent-path-è¢«åºŸå¼ƒäº†"><span>ä¸ºä»€ä¹ˆ <code>dirent.path</code> è¢«åºŸå¼ƒäº†ï¼Ÿ</span></a></h3><p>Node.js å›¢é˜Ÿé€šå¸¸ä¼šåºŸå¼ƒï¼ˆdeprecateï¼‰ä¸€äº›åŠŸèƒ½æˆ–å±æ€§ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½æ˜¯ä¸å®‰å…¨çš„ã€æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ³•æˆ–è€…è®¾è®¡ä¸Šå­˜åœ¨ç¼ºé™·ã€‚å½“ä¸€ä¸ªåŠŸèƒ½è¢«åºŸå¼ƒæ—¶ï¼Œå¼€å‘è€…åº”è¯¥åœæ­¢ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”è½¬å‘ä½¿ç”¨æ¨èçš„æ›¿ä»£æ–¹æ¡ˆã€‚é€šå¸¸ï¼Œåœ¨åºŸå¼ƒçš„åŠŸèƒ½è¢«æœ€ç»ˆç§»é™¤ä¹‹å‰ä¼šæœ‰ä¸€æ®µè¿‡æ¸¡æœŸã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>dirent.path</code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒäº†ï¼ŒåŸå› æ˜¯è®¾è®¡ä¸Šçš„é—®é¢˜ã€‚<code>dirent.path</code> å¹¶ä¸æ˜¯æ‰€æœ‰çš„ <code>Dirent</code> å¯¹è±¡éƒ½æœ‰çš„å±æ€§ï¼Œè¿™å–å†³äºè°ƒç”¨çš„æ–¹æ³•ã€‚è¿™å¯èƒ½å¯¼è‡´äº†äº›æ··ä¹±å’Œæ½œåœ¨çš„é”™è¯¯ï¼Œå› ä¸ºå¼€å‘è€…å¯èƒ½æœŸæœ›æ‰€æœ‰ <code>Dirent</code> å¯¹è±¡éƒ½æœ‰ <code>path</code> å±æ€§ã€‚</p><h3 id="æ›¿ä»£æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#æ›¿ä»£æ–¹æ³•"><span>æ›¿ä»£æ–¹æ³•</span></a></h3><p>å–è€Œä»£ä¹‹çš„ï¼Œä½ åº”è¯¥ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥è·å¾—å®Œæ•´çš„è·¯å¾„ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥è®°å½•ä½ æ­£åœ¨è¯»å–çš„ç›®å½•çš„è·¯å¾„ï¼Œç„¶åå°†ç›®å½•é¡¹çš„åç§°ï¼ˆé€šè¿‡ <code>dirent.name</code> å±æ€§è·å¾—ï¼‰æ‹¼æ¥åˆ°è¯¥è·¯å¾„ä¸Šã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æƒ³è¦åˆ—å‡ºä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œä»¥åŠå®ƒä»¬çš„å®Œæ•´è·¯å¾„ï¼š</p><p>åœ¨ä½¿ç”¨ <code>dirent.path</code> ä¹‹å‰çš„ä»£ç å¯èƒ½çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æ­£åœ¨è¯»å–å½“å‰å·¥ä½œç›®å½•ä¸‹çš„ &#39;someDir&#39; æ–‡ä»¶å¤¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> directoryPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cwd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someDir&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readdir</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">directoryPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">withFileTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">files</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error reading directory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dirent</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> files</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dirent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dirent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨éœ€è¦ä¿®æ”¹ä¸ºä¸ä½¿ç”¨ <code>dirent.path</code> çš„ç‰ˆæœ¬ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æ­£åœ¨è¯»å–å½“å‰å·¥ä½œç›®å½•ä¸‹çš„ &#39;someDir&#39; æ–‡ä»¶å¤¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> directoryPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cwd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someDir&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readdir</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">directoryPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">withFileTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">files</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error reading directory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dirent</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> files</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä½¿ç”¨ path.join æ¥æ‰‹åŠ¨æ„å»ºå®Œæ•´çš„è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fullPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">directoryPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dirent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fullPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¿®æ”¹åçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºäº†æ¯ä¸ªæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œé€šè¿‡ç»“åˆæˆ‘ä»¬çŸ¥é“çš„ç›®å½•è·¯å¾„å’Œ <code>dirent.name</code>ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒåºŸå¼ƒ <code>dirent.path</code> å¯èƒ½ä¼šè®©å¼€å‘è€…éœ€è¦åšä¸€ç‚¹é¢å¤–çš„å·¥ä½œæ¥å¤„ç†è·¯å¾„ï¼Œä½†è¿™æ ·èƒ½ç¡®ä¿ä»£ç æ›´åŠ æ¸…æ™°å’Œä¸€è‡´ã€‚åœ¨ç¼–å†™æ–°çš„ Node.js ä»£ç æ—¶ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨è¢«åºŸå¼ƒçš„åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æœªæ¥éšç€ Node.js ç‰ˆæœ¬æ›´æ–°è€Œäº§ç”Ÿçš„å…¼å®¹æ€§é—®é¢˜ã€‚</p><h3 id="dep0179-hash-constructor" tabindex="-1"><a class="header-anchor" href="#dep0179-hash-constructor"><span><a href="https://nodejs.org/docs/latest/api/deprecations.html#DEP0179" target="_blank" rel="noopener noreferrer">DEP0179: Hash constructor</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥èŠèŠ Node.js ä¸­çš„è¿™ä¸ª DEP0179 å¼ƒç”¨è­¦å‘Šã€‚</p><p>é¦–å…ˆï¼Œæ¦‚å¿µè§£é‡Šä¸€ä¸‹ï¼š</p><ul><li><strong>Node.js</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚</li><li><strong>DEP0179</strong> æ˜¯ Node.js å®˜æ–¹åˆ†é…çš„ä¸€ä¸ªç‰¹å®šå¼ƒç”¨ä»£ç ï¼ˆDeprecated APIï¼‰ï¼Œç”¨äºæ ‡è¯†å³å°†ä¸å†è¢«æ”¯æŒçš„åŠŸèƒ½æˆ– APIã€‚</li></ul><p>å…·ä½“æ¥è¯´ï¼ŒDEP0179 è­¦å‘Šæ˜¯å…³äºå¼ƒç”¨ <code>crypto.Hash</code> æ„é€ å‡½æ•°çš„ç›´æ¥è°ƒç”¨ã€‚åœ¨ Node.js çš„åŠ å¯†æ¨¡å—ä¸­ï¼Œ<code>crypto.Hash</code> æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºæ•°æ®å“ˆå¸Œï¼ˆæ•£åˆ—ï¼‰çš„å·¥å…·ï¼Œè¿™æ˜¯ä¸€ä¸ªå®‰å…¨æ€§çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”Ÿæˆä¾‹å¦‚ MD5, SHA1, SHA256 ç­‰å“ˆå¸Œå€¼ã€‚</p><p>åœ¨è¿‡å»ï¼Œæˆ‘ä»¬å¯èƒ½é€šè¿‡ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªå“ˆå¸Œå®ä¾‹ï¼Œå°±åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ç°åœ¨ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°çš„æ–¹å¼è¢«è®¤ä¸ºæ˜¯ä¸å†æ¨èä½¿ç”¨çš„ï¼Œè€Œä¸”æœªæ¥ç‰ˆæœ¬ä¸­å°†ä¼šå®Œå…¨ç§»é™¤ã€‚è¿™æ„å‘³ç€å¦‚æœä½ ç»§ç»­ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå½“ä½ å‡çº§åˆ°æœªæ¥çš„ Node.js ç‰ˆæœ¬æ—¶ï¼Œä½ çš„ä»£ç å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚</p><p>é‚£ä¹ˆï¼Œæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼ŸNode.js å»ºè®®æˆ‘ä»¬ä½¿ç”¨ <code>crypto.createHash()</code> å·¥å‚æ–¹æ³•æ¥ä»£æ›¿ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°ã€‚å·¥å‚æ–¹æ³•æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œå¯¹å¤–éšè—äº†åˆ›å»ºå¯¹è±¡çš„å…·ä½“é€»è¾‘ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªæ›´æ–°åçš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»º Hash å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ›´æ–°å“ˆå¸Œçš„å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some data to hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¡ç®—å¹¶è¾“å‡ºæ‘˜è¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>.createHash()</code> æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å“ˆå¸Œå¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬ç”¨ <code>.update()</code> æ–¹æ³•æ¥æ·»åŠ æˆ‘ä»¬æƒ³è¦å“ˆå¸Œå¤„ç†çš„æ•°æ®ã€‚æœ€åï¼Œè°ƒç”¨ <code>.digest()</code> æ–¹æ³•æ¥ç”Ÿæˆæœ€ç»ˆçš„å“ˆå¸Œå€¼ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js å°†æ¥çš„å˜æ›´å°±ä¸ä¼šå½±å“åˆ°ä½ çš„ä»£ç ï¼Œå› ä¸º <code>.createHash()</code> æ–¹æ³•ä¼šç»§ç»­å¾—åˆ°æ”¯æŒã€‚</p><p>å°ç»“ï¼šå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„ <code>crypto</code> æ¨¡å—æ¥è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œè¯·ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯ <code>crypto.createHash()</code> æ–¹æ³•æ¥åˆ›å»ºå“ˆå¸Œå®ä¾‹ï¼Œé¿å…ç›´æ¥è°ƒç”¨å·²å¼ƒç”¨çš„ <code>crypto.Hash</code> æ„é€ å‡½æ•°ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç å…¼å®¹æ€§å’Œæœªæ¥çš„ç¨³å®šæ€§ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Debugger.html" aria-label="Debugger"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Debugger</div></a><a class="route-link auto-link next" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Diagnostic report<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.e98858ae.js" defer></script><script src="/assets/js/9435.209d772b.js" defer></script><script src="/assets/js/app.604dc302.js" defer></script>
  </body>
</html>
